/*! For license information please see qxym0f.7.82317d17.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{12901:J=>{"use strict";J.exports=function(J,T,b,q,t,j){var B=+T[0],Y=+T[1],C=+T[2],F=+b[0],A=+b[1],a=+b[2],P=Math.sqrt(F*F+A*A+a*a);if(0===P)throw new Error("Can't raycast along a zero vector");return function(J,T,b,q,t,j,B,Y,C,F){for(var A=0,a=Math.floor,P=0|a(T),v=0|a(b),G=0|a(q),x=t>0?1:-1,I=j>0?1:-1,u=B>0?1:-1,U=Math.abs(1/t),K=Math.abs(1/j),E=Math.abs(1/B),l=U<1/0?U*(x>0?P+1-T:T-P):1/0,W=K<1/0?K*(I>0?v+1-b:b-v):1/0,p=E<1/0?E*(u>0?G+1-q:q-G):1/0,o=-1;A<=Y;){var S=J(P,v,G);if(S)return C&&(C[0]=T+A*t,C[1]=b+A*j,C[2]=q+A*B),F&&(F[0]=F[1]=F[2]=0,0===o&&(F[0]=-x),1===o&&(F[1]=-I),2===o&&(F[2]=-u)),S;l<W?l<p?(P+=x,A=l,l+=U,o=0):(G+=u,A=p,p+=E,o=2):W<p?(v+=I,A=W,W+=K,o=1):(G+=u,A=p,p+=E,o=2)}return C&&(C[0]=T+A*t,C[1]=b+A*j,C[2]=q+A*B),F&&(F[0]=F[1]=F[2]=0),0}(J,B,Y,C,F/=P,A/=P,a/=P,q="undefined"===typeof q?64:+q,t,j)}},12948:(J,T,b)=>{"use strict";b.d(T,{e:()=>j});var q=b(97);function t(){this.Tl=!1,this.stopPropagation=!1,this.Ul=!1,this.disabled=!1}class j{constructor(J,T){this.version="0.7.0";var b=Object.assign({},new t,T||{});this.element=J||document,this.Tl=!!b.Tl,this.stopPropagation=!!b.stopPropagation,this.Ul=!!b.Ul,this.disabled=!!b.disabled,this.filterEvents=(J,T)=>!0,this.down=new q.EventEmitter,this.up=new q.EventEmitter,this.state={},this.xk={dx:0,dy:0,Am:0,tg:0,Bm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Y(this):document.addEventListener("DOMContentLoaded",(J=>{Y(this)}),{once:!0})}bind(J){for(var T=arguments.length,b=new Array(T>1?T-1:0),q=1;q<T;q++)b[q-1]=arguments[q];b.forEach((T=>{var b=this._keyBindmap[T]||[];b.includes(J)||(b.push(J),this._keyBindmap[T]=b)})),this.state[J]=!!this.state[J],this.pressCount[J]=this.pressCount[J]||0,this.releaseCount[J]=this.releaseCount[J]||0}unbind(J){for(var T in this._keyBindmap){var b=this._keyBindmap[T],q=b.indexOf(J);q>-1&&b.splice(q,1)}}getBindings(){var J={};for(var T in this._keyBindmap){this._keyBindmap[T].forEach((b=>{J[b]=J[b]||[],J[b].push(T)}))}return J}$e(){B(this.xk),B(this.pressCount),B(this.releaseCount)}}function B(J){for(var T in J)J[T]=0}function Y(J){window.addEventListener("keydown",G.bind(null,J,!0),!1),window.addEventListener("keyup",G.bind(null,J,!1),!1);var T={passive:!0};J.element.addEventListener("touchstart",a.bind(void 0,J),{passive:!1}),J.element.addEventListener("touchend",v.bind(void 0,J),T),J.element.addEventListener("mousedown",x.bind(null,J,!0),T),window.document.addEventListener("mouseup",x.bind(null,J,!1),T),J.element.addEventListener("touchmove",I.bind(null,J),T),J.element.addEventListener("mousemove",I.bind(null,J),T),window.PointerEvent,J.element.addEventListener("wheel",u.bind(null,J),T),J.element.addEventListener("contextmenu",U.bind(null,J),!1),window.addEventListener("blur",K.bind(null,J),!1)}var C=0,F=0,A=null;function a(J,T){T.preventDefault(),P(T)}function P(J){let T=!1;for(let b=0;b<J.touches.length;++b)if(J.touches[b].identifier===A){T=!0;break}if(!T){const T=J.changedTouches[0];C=T.clientX,F=T.clientY,A=T.identifier}}function v(J,T){for(var b=T.changedTouches,q=0;q<b.length;++q)b[q].identifier===A&&(A=null)}function G(J,T,b){E(b.code,T,J,b)}function x(J,T,b){if("pointerId"in b)if(T){if(null!==J._touches.currID)return;J._touches.currID=b.pointerId}else{if(J._touches.currID!==b.pointerId)return;J._touches.currID=null}return E("Mouse"+("button"in b?b.button+1:1),T,J,b),!1}function I(J,T){var b=T.movementX||T.mozMovementX||0,q=T.movementY||T.mozMovementY||0;if(T.touches&&0===(b|q)){var t=function(J){P(J);for(let T=0;T<J.changedTouches.length;++T)if(J.changedTouches[T].identifier==A){const b=J.changedTouches[T],q=[b.clientX-C,b.clientY-F];return C=b.clientX,F=b.clientY,q}return console.error(`Did not find touch id ${A}`),[0,0]}(T);b=t[0],q=t[1]}J.xk.dx+=b,J.xk.dy+=q}function u(J,T){var b=1;switch(T.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=J.element.clientHeight||window.innerHeight}J.xk.Am+=(T.deltaX||0)*b,J.xk.tg+=(T.deltaY||0)*b,J.xk.Bm+=(T.deltaZ||0)*b}function U(J,T){if(!J.Ul)return T.preventDefault(),!1}function K(J){for(var T in J._keyStates)J._keyStates[T]&&(/^Mouse\d/.test(T)||E(T,!1,J,{code:T,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(J,T,b,q){var t=b._keyBindmap[J];t&&(l(b._keyStates[J],T)&&(b._keyStates[J]=T,t.forEach((J=>{(!b.filterEvents||b.filterEvents(q,J))&&function(J,T,b,q){var t=T?b.pressCount:b.releaseCount;t[J]=(t[J]||0)+1;var j=b._bindPressCount[J]||0;(j+=T?1:-1)<0&&(j=0);b._bindPressCount[J]=j;var B=b.state[J];if(l(B,j)){b.state[J]=j>0;var Y=T?b.down:b.up;b.disabled||Y.emit(J,q)}}(J,T,b,q)}))),"button"in q||(b.Tl&&!q.defaultPrevented&&q.preventDefault(),b.stopPropagation&&q.stopPropagation()))}function l(J,T){return J?!T:T}},12909:(J,T,b)=>{"use strict";b.d(T,{c:()=>q});class q{constructor(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Zk=!1,this.$k=!1,this.Jh=30,this.Yk=0,this.fl=!1,this.fullscreen=!1,this.al=function(J){},this.bl=function(){},this.dl=function(){},this.k=function(){},this.cl=function(J){},this.onFullscreenChanged=function(J){},F((()=>{!function(J,T){J._nowObject=performance||Date,J._lastTick=0,J._renderAccum=0,J._rt=0,J._frameCB=Y.bind(null,J),requestAnimationFrame(J._frameCB),T>0&&(J._intervalCB=B.bind(null,J),J._interval=setInterval(J._intervalCB,Math.max(T,1e3/J.Jh/2)))}(this,T),function(J,T){if(!T)return;var b=!1,q=!1;document.addEventListener("pointerlockchange",(q=>{b=document.pointerLockElement===T,J.cl(b)})),document.addEventListener("fullscreenchange",(b=>{q=document.fullscreenElement===T,J.onFullscreenChanged(q)})),Object.defineProperty(J,"fl",{get:()=>b,set:J=>{J&&!b?C(T):b&&!J&&function(J){J.exitPointerLock&&J.exitPointerLock()}(document)}}),Object.defineProperty(J,"fullscreen",{get:()=>q,set:J=>{J&&!q?T.requestFullscreen():q&&!J&&document.exitFullscreen()}}),T.addEventListener("click",(t=>{J.Zk&&!b&&C(T),J.$k&&!q&&T.requestFullscreen()}));var t=()=>J.k();if(window.ResizeObserver){new ResizeObserver(t).observe(T)}else window.addEventListener("resize",t)}(this,J),this.dl()}))}}var t=3,j=20;function B(J){for(var T=1e3/J.Jh,b=J._nowObject.now()+j,q=0;J._nowObject.now()>=J._lastTick+T&&J._nowObject.now()<b&&++q<=t;)J.al(T),J._lastTick+=T;var B=5*(T+5),Y=J._nowObject.now();if(Y-J._lastTick>B)for(;Y>=J._lastTick+T;)J._lastTick+=T}function Y(J){requestAnimationFrame(J._frameCB),B(J);var T=J._nowObject.now(),b=T-J._rt;if(J._rt=T,J.Yk>0){J._renderAccum+=b;var q=1e3/J.Yk;if(J._renderAccum<q)return;J._renderAccum=Math.min(J._renderAccum-q,q)}var t=1e3/J.Jh,j=(T-J._lastTick)/t;J.bl(b,j,t)}function C(J){J.requestPointerLock&&J.requestPointerLock()}var F=J=>{if("loading"===document.readyState){var T=()=>{document.removeEventListener("readystatechange",T),J()};document.addEventListener("readystatechange",T)}else setTimeout(J,1)}},12957:(J,T,b)=>{"use strict";b.d(T,{d:()=>a});var q=b(917),t=b(146);class j{constructor(J,T,b,j,B,Y,C){this.Mh=new q(J.base,J.Nh),this.mass=T,this.friction=b,this.restitution=j,this.Ck=B,this.Uh=Y,this.Dk=!!C,this.Qk=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.hh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Oh=t.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=t.create(),this._impulses=t.create(),this._sleepFrameCount=10}loadFromCopy(J){t.i(this.Mh.base,J.Mh.base),t.i(this.Mh.Nh,J.Mh.Nh),t.i(this.Mh.max,J.Mh.max),this.Mh.mag=J.Mh.mag,this.mass=J.mass,this.friction=J.friction,this.restitution=J.restitution,this.Ck=J.Ck,this.Uh=J.Uh,this.Dk=J.Dk,this.Qk=J.Qk,this.fluidDrag=J.fluidDrag,this.hh=J.hh,this.preventFallOffEdge=J.preventFallOffEdge,this.rolledBackLastTick=J.rolledBackLastTick,t.i(this.Oh,J.Oh),t.i(this.resting,J.resting),this.inFluid=J.inFluid,this._ratioInFluid=J._ratioInFluid,t.i(this._forces,J._forces),t.i(this._impulses,J._impulses),this._sleepFrameCount=J._sleepFrameCount}setPosition(J){B(J),t.Jg(J,J,this.Mh.base),this.Mh.translate(J),this.Lg()}Ve(){return t.clone(this.Mh.base)}applyForce(J){B(J),t.add(this._forces,this._forces,J),this.Lg()}applyImpulse(J){B(J),t.add(this._impulses,this._impulses,J),this.Lg()}Lg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var B=J=>{};var Y=b(917),C=b(146),F=b(922);function A(){this.Qk=.1,this.fluidDrag=.4,this.tj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function a(J,T,b){J=Object.assign(new A,J),this.gravity=J.gravity||[0,-10,0],this.Qk=J.Qk||.1,this.tj=J.tj||2,this.fluidDrag=J.fluidDrag||.4,this.minBounceImpulse=J.minBounceImpulse,this.bodies=[],this.sm=J.sm,this.testSolid=T,this.testFluid=b}a.prototype.Eh=function(J,T,b,q,t,B){J=J||new Y([0,0,0],[1,1,1]),"undefined"==typeof T&&(T=1),"undefined"==typeof b&&(b=1),"undefined"==typeof q&&(q=0),"undefined"==typeof t&&(t=1);var C=new j(J,T,b,q,t,B);return this.bodies.push(C),C},a.prototype.Hh=function(J){var T=this.bodies.indexOf(J);T<0||(this.bodies.splice(T,1),J.Mh=J.Uh=null)};var P=C.create(),v=C.create(),G=C.create(),x=C.create(),I=C.create(),u=C.create(),U=C.create(),K=new Y([0,0,0],[1,1,1]),E=new j(K,1,1,0,1,(()=>{}),!1);function l(J,T,b){return T=b,T*=1-(1-J.ratioInFluid)**2}a.prototype.$e=function(J){J/=1e3;var T=i(0,C.squaredLength(this.gravity));this.bodies.forEach((b=>function(J,T,b,q){C.i(I,T.resting),J.sm&&E.loadFromCopy(T);if(T.mass<=0)return C.set(T.Oh,0,0,0),C.set(T._forces,0,0,0),void C.set(T._impulses,0,0,0);var t=q||0===T.Ck;if(function(J,T,b,q){if(T._sleepFrameCount>0)return!1;if(q)return!0;var t=!1,j=.5*b*b*T.Ck;return C.scale(h,J.gravity,j),F(J.testSolid,T.Mh,h,(function(){return t=!0,!0}),!0),t}(J,T,b,t))return;T._sleepFrameCount--,function(J,T){var b=T.Mh,q=Math.floor(b.base[0]),t=Math.floor(b.base[2]),j=Math.floor(b.base[1]),B=Math.floor(b.max[1]);if(!J.testFluid(q,j,t))return T.inFluid=!1,void(T.ratioInFluid=0);var Y=1,F=j+1;for(;F<=B&&J.testFluid(q,F,t);)Y++,F++;var A=(j+Y-b.base[1])/b.Nh[1];A>1&&(A=1);var a=b.Nh[0]*b.Nh[1]*b.Nh[2]*A,P=p;C.scale(P,J.gravity,-J.tj*a*T.Ck),T.applyForce(P),T.inFluid=!0,T.ratioInFluid=A}(J,T),O(T._forces),O(T._impulses),O(T.Oh),O(T.resting),C.scale(P,T._forces,1/T.mass),C.sh(P,P,J.gravity,T.Ck),C.scale(v,T._impulses,1/T.mass),C.sh(v,v,P,b),C.add(T.Oh,T.Oh,v),T.friction&&(o(J,0,T,v,b),o(J,1,T,v,b),o(J,2,T,v,b));var j=T.fluidDrag>=0?T.fluidDrag:J.fluidDrag,B=T.Qk>=0?T.Qk:J.Qk,Y=B,A=B;T.inFluid&&(Y=l(T,Y,T.fluidDragHoriz>=0?T.fluidDragHoriz:j),A=l(T,A,T.fluidDragVert>=0?T.fluidDragVert:j));Y=Math.max(1-Y*b/T.mass,0),A=Math.max(1-A*b/T.mass,0),C.set(W,Y,A,Y),C.multiply(T.Oh,T.Oh,W),C.scale(G,T.Oh,b),C.set(T._forces,0,0,0),C.set(T._impulses,0,0,0),T.Dk&&m(s,T.Mh);C.i(u,G),C.set(U,0,0,0),T.preventFallOffEdge&&function(J,T,b,q){if(!T.resting[1]||b[1]>0)return;var t=c;m(t,T.Mh);for(var j=0;j<3;j+=2){C.set(e,0,0,0),e[j]=b[j];var B=!0;(B=(B=(B=(B=B&&!Q(J,t.base[0]+e[0]+1e-5,t.base[1],t.base[2]+e[2]+1e-5))&&!Q(J,t.max[0]+e[0]-1e-5,t.base[1],t.base[2]+e[2]+1e-5))&&!Q(J,t.base[0]+e[0]+1e-5,t.base[1],t.max[2]+e[2]-1e-5))&&!Q(J,t.max[0]+e[0]-1e-5,t.base[1],t.max[2]+e[2]-1e-5))?(q[j]=b[j]>0?1:-1,b[j]=0):0===j&&(C.set(V,b[0],0,0),H(J,t,V,q,T.slideOnCollision))}}(J,T,G,U);H(J,T.Mh,G,T.resting,T.slideOnCollision),T.Dk&&function(J,T,b,q){if(T.resting[1]>=0&&!T.inFluid)return;var t=0!==T.resting[0],j=0!==T.resting[2];if(!t&&!j)return;var B=Math.abs(q[0]/q[2]),Y=4;if(!t&&B>Y)return;if(!j&&B<1/Y)return;C.add(d,b.base,q);var A=J.testSolid;F(A,b,q,(function(J,T,b,q){if(1!==T)return!0;q[T]=0}));var a=b.base[1],P=T.inFluid?1.951:1.001,v=Math.floor(a+P)-a;C.set(w,0,v,0);var G=!1;if(F(A,b,w,(function(J,T,b,q){return G=!0,!0})),G)return;C.Jg(Z,d,b.base),Z[1]=0,H(J,b,Z,g,!0);var x=i(b.base[0],d[0]),I=i(b.base[2],d[2]);if(t&&!x&&(!I||!j))return;if(j&&(!x||!t)&&!I)return;var u=!0;if(u=u&&!Q(J,b.base[0]+1e-5,b.base[1],b.base[2]+1e-5),u=u&&!Q(J,b.max[0]-1e-5,b.base[1],b.base[2]+1e-5),u=u&&!Q(J,b.base[0]+1e-5,b.base[1],b.max[2]-1e-5),u=u&&!Q(J,b.max[0]-1e-5,b.base[1],b.max[2]-1e-5),u)return;m(T.Mh,b),T.resting[0]=g[0],T.resting[2]=g[2],T.hh&&T.hh()}(J,T,s,u);for(var a=0;a<3;++a)T.resting[a]=T.resting[a]||U[a],x[a]=0,T.resting[a]&&(I[a]||(x[a]=-T.Oh[a]),T.Oh[a]=0);var K=C.length(x);K>.001&&(C.scale(x,x,T.mass),T.Uh&&T.Uh(x),T.restitution>0&&K>J.minBounceImpulse&&(C.scale(x,x,T.restitution),T.applyImpulse(x)));var S=C.squaredLength(T.Oh);S>1e-5&&T.Lg();J.sm&&J.sm(T)?(T.loadFromCopy(E),T.rolledBackLastTick=!0):T.rolledBackLastTick=!1}(this,b,J,T)))};var W=C.create([0,0,0]);var p=C.create();function o(J,T,b,q,t){var j=b.resting[T],B=q[T];if(!b.alwaysApplyHorizFriction||1!==T){if(0===j)return;if(j*B<=0)return}C.i(S,b.Oh),S[T]=0;var Y=C.length(S);if(!i(Y,0)){var F=Math.abs(b.friction*J.gravity[T]*t),A=Y>F?(Y-F)/Y:0;b.Oh[(T+1)%3]*=A,b.Oh[(T+2)%3]*=A}}var S=C.create();function H(J,T,b,q,t){return C.set(q,0,0,0),F(J.testSolid,T,b,(function(J,T,b,j){q[T]=b,j[T]=0,t||(j[0]=0,j[1]=0,j[2]=0)}))}var s=new Y([],[]),g=C.create(),d=C.create(),w=C.create(),Z=C.create();var e=C.create(),c=new Y([],[]),V=C.create();function Q(J,T,b,q){return J.testSolid(Math.floor(T),Math.floor(b-1),Math.floor(q))}var h=C.create();function i(J,T){return Math.abs(J-T)<1e-5}function m(J,T){for(var b=0;b<3;b++)J.base[b]=T.base[b],J.max[b]=T.max[b],J.Nh[b]=T.Nh[b]}var O=function(J){}},11749:function(J,T){!function(J){"use strict";var T=function(J,b){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,T){J.__proto__=T}||function(J,T){for(var b in T)Object.prototype.hasOwnProperty.call(T,b)&&(J[b]=T[b])},T(J,b)};function b(J,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function q(){this.constructor=J}T(J,b),J.prototype=null===b?Object.create(b):(q.prototype=b.prototype,new q)}function q(J,T,b,q){var t,j=arguments.length,B=j<3?T:null===q?q=Object.getOwnPropertyDescriptor(T,b):q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)B=Reflect.decorate(J,T,b,q);else for(var Y=J.length-1;Y>=0;Y--)(t=J[Y])&&(B=(j<3?t(B):j>3?t(T,b,B):t(T,b))||B);return j>3&&B&&Object.defineProperty(T,b,B),B}function t(J,T,b){if(b||2===arguments.length)for(var q,t=0,j=T.length;t<j;t++)!q&&t in T||(q||(q=Array.prototype.slice.call(T,0,t)),q[t]=T[t]);return J.concat(q||Array.prototype.slice.call(T))}var j,B=255,Y=213;J.OPERATION=void 0,(j=J.OPERATION||(J.OPERATION={}))[j.ADD=128]="ADD",j[j.REPLACE=0]="REPLACE",j[j.DELETE=64]="DELETE",j[j.DELETE_AND_ADD=192]="DELETE_AND_ADD",j[j.TOUCH=1]="TOUCH",j[j.CLEAR=10]="CLEAR";var C=function(){function T(J,T,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=J,this.setParent(T,b)}return T.prototype.setParent=function(J,T,b){var q=this;if(this.indexes||(this.indexes=this.ref instanceof ZJ?this.ref._definition.indexes:{}),this.parent=J,this.parentIndex=b,T)if(this.root=T,this.ref instanceof ZJ){var t=this.ref._definition;for(var j in t.schema){var B=this.ref[j];if(B&&B.$changes){var Y=t.indexes[j];B.$changes.setParent(this.ref,T,Y)}}}else"object"===typeof this.ref&&this.ref.forEach((function(J,T){if(J instanceof ZJ){var b=J.$changes,t=q.ref.$changes.indexes[T];b.setParent(q.ref,q.root,t)}}))},T.prototype.operation=function(J){this.changes.set(--this.currentCustomOperation,J)},T.prototype.change=function(T,b){void 0===b&&(b=J.OPERATION.ADD);var q="number"===typeof T?T:this.indexes[T];this.assertValidIndex(q,T);var t=this.changes.get(q);t&&t.op!==J.OPERATION.DELETE&&t.op!==J.OPERATION.TOUCH||this.changes.set(q,{op:t&&t.op===J.OPERATION.DELETE?J.OPERATION.DELETE_AND_ADD:b,index:q}),this.allChanges.add(q),this.changed=!0,this.touchParents()},T.prototype.touch=function(T){var b="number"===typeof T?T:this.indexes[T];this.assertValidIndex(b,T),this.changes.has(b)||this.changes.set(b,{op:J.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},T.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},T.prototype.getType=function(J){if(this.ref._definition)return(T=this.ref._definition).schema[T.fieldsByIndex[J]];var T,b=(T=this.parent._definition).schema[T.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},T.prototype.getChildrenFilter=function(){var J=this.parent._definition.childFilters;return J&&J[this.parentIndex]},T.prototype.getValue=function(J){return this.ref.getByIndex(J)},T.prototype.delete=function(T){var b="number"===typeof T?T:this.indexes[T];if(void 0!==b){var q=this.getValue(b);this.changes.set(b,{op:J.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],q&&q.$changes&&(q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(T," (").concat(b,")"))},T.prototype.discard=function(T,b){var q=this;void 0===T&&(T=!1),void 0===b&&(b=!1),this.ref instanceof ZJ||this.changes.forEach((function(T){if(T.op===J.OPERATION.DELETE){var b=q.ref.getIndex(T.index);delete q.indexes[b]}})),this.changes.clear(),this.changed=T,b&&this.allChanges.clear(),this.currentCustomOperation=0},T.prototype.discardAll=function(){var J=this;this.changes.forEach((function(T){var b=J.getValue(T.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},T.prototype.cache=function(J,T){this.caches[J]=T},T.prototype.clone=function(){return new T(this.ref,this.parent,this.root)},T.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},T.prototype.assertValidIndex=function(J,T){if(void 0===J)throw new Error('ChangeTree: missing index for field "'.concat(T,'"'))},T}();function F(J,T,b,q){return J[T]||(J[T]=[]),J[T].push(b),null===q||void 0===q||q.forEach((function(J,T){return b(J,T)})),function(){return a(J[T],J[T].indexOf(b))}}function A(T){var b=this,q="string"!==typeof this.$changes.getType();this.$items.forEach((function(t,j){T.push({refId:b.$changes.refId,op:J.OPERATION.DELETE,field:j,value:void 0,previousValue:t}),q&&b.$changes.root.removeRef(t.$changes.refId)}))}function a(J,T){if(-1===T||T>=J.length)return!1;for(var b=J.length-1,q=T;q<b;q++)J[q]=J[q+1];return J.length=b,!0}var P=function(J,T){var b=J.toString(),q=T.toString();return b<q?-1:b>q?1:0};function v(J){return J.$proxy=!0,J=new Proxy(J,{get:function(J,T){return"symbol"===typeof T||isNaN(T)?J[T]:J.at(T)},set:function(J,T,b){if("symbol"===typeof T||isNaN(T))J[T]=b;else{var q=Array.from(J.$items.keys()),t=parseInt(q[T]||T);void 0===b||null===b?J.deleteAt(t):J.setAt(t,b)}return!0},deleteProperty:function(J,T){return"number"===typeof T?J.deleteAt(T):delete J[T],!0}})}var G=function(){function T(){for(var J=[],T=0;T<arguments.length;T++)J[T]=arguments[T];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,J)}return T.prototype.kh=function(T,b){return void 0===b&&(b=!0),F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.ADD,T,b?this.$items:void 0)},T.prototype.jh=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.REPLACE,T)},T.is=function(J){return Array.isArray(J)||void 0!==J.array},Object.defineProperty(T.prototype,"length",{get:function(){return this.$items.size},set:function(J){0===J?this.clear():this.splice(J,this.length-J)},enumerable:!1,configurable:!0}),T.prototype.push=function(){for(var J,T=this,b=[],q=0;q<arguments.length;q++)b[q]=arguments[q];return b.forEach((function(b){J=T.$refId++,T.setAt(J,b)})),J},T.prototype.pop=function(){var J=Array.from(this.$indexes.values()).pop();if(void 0!==J){this.$changes.delete(J),this.$indexes.delete(J);var T=this.$items.get(J);return this.$items.delete(J),T}},T.prototype.at=function(J){var T=Array.from(this.$items.keys())[J];return this.$items.get(T)},T.prototype.setAt=function(T,b){var q,t;if(void 0!==b&&null!==b){if(this.$items.get(T)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,T);var j=null!==(t=null===(q=this.$changes.indexes[T])||void 0===q?void 0:q.op)&&void 0!==t?t:J.OPERATION.ADD;this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,b),this.$changes.change(T,j)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},T.prototype.deleteAt=function(J){var T=Array.from(this.$items.keys())[J];return void 0!==T&&this.$deleteAt(T)},T.prototype.$deleteAt=function(J){return this.$changes.delete(J),this.$indexes.delete(J),this.$items.delete(J)},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&A.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:J.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.concat=function(){for(var J,b=[],q=0;q<arguments.length;q++)b[q]=arguments[q];return new(T.bind.apply(T,t([void 0],(J=Array.from(this.$items.values())).concat.apply(J,b),!1)))},T.prototype.join=function(J){return Array.from(this.$items.values()).join(J)},T.prototype.reverse=function(){var J=this,T=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,q){J.setAt(T[q],b)})),this},T.prototype.shift=function(){var J=Array.from(this.$items.keys()).shift();if(void 0!==J){var T=this.$items.get(J);return this.$deleteAt(J),T}},T.prototype.slice=function(J,b){var q=new T;return q.push.apply(q,Array.from(this.$items.values()).slice(J,b)),q},T.prototype.sort=function(J){var T=this;void 0===J&&(J=P);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(J).forEach((function(J,q){T.setAt(b[q],J)})),this},T.prototype.splice=function(J,T){void 0===T&&(T=this.length-J);for(var b=Array.from(this.$items.keys()),q=[],t=J;t<J+T;t++)q.push(this.$items.get(b[t])),this.$deleteAt(b[t]);return q},T.prototype.unshift=function(){for(var J=this,T=[],b=0;b<arguments.length;b++)T[b]=arguments[b];var q=this.length,t=T.length,j=Array.from(this.$items.values());return T.forEach((function(T,b){J.setAt(b,T)})),j.forEach((function(T,b){J.setAt(t+b,T)})),q+t},T.prototype.indexOf=function(J,T){return Array.from(this.$items.values()).indexOf(J,T)},T.prototype.lastIndexOf=function(J,T){return void 0===T&&(T=this.length-1),Array.from(this.$items.values()).lastIndexOf(J,T)},T.prototype.every=function(J,T){return Array.from(this.$items.values()).every(J,T)},T.prototype.some=function(J,T){return Array.from(this.$items.values()).some(J,T)},T.prototype.forEach=function(J,T){Array.from(this.$items.values()).forEach(J,T)},T.prototype.map=function(J,T){return Array.from(this.$items.values()).map(J,T)},T.prototype.filter=function(J,T){return Array.from(this.$items.values()).filter(J,T)},T.prototype.reduce=function(J,T){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},T.prototype.reduceRight=function(J,T){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},T.prototype.find=function(J,T){return Array.from(this.$items.values()).find(J,T)},T.prototype.findIndex=function(J,T){return Array.from(this.$items.values()).findIndex(J,T)},T.prototype.fill=function(J,T,b){throw new Error("ArraySchema#fill() not implemented")},T.prototype.copyWithin=function(J,T,b){throw new Error("ArraySchema#copyWithin() not implemented")},T.prototype.toString=function(){return this.$items.toString()},T.prototype.toLocaleString=function(){return this.$items.toLocaleString()},T.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(T,Symbol.species,{get:function(){return T},enumerable:!1,configurable:!0}),T.prototype.entries=function(){return this.$items.entries()},T.prototype.keys=function(){return this.$items.keys()},T.prototype.values=function(){return this.$items.values()},T.prototype.includes=function(J,T){return Array.from(this.$items.values()).includes(J,T)},T.prototype.flatMap=function(J,T){throw new Error("ArraySchema#flatMap() is not supported.")},T.prototype.flat=function(J){throw new Error("ArraySchema#flat() is not supported.")},T.prototype.findLast=function(){var J=Array.from(this.$items.values());return J.findLast.apply(J,arguments)},T.prototype.findLastIndex=function(){var J=Array.from(this.$items.values());return J.findLastIndex.apply(J,arguments)},T.prototype.setIndex=function(J,T){this.$indexes.set(J,T)},T.prototype.getIndex=function(J){return this.$indexes.get(J)},T.prototype.getByIndex=function(J){return this.$items.get(this.$indexes.get(J))},T.prototype.deleteByIndex=function(J){var T=this.$indexes.get(J);this.$items.delete(T),this.$indexes.delete(J)},T.prototype.toArray=function(){return Array.from(this.$items.values())},T.prototype.toJSON=function(){return this.toArray().map((function(J){return"function"===typeof J.toJSON?J.toJSON():J}))},T.prototype.clone=function(J){return J?new(T.bind.apply(T,t([void 0],Array.from(this.$items.values()),!1))):new(T.bind.apply(T,t([void 0],this.map((function(J){return J.$changes?J.clone():J})),!1)))},T}();function x(J){return J.$proxy=!0,J=new Proxy(J,{get:function(J,T){return"symbol"!==typeof T&&"undefined"===typeof J[T]?J.get(T):J[T]},set:function(J,T,b){return"symbol"!==typeof T&&-1===T.indexOf("$")&&"kh"!==T&&"jh"!==T&&"onChange"!==T?J.set(T,b):J[T]=b,!0},deleteProperty:function(J,T){return J.delete(T),!0}})}var I=function(){function T(J){var b=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,J)if(J instanceof Map||J instanceof T)J.forEach((function(J,T){return b.set(T,J)}));else for(var q in J)this.set(q,J[q])}return T.prototype.kh=function(T,b){return void 0===b&&(b=!0),F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.ADD,T,b?this.$items:void 0)},T.prototype.jh=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.REPLACE,T)},T.is=function(J){return void 0!==J.map},T.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(T.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(T,Symbol.species,{get:function(){return T},enumerable:!1,configurable:!0}),T.prototype.set=function(T,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(T,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(T,"'."));T=T.toString();var q="undefined"!==typeof this.$changes.indexes[T],t=q?this.$changes.indexes[T]:this.$refId++,j=q?J.OPERATION.REPLACE:J.OPERATION.ADD,B=void 0!==b.$changes;if(B&&b.$changes.setParent(this,this.$changes.root,t),q){if(!B&&this.$items.get(T)===b)return;B&&this.$items.get(T)!==b&&(j=J.OPERATION.ADD)}else this.$changes.indexes[T]=t,this.$indexes.set(t,T);return this.$items.set(T,b),this.$changes.change(T,j),this},T.prototype.get=function(J){return this.$items.get(J)},T.prototype.delete=function(J){return this.$changes.delete(J),this.$items.delete(J)},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&A.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:J.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.has=function(J){return this.$items.has(J)},T.prototype.forEach=function(J){this.$items.forEach(J)},T.prototype.entries=function(){return this.$items.entries()},T.prototype.keys=function(){return this.$items.keys()},T.prototype.values=function(){return this.$items.values()},Object.defineProperty(T.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),T.prototype.setIndex=function(J,T){this.$indexes.set(J,T)},T.prototype.getIndex=function(J){return this.$indexes.get(J)},T.prototype.getByIndex=function(J){return this.$items.get(this.$indexes.get(J))},T.prototype.deleteByIndex=function(J){var T=this.$indexes.get(J);this.$items.delete(T),this.$indexes.delete(J)},T.prototype.toJSON=function(){var J={};return this.forEach((function(T,b){J[b]="function"===typeof T.toJSON?T.toJSON():T})),J},T.prototype.clone=function(J){var b;return J?b=Object.assign(new T,this):(b=new T,this.forEach((function(J,T){J.$changes?b.set(T,J.clone()):b.set(T,J)}))),b},T}(),u={};function U(J,T){u[J]=T}function K(J){return u[J]}var E=function(){function J(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return J.create=function(T){var b=new J;return b.schema=Object.assign({},T&&T.schema||{}),b.indexes=Object.assign({},T&&T.indexes||{}),b.fieldsByIndex=Object.assign({},T&&T.fieldsByIndex||{}),b.descriptors=Object.assign({},T&&T.descriptors||{}),b.deprecated=Object.assign({},T&&T.deprecated||{}),b},J.prototype.addField=function(J,T){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=J,this.indexes[J]=b,this.schema[J]=Array.isArray(T)?{array:T[0]}:T},J.prototype.hasField=function(J){return void 0!==this.indexes[J]},J.prototype.addFilter=function(J,T){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[J]]=T,this.indexesWithFilters.push(this.indexes[J]),!0},J.prototype.addChildrenFilter=function(J,T){var b=this.indexes[J],q=this.schema[J];if(K(Object.keys(q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=T,!0;console.warn("@filterChildren: field '".concat(J,"' can't have children. Ignoring filter."))},J.prototype.getChildrenFilter=function(J){return this.childFilters&&this.childFilters[this.indexes[J]]},J.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},J}();function l(J){return J._context&&J._context.useFilters}var W=function(){function J(){this.types={},this.schemas=new Map,this.useFilters=!1}return J.prototype.has=function(J){return this.schemas.has(J)},J.prototype.get=function(J){return this.types[J]},J.prototype.add=function(J,T){void 0===T&&(T=this.schemas.size),J._definition=E.create(J._definition),J._typeid=T,this.types[T]=J,this.schemas.set(J,T)},J.create=function(T){return void 0===T&&(T={}),function(b){return T.context||(T.context=new J),o(b,T)}},J}(),p=new W;function o(J,T){return void 0===T&&(T={}),function(b,q){var j=T.context||p,B=b.constructor;if(B._context=j,!J)throw new Error("".concat(B.name,': @type() reference provided for "').concat(q,"\" is undefined. Make sure you don't have any circular dependencies."));j.has(B)||j.add(B);var Y=B._definition;if(Y.addField(q,J),Y.descriptors[q]){if(Y.deprecated[q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(q,"' definition on '").concat(B.name,"'.\nCheck @type() annotation"))}catch(u){var C=u.stack.split("\n")[4].trim();throw new Error("".concat(u.message," ").concat(C))}}var F=G.is(J),A=!F&&I.is(J);if("string"!==typeof J&&!ZJ.is(J)){var a=Object.values(J)[0];"string"===typeof a||j.has(a)||j.add(a)}if(T.manual)Y.descriptors[q]={enumerable:!0,configurable:!0,writable:!0};else{var P="_".concat(q);Y.descriptors[P]={enumerable:!1,configurable:!1,writable:!0},Y.descriptors[q]={get:function(){return this[P]},set:function(J){J!==this[P]&&(void 0!==J&&null!==J?(!F||J instanceof G||(J=new(G.bind.apply(G,t([void 0],J,!1)))),!A||J instanceof I||(J=new I(J)),void 0===J.$proxy&&(A?J=x(J):F&&(J=v(J))),this.$changes.change(q),J.$changes&&J.$changes.setParent(this,this.$changes.root,this._definition.indexes[q])):this[P]&&this.$changes.delete(q),this[P]=J)},enumerable:!0,configurable:!0}}}}function S(J){return function(T,b){var q=T.constructor;q._definition.addFilter(b,J)&&(q._context.useFilters=!0)}}function H(J){return function(T,b){var q=T.constructor;q._definition.addChildrenFilter(b,J)&&(q._context.useFilters=!0)}}function s(J){return void 0===J&&(J=!0),function(T,b){var q=T.constructor._definition;q.deprecated[b]=!0,J&&(q.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(J){},enumerable:!1,configurable:!0})}}function g(J,T,b){for(var q in void 0===b&&(b={}),b.context||(b.context=J._context||b.context||p),T)o(T[q],b)(J.prototype,q);return J}function d(J){for(var T=0,b=0,q=0,t=J.length;q<t;q++)(T=J.charCodeAt(q))<128?b+=1:T<2048?b+=2:T<55296||T>=57344?b+=3:(q++,b+=4);return b}function w(J,T,b){for(var q=0,t=0,j=b.length;t<j;t++)(q=b.charCodeAt(t))<128?J[T++]=q:q<2048?(J[T++]=192|q>>6,J[T++]=128|63&q):q<55296||q>=57344?(J[T++]=224|q>>12,J[T++]=128|q>>6&63,J[T++]=128|63&q):(t++,q=65536+((1023&q)<<10|1023&b.charCodeAt(t)),J[T++]=240|q>>18,J[T++]=128|q>>12&63,J[T++]=128|q>>6&63,J[T++]=128|63&q)}function Z(J,T){J.push(255&T)}function e(J,T){J.push(255&T)}function c(J,T){J.push(255&T),J.push(T>>8&255)}function V(J,T){J.push(255&T),J.push(T>>8&255)}function Q(J,T){J.push(255&T),J.push(T>>8&255),J.push(T>>16&255),J.push(T>>24&255)}function h(J,T){var b=T>>24,q=T>>16,t=T>>8,j=T;J.push(255&j),J.push(255&t),J.push(255&q),J.push(255&b)}function i(J,T){var b=Math.floor(T/Math.pow(2,32));h(J,T>>>0),h(J,b)}function m(J,T){var b=T/Math.pow(2,32)|0;h(J,T>>>0),h(J,b)}function O(J,T){R(J,T)}function X(J,T){n(J,T)}var L=new Int32Array(2),r=new Float32Array(L.buffer),N=new Float64Array(L.buffer);function R(J,T){r[0]=T,Q(J,L[0])}function n(J,T){N[0]=T,Q(J,L[0]),Q(J,L[1])}function D(J,T){return e(J,T?1:0)}function f(J,T){T||(T="");var b=d(T),q=0;if(b<32)J.push(160|b),q=1;else if(b<256)J.push(217),e(J,b),q=2;else if(b<65536)J.push(218),V(J,b),q=3;else{if(!(b<4294967296))throw new Error("String too long");J.push(219),h(J,b),q=5}return w(J,J.length,T),q+b}function z(J,T){return isNaN(T)?z(J,0):isFinite(T)?T!==(0|T)?(J.push(203),n(J,T),9):T>=0?T<128?(e(J,T),1):T<256?(J.push(204),e(J,T),2):T<65536?(J.push(205),V(J,T),3):T<4294967296?(J.push(206),h(J,T),5):(J.push(207),m(J,T),9):T>=-32?(J.push(224|T+32),1):T>=-128?(J.push(208),Z(J,T),2):T>=-32768?(J.push(209),c(J,T),3):T>=-2147483648?(J.push(210),Q(J,T),5):(J.push(211),i(J,T),9):z(J,T>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var M=Object.freeze({__proto__:null,utf8Write:w,int8:Z,uint8:e,int16:c,uint16:V,int32:Q,uint32:h,int64:i,uint64:m,float32:O,float64:X,writeFloat32:R,writeFloat64:n,boolean:D,string:f,number:z});function y(J,T,b){for(var q="",t=0,j=T,B=T+b;j<B;j++){var Y=J[j];0!==(128&Y)?192!==(224&Y)?224!==(240&Y)?240!==(248&Y)?console.error("Invalid byte "+Y.toString(16)):(t=(7&Y)<<18|(63&J[++j])<<12|(63&J[++j])<<6|63&J[++j])>=65536?(t-=65536,q+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):q+=String.fromCharCode(t):q+=String.fromCharCode((15&Y)<<12|(63&J[++j])<<6|63&J[++j]):q+=String.fromCharCode((31&Y)<<6|63&J[++j]):q+=String.fromCharCode(Y)}return q}function k(J,T){return JJ(J,T)<<24>>24}function JJ(J,T){return J[T.offset++]}function TJ(J,T){return bJ(J,T)<<16>>16}function bJ(J,T){return J[T.offset++]|J[T.offset++]<<8}function qJ(J,T){return J[T.offset++]|J[T.offset++]<<8|J[T.offset++]<<16|J[T.offset++]<<24}function tJ(J,T){return qJ(J,T)>>>0}function jJ(J,T){return PJ(J,T)}function BJ(J,T){return vJ(J,T)}function YJ(J,T){var b=tJ(J,T);return qJ(J,T)*Math.pow(2,32)+b}function CJ(J,T){var b=tJ(J,T);return tJ(J,T)*Math.pow(2,32)+b}var FJ=new Int32Array(2),AJ=new Float32Array(FJ.buffer),aJ=new Float64Array(FJ.buffer);function PJ(J,T){return FJ[0]=qJ(J,T),AJ[0]}function vJ(J,T){return FJ[0]=qJ(J,T),FJ[1]=qJ(J,T),aJ[0]}function GJ(J,T){return JJ(J,T)>0}function xJ(J,T){var b,q=J[T.offset++];q<192?b=31&q:217===q?b=JJ(J,T):218===q?b=bJ(J,T):219===q&&(b=tJ(J,T));var t=y(J,T.offset,b);return T.offset+=b,t}function IJ(J,T){var b=J[T.offset];return b<192&&b>160||217===b||218===b||219===b}function uJ(J,T){var b=J[T.offset++];return b<128?b:202===b?PJ(J,T):203===b?vJ(J,T):204===b?JJ(J,T):205===b?bJ(J,T):206===b?tJ(J,T):207===b?CJ(J,T):208===b?k(J,T):209===b?TJ(J,T):210===b?qJ(J,T):211===b?YJ(J,T):b>223?-1*(255-b+1):void 0}function UJ(J,T){var b=J[T.offset];return b<128||b>=202&&b<=211}function KJ(J,T){return J[T.offset]<160}function EJ(J,T){return J[T.offset-1]===B&&(J[T.offset]<128||J[T.offset]>=202&&J[T.offset]<=211)}var lJ=Object.freeze({__proto__:null,int8:k,uint8:JJ,int16:TJ,uint16:bJ,int32:qJ,uint32:tJ,float32:jJ,float64:BJ,int64:YJ,uint64:CJ,readFloat32:PJ,readFloat64:vJ,boolean:GJ,string:xJ,stringCheck:IJ,number:uJ,numberCheck:UJ,arrayCheck:KJ,switchStructureCheck:EJ}),WJ=function(){function T(J){var T=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,J&&J.forEach((function(J){return T.add(J)}))}return T.prototype.kh=function(T,b){return void 0===b&&(b=!0),F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.ADD,T,b?this.$items:void 0)},T.prototype.jh=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.REPLACE,T)},T.is=function(J){return void 0!==J.collection},T.prototype.add=function(J){var T=this.$refId++;return void 0!==J.$changes&&J.$changes.setParent(this,this.$changes.root,T),this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,J),this.$changes.change(T),T},T.prototype.at=function(J){var T=Array.from(this.$items.keys())[J];return this.$items.get(T)},T.prototype.entries=function(){return this.$items.entries()},T.prototype.delete=function(J){for(var T,b,q=this.$items.entries();(b=q.next())&&!b.done;)if(J===b.value[1]){T=b.value[0];break}return void 0!==T&&(this.$changes.delete(T),this.$indexes.delete(T),this.$items.delete(T))},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&A.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:J.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.has=function(J){return Array.from(this.$items.values()).some((function(T){return T===J}))},T.prototype.forEach=function(J){var T=this;this.$items.forEach((function(b,q,t){return J(b,q,T)}))},T.prototype.values=function(){return this.$items.values()},Object.defineProperty(T.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),T.prototype.setIndex=function(J,T){this.$indexes.set(J,T)},T.prototype.getIndex=function(J){return this.$indexes.get(J)},T.prototype.getByIndex=function(J){return this.$items.get(this.$indexes.get(J))},T.prototype.deleteByIndex=function(J){var T=this.$indexes.get(J);this.$items.delete(T),this.$indexes.delete(J)},T.prototype.toArray=function(){return Array.from(this.$items.values())},T.prototype.toJSON=function(){var J=[];return this.forEach((function(T,b){J.push("function"===typeof T.toJSON?T.toJSON():T)})),J},T.prototype.clone=function(J){var b;return J?b=Object.assign(new T,this):(b=new T,this.forEach((function(J){J.$changes?b.add(J.clone()):b.add(J)}))),b},T}(),pJ=function(){function T(J){var T=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,J&&J.forEach((function(J){return T.add(J)}))}return T.prototype.kh=function(T,b){return void 0===b&&(b=!0),F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.ADD,T,b?this.$items:void 0)},T.prototype.jh=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.REPLACE,T)},T.is=function(J){return void 0!==J.set},T.prototype.add=function(T){var b,q;if(this.has(T))return!1;var t=this.$refId++;void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,t);var j=null!==(q=null===(b=this.$changes.indexes[t])||void 0===b?void 0:b.op)&&void 0!==q?q:J.OPERATION.ADD;return this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,T),this.$changes.change(t,j),t},T.prototype.entries=function(){return this.$items.entries()},T.prototype.delete=function(J){for(var T,b,q=this.$items.entries();(b=q.next())&&!b.done;)if(J===b.value[1]){T=b.value[0];break}return void 0!==T&&(this.$changes.delete(T),this.$indexes.delete(T),this.$items.delete(T))},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&A.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:J.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.has=function(J){for(var T,b=this.$items.values(),q=!1;(T=b.next())&&!T.done;)if(J===T.value){q=!0;break}return q},T.prototype.forEach=function(J){var T=this;this.$items.forEach((function(b,q,t){return J(b,q,T)}))},T.prototype.values=function(){return this.$items.values()},Object.defineProperty(T.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),T.prototype.setIndex=function(J,T){this.$indexes.set(J,T)},T.prototype.getIndex=function(J){return this.$indexes.get(J)},T.prototype.getByIndex=function(J){return this.$items.get(this.$indexes.get(J))},T.prototype.deleteByIndex=function(J){var T=this.$indexes.get(J);this.$items.delete(T),this.$indexes.delete(J)},T.prototype.toArray=function(){return Array.from(this.$items.values())},T.prototype.toJSON=function(){var J=[];return this.forEach((function(T,b){J.push("function"===typeof T.toJSON?T.toJSON():T)})),J},T.prototype.clone=function(J){var b;return J?b=Object.assign(new T,this):(b=new T,this.forEach((function(J){J.$changes?b.add(J.clone()):b.add(J)}))),b},T}(),oJ=function(){function J(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return J.prototype.addRefId=function(J){this.refIds.has(J)||(this.refIds.add(J),this.containerIndexes.set(J,new Set))},J.get=function(T){return void 0===T.$filterState&&(T.$filterState=new J),T.$filterState},J}(),SJ=function(){function J(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return J.prototype.getNextUniqueId=function(){return this.nextUniqueId++},J.prototype.addRef=function(J,T,b){void 0===b&&(b=!0),this.refs.set(J,T),b&&(this.refCounts[J]=(this.refCounts[J]||0)+1)},J.prototype.removeRef=function(J){this.refCounts[J]=this.refCounts[J]-1,this.deletedRefs.add(J)},J.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},J.prototype.garbageCollectDeletedRefs=function(){var J=this;this.deletedRefs.forEach((function(T){if(!(J.refCounts[T]>0)){var b=J.refs.get(T);if(b instanceof ZJ)for(var q in b._definition.schema)"string"!==typeof b._definition.schema[q]&&b[q]&&b[q].$changes&&J.removeRef(b[q].$changes.refId);else{var t=b.$changes.parent._definition,j=t.schema[t.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(j)[0]&&Array.from(b.values()).forEach((function(T){return J.removeRef(T.$changes.refId)}))}J.refs.delete(T),delete J.refCounts[T]}})),this.deletedRefs.clear()},J}(),HJ=function(J){function T(){return null!==J&&J.apply(this,arguments)||this}return b(T,J),T}(Error);function sJ(J,T,b,q){var t,j=!1;switch(T){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":t="number",isNaN(J)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(q));break;case"string":t="string",j=!0;break;case"boolean":return}if(typeof J!==t&&(!j||j&&null!==J)){var B="'".concat(JSON.stringify(J),"'").concat(J&&J.constructor&&" (".concat(J.constructor.name,")")||"");throw new HJ("a '".concat(t,"' was expected, but ").concat(B," was provided in ").concat(b.constructor.name,"#").concat(q))}}function gJ(J,T,b,q){if(!(J instanceof T))throw new HJ("a '".concat(T.name,"' was expected, but '").concat(J.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(q))}function dJ(J,T,b,q,t){sJ(b,J,q,t);var j=M[J];if(!j)throw new HJ("a '".concat(J,"' was expected, but ").concat(b," was provided in ").concat(q.constructor.name,"#").concat(t));j(T,b)}function wJ(J,T,b){return lJ[J](T,b)}var ZJ=function(){function T(){for(var J=[],T=0;T<arguments.length;T++)J[T]=arguments[T];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new SJ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),J[0]&&this.assign(J[0])}return T.onError=function(J){console.error(J)},T.is=function(J){return J._definition&&void 0!==J._definition.schema},T.prototype.onChange=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.REPLACE,T)},T.prototype.jh=function(T){return F(this.$callbacks||(this.$callbacks=[]),J.OPERATION.DELETE,T)},T.prototype.assign=function(J){return Object.assign(this,J),this},Object.defineProperty(T.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),T.prototype.setDirty=function(J,T){this.$changes.change(J,T)},T.prototype.listen=function(J,T,b){var q=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[J]||(this.$callbacks[J]=[]),this.$callbacks[J].push(T),b&&void 0!==this[J]&&T(this[J],void 0),function(){return a(q.$callbacks[J],q.$callbacks[J].indexOf(T))}},T.prototype.decode=function(b,q,t){var j;void 0===q&&(q={offset:0}),void 0===t&&(t=this);var Y=[],C=this.$changes.root,F=b.length,A=0;for(C.refs.set(A,this);q.offset<F;){var a=b[q.offset++];if(a!=B){var P=t.$changes,v=void 0!==t._definition,x=v?a>>6<<6:a;if(x!==J.OPERATION.CLEAR){var u=v?a%(x||255):uJ(b,q),U=v?t._definition.fieldsByIndex[u]:"",E=P.getType(u),l=void 0,W=void 0,p=void 0;if(v?W=t["_".concat(U)]:(W=t.getByIndex(u),(x&J.OPERATION.ADD)===J.OPERATION.ADD?(p=t instanceof I?xJ(b,q):u,t.setIndex(u,p)):p=t.getIndex(u)),(x&J.OPERATION.DELETE)===J.OPERATION.DELETE&&(x!==J.OPERATION.DELETE_AND_ADD&&t.deleteByIndex(u),W&&W.$changes&&C.removeRef(W.$changes.refId),l=null),void 0!==U){if(x===J.OPERATION.DELETE);else if(T.is(E)){var o=uJ(b,q);if(l=C.refs.get(o),x!==J.OPERATION.REPLACE){var S=this.getSchemaType(b,q,E);l||((l=this.createTypeInstance(S)).$changes.refId=o,W&&(l.$callbacks=W.$callbacks,W.$changes.refId&&o!==W.$changes.refId&&C.removeRef(W.$changes.refId))),C.addRef(o,l,l!==W)}}else if("string"===typeof E)l=wJ(E,b,q);else{var H=K(Object.keys(E)[0]),s=uJ(b,q),g=C.refs.has(s)?W||C.refs.get(s):new H.constructor;if((l=g.clone(!0)).$changes.refId=s,W&&(l.$callbacks=W.$callbacks,W.$changes.refId&&s!==W.$changes.refId)){C.removeRef(W.$changes.refId);for(var d=W.entries(),w=void 0;(w=d.next())&&!w.done;){var Z=(j=w.value)[0],e=j[1];Y.push({refId:s,op:J.OPERATION.DELETE,field:Z,value:void 0,previousValue:e})}}C.addRef(s,l,g!==W)}if(null!==l&&void 0!==l)if(l.$changes&&l.$changes.setParent(P.ref,P.root,u),t instanceof T)t[U]=l;else if(t instanceof I)Z=p,t.$items.set(Z,l),t.$changes.allChanges.add(u);else if(t instanceof G)t.setAt(u,l);else if(t instanceof WJ){var c=t.add(l);t.setIndex(u,c)}else t instanceof pJ&&!1!==(c=t.add(l))&&t.setIndex(u,c);W!==l&&Y.push({refId:A,op:x,field:U,dynamicIndex:p,value:l,previousValue:W})}else{console.warn("@colyseus/schema: definition mismatch");for(var V={offset:q.offset};q.offset<F&&(!EJ(b,q)||(V.offset=q.offset+1,!C.refs.has(uJ(b,V))));)q.offset++}}else t.clear(Y)}else{A=uJ(b,q);var Q=C.refs.get(A);if(!Q)throw new Error('"refId" not found: '.concat(A));t=Q}}return this._triggerChanges(Y),C.garbageCollectDeletedRefs(),Y},T.prototype.encode=function(b,q,t){void 0===b&&(b=!1),void 0===q&&(q=[]),void 0===t&&(t=!1);for(var j=this.$changes,Y=new WeakSet,C=[j],F=1,A=0;A<F;A++){var a=C[A],P=a.ref,v=P instanceof T;a.ensureRefId(),Y.add(a),a!==j&&(a.changed||b)&&(e(q,B),z(q,a.refId));for(var G=b?Array.from(a.allChanges):Array.from(a.changes.values()),x=0,u=G.length;x<u;x++){var U=b?{op:J.OPERATION.ADD,index:G[x]}:G[x],E=U.index,l=v?P._definition.fieldsByIndex&&P._definition.fieldsByIndex[E]:E,W=q.length;if(U.op!==J.OPERATION.TOUCH)if(v)e(q,E|U.op);else{if(e(q,U.op),U.op===J.OPERATION.CLEAR)continue;z(q,E)}if(v||(U.op&J.OPERATION.ADD)!=J.OPERATION.ADD||P instanceof I&&f(q,a.ref.$indexes.get(E)),U.op!==J.OPERATION.DELETE){var p=a.getType(E),o=a.getValue(E);if(o&&o.$changes&&!Y.has(o.$changes)&&(C.push(o.$changes),o.$changes.ensureRefId(),F++),U.op!==J.OPERATION.TOUCH){if(T.is(p))gJ(o,p,P,l),z(q,o.$changes.refId),(U.op&J.OPERATION.ADD)===J.OPERATION.ADD&&this.tryEncodeTypeId(q,p,o.constructor);else if("string"===typeof p)dJ(p,q,o,P,l);else{var S=K(Object.keys(p)[0]);gJ(P["_".concat(l)],S.constructor,P,l),z(q,o.$changes.refId)}t&&a.cache(E,q.slice(W))}}}b||t||a.discard()}return q},T.prototype.encodeAll=function(J){return this.encode(!0,[],J)},T.prototype.applyFilters=function(b,q){var t,j;void 0===q&&(q=!1);for(var Y=this,C=new Set,F=oJ.get(b),A=[this.$changes],a=1,P=[],v=function(v){var G=A[v];if(C.has(G.refId))return"continue";var x=G.ref,u=x instanceof T;e(P,B),z(P,G.refId);var U=F.refIds.has(G),K=q||!U;F.addRefId(G);var E=F.containerIndexes.get(G),l=K?Array.from(G.allChanges):Array.from(G.changes.values());!q&&u&&x._definition.indexesWithFilters&&x._definition.indexesWithFilters.forEach((function(T){!E.has(T)&&G.allChanges.has(T)&&(K?l.push(T):l.push({op:J.OPERATION.ADD,index:T}))}));for(var W=0,p=l.length;W<p;W++){var o=K?{op:J.OPERATION.ADD,index:l[W]}:l[W];if(o.op!==J.OPERATION.CLEAR){var S=o.index;if(o.op!==J.OPERATION.DELETE){var H=G.getValue(S),s=G.getType(S);if(u){if((g=x._definition.filters&&x._definition.filters[S])&&!g.call(x,b,H,Y)){H&&H.$changes&&C.add(H.$changes.refId);continue}}else{var g,d=G.parent;if((g=G.getChildrenFilter())&&!g.call(d,b,x.$indexes.get(S),H,Y)){H&&H.$changes&&C.add(H.$changes.refId);continue}}if(H.$changes&&(A.push(H.$changes),a++),o.op!==J.OPERATION.TOUCH)if(o.op===J.OPERATION.ADD||u)P.push.apply(P,null!==(t=G.caches[S])&&void 0!==t?t:[]),E.add(S);else if(E.has(S))P.push.apply(P,null!==(j=G.caches[S])&&void 0!==j?j:[]);else{if(E.add(S),e(P,J.OPERATION.ADD),z(P,S),x instanceof I){var w=G.ref.$indexes.get(S);f(P,w)}H.$changes?z(P,H.$changes.refId):M[s](P,H)}else H.$changes&&!u&&(e(P,J.OPERATION.ADD),z(P,S),x instanceof I&&(w=G.ref.$indexes.get(S),f(P,w)),z(P,H.$changes.refId))}else u?e(P,o.op|S):(e(P,o.op),z(P,S))}else e(P,o.op)}},G=0;G<a;G++)v(G);return P},T.prototype.clone=function(){var J,T=new this.constructor,b=this._definition.schema;for(var q in b)"object"===typeof this[q]&&"function"===typeof(null===(J=this[q])||void 0===J?void 0:J.clone)?T[q]=this[q].clone():T[q]=this[q];return T},T.prototype.toJSON=function(){var J=this._definition.schema,T=this._definition.deprecated,b={};for(var q in J)T[q]||null===this[q]||"undefined"===typeof this[q]||(b[q]="function"===typeof this[q].toJSON?this[q].toJSON():this["_".concat(q)]);return b},T.prototype.discardAllChanges=function(){this.$changes.discardAll()},T.prototype.getByIndex=function(J){return this[this._definition.fieldsByIndex[J]]},T.prototype.deleteByIndex=function(J){this[this._definition.fieldsByIndex[J]]=void 0},T.prototype.tryEncodeTypeId=function(J,T,b){T._typeid!==b._typeid&&(e(J,Y),z(J,b._typeid))},T.prototype.getSchemaType=function(J,T,b){var q;return J[T.offset]===Y&&(T.offset++,q=this.constructor._context.get(uJ(J,T))),q||b},T.prototype.createTypeInstance=function(J){var T=new J;return T.$changes.root=this.$changes.root,T},T.prototype._triggerChanges=function(b){for(var q,t,j,B,Y,C,F,A,a,P=new Set,v=this.$changes.root.refs,G=function(G){var x=b[G],I=x.refId,u=v.get(I),U=u.$callbacks;if((x.op&J.OPERATION.DELETE)===J.OPERATION.DELETE&&x.previousValue instanceof T&&(null===(t=null===(q=x.previousValue.$callbacks)||void 0===q?void 0:q[J.OPERATION.DELETE])||void 0===t||t.forEach((function(J){return J()}))),!U)return"continue";if(u instanceof T){if(!P.has(I))try{null===(j=null===U||void 0===U?void 0:U[J.OPERATION.REPLACE])||void 0===j||j.forEach((function(J){return J()}))}catch(K){T.onError(K)}try{U.hasOwnProperty(x.field)&&(null===(B=U[x.field])||void 0===B||B.forEach((function(J){return J(x.value,x.previousValue)})))}catch(K){T.onError(K)}}else x.op===J.OPERATION.ADD&&void 0===x.previousValue?null===(Y=U[J.OPERATION.ADD])||void 0===Y||Y.forEach((function(J){var T;return J(x.value,null!==(T=x.dynamicIndex)&&void 0!==T?T:x.field)})):x.op===J.OPERATION.DELETE?void 0!==x.previousValue&&(null===(C=U[J.OPERATION.DELETE])||void 0===C||C.forEach((function(J){var T;return J(x.previousValue,null!==(T=x.dynamicIndex)&&void 0!==T?T:x.field)}))):x.op===J.OPERATION.DELETE_AND_ADD&&(void 0!==x.previousValue&&(null===(F=U[J.OPERATION.DELETE])||void 0===F||F.forEach((function(J){var T;return J(x.previousValue,null!==(T=x.dynamicIndex)&&void 0!==T?T:x.field)}))),null===(A=U[J.OPERATION.ADD])||void 0===A||A.forEach((function(J){var T;return J(x.value,null!==(T=x.dynamicIndex)&&void 0!==T?T:x.field)}))),x.value!==x.previousValue&&(null===(a=U[J.OPERATION.REPLACE])||void 0===a||a.forEach((function(J){var T;return J(x.value,null!==(T=x.dynamicIndex)&&void 0!==T?T:x.field)})));P.add(I)},x=0;x<b.length;x++)G(x)},T._definition=E.create(),T}();function eJ(J){for(var T=[J.$changes],b=1,q={},t=q,j=function(J){var b=T[J];b.changes.forEach((function(J){var T=b.ref,q=J.index,j=T._definition?T._definition.fieldsByIndex[q]:T.$indexes.get(q);t[j]=b.getValue(q)}))},B=0;B<b;B++)j(B);return q}var cJ={context:new W},VJ=function(J){function T(){return null!==J&&J.apply(this,arguments)||this}return b(T,J),q([o("string",cJ)],T.prototype,"name",void 0),q([o("string",cJ)],T.prototype,"type",void 0),q([o("number",cJ)],T.prototype,"referencedType",void 0),T}(ZJ),QJ=function(J){function T(){var T=null!==J&&J.apply(this,arguments)||this;return T.fields=new G,T}return b(T,J),q([o("number",cJ)],T.prototype,"id",void 0),q([o([VJ],cJ)],T.prototype,"fields",void 0),T}(ZJ),hJ=function(J){function T(){var T=null!==J&&J.apply(this,arguments)||this;return T.types=new G,T}return b(T,J),T.encode=function(J){var b=J.constructor,q=new T;q.rootType=b._typeid;var t=function(J,T){for(var b in T){var t=new VJ;t.name=b;var j=void 0;if("string"===typeof T[b])j=T[b];else{var B=T[b],Y=void 0;ZJ.is(B)?(j="ref",Y=T[b]):"string"===typeof B[j=Object.keys(B)[0]]?j+=":"+B[j]:Y=B[j],t.referencedType=Y?Y._typeid:-1}t.type=j,J.fields.push(t)}q.types.push(J)},j=b._context.types;for(var B in j){var Y=new QJ;Y.id=Number(B),t(Y,j[B]._definition.schema)}return q.encodeAll()},T.decode=function(J,q){var t=new W,j=new T;j.decode(J,q);var B=j.types.reduce((function(J,T){var q=function(J){function T(){return null!==J&&J.apply(this,arguments)||this}return b(T,J),T}(ZJ),j=T.id;return J[j]=q,t.add(q,j),J}),{});j.types.forEach((function(J){var T=B[J.id];J.fields.forEach((function(J){var b;if(void 0!==J.referencedType){var q=J.type,j=B[J.referencedType];if(!j){var Y=J.type.split(":");q=Y[0],j=Y[1]}"ref"===q?o(j,{context:t})(T.prototype,J.name):o(((b={})[q]=j,b),{context:t})(T.prototype,J.name)}else o(J.type,{context:t})(T.prototype,J.name)}))}));var Y=B[j.rootType],C=new Y;for(var F in Y._definition.schema){var A=Y._definition.schema[F];"string"!==typeof A&&(C[F]="function"===typeof A?new A:new(K(Object.keys(A)[0]).constructor))}return C},q([o([QJ],cJ)],T.prototype,"types",void 0),q([o("number",cJ)],T.prototype,"rootType",void 0),T}(ZJ);U("map",{constructor:I}),U("array",{constructor:G}),U("set",{constructor:pJ}),U("collection",{constructor:WJ}),J.ArraySchema=G,J.CollectionSchema=WJ,J.Context=W,J.MapSchema=I,J.Reflection=hJ,J.ReflectionField=VJ,J.ReflectionType=QJ,J.Schema=ZJ,J.SchemaDefinition=E,J.SetSchema=pJ,J.decode=lJ,J.defineTypes=g,J.deprecated=s,J.dumpChanges=eJ,J.encode=M,J.filter=S,J.filterChildren=H,J.hasFilter=l,J.registerType=U,J.type=o,Object.defineProperty(J,"__esModule",{value:!0})}(T)},12816:J=>{"use strict";J.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12812:(J,T,b)=>{var q=b(12816),t=b(12825),j=Object.hasOwnProperty,B=Object.create(null);for(var Y in q)j.call(q,Y)&&(B[q[Y]]=Y);var C=J.exports={to:{},get:{}};function F(J,T,b){return Math.min(Math.max(T,J),b)}function A(J){var T=Math.round(J).toString(16).toUpperCase();return T.length<2?"0"+T:T}C.get=function(J){var T,b;switch(J.substring(0,3).toLowerCase()){case"hsl":T=C.get.hsl(J),b="hsl";break;case"hwb":T=C.get.hwb(J),b="hwb";break;default:T=C.get.rgb(J),b="rgb"}return T?{model:b,value:T}:null},C.get.rgb=function(J){if(!J)return null;var T,b,t,B=[0,0,0,1];if(T=J.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(t=T[2],T=T[1],b=0;b<3;b++){var Y=2*b;B[b]=parseInt(T.slice(Y,Y+2),16)}t&&(B[3]=parseInt(t,16)/255)}else if(T=J.match(/^#([a-f0-9]{3,4})$/i)){for(t=(T=T[1])[3],b=0;b<3;b++)B[b]=parseInt(T[b]+T[b],16);t&&(B[3]=parseInt(t+t,16)/255)}else if(T=J.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)B[b]=parseInt(T[b+1],0);T[4]&&(T[5]?B[3]=.01*parseFloat(T[4]):B[3]=parseFloat(T[4]))}else{if(!(T=J.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(T=J.match(/^(\w+)$/))?"transparent"===T[1]?[0,0,0,0]:j.call(q,T[1])?((B=q[T[1]])[3]=1,B):null:null;for(b=0;b<3;b++)B[b]=Math.round(2.55*parseFloat(T[b+1]));T[4]&&(T[5]?B[3]=.01*parseFloat(T[4]):B[3]=parseFloat(T[4]))}for(b=0;b<3;b++)B[b]=F(B[b],0,255);return B[3]=F(B[3],0,1),B},C.get.hsl=function(J){if(!J)return null;var T=J.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(T){var b=parseFloat(T[4]);return[(parseFloat(T[1])%360+360)%360,F(parseFloat(T[2]),0,100),F(parseFloat(T[3]),0,100),F(isNaN(b)?1:b,0,1)]}return null},C.get.hwb=function(J){if(!J)return null;var T=J.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(T){var b=parseFloat(T[4]);return[(parseFloat(T[1])%360+360)%360,F(parseFloat(T[2]),0,100),F(parseFloat(T[3]),0,100),F(isNaN(b)?1:b,0,1)]}return null},C.to.hex=function(){var J=t(arguments);return"#"+A(J[0])+A(J[1])+A(J[2])+(J[3]<1?A(Math.round(255*J[3])):"")},C.to.rgb=function(){var J=t(arguments);return J.length<4||1===J[3]?"rgb("+Math.round(J[0])+", "+Math.round(J[1])+", "+Math.round(J[2])+")":"rgba("+Math.round(J[0])+", "+Math.round(J[1])+", "+Math.round(J[2])+", "+J[3]+")"},C.to.rgb.percent=function(){var J=t(arguments),T=Math.round(J[0]/255*100),b=Math.round(J[1]/255*100),q=Math.round(J[2]/255*100);return J.length<4||1===J[3]?"rgb("+T+"%, "+b+"%, "+q+"%)":"rgba("+T+"%, "+b+"%, "+q+"%, "+J[3]+")"},C.to.hsl=function(){var J=t(arguments);return J.length<4||1===J[3]?"hsl("+J[0]+", "+J[1]+"%, "+J[2]+"%)":"hsla("+J[0]+", "+J[1]+"%, "+J[2]+"%, "+J[3]+")"},C.to.hwb=function(){var J=t(arguments),T="";return J.length>=4&&1!==J[3]&&(T=", "+J[3]),"hwb("+J[0]+", "+J[1]+"%, "+J[2]+"%"+T+")"},C.to.keyword=function(J){return B[J.slice(0,3)]}},12808:(J,T,b)=>{const q=b(12812),t=b(12834),j=["keyword","gray","hex"],B={};for(const v of Object.keys(t))B[[...t[v].labels].sort().join("")]=v;const Y={};function C(J,T){if(!(this instanceof C))return new C(J,T);if(T&&T in j&&(T=null),T&&!(T in t))throw new Error("Unknown model: "+T);let b,F;if(null==J)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(J instanceof C)this.model=J.model,this.color=[...J.color],this.valpha=J.valpha;else if("string"===typeof J){const T=q.get(J);if(null===T)throw new Error("Unable to parse color from string: "+J);this.model=T.model,F=t[this.model].channels,this.color=T.value.slice(0,F),this.valpha="number"===typeof T.value[F]?T.value[F]:1}else if(J.length>0){this.model=T||"rgb",F=t[this.model].channels;const b=Array.prototype.slice.call(J,0,F);this.color=P(b,F),this.valpha="number"===typeof J[F]?J[F]:1}else if("number"===typeof J)this.model="rgb",this.color=[J>>16&255,J>>8&255,255&J],this.valpha=1;else{this.valpha=1;const T=Object.keys(J);"alpha"in J&&(T.splice(T.indexOf("alpha"),1),this.valpha="number"===typeof J.alpha?J.alpha:0);const q=T.sort().join("");if(!(q in B))throw new Error("Unable to parse color from object: "+JSON.stringify(J));this.model=B[q];const{labels:j}=t[this.model],Y=[];for(b=0;b<j.length;b++)Y.push(J[j[b]]);this.color=P(Y)}if(Y[this.model])for(F=t[this.model].channels,b=0;b<F;b++){const J=Y[this.model][b];J&&(this.color[b]=J(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(J){let T=this.model in q.to?this:this.rgb();T=T.round("number"===typeof J?J:1);const b=1===T.valpha?T.color:[...T.color,this.valpha];return q.to[T.model](b)},percentString(J){const T=this.rgb().round("number"===typeof J?J:1),b=1===T.valpha?T.color:[...T.color,this.valpha];return q.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const J={},{channels:T}=t[this.model],{labels:b}=t[this.model];for(let q=0;q<T;q++)J[b[q]]=this.color[q];return 1!==this.valpha&&(J.alpha=this.valpha),J},unitArray(){const J=this.rgb().color;return J[0]/=255,J[1]/=255,J[2]/=255,1!==this.valpha&&J.push(this.valpha),J},unitObject(){const J=this.rgb().object();return J.r/=255,J.g/=255,J.b/=255,1!==this.valpha&&(J.alpha=this.valpha),J},round(J){return J=Math.max(J||0,0),new C([...this.color.map(F(J)),this.valpha],this.model)},alpha(J){return void 0!==J?new C([...this.color,Math.max(0,Math.min(1,J))],this.model):this.valpha},red:A("rgb",0,a(255)),green:A("rgb",1,a(255)),blue:A("rgb",2,a(255)),hue:A(["hsl","hsv","hsl","hwb","hcg"],0,(J=>(J%360+360)%360)),saturationl:A("hsl",1,a(100)),lightness:A("hsl",2,a(100)),saturationv:A("hsv",1,a(100)),value:A("hsv",2,a(100)),chroma:A("hcg",1,a(100)),gray:A("hcg",2,a(100)),white:A("hwb",1,a(100)),wblack:A("hwb",2,a(100)),cyan:A("cmyk",0,a(100)),magenta:A("cmyk",1,a(100)),yellow:A("cmyk",2,a(100)),black:A("cmyk",3,a(100)),x:A("xyz",0,a(95.047)),y:A("xyz",1,a(100)),z:A("xyz",2,a(108.833)),l:A("lab",0,a(100)),a:A("lab",1),b:A("lab",2),keyword(J){return void 0!==J?new C(J):t[this.model].keyword(this.color)},hex(J){return void 0!==J?new C(J):q.to.hex(this.rgb().round().color)},hexa(J){if(void 0!==J)return new C(J);const T=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),q.to.hex(T)+b},rgbNumber(){const J=this.rgb().color;return(255&J[0])<<16|(255&J[1])<<8|255&J[2]},luminosity(){const J=this.rgb().color,T=[];for(const[b,q]of J.entries()){const J=q/255;T[b]=J<=.04045?J/12.92:((J+.055)/1.055)**2.4}return.2126*T[0]+.7152*T[1]+.0722*T[2]},contrast(J){const T=this.luminosity(),b=J.luminosity();return T>b?(T+.05)/(b+.05):(b+.05)/(T+.05)},level(J){const T=this.contrast(J);return T>=7?"AAA":T>=4.5?"AA":""},isDark(){const J=this.rgb().color;return(2126*J[0]+7152*J[1]+722*J[2])/1e4<128},isLight(){return!this.isDark()},negate(){const J=this.rgb();for(let T=0;T<3;T++)J.color[T]=255-J.color[T];return J},lighten(J){const T=this.hsl();return T.color[2]+=T.color[2]*J,T},darken(J){const T=this.hsl();return T.color[2]-=T.color[2]*J,T},saturate(J){const T=this.hsl();return T.color[1]+=T.color[1]*J,T},desaturate(J){const T=this.hsl();return T.color[1]-=T.color[1]*J,T},whiten(J){const T=this.hwb();return T.color[1]+=T.color[1]*J,T},blacken(J){const T=this.hwb();return T.color[2]+=T.color[2]*J,T},grayscale(){const J=this.rgb().color,T=.3*J[0]+.59*J[1]+.11*J[2];return C.rgb(T,T,T)},fade(J){return this.alpha(this.valpha-this.valpha*J)},opaquer(J){return this.alpha(this.valpha+this.valpha*J)},rotate(J){const T=this.hsl();let b=T.color[0];return b=(b+J)%360,b=b<0?360+b:b,T.color[0]=b,T},mix(J,T){if(!J||!J.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof J);const b=J.rgb(),q=this.rgb(),t=void 0===T?.5:T,j=2*t-1,B=b.alpha()-q.alpha(),Y=((j*B===-1?j:(j+B)/(1+j*B))+1)/2,F=1-Y;return C.rgb(Y*b.red()+F*q.red(),Y*b.green()+F*q.green(),Y*b.blue()+F*q.blue(),b.alpha()*t+q.alpha()*(1-t))}};for(const v of Object.keys(t)){if(j.includes(v))continue;const{channels:J}=t[v];C.prototype[v]=function(){if(this.model===v)return new C(this);for(var J=arguments.length,T=new Array(J),b=0;b<J;b++)T[b]=arguments[b];return T.length>0?new C(T,v):new C([...(q=t[this.model][v].raw(this.color),Array.isArray(q)?q:[q]),this.valpha],v);var q},C[v]=function(){for(var T=arguments.length,b=new Array(T),q=0;q<T;q++)b[q]=arguments[q];let t=b[0];return"number"===typeof t&&(t=P(b,J)),new C(t,v)}}function F(J){return function(T){return function(J,T){return Number(J.toFixed(T))}(T,J)}}function A(J,T,b){J=Array.isArray(J)?J:[J];for(const q of J)(Y[q]||(Y[q]=[]))[T]=b;return J=J[0],function(q){let t;return void 0!==q?(b&&(q=b(q)),t=this[J](),t.color[T]=q,t):(t=this[J]().color[T],b&&(t=b(t)),t)}}function a(J){return function(T){return Math.max(0,Math.min(J,T))}}function P(J,T){for(let b=0;b<T;b++)"number"!==typeof J[b]&&(J[b]=0);return J}J.exports=C},12836:(J,T,b)=>{const q=b(12839),t={};for(const B of Object.keys(q))t[q[B]]=B;const j={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};J.exports=j;for(const B of Object.keys(j)){if(!("channels"in j[B]))throw new Error("missing channels property: "+B);if(!("labels"in j[B]))throw new Error("missing channel labels property: "+B);if(j[B].labels.length!==j[B].channels)throw new Error("channel and label counts mismatch: "+B);const{channels:J,labels:T}=j[B];delete j[B].channels,delete j[B].labels,Object.defineProperty(j[B],"channels",{value:J}),Object.defineProperty(j[B],"labels",{value:T})}j.rgb.hsl=function(J){const T=J[0]/255,b=J[1]/255,q=J[2]/255,t=Math.min(T,b,q),j=Math.max(T,b,q),B=j-t;let Y,C;j===t?Y=0:T===j?Y=(b-q)/B:b===j?Y=2+(q-T)/B:q===j&&(Y=4+(T-b)/B),Y=Math.min(60*Y,360),Y<0&&(Y+=360);const F=(t+j)/2;return C=j===t?0:F<=.5?B/(j+t):B/(2-j-t),[Y,100*C,100*F]},j.rgb.hsv=function(J){let T,b,q,t,j;const B=J[0]/255,Y=J[1]/255,C=J[2]/255,F=Math.max(B,Y,C),A=F-Math.min(B,Y,C),a=function(J){return(F-J)/6/A+.5};return 0===A?(t=0,j=0):(j=A/F,T=a(B),b=a(Y),q=a(C),B===F?t=q-b:Y===F?t=1/3+T-q:C===F&&(t=2/3+b-T),t<0?t+=1:t>1&&(t-=1)),[360*t,100*j,100*F]},j.rgb.hwb=function(J){const T=J[0],b=J[1];let q=J[2];const t=j.rgb.hsl(J)[0],B=1/255*Math.min(T,Math.min(b,q));return q=1-1/255*Math.max(T,Math.max(b,q)),[t,100*B,100*q]},j.rgb.cmyk=function(J){const T=J[0]/255,b=J[1]/255,q=J[2]/255,t=Math.min(1-T,1-b,1-q);return[100*((1-T-t)/(1-t)||0),100*((1-b-t)/(1-t)||0),100*((1-q-t)/(1-t)||0),100*t]},j.rgb.keyword=function(J){const T=t[J];if(T)return T;let b,j=1/0;for(const t of Object.keys(q)){const T=q[t],C=(Y=T,((B=J)[0]-Y[0])**2+(B[1]-Y[1])**2+(B[2]-Y[2])**2);C<j&&(j=C,b=t)}var B,Y;return b},j.keyword.rgb=function(J){return q[J]},j.rgb.xyz=function(J){let T=J[0]/255,b=J[1]/255,q=J[2]/255;T=T>.04045?((T+.055)/1.055)**2.4:T/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,q=q>.04045?((q+.055)/1.055)**2.4:q/12.92;return[100*(.4124*T+.3576*b+.1805*q),100*(.2126*T+.7152*b+.0722*q),100*(.0193*T+.1192*b+.9505*q)]},j.rgb.lab=function(J){const T=j.rgb.xyz(J);let b=T[0],q=T[1],t=T[2];b/=95.047,q/=100,t/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,q=q>.008856?q**(1/3):7.787*q+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*q-16,500*(b-q),200*(q-t)]},j.hsl.rgb=function(J){const T=J[0]/360,b=J[1]/100,q=J[2]/100;let t,j,B;if(0===b)return B=255*q,[B,B,B];t=q<.5?q*(1+b):q+b-q*b;const Y=2*q-t,C=[0,0,0];for(let F=0;F<3;F++)j=T+1/3*-(F-1),j<0&&j++,j>1&&j--,B=6*j<1?Y+6*(t-Y)*j:2*j<1?t:3*j<2?Y+(t-Y)*(2/3-j)*6:Y,C[F]=255*B;return C},j.hsl.hsv=function(J){const T=J[0];let b=J[1]/100,q=J[2]/100,t=b;const j=Math.max(q,.01);q*=2,b*=q<=1?q:2-q,t*=j<=1?j:2-j;return[T,100*(0===q?2*t/(j+t):2*b/(q+b)),100*((q+b)/2)]},j.hsv.rgb=function(J){const T=J[0]/60,b=J[1]/100;let q=J[2]/100;const t=Math.floor(T)%6,j=T-Math.floor(T),B=255*q*(1-b),Y=255*q*(1-b*j),C=255*q*(1-b*(1-j));switch(q*=255,t){case 0:return[q,C,B];case 1:return[Y,q,B];case 2:return[B,q,C];case 3:return[B,Y,q];case 4:return[C,B,q];case 5:return[q,B,Y]}},j.hsv.hsl=function(J){const T=J[0],b=J[1]/100,q=J[2]/100,t=Math.max(q,.01);let j,B;B=(2-b)*q;const Y=(2-b)*t;return j=b*t,j/=Y<=1?Y:2-Y,j=j||0,B/=2,[T,100*j,100*B]},j.hwb.rgb=function(J){const T=J[0]/360;let b=J[1]/100,q=J[2]/100;const t=b+q;let j;t>1&&(b/=t,q/=t);const B=Math.floor(6*T),Y=1-q;j=6*T-B,0!==(1&B)&&(j=1-j);const C=b+j*(Y-b);let F,A,a;switch(B){default:case 6:case 0:F=Y,A=C,a=b;break;case 1:F=C,A=Y,a=b;break;case 2:F=b,A=Y,a=C;break;case 3:F=b,A=C,a=Y;break;case 4:F=C,A=b,a=Y;break;case 5:F=Y,A=b,a=C}return[255*F,255*A,255*a]},j.cmyk.rgb=function(J){const T=J[0]/100,b=J[1]/100,q=J[2]/100,t=J[3]/100;return[255*(1-Math.min(1,T*(1-t)+t)),255*(1-Math.min(1,b*(1-t)+t)),255*(1-Math.min(1,q*(1-t)+t))]},j.xyz.rgb=function(J){const T=J[0]/100,b=J[1]/100,q=J[2]/100;let t,j,B;return t=3.2406*T+-1.5372*b+-.4986*q,j=-.9689*T+1.8758*b+.0415*q,B=.0557*T+-.204*b+1.057*q,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,j=j>.0031308?1.055*j**(1/2.4)-.055:12.92*j,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,t=Math.min(Math.max(0,t),1),j=Math.min(Math.max(0,j),1),B=Math.min(Math.max(0,B),1),[255*t,255*j,255*B]},j.xyz.lab=function(J){let T=J[0],b=J[1],q=J[2];T/=95.047,b/=100,q/=108.883,T=T>.008856?T**(1/3):7.787*T+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*b-16,500*(T-b),200*(b-q)]},j.lab.xyz=function(J){let T,b,q;b=(J[0]+16)/116,T=J[1]/500+b,q=b-J[2]/200;const t=b**3,j=T**3,B=q**3;return b=t>.008856?t:(b-16/116)/7.787,T=j>.008856?j:(T-16/116)/7.787,q=B>.008856?B:(q-16/116)/7.787,T*=95.047,b*=100,q*=108.883,[T,b,q]},j.lab.lch=function(J){const T=J[0],b=J[1],q=J[2];let t;t=360*Math.atan2(q,b)/2/Math.PI,t<0&&(t+=360);return[T,Math.sqrt(b*b+q*q),t]},j.lch.lab=function(J){const T=J[0],b=J[1],q=J[2]/360*2*Math.PI;return[T,b*Math.cos(q),b*Math.sin(q)]},j.rgb.ansi16=function(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,q,t]=J;let B=null===T?j.rgb.hsv(J)[2]:T;if(B=Math.round(B/50),0===B)return 30;let Y=30+(Math.round(t/255)<<2|Math.round(q/255)<<1|Math.round(b/255));return 2===B&&(Y+=60),Y},j.hsv.ansi16=function(J){return j.rgb.ansi16(j.hsv.rgb(J),J[2])},j.rgb.ansi256=function(J){const T=J[0],b=J[1],q=J[2];if(T===b&&b===q)return T<8?16:T>248?231:Math.round((T-8)/247*24)+232;return 16+36*Math.round(T/255*5)+6*Math.round(b/255*5)+Math.round(q/255*5)},j.ansi16.rgb=function(J){let T=J%10;if(0===T||7===T)return J>50&&(T+=3.5),T=T/10.5*255,[T,T,T];const b=.5*(1+~~(J>50));return[(1&T)*b*255,(T>>1&1)*b*255,(T>>2&1)*b*255]},j.ansi256.rgb=function(J){if(J>=232){const T=10*(J-232)+8;return[T,T,T]}let T;J-=16;return[Math.floor(J/36)/5*255,Math.floor((T=J%36)/6)/5*255,T%6/5*255]},j.rgb.hex=function(J){const T=(((255&Math.round(J[0]))<<16)+((255&Math.round(J[1]))<<8)+(255&Math.round(J[2]))).toString(16).toUpperCase();return"000000".substring(T.length)+T},j.hex.rgb=function(J){const T=J.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!T)return[0,0,0];let b=T[0];3===T[0].length&&(b=b.split("").map((J=>J+J)).join(""));const q=parseInt(b,16);return[q>>16&255,q>>8&255,255&q]},j.rgb.hcg=function(J){const T=J[0]/255,b=J[1]/255,q=J[2]/255,t=Math.max(Math.max(T,b),q),j=Math.min(Math.min(T,b),q),B=t-j;let Y,C;return Y=B<1?j/(1-B):0,C=B<=0?0:t===T?(b-q)/B%6:t===b?2+(q-T)/B:4+(T-b)/B,C/=6,C%=1,[360*C,100*B,100*Y]},j.hsl.hcg=function(J){const T=J[1]/100,b=J[2]/100,q=b<.5?2*T*b:2*T*(1-b);let t=0;return q<1&&(t=(b-.5*q)/(1-q)),[J[0],100*q,100*t]},j.hsv.hcg=function(J){const T=J[1]/100,b=J[2]/100,q=T*b;let t=0;return q<1&&(t=(b-q)/(1-q)),[J[0],100*q,100*t]},j.hcg.rgb=function(J){const T=J[0]/360,b=J[1]/100,q=J[2]/100;if(0===b)return[255*q,255*q,255*q];const t=[0,0,0],j=T%1*6,B=j%1,Y=1-B;let C=0;switch(Math.floor(j)){case 0:t[0]=1,t[1]=B,t[2]=0;break;case 1:t[0]=Y,t[1]=1,t[2]=0;break;case 2:t[0]=0,t[1]=1,t[2]=B;break;case 3:t[0]=0,t[1]=Y,t[2]=1;break;case 4:t[0]=B,t[1]=0,t[2]=1;break;default:t[0]=1,t[1]=0,t[2]=Y}return C=(1-b)*q,[255*(b*t[0]+C),255*(b*t[1]+C),255*(b*t[2]+C)]},j.hcg.hsv=function(J){const T=J[1]/100,b=T+J[2]/100*(1-T);let q=0;return b>0&&(q=T/b),[J[0],100*q,100*b]},j.hcg.hsl=function(J){const T=J[1]/100,b=J[2]/100*(1-T)+.5*T;let q=0;return b>0&&b<.5?q=T/(2*b):b>=.5&&b<1&&(q=T/(2*(1-b))),[J[0],100*q,100*b]},j.hcg.hwb=function(J){const T=J[1]/100,b=T+J[2]/100*(1-T);return[J[0],100*(b-T),100*(1-b)]},j.hwb.hcg=function(J){const T=J[1]/100,b=1-J[2]/100,q=b-T;let t=0;return q<1&&(t=(b-q)/(1-q)),[J[0],100*q,100*t]},j.apple.rgb=function(J){return[J[0]/65535*255,J[1]/65535*255,J[2]/65535*255]},j.rgb.apple=function(J){return[J[0]/255*65535,J[1]/255*65535,J[2]/255*65535]},j.gray.rgb=function(J){return[J[0]/100*255,J[0]/100*255,J[0]/100*255]},j.gray.hsl=function(J){return[0,0,J[0]]},j.gray.hsv=j.gray.hsl,j.gray.hwb=function(J){return[0,100,J[0]]},j.gray.cmyk=function(J){return[0,0,0,J[0]]},j.gray.lab=function(J){return[J[0],0,0]},j.gray.hex=function(J){const T=255&Math.round(J[0]/100*255),b=((T<<16)+(T<<8)+T).toString(16).toUpperCase();return"000000".substring(b.length)+b},j.rgb.gray=function(J){return[(J[0]+J[1]+J[2])/3/255*100]}},12834:(J,T,b)=>{const q=b(12836),t=b(12844),j={};Object.keys(q).forEach((J=>{j[J]={},Object.defineProperty(j[J],"channels",{value:q[J].channels}),Object.defineProperty(j[J],"labels",{value:q[J].labels});const T=t(J);Object.keys(T).forEach((b=>{const q=T[b];j[J][b]=function(J){const T=function(){for(var T=arguments.length,b=new Array(T),q=0;q<T;q++)b[q]=arguments[q];const t=b[0];if(void 0===t||null===t)return t;t.length>1&&(b=t);const j=J(b);if("object"===typeof j)for(let J=j.length,B=0;B<J;B++)j[B]=Math.round(j[B]);return j};return"conversion"in J&&(T.conversion=J.conversion),T}(q),j[J][b].raw=function(J){const T=function(){for(var T=arguments.length,b=new Array(T),q=0;q<T;q++)b[q]=arguments[q];const t=b[0];return void 0===t||null===t?t:(t.length>1&&(b=t),J(b))};return"conversion"in J&&(T.conversion=J.conversion),T}(q)}))})),J.exports=j},12844:(J,T,b)=>{const q=b(12836);function t(J){const T=function(){const J={},T=Object.keys(q);for(let b=T.length,q=0;q<b;q++)J[T[q]]={distance:-1,parent:null};return J}(),b=[J];for(T[J].distance=0;b.length;){const J=b.pop(),t=Object.keys(q[J]);for(let q=t.length,j=0;j<q;j++){const q=t[j],B=T[q];-1===B.distance&&(B.distance=T[J].distance+1,B.parent=J,b.unshift(q))}}return T}function j(J,T){return function(b){return T(J(b))}}function B(J,T){const b=[T[J].parent,J];let t=q[T[J].parent][J],B=T[J].parent;for(;T[B].parent;)b.unshift(T[B].parent),t=j(q[T[B].parent][B],t),B=T[B].parent;return t.conversion=b,t}J.exports=function(J){const T=t(J),b={},q=Object.keys(T);for(let t=q.length,j=0;j<t;j++){const J=q[j];null!==T[J].parent&&(b[J]=B(J,T))}return b}},12839:J=>{"use strict";J.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11757:function(J,T,b){"use strict";var q=this&&this.__createBinding||(Object.create?function(J,T,b,q){void 0===q&&(q=b);var t=Object.getOwnPropertyDescriptor(T,b);t&&!("get"in t?!T.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return T[b]}}),Object.defineProperty(J,q,t)}:function(J,T,b,q){void 0===q&&(q=b),J[q]=T[b]}),t=this&&this.__setModuleDefault||(Object.create?function(J,T){Object.defineProperty(J,"default",{enumerable:!0,value:T})}:function(J,T){J.default=T}),j=this&&this.__importStar||function(J){if(J&&J.__esModule)return J;var T={};if(null!=J)for(var b in J)"default"!==b&&Object.prototype.hasOwnProperty.call(J,b)&&q(T,J,b);return t(T,J),T},B=this&&this.__awaiter||function(J,T,b,q){return new(b||(b=Promise))((function(t,j){function B(J){try{C(q.next(J))}catch(T){j(T)}}function Y(J){try{C(q.throw(J))}catch(T){j(T)}}function C(J){var T;J.done?t(J.value):(T=J.value,T instanceof b?T:new b((function(J){J(T)}))).then(B,Y)}C((q=q.apply(J,T||[])).next())}))};Object.defineProperty(T,"__esModule",{value:!0}),T.Auth=T.Platform=void 0;const Y=j(b(11686)),C=b(11764),F="colyseus-auth-token";!function(J){J.ios="ios",J.android="android"}(T.Platform||(T.Platform={}));T.Auth=class{constructor(J){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=J.replace("ws","http"),(0,C.getItem)(F,(J=>this.token=J))}get hasToken(){return!!this.token}login(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return B(this,void 0,void 0,(function*(){const T=Object.assign({},J);this.hasToken&&(T.token=this.token);const b=yield this.request("post","/auth",T);this.token=b.token,(0,C.setItem)(F,this.token);for(let J in b)this.hasOwnProperty(J)&&(this[J]=b[J]);return this.registerPingService(),this}))}save(){return B(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return B(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return B(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return B(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(J){return B(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:J})}))}acceptFriendRequest(J){return B(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:J})}))}declineFriendRequest(J){return B(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:J})}))}blockUser(J){return B(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:J})}))}unblockUser(J){return B(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:J})}))}request(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3?arguments[3]:void 0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return B(this,void 0,void 0,(function*(){t.Accept="application/json",this.hasToken&&(t.Authorization="Bearer "+this.token);const j=[];for(const J in b)j.push(`${J}=${b[J]}`);const B=j.length>0?`?${j.join("&")}`:"",C={headers:t};return q&&(C.body=q),(yield Y[J](`${this.endpoint}${T}${B}`,C)).data}))}logout(){this.token=void 0,(0,C.removeItem)(F),this.unregisterPingService()}registerPingService(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),J)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11683:function(J,T,b){"use strict";var q,t=this&&this.__awaiter||function(J,T,b,q){return new(b||(b=Promise))((function(t,j){function B(J){try{C(q.next(J))}catch(T){j(T)}}function Y(J){try{C(q.throw(J))}catch(T){j(T)}}function C(J){var T;J.done?t(J.value):(T=J.value,T instanceof b?T:new b((function(J){J(T)}))).then(B,Y)}C((q=q.apply(J,T||[])).next())}))};Object.defineProperty(T,"__esModule",{value:!0}),T.Client=T.MatchMakeError=void 0;const j=b(11686),B=b(11689),Y=b(11696);class C extends Error{constructor(J,T){super(J),this.code=T,Object.setPrototypeOf(this,C.prototype)}}T.MatchMakeError=C;const F="undefined"!==typeof window&&"undefined"!==typeof(null===(q=null===window||void 0===window?void 0:window.location)||void 0===q?void 0:q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";T.Client=class{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;if("string"===typeof J){const T=new URL(J),b="https:"===T.protocol||"wss:"===T.protocol,q=Number(T.port||(b?443:80));this.settings={hostname:T.hostname,pathname:"/"!==T.pathname?T.pathname:"",port:q,secure:b}}else void 0===J.port&&(J.port=J.secure?443:80),void 0===J.pathname&&(J.pathname=""),this.settings=J}joinOrCreate(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",J,T,b)}))}create(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",J,T,b)}))}join(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",J,T,b)}))}joinById(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",J,T,b)}))}reconnect(J,T){return t(this,void 0,void 0,(function*(){if("string"===typeof J&&"string"===typeof T)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,q]=J.split(":");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:q},T)}))}getAvailableRooms(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t(this,void 0,void 0,(function*(){return(yield(0,j.get)(this.getHttpEndpoint(`${J}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(J,T,b){return t(this,void 0,void 0,(function*(){const q=this.createRoom(J.room.name,T);q.roomId=J.room.roomId,q.sessionId=J.sessionId;const j={sessionId:q.sessionId};J.reconnectionToken&&(j.reconnectionToken=J.reconnectionToken);const Y=b||q;return q.connect(this.buildEndpoint(J.room,j),J.devMode&&(()=>t(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${q.roomId}'...`);let b=0;const j=()=>t(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(J,T,Y),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${q.roomId}'`)}catch(t){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(j,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(j,2e3)}))),Y),new Promise(((J,T)=>{const b=(J,b)=>T(new B.ServerError(J,b));Y.onError.once(b),Y.onJoin.once((()=>{Y.onError.remove(b),J(Y)}))}))}))}createMatchMakeRequest(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;return t(this,void 0,void 0,(function*(){const t=(yield(0,j.post)(this.getHttpEndpoint(`${J}/${T}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(t.error)throw new C(t.error,t.code);return"reconnect"===J&&(t.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(t,q,B)}))}createRoom(J,T){return new Y.Room(J,T)}buildEndpoint(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const t in T)T.hasOwnProperty(t)&&b.push(`${t}=${T[t]}`);let q=this.settings.secure?"wss://":"ws://";return J.publicAddress?q+=`${J.publicAddress}`:q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${q}/${J.processId}/${J.roomId}?${b.join("&")}`}getHttpEndpoint(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${J}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11708:(J,T,b)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Connection=void 0;const q=b(11716);T.Connection=class{constructor(){this.events={},this.transport=new q.WebSocketTransport(this.events)}send(J){this.transport.send(J)}connect(J){this.transport.connect(J)}close(J,T){this.transport.close(J,T)}get isOpen(){return this.transport.isOpen}}},11729:(J,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.utf8Length=T.utf8Read=T.ErrorCode=T.Protocol=void 0,function(J){J[J.HANDSHAKE=9]="HANDSHAKE",J[J.JOIN_ROOM=10]="JOIN_ROOM",J[J.ERROR=11]="ERROR",J[J.LEAVE_ROOM=12]="LEAVE_ROOM",J[J.ROOM_DATA=13]="ROOM_DATA",J[J.ROOM_STATE=14]="ROOM_STATE",J[J.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",J[J.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",J[J.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(T.Protocol||(T.Protocol={})),function(J){J[J.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",J[J.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",J[J.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",J[J.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",J[J.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",J[J.AUTH_FAILED=4215]="AUTH_FAILED",J[J.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(T.ErrorCode||(T.ErrorCode={})),T.utf8Read=function(J,T){const b=J[T++];for(var q="",t=0,j=T,B=T+b;j<B;j++){var Y=J[j];if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(t=(7&Y)<<18|(63&J[++j])<<12|(63&J[++j])<<6|63&J[++j])>=65536?(t-=65536,q+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):q+=String.fromCharCode(t)}else q+=String.fromCharCode((15&Y)<<12|(63&J[++j])<<6|63&J[++j]);else q+=String.fromCharCode((31&Y)<<6|63&J[++j]);else q+=String.fromCharCode(Y)}return q},T.utf8Length=function(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",T=0,b=0;for(let q=0,t=J.length;q<t;q++)T=J.charCodeAt(q),T<128?b+=1:T<2048?b+=2:T<55296||T>=57344?b+=3:(q++,b+=4);return b+1}},11696:function(J,T,b){"use strict";var q=this&&this.__createBinding||(Object.create?function(J,T,b,q){void 0===q&&(q=b);var t=Object.getOwnPropertyDescriptor(T,b);t&&!("get"in t?!T.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return T[b]}}),Object.defineProperty(J,q,t)}:function(J,T,b,q){void 0===q&&(q=b),J[q]=T[b]}),t=this&&this.__setModuleDefault||(Object.create?function(J,T){Object.defineProperty(J,"default",{enumerable:!0,value:T})}:function(J,T){J.default=T}),j=this&&this.__importStar||function(J){if(J&&J.__esModule)return J;var T={};if(null!=J)for(var b in J)"default"!==b&&Object.prototype.hasOwnProperty.call(J,b)&&q(T,J,b);return t(T,J),T};Object.defineProperty(T,"__esModule",{value:!0}),T.Room=void 0;const B=j(b(11701)),Y=b(11708),C=b(11729),F=b(11737),A=b(11741),a=b(11743),P=b(11749),v=b(11689);class G{constructor(J,T){this.onStateChange=(0,a.createSignal)(),this.onError=(0,a.createSignal)(),this.onLeave=(0,a.createSignal)(),this.onJoin=(0,a.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,A.createNanoEvents)(),this.roomId=null,this.name=J,T&&(this.serializer=new((0,F.getSerializer)("schema")),this.rootSchema=T,this.serializer.state=new T),this.onError(((J,T)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${J}) ${T}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const q=new Y.Connection;b.connection=q,q.events.onmessage=G.prototype.onMessageCallback.bind(b),q.events.onclose=function(J){var q;if(!b.hasJoined)return null===(q=console.warn)||void 0===q||q.call(console,`Room connection was closed unexpectedly (${J.code}): ${J.reason}`),void b.onError.invoke(J.code,J.reason);J.code===v.CloseCode.DEVMODE_RESTART&&T?T():(b.onLeave.invoke(J.code),b.destroy())},q.events.onerror=function(J){var T;null===(T=console.warn)||void 0===T||T.call(console,`Room, onError (${J.code}): ${J.reason}`),b.onError.invoke(J.code,J.reason)},q.connect(J)}leave(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((T=>{this.onLeave((J=>T(J))),this.connection?J?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(v.CloseCode.CONSENTED)}))}onMessage(J,T){return this.onMessageHandlers.on(this.getMessageHandlerKey(J),T)}send(J,T){const b=[C.Protocol.ROOM_DATA];let q;if("string"===typeof J?P.encode.string(b,J):P.encode.number(b,J),void 0!==T){const J=B.encode(T);q=new Uint8Array(b.length+J.byteLength),q.set(new Uint8Array(b),0),q.set(new Uint8Array(J),b.length)}else q=new Uint8Array(b);this.connection.send(q.buffer)}sendBytes(J,T){const b=[C.Protocol.ROOM_DATA_BYTES];let q;"string"===typeof J?P.encode.string(b,J):P.encode.number(b,J),q=new Uint8Array(b.length+(T.byteLength||T.length)),q.set(new Uint8Array(b),0),q.set(new Uint8Array(T),b.length),this.connection.send(q.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(J){const T=Array.from(new Uint8Array(J.data)),b=T[0];if(b===C.Protocol.JOIN_ROOM){let J=1;const b=(0,C.utf8Read)(T,J);if(J+=(0,C.utf8Length)(b),this.serializerId=(0,C.utf8Read)(T,J),J+=(0,C.utf8Length)(this.serializerId),!this.serializer){const J=(0,F.getSerializer)(this.serializerId);this.serializer=new J}T.length>J&&this.serializer.handshake&&this.serializer.handshake(T,{offset:J}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(b===C.Protocol.ERROR){const J={offset:1},b=P.decode.number(T,J),q=P.decode.string(T,J);this.onError.invoke(b,q)}else if(b===C.Protocol.LEAVE_ROOM)this.leave();else if(b===C.Protocol.ROOM_DATA_SCHEMA){const J={offset:1},b=this.serializer.getState().constructor._context.get(P.decode.number(T,J)),q=new b;q.decode(T,J),this.dispatchMessage(b,q)}else if(b===C.Protocol.ROOM_STATE)T.shift(),this.setState(T);else if(b===C.Protocol.ROOM_STATE_PATCH)T.shift(),this.patch(T);else if(b===C.Protocol.ROOM_DATA){const b={offset:1},q=P.decode.stringCheck(T,b)?P.decode.string(T,b):P.decode.number(T,b),t=T.length>b.offset?B.decode(J.data,b.offset):void 0;this.dispatchMessage(q,t)}else if(b===C.Protocol.ROOM_DATA_BYTES){const J={offset:1},b=P.decode.stringCheck(T,J)?P.decode.string(T,J):P.decode.number(T,J);this.dispatchMessage(b,new Uint8Array(T.slice(J.offset)))}}setState(J){this.serializer.setState(J),this.onStateChange.invoke(this.serializer.getState())}patch(J){this.serializer.patch(J),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(J,T){var b;const q=this.getMessageHandlerKey(J);this.onMessageHandlers.events[q]?this.onMessageHandlers.emit(q,T):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",J,T):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${J}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(J){switch(typeof J){case"function":return`$${J._typeid}`;case"string":return J;case"number":return`i${J}`;default:throw new Error("invalid message type.")}}}T.Room=G},11764:(J,T)=>{"use strict";let b;function q(){return b||(b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(J,T){this.cache[J]=T},getItem:function(J){this.cache[J]},removeItem:function(J){delete this.cache[J]}}),b}Object.defineProperty(T,"__esModule",{value:!0}),T.getItem=T.removeItem=T.setItem=void 0,T.setItem=function(J,T){q().setItem(J,T)},T.removeItem=function(J){q().removeItem(J)},T.getItem=function(J,T){const b=q().getItem(J);"undefined"!==typeof Promise&&b instanceof Promise?b.then((J=>T(J))):T(b)}},11741:(J,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.createNanoEvents=void 0;T.createNanoEvents=()=>({emit(J){let T=this.events[J]||[];for(var b=arguments.length,q=new Array(b>1?b-1:0),t=1;t<b;t++)q[t-1]=arguments[t];for(let j=0,B=T.length;j<B;j++)T[j](...q)},events:{},on(J,T){var b;return(null===(b=this.events[J])||void 0===b?void 0:b.push(T))||(this.events[J]=[T]),()=>{var b;this.events[J]=null===(b=this.events[J])||void 0===b?void 0:b.filter((J=>T!==J))}}})},11743:(J,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.createSignal=T.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(J){return this.handlers.push(J),this}invoke(){for(var J=arguments.length,T=new Array(J),b=0;b<J;b++)T[b]=arguments[b];this.handlers.forEach((J=>J.apply(this,T)))}invokeAsync(){for(var J=arguments.length,T=new Array(J),b=0;b<J;b++)T[b]=arguments[b];return Promise.all(this.handlers.map((J=>J.apply(this,T))))}remove(J){const T=this.handlers.indexOf(J);this.handlers[T]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}T.EventEmitter=b,T.createSignal=function(){const J=new b;function T(T){return J.register(T,null===this)}return T.once=T=>{const b=function(){for(var q=arguments.length,t=new Array(q),j=0;j<q;j++)t[j]=arguments[j];T.apply(this,t),J.remove(b)};J.register(b)},T.remove=T=>J.remove(T),T.invoke=function(){return J.invoke(...arguments)},T.invokeAsync=function(){return J.invokeAsync(...arguments)},T.clear=()=>J.clear(),T}},11689:(J,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ServerError=T.CloseCode=void 0,function(J){J[J.CONSENTED=4e3]="CONSENTED",J[J.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(T.CloseCode||(T.CloseCode={}));class b extends Error{constructor(J,T){super(T),this.name="ServerError",this.code=J}}T.ServerError=b},11677:(J,T,b)=>{"use strict";T.c=void 0,b(11681);var q=b(11683);Object.defineProperty(T,"c",{enumerable:!0,get:function(){return q.Client}});var t=b(11729);var j=b(11696);var B=b(11757);const Y=b(11770);const C=b(11772),F=b(11737);(0,F.registerSerializer)("schema",Y.SchemaSerializer),(0,F.registerSerializer)("none",C.NoneSerializer)},11681:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=J=>null!==J&&"object"===typeof J&&J.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11701:(J,T)=>{"use strict";function b(J,T){if(this._offset=T,J instanceof ArrayBuffer)this._buffer=J,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(J))throw new Error("Invalid argument");this._buffer=J.buffer,this._view=new DataView(this._buffer,J.byteOffset,J.byteLength)}}Object.defineProperty(T,"__esModule",{value:!0}),T.decode=T.encode=void 0,b.prototype._array=function(J){for(var T=new Array(J),b=0;b<J;b++)T[b]=this._parse();return T},b.prototype._map=function(J){for(var T={},b=0;b<J;b++)T[this._parse()]=this._parse();return T},b.prototype._str=function(J){var T=function(J,T,b){for(var q="",t=0,j=T,B=T+b;j<B;j++){var Y=J.getUint8(j);if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(t=(7&Y)<<18|(63&J.getUint8(++j))<<12|(63&J.getUint8(++j))<<6|63&J.getUint8(++j))>=65536?(t-=65536,q+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):q+=String.fromCharCode(t)}else q+=String.fromCharCode((15&Y)<<12|(63&J.getUint8(++j))<<6|63&J.getUint8(++j));else q+=String.fromCharCode((31&Y)<<6|63&J.getUint8(++j));else q+=String.fromCharCode(Y)}return q}(this._view,this._offset,J);return this._offset+=J,T},b.prototype._bin=function(J){var T=this._buffer.slice(this._offset,this._offset+J);return this._offset+=J,T},b.prototype._parse=function(){var J,T=this._view.getUint8(this._offset++),b=0,q=0,t=0,j=0;if(T<192)return T<128?T:T<144?this._map(15&T):T<160?this._array(15&T):this._str(31&T);if(T>223)return-1*(255-T+1);switch(T){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),q=this._view.getInt8(this._offset+1),this._offset+=2,-1===q){var B=this._view.getUint32(this._offset);return t=this._view.getInt32(this._offset+4),j=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*t+j)+B/1e6)}return[q,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),q=this._view.getInt8(this._offset+2),this._offset+=3,[q,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),q=this._view.getInt8(this._offset+4),this._offset+=5,[q,this._bin(b)];case 202:return J=this._view.getFloat32(this._offset),this._offset+=4,J;case 203:return J=this._view.getFloat64(this._offset),this._offset+=8,J;case 204:return J=this._view.getUint8(this._offset),this._offset+=1,J;case 205:return J=this._view.getUint16(this._offset),this._offset+=2,J;case 206:return J=this._view.getUint32(this._offset),this._offset+=4,J;case 207:return t=this._view.getUint32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,t+j;case 208:return J=this._view.getInt8(this._offset),this._offset+=1,J;case 209:return J=this._view.getInt16(this._offset),this._offset+=2,J;case 210:return J=this._view.getInt32(this._offset),this._offset+=4,J;case 211:return t=this._view.getInt32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,t+j;case 212:return q=this._view.getInt8(this._offset),this._offset+=1,0===q?void(this._offset+=1):[q,this._bin(1)];case 213:return q=this._view.getInt8(this._offset),this._offset+=1,[q,this._bin(2)];case 214:return q=this._view.getInt8(this._offset),this._offset+=1,-1===q?(J=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*J)):[q,this._bin(4)];case 215:return q=this._view.getInt8(this._offset),this._offset+=1,0===q?(t=this._view.getInt32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,new Date(t+j)):-1===q?(t=this._view.getUint32(this._offset),j=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&t)+j)+(t>>>2)/1e6)):[q,this._bin(8)];case 216:return q=this._view.getInt8(this._offset),this._offset+=1,[q,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},T.decode=function(J){var T=new b(J,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),q=T._parse();if(T._offset!==J.byteLength)throw new Error(J.byteLength-T._offset+" trailing bytes");return q};function q(J,T,b){for(var q=0,t=0,j=b.length;t<j;t++)(q=b.charCodeAt(t))<128?J.setUint8(T++,q):q<2048?(J.setUint8(T++,192|q>>6),J.setUint8(T++,128|63&q)):q<55296||q>=57344?(J.setUint8(T++,224|q>>12),J.setUint8(T++,128|q>>6&63),J.setUint8(T++,128|63&q)):(t++,q=65536+((1023&q)<<10|1023&b.charCodeAt(t)),J.setUint8(T++,240|q>>18),J.setUint8(T++,128|q>>12&63),J.setUint8(T++,128|q>>6&63),J.setUint8(T++,128|63&q))}function t(J,T,b){var q=typeof b,j=0,B=0,Y=0,C=0,F=0,A=0;if("string"===q){if(F=function(J){for(var T=0,b=0,q=0,t=J.length;q<t;q++)(T=J.charCodeAt(q))<128?b+=1:T<2048?b+=2:T<55296||T>=57344?b+=3:(q++,b+=4);return b}(b),F<32)J.push(160|F),A=1;else if(F<256)J.push(217,F),A=2;else if(F<65536)J.push(218,F>>8,F),A=3;else{if(!(F<4294967296))throw new Error("String too long");J.push(219,F>>24,F>>16,F>>8,F),A=5}return T.push({_str:b,_length:F,_offset:J.length}),A+F}if("number"===q)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(J.push(b),1):b<256?(J.push(204,b),2):b<65536?(J.push(205,b>>8,b),3):b<4294967296?(J.push(206,b>>24,b>>16,b>>8,b),5):(Y=b/Math.pow(2,32)|0,C=b>>>0,J.push(207,Y>>24,Y>>16,Y>>8,Y,C>>24,C>>16,C>>8,C),9):b>=-32?(J.push(b),1):b>=-128?(J.push(208,b),2):b>=-32768?(J.push(209,b>>8,b),3):b>=-2147483648?(J.push(210,b>>24,b>>16,b>>8,b),5):(Y=Math.floor(b/Math.pow(2,32)),C=b>>>0,J.push(211,Y>>24,Y>>16,Y>>8,Y,C>>24,C>>16,C>>8,C),9):(J.push(203),T.push({_float:b,_length:8,_offset:J.length}),9);if("object"===q){if(null===b)return J.push(192),1;if(Array.isArray(b)){if((F=b.length)<16)J.push(144|F),A=1;else if(F<65536)J.push(220,F>>8,F),A=3;else{if(!(F<4294967296))throw new Error("Array too large");J.push(221,F>>24,F>>16,F>>8,F),A=5}for(j=0;j<F;j++)A+=t(J,T,b[j]);return A}if(b instanceof Date){var a=b.getTime(),P=Math.floor(a/1e3),v=1e6*(a-1e3*P);return P>=0&&v>=0&&P<=17179869183?0===v&&P<=4294967295?(J.push(214,255,P>>24,P>>16,P>>8,P),6):(Y=P/4294967296,C=4294967295&P,J.push(215,255,v>>22,v>>14,v>>6,Y,C>>24,C>>16,C>>8,C),10):(Y=Math.floor(P/4294967296),C=P>>>0,J.push(199,12,255,v>>24,v>>16,v>>8,v,Y>>24,Y>>16,Y>>8,Y,C>>24,C>>16,C>>8,C),15)}if(b instanceof ArrayBuffer){if((F=b.byteLength)<256)J.push(196,F),A=2;else if(F<65536)J.push(197,F>>8,F),A=3;else{if(!(F<4294967296))throw new Error("Buffer too large");J.push(198,F>>24,F>>16,F>>8,F),A=5}return T.push({_bin:b,_length:F,_offset:J.length}),A+F}if("function"===typeof b.toJSON)return t(J,T,b.toJSON());var G=[],x="",I=Object.keys(b);for(j=0,B=I.length;j<B;j++)void 0!==b[x=I[j]]&&"function"!==typeof b[x]&&G.push(x);if((F=G.length)<16)J.push(128|F),A=1;else if(F<65536)J.push(222,F>>8,F),A=3;else{if(!(F<4294967296))throw new Error("Object too large");J.push(223,F>>24,F>>16,F>>8,F),A=5}for(j=0;j<F;j++)A+=t(J,T,x=G[j]),A+=t(J,T,b[x]);return A}if("boolean"===q)return J.push(b?195:194),1;if("undefined"===q)return J.push(192),1;if("function"===typeof b.toJSON)return t(J,T,b.toJSON());throw new Error("Could not encode")}T.encode=function(J){var T=[],b=[],j=t(T,b,J),B=new ArrayBuffer(j),Y=new DataView(B),C=0,F=0,A=-1;b.length>0&&(A=b[0]._offset);for(var a,P=0,v=0,G=0,x=T.length;G<x;G++)if(Y.setUint8(F+G,T[G]),G+1===A){if(P=(a=b[C])._length,v=F+A,a._bin)for(var I=new Uint8Array(a._bin),u=0;u<P;u++)Y.setUint8(v+u,I[u]);else a._str?q(Y,v,a._str):void 0!==a._float&&Y.setFloat64(v,a._float);F+=P,b[++C]&&(A=b[C]._offset)}return B}},11772:(J,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NoneSerializer=void 0;T.NoneSerializer=class{setState(J){}getState(){return null}patch(J){}teardown(){}handshake(J){}}},11770:(J,T,b)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.SchemaSerializer=void 0;const q=b(11749);T.SchemaSerializer=class{setState(J){return this.state.decode(J)}getState(){return this.state}patch(J){return this.state.decode(J)}teardown(){var J,T;null===(T=null===(J=this.state)||void 0===J?void 0:J.$changes)||void 0===T||T.root.clearRefs()}handshake(J,T){if(this.state){(new q.Reflection).decode(J,T)}else this.state=q.Reflection.decode(J,T)}}},11737:(J,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getSerializer=T.registerSerializer=void 0;const b={};T.registerSerializer=function(J,T){b[J]=T},T.getSerializer=function(J){const T=b[J];if(!T)throw new Error("missing serializer: "+J);return T}},11716:function(J,T,b){"use strict";var q=this&&this.__importDefault||function(J){return J&&J.__esModule?J:{default:J}};Object.defineProperty(T,"__esModule",{value:!0}),T.WebSocketTransport=void 0;const t=q(b(11724)),j=globalThis.WebSocket||t.default;T.WebSocketTransport=class{constructor(J){this.events=J}send(J){J instanceof ArrayBuffer?this.ws.send(J):Array.isArray(J)&&this.ws.send(new Uint8Array(J).buffer)}connect(J){this.ws=new j(J,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(J,T){this.ws.close(J,T)}get isOpen(){return this.ws.readyState===j.OPEN}}},11724:J=>{"use strict";J.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11870:J=>{"use strict";J.exports=function(J){for(var T=new Array(J),b=0;b<J;++b)T[b]=b;return T}},11874:J=>{function T(J){return!!J.constructor&&"function"===typeof J.constructor.isBuffer&&J.constructor.isBuffer(J)}J.exports=function(J){return null!=J&&(T(J)||function(J){return"function"===typeof J.readFloatLE&&"function"===typeof J.slice&&T(J.slice(0,0))}(J)||!!J._isBuffer)}},11861:(J,T,b)=>{var q=b(11870),t=b(11874),j="undefined"!==typeof Float64Array;function B(J,T){return J[0]-T[0]}function Y(){var J,T=this.stride,b=new Array(T.length);for(J=0;J<b.length;++J)b[J]=[Math.abs(T[J]),J];b.sort(B);var q=new Array(b.length);for(J=0;J<q.length;++J)q[J]=b[J][1];return q}function C(J,T){var b=["View",T,"d",J].join("");T<0&&(b="View_Nil"+J);var t="generic"===J;if(-1===T){var j="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+J+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(j)()}if(0===T){j="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+J+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(t?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(t?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",j)(F[J][0])}j=["'use strict'"];var B=q(T),C=B.map((function(J){return"i"+J})),A="this.offset+"+B.map((function(J){return"this.stride["+J+"]*i"+J})).join("+"),a=B.map((function(J){return"b"+J})).join(","),P=B.map((function(J){return"c"+J})).join(",");j.push("function "+b+"(a,"+a+","+P+",d){this.data=a","this.shape=["+a+"]","this.stride=["+P+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+J+"'","proto.dimension="+T),j.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+B.map((function(J){return"this.shape["+J+"]"})).join("*"),"}})"),1===T?j.push("proto.order=[0]"):(j.push("Object.defineProperty(proto,'order',{get:"),T<4?(j.push("function "+b+"_order(){"),2===T?j.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===T&&j.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):j.push("ORDER})")),j.push("proto.set=function "+b+"_set("+C.join(",")+",v){"),t?j.push("return this.data.set("+A+",v)}"):j.push("return this.data["+A+"]=v}"),j.push("proto.get=function "+b+"_get("+C.join(",")+"){"),t?j.push("return this.data.get("+A+")}"):j.push("return this.data["+A+"]}"),j.push("proto.index=function "+b+"_index(",C.join(),"){return "+A+"}"),j.push("proto.hi=function "+b+"_hi("+C.join(",")+"){return new "+b+"(this.data,"+B.map((function(J){return["(typeof i",J,"!=='number'||i",J,"<0)?this.shape[",J,"]:i",J,"|0"].join("")})).join(",")+","+B.map((function(J){return"this.stride["+J+"]"})).join(",")+",this.offset)}");var v=B.map((function(J){return"a"+J+"=this.shape["+J+"]"})),G=B.map((function(J){return"c"+J+"=this.stride["+J+"]"}));j.push("proto.lo=function "+b+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+G.join(","));for(var x=0;x<T;++x)j.push("if(typeof i"+x+"==='number'&&i"+x+">=0){d=i"+x+"|0;b+=c"+x+"*d;a"+x+"-=d}");j.push("return new "+b+"(this.data,"+B.map((function(J){return"a"+J})).join(",")+","+B.map((function(J){return"c"+J})).join(",")+",b)}"),j.push("proto.step=function "+b+"_step("+C.join(",")+"){var "+B.map((function(J){return"a"+J+"=this.shape["+J+"]"})).join(",")+","+B.map((function(J){return"b"+J+"=this.stride["+J+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(x=0;x<T;++x)j.push("if(typeof i"+x+"==='number'){d=i"+x+"|0;if(d<0){c+=b"+x+"*(a"+x+"-1);a"+x+"=ceil(-a"+x+"/d)}else{a"+x+"=ceil(a"+x+"/d)}b"+x+"*=d}");j.push("return new "+b+"(this.data,"+B.map((function(J){return"a"+J})).join(",")+","+B.map((function(J){return"b"+J})).join(",")+",c)}");var I=new Array(T),u=new Array(T);for(x=0;x<T;++x)I[x]="a[i"+x+"]",u[x]="b[i"+x+"]";j.push("proto.transpose=function "+b+"_transpose("+C+"){"+C.map((function(J,T){return J+"=("+J+"===undefined?"+T+":"+J+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+I.join(",")+","+u.join(",")+",this.offset)}"),j.push("proto.pick=function "+b+"_pick("+C+"){var a=[],b=[],c=this.offset");for(x=0;x<T;++x)j.push("if(typeof i"+x+"==='number'&&i"+x+">=0){c=(c+this.stride["+x+"]*i"+x+")|0}else{a.push(this.shape["+x+"]);b.push(this.stride["+x+"])}");return j.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),j.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+B.map((function(J){return"shape["+J+"]"})).join(",")+","+B.map((function(J){return"stride["+J+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",j.join("\n"))(F[J],Y)}var F={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};J.exports=function(J,T,b,q){if(void 0===J)return(0,F.array[0])([]);"number"===typeof J&&(J=[J]),void 0===T&&(T=[J.length]);var B=T.length;if(void 0===b){b=new Array(B);for(var Y=B-1,A=1;Y>=0;--Y)b[Y]=A,A*=T[Y]}if(void 0===q){q=0;for(Y=0;Y<B;++Y)b[Y]<0&&(q-=(T[Y]-1)*b[Y])}for(var a=function(J){if(t(J))return"buffer";if(j)switch(Object.prototype.toString.call(J)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(J)?"array":"generic"}(J),P=F[a];P.length<=B+1;)P.push(C(a,P.length-1));return(0,P[B+1])(J,T,b,q)}},12784:J=>{var T;self,T=()=>(()=>{"use strict";var J={d:(T,b)=>{for(var q in b)J.o(b,q)&&!J.o(T,q)&&Object.defineProperty(T,q,{enumerable:!0,get:b[q]})},o:(J,T)=>Object.prototype.hasOwnProperty.call(J,T)},T={};J.d(T,{default:()=>e});var b,q=function(J,T){var b=T.x-J.x,q=T.y-J.y;return Math.sqrt(b*b+q*q)},t=function(J){return J*(Math.PI/180)},j=new Map,B=function(J){j.has(J)&&clearTimeout(j.get(J)),j.set(J,setTimeout(J,100))},Y=function(J,T,b){for(var q,t=T.split(/[ ,]+/g),j=0;j<t.length;j+=1)q=t[j],J.addEventListener?J.addEventListener(q,b,!1):J.attachEvent&&J.attachEvent(q,b)},C=function(J,T,b){for(var q,t=T.split(/[ ,]+/g),j=0;j<t.length;j+=1)q=t[j],J.removeEventListener?J.removeEventListener(q,b):J.detachEvent&&J.detachEvent(q,b)},F=function(J){return J.preventDefault(),J.type.match(/^touch/)?J.changedTouches:J},A=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},a=function(J,T){T.top||T.right||T.bottom||T.left?(J.style.top=T.top,J.style.right=T.right,J.style.bottom=T.bottom,J.style.left=T.left):(J.style.left=T.x+"px",J.style.top=T.y+"px")},P=function(J,T,b){var q=v(J);for(var t in q)if(q.hasOwnProperty(t))if("string"==typeof T)q[t]=T+" "+b;else{for(var j="",B=0,Y=T.length;B<Y;B+=1)j+=T[B]+" "+b+", ";q[t]=j.slice(0,-2)}return q},v=function(J){var T={};return T[J]="",["webkit","Moz","o"].forEach((function(b){T[b+J.charAt(0).toUpperCase()+J.slice(1)]=""})),T},G=function(J,T){for(var b in T)T.hasOwnProperty(b)&&(J[b]=T[b]);return J},x=function(J,T){if(J.length)for(var b=0,q=J.length;b<q;b+=1)T(J[b]);else T(J)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,u=window.matchMedia("(any-hover: none)").matches,U=!!("ontouchstart"in window),K=!!window.PointerEvent,E=!!window.MSPointerEvent,l={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},W={start:"mousedown",move:"mousemove",end:"mouseup"},p={};function o(){}I&&!u?b=l:K?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:U?(b=l,p=W):b=W,o.prototype.on=function(J,T){var b,q=this,t=J.split(/[ ,]+/g);q._handlers_=q._handlers_||{};for(var j=0;j<t.length;j+=1)b=t[j],q._handlers_[b]=q._handlers_[b]||[],q._handlers_[b].push(T);return q},o.prototype.off=function(J,T){var b=this;return b._handlers_=b._handlers_||{},void 0===J?b._handlers_={}:void 0===T?b._handlers_[J]=null:b._handlers_[J]&&b._handlers_[J].indexOf(T)>=0&&b._handlers_[J].splice(b._handlers_[J].indexOf(T),1),b},o.prototype.trigger=function(J,T){var b,q=this,t=J.split(/[ ,]+/g);q._handlers_=q._handlers_||{};for(var j=0;j<t.length;j+=1)b=t[j],q._handlers_[b]&&q._handlers_[b].length&&q._handlers_[b].forEach((function(J){J.call(q,{type:b,target:q},T)}))},o.prototype.config=function(J){var T=this;T.options=T.defaults||{},J&&(T.options=function(J,T){var b={};for(var q in J)J.hasOwnProperty(q)&&T.hasOwnProperty(q)?b[q]=T[q]:J.hasOwnProperty(q)&&(b[q]=J[q]);return b}(T.options,J))},o.prototype.bindEvt=function(J,T){var q=this;return q._domHandlers_=q._domHandlers_||{},q._domHandlers_[T]=function(){"function"==typeof q["on"+T]?q["on"+T].apply(q,arguments):console.warn('[WARNING] : Missing "on'+T+'" handler.')},Y(J,b[T],q._domHandlers_[T]),p[T]&&Y(J,p[T],q._domHandlers_[T]),q},o.prototype.unbindEvt=function(J,T){var q=this;return q._domHandlers_=q._domHandlers_||{},C(J,b[T],q._domHandlers_[T]),p[T]&&C(J,p[T],q._domHandlers_[T]),delete q._domHandlers_[T],this};const S=o;function H(J,T){return this.identifier=T.identifier,this.position=T.position,this.frontPosition=T.frontPosition,this.collection=J,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(T),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=H.id,H.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}H.prototype=new S,H.constructor=H,H.id=0,H.prototype.buildEl=function(J){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},H.prototype.stylize=function(){if(this.options.dataOnly)return this;var J=this.options.fadeTime+"ms",T=function(){var J=v("borderRadius");for(var T in J)J.hasOwnProperty(T)&&(J[T]="50%");return J}(),b=P("transition","opacity",J),q={};return q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},G(q.el,b),"circle"===this.options.shape&&G(q.back,T),G(q.front,T),this.applyStyles(q),this},H.prototype.applyStyles=function(J){for(var T in this.ui)if(this.ui.hasOwnProperty(T))for(var b in J[T])this.ui[T].style[b]=J[T][b];return this},H.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},H.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},H.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},H.prototype.show=function(J){var T=this;return T.options.dataOnly||(clearTimeout(T.removeTimeout),clearTimeout(T.showTimeout),clearTimeout(T.restTimeout),T.addToDom(),T.restCallback(),setTimeout((function(){T.ui.el.style.opacity=1}),0),T.showTimeout=setTimeout((function(){T.trigger("shown",T.instance),"function"==typeof J&&J.call(this)}),T.options.fadeTime)),T},H.prototype.hide=function(J){var T=this;if(T.options.dataOnly)return T;if(T.ui.el.style.opacity=T.options.restOpacity,clearTimeout(T.removeTimeout),clearTimeout(T.showTimeout),clearTimeout(T.restTimeout),T.removeTimeout=setTimeout((function(){var b="dynamic"===T.options.mode?"none":"block";T.ui.el.style.display=b,"function"==typeof J&&J.call(T),T.trigger("hidden",T.instance)}),T.options.fadeTime),T.options.restJoystick){var b=T.options.restJoystick,q={};q.x=!0===b||!1!==b.x?0:T.instance.frontPosition.x,q.y=!0===b||!1!==b.y?0:T.instance.frontPosition.y,T.setPosition(J,q)}return T},H.prototype.setPosition=function(J,T){var b=this;b.frontPosition={x:T.x,y:T.y};var q=b.options.fadeTime+"ms",t={};t.front=P("transition",["transform"],q);var j={front:{}};j.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(t),b.applyStyles(j),b.restTimeout=setTimeout((function(){"function"==typeof J&&J.call(b),b.restCallback()}),b.options.fadeTime)},H.prototype.restCallback=function(){var J=this,T={};T.front=P("transition","none",""),J.applyStyles(T),J.trigger("rested",J.instance)},H.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},H.prototype.computeDirection=function(J){var T,b,q,t=J.angle.radian,j=Math.PI/4,B=Math.PI/2;if(t>j&&t<3*j&&!J.lockX?T="up":t>-j&&t<=j&&!J.lockY?T="left":t>3*-j&&t<=-j&&!J.lockX?T="down":J.lockY||(T="right"),J.lockY||(b=t>-B&&t<B?"left":"right"),J.lockX||(q=t>0?"up":"down"),J.force>this.options.threshold){var Y,C={};for(Y in this.direction)this.direction.hasOwnProperty(Y)&&(C[Y]=this.direction[Y]);var F={};for(Y in this.direction={x:b,y:q,angle:T},J.direction=this.direction,C)C[Y]===this.direction[Y]&&(F[Y]=!0);if(F.x&&F.y&&F.angle)return J;F.x&&F.y||this.trigger("plain",J),F.x||this.trigger("plain:"+b,J),F.y||this.trigger("plain:"+q,J),F.angle||this.trigger("dir dir:"+T,J)}else this.resetDirection();return J};const s=H;function g(J,T){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=J,b.id=g.id,g.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(T),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var q=getComputedStyle(b.options.zone.parentElement);return q&&"flex"===q.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.Vl(),b.begin(),b.nipples}g.prototype=new S,g.constructor=g,g.id=0,g.prototype.prepareNipples=function(){var J=this,T=J.nipples;T.on=J.on.bind(J),T.off=J.off.bind(J),T.options=J.options,T.destroy=J.destroy.bind(J),T.ids=J.ids,T.id=J.id,T.processOnMove=J.processOnMove.bind(J),T.processOnEnd=J.processOnEnd.bind(J),T.get=function(J){if(void 0===J)return T[0];for(var b=0,q=T.length;b<q;b+=1)if(T[b].identifier===J)return T[b];return!1}},g.prototype.Vl=function(){var J=this;J.bindEvt(J.options.zone,"start"),J.options.zone.style.touchAction="none",J.options.zone.style.msTouchAction="none"},g.prototype.begin=function(){var J=this,T=J.options;if("static"===T.mode){var b=J.createNipple(T.position,J.manager.getIdentifier());b.add(),J.idles.push(b)}},g.prototype.createNipple=function(J,T){var b=this,q=b.manager.scroll,t={},j=b.options,B=b.parentIsFlex?q.x:q.x+b.box.left,Y=b.parentIsFlex?q.y:q.y+b.box.top;if(J.x&&J.y)t={x:J.x-B,y:J.y-Y};else if(J.top||J.right||J.bottom||J.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=J.top,C.style.right=J.right,C.style.bottom=J.bottom,C.style.left=J.left,C.style.position="absolute",j.zone.appendChild(C);var F=C.getBoundingClientRect();j.zone.removeChild(C),t=J,J={x:F.left+q.x,y:F.top+q.y}}var A=new s(b,{color:j.color,size:j.size,threshold:j.threshold,fadeTime:j.fadeTime,dataOnly:j.dataOnly,restJoystick:j.restJoystick,restOpacity:j.restOpacity,mode:j.mode,identifier:T,position:J,zone:j.zone,frontPosition:{x:0,y:0},shape:j.shape});return j.dataOnly||(a(A.ui.el,t),a(A.ui.front,A.frontPosition)),b.nipples.push(A),b.trigger("added "+A.identifier+":added",A),b.manager.trigger("added "+A.identifier+":added",A),b.bindNipple(A),A},g.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},g.prototype.bindNipple=function(J){var T,b=this,q=function(J,q){T=J.type+" "+q.id+":"+J.type,b.trigger(T,q)};J.on("destroyed",b.onDestroyed.bind(b)),J.on("shown hidden rested dir plain",q),J.on("dir:up dir:right dir:down dir:left",q),J.on("plain:up plain:right plain:down plain:left",q)},g.prototype.pressureFn=function(J,T,b){var q=this,t=0;clearInterval(q.pressureIntervals[b]),q.pressureIntervals[b]=setInterval(function(){var b=J.force||J.pressure||J.webkitForce||0;b!==t&&(T.trigger("pressure",b),q.trigger("pressure "+T.identifier+":pressure",b),t=b)}.bind(q),100)},g.prototype.onstart=function(J){var T=this,b=T.options,q=J;return J=F(J),T.updateBox(),x(J,(function(t){T.actives.length<b.maxNumberOfNipples?T.processOnStart(t):q.type.match(/^touch/)&&(Object.keys(T.manager.ids).forEach((function(b){if(Object.values(q.touches).findIndex((function(J){return J.identifier===b}))<0){var t=[J[0]];t.identifier=b,T.processOnEnd(t)}})),T.actives.length<b.maxNumberOfNipples&&T.processOnStart(t))})),T.manager.bindDocument(),!1},g.prototype.processOnStart=function(J){var T,b=this,t=b.options,j=b.manager.getIdentifier(J),B=J.force||J.pressure||J.webkitForce||0,Y={x:J.pageX,y:J.pageY},C=b.getOrCreate(j,Y);C.identifier!==j&&b.manager.removeIdentifier(C.identifier),C.identifier=j;var F=function(T){T.trigger("start",T),b.trigger("start "+T.id+":start",T),T.show(),B>0&&b.pressureFn(J,T,T.identifier),b.processOnMove(J)};if((T=b.idles.indexOf(C))>=0&&b.idles.splice(T,1),b.actives.push(C),b.ids.push(C.identifier),"semi"!==t.mode)F(C);else{if(!(q(Y,C.position)<=t.catchDistance))return C.destroy(),void b.processOnStart(J);F(C)}return C},g.prototype.getOrCreate=function(J,T){var b,q=this,t=q.options;return/(semi|static)/.test(t.mode)?(b=q.idles[0])?(q.idles.splice(0,1),b):"semi"===t.mode?q.createNipple(T,J):(console.warn("Coudln't find the needed nipple."),!1):b=q.createNipple(T,J)},g.prototype.processOnMove=function(J){var T=this,b=T.options,j=T.manager.getIdentifier(J),B=T.nipples.get(j),Y=T.manager.scroll;if(function(J){return isNaN(J.buttons)?0!==J.pressure:0!==J.buttons}(J)){if(!B)return console.error("Found zombie joystick with ID "+j),void T.manager.removeIdentifier(j);if(b.dynamicPage){var C=B.el.getBoundingClientRect();B.position={x:Y.x+C.left,y:Y.y+C.top}}B.identifier=j;var F=B.options.size/2,A={x:J.pageX,y:J.pageY};b.lockX&&(A.y=B.position.y),b.lockY&&(A.x=B.position.x);var a,P,v,G,x,I,u,U,K,E,l=q(A,B.position),W=(a=A,v=(P=B.position).x-a.x,G=P.y-a.y,function(J){return J*(180/Math.PI)}(Math.atan2(G,v))),p=t(W),o=l/F,S={distance:l,position:A};if("circle"===B.options.shape?(x=Math.min(l,F),u=B.position,U=x,E={x:0,y:0},K=t(K=W),E.x=u.x-U*Math.cos(K),E.y=u.y-U*Math.sin(K),I=E):(I=function(J,T,b){return{x:Math.min(Math.max(J.x,T.x-b),T.x+b),y:Math.min(Math.max(J.y,T.y-b),T.y+b)}}(A,B.position,F),x=q(I,B.position)),b.follow){if(l>F){var H=A.x-I.x,s=A.y-I.y;B.position.x+=H,B.position.y+=s,B.el.style.top=B.position.y-(T.box.top+Y.y)+"px",B.el.style.left=B.position.x-(T.box.left+Y.x)+"px",l=q(A,B.position)}}else A=I,l=x;var g=A.x-B.position.x,d=A.y-B.position.y;B.frontPosition={x:g,y:d},b.dataOnly||(B.ui.front.style.transform="translate("+g+"px,"+d+"px)");var w={identifier:B.identifier,position:A,force:o,pressure:J.force||J.pressure||J.webkitForce||0,distance:l,angle:{radian:p,degree:W},vector:{x:g/F,y:-d/F},raw:S,instance:B,lockX:b.lockX,lockY:b.lockY};(w=B.computeDirection(w)).angle={radian:t(180-W),degree:180-W},B.trigger("move",w),T.trigger("move "+B.id+":move",w)}else this.processOnEnd(J)},g.prototype.processOnEnd=function(J){var T=this,b=T.options,q=T.manager.getIdentifier(J),t=T.nipples.get(q),j=T.manager.removeIdentifier(t.identifier);t&&(b.dataOnly||t.hide((function(){"dynamic"===b.mode&&(t.trigger("removed",t),T.trigger("removed "+t.id+":removed",t),T.manager.trigger("removed "+t.id+":removed",t),t.destroy())})),clearInterval(T.pressureIntervals[t.identifier]),t.resetDirection(),t.trigger("end",t),T.trigger("end "+t.id+":end",t),T.ids.indexOf(t.identifier)>=0&&T.ids.splice(T.ids.indexOf(t.identifier),1),T.actives.indexOf(t)>=0&&T.actives.splice(T.actives.indexOf(t),1),/(semi|static)/.test(b.mode)?T.idles.push(t):T.nipples.indexOf(t)>=0&&T.nipples.splice(T.nipples.indexOf(t),1),T.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(T.manager.ids[j.id]=j.identifier))},g.prototype.onDestroyed=function(J,T){var b=this;b.nipples.indexOf(T)>=0&&b.nipples.splice(b.nipples.indexOf(T),1),b.actives.indexOf(T)>=0&&b.actives.splice(b.actives.indexOf(T),1),b.idles.indexOf(T)>=0&&b.idles.splice(b.idles.indexOf(T),1),b.ids.indexOf(T.identifier)>=0&&b.ids.splice(b.ids.indexOf(T.identifier),1),b.manager.removeIdentifier(T.identifier),b.manager.unbindDocument()},g.prototype.destroy=function(){var J=this;for(var T in J.unbindEvt(J.options.zone,"start"),J.nipples.forEach((function(J){J.destroy()})),J.pressureIntervals)J.pressureIntervals.hasOwnProperty(T)&&clearInterval(J.pressureIntervals[T]);J.trigger("destroyed",J.nipples),J.manager.unbindDocument(),J.off()};const d=g;function w(J){var T=this;T.ids={},T.index=0,T.collections=[],T.scroll=A(),T.config(J),T.prepareCollections();var b=function(){var J;T.collections.forEach((function(b){b.forEach((function(b){J=b.el.getBoundingClientRect(),b.position={x:T.scroll.x+J.left,y:T.scroll.y+J.top}}))}))};Y(window,"resize",(function(){B(b)}));var q=function(){T.scroll=A()};return Y(window,"scroll",(function(){B(q)})),T.collections}w.prototype=new S,w.constructor=w,w.prototype.prepareCollections=function(){var J=this;J.collections.create=J.create.bind(J),J.collections.on=J.on.bind(J),J.collections.off=J.off.bind(J),J.collections.destroy=J.destroy.bind(J),J.collections.get=function(T){var b;return J.collections.every((function(J){return!(b=J.get(T))})),b}},w.prototype.create=function(J){return this.createCollection(J)},w.prototype.createCollection=function(J){var T=this,b=new d(T,J);return T.bindCollection(b),T.collections.push(b),b},w.prototype.bindCollection=function(J){var T,b=this,q=function(J,q){T=J.type+" "+q.id+":"+J.type,b.trigger(T,q)};J.on("destroyed",b.onDestroyed.bind(b)),J.on("shown hidden rested dir plain",q),J.on("dir:up dir:right dir:down dir:left",q),J.on("plain:up plain:right plain:down plain:left",q)},w.prototype.bindDocument=function(){var J=this;J.binded||(J.bindEvt(document,"move").bindEvt(document,"end"),J.binded=!0)},w.prototype.unbindDocument=function(J){var T=this;Object.keys(T.ids).length&&!0!==J||(T.unbindEvt(document,"move").unbindEvt(document,"end"),T.binded=!1)},w.prototype.getIdentifier=function(J){var T;return J?void 0===(T=void 0===J.identifier?J.pointerId:J.identifier)&&(T=this.latest||0):T=this.index,void 0===this.ids[T]&&(this.ids[T]=this.index,this.index+=1),this.latest=T,this.ids[T]},w.prototype.removeIdentifier=function(J){var T={};for(var b in this.ids)if(this.ids[b]===J){T.id=b,T.identifier=this.ids[b],delete this.ids[b];break}return T},w.prototype.onmove=function(J){return this.onAny("move",J),!1},w.prototype.onend=function(J){return this.onAny("end",J),!1},w.prototype.oncancel=function(J){return this.onAny("end",J),!1},w.prototype.onAny=function(J,T){var b,q=this,t="processOn"+J.charAt(0).toUpperCase()+J.slice(1);T=F(T);var j=function(J,T,b){b.ids.indexOf(T)>=0&&(b[t](J),J._found_=!0)};return x(T,(function(J){b=q.getIdentifier(J),x(q.collections,j.bind(null,J,b)),J._found_||q.removeIdentifier(b)})),!1},w.prototype.destroy=function(){var J=this;J.unbindDocument(!0),J.ids={},J.index=0,J.collections.forEach((function(J){J.destroy()})),J.off()},w.prototype.onDestroyed=function(J,T){var b=this;if(b.collections.indexOf(T)<0)return!1;b.collections.splice(b.collections.indexOf(T),1)};var Z=new w;const e={create:function(J){return Z.create(J)},factory:Z};return T.default})(),J.exports=T()},11892:(J,T,b)=>{"use strict";const{Deflate:q,deflate:t,deflateRaw:j,gzip:B}=b(11895),{Inflate:Y,inflate:C,inflateRaw:F,ungzip:A}=b(11941),a=b(11924);J.exports.Deflate=q,J.exports.deflate=t,J.exports.deflateRaw=j,J.exports.gzip=B,J.exports.Inflate=Y,J.exports.inflate=C,J.exports.inflateRaw=F,J.exports.ungzip=A,J.exports.constants=a},11895:(J,T,b)=>{"use strict";const q=b(11902),t=b(11926),j=b(11931),B=b(11922),Y=b(11933),C=Object.prototype.toString,{Z_NO_FLUSH:F,Z_SYNC_FLUSH:A,Z_FULL_FLUSH:a,Z_FINISH:P,Z_OK:v,Z_STREAM_END:G,Z_DEFAULT_COMPRESSION:x,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:u}=b(11924);function U(J){this.options=t.assign({level:x,method:u,Ja:16384,windowBits:15,memLevel:8,strategy:I},J||{});let T=this.options;T.raw&&T.windowBits>0?T.windowBits=-T.windowBits:T.gzip&&T.windowBits>0&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let b=q.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(b!==v)throw new Error(B[b]);if(T.header&&q.deflateSetHeader(this.strm,T.header),T.dictionary){let J;if(J="string"===typeof T.dictionary?j.string2buf(T.dictionary):"[object ArrayBuffer]"===C.call(T.dictionary)?new Uint8Array(T.dictionary):T.dictionary,b=q.deflateSetDictionary(this.strm,J),b!==v)throw new Error(B[b]);this._dict_set=!0}}function K(J,T){const b=new U(T);if(b.push(J,!0),b.err)throw b.msg||B[b.err];return b.result}U.prototype.push=function(J,T){const b=this.strm,t=this.options.Ja;let B,Y;if(this.ended)return!1;for(Y=T===~~T?T:!0===T?P:F,"string"===typeof J?b.input=j.string2buf(J):"[object ArrayBuffer]"===C.call(J)?b.input=new Uint8Array(J):b.input=J,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(t),b.next_out=0,b.avail_out=t),(Y===A||Y===a)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(B=q.deflate(b,Y),B===G)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),B=q.deflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===v;if(0!==b.avail_out){if(Y>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},U.prototype.onData=function(J){this.chunks.push(J)},U.prototype.onEnd=function(J){J===v&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=J,this.msg=this.strm.msg},J.exports.Deflate=U,J.exports.deflate=K,J.exports.deflateRaw=function(J,T){return(T=T||{}).raw=!0,K(J,T)},J.exports.gzip=function(J,T){return(T=T||{}).gzip=!0,K(J,T)},J.exports.constants=b(11924)},11941:(J,T,b)=>{"use strict";const q=b(11946),t=b(11926),j=b(11931),B=b(11922),Y=b(11933),C=b(11966),F=Object.prototype.toString,{Z_NO_FLUSH:A,Z_FINISH:a,Z_OK:P,Z_STREAM_END:v,Z_NEED_DICT:G,Z_STREAM_ERROR:x,Z_DATA_ERROR:I,Z_MEM_ERROR:u}=b(11924);function U(J){this.options=t.assign({Ja:65536,windowBits:15,to:""},J||{});const T=this.options;T.raw&&T.windowBits>=0&&T.windowBits<16&&(T.windowBits=-T.windowBits,0===T.windowBits&&(T.windowBits=-15)),!(T.windowBits>=0&&T.windowBits<16)||J&&J.windowBits||(T.windowBits+=32),T.windowBits>15&&T.windowBits<48&&0===(15&T.windowBits)&&(T.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let b=q.inflateInit2(this.strm,T.windowBits);if(b!==P)throw new Error(B[b]);if(this.header=new C,q.inflateGetHeader(this.strm,this.header),T.dictionary&&("string"===typeof T.dictionary?T.dictionary=j.string2buf(T.dictionary):"[object ArrayBuffer]"===F.call(T.dictionary)&&(T.dictionary=new Uint8Array(T.dictionary)),T.raw&&(b=q.inflateSetDictionary(this.strm,T.dictionary),b!==P)))throw new Error(B[b])}function K(J,T){const b=new U(T);if(b.push(J),b.err)throw b.msg||B[b.err];return b.result}U.prototype.push=function(J,T){const b=this.strm,t=this.options.Ja,B=this.options.dictionary;let Y,C,U;if(this.ended)return!1;for(C=T===~~T?T:!0===T?a:A,"[object ArrayBuffer]"===F.call(J)?b.input=new Uint8Array(J):b.input=J,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(t),b.next_out=0,b.avail_out=t),Y=q.inflate(b,C),Y===G&&B&&(Y=q.inflateSetDictionary(b,B),Y===P?Y=q.inflate(b,C):Y===I&&(Y=G));b.avail_in>0&&Y===v&&b.state.wrap>0&&0!==J[b.next_in];)q.inflateReset(b),Y=q.inflate(b,C);switch(Y){case x:case I:case G:case u:return this.onEnd(Y),this.ended=!0,!1}if(U=b.avail_out,b.next_out&&(0===b.avail_out||Y===v))if("string"===this.options.to){let J=j.utf8border(b.output,b.next_out),T=b.next_out-J,q=j.buf2string(b.output,J);b.next_out=T,b.avail_out=t-T,T&&b.output.set(b.output.subarray(J,J+T),0),this.onData(q)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(Y!==P||0!==U){if(Y===v)return Y=q.inflateEnd(this.strm),this.onEnd(Y),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},U.prototype.onData=function(J){this.chunks.push(J)},U.prototype.onEnd=function(J){J===P&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=J,this.msg=this.strm.msg},J.exports.Inflate=U,J.exports.inflate=K,J.exports.inflateRaw=function(J,T){return(T=T||{}).raw=!0,K(J,T)},J.exports.ungzip=K,J.exports.constants=b(11924)},11926:J=>{"use strict";const T=(J,T)=>Object.prototype.hasOwnProperty.call(J,T);J.exports.assign=function(J){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const q=b.shift();if(q){if("object"!==typeof q)throw new TypeError(q+"must be non-object");for(const b in q)T(q,b)&&(J[b]=q[b])}}return J},J.exports.flattenChunks=J=>{let T=0;for(let q=0,t=J.length;q<t;q++)T+=J[q].length;const b=new Uint8Array(T);for(let q=0,t=0,j=J.length;q<j;q++){let T=J[q];b.set(T,t),t+=T.length}return b}},11931:J=>{"use strict";let T=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(q){T=!1}const b=new Uint8Array(256);for(let t=0;t<256;t++)b[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;b[254]=b[254]=1,J.exports.string2buf=J=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(J);let T,b,q,t,j,B=J.length,Y=0;for(t=0;t<B;t++)b=J.charCodeAt(t),55296===(64512&b)&&t+1<B&&(q=J.charCodeAt(t+1),56320===(64512&q)&&(b=65536+(b-55296<<10)+(q-56320),t++)),Y+=b<128?1:b<2048?2:b<65536?3:4;for(T=new Uint8Array(Y),j=0,t=0;j<Y;t++)b=J.charCodeAt(t),55296===(64512&b)&&t+1<B&&(q=J.charCodeAt(t+1),56320===(64512&q)&&(b=65536+(b-55296<<10)+(q-56320),t++)),b<128?T[j++]=b:b<2048?(T[j++]=192|b>>>6,T[j++]=128|63&b):b<65536?(T[j++]=224|b>>>12,T[j++]=128|b>>>6&63,T[j++]=128|63&b):(T[j++]=240|b>>>18,T[j++]=128|b>>>12&63,T[j++]=128|b>>>6&63,T[j++]=128|63&b);return T};J.exports.buf2string=(J,q)=>{const t=q||J.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(J.subarray(0,q));let j,B;const Y=new Array(2*t);for(B=0,j=0;j<t;){let T=J[j++];if(T<128){Y[B++]=T;continue}let q=b[T];if(q>4)Y[B++]=65533,j+=q-1;else{for(T&=2===q?31:3===q?15:7;q>1&&j<t;)T=T<<6|63&J[j++],q--;q>1?Y[B++]=65533:T<65536?Y[B++]=T:(T-=65536,Y[B++]=55296|T>>10&1023,Y[B++]=56320|1023&T)}}return((J,b)=>{if(b<65534&&J.subarray&&T)return String.fromCharCode.apply(null,J.length===b?J:J.subarray(0,b));let q="";for(let T=0;T<b;T++)q+=String.fromCharCode(J[T]);return q})(Y,B)},J.exports.utf8border=(J,T)=>{(T=T||J.length)>J.length&&(T=J.length);let q=T-1;for(;q>=0&&128===(192&J[q]);)q--;return q<0||0===q?T:q+b[J[q]]>T?q:T}},11917:J=>{"use strict";J.exports=(J,T,b,q)=>{let t=65535&J,j=J>>>16&65535,B=0;for(;0!==b;){B=b>2e3?2e3:b,b-=B;do{t=t+T[q++]|0,j=j+t|0}while(--B);t%=65521,j%=65521}return t|j<<16}},11924:J=>{"use strict";J.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11920:J=>{"use strict";const T=new Uint32Array((()=>{let J,T=[];for(var b=0;b<256;b++){J=b;for(var q=0;q<8;q++)J=1&J?3988292384^J>>>1:J>>>1;T[b]=J}return T})());J.exports=(J,b,q,t)=>{const j=T,B=t+q;J^=-1;for(let T=t;T<B;T++)J=J>>>8^j[255&(J^b[T])];return~J}},11902:(J,T,b)=>{"use strict";const{_tr_init:q,_tr_stored_block:t,_tr_flush_block:j,_tr_tally:B,_tr_align:Y}=b(11911),C=b(11917),F=b(11920),A=b(11922),{Z_NO_FLUSH:a,Z_PARTIAL_FLUSH:P,Z_FULL_FLUSH:v,Z_FINISH:G,Z_BLOCK:x,Z_OK:I,Z_STREAM_END:u,Z_STREAM_ERROR:U,Z_DATA_ERROR:K,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:l,Z_FILTERED:W,Z_HUFFMAN_ONLY:p,Z_RLE:o,Z_FIXED:S,Z_DEFAULT_STRATEGY:H,Z_UNKNOWN:s,Z_DEFLATED:g}=b(11924),d=258,w=262,Z=103,e=113,c=666,V=(J,T)=>(J.msg=A[T],T),Q=J=>(J<<1)-(J>4?9:0),h=J=>{let T=J.length;for(;--T>=0;)J[T]=0};let i=(J,T,b)=>(T<<J.hash_shift^b)&J.hash_mask;const m=J=>{const T=J.state;let b=T.pending;b>J.avail_out&&(b=J.avail_out),0!==b&&(J.output.set(T.pending_buf.subarray(T.pending_out,T.pending_out+b),J.next_out),J.next_out+=b,T.pending_out+=b,J.total_out+=b,J.avail_out-=b,T.pending-=b,0===T.pending&&(T.pending_out=0))},O=(J,T)=>{j(J,J.block_start>=0?J.block_start:-1,J.strstart-J.block_start,T),J.block_start=J.strstart,m(J.strm)},X=(J,T)=>{J.pending_buf[J.pending++]=T},L=(J,T)=>{J.pending_buf[J.pending++]=T>>>8&255,J.pending_buf[J.pending++]=255&T},r=(J,T,b,q)=>{let t=J.avail_in;return t>q&&(t=q),0===t?0:(J.avail_in-=t,T.set(J.input.subarray(J.next_in,J.next_in+t),b),1===J.state.wrap?J.adler=C(J.adler,T,t,b):2===J.state.wrap&&(J.adler=F(J.adler,T,t,b)),J.next_in+=t,J.total_in+=t,t)},N=(J,T)=>{let b,q,t=J.max_chain_length,j=J.strstart,B=J.prev_length,Y=J.nice_match;const C=J.strstart>J.w_size-w?J.strstart-(J.w_size-w):0,F=J.window,A=J.w_mask,a=J.prev,P=J.strstart+d;let v=F[j+B-1],G=F[j+B];J.prev_length>=J.good_match&&(t>>=2),Y>J.lookahead&&(Y=J.lookahead);do{if(b=T,F[b+B]===G&&F[b+B-1]===v&&F[b]===F[j]&&F[++b]===F[j+1]){j+=2,b++;do{}while(F[++j]===F[++b]&&F[++j]===F[++b]&&F[++j]===F[++b]&&F[++j]===F[++b]&&F[++j]===F[++b]&&F[++j]===F[++b]&&F[++j]===F[++b]&&F[++j]===F[++b]&&j<P);if(q=d-(P-j),j=P-d,q>B){if(J.match_start=T,B=q,q>=Y)break;v=F[j+B-1],G=F[j+B]}}}while((T=a[T&A])>C&&0!==--t);return B<=J.lookahead?B:J.lookahead},R=J=>{const T=J.w_size;let b,q,t,j,B;do{if(j=J.window_size-J.lookahead-J.strstart,J.strstart>=T+(T-w)){J.window.set(J.window.subarray(T,T+T),0),J.match_start-=T,J.strstart-=T,J.block_start-=T,q=J.hash_size,b=q;do{t=J.head[--b],J.head[b]=t>=T?t-T:0}while(--q);q=T,b=q;do{t=J.prev[--b],J.prev[b]=t>=T?t-T:0}while(--q);j+=T}if(0===J.strm.avail_in)break;if(q=r(J.strm,J.window,J.strstart+J.lookahead,j),J.lookahead+=q,J.lookahead+J.insert>=3)for(B=J.strstart-J.insert,J.ins_h=J.window[B],J.ins_h=i(J,J.ins_h,J.window[B+1]);J.insert&&(J.ins_h=i(J,J.ins_h,J.window[B+3-1]),J.prev[B&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=B,B++,J.insert--,!(J.lookahead+J.insert<3)););}while(J.lookahead<w&&0!==J.strm.avail_in)},n=(J,T)=>{let b,q;for(;;){if(J.lookahead<w){if(R(J),J.lookahead<w&&T===a)return 1;if(0===J.lookahead)break}if(b=0,J.lookahead>=3&&(J.ins_h=i(J,J.ins_h,J.window[J.strstart+3-1]),b=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart),0!==b&&J.strstart-b<=J.w_size-w&&(J.match_length=N(J,b)),J.match_length>=3)if(q=B(J,J.strstart-J.match_start,J.match_length-3),J.lookahead-=J.match_length,J.match_length<=J.max_lazy_match&&J.lookahead>=3){J.match_length--;do{J.strstart++,J.ins_h=i(J,J.ins_h,J.window[J.strstart+3-1]),b=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart}while(0!==--J.match_length);J.strstart++}else J.strstart+=J.match_length,J.match_length=0,J.ins_h=J.window[J.strstart],J.ins_h=i(J,J.ins_h,J.window[J.strstart+1]);else q=B(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++;if(q&&(O(J,!1),0===J.strm.avail_out))return 1}return J.insert=J.strstart<2?J.strstart:2,T===G?(O(J,!0),0===J.strm.avail_out?3:4):J.last_lit&&(O(J,!1),0===J.strm.avail_out)?1:2},D=(J,T)=>{let b,q,t;for(;;){if(J.lookahead<w){if(R(J),J.lookahead<w&&T===a)return 1;if(0===J.lookahead)break}if(b=0,J.lookahead>=3&&(J.ins_h=i(J,J.ins_h,J.window[J.strstart+3-1]),b=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart),J.prev_length=J.match_length,J.prev_match=J.match_start,J.match_length=2,0!==b&&J.prev_length<J.max_lazy_match&&J.strstart-b<=J.w_size-w&&(J.match_length=N(J,b),J.match_length<=5&&(J.strategy===W||3===J.match_length&&J.strstart-J.match_start>4096)&&(J.match_length=2)),J.prev_length>=3&&J.match_length<=J.prev_length){t=J.strstart+J.lookahead-3,q=B(J,J.strstart-1-J.prev_match,J.prev_length-3),J.lookahead-=J.prev_length-1,J.prev_length-=2;do{++J.strstart<=t&&(J.ins_h=i(J,J.ins_h,J.window[J.strstart+3-1]),b=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart)}while(0!==--J.prev_length);if(J.match_available=0,J.match_length=2,J.strstart++,q&&(O(J,!1),0===J.strm.avail_out))return 1}else if(J.match_available){if(q=B(J,0,J.window[J.strstart-1]),q&&O(J,!1),J.strstart++,J.lookahead--,0===J.strm.avail_out)return 1}else J.match_available=1,J.strstart++,J.lookahead--}return J.match_available&&(q=B(J,0,J.window[J.strstart-1]),J.match_available=0),J.insert=J.strstart<2?J.strstart:2,T===G?(O(J,!0),0===J.strm.avail_out?3:4):J.last_lit&&(O(J,!1),0===J.strm.avail_out)?1:2};function f(J,T,b,q,t){this.good_length=J,this.max_lazy=T,this.nice_length=b,this.max_chain=q,this.func=t}const z=[new f(0,0,0,0,((J,T)=>{let b=65535;for(b>J.pending_buf_size-5&&(b=J.pending_buf_size-5);;){if(J.lookahead<=1){if(R(J),0===J.lookahead&&T===a)return 1;if(0===J.lookahead)break}J.strstart+=J.lookahead,J.lookahead=0;const q=J.block_start+b;if((0===J.strstart||J.strstart>=q)&&(J.lookahead=J.strstart-q,J.strstart=q,O(J,!1),0===J.strm.avail_out))return 1;if(J.strstart-J.block_start>=J.w_size-w&&(O(J,!1),0===J.strm.avail_out))return 1}return J.insert=0,T===G?(O(J,!0),0===J.strm.avail_out?3:4):(J.strstart>J.block_start&&(O(J,!1),J.strm.avail_out),1)})),new f(4,4,8,4,n),new f(4,5,16,8,n),new f(4,6,32,32,n),new f(4,4,16,16,D),new f(8,16,32,32,D),new f(8,16,128,128,D),new f(8,32,128,256,D),new f(32,128,258,1024,D),new f(32,258,258,4096,D)];function M(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const y=J=>{if(!J||!J.state)return V(J,U);J.total_in=J.total_out=0,J.data_type=s;const T=J.state;return T.pending=0,T.pending_out=0,T.wrap<0&&(T.wrap=-T.wrap),T.status=T.wrap?42:e,J.adler=2===T.wrap?0:1,T.last_flush=a,q(T),I},k=J=>{const T=y(J);var b;return T===I&&((b=J.state).window_size=2*b.w_size,h(b.head),b.max_lazy_match=z[b.level].max_lazy,b.good_match=z[b.level].good_length,b.nice_match=z[b.level].nice_length,b.max_chain_length=z[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),T},JJ=(J,T,b,q,t,j)=>{if(!J)return U;let B=1;if(T===l&&(T=6),q<0?(B=0,q=-q):q>15&&(B=2,q-=16),t<1||t>9||b!==g||q<8||q>15||T<0||T>9||j<0||j>S)return V(J,U);8===q&&(q=9);const Y=new M;return J.state=Y,Y.strm=J,Y.wrap=B,Y.gzhead=null,Y.w_bits=q,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=t+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+3-1)/3),Y.window=new Uint8Array(2*Y.w_size),Y.head=new Uint16Array(Y.hash_size),Y.prev=new Uint16Array(Y.w_size),Y.lit_bufsize=1<<t+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new Uint8Array(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=T,Y.strategy=j,Y.method=b,k(J)};J.exports.deflateInit=(J,T)=>JJ(J,T,g,15,8,H),J.exports.deflateInit2=JJ,J.exports.deflateReset=k,J.exports.deflateResetKeep=y,J.exports.deflateSetHeader=(J,T)=>J&&J.state?2!==J.state.wrap?U:(J.state.gzhead=T,I):U,J.exports.deflate=(J,T)=>{let b,q;if(!J||!J.state||T>x||T<0)return J?V(J,U):U;const j=J.state;if(!J.output||!J.input&&0!==J.avail_in||j.status===c&&T!==G)return V(J,0===J.avail_out?E:U);j.strm=J;const C=j.last_flush;if(j.last_flush=T,42===j.status)if(2===j.wrap)J.adler=0,X(j,31),X(j,139),X(j,8),j.gzhead?(X(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),X(j,255&j.gzhead.time),X(j,j.gzhead.time>>8&255),X(j,j.gzhead.time>>16&255),X(j,j.gzhead.time>>24&255),X(j,9===j.level?2:j.strategy>=p||j.level<2?4:0),X(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(X(j,255&j.gzhead.extra.length),X(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(J.adler=F(J.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(X(j,0),X(j,0),X(j,0),X(j,0),X(j,0),X(j,9===j.level?2:j.strategy>=p||j.level<2?4:0),X(j,3),j.status=e);else{let T=g+(j.w_bits-8<<4)<<8,b=-1;b=j.strategy>=p||j.level<2?0:j.level<6?1:6===j.level?2:3,T|=b<<6,0!==j.strstart&&(T|=32),T+=31-T%31,j.status=e,L(j,T),0!==j.strstart&&(L(j,J.adler>>>16),L(j,65535&J.adler)),J.adler=1}if(69===j.status)if(j.gzhead.extra){for(b=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>b&&(J.adler=F(J.adler,j.pending_buf,j.pending-b,b)),m(J),b=j.pending,j.pending!==j.pending_buf_size));)X(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>b&&(J.adler=F(J.adler,j.pending_buf,j.pending-b,b)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(73===j.status)if(j.gzhead.name){b=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>b&&(J.adler=F(J.adler,j.pending_buf,j.pending-b,b)),m(J),b=j.pending,j.pending===j.pending_buf_size)){q=1;break}q=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,X(j,q)}while(0!==q);j.gzhead.hcrc&&j.pending>b&&(J.adler=F(J.adler,j.pending_buf,j.pending-b,b)),0===q&&(j.gzindex=0,j.status=91)}else j.status=91;if(91===j.status)if(j.gzhead.comment){b=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>b&&(J.adler=F(J.adler,j.pending_buf,j.pending-b,b)),m(J),b=j.pending,j.pending===j.pending_buf_size)){q=1;break}q=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,X(j,q)}while(0!==q);j.gzhead.hcrc&&j.pending>b&&(J.adler=F(J.adler,j.pending_buf,j.pending-b,b)),0===q&&(j.status=Z)}else j.status=Z;if(j.status===Z&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&m(J),j.pending+2<=j.pending_buf_size&&(X(j,255&J.adler),X(j,J.adler>>8&255),J.adler=0,j.status=e)):j.status=e),0!==j.pending){if(m(J),0===J.avail_out)return j.last_flush=-1,I}else if(0===J.avail_in&&Q(T)<=Q(C)&&T!==G)return V(J,E);if(j.status===c&&0!==J.avail_in)return V(J,E);if(0!==J.avail_in||0!==j.lookahead||T!==a&&j.status!==c){let b=j.strategy===p?((J,T)=>{let b;for(;;){if(0===J.lookahead&&(R(J),0===J.lookahead)){if(T===a)return 1;break}if(J.match_length=0,b=B(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,b&&(O(J,!1),0===J.strm.avail_out))return 1}return J.insert=0,T===G?(O(J,!0),0===J.strm.avail_out?3:4):J.last_lit&&(O(J,!1),0===J.strm.avail_out)?1:2})(j,T):j.strategy===o?((J,T)=>{let b,q,t,j;const Y=J.window;for(;;){if(J.lookahead<=d){if(R(J),J.lookahead<=d&&T===a)return 1;if(0===J.lookahead)break}if(J.match_length=0,J.lookahead>=3&&J.strstart>0&&(t=J.strstart-1,q=Y[t],q===Y[++t]&&q===Y[++t]&&q===Y[++t])){j=J.strstart+d;do{}while(q===Y[++t]&&q===Y[++t]&&q===Y[++t]&&q===Y[++t]&&q===Y[++t]&&q===Y[++t]&&q===Y[++t]&&q===Y[++t]&&t<j);J.match_length=d-(j-t),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=3?(b=B(J,1,J.match_length-3),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(b=B(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),b&&(O(J,!1),0===J.strm.avail_out))return 1}return J.insert=0,T===G?(O(J,!0),0===J.strm.avail_out?3:4):J.last_lit&&(O(J,!1),0===J.strm.avail_out)?1:2})(j,T):z[j.level].func(j,T);if(3!==b&&4!==b||(j.status=c),1===b||3===b)return 0===J.avail_out&&(j.last_flush=-1),I;if(2===b&&(T===P?Y(j):T!==x&&(t(j,0,0,!1),T===v&&(h(j.head),0===j.lookahead&&(j.strstart=0,j.block_start=0,j.insert=0))),m(J),0===J.avail_out))return j.last_flush=-1,I}return T!==G?I:j.wrap<=0?u:(2===j.wrap?(X(j,255&J.adler),X(j,J.adler>>8&255),X(j,J.adler>>16&255),X(j,J.adler>>24&255),X(j,255&J.total_in),X(j,J.total_in>>8&255),X(j,J.total_in>>16&255),X(j,J.total_in>>24&255)):(L(j,J.adler>>>16),L(j,65535&J.adler)),m(J),j.wrap>0&&(j.wrap=-j.wrap),0!==j.pending?I:u)},J.exports.deflateEnd=J=>{if(!J||!J.state)return U;const T=J.state.status;return 42!==T&&69!==T&&73!==T&&91!==T&&T!==Z&&T!==e&&T!==c?V(J,U):(J.state=null,T===e?V(J,K):I)},J.exports.deflateSetDictionary=(J,T)=>{let b=T.length;if(!J||!J.state)return U;const q=J.state,t=q.wrap;if(2===t||1===t&&42!==q.status||q.lookahead)return U;if(1===t&&(J.adler=C(J.adler,T,b,0)),q.wrap=0,b>=q.w_size){0===t&&(h(q.head),q.strstart=0,q.block_start=0,q.insert=0);let J=new Uint8Array(q.w_size);J.set(T.subarray(b-q.w_size,b),0),T=J,b=q.w_size}const j=J.avail_in,B=J.next_in,Y=J.input;for(J.avail_in=b,J.next_in=0,J.input=T,R(q);q.lookahead>=3;){let J=q.strstart,T=q.lookahead-2;do{q.ins_h=i(q,q.ins_h,q.window[J+3-1]),q.prev[J&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=J,J++}while(--T);q.strstart=J,q.lookahead=2,R(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=2,q.match_available=0,J.next_in=B,J.input=Y,J.avail_in=j,q.wrap=t,I},J.exports.deflateInfo="pako deflate (from Nodeca project)"},11966:J=>{"use strict";J.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11954:J=>{"use strict";J.exports=function(J,T){let b,q,t,j,B,Y,C,F,A,a,P,v,G,x,I,u,U,K,E,l,W,p,o,S;const H=J.state;b=J.next_in,o=J.input,q=b+(J.avail_in-5),t=J.next_out,S=J.output,j=t-(T-J.avail_out),B=t+(J.avail_out-257),Y=H.dmax,C=H.wsize,F=H.whave,A=H.wnext,a=H.window,P=H.hold,v=H.bits,G=H.lencode,x=H.distcode,I=(1<<H.lenbits)-1,u=(1<<H.distbits)-1;J:do{v<15&&(P+=o[b++]<<v,v+=8,P+=o[b++]<<v,v+=8),U=G[P&I];T:for(;;){if(K=U>>>24,P>>>=K,v-=K,K=U>>>16&255,0===K)S[t++]=65535&U;else{if(!(16&K)){if(0===(64&K)){U=G[(65535&U)+(P&(1<<K)-1)];continue T}if(32&K){H.mode=12;break J}J.msg="invalid literal/length code",H.mode=30;break J}E=65535&U,K&=15,K&&(v<K&&(P+=o[b++]<<v,v+=8),E+=P&(1<<K)-1,P>>>=K,v-=K),v<15&&(P+=o[b++]<<v,v+=8,P+=o[b++]<<v,v+=8),U=x[P&u];b:for(;;){if(K=U>>>24,P>>>=K,v-=K,K=U>>>16&255,!(16&K)){if(0===(64&K)){U=x[(65535&U)+(P&(1<<K)-1)];continue b}J.msg="invalid distance code",H.mode=30;break J}if(l=65535&U,K&=15,v<K&&(P+=o[b++]<<v,v+=8,v<K&&(P+=o[b++]<<v,v+=8)),l+=P&(1<<K)-1,l>Y){J.msg="invalid distance too far back",H.mode=30;break J}if(P>>>=K,v-=K,K=t-j,l>K){if(K=l-K,K>F&&H.sane){J.msg="invalid distance too far back",H.mode=30;break J}if(W=0,p=a,0===A){if(W+=C-K,K<E){E-=K;do{S[t++]=a[W++]}while(--K);W=t-l,p=S}}else if(A<K){if(W+=C+A-K,K-=A,K<E){E-=K;do{S[t++]=a[W++]}while(--K);if(W=0,A<E){K=A,E-=K;do{S[t++]=a[W++]}while(--K);W=t-l,p=S}}}else if(W+=A-K,K<E){E-=K;do{S[t++]=a[W++]}while(--K);W=t-l,p=S}for(;E>2;)S[t++]=p[W++],S[t++]=p[W++],S[t++]=p[W++],E-=3;E&&(S[t++]=p[W++],E>1&&(S[t++]=p[W++]))}else{W=t-l;do{S[t++]=S[W++],S[t++]=S[W++],S[t++]=S[W++],E-=3}while(E>2);E&&(S[t++]=S[W++],E>1&&(S[t++]=S[W++]))}break}}break}}while(b<q&&t<B);E=v>>3,b-=E,v-=E<<3,P&=(1<<v)-1,J.next_in=b,J.next_out=t,J.avail_in=b<q?q-b+5:5-(b-q),J.avail_out=t<B?B-t+257:257-(t-B),H.hold=P,H.bits=v}},11946:(J,T,b)=>{"use strict";const q=b(11917),t=b(11920),j=b(11954),B=b(11957),{Z_FINISH:Y,Z_BLOCK:C,Z_TREES:F,Z_OK:A,Z_STREAM_END:a,Z_NEED_DICT:P,Z_STREAM_ERROR:v,Z_DATA_ERROR:G,Z_MEM_ERROR:x,Z_BUF_ERROR:I,Z_DEFLATED:u}=b(11924),U=12,K=30,E=J=>(J>>>24&255)+(J>>>8&65280)+((65280&J)<<8)+((255&J)<<24);function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const W=J=>{if(!J||!J.state)return v;const T=J.state;return J.total_in=J.total_out=T.total=0,J.msg="",T.wrap&&(J.adler=1&T.wrap),T.mode=1,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new Int32Array(852),T.distcode=T.distdyn=new Int32Array(592),T.sane=1,T.back=-1,A},p=J=>{if(!J||!J.state)return v;const T=J.state;return T.wsize=0,T.whave=0,T.wnext=0,W(J)},o=(J,T)=>{let b;if(!J||!J.state)return v;const q=J.state;return T<0?(b=0,T=-T):(b=1+(T>>4),T<48&&(T&=15)),T&&(T<8||T>15)?v:(null!==q.window&&q.wbits!==T&&(q.window=null),q.wrap=b,q.wbits=T,p(J))},S=(J,T)=>{if(!J)return v;const b=new l;J.state=b,b.window=null;const q=o(J,T);return q!==A&&(J.state=null),q};let H,s,g=!0;const d=J=>{if(g){H=new Int32Array(512),s=new Int32Array(32);let T=0;for(;T<144;)J.lens[T++]=8;for(;T<256;)J.lens[T++]=9;for(;T<280;)J.lens[T++]=7;for(;T<288;)J.lens[T++]=8;for(B(1,J.lens,0,288,H,0,J.work,{bits:9}),T=0;T<32;)J.lens[T++]=5;B(2,J.lens,0,32,s,0,J.work,{bits:5}),g=!1}J.lencode=H,J.lenbits=9,J.distcode=s,J.distbits=5},w=(J,T,b,q)=>{let t;const j=J.state;return null===j.window&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new Uint8Array(j.wsize)),q>=j.wsize?(j.window.set(T.subarray(b-j.wsize,b),0),j.wnext=0,j.whave=j.wsize):(t=j.wsize-j.wnext,t>q&&(t=q),j.window.set(T.subarray(b-q,b-q+t),j.wnext),(q-=t)?(j.window.set(T.subarray(b-q,b),0),j.wnext=q,j.whave=j.wsize):(j.wnext+=t,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=t))),0};J.exports.inflateReset=p,J.exports.inflateReset2=o,J.exports.inflateResetKeep=W,J.exports.inflateInit=J=>S(J,15),J.exports.inflateInit2=S,J.exports.inflate=(J,T)=>{let b,l,W,p,o,S,H,s,g,Z,e,c,V,Q,h,i,m,O,X,L,r,N,R=0;const n=new Uint8Array(4);let D,f;const z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!J||!J.state||!J.output||!J.input&&0!==J.avail_in)return v;b=J.state,b.mode===U&&(b.mode=13),o=J.next_out,W=J.output,H=J.avail_out,p=J.next_in,l=J.input,S=J.avail_in,s=b.hold,g=b.bits,Z=S,e=H,N=A;J:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;g<16;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(2&b.wrap&&35615===s){b.check=0,n[0]=255&s,n[1]=s>>>8&255,b.check=t(b.check,n,2,0),s=0,g=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&s)<<8)+(s>>8))%31){J.msg="incorrect header check",b.mode=K;break}if((15&s)!==u){J.msg="unknown compression method",b.mode=K;break}if(s>>>=4,g-=4,r=8+(15&s),0===b.wbits)b.wbits=r;else if(r>b.wbits){J.msg="invalid window size",b.mode=K;break}b.dmax=1<<b.wbits,J.adler=b.check=1,b.mode=512&s?10:U,s=0,g=0;break;case 2:for(;g<16;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(b.flags=s,(255&b.flags)!==u){J.msg="unknown compression method",b.mode=K;break}if(57344&b.flags){J.msg="unknown header flags set",b.mode=K;break}b.head&&(b.head.text=s>>8&1),512&b.flags&&(n[0]=255&s,n[1]=s>>>8&255,b.check=t(b.check,n,2,0)),s=0,g=0,b.mode=3;case 3:for(;g<32;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}b.head&&(b.head.time=s),512&b.flags&&(n[0]=255&s,n[1]=s>>>8&255,n[2]=s>>>16&255,n[3]=s>>>24&255,b.check=t(b.check,n,4,0)),s=0,g=0,b.mode=4;case 4:for(;g<16;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}b.head&&(b.head.xflags=255&s,b.head.os=s>>8),512&b.flags&&(n[0]=255&s,n[1]=s>>>8&255,b.check=t(b.check,n,2,0)),s=0,g=0,b.mode=5;case 5:if(1024&b.flags){for(;g<16;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}b.length=s,b.head&&(b.head.extra_len=s),512&b.flags&&(n[0]=255&s,n[1]=s>>>8&255,b.check=t(b.check,n,2,0)),s=0,g=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(c=b.length,c>S&&(c=S),c&&(b.head&&(r=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(l.subarray(p,p+c),r)),512&b.flags&&(b.check=t(b.check,l,c,p)),S-=c,p+=c,b.length-=c),b.length))break J;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===S)break J;c=0;do{r=l[p+c++],b.head&&r&&b.length<65536&&(b.head.name+=String.fromCharCode(r))}while(r&&c<S);if(512&b.flags&&(b.check=t(b.check,l,c,p)),S-=c,p+=c,r)break J}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===S)break J;c=0;do{r=l[p+c++],b.head&&r&&b.length<65536&&(b.head.comment+=String.fromCharCode(r))}while(r&&c<S);if(512&b.flags&&(b.check=t(b.check,l,c,p)),S-=c,p+=c,r)break J}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;g<16;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(s!==(65535&b.check)){J.msg="header crc mismatch",b.mode=K;break}s=0,g=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),J.adler=b.check=0,b.mode=U;break;case 10:for(;g<32;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}J.adler=b.check=E(s),s=0,g=0,b.mode=11;case 11:if(0===b.havedict)return J.next_out=o,J.avail_out=H,J.next_in=p,J.avail_in=S,b.hold=s,b.bits=g,P;J.adler=b.check=1,b.mode=U;case U:if(T===C||T===F)break J;case 13:if(b.last){s>>>=7&g,g-=7&g,b.mode=27;break}for(;g<3;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}switch(b.last=1&s,s>>>=1,g-=1,3&s){case 0:b.mode=14;break;case 1:if(d(b),b.mode=20,T===F){s>>>=2,g-=2;break J}break;case 2:b.mode=17;break;case 3:J.msg="invalid block type",b.mode=K}s>>>=2,g-=2;break;case 14:for(s>>>=7&g,g-=7&g;g<32;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if((65535&s)!==(s>>>16^65535)){J.msg="invalid stored block lengths",b.mode=K;break}if(b.length=65535&s,s=0,g=0,b.mode=15,T===F)break J;case 15:b.mode=16;case 16:if(c=b.length,c){if(c>S&&(c=S),c>H&&(c=H),0===c)break J;W.set(l.subarray(p,p+c),o),S-=c,p+=c,H-=c,o+=c,b.length-=c;break}b.mode=U;break;case 17:for(;g<14;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(b.nlen=257+(31&s),s>>>=5,g-=5,b.ndist=1+(31&s),s>>>=5,g-=5,b.ncode=4+(15&s),s>>>=4,g-=4,b.nlen>286||b.ndist>30){J.msg="too many length or distance symbols",b.mode=K;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;g<3;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}b.lens[z[b.have++]]=7&s,s>>>=3,g-=3}for(;b.have<19;)b.lens[z[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,D={bits:b.lenbits},N=B(0,b.lens,0,19,b.lencode,0,b.work,D),b.lenbits=D.bits,N){J.msg="invalid code lengths set",b.mode=K;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;R=b.lencode[s&(1<<b.lenbits)-1],h=R>>>24,i=R>>>16&255,m=65535&R,!(h<=g);){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(m<16)s>>>=h,g-=h,b.lens[b.have++]=m;else{if(16===m){for(f=h+2;g<f;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(s>>>=h,g-=h,0===b.have){J.msg="invalid bit length repeat",b.mode=K;break}r=b.lens[b.have-1],c=3+(3&s),s>>>=2,g-=2}else if(17===m){for(f=h+3;g<f;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}s>>>=h,g-=h,r=0,c=3+(7&s),s>>>=3,g-=3}else{for(f=h+7;g<f;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}s>>>=h,g-=h,r=0,c=11+(127&s),s>>>=7,g-=7}if(b.have+c>b.nlen+b.ndist){J.msg="invalid bit length repeat",b.mode=K;break}for(;c--;)b.lens[b.have++]=r}}if(b.mode===K)break;if(0===b.lens[256]){J.msg="invalid code -- missing end-of-block",b.mode=K;break}if(b.lenbits=9,D={bits:b.lenbits},N=B(1,b.lens,0,b.nlen,b.lencode,0,b.work,D),b.lenbits=D.bits,N){J.msg="invalid literal/lengths set",b.mode=K;break}if(b.distbits=6,b.distcode=b.distdyn,D={bits:b.distbits},N=B(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,D),b.distbits=D.bits,N){J.msg="invalid distances set",b.mode=K;break}if(b.mode=20,T===F)break J;case 20:b.mode=21;case 21:if(S>=6&&H>=258){J.next_out=o,J.avail_out=H,J.next_in=p,J.avail_in=S,b.hold=s,b.bits=g,j(J,e),o=J.next_out,W=J.output,H=J.avail_out,p=J.next_in,l=J.input,S=J.avail_in,s=b.hold,g=b.bits,b.mode===U&&(b.back=-1);break}for(b.back=0;R=b.lencode[s&(1<<b.lenbits)-1],h=R>>>24,i=R>>>16&255,m=65535&R,!(h<=g);){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(i&&0===(240&i)){for(O=h,X=i,L=m;R=b.lencode[L+((s&(1<<O+X)-1)>>O)],h=R>>>24,i=R>>>16&255,m=65535&R,!(O+h<=g);){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}s>>>=O,g-=O,b.back+=O}if(s>>>=h,g-=h,b.back+=h,b.length=m,0===i){b.mode=26;break}if(32&i){b.back=-1,b.mode=U;break}if(64&i){J.msg="invalid literal/length code",b.mode=K;break}b.extra=15&i,b.mode=22;case 22:if(b.extra){for(f=b.extra;g<f;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}b.length+=s&(1<<b.extra)-1,s>>>=b.extra,g-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;R=b.distcode[s&(1<<b.distbits)-1],h=R>>>24,i=R>>>16&255,m=65535&R,!(h<=g);){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(0===(240&i)){for(O=h,X=i,L=m;R=b.distcode[L+((s&(1<<O+X)-1)>>O)],h=R>>>24,i=R>>>16&255,m=65535&R,!(O+h<=g);){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}s>>>=O,g-=O,b.back+=O}if(s>>>=h,g-=h,b.back+=h,64&i){J.msg="invalid distance code",b.mode=K;break}b.offset=m,b.extra=15&i,b.mode=24;case 24:if(b.extra){for(f=b.extra;g<f;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}b.offset+=s&(1<<b.extra)-1,s>>>=b.extra,g-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){J.msg="invalid distance too far back",b.mode=K;break}b.mode=25;case 25:if(0===H)break J;if(c=e-H,b.offset>c){if(c=b.offset-c,c>b.whave&&b.sane){J.msg="invalid distance too far back",b.mode=K;break}c>b.wnext?(c-=b.wnext,V=b.wsize-c):V=b.wnext-c,c>b.length&&(c=b.length),Q=b.window}else Q=W,V=o-b.offset,c=b.length;c>H&&(c=H),H-=c,b.length-=c;do{W[o++]=Q[V++]}while(--c);0===b.length&&(b.mode=21);break;case 26:if(0===H)break J;W[o++]=b.length,H--,b.mode=21;break;case 27:if(b.wrap){for(;g<32;){if(0===S)break J;S--,s|=l[p++]<<g,g+=8}if(e-=H,J.total_out+=e,b.total+=e,e&&(J.adler=b.check=b.flags?t(b.check,W,e,o-e):q(b.check,W,e,o-e)),e=H,(b.flags?s:E(s))!==b.check){J.msg="incorrect data check",b.mode=K;break}s=0,g=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;g<32;){if(0===S)break J;S--,s+=l[p++]<<g,g+=8}if(s!==(4294967295&b.total)){J.msg="incorrect length check",b.mode=K;break}s=0,g=0}b.mode=29;case 29:N=a;break J;case K:N=G;break J;case 31:return x;default:return v}return J.next_out=o,J.avail_out=H,J.next_in=p,J.avail_in=S,b.hold=s,b.bits=g,(b.wsize||e!==J.avail_out&&b.mode<K&&(b.mode<27||T!==Y))&&w(J,J.output,J.next_out,e-J.avail_out)?(b.mode=31,x):(Z-=J.avail_in,e-=J.avail_out,J.total_in+=Z,J.total_out+=e,b.total+=e,b.wrap&&e&&(J.adler=b.check=b.flags?t(b.check,W,e,J.next_out-e):q(b.check,W,e,J.next_out-e)),J.data_type=b.bits+(b.last?64:0)+(b.mode===U?128:0)+(20===b.mode||15===b.mode?256:0),(0===Z&&0===e||T===Y)&&N===A&&(N=I),N)},J.exports.inflateEnd=J=>{if(!J||!J.state)return v;let T=J.state;return T.window&&(T.window=null),J.state=null,A},J.exports.inflateGetHeader=(J,T)=>{if(!J||!J.state)return v;const b=J.state;return 0===(2&b.wrap)?v:(b.head=T,T.done=!1,A)},J.exports.inflateSetDictionary=(J,T)=>{const b=T.length;let t,j,B;return J&&J.state?(t=J.state,0!==t.wrap&&11!==t.mode?v:11===t.mode&&(j=1,j=q(j,T,b,0),j!==t.check)?G:(B=w(J,T,b,b),B?(t.mode=31,x):(t.havedict=1,A))):v},J.exports.inflateInfo="pako inflate (from Nodeca project)"},11957:J=>{"use strict";const T=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),j=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);J.exports=(J,B,Y,C,F,A,a,P)=>{const v=P.bits;let G,x,I,u,U,K,E=0,l=0,W=0,p=0,o=0,S=0,H=0,s=0,g=0,d=0,w=null,Z=0;const e=new Uint16Array(16),c=new Uint16Array(16);let V,Q,h,i=null,m=0;for(E=0;E<=T;E++)e[E]=0;for(l=0;l<C;l++)e[B[Y+l]]++;for(o=v,p=T;p>=1&&0===e[p];p--);if(o>p&&(o=p),0===p)return F[A++]=20971520,F[A++]=20971520,P.bits=1,0;for(W=1;W<p&&0===e[W];W++);for(o<W&&(o=W),s=1,E=1;E<=T;E++)if(s<<=1,s-=e[E],s<0)return-1;if(s>0&&(0===J||1!==p))return-1;for(c[1]=0,E=1;E<T;E++)c[E+1]=c[E]+e[E];for(l=0;l<C;l++)0!==B[Y+l]&&(a[c[B[Y+l]]++]=l);if(0===J?(w=i=a,K=19):1===J?(w=b,Z-=257,i=q,m-=257,K=256):(w=t,i=j,K=-1),d=0,l=0,E=W,U=A,S=o,H=0,I=-1,g=1<<o,u=g-1,1===J&&g>852||2===J&&g>592)return 1;for(;;){V=E-H,a[l]<K?(Q=0,h=a[l]):a[l]>K?(Q=i[m+a[l]],h=w[Z+a[l]]):(Q=96,h=0),G=1<<E-H,x=1<<S,W=x;do{x-=G,F[U+(d>>H)+x]=V<<24|Q<<16|h}while(0!==x);for(G=1<<E-1;d&G;)G>>=1;if(0!==G?(d&=G-1,d+=G):d=0,l++,0===--e[E]){if(E===p)break;E=B[Y+a[l]]}if(E>o&&(d&u)!==I){for(0===H&&(H=o),U+=W,S=E-H,s=1<<S;S+H<p&&(s-=e[S+H],!(s<=0));)S++,s<<=1;if(g+=1<<S,1===J&&g>852||2===J&&g>592)return 1;I=d&u,F[I]=o<<24|S<<16|U-A}}return 0!==d&&(F[U+d]=E-H<<24|64<<16),P.bits=o,0}},11922:J=>{"use strict";J.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11911:J=>{"use strict";function T(J){let T=J.length;for(;--T>=0;)J[T]=0}const b=256,q=286,t=30,j=15,B=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A=new Array(576);T(A);const a=new Array(60);T(a);const P=new Array(512);T(P);const v=new Array(256);T(v);const G=new Array(29);T(G);const x=new Array(t);function I(J,T,b,q,t){this.static_tree=J,this.extra_bits=T,this.extra_base=b,this.elems=q,this.max_length=t,this.has_stree=J&&J.length}let u,U,K;function E(J,T){this.dyn_tree=J,this.max_code=0,this.stat_desc=T}T(x);const l=J=>J<256?P[J]:P[256+(J>>>7)],W=(J,T)=>{J.pending_buf[J.pending++]=255&T,J.pending_buf[J.pending++]=T>>>8&255},p=(J,T,b)=>{J.bi_valid>16-b?(J.bi_buf|=T<<J.bi_valid&65535,W(J,J.bi_buf),J.bi_buf=T>>16-J.bi_valid,J.bi_valid+=b-16):(J.bi_buf|=T<<J.bi_valid&65535,J.bi_valid+=b)},o=(J,T,b)=>{p(J,b[2*T],b[2*T+1])},S=(J,T)=>{let b=0;do{b|=1&J,J>>>=1,b<<=1}while(--T>0);return b>>>1},H=(J,T,b)=>{const q=new Array(16);let t,B,Y=0;for(t=1;t<=j;t++)q[t]=Y=Y+b[t-1]<<1;for(B=0;B<=T;B++){let T=J[2*B+1];0!==T&&(J[2*B]=S(q[T]++,T))}},s=J=>{let T;for(T=0;T<q;T++)J.dyn_ltree[2*T]=0;for(T=0;T<t;T++)J.dyn_dtree[2*T]=0;for(T=0;T<19;T++)J.bl_tree[2*T]=0;J.dyn_ltree[512]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0},g=J=>{J.bi_valid>8?W(J,J.bi_buf):J.bi_valid>0&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0},d=(J,T,b,q)=>{const t=2*T,j=2*b;return J[t]<J[j]||J[t]===J[j]&&q[T]<=q[b]},w=(J,T,b)=>{const q=J.heap[b];let t=b<<1;for(;t<=J.heap_len&&(t<J.heap_len&&d(T,J.heap[t+1],J.heap[t],J.depth)&&t++,!d(T,q,J.heap[t],J.depth));)J.heap[b]=J.heap[t],b=t,t<<=1;J.heap[b]=q},Z=(J,T,q)=>{let t,j,C,F,A=0;if(0!==J.last_lit)do{t=J.pending_buf[J.d_buf+2*A]<<8|J.pending_buf[J.d_buf+2*A+1],j=J.pending_buf[J.l_buf+A],A++,0===t?o(J,j,T):(C=v[j],o(J,C+b+1,T),F=B[C],0!==F&&(j-=G[C],p(J,j,F)),t--,C=l(t),o(J,C,q),F=Y[C],0!==F&&(t-=x[C],p(J,t,F)))}while(A<J.last_lit);o(J,256,T)},e=(J,T)=>{const b=T.dyn_tree,q=T.stat_desc.static_tree,t=T.stat_desc.has_stree,B=T.stat_desc.elems;let Y,C,F,A=-1;for(J.heap_len=0,J.heap_max=573,Y=0;Y<B;Y++)0!==b[2*Y]?(J.heap[++J.heap_len]=A=Y,J.depth[Y]=0):b[2*Y+1]=0;for(;J.heap_len<2;)F=J.heap[++J.heap_len]=A<2?++A:0,b[2*F]=1,J.depth[F]=0,J.opt_len--,t&&(J.static_len-=q[2*F+1]);for(T.max_code=A,Y=J.heap_len>>1;Y>=1;Y--)w(J,b,Y);F=B;do{Y=J.heap[1],J.heap[1]=J.heap[J.heap_len--],w(J,b,1),C=J.heap[1],J.heap[--J.heap_max]=Y,J.heap[--J.heap_max]=C,b[2*F]=b[2*Y]+b[2*C],J.depth[F]=(J.depth[Y]>=J.depth[C]?J.depth[Y]:J.depth[C])+1,b[2*Y+1]=b[2*C+1]=F,J.heap[1]=F++,w(J,b,1)}while(J.heap_len>=2);J.heap[--J.heap_max]=J.heap[1],((J,T)=>{const b=T.dyn_tree,q=T.max_code,t=T.stat_desc.static_tree,B=T.stat_desc.has_stree,Y=T.stat_desc.extra_bits,C=T.stat_desc.extra_base,F=T.stat_desc.max_length;let A,a,P,v,G,x,I=0;for(v=0;v<=j;v++)J.bl_count[v]=0;for(b[2*J.heap[J.heap_max]+1]=0,A=J.heap_max+1;A<573;A++)a=J.heap[A],v=b[2*b[2*a+1]+1]+1,v>F&&(v=F,I++),b[2*a+1]=v,a>q||(J.bl_count[v]++,G=0,a>=C&&(G=Y[a-C]),x=b[2*a],J.opt_len+=x*(v+G),B&&(J.static_len+=x*(t[2*a+1]+G)));if(0!==I){do{for(v=F-1;0===J.bl_count[v];)v--;J.bl_count[v]--,J.bl_count[v+1]+=2,J.bl_count[F]--,I-=2}while(I>0);for(v=F;0!==v;v--)for(a=J.bl_count[v];0!==a;)P=J.heap[--A],P>q||(b[2*P+1]!==v&&(J.opt_len+=(v-b[2*P+1])*b[2*P],b[2*P+1]=v),a--)}})(J,T),H(b,A,J.bl_count)},c=(J,T,b)=>{let q,t,j=-1,B=T[1],Y=0,C=7,F=4;for(0===B&&(C=138,F=3),T[2*(b+1)+1]=65535,q=0;q<=b;q++)t=B,B=T[2*(q+1)+1],++Y<C&&t===B||(Y<F?J.bl_tree[2*t]+=Y:0!==t?(t!==j&&J.bl_tree[2*t]++,J.bl_tree[32]++):Y<=10?J.bl_tree[34]++:J.bl_tree[36]++,Y=0,j=t,0===B?(C=138,F=3):t===B?(C=6,F=3):(C=7,F=4))},V=(J,T,b)=>{let q,t,j=-1,B=T[1],Y=0,C=7,F=4;for(0===B&&(C=138,F=3),q=0;q<=b;q++)if(t=B,B=T[2*(q+1)+1],!(++Y<C&&t===B)){if(Y<F)do{o(J,t,J.bl_tree)}while(0!==--Y);else 0!==t?(t!==j&&(o(J,t,J.bl_tree),Y--),o(J,16,J.bl_tree),p(J,Y-3,2)):Y<=10?(o(J,17,J.bl_tree),p(J,Y-3,3)):(o(J,18,J.bl_tree),p(J,Y-11,7));Y=0,j=t,0===B?(C=138,F=3):t===B?(C=6,F=3):(C=7,F=4)}};let Q=!1;const h=(J,T,b,q)=>{p(J,0+(q?1:0),3),((J,T,b,q)=>{g(J),q&&(W(J,b),W(J,~b)),J.pending_buf.set(J.window.subarray(T,T+b),J.pending),J.pending+=b})(J,T,b,!0)};J.exports._tr_init=J=>{Q||((()=>{let J,T,b,F,E;const l=new Array(16);for(b=0,F=0;F<28;F++)for(G[F]=b,J=0;J<1<<B[F];J++)v[b++]=F;for(v[b-1]=F,E=0,F=0;F<16;F++)for(x[F]=E,J=0;J<1<<Y[F];J++)P[E++]=F;for(E>>=7;F<t;F++)for(x[F]=E<<7,J=0;J<1<<Y[F]-7;J++)P[256+E++]=F;for(T=0;T<=j;T++)l[T]=0;for(J=0;J<=143;)A[2*J+1]=8,J++,l[8]++;for(;J<=255;)A[2*J+1]=9,J++,l[9]++;for(;J<=279;)A[2*J+1]=7,J++,l[7]++;for(;J<=287;)A[2*J+1]=8,J++,l[8]++;for(H(A,287,l),J=0;J<t;J++)a[2*J+1]=5,a[2*J]=S(J,5);u=new I(A,B,257,q,j),U=new I(a,Y,0,t,j),K=new I(new Array(0),C,0,19,7)})(),Q=!0),J.l_desc=new E(J.dyn_ltree,u),J.d_desc=new E(J.dyn_dtree,U),J.bl_desc=new E(J.bl_tree,K),J.bi_buf=0,J.bi_valid=0,s(J)},J.exports._tr_stored_block=h,J.exports._tr_flush_block=(J,T,q,t)=>{let j,B,Y=0;J.level>0?(2===J.strm.data_type&&(J.strm.data_type=(J=>{let T,q=4093624447;for(T=0;T<=31;T++,q>>>=1)if(1&q&&0!==J.dyn_ltree[2*T])return 0;if(0!==J.dyn_ltree[18]||0!==J.dyn_ltree[20]||0!==J.dyn_ltree[26])return 1;for(T=32;T<b;T++)if(0!==J.dyn_ltree[2*T])return 1;return 0})(J)),e(J,J.l_desc),e(J,J.d_desc),Y=(J=>{let T;for(c(J,J.dyn_ltree,J.l_desc.max_code),c(J,J.dyn_dtree,J.d_desc.max_code),e(J,J.bl_desc),T=18;T>=3&&0===J.bl_tree[2*F[T]+1];T--);return J.opt_len+=3*(T+1)+5+5+4,T})(J),j=J.opt_len+3+7>>>3,B=J.static_len+3+7>>>3,B<=j&&(j=B)):j=B=q+5,q+4<=j&&-1!==T?h(J,T,q,t):4===J.strategy||B===j?(p(J,2+(t?1:0),3),Z(J,A,a)):(p(J,4+(t?1:0),3),((J,T,b,q)=>{let t;for(p(J,T-257,5),p(J,b-1,5),p(J,q-4,4),t=0;t<q;t++)p(J,J.bl_tree[2*F[t]+1],3);V(J,J.dyn_ltree,T-1),V(J,J.dyn_dtree,b-1)})(J,J.l_desc.max_code+1,J.d_desc.max_code+1,Y+1),Z(J,J.dyn_ltree,J.dyn_dtree)),s(J),t&&g(J)},J.exports._tr_tally=(J,T,q)=>(J.pending_buf[J.d_buf+2*J.last_lit]=T>>>8&255,J.pending_buf[J.d_buf+2*J.last_lit+1]=255&T,J.pending_buf[J.l_buf+J.last_lit]=255&q,J.last_lit++,0===T?J.dyn_ltree[2*q]++:(J.matches++,T--,J.dyn_ltree[2*(v[q]+b+1)]++,J.dyn_dtree[2*l(T)]++),J.last_lit===J.lit_bufsize-1),J.exports._tr_align=J=>{p(J,2,3),o(J,256,A),(J=>{16===J.bi_valid?(W(J,J.bi_buf),J.bi_buf=0,J.bi_valid=0):J.bi_valid>=8&&(J.pending_buf[J.pending++]=255&J.bi_buf,J.bi_buf>>=8,J.bi_valid-=8)})(J)}},11933:J=>{"use strict";J.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11838:J=>{function T(J,T,b){for(var q=J.length,t=-1/0,j=1/0,B=0;B<q;B++){var Y=(b[0][B]-J[B])/T[B],C=(b[1][B]-J[B])/T[B];if(Y>C){var F=Y;Y=C,C=F}if(C<t||Y>j)return 1/0;Y>t&&(t=Y),C<j&&(j=C)}return t>j?1/0:t}J.exports=function(J,b,q,t){var j=T(b,q,t);if(j===1/0)J=null;else{J=J||[];for(var B=0;B<b.length;B++)J[B]=b[B]+q[B]*j}return J},J.exports.distance=T},12864:(J,T,b)=>{"use strict";b.d(T,{b:()=>B});var q=b(33);const t=q.useLayoutEffect;const j=function(J){var T=(0,q.useRef)(J);return t((function(){T.current=J})),T};var B=function(J){var T=j(J);(0,q.Rb)((function(){var J=function(J){var b;if(null!=T.current&&(b=T.current(J)),J.defaultPrevented&&(J.returnValue=""),"string"===typeof b)return J.returnValue=b,b};return window.addEventListener("beforeunload",J),function(){window.removeEventListener("beforeunload",J)}}),[])}},12825:(J,T,b)=>{"use strict";var q=b(12829),t=Array.prototype.concat,j=Array.prototype.slice,B=J.exports=function(J){for(var T=[],b=0,B=J.length;b<B;b++){var Y=J[b];q(Y)?T=t.call(T,j.call(Y)):T.push(Y)}return T};B.wrap=function(J){return function(){return J(B(arguments))}}},12829:J=>{J.exports=function(J){return!(!J||"string"===typeof J)&&(J instanceof Array||Array.isArray(J)||J.length>=0&&(J.splice instanceof Function||Object.getOwnPropertyDescriptor(J,J.length-1)&&"String"!==J.constructor.name))}},11851:(J,T,b)=>{var q=b(11853);function t(J){for(var T,b,t=0,j=J.length,B=0;B<J.length;){for(T=J[B],b=0;B<j&&J[B]===T;)++B,++b;t+=q.log2(b)/7|0,t+=q.log2(T>>>0)/7|0,t+=2}return t}T.size=t,T.encode=function(J,T){T||(T=new Uint8Array(t(J)));for(var b,q,j=0,B=T.length,Y=0;Y<J.length;){for(b=J[Y],q=0;Y<J.length&&J[Y]===b;)++Y,++q;for(;j<B&&q>=128;)T[j++]=128+(127&q),q>>>=7;if(j>=B)throw new Error("RLE buffer overflow");for(T[j++]=q,b>>>=0;j<B&&b>=128;)T[j++]=128+(127&b),b>>>=7;if(j>=B)throw new Error("RLE buffer overflow");T[j++]=b}return T},T.decode=function(J,T){for(var b,q,t,j,B=T.length,Y=J.length,C=0,F=0;F<Y;){for(b=0,q=0;F<Y&&J[F]>=128;)b+=(127&J[F++])<<q,q+=7;if(b+=J[F++]<<q,F>=Y)throw new Error("RLE buffer underrun");if(C+b>B)throw new Error("Chunk buffer overflow");for(t=0,q=0;F<Y&&J[F]>=128;)t+=(127&J[F++])<<q,q+=7;if(F>=Y)throw new Error("RLE buffer underrun");for(t+=J[F++]<<q,j=0;j<b;++j)T[C++]=t}return T}},11853:(J,T)=>{"use strict";function b(J){var T=32;return(J&=-J)&&T--,65535&J&&(T-=16),16711935&J&&(T-=8),252645135&J&&(T-=4),858993459&J&&(T-=2),1431655765&J&&(T-=1),T}T.INT_BITS=32,T.INT_MAX=2147483647,T.INT_MIN=-1<<31,T.sign=function(J){return(J>0)-(J<0)},T.abs=function(J){var T=J>>31;return(J^T)-T},T.min=function(J,T){return T^(J^T)&-(J<T)},T.max=function(J,T){return J^(J^T)&-(J<T)},T.isPow2=function(J){return!(J&J-1)&&!!J},T.log2=function(J){var T,b;return T=(J>65535)<<4,T|=b=((J>>>=T)>255)<<3,T|=b=((J>>>=b)>15)<<2,(T|=b=((J>>>=b)>3)<<1)|(J>>>=b)>>1},T.log10=function(J){return J>=1e9?9:J>=1e8?8:J>=1e7?7:J>=1e6?6:J>=1e5?5:J>=1e4?4:J>=1e3?3:J>=100?2:J>=10?1:0},T.popCount=function(J){return 16843009*((J=(858993459&(J-=J>>>1&1431655765))+(J>>>2&858993459))+(J>>>4)&252645135)>>>24},T.countTrailingZeros=b,T.nextPow2=function(J){return J+=0===J,--J,J|=J>>>1,J|=J>>>2,J|=J>>>4,J|=J>>>8,(J|=J>>>16)+1},T.prevPow2=function(J){return J|=J>>>1,J|=J>>>2,J|=J>>>4,J|=J>>>8,(J|=J>>>16)-(J>>>1)},T.parity=function(J){return J^=J>>>16,J^=J>>>8,J^=J>>>4,27030>>>(J&=15)&1};var q=new Array(256);!function(J){for(var T=0;T<256;++T){var b=T,q=T,t=7;for(b>>>=1;b;b>>>=1)q<<=1,q|=1&b,--t;J[T]=q<<t&255}}(q),T.reverse=function(J){return q[255&J]<<24|q[J>>>8&255]<<16|q[J>>>16&255]<<8|q[J>>>24&255]},T.interleave2=function(J,T){return(J=1431655765&((J=858993459&((J=252645135&((J=16711935&((J&=65535)|J<<8))|J<<4))|J<<2))|J<<1))|(T=1431655765&((T=858993459&((T=252645135&((T=16711935&((T&=65535)|T<<8))|T<<4))|T<<2))|T<<1))<<1},T.deinterleave2=function(J,T){return(J=65535&((J=16711935&((J=252645135&((J=858993459&((J=J>>>T&1431655765)|J>>>1))|J>>>2))|J>>>4))|J>>>16))<<16>>16},T.interleave3=function(J,T,b){return J=1227133513&((J=3272356035&((J=251719695&((J=4278190335&((J&=1023)|J<<16))|J<<8))|J<<4))|J<<2),(J|=(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},T.deinterleave3=function(J,T){return(J=1023&((J=4278190335&((J=251719695&((J=3272356035&((J=J>>>T&1227133513)|J>>>2))|J>>>4))|J>>>8))|J>>>16))<<22>>22},T.nextCombination=function(J){var T=J|J-1;return T+1|(~T&-~T)-1>>>b(J)+1}},11885:J=>{"use strict";J.exports=function(J,T,b,q){var t=self||window;try{try{var j;try{j=new t.Blob([J])}catch(F){(j=new(t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder)).append(J),j=j.getBlob()}var B=t.URL||t.webkitURL,Y=B.createObjectURL(j),C=new t[T](Y,b);return B.revokeObjectURL(Y),C}catch(F){return new t[T]("data:application/javascript,".concat(encodeURIComponent(J)),b)}}catch(F){if(!q)throw Error("Inline worker is not supported");return new t[T](q,b)}}},11829:(J,T,b)=>{"use strict";function q(J,T,b,q,t){var j={};return Object.keys(q).forEach((function(J){j[J]=q[J]})),j.enumerable=!!j.enumerable,j.configurable=!!j.configurable,("value"in j||j.initializer)&&(j.writable=!0),j=b.slice().reverse().reduce((function(b,q){return q(J,T,b)||b}),j),t&&void 0!==j.initializer&&(j.value=j.initializer?j.initializer.call(t):void 0,j.initializer=void 0),void 0===j.initializer&&(Object.defineProperty(J,T,j),j=null),j}b.d(T,{b:()=>q})},11822:(J,T,b)=>{"use strict";function q(J,T,b,q){b&&Object.defineProperty(J,T,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(q):void 0})}b.d(T,{b:()=>q})},12484:(J,T,b)=>{"use strict";b.d(T,{b:()=>K,c:()=>I,g:()=>u,j:()=>P,k:()=>x,l:()=>G,p:()=>v});var q=b(697),t=b(731),j=b(717),B=b(639),Y=b(12487),C=b(722),F=b(2295),A=b(542),a=b(727);const P=Object.freeze(new q.h(0,0,0,0)),v=Object.freeze(q.n.Zero()),G=Object.freeze(q.k.Zero()),x=Object.freeze(F.b.Zero()),I=Object.freeze(t.b.Black()),u=Object.freeze(new t.d(0,0,0,0)),U={key:0,repeatCount:0,loopMode:2};class K{static _PrepareAnimation(J,T,b,j,B,Y,C,A){let a;if(!isNaN(parseFloat(B))&&isFinite(B)?a=K.ANIMATIONTYPE_FLOAT:B instanceof q.h?a=K.ANIMATIONTYPE_QUATERNION:B instanceof q.n?a=K.ANIMATIONTYPE_VECTOR3:B instanceof q.k?a=K.ANIMATIONTYPE_VECTOR2:B instanceof t.b?a=K.ANIMATIONTYPE_COLOR3:B instanceof t.d?a=K.ANIMATIONTYPE_COLOR4:B instanceof F.b&&(a=K.ANIMATIONTYPE_SIZE),void 0==a)return null;const P=new K(J,T,b,a,C),v=[{frame:0,value:B},{frame:j,value:Y}];return P.setKeys(v),void 0!==A&&P.setEasingFunction(A),P}static CreateAnimation(J,T,b,q){const t=new K(J+"Animation",J,b,T,K.ANIMATIONLOOPMODE_CONSTANT);return t.setEasingFunction(q),t}static CreateAndStartAnimation(J,T,b,q,t,j,B,Y,C,F,A){const a=K._PrepareAnimation(J,b,q,t,j,B,Y,C);return a?(T.va&&(A=T.va()),A?A.beginDirectAnimation(T,[a],0,t,a.loopMode!==K.ANIMATIONLOOPMODE_CONSTANT,1,F):null):null}static CreateAndStartHierarchyAnimation(J,T,b,q,t,j,B,Y,C,F,A){const a=K._PrepareAnimation(J,q,t,j,B,Y,C,F);if(!a)return null;return T.va().beginDirectHierarchyAnimation(T,b,[a],0,j,1===a.loopMode,1,A)}static CreateMergeAndStartAnimation(J,T,b,q,t,j,B,Y,C,F){const A=K._PrepareAnimation(J,b,q,t,j,B,Y,C);return A?(T.animations.push(A),T.va().beginAnimation(T,0,t,1===A.loopMode,1,F)):null}static MakeAnimationAdditive(J,T,b){let t;t="object"===typeof T?T:{referenceFrame:T??0,range:b,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let j=J;if(t.cloneOriginalAnimation&&(j=J.clone(),j.name=t.clonedAnimationName||j.name),!j._keys.length)return j;const B=t.referenceFrame&&t.referenceFrame>=0?t.referenceFrame:0;let Y=0;const C=j._keys[0];let F=j._keys.length-1;const A=j._keys[F],a={referenceValue:C.value,referencePosition:q.j.pi[0],referenceQuaternion:q.j.Quaternion[0],referenceScaling:q.j.pi[1],keyPosition:q.j.pi[2],keyQuaternion:q.j.Quaternion[1],keyScaling:q.j.pi[3]};let P=C.frame,v=A.frame;if(t.range){const J=j.getRange(t.range);J&&(P=J.from,v=J.to)}else P=t.fromFrame??P,v=t.toFrame??v;if(P!==C.frame&&(Y=j.createKeyForFrame(P)),v!==A.frame&&(F=j.createKeyForFrame(v)),1===j._keys.length){const J=j._getKeyValue(j._keys[0]);a.referenceValue=J.clone?J.clone():J}else if(B<=C.frame){const J=j._getKeyValue(C.value);a.referenceValue=J.clone?J.clone():J}else if(B>=A.frame){const J=j._getKeyValue(A.value);a.referenceValue=J.clone?J.clone():J}else{U.key=0;const J=j._interpolate(B,U);a.referenceValue=J.clone?J.clone():J}j.dataType===K.ANIMATIONTYPE_QUATERNION?a.referenceValue.normalize().conjugateInPlace():j.dataType===K.ANIMATIONTYPE_MATRIX&&(a.referenceValue.decompose(a.referenceScaling,a.referenceQuaternion,a.referencePosition),a.referenceQuaternion.normalize().conjugateInPlace());let G=Number.MAX_VALUE;const x=t.clipKeys?[]:null;for(let I=Y;I<=F;I++){let J=j._keys[I];if((x||t.cloneOriginalAnimation)&&(J={frame:J.frame,value:J.value.clone?J.value.clone():J.value,inTangent:J.inTangent,outTangent:J.outTangent,interpolation:J.interpolation,lockedTangent:J.lockedTangent},x&&(G===Number.MAX_VALUE&&(G=J.frame),J.frame-=G,x.push(J))),!I||j.dataType===K.ANIMATIONTYPE_FLOAT||J.value!==C.value)switch(j.dataType){case K.ANIMATIONTYPE_MATRIX:J.value.decompose(a.keyScaling,a.keyQuaternion,a.keyPosition),a.keyPosition.Si(a.referencePosition),a.keyScaling.divideInPlace(a.referenceScaling),a.referenceQuaternion.multiplyToRef(a.keyQuaternion,a.keyQuaternion),q.e.ComposeToRef(a.keyScaling,a.keyQuaternion,a.keyPosition,J.value);break;case K.ANIMATIONTYPE_QUATERNION:a.referenceValue.multiplyToRef(J.value,J.value);break;case K.ANIMATIONTYPE_VECTOR2:case K.ANIMATIONTYPE_VECTOR3:case K.ANIMATIONTYPE_COLOR3:case K.ANIMATIONTYPE_COLOR4:J.value.subtractToRef(a.referenceValue,J.value);break;case K.ANIMATIONTYPE_SIZE:J.value.width-=a.referenceValue.width,J.value.height-=a.referenceValue.height;break;default:J.value-=a.referenceValue}}return x&&j.setKeys(x,!0),j}static TransitionTo(J,T,b,q,t,j,B){let Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(B<=0)return b[J]=T,Y&&Y(),null;const C=t*(B/1e3);j.setKeys([{frame:0,value:b[J].clone?b[J].clone():b[J]},{frame:C,value:T}]),b.animations||(b.animations=[]),b.animations.push(j);const F=q.beginAnimation(b,0,C,!1);return F.onAnimationEnd=Y,F}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const J of this._runtimeAnimations)if(!J.isStopped())return!0;return!1}constructor(J,T,b,q,t,j){this.name=J,this.targetProperty=T,this.framePerSecond=b,this.dataType=q,this.loopMode=t,this.enableBlending=j,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=T.split("."),this.dataType=q,this.loopMode=void 0===t?K.ANIMATIONLOOPMODE_CYCLE:t,this.uniqueId=K._UniqueIdGenerator++}toString(J){let T="Name: "+this.name+", property: "+this.targetProperty;if(T+=", datatype: "+["Float","pi","Quaternion","Matrix","Vi","Vector2"][this.dataType],T+=", nKeys: "+(this._keys?this._keys.length:"none"),T+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),J){T+=", Ranges: {";let J=!0;for(const b in this._ranges)J&&(T+=", ",J=!1),T+=b;T+="}"}return T}addEvent(J){this._events.push(J),this._events.sort(((J,T)=>J.frame-T.frame))}removeEvents(J){for(let T=0;T<this._events.length;T++)this._events[T].frame===J&&(this._events.splice(T,1),T--)}getEvents(){return this._events}createRange(J,T,b){this._ranges[J]||(this._ranges[J]=new Y.b(J,T,b))}deleteRange(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._ranges[J];if(b){if(T){const J=b.from,T=b.to;for(let b=this._keys.length-1;b>=0;b--)this._keys[b].frame>=J&&this._keys[b].frame<=T&&this._keys.splice(b,1)}this._ranges[J]=null}}getRange(J){return this._ranges[J]}getKeys(){return this._keys}getHighestFrame(){let J=0;for(let T=0,b=this._keys.length;T<b;T++)J<this._keys[T].frame&&(J=this._keys[T].frame);return J}getEasingFunction(){return this._easingFunction}setEasingFunction(J){this._easingFunction=J}floatInterpolateFunction(J,T,b){return(0,j.m)(J,T,b)}floatInterpolateFunctionWithTangents(J,T,b,q,t){return(0,j.f)(J,T,b,q,t)}quaternionInterpolateFunction(J,T,b){return q.h.Slerp(J,T,b)}quaternionInterpolateFunctionWithTangents(J,T,b,t,j){return q.h.Hermite(J,T,b,t,j).normalize()}vector3InterpolateFunction(J,T,b){return q.n.Lerp(J,T,b)}vector3InterpolateFunctionWithTangents(J,T,b,t,j){return q.n.Hermite(J,T,b,t,j)}vector2InterpolateFunction(J,T,b){return q.k.Lerp(J,T,b)}vector2InterpolateFunctionWithTangents(J,T,b,t,j){return q.k.Hermite(J,T,b,t,j)}sizeInterpolateFunction(J,T,b){return F.b.Lerp(J,T,b)}color3InterpolateFunction(J,T,b){return t.b.Lerp(J,T,b)}color3InterpolateFunctionWithTangents(J,T,b,q,j){return t.b.Hermite(J,T,b,q,j)}color4InterpolateFunction(J,T,b){return t.d.Lerp(J,T,b)}color4InterpolateFunctionWithTangents(J,T,b,q,j){return t.d.Hermite(J,T,b,q,j)}_getKeyValue(J){return"function"===typeof J?J():J}evaluate(J){return U.key=0,this._interpolate(J,U)}_interpolate(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(T.loopMode===K.ANIMATIONLOOPMODE_CONSTANT&&T.repeatCount>0)return T.highLimitValue.clone?T.highLimitValue.clone():T.highLimitValue;const q=this._keys;let t;if(this._coreAnimation)t=this._coreAnimation._key;else{const j=q.length;for(t=T.key;t>=0&&J<q[t].frame;)--t;for(;t+1<=j-1&&J>=q[t+1].frame;)++t;if(T.key=t,t<0)return b?void 0:this._getKeyValue(q[0].value);if(t+1>j-1)return b?void 0:this._getKeyValue(q[j-1].value);this._key=t}const j=q[t],B=q[t+1];if(b&&(J===j.frame||J===B.frame))return;const Y=this._getKeyValue(j.value),C=this._getKeyValue(B.value);if(1===j.interpolation)return B.frame>J?Y:C;const F=void 0!==j.outTangent&&void 0!==B.inTangent,A=B.frame-j.frame;let a=(J-j.frame)/A;const U=j.easingFunction||this.getEasingFunction();switch(U&&(a=U.ease(a)),this.dataType){case K.ANIMATIONTYPE_FLOAT:{const J=F?this.floatInterpolateFunctionWithTangents(Y,j.outTangent*A,C,B.inTangent*A,a):this.floatInterpolateFunction(Y,C,a);switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(T.offsetValue??0)*T.repeatCount+J}break}case K.ANIMATIONTYPE_QUATERNION:{const J=F?this.quaternionInterpolateFunctionWithTangents(Y,j.outTangent.scale(A),C,B.inTangent.scale(A),a):this.quaternionInterpolateFunction(Y,C,a);switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J.addInPlace((T.offsetValue||P).scale(T.repeatCount))}return J}case K.ANIMATIONTYPE_VECTOR3:{const J=F?this.vector3InterpolateFunctionWithTangents(Y,j.outTangent.scale(A),C,B.inTangent.scale(A),a):this.vector3InterpolateFunction(Y,C,a);switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J.add((T.offsetValue||v).scale(T.repeatCount))}break}case K.ANIMATIONTYPE_VECTOR2:{const J=F?this.vector2InterpolateFunctionWithTangents(Y,j.outTangent.scale(A),C,B.inTangent.scale(A),a):this.vector2InterpolateFunction(Y,C,a);switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J.add((T.offsetValue||G).scale(T.repeatCount))}break}case K.ANIMATIONTYPE_SIZE:switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(Y,C,a);case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(Y,C,a).add((T.offsetValue||x).scale(T.repeatCount))}break;case K.ANIMATIONTYPE_COLOR3:{const J=F?this.color3InterpolateFunctionWithTangents(Y,j.outTangent.scale(A),C,B.inTangent.scale(A),a):this.color3InterpolateFunction(Y,C,a);switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J.add((T.offsetValue||I).scale(T.repeatCount))}break}case K.ANIMATIONTYPE_COLOR4:{const J=F?this.color4InterpolateFunctionWithTangents(Y,j.outTangent.scale(A),C,B.inTangent.scale(A),a):this.color4InterpolateFunction(Y,C,a);switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J.add((T.offsetValue||u).scale(T.repeatCount))}break}case K.ANIMATIONTYPE_MATRIX:switch(T.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return K.AllowMatricesInterpolation?this.matrixInterpolateFunction(Y,C,a,T.workValue):Y;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Y}}return 0}matrixInterpolateFunction(J,T,b,t){return K.AllowMatrixDecomposeForInterpolation?t?(q.e.DecomposeLerpToRef(J,T,b,t),t):q.e.DecomposeLerp(J,T,b):t?(q.e.LerpToRef(J,T,b,t),t):q.e.Lerp(J,T,b)}clone(){const J=new K(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(J.enableBlending=this.enableBlending,J.blendingSpeed=this.blendingSpeed,this._keys&&J.setKeys(this._keys),this._ranges){J._ranges={};for(const T in this._ranges){const b=this._ranges[T];b&&(J._ranges[T]=b.clone())}}return J}setKeys(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=T?J:J.slice(0)}createKeyForFrame(J){U.key=0;const T=this._interpolate(J,U,!0);if(!T)return this._keys[U.key].frame===J?U.key:U.key+1;const b={frame:J,value:T.clone?T.clone():T};return this._keys.splice(U.key+1,0,b),U.key+1}serialize(){const J={};J.name=this.name,J.property=this.targetProperty,J.framePerSecond=this.framePerSecond,J.dataType=this.dataType,J.loopBehavior=this.loopMode,J.enableBlending=this.enableBlending,J.blendingSpeed=this.blendingSpeed;const T=this.dataType;J.keys=[];const b=this.getKeys();for(let q=0;q<b.length;q++){const t=b[q],j={};switch(j.frame=t.frame,T){case K.ANIMATIONTYPE_FLOAT:j.values=[t.value],void 0!==t.inTangent&&j.values.push(t.inTangent),void 0!==t.outTangent&&(void 0===t.inTangent&&j.values.push(void 0),j.values.push(t.outTangent)),void 0!==t.interpolation&&(void 0===t.inTangent&&j.values.push(void 0),void 0===t.outTangent&&j.values.push(void 0),j.values.push(t.interpolation));break;case K.ANIMATIONTYPE_QUATERNION:case K.ANIMATIONTYPE_MATRIX:case K.ANIMATIONTYPE_VECTOR3:case K.ANIMATIONTYPE_COLOR3:case K.ANIMATIONTYPE_COLOR4:j.values=t.value.Ai(),void 0!=t.inTangent&&j.values.push(t.inTangent.Ai()),void 0!=t.outTangent&&(void 0===t.inTangent&&j.values.push(void 0),j.values.push(t.outTangent.Ai())),void 0!==t.interpolation&&(void 0===t.inTangent&&j.values.push(void 0),void 0===t.outTangent&&j.values.push(void 0),j.values.push(t.interpolation))}J.keys.push(j)}J.ranges=[];for(const q in this._ranges){const T=this._ranges[q];if(!T)continue;const b={};b.name=q,b.from=T.from,b.to=T.to,J.ranges.push(b)}return J}static _UniversalLerp(J,T,b){const q=J.constructor;return q.Lerp?q.Lerp(J,T,b):q.Slerp?q.Slerp(J,T,b):J.toFixed?J*(1-b)+b*T:T}static Parse(J){const T=new K(J.name,J.property,J.framePerSecond,J.dataType,J.loopBehavior),b=J.dataType,j=[];let B,Y;for(J.enableBlending&&(T.enableBlending=J.enableBlending),J.blendingSpeed&&(T.blendingSpeed=J.blendingSpeed),Y=0;Y<J.keys.length;Y++){const T=J.keys[Y];let C,F,A;switch(b){case K.ANIMATIONTYPE_FLOAT:B=T.values[0],T.values.length>=2&&(C=T.values[1]),T.values.length>=3&&(F=T.values[2]),T.values.length>=4&&(A=T.values[3]);break;case K.ANIMATIONTYPE_QUATERNION:if(B=q.h.ni(T.values),T.values.length>=8){const J=q.h.ni(T.values.slice(4,8));J.equals(q.h.Zero())||(C=J)}if(T.values.length>=12){const J=q.h.ni(T.values.slice(8,12));J.equals(q.h.Zero())||(F=J)}T.values.length>=13&&(A=T.values[12]);break;case K.ANIMATIONTYPE_MATRIX:B=q.e.ni(T.values),T.values.length>=17&&(A=T.values[16]);break;case K.ANIMATIONTYPE_COLOR3:B=t.b.ni(T.values),T.values[3]&&(C=t.b.ni(T.values[3])),T.values[4]&&(F=t.b.ni(T.values[4])),T.values[5]&&(A=T.values[5]);break;case K.ANIMATIONTYPE_COLOR4:B=t.d.ni(T.values),T.values[4]&&(C=t.d.ni(T.values[4])),T.values[5]&&(F=t.d.ni(T.values[5])),T.values[6]&&(A=t.d.ni(T.values[6]));break;case K.ANIMATIONTYPE_VECTOR3:default:B=q.n.ni(T.values),T.values[3]&&(C=q.n.ni(T.values[3])),T.values[4]&&(F=q.n.ni(T.values[4])),T.values[5]&&(A=T.values[5])}const a={};a.frame=T.frame,a.value=B,void 0!=C&&(a.inTangent=C),void 0!=F&&(a.outTangent=F),void 0!=A&&(a.interpolation=A),j.push(a)}if(T.setKeys(j),J.ranges)for(Y=0;Y<J.ranges.length;Y++)B=J.ranges[Y],T.createRange(B.name,B.from,B.to);return T}static AppendSerializedAnimations(J,T){a.d.AppendSerializedAnimations(J,T)}static async ParseFromFileAsync(J,T){return await new Promise(((b,q)=>{const t=new A.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){let T=JSON.parse(t.responseText);if(T.animations&&(T=T.animations),T.length){const J=[];for(const b of T)J.push(this.Parse(b));b(J)}else{const q=this.Parse(T);J&&(q.name=J),b(q)}}else q("Unable to load the animation")})),t.open("GET",T),t.send()}))}static async ParseFromSnippetAsync(J){return await new Promise(((T,b)=>{const q=new A.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const b=JSON.parse(JSON.parse(q.responseText).jsonPayload);if(b.animations){const q=JSON.parse(b.animations),t=[];for(const T of q.animations){const b=this.Parse(T);b.snippetId=J,t.push(b)}T(t)}else{const q=JSON.parse(b.animation),t=this.Parse(q);t.snippetId=J,T(t)}}else b("Unable to load the snippet "+J)})),q.open("GET",this.SnippetUrl+"/"+J.replace(/#/g,"/")),q.send()}))}}K._UniqueIdGenerator=0,K.AllowMatricesInterpolation=!1,K.AllowMatrixDecomposeForInterpolation=!0,K.SnippetUrl="https://snippet.babylonjs.com",K.ANIMATIONTYPE_FLOAT=0,K.ANIMATIONTYPE_VECTOR3=1,K.ANIMATIONTYPE_QUATERNION=2,K.ANIMATIONTYPE_MATRIX=3,K.ANIMATIONTYPE_COLOR3=4,K.ANIMATIONTYPE_COLOR4=7,K.ANIMATIONTYPE_VECTOR2=5,K.ANIMATIONTYPE_SIZE=6,K.ANIMATIONLOOPMODE_RELATIVE=0,K.ANIMATIONLOOPMODE_CYCLE=1,K.ANIMATIONLOOPMODE_CONSTANT=2,K.ANIMATIONLOOPMODE_YOYO=4,K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,K.CreateFromSnippetAsync=K.ParseFromSnippetAsync,(0,B.g)("BABYLON.Animation",K),C.b._AnimationRangeFactory=(J,T,b)=>new Y.b(J,T,b)},12487:(J,T,b)=>{"use strict";b.d(T,{b:()=>q});class q{constructor(J,T,b){this.name=J,this.from=T,this.to=b}clone(){return new q(this.name,this.from,this.to)}}},12855:(J,T,b)=>{"use strict";b.d(T,{b:()=>B,f:()=>a,g:()=>Y,j:()=>j,l:()=>C,o:()=>t,p:()=>F,r:()=>A});var q=b(2289);class t{constructor(){this._easingMode=t.EASINGMODE_EASEIN}setEasingMode(J){const T=Math.min(Math.max(J,0),2);this._easingMode=T}getEasingMode(){return this._easingMode}easeInCore(J){throw new Error("You must implement this method")}ease(J){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(J);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-J)}return J>=.5?.5*(1-this.easeInCore(2*(1-J)))+.5:.5*this.easeInCore(2*J)}}t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2;class j extends t{easeInCore(J){return J=Math.max(0,Math.min(1,J)),1-Math.sqrt(1-J*J)}}class B extends t{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=J}easeInCore(J){const T=Math.max(0,this.amplitude);return Math.pow(J,3)-J*T*Math.sin(3.141592653589793*J)}}class Y extends t{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=J,this.bounciness=T}easeInCore(J){const T=Math.max(0,this.bounces);let b=this.bounciness;b<=1&&(b=1.001);const q=Math.pow(b,T),t=1-b,j=(1-q)/t+.5*q,B=J*j,Y=Math.log(-B*(1-b)+1)/Math.log(b),C=Math.floor(Y),F=C+1,A=(1-Math.pow(b,C))/(t*j),a=.5*(A+(1-Math.pow(b,F))/(t*j)),P=J-a,v=a-A;return-Math.pow(1/b,T-C)/(v*v)*(P-v)*(P+v)}}class C extends t{easeInCore(J){return J*J*J}}class F extends t{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=J,this.springiness=T}easeInCore(J){let T;const b=Math.max(0,this.oscillations),q=Math.max(0,this.springiness);return T=0==q?J:(Math.exp(q*J)-1)/(Math.exp(q)-1),T*Math.sin((6.283185307179586*b+1.5707963267948966)*J)}}class A extends t{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=J}easeInCore(J){return this.exponent<=0?J:(Math.exp(this.exponent*J)-1)/(Math.exp(this.exponent)-1)}}class a extends t{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=J,this.y1=T,this.x2=b,this.y2=q}easeInCore(J){return q.d.Interpolate(J,this.x1,this.y1,this.x2,this.y2)}}},12482:(J,T,b)=>{"use strict";b.d(T,{b:()=>B});var q=b(697),t=b(711),j=b(722);class B extends j.b{get _matrix(){return this._compose(),this.bj}set _matrix(J){(J.updateFlag!==this.bj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.bj.p(J),this._markAsDirtyAndDecompose())}constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(J,T.va(),!1),this.name=J,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=T,this.bj=(null===t||void 0===t?void 0:t.clone())??q.e.Identity(),this._restMatrix=j??this.bj.clone(),this._bindMatrix=B??this.bj.clone(),this._index=Y,this._absoluteMatrix=new q.e,this._absoluteBindMatrix=new q.e,this._absoluteInverseBindMatrix=new q.e,this._finalMatrix=new q.e,T.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(J){this.setParent(J)}setParent(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==J){if(this.parent){const J=this.parent.children.indexOf(this);-1!==J&&this.parent.children.splice(J,1)}this._parentNode=J,this.parent&&this.parent.children.push(this),T&&this._updateAbsoluteBindMatrices(),this.Pi()}}getLocalMatrix(){return this._compose(),this.bj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(J){this._restMatrix.p(J)}setRestPose(J){this.setRestMatrix(J)}getBindPose(){return this.getBindMatrix()}setBindMatrix(J){this.Zi(J)}setBindPose(J){this.setBindMatrix(J)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const J=q.j.pi[0],T=q.j.Quaternion[0],b=q.j.pi[1];this.getRestMatrix().decompose(J,T,b),this._linkedTransformNode.position.p(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??q.h.Identity(),this._linkedTransformNode.rotationQuaternion.p(T),this._linkedTransformNode.ii.p(J)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(J){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=J,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Gg}set position(J){this._decompose(),this.Gg.p(J),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(J){this.setRotation(J)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(J){this.setRotationQuaternion(J)}get ii(){return this.getScale()}set ii(J){this.setScale(J)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=q.n.Zero(),this._localRotation=q.h.Zero(),this.Gg=q.n.Zero()),this.bj.decompose(this._localScaling,this._localRotation,this.Gg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,q.e.ComposeToRef(this._localScaling,this._localRotation,this.Gg,this.bj)):this._needToCompose=!1)}Zi(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(J),T&&this._updateAbsoluteBindMatrices(),b?this._matrix=J:this.Pi()}_updateAbsoluteBindMatrices(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(J||(J=this._bindMatrix),this.parent?J.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(J),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),T)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Pi(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Pi(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Pi(),this._needToDecompose=!0}_updatePosition(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const j=this.getLocalMatrix();if(0==T)t?(j.addAtIndex(12,J.x),j.addAtIndex(13,J.y),j.addAtIndex(14,J.z)):j.setTranslationFromFloats(J.x,J.y,J.z);else{let T=null;b&&(T=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=B._TmpMats[0],C=B._TmpVecs[0];this.parent?b&&T?(Y.p(this.parent.getAbsoluteMatrix()),Y.multiplyToRef(T,Y)):Y.p(this.parent.getAbsoluteMatrix()):q.e.IdentityToRef(Y),t&&Y.setTranslationFromFloats(0,0,0),Y.invert(),q.n.TransformCoordinatesToRef(J,Y,C),t?(j.addAtIndex(12,C.x),j.addAtIndex(13,C.y),j.addAtIndex(14,C.z)):j.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(J,T,b,!0)}setPosition(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(J,T,b,!1)}setAbsolutePosition(J,T){this.setPosition(J,1,T)}scale(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=this.getLocalMatrix(),Y=B._TmpMats[0];q.e.ScalingToRef(J,T,b,Y),Y.multiplyToRef(j,j),Y.invert();for(const q of this.children){const t=q.getLocalMatrix();t.multiplyToRef(Y,t),t.multiplyAtIndex(12,J),t.multiplyAtIndex(13,T),t.multiplyAtIndex(14,b),q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),t)for(const q of this.children)q.scale(J,T,b,t)}setScale(J){this._decompose(),this._localScaling.p(J),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(J){this._decompose(),J.p(this._localScaling)}setYawPitchRoll(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4?arguments[4]:void 0;if(0===t){const Y=B._TmpQuat;return q.h.RotationYawPitchRollToRef(J,T,b,Y),void this.setRotationQuaternion(Y,t,j)}const Y=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,j))return;const C=B._TmpMats[1];q.e.RotationYawPitchRollToRef(J,T,b,C),Y.multiplyToRef(C,C),this._rotateWithMatrix(C,t,j)}rotate(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;const j=B._TmpMats[0];j.setTranslationFromFloats(0,0,0),q.e.RotationAxisToRef(J,T,j),this._rotateWithMatrix(j,b,t)}setAxisAngle(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;if(0===b){const j=B._TmpQuat;return q.h.RotationAxisToRef(J,T,j),void this.setRotationQuaternion(j,b,t)}const j=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,t))return;const Y=B._TmpMats[1];q.e.RotationAxisToRef(J,T,Y),j.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,b,t)}setRotation(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(J.y,J.x,J.z,T,b)}setRotationQuaternion(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===T)return this._decompose(),this._localRotation.p(J),void this._markAsDirtyAndCompose();const t=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,b))return;const j=B._TmpMats[1];q.e.FromQuaternionToRef(J,j),t.multiplyToRef(j,j),this._rotateWithMatrix(j,T,b)}setRotationMatrix(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===T){const t=B._TmpQuat;return q.h.FromRotationMatrixToRef(J,t),void this.setRotationQuaternion(t,T,b)}const t=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,b))return;const j=B._TmpMats[1];j.p(J),t.multiplyToRef(J,j),this._rotateWithMatrix(j,T,b)}_rotateWithMatrix(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const q=this.getLocalMatrix(),t=q.m[12],j=q.m[13],Y=q.m[14],C=this.getParent(),F=B._TmpMats[3],A=B._TmpMats[4];C&&1==T?(b?(F.p(b.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(F,F)):F.p(C.getAbsoluteMatrix()),A.p(F),A.invert(),q.multiplyToRef(F,q),q.multiplyToRef(J,q),q.multiplyToRef(A,q)):1==T&&b?(F.p(b.getWorldMatrix()),A.p(F),A.invert(),q.multiplyToRef(F,q),q.multiplyToRef(J,q),q.multiplyToRef(A,q)):q.multiplyToRef(J,q),q.setTranslationFromFloats(t,j,Y),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(J,T){const b=B._TmpMats[2];return J.p(this.getAbsoluteMatrix()),T?(J.multiplyToRef(T.getWorldMatrix(),J),q.e.ScalingToRef(T.ii.x,T.ii.y,T.ii.z,b)):q.e.IdentityToRef(b),J.invert(),!isNaN(J.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),J.multiplyToRef(b,J),!0)}Ve(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=q.n.Zero();return this.getPositionToRef(J,T,b),b}getPositionToRef(){let J=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const J=this.getLocalMatrix();T.x=J.m[12],T.y=J.m[13],T.z=J.m[14]}else{let b=null;J&&(b=J.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let q=B._TmpMats[0];J&&b?(q.p(this.getAbsoluteMatrix()),q.multiplyToRef(b,q)):q=this.getAbsoluteMatrix(),T.x=q.m[12],T.y=q.m[13],T.z=q.m[14]}}getAbsolutePosition(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const T=q.n.Zero();return this.getPositionToRef(1,J,T),T}getAbsolutePositionToRef(J,T){this.getPositionToRef(1,J,T)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.bj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.bj);const J=this._skeleton.getPoseMatrix();J&&this._absoluteMatrix.multiplyToRef(J,this._absoluteMatrix)}const J=this.children,T=J.length;for(let b=0;b<T;b++)J[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Qi(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=q.n.Zero();return this.getDirectionToRef(J,T,b),b}getDirectionToRef(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,t=null;T&&(t=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=B._TmpMats[0];j.p(this.getAbsoluteMatrix()),T&&t&&j.multiplyToRef(t,j),q.n.TransformNormalToRef(J,j,b),b.normalize()}getRotation(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=q.n.Zero();return this.getRotationToRef(J,T,b),b}getRotationToRef(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const q=B._TmpQuat;this.getRotationQuaternionToRef(J,T,q),q.toEulerAnglesToRef(b)}getRotationQuaternion(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=q.h.Identity();return this.getRotationQuaternionToRef(J,T,b),b}getRotationQuaternionToRef(){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),T.p(this._localRotation);else{const b=B._TmpMats[0],q=this.getAbsoluteMatrix();J?q.multiplyToRef(J.getWorldMatrix(),b):b.p(q),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,T,void 0)}}getRotationMatrix(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1?arguments[1]:void 0;const b=q.e.Identity();return this.getRotationMatrixToRef(J,T,b),b}getRotationMatrixToRef(){let J=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(T);else{const b=B._TmpMats[0],q=this.getAbsoluteMatrix();J?q.multiplyToRef(J.getWorldMatrix(),b):b.p(q),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(T)}}getAbsolutePositionFromLocal(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=q.n.Zero();return this.getAbsolutePositionFromLocalToRef(J,T,b),b}getAbsolutePositionFromLocalToRef(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,t=null;T&&(t=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=B._TmpMats[0];j.p(this.getAbsoluteMatrix()),T&&t&&j.multiplyToRef(t,j),q.n.TransformCoordinatesToRef(J,j,b)}getLocalPositionFromAbsolute(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=q.n.Zero();return this.getLocalPositionFromAbsoluteToRef(J,T,b),b}getLocalPositionFromAbsoluteToRef(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,t=null;T&&(t=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=B._TmpMats[0];j.p(this.getAbsoluteMatrix()),T&&t&&j.multiplyToRef(t,j),j.invert(),q.n.TransformCoordinatesToRef(J,j,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const J=this._skeleton.bones.indexOf(this);if(-1!==J&&this._skeleton.bones.splice(J,1),this._parentNode&&this._parentNode.children){const J=this._parentNode.children,T=J.indexOf(this);-1!==T&&J.splice(T,1)}super.dispose()}}B._TmpVecs=(0,t.b)(2,q.n.Zero),B._TmpQuat=q.h.Identity(),B._TmpMats=(0,t.b)(5,q.e.Identity)},12852:(J,T,b)=>{"use strict";b.d(T,{c:()=>e});var q=b(674),t=b(680),j=b(497),B=b(697),Y=b(717),C=b(722),F=b(494),A=b(2463),a=b(529),P=b(705);class v{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(J){this._zoomStopsAnimation=J}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(J){this._idleRotationSpeed=J}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(J){this._idleRotationWaitTime=J}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(J){this._idleRotationSpinupTime=J}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(J){this._attachedCamera=J;const T=this._attachedCamera.va();this._onPrePointerObservableObserver=T.onPrePointerObservable.add((J=>{J.type!==A.d.POINTERDOWN?J.type===A.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=J.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const J=a.b.Now;let T=0;null!=this._lastFrameTime&&(T=J-this._lastFrameTime),this._lastFrameTime=J,this._applyUserInteraction();const b=J-this._lastInteractionTime-this._idleRotationWaitTime,q=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(T/1e3))}))}detach(){if(!this._attachedCamera)return;const J=this._attachedCamera.va();this._onPrePointerObservableObserver&&J.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(J){this._lastInteractionTime=J??a.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<P.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let J=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(J=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?J:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=a.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var G=b(12855),x=b(12484);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(J){if(this._autoTransitionRange===J)return;this._autoTransitionRange=J;const T=this._attachedCamera;T&&(J?this._onMeshTargetChangedObserver=T.onMeshTargetChangedObservable.add((J=>{if(J&&(J.ti(!0),J.getBoundingInfo)){const T=J.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*T,this.upperRadiusTransitionRange=.05*T}})):this._onMeshTargetChangedObserver&&T.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(J){this._attachedCamera=J,this._onAfterCheckInputsObserver=J.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(J){return!!this._attachedCamera&&(this._attachedCamera.radius===J&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(J){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=x.b.CreateAnimation("radius",x.b.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const T=x.b.TransitionTo("radius",this._attachedCamera.radius+J,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));T&&this._animatables.push(T)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new G.b(.3),I.EasingMode=G.o.EASINGMODE_EASEOUT;class u{constructor(){this.onTargetFramingAnimationEndObservable=new j.b,this._mode=u.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(J){this._mode=J}get mode(){return this._mode}set radiusScale(J){this._radiusScale=J}get radiusScale(){return this._radiusScale}set positionScale(J){this._positionScale=J}get positionScale(){return this._positionScale}set defaultElevation(J){this._defaultElevation=J}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(J){this._elevationReturnTime=J}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(J){this._elevationReturnWaitTime=J}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(J){this._zoomStopsAnimation=J}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(J){this._framingTime=J}get framingTime(){return this._framingTime}init(){}attach(J){this._attachedCamera=J;const T=this._attachedCamera.va();u.EasingFunction.setEasingMode(u.EasingMode),this._onPrePointerObservableObserver=T.onPrePointerObservable.add((J=>{J.type!==A.d.POINTERDOWN?J.type===A.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=J.onMeshTargetChangedObservable.add((J=>{J&&J.getBoundingInfo&&this.zoomOnMesh(J,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=J.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const J=this._attachedCamera.va();this._onPrePointerObservableObserver&&J.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J.ti(!0);const q=J.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(q.minimumWorld,q.maximumWorld,T,b)}zoomOnMeshHierarchy(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J.ti(!0);const q=J.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(q.min,q.max,T,b)}zoomOnMeshesHierarchy(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new B.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new B.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let j=0;j<J.length;j++){const T=J[j].getHierarchyBoundingVectors(!0);B.n.CheckExtends(T.min,q,t),B.n.CheckExtends(T.max,q,t)}this.zoomOnBoundingInfo(q,t,T,b)}zoomOnBoundingInfo(J,T){let b,q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const j=J.y,Y=j+(T.y-j)*this._positionScale,C=T.Jg(J).scale(.5);if(!isFinite(Y))return!1;if(q)b=new B.n(0,Y,0);else{const T=J.add(C);b=new B.n(T.x,Y,T.z)}this._vectorTransition||(this._vectorTransition=x.b.CreateAnimation("target",x.b.ANIMATIONTYPE_VECTOR3,60,u.EasingFunction)),this._betaIsAnimating=!0;let F=x.b.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);F&&this._animatables.push(F);let A=0;if(this._mode===u.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(J,T);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.wi),A=b}else this._mode===u.IgnoreBoundsSizeMode&&(A=this._calculateLowerRadiusFromModelBoundingSphere(J,T),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.wi));if(this.autoCorrectCameraLimitsAndSensibility){const b=T.Jg(J).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/A}return this._radiusTransition||(this._radiusTransition=x.b.CreateAnimation("radius",x.b.ANIMATIONTYPE_FLOAT,60,u.EasingFunction)),F=x.b.TransitionTo("radius",A,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),t&&t(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),F&&this._animatables.push(F),!0}_calculateLowerRadiusFromModelBoundingSphere(J,T){const b=this._attachedCamera;if(!b)return 0;let q=b._calculateLowerRadiusFromModelBoundingSphere(J,T,this._radiusScale);return b.lowerRadiusLimit&&this._mode===u.IgnoreBoundsSizeMode&&(q=q<b.lowerRadiusLimit?b.lowerRadiusLimit:q),b.upperRadiusLimit&&(q=q>b.upperRadiusLimit?b.upperRadiusLimit:q),q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const J=a.b.Now-this._lastInteractionTime,T=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&J>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=x.b.CreateAnimation("beta",x.b.ANIMATIONTYPE_FLOAT,60,u.EasingFunction));const J=x.b.TransitionTo("beta",T,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));J&&this._animatables.push(J)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=a.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}u.EasingFunction=new G.r,u.EasingMode=G.o.EASINGMODE_EASEINOUT,u.IgnoreBoundsSizeMode=0,u.FitFrustumSidesMode=1;var U=b(670),K=b(12465),E=b(12473),l=b(505);class W{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(J){J=l.e.BackCompatCameraNoPreventDefault(arguments);const T=this.camera.getEngine(),b=T.getInputElement();let q=0,t=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=j=>{var B,Y;const C=j.event,F="touch"===C.pointerType;if(j.type!==A.d.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const a=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,T.isPointerLock){const J=C.movementX,T=C.movementY;this.onTouch(null,J,T),this._pointA=null,this._pointB=null}else{if(j.type!==A.d.POINTERDOWN&&j.type!==A.d.POINTERDOUBLETAP&&F&&(null===(B=this._pointA)||void 0===B?void 0:B.pointerId)!==C.pointerId&&(null===(Y=this._pointB)||void 0===Y?void 0:Y.pointerId)!==C.pointerId)return;if(j.type!==A.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!F)if(j.type===A.d.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(j.type!==A.d.POINTERUP||this._currentMousePointerIdDown!==C.pointerId&&!F){if(j.type===A.d.POINTERMOVE)if(J||C.preventDefault(),this._pointA&&null===this._pointB){const J=C.clientX-this._pointA.x,T=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,J,T)}else if(this._pointA&&this._pointB){const J=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;J.x=C.clientX,J.y=C.clientY;const T=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,B=T*T+b*b,Y={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:j.type};this.onMultiTouch(this._pointA,this._pointB,q,B,t,Y),t=Y,q=B}}else{try{null===a||void 0===a||a.releasePointerCapture(C.pointerId)}catch(P){}F||(this._pointB=null),T._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==q||t)&&(this.onMultiTouch(this._pointA,this._pointB,q,0,t,null),q=0,t=null),this._currentMousePointerIdDown=-1,this.onButtonUp(C),J||C.preventDefault()}else{try{null===a||void 0===a||a.setPointerCapture(C.pointerId)}catch(P){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentMousePointerIdDown||F||(this._currentMousePointerIdDown=C.pointerId),this.onButtonDown(C),J||(C.preventDefault(),b&&b.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,A.d.POINTERDOWN|A.d.POINTERUP|A.d.POINTERMOVE|A.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,q=0,t=null,this.onLostFocus()},this._contextMenuBind=J=>this.onContextMenu(J),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const j=this.camera.va().getEngine().getHostWindow();j&&l.e.RegisterTopRootEvents(j,[{name:"blur",handler:this._onLostFocus}])}Oi(){if(this._onLostFocus){const J=this.camera.va().getEngine().getHostWindow();J&&l.e.UnregisterTopRootEvents(J,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const J=this.camera.va().getEngine().getInputElement();J&&J.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(J){}onTouch(J,T,b){}onMultiTouch(J,T,b,q,t,j){}onContextMenu(J){J.preventDefault()}onButtonDown(J){}onButtonUp(J){}onLostFocus(){}}(0,q.e)([(0,t.M)()],W.prototype,"buttons",void 0);class p extends W{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(J,T){if(0!==this.panningSensibility&&J&&T){const b=T.x-J.x,q=T.y-J.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=q/this.panningSensibility}}_computePinchZoom(J,T){const b=this.camera.radius||p.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=b*Math.sqrt(J)/Math.sqrt(T):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(T-J)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(T-J)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(J,T,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-T/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=T/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(J,T,b,q,t,j){0===b&&null===t||0===q&&null===j||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,q),this._computeMultiTouchPanning(t,j)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(q)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,q),this._isPinching=!0):this._computeMultiTouchPanning(t,j)):this.multiTouchPanning?this._computeMultiTouchPanning(t,j):this.pinchZoom&&this._computePinchZoom(b,q))}onButtonDown(J){this._isPanClick=J.button===this.camera._panningMouseButton}onButtonUp(J){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}p.MinimumRadiusForPinch=.001,(0,q.e)([(0,t.M)()],p.prototype,"buttons",void 0),(0,q.e)([(0,t.M)()],p.prototype,"angularSensibilityX",void 0),(0,q.e)([(0,t.M)()],p.prototype,"angularSensibilityY",void 0),(0,q.e)([(0,t.M)()],p.prototype,"pinchPrecision",void 0),(0,q.e)([(0,t.M)()],p.prototype,"pinchDeltaPercentage",void 0),(0,q.e)([(0,t.M)()],p.prototype,"useNaturalPinchZoom",void 0),(0,q.e)([(0,t.M)()],p.prototype,"pinchZoom",void 0),(0,q.e)([(0,t.M)()],p.prototype,"panningSensibility",void 0),(0,q.e)([(0,t.M)()],p.prototype,"multiTouchPanning",void 0),(0,q.e)([(0,t.M)()],p.prototype,"multiTouchPanAndZoom",void 0),E.d.ArcRotateCameraPointersInput=p;var o=b(2468);class S{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(J){J=l.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((T=>{const b=T.event;if(!b.metaKey)if(T.type===o.d.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(J||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const T=this._keys.indexOf(b.keyCode);T>=0&&this._keys.splice(T,1),b.preventDefault&&(J||b.preventDefault())}})))}Oi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const J=this.camera;for(let T=0;T<this._keys.length;T++){const b=this._keys[T];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?J.inertialPanningX-=1/this.panningSensibility:J.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?J.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?J.inertialRadiusOffset+=1/this.zoomingSensibility:J.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?J.inertialPanningX+=1/this.panningSensibility:J.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?J.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?J.inertialRadiusOffset-=1/this.zoomingSensibility:J.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&J.useInputToRestoreState&&J.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,q.e)([(0,t.M)()],S.prototype,"keysUp",void 0),(0,q.e)([(0,t.M)()],S.prototype,"keysDown",void 0),(0,q.e)([(0,t.M)()],S.prototype,"keysLeft",void 0),(0,q.e)([(0,t.M)()],S.prototype,"keysRight",void 0),(0,q.e)([(0,t.M)()],S.prototype,"keysReset",void 0),(0,q.e)([(0,t.M)()],S.prototype,"panningSensibility",void 0),(0,q.e)([(0,t.M)()],S.prototype,"zoomingSensibility",void 0),(0,q.e)([(0,t.M)()],S.prototype,"useAltToZoom",void 0),(0,q.e)([(0,t.M)()],S.prototype,"angularSpeed",void 0),E.d.ArcRotateCameraKeyboardMoveInput=S;var H=b(749),s=b(2474);class g{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new B.n(0,0,0),this._globalOffset=new B.n(0,0,0),this._inertialPanning=B.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(J,T){let b=0;const q=.01*J*this.wheelDeltaPercentage*T;return b=J>0?q/(1+this.wheelDeltaPercentage):q*(1+this.wheelDeltaPercentage),b}attachControl(J){J=l.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=T=>{if(T.type!==A.d.POINTERWHEEL)return;const b=T.event;let q=0;const t=b.deltaMode===s.b.DOM_DELTA_LINE?40:1,j=-b.deltaY*t;if(this.customComputeDeltaFromMouseWheel)q=this.customComputeDeltaFromMouseWheel(j,this,b);else if(this.wheelDeltaPercentage){if(q=this._computeDeltaFromMouseWheelLegacyEvent(j,this.camera.radius),q>0){let J=this.camera.radius,T=this.camera.inertialRadiusOffset+q;for(let b=0;b<20&&!(J<=T)&&!(Math.abs(T*this.camera.inertia)<.001);b++)J-=T,T*=this.camera.inertia;J=(0,Y.b)(J,0,Number.MAX_VALUE),q=this._computeDeltaFromMouseWheelLegacyEvent(j,J)}}else q=j/(40*this.wheelPrecision);q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(q)):this.camera.inertialRadiusOffset+=q),b.preventDefault&&(J||b.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,A.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.oi(0)}Oi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const J=this.camera;0+J.inertialAlphaOffset+J.inertialBetaOffset+J.inertialRadiusOffset&&(this._updateHitPlane(),J.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(J.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const J=this.camera,T=J.target.Jg(J.position);this._hitPlane=H.e.FromPositionAndNormal(J.target,T)}_getPosition(){const J=this.camera,T=J.va(),b=T.createPickingRay(T.pointerX,T.pointerY,B.e.Identity(),J,!1);0===J.targetScreenOffset.x&&0===J.targetScreenOffset.y||(this._viewOffset.set(J.targetScreenOffset.x,J.targetScreenOffset.y,0),J.getViewMatrix().invertToRef(J._cameraTransformMatrix),this._globalOffset=B.n.TransformNormal(this._viewOffset,J._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let q=0;return this._hitPlane&&(q=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(q))}_zoomToMouse(J){const T=this.camera,b=1-T.inertia;if(T.lowerRadiusLimit){const q=T.lowerRadiusLimit??0;T.radius-(T.inertialRadiusOffset+J)/b<q&&(J=(T.radius-q)*b-T.inertialRadiusOffset)}if(T.upperRadiusLimit){const q=T.upperRadiusLimit??0;T.radius-(T.inertialRadiusOffset+J)/b>q&&(J=(T.radius-q)*b-T.inertialRadiusOffset)}const q=J/b/T.radius,t=this._getPosition(),j=B.j.pi[6];t.subtractToRef(T.target,j),j.scaleInPlace(q),j.scaleInPlace(b),this._inertialPanning.addInPlace(j),T.inertialRadiusOffset+=J}_zeroIfClose(J){Math.abs(J.x)<P.e&&(J.x=0),Math.abs(J.y)<P.e&&(J.y=0),Math.abs(J.z)<P.e&&(J.z=0)}}(0,q.e)([(0,t.M)()],g.prototype,"wheelPrecision",void 0),(0,q.e)([(0,t.M)()],g.prototype,"zoomToMouseLocation",void 0),(0,q.e)([(0,t.M)()],g.prototype,"wheelDeltaPercentage",void 0),E.d.ArcRotateCameraMouseWheelInput=g;class d extends E.g{constructor(J){super(J)}addMouseWheel(){return this.add(new g),this}addPointers(){return this.add(new p),this}addKeyboard(){return this.add(new S),this}}var w=b(639);function Z(J,T){return isNaN(J)?T:J}C.b.AddNodeConstructor("ArcRotateCamera",((J,T)=>()=>new e(J,0,0,1,B.n.Zero(),T)));class e extends K.b{get target(){return this._target}set target(J){this.setTarget(J)}get targetHost(){return this._targetHost}set targetHost(J){J&&this.setTarget(J)}getTarget(){return this.target}get position(){return this._position}set position(J){this.setPosition(J)}set upVector(J){this._upToYMatrix||(this._yToUpMatrix=new B.e,this._upToYMatrix=new B.e,this._upVector=B.n.Zero()),J.normalize(),this._upVector.p(J),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){B.e.RotationAlignToRef(B.n.UpReadOnly,this._upVector,this._yToUpMatrix),B.e.RotationAlignToRef(this._upVector,B.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const J=this.inputs.attached.pointers;return J?J.angularSensibilityX:0}set angularSensibilityX(J){const T=this.inputs.attached.pointers;T&&(T.angularSensibilityX=J)}get angularSensibilityY(){const J=this.inputs.attached.pointers;return J?J.angularSensibilityY:0}set angularSensibilityY(J){const T=this.inputs.attached.pointers;T&&(T.angularSensibilityY=J)}get pinchPrecision(){const J=this.inputs.attached.pointers;return J?J.pinchPrecision:0}set pinchPrecision(J){const T=this.inputs.attached.pointers;T&&(T.pinchPrecision=J)}get pinchDeltaPercentage(){const J=this.inputs.attached.pointers;return J?J.pinchDeltaPercentage:0}set pinchDeltaPercentage(J){const T=this.inputs.attached.pointers;T&&(T.pinchDeltaPercentage=J)}get useNaturalPinchZoom(){const J=this.inputs.attached.pointers;return!!J&&J.useNaturalPinchZoom}set useNaturalPinchZoom(J){const T=this.inputs.attached.pointers;T&&(T.useNaturalPinchZoom=J)}get panningSensibility(){const J=this.inputs.attached.pointers;return J?J.panningSensibility:0}set panningSensibility(J){const T=this.inputs.attached.pointers;T&&(T.panningSensibility=J)}get keysUp(){const J=this.inputs.attached.keyboard;return J?J.keysUp:[]}set keysUp(J){const T=this.inputs.attached.keyboard;T&&(T.keysUp=J)}get keysDown(){const J=this.inputs.attached.keyboard;return J?J.keysDown:[]}set keysDown(J){const T=this.inputs.attached.keyboard;T&&(T.keysDown=J)}get keysLeft(){const J=this.inputs.attached.keyboard;return J?J.keysLeft:[]}set keysLeft(J){const T=this.inputs.attached.keyboard;T&&(T.keysLeft=J)}get keysRight(){const J=this.inputs.attached.keyboard;return J?J.keysRight:[]}set keysRight(J){const T=this.inputs.attached.keyboard;T&&(T.keysRight=J)}get wheelPrecision(){const J=this.inputs.attached.mousewheel;return J?J.wheelPrecision:0}set wheelPrecision(J){const T=this.inputs.attached.mousewheel;T&&(T.wheelPrecision=J)}get zoomToMouseLocation(){const J=this.inputs.attached.mousewheel;return!!J&&J.zoomToMouseLocation}set zoomToMouseLocation(J){const T=this.inputs.attached.mousewheel;T&&(T.zoomToMouseLocation=J)}get wheelDeltaPercentage(){const J=this.inputs.attached.mousewheel;return J?J.wheelDeltaPercentage:0}set wheelDeltaPercentage(J){const T=this.inputs.attached.mousewheel;T&&(T.wheelDeltaPercentage=J)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(J){J!==this.useBouncingBehavior&&(J?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(J){J!==this.useFramingBehavior&&(J?(this._framingBehavior=new u,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(J){J!==this.useAutoRotationBehavior&&(J?(this._autoRotationBehavior=new v,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(J,T,b,q,t,Y){var C;let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(J,B.n.Zero(),Y,F),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=B.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=B.k.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new B.e,this.panningAxis=new B.n(1,1,0),this._transformedDirection=new B.n,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new j.b,this.checkCollisions=!1,this.collisionRadius=new B.n(.5,.5,.5),this._previousPosition=B.n.Zero(),this._collisionVelocity=B.n.Zero(),this._newPosition=B.n.Zero(),this._computationVector=B.n.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new B.n(NaN,NaN,NaN),this._goalTargetScreenOffset=new B.k(NaN,NaN),this._onCollisionPositionChange=function(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(C.setPosition(T),C.Uh&&C.Uh(b)):C._previousPosition.p(C._position);const q=Math.cos(C.alpha),t=Math.sin(C.alpha),j=Math.cos(C.beta);let B=Math.sin(C.beta);0===B&&(B=1e-4);const Y=C._getTargetPosition();C._computationVector.hi(C.radius*q*B,C.radius*j,C.radius*t*B),Y.addToRef(C._computationVector,C._newPosition),C._position.p(C._newPosition);let F=C.upVector;C.allowUpsideDown&&C.beta<0&&(F=F.clone(),F=F.negate()),C._computeViewMatrix(C._position,Y,F),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=B.n.Zero(),t&&this.setTarget(t),this.alpha=T,this.beta=b,this.radius=q,this.getViewMatrix(),this.inputs=new d(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new B.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=B.k.Zero()}_updateCache(J){J||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const J=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?J.addToRef(this._targetBoundingCenter,this._target):this._target.p(J)}const J=this._getLockedTargetPosition();return J||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>P.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,j=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=j?this._currentInterpolationFactor=j:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=Z(J,this._goalAlpha),this._goalBeta=Z(T,this._goalBeta),this._goalRadius=Z(b,this._goalRadius),this._goalTarget.set(Z(q.x,this._goalTarget.x),Z(q.y,this._goalTarget.y),Z(q.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(Z(t.x,this._goalTargetScreenOffset.x),Z(t.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,Y.b)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,Y.b)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,Y.b)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,Y.b)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(J,T){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const t=arguments;T=l.e.BackCompatCameraNoPreventDefault(t),this._useCtrlForPanning=b,this._panningMouseButton=q,"boolean"===typeof t[0]&&(t.length>1&&(this._useCtrlForPanning=t[1]),t.length>2&&(this._panningMouseButton=t[2])),this.inputs.attachElement(T),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Oi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let J=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){J=!0;const T=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let q=this.inertialAlphaOffset*b;this.beta<0&&(q*=-1),this.alpha+=q*T,this.beta+=this.inertialBetaOffset*T,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<P.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<P.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*P.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){J=!0;const T=new B.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),T.multiplyInPlace(this.panningAxis),B.n.TransformNormalToRef(T,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const J=this.upVector,T=B.n.CrossToRef(this._transformedDirection,J,this._transformedDirection);B.n.CrossToRef(J,T,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);B.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const J=B.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(J),J.transposeToRef(J),B.n.TransformCoordinatesToRef(this._transformedDirection,J,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*P.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*P.e&&(this.inertialPanningY=0)}if(J)this.stopInterpolation();else if(this._isInterpolating){let J=!1;const T=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-T/this._currentInterpolationFactor),q=Z(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const T=B.j.pi[0].set(Z(this._goalTarget.x,this._target.x),Z(this._goalTarget.y,this._target.y),Z(this._goalTarget.z,this._target.z));B.n.LerpToRef(this.target,T,b,this._target),10*B.n.Distance(this.target,T)/q<P.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(T),this.setTarget(this.target,!1,!0,!0)):J=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const T=B.h.RotationAlphaBetaGammaToRef(Z(this._goalAlpha,this.alpha),Z(this._goalBeta,this.beta),0,B.j.Quaternion[0]),q=B.h.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,B.j.Quaternion[1]),t=B.h.SlerpToRef(q,T,b,B.j.Quaternion[2]);t.normalize();const j=t.toAlphaBetaGammaToRef(B.j.pi[0]);if(this.alpha=j.x,this.beta=j.y,t.isApprox(T,P.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const J=T.toAlphaBetaGammaToRef(B.j.pi[0]);this.alpha=J.x,this.beta=J.y}else J=!0}if(isNaN(this._goalRadius)||(this.radius+=(q-this.radius)*b,Math.abs(q/this.radius-1)<P.e?(this._goalRadius=NaN,this.radius=q):J=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const T=B.j.Vector2[0].set(Z(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),Z(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));B.k.LerpToRef(this.targetScreenOffset,T,b,this.targetScreenOffset),B.k.Distance(this.targetScreenOffset,T)<P.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(T)):J=!0}this._isInterpolating=J}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const J=this.alpha;var T,b;this.alpha=function(J){let T=Math.PI/2;return 0===J.x&&0===J.z||(T=Math.acos(J.x/Math.sqrt(Math.pow(J.x,2)+Math.pow(J.z,2)))),J.z<0&&(T=2*Math.PI-T),T}(this._computationVector),this.beta=(T=this._computationVector.y,b=this.radius,Math.acos(T/b));const q=Math.round((J-this.alpha)/(2*Math.PI));this.alpha+=2*q*Math.PI,this._checkLimits()}setPosition(J){this._position.equals(J)||(this._position.p(J),this.rebuildAnglesAndRadius())}setTarget(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(q=this.overrideCloneAlphaBetaRadius??q,J.ti)T&&J.getBoundingInfo?this._targetBoundingCenter=J.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,J.ti(),this._targetHost=J,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const T=J,q=this._getTargetPosition();if(q&&!b&&q.equals(T))return;this._targetHost=null,this._target=T,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const J=Math.cos(this.alpha),T=Math.sin(this.alpha),b=Math.cos(this.beta);let q=Math.sin(this.beta);0===q&&(q=1e-4),0===this.radius&&(this.radius=1e-4);const t=this._getTargetPosition();if(this._computationVector.hi(this.radius*J*q,this.radius*b,this.radius*T*q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),t.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const J=this.va().collisionCoordinator;this._collider||(this._collider=J.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,J.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let J=this.upVector;this.allowUpsideDown&&q<0&&(J=J.negate()),this._computeViewMatrix(this._position,t,J),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(t),this._viewMatrix}zoomOn(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];J=J||this.va().meshes;const b=F.e.MinMax(J);let q=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);if(q=Math.max(Math.min(q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=q*this.zoomOnFactor,this.mode===U.b.ORTHOGRAPHIC_CAMERA){const J=this.va().getEngine().getAspectRatio(this),T=q*this.zoomOnFactor/2;this.orthoLeft=-T*J,this.orthoRight=T*J,this.orthoBottom=-T,this.orthoTop=T}this.focusOn({min:b.min,max:b.max,distance:q},T)}focusOn(J){let T,b,q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===J.min){const q=J||this.va().meshes;T=F.e.MinMax(q),b=B.n.Distance(T.min,T.max)}else{T=J,b=J.distance}this._target=F.e.Center(T),q||(this.maxZ=2*b)}createRigCamera(J,T){let b=0;switch(this.cameraRigMode){case U.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.b.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===T?1:-1);break;case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===T?-1:1)}const q=new e(J,this.alpha+b,this.beta,this.radius,this._target,this.va());return q._cameraRigParams={},q.isRigCamera=!0,q.rigParent=this,q.upVector=this.upVector,q.mode=this.mode,q.orthoLeft=this.orthoLeft,q.orthoRight=this.orthoRight,q.orthoBottom=this.orthoBottom,q.orthoTop=this.orthoTop,q}_updateRigCameras(){const J=this._rigCameras[0],T=this._rigCameras[1];switch(J.beta=T.beta=this.beta,this.cameraRigMode){case U.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.b.RIG_MODE_VR:J.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,T.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:J.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,T.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const q=B.n.Distance(J,T),t=this.va().getEngine().getAspectRatio(this),j=Math.tan(this.fov/2),Y=j*t,C=.5*q*b,F=C*Math.sqrt(1+1/(Y*Y)),A=C*Math.sqrt(1+1/(j*j));return Math.max(F,A)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,q.e)([(0,t.M)()],e.prototype,"alpha",void 0),(0,q.e)([(0,t.M)()],e.prototype,"beta",void 0),(0,q.e)([(0,t.M)()],e.prototype,"radius",void 0),(0,q.e)([(0,t.M)()],e.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,q.e)([(0,t.I)("target")],e.prototype,"_target",void 0),(0,q.e)([(0,t.y)("targetHost")],e.prototype,"_targetHost",void 0),(0,q.e)([(0,t.M)()],e.prototype,"inertialAlphaOffset",void 0),(0,q.e)([(0,t.M)()],e.prototype,"inertialBetaOffset",void 0),(0,q.e)([(0,t.M)()],e.prototype,"inertialRadiusOffset",void 0),(0,q.e)([(0,t.M)()],e.prototype,"lowerAlphaLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"upperAlphaLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"lowerBetaLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"upperBetaLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"lowerRadiusLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"upperRadiusLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"lowerTargetYLimit",void 0),(0,q.e)([(0,t.M)()],e.prototype,"inertialPanningX",void 0),(0,q.e)([(0,t.M)()],e.prototype,"inertialPanningY",void 0),(0,q.e)([(0,t.M)()],e.prototype,"pinchToPanMaxDistance",void 0),(0,q.e)([(0,t.M)()],e.prototype,"panningDistanceLimit",void 0),(0,q.e)([(0,t.I)()],e.prototype,"panningOriginTarget",void 0),(0,q.e)([(0,t.M)()],e.prototype,"panningInertia",void 0),(0,q.e)([(0,t.M)()],e.prototype,"zoomToMouseLocation",null),(0,q.e)([(0,t.M)()],e.prototype,"zoomOnFactor",void 0),(0,q.e)([(0,t.E)()],e.prototype,"targetScreenOffset",void 0),(0,q.e)([(0,t.M)()],e.prototype,"allowUpsideDown",void 0),(0,q.e)([(0,t.M)()],e.prototype,"useInputToRestoreState",void 0),(0,q.e)([(0,t.M)()],e.prototype,"restoreStateInterpolationFactor",void 0),(0,w.g)("BABYLON.ArcRotateCamera",e)},12473:(J,T,b)=>{"use strict";b.d(T,{d:()=>B,g:()=>Y});var q=b(519),t=b(727),j=b(670),B={};class Y{constructor(J){this.attachedToElement=!1,this.attached={},this.camera=J,this.checkInputs=()=>{}}add(J){const T=J.getSimpleName();this.attached[T]?q.d.Warn("camera input of type "+T+" already exists on camera"):(this.attached[T]=J,J.camera=this.camera,J.checkInputs&&(this.checkInputs=this._addCheckInputs(J.checkInputs.bind(J))),this.attachedToElement&&J.attachControl(this.noPreventDefault))}remove(J){for(const T in this.attached){const b=this.attached[T];if(b===J)return b.Oi(),b.camera=null,delete this.attached[T],void this.rebuildInputCheck()}}removeByType(J){for(const T in this.attached){const b=this.attached[T];b.getClassName()===J&&(b.Oi(),b.camera=null,delete this.attached[T],this.rebuildInputCheck())}}_addCheckInputs(J){const T=this.checkInputs;return()=>{T(),J()}}attachInput(J){this.attachedToElement&&J.attachControl(this.noPreventDefault)}attachElement(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){J=!j.b.ForceAttachControlToAlwaysPreventDefault&&J,this.attachedToElement=!0,this.noPreventDefault=J;for(const T in this.attached)this.attached[T].attachControl(J)}}detachElement(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const T in this.attached)this.attached[T].Oi(),J&&(this.attached[T].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const J in this.attached){const T=this.attached[J];T.checkInputs&&(this.checkInputs=this._addCheckInputs(T.checkInputs.bind(T)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(J){const T={};for(const b in this.attached){const J=this.attached[b],q=t.d.Serialize(J);T[J.getClassName()]=q}J.inputsmgr=T}parse(J){const T=J.inputsmgr;if(T){this.clear();for(const J in T){const b=B[J];if(b){const q=T[J],j=t.d.Parse((()=>new b),q,null);this.add(j)}}}else for(const b in this.attached){const T=B[this.attached[b].getClassName()];if(T){const q=t.d.Parse((()=>new T),J,null);this.remove(this.attached[b]),this.add(q)}}}}},12456:(J,T,b)=>{"use strict";b.d(T,{e:()=>W});var q=b(674),t=b(680),j=b(697),B=b(12465),Y=b(12473),C=b(2468),F=b(505);class A{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(J){J=F.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((T=>{const b=T.event;if(!b.metaKey)if(T.type===C.d.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),J||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const T=this._keys.indexOf(b.keyCode);T>=0&&this._keys.splice(T,1),J||b.preventDefault()}})))}Oi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const J=this.camera;for(let T=0;T<this._keys.length;T++){const b=this._keys[T],q=J._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?J._localDirection.hi(-q,0,0):-1!==this.keysUp.indexOf(b)?J._localDirection.hi(0,0,q):-1!==this.keysRight.indexOf(b)?J._localDirection.hi(q,0,0):-1!==this.keysDown.indexOf(b)?J._localDirection.hi(0,0,-q):-1!==this.keysUpward.indexOf(b)?J._localDirection.hi(0,q,0):-1!==this.keysDownward.indexOf(b)?J._localDirection.hi(0,-q,0):-1!==this.keysRotateLeft.indexOf(b)?(J._localDirection.hi(0,0,0),J.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(J._localDirection.hi(0,0,0),J.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(J._localDirection.hi(0,0,0),J.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(J._localDirection.hi(0,0,0),J.cameraRotation.x+=this._getLocalRotation()),J.va().useRightHandedSystem&&(J._localDirection.z*=-1),J.getViewMatrix().invertToRef(J._cameraTransformMatrix),j.n.TransformNormalToRef(J._localDirection,J._cameraTransformMatrix,J._transformedDirection),J.cameraDirection.addInPlace(J._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const J=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*J}}(0,q.e)([(0,t.M)()],A.prototype,"keysUp",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysUpward",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysDown",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysDownward",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysLeft",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysRight",void 0),(0,q.e)([(0,t.M)()],A.prototype,"rotationSpeed",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysRotateLeft",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysRotateRight",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysRotateUp",void 0),(0,q.e)([(0,t.M)()],A.prototype,"keysRotateDown",void 0),Y.d.FreeCameraKeyboardMoveInput=A;var a=b(497),P=b(2463);class v{constructor(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=J,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new a.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(J){J=F.e.BackCompatCameraNoPreventDefault(arguments);const T=this.camera.getEngine(),b=T.getInputElement();this._pointerInput||(this._pointerInput=q=>{const t=q.event,j="touch"===t.pointerType;if(!this.touchEnabled&&j)return;if(q.type!==P.d.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const B=t.target;if(q.type===P.d.POINTERDOWN){if(j&&-1!==this._activePointerId||!j&&-1!==this._currentActiveButton)return;this._activePointerId=t.pointerId;try{null===B||void 0===B||B.setPointerCapture(t.pointerId)}catch(Y){}-1===this._currentActiveButton&&(this._currentActiveButton=t.button),this._previousPosition={x:t.clientX,y:t.clientY},J||(t.preventDefault(),b&&b.focus()),T.isPointerLock&&this._onMouseMove&&this._onMouseMove(q.event)}else if(q.type===P.d.POINTERUP){if(j&&this._activePointerId!==t.pointerId||!j&&this._currentActiveButton!==t.button)return;try{null===B||void 0===B||B.releasePointerCapture(t.pointerId)}catch(Y){}this._currentActiveButton=-1,this._previousPosition=null,J||t.preventDefault(),this._activePointerId=-1}else if(q.type===P.d.POINTERMOVE&&(this._activePointerId===t.pointerId||!j))if(T.isPointerLock&&this._onMouseMove)this._onMouseMove(q.event);else if(this._previousPosition){const T=this.camera._calculateHandednessMultiplier(),b=(t.clientX-this._previousPosition.x)*T,q=t.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:q}),this._previousPosition={x:t.clientX,y:t.clientY},J||t.preventDefault()}}),this._onMouseMove=b=>{if(!T.isPointerLock)return;const q=this.camera._calculateHandednessMultiplier(),t=b.movementX*q;this.camera.cameraRotation.y+=t/this.angularSensibility;const j=b.movementY;this.camera.cameraRotation.x+=j/this.angularSensibility,this._previousPosition=null,J||b.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE),b&&(this._contextMenuBind=J=>this.onContextMenu(J),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(J){J.preventDefault()}Oi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const J=this.camera.getEngine().getInputElement();J&&J.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,q.e)([(0,t.M)()],v.prototype,"buttons",void 0),(0,q.e)([(0,t.M)()],v.prototype,"angularSensibility",void 0),Y.d.FreeCameraMouseInput=v;var G,x=b(2474);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new a.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(J){J=F.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=T=>{if(T.type!==P.d.POINTERWHEEL)return;const b=T.event,q=b.deltaMode===x.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*q*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*q*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*q*b.deltaZ/this._normalize,b.preventDefault&&(J||b.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,P.d.POINTERWHEEL)}Oi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,q.e)([(0,t.M)()],I.prototype,"wheelPrecisionX",void 0),(0,q.e)([(0,t.M)()],I.prototype,"wheelPrecisionY",void 0),(0,q.e)([(0,t.M)()],I.prototype,"wheelPrecisionZ",void 0),function(J){J[J.MoveRelative=0]="MoveRelative",J[J.RotateRelative=1]="RotateRelative",J[J.MoveScene=2]="MoveScene"}(G||(G={}));class u extends I{constructor(){super(...arguments),this._moveRelative=j.n.Zero(),this._rotateRelative=j.n.Zero(),this._moveScene=j.n.Zero(),this._wheelXAction=G.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=G.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(J){null===J&&this._wheelXAction!==G.MoveRelative||(this._wheelXAction=G.MoveRelative,this._wheelXActionCoordinate=J)}get wheelXMoveRelative(){return this._wheelXAction!==G.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(J){null===J&&this._wheelYAction!==G.MoveRelative||(this._wheelYAction=G.MoveRelative,this._wheelYActionCoordinate=J)}get wheelYMoveRelative(){return this._wheelYAction!==G.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(J){null===J&&this._wheelZAction!==G.MoveRelative||(this._wheelZAction=G.MoveRelative,this._wheelZActionCoordinate=J)}get wheelZMoveRelative(){return this._wheelZAction!==G.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(J){null===J&&this._wheelXAction!==G.RotateRelative||(this._wheelXAction=G.RotateRelative,this._wheelXActionCoordinate=J)}get wheelXRotateRelative(){return this._wheelXAction!==G.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(J){null===J&&this._wheelYAction!==G.RotateRelative||(this._wheelYAction=G.RotateRelative,this._wheelYActionCoordinate=J)}get wheelYRotateRelative(){return this._wheelYAction!==G.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(J){null===J&&this._wheelZAction!==G.RotateRelative||(this._wheelZAction=G.RotateRelative,this._wheelZActionCoordinate=J)}get wheelZRotateRelative(){return this._wheelZAction!==G.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(J){null===J&&this._wheelXAction!==G.MoveScene||(this._wheelXAction=G.MoveScene,this._wheelXActionCoordinate=J)}get wheelXMoveScene(){return this._wheelXAction!==G.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(J){null===J&&this._wheelYAction!==G.MoveScene||(this._wheelYAction=G.MoveScene,this._wheelYActionCoordinate=J)}get wheelYMoveScene(){return this._wheelYAction!==G.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(J){null===J&&this._wheelZAction!==G.MoveScene||(this._wheelZAction=G.MoveScene,this._wheelZActionCoordinate=J)}get wheelZMoveScene(){return this._wheelZAction!==G.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.oi(0),this._rotateRelative.oi(0),this._moveScene.oi(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const J=j.e.Zero();this.camera.getViewMatrix().invertToRef(J);const T=j.n.Zero();j.n.TransformNormalToRef(this._moveRelative,J,T),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(T),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(J,T,b){if(0===J)return;if(null===T||null===b)return;let q=null;switch(T){case G.MoveRelative:q=this._moveRelative;break;case G.RotateRelative:q=this._rotateRelative;break;case G.MoveScene:q=this._moveScene}switch(b){case 0:q.set(J,0,0);break;case 1:q.set(0,J,0);break;case 2:q.set(0,0,J)}}}(0,q.e)([(0,t.M)()],u.prototype,"wheelXMoveRelative",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelYMoveRelative",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelZMoveRelative",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelXRotateRelative",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelYRotateRelative",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelZRotateRelative",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelXMoveScene",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelYMoveScene",null),(0,q.e)([(0,t.M)()],u.prototype,"wheelZMoveScene",null),Y.d.FreeCameraMouseWheelInput=u;class U{constructor(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=J,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=F.e.IsSafari()}attachControl(J){J=F.e.BackCompatCameraNoPreventDefault(arguments);let T=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const q=b.event,t="mouse"===q.pointerType||this._isSafari&&"undefined"===typeof q.pointerType;if(this.allowMouse||!t)if(b.type===P.d.POINTERDOWN){if(J||q.preventDefault(),this._pointerPressed.push(q.pointerId),1!==this._pointerPressed.length)return;T={x:q.clientX,y:q.clientY}}else if(b.type===P.d.POINTERUP){J||q.preventDefault();const b=this._pointerPressed.indexOf(q.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;T=null,this._offsetX=null,this._offsetY=null}else if(b.type===P.d.POINTERMOVE){if(J||q.preventDefault(),!T)return;if(0!=this._pointerPressed.indexOf(q.pointerId))return;this._offsetX=q.clientX-T.x,this._offsetY=-(q.clientY-T.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE),this._onLostFocus){const J=this.camera.getEngine().getInputElement();J&&J.addEventListener("blur",this._onLostFocus)}}Oi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const J=this.camera.getEngine().getInputElement();J&&J.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const J=this.camera,T=J._calculateHandednessMultiplier();J.cameraRotation.y=T*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)J.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const T=J._computeLocalCameraSpeed(),b=new j.n(0,0,0!==this.touchMoveSensibility?T*this._offsetY/this.touchMoveSensibility:0);j.e.RotationYawPitchRollToRef(J.rotation.y,J.rotation.x,0,J._cameraRotationMatrix),J.cameraDirection.addInPlace(j.n.TransformCoordinates(b,J._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,q.e)([(0,t.M)()],U.prototype,"touchAngularSensibility",void 0),(0,q.e)([(0,t.M)()],U.prototype,"touchMoveSensibility",void 0),Y.d.FreeCameraTouchInput=U;class K extends Y.g{constructor(J){super(J),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new A),this}addMouse(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new v(J),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new u,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new U),this}clear(){super.clear(),this._mouseInput=null}}var E=b(639),l=b(581);class W extends B.b{get angularSensibility(){const J=this.inputs.attached.mouse;return J?J.angularSensibility:0}set angularSensibility(J){const T=this.inputs.attached.mouse;T&&(T.angularSensibility=J)}get keysUp(){const J=this.inputs.attached.keyboard;return J?J.keysUp:[]}set keysUp(J){const T=this.inputs.attached.keyboard;T&&(T.keysUp=J)}get keysUpward(){const J=this.inputs.attached.keyboard;return J?J.keysUpward:[]}set keysUpward(J){const T=this.inputs.attached.keyboard;T&&(T.keysUpward=J)}get keysDown(){const J=this.inputs.attached.keyboard;return J?J.keysDown:[]}set keysDown(J){const T=this.inputs.attached.keyboard;T&&(T.keysDown=J)}get keysDownward(){const J=this.inputs.attached.keyboard;return J?J.keysDownward:[]}set keysDownward(J){const T=this.inputs.attached.keyboard;T&&(T.keysDownward=J)}get keysLeft(){const J=this.inputs.attached.keyboard;return J?J.keysLeft:[]}set keysLeft(J){const T=this.inputs.attached.keyboard;T&&(T.keysLeft=J)}get keysRight(){const J=this.inputs.attached.keyboard;return J?J.keysRight:[]}set keysRight(J){const T=this.inputs.attached.keyboard;T&&(T.keysRight=J)}get keysRotateLeft(){const J=this.inputs.attached.keyboard;return J?J.keysRotateLeft:[]}set keysRotateLeft(J){const T=this.inputs.attached.keyboard;T&&(T.keysRotateLeft=J)}get keysRotateRight(){const J=this.inputs.attached.keyboard;return J?J.keysRotateRight:[]}set keysRotateRight(J){const T=this.inputs.attached.keyboard;T&&(T.keysRotateRight=J)}get keysRotateUp(){const J=this.inputs.attached.keyboard;return J?J.keysRotateUp:[]}set keysRotateUp(J){const T=this.inputs.attached.keyboard;T&&(T.keysRotateUp=J)}get keysRotateDown(){const J=this.inputs.attached.keyboard;return J?J.keysRotateDown:[]}set keysRotateDown(J){const T=this.inputs.attached.keyboard;T&&(T.keysRotateDown=J)}constructor(J,T,b){var q;super(J,T,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),q=this,this.ellipsoid=new j.n(.5,1,.5),this.ellipsoidOffset=new j.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=j.n.Zero(),this._diffPosition=j.n.Zero(),this._newPosition=j.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q._newPosition.p(T),q._newPosition.subtractToRef(q._oldPosition,q._diffPosition),q._diffPosition.length()>l.b.CollisionsEpsilon&&(q.position.addToRef(q._diffPosition,q._deferredPositionUpdate),q._deferOnly?q._deferredUpdated=!0:q.position.p(q._deferredPositionUpdate),q.Uh&&b&&q.Uh(b))},this.inputs=new K(this),this.inputs.addKeyboard().addMouse()}attachControl(J,T){T=F.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(T)}Oi(){this.inputs.detachElement(),this.cameraDirection=new j.n(0,0,0),this.cameraRotation=new j.k(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(J){this._collisionMask=isNaN(J)?-1:J}_collideWithWorld(J){let T;T=this.parent?j.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,T.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.va().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let q=J;this.applyGravity&&(q=J.add(this.va().gravity)),b.getNewPosition(this._oldPosition,q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=j.n.Zero(),this._transformedDirection=j.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(J){this._needMoveForGravity=J}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"cb"}}(0,q.e)([(0,t.I)()],W.prototype,"ellipsoid",void 0),(0,q.e)([(0,t.I)()],W.prototype,"ellipsoidOffset",void 0),(0,q.e)([(0,t.M)()],W.prototype,"checkCollisions",void 0),(0,q.e)([(0,t.M)()],W.prototype,"applyGravity",void 0),(0,E.g)("BABYLON.FreeCamera",W)},12465:(J,T,b)=>{"use strict";b.d(T,{b:()=>a});var q=b(674),t=b(680),j=b(670),B=b(697),Y=b(705),C=b(848);b(722).b.AddNodeConstructor("TargetCamera",((J,T)=>()=>new a(J,B.n.Zero(),T)));const F=B.e.Zero(),A=B.h.Identity();class a extends j.b{constructor(J,T,b){super(J,T,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new B.n(0,0,0),this.cameraRotation=new B.k(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=B.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=B.e.Zero(),this._cameraTransformMatrix=B.e.Zero(),this._cameraRotationMatrix=B.e.Zero(),this._transformedReferencePoint=B.n.Zero(),this._deferredPositionUpdate=new B.n,this._deferredRotationQuaternionUpdate=new B.h,this._deferredRotationUpdate=new B.n,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=B.n.Forward(this.va().useRightHandedSystem),this.rotation=new B.n(0,this.va().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(J){this.getWorldMatrix();const T=B.j.pi[0],b=B.j.pi[1];return b.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(b,T),T.scaleInPlace(J),this.globalPosition.add(T)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const J=this.lockedTarget;J.ti().getTranslationToRef(J.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.hi(0,0,0),this.cameraRotation.hi(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new B.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new B.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new B.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(J){J||super._updateCache();const T=this._getLockedTargetPosition();T?this._cache.lockedTarget?this._cache.lockedTarget.p(T):this._cache.lockedTarget=T.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const J=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(J):!J)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const J=this.getEngine();return this.speed*Math.sqrt(J.getDeltaTime()/(100*J.getFps()))}setTarget(J){this.upVector.normalize(),this._initialFocalDistance=J.Jg(this.position).length(),this.position.z===J.z&&(this.position.z+=Y.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.va().useRightHandedSystem?B.e.LookAtRHToRef(this.position,J,B.n.UpReadOnly,F):B.e.LookAtLHToRef(this.position,J,B.n.UpReadOnly,F),F.invert();const T=this.rotationQuaternion||A;B.h.FromRotationMatrixToRef(F,T),T.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(J){this.setTarget(J)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(B.j.Matrix[0]),B.n.TransformNormalToRef(this.cameraDirection,B.j.Matrix[0],B.j.pi[0]),this._deferredPositionUpdate.addInPlace(B.j.pi[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const J=this.invertRotation?-this.inverseRotationSpeed:1,T=this._decideIfNeedsToMove(),b=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),T&&this._updatePosition(),b){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*J,this._deferredRotationUpdate.y+=this.cameraRotation.y*J,!this.noRotationConstraint){const J=1.570796;this._deferredRotationUpdate.x>J&&(this._deferredRotationUpdate.x=J),this._deferredRotationUpdate.x<-J&&(this._deferredRotationUpdate.x=-J)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(B.h.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}T&&(Math.abs(this.cameraDirection.x)<this.speed*Y.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Y.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Y.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),b&&(Math.abs(this.cameraRotation.x)<this.speed*Y.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Y.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):B.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return B.n.TransformNormalToRef(B.n.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),B.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?C.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(B.h.FromEulerVectorToRef(this.rotation,A),C.d.Y.rotateByQuaternionToRef(A,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(J,T,b){if(this.va().useRightHandedSystem?B.e.LookAtRHToRef(J,T,b,this._viewMatrix):B.e.LookAtLHToRef(J,T,b,this._viewMatrix),this.parent){const J=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(J,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(J)}createRigCamera(J,T){if(this.cameraRigMode!==j.b.RIG_MODE_NONE){const T=new a(J,this.position.clone(),this.va());return T.isRigCamera=!0,T.rigParent=this,this.cameraRigMode===j.b.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new B.h),T._cameraRigParams={},T.rotationQuaternion=new B.h),T.mode=this.mode,T.orthoLeft=this.orthoLeft,T.orthoRight=this.orthoRight,T.orthoTop=this.orthoTop,T.orthoBottom=this.orthoBottom,T}return null}_updateRigCameras(){const J=this._rigCameras[0],T=this._rigCameras[1];switch(this.ti(),this.cameraRigMode){case j.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case j.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case j.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case j.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case j.b.RIG_MODE_STEREOSCOPIC_INTERLACED:{const b=this.cameraRigMode===j.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,q=this.cameraRigMode===j.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*b,J),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*q,T);break}case j.b.RIG_MODE_VR:J.rotationQuaternion?(J.rotationQuaternion.p(this.rotationQuaternion),T.rotationQuaternion.p(this.rotationQuaternion)):(J.rotation.p(this.rotation),T.rotation.p(this.rotation)),J.position.p(this.position),T.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(J,T){this.getTarget().subtractToRef(this.position,a._TargetFocalPoint),a._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const b=a._TargetFocalPoint.addInPlace(this.position);B.e.TranslationToRef(-b.x,-b.y,-b.z,a._TargetTransformMatrix),a._TargetTransformMatrix.multiplyToRef(B.e.RotationAxis(T.upVector,J),a._RigCamTransformMatrix),B.e.TranslationToRef(b.x,b.y,b.z,a._TargetTransformMatrix),a._RigCamTransformMatrix.multiplyToRef(a._TargetTransformMatrix,a._RigCamTransformMatrix),B.n.TransformCoordinatesToRef(this.position,a._RigCamTransformMatrix,T.position),T.setTarget(b)}getClassName(){return"TargetCamera"}}a._RigCamTransformMatrix=new B.e,a._TargetTransformMatrix=new B.e,a._TargetFocalPoint=new B.n,(0,q.e)([(0,t.M)()],a.prototype,"updateUpVectorFromRotation",void 0),(0,q.e)([(0,t.I)()],a.prototype,"rotation",void 0),(0,q.e)([(0,t.M)()],a.prototype,"speed",void 0),(0,q.e)([(0,t.y)("lockedTargetId")],a.prototype,"lockedTarget",void 0)},12918:(J,T,b)=>{"use strict";b.d(T,{b:()=>j});var q=b(689),t=b(12921);class j{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.il=[],this._maxBlockCapacity=T||64,this._selectionContent=new q.d(1024),this._creationFunc=J}update(J,T,b){t.d._CreateBlocks(J,T,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Yi(J){for(let T=0;T<this.Tk.length;T++){this.Tk[T].addEntry(J)}}_i(J){for(let T=0;T<this.Tk.length;T++){this.Tk[T].removeEntry(J)}}select(J,T){this._selectionContent.reset();for(let b=0;b<this.Tk.length;b++){this.Tk[b].select(J,this._selectionContent,T)}return T?this._selectionContent.concat(this.il):this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}intersects(J,T,b){this._selectionContent.reset();for(let q=0;q<this.Tk.length;q++){this.Tk[q].intersects(J,T,this._selectionContent,b)}return b?this._selectionContent.concat(this.il):this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}intersectsRay(J){this._selectionContent.reset();for(let T=0;T<this.Tk.length;T++){this.Tk[T].intersectsRay(J,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}}j.CreationFuncForMeshes=(J,T)=>{const b=J.getBoundingInfo();!J.isBlocked&&b.boundingBox.intersectsMinMax(T.kl,T.ll)&&T.entries.push(J)},j.CreationFuncForSubMeshes=(J,T)=>{J.getBoundingInfo().boundingBox.intersectsMinMax(T.kl,T.ll)&&T.entries.push(J)}},12921:(J,T,b)=>{"use strict";b.d(T,{d:()=>j});var q=b(697),t=b(794);class j{constructor(J,T,b,q,t,j){this.entries=[],this.ml=new Array,this._capacity=b,this._depth=q,this._maxDepth=t,this._creationFunc=j,this._minPoint=J,this._maxPoint=T,this.ml.push(J.clone()),this.ml.push(T.clone()),this.ml.push(J.clone()),this.ml[2].x=T.x,this.ml.push(J.clone()),this.ml[3].y=T.y,this.ml.push(J.clone()),this.ml[4].z=T.z,this.ml.push(T.clone()),this.ml[5].z=J.z,this.ml.push(T.clone()),this.ml[6].x=J.x,this.ml.push(T.clone()),this.ml[7].y=J.y}get Zh(){return this._capacity}get kl(){return this._minPoint}get ll(){return this._maxPoint}addEntry(J){if(this.Tk)for(let T=0;T<this.Tk.length;T++){this.Tk[T].addEntry(J)}else this._creationFunc(J,this),this.entries.length>this.Zh&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(J){if(this.Tk){for(let T=0;T<this.Tk.length;T++){this.Tk[T].removeEntry(J)}return}const T=this.entries.indexOf(J);T>-1&&this.entries.splice(T,1)}addEntries(J){for(let T=0;T<J.length;T++){const b=J[T];this.addEntry(b)}}select(J,T,b){if(t.c.IsInFrustum(this.ml,J)){if(this.Tk){for(let q=0;q<this.Tk.length;q++){this.Tk[q].select(J,T,b)}return}b?T.concat(this.entries):T.concatWithNoDuplicate(this.entries)}}intersects(J,T,b,q){if(t.c.IntersectsSphere(this._minPoint,this._maxPoint,J,T)){if(this.Tk){for(let t=0;t<this.Tk.length;t++){this.Tk[t].intersects(J,T,b,q)}return}q?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(J,T){if(J.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Tk){for(let b=0;b<this.Tk.length;b++){this.Tk[b].intersectsRay(J,T)}return}T.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){j._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(J,T,b,t,B,Y,C,F){C.Tk=new Array;const A=new q.n((T.x-J.x)/2,(T.y-J.y)/2,(T.z-J.z)/2);for(let q=0;q<2;q++)for(let T=0;T<2;T++)for(let a=0;a<2;a++){const P=J.add(A.multiplyByFloats(q,T,a)),v=J.add(A.multiplyByFloats(q+1,T+1,a+1)),G=new j(P,v,t,B+1,Y,F);G.addEntries(b),C.Tk.push(G)}}}},12930:(J,T,b)=>{"use strict";b.d(T,{d:()=>A});var q=b(2440),t=b(697),j=b(834),B=b(12176),Y=b(884),C=b(12918),F=b(550);q.b.prototype.createOrUpdateSelectionOctree=function(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(Y.e.NAME_OCTREE);b||(b=new A(this),this.bb(b)),this.gl||(this.gl=new C.b(C.b.CreationFuncForMeshes,J,T));const q=this.getWorldExtends();return this.gl.update(q.min,q.max,this.meshes),this.gl},Object.defineProperty(q.b.prototype,"selectionOctree",{get:function(){return this.gl},enumerable:!0,configurable:!0}),j.d.prototype.createOrUpdateSubmeshesOctree=function(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.va();let q=b._getComponent(Y.e.NAME_OCTREE);q||(q=new A(b),b.bb(q)),this._submeshesOctree||(this._submeshesOctree=new C.b(C.b.CreationFuncForSubMeshes,J,T)),this.ti(!0);const t=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(t.minimumWorld,t.maximumWorld,this.xi),this._submeshesOctree};class A{constructor(J){this.name=Y.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new B.b(t.n.Zero(),new t.n(1,1,1)),(J=J||F.e.LastCreatedScene)&&(this.cg=J,this.cg.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.cg.getActiveSubMeshCandidates=J=>this.getActiveSubMeshCandidates(J),this.cg.getCollidingSubMeshCandidates=(J,T)=>this.getCollidingSubMeshCandidates(J,T),this.cg.getIntersectingSubMeshCandidates=(J,T)=>this.getIntersectingSubMeshCandidates(J,T))}register(){this.cg.onMeshRemovedObservable.add((J=>{const T=this.cg.selectionOctree;if(void 0!==T&&null!==T){const b=T.il.indexOf(J);-1!==b&&T.il.splice(b,1)}})),this.cg.onMeshImportedObservable.add((J=>{const T=this.cg.selectionOctree;void 0!==T&&null!==T&&T.Yi(J)}))}getActiveMeshCandidates(){var J;return(null===(J=this.cg.gl)||void 0===J?void 0:J.select(this.cg.frustumPlanes))||this.cg._getDefaultMeshCandidates()}getActiveSubMeshCandidates(J){if(J._submeshesOctree&&J.useOctreeForRenderingSelection){return J._submeshesOctree.select(this.cg.frustumPlanes)}return this.cg._getDefaultSubMeshCandidates(J)}getIntersectingSubMeshCandidates(J,T){if(J._submeshesOctree&&J.useOctreeForPicking){B.b.TransformToRef(T,J.getWorldMatrix(),this._tempRay);return J._submeshesOctree.intersectsRay(this._tempRay)}return this.cg._getDefaultSubMeshCandidates(J)}getCollidingSubMeshCandidates(J,T){if(J._submeshesOctree&&J.useOctreeForCollisions){const b=T._velocityWorldLength+Math.max(T._radius.x,T._radius.y,T._radius.z);return J._submeshesOctree.intersects(T._basePointWorld,b)}return this.cg._getDefaultSubMeshCandidates(J)}rebuild(){}dispose(){}}},12176:(J,T,b)=>{"use strict";b.d(T,{b:()=>v});var q=b(2440),t=b(670),j=b(705),B=b(697),Y=b(711),C=b(781),F=b(841),A=b(550),a=b(2482);const P={internalPickerForMesh:void 0};class v{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.e;this.origin=J,this.direction=T,this.length=b,this.epsilon=q}clone(){return new v(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const q=v._TmpVector3[0].hi(J.x-b,J.y-b,J.z-b),t=v._TmpVector3[1].hi(T.x+b,T.y+b,T.z+b);let j,B,Y,C,F=0,A=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<q.x||this.origin.x>t.x)return!1}else if(j=1/this.direction.x,B=(q.x-this.origin.x)*j,Y=(t.x-this.origin.x)*j,Y===-1/0&&(Y=1/0),B>Y&&(C=B,B=Y,Y=C),F=Math.max(B,F),A=Math.min(Y,A),F>A)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<q.y||this.origin.y>t.y)return!1}else if(j=1/this.direction.y,B=(q.y-this.origin.y)*j,Y=(t.y-this.origin.y)*j,Y===-1/0&&(Y=1/0),B>Y&&(C=B,B=Y,Y=C),F=Math.max(B,F),A=Math.min(Y,A),F>A)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<q.z||this.origin.z>t.z)return!1}else if(j=1/this.direction.z,B=(q.z-this.origin.z)*j,Y=(t.z-this.origin.z)*j,Y===-1/0&&(Y=1/0),B>Y&&(C=B,B=Y,Y=C),F=Math.max(B,F),A=Math.min(Y,A),F>A)return!1;return!0}intersectsBox(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(J.minimum,J.maximum,T)}intersectsSphere(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=J.center.x-this.origin.x,q=J.center.y-this.origin.y,t=J.center.z-this.origin.z,j=b*b+q*q+t*t,B=J.radius+T,Y=B*B;if(j<=Y)return!0;const C=b*this.direction.x+q*this.direction.y+t*this.direction.z;if(C<0)return!1;return j-C*C<=Y}intersectsTriangle(J,T,b){const q=v._TmpVector3[0],t=v._TmpVector3[1],j=v._TmpVector3[2],Y=v._TmpVector3[3],F=v._TmpVector3[4];T.subtractToRef(J,q),b.subtractToRef(J,t),B.n.CrossToRef(this.direction,t,j);const A=B.n.Dot(q,j);if(0===A)return null;const a=1/A;this.origin.subtractToRef(J,Y);const P=B.n.Dot(Y,j)*a;if(P<-this.epsilon||P>1+this.epsilon)return null;B.n.CrossToRef(Y,q,F);const G=B.n.Dot(this.direction,F)*a;if(G<-this.epsilon||P+G>1+this.epsilon)return null;const x=B.n.Dot(t,F)*a;return x>this.length?null:new C.c(1-P-G,P,x)}intersectsPlane(J){let T;const b=B.n.Dot(J.Ti,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const q=B.n.Dot(J.Ti,this.origin);return T=(-J.d-q)/b,T<0?T<-9.99999997475243e-7?null:0:T}}intersectsAxis(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(J){case"y":{const J=(this.origin.y-T)/this.direction.y;return J>0?null:new B.n(this.origin.x+this.direction.x*-J,T,this.origin.z+this.direction.z*-J)}case"x":{const J=(this.origin.x-T)/this.direction.x;return J>0?null:new B.n(T,this.origin.y+this.direction.y*-J,this.origin.z+this.direction.z*-J)}case"z":{const J=(this.origin.z-T)/this.direction.z;return J>0?null:new B.n(this.origin.x+this.direction.x*-J,this.origin.y+this.direction.y*-J,T)}default:return null}}intersectsMesh(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=B.j.Matrix[0];return J.getWorldMatrix().invertToRef(Y),this._tmpRay?v.TransformToRef(this,Y,this._tmpRay):this._tmpRay=v.Transform(this,Y),J.intersects(this._tmpRay,T,b,q,t,j)}intersectsMeshes(J,T,b){b?b.length=0:b=[];for(let q=0;q<J.length;q++){const t=this.intersectsMesh(J[q],T);t.hit&&b.push(t)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(J,T){return J.distance<T.distance?-1:J.distance>T.distance?1:0}intersectionSegment(J,T,b){const q=this.origin,t=B.j.pi[0],j=B.j.pi[1],Y=B.j.pi[2],C=B.j.pi[3];T.subtractToRef(J,t),this.direction.scaleToRef(v._Rayl,Y),q.addToRef(Y,j),J.subtractToRef(q,C);const F=B.n.Dot(t,t),A=B.n.Dot(t,Y),a=B.n.Dot(Y,Y),P=B.n.Dot(t,C),G=B.n.Dot(Y,C),x=F*a-A*A;let I,u,U=x,K=x;x<v._Smallnum?(I=0,U=1,u=G,K=a):(I=A*G-a*P,u=F*G-A*P,I<0?(I=0,u=G,K=a):I>U&&(I=U,u=G+A,K=a)),u<0?(u=0,-P<0?I=0:-P>F?I=U:(I=-P,U=F)):u>K&&(u=K,-P+A<0?I=0:-P+A>F?I=U:(I=-P+A,U=F));const E=Math.abs(I)<v._Smallnum?0:I/U,l=Math.abs(u)<v._Smallnum?0:u/K,W=B.j.pi[4];Y.scaleToRef(l,W);const p=B.j.pi[5];t.scaleToRef(E,p),p.addInPlace(C);const o=B.j.pi[6];p.subtractToRef(W,o);return l>0&&l<=this.length&&o.lengthSquared()<b*b?p.length():-1}update(J,T,b,q,t,j,Y){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){v._RayDistant||(v._RayDistant=v.Zero()),v._RayDistant.unprojectRayToRef(J,T,b,q,B.e.IdentityReadOnly,j,Y);const C=B.j.Matrix[0];t.invertToRef(C),v.TransformToRef(v._RayDistant,C,this)}else this.unprojectRayToRef(J,T,b,q,t,j,Y);return this}static Zero(){return new v(B.n.Zero(),B.n.Zero())}static CreateNew(J,T,b,q,t,j,B){return v.Zero().update(J,T,b,q,t,j,B)}static CreateNewFromTo(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.e.IdentityReadOnly;const q=new v(new B.n(0,0,0),new B.n(0,0,0));return v.CreateFromToToRef(J,T,q,b)}static CreateFromToToRef(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.e.IdentityReadOnly;b.origin.p(J);const t=T.subtractToRef(J,b.direction),j=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return b.length=j,b.direction.normalize(),v.TransformToRef(b,q,b)}static Transform(J,T){const b=new v(new B.n(0,0,0),new B.n(0,0,0));return v.TransformToRef(J,T,b),b}static TransformToRef(J,T,b){B.n.TransformCoordinatesToRef(J.origin,T,b.origin),B.n.TransformNormalToRef(J.direction,T,b.direction),b.length=J.length,b.epsilon=J.epsilon;const q=b.direction,t=q.length();if(0!==t&&1!==t){const J=1/t;q.x*=J,q.y*=J,q.z*=J,b.length*=t}return b}unprojectRayToRef(J,T,b,q,t,j,Y){const C=B.j.Matrix[0];t.multiplyToRef(j,C),C.multiplyToRef(Y,C),C.invert();const F=A.e.LastCreatedEngine,a=B.j.pi[0];a.x=J/b*2-1,a.y=-(T/q*2-1),a.z=null!==F&&void 0!==F&&F.useReverseDepthBuffer?1:null!==F&&void 0!==F&&F.isNDCHalfZRange?0:-1;const P=B.j.pi[1].hi(a.x,a.y,1-1e-8),v=B.j.pi[2],G=B.j.pi[3];B.n._UnprojectFromInvertedMatrixToRef(a,C,v),B.n._UnprojectFromInvertedMatrixToRef(P,C,G),this.origin.p(v),G.subtractToRef(v,this.direction),this.direction.normalize()}}function G(J,T,b,q,t){let j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=v.Zero();return x(J,T,b,q,B,t,j),B}function x(J,T,b,q,t,j){let Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const F=J.getEngine();if(!j&&!(j=J.activeCamera))return J;const A=j.viewport,a=F.getRenderHeight(),{x:P,y:v,width:G,height:x}=A.toGlobal(F.getRenderWidth(),a),I=1/F.getHardwareScalingLevel();return T=T*I-P,b=b*I-(a-v-x),t.update(T,b,G,x,q||B.e.IdentityReadOnly,Y?B.e.IdentityReadOnly:j.getViewMatrix(),j.getProjectionMatrix(),C),J}function I(J,T,b,q,t){if(!F.d)return J;const j=J.getEngine();if(!t&&!(t=J.activeCamera))throw new Error("Active camera not set");const Y=t.viewport,C=j.getRenderHeight(),{x:A,y:a,width:P,height:v}=Y.toGlobal(j.getRenderWidth(),C),G=B.e.Identity(),x=1/j.getHardwareScalingLevel();return T=T*x-A,b=b*x-(C-a-v),q.update(T,b,P,v,G,G,t.getProjectionMatrix()),J}function u(J,T,b,q,t,j,B,Y){const C=T(q,b.enableDistantPicking),F=b.intersects(C,t,B,j,q,Y);return F&&F.hit?!t&&null!=J&&F.distance>=J.distance?null:F:null}function U(J,T,b,q,t,j){let Y=null;const C=!!(J.activeCameras&&J.activeCameras.length>1&&J.cameraToUseForPointers!==J.activeCamera),A=J.cameraToUseForPointers||J.activeCamera,a=P.internalPickerForMesh||u;for(let F=0;F<J.meshes.length;F++){const P=J.meshes[F];if(b){if(!b(P,-1))continue}else if(!P.isEnabled()||!P.isVisible||!P.Bi)continue;const v=C&&P.isWorldMatrixCameraDependent(),G=P.ti(v,A);if(P.hasThinInstances&&P.thinInstanceEnablePicking){const J=a(Y,T,P,G,!0,!0,j);if(J){if(t)return J;const C=B.j.Matrix[1],F=P.thinInstanceGetWorldMatrices();for(let J=0;J<F.length;J++){if(b&&!b(P,J))continue;F[J].multiplyToRef(G,C);const B=a(Y,T,P,C,q,t,j,!0);if(B&&(Y=B,Y.thinInstanceIndex=J,q))return Y}}}else{const J=a(Y,T,P,G,q,t,j);if(J&&(Y=J,q))return Y}}return Y||new F.d}function K(J,T,b,q){if(!F.d)return null;const t=[],j=!!(J.activeCameras&&J.activeCameras.length>1&&J.cameraToUseForPointers!==J.activeCamera),Y=J.cameraToUseForPointers||J.activeCamera,C=P.internalPickerForMesh||u;for(let F=0;F<J.meshes.length;F++){const A=J.meshes[F];if(b){if(!b(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.Bi)continue;const a=j&&A.isWorldMatrixCameraDependent(),P=A.ti(a,Y);if(A.hasThinInstances&&A.thinInstanceEnablePicking){if(C(null,T,A,P,!0,!0,q)){const J=B.j.Matrix[1],j=A.thinInstanceGetWorldMatrices();for(let B=0;B<j.length;B++){if(b&&!b(A,B))continue;j[B].multiplyToRef(P,J);const Y=C(null,T,A,J,!1,!1,q,!0);Y&&(Y.thinInstanceIndex=B,t.push(Y))}}}else{const J=C(null,T,A,P,!1,!1,q);J&&t.push(J)}}return t}function E(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,q=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;q||(q=J.getWorldMatrix()),T.length=b,t?T.origin.p(t):T.origin.p(J.position);const j=B.j.pi[2];j.set(0,0,J._scene.useRightHandedSystem?-1:1);const Y=B.j.pi[3];return B.n.TransformNormalToRef(j,q,Y),B.n.NormalizeToRef(Y,T.direction),T}var l,W;v._TmpVector3=(0,Y.b)(6,B.n.Zero),v._RayDistant=v.Zero(),v._Smallnum=1e-8,v._Rayl=1e9,l=q.b,(W=t.b)&&(W.prototype.getForwardRay=function(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,T=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return E(this,new v(B.n.Zero(),B.n.Zero(),J),J,T,b)},W.prototype.getForwardRayToRef=function(J){return E(this,J,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),l&&(a.e._IsPickingAvailable=!0,l.prototype.createPickingRay=function(J,T,b,q){return G(this,J,T,b,q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),q.b.prototype.createPickingRayToRef=function(J,T,b,q,t){return x(this,J,T,b,q,t,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},q.b.prototype.createPickingRayInCameraSpace=function(J,T,b){return function(J,T,b,q){const t=v.Zero();return I(J,T,b,t,q),t}(this,J,T,b)},q.b.prototype.createPickingRayInCameraSpaceToRef=function(J,T,b,q){return I(this,J,T,b,q)},q.b.prototype.pickWithBoundingInfo=function(J,T,b,q,t){return function(J,T,b,q,t,j){if(!F.d)return null;const Y=U(J,(q=>(J._tempPickingRay||(J._tempPickingRay=v.Zero()),x(J,T,b,q,J._tempPickingRay,j||null),J._tempPickingRay)),q,t,!0);return Y&&(Y.ray=G(J,T,b,B.e.Identity(),j||null)),Y}(this,J,T,b,q,t)},q.b.prototype.Mk=function(J,T,b,q,t,j){return function(J,T,b,q,t,j,Y){const C=U(J,((q,t)=>(J._tempPickingRay||(J._tempPickingRay=v.Zero()),x(J,T,b,q,J._tempPickingRay,j||null,!1,t),J._tempPickingRay)),q,t,!1,Y);return C&&(C.ray=G(J,T,b,B.e.Identity(),j||null)),C}(this,J,T,b,q,t,j)},q.b.prototype.pickWithRay=function(J,T,b,q){return function(J,T,b,q,t){const j=U(J,(b=>(J._pickWithRayInverseMatrix||(J._pickWithRayInverseMatrix=B.e.Identity()),b.invertToRef(J._pickWithRayInverseMatrix),J._cachedRayForTransform||(J._cachedRayForTransform=v.Zero()),v.TransformToRef(T,J._pickWithRayInverseMatrix,J._cachedRayForTransform),J._cachedRayForTransform)),b,q,!1,t);return j&&(j.ray=T),j}(this,J,T,b,q)},q.b.prototype.multiPick=function(J,T,b,q,t){return function(J,T,b,q,t,j){return K(J,(q=>G(J,T,b,q,t||null)),q,j)}(this,J,T,b,q,t)},q.b.prototype.multiPickWithRay=function(J,T,b){return function(J,T,b,q){return K(J,(b=>(J._pickWithRayInverseMatrix||(J._pickWithRayInverseMatrix=B.e.Identity()),b.invertToRef(J._pickWithRayInverseMatrix),J._cachedRayForTransform||(J._cachedRayForTransform=v.Zero()),v.TransformToRef(T,J._pickWithRayInverseMatrix,J._cachedRayForTransform),J._cachedRayForTransform)),b,q)}(this,J,T,b)}},2414:(J,T,b)=>{"use strict";var q=b(615),t=b(519),j=b(556),B=b(644),Y=b(581),C=b(632);Y.b.prototype._partialLoadFile=function(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(J,(J=>{b[T]=J,b._internalCount++,6===b._internalCount&&q(b)}),void 0,void 0,!0,((J,T)=>{t&&J&&t(J.status+" "+J.statusText,T)}))},Y.b.prototype._cascadeLoadFiles=function(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=[];t._internalCount=0;for(let j=0;j<6;j++)this._partialLoadFile(b[j],j,t,T,q)},Y.b.prototype._cascadeLoadImgs=function(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5?arguments[5]:void 0;const B=[];B._internalCount=0;for(let Y=0;Y<6;Y++)this._partialLoadImg(q[Y],Y,B,J,T,b,t,j)},Y.b.prototype._partialLoadImg=function(J,T,b,q,t,Y){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7?arguments[7]:void 0;const A=(0,B.e)();(0,j.o)(J,(J=>{b[T]=J,b._internalCount++,q&&q.removePendingData(A),6===b._internalCount&&Y&&Y(t,b)}),((J,T)=>{q&&q.removePendingData(A),C&&C(J,T)}),q?q.offlineProvider:null,F),q&&q.addPendingData(A)},Y.b.prototype.createCubeTextureBase=function(J,T,b,j){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8],P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,u=arguments.length>14&&void 0!==arguments[14]&&arguments[14],U=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const K=G||new q.d(this,7);K.isCube=!0,K.url=J,K.generateMipMaps=!j,K._lodGenerationScale=P,K._lodGenerationOffset=v,K._useSRGBBuffer=!!u&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!j),K!==G&&(K.label=J.substring(0,60)),this._doNotHandleContextLost||(K._extension=A,K._files=b,K._buffer=U);const E=J;this._transformTextureUrl&&!G&&(J=this._transformTextureUrl(J));const l=A??function(J){const T=J.split("?")[0],b=T.lastIndexOf(".");return b>-1?T.substring(b).toLowerCase():""}(J),W=(0,C.c)(l),p=(J,T)=>{K.dispose(),Y?Y(J,T):J&&t.d.Warn(J)},o=(q,Y)=>{J===E?q&&p(q.status+" "+q.statusText,Y):(t.d.Warn(`Failed to load ${J}, falling back to the ${E}`),this.createCubeTextureBase(E,T,b,!!j,B,p,F,A,a,P,v,K,x,I,u,U))};if(W)W.then((q=>{const t=J=>{x&&x(K,J),q.loadCubeData(J,K,a,B,((J,T)=>{p(J,T)}))};U?t(U):b&&6===b.length?q.supportCascades?this._cascadeLoadFiles(T,(J=>t(J.map((J=>new Uint8Array(J))))),b,p):p("Textures type does not support cascades."):this._loadFile(J,(J=>t(new Uint8Array(J))),void 0,void 0,!0,o)}));else{if(!b||0===b.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(T,K,((J,T)=>{I&&I(J,T)}),b,p)}return this._internalTexturesCache.push(K),K}},12518:(J,T,b)=>{"use strict";b.d(T,{e:()=>q});class q{}q.AUTOSAMPLERSUFFIX="Sampler",q.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",q.ALPHA_DISABLE=0,q.ALPHA_ADD=1,q.ALPHA_COMBINE=2,q.ALPHA_SUBTRACT=3,q.ALPHA_MULTIPLY=4,q.ALPHA_MAXIMIZED=5,q.ALPHA_ONEONE=6,q.ALPHA_PREMULTIPLIED=7,q.ALPHA_PREMULTIPLIED_PORTERDUFF=8,q.ALPHA_INTERPOLATE=9,q.ALPHA_SCREENMODE=10,q.ALPHA_ONEONE_ONEONE=11,q.ALPHA_ALPHATOCOLOR=12,q.ALPHA_REVERSEONEMINUS=13,q.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,q.ALPHA_ONEONE_ONEZERO=15,q.ALPHA_EXCLUSION=16,q.ALPHA_LAYER_ACCUMULATE=17,q.ALPHA_EQUATION_ADD=0,q.ALPHA_EQUATION_SUBSTRACT=1,q.ALPHA_EQUATION_REVERSE_SUBTRACT=2,q.ALPHA_EQUATION_MAX=3,q.ALPHA_EQUATION_MIN=4,q.ALPHA_EQUATION_DARKEN=5,q.DELAYLOADSTATE_NONE=0,q.DELAYLOADSTATE_LOADED=1,q.DELAYLOADSTATE_LOADING=2,q.DELAYLOADSTATE_NOTLOADED=4,q.NEVER=512,q.ALWAYS=519,q.LESS=513,q.EQUAL=514,q.LEQUAL=515,q.GREATER=516,q.GEQUAL=518,q.NOTEQUAL=517,q.KEEP=7680,q.ZERO=0,q.REPLACE=7681,q.INCR=7682,q.DECR=7683,q.INVERT=5386,q.INCR_WRAP=34055,q.DECR_WRAP=34056,q.TEXTURE_CLAMP_ADDRESSMODE=0,q.TEXTURE_WRAP_ADDRESSMODE=1,q.TEXTURE_MIRROR_ADDRESSMODE=2,q.TEXTURE_CREATIONFLAG_STORAGE=1,q.TEXTUREFORMAT_ALPHA=0,q.TEXTUREFORMAT_LUMINANCE=1,q.TEXTUREFORMAT_LUMINANCE_ALPHA=2,q.TEXTUREFORMAT_RGB=4,q.TEXTUREFORMAT_RGBA=5,q.TEXTUREFORMAT_RED=6,q.TEXTUREFORMAT_R=6,q.TEXTUREFORMAT_R16_UNORM=33322,q.TEXTUREFORMAT_RG16_UNORM=33324,q.TEXTUREFORMAT_RGB16_UNORM=32852,q.TEXTUREFORMAT_RGBA16_UNORM=32859,q.TEXTUREFORMAT_R16_SNORM=36760,q.TEXTUREFORMAT_RG16_SNORM=36761,q.TEXTUREFORMAT_RGB16_SNORM=36762,q.TEXTUREFORMAT_RGBA16_SNORM=36763,q.TEXTUREFORMAT_RG=7,q.TEXTUREFORMAT_RED_INTEGER=8,q.TEXTUREFORMAT_R_INTEGER=8,q.TEXTUREFORMAT_RG_INTEGER=9,q.TEXTUREFORMAT_RGB_INTEGER=10,q.TEXTUREFORMAT_RGBA_INTEGER=11,q.TEXTUREFORMAT_BGRA=12,q.TEXTUREFORMAT_DEPTH24_STENCIL8=13,q.TEXTUREFORMAT_DEPTH32_FLOAT=14,q.TEXTUREFORMAT_DEPTH16=15,q.TEXTUREFORMAT_DEPTH24=16,q.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,q.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,q.TEXTUREFORMAT_STENCIL8=19,q.TEXTUREFORMAT_UNDEFINED=4294967295,q.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,q.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,q.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,q.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,q.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,q.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,q.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,q.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,q.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,q.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,q.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,q.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,q.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,q.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,q.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,q.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,q.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,q.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,q.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,q.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,q.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,q.TEXTURETYPE_UNSIGNED_BYTE=0,q.TEXTURETYPE_UNSIGNED_INT=0,q.TEXTURETYPE_FLOAT=1,q.TEXTURETYPE_HALF_FLOAT=2,q.TEXTURETYPE_BYTE=3,q.TEXTURETYPE_SHORT=4,q.TEXTURETYPE_UNSIGNED_SHORT=5,q.TEXTURETYPE_INT=6,q.TEXTURETYPE_UNSIGNED_INTEGER=7,q.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,q.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,q.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,q.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,q.TEXTURETYPE_UNSIGNED_INT_24_8=12,q.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,q.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,q.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,q.TEXTURETYPE_UNDEFINED=16,q.TEXTURE_2D=3553,q.TEXTURE_2D_ARRAY=35866,q.TEXTURE_CUBE_MAP=34067,q.TEXTURE_CUBE_MAP_ARRAY=3735928559,q.TEXTURE_3D=32879,q.TEXTURE_NEAREST_SAMPLINGMODE=1,q.TEXTURE_NEAREST_NEAREST=1,q.TEXTURE_BILINEAR_SAMPLINGMODE=2,q.TEXTURE_LINEAR_LINEAR=2,q.TEXTURE_TRILINEAR_SAMPLINGMODE=3,q.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,q.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,q.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,q.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,q.TEXTURE_NEAREST_LINEAR=7,q.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,q.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,q.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,q.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,q.TEXTURE_LINEAR_NEAREST=12,q.TEXTURE_EXPLICIT_MODE=0,q.TEXTURE_SPHERICAL_MODE=1,q.TEXTURE_PLANAR_MODE=2,q.TEXTURE_CUBIC_MODE=3,q.TEXTURE_PROJECTION_MODE=4,q.TEXTURE_SKYBOX_MODE=5,q.TEXTURE_INVCUBIC_MODE=6,q.TEXTURE_EQUIRECTANGULAR_MODE=7,q.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,q.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,q.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,q.TEXTURE_FILTERING_QUALITY_HIGH=64,q.TEXTURE_FILTERING_QUALITY_MEDIUM=16,q.TEXTURE_FILTERING_QUALITY_LOW=8,q.SCALEMODE_FLOOR=1,q.SCALEMODE_NEAREST=2,q.SCALEMODE_CEILING=3,q.MATERIAL_TextureDirtyFlag=1,q.MATERIAL_LightDirtyFlag=2,q.MATERIAL_FresnelDirtyFlag=4,q.MATERIAL_AttributesDirtyFlag=8,q.MATERIAL_MiscDirtyFlag=16,q.MATERIAL_PrePassDirtyFlag=32,q.MATERIAL_ImageProcessingDirtyFlag=64,q.MATERIAL_AllDirtyFlag=127,q.MATERIAL_TriangleFillMode=0,q.MATERIAL_WireFrameFillMode=1,q.MATERIAL_PointFillMode=2,q.MATERIAL_PointListDrawMode=3,q.MATERIAL_LineListDrawMode=4,q.MATERIAL_LineLoopDrawMode=5,q.MATERIAL_LineStripDrawMode=6,q.MATERIAL_TriangleStripDrawMode=7,q.MATERIAL_TriangleFanDrawMode=8,q.MATERIAL_ClockWiseSideOrientation=0,q.MATERIAL_CounterClockWiseSideOrientation=1,q.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,q.MATERIAL_DIFFUSE_MODEL_BURLEY=1,q.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,q.MATERIAL_DIFFUSE_MODEL_LEGACY=3,q.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,q.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,q.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,q.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,q.ACTION_NothingTrigger=0,q.ACTION_OnPickTrigger=1,q.ACTION_OnLeftPickTrigger=2,q.ACTION_OnRightPickTrigger=3,q.ACTION_OnCenterPickTrigger=4,q.ACTION_OnPickDownTrigger=5,q.ACTION_OnDoublePickTrigger=6,q.ACTION_OnPickUpTrigger=7,q.ACTION_OnPickOutTrigger=16,q.ACTION_OnLongPressTrigger=8,q.ACTION_OnPointerOverTrigger=9,q.ACTION_OnPointerOutTrigger=10,q.ACTION_OnEveryFrameTrigger=11,q.ACTION_OnIntersectionEnterTrigger=12,q.ACTION_OnIntersectionExitTrigger=13,q.ACTION_OnKeyDownTrigger=14,q.ACTION_OnKeyUpTrigger=15,q.PARTICLES_BILLBOARDMODE_Y=2,q.PARTICLES_BILLBOARDMODE_ALL=7,q.PARTICLES_BILLBOARDMODE_STRETCHED=8,q.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,q.MESHES_CULLINGSTRATEGY_STANDARD=0,q.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,q.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,q.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,q.SCENELOADER_NO_LOGGING=0,q.SCENELOADER_MINIMAL_LOGGING=1,q.SCENELOADER_SUMMARY_LOGGING=2,q.SCENELOADER_DETAILED_LOGGING=3,q.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,q.PREPASS_POSITION_TEXTURE_TYPE=1,q.PREPASS_VELOCITY_TEXTURE_TYPE=2,q.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,q.PREPASS_COLOR_TEXTURE_TYPE=4,q.PREPASS_DEPTH_TEXTURE_TYPE=5,q.PREPASS_NORMAL_TEXTURE_TYPE=6,q.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,q.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,q.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,q.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,q.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,q.PREPASS_ALBEDO_TEXTURE_TYPE=12,q.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,q.BUFFER_CREATIONFLAG_READ=1,q.BUFFER_CREATIONFLAG_WRITE=2,q.BUFFER_CREATIONFLAG_READWRITE=3,q.BUFFER_CREATIONFLAG_UNIFORM=4,q.BUFFER_CREATIONFLAG_VERTEX=8,q.BUFFER_CREATIONFLAG_INDEX=16,q.BUFFER_CREATIONFLAG_STORAGE=32,q.BUFFER_CREATIONFLAG_INDIRECT=64,q.RENDERPASS_MAIN=0,q.INPUT_ALT_KEY=18,q.INPUT_CTRL_KEY=17,q.INPUT_META_KEY1=91,q.INPUT_META_KEY2=92,q.INPUT_META_KEY3=93,q.INPUT_SHIFT_KEY=16,q.SNAPSHOTRENDERING_STANDARD=0,q.SNAPSHOTRENDERING_FAST=1,q.PERSPECTIVE_CAMERA=0,q.ORTHOGRAPHIC_CAMERA=1,q.FOVMODE_VERTICAL_FIXED=0,q.FOVMODE_HORIZONTAL_FIXED=1,q.RIG_MODE_NONE=0,q.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,q.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,q.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,q.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,q.RIG_MODE_STEREOSCOPIC_INTERLACED=14,q.RIG_MODE_VR=20,q.RIG_MODE_CUSTOM=22,q.MAX_SUPPORTED_UV_SETS=6,q.GL_ALPHA_EQUATION_ADD=32774,q.GL_ALPHA_EQUATION_MIN=32775,q.GL_ALPHA_EQUATION_MAX=32776,q.GL_ALPHA_EQUATION_SUBTRACT=32778,q.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,q.GL_ALPHA_FUNCTION_SRC=768,q.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,q.GL_ALPHA_FUNCTION_SRC_ALPHA=770,q.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,q.GL_ALPHA_FUNCTION_DST_ALPHA=772,q.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,q.GL_ALPHA_FUNCTION_DST_COLOR=774,q.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,q.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,q.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,q.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,q.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,q.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,q.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,q.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,q.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,q.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,q.SnippetUrl="https://snippet.babylonjs.com",q.FOGMODE_NONE=0,q.FOGMODE_EXP=1,q.FOGMODE_EXP2=2,q.FOGMODE_LINEAR=3,q.BYTE=5120,q.UNSIGNED_BYTE=5121,q.SHORT=5122,q.UNSIGNED_SHORT=5123,q.INT=5124,q.UNSIGNED_INT=5125,q.FLOAT=5126,q.PositionKind="position",q.NormalKind="Ti",q.TangentKind="tangent",q.UVKind="uv",q.UV2Kind="uv2",q.UV3Kind="uv3",q.UV4Kind="uv4",q.UV5Kind="uv5",q.UV6Kind="uv6",q.ColorKind="color",q.ColorInstanceKind="instanceColor",q.MatricesIndicesKind="matricesIndices",q.MatricesWeightsKind="matricesWeights",q.MatricesIndicesExtraKind="matricesIndicesExtra",q.MatricesWeightsExtraKind="matricesWeightsExtra",q.ANIMATIONTYPE_FLOAT=0,q.ANIMATIONTYPE_VECTOR3=1,q.ANIMATIONTYPE_QUATERNION=2,q.ANIMATIONTYPE_MATRIX=3,q.ANIMATIONTYPE_COLOR3=4,q.ANIMATIONTYPE_COLOR4=7,q.ANIMATIONTYPE_VECTOR2=5,q.ANIMATIONTYPE_SIZE=6,q.ShadowMinZ=0,q.ShadowMaxZ=1e4},12939:(J,T,b)=>{"use strict";b(519);var q=b(2351);b(615),b(758),b(607),b(2392),b(2362);q.b},12598:(J,T,b)=>{"use strict";b.d(T,{e:()=>t});var q=b(639);class t{constructor(J){this.value=this._toInt(J)}_toInt(J){return 0|J}add(J){return new t(this.value+J.value)}Jg(J){return new t(this.value-J.value)}multiply(J){return new t(Math.imul(this.value,J.value))}divide(J){return new t(this.value/J.value)}getClassName(){return t.ClassName}equals(J){return this.value===J.value}static FromValue(J){return new t(J)}toString(){return this.value.toString()}}t.ClassName="FlowGraphInteger",(0,q.g)("FlowGraphInteger",t)},12606:(J,T,b)=>{"use strict";b.d(T,{b:()=>t,f:()=>j});var q=b(697);class t{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Mi=J}get m(){return this.Mi}transformVector(J){return this.transformVectorToRef(J,new q.k)}transformVectorToRef(J,T){return T.x=J.x*this.Mi[0]+J.y*this.Mi[1],T.y=J.x*this.Mi[2]+J.y*this.Mi[3],T}Ai(){return this.toArray()}toArray(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let T=0;T<4;T++)J[T]=this.Mi[T];return J}Ri(J){for(let T=0;T<4;T++)this.Mi[T]=J[T];return this}multiplyToRef(J,T){const b=J.Mi,q=this.Mi,t=T.Mi;return t[0]=b[0]*q[0]+b[1]*q[2],t[1]=b[0]*q[1]+b[1]*q[3],t[2]=b[2]*q[0]+b[3]*q[2],t[3]=b[2]*q[1]+b[3]*q[3],T}multiply(J){return this.multiplyToRef(J,new t)}divideToRef(J,T){const b=this.Mi,q=J.Mi,t=T.Mi;return t[0]=b[0]/q[0],t[1]=b[1]/q[1],t[2]=b[2]/q[2],t[3]=b[3]/q[3],T}divide(J){return this.divideToRef(J,new t)}addToRef(J,T){const b=this.Mi,q=J.m,t=T.m;return t[0]=b[0]+q[0],t[1]=b[1]+q[1],t[2]=b[2]+q[2],t[3]=b[3]+q[3],T}add(J){return this.addToRef(J,new t)}subtractToRef(J,T){const b=this.Mi,q=J.m,t=T.m;return t[0]=b[0]-q[0],t[1]=b[1]-q[1],t[2]=b[2]-q[2],t[3]=b[3]-q[3],T}Jg(J){return this.subtractToRef(J,new t)}transpose(){const J=this.Mi;return new t([J[0],J[2],J[1],J[3]])}determinant(){const J=this.Mi;return J[0]*J[3]-J[1]*J[2]}inverse(){const J=this.determinant();if(0===J)throw new Error("Matrix is not invertible");const T=this.Mi,b=1/J;return new t([T[3]*b,-T[1]*b,-T[2]*b,T[0]*b])}equals(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.Mi,q=J.m;return 0===T?b[0]===q[0]&&b[1]===q[1]&&b[2]===q[2]&&b[3]===q[3]:Math.abs(b[0]-q[0])<T&&Math.abs(b[1]-q[1])<T&&Math.abs(b[2]-q[2])<T&&Math.abs(b[3]-q[3])<T}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Mi.join(", ")})`}}class j{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Mi=J}get m(){return this.Mi}transformVector(J){return this.transformVectorToRef(J,new q.n)}transformVectorToRef(J,T){const b=this.Mi;return T.x=J.x*b[0]+J.y*b[1]+J.z*b[2],T.y=J.x*b[3]+J.y*b[4]+J.z*b[5],T.z=J.x*b[6]+J.y*b[7]+J.z*b[8],T}multiplyToRef(J,T){const b=J.Mi,q=this.Mi,t=T.m;return t[0]=b[0]*q[0]+b[1]*q[3]+b[2]*q[6],t[1]=b[0]*q[1]+b[1]*q[4]+b[2]*q[7],t[2]=b[0]*q[2]+b[1]*q[5]+b[2]*q[8],t[3]=b[3]*q[0]+b[4]*q[3]+b[5]*q[6],t[4]=b[3]*q[1]+b[4]*q[4]+b[5]*q[7],t[5]=b[3]*q[2]+b[4]*q[5]+b[5]*q[8],t[6]=b[6]*q[0]+b[7]*q[3]+b[8]*q[6],t[7]=b[6]*q[1]+b[7]*q[4]+b[8]*q[7],t[8]=b[6]*q[2]+b[7]*q[5]+b[8]*q[8],T}multiply(J){return this.multiplyToRef(J,new j)}divideToRef(J,T){const b=this.Mi,q=J.m,t=T.m;return t[0]=b[0]/q[0],t[1]=b[1]/q[1],t[2]=b[2]/q[2],t[3]=b[3]/q[3],t[4]=b[4]/q[4],t[5]=b[5]/q[5],t[6]=b[6]/q[6],t[7]=b[7]/q[7],t[8]=b[8]/q[8],T}divide(J){return this.divideToRef(J,new j)}addToRef(J,T){const b=this.Mi,q=J.m,t=T.m;return t[0]=b[0]+q[0],t[1]=b[1]+q[1],t[2]=b[2]+q[2],t[3]=b[3]+q[3],t[4]=b[4]+q[4],t[5]=b[5]+q[5],t[6]=b[6]+q[6],t[7]=b[7]+q[7],t[8]=b[8]+q[8],T}add(J){return this.addToRef(J,new j)}subtractToRef(J,T){const b=this.Mi,q=J.m,t=T.m;return t[0]=b[0]-q[0],t[1]=b[1]-q[1],t[2]=b[2]-q[2],t[3]=b[3]-q[3],t[4]=b[4]-q[4],t[5]=b[5]-q[5],t[6]=b[6]-q[6],t[7]=b[7]-q[7],t[8]=b[8]-q[8],T}Jg(J){return this.subtractToRef(J,new j)}toArray(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let T=0;T<9;T++)J[T]=this.Mi[T];return J}Ai(){return this.toArray()}Ri(J){for(let T=0;T<9;T++)this.Mi[T]=J[T];return this}transpose(){const J=this.Mi;return new j([J[0],J[3],J[6],J[1],J[4],J[7],J[2],J[5],J[8]])}determinant(){const J=this.Mi;return J[0]*(J[4]*J[8]-J[5]*J[7])-J[1]*(J[3]*J[8]-J[5]*J[6])+J[2]*(J[3]*J[7]-J[4]*J[6])}inverse(){const J=this.determinant();if(0===J)throw new Error("Matrix is not invertible");const T=this.Mi,b=1/J;return new j([(T[4]*T[8]-T[5]*T[7])*b,(T[2]*T[7]-T[1]*T[8])*b,(T[1]*T[5]-T[2]*T[4])*b,(T[5]*T[6]-T[3]*T[8])*b,(T[0]*T[8]-T[2]*T[6])*b,(T[2]*T[3]-T[0]*T[5])*b,(T[3]*T[7]-T[4]*T[6])*b,(T[1]*T[6]-T[0]*T[7])*b,(T[0]*T[4]-T[1]*T[3])*b])}equals(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.Mi,q=J.m;return 0===T?b[0]===q[0]&&b[1]===q[1]&&b[2]===q[2]&&b[3]===q[3]&&b[4]===q[4]&&b[5]===q[5]&&b[6]===q[6]&&b[7]===q[7]&&b[8]===q[8]:Math.abs(b[0]-q[0])<T&&Math.abs(b[1]-q[1])<T&&Math.abs(b[2]-q[2])<T&&Math.abs(b[3]-q[3])<T&&Math.abs(b[4]-q[4])<T&&Math.abs(b[5]-q[5])<T&&Math.abs(b[6]-q[6])<T&&Math.abs(b[7]-q[7])<T&&Math.abs(b[8]-q[8])<T}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Mi.join(", ")})`}}},12615:(J,T,b)=>{"use strict";var q;function t(J,T,b,q){switch(T){case"Animation":return q?J.animations.find((J=>J.uniqueId===b))??null:J.animations[b]??null;case"AnimationGroup":return q?J.animationGroups.find((J=>J.uniqueId===b))??null:J.animationGroups[b]??null;case"Mesh":return q?J.meshes.find((J=>J.uniqueId===b))??null:J.meshes[b]??null;case"Material":return q?J.materials.find((J=>J.uniqueId===b))??null:J.materials[b]??null;case"Ni":return q?J.cameras.find((J=>J.uniqueId===b))??null:J.cameras[b]??null;case"Light":return q?J.lights.find((J=>J.uniqueId===b))??null:J.lights[b]??null;default:return null}}b.d(T,{b:()=>t}),function(J){J.Animation="Animation",J.AnimationGroup="AnimationGroup",J.Mesh="Mesh",J.Material="Material",J.Ni="Ni",J.Light="Light"}(q||(q={}))},12644:(J,T,b)=>{"use strict";b.d(T,{b:()=>t});var q=b(12647);class t extends q.c{constructor(J,T){if(super(J),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),T)for(const b of T)this._eventsSignalOutputs[b]=this._registerSignalOutput(b+"Event")}_executeOnTick(J){}_startPendingTasks(J){J._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(J),this._resetAfterCanceled(J)),this._preparePendingTasks(J),J._addPendingBlock(this),this.out._activateSignal(J),J._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(J){J._deleteExecutionVariable(this,"_initialized"),J._removePendingBlock(this)}}},12627:(J,T,b)=>{"use strict";b.d(T,{b:()=>F});var q=b(644),t=b(639),j=b(12630),B=b(497),Y=b(12591);class C extends j.d{constructor(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q.defaultValue,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(J,T,b),this.richType=q,this._defaultValue=t,this._optional=j,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new B.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(J){this._isDisabled!==J&&(this._isDisabled=J,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(J,T){T._getConnectionValue(this)!==J&&(T._setConnectionValue(this,J),this.onValueChangedObservable.notifyObservers(J))}resetToDefaultValue(J){J._setConnectionValue(this,this._defaultValue)}connectTo(J){this._isDisabled||super.connectTo(J)}_getValueOrDefault(J){const T=J._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(T):T}getValue(J){if(1===this.connectionType){J._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(J);const T=this._getValueOrDefault(J);return this._lastValue=T,this.richType.typeTransformer?this.richType.typeTransformer(T):T}const T=this.isConnected()?this._connectedPoint[0].getValue(J):this._getValueOrDefault(J);return this._lastValue=T,this.richType.typeTransformer?this.richType.typeTransformer(T):T}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(J),J.richType={},this.richType.serialize(J.richType),J.optional=this._optional,(0,Y.g)("defaultValue",this._defaultValue,J)}}(0,t.g)("FlowGraphDataConnection",C);class F{constructor(J){var T;this.config=J,this.uniqueId=(0,q.e)(),this.name=(null===(T=this.config)||void 0===T?void 0:T.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(J){}registerDataInput(J,T,b){const q=new C(J,0,this,T,b);return this.dataInputs.push(q),q}registerDataOutput(J,T,b){const q=new C(J,1,this,T,b);return this.dataOutputs.push(q),q}getDataInput(J){return this.dataInputs.find((T=>T.name===J))}getDataOutput(J){return this.dataOutputs.find((T=>T.name===J))}serialize(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y.g;if(J.uniqueId=this.uniqueId,J.config={},this.config){const b=this.config,q=Object.keys(b);for(const t of q)T(t,b[t],J.config)}J.dataInputs=[],J.dataOutputs=[],J.className=this.getClassName();for(const b of this.dataInputs){const T={};b.serialize(T),J.dataInputs.push(T)}for(const b of this.dataOutputs){const T={};b.serialize(T),J.dataOutputs.push(T)}}deserialize(J){}_log(J,T,b){var q;null===(q=J.logger)||void 0===q||q.addLogItem({action:T,payload:b,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12630:(J,T,b)=>{"use strict";b.d(T,{d:()=>j});var q,t=b(644);!function(J){J[J.Input=0]="Input",J[J.Output=1]="Output"}(q||(q={}));class j{constructor(J,T,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,t.e)(),this.connectedPointIds=[],this.name=J,this._connectionType=T}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(J){if(this._connectionType===J._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||J._isSingularConnection()&&J._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(J),J._connectedPoint.push(this)}disconnectFrom(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._connectedPoint.indexOf(J),q=J._connectedPoint.indexOf(this);-1!==b&&-1!==q&&(T&&this._connectedPoint.splice(b,1),J._connectedPoint.splice(q,1))}disconnectFromAll(){for(const J of this._connectedPoint)this.disconnectFrom(J,!1);this._connectedPoint.length=0}dispose(){for(const J of this._connectedPoint)this.disconnectFrom(J)}serialize(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};J.uniqueId=this.uniqueId,J.name=this.name,J._connectionType=this._connectionType,J.connectedPointIds=[],J.className=this.getClassName();for(const T of this._connectedPoint)J.connectedPointIds.push(T.uniqueId)}getClassName(){return"FGConnection"}deserialize(J){this.uniqueId=J.uniqueId,this.name=J.name,this._connectionType=J._connectionType,this.connectedPointIds=J.connectedPointIds}}},12582:(J,T,b)=>{"use strict";b.d(T,{c:()=>K});var q,t=b(497),j=b(674),B=b(680),Y=b(644),C=b(12591),F=b(12615),A=b(519);!function(J){J.ExecuteBlock="ExecuteBlock",J.ExecuteEvent="ExecuteEvent",J.TriggerConnection="TriggerConnection",J.ContextVariableSet="ContextVariableSet",J.GlobalVariableSet="GlobalVariableSet",J.GlobalVariableDelete="GlobalVariableDelete",J.GlobalVariableGet="GlobalVariableGet",J.AddConnection="AddConnection",J.GetConnectionValue="GetConnectionValue",J.SetConnectionValue="SetConnectionValue",J.ActivateSignal="ActivateSignal",J.ContextVariableGet="ContextVariableGet"}(q||(q={}));class a{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(J){if(J.time||(J.time=Date.now()),this.log.push(J),this.logToConsole){var T;const b=null===(T=J.payload)||void 0===T?void 0:T.value;"object"===typeof b&&b.getClassName?A.d.Log(`[FGLog] ${J.className}:${J.uniqueId.split("-")[0]} ${J.action} - ${JSON.stringify(b.getClassName())}: ${b.toString()}`):A.d.Log(`[FGLog] ${J.className}:${J.uniqueId.split("-")[0]} ${J.action} - ${JSON.stringify(J.payload)}`)}}getItemsOfType(J){return this.log.filter((T=>T.action===J))}}class P{get enableLogging(){return this._enableLogging}set enableLogging(J){this._enableLogging!==J&&(this._enableLogging=J,this._enableLogging?(this.logger=new a,this.logger.logToConsole=!0):this.logger=null)}constructor(J){this.uniqueId=(0,Y.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new t.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=J,this.assetsContext=J.assetsContext??J.cg}hasVariable(J){return J in this._userVariables}setVariable(J,T){var b;this._userVariables[J]=T,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:J,value:T}})}getAsset(J,T){return(0,F.b)(this.assetsContext,J,T)}getVariable(J){var T;return null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:J,value:this._userVariables[J]}}),this._userVariables[J]}get userVariables(){return this._userVariables}va(){return this._configuration.cg}_getUniqueIdPrefixedName(J,T){return`${J.uniqueId}_${T}`}_getGlobalContextVariable(J,T){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:J,defaultValue:T,possibleValue:this._globalContextVariables[J]}}),this._hasGlobalContextVariable(J)?this._globalContextVariables[J]:T}_setGlobalContextVariable(J,T){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:J,value:T}}),this._globalContextVariables[J]=T}_deleteGlobalContextVariable(J){var T;null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:J}}),delete this._globalContextVariables[J]}_hasGlobalContextVariable(J){return J in this._globalContextVariables}_setExecutionVariable(J,T,b){this._executionVariables[this._getUniqueIdPrefixedName(J,T)]=b}_getExecutionVariable(J,T,b){return this._hasExecutionVariable(J,T)?this._executionVariables[this._getUniqueIdPrefixedName(J,T)]:b}_deleteExecutionVariable(J,T){delete this._executionVariables[this._getUniqueIdPrefixedName(J,T)]}_hasExecutionVariable(J,T){return this._getUniqueIdPrefixedName(J,T)in this._executionVariables}_hasConnectionValue(J){return J.uniqueId in this._connectionValues}_setConnectionValue(J,T){var b;this._connectionValues[J.uniqueId]=T,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:J.uniqueId,value:T}})}_setConnectionValueByKey(J,T){this._connectionValues[J]=T}_getConnectionValue(J){var T;return null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:J.uniqueId,value:this._connectionValues[J.uniqueId]}}),this._connectionValues[J.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(J){this._pendingBlocks.includes(J)||(this._pendingBlocks.push(J),this._pendingBlocks.sort(((J,T)=>J.priority-T.priority)))}_removePendingBlock(J){const T=this._pendingBlocks.indexOf(J);-1!==T&&this._pendingBlocks.splice(T,1)}_clearPendingBlocks(){for(const J of this._pendingBlocks)J._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(J){var T;this.onNodeExecutedObservable.notifyObservers(J),null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:J.getClassName(),uniqueId:J.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(J){this._setGlobalContextVariable("timeSinceStart",J.timeSinceStart),this._setGlobalContextVariable("deltaTime",J.deltaTime);for(const b of this._pendingBlocks){var T;null===(T=b._executeOnTick)||void 0===T||T.call(b,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.g;J.uniqueId=this.uniqueId,J._userVariables={};for(const q in this._userVariables)T(q,this._userVariables[q],J._userVariables);J._connectionValues={};for(const q in this._connectionValues)T(q,this._connectionValues[q],J._connectionValues);var b;this.assetsContext!==this.va()&&(J._assetsContext={meshes:this.assetsContext.meshes.map((J=>J.id)),materials:this.assetsContext.materials.map((J=>J.id)),textures:this.assetsContext.textures.map((J=>J.name)),animations:this.assetsContext.animations.map((J=>J.name)),lights:this.assetsContext.lights.map((J=>J.id)),cameras:this.assetsContext.cameras.map((J=>J.id)),om:null===(b=this.assetsContext.om)||void 0===b?void 0:b.map((J=>J.name)),skeletons:this.assetsContext.skeletons.map((J=>J.id)),si:this.assetsContext.si.map((J=>J.name)),geometries:this.assetsContext.geometries.map((J=>J.id)),multiMaterials:this.assetsContext.multiMaterials.map((J=>J.id)),transformNodes:this.assetsContext.transformNodes.map((J=>J.id))})}getClassName(){return"FlowGraphContext"}}(0,j.e)([(0,B.M)()],P.prototype,"uniqueId",void 0);var v=b(12620),G=b(2463);class x{constructor(J){this.onEventTriggeredObservable=new t.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=J,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ki.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const J=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:J}}),this._startingTime+=J})),this._meshPickedObserver=this._scene.onPointerObservable.add((J=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:J})}),G.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((J=>{const T=J.pointerId,b=J.mesh,q=this._pointerUnderMeshState[T];!q&&b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:T,mesh:b}}):q&&!b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:T,mesh:q}}):q&&b&&q!==b&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:T,mesh:q,over:b}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:T,mesh:b,out:q}})),this._pointerUnderMeshState[T]=b}),G.d.POINTERMOVE)}dispose(){var J,T,b,q,t;null===(J=this._sceneDisposeObserver)||void 0===J||J.remove(),null===(T=this._sceneReadyObserver)||void 0===T||T.remove(),null===(b=this._sceneOnBeforeRenderObserver)||void 0===b||b.remove(),null===(q=this._meshPickedObserver)||void 0===q||q.remove(),null===(t=this._meshUnderPointerObserver)||void 0===t||t.remove(),this.onEventTriggeredObservable.clear()}}var I,u=b(12633);!function(J){J[J.Stopped=0]="Stopped",J[J.Started=1]="Started"}(I||(I={}));class U{get state(){return this._state}set state(J){this._state=J,this.onStateChangedObservable.notifyObservers(J)}constructor(J){this.onStateChangedObservable=new t.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=J.cg,this._sceneEventCoordinator=new x(this._scene),this._coordinator=J.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((J=>{for(const T of this._executionContexts){const b=this._getContextualOrder(J.type,T);for(const q of b)if(!q._executeEvent(T,J.payload))break}switch(J.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const T of this._executionContexts)T._notifyOnTick(J.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const J=new P({cg:this._scene,coordinator:this._coordinator});return this._executionContexts.push(J),J}getContext(J){return this._executionContexts[J]}addEventBlock(J){if("PointerOver"!==J.type&&"PointerOut"!==J.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==J.type&&this._eventBlocks[J.type].push(J),1===this.state)for(const T of this._executionContexts)J._startPendingTasks(T);else this.onStateChangedObservable.addOnce((T=>{if(1===T)for(const b of this._executionContexts)J._startPendingTasks(b)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((J=>{1===J&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const J of this._executionContexts)for(const T in this._eventBlocks){const b=this._getContextualOrder(T,J);for(const T of b)T._startPendingTasks(J)}}_getContextualOrder(J,T){const b=this._eventBlocks[J].sort(((J,T)=>T.initPriority-J.initPriority));if("MeshPick"===J){const J=[];for(const q of b){const t=q.asset.getValue(T);let j=0;for(;j<b.length;j++){const J=b[j].asset.getValue(T);if(t&&J&&(0,u.o)(t,J))break}J.splice(j,0,q)}return J}return b}dispose(){var J;if(0!==this.state){this.state=0;for(const J of this._executionContexts)J._clearPendingBlocks();this._executionContexts.length=0;for(const J in this._eventBlocks)this._eventBlocks[J].length=0;null===(J=this._eventObserver)||void 0===J||J.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(J){const T=[],b=new Set;for(const q in this._eventBlocks)for(const J of this._eventBlocks[q])T.push(J),b.add(J.uniqueId);for(;T.length>0;){const q=T.pop();J(q);for(const J of q.dataInputs)for(const q of J._connectedPoint)b.has(q._ownerBlock.uniqueId)||(T.push(q._ownerBlock),b.add(q._ownerBlock.uniqueId));if(q instanceof v.c)for(const J of q.signalOutputs)for(const q of J._connectedPoint)b.has(q._ownerBlock.uniqueId)||(T.push(q._ownerBlock),b.add(q._ownerBlock.uniqueId))}}serialize(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=arguments.length>1?arguments[1]:void 0;J.allBlocks=[],this.visitAllBlocks((T=>{const b={};T.serialize(b),J.allBlocks.push(b)})),J.executionContexts=[];for(const b of this._executionContexts){const q={};b.serialize(q,T),J.executionContexts.push(q)}}}class K{constructor(J){this.config=J,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.cg.Ki.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.cg.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const J=this._executeOnNextFrame.slice(0);if(J.length)for(const T of J){this.notifyCustomEvent(T.id,T.data,!1);const J=this._executeOnNextFrame.findIndex((J=>J.uniqueId===T.uniqueId));-1!==J&&this._executeOnNextFrame.splice(J,1)}}));(K.SceneCoordinators.get(this.config.cg)??[]).push(this)}createGraph(){const J=new U({cg:this.config.cg,coordinator:this});return this._flowGraphs.push(J),J}removeGraph(J){const T=this._flowGraphs.indexOf(J);-1!==T&&(J.dispose(),this._flowGraphs.splice(T,1))}start(){for(const J of this._flowGraphs)J.start()}dispose(){var J,T;for(const t of this._flowGraphs)t.dispose();this._flowGraphs.length=0,null===(J=this._disposeObserver)||void 0===J||J.remove(),null===(T=this._onBeforeRenderObserver)||void 0===T||T.remove();const b=K.SceneCoordinators.get(this.config.cg)??[],q=b.indexOf(this);-1!==q&&b.splice(q,1)}serialize(J,T){J._flowGraphs=[];for(const b of this._flowGraphs){const q={};b.serialize(q,T),J._flowGraphs.push(q)}J.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(J){let T=this._customEventsMap.get(J);return T||(T=new t.b,this._customEventsMap.set(J,T)),T}notifyCustomEvent(J,T){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:J,data:T,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(J)){const T=this._eventExecutionCounter.get(J);if(this._eventExecutionCounter.set(J,T+1),T>=K.MaxEventTypeExecutionPerFrame)return void(T===K.MaxEventTypeExecutionPerFrame&&A.d.Warn(`FlowGraphCoordinator: Too many executions of event "${J}".`))}else this._eventExecutionCounter.set(J,1);const b=this._customEventsMap.get(J);b&&b.notifyObservers(T)}}K.MaxEventsPerType=30,K.MaxEventTypeExecutionPerFrame=30,K.SceneCoordinators=new Map},12639:(J,T,b)=>{"use strict";b.d(T,{d:()=>t});var q=b(12644);class t extends q.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(J){J._notifyExecuteNode(this),this.done._activateSignal(J)}}},12620:(J,T,b)=>{"use strict";b.d(T,{c:()=>Y});var q=b(12627),t=b(12630),j=b(639);class B extends t.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(J){super.connectTo(J),this._connectedPoint.sort(((J,T)=>T.priority-J.priority))}_activateSignal(J){var T;if(null===(T=J.logger)||void 0===T||T.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)J._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(J,this),J._increaseExecutionId();else for(const b of this._connectedPoint)b._activateSignal(J)}}(0,j.g)("FlowGraphSignalConnection",B);class Y extends q.b{constructor(J){super(J),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(J){const T=new B(J,0,this);return this.signalInputs.push(T),T}_registerSignalOutput(J){const T=new B(J,1,this);return this.signalOutputs.push(T),T}_unregisterSignalInput(J){const T=this.signalInputs.findIndex((T=>T.name===J));-1!==T&&(this.signalInputs[T].dispose(),this.signalInputs.splice(T,1))}_unregisterSignalOutput(J){const T=this.signalOutputs.findIndex((T=>T.name===J));-1!==T&&(this.signalOutputs[T].dispose(),this.signalOutputs.splice(T,1))}_reportError(J,T){this.error.payload="string"===typeof T?new Error(T):T,this.error._activateSignal(J)}getSignalInput(J){return this.signalInputs.find((T=>T.name===J))}getSignalOutput(J){return this.signalOutputs.find((T=>T.name===J))}serialize(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(J),J.signalInputs=[],J.signalOutputs=[];for(const T of this.signalInputs){const b={};T.serialize(b),J.signalInputs.push(b)}for(const T of this.signalOutputs){const b={};T.serialize(b),J.signalOutputs.push(b)}}deserialize(J){for(let T=0;T<J.signalInputs.length;T++){const b=this.getSignalInput(J.signalInputs[T].name);if(!b)throw new Error("Could not find signal input with name "+J.signalInputs[T].name+" in block "+J.className);b.deserialize(J.signalInputs[T])}for(let T=0;T<J.signalOutputs.length;T++){const b=this.getSignalOutput(J.signalOutputs[T].name);if(!b)throw new Error("Could not find signal output with name "+J.signalOutputs[T].name+" in block "+J.className);b.deserialize(J.signalOutputs[T])}}getClassName(){return"FlowGraphExecutionBlock"}}},12647:(J,T,b)=>{"use strict";b.d(T,{c:()=>t});var q=b(12620);class t extends q.c{constructor(J){super(J),this.out=this._registerSignalOutput("out")}}},12603:(J,T,b)=>{"use strict";b.d(T,{B:()=>v,E:()=>G,I:()=>x,M:()=>S,N:()=>H,O:()=>o,S:()=>p,c:()=>F,e:()=>P,i:()=>W,l:()=>I,p:()=>u,q:()=>U,r:()=>a,u:()=>l,y:()=>A});var q,t=b(697),j=b(731),B=b(12598),Y=b(12606);!function(J){J.Any="any",J.String="string",J.Number="number",J.Boolean="boolean",J.Object="object",J.Integer="FlowGraphInteger",J.Vector2="Vector2",J.pi="pi",J.Vector4="Vector4",J.Quaternion="Quaternion",J.Matrix="Matrix",J.Matrix2D="Matrix2D",J.Matrix3D="Matrix3D",J.Vi="Vi",J.Wi="Wi"}(q||(q={}));class C{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=J,this.defaultValue=T,this.animationType=b}serialize(J){J.typeName=this.typeName,J.defaultValue=this.defaultValue}}const F=new C("any",void 0),A=new C("string",""),a=new C("number",0,0),P=new C("boolean",!1),v=new C("Vector2",t.k.Zero(),5),G=new C("pi",t.n.Zero(),1),x=new C("Vector4",t.p.Zero()),I=new C("Matrix",t.e.Identity(),3),u=new C("Matrix2D",new Y.b),U=new C("Matrix3D",new Y.f),K=new C("Vi",j.b.Black(),4),E=new C("Wi",new j.d(0,0,0,0),7),l=new C("Quaternion",t.h.Identity(),2);l.typeTransformer=J=>{if(J.getClassName){if("Vector4"===J.getClassName())return t.h.ni(J.Ai());if("pi"===J.getClassName())return t.h.FromEulerVector(J);if("Matrix"===J.getClassName())return t.h.FromRotationMatrix(J)}return J};const W=new C("FlowGraphInteger",new B.e(0),0);function p(J){const T=J;switch(typeof J){case"string":return A;case"number":return a;case"boolean":return P;case"object":if(T.getClassName)switch(T.getClassName()){case"Vector2":return v;case"pi":return G;case"Vector4":return x;case"Matrix":return I;case"Vi":return K;case"Wi":return E;case"Quaternion":return l;case"FlowGraphInteger":return W;case"Matrix2D":return u;case"Matrix3D":return U}return F;default:return F}}function o(J){switch(J){case"string":return A;case"number":return a;case"boolean":return P;case"Vector2":return v;case"pi":return G;case"Vector4":return x;case"Matrix":return I;case"Vi":return K;case"Wi":return E;case"Quaternion":return l;case"FlowGraphInteger":return W;case"Matrix2D":return u;case"Matrix3D":return U;default:return F}}function S(J){switch(J){case"number":default:return 0;case"Vector2":return 5;case"pi":return 1;case"Matrix":return 3;case"Vi":return 4;case"Wi":return 7;case"Quaternion":return 2}}function H(J){switch(J){case 0:return a;case 5:return v;case 1:return G;case 3:return I;case 4:return K;case 7:return E;case 2:return l;default:return F}}},12591:(J,T,b)=>{"use strict";b.d(T,{d:()=>A,g:()=>F,h:()=>a});var q=b(731),t=b(697),j=b(12598),B=b(12603),Y=b(12606);function C(J){return"Vector2"===J||"pi"===J||"Vector4"===J||"Quaternion"===J||"Vi"===J||"Wi"===J}function F(J,T,b){var q;const t=(null===T||void 0===T||null===(q=T.getClassName)||void 0===q?void 0:q.call(T))??"";if(C(t)||function(J){return"Matrix"===J||"Matrix2D"===J||"Matrix3D"===J}(t))b[J]={value:T.Ai(),className:t};else if("FlowGraphInteger"===t)b[J]={value:T.value,className:t};else if(t&&(T.id||T.name))b[J]={id:T.id,name:T.name,className:t};else{if("object"===typeof T)throw new Error(`Could not serialize value ${T}`);b[J]=T}}function A(J,T,b,F){const a=T[J];let P;const v=(null===a||void 0===a?void 0:a.type)??(null===a||void 0===a?void 0:a.className);if(function(J){return"Mesh"===J||"AbstractMesh"===J||"GroundMesh"===J||"InstanceMesh"===J||"LinesMesh"===J||"GoldbergMesh"===J||"GreasedLineMesh"===J||"TrailMesh"===J}(v)){let J=F.meshes.filter((J=>a.id?J.id===a.id:J.name===a.name));0===J.length&&(J=F.transformNodes.filter((J=>a.id?J.id===a.id:J.name===a.name))),P=a.uniqueId?J.find((J=>J.uniqueId===a.uniqueId)):J[0]}else if(C(v))P=function(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===J)return t.k.ni(T);if("pi"===J)return b&&(T[2]*=-1),t.n.ni(T);if("Vector4"===J)return t.p.ni(T);if("Quaternion"===J)return b&&(T[2]*=-1,T[3]*=-1),t.h.ni(T);if("Vi"===J)return new q.b(T[0],T[1],T[2]);if("Wi"===J)return new q.d(T[0],T[1],T[2],T[3]);throw new Error(`Unknown vector class name ${J}`)}(v,a.value);else if(function(J){return"AnimationGroup"===J}(v)){const J=F.animationGroups.filter((J=>J.name===a.name));P=1===J.length?J[0]:J.find((J=>J.uniqueId===a.uniqueId))}else P="Matrix"===v?t.e.ni(a.value):"Matrix2D"===v?new Y.b(a.value):"Matrix3D"===v?new Y.f(a.value):"FlowGraphInteger"===v?j.e.FromValue(a.value):"number"===v||"string"===v||"boolean"===v?a.value[0]:a&&void 0!==a.value?a.value:Array.isArray(a)?a.reduce(((J,T)=>T.eventData?(J[T.id]={type:(0,B.O)(T.type)},"undefined"!==typeof T.value&&(J[T.id].value=A("value",T,b,F)),J):J),{}):a;return P}function a(J){return"FlowGraphJsonPointerParserBlock"===J}},12633:(J,T,b)=>{"use strict";function q(J,T){return!(!J.parent||J.parent!==T&&!q(J.parent,T))}function t(J){if(J.getClassName)return J.getClassName()}function j(J,T){return J===T&&("Vector2"===J||"pi"===J||"Vector4"===J||"Quaternion"===J)}function B(J,T){return J===T&&("Matrix"===J||"Matrix2D"===J||"Matrix3D"===J)}function Y(J,T){return"FlowGraphInteger"===J&&"FlowGraphInteger"===T}function C(J,T){const b="number"===typeof J||"number"===typeof(null===J||void 0===J?void 0:J.value);return b&&!T?!isNaN(F(J)):b}function F(J){return"number"===typeof J?J:J.value}b.d(T,{e:()=>Y,h:()=>B,i:()=>j,k:()=>t,o:()=>q,p:()=>F,s:()=>C})},11881:(J,T,b)=>{"use strict";b.r(T),b.d(T,{SceneInstrumentation:()=>j});var q=b(505),t=b(2405);class j{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(J){J!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=J,J?(this._onBeforeActiveMeshesEvaluationObserver=this.cg.onBeforeActiveMeshesEvaluationObservable.add((()=>{q.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.cg.onAfterActiveMeshesEvaluationObservable.add((()=>{q.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.cg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.cg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(J){J!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=J,J?(this._onBeforeRenderTargetsRenderObserver=this.cg.onBeforeRenderTargetsRenderObservable.add((()=>{q.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.cg.onAfterRenderTargetsRenderObservable.add((()=>{q.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.cg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.cg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(J){J!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=J,J?(this._onBeforeParticlesRenderingObserver=this.cg.onBeforeParticlesRenderingObservable.add((()=>{q.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.cg.onAfterParticlesRenderingObservable.add((()=>{q.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.cg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.cg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(J){J!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=J,this.cg.spriteManagers&&(J?(this._onBeforeSpritesRenderingObserver=this.cg.onBeforeSpritesRenderingObservable.add((()=>{q.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.cg.onAfterSpritesRenderingObservable.add((()=>{q.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.cg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.cg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(J){J!==this._capturePhysicsTime&&this.cg.onBeforePhysicsObservable&&(this._capturePhysicsTime=J,J?(this._onBeforePhysicsObserver=this.cg.onBeforePhysicsObservable.add((()=>{q.e.StartPerformanceCounter("eb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.cg.onAfterPhysicsObservable.add((()=>{q.e.EndPerformanceCounter("eb"),this._physicsTime.endMonitoring()}))):(this.cg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.cg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(J){J!==this._captureAnimationsTime&&(this._captureAnimationsTime=J,J?this._onAfterAnimationsObserver=this.cg.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.cg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(J){this._captureFrameTime=J}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(J){this._captureInterFrameTime=J}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(J){J!==this._captureRenderTime&&(this._captureRenderTime=J,J?(this._onBeforeDrawPhaseObserver=this.cg.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),q.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.cg.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),q.e.EndPerformanceCounter("Main render")}))):(this.cg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.cg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(J){J!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=J,J?(this._onBeforeCameraRenderObserver=this.cg.onBeforeCameraRenderObservable.add((J=>{this._cameraRenderTime.beginMonitoring(),q.e.StartPerformanceCounter(`Rendering camera ${J.name}`)})),this._onAfterCameraRenderObserver=this.cg.onAfterCameraRenderObservable.add((J=>{this._cameraRenderTime.endMonitoring(!1),q.e.EndPerformanceCounter(`Rendering camera ${J.name}`)}))):(this.cg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.cg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.cg.getEngine()._drawCalls}constructor(J){this.cg=J,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new t.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new t.d,this._captureFrameTime=!1,this._frameTime=new t.d,this._captureRenderTime=!1,this._renderTime=new t.d,this._captureInterFrameTime=!1,this._interFrameTime=new t.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new t.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new t.d,this._capturePhysicsTime=!1,this._physicsTime=new t.d,this._captureAnimationsTime=!1,this._animationsTime=new t.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new t.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=J.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(q.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.cg.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=J.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(q.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ji(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ji(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ji(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ji(),this._captureRenderTime&&this._renderTime.Ji(),this._captureCameraRenderTime&&this._cameraRenderTime.Ji()}))}dispose(){this._disposed||(this.cg.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.cg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.cg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.cg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.cg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.cg.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.cg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.cg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.cg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.cg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.cg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.cg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.cg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.cg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.cg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.cg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.cg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.cg=null,this._disposed=!0)}}},12577:(J,T,b)=>{"use strict";b.d(T,{d:()=>A});var q=b(674),t=b(680),j=b(697),B=b(722),Y=b(12504),C=b(12529),F=b(639);B.b.AddNodeConstructor("Light_Type_1",((J,T)=>()=>new A(J,j.n.Zero(),T)));class A extends C.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(J){this._shadowFrustumSize=J,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(J){this._shadowOrthoScale=J,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(J){this._orthoLeft=J}get orthoRight(){return this._orthoRight}set orthoRight(J){this._orthoRight=J}get orthoTop(){return this._orthoTop}set orthoTop(J){this._orthoTop=J}get orthoBottom(){return this._orthoBottom}set orthoBottom(J){this._orthoBottom=J}constructor(J,T,b){super(J,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=T.scale(-1),this.direction=T}getClassName(){return"fb"}getTypeID(){return Y.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(J,T,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(J):this._setDefaultAutoExtendShadowProjectionMatrix(J,T,b)}_setDefaultFixedFrustumShadowProjectionMatrix(J){const T=this.va().activeCamera;T&&j.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:T.wi,void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,J,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(J,T,b){const q=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const J=j.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let q=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let B=0;B<b.length;B++){const Y=b[B];if(!Y)continue;const C=Y.getBoundingInfo().boundingBox;for(let b=0;b<C.vectorsWorld.length;b++)j.n.TransformCoordinatesToRef(C.vectorsWorld[b],T,J),J.x<this._orthoLeft&&(this._orthoLeft=J.x),J.y<this._orthoBottom&&(this._orthoBottom=J.y),J.x>this._orthoRight&&(this._orthoRight=J.x),J.y>this._orthoTop&&(this._orthoTop=J.y),this.autoCalcShadowZBounds&&(J.z<q&&(q=J.z),J.z>t&&(t=J.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=q,this._shadowMaxZ=t)}const t=this._orthoRight-this._orthoLeft,B=this._orthoTop-this._orthoBottom,Y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.wi)||0,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)||1e4,F=this.va().getEngine().useReverseDepthBuffer;j.e.OrthoOffCenterLHToRef(this._orthoLeft-t*this.shadowOrthoScale,this._orthoRight+t*this.shadowOrthoScale,this._orthoBottom-B*this.shadowOrthoScale,this._orthoTop+B*this.shadowOrthoScale,F?C:Y,F?Y:C,J,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(J,T){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,T),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,T),this)}transferToNodeMaterialEffect(J,T){return this.computeTransformedInformation()?(J.setFloat3(T,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(J.setFloat3(T,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(J){const T=this._scene.getEngine();return!T.useReverseDepthBuffer&&T.isNDCHalfZRange?0:1}getDepthMaxZ(J){const T=this._scene.getEngine();return T.useReverseDepthBuffer&&T.isNDCHalfZRange?0:1}prepareLightSpecificDefines(J,T){J["DIRLIGHT"+T]=!0}}(0,q.e)([(0,t.M)()],A.prototype,"shadowFrustumSize",null),(0,q.e)([(0,t.M)()],A.prototype,"shadowOrthoScale",null),(0,q.e)([(0,t.M)()],A.prototype,"autoUpdateExtends",void 0),(0,q.e)([(0,t.M)()],A.prototype,"autoCalcShadowZBounds",void 0),(0,q.e)([(0,t.M)("orthoLeft")],A.prototype,"_orthoLeft",void 0),(0,q.e)([(0,t.M)("orthoRight")],A.prototype,"_orthoRight",void 0),(0,q.e)([(0,t.M)("orthoTop")],A.prototype,"_orthoTop",void 0),(0,q.e)([(0,t.M)("orthoBottom")],A.prototype,"_orthoBottom",void 0),(0,F.g)("BABYLON.DirectionalLight",A)},12861:(J,T,b)=>{"use strict";b.d(T,{c:()=>A});var q=b(674),t=b(680),j=b(697),B=b(731),Y=b(722),C=b(12504),F=b(639);Y.b.AddNodeConstructor("Light_Type_3",((J,T)=>()=>new A(J,j.n.Zero(),T)));class A extends C.c{constructor(J,T,b){super(J,b),this.groundColor=new B.b(0,0,0),this.direction=T||j.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"gb"}setDirectionToTarget(J){return this.direction=j.n.Normalize(J.Jg(j.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(J,T){const b=j.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,T),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Kl),T),this}transferToNodeMaterialEffect(J,T){const b=j.n.Normalize(this.direction);return J.setFloat3(T,b.x,b.y,b.z),this}ti(){return this._worldMatrix||(this._worldMatrix=j.e.Identity()),this._worldMatrix}getTypeID(){return C.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(J,T){J["HEMILIGHT"+T]=!0}}(0,q.e)([(0,t.o)()],A.prototype,"groundColor",void 0),(0,q.e)([(0,t.I)()],A.prototype,"direction",void 0),(0,F.g)("BABYLON.HemisphericLight",A)},12504:(J,T,b)=>{"use strict";b.d(T,{c:()=>P});var q=b(674),t=b(680),j=b(697),B=b(731),Y=b(722),C=b(845),F=b(639),A=b(867),a=b(727);class P extends Y.b{get range(){return this._range}set range(J){this._range=J,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(J){this._intensityMode=J,this._computePhotometricScale()}get radius(){return this._radius}set radius(J){this._radius=J,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(J){this._shadowEnabled!==J&&(this._shadowEnabled=J,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(J){this._includedOnlyMeshes=J,this._hookArrayForIncludedOnly(J)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(J){this._excludedMeshes=J,this._hookArrayForExcluded(J)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(J){this._excludeWithLayerMask=J,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(J){this._includeOnlyWithLayerMask=J,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(J){this._lightmapMode!==J&&(this._lightmapMode=J,this._markMeshesAsLightDirty())}getViewMatrix(J){return null}getProjectionMatrix(J,T){return null}constructor(J,T){super(J,T,!1),this.Sk=new B.b(1,1,1),this.ej=new B.b(1,1,1),this.falloffType=P.FALLOFF_DEFAULT,this.Kl=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=P.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new C.b(this.va().getEngine(),void 0,void 0,J),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(J,T){return this}_bindLight(J,T,b,q){let t=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const j=J.toString();let Y=!1;if(this._uniformBuffer.bindToEffect(b,"Light"+j),this._renderId!==T.getRenderId()||this._lastUseSpecular!==q||!this._uniformBuffer.useUbo){this._renderId=T.getRenderId(),this._lastUseSpecular=q;const J=this.getScaledIntensity();this.transferToEffect(b,j),this.Sk.scaleToRef(J,B.g.Vi[0]),this._uniformBuffer.updateColor4("vLightDiffuse",B.g.Vi[0],this.range,j),q&&(this.ej.scaleToRef(J,B.g.Vi[1]),this._uniformBuffer.updateColor4("vLightSpecular",B.g.Vi[1],this.radius,j)),Y=!0}if(this.transferTexturesToEffect(b,j),T.shadowsEnabled&&this.shadowEnabled&&t){const J=this.getShadowGenerator(T.activeCamera)??this.getShadowGenerator();J&&(J.bindShadowLight(j,b),Y=!0)}Y?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(J){let T="Name: "+this.name;if(T+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let b=0;b<this.animations.length;b++)T+=", animation[0]: "+this.animations[b].toString(J);return T}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}di(J){super.di(J),this._resyncMeshes()}getShadowGenerator(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(J)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return j.n.Zero()}canAffectMesh(J){return!J||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(J))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(J))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&J.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&J.layerMask)))}dispose(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const J=this._shadowGenerators.values();for(let T=J.next();!0!==T.done;T=J.next()){T.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const J=this._parentContainer.lights.indexOf(this);J>-1&&this._parentContainer.lights.splice(J,1),this._parentContainer=null}for(const b of this.va().meshes)b._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(J,T)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Kl}clone(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=P.GetConstructorFromName(this.getTypeID(),J,this.va());if(!b)return null;const q=a.d.Clone(b,this);return J&&(q.name=J),T&&(q.parent=T),q.di(this.isEnabled()),this.onClonedObservable.notifyObservers(q),q}serialize(){const J=a.d.Serialize(this);if(J.uniqueId=this.uniqueId,J.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(J),this.excludedMeshes.length>0){J.excludedMeshesIds=[];for(const T of this.excludedMeshes)J.excludedMeshesIds.push(T.id)}if(this.includedOnlyMeshes.length>0){J.includedOnlyMeshesIds=[];for(const T of this.includedOnlyMeshes)J.includedOnlyMeshesIds.push(T.id)}return a.d.AppendSerializedAnimations(this,J),J.ranges=this.serializeAnimationRanges(),J.isEnabled=this.isEnabled(),J}static GetConstructorFromName(J,T,b){const q=Y.b.Construct("Light_Type_"+J,T,b);return q||null}static Parse(J,T){const b=P.GetConstructorFromName(J.type,J.name,T);if(!b)return null;const q=a.d.Parse(b,J,T);if(J.excludedMeshesIds&&(q._excludedMeshesIds=J.excludedMeshesIds),J.includedOnlyMeshesIds&&(q._includedOnlyMeshesIds=J.includedOnlyMeshesIds),void 0!==J.parentId&&(q._waitingParentId=J.parentId),void 0!==J.parentInstanceIndex&&(q._waitingParentInstanceIndex=J.parentInstanceIndex),void 0!==J.falloffType&&(q.falloffType=J.falloffType),void 0!==J.lightmapMode&&(q.lightmapMode=J.lightmapMode),J.animations){for(let T=0;T<J.animations.length;T++){const b=J.animations[T],t=(0,F.c)("BABYLON.Animation");t&&q.animations.push(t.Parse(b))}Y.b.ParseAnimationRanges(q,J,T)}return J.autoAnimate&&T.beginAnimation(q,J.autoAnimateFrom,J.autoAnimateTo,J.autoAnimateLoop,J.autoAnimateSpeed||1),void 0!==J.isEnabled&&q.di(J.isEnabled),q}_hookArrayForExcluded(J){var T=this;const b=J.push;J.push=function(){for(var q=arguments.length,t=new Array(q),j=0;j<q;j++)t[j]=arguments[j];const B=b.apply(J,t);for(const J of t)J._resyncLightSource(T);return B};const q=J.splice;J.splice=(T,b)=>{const t=q.apply(J,[T,b]);for(const J of t)J._resyncLightSource(this);return t};for(const t of J)t._resyncLightSource(this)}_hookArrayForIncludedOnly(J){var T=this;const b=J.push;J.push=function(){for(var q=arguments.length,t=new Array(q),j=0;j<q;j++)t[j]=arguments[j];const B=b.apply(J,t);return T._resyncMeshes(),B};const q=J.splice;J.splice=(T,b)=>{const t=q.apply(J,[T,b]);return this._resyncMeshes(),t},this._resyncMeshes()}_resyncMeshes(){for(const J of this.va().meshes)J._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const J of this.va().meshes)-1!==J.lightSources.indexOf(this)&&J._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let J=0;const T=this.getTypeID();let b=this.intensityMode;switch(b===P.INTENSITYMODE_AUTOMATIC&&(b=T===P.LIGHTTYPEID_DIRECTIONALLIGHT?P.INTENSITYMODE_ILLUMINANCE:P.INTENSITYMODE_LUMINOUSINTENSITY),T){case P.LIGHTTYPEID_POINTLIGHT:case P.LIGHTTYPEID_SPOTLIGHT:switch(b){case P.INTENSITYMODE_LUMINOUSPOWER:J=1/(4*Math.PI);break;case P.INTENSITYMODE_LUMINOUSINTENSITY:J=1;break;case P.INTENSITYMODE_LUMINANCE:J=this.radius*this.radius}break;case P.LIGHTTYPEID_DIRECTIONALLIGHT:switch(b){case P.INTENSITYMODE_ILLUMINANCE:J=1;break;case P.INTENSITYMODE_LUMINANCE:{let T=this.radius;T=Math.max(T,.001);J=2*Math.PI*(1-Math.cos(T));break}}break;case P.LIGHTTYPEID_HEMISPHERICLIGHT:J=1}return J}_reorderLightsInScene(){const J=this.va();0!=this._renderPriority&&(J.requireLightSorting=!0),this.va().sortLightsByPriority()}_isReady(){return!0}}P.FALLOFF_DEFAULT=A.e.FALLOFF_DEFAULT,P.FALLOFF_PHYSICAL=A.e.FALLOFF_PHYSICAL,P.FALLOFF_GLTF=A.e.FALLOFF_GLTF,P.FALLOFF_STANDARD=A.e.FALLOFF_STANDARD,P.LIGHTMAP_DEFAULT=A.e.LIGHTMAP_DEFAULT,P.LIGHTMAP_SPECULAR=A.e.LIGHTMAP_SPECULAR,P.LIGHTMAP_SHADOWSONLY=A.e.LIGHTMAP_SHADOWSONLY,P.INTENSITYMODE_AUTOMATIC=A.e.INTENSITYMODE_AUTOMATIC,P.INTENSITYMODE_LUMINOUSPOWER=A.e.INTENSITYMODE_LUMINOUSPOWER,P.INTENSITYMODE_LUMINOUSINTENSITY=A.e.INTENSITYMODE_LUMINOUSINTENSITY,P.INTENSITYMODE_ILLUMINANCE=A.e.INTENSITYMODE_ILLUMINANCE,P.INTENSITYMODE_LUMINANCE=A.e.INTENSITYMODE_LUMINANCE,P.LIGHTTYPEID_POINTLIGHT=A.e.LIGHTTYPEID_POINTLIGHT,P.LIGHTTYPEID_DIRECTIONALLIGHT=A.e.LIGHTTYPEID_DIRECTIONALLIGHT,P.LIGHTTYPEID_SPOTLIGHT=A.e.LIGHTTYPEID_SPOTLIGHT,P.LIGHTTYPEID_HEMISPHERICLIGHT=A.e.LIGHTTYPEID_HEMISPHERICLIGHT,P.LIGHTTYPEID_RECT_AREALIGHT=A.e.LIGHTTYPEID_RECT_AREALIGHT,(0,q.e)([(0,t.o)()],P.prototype,"diffuse",void 0),(0,q.e)([(0,t.o)()],P.prototype,"specular",void 0),(0,q.e)([(0,t.M)()],P.prototype,"falloffType",void 0),(0,q.e)([(0,t.M)()],P.prototype,"intensity",void 0),(0,q.e)([(0,t.M)()],P.prototype,"range",null),(0,q.e)([(0,t.M)()],P.prototype,"intensityMode",null),(0,q.e)([(0,t.M)()],P.prototype,"radius",null),(0,q.e)([(0,t.M)()],P.prototype,"_renderPriority",void 0),(0,q.e)([(0,t.e)("_reorderLightsInScene")],P.prototype,"renderPriority",void 0),(0,q.e)([(0,t.M)("shadowEnabled")],P.prototype,"_shadowEnabled",void 0),(0,q.e)([(0,t.M)("excludeWithLayerMask")],P.prototype,"_excludeWithLayerMask",void 0),(0,q.e)([(0,t.M)("includeOnlyWithLayerMask")],P.prototype,"_includeOnlyWithLayerMask",void 0),(0,q.e)([(0,t.M)("lightmapMode")],P.prototype,"_lightmapMode",void 0)},12529:(J,T,b)=>{"use strict";b.d(T,{e:()=>C});var q=b(674),t=b(680),j=b(697),B=b(12504),Y=b(848);class C extends B.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=j.e.Identity(),this._projectionMatrix=j.e.Identity()}_setPosition(J){this._position=J}get position(){return this._position}set position(J){this._setPosition(J)}_setDirection(J){this._direction=J}get direction(){return this._direction}set direction(J){this._setDirection(J)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(J){this._shadowMinZ=J,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(J){this._shadowMaxZ=J,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=j.n.Zero()),j.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=j.n.Zero()),j.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(J){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(J){return this.direction=j.n.Normalize(J.Jg(this.position)),this.direction}getRotation(){this.direction.normalize();const J=j.n.Cross(this.direction,Y.d.Y),T=j.n.Cross(J,this.direction);return j.n.RotationFromAxis(J,T,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=j.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ti(J){return!J&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=j.e.Identity()),j.e.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(J){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.wi)||0}getDepthMaxZ(J){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)||1e4}setShadowProjectionMatrix(J,T,b){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(T,b,J):this._setDefaultShadowProjectionMatrix(J,T,b),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(J){const T=j.j.pi[0];let b=this.position;this.computeTransformedInformation()&&(b=this.transformedPosition),j.n.NormalizeToRef(this.getShadowDirection(J),T),1===Math.abs(j.n.Dot(T,j.n.Up()))&&(T.z=1e-13);const q=j.j.pi[1];return b.addToRef(T,q),j.e.LookAtLHToRef(b,q,j.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(J,T){return this.setShadowProjectionMatrix(this._projectionMatrix,J??this._viewMatrix,T??[]),this._projectionMatrix}}(0,q.e)([(0,t.I)()],C.prototype,"position",null),(0,q.e)([(0,t.I)()],C.prototype,"direction",null),(0,q.e)([(0,t.M)()],C.prototype,"shadowMinZ",null),(0,q.e)([(0,t.M)()],C.prototype,"shadowMaxZ",null)},12523:(J,T,b)=>{"use strict";b.d(T,{c:()=>a});var q=b(674),t=b(680),j=b(697),B=b(722),Y=b(12504),C=b(12529),F=b(2319),A=b(639);B.b.AddNodeConstructor("Light_Type_2",((J,T)=>()=>new a(J,j.n.Zero(),j.n.Zero(),0,0,T)));class a extends C.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(J){this._iesProfileTexture!==J&&(this._iesProfileTexture=J,this._iesProfileTexture&&a._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(J){this._angle=J,this._cosHalfAngle=Math.cos(.5*J),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(J){this._innerAngle=J,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(J){this._shadowAngleScale=J,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(J){this._projectionTextureLightNear=J,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(J){this._projectionTextureLightFar=J,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(J){this._projectionTextureUpDirection=J,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(J){this._projectionTexture!==J&&(this._projectionTexture=J,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(a._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):a._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(J){return void 0!==J.onGeneratedObservable}static _IsTexture(J){return void 0!==J.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(J){this._projectionTextureProjectionLightMatrix=J,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(J,T,b,q,t,B){super(J,B),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=j.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=j.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=j.n.Zero(),this._projectionTextureViewLightMatrix=j.e.Zero(),this._projectionTextureProjectionLightMatrix=j.e.Zero(),this._projectionTextureScalingMatrix=j.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=T,this.direction=b,this.angle=q,this.exponent=t}getClassName(){return"SpotLight"}getTypeID(){return Y.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(J){super._setDirection(J),this._projectionTextureViewLightDirty=!0}_setPosition(J){super._setPosition(J),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(J,T,b){const q=this.va().activeCamera;if(!q)return;this._shadowAngleScale=this._shadowAngleScale||1;const t=this._shadowAngleScale*this._angle,B=void 0!==this.shadowMinZ?this.shadowMinZ:q.wi,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,C=this.va().getEngine().useReverseDepthBuffer;j.e.PerspectiveFovLHToRef(t,1,C?Y:B,C?B:Y,J,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),j.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const J=this.projectionTextureLightFar,T=this.projectionTextureLightNear,b=J/(J-T),q=-b*T,t=1/Math.tan(this._angle/2);j.e.FromValuesToRef(t/1,0,0,0,0,t,0,0,0,0,b,1,0,0,q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof F.b){const J=this._projectionTexture.uScale/2,T=this._projectionTexture.vScale/2;j.e.FromValuesToRef(J,0,0,0,0,T,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(J,T){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),J.setMatrix("textureProjectionMatrix"+T,this._projectionTextureMatrix),J.setTexture("projectionLightTexture"+T,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&J.setTexture("iesLightTexture"+T,this._iesProfileTexture),this}transferToEffect(J,T){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,T),b=j.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,T),b=j.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,T),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,T),this}transferToNodeMaterialEffect(J,T){let b;return b=this.computeTransformedInformation()?j.n.Normalize(this.transformedDirection):j.n.Normalize(this.direction),this.va().useRightHandedSystem?J.setFloat3(T,-b.x,-b.y,-b.z):J.setFloat3(T,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(J){const T=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.wi)??0;return T.useReverseDepthBuffer&&T.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(J){const T=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)??1e4;return T.useReverseDepthBuffer&&T.isNDCHalfZRange?0:b}prepareLightSpecificDefines(J,T){J["SPOTLIGHT"+T]=!0,J["PROJECTEDLIGHTTEXTURE"+T]=!(!this.projectionTexture||!this.projectionTexture.isReady()),J["IESLIGHTTEXTURE"+T]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,q.e)([(0,t.M)()],a.prototype,"angle",null),(0,q.e)([(0,t.M)()],a.prototype,"innerAngle",null),(0,q.e)([(0,t.M)()],a.prototype,"shadowAngleScale",null),(0,q.e)([(0,t.M)()],a.prototype,"exponent",void 0),(0,q.e)([(0,t.M)()],a.prototype,"projectionTextureLightNear",null),(0,q.e)([(0,t.M)()],a.prototype,"projectionTextureLightFar",null),(0,q.e)([(0,t.M)()],a.prototype,"projectionTextureUpDirection",null),(0,q.e)([(0,t.D)("projectedLightTexture")],a.prototype,"_projectionTexture",void 0),(0,A.g)("BABYLON.SpotLight",a)},12174:(J,T,b)=>{"use strict";b.d(T,{d:()=>B,f:()=>j,j:()=>Y});const q={},t={};function j(J,T){q[J]=T}function B(J,T){t[J]=T}function Y(J){return t[J]?t[J]:null}},12067:(J,T,b)=>{"use strict";b.d(T,{b:()=>p,c:()=>V});var q,t=b(505),j=b(497),B=b(2440),Y=b(550),C=b(519),F=b(821),A=b(556),a=b(559),P=b(644),v=b(581),G=b(542);!function(J){J[J.Clean=0]="Clean",J[J.Stop=1]="Stop",J[J.Sync=2]="Sync",J[J.NoSync=3]="NoSync"}(q||(q={}));const x=new j.b,I={};let u=!1;function U(){return I[".babylon"]}function K(J,T){const b=I[J];return b||(C.d.Warn("Unable to find a plugin to load "+J+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),T?U():void 0)}function E(J,T,b){let q="Unable to load from "+(J.rawData?"binary data":J.url);return T?q+=`: ${T}`:b&&(q+=`: ${b}`),q}async function l(J,T,b,q,t,j,B,Y,C){var F;const a="data:"===(P=J.url).substring(0,5)?P.substring(5):null;var P;if(J.rawData&&!B)throw"When using ArrayBufferView to load data the file extension must be provided.";const u=a||B?"":function(J){const T=J.indexOf("?");-1!==T&&(J=J.substring(0,T));const b=J.lastIndexOf(".");return J.substring(b,J.length).toLowerCase()}(J.url);let E=B?K(B,!0):a?function(J){for(const T in I){const b=I[T].plugin;if(b.canDirectLoad&&b.canDirectLoad(J))return I[T]}return U()}(J.url):K(u,!1);if(!E&&u){if(J.url&&!J.url.startsWith("blob:")){const T=await async function(J,T){const b=T.method||"GET";return await new Promise(((q,t)=>{const j=new G.b;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const J={};if(T.responseHeaders)for(const b of T.responseHeaders)J[b]=j.getResponseHeader(b)||"";q({response:j.response,headerValues:J})}else t(`Unable to fetch data from ${J}. Error code: ${j.status}`)})),j.open(b,J),j.send()}))}(J.url,{method:"HEAD",responseHeaders:["Content-Type"]}),b=T.headerValues?T.headerValues["Content-Type"]:"";b&&(E=function(J){for(const T in I){const b=I[T];if(b.mimeType===J)return b}}(b))}E||(E=U())}if(!E)throw new Error(`No plugin or fallback for ${B??J.url}`);if(!1===(null===C||void 0===C||null===(F=C[E.plugin.name])||void 0===F?void 0:F.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(J.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(J=>{if(E.plugin.createPlugin){const T=E.plugin.createPlugin(C??{});return T instanceof Promise?(T.then(J).catch((J=>{t("Error instantiating plugin.",J)})),null):(J(T),T)}return J(E.plugin),E.plugin})((C=>{var F;if(!C)throw`The loader plugin corresponding to the '${B}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(x.notifyObservers(C),a&&(C.canDirectLoad&&C.canDirectLoad(J.url)||!(0,A.i)(J.url))){if(C.directLoad){const J=C.directLoad(T,a);J instanceof Promise?J.then((J=>{b(C,J)})).catch((J=>{t("Error in directLoad of _loadData: "+J,J)})):b(C,J)}else b(C,a);return}const P=E.isBinary,G=(J,q)=>{T.u?t("Scene has been disposed"):b(C,J,q)};let I=null,u=!1;null===(F=C.Ki)||void 0===F||F.add((()=>{u=!0,I&&(I.abort(),I=null),j()}));const U=()=>{if(u)return;const b=(J,T)=>{t(null===J||void 0===J?void 0:J.statusText,T)};if(!C.loadFile&&J.rawData)throw"Plugin does not support loading ArrayBufferView.";I=C.loadFile?C.loadFile(T,J.rawData||J.file||J.url,J.rootUrl,G,q,P,b,Y):T._loadFile(J.file||J.url,G,q,!0,P,b)},K=T.getEngine();let l=K.enableOfflineSupport;if(l){let b=!1;for(const q of T.disableOfflineSupportExceptionRules)if(q.test(J.url)){b=!0;break}l=!b}l&&v.b.OfflineProviderFactory?T.offlineProvider=v.b.OfflineProviderFactory(J.url,U,K.disableManifestCheck):U()}))}function W(J,T){let b,q,j=null,B=null;if(T)if(T.name)b=`file:${T.name}`,q=T.name,j=T;else if(ArrayBuffer.isView(T))b="",q=(0,P.e)(),B=T;else if(T.startsWith("data:"))b=T,q="";else if(J){const j=T;if("/"===j.substring(0,1))return t.e.Error("Wrong sceneFilename parameter"),null;b=J+j,q=j}else b=T,q=t.e.GetFilename(T),J=t.e.GetFolderPath(T);else b=J,q=t.e.GetFilename(J),J=t.e.GetFolderPath(J);return{url:b,rootUrl:J,name:q,file:j,rawData:B}}function p(J){if("string"===typeof J.extensions){const T=J.extensions;I[T.toLowerCase()]={plugin:J,isBinary:!1}}else{const T=J.extensions,b=Object.keys(T);for(const q of b)I[q.toLowerCase()]={plugin:J,isBinary:T[q].isBinary,mimeType:T[q].mimeType}}}async function o(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.e.LastCreatedScene,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!q)return C.d.Error("No scene available to import mesh to"),null;const v=W(T,b);if(!v)return null;const G={};q.addPendingData(G);const x=()=>{q.removePendingData(G)},I=(J,T)=>{const b=E(v,J,T);B?B(q,b,new a.k(b,a.h.SceneLoaderError,T)):C.d.Error(b),x()},u=j?J=>{try{j(J)}catch(T){I("Error in onProgress callback: "+T,T)}}:void 0,U=(J,T,b,j,B,Y,C,F)=>{if(q.importedMeshesFiles.push(v.url),t)try{t(J,T,b,j,B,Y,C,F)}catch(A){I("Error in onSuccess callback: "+A,A)}q.removePendingData(G)};return await l(v,q,((T,b,t)=>{if(T.rewriteRootURL&&(v.rootUrl=T.rewriteRootURL(v.rootUrl,t)),T.importMesh){const t=[],j=[],B=[];if(!T.importMesh(J,q,b,v.rootUrl,t,j,B,I))return;q.loadingPluginName=T.name,U(t,j,B,[],[],[],[],[])}else{T.importMeshAsync(J,q,b,v.rootUrl,u,v.name).then((J=>{q.loadingPluginName=T.name,U(J.meshes,J.si,J.skeletons,J.animationGroups,J.transformNodes,J.geometries,J.lights,J.spriteManagers)})).catch((J=>{I(J.message,J)}))}}),u,I,x,F,A,P)}async function S(J,T,b,q,t,j,B,Y){return await new Promise(((C,F)=>{try{o(J,T,b,q,((J,T,b,q,t,j,B,Y)=>{C({meshes:J,si:T,skeletons:b,animationGroups:q,transformNodes:t,geometries:j,lights:B,spriteManagers:Y})}),t,((J,T,b)=>{F(b||new Error(T))}),j,B,Y).catch(F)}catch(a){F(a)}}))}async function H(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedEngine,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};b?await g(J,T,new B.b(b),q,j,C,F,A,a):t.e.Error("No engine available")}async function s(J,T,b,q,t,j,B){return await new Promise(((Y,C)=>{H(J,T,b,(J=>{Y(J)}),q,((J,T,b)=>{C(b||new Error(T))}),t,j,B)}))}async function g(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedScene,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return C.d.Error("No scene available to append to"),null;const v=W(J,T);if(!v)return null;const G={};b.addPendingData(G);const x=()=>{b.removePendingData(G)};F.e.ShowLoadingScreen&&!u&&(u=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),u=!1})));const I=(J,T)=>{const q=E(v,J,T);j?j(b,q,new a.k(q,a.h.SceneLoaderError,T)):C.d.Error(q),x()},U=t?J=>{try{t(J)}catch(T){I("Error in onProgress callback",T)}}:void 0,K=()=>{if(q)try{q(b)}catch(J){I("Error in onSuccess callback",J)}b.removePendingData(G)};return await l(v,b,((J,T)=>{if(J.load){if(!J.load(b,T,v.rootUrl,I))return;b.loadingPluginName=J.name,K()}else{J.loadAsync(b,T,v.rootUrl,U,v.name).then((()=>{b.loadingPluginName=J.name,K()})).catch((J=>{I(J.message,J)}))}}),U,I,x,B,A,P)}async function d(J,T,b,q,t,j,B){return await new Promise(((Y,C)=>{try{g(J,T,b,(J=>{Y(J)}),q,((J,T,b)=>{C(b||new Error(T))}),t,j,B).catch(C)}catch(a){C(a)}}))}async function w(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedScene,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return C.d.Error("No scene available to load asset container to"),null;const P=W(J,T);if(!P)return null;const v={};b.addPendingData(v);const G=()=>{b.removePendingData(v)},x=(J,T)=>{const q=E(P,J,T);j?j(b,q,new a.k(q,a.h.SceneLoaderError,T)):C.d.Error(q),G()},I=t?J=>{try{t(J)}catch(T){x("Error in onProgress callback",T)}}:void 0,u=J=>{if(q)try{q(J)}catch(T){x("Error in onSuccess callback",T)}b.removePendingData(v)};return await l(P,b,((J,T)=>{if(J.loadAssetContainer){const q=J.loadAssetContainer(b,T,P.rootUrl,x);if(!q)return;q.populateRootNodes(),b.loadingPluginName=J.name,u(q)}else if(J.loadAssetContainerAsync){J.loadAssetContainerAsync(b,T,P.rootUrl,I,P.name).then((T=>{T.populateRootNodes(),b.loadingPluginName=J.name,u(T)})).catch((J=>{x(J.message,J)}))}else x("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,x,G,B,F,A)}async function Z(J,T,b,q,t,j,B){return await new Promise(((Y,C)=>{try{w(J,T,b,(J=>{Y(J)}),q,((J,T,b)=>{C(b||new Error(T))}),t,j,B).catch(C)}catch(a){C(a)}}))}async function e(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedScene,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,P=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void C.d.Error("No scene available to load animations to");if(q){for(const q of b.animatables)q.reset();b.stopAllAnimations();const J=b.animationGroups.slice();for(const b of J)b.dispose();const T=b.getNodes();for(const b of T)b.animations&&(b.animations=[])}else switch(t){case 0:const J=b.animationGroups.slice();for(const T of J)T.dispose();break;case 1:for(const T of b.animationGroups)T.stop();break;case 2:for(const T of b.animationGroups)T.reset(),T.restart();break;case 3:break;default:return void C.d.Error("Unknown animation group loading mode value '"+t+"'")}const G=b.animatables.length;await w(J,T,b,(J=>{J.mergeAnimationsTo(b,b.animatables.slice(G),j),J.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),B&&B(b)}),F,A,a,P,v)}async function c(J,T,b,q,t,j,B,Y,C,F){return await new Promise(((A,P)=>{try{e(J,T,b,q,t,j,(J=>{A(J)}),B,((J,T,b)=>{P(b||new Error(T))}),Y,C,F).catch(P)}catch(a){P(a)}}))}class V{static get ForceFullSceneLoadingForIncremental(){return F.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(J){F.e.ForceFullSceneLoadingForIncremental=J}static get ShowLoadingScreen(){return F.e.ShowLoadingScreen}static set ShowLoadingScreen(J){F.e.ShowLoadingScreen=J}static get loggingLevel(){return F.e.loggingLevel}static set loggingLevel(J){F.e.loggingLevel=J}static get CleanBoneMatrixWeights(){return F.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(J){F.e.CleanBoneMatrixWeights=J}static GetDefaultPlugin(){return U()}static GetPluginForExtension(J){var T;return null===(T=K(J,!0))||void 0===T?void 0:T.plugin}static IsPluginForExtensionAvailable(J){return function(J){return!!I[J]}(J)}static RegisterPlugin(J){p(J)}static ImportMesh(J,T,b,q,t,j,B,C,F){o(J,T,b,q,t,j,B,C,F).catch((J=>null===B||void 0===B?void 0:B(Y.e.LastCreatedScene,null===J||void 0===J?void 0:J.message,J)))}static async ImportMeshAsync(J,T,b,q,t,j,B){return await S(J,T,b,q,t,j,B)}static Load(J,T,b,q,t,j,B,C){H(J,T,b,q,t,j,B,C).catch((J=>null===j||void 0===j?void 0:j(Y.e.LastCreatedScene,null===J||void 0===J?void 0:J.message,J)))}static async LoadAsync(J,T,b,q,t,j){return await s(J,T,b,q,t,j)}static Append(J,T,b,q,t,j,B,C){g(J,T,b,q,t,j,B,C).catch((J=>null===j||void 0===j?void 0:j(b??Y.e.LastCreatedScene,null===J||void 0===J?void 0:J.message,J)))}static async AppendAsync(J,T,b,q,t,j){return await d(J,T,b,q,t,j)}static LoadAssetContainer(J,T,b,q,t,j,B,C){w(J,T,b,q,t,j,B,C).catch((J=>null===j||void 0===j?void 0:j(b??Y.e.LastCreatedScene,null===J||void 0===J?void 0:J.message,J)))}static async LoadAssetContainerAsync(J,T,b,q,t,j){return await Z(J,T,b,q,t,j)}static ImportAnimations(J,T,b,q,t,j,B,C,F,A,a){e(J,T,b,q,t,j,B,C,F,A,a).catch((J=>null===F||void 0===F?void 0:F(b??Y.e.LastCreatedScene,null===J||void 0===J?void 0:J.message,J)))}static async ImportAnimationsAsync(J,T,b,q,t,j,B,Y,C,F,A){return await c(J,T,b,q,t,j,Y,F,A)}}V.NO_LOGGING=0,V.MINIMAL_LOGGING=1,V.SUMMARY_LOGGING=2,V.DETAILED_LOGGING=3,V.OnPluginActivatedObservable=x},12495:(J,T,b)=>{"use strict";b.d(T,{d:()=>O});var q=b(674),t=b(680),j=b(519),B=b(689),Y=b(12493),C=b(2440),F=b(697),A=b(751),a=b(11994),P=b(12016);class v extends a.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class G extends P.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"PBRBRDF",90,new v,T),this._useEnergyConservation=G.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=G.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=G.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=G.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=G.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=G.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=G.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=G.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=G.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=G.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=G.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=G.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=G.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=G.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=G.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=G.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=G.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=G.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=J._dirtyCallbacks[16],this._enable(!0)}prepareDefines(J){J.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,J.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,J.SPHERICAL_HARMONICS=this._useSphericalHarmonics,J.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,J.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,J.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,J.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,J.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,J.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}G.DEFAULT_USE_ENERGY_CONSERVATION=!0,G.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,G.DEFAULT_USE_SPHERICAL_HARMONICS=!0,G.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,G.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,G.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,G.DEFAULT_DIFFUSE_MODEL=0,G.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,G.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"useEnergyConservation",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"useSphericalHarmonics",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"mixIblRadianceWithIrradiance",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"useLegacySpecularEnergyConservation",void 0),(0,q.e)([(0,t.M)("baseDiffuseModel"),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"baseDiffuseModel",void 0),(0,q.e)([(0,t.M)("dielectricSpecularModel"),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"dielectricSpecularModel",void 0),(0,q.e)([(0,t.M)("conductorSpecularModel"),(0,t.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"conductorSpecularModel",void 0);var x=b(11991),I=b(731),u=b(2442),U=b(855),K=b(11996),E=b(2319),l=b(12002),W=(b(2501),b(12005)),p=b(864);class o extends a.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class S extends P.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"PBRClearCoat",100,new o,T),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.roughness=0,this._indexOfRefraction=S._DefaultIndexOfRefraction,this.indexOfRefraction=S._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=I.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=J._dirtyCallbacks[1]}isReadyForSubMesh(J,T,b){if(!this._isEnabled)return!0;const q=this._material._disableBumpMap;if(J._areTexturesDirty&&T.texturesEnabled){if(this._texture&&l.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&l.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(b.getCaps().standardDerivatives&&this._bumpTexture&&l.e.ClearCoatBumpTextureEnabled&&!q&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&l.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(J,T){this._isEnabled?(J.CLEARCOAT=!0,J.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,J.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,J._areTexturesDirty&&T.texturesEnabled&&(this._texture&&l.e.ClearCoatTextureEnabled?(0,p.P)(this._texture,J,"CLEARCOAT_TEXTURE"):J.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&l.e.ClearCoatTextureEnabled?(0,p.P)(this._textureRoughness,J,"CLEARCOAT_TEXTURE_ROUGHNESS"):J.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&l.e.ClearCoatBumpTextureEnabled?(0,p.P)(this._bumpTexture,J,"CLEARCOAT_BUMP"):J.CLEARCOAT_BUMP=!1,J.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===S._DefaultIndexOfRefraction,this._isTintEnabled?(J.CLEARCOAT_TINT=!0,this._tintTexture&&l.e.ClearCoatTintTextureEnabled?((0,p.P)(this._tintTexture,J,"CLEARCOAT_TINT_TEXTURE"),J.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):J.CLEARCOAT_TINT_TEXTURE=!1):(J.CLEARCOAT_TINT=!1,J.CLEARCOAT_TINT_TEXTURE=!1))):(J.CLEARCOAT=!1,J.CLEARCOAT_TEXTURE=!1,J.CLEARCOAT_TEXTURE_ROUGHNESS=!1,J.CLEARCOAT_BUMP=!1,J.CLEARCOAT_TINT=!1,J.CLEARCOAT_TINT_TEXTURE=!1,J.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,J.CLEARCOAT_DEFAULTIOR=!1,J.CLEARCOAT_TEXTUREDIRECTUV=0,J.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,J.CLEARCOAT_BUMPDIRECTUV=0,J.CLEARCOAT_REMAP_F0=!1,J.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,J.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(J,T,b,q){if(!this._isEnabled)return;const t=q.materialDefines,j=this._material.isFrozen,B=this._material._disableBumpMap,Y=this._material._invertNormalMapX,C=this._material._invertNormalMapY;if(!J.useUbo||!j||!J.isSync){var F,A,a,P;if((this._texture||this._textureRoughness)&&l.e.ClearCoatTextureEnabled)J.updateFloat4("vClearCoatInfos",(null===(F=this._texture)||void 0===F?void 0:F.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(a=this._textureRoughness)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(P=this._textureRoughness)||void 0===P?void 0:P.level)??0),this._texture&&(0,p.q)(this._texture,J,"clearCoat"),this._textureRoughness&&!t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,p.q)(this._textureRoughness,J,"clearCoatRoughness");this._bumpTexture&&b.getCaps().standardDerivatives&&l.e.ClearCoatTextureEnabled&&!B&&(J.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,p.q)(this._bumpTexture,J,"clearCoatBump"),T._mirroredCameraPosition?J.updateFloat2("vClearCoatTangentSpaceParams",Y?1:-1,C?1:-1):J.updateFloat2("vClearCoatTangentSpaceParams",Y?-1:1,C?-1:1)),this._tintTexture&&l.e.ClearCoatTintTextureEnabled&&(J.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,p.q)(this._tintTexture,J,"clearCoatTint")),J.updateFloat2("vClearCoatParams",this.Kl,this.roughness);const q=1-this._indexOfRefraction,j=1+this._indexOfRefraction,v=Math.pow(-q/j,2),G=1/this._indexOfRefraction;J.updateFloat4("vClearCoatRefractionParams",v,G,q,j),this._isTintEnabled&&(J.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),J.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}T.texturesEnabled&&(this._texture&&l.e.ClearCoatTextureEnabled&&J.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&l.e.ClearCoatTextureEnabled&&J.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&b.getCaps().standardDerivatives&&l.e.ClearCoatBumpTextureEnabled&&!B&&J.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&l.e.ClearCoatTintTextureEnabled&&J.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(J){return this._texture===J||(this._textureRoughness===J||(this._bumpTexture===J||this._tintTexture===J))}getActiveTextures(J){this._texture&&J.push(this._texture),this._textureRoughness&&J.push(this._textureRoughness),this._bumpTexture&&J.push(this._bumpTexture),this._tintTexture&&J.push(this._tintTexture)}getAnimatables(J){this._texture&&this._texture.animations&&this._texture.animations.length>0&&J.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&J.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&J.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&J.push(this._tintTexture)}dispose(J){var T,b,q,t;J&&(null===(T=this._texture)||void 0===T||T.dispose(),null===(b=this._textureRoughness)||void 0===b||b.dispose(),null===(q=this._bumpTexture)||void 0===q||q.dispose(),null===(t=this._tintTexture)||void 0===t||t.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(J,T,b){return J.CLEARCOAT_BUMP&&T.addFallback(b++,"CLEARCOAT_BUMP"),J.CLEARCOAT_TINT&&T.addFallback(b++,"CLEARCOAT_TINT"),J.CLEARCOAT&&T.addFallback(b++,"CLEARCOAT"),b}getSamplers(J){J.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}S._DefaultIndexOfRefraction=1.5,(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isEnabled",void 0),(0,q.e)([(0,t.M)()],S.prototype,"intensity",void 0),(0,q.e)([(0,t.M)()],S.prototype,"roughness",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"indexOfRefraction",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"texture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMainTexture",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"textureRoughness",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"remapF0OnInterfaceChange",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isTintEnabled",void 0),(0,q.e)([(0,t.o)()],S.prototype,"tintColor",void 0),(0,q.e)([(0,t.M)()],S.prototype,"tintColorAtDistance",void 0),(0,q.e)([(0,t.M)()],S.prototype,"tintThickness",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"tintTexture",void 0);class H extends a.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class s extends P.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"PBRIridescence",110,new H,T),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.minimumThickness=s._DefaultMinimumThickness,this.maximumThickness=s._DefaultMaximumThickness,this.indexOfRefraction=s._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=J._dirtyCallbacks[1]}isReadyForSubMesh(J,T){if(!this._isEnabled)return!0;if(J._areTexturesDirty&&T.texturesEnabled){if(this._texture&&l.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&l.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(J,T){this._isEnabled?(J.IRIDESCENCE=!0,J._areTexturesDirty&&T.texturesEnabled&&(this._texture&&l.e.IridescenceTextureEnabled?(0,p.P)(this._texture,J,"IRIDESCENCE_TEXTURE"):J.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&l.e.IridescenceTextureEnabled?(0,p.P)(this._thicknessTexture,J,"IRIDESCENCE_THICKNESS_TEXTURE"):J.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(J.IRIDESCENCE=!1,J.IRIDESCENCE_TEXTURE=!1,J.IRIDESCENCE_THICKNESS_TEXTURE=!1,J.IRIDESCENCE_TEXTUREDIRECTUV=0,J.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(J,T){if(!this._isEnabled)return;const b=this._material.isFrozen;if(!J.useUbo||!b||!J.isSync){var q,t,j,B;if((this._texture||this._thicknessTexture)&&l.e.IridescenceTextureEnabled)J.updateFloat4("vIridescenceInfos",(null===(q=this._texture)||void 0===q?void 0:q.coordinatesIndex)??0,(null===(t=this._texture)||void 0===t?void 0:t.level)??0,(null===(j=this._thicknessTexture)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(B=this._thicknessTexture)||void 0===B?void 0:B.level)??0),this._texture&&(0,p.q)(this._texture,J,"iridescence"),this._thicknessTexture&&(0,p.q)(this._thicknessTexture,J,"iridescenceThickness");J.updateFloat4("vIridescenceParams",this.Kl,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}T.texturesEnabled&&(this._texture&&l.e.IridescenceTextureEnabled&&J.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&l.e.IridescenceTextureEnabled&&J.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(J){return this._texture===J||this._thicknessTexture===J}getActiveTextures(J){this._texture&&J.push(this._texture),this._thicknessTexture&&J.push(this._thicknessTexture)}getAnimatables(J){this._texture&&this._texture.animations&&this._texture.animations.length>0&&J.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&J.push(this._thicknessTexture)}dispose(J){var T,b;J&&(null===(T=this._texture)||void 0===T||T.dispose(),null===(b=this._thicknessTexture)||void 0===b||b.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(J,T,b){return J.IRIDESCENCE&&T.addFallback(b++,"IRIDESCENCE"),b}getSamplers(J){J.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}s._DefaultMinimumThickness=100,s._DefaultMaximumThickness=400,s._DefaultIndexOfRefraction=1.3,(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isEnabled",void 0),(0,q.e)([(0,t.M)()],s.prototype,"intensity",void 0),(0,q.e)([(0,t.M)()],s.prototype,"minimumThickness",void 0),(0,q.e)([(0,t.M)()],s.prototype,"maximumThickness",void 0),(0,q.e)([(0,t.M)()],s.prototype,"indexOfRefraction",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"texture",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"thicknessTexture",void 0);class g extends a.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class d extends P.c{set angle(J){this.direction.x=Math.cos(J),this.direction.y=Math.sin(J)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"PBRAnisotropic",110,new g,T),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.direction=new F.k(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=J._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=J._dirtyCallbacks[16]}isReadyForSubMesh(J,T){return!this._isEnabled||!(J._areTexturesDirty&&T.texturesEnabled&&this._texture&&l.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(J,T,b){this._isEnabled?(J.ANISOTROPIC=this._isEnabled,this._isEnabled&&!b.isVerticesDataPresent(A.e.TangentKind)&&(J._needUVs=!0,J.MAINUV1=!0),J._areTexturesDirty&&T.texturesEnabled&&(this._texture&&l.e.AnisotropicTextureEnabled?(0,p.P)(this._texture,J,"ANISOTROPIC_TEXTURE"):J.ANISOTROPIC_TEXTURE=!1),J._areMiscDirty&&(J.ANISOTROPIC_LEGACY=this._legacy)):(J.ANISOTROPIC=!1,J.ANISOTROPIC_TEXTURE=!1,J.ANISOTROPIC_TEXTUREDIRECTUV=0,J.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(J,T){if(!this._isEnabled)return;const b=this._material.isFrozen;J.useUbo&&b&&J.isSync||(this._texture&&l.e.AnisotropicTextureEnabled&&(J.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,p.q)(this._texture,J,"anisotropy")),J.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Kl)),T.texturesEnabled&&this._texture&&l.e.AnisotropicTextureEnabled&&J.setTexture("anisotropySampler",this._texture)}hasTexture(J){return this._texture===J}getActiveTextures(J){this._texture&&J.push(this._texture)}getAnimatables(J){this._texture&&this._texture.animations&&this._texture.animations.length>0&&J.push(this._texture)}dispose(J){J&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(J,T,b){return J.ANISOTROPIC&&T.addFallback(b++,"ANISOTROPIC"),b}getSamplers(J){J.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(J,T,b){super.parse(J,T,b),void 0===J.legacy&&(this.legacy=!0)}}(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isEnabled",void 0),(0,q.e)([(0,t.M)()],d.prototype,"intensity",void 0),(0,q.e)([(0,t.E)()],d.prototype,"direction",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"texture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsMiscDirty")],d.prototype,"legacy",void 0);class w extends a.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class Z extends P.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"Sheen",120,new w,T),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Kl=1,this.color=I.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=J._dirtyCallbacks[1]}isReadyForSubMesh(J,T){if(!this._isEnabled)return!0;if(J._areTexturesDirty&&T.texturesEnabled){if(this._texture&&l.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&l.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(J,T){this._isEnabled?(J.SHEEN=!0,J.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,J.SHEEN_ROUGHNESS=null!==this._roughness,J.SHEEN_ALBEDOSCALING=this._albedoScaling,J.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,J._areTexturesDirty&&T.texturesEnabled&&(this._texture&&l.e.SheenTextureEnabled?((0,p.P)(this._texture,J,"SHEEN_TEXTURE"),J.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):J.SHEEN_TEXTURE=!1,this._textureRoughness&&l.e.SheenTextureEnabled?(0,p.P)(this._textureRoughness,J,"SHEEN_TEXTURE_ROUGHNESS"):J.SHEEN_TEXTURE_ROUGHNESS=!1)):(J.SHEEN=!1,J.SHEEN_TEXTURE=!1,J.SHEEN_TEXTURE_ROUGHNESS=!1,J.SHEEN_LINKWITHALBEDO=!1,J.SHEEN_ROUGHNESS=!1,J.SHEEN_ALBEDOSCALING=!1,J.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,J.SHEEN_GAMMATEXTURE=!1,J.SHEEN_TEXTUREDIRECTUV=0,J.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(J,T,b,q){if(!this._isEnabled)return;const t=q.materialDefines,j=this._material.isFrozen;if(!J.useUbo||!j||!J.isSync){var B,Y,C,F;if((this._texture||this._textureRoughness)&&l.e.SheenTextureEnabled)J.updateFloat4("vSheenInfos",(null===(B=this._texture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(Y=this._texture)||void 0===Y?void 0:Y.level)??0,(null===(C=this._textureRoughness)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(F=this._textureRoughness)||void 0===F?void 0:F.level)??0),this._texture&&(0,p.q)(this._texture,J,"sheen"),this._textureRoughness&&!t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,p.q)(this._textureRoughness,J,"sheenRoughness");J.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Kl),null!==this._roughness&&J.updateFloat("vSheenRoughness",this._roughness)}T.texturesEnabled&&(this._texture&&l.e.SheenTextureEnabled&&J.setTexture("sheenSampler",this._texture),this._textureRoughness&&!t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&l.e.SheenTextureEnabled&&J.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(J){return this._texture===J||this._textureRoughness===J}getActiveTextures(J){this._texture&&J.push(this._texture),this._textureRoughness&&J.push(this._textureRoughness)}getAnimatables(J){this._texture&&this._texture.animations&&this._texture.animations.length>0&&J.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&J.push(this._textureRoughness)}dispose(J){var T,b;J&&(null===(T=this._texture)||void 0===T||T.dispose(),null===(b=this._textureRoughness)||void 0===b||b.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(J,T,b){return J.SHEEN&&T.addFallback(b++,"SHEEN"),b}getSamplers(J){J.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"linkSheenWithAlbedo",void 0),(0,q.e)([(0,t.M)()],Z.prototype,"intensity",void 0),(0,q.e)([(0,t.o)()],Z.prototype,"color",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRoughnessFromMainTexture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"roughness",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"textureRoughness",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"albedoScaling",void 0);class e extends a.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class c extends P.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(J){this._scene.enableSubSurfaceForPrePass()&&J&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(J))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(J){this._volumeIndexOfRefraction=J>=1?J:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"PBRSubSurface",130,new e,T),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=I.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=I.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=c.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=c.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=J.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=J._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=J._dirtyCallbacks[32]}isReadyForSubMesh(J,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(J._areTexturesDirty&&T.texturesEnabled){if(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const J=this._getRefractionTexture(T);if(J&&l.e.RefractionTextureEnabled&&!J.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(J,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return J.SUBSURFACE=!1,J.SS_DISPERSION=!1,J.SS_TRANSLUCENCY=!1,J.SS_SCATTERING=!1,J.SS_REFRACTION=!1,J.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,J.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,J.SS_THICKNESSANDMASK_TEXTURE=!1,J.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,J.SS_HAS_THICKNESS=!1,J.SS_REFRACTIONINTENSITY_TEXTURE=!1,J.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,J.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,J.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,J.SS_REFRACTIONMAP_3D=!1,J.SS_REFRACTIONMAP_OPPOSITEZ=!1,J.SS_LODINREFRACTIONALPHA=!1,J.SS_GAMMAREFRACTION=!1,J.SS_RGBDREFRACTION=!1,J.SS_LINEARSPECULARREFRACTION=!1,J.SS_LINKREFRACTIONTOTRANSPARENCY=!1,J.SS_ALBEDOFORREFRACTIONTINT=!1,J.SS_ALBEDOFORTRANSLUCENCYTINT=!1,J.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,J.SS_USE_THICKNESS_AS_DEPTH=!1,J.SS_USE_GLTF_TEXTURES=!1,J.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,J.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,J.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(J.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(J._areTexturesDirty){if(J.SUBSURFACE=!0,J.SS_DISPERSION=this._isDispersionEnabled,J.SS_TRANSLUCENCY=this._isTranslucencyEnabled,J.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,J.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,J.SS_SCATTERING=this._isScatteringEnabled,J.SS_THICKNESSANDMASK_TEXTURE=!1,J.SS_REFRACTIONINTENSITY_TEXTURE=!1,J.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,J.SS_HAS_THICKNESS=!1,J.SS_USE_GLTF_TEXTURES=!1,J.SS_REFRACTION=!1,J.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,J.SS_REFRACTIONMAP_3D=!1,J.SS_GAMMAREFRACTION=!1,J.SS_RGBDREFRACTION=!1,J.SS_LINEARSPECULARREFRACTION=!1,J.SS_REFRACTIONMAP_OPPOSITEZ=!1,J.SS_LODINREFRACTIONALPHA=!1,J.SS_LINKREFRACTIONTOTRANSPARENCY=!1,J.SS_ALBEDOFORREFRACTIONTINT=!1,J.SS_ALBEDOFORTRANSLUCENCYTINT=!1,J.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,J.SS_USE_THICKNESS_AS_DEPTH=!1,J.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,J.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,J._areTexturesDirty&&T.texturesEnabled&&(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&(0,p.P)(this._thicknessTexture,J,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&l.e.RefractionIntensityTextureEnabled&&(0,p.P)(this._refractionIntensityTexture,J,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&(0,p.P)(this._translucencyIntensityTexture,J,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&((0,p.P)(this._translucencyColorTexture,J,"SS_TRANSLUCENCYCOLOR_TEXTURE"),J.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),J.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,J.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,J.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,J.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&T.texturesEnabled){const b=this._getRefractionTexture(T);b&&l.e.RefractionTextureEnabled&&(J.SS_REFRACTION=!0,J.SS_REFRACTIONMAP_3D=b.isCube,J.SS_GAMMAREFRACTION=b.gammaSpace,J.SS_RGBDREFRACTION=b.isRGBD,J.SS_LINEARSPECULARREFRACTION=b.linearSpecularLOD,J.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&b.isCube?!b.invertZ:b.invertZ,J.SS_LODINREFRACTIONALPHA=b.lodLevelInAlpha,J.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,J.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,J.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=b.isCube&&b.boundingBoxSize,J.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(J.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(J,T,b,q){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)J.updateFloat2("vThicknessParam",0,0);else{q.getRenderingMesh().getWorldMatrix().decompose(F.j.pi[0]);const T=Math.max(Math.abs(F.j.pi[0].x),Math.abs(F.j.pi[0].y),Math.abs(F.j.pi[0].z));J.updateFloat2("vThicknessParam",this.minimumThickness*T,(this.maximumThickness-this.minimumThickness)*T)}}bindForSubMesh(J,T,b,q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const t=q.materialDefines,j=this._material.isFrozen,B=this._material.realTimeFiltering,Y=t.LODBASEDMICROSFURACE,C=this._getRefractionTexture(T);if(!J.useUbo||!j||!J.isSync){if(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&(J.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,p.q)(this._thicknessTexture,J,"thickness")),this._refractionIntensityTexture&&l.e.RefractionIntensityTextureEnabled&&t.SS_REFRACTIONINTENSITY_TEXTURE&&(J.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,p.q)(this._refractionIntensityTexture,J,"refractionIntensity")),this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&t.SS_TRANSLUCENCYCOLOR_TEXTURE&&(J.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,p.q)(this._translucencyColorTexture,J,"translucencyColor")),this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&t.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(J.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,p.q)(this._translucencyIntensityTexture,J,"translucencyIntensity")),C&&l.e.RefractionTextureEnabled){J.Zi("refractionMatrix",C.getRefractionTextureMatrix());let T=1;C.isCube||C.depth&&(T=C.depth);const b=C.getSize().width,q=this.volumeIndexOfRefraction;if(J.updateFloat4("vRefractionInfos",C.level,1/q,T,this._invertRefractionY?-1:1),J.updateFloat4("vRefractionMicrosurfaceInfos",b,C.lodGenerationScale,C.lodGenerationOffset,1/this.indexOfRefraction),B&&J.updateFloat2("vRefractionFilteringInfo",b,Math.log2(b)),C.boundingBoxSize){const T=C;J.updateVector3("vRefractionPosition",T.boundingBoxPosition),J.updateVector3("vRefractionSize",T.boundingBoxSize)}}this._isScatteringEnabled&&J.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),J.updateColor3("vDiffusionDistance",this.diffusionDistance),J.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),J.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),J.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),J.updateFloat("dispersion",this.dispersion)}T.texturesEnabled&&(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&J.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&l.e.RefractionIntensityTextureEnabled&&t.SS_REFRACTIONINTENSITY_TEXTURE&&J.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&t.SS_TRANSLUCENCYINTENSITY_TEXTURE&&J.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&t.SS_TRANSLUCENCYCOLOR_TEXTURE&&J.setTexture("translucencyColorSampler",this._translucencyColorTexture),C&&l.e.RefractionTextureEnabled&&(Y?J.setTexture("refractionSampler",C):(J.setTexture("refractionSampler",C._lodTextureMid||C),J.setTexture("refractionSamplerLow",C._lodTextureLow||C),J.setTexture("refractionSamplerHigh",C._lodTextureHigh||C))))}_getRefractionTexture(J){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?J.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(J){l.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&J.push(this._refractionTexture)}hasTexture(J){return this._thicknessTexture===J||(this._refractionTexture===J||(this._refractionIntensityTexture===J||(this._translucencyIntensityTexture===J||this._translucencyColorTexture===J)))}hasRenderTargetTextures(){return!!(l.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(J){this._thicknessTexture&&J.push(this._thicknessTexture),this._refractionTexture&&J.push(this._refractionTexture),this._translucencyColorTexture&&J.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&J.push(this._translucencyIntensityTexture)}getAnimatables(J){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&J.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&J.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&J.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&J.push(this._translucencyIntensityTexture)}dispose(J){J&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(J,T,b){return J.SS_SCATTERING&&T.addFallback(b++,"SS_SCATTERING"),J.SS_TRANSLUCENCY&&T.addFallback(b++,"SS_TRANSLUCENCY"),b}getSamplers(J){J.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}c.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,c.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isRefractionEnabled",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isTranslucencyEnabled",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isDispersionEnabled",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markScenePrePassDirty")],c.prototype,"isScatteringEnabled",void 0),(0,q.e)([(0,t.M)()],c.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,q.e)([(0,t.M)()],c.prototype,"refractionIntensity",void 0),(0,q.e)([(0,t.M)()],c.prototype,"translucencyIntensity",void 0),(0,q.e)([(0,t.M)()],c.prototype,"useAlbedoToTintRefraction",void 0),(0,q.e)([(0,t.M)()],c.prototype,"useAlbedoToTintTranslucency",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"thicknessTexture",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"refractionTexture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"indexOfRefraction",void 0),(0,q.e)([(0,t.M)()],c.prototype,"_volumeIndexOfRefraction",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"volumeIndexOfRefraction",null),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"invertRefractionY",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"linkRefractionWithTransparency",void 0),(0,q.e)([(0,t.M)()],c.prototype,"minimumThickness",void 0),(0,q.e)([(0,t.M)()],c.prototype,"maximumThickness",void 0),(0,q.e)([(0,t.M)()],c.prototype,"useThicknessAsDepth",void 0),(0,q.e)([(0,t.o)()],c.prototype,"tintColor",void 0),(0,q.e)([(0,t.M)()],c.prototype,"tintColorAtDistance",void 0),(0,q.e)([(0,t.M)()],c.prototype,"dispersion",void 0),(0,q.e)([(0,t.o)()],c.prototype,"diffusionDistance",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useMaskFromThicknessTexture",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"refractionIntensityTexture",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"translucencyIntensityTexture",void 0),(0,q.e)([(0,t.o)()],c.prototype,"translucencyColor",void 0),(0,q.e)([(0,t.D)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"translucencyColorTexture",void 0),(0,q.e)([(0,t.M)(),(0,t.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useGltfStyleTextures",void 0),(0,q.e)([(0,t.M)()],c.prototype,"applyAlbedoAfterSubSurface",void 0),(0,q.e)([(0,t.M)()],c.prototype,"legacyTransluceny",void 0);var V=b(12011),Q=b(869),h=b(12023);const i={effect:null,subMesh:null};class m extends a.d{constructor(J){super(J),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class O extends K.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(J){this._realTimeFiltering=J,this.Pi(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(J){this._realTimeFilteringQuality=J,this.Pi(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(J){J!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=J||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(J,T){super(J,T,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||O.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new F.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=O.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=I.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new I.b(0,0,0),this._albedoColor=new I.b(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new I.b(1,1,1),this._reflectionColor=new I.b(1,1,1),this._emissiveColor=new I.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=O.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new B.e(16),this._globalAmbientColor=new I.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new G(this),this.clearCoat=new S(this),this.iridescence=new s(this),this.anisotropy=new d(this),this.sheen=new Z(this),this.subSurface=new c(this),this.detailMap=new V.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),l.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,Y.d)(this.va()),this.prePassConfiguration=new x.c}get hasRenderTargetTextures(){return!!(l.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var J;return this._transparencyMode===O.PBRMATERIAL_OPAQUE||this._transparencyMode===O.PBRMATERIAL_ALPHATEST||(null===(J=this.subSurface)||void 0===J?void 0:J.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var J;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(J=this.subSurface)||void 0===J||!J.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===O.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Fj&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==O.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Fj||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(J,T,b){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const q=T._drawWrapper;if(q.effect&&this.isFrozen&&q._wasPreviouslyReady&&q._wasPreviouslyUsingInstances===b)return!0;T.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),T.materialDefines=new m(this._eventInfo.defineNames));const t=T.materialDefines;if(this._isReadyForSubMesh(T))return!0;const B=this.va(),Y=B.getEngine();if(t._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,B.texturesEnabled)){if(this._albedoTexture&&l.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&l.e.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&l.e.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&l.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&l.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const J=this._getReflectionTexture();if(J&&l.e.ReflectionTextureEnabled){if(!J.isReadyOrNotBlocking())return!1;var C;if(J.irradianceTexture){if(!J.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!J.sphericalPolynomial&&null!==(C=J.getInternalTexture())&&void 0!==C&&C._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&l.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&l.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(l.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(Y.getCaps().standardDerivatives&&this._bumpTexture&&l.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&l.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=t,this._eventInfo.subMesh=T,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(t._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(t.AREALIGHTUSED)for(let j=0;j<J.lightSources.length;j++)if(!J.lightSources[j]._isReady())return!1;Y.getCaps().standardDerivatives||J.isVerticesDataPresent(A.e.NormalKind)||(J.createNormals(!0),j.d.Warn("PBRMaterial: Normals have been created for the mesh: "+J.name));const F=T.effect,a=t._areLightsDisposed;let P=this._prepareEffect(J,t,this.onCompiled,this.onError,b,null,T.getRenderingMesh().hasThinInstances),v=!1;if(P)if(this._onEffectCreatedObservable&&(i.effect=P,i.subMesh=T,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&F&&!P.isReady()){if(P=F,t.markAsUnprocessed(),v=this.isFrozen,a)return t._areLightsDisposed=!0,!1}else B.resetCachedMaterial(),T.setEffect(P,t,this._materialContext);return!(!T.effect||!T.effect.isReady())&&(t._renderId=B.getRenderId(),q._wasPreviouslyReady=!v,q._wasPreviouslyUsingInstances=!!b,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(J,T){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(J,T,j,B,Y),!T.isDirty)return null;T.markAsProcessed();const C=this.va().getEngine(),F=new W.d;let a=0;T.USESPHERICALINVERTEX&&F.addFallback(a++,"USESPHERICALINVERTEX"),T.FOG&&F.addFallback(a,"FOG"),T.SPECULARAA&&F.addFallback(a,"SPECULARAA"),T.POINTSIZE&&F.addFallback(a,"POINTSIZE"),T.LOGARITHMICDEPTH&&F.addFallback(a,"LOGARITHMICDEPTH"),T.PARALLAX&&F.addFallback(a,"PARALLAX"),T.PARALLAX_RHS&&F.addFallback(a,"PARALLAX_RHS"),T.PARALLAXOCCLUSION&&F.addFallback(a++,"PARALLAXOCCLUSION"),T.ENVIRONMENTBRDF&&F.addFallback(a++,"ENVIRONMENTBRDF"),T.TANGENT&&F.addFallback(a++,"TANGENT"),T.BUMP&&F.addFallback(a++,"BUMP"),a=(0,p.u)(T,F,this._maxSimultaneousLights,a++),T.SPECULARTERM&&F.addFallback(a++,"SPECULARTERM"),T.USESPHERICALFROMREFLECTIONMAP&&F.addFallback(a++,"USESPHERICALFROMREFLECTIONMAP"),T.USEIRRADIANCEMAP&&F.addFallback(a++,"USEIRRADIANCEMAP"),T.LIGHTMAP&&F.addFallback(a++,"LIGHTMAP"),T.NORMAL&&F.addFallback(a++,"NORMAL"),T.AMBIENT&&F.addFallback(a++,"AMBIENT"),T.EMISSIVE&&F.addFallback(a++,"EMISSIVE"),T.VERTEXCOLOR&&F.addFallback(a++,"VERTEXCOLOR"),T.MORPHTARGETS&&F.addFallback(a++,"MORPHTARGETS"),T.MULTIVIEW&&F.addFallback(0,"MULTIVIEW");const P=[A.e.PositionKind];T.NORMAL&&P.push(A.e.NormalKind),T.TANGENT&&P.push(A.e.TangentKind);for(let b=1;b<=6;++b)T["UV"+b]&&P.push(`uv${1===b?"":b}`);T.VERTEXCOLOR&&P.push(A.e.ColorKind),(0,p.y)(P,J,T,F),(0,p.B)(P,T),(0,p.D)(P,J,T),(0,p.w)(P,J,T);let v="pbr";const G=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],I=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],U=["Material","Scene","Mesh"],K={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:T.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=F,this._eventInfo.fallbackRank=a,this._eventInfo.defines=T,this._eventInfo.uniforms=G,this._eventInfo.attributes=P,this._eventInfo.samplers=I,this._eventInfo.uniformBuffersNames=U,this._eventInfo.customCode=void 0,this._eventInfo.mesh=J,this._eventInfo.indexParameters=K,this._callbackPluginEventGeneric(128,this._eventInfo),h.d.AddUniformsAndSamplers(G,I),x.c.AddUniforms(G),x.c.AddSamplers(I),(0,Q.e)(G),u.b&&(u.b.PrepareUniforms(G,T),u.b.PrepareSamplers(I,T)),(0,p.Z)({uniformsNames:G,uniformBuffersNames:U,samplers:I,defines:T,maxSimultaneousLights:this._maxSimultaneousLights});const E={};this.customShaderNameResolve&&(v=this.customShaderNameResolve(v,G,U,I,T,P,E));const l=T.toString(),o=C.createEffect(v,{attributes:P,uniformsNames:G,uniformBuffersNames:U,samplers:I,defines:l,fallbacks:F,onCompiled:q,onError:t,indexParameters:K,processFinalCode:E.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:T.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([b.e(41),b.e(50)]).then(b.bind(b,13737)),Promise.all([b.e(42),b.e(51)]).then(b.bind(b,13761))]):await Promise.all([Promise.all([b.e(45),b.e(52)]).then(b.bind(b,13769)),Promise.all([b.e(47),b.e(53)]).then(b.bind(b,13794))]),this._shadersLoaded=!0}},C);return this._eventInfo.customCode=void 0,o}_prepareDefines(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const j=this.va(),B=j.getEngine();(0,p.N)(j,J,T,!0,this._maxSimultaneousLights,this._disableLighting),T._needNormals=!0,(0,p.R)(j,T);const Y=this.needAlphaBlendingForMesh(J)&&this.va().useOrderIndependentTransparency;if((0,p.X)(j,T,this.canRenderToMRT&&!Y),(0,p.T)(j,T,Y),h.d.PrepareDefines(B.currentRenderPassId,J,T),T.METALLICWORKFLOW=this.isMetallicWorkflow(),T._areTexturesDirty){T._needUVs=!1;for(let J=1;J<=6;++J)T["MAINUV"+J]=!1;if(j.texturesEnabled){T.ALBEDODIRECTUV=0,T.BASE_WEIGHTDIRECTUV=0,T.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,T.AMBIENTDIRECTUV=0,T.OPACITYDIRECTUV=0,T.EMISSIVEDIRECTUV=0,T.REFLECTIVITYDIRECTUV=0,T.MICROSURFACEMAPDIRECTUV=0,T.METALLIC_REFLECTANCEDIRECTUV=0,T.REFLECTANCEDIRECTUV=0,T.BUMPDIRECTUV=0,T.LIGHTMAPDIRECTUV=0,B.getCaps().textureLOD&&(T.LODBASEDMICROSFURACE=!0),this._albedoTexture&&l.e.DiffuseTextureEnabled?((0,p.P)(this._albedoTexture,T,"ALBEDO"),T.GAMMAALBEDO=this._albedoTexture.gammaSpace):T.ALBEDO=!1,this._baseWeightTexture&&l.e.BaseWeightTextureEnabled?(0,p.P)(this._baseWeightTexture,T,"BASE_WEIGHT"):T.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&l.e.BaseDiffuseRoughnessTextureEnabled?(0,p.P)(this._baseDiffuseRoughnessTexture,T,"BASE_DIFFUSE_ROUGHNESS"):T.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&l.e.AmbientTextureEnabled?((0,p.P)(this._ambientTexture,T,"AMBIENT"),T.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):T.AMBIENT=!1,this._opacityTexture&&l.e.OpacityTextureEnabled?((0,p.P)(this._opacityTexture,T,"OPACITY"),T.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):T.OPACITY=!1;const J=this._getReflectionTexture();if(J&&l.e.ReflectionTextureEnabled){switch(T.REFLECTION=!0,T.GAMMAREFLECTION=J.gammaSpace,T.RGBDREFLECTION=J.isRGBD,T.LODINREFLECTIONALPHA=J.lodLevelInAlpha,T.LINEARSPECULARREFLECTION=J.linearSpecularLOD,T.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(T.NUM_SAMPLES=""+this.realTimeFilteringQuality,B._features.needTypeSuffixInShaderConstants&&(T.NUM_SAMPLES=T.NUM_SAMPLES+"u"),T.REALTIME_FILTERING=!0,this.va().iblCdfGenerator&&(T.IBL_CDF_FILTERING=!0)):T.REALTIME_FILTERING=!1,T.INVERTCUBICMAP=J.coordinatesMode===E.b.INVCUBIC_MODE,T.REFLECTIONMAP_3D=J.isCube,T.REFLECTIONMAP_OPPOSITEZ=T.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!J.invertZ:J.invertZ,T.REFLECTIONMAP_CUBIC=!1,T.REFLECTIONMAP_EXPLICIT=!1,T.REFLECTIONMAP_PLANAR=!1,T.REFLECTIONMAP_PROJECTION=!1,T.REFLECTIONMAP_SKYBOX=!1,T.REFLECTIONMAP_SPHERICAL=!1,T.REFLECTIONMAP_EQUIRECTANGULAR=!1,T.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,T.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,J.coordinatesMode){case E.b.EXPLICIT_MODE:T.REFLECTIONMAP_EXPLICIT=!0;break;case E.b.PLANAR_MODE:T.REFLECTIONMAP_PLANAR=!0;break;case E.b.PROJECTION_MODE:T.REFLECTIONMAP_PROJECTION=!0;break;case E.b.SKYBOX_MODE:T.REFLECTIONMAP_SKYBOX=!0;break;case E.b.SPHERICAL_MODE:T.REFLECTIONMAP_SPHERICAL=!0;break;case E.b.EQUIRECTANGULAR_MODE:T.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case E.b.FIXED_EQUIRECTANGULAR_MODE:T.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case E.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:T.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case E.b.CUBIC_MODE:case E.b.INVCUBIC_MODE:default:T.REFLECTIONMAP_CUBIC=!0,T.USE_LOCAL_REFLECTIONMAP_CUBIC=!!J.boundingBoxSize}J.coordinatesMode!==E.b.SKYBOX_MODE&&(J.irradianceTexture?(T.USEIRRADIANCEMAP=!0,T.USESPHERICALFROMREFLECTIONMAP=!1,T.USESPHERICALINVERTEX=!1,J.irradianceTexture._dominantDirection&&(T.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):J.isCube&&(T.USESPHERICALFROMREFLECTIONMAP=!0,T.USEIRRADIANCEMAP=!1,T.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||B.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?T.USESPHERICALINVERTEX=!1:T.USESPHERICALINVERTEX=!0))}else T.REFLECTION=!1,T.REFLECTIONMAP_3D=!1,T.REFLECTIONMAP_SPHERICAL=!1,T.REFLECTIONMAP_PLANAR=!1,T.REFLECTIONMAP_CUBIC=!1,T.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,T.REFLECTIONMAP_PROJECTION=!1,T.REFLECTIONMAP_SKYBOX=!1,T.REFLECTIONMAP_EXPLICIT=!1,T.REFLECTIONMAP_EQUIRECTANGULAR=!1,T.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,T.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,T.INVERTCUBICMAP=!1,T.USESPHERICALFROMREFLECTIONMAP=!1,T.USEIRRADIANCEMAP=!1,T.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,T.USESPHERICALINVERTEX=!1,T.REFLECTIONMAP_OPPOSITEZ=!1,T.LODINREFLECTIONALPHA=!1,T.GAMMAREFLECTION=!1,T.RGBDREFLECTION=!1,T.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&l.e.LightmapTextureEnabled?((0,p.P)(this._lightmapTexture,T,"LIGHTMAP"),T.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,T.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,T.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):T.LIGHTMAP=!1,this._emissiveTexture&&l.e.EmissiveTextureEnabled?((0,p.P)(this._emissiveTexture,T,"EMISSIVE"),T.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):T.EMISSIVE=!1,l.e.SpecularTextureEnabled?(this._metallicTexture?((0,p.P)(this._metallicTexture,T,"REFLECTIVITY"),T.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,T.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,T.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,T.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,T.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,p.P)(this._reflectivityTexture,T,"REFLECTIVITY"),T.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,T.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,T.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):T.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(T.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,p.P)(this._metallicReflectanceTexture,T,"METALLIC_REFLECTANCE"),T.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):T.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,p.P)(this._reflectanceTexture,T,"REFLECTANCE"),T.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):T.REFLECTANCE=!1):(T.METALLIC_REFLECTANCE=!1,T.REFLECTANCE=!1),this._microSurfaceTexture?(0,p.P)(this._microSurfaceTexture,T,"MICROSURFACEMAP"):T.MICROSURFACEMAP=!1):(T.REFLECTIVITY=!1,T.MICROSURFACEMAP=!1),B.getCaps().standardDerivatives&&this._bumpTexture&&l.e.BumpTextureEnabled&&!this._disableBumpMap?((0,p.P)(this._bumpTexture,T,"BUMP"),this._useParallax&&this._albedoTexture&&l.e.DiffuseTextureEnabled?(T.PARALLAX=!0,T.PARALLAX_RHS=j.useRightHandedSystem,T.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):T.PARALLAX=!1,T.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(T.BUMP=!1,T.PARALLAX=!1,T.PARALLAX_RHS=!1,T.PARALLAXOCCLUSION=!1,T.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&l.e.ReflectionTextureEnabled?(T.ENVIRONMENTBRDF=!0,T.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(T.ENVIRONMENTBRDF=!1,T.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?T.ALPHAFROMALBEDO=!0:T.ALPHAFROMALBEDO=!1}T.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===O.LIGHTFALLOFF_STANDARD?(T.USEPHYSICALLIGHTFALLOFF=!1,T.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===O.LIGHTFALLOFF_GLTF?(T.USEPHYSICALLIGHTFALLOFF=!1,T.USEGLTFLIGHTFALLOFF=!0):(T.USEPHYSICALLIGHTFALLOFF=!0,T.USEGLTFLIGHTFALLOFF=!1),T.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.zi&&this._twoSidedLighting?T.TWOSIDEDLIGHTING=!0:T.TWOSIDEDLIGHTING=!1,T.MIRRORED=!!j._mirroredCameraPosition,T.SPECULARAA=B.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(T._areTexturesDirty||T._areMiscDirty)&&(T.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,T.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,T.ALPHABLEND=this.needAlphaBlendingForMesh(J),T.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,T.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),T._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(T),T.FORCENORMALFORWARD=this._forceNormalForward,T.RADIANCEOCCLUSION=this._useRadianceOcclusion,T.HORIZONOCCLUSION=this._useHorizonOcclusion,T._areMiscDirty&&((0,p.Q)(J,j,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(J),T,this._applyDecalMapAfterDetailMap),T.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!J.isVerticesDataPresent(A.e.NormalKind),T.DEBUGMODE=this._debugMode),(0,p.J)(j,B,this,T,!!b,q,t),this._eventInfo.defines=T,this._eventInfo.mesh=J,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,p.I)(J,T,!0,!0,!0,this._transparencyMode!==O.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(J,T,b){const q={clipPlane:!1,useInstances:!1,...b};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const b=new m(this._eventInfo.defineNames),t=this._prepareEffect(J,b,void 0,void 0,q.useInstances,q.clipPlane,J.hasThinInstances);this._onEffectCreatedObservable&&(i.effect=t,i.subMesh=null,this._onEffectCreatedObservable.notifyObservers(i)),t.isReady()?T&&T(this):t.onCompileObservable.add((()=>{T&&T(this)}))})()}buildUniformLayout(){const J=this._uniformBuffer;J.addUniform("vAlbedoInfos",2),J.addUniform("vBaseWeightInfos",2),J.addUniform("vBaseDiffuseRoughnessInfos",2),J.addUniform("vAmbientInfos",4),J.addUniform("vOpacityInfos",2),J.addUniform("vEmissiveInfos",2),J.addUniform("vLightmapInfos",2),J.addUniform("vReflectivityInfos",3),J.addUniform("vMicroSurfaceSamplerInfos",2),J.addUniform("vReflectionInfos",2),J.addUniform("vReflectionFilteringInfo",2),J.addUniform("vReflectionPosition",3),J.addUniform("vReflectionSize",3),J.addUniform("vBumpInfos",3),J.addUniform("albedoMatrix",16),J.addUniform("baseWeightMatrix",16),J.addUniform("baseDiffuseRoughnessMatrix",16),J.addUniform("ambientMatrix",16),J.addUniform("opacityMatrix",16),J.addUniform("emissiveMatrix",16),J.addUniform("lightmapMatrix",16),J.addUniform("reflectivityMatrix",16),J.addUniform("microSurfaceSamplerMatrix",16),J.addUniform("bumpMatrix",16),J.addUniform("vTangentSpaceParams",2),J.addUniform("reflectionMatrix",16),J.addUniform("vReflectionColor",3),J.addUniform("vAlbedoColor",4),J.addUniform("baseWeight",1),J.addUniform("baseDiffuseRoughness",1),J.addUniform("vLightingIntensity",4),J.addUniform("vReflectionMicrosurfaceInfos",3),J.addUniform("vReflectionDominantDirection",3),J.addUniform("pointSize",1),J.addUniform("vReflectivityColor",4),J.addUniform("vEmissiveColor",3),J.addUniform("vAmbientColor",3),J.addUniform("vDebugMode",2),J.addUniform("vMetallicReflectanceFactors",4),J.addUniform("vMetallicReflectanceInfos",2),J.addUniform("metallicReflectanceMatrix",16),J.addUniform("vReflectanceInfos",2),J.addUniform("reflectanceMatrix",16),J.addUniform("vSphericalL00",3),J.addUniform("vSphericalL1_1",3),J.addUniform("vSphericalL10",3),J.addUniform("vSphericalL11",3),J.addUniform("vSphericalL2_2",3),J.addUniform("vSphericalL2_1",3),J.addUniform("vSphericalL20",3),J.addUniform("vSphericalL21",3),J.addUniform("vSphericalL22",3),J.addUniform("vSphericalX",3),J.addUniform("vSphericalY",3),J.addUniform("vSphericalZ",3),J.addUniform("vSphericalXX_ZZ",3),J.addUniform("vSphericalYY_ZZ",3),J.addUniform("vSphericalZZ",3),J.addUniform("vSphericalXY",3),J.addUniform("vSphericalYZ",3),J.addUniform("vSphericalZX",3),J.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(J,T,b){const q=this.va(),t=b.materialDefines;if(!t)return;const j=b.effect;if(!j)return;this._activeEffect=j,T.getMeshUniformBuffer().bindToEffect(j,"Mesh"),T.transferToEffect(J);const B=q.getEngine();this._uniformBuffer.bindToEffect(j,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,q,T,J,this.isFrozen),h.d.Bind(B.currentRenderPassId,this._activeEffect,T,J,this);const Y=q.activeCamera;Y?this._uniformBuffer.updateFloat4("cameraInfo",Y.wi,Y.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=b,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),t.OBJECTSPACE_NORMALMAP&&(J.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const F=this._mustRebind(q,j,b,T.visibility);(0,p.b)(T,this._activeEffect,this.prePassConfiguration);let A=null;const a=this._uniformBuffer;if(F){if(this.bindViewProjection(j),A=this._getReflectionTexture(),!a.useUbo||!this.isFrozen||!a.isSync||b._drawWrapper._forceRebindOnNextCall){var P;if(q.texturesEnabled){if(this._albedoTexture&&l.e.DiffuseTextureEnabled&&(a.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,p.q)(this._albedoTexture,a,"albedo")),this._baseWeightTexture&&l.e.BaseWeightTextureEnabled&&(a.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,p.q)(this._baseWeightTexture,a,"baseWeight")),this._baseDiffuseRoughnessTexture&&l.e.BaseDiffuseRoughnessTextureEnabled&&(a.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,p.q)(this._baseDiffuseRoughnessTexture,a,"baseDiffuseRoughness")),this._ambientTexture&&l.e.AmbientTextureEnabled&&(a.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,p.q)(this._ambientTexture,a,"ambient")),this._opacityTexture&&l.e.OpacityTextureEnabled&&(a.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,p.q)(this._opacityTexture,a,"opacity")),A&&l.e.ReflectionTextureEnabled){if(a.Zi("reflectionMatrix",A.getReflectionTextureMatrix()),a.updateFloat2("vReflectionInfos",A.level*q.iblIntensity,0),A.boundingBoxSize){const J=A;a.updateVector3("vReflectionPosition",J.boundingBoxPosition),a.updateVector3("vReflectionSize",J.boundingBoxSize)}if(this.realTimeFiltering){const J=A.getSize().width;a.updateFloat2("vReflectionFilteringInfo",J,Math.log2(J))}if(t.USEIRRADIANCEMAP)t.USEIRRADIANCEMAP&&t.USE_IRRADIANCE_DOMINANT_DIRECTION&&a.updateVector3("vReflectionDominantDirection",A.irradianceTexture._dominantDirection);else{const J=A.sphericalPolynomial;if(t.USESPHERICALFROMREFLECTIONMAP&&J)if(t.SPHERICAL_HARMONICS){const T=J.preScaledHarmonics;a.updateVector3("vSphericalL00",T.l00),a.updateVector3("vSphericalL1_1",T.l1_1),a.updateVector3("vSphericalL10",T.l10),a.updateVector3("vSphericalL11",T.l11),a.updateVector3("vSphericalL2_2",T.l2_2),a.updateVector3("vSphericalL2_1",T.l2_1),a.updateVector3("vSphericalL20",T.l20),a.updateVector3("vSphericalL21",T.l21),a.updateVector3("vSphericalL22",T.l22)}else a.updateFloat3("vSphericalX",J.x.x,J.x.y,J.x.z),a.updateFloat3("vSphericalY",J.y.x,J.y.y,J.y.z),a.updateFloat3("vSphericalZ",J.z.x,J.z.y,J.z.z),a.updateFloat3("vSphericalXX_ZZ",J.xx.x-J.zz.x,J.xx.y-J.zz.y,J.xx.z-J.zz.z),a.updateFloat3("vSphericalYY_ZZ",J.yy.x-J.zz.x,J.yy.y-J.zz.y,J.yy.z-J.zz.z),a.updateFloat3("vSphericalZZ",J.zz.x,J.zz.y,J.zz.z),a.updateFloat3("vSphericalXY",J.xy.x,J.xy.y,J.xy.z),a.updateFloat3("vSphericalYZ",J.yz.x,J.yz.y,J.yz.z),a.updateFloat3("vSphericalZX",J.zx.x,J.zx.y,J.zx.z)}a.updateFloat3("vReflectionMicrosurfaceInfos",A.getSize().width,A.lodGenerationScale,A.lodGenerationOffset)}this._emissiveTexture&&l.e.EmissiveTextureEnabled&&(a.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,p.q)(this._emissiveTexture,a,"emissive")),this._lightmapTexture&&l.e.LightmapTextureEnabled&&(a.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,p.q)(this._lightmapTexture,a,"lightmap")),l.e.SpecularTextureEnabled&&(this._metallicTexture?(a.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,p.q)(this._metallicTexture,a,"reflectivity")):this._reflectivityTexture&&(a.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,p.q)(this._reflectivityTexture,a,"reflectivity")),this._metallicReflectanceTexture&&(a.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,p.q)(this._metallicReflectanceTexture,a,"metallicReflectance")),this._reflectanceTexture&&t.REFLECTANCE&&(a.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,p.q)(this._reflectanceTexture,a,"reflectance")),this._microSurfaceTexture&&(a.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,p.q)(this._microSurfaceTexture,a,"microSurfaceSampler"))),this._bumpTexture&&B.getCaps().standardDerivatives&&l.e.BumpTextureEnabled&&!this._disableBumpMap&&(a.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,p.q)(this._bumpTexture,a,"bump"),q._mirroredCameraPosition?a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&a.updateFloat("pointSize",this.pointSize),t.METALLICWORKFLOW){var v;I.g.Wi[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,I.g.Wi[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const J=(null===(v=this.subSurface)||void 0===v?void 0:v._indexOfRefraction)??1.5,T=1;I.g.Wi[0].b=J;const b=Math.pow((J-T)/(J+T),2);I.g.Wi[0].a=b,a.updateDirectColor4("vReflectivityColor",I.g.Wi[0]),a.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else a.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);a.updateColor3("vEmissiveColor",l.e.EmissiveTextureEnabled?this._emissiveColor:I.b.BlackReadOnly),a.updateColor3("vReflectionColor",this._reflectionColor),!t.SS_REFRACTION&&null!==(P=this.subSurface)&&void 0!==P&&P._linkRefractionWithTransparency?a.updateColor4("vAlbedoColor",this._albedoColor,1):a.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),a.updateFloat("baseWeight",this._baseWeight),a.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*q.environmentIntensity,this._lightingInfos.w=this._specularIntensity,a.updateVector4("vLightingIntensity",this._lightingInfos),q.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),a.updateColor3("vAmbientColor",this._globalAmbientColor),a.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(q.texturesEnabled){if(this._albedoTexture&&l.e.DiffuseTextureEnabled&&a.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&l.e.BaseWeightTextureEnabled&&a.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&l.e.BaseDiffuseRoughnessTextureEnabled&&a.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&l.e.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&l.e.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),A&&l.e.ReflectionTextureEnabled){t.LODBASEDMICROSFURACE?a.setTexture("reflectionSampler",A):(a.setTexture("reflectionSampler",A._lodTextureMid||A),a.setTexture("reflectionSamplerLow",A._lodTextureLow||A),a.setTexture("reflectionSamplerHigh",A._lodTextureHigh||A)),t.USEIRRADIANCEMAP&&a.setTexture("irradianceSampler",A.irradianceTexture);const J=this.va().iblCdfGenerator;this.realTimeFiltering&&J&&a.setTexture("icdfSampler",J.getIcdfTexture())}t.ENVIRONMENTBRDF&&a.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&l.e.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&l.e.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),l.e.SpecularTextureEnabled&&(this._metallicTexture?a.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&a.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&a.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&t.REFLECTANCE&&a.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&a.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&B.getCaps().standardDerivatives&&l.e.BumpTextureEnabled&&!this._disableBumpMap&&a.setTexture("bumpSampler",this._bumpTexture)}this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(T)&&this.va().depthPeelingRenderer.bind(j),this._eventInfo.subMesh=b,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,Q.h)(this._activeEffect,this,q),this.bindEyePosition(j)}else q.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(F||!this.isFrozen){var G;if(q.lightsEnabled&&!this._disableLighting&&(0,p.f)(q,T,this._activeEffect,t,this._maxSimultaneousLights),(q.fogEnabled&&T.applyFog&&q.fogMode!==C.b.FOGMODE_NONE||A||this.subSurface.refractionTexture||T.receiveShadows||t.PREPASS)&&this.bindView(j),(0,p.c)(q,T,this._activeEffect,!0),t.NUM_MORPH_INFLUENCERS&&(0,p.m)(T,this._activeEffect),t.BAKED_VERTEX_ANIMATION_TEXTURE)null===(G=T.bakedVertexAnimationManager)||void 0===G||G.bind(j,t.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,p.j)(t,this._activeEffect,q)}this._afterBind(T,this._activeEffect,b),a.update()}getAnimatables(){const J=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&J.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&J.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&J.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&J.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&J.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&J.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&J.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?J.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&J.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&J.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&J.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&J.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&J.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&J.push(this._microSurfaceTexture),J}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const J=super.getActiveTextures();return this._albedoTexture&&J.push(this._albedoTexture),this._baseWeightTexture&&J.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&J.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&J.push(this._ambientTexture),this._opacityTexture&&J.push(this._opacityTexture),this._reflectionTexture&&J.push(this._reflectionTexture),this._emissiveTexture&&J.push(this._emissiveTexture),this._reflectivityTexture&&J.push(this._reflectivityTexture),this._metallicTexture&&J.push(this._metallicTexture),this._metallicReflectanceTexture&&J.push(this._metallicReflectanceTexture),this._reflectanceTexture&&J.push(this._reflectanceTexture),this._microSurfaceTexture&&J.push(this._microSurfaceTexture),this._bumpTexture&&J.push(this._bumpTexture),this._lightmapTexture&&J.push(this._lightmapTexture),J}hasTexture(J){return!!super.hasTexture(J)||(this._albedoTexture===J||(this._baseWeightTexture===J||(this._baseDiffuseRoughnessTexture===J||(this._ambientTexture===J||(this._opacityTexture===J||(this._reflectionTexture===J||(this._emissiveTexture===J||(this._reflectivityTexture===J||(this._metallicTexture===J||(this._metallicReflectanceTexture===J||(this._reflectanceTexture===J||(this._microSurfaceTexture===J||(this._bumpTexture===J||this._lightmapTexture===J)))))))))))))}setPrePassRenderer(){var J;if(null===(J=this.subSurface)||void 0===J||!J.isScatteringEnabled)return!1;const T=this.va().enableSubSurfaceForPrePass();return T&&(T.enabled=!0),!0}dispose(J,T){var b,q,t,j,B,Y,C,F,A,a,P,v,G,x;(this._breakShaderLoadedCheck=!0,T)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(b=this._albedoTexture)||void 0===b||b.dispose(),null===(q=this._baseWeightTexture)||void 0===q||q.dispose(),null===(t=this._baseDiffuseRoughnessTexture)||void 0===t||t.dispose(),null===(j=this._ambientTexture)||void 0===j||j.dispose(),null===(B=this._opacityTexture)||void 0===B||B.dispose(),null===(Y=this._reflectionTexture)||void 0===Y||Y.dispose(),null===(C=this._emissiveTexture)||void 0===C||C.dispose(),null===(F=this._metallicTexture)||void 0===F||F.dispose(),null===(A=this._reflectivityTexture)||void 0===A||A.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(P=this._lightmapTexture)||void 0===P||P.dispose(),null===(v=this._metallicReflectanceTexture)||void 0===v||v.dispose(),null===(G=this._reflectanceTexture)||void 0===G||G.dispose(),null===(x=this._microSurfaceTexture)||void 0===x||x.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(J,T)}}O.PBRMATERIAL_OPAQUE=U.c.MATERIAL_OPAQUE,O.PBRMATERIAL_ALPHATEST=U.c.MATERIAL_ALPHATEST,O.PBRMATERIAL_ALPHABLEND=U.c.MATERIAL_ALPHABLEND,O.PBRMATERIAL_ALPHATESTANDBLEND=U.c.MATERIAL_ALPHATESTANDBLEND,O.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,O.LIGHTFALLOFF_PHYSICAL=0,O.LIGHTFALLOFF_GLTF=1,O.LIGHTFALLOFF_STANDARD=2,O.ForceGLSL=!1,(0,q.e)([(0,t.u)()],O.prototype,"_imageProcessingConfiguration",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsMiscDirty")],O.prototype,"debugMode",void 0)},12544:(J,T,b)=>{"use strict";b.d(T,{c:()=>P});var q=b(674),t=b(680),j=b(505),B=b(697),Y=b(2323),C=b(2319),F=b(639),A=b(497),a=b(727);b(2414);class P extends Y.d{set boundingBoxSize(J){if(this._boundingBoxSize&&this._boundingBoxSize.equals(J))return;this._boundingBoxSize=J;const T=this.va();T&&T.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(J){this._rotationY=J,this.setReflectionTextureMatrix(B.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(J,T,b){let q="";for(const t of J)q+=t;return new P(q,T,null,b,J)}static CreateFromPrefilteredData(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=T.useDelayedTextureLoading;T.useDelayedTextureLoading=!1;const j=new P(J,T,null,!1,null,null,null,void 0,!0,b,q);return T.useDelayedTextureLoading=t,j}constructor(J,T){var b;let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,G=arguments.length>10&&void 0!==arguments[10]&&arguments[10],x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,u=arguments.length>13?arguments[13]:void 0,U=arguments.length>14?arguments[14]:void 0;super(T),this.onLoadObservable=new A.b,this.boundingBoxPosition=B.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new B.e,this._buffer=null,this.name=J,this.url=J,this._noMipmap=t,this.Fj=!1,this.isCube=!0,this._textureMatrix=B.e.Identity(),this.coordinatesMode=C.b.CUBIC_MODE;let K=null,E=null;null===q||Array.isArray(q)?(this._noMipmap=t,this._format=a,this._createPolynomials=G,K=q,this._loaderOptions=u,this._useSRGBBuffer=U,this._lodScale=x,this._lodOffset=I):(K=q.extensions??null,this._noMipmap=q.noMipmap??!1,j=q.files??null,E=q.buffer??null,this._format=q.format??5,P=q.prefiltered??!1,v=q.forcedExtension??null,this._createPolynomials=q.createPolynomials??!1,this._lodScale=q.lodScale??.8,this._lodOffset=q.lodOffset??0,this._loaderOptions=q.loaderOptions,this._useSRGBBuffer=q.useSRGBBuffer,Y=q.X??null,F=q.onError??null),(J||j)&&this.updateURL(J,v,Y,P,F,K,null===(b=this.va())||void 0===b?void 0:b.useDelayedTextureLoading,j,E)}getClassName(){return"CubeTexture"}updateURL(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=J),this.url=J,T&&(this._forcedExtension=T);const F=J.lastIndexOf("."),A=T||(F>-1?J.substring(F).toLowerCase():""),a=0===A.indexOf(".dds"),P=0===A.indexOf(".env"),v=0===A.indexOf(".basis");if(P?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=q,q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Y)this._files=Y;else if(v||P||a||j||(j=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,j){for(let T=0;T<j.length;T++)this._files.push(J+j[T]);this._extensions=j}this._buffer=C,B?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=t):this._loadTexture(b,t)}delayLoad(J){4===this.delayLoadState&&(J&&(this._forcedExtension=J),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(J){var T,b;if(J.updateFlag===this._textureMatrix.updateFlag)return;J.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(J=>-1!==J.getActiveTextures().indexOf(this))));if(this._textureMatrix=J,null===(T=this.va())||void 0===T||!T.useRightHandedSystem)return;const q=B.j.pi[0],t=B.j.Quaternion[0],j=B.j.pi[1];this._textureMatrix.decompose(q,t,j),t.z*=-1,t.w*=-1,B.e.ComposeToRef(q,t,j,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var J;return null!==(J=this.va())&&void 0!==J&&J.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.va(),q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const t=()=>{var T;(this.onLoadObservable.notifyObservers(this),q)&&(q.dispose(),null===(T=this.va())||void 0===T||T.markAllMaterialsAsDirty(1));J&&J()},B=(J,b)=>{this._loadingError=!0,this._errorObject={message:J,exception:b},T&&T(J,b),C.b.OnTextureLoadErrorObservable.notifyObservers(this)};var Y;this._texture?this._texture.isReady?j.e.SetImmediate((()=>t())):this._texture.onLoadedObservable.add((()=>t())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,J,B,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,J,B,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(Y=this._texture)||void 0===Y||Y.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(J,T,b){const q=a.d.Parse((()=>{let q=!1;return J.prefiltered&&(q=J.prefiltered),new P(b+(J.url??J.name),T,J.extensions,!1,J.files||null,null,null,void 0,q,J.forcedExtension)}),J,T);if(J.boundingBoxPosition&&(q.boundingBoxPosition=B.n.ni(J.boundingBoxPosition)),J.boundingBoxSize&&(q.boundingBoxSize=B.n.ni(J.boundingBoxSize)),J.animations)for(let t=0;t<J.animations.length;t++){const T=J.animations[t],b=(0,F.c)("BABYLON.Animation");b&&q.animations.push(b.Parse(T))}return q}clone(){let J=0;const T=a.d.Clone((()=>{const T=new P(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return J=T.uniqueId,T}),this);return T.uniqueId=J,T}}(0,q.e)([(0,t.M)()],P.prototype,"url",void 0),(0,q.e)([(0,t.I)()],P.prototype,"boundingBoxPosition",void 0),(0,q.e)([(0,t.I)()],P.prototype,"boundingBoxSize",null),(0,q.e)([(0,t.M)("rotationY")],P.prototype,"rotationY",null),(0,q.e)([(0,t.M)("files")],P.prototype,"_files",void 0),(0,q.e)([(0,t.M)("forcedExtension")],P.prototype,"_forcedExtension",void 0),(0,q.e)([(0,t.M)("extensions")],P.prototype,"_extensions",void 0),(0,q.e)([(0,t.w)("textureMatrix")],P.prototype,"_textureMatrix",void 0),(0,q.e)([(0,t.w)("textureMatrixRefraction")],P.prototype,"_textureMatrixRefraction",void 0),C.b._CubeTextureParser=P.Parse,(0,F.g)("BABYLON.CubeTexture",P)},12868:(J,T,b)=>{"use strict";b.d(T,{b:()=>C});var q=b(519),t=b(2319),j=b(646),B=b(2354),Y=b(615);B.ThinEngine.prototype.createDynamicTexture=function(J,T,b,q){const t=new Y.d(this,4);return t.baseWidth=J,t.baseHeight=T,b&&(J=this.needPOTTextures?(0,j.c)(J,this._caps.maxTextureSize):J,T=this.needPOTTextures?(0,j.c)(T,this._caps.maxTextureSize):T),t.width=J,t.height=T,t.isReady=!1,t.generateMipMaps=b,t.samplingMode=q,this.updateTextureSamplingMode(q,t),this._internalTexturesCache.push(t),t},B.ThinEngine.prototype.updateDynamicTexture=function(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!J)return;const B=this._gl,Y=B.TEXTURE_2D,C=this._bindTextureDirectly(Y,J,!0,j);this._unpackFlipY(void 0===b?J.invertY:b),q&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const F=this._getWebGLTextureType(J.type),A=this._getInternalFormat(t||J.format),a=this._getRGBABufferInternalSizedFormat(J.type,A);B.texImage2D(Y,0,a,A,F,T),J.generateMipMaps&&B.generateMipmap(Y),C||this._bindTextureDirectly(Y,null),q&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t&&(J.format=t),J._dynamicTextureSource=T,J._premulAlpha=q,J.invertY=b||!1,J.isReady=!0};class C extends t.b{constructor(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,Y=arguments.length>6?arguments[6]:void 0;const C=!b||b._isScene;super(null,C?b:null===b||void 0===b?void 0:b.cg,C?!q:b,Y,j,void 0,void 0,void 0,void 0,B),this.name=J,this.wrapU=t.b.CLAMP_ADDRESSMODE,this.wrapV=t.b.CLAMP_ADDRESSMODE,this._generateMipMaps=q;const F=this._getEngine();if(!F)return;if(T.getContext)this._canvas=T,this._ownCanvas=!1,this._texture=F.createDynamicTexture(this._canvas.width,this._canvas.height,q,j);else{this._canvas=F.createCanvas(1,1),this._ownCanvas=!0;const J=T;J.width||0===J.width?this._texture=F.createDynamicTexture(J.width,J.height,q,j):this._texture=F.createDynamicTexture(T,T,q,j)}const A=this.getSize();this._canvas.width!==A.width&&(this._canvas.width=A.width),this._canvas.height!==A.height&&(this._canvas.height=A.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(J){this._canvas.width=J.width,this._canvas.height=J.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(J.width,J.height,this._generateMipMaps,this.samplingMode)}scale(J){const T=this.getSize();T.width*=J,T.height*=J,this._recreate(T)}scaleTo(J,T){const b=this.getSize();b.width=J,b.height=T,this._recreate(b)}getContext(){return this._context}clear(J){const T=this.getSize();J&&(this._context.fillStyle=J),this._context.clearRect(0,0,T.width,T.height)}update(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===J||J,T,this._format||void 0,void 0,b)}drawText(J,T,b,q,t,j,B){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(j&&(this._context.fillStyle=j,this._context.fillRect(0,0,C.width,C.height)),this._context.font=q,null===T||void 0===T){const b=this._context.measureText(J);T=(C.width-b.width)/2}if(null===b||void 0===b){const J=parseInt(q.replace(/\D/g,""));b=C.height/2+J/3.65}this._context.fillStyle=t||"",this._context.fillText(J,T,b),Y&&this.update(B)}dispose(){var J,T;(super.dispose(),this._ownCanvas)&&(null===(J=this._canvas)||void 0===J||null===(T=J.remove)||void 0===T||T.call(J));this._canvas=null,this._context=null}clone(){const J=this.va();if(!J)return this;const T=this.getSize(),b=new C(this.name,T,J,this._generateMipMaps);return b.Fj=this.Fj,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const J=this.va();J&&!J.isReady()&&q.d.Warn("The scene must be ready before serializing the dynamic texture");const T=super.serialize();return C._IsCanvasElement(this._canvas)&&(T.base64String=this._canvas.toDataURL()),T.invertY=this._invertY,T.samplingMode=this.samplingMode,T}static _IsCanvasElement(J){return void 0!==J.toDataURL}_rebuild(){this.update()}}},12101:(J,T,b)=>{"use strict";b.d(T,{e:()=>t});var q=b(2319);class t extends q.b{constructor(J,T,b,t,j){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,a=arguments.length>10?arguments[10]:void 0,P=arguments.length>11?arguments[11]:void 0;super(null,j,!B,Y,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,A),this.format=t,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==F||(C=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==F||(C=1),this._texture=this._engine.createRawTexture(J,T,b,t,B,Y,C,null,F,A??0,a??!1),this.wrapU=q.b.CLAMP_ADDRESSMODE,this.wrapV=q.b.CLAMP_ADDRESSMODE,this._waitingForData=!!P&&!J)}update(J){this._getEngine().updateRawTexture(this._texture,J,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const J=new t(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return J._texture=this._texture,this._texture.incrementReferences(),J}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(J,T,b,q){return new t(J,T,b,1,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(J,T,b,q){return new t(J,T,b,2,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(J,T,b,q){return new t(J,T,b,0,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(J,T,b,q){return new t(J,T,b,4,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(J,T,b,q){return new t(J,T,b,5,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(J,T,b,q){return new t(J,T,b,5,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(J,T,b,j){let B=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q.b.TRILINEAR_SAMPLINGMODE;return new t(J,T,b,6,j,B,Y,C,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(J,T,b,j){let B=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q.b.TRILINEAR_SAMPLINGMODE;return new t(J,T,b,6,j,B,Y,C,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12400:(J,T,b)=>{"use strict";b.d(T,{d:()=>t});var q=b(2319);class t extends q.b{get depth(){return this._depth}constructor(J,T,b,t,j,B){let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:q.b.TRILINEAR_SAMPLINGMODE,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,a=arguments.length>10?arguments[10]:void 0;super(null,B,!Y,C),this.format=j,this._texture=B.getEngine().createRawTexture2DArray(J,T,b,t,j,Y,C,F,null,A,a),this._depth=t,this.is2DArray=!0}update(J){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,J,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(J,T,b,q,j){return new t(J,T,b,q,5,j,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12005:(J,T,b)=>{"use strict";b.d(T,{d:()=>q});class q{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(J,T){this._defines[J]||(J<this._currentRank&&(this._currentRank=J),J>this._maxRank&&(this._maxRank=J),this._defines[J]=new Array),this._defines[J].push(T)}addCPUSkinningFallback(J,T){this._mesh=T,J<this._currentRank&&(this._currentRank=J),J>this._maxRank&&(this._maxRank=J)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(J,T){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,J=J.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),T._bonesComputationForcedToCPU=!0;const b=this._mesh.va();for(let J=0;J<b.meshes.length;J++){const q=b.meshes[J];if(q.material){if(q.computeBonesUsingShaders&&0!==q.numBoneInfluencers)if(q.material.getEffect()===T)q.computeBonesUsingShaders=!1;else if(q.xi)for(const J of q.xi){if(J.effect===T){q.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&q.computeBonesUsingShaders&&q.numBoneInfluencers>0&&(q.computeBonesUsingShaders=!1)}}else{const T=this._defines[this._currentRank];if(T)for(let b=0;b<T.length;b++)J=J.replace("#define "+T[b],"");this._currentRank++}return J}}},12011:(J,T,b)=>{"use strict";b.d(T,{e:()=>a});var q=b(674),t=b(855),j=b(680),B=b(12002),Y=b(11994),C=b(12016),F=b(864);class A extends Y.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class a extends C.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(J,"DetailMap",140,new A,T),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=t.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=J._dirtyCallbacks[1]}isReadyForSubMesh(J,T,b){return!this._isEnabled||!(J._areTexturesDirty&&T.texturesEnabled&&b.getCaps().standardDerivatives&&this._texture&&B.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(J,T){if(this._isEnabled){J.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const b=T.getEngine();J._areTexturesDirty&&(b.getCaps().standardDerivatives&&this._texture&&B.e.DetailTextureEnabled&&this._isEnabled?((0,F.P)(this._texture,J,"DETAIL"),J.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):J.DETAIL=!1)}else J.DETAIL=!1}bindForSubMesh(J,T){if(!this._isEnabled)return;const b=this._material.isFrozen;J.useUbo&&b&&J.isSync||this._texture&&B.e.DetailTextureEnabled&&(J.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,F.q)(this._texture,J,"detail")),T.texturesEnabled&&this._texture&&B.e.DetailTextureEnabled&&J.setTexture("detailSampler",this._texture)}hasTexture(J){return this._texture===J}getActiveTextures(J){this._texture&&J.push(this._texture)}getAnimatables(J){this._texture&&this._texture.animations&&this._texture.animations.length>0&&J.push(this._texture)}dispose(J){var T;J&&(null===(T=this._texture)||void 0===T||T.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(J){J.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,q.e)([(0,j.D)("detailTexture"),(0,j.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"texture",void 0),(0,q.e)([(0,j.M)()],a.prototype,"diffuseBlendLevel",void 0),(0,q.e)([(0,j.M)()],a.prototype,"roughnessBlendLevel",void 0),(0,q.e)([(0,j.M)()],a.prototype,"bumpLevel",void 0),(0,q.e)([(0,j.M)(),(0,j.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"normalBlendMethod",void 0),(0,q.e)([(0,j.M)(),(0,j.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"isEnabled",void 0)},11994:(J,T,b)=>{"use strict";b.d(T,{d:()=>q});class q{constructor(J){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=J,J)for(const T in J)Object.prototype.hasOwnProperty.call(J,T)&&this._setDefaultValue(T)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||J,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const J of Object.keys(this))"_"!==J[0]&&this._keys.push(J);if(this._externalProperties)for(const J in this._externalProperties)-1===this._keys.indexOf(J)&&this._keys.push(J)}isEqual(J){if(this._keys.length!==J._keys.length)return!1;for(let T=0;T<this._keys.length;T++){const b=this._keys[T];if(this[b]!==J[b])return!1}return!0}cloneTo(J){this._keys.length!==J._keys.length&&(J._keys=this._keys.slice(0));for(let T=0;T<this._keys.length;T++){const b=this._keys[T];J[b]=this[b]}}reset(){for(const J of this._keys)this._setDefaultValue(J)}_setDefaultValue(J){var T,b,q,t;const j=(null===(T=this._externalProperties)||void 0===T||null===(b=T[J])||void 0===b?void 0:b.type)??typeof this[J],B=null===(q=this._externalProperties)||void 0===q||null===(t=q[J])||void 0===t?void 0:t.default;switch(j){case"number":this[J]=B??0;break;case"string":this[J]=B??"";break;default:this[J]=B??!1}}toString(){let J="";for(let T=0;T<this._keys.length;T++){const b=this._keys[T],q=this[b];switch(typeof q){case"number":case"string":J+="#define "+b+" "+q+"\n";break;default:q&&(J+="#define "+b+"\n")}}return J}}},12002:(J,T,b)=>{"use strict";b.d(T,{e:()=>t});var q=b(581);class t{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(J){this._DiffuseTextureEnabled!==J&&(this._DiffuseTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(J){this._BaseWeightTextureEnabled!==J&&(this._BaseWeightTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(J){this._BaseDiffuseRoughnessTextureEnabled!==J&&(this._BaseDiffuseRoughnessTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(J){this._DetailTextureEnabled!==J&&(this._DetailTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(J){this._DecalMapEnabled!==J&&(this._DecalMapEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(J){this._AmbientTextureEnabled!==J&&(this._AmbientTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(J){this._OpacityTextureEnabled!==J&&(this._OpacityTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(J){this._ReflectionTextureEnabled!==J&&(this._ReflectionTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(J){this._EmissiveTextureEnabled!==J&&(this._EmissiveTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(J){this._SpecularTextureEnabled!==J&&(this._SpecularTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(J){this._BumpTextureEnabled!==J&&(this._BumpTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(J){this._LightmapTextureEnabled!==J&&(this._LightmapTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(J){this._RefractionTextureEnabled!==J&&(this._RefractionTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(J){this._ColorGradingTextureEnabled!==J&&(this._ColorGradingTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(J){this._FresnelEnabled!==J&&(this._FresnelEnabled=J,q.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(J){this._ClearCoatTextureEnabled!==J&&(this._ClearCoatTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(J){this._ClearCoatBumpTextureEnabled!==J&&(this._ClearCoatBumpTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(J){this._ClearCoatTintTextureEnabled!==J&&(this._ClearCoatTintTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(J){this._SheenTextureEnabled!==J&&(this._SheenTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(J){this._AnisotropicTextureEnabled!==J&&(this._AnisotropicTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(J){this._ThicknessTextureEnabled!==J&&(this._ThicknessTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(J){this._RefractionIntensityTextureEnabled!==J&&(this._RefractionIntensityTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(J){this._TranslucencyIntensityTextureEnabled!==J&&(this._TranslucencyIntensityTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(J){this._TranslucencyColorTextureEnabled!==J&&(this._TranslucencyColorTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(J){this._IridescenceTextureEnabled!==J&&(this._IridescenceTextureEnabled=J,q.b.MarkAllMaterialsAsDirty(1))}}t._DiffuseTextureEnabled=!0,t._BaseWeightTextureEnabled=!0,t._BaseDiffuseRoughnessTextureEnabled=!0,t._DetailTextureEnabled=!0,t._DecalMapEnabled=!0,t._AmbientTextureEnabled=!0,t._OpacityTextureEnabled=!0,t._ReflectionTextureEnabled=!0,t._EmissiveTextureEnabled=!0,t._SpecularTextureEnabled=!0,t._BumpTextureEnabled=!0,t._LightmapTextureEnabled=!0,t._RefractionTextureEnabled=!0,t._ColorGradingTextureEnabled=!0,t._FresnelEnabled=!0,t._ClearCoatTextureEnabled=!0,t._ClearCoatBumpTextureEnabled=!0,t._ClearCoatTintTextureEnabled=!0,t._SheenTextureEnabled=!0,t._AnisotropicTextureEnabled=!0,t._ThicknessTextureEnabled=!0,t._RefractionIntensityTextureEnabled=!0,t._TranslucencyIntensityTextureEnabled=!0,t._TranslucencyColorTextureEnabled=!0,t._IridescenceTextureEnabled=!0},12023:(J,T,b)=>{"use strict";b.d(T,{d:()=>j});var q,t=b(697);!function(J){J[J.Zero=0]="Zero",J[J.One=1]="One",J[J.MaxViewZ=2]="MaxViewZ"}(q||(q={}));class j{static CreateConfiguration(J){return j._Configurations[J]={defines:{},previousWorldMatrices:{},previousViewProjection:t.e.Zero(),currentViewProjection:t.e.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},j._Configurations[J]}static DeleteConfiguration(J){delete j._Configurations[J]}static GetConfiguration(J){return j._Configurations[J]}static AddUniformsAndSamplers(J,T){J.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(J,T){for(const b of T)if(b.xi)for(const T of b.xi)T._removeDrawWrapper(J)}static PrepareDefines(J,T,b){if(!b._arePrePassDirty)return;const q=j._Configurations[J];if(!q)return;b.PREPASS=!0,b.PREPASS_COLOR=!1,b.PREPASS_COLOR_INDEX=-1;let t=0;for(let B=0;B<j.GeometryTextureDescriptions.length;B++){const J=j.GeometryTextureDescriptions[B],T=J.define,Y=J.defineIndex,C=q.defines[Y];void 0!==C?(b[T]=!0,b[Y]=C,t++):(b[T]=!1,delete b[Y])}b.SCENE_MRT_COUNT=t,b.BONES_VELOCITY_ENABLED=T.useBones&&T.computeBonesUsingShaders&&T.skeleton&&!T.skeleton.isUsingTextureForMatrices&&-1===q.excludedSkinnedMesh.indexOf(T)}static Bind(J,T,b,q,t){const B=j._Configurations[J];if(!B)return;const Y=b.va(),C=Y.getEngine();if(B.reverseCulling&&C.setStateCullFaceType(Y._mirroredCameraPosition?t.cullBackFaces:!t.cullBackFaces),(void 0!==B.defines.PREPASS_VELOCITY_INDEX||void 0!==B.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(B.previousWorldMatrices[b.uniqueId]||(B.previousWorldMatrices[b.uniqueId]=q.clone()),B.previousViewProjection||(B.previousViewProjection=Y.getTransformMatrix().clone(),B.currentViewProjection=Y.getTransformMatrix().clone()),B.currentViewProjection.updateFlag!==Y.getTransformMatrix().updateFlag?(B.lastUpdateFrameId=C.frameId,B.previousViewProjection.p(B.currentViewProjection),B.currentViewProjection.p(Y.getTransformMatrix())):B.lastUpdateFrameId!==C.frameId&&(B.lastUpdateFrameId=C.frameId,B.previousViewProjection.p(B.currentViewProjection)),T.setMatrix("previousWorld",B.previousWorldMatrices[b.uniqueId]),T.setMatrix("previousViewProjection",B.previousViewProjection),B.previousWorldMatrices[b.uniqueId]=q.clone(),b.useBones&&b.computeBonesUsingShaders&&b.skeleton)){const J=b.skeleton;if(!J.isUsingTextureForMatrices||-1===T.getUniformIndex("boneTextureWidth")){const q=J.getTransformMatrices(b);q&&(B.previousBones[b.uniqueId]||(B.previousBones[b.uniqueId]=q.slice()),T.setMatrices("mPreviousBones",B.previousBones[b.uniqueId]),B.previousBones[b.uniqueId].set(q))}}}}j.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],j._Configurations={}},12016:(J,T,b)=>{"use strict";b.d(T,{c:()=>u});var q=b(674),t=b(680),j=b(855),B=b(550),Y=b(568),C=b(596);const F=new RegExp("^([gimus]+)!");class A{constructor(J){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=J,this._scene=J.va(),this._engine=this._scene.getEngine()}_addPlugin(J){for(let q=0;q<this._plugins.length;++q)if(this._plugins[q].name===J.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!J.isCompatible(this._material.shaderLanguage))throw`The plugin "${J.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const T=J.getClassName();A._MaterialPluginClassToMainDefine[T]||(A._MaterialPluginClassToMainDefine[T]="MATERIALPLUGIN_"+ ++A._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(J,T)=>this._handlePluginEvent(J,T),this._plugins.push(J),this._plugins.sort(((J,T)=>J.priority-T.priority)),this._codeInjectionPoints={};const b={};b[A._MaterialPluginClassToMainDefine[T]]={type:"boolean",default:!0};for(const q of this._plugins)q.collectDefines(b),this._collectPointNames("vertex",q.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",q.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=b,!0}_activatePlugin(J){-1===this._activePlugins.indexOf(J)&&(this._activePlugins.push(J),this._activePlugins.sort(((J,T)=>J.priority-T.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),J.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(J),this._activePluginsForExtraEvents.sort(((J,T)=>J.priority-T.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(J){for(let T=0;T<this._plugins.length;++T)if(this._plugins[T].name===J)return this._plugins[T];return null}_handlePluginEventIsReadyForSubMesh(J){let T=!0;for(const b of this._activePlugins)T=T&&b.isReadyForSubMesh(J.defines,this._scene,this._engine,J.subMesh);J.isReadyForSubMesh=T}_handlePluginEventPrepareDefinesBeforeAttributes(J){for(const T of this._activePlugins)T.prepareDefinesBeforeAttributes(J.defines,this._scene,J.mesh)}_handlePluginEventPrepareDefines(J){for(const T of this._activePlugins)T.prepareDefines(J.defines,this._scene,J.mesh)}_handlePluginEventHardBindForSubMesh(J){for(const T of this._activePluginsForExtraEvents)T.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,J.subMesh)}_handlePluginEventBindForSubMesh(J){for(const T of this._activePlugins)T.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,J.subMesh)}_handlePluginEventHasRenderTargetTextures(J){let T=!1;for(const b of this._activePluginsForExtraEvents)if(T=b.hasRenderTargetTextures(),T)break;J.hasRenderTargetTextures=T}_handlePluginEventFillRenderTargetTextures(J){for(const T of this._activePluginsForExtraEvents)T.fillRenderTargetTextures(J.renderTargets)}_handlePluginEvent(J,T){switch(J){case 512:{const J=T;for(const T of this._activePlugins)T.getActiveTextures(J.activeTextures);break}case 256:{const J=T;for(const T of this._activePlugins)T.getAnimatables(J.animatables);break}case 1024:{const J=T;let b=!1;for(const T of this._activePlugins)if(b=T.hasTexture(J.texture),b)break;J.hasTexture=b;break}case 2:{const J=T;for(const T of this._plugins)T.dispose(J.forceDisposeTextures);break}case 4:T.defineNames=this._defineNamesFromPlugins;break;case 128:{const J=T;for(const T of this._activePlugins)J.fallbackRank=T.addFallbacks(J.defines,J.fallbacks,J.fallbackRank),T.getAttributes(J.attributes,this._scene,J.mesh);this._uniformList.length>0&&J.uniforms.push(...this._uniformList),this._samplerList.length>0&&J.samplers.push(...this._samplerList),this._uboList.length>0&&J.uniformBuffersNames.push(...this._uboList),J.customCode=this._injectCustomCode(J,J.customCode);break}case 8:{const J=T;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const b=1===this._material.shaderLanguage;for(const T of this._plugins){const q=T.getUniforms(this._material.shaderLanguage);if(q){if(q.ubo)for(const T of q.ubo){if(T.size&&T.type){const q=T.arraySize??0;if(J.ubo.addUniform(T.name,T.size,q),b){let J;switch(T.type){case"mat4":J="mat4x4f";break;case"float":J="f32";break;default:J=`${T.type}f`}this._uboDeclaration+=q>0?`uniform ${T.name}: array<${J}, ${q}>;\n`:`uniform ${T.name}: ${J};\n`}else this._uboDeclaration+=`${T.type} ${T.name}${q>0?`[${q}]`:""};\n`}this._uniformList.push(T.name)}q.vertex&&(this._vertexDeclaration+=q.vertex+"\n"),q.fragment&&(this._fragmentDeclaration+=q.fragment+"\n")}T.getSamplers(this._samplerList),T.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(J,T){if(T)for(const b in T)this._codeInjectionPoints[J]||(this._codeInjectionPoints[J]={}),this._codeInjectionPoints[J][b]=!0}_injectCustomCode(J,T){return(b,q)=>{var t;T&&(q=T(b,q)),this._uboDeclaration&&(q=q.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(q=q.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(q=q.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const j=null===(t=this._codeInjectionPoints)||void 0===t?void 0:t[b];if(!j)return q;let B=null;for(let T in j){let t="";for(const q of this._activePlugins){var A;let j=null===(A=q.getCustomCode(b,this._material.shaderLanguage))||void 0===A?void 0:A[T];if(j){if(q.resolveIncludes){if(null===B){const T=0;B={defines:[],indexParameters:J.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:C.c.GetShadersRepository(T),includesShadersStore:C.c.GetIncludesShadersStore(T),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}B.isFragment="fragment"===b,(0,Y.i)(j,B,(J=>j=J))}t+=j+"\n"}}if(t.length>0)if("!"===T.charAt(0)){T=T.substring(1);let J="g";if("!"===T.charAt(0))J="",T=T.substring(1);else{const b=F.exec(T);b&&b.length>=2&&(J=b[1],T=T.substring(J.length+1))}J.indexOf("g")<0&&(J+="g");const b=q,j=new RegExp(T,J);let B=j.exec(b);for(;null!==B;){let J=t;for(let T=0;T<B.length;++T)J=J.replace("$"+T,B[T]);q=q.replace(B[0],J),B=j.exec(b)}}else{const J="#define "+T;q=q.replace(J,"\n"+t+"\n"+J)}}return q}}}A._MaterialPluginClassToMainDefine={},A._MaterialPluginCounter=0,B.e.OnEnginesDisposedObservable.add((()=>{G()}));const a=[];let P=!1,v=null;function G(){a.length=0,P=!1,j.c.OnEventObservable.remove(v),v=null}var x=b(727),I=b(639);class u{isCompatible(J){return 0===J}_enable(J){J&&this._pluginManager._activatePlugin(this)}constructor(J,T,b,q){let t=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=J,this.name=T,this.priority=b,this.resolveIncludes=B,J.pluginManager||(J.pluginManager=new A(J),J.Ki.add((()=>{J.pluginManager=void 0}))),this._pluginDefineNames=q,this._pluginManager=J.pluginManager,t&&this._pluginManager._addPlugin(this),j&&this._enable(!0),this.markAllDefinesAsDirty=J._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(J,T,b,q){return!0}hardBindForSubMesh(J,T,b,q){}bindForSubMesh(J,T,b,q){}dispose(J){}getCustomCode(J){return null}collectDefines(J){if(this._pluginDefineNames)for(const T of Object.keys(this._pluginDefineNames)){if("_"===T[0])continue;const b=typeof this._pluginDefineNames[T];J[T]={type:"number"===b?"number":"string"===b?"string":"boolean"===b?"boolean":"object",default:this._pluginDefineNames[T]}}}prepareDefinesBeforeAttributes(J,T,b){}prepareDefines(J,T,b){}hasTexture(J){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(J){}getActiveTextures(J){}getAnimatables(J){}addFallbacks(J,T,b){return b}getSamplers(J){}getAttributes(J,T,b){}getUniformBuffersNames(J){}getUniforms(){return{}}copyTo(J){x.d.Clone((()=>J),this)}serialize(){return x.d.Serialize(this)}parse(J,T,b){x.d.Parse((()=>this),J,T,b)}}(0,q.e)([(0,t.M)()],u.prototype,"name",void 0),(0,q.e)([(0,t.M)()],u.prototype,"priority",void 0),(0,q.e)([(0,t.M)()],u.prototype,"resolveIncludes",void 0),(0,q.e)([(0,t.M)()],u.prototype,"registerForExtraEvents",void 0),(0,I.g)("BABYLON.MaterialPluginBase",u)},11991:(J,T,b)=>{"use strict";b.d(T,{c:()=>q});class q{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(J){J.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(J){}bindForSubMesh(J,T,b,q,t){if(T.prePassRenderer&&T.prePassRenderer.enabled&&T.prePassRenderer.currentRTisSceneRT&&(-1!==T.prePassRenderer.getIndex(2)||-1!==T.prePassRenderer.getIndex(11))){this.previousWorldMatrices[b.uniqueId]||(this.previousWorldMatrices[b.uniqueId]=q.clone()),this.previousViewProjection||(this.previousViewProjection=T.getTransformMatrix().clone(),this.currentViewProjection=T.getTransformMatrix().clone());const t=T.getEngine();this.currentViewProjection.updateFlag!==T.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=t.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(T.getTransformMatrix())):this._lastUpdateFrameId!==t.frameId&&(this._lastUpdateFrameId=t.frameId,this.previousViewProjection.p(this.currentViewProjection)),J.setMatrix("previousWorld",this.previousWorldMatrices[b.uniqueId]),J.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[b.uniqueId]=q.clone()}}}},11996:(J,T,b)=>{"use strict";b.d(T,{b:()=>j});var q=b(697),t=b(855);class j extends t.c{constructor(J,T){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(J,T,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new q.e,this._storeEffectOnSubMeshes=b}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(J,T){return!!J&&(!this._storeEffectOnSubMeshes||(!J.xi||0===J.xi.length||this.isReadyForSubMesh(J,J.xi[0],T)))}_isReadyForSubMesh(J){const T=J.materialDefines;return!(this.checkReadyOnEveryCall||!J.effect||!T||T._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(J){this._activeEffect.setMatrix("world",J)}bindOnlyNormalMatrix(J){this._activeEffect.setMatrix("normalMatrix",J)}bind(J,T){T&&this.bindForSubMesh(J,T,T.xi[0])}_afterBind(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;super._afterBind(J,T,b),this.va()._cachedEffect=T,b?b._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return b._drawWrapper._forceRebindOnNextCall||J.isCachedMaterialInvalid(this,T,q)}dispose(J,T,b){this._activeEffect=void 0,super.dispose(J,T,b)}}},11983:(J,T,b)=>{"use strict";b.d(T,{c:()=>S});var q=b(674),t=b(680),j=b(689),B=b(2440),Y=b(731),C=b(751),F=b(11991),A=b(2442),a=b(855),P=b(11994),v=b(11996),G=b(2319),x=b(639),I=b(12002),u=b(12005),U=b(12011),K=b(869),E=b(864),l=b(727),W=b(12023);const p={effect:null,subMesh:null};class o extends P.d{constructor(J){super(J),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(J){const T=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const b of T)this[b]=b===J}}class S extends v.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(J){this._attachImageProcessingConfiguration(J),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(J){J!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=J||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(J){this.imageProcessingConfiguration.colorCurvesEnabled=J}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(J){this.imageProcessingConfiguration.colorGradingEnabled=J}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(J){this._imageProcessingConfiguration.toneMappingEnabled=J}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(J){this._imageProcessingConfiguration.exposure=J}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(J){this._imageProcessingConfiguration.contrast=J}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(J){this._imageProcessingConfiguration.colorGradingTexture=J}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(J){this._imageProcessingConfiguration.colorCurves=J}get canRenderToMRT(){return!0}constructor(J,T){super(J,T,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||S.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new Y.b(0,0,0),this.diffuseColor=new Y.b(1,1,1),this.specularColor=new Y.b(1,1,1),this.emissiveColor=new Y.b(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new j.e(16),this._globalAmbientColor=new Y.b(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new U.e(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new F.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),S.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),S.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(S.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(S.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"o"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===a.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Fj&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==a.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Fj||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(J,T){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const t=T._drawWrapper;if(t.effect&&this.isFrozen&&t._wasPreviouslyReady&&t._wasPreviouslyUsingInstances===q)return!0;T.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),T.materialDefines=new o(this._eventInfo.defineNames));const j=this.va(),B=T.materialDefines;if(this._isReadyForSubMesh(T))return!0;const Y=j.getEngine();B._needNormals=(0,E.N)(j,J,B,!0,this._maxSimultaneousLights,this._disableLighting),(0,E.R)(j,B);const a=this.needAlphaBlendingForMesh(J)&&this.va().useOrderIndependentTransparency;if((0,E.X)(j,B,this.canRenderToMRT&&!a),(0,E.T)(j,B,a),W.d.PrepareDefines(Y.currentRenderPassId,J,B),B._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,B._needUVs=!1;for(let J=1;J<=6;++J)B["MAINUV"+J]=!1;if(j.texturesEnabled){if(B.DIFFUSEDIRECTUV=0,B.BUMPDIRECTUV=0,B.AMBIENTDIRECTUV=0,B.OPACITYDIRECTUV=0,B.EMISSIVEDIRECTUV=0,B.SPECULARDIRECTUV=0,B.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&S.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._diffuseTexture,B,"DIFFUSE")}else B.DIFFUSE=!1;if(this._ambientTexture&&S.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._ambientTexture,B,"AMBIENT")}else B.AMBIENT=!1;if(this._opacityTexture&&S.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._opacityTexture,B,"OPACITY"),B.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else B.OPACITY=!1;if(this._reflectionTexture&&S.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(B._needNormals=!0,B.REFLECTION=!0,B.ROUGHNESS=this._roughness>0,B.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,B.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===G.b.INVCUBIC_MODE,B.REFLECTIONMAP_3D=this._reflectionTexture.isCube,B.REFLECTIONMAP_OPPOSITEZ=B.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,B.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case G.b.EXPLICIT_MODE:B.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case G.b.PLANAR_MODE:B.setReflectionMode("REFLECTIONMAP_PLANAR");break;case G.b.PROJECTION_MODE:B.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case G.b.SKYBOX_MODE:B.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case G.b.SPHERICAL_MODE:B.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case G.b.EQUIRECTANGULAR_MODE:B.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case G.b.FIXED_EQUIRECTANGULAR_MODE:B.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case G.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:B.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case G.b.CUBIC_MODE:case G.b.INVCUBIC_MODE:default:B.setReflectionMode("REFLECTIONMAP_CUBIC")}B.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else B.REFLECTION=!1,B.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&S.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._emissiveTexture,B,"EMISSIVE")}else B.EMISSIVE=!1;if(this._lightmapTexture&&S.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._lightmapTexture,B,"LIGHTMAP"),B.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,B.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else B.LIGHTMAP=!1;if(this._specularTexture&&S.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._specularTexture,B,"SPECULAR"),B.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else B.SPECULAR=!1;if(j.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&S.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,E.P)(this._bumpTexture,B,"BUMP"),B.PARALLAX=this._useParallax,B.PARALLAX_RHS=j.useRightHandedSystem,B.PARALLAXOCCLUSION=this._useParallaxOcclusion,B.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else B.BUMP=!1,B.PARALLAX=!1,B.PARALLAX_RHS=!1,B.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&S.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;B._needUVs=!0,B.REFRACTION=!0,B.REFRACTIONMAP_3D=this._refractionTexture.isCube,B.RGBDREFRACTION=this._refractionTexture.isRGBD,B.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else B.REFRACTION=!1;B.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else B.DIFFUSE=!1,B.AMBIENT=!1,B.OPACITY=!1,B.REFLECTION=!1,B.EMISSIVE=!1,B.LIGHTMAP=!1,B.BUMP=!1,B.REFRACTION=!1;B.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),B.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,B.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,B.SPECULAROVERALPHA=this._useSpecularOverAlpha,B.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,B.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,B.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(J)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=B,this._eventInfo.subMesh=T,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(B._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(B),B.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,B.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(B._areFresnelDirty&&(S.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(B.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,B.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,B.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,B.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,B.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,B.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,B._needNormals=!0,B.FRESNEL=!0):B.FRESNEL=!1),B.AREALIGHTUSED)for(let b=0;b<J.lightSources.length;b++)if(!J.lightSources[b]._isReady())return!1;(0,E.Q)(J,j,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(J),B,this._applyDecalMapAfterDetailMap),(0,E.J)(j,Y,this,B,q,null,T.getRenderingMesh().hasThinInstances),this._eventInfo.defines=B,this._eventInfo.mesh=J,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,E.I)(J,B,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let P=!1;if(B.isDirty){const q=B._areLightsDisposed;B.markAsProcessed();const t=new u.d;B.REFLECTION&&t.addFallback(0,"REFLECTION"),B.SPECULAR&&t.addFallback(0,"SPECULAR"),B.BUMP&&t.addFallback(0,"BUMP"),B.PARALLAX&&t.addFallback(1,"PARALLAX"),B.PARALLAX_RHS&&t.addFallback(1,"PARALLAX_RHS"),B.PARALLAXOCCLUSION&&t.addFallback(0,"PARALLAXOCCLUSION"),B.SPECULAROVERALPHA&&t.addFallback(0,"SPECULAROVERALPHA"),B.FOG&&t.addFallback(1,"FOG"),B.POINTSIZE&&t.addFallback(0,"POINTSIZE"),B.LOGARITHMICDEPTH&&t.addFallback(0,"LOGARITHMICDEPTH"),(0,E.u)(B,t,this._maxSimultaneousLights),B.SPECULARTERM&&t.addFallback(0,"SPECULARTERM"),B.DIFFUSEFRESNEL&&t.addFallback(1,"DIFFUSEFRESNEL"),B.OPACITYFRESNEL&&t.addFallback(2,"OPACITYFRESNEL"),B.REFLECTIONFRESNEL&&t.addFallback(3,"REFLECTIONFRESNEL"),B.EMISSIVEFRESNEL&&t.addFallback(4,"EMISSIVEFRESNEL"),B.FRESNEL&&t.addFallback(4,"FRESNEL"),B.MULTIVIEW&&t.addFallback(0,"MULTIVIEW");const a=[C.e.PositionKind];B.NORMAL&&a.push(C.e.NormalKind),B.TANGENT&&a.push(C.e.TangentKind);for(let J=1;J<=6;++J)B["UV"+J]&&a.push(`uv${1===J?"":J}`);B.VERTEXCOLOR&&a.push(C.e.ColorKind),(0,E.y)(a,J,B,t),(0,E.B)(a,B),(0,E.D)(a,J,B),(0,E.w)(a,J,B);let v="default";const G=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],x=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],I=["Material","Scene","Mesh"],U={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:B.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=t,this._eventInfo.fallbackRank=0,this._eventInfo.defines=B,this._eventInfo.uniforms=G,this._eventInfo.attributes=a,this._eventInfo.samplers=x,this._eventInfo.uniformBuffersNames=I,this._eventInfo.customCode=void 0,this._eventInfo.mesh=J,this._eventInfo.indexParameters=U,this._callbackPluginEventGeneric(128,this._eventInfo),W.d.AddUniformsAndSamplers(G,x),F.c.AddUniforms(G),F.c.AddSamplers(x),A.b&&(A.b.PrepareUniforms(G,B),A.b.PrepareSamplers(x,B)),(0,E.Z)({uniformsNames:G,uniformBuffersNames:I,samplers:x,defines:B,maxSimultaneousLights:this._maxSimultaneousLights}),(0,K.e)(G);const l={};this.customShaderNameResolve&&(v=this.customShaderNameResolve(v,G,I,x,B,a,l));const o=B.toString(),S=T.effect;let H=j.getEngine().createEffect(v,{attributes:a,uniformsNames:G,uniformBuffersNames:I,samplers:x,defines:o,fallbacks:t,onCompiled:this.onCompiled,onError:this.onError,indexParameters:U,processFinalCode:l.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:B.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([b.e(41),b.e(39)]).then(b.bind(b,13225)),Promise.all([b.e(42),b.e(40)]).then(b.bind(b,13378))]):await Promise.all([Promise.all([b.e(45),b.e(44)]).then(b.bind(b,13458)),Promise.all([b.e(47),b.e(46)]).then(b.bind(b,13629))]),this._shadersLoaded=!0}},Y);if(this._eventInfo.customCode=void 0,H)if(this._onEffectCreatedObservable&&(p.effect=H,p.subMesh=T,this._onEffectCreatedObservable.notifyObservers(p)),this.allowShaderHotSwapping&&S&&!H.isReady()){if(H=S,B.markAsUnprocessed(),P=this.isFrozen,q)return B._areLightsDisposed=!0,!1}else j.resetCachedMaterial(),T.setEffect(H,B,this._materialContext)}return!(!T.effect||!T.effect.isReady())&&(B._renderId=j.getRenderId(),t._wasPreviouslyReady=!P,t._wasPreviouslyUsingInstances=q,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const J=this._uniformBuffer;J.addUniform("diffuseLeftColor",4),J.addUniform("diffuseRightColor",4),J.addUniform("opacityParts",4),J.addUniform("reflectionLeftColor",4),J.addUniform("reflectionRightColor",4),J.addUniform("refractionLeftColor",4),J.addUniform("refractionRightColor",4),J.addUniform("emissiveLeftColor",4),J.addUniform("emissiveRightColor",4),J.addUniform("vDiffuseInfos",2),J.addUniform("vAmbientInfos",2),J.addUniform("vOpacityInfos",2),J.addUniform("vReflectionInfos",2),J.addUniform("vReflectionPosition",3),J.addUniform("vReflectionSize",3),J.addUniform("vEmissiveInfos",2),J.addUniform("vLightmapInfos",2),J.addUniform("vSpecularInfos",2),J.addUniform("vBumpInfos",3),J.addUniform("diffuseMatrix",16),J.addUniform("ambientMatrix",16),J.addUniform("opacityMatrix",16),J.addUniform("reflectionMatrix",16),J.addUniform("emissiveMatrix",16),J.addUniform("lightmapMatrix",16),J.addUniform("specularMatrix",16),J.addUniform("bumpMatrix",16),J.addUniform("vTangentSpaceParams",2),J.addUniform("pointSize",1),J.addUniform("alphaCutOff",1),J.addUniform("refractionMatrix",16),J.addUniform("vRefractionInfos",4),J.addUniform("vRefractionPosition",3),J.addUniform("vRefractionSize",3),J.addUniform("vSpecularColor",4),J.addUniform("vEmissiveColor",3),J.addUniform("vDiffuseColor",4),J.addUniform("vAmbientColor",3),J.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(J,T,b){const q=this.va(),t=b.materialDefines;if(!t)return;const j=b.effect;if(!j)return;this._activeEffect=j,T.getMeshUniformBuffer().bindToEffect(j,"Mesh"),T.transferToEffect(J),this._uniformBuffer.bindToEffect(j,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,q,T,J,this.isFrozen),W.d.Bind(q.getEngine().currentRenderPassId,this._activeEffect,T,J,this);const C=q.activeCamera;C?this._uniformBuffer.updateFloat4("cameraInfo",C.wi,C.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=b,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),t.OBJECTSPACE_NORMALMAP&&(J.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const F=this._mustRebind(q,j,b,T.visibility);(0,E.b)(T,j);const A=this._uniformBuffer;if(F){if(this.bindViewProjection(j),!A.useUbo||!this.isFrozen||!A.isSync||b._drawWrapper._forceRebindOnNextCall){if(S.FresnelEnabled&&t.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(A.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),A.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&A.updateColor4("opacityParts",new Y.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(A.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),A.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(A.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),A.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(A.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),A.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),q.texturesEnabled){if(this._diffuseTexture&&S.DiffuseTextureEnabled&&(A.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,E.q)(this._diffuseTexture,A,"diffuse")),this._ambientTexture&&S.AmbientTextureEnabled&&(A.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,E.q)(this._ambientTexture,A,"ambient")),this._opacityTexture&&S.OpacityTextureEnabled&&(A.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,E.q)(this._opacityTexture,A,"opacity")),this._hasAlphaChannel()&&A.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&S.ReflectionTextureEnabled){if(A.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),A.Zi("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const J=this._reflectionTexture;A.updateVector3("vReflectionPosition",J.boundingBoxPosition),A.updateVector3("vReflectionSize",J.boundingBoxSize)}}else A.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&S.EmissiveTextureEnabled&&(A.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,E.q)(this._emissiveTexture,A,"emissive")),this._lightmapTexture&&S.LightmapTextureEnabled&&(A.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,E.q)(this._lightmapTexture,A,"lightmap")),this._specularTexture&&S.SpecularTextureEnabled&&(A.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,E.q)(this._specularTexture,A,"specular")),this._bumpTexture&&q.getEngine().getCaps().standardDerivatives&&S.BumpTextureEnabled&&(A.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,E.q)(this._bumpTexture,A,"bump"),q._mirroredCameraPosition?A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&S.RefractionTextureEnabled){let J=1;if(this._refractionTexture.isCube||(A.Zi("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(J=this._refractionTexture.depth)),A.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,J,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const J=this._refractionTexture;A.updateVector3("vRefractionPosition",J.boundingBoxPosition),A.updateVector3("vRefractionSize",J.boundingBoxSize)}}}this.pointsCloud&&A.updateFloat("pointSize",this.pointSize),A.updateColor4("vSpecularColor",this.specularColor,this.specularPower),A.updateColor3("vEmissiveColor",S.EmissiveTextureEnabled?this.emissiveColor:Y.b.BlackReadOnly),A.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),q.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),A.updateColor3("vAmbientColor",this._globalAmbientColor)}q.texturesEnabled&&(this._diffuseTexture&&S.DiffuseTextureEnabled&&j.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&S.AmbientTextureEnabled&&j.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&S.OpacityTextureEnabled&&j.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&S.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?j.setTexture("reflectionCubeSampler",this._reflectionTexture):j.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&S.EmissiveTextureEnabled&&j.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&S.LightmapTextureEnabled&&j.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&S.SpecularTextureEnabled&&j.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&q.getEngine().getCaps().standardDerivatives&&S.BumpTextureEnabled&&j.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&S.RefractionTextureEnabled&&(this._refractionTexture.isCube?j.setTexture("refractionCubeSampler",this._refractionTexture):j.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(T)&&this.va().depthPeelingRenderer.bind(j),this._eventInfo.subMesh=b,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,K.h)(j,this,q),this.bindEyePosition(j)}else q.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(F||!this.isFrozen){var a;if(q.lightsEnabled&&!this._disableLighting&&(0,E.f)(q,T,j,t,this._maxSimultaneousLights),(q.fogEnabled&&T.applyFog&&q.fogMode!==B.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||T.receiveShadows||t.PREPASS)&&this.bindView(j),(0,E.c)(q,T,j),t.NUM_MORPH_INFLUENCERS&&(0,E.m)(T,j),t.BAKED_VERTEX_ANIMATION_TEXTURE)null===(a=T.bakedVertexAnimationManager)||void 0===a||a.bind(j,t.INSTANCES);this.useLogarithmicDepth&&(0,E.j)(t,j,q),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(T,this._activeEffect,b),A.update()}getAnimatables(){const J=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&J.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&J.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&J.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&J.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&J.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&J.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&J.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&J.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&J.push(this._refractionTexture),J}getActiveTextures(){const J=super.getActiveTextures();return this._diffuseTexture&&J.push(this._diffuseTexture),this._ambientTexture&&J.push(this._ambientTexture),this._opacityTexture&&J.push(this._opacityTexture),this._reflectionTexture&&J.push(this._reflectionTexture),this._emissiveTexture&&J.push(this._emissiveTexture),this._specularTexture&&J.push(this._specularTexture),this._bumpTexture&&J.push(this._bumpTexture),this._lightmapTexture&&J.push(this._lightmapTexture),this._refractionTexture&&J.push(this._refractionTexture),J}hasTexture(J){return!!super.hasTexture(J)||(this._diffuseTexture===J||(this._ambientTexture===J||(this._opacityTexture===J||(this._reflectionTexture===J||(this._emissiveTexture===J||(this._specularTexture===J||(this._bumpTexture===J||(this._lightmapTexture===J||this._refractionTexture===J))))))))}dispose(J,T){var b,q,t,j,B,Y,C,F,A;T&&(null===(b=this._diffuseTexture)||void 0===b||b.dispose(),null===(q=this._ambientTexture)||void 0===q||q.dispose(),null===(t=this._opacityTexture)||void 0===t||t.dispose(),null===(j=this._reflectionTexture)||void 0===j||j.dispose(),null===(B=this._emissiveTexture)||void 0===B||B.dispose(),null===(Y=this._specularTexture)||void 0===Y||Y.dispose(),null===(C=this._bumpTexture)||void 0===C||C.dispose(),null===(F=this._lightmapTexture)||void 0===F||F.dispose(),null===(A=this._refractionTexture)||void 0===A||A.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(J,T)}clone(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const q=l.d.Clone((()=>new S(J,this.va())),this,{cloneTexturesOnlyOnce:T});return q.name=J,q.id=J,this.stencil.copyTo(q.stencil),this._clonePlugins(q,b),q}static Parse(J,T,b){const q=l.d.Parse((()=>new S(J.name,T)),J,T,b);return J.stencil&&q.stencil.parse(J.stencil,T,b),a.c._ParsePlugins(J,q,T,b),q}static get DiffuseTextureEnabled(){return I.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(J){I.e.DiffuseTextureEnabled=J}static get DetailTextureEnabled(){return I.e.DetailTextureEnabled}static set DetailTextureEnabled(J){I.e.DetailTextureEnabled=J}static get AmbientTextureEnabled(){return I.e.AmbientTextureEnabled}static set AmbientTextureEnabled(J){I.e.AmbientTextureEnabled=J}static get OpacityTextureEnabled(){return I.e.OpacityTextureEnabled}static set OpacityTextureEnabled(J){I.e.OpacityTextureEnabled=J}static get ReflectionTextureEnabled(){return I.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(J){I.e.ReflectionTextureEnabled=J}static get EmissiveTextureEnabled(){return I.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(J){I.e.EmissiveTextureEnabled=J}static get SpecularTextureEnabled(){return I.e.SpecularTextureEnabled}static set SpecularTextureEnabled(J){I.e.SpecularTextureEnabled=J}static get BumpTextureEnabled(){return I.e.BumpTextureEnabled}static set BumpTextureEnabled(J){I.e.BumpTextureEnabled=J}static get LightmapTextureEnabled(){return I.e.LightmapTextureEnabled}static set LightmapTextureEnabled(J){I.e.LightmapTextureEnabled=J}static get RefractionTextureEnabled(){return I.e.RefractionTextureEnabled}static set RefractionTextureEnabled(J){I.e.RefractionTextureEnabled=J}static get ColorGradingTextureEnabled(){return I.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(J){I.e.ColorGradingTextureEnabled=J}static get FresnelEnabled(){return I.e.FresnelEnabled}static set FresnelEnabled(J){I.e.FresnelEnabled=J}}S.ForceGLSL=!1,(0,q.e)([(0,t.D)("diffuseTexture")],S.prototype,"_diffuseTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"diffuseTexture",void 0),(0,q.e)([(0,t.D)("ambientTexture")],S.prototype,"_ambientTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,q.e)([(0,t.D)("opacityTexture")],S.prototype,"_opacityTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,q.e)([(0,t.D)("reflectionTexture")],S.prototype,"_reflectionTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,q.e)([(0,t.D)("emissiveTexture")],S.prototype,"_emissiveTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,q.e)([(0,t.D)("specularTexture")],S.prototype,"_specularTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularTexture",void 0),(0,q.e)([(0,t.D)("bumpTexture")],S.prototype,"_bumpTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,q.e)([(0,t.D)("lightmapTexture")],S.prototype,"_lightmapTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"lightmapTexture",void 0),(0,q.e)([(0,t.D)("refractionTexture")],S.prototype,"_refractionTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"refractionTexture",void 0),(0,q.e)([(0,t.o)("ambient")],S.prototype,"ambientColor",void 0),(0,q.e)([(0,t.o)("diffuse")],S.prototype,"diffuseColor",void 0),(0,q.e)([(0,t.o)("specular")],S.prototype,"specularColor",void 0),(0,q.e)([(0,t.o)("emissive")],S.prototype,"emissiveColor",void 0),(0,q.e)([(0,t.M)()],S.prototype,"specularPower",void 0),(0,q.e)([(0,t.M)("useAlphaFromDiffuseTexture")],S.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromDiffuseTexture",void 0),(0,q.e)([(0,t.M)("useEmissiveAsIllumination")],S.prototype,"_useEmissiveAsIllumination",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useEmissiveAsIllumination",void 0),(0,q.e)([(0,t.M)("linkEmissiveWithDiffuse")],S.prototype,"_linkEmissiveWithDiffuse",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"linkEmissiveWithDiffuse",void 0),(0,q.e)([(0,t.M)("useSpecularOverAlpha")],S.prototype,"_useSpecularOverAlpha",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,q.e)([(0,t.M)("useReflectionOverAlpha")],S.prototype,"_useReflectionOverAlpha",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useReflectionOverAlpha",void 0),(0,q.e)([(0,t.M)("disableLighting")],S.prototype,"_disableLighting",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,q.e)([(0,t.M)("useObjectSpaceNormalMap")],S.prototype,"_useObjectSpaceNormalMap",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,q.e)([(0,t.M)("useParallax")],S.prototype,"_useParallax",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,q.e)([(0,t.M)("useParallaxOcclusion")],S.prototype,"_useParallaxOcclusion",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,q.e)([(0,t.M)()],S.prototype,"parallaxScaleBias",void 0),(0,q.e)([(0,t.M)("roughness")],S.prototype,"_roughness",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,q.e)([(0,t.M)()],S.prototype,"indexOfRefraction",void 0),(0,q.e)([(0,t.M)()],S.prototype,"invertRefractionY",void 0),(0,q.e)([(0,t.M)()],S.prototype,"alphaCutOff",void 0),(0,q.e)([(0,t.M)("useLightmapAsShadowmap")],S.prototype,"_useLightmapAsShadowmap",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,q.e)([(0,t.t)("diffuseFresnelParameters")],S.prototype,"_diffuseFresnelParameters",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"diffuseFresnelParameters",void 0),(0,q.e)([(0,t.t)("opacityFresnelParameters")],S.prototype,"_opacityFresnelParameters",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],S.prototype,"opacityFresnelParameters",void 0),(0,q.e)([(0,t.t)("reflectionFresnelParameters")],S.prototype,"_reflectionFresnelParameters",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"reflectionFresnelParameters",void 0),(0,q.e)([(0,t.t)("refractionFresnelParameters")],S.prototype,"_refractionFresnelParameters",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"refractionFresnelParameters",void 0),(0,q.e)([(0,t.t)("emissiveFresnelParameters")],S.prototype,"_emissiveFresnelParameters",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"emissiveFresnelParameters",void 0),(0,q.e)([(0,t.M)("useReflectionFresnelFromSpecular")],S.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"useReflectionFresnelFromSpecular",void 0),(0,q.e)([(0,t.M)("useGlossinessFromSpecularMapAlpha")],S.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,q.e)([(0,t.M)("maxSimultaneousLights")],S.prototype,"_maxSimultaneousLights",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,q.e)([(0,t.M)("invertNormalMapX")],S.prototype,"_invertNormalMapX",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,q.e)([(0,t.M)("invertNormalMapY")],S.prototype,"_invertNormalMapY",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,q.e)([(0,t.M)("twoSidedLighting")],S.prototype,"_twoSidedLighting",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,q.e)([(0,t.M)("applyDecalMapAfterDetailMap")],S.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,q.e)([(0,t.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,x.g)("BABYLON.StandardMaterial",S),B.b.DefaultMaterialFactory=J=>new S("default material",J)},12180:(J,T,b)=>{"use strict";b.d(T,{b:()=>Y,c:()=>C,f:()=>j,h:()=>B});var q=b(717),t=b(697);function j(J,T){return`{X: ${J.x.toFixed(T)} Y: ${J.y.toFixed(T)}}`}function B(J,T){return`{X: ${J._x.toFixed(T)} Y: ${J._y.toFixed(T)} Z: ${J._z.toFixed(T)}}`}function Y(J,T){return 2*Math.acos((0,q.b)(t.h.Dot(J,T)))}function C(J,T){const b=new t.h;return function(J,T,b){const j=t.n.Cross(J,T),B=Math.acos((0,q.b)(t.n.Dot(J,T),-1,1));t.h.RotationAxisToRef(j,B,b)}(J,T,b),b}},12025:(J,T,b)=>{"use strict";b.d(T,{e:()=>F});var q=b(697),t=b(731),j=b(494),B=b(768),Y=b(830);b(12029);function C(J){let T=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],j=[];let C=[];const F=J.width||J.size||1,A=J.height||J.size||1,a=J.depth||J.size||1,P=J.wrap||!1;let v=void 0===J.topBaseAt?1:J.topBaseAt,G=void 0===J.bottomBaseAt?0:J.bottomBaseAt;v=(v+4)%4,G=(G+4)%4;let x=[2,0,3,1][v],I=[2,0,1,3][G],u=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(P){T=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],u=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let J=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const q=[17,18,19,16],t=[22,23,20,21];for(;x>0;)J.unshift(J.pop()),q.unshift(q.pop()),x--;for(;I>0;)b.unshift(b.pop()),t.unshift(t.pop()),I--;J=J.flat(),b=b.flat(),u=u.concat(J).concat(b),T.push(q[0],q[2],q[3],q[0],q[1],q[2]),T.push(t[0],t[2],t[3],t[0],t[1],t[2])}const U=[F/2,A/2,a/2];C=u.reduce(((J,T,b)=>J.concat(T*U[b%3])),[]);const K=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,E=J.faceUV||new Array(6),l=J.faceColors,W=[];for(let B=0;B<6;B++)void 0===E[B]&&(E[B]=new q.p(0,0,1,1)),l&&void 0===l[B]&&(l[B]=new t.d(1,1,1,1));for(let q=0;q<6;q++)if(j.push(E[q].z,Y.c?1-E[q].w:E[q].w),j.push(E[q].x,Y.c?1-E[q].w:E[q].w),j.push(E[q].x,Y.c?1-E[q].y:E[q].y),j.push(E[q].z,Y.c?1-E[q].y:E[q].y),l)for(let J=0;J<4;J++)W.push(l[q].r,l[q].g,l[q].b,l[q].a);B.c._ComputeSides(K,C,T,b,j,J.frontUVs,J.backUVs);const p=new B.c;if(p.indices=T,p.xa=C,p.ya=b,p.Aa=j,l){const J=K===B.c.DOUBLESIDE?W.concat(W):W;p.za=J}return p}function F(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new j.e(J,b);T.sideOrientation=j.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return C(T).Ca(q,T.updatable),q}B.c.CreateBox=C,j.e.CreateBox=function(J,T){return F(J,{size:T,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12029:(J,T,b)=>{"use strict";b.d(T,{f:()=>I,c:()=>U,i:()=>u});var q=b(697),t=b(731),j=b(494),B=b(768),Y=b(751);j.e._GroundMeshParser=(J,T)=>C.Parse(J,T);class C extends j.e{constructor(J,T){super(J,T),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=J,this._subdivisionsY=J,this.subdivide(J);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(T)}getHeightAtCoordinates(J,T){const b=this.getWorldMatrix(),t=q.j.Matrix[5];b.invertToRef(t);const j=q.j.pi[8];if(q.n.TransformCoordinatesFromFloatsToRef(J,0,T,t,j),J=j.x,T=j.z,J<this._minX||J>=this._maxX||T<=this._minZ||T>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(J,T),Y=-(B.x*J+B.z*T+B.w)/B.y;return q.n.TransformCoordinatesFromFloatsToRef(0,Y,0,b,j),j.y}getNormalAtCoordinates(J,T){const b=new q.n(0,1,0);return this.getNormalAtCoordinatesToRef(J,T,b),b}getNormalAtCoordinatesToRef(J,T,b){const t=this.getWorldMatrix(),j=q.j.Matrix[5];t.invertToRef(j);const B=q.j.pi[8];if(q.n.TransformCoordinatesFromFloatsToRef(J,0,T,j,B),J=B.x,T=B.z,J<this._minX||J>this._maxX||T<this._minZ||T>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(J,T);return q.n.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,t,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(J,T){const b=Math.floor((J+this._maxX)*this._subdivisionsX/this._width),q=Math.floor(-(T+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),t=this._heightQuads[q*this._subdivisionsX+b];let j;return j=T<t.slope.x*J+t.slope.y?t.facet1:t.facet2,j}_initHeightQuads(){const J=this._subdivisionsX,T=this._subdivisionsY;this._heightQuads=[];for(let b=0;b<T;b++)for(let T=0;T<J;T++){const t={slope:q.k.Zero(),facet1:new q.p(0,0,0,0),facet2:new q.p(0,0,0,0)};this._heightQuads[b*J+T]=t}return this}_computeHeightQuads(){const J=this.getVerticesData(Y.e.PositionKind);if(!J)return this;const T=q.j.pi[3],b=q.j.pi[2],t=q.j.pi[1],j=q.j.pi[0],B=q.j.pi[4],C=q.j.pi[5],F=q.j.pi[6],A=q.j.pi[7],a=q.j.pi[8];let P=0,v=0,G=0,x=0,I=0,u=0,U=0;const K=this._subdivisionsX,E=this._subdivisionsY;for(let Y=0;Y<E;Y++)for(let E=0;E<K;E++){P=3*E,v=Y*(K+1)*3,G=(Y+1)*(K+1)*3,T.x=J[v+P],T.y=J[v+P+1],T.z=J[v+P+2],b.x=J[v+P+3],b.y=J[v+P+4],b.z=J[v+P+5],t.x=J[G+P],t.y=J[G+P+1],t.z=J[G+P+2],j.x=J[G+P+3],j.y=J[G+P+4],j.z=J[G+P+5],x=(j.z-T.z)/(j.x-T.x),I=T.z-x*T.x,b.subtractToRef(T,B),t.subtractToRef(T,C),j.subtractToRef(T,F),q.n.CrossToRef(F,C,A),q.n.CrossToRef(B,F,a),A.normalize(),a.normalize(),u=-(A.x*T.x+A.y*T.y+A.z*T.z),U=-(a.x*b.x+a.y*b.y+a.z*b.z);const l=this._heightQuads[Y*K+E];l.slope.hi(x,I),l.facet1.hi(A.x,A.y,A.z,u),l.facet2.hi(a.x,a.y,a.z,U)}return this}serialize(J){super.serialize(J),J.subdivisionsX=this._subdivisionsX,J.subdivisionsY=this._subdivisionsY,J.minX=this._minX,J.maxX=this._maxX,J.wi=this._minZ,J.maxZ=this._maxZ,J.width=this._width,J.height=this._height}static Parse(J,T){const b=new C(J.name,T);return b._subdivisionsX=J.subdivisionsX||1,b._subdivisionsY=J.subdivisionsY||1,b._minX=J.minX,b._maxX=J.maxX,b._minZ=J.wi,b._maxZ=J.maxZ,b._width=J.width,b._height=J.height,b}}var F=b(505),A=b(550),a=b(705),P=b(830);function v(J){const T=[],b=[],t=[],j=[];let Y,C;const F=J.width||J.size||1,A=J.height||J.size||1,a=0|(J.subdivisionsX||J.subdivisions||1),v=0|(J.subdivisionsY||J.subdivisions||1);for(Y=0;Y<=v;Y++)for(C=0;C<=a;C++){const J=new q.n(C*F/a-F/2,0,(v-Y)*A/v-A/2),T=new q.n(0,1,0);b.push(J.x,J.y,J.z),t.push(T.x,T.y,T.z),j.push(C/a,P.c?Y/v:1-Y/v)}for(Y=0;Y<v;Y++)for(C=0;C<a;C++)T.push(C+1+(Y+1)*(a+1)),T.push(C+1+Y*(a+1)),T.push(C+Y*(a+1)),T.push(C+(Y+1)*(a+1)),T.push(C+1+(Y+1)*(a+1)),T.push(C+Y*(a+1));const G=new B.c;return G.indices=T,G.xa=b,G.ya=t,G.Aa=j,G}function G(J){const T=void 0!==J.xmin&&null!==J.xmin?J.xmin:-1,b=void 0!==J.zmin&&null!==J.zmin?J.zmin:-1,t=void 0!==J.xmax&&null!==J.xmax?J.xmax:1,j=void 0!==J.zmax&&null!==J.zmax?J.zmax:1,Y=J.subdivisions||{w:1,h:1},C=J.precision||{w:1,h:1},F=[],A=[],a=[],P=[];let v,G,x,I;Y.h=Y.h<1?1:Y.h,Y.w=Y.w<1?1:Y.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const u=(t-T)/Y.w,U=(j-b)/Y.h;function K(J,T,b,t){const j=A.length/3,B=C.w+1;for(v=0;v<C.h;v++)for(G=0;G<C.w;G++){const J=[j+G+v*B,j+(G+1)+v*B,j+(G+1)+(v+1)*B,j+G+(v+1)*B];F.push(J[1]),F.push(J[2]),F.push(J[3]),F.push(J[0]),F.push(J[1]),F.push(J[3])}const Y=q.n.Zero(),x=new q.n(0,1,0);for(v=0;v<=C.h;v++)for(Y.z=v*(t-T)/C.h+T,G=0;G<=C.w;G++)Y.x=G*(b-J)/C.w+J,Y.y=0,A.push(Y.x,Y.y,Y.z),a.push(x.x,x.y,x.z),P.push(G/C.w,v/C.h)}for(x=0;x<Y.h;x++)for(I=0;I<Y.w;I++)K(T+I*u,b+x*U,T+(I+1)*u,b+(x+1)*U);const E=new B.c;return E.indices=F,E.xa=A,E.ya=a,E.Aa=P,E}function x(J){const T=[],b=[],j=[],Y=[];let C,F;const A=J.colorFilter||new t.b(.3,.59,.11),P=J.alphaFilter||0;let v=!1;if(J.minHeight>J.maxHeight){v=!0;const T=J.maxHeight;J.maxHeight=J.minHeight,J.minHeight=T}for(C=0;C<=J.subdivisions;C++)for(F=0;F<=J.subdivisions;F++){const T=new q.n(F*J.width/J.subdivisions-J.width/2,0,(J.subdivisions-C)*J.height/J.subdivisions-J.height/2),t=4*(((T.x+J.width/2)/J.width*(J.bufferWidth-1)|0)+((1-(T.z+J.height/2)/J.height)*(J.bufferHeight-1)|0)*J.bufferWidth);let B=J.buffer[t]/255,G=J.buffer[t+1]/255,x=J.buffer[t+2]/255;const I=J.buffer[t+3]/255;v&&(B=1-B,G=1-G,x=1-x);const u=B*A.r+G*A.g+x*A.b;T.y=I>=P?J.minHeight+(J.maxHeight-J.minHeight)*u:J.minHeight-a.e,J.heightBuffer&&(J.heightBuffer[C*(J.subdivisions+1)+F]=T.y),b.push(T.x,T.y,T.z),j.push(0,0,0),Y.push(F/J.subdivisions,1-C/J.subdivisions)}for(C=0;C<J.subdivisions;C++)for(F=0;F<J.subdivisions;F++){const q=F+1+(C+1)*(J.subdivisions+1),t=F+1+C*(J.subdivisions+1),j=F+C*(J.subdivisions+1),B=F+(C+1)*(J.subdivisions+1),Y=b[3*q+1]>=J.minHeight,A=b[3*t+1]>=J.minHeight,a=b[3*j+1]>=J.minHeight;Y&&A&&a&&(T.push(q),T.push(t),T.push(j));b[3*B+1]>=J.minHeight&&Y&&a&&(T.push(B),T.push(q),T.push(j))}B.c.ComputeNormals(b,T,j);const G=new B.c;return G.indices=T,G.xa=b,G.ya=j,G.Aa=Y,G}function I(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new C(J,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=T.subdivisionsX||T.subdivisions||1,b._subdivisionsY=T.subdivisionsY||T.subdivisions||1,b._width=T.width||1,b._height=T.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return v(T).Ca(b,T.updatable),b._setReady(!0),b}function u(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new j.e(J,b);return G(T).Ca(q,T.updatable),q}function U(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=b.width||10,B=b.height||10,Y=b.subdivisions||1,a=b.minHeight||0,P=b.maxHeight||1,v=b.colorFilter||new t.b(.3,.59,.11),G=b.alphaFilter||0,I=b.updatable,u=b.onReady;q=q||A.e.LastCreatedScene;const U=new C(J,q);let K;U._subdivisionsX=Y,U._subdivisionsY=Y,U._width=j,U._height=B,U._maxX=U._width/2,U._maxZ=U._height/2,U._minX=-U._maxX,U._minZ=-U._maxZ,U._setReady(!1),b.passHeightBufferInCallback&&(K=new Float32Array((Y+1)*(Y+1)));const E=(J,T,b)=>{x({width:j,height:B,subdivisions:Y,minHeight:a,maxHeight:P,colorFilter:v,buffer:J,bufferWidth:T,bufferHeight:b,alphaFilter:G,heightBuffer:K}).Ca(U,I),u&&u(U,K),U._setReady(!0)};if("string"===typeof T){const J=J=>{var T;const b=J.width,t=J.height;if(q.u)return;const j=null===(T=q)||void 0===T?void 0:T.getEngine().resizeImageBitmap(J,b,t);E(j,b,t)};F.e.LoadImage(T,J,b.onError?b.onError:()=>{},q.offlineProvider)}else E(T.data,T.width,T.height);return U}B.c.CreateGround=v,B.c.CreateTiledGround=G,B.c.CreateGroundFromHeightMap=x,j.e.CreateGround=(J,T,b,q,t,j)=>I(J,{width:T,height:b,subdivisions:q,updatable:j},t),j.e.CreateTiledGround=(J,T,b,q,t,j,B,Y,C)=>u(J,{xmin:T,zmin:b,xmax:q,zmax:t,subdivisions:j,precision:B,updatable:C},Y),j.e.CreateGroundFromHeightMap=(J,T,b,q,t,j,B,Y,C,F,A)=>U(J,T,{width:b,height:q,subdivisions:t,minHeight:j,maxHeight:B,updatable:C,onReady:F,alphaFilter:A},Y)},12761:(J,T,b)=>{"use strict";b.d(T,{e:()=>d,g:()=>s,i:()=>g});var q=b(697),t=b(494),j=b(768),B=b(731),Y=b(751),C=b(12502),F=b(855),A=b(727),a=b(2440),P=b(2319),v=b(639),G=b(12005),x=b(542),I=b(11996),u=b(550),U=b(869),K=b(864);const E={effect:null,subMesh:null};class l extends I.b{constructor(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(J,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new q.e,this._cachedWorldViewProjectionMatrix=new q.e,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=b,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Ti","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...t}}get shaderPath(){return this._shaderPath}set shaderPath(J){this._shaderPath=J}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(J){-1===this._options.uniforms.indexOf(J)&&this._options.uniforms.push(J)}setTexture(J,T){return-1===this._options.samplers.indexOf(J)&&this._options.samplers.push(J),this._textures[J]=T,this}removeTexture(J){delete this._textures[J]}setTextureArray(J,T){return-1===this._options.samplers.indexOf(J)&&this._options.samplers.push(J),this._checkUniform(J),this._textureArrays[J]=T,this}setExternalTexture(J,T){return-1===this._options.externalTextures.indexOf(J)&&this._options.externalTextures.push(J),this._externalTextures[J]=T,this}setFloat(J,T){return this._checkUniform(J),this._floats[J]=T,this}setInt(J,T){return this._checkUniform(J),this._ints[J]=T,this}setUInt(J,T){return this._checkUniform(J),this._uints[J]=T,this}setFloats(J,T){return this._checkUniform(J),this._floatsArrays[J]=T,this}setColor3(J,T){return this._checkUniform(J),this._colors3[J]=T,this}setColor3Array(J,T){return this._checkUniform(J),this._colors3Arrays[J]=T.reduce(((J,T)=>(J.push(T.r,T.g,T.b),J)),[]),this}setColor4(J,T){return this._checkUniform(J),this._colors4[J]=T,this}setColor4Array(J,T){return this._checkUniform(J),this._colors4Arrays[J]=T.reduce(((J,T)=>(J.push(T.r,T.g,T.b,T.a),J)),[]),this}setVector2(J,T){return this._checkUniform(J),this._vectors2[J]=T,this}setVector3(J,T){return this._checkUniform(J),this._vectors3[J]=T,this}setVector4(J,T){return this._checkUniform(J),this._vectors4[J]=T,this}setQuaternion(J,T){return this._checkUniform(J),this._quaternions[J]=T,this}setQuaternionArray(J,T){return this._checkUniform(J),this._quaternionsArrays[J]=T.reduce(((J,T)=>(T.toArray(J,J.length),J)),[]),this}setMatrix(J,T){return this._checkUniform(J),this._matrices[J]=T,this}setMatrices(J,T){this._checkUniform(J);const b=new Float32Array(16*T.length);for(let q=0;q<T.length;q++){T[q].copyToArray(b,16*q)}return this._matrixArrays[J]=b,this}setMatrix3x3(J,T){return this._checkUniform(J),this._matrices3x3[J]=T,this}setMatrix2x2(J,T){return this._checkUniform(J),this._matrices2x2[J]=T,this}setArray2(J,T){return this._checkUniform(J),this._vectors2Arrays[J]=T,this}setArray3(J,T){return this._checkUniform(J),this._vectors3Arrays[J]=T,this}setArray4(J,T){return this._checkUniform(J),this._vectors4Arrays[J]=T,this}setUniformBuffer(J,T){return-1===this._options.uniformBuffers.indexOf(J)&&this._options.uniformBuffers.push(J),this._uniformBuffers[J]=T,this}setTextureSampler(J,T){return-1===this._options.samplerObjects.indexOf(J)&&this._options.samplerObjects.push(J),this._textureSamplers[J]=T,this}setStorageBuffer(J,T){return-1===this._options.storageBuffers.indexOf(J)&&this._options.storageBuffers.push(J),this._storageBuffers[J]=T,this}setDefine(J,T){const b=J.trimEnd()+" ",q=this.options.defines.findIndex((T=>T===J||T.startsWith(b)));return q>=0&&this.options.defines.splice(q,1),("boolean"!==typeof T||T)&&this.options.defines.push(b+T),this}isReadyForSubMesh(J,T,b){return this.isReady(J,b,T)}isReady(J,T,b){var q;const t=b&&this._storeEffectOnSubMeshes;if(this.isFrozen){const J=t?b._drawWrapper:this._drawWrapper;if(J.effect&&J._wasPreviouslyReady&&J._wasPreviouslyUsingInstances===T)return!0}const j=this.va(),B=j.getEngine(),C=[],F=[];let A=null,P=this._shaderPath,v=this._options.uniforms,x=this._options.uniformBuffers,I=this._options.samplers;B.getCaps().multiview&&j.activeCamera&&j.activeCamera.outputRenderTarget&&j.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,C.push("#define MULTIVIEW"),-1!==v.indexOf("viewProjection")&&-1===v.indexOf("viewProjectionR")&&v.push("viewProjectionR"));for(let Y=0;Y<this._options.defines.length;Y++){const J=0===this._options.defines[Y].indexOf("#define")?this._options.defines[Y]:`#define ${this._options.defines[Y]}`;C.push(J)}for(let Y=0;Y<this._options.attributes.length;Y++)F.push(this._options.attributes[Y]);if(J&&J.isVerticesDataPresent(Y.e.ColorKind)&&(-1===F.indexOf(Y.e.ColorKind)&&F.push(Y.e.ColorKind),C.push("#define VERTEXCOLOR")),T&&(C.push("#define INSTANCES"),(0,K.$)(F,this._materialHelperNeedsPreviousMatrices),null!==J&&void 0!==J&&J.hasThinInstances&&(C.push("#define THIN_INSTANCES"),J&&J.isVerticesDataPresent(Y.e.ColorInstanceKind)&&(F.push(Y.e.ColorInstanceKind),C.push("#define INSTANCESCOLOR")))),J&&J.useBones&&J.computeBonesUsingShaders&&J.skeleton){F.push(Y.e.MatricesIndicesKind),F.push(Y.e.MatricesWeightsKind),J.numBoneInfluencers>4&&(F.push(Y.e.MatricesIndicesExtraKind),F.push(Y.e.MatricesWeightsExtraKind));const T=J.skeleton;C.push("#define NUM_BONE_INFLUENCERS "+J.numBoneInfluencers),A=new G.d,A.addCPUSkinningFallback(0,J),T.isUsingTextureForMatrices?(C.push("#define BONETEXTURE"),-1===v.indexOf("boneTextureWidth")&&v.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(C.push("#define BonesPerMesh "+(T.bones.length+1)),-1===v.indexOf("mBones")&&v.push("mBones"))}else C.push("#define NUM_BONE_INFLUENCERS 0");let u=0;const l=J?J.morphTargetManager:null;if(l){const T=-1!==C.indexOf("#define UV1"),b=-1!==C.indexOf("#define UV2"),q=-1!==C.indexOf("#define TANGENT"),t=-1!==C.indexOf("#define NORMAL"),j=-1!==C.indexOf("#define VERTEXCOLOR");u=(0,K.F)(l,C,F,J,!0,t,q,T,b,j),l.isUsingTextureForTargets&&(-1===v.indexOf("morphTargetTextureIndices")&&v.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),u>0&&(v=v.slice(),v.push("morphTargetInfluences"),v.push("morphTargetCount"),v.push("morphTargetTextureInfo"),v.push("morphTargetTextureIndices"))}else C.push("#define NUM_MORPH_INFLUENCERS 0");if(J){const T=J.bakedVertexAnimationManager;T&&T.isEnabled&&(C.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===v.indexOf("bakedVertexAnimationSettings")&&v.push("bakedVertexAnimationSettings"),-1===v.indexOf("bakedVertexAnimationTextureSizeInverted")&&v.push("bakedVertexAnimationTextureSizeInverted"),-1===v.indexOf("bakedVertexAnimationTime")&&v.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,K.w)(F,J,C)}for(const Y in this._textures)if(!this._textures[Y].isReady())return!1;J&&this.needAlphaTestingForMesh(J)&&C.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,U.e)(v),(0,U.o)(this,j,C)),j.fogEnabled&&null!==J&&void 0!==J&&J.applyFog&&j.fogMode!==a.b.FOGMODE_NONE&&(C.push("#define FOG"),-1===v.indexOf("view")&&v.push("view"),-1===v.indexOf("vFogInfos")&&v.push("vFogInfos"),-1===v.indexOf("vFogColor")&&v.push("vFogColor")),this._useLogarithmicDepth&&(C.push("#define LOGARITHMICDEPTH"),-1===v.indexOf("logarithmicDepthConstant")&&v.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(v=v.slice(),x=x.slice(),I=I.slice(),P=this.customShaderNameResolve(this.name,v,x,I,C,F));const W=t?b._getDrawWrapper(void 0,!0):this._drawWrapper,p=(null===W||void 0===W?void 0:W.effect)??null,o=(null===W||void 0===W?void 0:W.defines)??null,S=C.join("\n");let H=p;return o!==S&&(H=B.createEffect(P,{attributes:F,uniformsNames:v,uniformBuffersNames:x,samplers:I,defines:S,fallbacks:A,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:u},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},B),t?b.setEffect(H,S,this._materialContext):W&&W.setEffect(H,S),this._onEffectCreatedObservable&&(E.effect=H,E.subMesh=b??(null===J||void 0===J?void 0:J.xi[0])??null,this._onEffectCreatedObservable.notifyObservers(E))),W._wasPreviouslyUsingInstances=!!T,!(null===(q=H)||void 0===q||!q.isReady())&&(p!==H&&j.resetCachedMaterial(),W._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(J,T){const b=T??this.getEffect();if(!b)return;const q=this._options.uniforms;-1!==q.indexOf("world")&&b.setMatrix("world",J);const t=this.va();-1!==q.indexOf("worldView")&&(J.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),b.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==q.indexOf("worldViewProjection")&&(J.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),b.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==q.indexOf("view")&&b.setMatrix("view",t.getViewMatrix())}bindForSubMesh(J,T,b){var q;this.bind(J,T,null===(q=b._drawWrapperOverride)||void 0===q?void 0:q.effect,b)}bind(J,T,b,q){const t=q&&this._storeEffectOnSubMeshes,j=b??(t?q.effect:this.getEffect());if(!j)return;const B=this.va();this._activeEffect=j,this.bindOnlyWorldMatrix(J,b);const Y=this._options.uniformBuffers;let C=!1;if(j&&Y&&Y.length>0&&B.getEngine().supportsUniformBuffers)for(let a=0;a<Y.length;++a){switch(Y[a]){case"Mesh":T&&(T.getMeshUniformBuffer().bindToEffect(j,"Mesh"),T.transferToEffect(J));break;case"Scene":(0,K.n)(j,B.getSceneUniformBuffer()),B.finalizeSceneUbo(),C=!0}}const F=T&&t?this._mustRebind(B,j,q,T.visibility):B.getCachedMaterial()!==this;if(j&&F){let J;for(J in C||-1===this._options.uniforms.indexOf("view")||j.setMatrix("view",B.getViewMatrix()),C||-1===this._options.uniforms.indexOf("projection")||j.setMatrix("projection",B.getProjectionMatrix()),C||-1===this._options.uniforms.indexOf("viewProjection")||(j.setMatrix("viewProjection",B.getTransformMatrix()),this._multiview&&j.setMatrix("viewProjectionR",B._transformMatrixR)),B.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&j.setVector3("cameraPosition",B.activeCamera.globalPosition),(0,K.b)(T,j),(0,U.h)(j,this,B),this._useLogarithmicDepth&&(0,K.j)(t?q.materialDefines:j.defines,j,B),T&&(0,K.c)(B,T,j),this._textures)j.setTexture(J,this._textures[J]);for(J in this._textureArrays)j.setTextureArray(J,this._textureArrays[J]);for(J in this._ints)j.setInt(J,this._ints[J]);for(J in this._uints)j.setUInt(J,this._uints[J]);for(J in this._floats)j.setFloat(J,this._floats[J]);for(J in this._floatsArrays)j.setArray(J,this._floatsArrays[J]);for(J in this._colors3)j.setColor3(J,this._colors3[J]);for(J in this._colors3Arrays)j.setArray3(J,this._colors3Arrays[J]);for(J in this._colors4){const T=this._colors4[J];j.setFloat4(J,T.r,T.g,T.b,T.a)}for(J in this._colors4Arrays)j.setArray4(J,this._colors4Arrays[J]);for(J in this._vectors2)j.setVector2(J,this._vectors2[J]);for(J in this._vectors3)j.setVector3(J,this._vectors3[J]);for(J in this._vectors4)j.setVector4(J,this._vectors4[J]);for(J in this._quaternions)j.setQuaternion(J,this._quaternions[J]);for(J in this._matrices)j.setMatrix(J,this._matrices[J]);for(J in this._matrixArrays)j.setMatrices(J,this._matrixArrays[J]);for(J in this._matrices3x3)j.setMatrix3x3(J,this._matrices3x3[J]);for(J in this._matrices2x2)j.setMatrix2x2(J,this._matrices2x2[J]);for(J in this._vectors2Arrays)j.setArray2(J,this._vectors2Arrays[J]);for(J in this._vectors3Arrays)j.setArray3(J,this._vectors3Arrays[J]);for(J in this._vectors4Arrays)j.setArray4(J,this._vectors4Arrays[J]);for(J in this._quaternionsArrays)j.setArray4(J,this._quaternionsArrays[J]);for(J in this._uniformBuffers){const T=this._uniformBuffers[J].getBuffer();T&&j.bindUniformBuffer(T,J)}const b=B.getEngine(),Y=b.setExternalTexture;if(Y)for(J in this._externalTextures)Y.call(b,J,this._externalTextures[J]);const F=b.setTextureSampler;if(F)for(J in this._textureSamplers)F.call(b,J,this._textureSamplers[J]);const A=b.setStorageBuffer;if(A)for(J in this._storageBuffers)A.call(b,J,this._storageBuffers[J])}if(j&&T&&(F||!this.isFrozen)){(0,K.m)(T,j),T.morphTargetManager&&T.morphTargetManager.isUsingTextureForTargets&&T.morphTargetManager._bind(j);const J=T.bakedVertexAnimationManager;if(J&&J.isEnabled){var A;const J=t?q._drawWrapper:this._drawWrapper;null===(A=T.bakedVertexAnimationManager)||void 0===A||A.bind(j,!!J._wasPreviouslyUsingInstances)}}this._afterBind(T,j,q)}getActiveTextures(){const J=super.getActiveTextures();for(const T in this._textures)J.push(this._textures[T]);for(const T in this._textureArrays){const b=this._textureArrays[T];for(let T=0;T<b.length;T++)J.push(b[T])}return J}hasTexture(J){if(super.hasTexture(J))return!0;for(const T in this._textures)if(this._textures[T]===J)return!0;for(const T in this._textureArrays){const b=this._textureArrays[T];for(let T=0;T<b.length;T++)if(b[T]===J)return!0}return!1}clone(J){const T=A.d.Clone((()=>new l(J,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);T.name=J,T.id=J,"object"===typeof T._shaderPath&&(T._shaderPath={...T._shaderPath}),this._options={...this._options};const b=Object.keys(this._options);for(const q of b){const J=this._options[q];Array.isArray(J)&&(this._options[q]=J.slice(0))}this.stencil.copyTo(T.stencil);for(const q in this._textures)T.setTexture(q,this._textures[q]);for(const q in this._textureArrays)T.setTextureArray(q,this._textureArrays[q]);for(const q in this._externalTextures)T.setExternalTexture(q,this._externalTextures[q]);for(const q in this._ints)T.setInt(q,this._ints[q]);for(const q in this._uints)T.setUInt(q,this._uints[q]);for(const q in this._floats)T.setFloat(q,this._floats[q]);for(const q in this._floatsArrays)T.setFloats(q,this._floatsArrays[q]);for(const q in this._colors3)T.setColor3(q,this._colors3[q]);for(const q in this._colors3Arrays)T._colors3Arrays[q]=this._colors3Arrays[q];for(const q in this._colors4)T.setColor4(q,this._colors4[q]);for(const q in this._colors4Arrays)T._colors4Arrays[q]=this._colors4Arrays[q];for(const q in this._vectors2)T.setVector2(q,this._vectors2[q]);for(const q in this._vectors3)T.setVector3(q,this._vectors3[q]);for(const q in this._vectors4)T.setVector4(q,this._vectors4[q]);for(const q in this._quaternions)T.setQuaternion(q,this._quaternions[q]);for(const q in this._quaternionsArrays)T._quaternionsArrays[q]=this._quaternionsArrays[q];for(const q in this._matrices)T.setMatrix(q,this._matrices[q]);for(const q in this._matrixArrays)T._matrixArrays[q]=this._matrixArrays[q].slice();for(const q in this._matrices3x3)T.setMatrix3x3(q,this._matrices3x3[q]);for(const q in this._matrices2x2)T.setMatrix2x2(q,this._matrices2x2[q]);for(const q in this._vectors2Arrays)T.setArray2(q,this._vectors2Arrays[q]);for(const q in this._vectors3Arrays)T.setArray3(q,this._vectors3Arrays[q]);for(const q in this._vectors4Arrays)T.setArray4(q,this._vectors4Arrays[q]);for(const q in this._uniformBuffers)T.setUniformBuffer(q,this._uniformBuffers[q]);for(const q in this._textureSamplers)T.setTextureSampler(q,this._textureSamplers[q]);for(const q in this._storageBuffers)T.setStorageBuffer(q,this._storageBuffers[q]);return T}dispose(J,T,b){if(T){let J;for(J in this._textures)this._textures[J].dispose();for(J in this._textureArrays){const T=this._textureArrays[J];for(let J=0;J<T.length;J++)T[J].dispose()}}this._textures={},super.dispose(J,T,b)}serialize(){const J=A.d.Serialize(this);let T;for(T in J.customType="BABYLON.ShaderMaterial",J.uniqueId=this.uniqueId,J.options=this._options,J.shaderPath=this._shaderPath,J.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,J.stencil=this.stencil.serialize(),J.textures={},this._textures)J.textures[T]=this._textures[T].serialize();for(T in J.textureArrays={},this._textureArrays){J.textureArrays[T]=[];const b=this._textureArrays[T];for(let q=0;q<b.length;q++)J.textureArrays[T].push(b[q].serialize())}for(T in J.ints={},this._ints)J.ints[T]=this._ints[T];for(T in J.uints={},this._uints)J.uints[T]=this._uints[T];for(T in J.floats={},this._floats)J.floats[T]=this._floats[T];for(T in J.floatsArrays={},this._floatsArrays)J.floatsArrays[T]=this._floatsArrays[T];for(T in J.colors3={},this._colors3){const b=this._colors3[T];J.colors3[T]=[b.r,b.g,b.b]}for(T in J.colors3Arrays={},this._colors3Arrays)J.colors3Arrays[T]=this._colors3Arrays[T];for(T in J.colors4={},this._colors4){const b=this._colors4[T];J.colors4[T]=[b.r,b.g,b.b,b.a]}for(T in J.colors4Arrays={},this._colors4Arrays)J.colors4Arrays[T]=this._colors4Arrays[T];for(T in J.vectors2={},this._vectors2){const b=this._vectors2[T];J.vectors2[T]=[b.x,b.y]}for(T in J.vectors3={},this._vectors3){const b=this._vectors3[T];J.vectors3[T]=[b.x,b.y,b.z]}for(T in J.vectors4={},this._vectors4){const b=this._vectors4[T];J.vectors4[T]=[b.x,b.y,b.z,b.w]}for(T in J.quaternions={},this._quaternions)J.quaternions[T]=this._quaternions[T].Ai();for(T in J.matrices={},this._matrices)J.matrices[T]=this._matrices[T].Ai();for(T in J.matrixArray={},this._matrixArrays)J.matrixArray[T]=this._matrixArrays[T];for(T in J.matrices3x3={},this._matrices3x3)J.matrices3x3[T]=this._matrices3x3[T];for(T in J.matrices2x2={},this._matrices2x2)J.matrices2x2[T]=this._matrices2x2[T];for(T in J.vectors2Arrays={},this._vectors2Arrays)J.vectors2Arrays[T]=this._vectors2Arrays[T];for(T in J.vectors3Arrays={},this._vectors3Arrays)J.vectors3Arrays[T]=this._vectors3Arrays[T];for(T in J.vectors4Arrays={},this._vectors4Arrays)J.vectors4Arrays[T]=this._vectors4Arrays[T];for(T in J.quaternionsArrays={},this._quaternionsArrays)J.quaternionsArrays[T]=this._quaternionsArrays[T];return J}static Parse(J,T,b){const t=A.d.Parse((()=>new l(J.name,T,J.shaderPath,J.options,J.storeEffectOnSubMeshes)),J,T,b);let j;for(j in J.stencil&&t.stencil.parse(J.stencil,T,b),J.textures)t.setTexture(j,P.b.Parse(J.textures[j],T,b));for(j in J.textureArrays){const q=J.textureArrays[j],B=[];for(let J=0;J<q.length;J++)B.push(P.b.Parse(q[J],T,b));t.setTextureArray(j,B)}for(j in J.ints)t.setInt(j,J.ints[j]);for(j in J.uints)t.setUInt(j,J.uints[j]);for(j in J.floats)t.setFloat(j,J.floats[j]);for(j in J.floatsArrays)t.setFloats(j,J.floatsArrays[j]);for(j in J.colors3){const T=J.colors3[j];t.setColor3(j,{r:T[0],g:T[1],b:T[2]})}for(j in J.colors3Arrays){const T=J.colors3Arrays[j].reduce(((J,T,b)=>(b%3===0?J.push([T]):J[J.length-1].push(T),J)),[]).map((J=>({r:J[0],g:J[1],b:J[2]})));t.setColor3Array(j,T)}for(j in J.colors4){const T=J.colors4[j];t.setColor4(j,{r:T[0],g:T[1],b:T[2],a:T[3]})}for(j in J.colors4Arrays){const T=J.colors4Arrays[j].reduce(((J,T,b)=>(b%4===0?J.push([T]):J[J.length-1].push(T),J)),[]).map((J=>({r:J[0],g:J[1],b:J[2],a:J[3]})));t.setColor4Array(j,T)}for(j in J.vectors2){const T=J.vectors2[j];t.setVector2(j,{x:T[0],y:T[1]})}for(j in J.vectors3){const T=J.vectors3[j];t.setVector3(j,{x:T[0],y:T[1],z:T[2]})}for(j in J.vectors4){const T=J.vectors4[j];t.setVector4(j,{x:T[0],y:T[1],z:T[2],w:T[3]})}for(j in J.quaternions)t.setQuaternion(j,q.h.ni(J.quaternions[j]));for(j in J.matrices)t.setMatrix(j,q.e.ni(J.matrices[j]));for(j in J.matrixArray)t._matrixArrays[j]=new Float32Array(J.matrixArray[j]);for(j in J.matrices3x3)t.setMatrix3x3(j,J.matrices3x3[j]);for(j in J.matrices2x2)t.setMatrix2x2(j,J.matrices2x2[j]);for(j in J.vectors2Arrays)t.setArray2(j,J.vectors2Arrays[j]);for(j in J.vectors3Arrays)t.setArray3(j,J.vectors3Arrays[j]);for(j in J.vectors4Arrays)t.setArray4(j,J.vectors4Arrays[j]);for(j in J.quaternionsArrays)t.setArray4(j,J.quaternionsArrays[j]);return t}static async ParseFromFileAsync(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((t,j)=>{const B=new x.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const T=JSON.parse(B.responseText),j=this.Parse(T,b||u.e.LastCreatedScene,q);J&&(j.name=J),t(j)}else j("Unable to load the ShaderMaterial")})),B.open("GET",T),B.send()}))}static async ParseFromSnippetAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((q,t)=>{const j=new x.b;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const t=JSON.parse(JSON.parse(j.responseText).jsonPayload),B=JSON.parse(t.shaderMaterial),Y=this.Parse(B,T||u.e.LastCreatedScene,b);Y.snippetId=J,q(Y)}else t("Unable to load the snippet "+J)})),j.open("GET",this.SnippetUrl+"/"+J.replace(/#/g,"/")),j.send()}))}}l.SnippetUrl="https://snippet.babylonjs.com",l.CreateFromSnippetAsync=l.ParseFromSnippetAsync,(0,v.g)("BABYLON.ShaderMaterial",l),t.e._LinesMeshParser=(J,T)=>W.Parse(J,T);class W extends t.e{_isShaderMaterial(J){return"ShaderMaterial"===J.getClassName()}constructor(J){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0;super(J,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T,arguments.length>4?arguments[4]:void 0),this.useVertexColor=q,this.useVertexAlpha=t,this.color=new B.b(1,1,1),this.alpha=1,this._shaderLanguage=0,T&&(this.color=T.color.clone(),this.alpha=T.alpha,this.useVertexColor=T.useVertexColor,this.useVertexAlpha=T.useVertexAlpha),this.intersectionThreshold=.1;const C={attributes:[Y.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?C.defines.push("#define VERTEXALPHA"):C.needAlphaBlending=!1,this.useVertexColor?(C.defines.push("#define VERTEXCOLOR"),C.attributes.push(Y.e.ColorKind)):(C.uniforms.push("color"),this._color4=new B.d),j)this.material=j;else{this.va().getEngine().isWebGPU&&!W.ForceGLSL&&(this._shaderLanguage=1),C.shaderLanguage=this._shaderLanguage,C.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([b.e(43).then(b.bind(b,14095)),b.e(102).then(b.bind(b,14099))]):await Promise.all([b.e(48).then(b.bind(b,14108)),b.e(103).then(b.bind(b,14110))])},this.material=new l("colorShader",this.va(),"color",C,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(J){this._lineMaterial=J,this._lineMaterial.fillMode=F.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(J){}_bind(J,T){if(!this._geometry)return this;const b=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(T,b):this._geometry._bind(T,b,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:J,g:T,b:b}=this.color;this._color4.set(J,T,b,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(J,T,b){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const q=this.va().getEngine();return this._unIndexed?q.drawArraysType(F.c.LineListDrawMode,J.verticesStart,J.verticesCount,b):q.drawElementsType(F.c.LineListDrawMode,J.indexStart,J.indexCount,b),this}dispose(J){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(J)}clone(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(T&&void 0===T._addToSceneRootNodes){const b=T;return b.source=this,new W(J,this.va(),b.parent,b.source,b.doNotCloneChildren)}return new W(J,this.va(),T,this,b)}createInstance(J){const T=new p(J,this);if(this.instancedBuffers){T.instancedBuffers={};for(const J in this.instancedBuffers)T.instancedBuffers[J]=this.instancedBuffers[J]}return T}serialize(J){super.serialize(J),J.color=this.color.Ai(),J.alpha=this.alpha}static Parse(J,T){const b=new W(J.name,T);return b.color=B.b.ni(J.color),b.alpha=J.alpha,b}}W.ForceGLSL=!1;class p extends C.c{constructor(J,T){super(J,T),this.intersectionThreshold=T.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var o=b(519);function S(J){const T=[],b=[],q=J.lines,t=J.za,B=[];let Y=0;for(let j=0;j<q.length;j++){const J=q[j];for(let q=0;q<J.length;q++){const{x:C,y:F,z:A}=J[q];if(b.push(C,F,A),t){const J=t[j],{r:T,g:b,b:Y,a:C}=J[q];B.push(T,b,Y,C)}q>0&&(T.push(Y-1),T.push(Y)),Y++}}const C=new j.c;return C.indices=T,C.xa=b,t&&(C.za=B),C}function H(J){const T=J.dashSize||3,b=J.gapSize||1,t=J.dashNb||200,B=J.points,Y=[],C=[],F=q.n.Zero();let A=0,a=0,P=0,v=0,G=0,x=0,I=0;for(I=0;I<B.length-1;I++)B[I+1].subtractToRef(B[I],F),A+=F.length();for(P=A/t,v=T*P/(T+b),I=0;I<B.length-1;I++){B[I+1].subtractToRef(B[I],F),a=Math.floor(F.length()/P),F.normalize();for(let J=0;J<a;J++)G=P*J,Y.push(B[I].x+G*F.x,B[I].y+G*F.y,B[I].z+G*F.z),Y.push(B[I].x+(G+v)*F.x,B[I].y+(G+v)*F.y,B[I].z+(G+v)*F.z),C.push(x,x+1),x+=2}const u=new j.c;return u.xa=Y,u.indices=C,u}function s(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=T.instance,t=T.lines,j=T.za;if(q){const J=q.getVerticesData(Y.e.PositionKind);let T,b;j&&(T=q.getVerticesData(Y.e.ColorKind));let B=0,C=0;for(let q=0;q<t.length;q++){const Y=t[q];for(let t=0;t<Y.length;t++)J[B]=Y[t].x,J[B+1]=Y[t].y,J[B+2]=Y[t].z,j&&T&&(b=j[q],T[C]=b[t].r,T[C+1]=b[t].g,T[C+2]=b[t].b,T[C+3]=b[t].a,C+=4),B+=3}return q.updateVerticesData(Y.e.PositionKind,J,!1,!1),j&&T&&q.updateVerticesData(Y.e.ColorKind,T,!1,!1),q.refreshBoundingInfo(),q}const B=new W(J,b,null,void 0,void 0,!!j,T.useVertexAlpha,T.material);return S(T).Ca(B,T.updatable),B}function g(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=T.za?[T.za]:null;return s(J,{lines:[T.points],updatable:T.updatable,instance:T.instance,za:q,useVertexAlpha:T.useVertexAlpha,material:T.material},b)}function d(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=T.points,B=T.instance,Y=T.gapSize||1,C=T.dashSize||3;if(B){const J=J=>{const T=q.n.Zero(),b=J.length/6;let t=0,Y=0,C=0,F=0,A=0,a=0,P=0,v=0;for(P=0;P<j.length-1;P++)j[P+1].subtractToRef(j[P],T),t+=T.length();C=t/b;const G=B._creationDataStorage.dashSize;for(F=G*C/(G+B._creationDataStorage.gapSize),P=0;P<j.length-1;P++)for(j[P+1].subtractToRef(j[P],T),Y=Math.floor(T.length()/C),T.normalize(),v=0;v<Y&&a<J.length;)A=C*v,J[a]=j[P].x+A*T.x,J[a+1]=j[P].y+A*T.y,J[a+2]=j[P].z+A*T.z,J[a+3]=j[P].x+(A+F)*T.x,J[a+4]=j[P].y+(A+F)*T.y,J[a+5]=j[P].z+(A+F)*T.z,a+=6,v++;for(;a<J.length;)J[a]=j[P].x,J[a+1]=j[P].y,J[a+2]=j[P].z,a+=3};return(T.dashNb||T.dashSize||T.gapSize||T.useVertexAlpha||T.material)&&o.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),B.updateMeshPositions(J,!1),B}const F=new W(J,b,null,void 0,void 0,void 0,T.useVertexAlpha,T.material);return H(T).Ca(F,T.updatable),F._creationDataStorage=new t.i,F._creationDataStorage.dashSize=C,F._creationDataStorage.gapSize=Y,F}j.c.CreateLineSystem=S,j.c.CreateDashedLines=H,t.e.Fi=function(J,T){return g(J,{points:T,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},t.e.CreateDashedLines=function(J,T,b,q,t){return d(J,{points:T,dashSize:b,gapSize:q,dashNb:t,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12076:(J,T,b)=>{"use strict";b.d(T,{d:()=>Y,e:()=>C});var q=b(494),t=b(768),j=b(830);function B(J){const T=[],b=[],q=[],B=[],Y=void 0!==J.width?J.width:void 0!==J.size?J.size:1,C=void 0!==J.height?J.height:void 0!==J.size?J.size:1,F=0===J.sideOrientation?0:J.sideOrientation||t.c.DEFAULTSIDE,A=Y/2,a=C/2;b.push(-A,-a,0),q.push(0,0,-1),B.push(0,j.c?1:0),b.push(A,-a,0),q.push(0,0,-1),B.push(1,j.c?1:0),b.push(A,a,0),q.push(0,0,-1),B.push(1,j.c?0:1),b.push(-A,a,0),q.push(0,0,-1),B.push(0,j.c?0:1),T.push(0),T.push(1),T.push(2),T.push(0),T.push(2),T.push(3),t.c._ComputeSides(F,b,T,q,B,J.frontUVs,J.backUVs);const P=new t.c;return P.indices=T,P.xa=b,P.ya=q,P.Aa=B,P}function Y(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.e(J,b);T.sideOrientation=q.e._GetDefaultSideOrientation(T.sideOrientation),t._originalBuilderSideOrientation=T.sideOrientation;return B(T).Ca(t,T.updatable),T.sourcePlane&&(t.translate(T.sourcePlane.Ti,-T.sourcePlane.d),t.setDirection(T.sourcePlane.Ti.scale(-1))),t}const C={Gi:Y};t.c.Gi=B,q.e.Gi=(J,T,b,q,t)=>Y(J,{size:T,width:T,height:T,sideOrientation:t,updatable:q},b)},12172:(J,T,b)=>{"use strict";b.d(T,{b:()=>C});var q=b(697),t=b(494),j=b(768),B=b(830);function Y(J){const T=0|(J.segments||32),b=J.diameterX||J.diameter||1,t=J.diameterY||J.diameter||1,Y=J.diameterZ||J.diameter||1,C=J.arc&&(J.arc<=0||J.arc>1)?1:J.arc||1,F=J.slice&&J.slice<=0?1:J.slice||1,A=0===J.sideOrientation?0:J.sideOrientation||j.c.DEFAULTSIDE,a=!!J.dedupTopBottomIndices,P=new q.n(b/2,t/2,Y/2),v=2+T,G=2*v,x=[],I=[],u=[],U=[];for(let j=0;j<=v;j++){const J=j/v,T=J*Math.PI*F;for(let b=0;b<=G;b++){const t=b/G,j=t*Math.PI*2*C,Y=q.e.RotationZ(-T),F=q.e.RotationY(j),A=q.n.TransformCoordinates(q.n.Up(),Y),a=q.n.TransformCoordinates(A,F),v=a.multiply(P),x=a.divide(P).normalize();I.push(v.x,v.y,v.z),u.push(x.x,x.y,x.z),U.push(t,B.c?1-J:J)}if(j>0){const J=I.length/3;for(let T=J-2*(G+1);T+G+2<J;T++)a?(j>1&&(x.push(T),x.push(T+1),x.push(T+G+1)),(j<v||F<1)&&(x.push(T+G+1),x.push(T+1),x.push(T+G+2))):(x.push(T),x.push(T+1),x.push(T+G+1),x.push(T+G+1),x.push(T+1),x.push(T+G+2))}}j.c._ComputeSides(A,I,x,u,U,J.frontUVs,J.backUVs);const K=new j.c;return K.indices=x,K.xa=I,K.ya=u,K.Aa=U,K}function C(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return Y(T).Ca(q,T.updatable),q}j.c.CreateSphere=Y,t.e.CreateSphere=(J,T,b,q,t,j)=>C(J,{segments:T,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:j,updatable:t},q)},12560:(J,T,b)=>{"use strict";b.d(T,{b:()=>C,d:()=>B,f:()=>Y});var q=b(505),t=b(2521),j=b(12567);function B(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function Y(J){return!!(J.wasmUrl&&(J.wasmBinary||J.wasmBinaryUrl)&&"object"===typeof WebAssembly||J.fallbackUrl)}class C{constructor(J){if(J.workerPool)return void(this._workerPoolPromise=Promise.resolve(J.workerPool));const T=J.wasmBinary,b=J.numWorkers??B(),Y=b&&"function"===typeof Worker&&"function"===typeof URL,C=Y||!J.jsModule,F=J.wasmUrl&&J.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:C?q.e.GetBabylonScriptURL(J.wasmUrl,!0):"",wasmBinaryPromise:T?Promise.resolve(T):q.e.LoadFileAsync(q.e.GetBabylonScriptURL(J.wasmBinaryUrl,!0))}:{url:C?q.e.GetBabylonScriptURL(J.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};Y?this._workerPoolPromise=F.wasmBinaryPromise.then((J=>{const T=this._getWorkerContent(),q=URL.createObjectURL(new Blob([T],{type:"application/javascript"}));return new t.d(b,(()=>{const T=new Worker(q);return(0,j.g)(T,J,F.url)}))})):this._modulePromise=F.wasmBinaryPromise.then((async T=>{if(!this._isModuleAvailable()&&!J.jsModule){if(!F.url)throw new Error("Draco codec module is not available");await q.e.LoadBabylonScriptAsync(F.url)}return await this._createModuleAsync(T,J.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((J=>{J.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},12878:(J,T,b)=>{"use strict";b.d(T,{b:()=>Y});var q=b(12560),t=b(12551),j=b(12573),B=b(768);class Y{static get Configuration(){return{get decoder(){return t.b.DefaultConfiguration},set decoder(J){t.b.DefaultConfiguration=J}}}static set Configuration(J){t.b.DefaultConfiguration=J.decoder}static get DecoderAvailable(){return(0,q.f)(t.b.DefaultConfiguration)}static get Default(){return Y._Default??(Y._Default=new Y),Y._Default}static ResetDefault(J){Y._Default&&(J||Y._Default.dispose(),Y._Default=null)}constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.DefaultNumWorkers;const T="number"===typeof J?{...t.b.DefaultConfiguration,numWorkers:J}:{...t.b.DefaultConfiguration,...J};this._decoder=new t.b(T)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(J,T,b){return this._decoder.decodeMeshToMeshDataAsync(J,T,b)}async decodeMeshToGeometryAsync(J,T,b,q){return await this._decoder.decodeMeshToGeometryAsync(J,T,b,q)}async _decodeMeshToGeometryForGltfAsync(J,T,b,q,t,j){return await this._decoder._decodeMeshToGeometryForGltfAsync(J,T,b,q,t,j)}async decodeMeshAsync(J,T){const b=await this._decoder.decodeMeshToMeshDataAsync(J,T),q=new B.c;b.indices&&(q.indices=b.indices);for(const t of b.attributes){const J=j.d.GetFloatData(t.data,t.size,j.d.GetDataType(t.data),t.byteOffset,t.byteStride,t.normalized,b.totalVertices);q.set(J,t.kind)}return q}}Y.DefaultNumWorkers=(0,q.d)(),Y._Default=null},12567:(J,T,b)=>{"use strict";function q(J,T,b,q,t){const j=J;let B=null,Y=null,C=null;try{let J;B=new j.Decoder,Y=new j.DecoderBuffer,Y.Init(T,T.byteLength);const F=B.GetEncodedGeometryType(Y);switch(F){case j.TRIANGULAR_MESH:{const T=new j.Mesh;if(J=B.DecodeBufferToMesh(Y,T),!J.ok()||0===T.ptr)throw new Error(J.error_msg());const b=3*T.num_faces(),t=4*b,F=j._malloc(t);try{B.GetTrianglesUInt32Array(T,t,F);const J=new Uint32Array(b);J.set(new Uint32Array(j.HEAPF32.buffer,F,b)),q(J)}finally{j._free(F)}C=T;break}case j.POINT_CLOUD:{const T=new j.PointCloud;if(J=B.DecodeBufferToPointCloud(Y,T),!J.ok()||!T.ptr)throw new Error(J.error_msg());C=T;break}default:throw new Error(`Invalid geometry type ${F}`)}const A=C.num_points(),a=(J,T,b,q)=>{const B=q.data_type(),Y=q.num_components(),C=q.normalized(),F=q.byte_stride(),a=q.byte_offset(),P={[j.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:j.HEAPF32},[j.DT_INT8]:{typedArrayConstructor:Int8Array,heap:j.HEAP8},[j.DT_INT16]:{typedArrayConstructor:Int16Array,heap:j.HEAP16},[j.DT_INT32]:{typedArrayConstructor:Int32Array,heap:j.HEAP32},[j.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:j.HEAPU8},[j.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:j.HEAPU16},[j.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:j.HEAPU32}}[B];if(!P)throw new Error(`Invalid data type ${B}`);const v=A*Y,G=v*P.typedArrayConstructor.BYTES_PER_ELEMENT,x=j._malloc(G);try{J.GetAttributeDataArrayForAllPoints(T,q,B,G,x);const j=new P.typedArrayConstructor(P.heap.buffer,x,v);t(b,j.slice(),Y,a,F,C)}finally{j._free(x)}};if(b)for(const T in b){const J=b[T],q=B.GetAttributeByUniqueId(C,J);a(B,C,T,q)}else{const J={position:j.POSITION,Ti:j.NORMAL,color:j.COLOR,uv:j.TEX_COORD};for(const T in J){const b=B.GetAttributeId(C,J[T]);if(-1!==b){const J=B.GetAttribute(C,b);a(B,C,T,J)}}}return A}finally{C&&j.destroy(C),Y&&j.destroy(Y),B&&j.destroy(B)}}function t(){let J;onmessage=T=>{const b=T.data;switch(b.id){case"init":{b.url&&importScripts(b.url);const T=b.wasmBinary?{wasmBinary:b.wasmBinary}:{};J=DracoDecoderModule(T),postMessage({id:"initDone"});break}case"decodeMesh":if(!J)throw new Error("Draco decoder module is not available");J.then((J=>{const T=q(J,b.dataView,b.attributes,(J=>{postMessage({id:"indices",data:J},[J.buffer])}),((J,T,b,q,t,j)=>{postMessage({id:"attribute",kind:J,data:T,size:b,byteOffset:q,byteStride:t,normalized:j},[T.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:T})}))}}}async function j(J,T,b){return await new Promise(((q,t)=>{const j=T=>{J.removeEventListener("error",j),J.removeEventListener("message",B),t(T)},B=T=>{"initDone"===T.data.id&&(J.removeEventListener("error",j),J.removeEventListener("message",B),q(J))};if(J.addEventListener("error",j),J.addEventListener("message",B),T){const q=T.slice(0);J.postMessage({id:"init",url:b,wasmBinary:q},[q])}else J.postMessage({id:"init",url:b})}))}b.d(T,{d:()=>q,e:()=>t,g:()=>j})},12551:(J,T,b)=>{"use strict";b.d(T,{b:()=>F});var q=b(12560),t=b(505),j=b(812),B=b(12573),Y=b(519),C=b(12567);class F extends q.b{static get DefaultAvailable(){return(0,q.f)(F.DefaultConfiguration)}static get Default(){return F._Default??(F._Default=new F),F._Default}static ResetDefault(J){F._Default&&(J||F._Default.dispose(),F._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(J,T){return{module:await(T||DracoDecoderModule)({wasmBinary:J})}}_getWorkerContent(){return`${C.d}(${C.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.DefaultConfiguration)}decodeMeshToMeshDataAsync(J,T,b){const q=J instanceof ArrayBuffer?new Int8Array(J):new Int8Array(J.buffer,J.byteOffset,J.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async J=>await new Promise(((t,j)=>{J.push(((J,B)=>{let C=null;const F=[],A=T=>{J.removeEventListener("error",A),J.removeEventListener("message",a),j(T),B()},a=T=>{const q=T.data;switch(q.id){case"indices":C=q.data;break;case"attribute":F.push({kind:q.kind,data:q.data,size:q.size,byteOffset:q.byteOffset,byteStride:q.byteStride,normalized:(j=q.kind,P=q.normalized,b&&void 0!==b[j]?(P!==b[j]&&Y.d.Warn(`Normalized flag from Draco data (${P}) does not match normalized flag from glTF accessor (${b[j]}). Using flag from glTF accessor.`),b[j]):P)});break;case"decodeMeshDone":J.removeEventListener("error",A),J.removeEventListener("message",a),t({indices:C,attributes:F,totalVertices:q.totalVertices}),B()}var j,P};J.addEventListener("error",A),J.addEventListener("message",a);const P=q.slice();J.postMessage({id:"decodeMesh",dataView:P,attributes:T},[P.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((J=>{let b=null;const t=[],j=(0,C.d)(J.module,q,T,(J=>{b=J}),((J,T,b,q,j,B)=>{t.push({kind:J,data:T,size:b,byteOffset:q,byteStride:j,normalized:B})}));return{indices:b,attributes:t,totalVertices:j}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(J,T,b,q){const t=await this.decodeMeshToMeshDataAsync(b,q),Y=new j.c(J,T);t.indices&&Y.setIndices(t.indices);for(const j of t.attributes)Y.setVerticesBuffer(new B.d(T.getEngine(),j.data,j.kind,!1,void 0,j.byteStride,void 0,j.byteOffset,j.size,void 0,j.normalized,!0),t.totalVertices);return Y}async _decodeMeshToGeometryForGltfAsync(J,T,b,q,t,Y){const C=await this.decodeMeshToMeshDataAsync(b,q,t),F=new j.c(J,T);Y&&(F._boundingInfo=Y,F.useBoundingInfoFromGeometry=!0),C.indices&&F.setIndices(C.indices);for(const j of C.attributes)F.setVerticesBuffer(new B.d(T.getEngine(),j.data,j.kind,!1,void 0,j.byteStride,void 0,j.byteOffset,j.size,void 0,j.normalized,!0),C.totalVertices);return F}}F.DefaultConfiguration={wasmUrl:`${t.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${t.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${t.e._DefaultCdnUrl}/draco_decoder_gltf.js`},F._Default=null},12573:(J,T,b)=>{"use strict";b.d(T,{d:()=>q.e});var q=b(751)},12502:(J,T,b)=>{"use strict";b.d(T,{c:()=>P});var q=b(697),t=b(519),j=b(834),B=b(494),Y=b(526),C=b(837),F=b(751),A=b(505),a=b(639);B.e._instancedMeshFactory=(J,T)=>{const b=new P(J,T);if(T.instancedBuffers){b.instancedBuffers={};for(const J in T.instancedBuffers)b.instancedBuffers[J]=T.instancedBuffers[J]}return b};class P extends j.d{constructor(J,T){super(J,T.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,T.Di(this),this._sourceMesh=T,this._unIndexed=T._unIndexed,this.position.p(T.position),this.rotation.p(T.rotation),this.ii.p(T.ii),T.rotationQuaternion&&(this.rotationQuaternion=T.rotationQuaternion.clone()),this.animations=T.animations.slice();for(const b of T.getAnimationRanges())null!=b&&this.createAnimationRange(b.name,b.from,b.to);if(this.infiniteDistance=T.infiniteDistance,this.setPivotMatrix(T.getPivotMatrix()),T.skeleton||T.morphTargetManager||!T.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const J=T.getBoundingInfo();this.buildBoundingInfo(J.minimum,J.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(J){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.receiveShadows)!==J&&A.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(J){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.material)!==J&&A.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(J){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.visibility)!==J&&A.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(J){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.skeleton)!==J&&A.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(J){this._sourceMesh&&J!==this._sourceMesh.renderingGroupId&&t.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get qi(){return this._sourceMesh._geometry}createInstance(J){return this._sourceMesh.createInstance(J)}isReady(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(J,!0)}getVerticesData(J,T,b){return this._sourceMesh.getVerticesData(J,T,b)}copyVerticesData(J,T){this._sourceMesh.copyVerticesData(J,T)}Ga(J,T,b,q){return this.sourceMesh&&this.sourceMesh.Ga(J,T,b,q),this.sourceMesh}updateVerticesData(J,T,b,q){return this.sourceMesh&&this.sourceMesh.updateVerticesData(J,T,b,q),this.sourceMesh}setIndices(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(J,T),this.sourceMesh}isVerticesDataPresent(J){return this._sourceMesh.isVerticesDataPresent(J)}ui(){return this._sourceMesh.ui()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let J,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;J="object"===typeof T?T:{applySkeleton:T,applyMorph:b};const q=this._sourceMesh.qi?this._sourceMesh.qi.boundingBias:null;return this.Fa(this._sourceMesh._getData(J,null,F.e.PositionKind),q),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(J,T){if(super._activate(J,T),this._sourceMesh.xi||t.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,J),T){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==C.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new q.e);const J=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,q.j.pi[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ti(!0)),this._currentLOD.position.p(q.j.pi[7]),this._currentLOD._masterMesh=J,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(J){if(!J)return this;const T=this.sourceMesh.getLODLevels();if(T&&0!==T.length){const T=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(J,T.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(J){return this.sourceMesh._preActivateForIntermediateRendering(J)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.xi)for(let J=0;J<this._sourceMesh.xi.length;J++)this._sourceMesh.xi[J].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const q=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(J);if(Y.d.DeepCopy(this,q,["name","xi","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","ri","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","qi"],[]),this.refreshBoundingInfo(),T&&(q.parent=T),!b)for(let t=0;t<this.va().meshes.length;t++){const J=this.va().meshes[t];J.parent===this&&J.clone(J.name,q)}return q.ti(!0),this.onClonedObservable.notifyObservers(q),q}dispose(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ei(this),super.dispose(J,T)}_serializeAsParent(J){super._serializeAsParent(J),J.parentId=this._sourceMesh.uniqueId,J.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const q=this.clone("Clone of "+(this.name||this.id),J||this.parent,!0,T&&T.newSourcedMesh);q&&b&&b(this,q);for(const t of this.getChildTransformNodes(!0))t.instantiateHierarchy(q,T,b);return q}}B.e.prototype.registerInstancedBuffer=function(J,T){var b,q;if(null===(b=this._userInstancedBuffersStorage)||void 0===b||null===(q=b.vertexBuffers[J])||void 0===q||q.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const J of this.instances)J.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[J]=null,this._userInstancedBuffersStorage.strides[J]=T,this._userInstancedBuffersStorage.sizes[J]=32*T,this._userInstancedBuffersStorage.data[J]=new Float32Array(this._userInstancedBuffersStorage.sizes[J]),this._userInstancedBuffersStorage.vertexBuffers[J]=new F.e(this.getEngine(),this._userInstancedBuffersStorage.data[J],J,!0,!1,T,!0);for(const t of this.instances)t.instancedBuffers[J]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},B.e.prototype._processInstancedBuffers=function(J,T){const b=J?J.length:0;for(const q in this.instancedBuffers){let t=this._userInstancedBuffersStorage.sizes[q];const j=this._userInstancedBuffersStorage.strides[q],B=(b+1)*j;for(;t<B;)t*=2;this._userInstancedBuffersStorage.data[q].length!=t&&(this._userInstancedBuffersStorage.data[q]=new Float32Array(t),this._userInstancedBuffersStorage.sizes[q]=t,this._userInstancedBuffersStorage.vertexBuffers[q]&&(this._userInstancedBuffersStorage.vertexBuffers[q].dispose(),this._userInstancedBuffersStorage.vertexBuffers[q]=null));const Y=this._userInstancedBuffersStorage.data[q];let C=0;if(T){const J=this.instancedBuffers[q];J.toArray?J.toArray(Y,C):J.copyToArray?J.copyToArray(Y,C):Y[C]=J,C+=j}for(let T=0;T<b;T++){const b=J[T].instancedBuffers[q];b.toArray?b.toArray(Y,C):b.copyToArray?b.copyToArray(Y,C):Y[C]=b,C+=j}this._userInstancedBuffersStorage.vertexBuffers[q]?this._userInstancedBuffersStorage.vertexBuffers[q].updateDirectly(Y,0):(this._userInstancedBuffersStorage.vertexBuffers[q]=new F.e(this.getEngine(),this._userInstancedBuffersStorage.data[q],q,!0,!1,j,!0),this._invalidateInstanceVertexArrayObject())}},B.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const J in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[J]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},B.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const J in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[J]&&this._userInstancedBuffersStorage.vertexBuffers[J].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,a.g)("BABYLON.InstancedMesh",P)},12756:(J,T,b)=>{"use strict";b.d(T,{b:()=>xJ});var q=b(697),t=b(494),j=b(751),B=b(768),Y=b(830);function C(J){let T=J.pathArray;const b=J.closeArray||!1,q=J.closePath||!1,t=J.invertUV||!1,C=Math.floor(T[0].length/2);let F=J.offset||C;F=F>C?C:Math.floor(F);const A=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,a=J.Aa,P=J.za,v=[],G=[],x=[],I=[],u=[],U=[],K=[],E=[];let l;const W=[],p=[];let o,S,H;if(T.length<2){const J=[],b=[];for(S=0;S<T[0].length-F;S++)J.push(T[0][S]),b.push(T[0][S+F]);T=[J,b]}let s=0;const g=q?1:0,d=b?1:0;let w,Z,e,c,V,Q;for(l=T[0].length,o=0;o<T.length+d;o++){for(K[o]=0,u[o]=[0],w=o===T.length?T[0]:T[o],Z=w.length,l=l<Z?l:Z,H=0;H<Z;)v.push(w[H].x,w[H].y,w[H].z),H>0&&(e=w[H].Jg(w[H-1]).length(),c=e+K[o],u[o].push(c),K[o]=c),H++;q&&(H--,v.push(w[0].x,w[0].y,w[0].z),e=w[H].Jg(w[0]).length(),c=e+K[o],u[o].push(c),K[o]=c),W[o]=Z+g,p[o]=s,s+=Z+g}let h,i,m=null,O=null;for(S=0;S<l+g;S++)for(E[S]=0,U[S]=[0],o=0;o<T.length-1+d;o++)V=T[o],Q=o===T.length-1?T[0]:T[o+1],S===l?(m=V[0],O=Q[0]):(m=V[S],O=Q[S]),e=O.Jg(m).length(),c=e+E[S],U[S].push(c),E[S]=c;if(a)for(o=0;o<a.length;o++)I.push(a[o].x,Y.c?1-a[o].y:a[o].y);else for(o=0;o<T.length+d;o++)for(S=0;S<l+g;S++)h=0!=K[o]?u[o][S]/K[o]:0,i=0!=E[S]?U[S][o]/E[S]:0,t?I.push(i,h):I.push(h,Y.c?1-i:i);o=0;let X=0,L=W[o]-1,r=W[o+1]-1,N=L<r?L:r,R=p[1]-p[0];const n=W.length-1;for(;X<=N&&o<n;)G.push(X,X+R,X+1),G.push(X+R+1,X+1,X+R),X+=1,X===N&&(o++,R=p[o+1]-p[o],L=W[o]-1,r=W[o+1]-1,X=p[o],N=L<r?L+X:r+X);if(B.c.ComputeNormals(v,G,x),q){let J=0,b=0;for(o=0;o<T.length;o++){J=3*p[o],b=o+1<T.length?3*(p[o+1]-1):x.length-3,x[J]=.5*(x[J]+x[b]),x[J+1]=.5*(x[J+1]+x[b+1]),x[J+2]=.5*(x[J+2]+x[b+2]);const q=Math.sqrt(x[J]*x[J]+x[J+1]*x[J+1]+x[J+2]*x[J+2]);x[J]/=q,x[J+1]/=q,x[J+2]/=q,x[b]=x[J],x[b+1]=x[J+1],x[b+2]=x[J+2]}}if(b){let J=3*p[0],b=3*p[T.length];for(S=0;S<l+g;S++){x[J]=.5*(x[J]+x[b]),x[J+1]=.5*(x[J+1]+x[b+1]),x[J+2]=.5*(x[J+2]+x[b+2]);const T=Math.sqrt(x[J]*x[J]+x[J+1]*x[J+1]+x[J+2]*x[J+2]);x[J]/=T,x[J+1]/=T,x[J+2]/=T,x[b]=x[J],x[b+1]=x[J+1],x[b+2]=x[J+2],J+=3,b+=3}}B.c._ComputeSides(A,v,G,x,I,J.frontUVs,J.backUVs);let D=null;if(P){D=new Float32Array(4*P.length);for(let J=0;J<P.length;J++)D[4*J]=P[J].r,D[4*J+1]=P[J].g,D[4*J+2]=P[J].b,D[4*J+3]=P[J].a}const f=new B.c,z=new Float32Array(v),M=new Float32Array(x),y=new Float32Array(I);return f.indices=G,f.xa=z,f.ya=M,f.Aa=y,D&&f.set(D,j.e.ColorKind),q&&(f._idx=p),f}function F(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=T.pathArray,A=T.closeArray,a=T.closePath,P=t.e._GetDefaultSideOrientation(T.sideOrientation),v=T.instance,G=T.updatable;if(v){const J=q.j.pi[0].oi(Number.MAX_VALUE),b=q.j.pi[1].oi(-Number.MAX_VALUE),C=T=>{let q=F[0].length;const j=v;let B=0;const Y=j._originalBuilderSideOrientation===t.e.DOUBLESIDE?2:1;for(let t=1;t<=Y;++t)for(let Y=0;Y<F.length;++Y){const t=F[Y],C=t.length;q=q<C?q:C;for(let j=0;j<q;++j){const q=t[j];T[B]=q.x,T[B+1]=q.y,T[B+2]=q.z,J.minimizeInPlaceFromFloats(q.x,q.y,q.z),b.maximizeInPlaceFromFloats(q.x,q.y,q.z),B+=3}if(j._creationDataStorage&&j._creationDataStorage.closePath){const J=t[0];T[B]=J.x,T[B+1]=J.y,T[B+2]=J.z,B+=3}}},A=v.getVerticesData(j.e.PositionKind);if(C(A),v.hasBoundingInfo?v.getBoundingInfo().reConstruct(J,b,v._worldMatrix):v.buildBoundingInfo(J,b,v._worldMatrix),v.updateVerticesData(j.e.PositionKind,A,!1,!1),T.za){const J=v.getVerticesData(j.e.ColorKind);for(let b=0,q=0;b<T.za.length;b++,q+=4){const t=T.za[b];J[q]=t.r,J[q+1]=t.g,J[q+2]=t.b,J[q+3]=t.a}v.updateVerticesData(j.e.ColorKind,J,!1,!1)}if(T.Aa){const J=v.getVerticesData(j.e.UVKind);for(let b=0;b<T.Aa.length;b++)J[2*b]=T.Aa[b].x,J[2*b+1]=Y.c?1-T.Aa[b].y:T.Aa[b].y;v.updateVerticesData(j.e.UVKind,J,!1,!1)}if(!v.areNormalsFrozen||v.isFacetDataEnabled){const J=v.ui(),T=v.getVerticesData(j.e.NormalKind),b=v.isFacetDataEnabled?v.getFacetDataParameters():null;if(B.c.ComputeNormals(A,J,T,b),v._creationDataStorage&&v._creationDataStorage.closePath){let J=0,b=0;for(let q=0;q<F.length;q++)J=3*v._creationDataStorage.idx[q],b=q+1<F.length?3*(v._creationDataStorage.idx[q+1]-1):T.length-3,T[J]=.5*(T[J]+T[b]),T[J+1]=.5*(T[J+1]+T[b+1]),T[J+2]=.5*(T[J+2]+T[b+2]),T[b]=T[J],T[b+1]=T[J+1],T[b+2]=T[J+2]}v.areNormalsFrozen||v.updateVerticesData(j.e.NormalKind,T,!1,!1)}return v}{const q=new t.e(J,b);q._originalBuilderSideOrientation=P,q._creationDataStorage=new t.i;const j=C(T);return a&&(q._creationDataStorage.idx=j._idx),q._creationDataStorage.closePath=a,q._creationDataStorage.closeArray=A,j.Ca(q,G),q}}B.c.CreateRibbon=C,t.e.CreateRibbon=function(J,T){return F(J,{pathArray:T,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var A=b(889),a=b(12025),P=b(731);function v(J){const T=J.pattern||t.e.NO_FLIP,b=J.tileWidth||J.tileSize||1,q=J.tileHeight||J.tileSize||1,j=J.alignHorizontal||0,Y=J.alignVertical||0,C=J.width||J.size||1,F=Math.floor(C/b);let A=C-F*b;const a=J.height||J.size||1,P=Math.floor(a/q);let v=a-P*q;const G=b*F/2,x=q*P/2;let I=0,u=0,U=0,K=0,E=0,l=0;if(A>0||v>0){switch(U=-G,K=-x,E=G,l=x,j){case t.e.CENTER:A/=2,U-=A,E+=A;break;case t.e.LEFT:E+=A,I=-A/2;break;case t.e.RIGHT:U-=A,I=A/2}switch(Y){case t.e.CENTER:v/=2,K-=v,l+=v;break;case t.e.BOTTOM:l+=v,u=-v/2;break;case t.e.TOP:K-=v,u=v/2}}const W=[],p=[],o=[];o[0]=[0,0,1,0,1,1,0,1],o[1]=[0,0,1,0,1,1,0,1],T!==t.e.ROTATE_TILE&&T!==t.e.ROTATE_ROW||(o[1]=[1,1,0,1,0,0,1,0]),T!==t.e.FLIP_TILE&&T!==t.e.FLIP_ROW||(o[1]=[1,0,0,0,0,1,1,1]),T!==t.e.FLIP_N_ROTATE_TILE&&T!==t.e.FLIP_N_ROTATE_ROW||(o[1]=[0,1,1,1,1,0,0,0]);let S=[];const H=[],s=[];let g=0;for(let B=0;B<P;B++)for(let J=0;J<F;J++)W.push(J*b-G+I,B*q-x+u,0),W.push((J+1)*b-G+I,B*q-x+u,0),W.push((J+1)*b-G+I,(B+1)*q-x+u,0),W.push(J*b-G+I,(B+1)*q-x+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),S=T===t.e.FLIP_TILE||T===t.e.ROTATE_TILE||T===t.e.FLIP_N_ROTATE_TILE?S.concat(o[(J%2+B%2)%2]):T===t.e.FLIP_ROW||T===t.e.ROTATE_ROW||T===t.e.FLIP_N_ROTATE_ROW?S.concat(o[B%2]):S.concat(o[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),g+=4;if(A>0||v>0){const J=v>0&&(Y===t.e.CENTER||Y===t.e.TOP),B=v>0&&(Y===t.e.CENTER||Y===t.e.BOTTOM),C=A>0&&(j===t.e.CENTER||j===t.e.RIGHT),a=A>0&&(j===t.e.CENTER||j===t.e.LEFT);let o,d,w,Z,e=[];if(J&&C&&(W.push(U+I,K+u,0),W.push(-G+I,K+u,0),W.push(-G+I,K+v+u,0),W.push(U+I,K+v+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,o=1-A/b,d=1-v/q,w=1,Z=1,e=[o,d,w,d,w,Z,o,Z],T===t.e.ROTATE_ROW&&(e=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),T===t.e.FLIP_ROW&&(e=[1-o,d,1-w,d,1-w,Z,1-o,Z]),T===t.e.FLIP_N_ROTATE_ROW&&(e=[o,1-d,w,1-d,w,1-Z,o,1-Z]),S=S.concat(e),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),J&&a&&(W.push(G+I,K+u,0),W.push(E+I,K+u,0),W.push(E+I,K+v+u,0),W.push(G+I,K+v+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,o=0,d=1-v/q,w=A/b,Z=1,e=[o,d,w,d,w,Z,o,Z],(T===t.e.ROTATE_ROW||T===t.e.ROTATE_TILE&&F%2===0)&&(e=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),(T===t.e.FLIP_ROW||T===t.e.FLIP_TILE&&F%2===0)&&(e=[1-o,d,1-w,d,1-w,Z,1-o,Z]),(T===t.e.FLIP_N_ROTATE_ROW||T===t.e.FLIP_N_ROTATE_TILE&&F%2===0)&&(e=[o,1-d,w,1-d,w,1-Z,o,1-Z]),S=S.concat(e),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&C&&(W.push(U+I,x+u,0),W.push(-G+I,x+u,0),W.push(-G+I,l+u,0),W.push(U+I,l+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,o=1-A/b,d=0,w=1,Z=v/q,e=[o,d,w,d,w,Z,o,Z],(T===t.e.ROTATE_ROW&&P%2===1||T===t.e.ROTATE_TILE&&P%1===0)&&(e=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),(T===t.e.FLIP_ROW&&P%2===1||T===t.e.FLIP_TILE&&P%2===0)&&(e=[1-o,d,1-w,d,1-w,Z,1-o,Z]),(T===t.e.FLIP_N_ROTATE_ROW&&P%2===1||T===t.e.FLIP_N_ROTATE_TILE&&P%2===0)&&(e=[o,1-d,w,1-d,w,1-Z,o,1-Z]),S=S.concat(e),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&a&&(W.push(G+I,x+u,0),W.push(E+I,x+u,0),W.push(E+I,l+u,0),W.push(G+I,l+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,o=0,d=0,w=A/b,Z=v/q,e=[o,d,w,d,w,Z,o,Z],(T===t.e.ROTATE_ROW&&P%2===1||T===t.e.ROTATE_TILE&&(P+F)%2===1)&&(e=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),(T===t.e.FLIP_ROW&&P%2===1||T===t.e.FLIP_TILE&&(P+F)%2===1)&&(e=[1-o,d,1-w,d,1-w,Z,1-o,Z]),(T===t.e.FLIP_N_ROTATE_ROW&&P%2===1||T===t.e.FLIP_N_ROTATE_TILE&&(P+F)%2===1)&&(e=[o,1-d,w,1-d,w,1-Z,o,1-Z]),S=S.concat(e),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),J){const J=[];o=0,d=1-v/q,w=1,Z=1,J[0]=[o,d,w,d,w,Z,o,Z],J[1]=[o,d,w,d,w,Z,o,Z],T!==t.e.ROTATE_TILE&&T!==t.e.ROTATE_ROW||(J[1]=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),T!==t.e.FLIP_TILE&&T!==t.e.FLIP_ROW||(J[1]=[1-o,d,1-w,d,1-w,Z,1-o,Z]),T!==t.e.FLIP_N_ROTATE_TILE&&T!==t.e.FLIP_N_ROTATE_ROW||(J[1]=[o,1-d,w,1-d,w,1-Z,o,1-Z]);for(let q=0;q<F;q++)W.push(q*b-G+I,K+u,0),W.push((q+1)*b-G+I,K+u,0),W.push((q+1)*b-G+I,K+v+u,0),W.push(q*b-G+I,K+v+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=T===t.e.FLIP_TILE||T===t.e.ROTATE_TILE||T===t.e.FLIP_N_ROTATE_TILE?S.concat(J[(q+1)%2]):T===t.e.FLIP_ROW||T===t.e.ROTATE_ROW||T===t.e.FLIP_N_ROTATE_ROW?S.concat(J[1]):S.concat(J[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const J=[];o=0,d=0,w=1,Z=v/q,J[0]=[o,d,w,d,w,Z,o,Z],J[1]=[o,d,w,d,w,Z,o,Z],T!==t.e.ROTATE_TILE&&T!==t.e.ROTATE_ROW||(J[1]=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),T!==t.e.FLIP_TILE&&T!==t.e.FLIP_ROW||(J[1]=[1-o,d,1-w,d,1-w,Z,1-o,Z]),T!==t.e.FLIP_N_ROTATE_TILE&&T!==t.e.FLIP_N_ROTATE_ROW||(J[1]=[o,1-d,w,1-d,w,1-Z,o,1-Z]);for(let q=0;q<F;q++)W.push(q*b-G+I,l-v+u,0),W.push((q+1)*b-G+I,l-v+u,0),W.push((q+1)*b-G+I,l+u,0),W.push(q*b-G+I,l+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=T===t.e.FLIP_TILE||T===t.e.ROTATE_TILE||T===t.e.FLIP_N_ROTATE_TILE?S.concat(J[(q+P)%2]):T===t.e.FLIP_ROW||T===t.e.ROTATE_ROW||T===t.e.FLIP_N_ROTATE_ROW?S.concat(J[P%2]):S.concat(J[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const J=[];o=1-A/b,d=0,w=1,Z=1,J[0]=[o,d,w,d,w,Z,o,Z],J[1]=[o,d,w,d,w,Z,o,Z],T!==t.e.ROTATE_TILE&&T!==t.e.ROTATE_ROW||(J[1]=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),T!==t.e.FLIP_TILE&&T!==t.e.FLIP_ROW||(J[1]=[1-o,d,1-w,d,1-w,Z,1-o,Z]),T!==t.e.FLIP_N_ROTATE_TILE&&T!==t.e.FLIP_N_ROTATE_ROW||(J[1]=[o,1-d,w,1-d,w,1-Z,o,1-Z]);for(let b=0;b<P;b++)W.push(U+I,b*q-x+u,0),W.push(U+A+I,b*q-x+u,0),W.push(U+A+I,(b+1)*q-x+u,0),W.push(U+I,(b+1)*q-x+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=T===t.e.FLIP_TILE||T===t.e.ROTATE_TILE||T===t.e.FLIP_N_ROTATE_TILE?S.concat(J[(b+1)%2]):T===t.e.FLIP_ROW||T===t.e.ROTATE_ROW||T===t.e.FLIP_N_ROTATE_ROW?S.concat(J[b%2]):S.concat(J[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const J=[];o=0,d=0,w=A/q,Z=1,J[0]=[o,d,w,d,w,Z,o,Z],J[1]=[o,d,w,d,w,Z,o,Z],T!==t.e.ROTATE_TILE&&T!==t.e.ROTATE_ROW||(J[1]=[1-o,1-d,1-w,1-d,1-w,1-Z,1-o,1-Z]),T!==t.e.FLIP_TILE&&T!==t.e.FLIP_ROW||(J[1]=[1-o,d,1-w,d,1-w,Z,1-o,Z]),T!==t.e.FLIP_N_ROTATE_TILE&&T!==t.e.FLIP_N_ROTATE_ROW||(J[1]=[o,1-d,w,1-d,w,1-Z,o,1-Z]);for(let b=0;b<P;b++)W.push(E-A+I,b*q-x+u,0),W.push(E+I,b*q-x+u,0),W.push(E+I,(b+1)*q-x+u,0),W.push(E-A+I,(b+1)*q-x+u,0),s.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=T===t.e.FLIP_TILE||T===t.e.ROTATE_TILE||T===t.e.FLIP_N_ROTATE_TILE?S.concat(J[(b+F)%2]):T===t.e.FLIP_ROW||T===t.e.ROTATE_ROW||T===t.e.FLIP_N_ROTATE_ROW?S.concat(J[b%2]):S.concat(J[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const d=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE;B.c._ComputeSides(d,W,s,p,S,J.frontUVs,J.backUVs);const w=new B.c;w.indices=s,w.xa=W,w.ya=p,w.Aa=S;const Z=d===B.c.DOUBLESIDE?H.concat(H):H;return w.za=Z,w}function G(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return v(T).Ca(q,T.updatable),q}function x(J){const T=J.faceUV||new Array(6),b=J.faceColors,j=J.pattern||t.e.NO_FLIP,C=J.width||J.size||1,F=J.height||J.size||1,A=J.depth||J.size||1,a=J.tileWidth||J.tileSize||1,G=J.tileHeight||J.tileSize||1,x=J.alignHorizontal||0,I=J.alignVertical||0,u=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE;for(let t=0;t<6;t++)void 0===T[t]&&(T[t]=new q.p(0,0,1,1)),b&&void 0===b[t]&&(b[t]=new P.d(1,1,1,1));const U=C/2,K=F/2,E=A/2,l=[];for(let q=0;q<2;q++)l[q]=v({pattern:j,tileWidth:a,tileHeight:G,width:C,height:F,alignVertical:I,alignHorizontal:x,sideOrientation:u});for(let q=2;q<4;q++)l[q]=v({pattern:j,tileWidth:a,tileHeight:G,width:A,height:F,alignVertical:I,alignHorizontal:x,sideOrientation:u});let W=I;I===t.e.BOTTOM?W=t.e.TOP:I===t.e.TOP&&(W=t.e.BOTTOM);for(let q=4;q<6;q++)l[q]=v({pattern:j,tileWidth:a,tileHeight:G,width:C,height:A,alignVertical:W,alignHorizontal:x,sideOrientation:u});let p=[],o=[],S=[],H=[];const s=[],g=[],d=[],w=[];let Z=0,e=0;for(let t=0;t<6;t++){const J=l[t].xa.length;g[t]=[],d[t]=[];for(let T=0;T<J/3;T++)g[t].push(new q.n(l[t].xa[3*T],l[t].xa[3*T+1],l[t].xa[3*T+2])),d[t].push(new q.n(l[t].ya[3*T],l[t].ya[3*T+1],l[t].ya[3*T+2]));Z=l[t].Aa.length,w[t]=[];for(let b=0;b<Z;b+=2)w[t][b]=T[t].x+(T[t].z-T[t].x)*l[t].Aa[b],w[t][b+1]=T[t].y+(T[t].w-T[t].y)*l[t].Aa[b+1],Y.c&&(w[t][b+1]=1-w[t][b+1]);if(S=S.concat(w[t]),H=H.concat(l[t].indices.map((J=>J+e))),e+=g[t].length,b)for(let T=0;T<4;T++)s.push(b[t].r,b[t].g,b[t].b,b[t].a)}const c=new q.n(0,0,E),V=q.e.RotationY(Math.PI);p=g[0].map((J=>q.n.TransformNormal(J,V).add(c))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[]),o=d[0].map((J=>q.n.TransformNormal(J,V))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[]),p=p.concat(g[1].map((J=>J.Jg(c))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[])),o=o.concat(d[1].map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[]));const Q=new q.n(U,0,0),h=q.e.RotationY(-Math.PI/2);p=p.concat(g[2].map((J=>q.n.TransformNormal(J,h).add(Q))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[])),o=o.concat(d[2].map((J=>q.n.TransformNormal(J,h))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[]));const i=q.e.RotationY(Math.PI/2);p=p.concat(g[3].map((J=>q.n.TransformNormal(J,i).Jg(Q))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[])),o=o.concat(d[3].map((J=>q.n.TransformNormal(J,i))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[]));const m=new q.n(0,K,0),O=q.e.RotationX(Math.PI/2);p=p.concat(g[4].map((J=>q.n.TransformNormal(J,O).add(m))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[])),o=o.concat(d[4].map((J=>q.n.TransformNormal(J,O))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[]));const X=q.e.RotationX(-Math.PI/2);p=p.concat(g[5].map((J=>q.n.TransformNormal(J,X).Jg(m))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[])),o=o.concat(d[5].map((J=>q.n.TransformNormal(J,X))).map((J=>[J.x,J.y,J.z])).reduce(((J,T)=>J.concat(T)),[])),B.c._ComputeSides(u,p,H,o,S);const L=new B.c;if(L.indices=H,L.xa=p,L.ya=o,L.Aa=S,b){const J=u===B.c.DOUBLESIDE?s.concat(s):s;L.za=J}return L}function I(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return x(T).Ca(q,T.updatable),q}B.c.CreateTiledPlane=v;B.c.CreateTiledBox=x;var u=b(12172),U=b(2440),K=b(848);function E(J){const T=J.height||2;let b=0===J.diameterTop?0:J.diameterTop||J.diameter||1,j=0===J.diameterBottom?0:J.diameterBottom||J.diameter||1;b=b||1e-5,j=j||1e-5;const C=0|(J.tessellation||24),F=0|(J.subdivisions||1),A=!!J.hasRings,a=!!J.enclose,v=0===J.cap?0:J.cap||t.e.CAP_ALL,G=J.arc&&(J.arc<=0||J.arc>1)?1:J.arc||1,x=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,I=J.faceUV||new Array(3),u=J.faceColors,U=2+(1+(1!==G&&a?2:0))*(A?F:1);let E;for(E=0;E<U;E++)u&&void 0===u[E]&&(u[E]=new P.d(1,1,1,1));for(E=0;E<U;E++)I&&void 0===I[E]&&(I[E]=new q.p(0,0,1,1));const l=[],W=[],p=[],o=[],S=[],H=2*Math.PI*G/C;let s,g,d;const w=(j-b)/2/T,Z=q.n.Zero(),e=q.n.Zero(),c=q.n.Zero(),V=q.n.Zero(),Q=q.n.Zero(),h=K.d.Y;let i,m,O,X=1,L=1,r=0,N=0;for(i=0;i<=F;i++)for(g=i/F,d=(g*(b-j)+j)/2,X=A&&0!==i&&i!==F?2:1,O=0;O<X;O++){for(A&&(L+=O),a&&(L+=2*O),m=0;m<=C;m++)s=m*H,Z.x=Math.cos(-s)*d,Z.y=-T/2+g*T,Z.z=Math.sin(-s)*d,0===b&&i===F?(e.x=p[p.length-3*(C+1)],e.y=p[p.length-3*(C+1)+1],e.z=p[p.length-3*(C+1)+2]):(e.x=Z.x,e.z=Z.z,e.y=Math.sqrt(e.x*e.x+e.z*e.z)*w,e.normalize()),0===m&&(c.p(Z),V.p(e)),W.push(Z.x,Z.y,Z.z),p.push(e.x,e.y,e.z),N=A?r!==L?I[L].y:I[L].w:I[L].y+(I[L].w-I[L].y)*g,o.push(I[L].x+(I[L].z-I[L].x)*m/C,Y.c?1-N:N),u&&S.push(u[L].r,u[L].g,u[L].b,u[L].a);1!==G&&a&&(W.push(Z.x,Z.y,Z.z),W.push(0,Z.y,0),W.push(0,Z.y,0),W.push(c.x,c.y,c.z),q.n.CrossToRef(h,e,Q),Q.normalize(),p.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),q.n.CrossToRef(V,h,Q),Q.normalize(),p.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),N=A?r!==L?I[L+1].y:I[L+1].w:I[L+1].y+(I[L+1].w-I[L+1].y)*g,o.push(I[L+1].x,Y.c?1-N:N),o.push(I[L+1].z,Y.c?1-N:N),N=A?r!==L?I[L+2].y:I[L+2].w:I[L+2].y+(I[L+2].w-I[L+2].y)*g,o.push(I[L+2].x,Y.c?1-N:N),o.push(I[L+2].z,Y.c?1-N:N),u&&(S.push(u[L+1].r,u[L+1].g,u[L+1].b,u[L+1].a),S.push(u[L+1].r,u[L+1].g,u[L+1].b,u[L+1].a),S.push(u[L+2].r,u[L+2].g,u[L+2].b,u[L+2].a),S.push(u[L+2].r,u[L+2].g,u[L+2].b,u[L+2].a))),r!==L&&(r=L)}const R=1!==G&&a?C+4:C;for(i=0,L=0;L<F;L++){let J=0,T=0,b=0,q=0;for(m=0;m<C;m++)J=i*(R+1)+m,T=(i+1)*(R+1)+m,b=i*(R+1)+(m+1),q=(i+1)*(R+1)+(m+1),l.push(J,T,b),l.push(q,b,T);1!==G&&a&&(l.push(J+2,T+2,b+2),l.push(q+2,b+2,T+2),l.push(J+4,T+4,b+4),l.push(q+4,b+4,T+4)),i=A?i+2:i+1}const n=J=>{const t=J?b/2:j/2;if(0===t)return;let B,F,A;const a=J?I[U-1]:I[0];let P=null;u&&(P=J?u[U-1]:u[0]);const v=W.length/3,x=J?T/2:-T/2,K=new q.n(0,x,0);W.push(K.x,K.y,K.z),p.push(0,J?1:-1,0);const E=a.y+.5*(a.w-a.y);o.push(a.x+.5*(a.z-a.x),Y.c?1-E:E),P&&S.push(P.r,P.g,P.b,P.a);const H=new q.k(.5,.5);for(A=0;A<=C;A++){B=2*Math.PI*A*G/C;const T=Math.cos(-B),b=Math.sin(-B);F=new q.n(T*t,x,b*t);const j=new q.k(T*H.x+.5,b*H.y+.5);W.push(F.x,F.y,F.z),p.push(0,J?1:-1,0);const v=a.y+(a.w-a.y)*j.y;o.push(a.x+(a.z-a.x)*j.x,Y.c?1-v:v),P&&S.push(P.r,P.g,P.b,P.a)}for(A=0;A<C;A++)J?(l.push(v),l.push(v+(A+2)),l.push(v+(A+1))):(l.push(v),l.push(v+(A+1)),l.push(v+(A+2)))};v!==t.e.CAP_START&&v!==t.e.CAP_ALL||n(!1),v!==t.e.CAP_END&&v!==t.e.CAP_ALL||n(!0),B.c._ComputeSides(x,W,l,p,o,J.frontUVs,J.backUVs);const D=new B.c;return D.indices=l,D.xa=W,D.ya=p,D.Aa=o,u&&(D.za=S),D}function l(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return E(T).Ca(q,T.updatable),q}function W(J){const T=[],b=[],t=[],j=[],C=J.diameter||1,F=J.thickness||.5,A=0|(J.tessellation||16),a=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,P=A+1;for(let B=0;B<=A;B++){const J=B/A,a=B*Math.PI*2/A-Math.PI/2,v=q.e.Translation(C/2,0,0).multiply(q.e.RotationY(a));for(let C=0;C<=A;C++){const a=1-C/A,G=C*Math.PI*2/A+Math.PI,x=Math.cos(G),I=Math.sin(G);let u=new q.n(x,I,0),U=u.scale(F/2);const K=new q.k(J,a);U=q.n.TransformCoordinates(U,v),u=q.n.TransformNormal(u,v),b.push(U.x,U.y,U.z),t.push(u.x,u.y,u.z),j.push(K.x,Y.c?1-K.y:K.y);const E=(B+1)%P,l=(C+1)%P;T.push(B*P+C),T.push(B*P+l),T.push(E*P+C),T.push(B*P+l),T.push(E*P+l),T.push(E*P+C)}}B.c._ComputeSides(a,b,T,t,j,J.frontUVs,J.backUVs);const v=new B.c;return v.indices=T,v.xa=b,v.ya=t,v.Aa=j,v}function p(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return W(T).Ca(q,T.updatable),q}B.c.CreateCylinder=E,t.e.CreateCylinder=(J,T,b,q,j,B,Y,C,F)=>{void 0!==Y&&Y instanceof U.b||(void 0!==Y&&(F=C||t.e.DEFAULTSIDE,C=Y),Y=B,B=1);return l(J,{height:T,diameterTop:b,diameterBottom:q,tessellation:j,subdivisions:B,sideOrientation:F,updatable:C},Y)};function o(J){const T=[],b=[],t=[],j=[],C=J.radius||2,F=J.tube||.5,A=J.radialSegments||32,a=J.tubularSegments||32,P=J.p||2,v=J.q||3,G=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,x=J=>{const T=Math.cos(J),b=Math.sin(J),t=v/P*J,j=Math.cos(t),B=C*(2+j)*.5*T,Y=C*(2+j)*b*.5,F=C*Math.sin(t)*.5;return new q.n(B,Y,F)};let I,u;for(I=0;I<=A;I++){const J=I%A/A*2*P*Math.PI,T=x(J),t=x(J+.01),B=t.Jg(T);let C=t.add(T);const v=q.n.Cross(B,C);for(C=q.n.Cross(v,B),v.normalize(),C.normalize(),u=0;u<a;u++){const J=u%a/a*2*Math.PI,q=-F*Math.cos(J),t=F*Math.sin(J);b.push(T.x+q*C.x+t*v.x),b.push(T.y+q*C.y+t*v.y),b.push(T.z+q*C.z+t*v.z),j.push(I/A),j.push(Y.c?1-u/a:u/a)}}for(I=0;I<A;I++)for(u=0;u<a;u++){const J=(u+1)%a,b=I*a+u,q=(I+1)*a+u,t=(I+1)*a+J,j=I*a+J;T.push(j),T.push(q),T.push(b),T.push(j),T.push(t),T.push(q)}B.c.ComputeNormals(b,T,t),B.c._ComputeSides(G,b,T,t,j,J.frontUVs,J.backUVs);const U=new B.c;return U.indices=T,U.xa=b,U.ya=t,U.Aa=j,U}function S(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return o(T).Ca(q,T.updatable),q}B.c.CreateTorus=W,t.e.CreateTorus=(J,T,b,q,t,j,B)=>p(J,{diameter:T,thickness:b,tessellation:q,sideOrientation:B,updatable:j},t);B.c.CreateTorusKnot=o,t.e.CreateTorusKnot=(J,T,b,q,t,j,B,Y,C,F)=>S(J,{radius:T,tube:b,radialSegments:q,tubularSegments:t,p:j,q:B,sideOrientation:F,updatable:C},Y);var H=b(12761),s=b(519),g=b(2289),d=b(705),w=b(550);class Z extends q.k{constructor(J,T){super(J.x,J.y),this.index=T}}class e{constructor(){this.elements=[]}add(J){const T=[];for(const b of J){const J=new Z(b,this.elements.length);T.push(J),this.elements.push(J)}return T}computeBounds(){const J=new q.k(this.elements[0].x,this.elements[0].y),T=new q.k(this.elements[0].x,this.elements[0].y);for(const b of this.elements)b.x<J.x?J.x=b.x:b.x>T.x&&(T.x=b.x),b.y<J.y?J.y=b.y:b.y>T.y&&(T.y=b.y);return{min:J,max:T,width:T.x-J.x,height:T.y-J.y}}}class c{_addToepoint(J){for(const T of J)this._epoints.push(T.x,T.y)}constructor(J,T,b){let q,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new e,this._outlinepoints=new e,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=t,this._name=J,this._scene=b||w.e.LastCreatedScene,q=T instanceof g.f?T.getPoints():T,this._addToepoint(q),this._points.add(q),this._outlinepoints.add(q),"undefined"===typeof this.bjsEarcut&&s.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(J){this._points.add(J);const T=new e;return T.add(J),this._holes.push(T),this._eholes.push(this._epoints.length/2),this._addToepoint(J),this}build(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const q=new t.e(this._name,this._scene),B=this.buildVertexData(T,b);return q.Ga(j.e.PositionKind,B.xa,J),q.Ga(j.e.NormalKind,B.ya,J),q.Ga(j.e.UVKind,B.Aa,J),q.setIndices(B.indices),q}buildVertexData(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=new B.c,q=[],t=[],j=[],Y=this._points.computeBounds();for(const B of this._points.elements)q.push(0,1,0),t.push(B.x,0,B.y),j.push((B.x-Y.min.x)/Y.width,(B.y-Y.min.y)/Y.height);const C=[],F=this.bjsEarcut(this._epoints,this._eholes,2);for(let B=0;B<F.length;B++)C.push(F[B]);if(J>0){const b=t.length/3;for(const T of this._points.elements)q.push(0,-1,0),t.push(T.x,-J,T.y),j.push(1-(T.x-Y.min.x)/Y.width,1-(T.y-Y.min.y)/Y.height);const B=C.length;for(let J=0;J<B;J+=3){const T=C[J+0],q=C[J+1],t=C[J+2];C.push(t+b),C.push(q+b),C.push(T+b)}this._addSide(t,q,j,C,Y,this._outlinepoints,J,!1,T);for(const F of this._holes)this._addSide(t,q,j,C,Y,F,J,!0,T)}return b.indices=C,b.xa=t,b.ya=q,b.Aa=j,b}_addSide(J,T,b,t,j,B,Y,C,F){let A=J.length/3,a=0;for(let P=0;P<B.elements.length;P++){const v=B.elements[P],G=B.elements[(P+1)%B.elements.length];J.push(v.x,0,v.y),J.push(v.x,-Y,v.y),J.push(G.x,0,G.y),J.push(G.x,-Y,G.y);const x=B.elements[(P+B.elements.length-1)%B.elements.length],I=B.elements[(P+2)%B.elements.length];let u=new q.n(-(G.y-v.y),0,G.x-v.x),U=new q.n(-(v.y-x.y),0,v.x-x.x),K=new q.n(-(I.y-G.y),0,I.x-G.x);C||(u=u.scale(-1),U=U.scale(-1),K=K.scale(-1));const E=u.normalizeToNew();let l=U.normalizeToNew(),W=K.normalizeToNew();const p=q.n.Dot(l,E);l=p>F?p<d.e-1?new q.n(v.x,0,v.y).Jg(new q.n(G.x,0,G.y)).normalize():U.add(u).normalize():E;const o=q.n.Dot(K,u);W=o>F?o<d.e-1?new q.n(G.x,0,G.y).Jg(new q.n(v.x,0,v.y)).normalize():K.add(u).normalize():E,b.push(a/j.width,0),b.push(a/j.width,1),a+=u.length(),b.push(a/j.width,0),b.push(a/j.width,1),T.push(l.x,l.y,l.z),T.push(l.x,l.y,l.z),T.push(W.x,W.y,W.z),T.push(W.x,W.y,W.z),C?(t.push(A),t.push(A+2),t.push(A+1),t.push(A+1),t.push(A+2),t.push(A+3)):(t.push(A),t.push(A+1),t.push(A+2),t.push(A+1),t.push(A+3),t.push(A+2)),A+=4}}}function V(J,T,b,t,C,F,A){const a=b||new Array(3),v=t,G=[],x=A||!1;for(let j=0;j<3;j++)void 0===a[j]&&(a[j]=new q.p(0,0,1,1)),v&&void 0===v[j]&&(v[j]=new P.d(1,1,1,1));const I=J.getVerticesData(j.e.PositionKind),u=J.getVerticesData(j.e.NormalKind),U=J.getVerticesData(j.e.UVKind),K=J.ui(),E=I.length/9;let l=0,W=0,p=0,o=0,S=0;const H=[0];if(x)for(let q=E;q<I.length/3;q+=4)W=I[3*(q+2)]-I[3*q],p=I[3*(q+2)+2]-I[3*q+2],o=Math.sqrt(W*W+p*p),S+=o,H.push(S);let s=0,g=0;for(let q=0;q<u.length;q+=3)Math.abs(u[q+1])<.001&&(g=1),Math.abs(u[q+1]-1)<.001&&(g=0),Math.abs(u[q+1]+1)<.001&&(g=2),s=q/3,1===g?(l=s-E,U[2*s]=l%4<1.5?x?a[g].x+(a[g].z-a[g].x)*H[Math.floor(l/4)]/S:a[g].x:x?a[g].x+(a[g].z-a[g].x)*H[Math.floor(l/4)+1]/S:a[g].z,U[2*s+1]=l%2===0?Y.c?1-a[g].w:a[g].w:Y.c?1-a[g].y:a[g].y):(U[2*s]=(1-U[2*s])*a[g].x+U[2*s]*a[g].z,U[2*s+1]=(1-U[2*s+1])*a[g].y+U[2*s+1]*a[g].w,Y.c&&(U[2*s+1]=1-U[2*s+1])),v&&G.push(v[g].r,v[g].g,v[g].b,v[g].a);B.c._ComputeSides(T,I,K,u,U,C,F);const d=new B.c;if(d.indices=K,d.xa=I,d.ya=u,d.Aa=U,v){const J=T===B.c.DOUBLESIDE?G.concat(G):G;d.za=J}return d}function Q(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation);const B=T.shape,Y=T.holes||[],C=T.depth||0,F=T.smoothingThreshold||2,A=[];let a=[];for(let t=0;t<B.length;t++)A[t]=new q.k(B[t].x,B[t].z);A[0].equalsWithEpsilon(A[A.length-1],1e-8)&&A.pop();const P=new c(J,A,b||w.e.LastCreatedScene,j);for(let t=0;t<Y.length;t++){a=[];for(let J=0;J<Y[t].length;J++)a.push(new q.k(Y[t][J].x,Y[t][J].z));P.addHole(a)}const v=P.build(!1,C,F);v._originalBuilderSideOrientation=T.sideOrientation;return V(v,T.sideOrientation,T.faceUV,T.faceColors,T.frontUVs,T.backUVs,T.wrap).Ca(v,T.updatable),v}function h(J,T){return Q(J,T,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function i(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=T.path,j=T.shape,B=T.scale||1,Y=T.rotation||0,C=0===T.cap?0:T.cap||t.e.NO_CAP,F=T.updatable,A=t.e._GetDefaultSideOrientation(T.sideOrientation),a=T.instance||null,P=T.invertUV||!1,v=T.closeShape||!1,G=T.closePath||!1,x=T.capFunction||null;return O(J,j,q,B,Y,null,null,G,v,C,!1,b,!!F,A,a,P,T.frontUVs||null,T.backUVs||null,T.firstNormal||null,!!T.adjustFrame,x)}function m(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=T.path,j=T.shape,B=T.scaleFunction||(()=>1),Y=T.rotationFunction||(()=>0),C=T.closePath||T.ribbonCloseArray||!1,F=T.closeShape||T.ribbonClosePath||!1,A=0===T.cap?0:T.cap||t.e.NO_CAP,a=T.updatable,P=T.firstNormal||null,v=T.adjustFrame||!1,G=t.e._GetDefaultSideOrientation(T.sideOrientation),x=T.instance,I=T.invertUV||!1,u=T.capFunction||null;return O(J,j,q,null,null,B,Y,C,F,A,!0,b,!!a,G,x||null,I,T.frontUVs||null,T.backUVs||null,P,v,u||null)}function O(J,T,b,j,B,Y,C,A,a,P,v,G,x,I,u,U,K,E,l,W,p){const o=(J,T,b,j,B,Y,C,F,A,a,P)=>{const v=b.getTangents(),G=b.getNormals(),x=b.getBinormals(),I=b.getDistances();if(P)for(let t=0;t<v.length;t++)if(0==v[t].x&&0==v[t].y&&0==v[t].z&&v[t].p(v[t-1]),0==G[t].x&&0==G[t].y&&0==G[t].z&&G[t].p(G[t-1]),0==x[t].x&&0==x[t].y&&0==x[t].z&&x[t].p(x[t-1]),t>0){let J=v[t-1];q.n.Dot(J,v[t])<0&&v[t].scaleInPlace(-1),J=G[t-1],q.n.Dot(J,G[t])<0&&G[t].scaleInPlace(-1),J=x[t-1],q.n.Dot(J,x[t])<0&&x[t].scaleInPlace(-1)}let u=0;const U=a&&F?F:()=>null!==Y?Y:0,K=a&&C?C:()=>null!==B?B:1;let E=A===t.e.NO_CAP||A===t.e.CAP_END?0:2;const l=q.j.Matrix[0];for(let t=0;t<T.length;t++){const b=[],B=U(t,I[t]),Y=K(t,I[t]);q.e.RotationAxisToRef(v[t],u,l);for(let j=0;j<J.length;j++){const B=v[t].scale(J[j].z).add(G[t].scale(J[j].x)).add(x[t].scale(J[j].y)),C=q.n.Zero();q.n.TransformCoordinatesToRef(B,l,C),C.scaleInPlace(Y).addInPlace(T[t]),b[j]=C}j[E]=b,u+=B,E++}const W=p||(J=>{const T=Array(),b=q.n.Zero();let t;for(t=0;t<J.length;t++)b.addInPlace(J[t]);for(b.scaleInPlace(1/J.length),t=0;t<J.length;t++)T.push(b);return T});switch(A){case t.e.NO_CAP:break;case t.e.CAP_START:j[0]=W(j[2]),j[1]=j[2];break;case t.e.CAP_END:j[E]=j[E-1],j[E+1]=W(j[E-1]);break;case t.e.CAP_ALL:j[0]=W(j[2]),j[1]=j[2],j[E]=j[E-1],j[E+1]=W(j[E-1])}return j};let S,H;if(u){const J=u._creationDataStorage;return S=l?J.path3D.update(b,l):J.path3D.update(b),H=o(T,b,J.path3D,J.pathArray,j,B,Y,C,J.cap,v,W),u=F("",{pathArray:H,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:u},G||void 0)}S=l?new g.j(b,l):new g.j(b);H=o(T,b,S,new Array,j,B,Y,C,P=P<0||P>3?0:P,v,W);const s=F(J,{pathArray:H,closeArray:A,closePath:a,updatable:x,sideOrientation:I,invertUV:U,frontUVs:K||void 0,backUVs:E||void 0},G);return s._creationDataStorage.pathArray=H,s._creationDataStorage.path3D=S,s._creationDataStorage.cap=P,s}B.c.CreatePolygon=V,t.e.CreatePolygon=function(J,T,b,q,t,j){return Q(J,{shape:T,holes:q,updatable:t,sideOrientation:j},b,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},t.e.ExtrudePolygon=function(J,T,b,q,t,j,B){return h(J,{shape:T,holes:t,depth:b,updatable:j,sideOrientation:B},q,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function X(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=T.arc?T.arc<=0||T.arc>1?1:T.arc:1,B=void 0===T.closed||T.closed,Y=T.shape,C=T.radius||1,A=T.tessellation||64,a=T.clip||0,P=T.updatable,v=t.e._GetDefaultSideOrientation(T.sideOrientation),G=T.cap||t.e.NO_CAP,x=2*Math.PI,I=[],u=T.invertUV||!1;let U=0,K=0;const E=x/A*j;let l,W;for(U=0;U<=A-a;U++){for(W=[],G!=t.e.CAP_START&&G!=t.e.CAP_ALL||(W.push(new q.n(0,Y[0].y,0)),W.push(new q.n(Math.cos(U*E)*Y[0].x*C,Y[0].y,Math.sin(U*E)*Y[0].x*C))),K=0;K<Y.length;K++)l=new q.n(Math.cos(U*E)*Y[K].x*C,Y[K].y,Math.sin(U*E)*Y[K].x*C),W.push(l);G!=t.e.CAP_END&&G!=t.e.CAP_ALL||(W.push(new q.n(Math.cos(U*E)*Y[Y.length-1].x*C,Y[Y.length-1].y,Math.sin(U*E)*Y[Y.length-1].x*C)),W.push(new q.n(0,Y[Y.length-1].y,0))),I.push(W)}return F(J,{pathArray:I,closeArray:B,sideOrientation:v,updatable:P,invertUV:u,frontUVs:T.frontUVs,backUVs:T.backUVs},b)}t.e.ExtrudeShape=function(J,T,b,q,j,B){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,F=arguments.length>8?arguments[8]:void 0,A=arguments.length>9?arguments[9]:void 0;return i(J,{shape:T,path:b,scale:q,rotation:j,cap:0===B?0:B||t.e.NO_CAP,sideOrientation:F,instance:A,updatable:C},Y)},t.e.ExtrudeShapeCustom=(J,T,b,q,j,B,Y,C,F,A,a,P)=>m(J,{shape:T,path:b,scaleFunction:q,rotationFunction:j,ribbonCloseArray:B,ribbonClosePath:Y,cap:0===C?0:C||t.e.NO_CAP,sideOrientation:a,instance:P,updatable:A},F);t.e.CreateLathe=(J,T,b,q,t,j,B)=>X(J,{shape:T,radius:b,tessellation:q,sideOrientation:B,updatable:j},t);var L=b(12076),r=b(12029);function N(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=T.path;let B=T.instance,Y=1;void 0!==T.radius?Y=T.radius:B&&(Y=B._creationDataStorage.radius);const C=T.tessellation||64,A=T.radiusFunction||null;let a=T.cap||t.e.NO_CAP;const P=T.invertUV||!1,v=T.updatable,G=t.e._GetDefaultSideOrientation(T.sideOrientation);T.arc=T.arc&&(T.arc<=0||T.arc>1)?1:T.arc||1;const x=(J,T,b,j,B,Y,C,F)=>{const A=T.getTangents(),a=T.getNormals(),P=T.getDistances(),v=2*Math.PI/B*F,G=Y||(()=>j);let x,I,u,U;const K=q.j.Matrix[0];let E=C===t.e.NO_CAP||C===t.e.CAP_END?0:2;for(let t=0;t<J.length;t++){I=G(t,P[t]),x=Array(),u=a[t];for(let T=0;T<B;T++)q.e.RotationAxisToRef(A[t],v*T,K),U=x[T]?x[T]:q.n.Zero(),q.n.TransformCoordinatesToRef(u,K,U),U.scaleInPlace(I).addInPlace(J[t]),x[T]=U;b[E]=x,E++}const l=(T,b)=>{const q=Array();for(let t=0;t<T;t++)q.push(J[b]);return q};switch(C){case t.e.NO_CAP:break;case t.e.CAP_START:b[0]=l(B,0),b[1]=b[2].slice(0);break;case t.e.CAP_END:b[E]=b[E-1].slice(0),b[E+1]=l(B,J.length-1);break;case t.e.CAP_ALL:b[0]=l(B,0),b[1]=b[2].slice(0),b[E]=b[E-1].slice(0),b[E+1]=l(B,J.length-1)}return b};let I,u;if(B){const J=B._creationDataStorage,b=T.arc||J.arc;return I=J.path3D.update(j),u=x(j,I,J.pathArray,Y,J.tessellation,A,J.cap,b),B=F("",{pathArray:u,instance:B}),J.path3D=I,J.pathArray=u,J.arc=b,J.radius=Y,B}I=new g.j(j);a=a<0||a>3?0:a,u=x(j,I,new Array,Y,C,A,a,T.arc);const U=F(J,{pathArray:u,closePath:!0,closeArray:!1,updatable:v,sideOrientation:G,invertUV:P,frontUVs:T.frontUVs,backUVs:T.backUVs},b);return U._creationDataStorage.pathArray=u,U._creationDataStorage.path3D=I,U._creationDataStorage.tessellation=C,U._creationDataStorage.cap=a,U._creationDataStorage.arc=T.arc,U._creationDataStorage.radius=Y,U}function R(J){const T=[];T[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},T[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},T[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},T[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},T[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},T[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},T[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},T[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},T[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},T[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},T[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},T[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},T[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},T[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},T[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=J.type&&(J.type<0||J.type>=T.length)?0:J.type||0,t=J.size,j=J.sizeX||t||1,C=J.sizeY||t||1,F=J.sizeZ||t||1,A=J.custom||T[b],a=A.face.length,v=J.faceUV||new Array(a),G=J.faceColors,x=void 0===J.flat||J.flat,I=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,u=[],U=[],K=[],E=[],l=[];let W=0,p=0;const o=[];let S,H,s,g,d,w,Z=0,e=0;if(x)for(e=0;e<a;e++)G&&void 0===G[e]&&(G[e]=new P.d(1,1,1,1)),v&&void 0===v[e]&&(v[e]=new q.p(0,0,1,1));if(x)for(e=0;e<a;e++){const J=A.face[e].length;for(s=2*Math.PI/J,g=.5*Math.tan(s/2),d=.5,Z=0;Z<J;Z++)u.push(A.vertex[A.face[e][Z]][0]*j,A.vertex[A.face[e][Z]][1]*C,A.vertex[A.face[e][Z]][2]*F),o.push(W),W++,S=v[e].x+(v[e].z-v[e].x)*(.5+g),H=v[e].y+(v[e].w-v[e].y)*(d-.5),E.push(S,Y.c?1-H:H),w=g*Math.cos(s)-d*Math.sin(s),d=g*Math.sin(s)+d*Math.cos(s),g=w,G&&l.push(G[e].r,G[e].g,G[e].b,G[e].a);for(Z=0;Z<J-2;Z++)U.push(o[0+p],o[Z+2+p],o[Z+1+p]);p+=J}else{for(Z=0;Z<A.vertex.length;Z++)u.push(A.vertex[Z][0]*j,A.vertex[Z][1]*C,A.vertex[Z][2]*F),E.push(0,Y.c?1:0);for(e=0;e<a;e++)for(Z=0;Z<A.face[e].length-2;Z++)U.push(A.face[e][0],A.face[e][Z+2],A.face[e][Z+1])}B.c.ComputeNormals(u,U,K),B.c._ComputeSides(I,u,U,K,E,J.frontUVs,J.backUVs);const c=new B.c;return c.xa=u,c.indices=U,c.ya=K,c.Aa=E,G&&x&&(c.za=l),c}function n(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return R(T).Ca(q,T.updatable),q}t.e.CreateTube=(J,T,b,q,t,j,B,Y,C,F)=>N(J,{path:T,radius:b,tessellation:q,radiusFunction:t,arc:1,cap:j,updatable:Y,sideOrientation:C,instance:F},B);function D(J){const T=J.sideOrientation||B.c.DEFAULTSIDE,b=J.radius||1,t=void 0===J.flat||J.flat,j=0|(J.subdivisions||4),C=J.radiusX||b,F=J.radiusY||b,A=J.radiusZ||b,a=(1+Math.sqrt(5))/2,P=[-1,a,-0,1,a,0,-1,-a,0,1,-a,0,0,-1,-a,0,1,-a,0,-1,a,0,1,a,a,0,1,a,0,-1,-a,0,1,-a,0,-1],v=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],G=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],x=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],u=[],U=[],K=[],E=[];let l=0;const W=new Array(3),p=new Array(3);let o;for(o=0;o<3;o++)W[o]=q.n.Zero(),p[o]=q.k.Zero();for(let B=0;B<20;B++){for(o=0;o<3;o++){const J=v[3*B+o];W[o].hi(P[3*G[J]],P[3*G[J]+1],P[3*G[J]+2]),W[o].normalize(),p[o].hi(.134765625*x[2*J]+.05859375+-.0390625*I[B],.2333984375*x[2*J+1]+.025390625+.01953125*I[B])}const J=(J,T,b,B)=>{const a=q.n.Lerp(W[0],W[2],T/j),P=q.n.Lerp(W[1],W[2],T/j),v=j===T?W[2]:q.n.Lerp(a,P,J/(j-T));let G;if(v.normalize(),t){const J=q.n.Lerp(W[0],W[2],B/j),T=q.n.Lerp(W[1],W[2],B/j);G=q.n.Lerp(J,T,b/(j-B))}else G=new q.n(v.x,v.y,v.z);G.x/=C,G.y/=F,G.z/=A,G.normalize();const x=q.k.Lerp(p[0],p[2],T/j),I=q.k.Lerp(p[1],p[2],T/j),o=j===T?p[2]:q.k.Lerp(x,I,J/(j-T));U.push(v.x*C,v.y*F,v.z*A),K.push(G.x,G.y,G.z),E.push(o.x,Y.c?1-o.y:o.y),u.push(l),l++};for(let T=0;T<j;T++)for(let b=0;b+T<j;b++)J(b,T,b+1/3,T+1/3),J(b+1,T,b+1/3,T+1/3),J(b,T+1,b+1/3,T+1/3),b+T+1<j&&(J(b+1,T,b+2/3,T+2/3),J(b+1,T+1,b+2/3,T+2/3),J(b,T+1,b+2/3,T+2/3))}B.c._ComputeSides(T,U,u,K,E,J.frontUVs,J.backUVs);const S=new B.c;return S.indices=u,S.xa=U,S.ya=K,S.Aa=E,S}function f(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.e(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),q._originalBuilderSideOrientation=T.sideOrientation;return D(T).Ca(q,T.updatable),q}B.c.CreatePolyhedron=R,t.e.CreatePolyhedron=(J,T,b)=>n(J,T,b);B.c.CreateIcoSphere=D,t.e.CreateIcoSphere=(J,T,b)=>f(J,T,b);var z=b(717);const M=new q.n(1,0,0),y=new q.n(-1,0,0),k=new q.n(0,1,0),JJ=new q.n(0,-1,0),TJ=new q.n(0,0,1),bJ=new q.n(0,0,-1);class qJ{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.n.Zero(),T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.n.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.k.Zero(),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=J,this.Ti=T,this.uv=b,this.vertexIdx=t,this.vertexIdxForBones=j,this.localPositionOverride=B,this.localNormalOverride=Y,this.matrixIndicesOverride=C,this.matrixWeightsOverride=F}clone(){var J,T,b,q;return new qJ(this.position.clone(),this.Ti.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(J=this.localPositionOverride)||void 0===J?void 0:J.slice(),null===(T=this.localNormalOverride)||void 0===T?void 0:T.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(q=this.matrixWeightsOverride)||void 0===q?void 0:q.slice())}}function tJ(J,T,b){var C,F,A,a,P;const v=!!T.skeleton,G=!(null===(C=T.morphTargetManager)||void 0===C||!C.numTargets),x=b.localMode||v,I=T.ui(),u=v||G?T.Kf(!0,!0):T.getVerticesData(j.e.PositionKind),U=v||G?T.getNormalsData(!0,!0):T.getVerticesData(j.e.NormalKind),K=x?v?T.getVerticesData(j.e.PositionKind):u:null,E=x?v?T.getVerticesData(j.e.NormalKind):U:null,l=T.getVerticesData(j.e.UVKind),W=v?T.getVerticesData(j.e.MatricesIndicesKind):null,p=v?T.getVerticesData(j.e.MatricesWeightsKind):null,o=v?T.getVerticesData(j.e.MatricesIndicesExtraKind):null,S=v?T.getVerticesData(j.e.MatricesWeightsExtraKind):null,H=b.position||q.n.Zero();let s=b.Ti||q.n.Up();const g=b.size||q.n.One(),d=b.angle||0;if(!s){const J=new q.n(0,0,1),b=T.va().activeCamera,t=q.n.TransformCoordinates(J,b.getWorldMatrix());s=b.globalPosition.Jg(t)}const w=-Math.atan2(s.z,s.x)-Math.PI/2,Z=Math.sqrt(s.x*s.x+s.z*s.z),e=Math.atan2(s.y,Z),c=new B.c;c.indices=[],c.xa=[],c.ya=[],c.Aa=[],c.matricesIndices=v?[]:null,c.matricesWeights=v?[]:null,c.matricesIndicesExtra=o?[]:null,c.matricesWeightsExtra=S?[]:null;let V=0;const Q=(J,T)=>{const t=new qJ;if(!I||!u||!U)return t;const j=I[J];if(t.vertexIdx=3*j,t.vertexIdxForBones=4*j,t.position=new q.n(u[3*j],u[3*j+1],u[3*j+2]),q.n.TransformCoordinatesToRef(t.position,T,t.position),t.Ti=new q.n(U[3*j],U[3*j+1],U[3*j+2]),q.n.TransformNormalToRef(t.Ti,T,t.Ti),b.captureUVS&&l){const J=l[2*j+1];t.uv=new q.k(l[2*j],Y.c?1-J:J)}return t},h=[0,0,0,0],i=(J,T)=>{if(0===J.length)return J;const b=.5*Math.abs(q.n.Dot(g,T)),t=(J,T,b,q)=>{for(let t=0;t<q;++t)if(J[b+t]===T)return b+t;return-1},j=(J,j)=>{const B=q.n.GetClipFactor(J.position,j.position,T,b);let Y=h,C=h;if(W&&p){const T=J.matrixIndicesOverride?0:J.vertexIdxForBones,b=J.matrixIndicesOverride??W,q=J.matrixWeightsOverride??p,F=j.matrixIndicesOverride?0:j.vertexIdxForBones,A=j.matrixIndicesOverride??W,a=j.matrixWeightsOverride??p;Y=[0,0,0,0],C=[0,0,0,0];let P=0;for(let J=0;J<4;++J)if(q[T+J]>0){const j=t(A,b[T+J],F,4);Y[P]=b[T+J],C[P]=(0,z.m)(q[T+J],j>=0?a[j]:0,B),P++}for(let J=0;J<4&&P<4;++J){const q=A[F+J];-1===t(b,q,T,4)&&(Y[P]=q,C[P]=(0,z.m)(0,a[F+J],B),P++)}const v=C[0]+C[1]+C[2]+C[3];C[0]/=v,C[1]/=v,C[2]/=v,C[3]/=v}const F=J.localPositionOverride?J.localPositionOverride[0]:(null===K||void 0===K?void 0:K[J.vertexIdx])??0,A=J.localPositionOverride?J.localPositionOverride[1]:(null===K||void 0===K?void 0:K[J.vertexIdx+1])??0,a=J.localPositionOverride?J.localPositionOverride[2]:(null===K||void 0===K?void 0:K[J.vertexIdx+2])??0,P=j.localPositionOverride?j.localPositionOverride[0]:(null===K||void 0===K?void 0:K[j.vertexIdx])??0,v=j.localPositionOverride?j.localPositionOverride[1]:(null===K||void 0===K?void 0:K[j.vertexIdx+1])??0,G=j.localPositionOverride?j.localPositionOverride[2]:(null===K||void 0===K?void 0:K[j.vertexIdx+2])??0,x=J.localNormalOverride?J.localNormalOverride[0]:(null===E||void 0===E?void 0:E[J.vertexIdx])??0,I=J.localNormalOverride?J.localNormalOverride[1]:(null===E||void 0===E?void 0:E[J.vertexIdx+1])??0,u=J.localNormalOverride?J.localNormalOverride[2]:(null===E||void 0===E?void 0:E[J.vertexIdx+2])??0,U=x+((j.localNormalOverride?j.localNormalOverride[0]:(null===E||void 0===E?void 0:E[j.vertexIdx])??0)-x)*B,l=I+((j.localNormalOverride?j.localNormalOverride[1]:(null===E||void 0===E?void 0:E[j.vertexIdx+1])??0)-I)*B,o=u+((j.localNormalOverride?j.localNormalOverride[2]:(null===E||void 0===E?void 0:E[j.vertexIdx+2])??0)-u)*B,S=Math.sqrt(U*U+l*l+o*o);return new qJ(q.n.Lerp(J.position,j.position,B),q.n.Lerp(J.Ti,j.Ti,B).normalize(),q.k.Lerp(J.uv,j.uv,B),-1,-1,K?[F+(P-F)*B,A+(v-A)*B,a+(G-a)*B]:null,E?[U/S,l/S,o/S]:null,Y,C)};let B=null;J.length>3&&(B=[]);for(let Y=0;Y<J.length;Y+=3){let t=0,C=null,F=null,A=null,a=null;const P=q.n.Dot(J[Y].position,T)-b>0,v=q.n.Dot(J[Y+1].position,T)-b>0,G=q.n.Dot(J[Y+2].position,T)-b>0;switch(t=(P?1:0)+(v?1:0)+(G?1:0),t){case 0:J.length>3?(B.push(J[Y]),B.push(J[Y+1]),B.push(J[Y+2])):B=J;break;case 1:if(B=B??new Array,P&&(C=J[Y+1],F=J[Y+2],A=j(J[Y],C),a=j(J[Y],F)),v){C=J[Y],F=J[Y+2],A=j(J[Y+1],C),a=j(J[Y+1],F),B.push(A),B.push(F.clone()),B.push(C.clone()),B.push(F.clone()),B.push(A.clone()),B.push(a);break}G&&(C=J[Y],F=J[Y+1],A=j(J[Y+2],C),a=j(J[Y+2],F)),C&&F&&A&&a&&(B.push(C.clone()),B.push(F.clone()),B.push(A),B.push(a),B.push(A.clone()),B.push(F.clone()));break;case 2:B=B??new Array,P||(C=J[Y].clone(),F=j(C,J[Y+1]),A=j(C,J[Y+2]),B.push(C),B.push(F),B.push(A)),v||(C=J[Y+1].clone(),F=j(C,J[Y+2]),A=j(C,J[Y]),B.push(C),B.push(F),B.push(A)),G||(C=J[Y+2].clone(),F=j(C,J[Y]),A=j(C,J[Y+1]),B.push(C),B.push(F),B.push(A))}}return B},m=T instanceof t.e?T:null,O=null===m||void 0===m?void 0:m._thinInstanceDataStorage.matrixData,X=(null===m||void 0===m?void 0:m.ki)||1,L=q.j.Matrix[0];L.p(q.e.IdentityReadOnly);for(let t=0;t<X;++t){if(null!==m&&void 0!==m&&m.hasThinInstances&&O){const J=16*t;L.setRowFromFloats(0,O[J+0],O[J+1],O[J+2],O[J+3]),L.setRowFromFloats(1,O[J+4],O[J+5],O[J+6],O[J+7]),L.setRowFromFloats(2,O[J+8],O[J+9],O[J+10],O[J+11]),L.setRowFromFloats(3,O[J+12],O[J+13],O[J+14],O[J+15])}const J=q.e.RotationYawPitchRoll(w,e,d).multiply(q.e.Translation(H.x,H.y,H.z)),j=q.e.Invert(J),B=T.getWorldMatrix(),C=L.multiply(B).multiply(j),F=new Array(3);for(let T=0;T<I.length;T+=3){let J=F;if(J[0]=Q(T,C),J[1]=Q(T+1,C),J[2]=Q(T+2,C),!(b.cullBackFaces&&-J[0].Ti.z<=0&&-J[1].Ti.z<=0&&-J[2].Ti.z<=0)&&(J=i(J,M),J&&(J=i(J,y),J&&(J=i(J,k),J&&(J=i(J,JJ),J&&(J=i(J,TJ),J&&(J=i(J,bJ),J)))))))for(let T=0;T<J.length;T++){const q=J[T];if(c.indices.push(V),x?(q.localPositionOverride?(c.xa[3*V]=q.localPositionOverride[0],c.xa[3*V+1]=q.localPositionOverride[1],c.xa[3*V+2]=q.localPositionOverride[2]):K&&(c.xa[3*V]=K[q.vertexIdx],c.xa[3*V+1]=K[q.vertexIdx+1],c.xa[3*V+2]=K[q.vertexIdx+2]),q.localNormalOverride?(c.ya[3*V]=q.localNormalOverride[0],c.ya[3*V+1]=q.localNormalOverride[1],c.ya[3*V+2]=q.localNormalOverride[2]):E&&(c.ya[3*V]=E[q.vertexIdx],c.ya[3*V+1]=E[q.vertexIdx+1],c.ya[3*V+2]=E[q.vertexIdx+2])):(q.position.toArray(c.xa,3*V),q.Ti.toArray(c.ya,3*V)),c.matricesIndices&&c.matricesWeights&&(q.matrixIndicesOverride?(c.matricesIndices[4*V]=q.matrixIndicesOverride[0],c.matricesIndices[4*V+1]=q.matrixIndicesOverride[1],c.matricesIndices[4*V+2]=q.matrixIndicesOverride[2],c.matricesIndices[4*V+3]=q.matrixIndicesOverride[3]):(W&&(c.matricesIndices[4*V]=W[q.vertexIdxForBones],c.matricesIndices[4*V+1]=W[q.vertexIdxForBones+1],c.matricesIndices[4*V+2]=W[q.vertexIdxForBones+2],c.matricesIndices[4*V+3]=W[q.vertexIdxForBones+3]),o&&c.matricesIndicesExtra&&(c.matricesIndicesExtra[4*V]=o[q.vertexIdxForBones],c.matricesIndicesExtra[4*V+1]=o[q.vertexIdxForBones+1],c.matricesIndicesExtra[4*V+2]=o[q.vertexIdxForBones+2],c.matricesIndicesExtra[4*V+3]=o[q.vertexIdxForBones+3])),q.matrixWeightsOverride?(c.matricesWeights[4*V]=q.matrixWeightsOverride[0],c.matricesWeights[4*V+1]=q.matrixWeightsOverride[1],c.matricesWeights[4*V+2]=q.matrixWeightsOverride[2],c.matricesWeights[4*V+3]=q.matrixWeightsOverride[3]):(p&&(c.matricesWeights[4*V]=p[q.vertexIdxForBones],c.matricesWeights[4*V+1]=p[q.vertexIdxForBones+1],c.matricesWeights[4*V+2]=p[q.vertexIdxForBones+2],c.matricesWeights[4*V+3]=p[q.vertexIdxForBones+3]),S&&c.matricesWeightsExtra&&(c.matricesWeightsExtra[4*V]=S[q.vertexIdxForBones],c.matricesWeightsExtra[4*V+1]=S[q.vertexIdxForBones+1],c.matricesWeightsExtra[4*V+2]=S[q.vertexIdxForBones+2],c.matricesWeightsExtra[4*V+3]=S[q.vertexIdxForBones+3]))),b.captureUVS)q.uv.toArray(c.Aa,2*V);else{c.Aa.push(.5+q.position.x/g.x);const J=.5+q.position.y/g.y;c.Aa.push(Y.c?1-J:J)}V++}}}0===c.indices.length&&(c.indices=null),0===c.xa.length&&(c.xa=null),0===c.ya.length&&(c.ya=null),0===c.Aa.length&&(c.Aa=null),0===(null===(F=c.matricesIndices)||void 0===F?void 0:F.length)&&(c.matricesIndices=null),0===(null===(A=c.matricesWeights)||void 0===A?void 0:A.length)&&(c.matricesWeights=null),0===(null===(a=c.matricesIndicesExtra)||void 0===a?void 0:a.length)&&(c.matricesIndicesExtra=null),0===(null===(P=c.matricesWeightsExtra)||void 0===P?void 0:P.length)&&(c.matricesWeightsExtra=null);const r=new t.e(J,T.va());return c.Ca(r),x?(r.skeleton=T.skeleton,r.parent=T):(r.position=H.clone(),r.rotation=new q.n(e,w,d)),r.ti(!0),r.refreshBoundingInfo(!0,!0),r}function jJ(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const T=0|Math.max(J.subdivisions?J.subdivisions:2,1),b=0|Math.max(J.tessellation?J.tessellation:16,3),t=Math.max(J.height?J.height:1,0),j=Math.max(J.radius?J.radius:.25,0),C=0|Math.max(J.capSubdivisions?J.capSubdivisions:6,1),F=b,A=T,a=Math.max(J.radiusTop?J.radiusTop:j,0),P=Math.max(J.radiusBottom?J.radiusBottom:j,0),v=t-(a+P),G=2*Math.PI,x=Math.max(J.topCapSubdivisions?J.topCapSubdivisions:C,1),I=Math.max(J.bottomCapSubdivisions?J.bottomCapSubdivisions:C,1),u=Math.acos((P-a)/t);let U=[];const K=[],E=[],l=[];let W=0;const p=[],o=.5*v,S=.5*Math.PI;let H,s;const g=q.n.Zero(),d=q.n.Zero(),w=Math.cos(u),Z=Math.sin(u),e=new q.k(a*Z,o+a*w).Jg(new q.k(P*Z,P*w-o)).length(),c=a*u+e+P*(S-u);let V=0;for(s=0;s<=x;s++){const J=[],T=S-u*(s/x);V+=a*u/x;const b=Math.cos(T),q=Math.sin(T),t=b*a;for(H=0;H<=F;H++){const T=H/F,j=T*G+0,B=Math.sin(j),C=Math.cos(j);d.x=t*B,d.y=o+q*a,d.z=t*C,K.push(d.x,d.y,d.z),g.set(b*B,q,b*C),E.push(g.x,g.y,g.z),l.push(T,Y.c?V/c:1-V/c),J.push(W),W++}p.push(J)}const Q=t-a-P+w*a-w*P,h=Z*(P-a)/Q;for(s=1;s<=A;s++){const J=[];V+=e/A;const T=Z*(s*(P-a)/A+a);for(H=0;H<=F;H++){const b=H/F,q=b*G+0,t=Math.sin(q),j=Math.cos(q);d.x=T*t,d.y=o+w*a-s*Q/A,d.z=T*j,K.push(d.x,d.y,d.z),g.set(t,h,j).normalize(),E.push(g.x,g.y,g.z),l.push(b,Y.c?V/c:1-V/c),J.push(W),W++}p.push(J)}for(s=1;s<=I;s++){const J=[],T=S-u-(Math.PI-u)*(s/I);V+=P*u/I;const b=Math.cos(T),q=Math.sin(T),t=b*P;for(H=0;H<=F;H++){const T=H/F,j=T*G+0,B=Math.sin(j),C=Math.cos(j);d.x=t*B,d.y=q*P-o,d.z=t*C,K.push(d.x,d.y,d.z),g.set(b*B,q,b*C),E.push(g.x,g.y,g.z),l.push(T,Y.c?V/c:1-V/c),J.push(W),W++}p.push(J)}for(H=0;H<F;H++)for(s=0;s<x+A+I;s++){const J=p[s][H],T=p[s+1][H],b=p[s+1][H+1],q=p[s][H+1];U.push(J),U.push(T),U.push(q),U.push(T),U.push(b),U.push(q)}if(U=U.reverse(),J.orientation&&!J.orientation.equals(q.n.Up())){const T=new q.e;J.orientation.clone().scale(.5*Math.PI).cross(q.n.Up()).toQuaternion().toRotationMatrix(T);const b=q.n.Zero();for(let J=0;J<K.length;J+=3)b.set(K[J],K[J+1],K[J+2]),q.n.TransformCoordinatesToRef(b.clone(),T,b),K[J]=b.x,K[J+1]=b.y,K[J+2]=b.z}const i=new B.c;return i.xa=K,i.ya=E,i.Aa=l,i.indices=U,i}function BJ(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:q.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new t.e(J,b);return jJ(T).Ca(j,T.updatable),j}t.e.CreateDecal=(J,T,b,q,t,j)=>tJ(J,T,{position:b,Ti:q,size:t,angle:j});t.e.CreateCapsule=(J,T,b)=>BJ(J,T,b),B.c.CreateCapsule=jJ;class YJ{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=J,this.y=T,J!==Math.floor(J)&&(J=Math.floor(J),s.d.Warn("x is not an integer, floor(x) used")),T!==Math.floor(T)&&(T=Math.floor(T),s.d.Warn("y is not an integer, floor(y) used"))}clone(){return new YJ(this.x,this.y)}rotate60About(J){const T=this.x;return this.x=J.x+J.y-this.y,this.y=T+this.y-J.x,this}rotateNeg60About(J){const T=this.x;return this.x=T+this.y-J.y,this.y=J.x+J.y-T,this}rotate120(J,T){J!==Math.floor(J)&&(J=Math.floor(J),s.d.Warn("m not an integer only floor(m) used")),T!==Math.floor(T)&&(T=Math.floor(T),s.d.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=J-b-this.y,this.y=T+b,this}rotateNeg120(J,T){J!==Math.floor(J)&&(J=Math.floor(J),s.d.Warn("m is not an integer, floor(m) used")),T!==Math.floor(T)&&(T=Math.floor(T),s.d.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-T,this.y=J+T-b-this.y,this}toCartesianOrigin(J,T){const b=q.n.Zero();return b.x=J.x+2*this.x*T+this.y*T,b.y=J.y+Math.sqrt(3)*this.y*T,b}static Zero(){return new YJ(0,0)}}class CJ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new FJ("icosahedron","Regular",[[0,d.f,-1],[-d.f,1,0],[-1,0,-d.f],[1,0,-d.f],[d.f,1,0],[0,d.f,1],[-1,0,d.f],[-d.f,-1,0],[0,-d.f,-1],[d.f,-1,0],[1,0,d.f],[0,-d.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let J=12;const T={},b=this.m,q=this.n;let t,j,B,Y,C,F=b,A=1,a=0;0!==q&&(F=(0,z.g)(b,q)),A=b/F,a=q/F;const P=YJ.Zero(),v=new YJ(b,q),G=new YJ(-q,b+q),x=YJ.Zero(),I=YJ.Zero(),u=YJ.Zero();let U,K,E,l,W=[];const p=[],o=this.vertByDist,S=(b,q,t,j)=>{U=b+"|"+t,K=q+"|"+j,U in T||K in T?U in T&&!(K in T)?T[K]=T[U]:K in T&&!(U in T)&&(T[U]=T[K]):(T[U]=J,T[K]=J,J++),o[t][0]>2?p[T[U]]=[-o[t][0],o[t][1],T[U]]:p[T[U]]=[W[o[t][0]],o[t][1],T[U]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let H=0;H<20;H++){if(W=this.IDATA.face[H],B=W[2],Y=W[1],C=W[0],E=P.x+"|"+P.y,U=H+"|"+E,U in T||(T[U]=B,p[B]=[W[o[E][0]],o[E][1]]),E=v.x+"|"+v.y,U=H+"|"+E,U in T||(T[U]=Y,p[Y]=[W[o[E][0]],o[E][1]]),E=G.x+"|"+G.y,U=H+"|"+E,U in T||(T[U]=C,p[C]=[W[o[E][0]],o[E][1]]),t=this.IDATA.edgematch[H][0],j=this.IDATA.edgematch[H][1],"B"===j)for(let J=1;J<F;J++)I.x=b-J*(A+a),I.y=q+J*A,u.x=-J*a,u.y=J*(A+a),E=I.x+"|"+I.y,l=u.x+"|"+u.y,S(H,t,E,l);if("O"===j)for(let J=1;J<F;J++)u.x=-J*a,u.y=J*(A+a),x.x=J*A,x.y=J*a,E=u.x+"|"+u.y,l=x.x+"|"+x.y,S(H,t,E,l);if(t=this.IDATA.edgematch[H][2],j=this.IDATA.edgematch[H][3],j&&"A"===j)for(let J=1;J<F;J++)x.x=J*A,x.y=J*a,I.x=b-(F-J)*(A+a),I.y=q+(F-J)*A,E=x.x+"|"+x.y,l=I.x+"|"+I.y,S(H,t,E,l);for(let b=0;b<this.vertices.length;b++)E=this.vertices[b].x+"|"+this.vertices[b].y,U=H+"|"+E,U in T||(T[U]=J++,o[E][0]>2?p[T[U]]=[-o[E][0],o[E][1],T[U]]:p[T[U]]=[W[o[E][0]],o[E][1],T[U]])}this.closestTo=p,this.vecToidx=T}calcCoeffs(){const J=this.m,T=this.n,b=Math.sqrt(3)/3,q=J*J+T*T+J*T;this.coau=(J+T)/q,this.cobu=-T/q,this.coav=-b*(J-T)/q,this.cobv=b*(2*J+T)/q}createInnerFacets(){const J=this.m,T=this.n;for(let b=0;b<T+J+1;b++)for(let J=this.min[b];J<this.max[b]+1;J++)J<this.max[b]&&J<this.max[b+1]+1&&this.innerFacets.push(["|"+J+"|"+b,"|"+J+"|"+(b+1),"|"+(J+1)+"|"+b]),b>0&&J<this.max[b-1]&&J+1<this.max[b]+1&&this.innerFacets.push(["|"+J+"|"+b,"|"+(J+1)+"|"+b,"|"+(J+1)+"|"+(b-1)])}edgeVecsABOB(){const J=this.m,T=this.n,b=new YJ(-T,J+T);for(let q=1;q<J+T;q++){const J=new YJ(this.min[q],q),T=new YJ(this.min[q-1],q-1),t=new YJ(this.min[q+1],q+1),j=J.clone(),B=T.clone(),Y=t.clone();j.rotate60About(b),B.rotate60About(b),Y.rotate60About(b);const C=new YJ(this.max[j.y],j.y),F=new YJ(this.max[j.y-1],j.y-1),A=new YJ(this.max[j.y-1]-1,j.y-1);j.x===C.x&&j.y===C.y||(j.x!==F.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([J,F,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([J,A,C])):j.y===Y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([J,T,F]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([J,F,t])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([J,T,F]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([J,F,C])))}}mapABOBtoOBOA(){const J=new YJ(0,0);for(let T=0;T<this.isoVecsABOB.length;T++){const b=[];for(let q=0;q<3;q++)J.x=this.isoVecsABOB[T][q].x,J.y=this.isoVecsABOB[T][q].y,0===this.vertexTypes[T][q]&&J.rotateNeg120(this.m,this.n),b.push(J.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const J=new YJ(0,0);for(let T=0;T<this.isoVecsABOB.length;T++){const b=[];for(let q=0;q<3;q++)J.x=this.isoVecsABOB[T][q].x,J.y=this.isoVecsABOB[T][q].y,1===this.vertexTypes[T][q]&&J.rotate120(this.m,this.n),b.push(J.clone());this.isoVecsBAOA.push(b)}}MapToFace(J,T){const b=this.IDATA.face[J],t=b[2],j=b[1],B=b[0],Y=q.n.ni(this.IDATA.vertex[t]),C=q.n.ni(this.IDATA.vertex[j]),F=q.n.ni(this.IDATA.vertex[B]),A=C.Jg(Y),a=F.Jg(Y),P=A.scale(this.coau).add(a.scale(this.cobu)),v=A.scale(this.coav).add(a.scale(this.cobv)),G=[];let x,I=q.j.pi[0];for(let q=0;q<this.cartesian.length;q++)I=P.scale(this.cartesian[q].x).add(v.scale(this.cartesian[q].y)).add(Y),G[q]=[I.x,I.y,I.z],x=J+"|"+this.vertices[q].x+"|"+this.vertices[q].y,T.vertex[this.vecToidx[x]]=[I.x,I.y,I.z]}build(J,T){const b=[],q=YJ.Zero(),t=new YJ(J,T),j=new YJ(-T,J+T);b.push(q,t,j);for(let E=T;E<J+1;E++)for(let T=0;T<J+1-E;T++)b.push(new YJ(T,E));if(T>0){const q=(0,z.g)(J,T),t=J/q,j=T/q;for(let Y=1;Y<q;Y++)b.push(new YJ(Y*t,Y*j)),b.push(new YJ(-Y*j,Y*(t+j))),b.push(new YJ(J-Y*(t+j),T+Y*t));const B=J/T;for(let Y=1;Y<T;Y++)for(let q=0;q<Y*B;q++)b.push(new YJ(q,Y)),b.push(new YJ(q,Y).rotate120(J,T)),b.push(new YJ(q,Y).rotateNeg120(J,T))}b.sort(((J,T)=>J.x-T.x)),b.sort(((J,T)=>J.y-T.y));const B=new Array(J+T+1),Y=new Array(J+T+1);for(let E=0;E<B.length;E++)B[E]=1/0,Y[E]=-1/0;let C=0,F=0;const A=b.length;for(let E=0;E<A;E++)F=b[E].x,C=b[E].y,B[C]=Math.min(F,B[C]),Y[C]=Math.max(F,Y[C]);const a=(b,q)=>{const t=b.clone();return"A"===q&&t.rotateNeg120(J,T),"B"===q&&t.rotate120(J,T),t.x<0?t.y:t.x+t.y},P=[],v=[],G=[],x=[],I={},u=[];let U=-1,K=-1;for(let E=0;E<A;E++)P[E]=b[E].toCartesianOrigin(new YJ(0,0),.5),v[E]=a(b[E],"O"),G[E]=a(b[E],"A"),x[E]=a(b[E],"B"),v[E]===G[E]&&G[E]===x[E]?(U=3,K=v[E]):v[E]===G[E]?(U=4,K=v[E]):G[E]===x[E]?(U=5,K=G[E]):x[E]===v[E]&&(U=6,K=v[E]),v[E]<G[E]&&v[E]<x[E]&&(U=2,K=v[E]),G[E]<v[E]&&G[E]<x[E]&&(U=1,K=G[E]),x[E]<G[E]&&x[E]<v[E]&&(U=0,K=x[E]),u.push([U,K,b[E].x,b[E].y]);u.sort(((J,T)=>J[2]-T[2])),u.sort(((J,T)=>J[3]-T[3])),u.sort(((J,T)=>J[1]-T[1])),u.sort(((J,T)=>J[0]-T[0]));for(let E=0;E<u.length;E++)I[u[E][2]+"|"+u[E][3]]=[u[E][0],u[E][1],E];return this.m=J,this.n=T,this.vertices=b,this.vertByDist=I,this.cartesian=P,this.min=B,this.max=Y,this}}class FJ{constructor(J,T,b,q){this.name=J,this.category=T,this.vertex=b,this.face=q}}class AJ extends FJ{innerToData(J,T){for(let b=0;b<T.innerFacets.length;b++)this.face.push(T.innerFacets[b].map((b=>T.vecToidx[J+b])))}mapABOBtoDATA(J,T){const b=T.IDATA.edgematch[J][0];for(let q=0;q<T.isoVecsABOB.length;q++){const t=[];for(let j=0;j<3;j++)0===T.vertexTypes[q][j]?t.push(J+"|"+T.isoVecsABOB[q][j].x+"|"+T.isoVecsABOB[q][j].y):t.push(b+"|"+T.isoVecsABOB[q][j].x+"|"+T.isoVecsABOB[q][j].y);this.face.push([T.vecToidx[t[0]],T.vecToidx[t[1]],T.vecToidx[t[2]]])}}mapOBOAtoDATA(J,T){const b=T.IDATA.edgematch[J][0];for(let q=0;q<T.isoVecsOBOA.length;q++){const t=[];for(let j=0;j<3;j++)1===T.vertexTypes[q][j]?t.push(J+"|"+T.isoVecsOBOA[q][j].x+"|"+T.isoVecsOBOA[q][j].y):t.push(b+"|"+T.isoVecsOBOA[q][j].x+"|"+T.isoVecsOBOA[q][j].y);this.face.push([T.vecToidx[t[0]],T.vecToidx[t[1]],T.vecToidx[t[2]]])}}mapBAOAtoDATA(J,T){const b=T.IDATA.edgematch[J][2];for(let q=0;q<T.isoVecsBAOA.length;q++){const t=[];for(let j=0;j<3;j++)1===T.vertexTypes[q][j]?t.push(J+"|"+T.isoVecsBAOA[q][j].x+"|"+T.isoVecsBAOA[q][j].y):t.push(b+"|"+T.isoVecsBAOA[q][j].x+"|"+T.isoVecsBAOA[q][j].y);this.face.push([T.vecToidx[t[0]],T.vecToidx[t[1]],T.vecToidx[t[2]]])}}orderData(J){const T=[];for(let j=0;j<13;j++)T[j]=[];const b=J.closestTo;for(let j=0;j<b.length;j++)b[j][0]>-1?b[j][1]>0&&T[b[j][0]].push([j,b[j][1]]):T[12].push([j,b[j][0]]);const q=[];for(let j=0;j<12;j++)q[j]=j;let t=12;for(let j=0;j<12;j++){T[j].sort(((J,T)=>J[1]-T[1]));for(let J=0;J<T[j].length;J++)q[T[j][J][0]]=t++}for(let j=0;j<T[12].length;j++)q[T[12][j][0]]=t++;for(let j=0;j<this.vertex.length;j++)this.vertex[j].push(q[j]);this.vertex.sort(((J,T)=>J[3]-T[3]));for(let j=0;j<this.vertex.length;j++)this.vertex[j].pop();for(let j=0;j<this.face.length;j++)for(let J=0;J<this.face[j].length;J++)this.face[j][J]=q[this.face[j][J]];this.sharedNodes=T[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(J,T){const b=[],q=[];let t=T.pop();q.push(t);let j=this.face[t].indexOf(J);j=(j+2)%3;let B=this.face[t][j];b.push(B);let Y=0;for(;T.length>0;)t=T[Y],this.face[t].indexOf(B)>-1?(j=(this.face[t].indexOf(B)+1)%3,B=this.face[t][j],b.push(B),q.push(t),T.splice(Y,1),Y=0):Y++;return this.adjacentFaces.push(b),q}toGoldbergPolyhedronData(){const J=new FJ("GeoDual","Goldberg",[],[]);J.name="GD dual";const T=this.vertex.length,b=new Array(T);for(let C=0;C<T;C++)b[C]=[];for(let C=0;C<this.face.length;C++)for(let J=0;J<3;J++)b[this.face[C][J]].push(C);let q=0,t=0,j=0,B=[],Y=[];this.adjacentFaces=[];for(let C=0;C<b.length;C++){J.face[C]=this.setOrder(C,b[C].concat([]));for(const T of b[C]){q=0,t=0,j=0,B=this.face[T];for(let J=0;J<3;J++)Y=this.vertex[B[J]],q+=Y[0],t+=Y[1],j+=Y[2];J.vertex[T]=[q/3,t/3,j/3]}}return J}static BuildGeodesicData(J){const T=new AJ("Geodesic-m-n","Geodesic",[[0,d.f,-1],[-d.f,1,0],[-1,0,-d.f],[1,0,-d.f],[d.f,1,0],[0,d.f,1],[-1,0,d.f],[-d.f,-1,0],[0,-d.f,-1],[d.f,-1,0],[1,0,d.f],[0,-d.f,1]],[]);J.setIndices(),J.calcCoeffs(),J.createInnerFacets(),J.edgeVecsABOB(),J.mapABOBtoOBOA(),J.mapABOBtoBAOA();for(let b=0;b<J.IDATA.face.length;b++)J.MapToFace(b,T),T.innerToData(b,J),"B"===J.IDATA.edgematch[b][1]&&T.mapABOBtoDATA(b,J),"O"===J.IDATA.edgematch[b][1]&&T.mapOBOAtoDATA(b,J),"A"===J.IDATA.edgematch[b][3]&&T.mapBAOAtoDATA(b,J);T.orderData(J);return T.vertex=T.vertex.map((function(J){const T=J[0],b=J[1],q=J[2],t=Math.sqrt(T*T+b*b+q*q);return J[0]*=1/t,J[1]*=1/t,J[2]*=1/t,J})),T}}t.e._GoldbergMeshParser=(J,T)=>aJ.Parse(J,T);class aJ extends t.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(J,T){return void 0===T?(J>this.goldbergData.nbUnsharedFaces-1&&(s.d.Warn("Maximum number of unshared faces used"),J=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+J):(J>11&&(s.d.Warn("Last pole used"),J=11),T>this.goldbergData.nbFacesAtPole-1&&(s.d.Warn("Maximum number of faces at a pole used"),T=this.goldbergData.nbFacesAtPole-1),12+J*this.goldbergData.nbFacesAtPole+T)}_changeGoldbergFaceColors(J){for(let b=0;b<J.length;b++){const T=J[b][0],q=J[b][1],t=J[b][2];for(let J=T;J<q+1;J++)this.goldbergData.faceColors[J]=t}const T=[];for(let b=0;b<12;b++)for(let J=0;J<5;J++)T.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let J=0;J<6;J++)T.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return T}setGoldbergFaceColors(J){const T=this._changeGoldbergFaceColors(J);this.Ga(j.e.ColorKind,T)}updateGoldbergFaceColors(J){const T=this._changeGoldbergFaceColors(J);this.updateVerticesData(j.e.ColorKind,T)}_changeGoldbergFaceUVs(J){const T=this.getVerticesData(j.e.UVKind);for(let b=0;b<J.length;b++){const q=J[b][0],t=J[b][1],j=J[b][2],B=J[b][3],Y=J[b][4],C=[],F=[];let A,a;for(let J=0;J<5;J++)A=j.x+B*Math.cos(Y+J*Math.PI/2.5),a=j.y+B*Math.sin(Y+J*Math.PI/2.5),A<0&&(A=0),A>1&&(A=1),C.push(A,a);for(let J=0;J<6;J++)A=j.x+B*Math.cos(Y+J*Math.PI/3),a=j.y+B*Math.sin(Y+J*Math.PI/3),A<0&&(A=0),A>1&&(A=1),F.push(A,a);for(let J=q;J<Math.min(12,t+1);J++)for(let b=0;b<5;b++)T[10*J+2*b]=C[2*b],T[10*J+2*b+1]=C[2*b+1];for(let J=Math.max(12,q);J<t+1;J++)for(let b=0;b<6;b++)T[12*J-24+2*b]=F[2*b],T[12*J-23+2*b]=F[2*b+1]}return T}setGoldbergFaceUVs(J){const T=this._changeGoldbergFaceUVs(J);this.Ga(j.e.UVKind,T)}updateGoldbergFaceUVs(J){const T=this._changeGoldbergFaceUVs(J);this.updateVerticesData(j.e.UVKind,T)}placeOnGoldbergFaceAt(J,T,b){const t=q.n.RotationFromAxis(this.goldbergData.faceXaxis[T],this.goldbergData.faceYaxis[T],this.goldbergData.faceZaxis[T]);J.rotation=t,J.position=this.goldbergData.faceCenters[T].add(this.goldbergData.faceXaxis[T].scale(b.x)).add(this.goldbergData.faceYaxis[T].scale(b.y)).add(this.goldbergData.faceZaxis[T].scale(b.z))}serialize(J){super.serialize(J),J.type="GoldbergMesh";const T={};if(T.adjacentFaces=this.goldbergData.adjacentFaces,T.nbSharedFaces=this.goldbergData.nbSharedFaces,T.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,T.nbFaces=this.goldbergData.nbFaces,T.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){T.faceColors=[];for(const J of this.goldbergData.faceColors)T.faceColors.push(J.Ai())}if(this.goldbergData.faceCenters){T.faceCenters=[];for(const J of this.goldbergData.faceCenters)T.faceCenters.push(J.Ai())}if(this.goldbergData.faceZaxis){T.faceZaxis=[];for(const J of this.goldbergData.faceZaxis)T.faceZaxis.push(J.Ai())}if(this.goldbergData.faceYaxis){T.faceYaxis=[];for(const J of this.goldbergData.faceYaxis)T.faceYaxis.push(J.Ai())}if(this.goldbergData.faceXaxis){T.faceXaxis=[];for(const J of this.goldbergData.faceXaxis)T.faceXaxis.push(J.Ai())}J.goldbergData=T}static Parse(J,T){const b=J.goldbergData;b.faceColors=b.faceColors.map((J=>P.d.ni(J))),b.faceCenters=b.faceCenters.map((J=>q.n.ni(J))),b.faceZaxis=b.faceZaxis.map((J=>q.n.ni(J))),b.faceXaxis=b.faceXaxis.map((J=>q.n.ni(J))),b.faceYaxis=b.faceYaxis.map((J=>q.n.ni(J)));const t=new aJ(J.name,T);return t.goldbergData=b,t}}var PJ=b(837);class vJ{constructor(J){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=J}moveTo(J,T){this._currentPath=new g.f(J,T),this._tempPaths.push(this._currentPath)}lineTo(J,T){this._currentPath.addLineTo(J,T)}quadraticCurveTo(J,T,b,q){this._currentPath.addQuadraticCurveTo(J,T,b,q,this._resolution)}bezierCurveTo(J,T,b,q,t,j){this._currentPath.addBezierCurveTo(J,T,b,q,t,j,this._resolution)}extractHoles(){for(const J of this._tempPaths)J.area()>0?this._holes.push(J):this._paths.push(J);if(!this._paths.length&&this._holes.length){const J=this._holes;this._holes=this._paths,this._paths=J}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function GJ(J,T,b,q,t,j){const B=j.glyphs[J]||j.glyphs["?"];if(!B)return null;const Y=new vJ(t);if(B.o){const J=B.o.split(" ");for(let t=0,j=J.length;t<j;){switch(J[t++]){case"m":{const j=parseInt(J[t++])*T+b,B=parseInt(J[t++])*T+q;Y.moveTo(j,B);break}case"l":{const j=parseInt(J[t++])*T+b,B=parseInt(J[t++])*T+q;Y.lineTo(j,B);break}case"q":{const j=parseInt(J[t++])*T+b,B=parseInt(J[t++])*T+q,C=parseInt(J[t++])*T+b,F=parseInt(J[t++])*T+q;Y.quadraticCurveTo(C,F,j,B);break}case"b":{const j=parseInt(J[t++])*T+b,B=parseInt(J[t++])*T+q,C=parseInt(J[t++])*T+b,F=parseInt(J[t++])*T+q,A=parseInt(J[t++])*T+b,a=parseInt(J[t++])*T+q;Y.bezierCurveTo(C,F,A,a,j,B);break}}}}return Y.extractHoles(),{offsetX:B.ha*T,shapePath:Y}}const xJ={CreateBox:a.e,CreateTiledBox:I,CreateSphere:u.b,CreateDisc:A.e,CreateIcoSphere:f,CreateRibbon:F,CreateCylinder:l,CreateTorus:p,CreateTorusKnot:S,CreateLineSystem:H.g,Fi:H.i,CreateDashedLines:H.e,ExtrudeShape:i,ExtrudeShapeCustom:m,CreateLathe:X,CreateTiledPlane:G,Gi:L.d,CreateGround:r.f,CreateTiledGround:r.i,CreateGroundFromHeightMap:r.c,CreatePolygon:Q,ExtrudePolygon:h,CreateTube:N,CreatePolyhedron:n,CreateGeodesic:function(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=T.m||1;q!==Math.floor(q)&&(q=Math.floor(q),s.d.Warn("m not an integer only floor(m) used"));let t=T.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),s.d.Warn("n not an integer only floor(n) used")),t>q){const J=t;t=q,q=J,s.d.Warn("n > m therefore m and n swapped")}const j=new CJ;return j.build(q,t),n(J,{custom:AJ.BuildGeodesicData(j),size:T.size,sizeX:T.sizeX,sizeY:T.sizeY,sizeZ:T.sizeZ,faceUV:T.faceUV,faceColors:T.faceColors,flat:T.flat,updatable:T.updatable,sideOrientation:T.sideOrientation,frontUVs:T.frontUVs,backUVs:T.backUVs},b)},CreateGoldberg:function(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=T.size,C=T.sizeX||j||1,F=T.sizeY||j||1,A=T.sizeZ||j||1;let a=T.m||1;a!==Math.floor(a)&&(a=Math.floor(a),s.d.Warn("m not an integer only floor(m) used"));let v=T.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),s.d.Warn("n not an integer only floor(n) used")),v>a){const J=v;v=a,a=J,s.d.Warn("n > m therefore m and n swapped")}const G=new CJ;G.build(a,v);const x=AJ.BuildGeodesicData(G),I=x.toGoldbergPolyhedronData(),u=new aJ(J,b);T.sideOrientation=t.e._GetDefaultSideOrientation(T.sideOrientation),u._originalBuilderSideOrientation=T.sideOrientation;(function(J,T){const b=J.size,t=J.sizeX||b||1,j=J.sizeY||b||1,C=J.sizeZ||b||1,F=0===J.sideOrientation?0:J.sideOrientation||B.c.DEFAULTSIDE,A=[],a=[],P=[],v=[];let G=1/0,x=-1/0,I=1/0,u=-1/0;for(let q=0;q<T.vertex.length;q++)G=Math.min(G,T.vertex[q][0]*t),x=Math.max(x,T.vertex[q][0]*t),I=Math.min(I,T.vertex[q][1]*j),u=Math.max(u,T.vertex[q][1]*j);let U=0;for(let B=0;B<T.face.length;B++){const J=T.face[B],b=q.n.ni(T.vertex[J[0]]),F=q.n.ni(T.vertex[J[2]]),K=q.n.ni(T.vertex[J[1]]),E=F.Jg(b),l=K.Jg(b),W=q.n.Cross(l,E).normalize();for(let q=0;q<J.length;q++){P.push(W.x,W.y,W.z);const b=T.vertex[J[q]];A.push(b[0]*t,b[1]*j,b[2]*C);const B=(b[1]*j-I)/(u-I);v.push((b[0]*t-G)/(x-G),Y.c?1-B:B)}for(let T=0;T<J.length-2;T++)a.push(U,U+T+2,U+T+1);U+=J.length}B.c._ComputeSides(F,A,a,P,v);const K=new B.c;return K.xa=A,K.indices=a,K.ya=P,K.Aa=v,K})(T,I).Ca(u,T.updatable),u.goldbergData.nbSharedFaces=x.sharedNodes,u.goldbergData.nbUnsharedFaces=x.poleNodes,u.goldbergData.adjacentFaces=x.adjacentFaces,u.goldbergData.nbFaces=u.goldbergData.nbSharedFaces+u.goldbergData.nbUnsharedFaces,u.goldbergData.nbFacesAtPole=(u.goldbergData.nbUnsharedFaces-12)/12;for(let t=0;t<x.vertex.length;t++)u.goldbergData.faceCenters.push(q.n.ni(x.vertex[t])),u.goldbergData.faceCenters[t].x*=C,u.goldbergData.faceCenters[t].y*=F,u.goldbergData.faceCenters[t].z*=A,u.goldbergData.faceColors.push(new P.d(1,1,1,1));for(let t=0;t<I.face.length;t++){const J=I.face[t],T=q.n.ni(I.vertex[J[0]]),b=q.n.ni(I.vertex[J[2]]),j=q.n.ni(I.vertex[J[1]]),B=b.Jg(T),Y=j.Jg(T),C=q.n.Cross(Y,B).normalize(),F=q.n.Cross(Y,C).normalize();u.goldbergData.faceXaxis.push(Y.normalize()),u.goldbergData.faceYaxis.push(C),u.goldbergData.faceZaxis.push(F)}return u},CreateDecal:tJ,CreateCapsule:BJ,CreateText:function(J,T,b){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const C=function(J,T,b,q){const t=Array.from(J),j=T/q.resolution,B=(q.boundingBox.yMax-q.boundingBox.yMin+q.underlineThickness)*j,Y=[];let C=0,F=0;for(let A=0;A<t.length;A++){const J=t[A];if("\n"===J)C=0,F-=B;else{const T=GJ(J,j,C,F,b,q);T&&(C+=T.offsetX,Y.push(T.shapePath))}}return Y}(T,j.size||50,j.resolution||8,b),F=[];let A=0;for(const G of C){if(!G.paths.length)continue;const T=G.holes.slice();for(const b of G.paths){var a,P;const C=[],v=[],G=b.getPoints();for(const J of G)v.push(new q.n(J.x,0,J.y));const x=T.slice();for(const J of x){const t=J.getPoints();let j=!1;for(const J of t)if(b.isPointInside(J)){j=!0;break}if(!j)continue;const B=[];for(const J of t)B.push(new q.n(J.x,0,J.y));C.push(B),T.splice(T.indexOf(J),1)}if(!C.length&&T.length)for(const J of T){const T=J.getPoints(),b=[];for(const J of T)b.push(new q.n(J.x,0,J.y));C.push(b)}const I=h(J,{shape:v,holes:C.length?C:void 0,depth:j.depth||1,faceUV:j.faceUV||(null===(a=j.perLetterFaceUV)||void 0===a?void 0:a.call(j,A)),faceColors:j.faceColors||(null===(P=j.perLetterFaceColors)||void 0===P?void 0:P.call(j,A)),sideOrientation:t.e._GetDefaultSideOrientation(j.sideOrientation||t.e.DOUBLESIDE)},B,Y);F.push(I),A++}}const v=t.e.MergeMeshes(F,!0,!0);if(v){const T=v.getBoundingInfo().boundingBox;v.position.x+=-(T.minimumWorld.x+T.maximumWorld.x)/2,v.position.y+=-(T.minimumWorld.y+T.maximumWorld.y)/2,v.position.z+=-(T.minimumWorld.z+T.maximumWorld.z)/2+T.extendSize.z,v.name=J;const b=new PJ.e("pivot",B);b.rotation.x=-Math.PI/2,v.parent=b,v.bakeCurrentTransformIntoVertices(),v.parent=null,b.dispose()}return v}}},12493:(J,T,b)=>{"use strict";b.d(T,{d:()=>B});var q=b(2319),t=b(2490);let j=0;const B=J=>{if(!J.environmentBRDFTexture){const T=J.useDelayedTextureLoading;J.useDelayedTextureLoading=!1;const b=J._blockEntityCollection;J._blockEntityCollection=!1;const B=q.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+j++,J,!0,!1,q.b.BILINEAR_SAMPLINGMODE);J._blockEntityCollection=b;const Y=J.getEngine().getLoadedTexturesCache(),C=Y.indexOf(B.getInternalTexture());-1!==C&&Y.splice(C,1),B.isRGBD=!0,B.wrapU=q.b.CLAMP_ADDRESSMODE,B.wrapV=q.b.CLAMP_ADDRESSMODE,J.environmentBRDFTexture=B,J.useDelayedTextureLoading=T,t.d.ExpandRGBDTexture(B);const F=J.getEngine().onContextRestoredObservable.add((()=>{B.isRGBD=!0;const T=J.onBeforeRenderObservable.add((()=>{B.isReady()&&(J.onBeforeRenderObservable.remove(T),t.d.ExpandRGBDTexture(B))}))}));J.Ki.add((()=>{J.getEngine().onContextRestoredObservable.remove(F)}))}return J.environmentBRDFTexture}},2521:(J,T,b)=>{"use strict";b.d(T,{d:()=>t});class q{constructor(J){this._pendingActions=new Array,this._workerInfos=J.map((J=>({workerPromise:Promise.resolve(J),idle:!0})))}dispose(){for(const J of this._workerInfos)J.workerPromise.then((J=>{J.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(J){this._executeOnIdleWorker(J)||this._pendingActions.push(J)}_executeOnIdleWorker(J){for(const T of this._workerInfos)if(T.idle)return this._execute(T,J),!0;return!1}_execute(J,T){J.idle=!1,J.workerPromise.then((b=>{T(b,(()=>{const T=this._pendingActions.shift();T?this._execute(J,T):J.idle=!0}))}))}}class t extends q{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.DefaultOptions;super([]),this._maxWorkers=J,this._createWorkerAsync=T,this._options=b}push(J){if(!this._executeOnIdleWorker(J))if(this._workerInfos.length<this._maxWorkers){const T={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(T),this._execute(T,J)}else this._pendingActions.push(J)}_execute(J,T){J.timeoutId&&(clearTimeout(J.timeoutId),delete J.timeoutId),super._execute(J,((b,q)=>{T(b,(()=>{q(),J.idle&&(J.timeoutId=setTimeout((()=>{J.workerPromise.then((J=>{J.terminate()}));const T=this._workerInfos.indexOf(J);-1!==T&&this._workerInfos.splice(T,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}t.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12093:(J,T,b)=>{"use strict";b.d(T,{d:()=>YT});var q=b(697),t=b(11994);class j extends t.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var B=b(731),Y=(b(2388),b(639));class C{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(J){this._targetStopDuration!==J&&(this._targetStopDuration=J)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(J){this._noiseTexture!==J&&(this._noiseTexture=J,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(J){this._animationSheetEnabled!==J&&(this._animationSheetEnabled=J)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(J){this._isAnimationSheetEnabled!=J&&(this._isAnimationSheetEnabled=J,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(J){this._useLogarithmicDepth=J&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(J){switch(J){case C.BLENDMODE_MULTIPLYADD:return;case C.BLENDMODE_ADD:J=1;break;case C.BLENDMODE_ONEONE:J=6;break;case C.BLENDMODE_STANDARD:J=2;break;case C.BLENDMODE_MULTIPLY:J=4;break;case C.BLENDMODE_SUBTRACT:J=3}this._engine.setAlphaMode(J)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:q.n.Zero()}set direction1(J){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=J)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:q.n.Zero()}set direction2(J){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=J)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:q.n.Zero()}set minEmitBox(J){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=J)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:q.n.Zero()}set maxEmitBox(J){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=J)}get billboardMode(){return this._billboardMode}set billboardMode(J){this._billboardMode!==J&&(this._billboardMode=J,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(J){this._isBillboardBased!==J&&(this._isBillboardBased=J,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(J){this._attachImageProcessingConfiguration(J)}_attachImageProcessingConfiguration(J){J!==this._imageProcessingConfiguration&&(!J&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=J)}_reset(){}_removeGradientAndTexture(J,T,b){if(!T)return this;let q=0;for(const t of T){if(t.gradient===J){T.splice(q,1);break}q++}return b&&b.dispose(),this}constructor(J){this.animations=[],this.renderingGroupId=0,this.j=q.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new q.n(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new q.k(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.bg=new q.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=q.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new B.d(1,1,1,1),this.color2=new B.d(1,1,1,1),this.colorDead=new B.d(0,0,0,1),this.textureMask=new B.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new j,this.id=J,this.name=J}createPointEmitter(J,T){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new q.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new q.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new q.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new q.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new q.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new q.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(J,T,b,q){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,C.BLENDMODE_SUBTRACT=-1,(0,Y.g)("BABYLON.BaseParticleSystem",C);var F=b(717),A=b(526);class a{constructor(){this.direction1=new q.n(0,1,0),this.direction2=new q.n(0,1,0),this.minEmitBox=new q.n(-.5,-.5,-.5),this.maxEmitBox=new q.n(.5,.5,.5)}startDirectionFunction(J,T,b,t){const j=(0,F.o)(this.direction1.x,this.direction2.x),B=(0,F.o)(this.direction1.y,this.direction2.y),Y=(0,F.o)(this.direction1.z,this.direction2.z);if(t)return T.x=j,T.y=B,void(T.z=Y);q.n.TransformNormalFromFloatsToRef(j,B,Y,J,T)}startPositionFunction(J,T,b,t){const j=(0,F.o)(this.minEmitBox.x,this.maxEmitBox.x),B=(0,F.o)(this.minEmitBox.y,this.maxEmitBox.y),Y=(0,F.o)(this.minEmitBox.z,this.maxEmitBox.z);if(t)return T.x=j,T.y=B,void(T.z=Y);q.n.TransformCoordinatesFromFloatsToRef(j,B,Y,J,T)}clone(){const J=new a;return A.d.DeepCopy(this,J),J}applyToShader(J){J.setVector3("direction1",this.direction1),J.setVector3("direction2",this.direction2),J.setVector3("minEmitBox",this.minEmitBox),J.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(J){J.addUniform("direction1",3),J.addUniform("direction2",3),J.addUniform("minEmitBox",3),J.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.direction1=this.direction1.Ai(),J.direction2=this.direction2.Ai(),J.minEmitBox=this.minEmitBox.Ai(),J.maxEmitBox=this.maxEmitBox.Ai(),J}parse(J){q.n.FromArrayToRef(J.direction1,0,this.direction1),q.n.FromArrayToRef(J.direction2,0,this.direction2),q.n.FromArrayToRef(J.minEmitBox,0,this.minEmitBox),q.n.FromArrayToRef(J.maxEmitBox,0,this.maxEmitBox)}}class P{get radius(){return this._radius}set radius(J){this._radius=J,this._buildHeight()}get angle(){return this._angle}set angle(J){this._angle=J,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=T,this.radius=J}startDirectionFunction(J,T,b,t){t?q.j.pi[0].p(b.Gg).normalize():b.position.subtractToRef(J.getTranslation(),q.j.pi[0]).normalize();const j=(0,F.o)(0,this.directionRandomizer),B=(0,F.o)(0,this.directionRandomizer),Y=(0,F.o)(0,this.directionRandomizer);T.x=q.j.pi[0].x+j,T.y=q.j.pi[0].y+B,T.z=q.j.pi[0].z+Y,T.normalize()}startPositionFunction(J,T,b,t){const j=(0,F.o)(0,2*Math.PI);let B;this.emitFromSpawnPointOnly?B=1e-4:(B=(0,F.o)(0,this.heightRange),B=1-B*B);let Y=this._radius-(0,F.o)(0,this._radius*this.radiusRange);Y*=B;const C=Y*Math.sin(j),A=Y*Math.cos(j),a=B*this._height;if(t)return T.x=C,T.y=a,void(T.z=A);q.n.TransformCoordinatesFromFloatsToRef(C,a,A,J,T)}clone(){const J=new P(this._radius,this._angle,this.directionRandomizer);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat2("radius",this._radius,this.radiusRange),J.setFloat("coneAngle",this._angle),J.setFloat2("height",this._height,this.heightRange),J.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(J){J.addUniform("radius",2),J.addUniform("coneAngle",1),J.addUniform("height",2),J.addUniform("directionRandomizer",1)}getEffectDefines(){let J="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(J+="\n#define CONEEMITTERSPAWNPOINT"),J}getClassName(){return"ConeParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.radius=this._radius,J.angle=this._angle,J.directionRandomizer=this.directionRandomizer,J.radiusRange=this.radiusRange,J.heightRange=this.heightRange,J.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,J}parse(J){this.radius=J.radius,this.angle=J.angle,this.directionRandomizer=J.directionRandomizer,this.radiusRange=void 0!==J.radiusRange?J.radiusRange:1,this.heightRange=void 0!==J.radiusRange?J.heightRange:1,this.emitFromSpawnPointOnly=void 0!==J.emitFromSpawnPointOnly&&J.emitFromSpawnPointOnly}}class v extends P{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0);super(J,T),this.direction1=b,this.direction2=t}startDirectionFunction(J,T){const b=(0,F.o)(this.direction1.x,this.direction2.x),t=(0,F.o)(this.direction1.y,this.direction2.y),j=(0,F.o)(this.direction1.z,this.direction2.z);q.n.TransformNormalFromFloatsToRef(b,t,j,J,T)}clone(){const J=new v(this.radius,this.angle,this.direction1,this.direction2);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat("radius",this.radius),J.setFloat("radiusRange",this.radiusRange),J.setVector3("direction1",this.direction1),J.setVector3("direction2",this.direction2)}buildUniformLayout(J){J.addUniform("radius",1),J.addUniform("radiusRange",1),J.addUniform("direction1",3),J.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const J=super.serialize();return J.direction1=this.direction1.Ai(),J.direction2=this.direction2.Ai(),J}parse(J){super.parse(J),this.direction1.p(J.direction1),this.direction2.p(J.direction2)}}class G{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=J,this.height=T,this.radiusRange=b,this.directionRandomizer=t,this._tempVector=q.n.Zero()}startDirectionFunction(J,T,b,t,j){b.position.subtractToRef(J.getTranslation(),this._tempVector),this._tempVector.normalize(),q.n.TransformNormalToRef(this._tempVector,j,this._tempVector);const B=(0,F.o)(-this.directionRandomizer/2,this.directionRandomizer/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,F.o)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=B,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),t?T.p(this._tempVector):q.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,J,T)}startPositionFunction(J,T,b,t){const j=(0,F.o)(-this.height/2,this.height/2),B=(0,F.o)(0,2*Math.PI),Y=(0,F.o)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(Y)*this.radius,A=C*Math.cos(B),a=C*Math.sin(B);t?T.hi(A,j,a):q.n.TransformCoordinatesFromFloatsToRef(A,j,a,J,T)}clone(){const J=new G(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat("radius",this.radius),J.setFloat("height",this.height),J.setFloat("radiusRange",this.radiusRange),J.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(J){J.addUniform("radius",1),J.addUniform("height",1),J.addUniform("radiusRange",1),J.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.radius=this.radius,J.height=this.height,J.radiusRange=this.radiusRange,J.directionRandomizer=this.directionRandomizer,J}parse(J){this.radius=J.radius,this.height=J.height,this.radiusRange=J.radiusRange,this.directionRandomizer=J.directionRandomizer}}class x extends G{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0),j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.n(0,1,0);super(J,T,b),this.direction1=t,this.direction2=j}startDirectionFunction(J,T,b,t){const j=(0,F.o)(this.direction1.x,this.direction2.x),B=(0,F.o)(this.direction1.y,this.direction2.y),Y=(0,F.o)(this.direction1.z,this.direction2.z);t?T.hi(j,B,Y):q.n.TransformNormalFromFloatsToRef(j,B,Y,J,T)}clone(){const J=new x(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat("radius",this.radius),J.setFloat("height",this.height),J.setFloat("radiusRange",this.radiusRange),J.setVector3("direction1",this.direction1),J.setVector3("direction2",this.direction2)}buildUniformLayout(J){J.addUniform("radius",1),J.addUniform("height",1),J.addUniform("radiusRange",1),J.addUniform("direction1",3),J.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const J=super.serialize();return J.direction1=this.direction1.Ai(),J.direction2=this.direction2.Ai(),J}parse(J){super.parse(J),q.n.FromArrayToRef(J.direction1,0,this.direction1),q.n.FromArrayToRef(J.direction2,0,this.direction2)}}class I{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=J,this.radiusRange=T,this.directionRandomizer=b}startDirectionFunction(J,T,b,t){const j=b.position.Jg(J.getTranslation()).normalize(),B=(0,F.o)(0,this.directionRandomizer),Y=(0,F.o)(0,this.directionRandomizer),C=(0,F.o)(0,this.directionRandomizer);j.x+=B,j.y+=Y,j.z+=C,j.normalize(),t?T.p(j):q.n.TransformNormalFromFloatsToRef(j.x,j.y,j.z,J,T)}startPositionFunction(J,T,b,t){const j=this.radius-(0,F.o)(0,this.radius*this.radiusRange),B=(0,F.o)(0,1),Y=(0,F.o)(0,2*Math.PI),C=Math.acos(2*B-1),A=j*Math.cos(Y)*Math.sin(C),a=j*Math.cos(C),P=j*Math.sin(Y)*Math.sin(C);t?T.hi(A,Math.abs(a),P):q.n.TransformCoordinatesFromFloatsToRef(A,Math.abs(a),P,J,T)}clone(){const J=new I(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat("radius",this.radius),J.setFloat("radiusRange",this.radiusRange),J.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(J){J.addUniform("radius",1),J.addUniform("radiusRange",1),J.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.radius=this.radius,J.radiusRange=this.radiusRange,J.directionRandomizer=this.directionRandomizer,J}parse(J){this.radius=J.radius,this.radiusRange=J.radiusRange,this.directionRandomizer=J.directionRandomizer}}class u{constructor(){this.direction1=new q.n(0,1,0),this.direction2=new q.n(0,1,0)}startDirectionFunction(J,T,b,t){const j=(0,F.o)(this.direction1.x,this.direction2.x),B=(0,F.o)(this.direction1.y,this.direction2.y),Y=(0,F.o)(this.direction1.z,this.direction2.z);t?T.hi(j,B,Y):q.n.TransformNormalFromFloatsToRef(j,B,Y,J,T)}startPositionFunction(J,T,b,t){t?T.hi(0,0,0):q.n.TransformCoordinatesFromFloatsToRef(0,0,0,J,T)}clone(){const J=new u;return A.d.DeepCopy(this,J),J}applyToShader(J){J.setVector3("direction1",this.direction1),J.setVector3("direction2",this.direction2)}buildUniformLayout(J){J.addUniform("direction1",3),J.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.direction1=this.direction1.Ai(),J.direction2=this.direction2.Ai(),J}parse(J){q.n.FromArrayToRef(J.direction1,0,this.direction1),q.n.FromArrayToRef(J.direction2,0,this.direction2)}}class U{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=J,this.radiusRange=T,this.directionRandomizer=b}startDirectionFunction(J,T,b,t){const j=b.position.Jg(J.getTranslation()).normalize(),B=(0,F.o)(0,this.directionRandomizer),Y=(0,F.o)(0,this.directionRandomizer),C=(0,F.o)(0,this.directionRandomizer);j.x+=B,j.y+=Y,j.z+=C,j.normalize(),t?T.p(j):q.n.TransformNormalFromFloatsToRef(j.x,j.y,j.z,J,T)}startPositionFunction(J,T,b,t){const j=this.radius-(0,F.o)(0,this.radius*this.radiusRange),B=(0,F.o)(0,1),Y=(0,F.o)(0,2*Math.PI),C=Math.acos(2*B-1),A=j*Math.cos(Y)*Math.sin(C),a=j*Math.cos(C),P=j*Math.sin(Y)*Math.sin(C);t?T.hi(A,a,P):q.n.TransformCoordinatesFromFloatsToRef(A,a,P,J,T)}clone(){const J=new U(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat("radius",this.radius),J.setFloat("radiusRange",this.radiusRange),J.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(J){J.addUniform("radius",1),J.addUniform("radiusRange",1),J.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.radius=this.radius,J.radiusRange=this.radiusRange,J.directionRandomizer=this.directionRandomizer,J}parse(J){this.radius=J.radius,this.radiusRange=J.radiusRange,this.directionRandomizer=J.directionRandomizer}}class K extends U{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.n(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0);super(J),this.direction1=T,this.direction2=b}startDirectionFunction(J,T){const b=(0,F.o)(this.direction1.x,this.direction2.x),t=(0,F.o)(this.direction1.y,this.direction2.y),j=(0,F.o)(this.direction1.z,this.direction2.z);q.n.TransformNormalFromFloatsToRef(b,t,j,J,T)}clone(){const J=new K(this.radius,this.direction1,this.direction2);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setFloat("radius",this.radius),J.setFloat("radiusRange",this.radiusRange),J.setVector3("direction1",this.direction1),J.setVector3("direction2",this.direction2)}buildUniformLayout(J){J.addUniform("radius",1),J.addUniform("radiusRange",1),J.addUniform("direction1",3),J.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const J=super.serialize();return J.direction1=this.direction1.Ai(),J.direction2=this.direction2.Ai(),J}parse(J){super.parse(J),this.direction1.p(J.direction1),this.direction2.p(J.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(J,T,b,t){const j=q.j.pi[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,b,j);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,j);const J=q.j.pi[1];j.subtractToRef(b.position,J),J.scaleToRef(1/b.lifeTime,j)}else j.set(0,0,0);t?T.p(j):q.n.TransformNormalToRef(j,J,T)}startPositionFunction(J,T,b,t){const j=q.j.pi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,j):j.set(0,0,0),t?T.p(j):q.n.TransformCoordinatesToRef(j,J,T)}clone(){const J=new E;return A.d.DeepCopy(this,J),J}applyToShader(J){}buildUniformLayout(J){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const J={};return J.type=this.getClassName(),J.particlePositionGenerator=this.particlePositionGenerator,J.particleDestinationGenerator=this.particleDestinationGenerator,J}parse(J){J.particlePositionGenerator&&(this.particlePositionGenerator=J.particlePositionGenerator),J.particleDestinationGenerator&&(this.particleDestinationGenerator=J.particleDestinationGenerator)}}var l=b(751);class W{get mesh(){return this._mesh}set mesh(J){this._mesh!==J&&(this._mesh=J,J?(this._indices=J.ui(),this._positions=J.getVerticesData(l.e.PositionKind),this._normals=J.getVerticesData(l.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=q.n.Zero(),this._mesh=null,this.direction1=new q.n(0,1,0),this.direction2=new q.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=J}startDirectionFunction(J,T,b,t){if(this.useMeshNormalsForDirection&&this._normals)return void q.n.TransformNormalToRef(this._storedNormal,J,T);const j=(0,F.o)(this.direction1.x,this.direction2.x),B=(0,F.o)(this.direction1.y,this.direction2.y),Y=(0,F.o)(this.direction1.z,this.direction2.z);t?T.hi(j,B,Y):q.n.TransformNormalFromFloatsToRef(j,B,Y,J,T)}startPositionFunction(J,T,b,t){if(!this._indices||!this._positions)return;const j=3*(Math.random()*(this._indices.length/3)|0),B=Math.random(),Y=Math.random()*(1-B),C=1-B-Y,F=this._indices[j],A=this._indices[j+1],a=this._indices[j+2],P=q.j.pi[0],v=q.j.pi[1],G=q.j.pi[2],x=q.j.pi[3];q.n.FromArrayToRef(this._positions,3*F,P),q.n.FromArrayToRef(this._positions,3*A,v),q.n.FromArrayToRef(this._positions,3*a,G),x.x=B*P.x+Y*v.x+C*G.x,x.y=B*P.y+Y*v.y+C*G.y,x.z=B*P.z+Y*v.z+C*G.z,t?T.hi(x.x,x.y,x.z):q.n.TransformCoordinatesFromFloatsToRef(x.x,x.y,x.z,J,T),this.useMeshNormalsForDirection&&this._normals&&(q.n.FromArrayToRef(this._normals,3*F,P),q.n.FromArrayToRef(this._normals,3*A,v),q.n.FromArrayToRef(this._normals,3*a,G),this._storedNormal.x=B*P.x+Y*v.x+C*G.x,this._storedNormal.y=B*P.y+Y*v.y+C*G.y,this._storedNormal.z=B*P.z+Y*v.z+C*G.z)}clone(){const J=new W(this.mesh);return A.d.DeepCopy(this,J),J}applyToShader(J){J.setVector3("direction1",this.direction1),J.setVector3("direction2",this.direction2)}buildUniformLayout(J){J.addUniform("direction1",3),J.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var J;const T={};return T.type=this.getClassName(),T.direction1=this.direction1.Ai(),T.direction2=this.direction2.Ai(),T.meshId=null===(J=this.mesh)||void 0===J?void 0:J.id,T.useMeshNormalsForDirection=this.useMeshNormalsForDirection,T}parse(J,T){q.n.FromArrayToRef(J.direction1,0,this.direction1),q.n.FromArrayToRef(J.direction2,0,this.direction2),J.meshId&&T&&(this.mesh=T.getLastMeshById(J.meshId)),this.useMeshNormalsForDirection=J.useMeshNormalsForDirection}}class p{_isUbo(J){return void 0!==J.addUniform}constructor(J){this._isUbo(J)?(this.setMatrix3x3=J.updateMatrix3x3.bind(J),this.setMatrix2x2=J.updateMatrix2x2.bind(J),this.setFloat=J.updateFloat.bind(J),this.setFloat2=J.updateFloat2.bind(J),this.setFloat3=J.updateFloat3.bind(J),this.setFloat4=J.updateFloat4.bind(J),this.setFloatArray=J.updateFloatArray.bind(J),this.setArray=J.updateArray.bind(J),this.setIntArray=J.updateIntArray.bind(J),this.setMatrix=J.Zi.bind(J),this.setMatrices=J.updateMatrices.bind(J),this.setVector3=J.updateVector3.bind(J),this.setVector4=J.updateVector4.bind(J),this.setColor3=J.updateColor3.bind(J),this.setColor4=J.updateColor4.bind(J),this.setDirectColor4=J.updateDirectColor4.bind(J),this.setInt=J.updateInt.bind(J),this.setInt2=J.updateInt2.bind(J),this.setInt3=J.updateInt3.bind(J),this.setInt4=J.updateInt4.bind(J)):(this.setMatrix3x3=J.setMatrix3x3.bind(J),this.setMatrix2x2=J.setMatrix2x2.bind(J),this.setFloat=J.setFloat.bind(J),this.setFloat2=J.setFloat2.bind(J),this.setFloat3=J.setFloat3.bind(J),this.setFloat4=J.setFloat4.bind(J),this.setFloatArray=J.setFloatArray.bind(J),this.setArray=J.setArray.bind(J),this.setIntArray=J.setIntArray.bind(J),this.setMatrix=J.setMatrix.bind(J),this.setMatrices=J.setMatrices.bind(J),this.setVector3=J.setVector3.bind(J),this.setVector4=J.setVector4.bind(J),this.setColor3=J.setColor3.bind(J),this.setColor4=J.setColor4.bind(J),this.setDirectColor4=J.setDirectColor4.bind(J),this.setInt=J.setInt.bind(J),this.setInt2=J.setInt2.bind(J),this.setInt3=J.setInt3.bind(J),this.setInt4=J.setInt4.bind(J))}}var o=b(596);const S="gpuUpdateParticlesPixelShader",H="#version 300 es\nvoid main() {discard;}\n";o.c.ShadersStore[S]||(o.c.ShadersStore[S]=H);const s="gpuUpdateParticlesVertexShader",g="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";o.c.ShadersStore[s]||(o.c.ShadersStore[s]=g);(0,Y.g)("BABYLON.WebGL2ParticleSystem",class{constructor(J,T){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=J,this._engine=T,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var J;return(null===(J=this._updateEffect)||void 0===J?void 0:J.isReady())??!1}createUpdateBuffer(J){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=J,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new p(this._updateEffect)}createVertexBuffers(J,T){this._updateVAO.push(this._createUpdateVAO(J)),this._renderVAO.push(this._engine.recordVertexArrayObject(T,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=T}createParticleBuffer(J){return J}bindDrawBuffers(J,T,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,T):this._engine.bindVertexArrayObject(this._renderVAO[J],null)}preUpdateParticleBuffer(){const J=this._engine;if(this._engine.enableEffect(this._updateEffect),!J.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(J,T,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[J],null);const q=this._engine;q.bindTransformFeedbackBuffer(T.getBuffer()),q.setRasterizerState(!1),q.beginTransformFeedback(!0),q.drawArraysType(3,0,b),q.endTransformFeedback(),q.setRasterizerState(!0),q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let J=0;J<this._updateVAO.length;J++)this._engine.releaseVertexArrayObject(this._updateVAO[J]);this._updateVAO.length=0;for(let J=0;J<this._renderVAO.length;J++)this._engine.releaseVertexArrayObject(this._renderVAO[J]);this._renderVAO.length=0}_createUpdateVAO(J){const T={};T.position=J.createVertexBuffer("position",0,3);let b=3;T.age=J.createVertexBuffer("age",b,1),b+=1,T.size=J.createVertexBuffer("size",b,3),b+=3,T.life=J.createVertexBuffer("life",b,1),b+=1,T.seed=J.createVertexBuffer("seed",b,4),b+=4,T.direction=J.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof E&&(T.initialPosition=J.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(T.color=J.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(T.initialDirection=J.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(T.noiseCoordinates1=J.createVertexBuffer("noiseCoordinates1",b,3),b+=3,T.noiseCoordinates2=J.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(T.angle=J.createVertexBuffer("angle",b,1),b+=1):(T.angle=J.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(T.cellIndex=J.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(T.cellStartOffset=J.createVertexBuffer("cellStartOffset",b,1),b+=1));const q=this._engine.recordVertexArrayObject(T,null,this._updateEffect);return this._engine.bindArrayBuffer(null),q}});class d{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,q=arguments.length>3?arguments[3]:void 0;this._engine=J,this._label=q,this._engine._storageBuffers.push(this),this._create(T,b)}_create(J,T){this._bufferSize=J,this._creationFlags=T,this._buffer=this._engine.createStorageBuffer(J,T,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(J,T,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,J,T,b)}async read(J,T,b,q){return await this._engine.readFromStorageBuffer(this._buffer,J,T,b,q)}dispose(){const J=this._engine._storageBuffers,T=J.indexOf(this);-1!==T&&(J[T]=J[J.length-1],J.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var w=b(674),Z=b(680),e=b(727),c=b(2319),V=b(2487),Q=b(519),h=b(623),i=b(2405);class m{constructor(){this._gpuTimeInFrameId=-1,this.counter=new i.d}_addDuration(J,T){J<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==J?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(T,!1),this._gpuTimeInFrameId=J):this.counter.addCount(T,!1))}}var O=b(575);class X{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=J,this._engine=T,this.uniqueId=V.e.UniqueId,T.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new m),this._engine.getCaps().supportComputeShaders?q.bindingsMapping?(this._context=T.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...q}):Q.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):Q.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(J,T){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const q=this._bindings[J];this._bindings[J]={type:b?0:4,object:T,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!q||q.object!==T||q.type!==this._bindings[J].type)}setStorageTexture(J,T){const b=this._bindings[J];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==T),this._bindings[J]={type:1,object:T,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(J,T){const b=this._bindings[J];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==T),this._bindings[J]={type:6,object:T,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(J,T){return!!T.externalTexture&&(this.setExternalTexture(J,T.externalTexture),!0)}setUniformBuffer(J,T){const b=this._bindings[J];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==T),this._bindings[J]={type:X._BufferIsDataBuffer(T)?7:2,object:T,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(J,T){const b=this._bindings[J];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==T),this._bindings[J]={type:X._BufferIsDataBuffer(T)?7:3,object:T,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(J,T){const b=this._bindings[J];this._contextIsDirty||(this._contextIsDirty=!b||!T.compareSampler(b.object)),this._bindings[J]={type:5,object:T,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let J=this._effect;for(const t in this._bindings){const J=this._bindings[t],T=J.type,b=J.object;switch(T){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const T=[],b=this._shaderPath;if(this._options.defines)for(let t=0;t<this._options.defines.length;t++)T.push(this._options.defines[t]);const q=T.join("\n");return this._cachedDefines!==q&&(this._cachedDefines=q,J=this._engine.createComputeEffect(b,{defines:q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=J),!!J.isReady()}dispatch(J,T,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,J,T,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=X._BufferIsDataBuffer(J)?J:J.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,T,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const T in this._bindings){const b=this._bindings[T];if(!this._options.bindingsMapping[T])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+T+"'");switch(b.type){case 0:{const q=this._samplers[T],t=b.object;var J;if(!q||!t._texture||!q.compareSampler(t._texture))this._samplers[T]=(new h.c).setParameters(t.wrapU,t.wrapV,t.wrapR,t.anisotropicFilteringLevel,t._texture.samplingMode,null===(J=t._texture)||void 0===J?void 0:J._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const J=b.object;J.getBuffer()!==b.buffer&&(b.buffer=J.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((t=>{(0,O.h)((()=>this.dispatch(J,T,b)),t,void 0,q)}))}serialize(){const J=e.d.Serialize(this);J.options=this._options,J.shaderPath=this._shaderPath,J.Vl={},J.textures={};for(const T in this._bindings){const b=this._bindings[T],q=b.object;switch(b.type){case 0:case 4:case 1:{const t=q.serialize();t&&(J.textures[T]=t,J.Vl[T]={type:b.type});break}}}return J}static Parse(J,T,b){const q=e.d.Parse((()=>new X(J.name,T.getEngine(),J.shaderPath,J.options)),J,T,b);for(const t in J.textures){const j=J.Vl[t],B=c.b.Parse(J.textures[t],T,b);0===j.type?q.setTexture(t,B):4===j.type?q.setTexture(t,B,!1):q.setStorageTexture(t,B)}return q}static _BufferIsDataBuffer(J){return void 0!==J.underlyingResource}}(0,w.e)([(0,Z.M)()],X.prototype,"name",void 0),(0,w.e)([(0,Z.M)()],X.prototype,"fastMode",void 0),(0,Y.g)("BABYLON.ComputeShader",X);var L=b(845);const r="gpuUpdateParticlesComputeShader",N="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";o.c.ShadersStoreWGSL[r]||(o.c.ShadersStoreWGSL[r]=N);(0,Y.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(J,T){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=J,this._engine=T}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var J;return(null===(J=this._updateComputeShader)||void 0===J?void 0:J.isReady())??!1}createUpdateBuffer(J){var T;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(b.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new X("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:J.split("\n")}),null===(T=this._simParamsComputeShader)||void 0===T||T.dispose(),this._simParamsComputeShader=new L.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new p(this._simParamsComputeShader)}createVertexBuffers(J,T){this._renderVertexBuffers.push(T)}createParticleBuffer(J){const T=new d(this._engine,4*J.length,11,"ComputeShaderParticleSystemBuffer");return T.update(J),this._bufferComputeShader.push(T),T.getBuffer()}bindDrawBuffers(J,T,b){this._engine.bindBuffers(this._renderVertexBuffers[J],b,T)}preUpdateParticleBuffer(){}updateParticleBuffer(J,T,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[J]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^J]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var J;for(let T=0;T<this._bufferComputeShader.length;++T)this._bufferComputeShader[T].dispose();this._bufferComputeShader.length=0,null===(J=this._simParamsComputeShader)||void 0===J||J.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class R{constructor(J,T,b){this.gradient=J,this.color1=T,this.color2=b}getColorToRef(J){this.color2?B.d.LerpToRef(this.color1,this.color2,Math.random(),J):J.p(this.color1)}}class n{constructor(J,T){this.gradient=J,this.color=T}}class D{constructor(J,T,b){this.gradient=J,this.factor1=T,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class f{static GetCurrentGradient(J,T,b){if(T[0].gradient>J)return void b(T[0],T[0],1);for(let t=0;t<T.length-1;t++){const q=T[t],j=T[t+1];if(J>=q.gradient&&J<=j.gradient){return void b(q,j,(J-q.gradient)/(j.gradient-q.gradient))}}const q=T.length-1;b(T[q],T[q],1)}}var z=b(497),M=b(12101),y=b(550);class k{constructor(J){this.particleSystem=J,this.position=q.n.Zero(),this.direction=q.n.Zero(),this.color=new B.d(0,0,0,0),this.colorStep=new B.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new q.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new B.d(0,0,0,0),this._currentColor2=new B.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=k._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let J=this.age,T=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===T?(T=1,J=this._randomCellOffset):J+=this._randomCellOffset);const b=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let q;q=this._initialSpriteCellLoop?(0,F.b)(J*T%this.lifeTime/this.lifeTime):(0,F.b)(J*T/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+q*b|0}_inheritParticleInfoToSubEmitter(J){if(J.particleSystem.j.position){const T=J.particleSystem.j;if(T.position.p(this.position),J.inheritDirection){const J=q.j.pi[0];this.direction.normalizeToRef(J),T.setDirection(J,0,Math.PI/2)}}else{J.particleSystem.j.p(this.position)}this.direction.scaleToRef(J.inheritedVelocityAmount/2,q.j.pi[0]),J.particleSystem._inheritedVelocityOffset.p(q.j.pi[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const J of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(J)}_reset(){this.age=0,this.id=k._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(J){J.position.p(this.position),this._initialDirection?J._initialDirection?J._initialDirection.p(this._initialDirection):J._initialDirection=this._initialDirection.clone():J._initialDirection=null,J.direction.p(this.direction),this.Gg&&(J.Gg?J.Gg.p(this.Gg):J.Gg=this.Gg.clone()),J.color.p(this.color),J.colorStep.p(this.colorStep),J.lifeTime=this.lifeTime,J.age=this.age,J._randomCellOffset=this._randomCellOffset,J.size=this.size,J.scale.p(this.scale),J.angle=this.angle,J.angularSpeed=this.angularSpeed,J.particleSystem=this.particleSystem,J.cellIndex=this.cellIndex,J.id=this.id,J._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(J._currentColorGradient=this._currentColorGradient,J._currentColor1.p(this._currentColor1),J._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(J._currentSizeGradient=this._currentSizeGradient,J._currentSize1=this._currentSize1,J._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(J._currentAngularSpeedGradient=this._currentAngularSpeedGradient,J._currentAngularSpeed1=this._currentAngularSpeed1,J._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(J._currentVelocityGradient=this._currentVelocityGradient,J._currentVelocity1=this._currentVelocity1,J._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(J._currentLimitVelocityGradient=this._currentLimitVelocityGradient,J._currentLimitVelocity1=this._currentLimitVelocity1,J._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(J._currentDragGradient=this._currentDragGradient,J._currentDrag1=this._currentDrag1,J._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(J._initialStartSpriteCellId=this._initialStartSpriteCellId,J._initialEndSpriteCellId=this._initialEndSpriteCellId,J._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(J.remapData&&this.remapData?J.remapData.p(this.remapData):J.remapData=new q.p(0,0,0,0)),this._randomNoiseCoordinates1&&(J._randomNoiseCoordinates1?(J._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),J._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(J._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),J._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}k._Count=0;var JJ=b(810),TJ=(b(2383),b(869)),bJ=b(864),qJ=b(2454);function tJ(J,T){const b=(0,F.o)(0,1);B.d.LerpToRef(T.color1,T.color2,b,J.color),T.colorDead.subtractToRef(J.color,T._colorDiff),T._colorDiff.scaleToRef(1/J.lifeTime,J.colorStep)}function jJ(J,T){J._currentColorGradient=T._colorGradients[0],J._currentColorGradient.getColorToRef(J.color),J._currentColor1.p(J.color),T._colorGradients.length>1?T._colorGradients[1].getColorToRef(J._currentColor2):J._currentColor2.p(J.color)}function BJ(J,T){const b=T._colorGradients;f.GetCurrentGradient(T._ratio,b,((T,b,q)=>{T!==J._currentColorGradient&&(J._currentColor1.p(J._currentColor2),b.getColorToRef(J._currentColor2),J._currentColorGradient=T),B.d.LerpToRef(J._currentColor1,J._currentColor2,q,J.color)}))}function YJ(J,T){J.colorStep.scaleToRef(T._scaledUpdateSpeed,T._scaledColorStep),J.color.addInPlace(T._scaledColorStep),J.color.a<0&&(J.color.a=0)}function CJ(J,T){f.GetCurrentGradient(T._ratio,T._angularSpeedGradients,((T,b,q)=>{T!==J._currentAngularSpeedGradient&&(J._currentAngularSpeed1=J._currentAngularSpeed2,J._currentAngularSpeed2=b.getFactor(),J._currentAngularSpeedGradient=T),J.angularSpeed=(0,F.m)(J._currentAngularSpeed1,J._currentAngularSpeed2,q)}))}function FJ(J,T){J.angle+=J.angularSpeed*T._scaledUpdateSpeed}function AJ(J,T){T.particleEmitterType.startDirectionFunction(T._emitterWorldMatrix,J.direction,J,T.isLocal,T._emitterInverseWorldMatrix)}function aJ(J,T){T.startDirectionFunction(T._emitterWorldMatrix,J.direction,J,T.isLocal)}function PJ(J,T){J._currentVelocityGradient=T._velocityGradients[0],J._currentVelocity1=J._currentVelocityGradient.getFactor(),T._velocityGradients.length>1?J._currentVelocity2=T._velocityGradients[1].getFactor():J._currentVelocity2=J._currentVelocity1}function vJ(J,T){J._currentLimitVelocityGradient=T._limitVelocityGradients[0],J._currentLimitVelocity1=J._currentLimitVelocityGradient.getFactor(),T._limitVelocityGradients.length>1?J._currentLimitVelocity2=T._limitVelocityGradients[1].getFactor():J._currentLimitVelocity2=J._currentLimitVelocity1}function GJ(J,T){f.GetCurrentGradient(T._ratio,T._velocityGradients,((b,q,t)=>{b!==J._currentVelocityGradient&&(J._currentVelocity1=J._currentVelocity2,J._currentVelocity2=q.getFactor(),J._currentVelocityGradient=b),T._directionScale*=(0,F.m)(J._currentVelocity1,J._currentVelocity2,t)}))}function xJ(J,T){f.GetCurrentGradient(T._ratio,T._limitVelocityGradients,((b,q,t)=>{b!==J._currentLimitVelocityGradient&&(J._currentLimitVelocity1=J._currentLimitVelocity2,J._currentLimitVelocity2=q.getFactor(),J._currentLimitVelocityGradient=b);const j=(0,F.m)(J._currentLimitVelocity1,J._currentLimitVelocity2,t);J.direction.length()>j&&J.direction.scaleInPlace(T.limitVelocityDamping)}))}function IJ(J,T){J.direction.scaleToRef(T._directionScale,T._scaledDirection)}function uJ(J,T){T.particleEmitterType.startPositionFunction(T._emitterWorldMatrix,J.position,J,T.isLocal)}function UJ(J,T){T.startPositionFunction(T._emitterWorldMatrix,J.position,J,T.isLocal)}function KJ(J,T){J.Gg?J.Gg.p(J.position):J.Gg=J.position.clone(),q.n.TransformCoordinatesToRef(J.Gg,T._emitterWorldMatrix,J.position)}function EJ(J,T){T.isLocal&&J.Gg?(J.Gg.addInPlace(T._scaledDirection),q.n.TransformCoordinatesToRef(J.Gg,T._emitterWorldMatrix,J.position)):J.position.addInPlace(T._scaledDirection)}function lJ(J,T){J._currentDragGradient=T._dragGradients[0],J._currentDrag1=J._currentDragGradient.getFactor(),T._dragGradients.length>1?J._currentDrag2=T._dragGradients[1].getFactor():J._currentDrag2=J._currentDrag1}function WJ(J,T){f.GetCurrentGradient(T._ratio,T._dragGradients,((b,q,t)=>{b!==J._currentDragGradient&&(J._currentDrag1=J._currentDrag2,J._currentDrag2=q.getFactor(),J._currentDragGradient=b);const j=(0,F.m)(J._currentDrag1,J._currentDrag2,t);T._scaledDirection.scaleInPlace(1-j)}))}function pJ(J,T){J._randomNoiseCoordinates1?(J._randomNoiseCoordinates1.hi(Math.random(),Math.random(),Math.random()),J._randomNoiseCoordinates2.hi(Math.random(),Math.random(),Math.random())):(J._randomNoiseCoordinates1=new q.n(Math.random(),Math.random(),Math.random()),J._randomNoiseCoordinates2=new q.n(Math.random(),Math.random(),Math.random()))}function oJ(J,T){const b=T._noiseTextureData,t=T._noiseTextureSize;if(b&&t&&J._randomNoiseCoordinates1){const j=T._fetchR(J._randomNoiseCoordinates1.x,J._randomNoiseCoordinates1.y,t.width,t.height,b),B=T._fetchR(J._randomNoiseCoordinates1.z,J._randomNoiseCoordinates2.x,t.width,t.height,b),Y=T._fetchR(J._randomNoiseCoordinates2.y,J._randomNoiseCoordinates2.z,t.width,t.height,b),C=q.j.pi[0],F=q.j.pi[1];C.hi((2*j-1)*T.noiseStrength.x,(2*B-1)*T.noiseStrength.y,(2*Y-1)*T.noiseStrength.z),C.scaleToRef(T._tempScaledUpdateSpeed,F),J.direction.addInPlace(F)}}function SJ(J,T){T.gravity.scaleToRef(T._tempScaledUpdateSpeed,T._scaledGravity),J.direction.addInPlace(T._scaledGravity)}function HJ(J,T){J.size=(0,F.o)(T.minSize,T.maxSize),J.scale.hi((0,F.o)(T.minScaleX,T.maxScaleX),(0,F.o)(T.minScaleY,T.maxScaleY))}function sJ(J,T){J._currentSizeGradient=T._sizeGradients[0],J._currentSize1=J._currentSizeGradient.getFactor(),J.size=J._currentSize1,T._sizeGradients.length>1?J._currentSize2=T._sizeGradients[1].getFactor():J._currentSize2=J._currentSize1,J.scale.hi((0,F.o)(T.minScaleX,T.maxScaleX),(0,F.o)(T.minScaleY,T.maxScaleY))}function gJ(J,T){const b=T._actualFrame/T.targetStopDuration;f.GetCurrentGradient(b,T._startSizeGradients,((b,q,t)=>{b!==T._currentStartSizeGradient&&(T._currentStartSize1=T._currentStartSize2,T._currentStartSize2=q.getFactor(),T._currentStartSizeGradient=b);const j=(0,F.m)(T._currentStartSize1,T._currentStartSize2,t);J.scale.scaleInPlace(j)}))}function dJ(J,T){f.GetCurrentGradient(T._ratio,T._sizeGradients,((T,b,q)=>{T!==J._currentSizeGradient&&(J._currentSize1=J._currentSize2,J._currentSize2=b.getFactor(),J._currentSizeGradient=T),J.size=(0,F.m)(J._currentSize1,J._currentSize2,q)}))}function wJ(J,T){J.remapData=new q.p(0,1,0,1)}function ZJ(J,T){T._colorRemapGradients&&T._colorRemapGradients.length>0&&f.GetCurrentGradient(T._ratio,T._colorRemapGradients,((T,b,q)=>{const t=(0,F.m)(T.factor1,b.factor1,q),j=(0,F.m)(T.factor2,b.factor2,q);J.remapData.x=t,J.remapData.y=j-t})),T._alphaRemapGradients&&T._alphaRemapGradients.length>0&&f.GetCurrentGradient(T._ratio,T._alphaRemapGradients,((T,b,q)=>{const t=(0,F.m)(T.factor1,b.factor1,q),j=(0,F.m)(T.factor2,b.factor2,q);J.remapData.z=t,J.remapData.w=j-t}))}function eJ(J,T){const b=(0,F.b)(T._actualFrame/T.targetStopDuration);f.GetCurrentGradient(b,T._lifeTimeGradients,((T,q)=>{const t=T,j=q,B=t.getFactor(),Y=j.getFactor(),C=(b-t.gradient)/(j.gradient-t.gradient);J.lifeTime=(0,F.m)(B,Y,C)})),T._emitPower=(0,F.o)(T.minEmitPower,T.maxEmitPower)}function cJ(J,T){J.lifeTime=(0,F.o)(T.minLifeTime,T.maxLifeTime),T._emitPower=(0,F.o)(T.minEmitPower,T.maxEmitPower)}function VJ(J,T){0===T._emitPower?(J._initialDirection?J._initialDirection.p(J.direction):J._initialDirection=J.direction.clone(),J.direction.set(0,0,0)):(J._initialDirection=null,J.direction.scaleInPlace(T._emitPower)),J.direction.addInPlace(T._inheritedVelocityOffset)}function QJ(J,T){J.angularSpeed=(0,F.o)(T.minAngularSpeed,T.maxAngularSpeed),J.angle=(0,F.o)(T.minInitialRotation,T.maxInitialRotation)}function hJ(J,T){J._currentAngularSpeedGradient=T._angularSpeedGradients[0],J.angularSpeed=J._currentAngularSpeedGradient.getFactor(),J._currentAngularSpeed1=J.angularSpeed,T._angularSpeedGradients.length>1?J._currentAngularSpeed2=T._angularSpeedGradients[1].getFactor():J._currentAngularSpeed2=J._currentAngularSpeed1,J.angle=(0,F.o)(T.minInitialRotation,T.maxInitialRotation)}function iJ(J,T){J._initialStartSpriteCellId=T.startSpriteCellID,J._initialEndSpriteCellId=T.endSpriteCellID,J._initialSpriteCellLoop=T.spriteCellLoop}function mJ(J,T){J.previousItem=T.previousItem,J.nextItem=T,T.previousItem&&(T.previousItem.nextItem=J),T.previousItem=J}function OJ(J,T){J.previousItem=T,J.nextItem=T.nextItem,T.nextItem&&(T.nextItem.previousItem=J),T.nextItem=J}function XJ(J,T){let b=T;for(;b.nextItem;)b=b.nextItem;J.previousItem=b,J.nextItem=b.nextItem,b.nextItem=J}function LJ(J){J.previousItem&&(J.previousItem.nextItem=J.nextItem),J.nextItem&&(J.nextItem.previousItem=J.previousItem)}class rJ extends C{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(J){this._startDirectionFunction!==J&&(this._startDirectionFunction=J,this._directionProcessing.process=J?aJ:AJ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(J){this._startPositionFunction!==J&&(this._startPositionFunction=J,this._positionCreation.process=J?UJ:uJ)}set onDispose(J){this._onDisposeObserver&&this.Ki.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ki.add(J)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(J){this._useRampGradients!==J&&(this._useRampGradients=J,this._resetEffect(),J?(this._rampCreation={process:wJ,previousItem:null,nextItem:null},OJ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:ZJ,previousItem:null,nextItem:null},OJ(this._remapGradientProcessing,this._gravityProcessing)):(LJ(this._rampCreation),LJ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(J){this._isLocal!==J&&(this._isLocal=J,J?(this._isLocalCreation={process:KJ,previousItem:null,nextItem:null},OJ(this._isLocalCreation,this._positionCreation)):LJ(this._isLocalCreation))}get particles(){return this.Ql}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(J){this._animationSheetEnabled!==J&&(this._animationSheetEnabled=J,J?(this._sheetCreation={process:iJ,previousItem:null,nextItem:null},OJ(this._sheetCreation,this._colorCreation)):LJ(this._sheetCreation),this._reset())}getActiveCount(){return this.Ql.length}getClassName(){return"fj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var J;let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(J=this._customWrappers[T])||void 0===J?void 0:J.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[J]??this._customWrappers[0]}setCustomEffect(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[T]=new JJ.b(this._engine),this._customWrappers[T].effect=J,this._customWrappers[T].drawContext&&(this._customWrappers[T].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(J){if(this.noiseTexture!==J){if(this._noiseTexture=J,!J)return LJ(this._noiseCreation),void LJ(this._noiseProcessing);this._noiseCreation={process:pJ,previousItem:null,nextItem:null},OJ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:oJ,previousItem:null,nextItem:null},OJ(this._noiseProcessing,this._positionProcessing)}}constructor(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(J),this._emitterInverseWorldMatrix=q.e.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new q.n,this.Ki=new z.b,this.onStoppedObservable=new z.b,this.onStartedObservable=new z.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ql=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new B.d(0,0,0,0),this._colorDiff=new B.d(0,0,0,0),this._scaledDirection=q.n.Zero(),this._scaledGravity=q.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=J=>{},this.recycleParticle=J=>{const T=this.Ql.pop();T!==J&&T.copyTo(J),this._stockParticles.push(T)},this._createParticle=()=>{let J;return 0!==this._stockParticles.length?(J=this._stockParticles.pop(),J._reset()):J=new k(this),this._prepareParticle(J),J},this.paused=!1,this._shadersLoaded=!1,this._capacity=T,this._epsilon=Y,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=q.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||y.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.si.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:cJ,previousItem:null,nextItem:null},this._positionCreation={process:uJ,previousItem:null,nextItem:null},OJ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:AJ,previousItem:null,nextItem:null},OJ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:VJ,previousItem:null,nextItem:null},OJ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:HJ,previousItem:null,nextItem:null},OJ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:QJ,previousItem:null,nextItem:null},OJ(this._angleCreation,this._sizeCreation),this._colorCreation={process:tJ,previousItem:null,nextItem:null},OJ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,C||(this._colorProcessing={process:YJ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:FJ,previousItem:null,nextItem:null},OJ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:IJ,previousItem:null,nextItem:null},OJ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:EJ,previousItem:null,nextItem:null},OJ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:SJ,previousItem:null,nextItem:null},OJ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=j,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new JJ.b(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new a,this.updateFunction=J=>{var T;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(T=this.noiseTexture.getContent())||void 0===T||T.then((J=>{this._noiseTextureData=J})));const b=J===this.Ql;for(let q=0;q<J.length;q++){const T=J[q];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const t=T.age;if(T.age+=this._tempScaledUpdateSpeed,T.age>T.lifeTime){const J=T.age-t,b=T.lifeTime-t;this._tempScaledUpdateSpeed=b*this._tempScaledUpdateSpeed/J,T.age=T.lifeTime}this._ratio=T.age/T.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let j=this._updateQueueStart;for(;j;)j.process(T,this),j=j.nextItem;if(this._isAnimationSheetEnabled&&!C&&T.updateCellIndex(),T._inheritParticleInfoToSubEmitters(),T.age>=T.lifeTime){if(this._emitFromParticle(T),T._attachedSubEmitters){for(const J of T._attachedSubEmitters)J.particleSystem.disposeOnStop=!0,J.particleSystem.stop();T._attachedSubEmitters=null}this.recycleParticle(T),b&&q--}else;}}}serialize(J){throw new Error("Method not implemented.")}clone(J,T){throw new Error("Method not implemented.")}_addFactorGradient(J,T,b,q){const t=new D(T,b,q);J.push(t),J.sort(((J,T)=>J.gradient<T.gradient?-1:J.gradient>T.gradient?1:0))}_removeFactorGradient(J,T){if(!J)return;let b=0;for(const q of J){if(q.gradient===T){J.splice(b,1);break}b++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=eJ:this._lifeTimeCreation.process=cJ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:gJ,previousItem:null,nextItem:null},OJ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(LJ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(J){this.targetStopDuration!==J&&(this._targetStopDuration=J,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(J,T,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,J,T,b),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(J){return this._removeFactorGradient(this._lifeTimeGradients,J),this._syncLifeTimeCreation(),this}addSizeGradient(J,T,b){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=sJ,this._sizeGradientProcessing={process:dJ,previousItem:null,nextItem:null},mJ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,J,T,b),this}removeSizeGradient(J){var T;return this._removeFactorGradient(this._sizeGradients,J),0===(null===(T=this._sizeGradients)||void 0===T?void 0:T.length)&&(LJ(this._sizeGradientProcessing),this._sizeCreation.process=HJ),this}addColorRemapGradient(J,T,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,J,T,b),this}removeColorRemapGradient(J){return this._removeFactorGradient(this._colorRemapGradients,J),this}addAlphaRemapGradient(J,T,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,J,T,b),this}removeAlphaRemapGradient(J){return this._removeFactorGradient(this._alphaRemapGradients,J),this}addAngularSpeedGradient(J,T,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=hJ,this._angularSpeedGradientProcessing={process:CJ,previousItem:null,nextItem:null},mJ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,J,T,b),this}removeAngularSpeedGradient(J){var T;return this._removeFactorGradient(this._angularSpeedGradients,J),0===(null===(T=this._angularSpeedGradients)||void 0===T?void 0:T.length)&&(this._angleCreation.process=QJ,LJ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(J,T,b){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:PJ,previousItem:null,nextItem:null},OJ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:GJ,previousItem:null,nextItem:null},mJ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,J,T,b),this}removeVelocityGradient(J){var T;return this._removeFactorGradient(this._velocityGradients,J),0===(null===(T=this._velocityGradients)||void 0===T?void 0:T.length)&&(LJ(this._velocityCreation),LJ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(J,T,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:vJ,previousItem:null,nextItem:null},OJ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:xJ,previousItem:null,nextItem:null},OJ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,J,T,b),this}removeLimitVelocityGradient(J){var T;return this._removeFactorGradient(this._limitVelocityGradients,J),0===(null===(T=this._limitVelocityGradients)||void 0===T?void 0:T.length)&&(LJ(this._limitVelocityCreation),LJ(this._limitVelocityGradientProcessing)),this}addDragGradient(J,T,b){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:lJ,previousItem:null,nextItem:null},mJ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:WJ,previousItem:null,nextItem:null},mJ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,J,T,b),this}removeDragGradient(J){var T;return this._removeFactorGradient(this._dragGradients,J),0===(null===(T=this._dragGradients)||void 0===T?void 0:T.length)&&(LJ(this._dragCreation),LJ(this._dragGradientProcessing)),this}addEmitRateGradient(J,T,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,J,T,b),this}removeEmitRateGradient(J){return this._removeFactorGradient(this._emitRateGradients,J),this}addStartSizeGradient(J,T,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,J,T,b),this._syncStartSizeCreation(),this}removeStartSizeGradient(J){return this._removeFactorGradient(this._startSizeGradients,J),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const J=new Uint8Array(4*this._rawTextureWidth),T=B.g.Vi[0];for(let b=0;b<this._rawTextureWidth;b++){const q=b/this._rawTextureWidth;f.GetCurrentGradient(q,this._rampGradients,((q,t,j)=>{B.b.LerpToRef(q.color,t.color,j,T),J[4*b]=255*T.r,J[4*b+1]=255*T.g,J[4*b+2]=255*T.b,J[4*b+3]=255}))}this._rampGradientsTexture=M.e.CreateRGBATexture(J,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((J,T)=>J.gradient<T.gradient?-1:J.gradient>T.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(J,T){this._rampGradients||(this._rampGradients=[]);const b=new n(J,T);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(J){return this._removeGradientAndTexture(J,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(J,T,b){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=jJ,this._colorProcessing.process=BJ);const q=new R(J,T,b);return this._colorGradients.push(q),this._colorGradients.sort(((J,T)=>J.gradient<T.gradient?-1:J.gradient>T.gradient?1:0)),this}removeColorGradient(J){if(!this._colorGradients)return this;let T=0;for(const b of this._colorGradients){if(b.gradient===J){this._colorGradients.splice(T,1);break}T++}return 0===this._colorGradients.length&&(this._colorCreation.process=tJ,this._colorProcessing.process=YJ),this}resetDrawCache(){if(this._drawWrappers){for(const J of this._drawWrappers)if(J)for(const T of J)null===T||void 0===T||T.dispose();this._drawWrappers=[]}}_fetchR(J,T,b,q,t){return t[4*(((J=.5*Math.abs(J)+.5)*b%b|0)+((T=.5*Math.abs(T)+.5)*q%q|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const J=this._engine,T=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*T),this._vertexBuffer=new l.c(J,this._vertexData,!0,T);let b=0;const q=this._vertexBuffer.createVertexBuffer(l.e.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.e.PositionKind]=q,b+=3;const t=this._vertexBuffer.createVertexBuffer(l.e.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.e.ColorKind]=t,b+=4;const j=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=j,b+=1;const B=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=B,b+=2,this._isAnimationSheetEnabled){const J=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=J,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const J=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=J,b+=3}if(this._useRampGradients){const J=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=J,b+=4}let Y;if(this._useInstancing){const T=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new l.c(J,T,!1,2),Y=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Y=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=Y,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const J=[],T=[];let b=0;for(let q=0;q<this._capacity;q++)J.push(b),J.push(b+1),J.push(b+2),J.push(b),J.push(b+2),J.push(b+3),T.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(J),this._linesIndexBuffer=this._engine.createIndexBuffer(T)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(J)setTimeout((()=>{this.start(0)}),J);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var T;-1!==(null===(T=this.j)||void 0===T?void 0:T.getClassName().indexOf("Mesh"))&&this.j.ti(!0);const J=this.noiseTexture;if(J&&J.onGeneratedObservable)J.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let T=0;T<this.preWarmCycles;T++)this.animate(!0),J.render()}))}));else for(let T=0;T<this.preWarmCycles;T++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(J))}_postStop(J){}reset(){this._stockParticles.length=0,this.Ql.length=0}_appendParticleVertex(J,T,b,t){let j=J*this._vertexBufferSize;if(this._vertexData[j++]=T.position.x+this.bg.x,this._vertexData[j++]=T.position.y+this.bg.y,this._vertexData[j++]=T.position.z+this.bg.z,this._vertexData[j++]=T.color.r,this._vertexData[j++]=T.color.g,this._vertexData[j++]=T.color.b,this._vertexData[j++]=T.color.a,this._vertexData[j++]=T.angle,this._vertexData[j++]=T.scale.x*T.size,this._vertexData[j++]=T.scale.y*T.size,this._isAnimationSheetEnabled&&(this._vertexData[j++]=T.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[j++]=T.direction.x,this._vertexData[j++]=T.direction.y,this._vertexData[j++]=T.direction.z);else if(T._initialDirection){let J=T._initialDirection;this.isLocal&&(q.n.TransformNormalToRef(J,this._emitterWorldMatrix,q.j.pi[0]),J=q.j.pi[0]),0===J.x&&0===J.z&&(J.x=.001),this._vertexData[j++]=J.x,this._vertexData[j++]=J.y,this._vertexData[j++]=J.z}else{let J=T.direction;this.isLocal&&(q.n.TransformNormalToRef(J,this._emitterWorldMatrix,q.j.pi[0]),J=q.j.pi[0]),0===J.x&&0===J.z&&(J.x=.001),this._vertexData[j++]=J.x,this._vertexData[j++]=J.y,this._vertexData[j++]=J.z}this._useRampGradients&&T.remapData&&(this._vertexData[j++]=T.remapData.x,this._vertexData[j++]=T.remapData.y,this._vertexData[j++]=T.remapData.z,this._vertexData[j++]=T.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===t?t=this._epsilon:1===t&&(t=1-this._epsilon)),this._vertexData[j++]=b,this._vertexData[j++]=t)}_prepareParticle(J){}_createNewOnes(J){let T;for(let b=0;b<J&&this.Ql.length!==this._capacity;b++){T=this._createParticle(),this.Ql.push(T);let J=this._createQueueStart;for(;J;)J.process(T,this),J=J.nextItem;T._inheritParticleInfoToSubEmitters()}}_update(J){if(this._alive=this.Ql.length>0,this.j.position){const J=this.j;this._emitterWorldMatrix=J.getWorldMatrix()}else{const J=this.j;this._emitterWorldMatrix=q.e.Translation(J.x,J.y,J.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ql),this._createNewOnes(J)}static _GetAttributeNamesOrOptions(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=[l.e.PositionKind,l.e.ColorKind,"angle","offset","size"];return J&&q.push("cellIndex"),T||q.push("direction"),b&&q.push("remapData"),q}static _GetEffectCreationOptions(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,TJ.e)(q),J&&q.push("particlesInfos"),T&&q.push("logarithmicDepthConstant"),b&&(q.push("vFogInfos"),q.push("vFogColor")),q}fillDefines(J,T){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,TJ.o)(this,this._scene,J),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&J.push("#define FOG")),this._isAnimationSheetEnabled&&J.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&J.push("#define LOGARITHMICDEPTH"),T===C.BLENDMODE_MULTIPLY&&J.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&J.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(J.push("#define BILLBOARD"),this.billboardMode){case 2:J.push("#define BILLBOARDY");break;case 8:case 9:J.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&J.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:J.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),J.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(J,T,b){T.push(...rJ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),J.push(...rJ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,qJ.f)(J,this._imageProcessingConfigurationDefines),(0,qJ.e)(b,this._imageProcessingConfigurationDefines))}_getWrapper(J){const T=this._getCustomDrawWrapper(J);if(null!==T&&void 0!==T&&T.effect)return T;const b=[];this.fillDefines(b,J);const q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let t=this._drawWrappers[q];t||(t=this._drawWrappers[q]=[]);let j=t[J];j||(j=new JJ.b(this._engine),j.drawContext&&(j.drawContext.useInstancing=this._useInstancing),t[J]=j);const B=b.join("\n");if(j.defines!==B){const J=[],T=[],b=[];this.fillUniformsAttributesAndSamplerNames(T,J,b),j.setEffect(this._engine.createEffect("particles",J,T,b,B,void 0,void 0,void 0,void 0,this._shaderLanguage),B)}return j}animate(){var J;let T,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(J=this._scene)||void 0===J?void 0:J.getAnimationRatio())||1),this.manualEmitCount>-1)T=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let J=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const T=this._actualFrame/this.targetStopDuration;f.GetCurrentGradient(T,this._emitRateGradients,((T,b,q)=>{T!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=T),J=(0,F.m)(this._currentEmitRate1,this._currentEmitRate2,q)}))}T=J*this._scaledUpdateSpeed|0,this._newPartsExcess+=J*this._scaledUpdateSpeed-T}if(this._newPartsExcess>1&&(T+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?T=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(T),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let J=0;for(let T=0;T<this.Ql.length;T++){const b=this.Ql[T];this._appendParticleVertices(J,b),J+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ql.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(J,T){this._appendParticleVertex(J++,T,0,0),this._useInstancing||(this._appendParticleVertex(J++,T,1,0),this._appendParticleVertex(J++,T,1,1),this._appendParticleVertex(J++,T,0,1))}rebuild(){var J;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(J=this._spriteBuffer)||void 0===J||J._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!rJ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,12278)),Promise.resolve().then(b.bind(b,12220))])):await Promise.all([Promise.resolve().then(b.bind(b,12204)),Promise.resolve().then(b.bind(b,12186))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(J){const T=this._getWrapper(J),b=T.effect,t=this._engine;t.enableEffect(T);const j=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",j),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const J=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/J.width,this.spriteCellHeight/J.height,this.spriteCellWidth/J.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const J=this._scene.activeCamera;b.setVector3("eyePosition",J.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const B=b.defines;var Y,C,F,A,a,P;(this._scene&&((0,TJ.h)(b,this,this._scene),this.applyFog&&(0,bJ.c)(this._scene,void 0,b)),B.indexOf("#define BILLBOARDMODE_ALL")>=0&&(j.invertToRef(q.j.Matrix[0]),b.setMatrix("invView",q.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?t.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?t.bindBuffers(this._vertexBuffers,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):t.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null,b);(this.useLogarithmicDepth&&this._scene&&(0,bJ.j)(B,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(J),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?t.drawElementsType(6,0,10,this.Ql.length):t.drawArraysType(7,0,4,this.Ql.length):null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?t.drawElementsType(1,0,10*this.Ql.length):t.drawElementsType(0,0,6*this.Ql.length);return this.Ql.length}render(){if(!this.isReady()||!this.Ql.length)return 0;const J=this._engine;J.setState&&(J.setState(!1),this.forceDepthWrite&&J.setDepthWrite(!0));let T=0;return T=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),T}_onDispose(){}dispose(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),J&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),J&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(T,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const J=this._scene.si.indexOf(this);J>-1&&this._scene.si.splice(J,1),this._scene._activeParticleSystems.dispose()}this.Ki.notifyObservers(this),this.Ki.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}rJ.ForceGLSL=!1;var NJ,RJ=b(533);!function(J){J[J.ATTACHED=0]="ATTACHED",J[J.END=1]="END"}(NJ||(NJ={}));class nJ{constructor(J){if(this.particleSystem=J,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!J.j||!J.j.dispose){const T=(0,Y.c)("BABYLON.AbstractMesh");J.j=new T("SubemitterSystemEmitter",J.va()),J._disposeEmitterOnDispose=!0}}clone(){let J=this.particleSystem.j;if(J){if(J instanceof q.n)J=J.clone();else if(-1!==J.getClassName().indexOf("Mesh")){J=new((0,Y.c)("BABYLON.Mesh"))("",J.va()),J.isVisible=!1}}else J=new q.n;const T=new nJ(this.particleSystem.clone(this.particleSystem.name,J));return T.particleSystem.name+="Clone",T.type=this.type,T.inheritDirection=this.inheritDirection,T.inheritedVelocityAmount=this.inheritedVelocityAmount,T.particleSystem._disposeEmitterOnDispose=!0,T.particleSystem.disposeOnStop=!0,T}serialize(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={};return T.type=this.type,T.inheritDirection=this.inheritDirection,T.inheritedVelocityAmount=this.inheritedVelocityAmount,T.particleSystem=this.particleSystem.serialize(J),T}static _ParseParticleSystem(J,T,b){throw(0,RJ.e)("ParseParticle")}static Parse(J,T,b){const q=J.particleSystem,t=new nJ(nJ._ParseParticleSystem(q,T,b,!0));return t.type=J.type,t.inheritDirection=J.inheritDirection,t.inheritedVelocityAmount=J.inheritedVelocityAmount,t.particleSystem._isSubEmitter=!0,t}dispose(){this.particleSystem.dispose()}}var DJ=b(581);function fJ(J,T){const b=new u;return b.direction1=J,b.direction2=T,b}function zJ(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function MJ(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function yJ(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.n(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0);return new K(J,T,b)}function kJ(){return new G(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function JT(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0),j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.n(0,1,0);return new x(J,T,b,t,j)}function TT(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new P(J,T)}function bT(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0);return new v(J,T,b,t)}const qT=q.n.Zero(),tT=q.n.Zero(),jT=q.n.Zero();class BT{constructor(){this.strength=0,this.position=q.n.Zero()}_processParticle(J,T){this.position.subtractToRef(J.position,qT);const b=qT.lengthSquared()+1;qT.normalize().scaleToRef(this.strength/b,tT),tT.scaleToRef(T._tempScaledUpdateSpeed,jT),J.direction.addInPlace(jT)}serialize(){return{position:this.position.Ai(),strength:this.strength}}}class YT extends rJ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=J=>{if(!this._subEmitters||0===this._subEmitters.length)return;const T=Math.floor(Math.random()*this._subEmitters.length);for(const b of this._subEmitters[T])if(1===b.type){const T=b.clone();J._inheritParticleInfoToSubEmitter(T),T.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(T.particleSystem),T.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(J,T){const b=fJ(J,T);return this.particleEmitterType=b,b}get flowMap(){return this._flowMap}set flowMap(J){this._flowMap!==J&&(this._flowMap=J,this._flowMapUpdate&&(LJ(this._flowMapUpdate),this._flowMapUpdate=null),J&&(this._flowMapUpdate={process:J=>{var T;const b=null===(T=this.va())||void 0===T?void 0:T.getTransformMatrix();this._flowMap._processParticle(J,this.flowMapStrength*this._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null},OJ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(J){this._attractors.push(J),1===this._attractors.length&&(this._attractorUpdate={process:J=>{for(const T of this._attractors)T._processParticle(J,this)},previousItem:null,nextItem:null},OJ(this._attractorUpdate,this._directionProcessing))}removeAttractor(J){const T=this._attractors.indexOf(J);-1!==T&&this._attractors.splice(T,1),0===this._attractors.length&&LJ(this._attractorUpdate)}start(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(J)}createHemisphericEmitter(){const J=zJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=J,J}createSphereEmitter(){const J=MJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=J,J}createDirectedSphereEmitter(){const J=yJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0));return this.particleEmitterType=J,J}createCylinderEmitter(){const J=kJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=J,J}createDirectedCylinderEmitter(){const J=JT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.n(0,1,0));return this.particleEmitterType=J,J}createConeEmitter(){const J=TT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=J,J}createDirectedConeEmitter(){const J=bT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0));return this.particleEmitterType=J,J}createBoxEmitter(J,T,b,q){const t=new a;return this.particleEmitterType=t,this.direction1=J,this.direction2=T,this.minEmitBox=b,this.maxEmitBox=q,t}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const J of this.subEmitters)J instanceof YT?this._subEmitters.push([new nJ(J)]):J instanceof nJ?this._subEmitters.push([J]):J instanceof Array&&this._subEmitters.push(J)}_stopSubEmitters(){if(this.activeSubSystems){for(const J of this.activeSubSystems)J.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const J=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==J&&this._rootParticleSystem.activeSubSystems.splice(J,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(J){J&&this._stopSubEmitters()}_prepareParticle(J){if(this._subEmitters&&this._subEmitters.length>0){const T=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];J._attachedSubEmitters=[];for(const b of T)if(0===b.type){const T=b.clone();J._attachedSubEmitters.push(T),T.particleSystem.start()}}}_onDispose(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),J&&this.particles)for(const b of this.particles)if(b._attachedSubEmitters)for(let J=b._attachedSubEmitters.length-1;J>=0;J-=1)b._attachedSubEmitters[J].dispose();if(T&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let J=0;J<this._subEmitters.length;J++)for(const T of this._subEmitters[J])T.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(J,T,b,t){let j;j=b instanceof DJ.b?null:b;const C=(0,Y.c)("BABYLON.Texture");if(C&&j&&(J.texture?T.particleTexture=C.Parse(J.texture,j,t):J.textureName&&(T.particleTexture=new C(t+J.textureName,j,!1,void 0===J.invertY||J.invertY),T.particleTexture.name=J.textureName)),J.emitterId||0===J.emitterId||void 0!==J.j?J.emitterId&&j?T.j=j.getLastMeshById(J.emitterId):T.j=q.n.ni(J.j):T.j=q.n.Zero(),T.isLocal=!!J.isLocal,void 0!==J.renderingGroupId&&(T.renderingGroupId=J.renderingGroupId),void 0!==J.isBillboardBased&&(T.isBillboardBased=J.isBillboardBased),void 0!==J.billboardMode&&(T.billboardMode=J.billboardMode),void 0!==J.useLogarithmicDepth&&(T.useLogarithmicDepth=J.useLogarithmicDepth),J.animations){for(let b=0;b<J.animations.length;b++){const q=J.animations[b],t=(0,Y.c)("BABYLON.Animation");t&&T.animations.push(t.Parse(q))}T.beginAnimationOnStart=J.beginAnimationOnStart,T.beginAnimationFrom=J.beginAnimationFrom,T.beginAnimationTo=J.beginAnimationTo,T.beginAnimationLoop=J.beginAnimationLoop}if(J.autoAnimate&&j&&j.beginAnimation(T,J.autoAnimateFrom,J.autoAnimateTo,J.autoAnimateLoop,J.autoAnimateSpeed||1),T.startDelay=0|J.startDelay,T.minAngularSpeed=J.minAngularSpeed,T.maxAngularSpeed=J.maxAngularSpeed,T.minSize=J.minSize,T.maxSize=J.maxSize,J.minScaleX&&(T.minScaleX=J.minScaleX,T.maxScaleX=J.maxScaleX,T.minScaleY=J.minScaleY,T.maxScaleY=J.maxScaleY),void 0!==J.preWarmCycles&&(T.preWarmCycles=J.preWarmCycles,T.preWarmStepOffset=J.preWarmStepOffset),void 0!==J.minInitialRotation&&(T.minInitialRotation=J.minInitialRotation,T.maxInitialRotation=J.maxInitialRotation),T.minLifeTime=J.minLifeTime,T.maxLifeTime=J.maxLifeTime,T.minEmitPower=J.minEmitPower,T.maxEmitPower=J.maxEmitPower,T.emitRate=J.emitRate,T.gravity=q.n.ni(J.gravity),J.noiseStrength&&(T.noiseStrength=q.n.ni(J.noiseStrength)),T.color1=B.d.ni(J.color1),T.color2=B.d.ni(J.color2),T.colorDead=B.d.ni(J.colorDead),T.updateSpeed=J.updateSpeed,T.targetStopDuration=J.targetStopDuration,T.blendMode=J.blendMode,J.colorGradients)for(const q of J.colorGradients)T.addColorGradient(q.gradient,B.d.ni(q.color1),q.color2?B.d.ni(q.color2):void 0);if(J.rampGradients){for(const b of J.rampGradients)T.addRampGradient(b.gradient,B.b.ni(b.color));T.useRampGradients=J.useRampGradients}if(J.colorRemapGradients)for(const q of J.colorRemapGradients)T.addColorRemapGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.alphaRemapGradients)for(const q of J.alphaRemapGradients)T.addAlphaRemapGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.sizeGradients)for(const q of J.sizeGradients)T.addSizeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.angularSpeedGradients)for(const q of J.angularSpeedGradients)T.addAngularSpeedGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.velocityGradients)for(const q of J.velocityGradients)T.addVelocityGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.dragGradients)for(const q of J.dragGradients)T.addDragGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.emitRateGradients)for(const q of J.emitRateGradients)T.addEmitRateGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.startSizeGradients)for(const q of J.startSizeGradients)T.addStartSizeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.lifeTimeGradients)for(const q of J.lifeTimeGradients)T.addLifeTimeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(J.limitVelocityGradients){for(const b of J.limitVelocityGradients)T.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);T.limitVelocityDamping=J.limitVelocityDamping}if(J.noiseTexture&&j){const b=(0,Y.c)("BABYLON.ProceduralTexture");T.noiseTexture=b.Parse(J.noiseTexture,j,t)}let F;if(J.particleEmitterType){switch(J.particleEmitterType.type){case"SphereParticleEmitter":F=new U;break;case"SphereDirectedParticleEmitter":F=new K;break;case"ConeEmitter":case"ConeParticleEmitter":F=new P;break;case"ConeDirectedParticleEmitter":F=new v;break;case"CylinderParticleEmitter":F=new G;break;case"CylinderDirectedParticleEmitter":F=new x;break;case"HemisphericParticleEmitter":F=new I;break;case"PointParticleEmitter":F=new u;break;case"MeshParticleEmitter":F=new W;break;case"CustomParticleEmitter":F=new E;break;default:F=new a}F.parse(J.particleEmitterType,j)}else F=new a,F.parse(J,j);T.particleEmitterType=F,T.startSpriteCellID=J.startSpriteCellID,T.endSpriteCellID=J.endSpriteCellID,T.spriteCellLoop=J.spriteCellLoop??!0,T.spriteCellWidth=J.spriteCellWidth,T.spriteCellHeight=J.spriteCellHeight,T.spriteCellChangeSpeed=J.spriteCellChangeSpeed,T.spriteRandomStartCell=J.spriteRandomStartCell,T.disposeOnStop=J.disposeOnStop??!1,T.manualEmitCount=J.manualEmitCount??-1}static Parse(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0;const Y=J.name;let C,F,A=null,a=null;if(T instanceof DJ.b?C=T:(F=T,C=F.getEngine()),J.customShader&&C.createEffectForParticles){a=J.customShader;const T=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"";A=C.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,T)}const P=new YT(Y,j||J.Zh,T,A,J.isAnimationSheetEnabled);if(P.customShader=a,P._rootUrl=b,J.id&&(P.id=J.id),J.subEmitters){P.subEmitters=[];for(const q of J.subEmitters){const J=[];for(const t of q)J.push(nJ.Parse(t,T,b));P.subEmitters.push(J)}}if(J.attractors)for(const B of J.attractors){const J=new BT;J.position=q.n.ni(B.position),J.strength=B.strength,P.addAttractor(J)}return YT._Parse(J,P,T,b),J.textureMask&&(P.textureMask=B.d.ni(J.textureMask)),J.bg&&(P.bg=q.n.ni(J.bg)),J.preventAutoStart&&(P.preventAutoStart=J.preventAutoStart),t||P.preventAutoStart||P.start(),P}serialize(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={};if(YT._Serialize(T,this,J),T.textureMask=this.textureMask.Ai(),T.customShader=this.customShader,T.preventAutoStart=this.preventAutoStart,T.bg=this.bg.Ai(),this.subEmitters){T.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const q=[];for(const T of b)q.push(T.serialize(J));T.subEmitters.push(q)}}if(this._attractors&&this._attractors.length){T.attractors=[];for(const J of this._attractors)T.attractors.push(J.serialize())}return T}static _Serialize(J,T,b){if(J.name=T.name,J.id=T.id,J.Zh=T.getCapacity(),J.disposeOnStop=T.disposeOnStop,J.manualEmitCount=T.manualEmitCount,T.j.position){const b=T.j;J.emitterId=b.id}else{const b=T.j;J.j=b.Ai()}T.particleEmitterType&&(J.particleEmitterType=T.particleEmitterType.serialize()),T.particleTexture&&(b?J.texture=T.particleTexture.serialize():(J.textureName=T.particleTexture.name,J.invertY=!!T.particleTexture._invertY)),J.isLocal=T.isLocal,e.d.AppendSerializedAnimations(T,J),J.beginAnimationOnStart=T.beginAnimationOnStart,J.beginAnimationFrom=T.beginAnimationFrom,J.beginAnimationTo=T.beginAnimationTo,J.beginAnimationLoop=T.beginAnimationLoop,J.startDelay=T.startDelay,J.renderingGroupId=T.renderingGroupId,J.isBillboardBased=T.isBillboardBased,J.billboardMode=T.billboardMode,J.minAngularSpeed=T.minAngularSpeed,J.maxAngularSpeed=T.maxAngularSpeed,J.minSize=T.minSize,J.maxSize=T.maxSize,J.minScaleX=T.minScaleX,J.maxScaleX=T.maxScaleX,J.minScaleY=T.minScaleY,J.maxScaleY=T.maxScaleY,J.minEmitPower=T.minEmitPower,J.maxEmitPower=T.maxEmitPower,J.minLifeTime=T.minLifeTime,J.maxLifeTime=T.maxLifeTime,J.emitRate=T.emitRate,J.gravity=T.gravity.Ai(),J.noiseStrength=T.noiseStrength.Ai(),J.color1=T.color1.Ai(),J.color2=T.color2.Ai(),J.colorDead=T.colorDead.Ai(),J.updateSpeed=T.updateSpeed,J.targetStopDuration=T.targetStopDuration,J.blendMode=T.blendMode,J.preWarmCycles=T.preWarmCycles,J.preWarmStepOffset=T.preWarmStepOffset,J.minInitialRotation=T.minInitialRotation,J.maxInitialRotation=T.maxInitialRotation,J.startSpriteCellID=T.startSpriteCellID,J.spriteCellLoop=T.spriteCellLoop,J.endSpriteCellID=T.endSpriteCellID,J.spriteCellChangeSpeed=T.spriteCellChangeSpeed,J.spriteCellWidth=T.spriteCellWidth,J.spriteCellHeight=T.spriteCellHeight,J.spriteRandomStartCell=T.spriteRandomStartCell,J.isAnimationSheetEnabled=T.isAnimationSheetEnabled,J.useLogarithmicDepth=T.useLogarithmicDepth;const q=T.getColorGradients();if(q){J.colorGradients=[];for(const T of q){const b={gradient:T.gradient,color1:T.color1.Ai()};T.color2?b.color2=T.color2.Ai():b.color2=T.color1.Ai(),J.colorGradients.push(b)}}const t=T.getRampGradients();if(t){J.rampGradients=[];for(const T of t){const b={gradient:T.gradient,color:T.color.Ai()};J.rampGradients.push(b)}J.useRampGradients=T.useRampGradients}const j=T.getColorRemapGradients();if(j){J.colorRemapGradients=[];for(const T of j){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.colorRemapGradients.push(b)}}const B=T.getAlphaRemapGradients();if(B){J.alphaRemapGradients=[];for(const T of B){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.alphaRemapGradients.push(b)}}const Y=T.getSizeGradients();if(Y){J.sizeGradients=[];for(const T of Y){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.sizeGradients.push(b)}}const C=T.getAngularSpeedGradients();if(C){J.angularSpeedGradients=[];for(const T of C){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.angularSpeedGradients.push(b)}}const F=T.getVelocityGradients();if(F){J.velocityGradients=[];for(const T of F){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.velocityGradients.push(b)}}const A=T.getDragGradients();if(A){J.dragGradients=[];for(const T of A){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.dragGradients.push(b)}}const a=T.getEmitRateGradients();if(a){J.emitRateGradients=[];for(const T of a){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.emitRateGradients.push(b)}}const P=T.getStartSizeGradients();if(P){J.startSizeGradients=[];for(const T of P){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.startSizeGradients.push(b)}}const v=T.getLifeTimeGradients();if(v){J.lifeTimeGradients=[];for(const T of v){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.lifeTimeGradients.push(b)}}const G=T.getLimitVelocityGradients();if(G){J.limitVelocityGradients=[];for(const T of G){const b={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?b.factor2=T.factor2:b.factor2=T.factor1,J.limitVelocityGradients.push(b)}J.limitVelocityDamping=T.limitVelocityDamping}T.noiseTexture&&(J.noiseTexture=T.noiseTexture.serialize())}clone(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q={...this._customWrappers};let t=null;const j=this._engine;if(j.createEffectForParticles&&null!=this.customShader){t=this.customShader;const J=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",T=j.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,J);q[0]?q[0].effect=T:this.setCustomEffect(T,0)}const B=this.serialize(b),Y=YT.Parse(B,this._scene||this._engine,this._rootUrl);return Y.name=J,Y.customShader=t,Y._customWrappers=q,void 0===T&&(T=this.j),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.j=T,this.preventAutoStart||Y.start(),Y}}YT.BILLBOARDMODE_Y=2,YT.BILLBOARDMODE_ALL=7,YT.BILLBOARDMODE_STRETCHED=8,YT.BILLBOARDMODE_STRETCHED_LOCAL=9,nJ._ParseParticleSystem=YT.Parse;var CT=b(2442),FT=b(2440),AT=b(2351);AT.b.prototype.createTransformFeedback=function(){const J=this._gl.createTransformFeedback();if(!J)throw new Error("Unable to create Transform Feedback");return J},AT.b.prototype.deleteTransformFeedback=function(J){this._gl.deleteTransformFeedback(J)},AT.b.prototype.bindTransformFeedback=function(J){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,J)},AT.b.prototype.beginTransformFeedback=function(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(J?this._gl.POINTS:this._gl.TRIANGLES)},AT.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},AT.b.prototype.setTranformFeedbackVaryings=function(J,T){this._gl.transformFeedbackVaryings(J,T,this._gl.INTERLEAVED_ATTRIBS)},AT.b.prototype.bindTransformFeedbackBuffer=function(J){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,J?J.underlyingResource:null)},AT.b.prototype.readTransformFeedbackBuffer=function(J){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,J)};const aT="clipPlaneFragmentDeclaration2",PT="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";o.c.IncludesShadersStore[aT]||(o.c.IncludesShadersStore[aT]=PT);b(12106),b(12110),b(12116),b(12119),b(12126),b(12135),b(12144),b(12149);const vT="gpuRenderParticlesPixelShader",GT="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";o.c.ShadersStore[vT]||(o.c.ShadersStore[vT]=GT);const xT="clipPlaneVertexDeclaration2",IT="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";o.c.IncludesShadersStore[xT]||(o.c.IncludesShadersStore[xT]=IT);b(12154),b(12160),b(12166),b(12170);const uT="gpuRenderParticlesVertexShader",UT="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";o.c.ShadersStore[uT]||(o.c.ShadersStore[uT]=UT);class KT extends C{static get IsSupported(){if(!y.e.LastCreatedEngine)return!1;const J=y.e.LastCreatedEngine.getCaps();return J.supportTransformFeedbacks||J.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(J){this._maxActiveParticleCount=Math.min(J,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(J){this.maxActiveParticleCount=J}createPointEmitter(J,T){const b=fJ(J,T);return this.particleEmitterType=b,b}createHemisphericEmitter(){const J=zJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=J,J}createSphereEmitter(){const J=MJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=J,J}createDirectedSphereEmitter(){const J=yJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0));return this.particleEmitterType=J,J}createCylinderEmitter(){const J=kJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=J,J}createDirectedCylinderEmitter(){const J=JT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.n(0,1,0));return this.particleEmitterType=J,J}createConeEmitter(){const J=TT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=J,J}createDirectedConeEmitter(){const J=bT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.n(0,1,0));return this.particleEmitterType=J,J}createBoxEmitter(J,T,b,q){const t=new a;return this.particleEmitterType=t,this.direction1=J,this.direction2=T,this.minEmitBox=b,this.maxEmitBox=q,t}get flowMap(){return this._flowMap}set flowMap(J){this._flowMap!==J&&(this._flowMap=J)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==YT.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(YT.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(YT.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";J?setTimeout((()=>{this.start(0)}),J):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var J;let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(J=this._customWrappers[T])||void 0===J?void 0:J.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[J]??this._customWrappers[0]}setCustomEffect(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[T]=new JJ.b(this._engine),this._customWrappers[T].effect=J}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(J,T,b){return super._removeGradientAndTexture(J,T,b),this._releaseBuffers(),this}addColorGradient(J,T){this._colorGradients||(this._colorGradients=[]);const b=new R(J,T);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(J&&this._colorGradients.sort(((J,T)=>J.gradient<T.gradient?-1:J.gradient>T.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(J){return this._removeGradientAndTexture(J,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const T in this._drawWrappers){var J;null===(J=this._drawWrappers[T].drawContext)||void 0===J||J.reset()}}_addFactorGradient(J,T,b){const q=new D(T,b);J.push(q),this._releaseBuffers()}addSizeGradient(J,T){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,J,T),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(J){return this._removeGradientAndTexture(J,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(J,T){if(!J)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&J.sort(((J,T)=>J.gradient<T.gradient?-1:J.gradient>T.gradient?1:0));const b=this;b[T]&&(b[T].dispose(),b[T]=null)}addAngularSpeedGradient(J,T){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,J,T),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(J){return this._removeGradientAndTexture(J,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(J,T){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,J,T),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(J){return this._removeGradientAndTexture(J,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(J,T){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,J,T),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(J){return this._removeGradientAndTexture(J,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(J,T){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,J,T),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(J){return this._removeGradientAndTexture(J,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(J){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(J),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ki=new z.b,this.onStoppedObservable=new z.b,this.onStartedObservable=new z.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=q.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||y.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.si.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,Y.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,Y.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new JJ.b(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers={0:new JJ.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(T=T??{}).randomTextureSize||delete T.randomTextureSize;const B={Zh:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...T},C=T;isFinite(C)&&(B.Zh=C),this._capacity=B.Zh,this._maxActiveParticleCount=B.Zh,this._currentActiveCount=0,this._isAnimationSheetEnabled=j,this.particleEmitterType=new a;const F=Math.min(this._engine.getCaps().maxTextureSize,B.randomTextureSize);let A=[];for(let q=0;q<F;++q)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture=new M.e(new Float32Array(A),F,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,A=[];for(let q=0;q<F;++q)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture2=new M.e(new Float32Array(A),F,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=F}_reset(){this._releaseBuffers()}_createVertexBuffers(J,T,b){const q={};q.position=T.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let t=3;q.age=T.createVertexBuffer("age",t,1,this._attributesStrideSize,!0),t+=1,q.size=T.createVertexBuffer("size",t,3,this._attributesStrideSize,!0),t+=3,q.life=T.createVertexBuffer("life",t,1,this._attributesStrideSize,!0),t+=1,t+=4,this.billboardMode===YT.BILLBOARDMODE_STRETCHED&&(q.direction=T.createVertexBuffer("direction",t,3,this._attributesStrideSize,!0)),t+=3,this._platform.alignDataInBuffer&&(t+=1),this.particleEmitterType instanceof E&&(t+=3,this._platform.alignDataInBuffer&&(t+=1)),this._colorGradientsTexture||(q.color=T.createVertexBuffer("color",t,4,this._attributesStrideSize,!0),t+=4),this._isBillboardBased||(q.initialDirection=T.createVertexBuffer("initialDirection",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),this.noiseTexture&&(q.noiseCoordinates1=T.createVertexBuffer("noiseCoordinates1",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1),q.noiseCoordinates2=T.createVertexBuffer("noiseCoordinates2",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),q.angle=T.createVertexBuffer("angle",t,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?t++:t+=2,this._isAnimationSheetEnabled&&(q.cellIndex=T.createVertexBuffer("cellIndex",t,1,this._attributesStrideSize,!0),t+=1,this.spriteRandomStartCell&&(q.cellStartOffset=T.createVertexBuffer("cellStartOffset",t,1,this._attributesStrideSize,!0),t+=1)),q.offset=b.createVertexBuffer("offset",0,2),q.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(q),this._platform.createVertexBuffers(J,q),this.resetDrawCache()}_initialize(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!J)return;const T=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const t=this.particleEmitterType instanceof E,j=q.j.pi[0];let B=0;for(let q=0;q<this._capacity;q++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),t?(this.particleEmitterType.particleDestinationGenerator(q,null,j),b.push(j.x),b.push(j.y),b.push(j.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),B+=16,t&&(this.particleEmitterType.particlePositionGenerator(q,null,j),b.push(j.x),b.push(j.y),b.push(j.z),this._platform.alignDataInBuffer&&b.push(0),B+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),B+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),B+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),B+=8),b.push(0),B+=1,this._angularSpeedGradientsTexture||(b.push(0),B+=1),this._isAnimationSheetEnabled&&(b.push(0),B+=1,this.spriteRandomStartCell&&(b.push(0),B+=1)),this._platform.alignDataInBuffer){let J=3-(B+3&3);for(B+=J;J-- >0;)b.push(0)}const Y=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(b),F=this._platform.createParticleBuffer(b);this._buffer0=new l.c(T,C,!1,this._attributesStrideSize),this._buffer1=new l.c(T,F,!1,this._attributesStrideSize),this._spriteBuffer=new l.c(T,Y,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let J=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(J+="\n#define BILLBOARD"),this._colorGradientsTexture&&(J+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(J+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(J+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(J+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(J+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(J+="\n#define DRAGGRADIENTS"),this._flowMap&&(J+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(J+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(J+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(J+="\n#define NOISE"),this.isLocal&&(J+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===J||(this._cachedUpdateDefines=J,this._updateBuffer=this._platform.createUpdateBuffer(J)),this._platform.isUpdateBufferReady()}_getWrapper(J){const T=this._getCustomDrawWrapper(J);if(null!==T&&void 0!==T&&T.effect)return T;const b=[];this.fillDefines(b,J);let q=this._drawWrappers[J];q||(q=new JJ.b(this._engine),q.drawContext&&(q.drawContext.useInstancing=!0),this._drawWrappers[J]=q);const t=b.join("\n");if(q.defines!==t){const J=[],T=[],b=[];this.fillUniformsAttributesAndSamplerNames(T,J,b),q.setEffect(this._engine.createEffect("gpuRenderParticles",J,T,b,t),t)}return q}static _GetAttributeNamesOrOptions(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=[l.e.PositionKind,"age","life","size","angle"];return J||t.push(l.e.ColorKind),T&&t.push("cellIndex"),b||t.push("initialDirection"),q&&t.push("direction"),t.push("offset",l.e.UVKind),t}static _GetEffectCreationOptions(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=["emitterWM","bg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,TJ.e)(q),J&&q.push("sheetInfos"),T&&q.push("logarithmicDepthConstant"),b&&(q.push("vFogInfos"),q.push("vFogColor")),q}fillDefines(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,TJ.o)(this,this._scene,J),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==FT.b.FOGMODE_NONE&&J.push("#define FOG")),T===YT.BLENDMODE_MULTIPLY&&J.push("#define BLENDMULTIPLYMODE"),this.isLocal&&J.push("#define LOCAL"),this.useLogarithmicDepth&&J.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(J.push("#define BILLBOARD"),this.billboardMode){case YT.BILLBOARDMODE_Y:J.push("#define BILLBOARDY");break;case YT.BILLBOARDMODE_STRETCHED:J.push("#define BILLBOARDSTRETCHED");break;case YT.BILLBOARDMODE_ALL:J.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&J.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&J.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),J.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(J,T,b){T.push(...KT._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===YT.BILLBOARDMODE_STRETCHED)),J.push(...KT._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(CT.b.PrepareUniforms(J,this._imageProcessingConfigurationDefines),CT.b.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var J;let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(T?this.preWarmStepOffset:(null===(J=this._scene)||void 0===J?void 0:J.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(J,T){const b=this[T];if(!J||!J.length||b)return;const q=new Float32Array(this._rawTextureWidth);for(let t=0;t<this._rawTextureWidth;t++){const T=t/this._rawTextureWidth;f.GetCurrentGradient(T,J,((J,T,b)=>{q[t]=(0,F.m)(J.factor1,T.factor1,b)}))}this[T]=M.e.CreateRTexture(q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[T].name=T.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const J=new Uint8Array(4*this._rawTextureWidth),T=B.g.Wi[0];for(let b=0;b<this._rawTextureWidth;b++){const q=b/this._rawTextureWidth;f.GetCurrentGradient(q,this._colorGradients,((q,t,j)=>{B.d.LerpToRef(q.color1,t.color1,j,T),J[4*b]=255*T.r,J[4*b+1]=255*T.g,J[4*b+2]=255*T.b,J[4*b+3]=255*T.a}))}this._colorGradientsTexture=M.e.CreateRGBATexture(J,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(J,T){var b,t,j,B;const Y=this._getWrapper(J),C=Y.effect;this._engine.enableEffect(Y);const F=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||q.e.IdentityReadOnly;if(C.setMatrix("view",F),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("bg",this.bg),this.isLocal&&C.setMatrix("emitterWM",T),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const J=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/J.width,this.spriteCellHeight/J.height,J.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const J=this._scene.activeCamera;C.setVector3("eyePosition",J.globalPosition)}const A=C.defines;if(this._scene&&((0,TJ.h)(C,this,this._scene),this.applyFog&&(0,bJ.c)(this._scene,void 0,C)),A.indexOf("#define BILLBOARDMODE_ALL")>=0){const J=F.clone();J.invert(),C.setMatrix("invView",J)}return this.useLogarithmicDepth&&this._scene&&(0,bJ.j)(A,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(J),this._platform.bindDrawBuffers(this._targetIndex,C,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(J){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!J)if(this.j.position){J=this.j.getWorldMatrix()}else{const T=this.j;J=q.j.Matrix[0],q.e.TranslationToRef(T.x,T.y,T.z,J)}const T=this._engine,b=T.getDepthWrite();if(T.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const J=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",J.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",J),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const t=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=t,T.setDepthWrite(b)}render(){let J,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!T&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let J=0;J<this.preWarmCycles;J++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const J=0|this._accumulatedCount;this._accumulatedCount-=J,this._currentActiveCount+=J}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){J=this.j.getWorldMatrix()}else{const T=this.j;J=q.j.Matrix[0],q.e.TranslationToRef(T.x,T.y,T.z,J)}const t=this._engine;this.updateInAnimate||this._update(J);let j=0;return T||b||(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0),j=this.blendMode===YT.BLENDMODE_MULTIPLYADD?this._render(YT.BLENDMODE_MULTIPLY,J)+this._render(YT.BLENDMODE_ADD,J):this._render(this.blendMode,J),this._engine.setAlphaMode(0)),j}rebuild(){const J=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(J,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,J()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const T in this._drawWrappers){this._drawWrappers[T].dispose()}if(this._drawWrappers={},this._scene){const J=this._scene.si.indexOf(this);J>-1&&this._scene.si.splice(J,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let T=0;T<this._renderVertexBuffers.length;++T){const J=this._renderVertexBuffers[T];for(const T in J)J[T].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),J&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),J&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ki.notifyObservers(this),this.Ki.clear()}clone(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q={...this._customWrappers};let t=null;const j=this._engine;if(j.createEffectForParticles&&null!=this.customShader){t=this.customShader;const J=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";q[0]=j.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,J,void 0,void 0,void 0,this)}const B=this.serialize(b),Y=KT.Parse(B,this._scene||this._engine,this._rootUrl);return Y.name=J,Y.customShader=t,Y._customWrappers=q,void 0===T&&(T=this.j),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.j=T,Y}serialize(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={};return YT._Serialize(T,this,J),T.activeParticleCount=this.activeParticleCount,T.randomTextureSize=this._randomTextureSize,T.customShader=this.customShader,T}static Parse(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const j=J.name;let B,Y;T instanceof DJ.b?B=T:(Y=T,B=Y.getEngine());const C=new KT(j,{Zh:t||J.Zh,randomTextureSize:J.randomTextureSize},T,null,J.isAnimationSheetEnabled);if(C._rootUrl=b,J.customShader&&B.createEffectForParticles){const T=J.customShader,b=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"",q=B.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,b,void 0,void 0,void 0,C);C.setCustomEffect(q,0),C.customShader=T}return J.id&&(C.id=J.id),J.activeParticleCount&&(C.activeParticleCount=J.activeParticleCount),YT._Parse(J,C,T,b),J.preventAutoStart&&(C.preventAutoStart=J.preventAutoStart),q||C.preventAutoStart||C.start(),C}}var ET=b(505),lT=b(12172),WT=b(11983);class pT{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(J){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const T of this.systems)T.j=J;this._emitterNode=J}setEmitterAsSphere(J,T,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:J,renderingGroupId:T};const q=(0,lT.b)("emitterSphere",{diameter:J.diameter,segments:J.segments},b);q.renderingGroupId=T;const t=new WT.c("emitterSphereMaterial",b);t.emissiveColor=J.color,q.material=t;for(const j of this.systems)j.j=q;this._emitterNode=q}start(J){for(const T of this.systems)J&&(T.j=J),T.start()}dispose(){for(const J of this.systems)J.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={systems:[]};for(const b of this.systems)T.systems.push(b.serialize(J));return this._emitterNode&&(T.j=this._emitterCreationOptions),T}static Parse(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;const t=new pT,j=this.BaseAssetsUrl+"/textures/";T=T||y.e.LastCreatedScene;for(const B of J.systems)t.systems.push(b?KT.Parse(B,T,j,!0,q):YT.Parse(B,T,j,!0,q));if(J.j){const b=J.j.options;if("Sphere"===J.j.kind)t.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:B.b.ni(b.color)},J.j.renderingGroupId,T)}return t}}pT.BaseAssetsUrl="https://assets.babylonjs.com/particles";var oT=b(542);class ST{static CreateDefault(J){let T,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,q=arguments.length>2?arguments[2]:void 0;T=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new KT("default system",{Zh:b},q):new YT("default system",b,q),T.j=J;const t=ET.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return T.particleTexture=new c.b(t,T.va()),T.createConeEmitter(.1,Math.PI/4),T.color1=new B.d(1,1,1,1),T.color2=new B.d(1,1,1,1),T.colorDead=new B.d(1,1,1,0),T.minSize=.1,T.maxSize=.1,T.minEmitPower=2,T.maxEmitPower=2,T.updateSpeed=1/60,T.emitRate=30,T}static CreateAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;T||(T=y.e.LastCreatedScene);const t={};return T.addPendingData(t),new Promise(((j,B)=>{if(b&&!KT.IsSupported)return T.removePendingData(t),B("Particle system with GPU is not supported.");ET.e.LoadFile(`${ST.BaseAssetsUrl}/systems/${J}.json`,(J=>{T.removePendingData(t);const B=JSON.parse(J.toString());return j(pT.Parse(B,T,b,q))}),void 0,void 0,void 0,(()=>(T.removePendingData(t),B(`An error occurred with the creation of your particle system. Check if your type '${J}' exists.`))))}))}static ExportSet(J){const T=new pT;for(const b of J)T.systems.push(b);return T}static ParseFromFileAsync(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",j=arguments.length>5?arguments[5]:void 0;return new Promise(((B,Y)=>{const C=new oT.b;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const T=JSON.parse(C.responseText);let Y;Y=q?KT.Parse(T,b,t,!1,j):YT.Parse(T,b,t,!1,j),J&&(Y.name=J),B(Y)}else Y("Unable to load the particle system")})),C.open("GET",T),C.send()}))}static ParseFromSnippetAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0;if("_BLANK"===J){const J=this.CreateDefault(null);return J.start(),Promise.resolve(J)}return new Promise(((j,B)=>{const Y=new oT.b;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const B=JSON.parse(JSON.parse(Y.responseText).jsonPayload),C=JSON.parse(B.particleSystem);let F;F=b?KT.Parse(C,T,q,!1,t):YT.Parse(C,T,q,!1,t),F.snippetId=J,j(F)}else B("Unable to load the snippet "+J)})),Y.open("GET",this.SnippetUrl+"/"+J.replace(/#/g,"/")),Y.send()}))}}ST.BaseAssetsUrl=pT.BaseAssetsUrl,ST.SnippetUrl="https://snippet.babylonjs.com",ST.CreateFromSnippetAsync=ST.ParseFromSnippetAsync;var HT=b(494),sT=b(884),gT=b(12174);(0,gT.f)(sT.e.NAME_PARTICLESYSTEM,((J,T,b,q)=>{const t=(0,gT.j)(sT.e.NAME_PARTICLESYSTEM);if(t&&void 0!==J.si&&null!==J.si)for(let j=0,B=J.si.length;j<B;j++){const B=J.si[j];b.si.push(t(B,T,q))}})),(0,gT.d)(sT.e.NAME_PARTICLESYSTEM,((J,T,b)=>{if(J.activeParticleCount){return KT.Parse(J,T,b)}return YT.Parse(J,T,b)})),DJ.b.prototype.createEffectForParticles=function(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",j=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,a=[],P=[];const v=[];return C?C.fillUniformsAttributesAndSamplerNames(P,a,v):(a=YT._GetAttributeNamesOrOptions(),P=YT._GetEffectCreationOptions()),-1===t.indexOf(" BILLBOARD")&&(t+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===t.indexOf(" ANIMATESHEET")&&(t+="\n#define ANIMATESHEET\n"),-1===q.indexOf("diffuseSampler")&&q.push("diffuseSampler"),this.createEffect({vertex:A??(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:J},a,P.concat(T),v.concat(q),t,j,B,Y,void 0,F,(async()=>{0===F?await Promise.resolve().then(b.bind(b,12204)):await Promise.resolve().then(b.bind(b,12278))}))},HT.e.prototype.getEmittedParticleSystems=function(){const J=[];for(let T=0;T<this.va().si.length;T++){const b=this.va().si[T];b.j===this&&J.push(b)}return J},HT.e.prototype.getHierarchyEmittedParticleSystems=function(){const J=[],T=this.getDescendants();T.push(this);for(let b=0;b<this.va().si.length;b++){const q=this.va().si[b],t=q.j;t.position&&-1!==T.indexOf(t)&&J.push(q)}return J};b(789),b(797),b(834);b(768),b(889),b(848),b(776),b(878);b(2286);var dT;b(12176),b(2323);!function(J){J[J.Color=2]="Color",J[J.UV=1]="UV",J[J.Random=0]="Random",J[J.Stated=3]="Stated"}(dT||(dT={}));var wT=b(2317);const ZT=new q.n(0,0,0),eT=new q.n(0,0,0),cT=new q.n(0,0,0);class VT{constructor(J,T,b){this.width=J,this.height=T,this.data=b}processFlowable(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;if(!b)return;b instanceof q.e?q.n.TransformCoordinatesToRef(J.position,b,cT):(cT.x=b.x,cT.y=b.y,cT.z=b.z);const t=.5*cT.x+.5,j=1-(.5*cT.y+.5),B=Math.floor(t*this.width),Y=Math.floor(j*this.height);if(B<0||B>=this.width||Y<0||Y>=this.height)return;const C=4*(Y*this.width+B),F=this.data[C]/255*2-1,A=this.data[C+1]/255*2-1,a=this.data[C+2]/255*2-1,P=this.data[C+3]/255;ZT.set(F,A,a),ZT.scaleToRef(T*P,eT),J.direction.addInPlace(eT)}_processParticle(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;this.processFlowable(J,T,b)}static async FromUrlAsync(J){return await new Promise(((T,b)=>{const q=document.createElement("canvas"),t=q.getContext("2d");let j=null;const B=new Image;B.crossOrigin="anonymous",B.src=J,B.onerror=T=>{b(new Error(`Failed to load image: ${J} : ${T}`))},B.onload=()=>{q.width=B.width,q.height=B.height,t.drawImage(B,0,0),j=t.getImageData(0,0,q.width,q.height),T(new VT(q.width,q.height,j.data))}}))}static async ExtractFromTextureAsync(J){return await new Promise(((T,b)=>{if(!J.isReady())return void J.onLoadObservable.addOnce((async()=>{try{const b=await this.ExtractFromTextureAsync(J);T(b)}catch(q){b(q)}}));const q=J.getSize();wT.k.GetTextureDataAsync(J,q.width,q.height).then((J=>{T(new VT(q.width,q.height,new Uint8ClampedArray(J)))})).catch(b)}))}}var QT,hT,iT,mT,OT,XT,LT,rT,NT;!function(J){J[J.Int=1]="Int",J[J.Float=2]="Float",J[J.Vector2=4]="Vector2",J[J.pi=8]="pi",J[J.Matrix=16]="Matrix",J[J.Particle=32]="Particle",J[J.Texture=64]="Texture",J[J.Wi=128]="Wi",J[J.FloatGradient=256]="FloatGradient",J[J.Vector2Gradient=512]="Vector2Gradient",J[J.Vector3Gradient=1024]="Vector3Gradient",J[J.Color4Gradient=2048]="Color4Gradient",J[J.System=4096]="System",J[J.AutoDetect=8192]="AutoDetect",J[J.BasedOnInput=16384]="BasedOnInput",J[J.Undefined=32768]="Undefined",J[J.All=65535]="All"}(QT||(QT={})),function(J){J[J.Compatible=0]="Compatible",J[J.TypeIncompatible=1]="TypeIncompatible",J[J.HierarchyIssue=2]="HierarchyIssue"}(hT||(hT={})),function(J){J[J.Input=0]="Input",J[J.Output=1]="Output"}(iT||(iT={}));class RT{get direction(){return this._direction}get type(){if(this._type===QT.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===QT.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(J){this._type=J}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((J=>J.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(J,T,b){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=QT.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new z.b,this.onDisconnectionObservable=new z.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=T,this.name=J,this._direction=b}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(J){var T;return this.isConnected?null!==(T=this._connectedPoint)&&void 0!==T&&T._storedFunction?this._connectedPoint._storedFunction(J):this._connectedPoint._storedValue:this.value}canConnectTo(J){return 0===this.checkCompatibilityState(J)}checkCompatibilityState(J){const T=this._ownerBlock,b=J.ownerBlock;if(this.type!==J.type&&J.innerType!==QT.AutoDetect)return J.acceptedConnectionPointTypes&&-1!==J.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(J.excludedConnectionPointTypes&&-1!==J.excludedConnectionPointTypes.indexOf(this.type))return 1;let q=b,t=T;return 0===this.direction&&(q=T,t=b),q.isAnAncestorOf(t)?2:0}connectTo(J){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(J))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${J.ownerBlock.name}".${J.name}`;return this._endpoints.push(J),J._connectedPoint=this,this.onConnectionObservable.notifyObservers(J),J.onConnectionObservable.notifyObservers(this),this}disconnectFrom(J){const T=this._endpoints.indexOf(J);return-1===T||(this._endpoints.splice(T,1),J._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(J),J.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(J){let T=1;for(;T<QT.All;)J&T||this.excludedConnectionPointTypes.push(T),T<<=1}serialize(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const T={};return T.name=this.name,T.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ai?(T.valueType="BABYLON."+this.value.getClassName(),T.value=this.value.Ai()):(T.valueType="number",T.value=this.value)),J&&this.connectedPoint&&(T.inputName=this.name,T.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,T.targetConnectionName=this.connectedPoint.name,T.isExposedOnFrame=!0,T.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(T.isExposedOnFrame=!0,T.exposedPortPosition=this.exposedPortPosition),T}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class nT{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(J){this._name=J}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(J){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new z.b,this.Ki=new z.b,this.onInputChangedObservable=new z.b,this.visibleOnFrame=!1,this._name=J,this.uniqueId=V.e.UniqueId}_inputRename(J){return J}_outputRename(J){return J}isAnAncestorOf(J){for(const T of this._outputs)if(T.hasEndpoints)for(const b of T.endpoints){if(b.ownerBlock===J)return!0;if(b.ownerBlock.isAnAncestorOf(J))return!0}return!1}isAnAncestorOfType(J){if(this.getClassName()===J)return!0;for(const T of this._outputs)if(T.hasEndpoints)for(const b of T.endpoints)if(b.ownerBlock.isAnAncestorOfType(J))return!0;return!1}getInputByName(J){const T=this._inputs.filter((T=>T.name===J));return T.length?T[0]:null}_linkConnectionTypes(J,T){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[T]._acceptedConnectionPointType=this._inputs[J]:(this._inputs[J]._linkedConnectionSource=this._inputs[T],this._inputs[J]._isMainLinkSource=!0),this._inputs[T]._linkedConnectionSource=this._inputs[J]}registerInput(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0;const B=new RT(J,this,0);return B.type=T,B.isOptional=b,B.defaultValue=q,B.value=q,B.valueMin=t,B.valueMax=j,this._inputs.push(B),this.onInputChangedObservable.notifyObservers(B),this}registerOutput(J,T,b){return(b=b??new RT(J,this,1)).type=T,this._outputs.push(b),this}_build(J){}_customBuildStep(J){}build(J){if(this._buildId===J.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((J=>J.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=J.buildId;for(const T of this._inputs){if(!T.connectedPoint){T.isOptional||J.notConnectedNonOptionalInputs.push(T);continue}const b=T.connectedPoint.ownerBlock;b&&b!==this&&!b.isSystem&&b.build(J)}return this._customBuildStep(J),J.verbose&&Q.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(J),this.onBuildObservable.notifyObservers(this),!1}serialize(){const J={};J.customType="BABYLON."+this.getClassName(),J.id=this.uniqueId,J.name=this.name,J.visibleOnFrame=this.visibleOnFrame,J.inputs=[],J.outputs=[];for(const T of this.inputs)J.inputs.push(T.serialize());for(const T of this.outputs)J.outputs.push(T.serialize(!1));return J}_deserialize(J){this._name=J.name,this.comments=J.comments,this.visibleOnFrame=!!J.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(J)}_deserializePortDisplayNamesAndExposedOnFrame(J){const T=J.inputs,b=J.outputs;if(T)for(const q of T){const J=this.inputs.find((J=>J.name===q.name));if(!J)return;if(q.displayName&&(J.displayName=q.displayName),q.isExposedOnFrame&&(J.isExposedOnFrame=q.isExposedOnFrame,J.exposedPortPosition=q.exposedPortPosition),void 0!==q.value&&null!==q.value)if("number"===q.valueType)J.value=q.value;else{const T=(0,Y.c)(q.valueType);T&&(J.value=T.ni(q.value))}}if(b)for(let q=0;q<b.length;q++){const J=b[q];J.displayName&&(this.outputs[q].displayName=J.displayName),J.isExposedOnFrame&&(this.outputs[q].isExposedOnFrame=J.isExposedOnFrame,this.outputs[q].exposedPortPosition=J.exposedPortPosition)}}clone(){const J=this.serialize(),T=(0,Y.c)(J.customType);if(T){const b=new T;return b._deserialize(J),b}return null}dispose(){this.Ki.notifyObservers(this),this.Ki.clear();for(const J of this.inputs)J.dispose();for(const J of this.outputs)J.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function DT(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",q=arguments.length>3?arguments[3]:void 0;return(t,j)=>{let B=t._propStore;B||(B=[],t._propStore=B),B.push({propertyName:j,displayName:J,type:T,groupName:b,options:q??{},className:t.getClassName()})}}(0,w.e)([(0,Z.M)("comment")],nT.prototype,"comments",void 0),function(J){J[J.Boolean=0]="Boolean",J[J.Float=1]="Float",J[J.Int=2]="Int",J[J.Vector2=3]="Vector2",J[J.List=4]="List",J[J.Wi=5]="Wi",J[J.SamplingMode=6]="SamplingMode",J[J.TextureFormat=7]="TextureFormat",J[J.TextureType=8]="TextureType"}(mT||(mT={})),function(J){J[J.None=0]="None",J[J.Position=1]="Position",J[J.Direction=2]="Direction",J[J.Age=3]="Age",J[J.Lifetime=4]="Lifetime",J[J.Color=5]="Color",J[J.ScaledDirection=6]="ScaledDirection",J[J.Scale=7]="Scale",J[J.AgeGradient=8]="AgeGradient",J[J.Angle=9]="Angle",J[J.SpriteCellIndex=16]="SpriteCellIndex",J[J.SpriteCellStart=17]="SpriteCellStart",J[J.SpriteCellEnd=18]="SpriteCellEnd"}(OT||(OT={})),function(J){J[J.None=0]="None",J[J.Time=1]="Time",J[J.Delta=2]="Delta",J[J.Emitter=3]="Emitter"}(XT||(XT={}));class fT{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let J="";for(const T of this.notConnectedNonOptionalInputs)J+=`input ${T.name} from block ${T.ownerBlock.name}[${T.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(J)throw"Build of Node Particle System Set failed:\n"+J}adapt(J,T){const b=J.getConnectedValue(this)||0;if(J.type===T)return b;switch(T){case QT.Vector2:return new q.k(b,b);case QT.pi:return new q.n(b,b,b);case QT.Wi:return new B.d(b,b,b,b)}return null}getContextualValue(J){if(!this.particleContext||!this.systemContext)return null;switch(J){case OT.Position:return this.particleContext.position;case OT.Direction:return this.particleContext.direction;case OT.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case OT.Color:return this.particleContext.color;case OT.Age:return this.particleContext.age;case OT.Lifetime:return this.particleContext.lifeTime;case OT.Angle:return this.particleContext.angle;case OT.Scale:return this.particleContext.scale;case OT.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case OT.SpriteCellEnd:return this.systemContext.endSpriteCellID;case OT.SpriteCellIndex:return this.particleContext.cellIndex;case OT.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(J){if(!this.particleContext||!this.systemContext)return null;switch(J){case XT.Time:return this.systemContext._actualFrame;case XT.Delta:return this.systemContext._scaledUpdateSpeed;case XT.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function zT(J,T,b){const q=new fT;q.cg=T;const t=J.createSystem(q);return t.canStart=()=>!0,t.j=b.clone(),t.disposeOnStop=!0,t.start(),t}class MT extends nT{constructor(J){super(J),this.blendMode=C.BLENDMODE_ONEONE,this.Zh=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",QT.Particle),this.registerInput("texture",QT.Texture),this.registerInput("onStart",QT.System,!0),this.registerInput("onEnd",QT.System,!0),this.registerOutput("system",QT.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(J){J.Zh=this.Zh,J.buildId=this._buildId++,this.build(J);const T=this.particle.getConnectedValue(J);return T.particleTexture=this.texture.getConnectedValue(J),T.emitRate=this.emitRate,T.blendMode=this.blendMode,T.name=this.name,T._nodeGenerated=!0,T._targetStopDuration=this.targetStopDuration,T.startDelay=this.startDelay,this.system._storedValue=this,T.canStart=()=>!this.doNoStart,T.onStartedObservable.add((b=>{const q=this.onStart.getConnectedValue(J);q&&b.onStartedObservable.addOnce((()=>{J.systemContext=T;const b=zT(q,J.cg,J.emitterPosition);this.Ki.addOnce((()=>{b.dispose()}))}));const t=this.onEnd.getConnectedValue(J);t&&b.onStoppedObservable.addOnce((()=>{J.systemContext=T;const b=zT(t,J.cg,J.emitterPosition);this.Ki.addOnce((()=>{b.dispose()}))}))})),this.Ki.addOnce((()=>{T.dispose()})),T}serialize(){const J=super.serialize();return J.Zh=this.Zh,J.emitRate=this.emitRate,J.blendMode=this.blendMode,J.doNoStart=this.doNoStart,J.targetStopDuration=this.targetStopDuration,J.startDelay=this.startDelay,J}_deserialize(J){super._deserialize(J),this.Zh=J.Zh,this.emitRate=J.emitRate,this.doNoStart=!!J.doNoStart,void 0!==J.blendMode&&(this.blendMode=J.blendMode),void 0!==J.targetStopDuration&&(this.targetStopDuration=J.targetStopDuration),void 0!==J.startDelay&&(this.startDelay=J.startDelay)}}(0,w.e)([DT("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:C.BLENDMODE_ONEONE},{label:"Standard",value:C.BLENDMODE_STANDARD},{label:"Add",value:C.BLENDMODE_ADD},{label:"Multiply",value:C.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:C.BLENDMODE_MULTIPLYADD}]})],MT.prototype,"blendMode",void 0),(0,w.e)([DT("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],MT.prototype,"Zh",void 0),(0,w.e)([DT("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MT.prototype,"emitRate",void 0),(0,w.e)([DT("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MT.prototype,"targetStopDuration",void 0),(0,w.e)([DT("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],MT.prototype,"startDelay",void 0),(0,w.e)([DT("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],MT.prototype,"doNoStart",void 0),(0,Y.g)("BABYLON.SystemBlock",MT);class yT extends nT{get type(){if(this._type===QT.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=QT.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=QT.Vector2,this._type;case"pi":return this._type=QT.pi,this._type;case"Wi":return this._type=QT.Wi,this._type;case"Matrix":return this._type=QT.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===OT.None&&this._systemSource!==XT.None}get systemSource(){return this._systemSource}set systemSource(J){if(this._systemSource=J,J!==XT.None){switch(this._contextualSource=OT.None,this._type=QT.Float,J){case XT.Time:case XT.Delta:this._type=QT.Float;break;case XT.Emitter:this._type=QT.pi}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==OT.None}get contextualValue(){return this._contextualSource}set contextualValue(J){if(this._contextualSource=J,J!==OT.None){switch(this._systemSource=XT.None,J){case OT.Scale:this._type=QT.Vector2;break;case OT.Position:case OT.Direction:case OT.ScaledDirection:this._type=QT.pi;break;case OT.Color:this._type=QT.Wi;break;case OT.Age:case OT.Lifetime:case OT.Angle:case OT.AgeGradient:this._type=QT.Float;break;case OT.SpriteCellEnd:case OT.SpriteCellStart:case OT.SpriteCellIndex:this._type=QT.Int}this.output&&(this.output.type=this._type)}}constructor(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:QT.AutoDetect;super(J),this._type=QT.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new z.b,this._systemSource=XT.None,this._contextualSource=OT.None,this._type=T,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",T)}get value(){return this._storedValue}set value(J){this.type===QT.Float&&this.min!==this.max&&(J=Math.max(this.min,J),J=Math.min(this.max,J)),this._storedValue=J,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(J){this._valueCallback=J}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case QT.Int:case QT.Float:this.value=0;break;case QT.Vector2:this.value=q.k.Zero();break;case QT.pi:this.value=q.n.Zero();break;case QT.Wi:this.value=new B.d(1,1,1,1);break;case QT.Matrix:this.value=q.e.Identity()}}_build(J){super._build(J),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=J=>J.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=J=>J.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const J=super.serialize();return J.type=this.type,J.contextualValue=this.contextualValue,J.systemSource=this.systemSource,J.min=this.min,J.max=this.max,J.groupInInspector=this.groupInInspector,J.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ai?(J.valueType="BABYLON."+this._storedValue.getClassName(),J.value=this._storedValue.Ai()):(J.valueType="number",J.value=this._storedValue)),J}_deserialize(J){if(super._deserialize(J),this._type=J.type,this.contextualValue=J.contextualValue,this.systemSource=J.systemSource||XT.None,this.min=J.min||0,this.max=J.max||0,this.groupInInspector=J.groupInInspector||"",void 0!==J.displayInInspector&&(this.displayInInspector=J.displayInInspector),J.valueType)if("number"===J.valueType)this._storedValue=J.value;else{const T=(0,Y.c)(J.valueType);T&&(this._storedValue=T.ni(J.value))}}}(0,Y.g)("BABYLON.ParticleInputBlock",yT);class kT extends nT{get url(){return this._url}set url(J){this._url!==J&&(this._cachedData=null,this._url=J,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(J){this._textureDataUrl!==J&&(this._cachedData=null,this._textureDataUrl=J,this._url="",this._sourceTexture=null)}set sourceTexture(J){this._sourceTexture!==J&&(this._cachedData=null,this._sourceTexture=J,this._url="",this._textureDataUrl="")}constructor(J){super(J),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",QT.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const J=this.texture._storedValue;return await new Promise(((T,b)=>{if(!J.isReady())return void J.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),T(this._cachedData)}catch(J){b(J)}}));const q=J.getSize();wT.k.GetTextureDataAsync(J,q.width,q.height).then((b=>{this._cachedData={width:q.width,height:q.height,data:new Uint8ClampedArray(b)},J.dispose(),T(this._cachedData)})).catch(b)}))}_build(J){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new c.b(this._textureDataUrl,J.cg):this.texture._storedValue=new c.b(this._url,J.cg):this.texture._storedValue=null}serialize(){const J=super.serialize();return J.url=this.url,J.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(J.textureDataUrl=this.textureDataUrl),J}_deserialize(J){super._deserialize(J),this.url=J.url,this.serializedCachedData=!!J.serializedCachedData,J.textureDataUrl&&(this.textureDataUrl=J.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,Y.g)("BABYLON.ParticleTextureSourceBlock",kT);class Jb extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("position",QT.pi),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(J){const T=this.particle.getConnectedValue(J);if(this.output._storedValue=T,!this.position.isConnected)return;const b={process:b=>{J.particleContext=b,J.systemContext=T,b.position.p(this.position.getConnectedValue(J))},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b}}(0,Y.g)("BABYLON.UpdatePositionBlock",Jb),function(J){J[J.Add=0]="Add",J[J.Subtract=1]="Subtract",J[J.Multiply=2]="Multiply",J[J.Divide=3]="Divide",J[J.Max=4]="Max",J[J.Min=5]="Min"}(LT||(LT={}));class Tb extends nT{constructor(J){super(J),this.operation=LT.Add,this.registerInput("left",QT.AutoDetect),this.registerInput("right",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this.output._typeConnectionSource=this.left;const T=[QT.Matrix,QT.Particle,QT.Texture,QT.System,QT.FloatGradient,QT.Color4Gradient,QT.Vector2Gradient,QT.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...T),this.right.excludedConnectionPointTypes.push(...T),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(J){let T;const b=this.left,t=this.right;if(!b.isConnected||!t.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const j=b.type===QT.Float||b.type===QT.Int,Y=t.type===QT.Float||t.type===QT.Int,C=j&&Y;switch(this.operation){case LT.Add:T=C?J=>b.getConnectedValue(J)+t.getConnectedValue(J):j?J=>J.adapt(b,t.type).add(t.getConnectedValue(J)):J=>b.getConnectedValue(J).add(J.adapt(t,b.type));break;case LT.Subtract:T=C?J=>b.getConnectedValue(J)-t.getConnectedValue(J):j?J=>J.adapt(b,t.type).Jg(t.getConnectedValue(J)):J=>b.getConnectedValue(J).Jg(J.adapt(t,b.type));break;case LT.Multiply:T=C?J=>b.getConnectedValue(J)*t.getConnectedValue(J):j?J=>J.adapt(b,t.type).multiply(t.getConnectedValue(J)):J=>b.getConnectedValue(J).multiply(J.adapt(t,b.type));break;case LT.Divide:T=C?J=>b.getConnectedValue(J)/t.getConnectedValue(J):j?J=>J.adapt(b,t.type).divide(t.getConnectedValue(J)):J=>b.getConnectedValue(J).divide(J.adapt(t,b.type));break;case LT.Min:if(C)T=J=>Math.min(b.getConnectedValue(J),t.getConnectedValue(J));else{const[J,Y]=j?[t,b]:[b,t];switch(J.type){case QT.Vector2:T=T=>q.k.Minimize(J.getConnectedValue(T),T.adapt(Y,J.type));break;case QT.pi:T=T=>q.n.Minimize(J.getConnectedValue(T),T.adapt(Y,J.type));break;case QT.Wi:T=T=>{const b=J.getConnectedValue(T),{r:q,g:t,b:j,a:C}=T.adapt(Y,J.type);return new B.d(Math.min(b.r,q),Math.min(b.g,t),Math.min(b.b,j),Math.min(b.a,C))}}}break;case LT.Max:if(!C){const[J,Y]=j?[t,b]:[b,t];switch(J.type){case QT.Vector2:T=T=>q.k.Maximize(J.getConnectedValue(T),T.adapt(Y,J.type));break;case QT.pi:T=T=>q.n.Maximize(J.getConnectedValue(T),T.adapt(Y,J.type));break;case QT.Wi:T=T=>{const b=J.getConnectedValue(T),{r:q,g:t,b:j,a:C}=T.adapt(Y,J.type);return new B.d(Math.max(b.r,q),Math.min(b.g,t),Math.min(b.b,j),Math.min(b.a,C))}}break}T=J=>Math.max(b.getConnectedValue(J),t.getConnectedValue(J))}this.output._storedFunction=J=>b.type===QT.Int?0|T(J):T(J)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===QT.Int||this.left.type===QT.Float&&this.right.type!==QT.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[J,T]of[[this.left,this.right],[this.right,this.left]])J.acceptedConnectionPointTypes=[QT.Int,QT.Float],T.isConnected&&(J.acceptedConnectionPointTypes.push(T.type),T.type!==QT.Int&&T.type!==QT.Float||J.acceptedConnectionPointTypes.push(QT.Vector2,QT.pi,QT.Wi))}dispose(){super.dispose();for(const J of this._connectionObservers)J.remove();this._connectionObservers.length=0}serialize(){const J=super.serialize();return J.operation=this.operation,J}_deserialize(J){super._deserialize(J),this.operation=J.operation}}(0,w.e)([DT("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:LT.Add},{label:"Subtract",value:LT.Subtract},{label:"Multiply",value:LT.Multiply},{label:"Divide",value:LT.Divide},{label:"Max",value:LT.Max},{label:"Min",value:LT.Min}]})],Tb.prototype,"operation",void 0),(0,Y.g)("BABYLON.ParticleMathBlock",Tb);class bb extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("direction1",QT.pi,!0,new q.n(0,1,0)),this.registerInput("direction2",QT.pi,!0,new q.n(0,1,0)),this.registerInput("minEmitBox",QT.pi,!0,new q.n(-.5,-.5,-.5)),this.registerInput("maxEmitBox",QT.pi,!0,new q.n(.5,.5,.5)),this.registerOutput("output",QT.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(J){const T=this.particle.getConnectedValue(J);T._directionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.direction1.getConnectedValue(J),j=this.direction2.getConnectedValue(J),B=(0,F.o)(t.x,j.x),Y=(0,F.o)(t.y,j.y),C=(0,F.o)(t.z,j.z);J.isEmitterTransformNode?q.n.TransformNormalFromFloatsToRef(B,Y,C,J.emitterWorldMatrix,b.direction):b.direction.hi(B,Y,C)},T._positionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.minEmitBox.getConnectedValue(J),j=this.maxEmitBox.getConnectedValue(J),B=(0,F.o)(t.x,j.x),Y=(0,F.o)(t.y,j.y),C=(0,F.o)(t.z,j.z);J.isEmitterTransformNode?q.n.TransformCoordinatesFromFloatsToRef(B,Y,C,J.emitterWorldMatrix,b.position):(b.position.hi(B,Y,C),b.position.addInPlace(J.emitterPosition))},this.output._storedValue=T}}(0,Y.g)("BABYLON.BoxShapeBlock",bb);class qb extends nT{constructor(J){super(J),this.registerInput("emitPower",QT.Float,!0,1),this.registerInput("lifeTime",QT.Float,!0,1),this.registerInput("color",QT.Wi,!0,new B.d(1,1,1,1)),this.registerInput("scale",QT.Vector2,!0,new q.k(1,1)),this.registerInput("angle",QT.Float,!0,0),this.registerOutput("particle",QT.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(J){const T=new YT(this.name,J.Zh,J.cg,null,!1,void 0,!0);T.particleEmitterType=new u,T._lifeTimeCreation.process=(T,b)=>{J.particleContext=T,T.lifeTime=this.lifeTime.getConnectedValue(J),b._emitPower=this.emitPower.getConnectedValue(J)},T._colorCreation.process=T=>{J.particleContext=T,T.color.p(this.color.getConnectedValue(J))},T._sizeCreation.process=T=>{J.particleContext=T,T.size=1,T.scale.p(this.scale.getConnectedValue(J))},T._angleCreation.process=T=>{J.particleContext=T,T.angle=this.angle.getConnectedValue(J)},this.particle._storedValue=T}}(0,Y.g)("BABYLON.CreateParticleBlock",qb);class tb{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const J=[];for(const T of this.attachedBlocks)T.isInput&&J.push(T);return J}constructor(J){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new z.b,this.name=J}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(J)&&this.attachedBlocks.push(J);for(const b of J.inputs){const q=b.connectedPoint;if(q){const b=q.ownerBlock;b!==J&&this._initializeBlock(b,T)}}}async buildAsync(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((b=>{const q=new pT;for(const J of this._systemBlocks)this._initializeBlock(J);for(const t of this.systemBlocks){const b=new fT;b.buildId=this._buildId++,b.cg=J,b.verbose=T;const j=t.createSystem(b);b.emitErrors(),q.systems.push(j)}this.onBuildObservable.notifyObservers(this),b(q)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const J=new MT("Particle system"),T=new Jb("Update position");T.output.connectTo(J.particle);const b=new yT("Position");b.contextualValue=OT.Position;const q=new yT("Scaled direction");q.contextualValue=OT.ScaledDirection;const t=new Tb("Add");t.operation=LT.Add,b.output.connectTo(t.left),q.output.connectTo(t.right),t.output.connectTo(T.position);const j=new qb("Create particle"),B=new bb("Box shape");j.particle.connectTo(B.particle),B.output.connectTo(T.particle);const Y=new kT("Texture");Y.texture.connectTo(J.texture),Y.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(J)}removeBlock(J){const T=this.attachedBlocks.indexOf(J);if(T>-1&&this.attachedBlocks.splice(T,1),J.isSystem){const T=this._systemBlocks.indexOf(J);T>-1&&this._systemBlocks.splice(T,1)}}parseSerializedObject(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T||this.clear();const b={};for(const q of J.Tk){const J=(0,Y.c)(q.customType);if(J){const T=new J;T._deserialize(q),b[q.id]=T,this.attachedBlocks.push(T),T.isSystem&&this._systemBlocks.push(T)}}for(const q of this.attachedBlocks)if(q.isTeleportOut){const J=q,T=J._tempEntryPointUniqueId;if(T){const q=b[T];q&&q.attachToEndpoint(J)}}for(let q=0;q<J.Tk.length;q++){const t=J.Tk[q],j=b[t.id];j&&(j.inputs.length&&t.inputs.some((J=>J.targetConnectionName))&&!T||this._restoreConnections(j,J,b))}if(J.locations||J.editorData&&J.editorData.locations){const q=J.locations||J.editorData.locations;for(const J of q)b[J.blockId]&&(J.blockId=b[J.blockId].uniqueId);T&&this.editorData&&this.editorData.locations&&q.concat(this.editorData.locations),J.locations?this.editorData={locations:q}:(this.editorData=J.editorData,this.editorData.locations=q);const t=[];for(const J in b)t[J]=b[J].uniqueId;this.editorData.map=t}this.comment=J.comment}_restoreConnections(J,T,b){for(const q of J.outputs)for(const t of T.Tk){const j=b[t.id];if(j)for(const B of t.inputs)if(b[B.targetBlockId]!==J||B.targetConnectionName!==q.name);else{const J=j.getInputByName(B.inputName);if(!J||J.isConnected)continue;q.connectTo(J,!0),this._restoreConnections(j,T,b)}}}serialize(J){const T=J?{}:e.d.Serialize(this);T.editorData=JSON.parse(JSON.stringify(this.editorData));let b=[];J?b=J:T.customType="BABYLON.NodeParticleSystemSet",T.Tk=[];for(const q of b)T.Tk.push(q.serialize());if(!J)for(const q of this.attachedBlocks)-1===b.indexOf(q)&&T.Tk.push(q.serialize());return T}dispose(){for(const J of this.attachedBlocks)J.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(J){const T=new tb(J);return T.setToDefault(),T}static Parse(J){const T=e.d.Parse((()=>new tb(J.name)),J,null);return T.parseSerializedObject(J),T}static ParseFromSnippetAsync(J,T){return"_BLANK"===J?Promise.resolve(tb.CreateDefault("blank")):new Promise(((b,q)=>{const t=new oT.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const B=JSON.parse(JSON.parse(t.responseText).jsonPayload),Y=JSON.parse(B.nodeParticle);T||(T=e.d.Parse((()=>new tb(J)),Y,null)),T.parseSerializedObject(Y),T.snippetId=J;try{b(T)}catch(j){q(j)}}else q("Unable to load the snippet "+J)})),t.open("GET",this.SnippetUrl+"/"+J.replace(/#/g,"/")),t.send()}))}}tb.EditorURL=`${ET.e._DefaultCdnUrl}/v${DJ.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,tb.SnippetUrl="https://snippet.babylonjs.com",(0,w.e)([(0,Z.M)()],tb.prototype,"name",void 0),(0,w.e)([(0,Z.M)("comment")],tb.prototype,"comment",void 0),function(J){J[J.None=0]="None",J[J.PerParticle=1]="PerParticle",J[J.PerSystem=2]="PerSystem"}(rT||(rT={}));class jb extends nT{constructor(J){super(J),this._currentLockId=-2,this.lockMode=rT.PerParticle,this.registerInput("min",QT.AutoDetect,!0,0),this.registerInput("max",QT.AutoDetect,!0,1),this.registerOutput("output",QT.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(QT.Float|QT.Int|QT.Vector2|QT.pi|QT.Wi),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(QT.Float|QT.Int|QT.Vector2|QT.pi|QT.Wi),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=QT.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let J=null;switch(this._currentLockId=-2,this.min.type){case QT.AutoDetect:case QT.Int:case QT.Float:J=J=>{const T=this.min.getConnectedValue(J)||0,b=this.max.getConnectedValue(J)||1;return T+Math.random()*(b-T)};break;case QT.Vector2:J=J=>{const T=this.min.getConnectedValue(J)||q.k.Zero(),b=this.max.getConnectedValue(J)||q.k.One();return new q.k(T.x+Math.random()*(b.x-T.x),T.y+Math.random()*(b.y-T.y))};break;case QT.pi:J=J=>{const T=this.min.getConnectedValue(J)||q.n.Zero(),b=this.max.getConnectedValue(J)||q.n.One();return new q.n(T.x+Math.random()*(b.x-T.x),T.y+Math.random()*(b.y-T.y),T.z+Math.random()*(b.z-T.z))};break;case QT.Wi:J=J=>{const T=this.min.getConnectedValue(J)||new B.d(0,0,0,0),b=this.max.getConnectedValue(J)||new B.d(1,1,1,1);return new B.d(T.x+Math.random()*(b.x-T.x),T.y+Math.random()*(b.y-T.y),T.z+Math.random()*(b.z-T.z),T.w+Math.random()*(b.w-T.w))}}this.output._storedFunction=T=>{var b;let q=0;switch(this.lockMode){case rT.PerParticle:q=(null===(b=T.particleContext)||void 0===b?void 0:b.id)||-1;break;case rT.PerSystem:q=T.buildId||0}return this._currentLockId!==q&&(this.lockMode!==rT.None&&(this._currentLockId=q),this.output._storedValue=J(T)),this.output._storedValue}}serialize(){const J=super.serialize();return J.lockMode=this.lockMode,J}_deserialize(J){super._deserialize(J),this.lockMode=J.lockMode}}(0,w.e)([DT("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:rT.None},{label:"Per particle",value:rT.PerParticle},{label:"Per system",value:rT.PerSystem}]})],jb.prototype,"lockMode",void 0),(0,Y.g)("BABYLON.ParticleRandomBlock",jb);class Bb extends nT{constructor(J){super(J),this._currentLockId=-2,this.lockMode=rT.PerParticle,this.registerInput("min",QT.AutoDetect),this.registerInput("max",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const T=[QT.Matrix,QT.Particle,QT.Texture,QT.System,QT.FloatGradient,QT.Color4Gradient,QT.Vector2Gradient,QT.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...T),this.max.excludedConnectionPointTypes.push(...T)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let J=null;switch(this._currentLockId=-2,this.min.type){case QT.Float:case QT.Int:J=J=>{const T=this.min.getConnectedValue(J),b=this.max.getConnectedValue(J);return Math.random()*(b-T)+T};break;case QT.Vector2:J=J=>{const T=this.min.getConnectedValue(J),b=this.max.getConnectedValue(J);return new q.k(Math.random()*(b.x-T.x)+T.x,Math.random()*(b.y-T.y)+T.y)};break;case QT.pi:J=J=>{const T=this.min.getConnectedValue(J),b=this.max.getConnectedValue(J);return new q.n(Math.random()*(b.x-T.x)+T.x,Math.random()*(b.y-T.y)+T.y,Math.random()*(b.z-T.z)+T.z)};break;case QT.Wi:J=J=>{const T=this.min.getConnectedValue(J),b=this.max.getConnectedValue(J);return new B.d(Math.random()*(b.r-T.r)+T.r,Math.random()*(b.g-T.g)+T.g,Math.random()*(b.b-T.b)+T.b,Math.random()*(b.a-T.a)+T.a)}}this.output._storedFunction=T=>{var b;let q=0;switch(this.lockMode){case rT.PerParticle:q=(null===(b=T.particleContext)||void 0===b?void 0:b.id)||-1;break;case rT.PerSystem:q=T.buildId||0}return this._currentLockId!==q&&(this.lockMode!==rT.None&&(this._currentLockId=q),this.output._storedValue=J(T)),this.output._storedValue}}serialize(){const J=super.serialize();return J.lockMode=this.lockMode,J}_deserialize(J){super._deserialize(J),void 0!==J.lockMode&&(this.lockMode=J.lockMode)}}(0,w.e)([DT("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:rT.None},{label:"Per particle",value:rT.PerParticle},{label:"Per system",value:rT.PerSystem}]})],Bb.prototype,"lockMode",void 0),(0,Y.g)("BABYLON.RandomRangeBlock",Bb);(0,Y.g)("BABYLON.ParticleLerpBlock",class extends nT{constructor(J){super(J),this.registerInput("left",QT.AutoDetect),this.registerInput("right",QT.AutoDetect),this.registerInput("gradient",QT.Float,!0,0,0,1),this.registerOutput("output",QT.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(QT.Float|QT.Int|QT.Vector2|QT.pi|QT.Wi)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const J=(J,T,b)=>(1-J)*T+J*b;this.output._storedFunction=T=>{const b=this.left.getConnectedValue(T),t=this.right.getConnectedValue(T),j=this.gradient.getConnectedValue(T);switch(this.left.type){case QT.Int:case QT.Float:return J(j,b,t);case QT.Vector2:return new q.k(J(j,b.x,t.x),J(j,b.y,t.y));case QT.pi:return new q.n(J(j,b.x,t.x),J(j,b.y,t.y),J(j,b.z,t.z));case QT.Wi:return new B.d(J(j,b.r,t.r),J(j,b.g,t.g),J(j,b.b,t.b),J(j,b.a,t.a))}return 0}}});(0,Y.g)("BABYLON.UpdateDirectionBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("direction",QT.pi),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(J){const T=this.particle.getConnectedValue(J);if(this.output._storedValue=T,!this.direction.isConnected)return;const b={process:b=>{J.particleContext=b,J.systemContext=T,b.direction.p(this.direction.getConnectedValue(J))},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b}});(0,Y.g)("BABYLON.UpdateColorBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("color",QT.Wi),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(J){const T=this.particle.getConnectedValue(J);if(this.output._storedValue=T,!this.color.isConnected)return;const b={process:b=>{J.particleContext=b,J.systemContext=T,b.color.p(this.color.getConnectedValue(J))},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b}});(0,Y.g)("BABYLON.UpdateScaleBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("scale",QT.Vector2),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(J){const T=this.particle.getConnectedValue(J);if(this.output._storedValue=T,!this.scale.isConnected)return;const b={process:b=>{J.particleContext=b,J.systemContext=T,b.scale.p(this.scale.getConnectedValue(J))},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b}});(0,Y.g)("BABYLON.UpdateAngleBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("angle",QT.Float),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(J){const T=this.particle.getConnectedValue(J);if(this.output._storedValue=T,!this.angle.isConnected)return;const b={process:b=>{J.particleContext=b,J.systemContext=T,b.angle=this.angle.getConnectedValue(J)},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b}});(0,Y.g)("BABYLON.BasicPositionUpdateBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(J){const T=this.particle.getConnectedValue(J),b={process:b=>{J.particleContext=b,J.systemContext=T,b.direction.scaleToRef(T._directionScale,T._scaledDirection),b.position.addInPlace(T._scaledDirection)},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b,this.output._storedValue=T}});(0,Y.g)("BABYLON.BasicSpriteUpdateBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(J){const T=this.particle.getConnectedValue(J),b={process:b=>{J.particleContext=b,J.systemContext=T,b.updateCellIndex()},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b,this.output._storedValue=T}});(0,Y.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("cellIndex",QT.Int),this.registerOutput("output",QT.Particle),this.cellIndex.acceptedConnectionPointTypes=[QT.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(J){const T=this.particle.getConnectedValue(J);if(this.output._storedValue=T,!this.cellIndex.isConnected)return;const b={process:b=>{J.particleContext=b,J.systemContext=T,b.cellIndex=Math.floor(this.cellIndex.getConnectedValue(J))},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b}});class Yb extends nT{constructor(J){super(J),this.strength=1,this.registerInput("particle",QT.Particle),this.registerInput("flowMap",QT.Texture),this.registerOutput("output",QT.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(J){var T;const b=this.particle.getConnectedValue(J),q=J.cg;let t;(null===(T=this.flowMap.connectedPoint)||void 0===T?void 0:T.ownerBlock).extractTextureContentAsync().then((J=>{J&&(t=new VT(J.width,J.height,J.data))}));const j={process:J=>{const T=q.getTransformMatrix();t&&t._processParticle(J,this.strength*b._tempScaledUpdateSpeed,T)},previousItem:null,nextItem:null};b._updateQueueStart?XJ(j,b._updateQueueStart):b._updateQueueStart=j,this.output._storedValue=b}serialize(){const J=super.serialize();return J.strength=this.strength,J}_deserialize(J){super._deserialize(J),this.strength=J.strength}}(0,w.e)([DT("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yb.prototype,"strength",void 0),(0,Y.g)("BABYLON.UpdateFlowMapBlock",Yb);(0,Y.g)("BABYLON.SphereShapeBlock",class extends nT{constructor(J){super(J),this.registerInput("input",QT.Particle),this.registerInput("radius",QT.Float,!0,1),this.registerInput("radiusRange",QT.Float,!0,1,0,1),this.registerInput("directionRandomizer",QT.Float,!0,0,0,1),this.registerOutput("output",QT.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(J){const T=this.input.getConnectedValue(J);T._directionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.directionRandomizer.getConnectedValue(J),j=b.position.Jg(J.emitterPosition).normalize(),B=(0,F.o)(0,t),Y=(0,F.o)(0,t),C=(0,F.o)(0,t);j.x+=B,j.y+=Y,j.z+=C,j.normalize(),J.isEmitterTransformNode?q.n.TransformNormalFromFloatsToRef(B,Y,C,J.emitterWorldMatrix,b.direction):b.direction.hi(B,Y,C)},T._positionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.radius.getConnectedValue(J),j=this.radiusRange.getConnectedValue(J),B=t-(0,F.o)(0,t*j),Y=(0,F.o)(0,1),C=(0,F.o)(0,2*Math.PI),A=Math.acos(2*Y-1),a=B*Math.cos(C)*Math.sin(A),P=B*Math.cos(A),v=B*Math.sin(C)*Math.sin(A);J.isEmitterTransformNode?q.n.TransformCoordinatesFromFloatsToRef(a,P,v,J.emitterWorldMatrix,b.position):(b.position.hi(a,P,v),b.position.addInPlace(J.emitterPosition))},this.output._storedValue=T}});(0,Y.g)("BABYLON.PointShapeBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("direction1",QT.pi,!0,new q.n(0,1,0)),this.registerInput("direction2",QT.pi,!0,new q.n(0,1,0)),this.registerOutput("output",QT.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(J){const T=this.particle.getConnectedValue(J);T._directionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.direction1.getConnectedValue(J),j=this.direction2.getConnectedValue(J),B=(0,F.o)(t.x,j.x),Y=(0,F.o)(t.y,j.y),C=(0,F.o)(t.z,j.z);J.isEmitterTransformNode?q.n.TransformNormalFromFloatsToRef(B,Y,C,J.emitterWorldMatrix,b.direction):b.direction.hi(B,Y,C)},T._positionCreation.process=b=>{J.systemContext=T,J.isEmitterTransformNode?q.n.TransformCoordinatesFromFloatsToRef(0,0,0,J.emitterWorldMatrix,b.position):b.position.p(J.emitterPosition)},this.output._storedValue=T}});(0,Y.g)("BABYLON.CustomShapeBlock",class extends nT{constructor(J){super(J),this.registerInput("particle",QT.Particle),this.registerInput("position",QT.pi,!0,new q.n(0,0,0)),this.registerInput("direction",QT.pi,!0,new q.n(0,1,0)),this.registerOutput("output",QT.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(J){const T=this.particle.getConnectedValue(J);T._directionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.direction.getConnectedValue(J);J.isEmitterTransformNode?q.n.TransformNormalToRef(t,J.emitterWorldMatrix,b.direction):b.direction.p(t)},T._positionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.position.getConnectedValue(J);J.isEmitterTransformNode?q.n.TransformCoordinatesToRef(t,J.emitterWorldMatrix,b.position):(b.position.p(t),b.position.addInPlace(J.emitterPosition))},this.output._storedValue=T}});(0,Y.g)("BABYLON.CylinderShapeBlock",class extends nT{constructor(J){super(J),this._tempVector=q.n.Zero(),this.registerInput("particle",QT.Particle),this.registerInput("radius",QT.Float,!0,1),this.registerInput("height",QT.Float,!0,1,0),this.registerInput("radiusRange",QT.Float,!0,1,0,1),this.registerInput("directionRandomizer",QT.Float,!0,0,0,1),this.registerOutput("output",QT.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(J){const T=this.particle.getConnectedValue(J);T._directionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.directionRandomizer.getConnectedValue(J);b.position.subtractToRef(J.emitterPosition,this._tempVector),this._tempVector.normalize(),J.isEmitterTransformNode&&q.n.TransformNormalToRef(this._tempVector,J.emitterInverseWorldMatrix,this._tempVector);const j=(0,F.o)(-t/2,t/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,F.o)(-Math.PI/2,Math.PI/2)*t,this._tempVector.y=j,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),J.isEmitterTransformNode?q.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,J.emitterWorldMatrix,b.direction):b.direction.p(this._tempVector)},T._positionCreation.process=b=>{J.particleContext=b,J.systemContext=T;const t=this.height.getConnectedValue(J),j=this.radiusRange.getConnectedValue(J),B=this.radius.getConnectedValue(J),Y=(0,F.o)(-t/2,t/2),C=(0,F.o)(0,2*Math.PI),A=(0,F.o)((1-j)*(1-j),1),a=Math.sqrt(A)*B,P=a*Math.cos(C),v=a*Math.sin(C);J.isEmitterTransformNode?q.n.TransformCoordinatesFromFloatsToRef(P,Y,v,J.emitterWorldMatrix,b.position):(b.position.hi(P,Y,v),b.position.addInPlace(J.emitterPosition))},this.output._storedValue=T}});class Cb extends nT{constructor(J){super(J),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",QT.Particle),this.registerOutput("output",QT.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(J){super._build(J);const T=this.particle.getConnectedValue(J);T._isAnimationSheetEnabled=!0,T.spriteCellWidth=this.width,T.spriteCellHeight=this.height,T.startSpriteCellID=this.start,T.endSpriteCellID=this.end,T.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=T}serialize(){const J=super.serialize();return J.width=this.width,J.height=this.height,J.start=this.start,J.end=this.end,J.randomStartCell=this.randomStartCell,J}_deserialize(J){super._deserialize(J),this.width=J.width,this.height=J.height,this.start=J.start,this.end=J.end,this.randomStartCell=J.randomStartCell}}(0,w.e)([DT("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cb.prototype,"start",void 0),(0,w.e)([DT("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cb.prototype,"end",void 0),(0,w.e)([DT("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cb.prototype,"width",void 0),(0,w.e)([DT("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cb.prototype,"height",void 0),(0,w.e)([DT("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cb.prototype,"loop",void 0),(0,w.e)([DT("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cb.prototype,"randomStartCell",void 0),(0,Y.g)("BABYLON.SetupSpriteSheetBlock",Cb);class Fb extends nT{constructor(J){super(J),this.reference=0,this.registerInput("value",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=J=>{switch(J){case QT.Float:return QT.FloatGradient;case QT.Vector2:return QT.Vector2Gradient;case QT.pi:return QT.Vector3Gradient;case QT.Wi:return QT.Color4Gradient}return J},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(QT.Float|QT.Vector2|QT.pi|QT.Wi)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=J=>null}serialize(){const J=super.serialize();return J.reference=this.reference,J}_deserialize(J){super._deserialize(J),this.reference=J.reference}}(0,w.e)([DT("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Fb.prototype,"reference",void 0),(0,Y.g)("BABYLON.ParticleGradientValueBlock",Fb);(0,Y.g)("BABYLON.ParticleGradientBlock",class extends nT{constructor(J){super(J),this._entryCount=1,this.registerInput("gradient",QT.Float,!0,1,0,1),this.registerInput("value0",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=J=>{switch(J){case QT.FloatGradient:return QT.Float;case QT.Vector2Gradient:return QT.Vector2;case QT.Vector3Gradient:return QT.pi;case QT.Color4Gradient:return QT.Wi}return J},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(QT.FloatGradient|QT.Vector2Gradient|QT.Vector3Gradient|QT.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(J){this._inputs[J].onConnectionObservable.add((()=>{this._entryCount>J||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),QT.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const J=[];for(let b=1;b<this._inputs.length;b++){var T;if(this._inputs[b].isConnected)J.push(null===(T=this._inputs[b].connectedPoint)||void 0===T?void 0:T.ownerBlock)}J.sort(((J,T)=>J.reference-T.reference)),this.output._storedFunction=T=>{const b=this.gradient.getConnectedValue(T);if(1===J.length)return J[0].value.getConnectedValue(T);let t=null;for(let j=J.length-1;j>=0;j--){const Y=J[j];if(Y.reference<=b){const J=Y.value.getConnectedValue(T);if(t){const j=t.value.getConnectedValue(T),C=t.reference,A=Y.reference,a=Math.max(0,Math.min(1,(b-A)/(C-A)));switch(this.output.type){case QT.Float:return(0,F.m)(J,j,a);case QT.Vector2:return q.k.Lerp(J,j,a);case QT.pi:return q.n.Lerp(J,j,a);case QT.Wi:return B.d.Lerp(J,j,a)}}return J}t=Y}return 0}}});(0,Y.g)("BABYLON.ParticleConverterBlock",class extends nT{constructor(J){super(J),this.registerInput("color ",QT.Wi,!0),this.registerInput("xyz ",QT.pi,!0),this.registerInput("xy ",QT.Vector2,!0),this.registerInput("zw ",QT.Vector2,!0),this.registerInput("x ",QT.Float,!0),this.registerInput("y ",QT.Float,!0),this.registerInput("z ",QT.Float,!0),this.registerInput("w ",QT.Float,!0),this.registerOutput("color",QT.Wi),this.registerOutput("xyz",QT.pi),this.registerOutput("xy",QT.Vector2),this.registerOutput("zw",QT.Vector2),this.registerOutput("x",QT.Float),this.registerOutput("y",QT.Float),this.registerOutput("z",QT.Float),this.registerOutput("w",QT.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(J){return"color "===J?"colorIn":"xyz "===J?"xyzIn":"xy "===J?"xyIn":"zw "===J?"zwIn":"x "===J?"xIn":"y "===J?"yIn":"z "===J?"zIn":"w "===J?"wIn":J}_outputRename(J){switch(J){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return J}}_build(J){super._build(J);const T=this.xIn,b=this.yIn,t=this.zIn,j=this.wIn,Y=this.xyIn,C=this.zwIn,F=this.xyzIn,A=this.colorIn,a=this.colorOut,P=this.xyzOut,v=this.xyOut,G=this.zwOut,x=this.xOut,I=this.yOut,u=this.zOut,U=this.wOut,K=J=>{if(A.isConnected)return A.getConnectedValue(J);let q=0,a=0,P=0,v=0;if(T.isConnected&&(q=T.getConnectedValue(J)),b.isConnected&&(a=b.getConnectedValue(J)),t.isConnected&&(P=t.getConnectedValue(J)),j.isConnected&&(v=j.getConnectedValue(J)),Y.isConnected){const T=Y.getConnectedValue(J);T&&(q=T.x,a=T.y)}if(C.isConnected){const T=C.getConnectedValue(J);T&&(P=T.x,v=T.y)}if(F.isConnected){const T=F.getConnectedValue(J);T&&(q=T.x,a=T.y,P=T.z)}return new B.d(q,a,P,v)};a._storedFunction=J=>K(J),P._storedFunction=J=>{const T=K(J);return new q.n(T.r,T.g,T.b)},v._storedFunction=J=>{const T=K(J);return new q.k(T.r,T.g)},G._storedFunction=J=>{const T=K(J);return new q.k(T.b,T.a)},x._storedFunction=J=>K(J).r,I._storedFunction=J=>K(J).g,u._storedFunction=J=>K(J).b,U._storedFunction=J=>K(J).a}}),function(J){J[J.Cos=0]="Cos",J[J.Sin=1]="Sin",J[J.Abs=2]="Abs",J[J.Exp=3]="Exp",J[J.Exp2=4]="Exp2",J[J.Round=5]="Round",J[J.Floor=6]="Floor",J[J.Ceiling=7]="Ceiling",J[J.Sqrt=8]="Sqrt",J[J.Log=9]="Log",J[J.Tan=10]="Tan",J[J.ArcTan=11]="ArcTan",J[J.ArcCos=12]="ArcCos",J[J.ArcSin=13]="ArcSin",J[J.Sign=14]="Sign",J[J.Negate=15]="Negate",J[J.OneMinus=16]="OneMinus",J[J.Reciprocal=17]="Reciprocal",J[J.ToDegrees=18]="ToDegrees",J[J.ToRadians=19]="ToRadians",J[J.Fract=20]="Fract"}(NT||(NT={}));class Ab extends nT{constructor(J){super(J),this.operation=NT.Cos,this.registerInput("input",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(QT.Float|QT.Int|QT.Vector2|QT.pi|QT.Wi)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(J){super._build(J);let T=null;switch(this.operation){case NT.Cos:T=J=>Math.cos(J);break;case NT.Sin:T=J=>Math.sin(J);break;case NT.Abs:T=J=>Math.abs(J);break;case NT.Exp:T=J=>Math.exp(J);break;case NT.Exp2:T=J=>Math.pow(2,J);break;case NT.Round:T=J=>Math.round(J);break;case NT.Floor:T=J=>Math.floor(J);break;case NT.Ceiling:T=J=>Math.ceil(J);break;case NT.Sqrt:T=J=>Math.sqrt(J);break;case NT.Log:T=J=>Math.log(J);break;case NT.Tan:T=J=>Math.tan(J);break;case NT.ArcTan:T=J=>Math.atan(J);break;case NT.ArcCos:T=J=>Math.acos(J);break;case NT.ArcSin:T=J=>Math.asin(J);break;case NT.Sign:T=J=>Math.sign(J);break;case NT.Negate:T=J=>-J;break;case NT.OneMinus:T=J=>1-J;break;case NT.Reciprocal:T=J=>1/J;break;case NT.ToRadians:T=J=>J*Math.PI/180;break;case NT.ToDegrees:T=J=>180*J/Math.PI;break;case NT.Fract:T=J=>J>=0?J-Math.floor(J):J-Math.ceil(J)}if(!T)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case QT.Int:case QT.Float:this.output._storedFunction=J=>{const b=this.input.getConnectedValue(J);return T(b)};break;case QT.Vector2:this.output._storedFunction=J=>{const b=this.input.getConnectedValue(J);return new q.k(T(b.x),T(b.y))};break;case QT.pi:this.output._storedFunction=J=>{const b=this.input.getConnectedValue(J);return new q.n(T(b.x),T(b.y),T(b.z))};break;case QT.Wi:this.output._storedFunction=J=>{const b=this.input.getConnectedValue(J);return new B.d(T(b.r),T(b.g),T(b.b),T(b.a))}}return this}serialize(){const J=super.serialize();return J.operation=this.operation,J}_deserialize(J){super._deserialize(J),this.operation=J.operation}}(0,w.e)([DT("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:NT.Cos},{label:"Sin",value:NT.Sin},{label:"Abs",value:NT.Abs},{label:"Exp",value:NT.Exp},{label:"Exp2",value:NT.Exp2},{label:"Round",value:NT.Round},{label:"Floor",value:NT.Floor},{label:"Ceiling",value:NT.Ceiling},{label:"Sqrt",value:NT.Sqrt},{label:"Log",value:NT.Log},{label:"Tan",value:NT.Tan},{label:"ArcTan",value:NT.ArcTan},{label:"ArcCos",value:NT.ArcCos},{label:"ArcSin",value:NT.ArcSin},{label:"Sign",value:NT.Sign},{label:"Negate",value:NT.Negate},{label:"OneMinus",value:NT.OneMinus},{label:"Reciprocal",value:NT.Reciprocal},{label:"ToDegrees",value:NT.ToDegrees},{label:"ToRadians",value:NT.ToRadians},{label:"Fract",value:NT.Fract}]})],Ab.prototype,"operation",void 0),(0,Y.g)("BABYLON.ParticleTrigonometryBlock",Ab);var ab,Pb=b(12180);class vb extends nT{constructor(J){super(J),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(QT.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(QT.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(QT.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(QT.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(QT.System),this._inputs[0].excludedConnectionPointTypes.push(QT.Particle),this._inputs[0].excludedConnectionPointTypes.push(QT.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(J){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const T=J=>{const T=this.input.getConnectedValue(J);if(this.log.length>=this.stackSize)return T;if(null===T||void 0===T)return this.log.push(["null",""]),T;switch(this.input.type){case QT.Vector2:this.log.push([(0,Pb.f)(T,4),T.toString()]);break;case QT.pi:this.log.push([(0,Pb.h)(T,4),T.toString()]);break;case QT.Wi:this.log.push([`{R: ${T.r.toFixed(4)} G: ${T.g.toFixed(4)} B: ${T.b.toFixed(4)} A: ${T.a.toFixed(4)}}`,T.toString()]);break;default:this.log.push([T.toString(),T.toString()])}return T};this.output.isConnected?this.output._storedFunction=T:this.output._storedValue=T(J)}serialize(){const J=super.serialize();return J.stackSize=this.stackSize,J}_deserialize(J){super._deserialize(J),this.stackSize=J.stackSize}}(0,w.e)([DT("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],vb.prototype,"stackSize",void 0),(0,Y.g)("BABYLON.ParticleDebugBlock",vb);(0,Y.g)("BABYLON.ParticleElbowBlock",class extends nT{constructor(J){super(J),this.registerInput("input",QT.AutoDetect),this.registerOutput("output",QT.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(J){super._build(J);const T=this._outputs[0],b=this._inputs[0];T._storedFunction=J=>b.getConnectedValue(J)}});(0,Y.g)("BABYLON.ParticleTeleportInBlock",class extends nT{get endpoints(){return this._endpoints}constructor(J){super(J),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",QT.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(J){if(this.getClassName()===J)return!0;for(const T of this.endpoints)if(T.isAnAncestorOfType(J))return!0;return!1}isAnAncestorOf(J){for(const T of this.endpoints){if(T===J)return!0;if(T.isAnAncestorOf(J))return!0}return!1}attachToEndpoint(J){J.detach(),this._endpoints.push(J),J._entryPoint=this,J._outputs[0]._typeConnectionSource=this._inputs[0],J._tempEntryPointUniqueId=null,J.name="> "+this.name}detachFromEndpoint(J){const T=this._endpoints.indexOf(J);-1!==T&&(this._endpoints.splice(T,1),J._outputs[0]._typeConnectionSource=null,J._entryPoint=null)}_build(){for(const J of this._endpoints)J.output._storedFunction=J=>this.input.getConnectedValue(J)}});(0,Y.g)("BABYLON.ParticleTeleportOutBlock",class extends nT{constructor(J){super(J),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",QT.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(J){this.entryPoint&&this.entryPoint.build(J)}clone(){const J=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(J),J}serialize(){var J;const T=super.serialize();return T.entryPoint=(null===(J=this.entryPoint)||void 0===J?void 0:J.uniqueId)??"",T}_deserialize(J){super._deserialize(J),this._tempEntryPointUniqueId=J.entryPoint}}),function(J){J[J.Equal=0]="Equal",J[J.NotEqual=1]="NotEqual",J[J.LessThan=2]="LessThan",J[J.GreaterThan=3]="GreaterThan",J[J.LessOrEqual=4]="LessOrEqual",J[J.GreaterOrEqual=5]="GreaterOrEqual",J[J.Xor=6]="Xor",J[J.Or=7]="Or",J[J.And=8]="And"}(ab||(ab={}));class Gb extends nT{constructor(J){super(J),this.test=ab.Equal,this.epsilon=0,this.registerInput("left",QT.Float),this.registerInput("right",QT.Float,!0,0),this.registerInput("ifTrue",QT.AutoDetect,!0,1),this.registerInput("ifFalse",QT.AutoDetect,!0,0),this.registerOutput("output",QT.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=QT.Float,this._inputs[0].acceptedConnectionPointTypes.push(QT.Int),this._inputs[1].acceptedConnectionPointTypes.push(QT.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const J=J=>{const T=this.left.getConnectedValue(J),b=this.right.getConnectedValue(J);let q=!1;switch(this.test){case ab.Equal:q=(0,F.r)(T,b,this.epsilon);break;case ab.NotEqual:q=!(0,F.r)(T,b,this.epsilon);break;case ab.LessThan:q=T<b+this.epsilon;break;case ab.GreaterThan:q=T>b-this.epsilon;break;case ab.LessOrEqual:q=T<=b+this.epsilon;break;case ab.GreaterOrEqual:q=T>=b-this.epsilon;break;case ab.Xor:q=!!T&&!b||!T&&!!b;break;case ab.Or:q=!!T||!!b;break;case ab.And:q=!!T&&!!b}return q};this.output._storedFunction=T=>J(T)?this.ifTrue.getConnectedValue(T):this.ifFalse.getConnectedValue(T)}serialize(){const J=super.serialize();return J.test=this.test,J.epsilon=this.epsilon,J}_deserialize(J){super._deserialize(J),this.test=J.test,void 0!==J.epsilon&&(this.epsilon=J.epsilon)}}(0,w.e)([DT("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:ab.Equal},{label:"NotEqual",value:ab.NotEqual},{label:"LessThan",value:ab.LessThan},{label:"GreaterThan",value:ab.GreaterThan},{label:"LessOrEqual",value:ab.LessOrEqual},{label:"GreaterOrEqual",value:ab.GreaterOrEqual},{label:"Xor",value:ab.Xor},{label:"Or",value:ab.Or},{label:"And",value:ab.And}]})],Gb.prototype,"test",void 0),(0,w.e)([DT("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gb.prototype,"epsilon",void 0),(0,Y.g)("BABYLON.ParticleConditionBlock",Gb);class xb extends nT{constructor(J){super(J),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",QT.Particle),this.registerInput("condition",QT.Float,!0,0),this.registerInput("system",QT.System),this.registerOutput("output",QT.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(J){this._triggerCount=0;const T=this.input.getConnectedValue(J),b={process:b=>{if(J.particleContext=b,J.systemContext=T,0!==this.condition.getConnectedValue(J)&&(0===this.limit||this._triggerCount<this.limit)){const q=(new Date).getTime();if(this._previousOne&&q-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=q;const t=this.system.getConnectedValue(J);if(t){const q=zT(t,J.cg,b.position);q.Ki.addOnce((()=>{this._triggerCount--})),T.Ki.addOnce((()=>{q.dispose()}))}}},previousItem:null,nextItem:null};T._updateQueueStart?XJ(b,T._updateQueueStart):T._updateQueueStart=b,this.output._storedValue=T}serialize(){const J=super.serialize();return J.limit=this.limit,J.delay=this.delay,J}_deserialize(J){super._deserialize(J),void 0!==J.limit&&(this.limit=J.limit),void 0!==J.delay&&(this.delay=J.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,w.e)([DT("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xb.prototype,"limit",void 0),(0,w.e)([DT("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xb.prototype,"delay",void 0),(0,Y.g)("BABYLON.ParticleTriggerBlock",xb);b(12186),b(12204),b(12220),b(12278)},12258:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneFragment",j="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12227:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneFragmentDeclaration",j="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12296:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneVertex",j="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12284:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneVertexDeclaration",j="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12272:(J,T,b)=>{"use strict";var q=b(596);const t="fogFragment",j="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12250:(J,T,b)=>{"use strict";var q=b(596);const t="fogFragmentDeclaration",j="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12302:(J,T,b)=>{"use strict";var q=b(596);const t="fogVertex",j="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12291:(J,T,b)=>{"use strict";var q=b(596);const t="fogVertexDeclaration",j="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12244:(J,T,b)=>{"use strict";var q=b(596);const t="helperFunctions",j="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12232:(J,T,b)=>{"use strict";var q=b(596);const t="imageProcessingDeclaration",j="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12248:(J,T,b)=>{"use strict";var q=b(596);const t="imageProcessingFunctions",j="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12235:(J,T,b)=>{"use strict";var q=b(596);const t="logDepthDeclaration",j="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12267:(J,T,b)=>{"use strict";var q=b(596);const t="logDepthFragment",j="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12304:(J,T,b)=>{"use strict";var q=b(596);const t="logDepthVertex",j="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";q.c.IncludesShadersStoreWGSL[t]||(q.c.IncludesShadersStoreWGSL[t]=j)},12220:(J,T,b)=>{"use strict";b.r(T),b.d(T,{particlesPixelShaderWGSL:()=>B});var q=b(596);b(12227),b(12232),b(12235),b(12244),b(12248),b(12250),b(12258),b(12267),b(12272);const t="particlesPixelShader",j="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";q.c.ShadersStoreWGSL[t]||(q.c.ShadersStoreWGSL[t]=j);const B={name:t,shader:j}},12278:(J,T,b)=>{"use strict";b.r(T),b.d(T,{particlesVertexShaderWGSL:()=>B});var q=b(596);b(12284),b(12291),b(12235),b(12296),b(12302),b(12304);const t="particlesVertexShader",j="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.c.ShadersStoreWGSL[t]||(q.c.ShadersStoreWGSL[t]=j);const B={name:t,shader:j}},12135:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneFragment",j="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12195:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneFragmentDeclaration",j="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12160:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneVertex",j="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12213:(J,T,b)=>{"use strict";var q=b(596);const t="clipPlaneVertexDeclaration",j="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12149:(J,T,b)=>{"use strict";var q=b(596);const t="fogFragment",j="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12126:(J,T,b)=>{"use strict";var q=b(596);const t="fogFragmentDeclaration",j="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12166:(J,T,b)=>{"use strict";var q=b(596);const t="fogVertex",j="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12154:(J,T,b)=>{"use strict";var q=b(596);const t="fogVertexDeclaration",j="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12116:(J,T,b)=>{"use strict";var q=b(596);const t="helperFunctions",j="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12106:(J,T,b)=>{"use strict";var q=b(596);const t="imageProcessingDeclaration",j="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12119:(J,T,b)=>{"use strict";var q=b(596);const t="imageProcessingFunctions",j="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12110:(J,T,b)=>{"use strict";var q=b(596);const t="logDepthDeclaration",j="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12144:(J,T,b)=>{"use strict";var q=b(596);const t="logDepthFragment",j="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12170:(J,T,b)=>{"use strict";var q=b(596);const t="logDepthVertex",j="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";q.c.IncludesShadersStore[t]||(q.c.IncludesShadersStore[t]=j)},12186:(J,T,b)=>{"use strict";b.r(T),b.d(T,{particlesPixelShader:()=>B});var q=b(596);b(12195),b(12106),b(12110),b(12116),b(12119),b(12126),b(12135),b(12144),b(12149);const t="particlesPixelShader",j="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";q.c.ShadersStore[t]||(q.c.ShadersStore[t]=j);const B={name:t,shader:j}},12204:(J,T,b)=>{"use strict";b.r(T),b.d(T,{particlesVertexShader:()=>B});var q=b(596);b(12213),b(12154),b(12110),b(12160),b(12166),b(12170);const t="particlesVertexShader",j="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.c.ShadersStore[t]||(q.c.ShadersStore[t]=j);const B={name:t,shader:j}},12654:(J,T,b)=>{"use strict";b.r(T),b.d(T,{FlowGraphGLTFDataProvider:()=>j});var q=b(12627),t=b(12603);class j extends q.b{constructor(J){var T,b;super();const q=J.glTF,j=(null===(T=q.animations)||void 0===T?void 0:T.map((J=>J._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",t.c,j);const B=(null===(b=q.nodes)||void 0===b?void 0:b.map((J=>J._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",t.c,B)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12513:(J,T,b)=>{"use strict";b.d(T,{c:()=>I,e:()=>G,i:()=>v,m:()=>x});var q=b(697),t=b(12518),j=b(731),B=b(12523);const Y=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class C{constructor(J,T){this._gltf=J,this._infoTree=T}convert(J){let T,b=this._gltf,q=this._infoTree;if(!J.startsWith("/"))throw new Error("Path must start with a /");const t=J.split("/");if(t.shift(),t[t.length-1].includes(".length")){const J=t[t.length-1].split(".");t.pop(),t.push(...J)}let j=!1;for(const C of t){const t="length"===C;if(t&&!q.__array__)throw new Error(`Path ${J} is invalid`);if(q.__ignoreObjectTree__&&(j=!0),q.__array__&&!t)q=q.__array__;else if(q=q[C],!q)throw new Error(`Path ${J} is invalid`);if(!j)if(void 0===b){if(!Y.find((T=>T.regex.test(J))))throw new Error(`Path ${J} is invalid`)}else if(!t){var B;b=null===(B=b)||void 0===B?void 0:B[C]}(q.__target__||t)&&(T=b)}return{object:T,info:q}}}function F(J,T,b,q){const t=A(J,T);return q?t[b][q]:t[b]}function A(J,T,b){var q,j;return null===(q=J._data)||void 0===q||null===(j=q[(null===b||void 0===b?void 0:b.fillMode)??t.e.MATERIAL_TriangleFillMode])||void 0===j?void 0:j.babylonMaterial}function a(J,T){return{offset:{componentsCount:2,type:"Vector2",get:(b,t,j)=>{const B=F(b,j,J,T);return new q.k(null===B||void 0===B?void 0:B.uOffset,null===B||void 0===B?void 0:B.vOffset)},getTarget:A,set:(b,q,t,j)=>{const B=F(q,j,J,T);B.uOffset=b.x,B.vOffset=b.y},getPropertyName:[()=>`${J}${T?"."+T:""}.uOffset`,()=>`${J}${T?"."+T:""}.vOffset`]},rotation:{type:"number",get:(b,q,t)=>{var j;return null===(j=F(b,t,J,T))||void 0===j?void 0:j.wAng},getTarget:A,set:(b,q,t,j)=>F(q,j,J,T).wAng=b,getPropertyName:[()=>`${J}${T?"."+T:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(b,t,j)=>{const B=F(b,j,J,T);return new q.k(null===B||void 0===B?void 0:B.uScale,null===B||void 0===B?void 0:B.vScale)},getTarget:A,set:(b,q,t,j)=>{const B=F(q,j,J,T);B.uScale=b.x,B.vScale=b.y},getPropertyName:[()=>`${J}${T?"."+T:""}.uScale`,()=>`${J}${T?"."+T:""}.vScale`]}}}const P={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:J=>{var T,b;return new q.k((null===(T=J._babylonCamera)||void 0===T?void 0:T.orthoLeft)??0,(null===(b=J._babylonCamera)||void 0===b?void 0:b.orthoRight)??0)},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.orthoLeft=J.x,T._babylonCamera.orthoRight=J.y)},getTarget:J=>J,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:J=>{var T,b;return new q.k((null===(T=J._babylonCamera)||void 0===T?void 0:T.orthoBottom)??0,(null===(b=J._babylonCamera)||void 0===b?void 0:b.orthoTop)??0)},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.orthoBottom=J.x,T._babylonCamera.orthoTop=J.y)},getTarget:J=>J,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:J=>{var T;return null===(T=J._babylonCamera)||void 0===T?void 0:T.maxZ},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.maxZ=J)},getTarget:J=>J,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:J=>{var T;return null===(T=J._babylonCamera)||void 0===T?void 0:T.wi},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.wi=J)},getTarget:J=>J,getPropertyName:[()=>"wi"]}},perspective:{aspectRatio:{type:"number",get:J=>{var T;return null===(T=J._babylonCamera)||void 0===T?void 0:T.getEngine().getAspectRatio(J._babylonCamera)},getTarget:J=>J,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:J=>{var T;return null===(T=J._babylonCamera)||void 0===T?void 0:T.fov},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.fov=J)},getTarget:J=>J,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:J=>{var T;return null===(T=J._babylonCamera)||void 0===T?void 0:T.maxZ},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.maxZ=J)},getTarget:J=>J,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:J=>{var T;return null===(T=J._babylonCamera)||void 0===T?void 0:T.wi},set:(J,T)=>{T._babylonCamera&&(T._babylonCamera.wi=J)},getTarget:J=>J,getPropertyName:[()=>"wi"]}}}},nodes:{length:{type:"number",get:J=>J.length,getTarget:J=>J.map((J=>J._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"pi",get:J=>{var T;return null===(T=J._babylonTransformNode)||void 0===T?void 0:T.position},set:(J,T)=>{var b;return null===(b=T._babylonTransformNode)||void 0===b?void 0:b.position.p(J)},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:J=>{var T;return null===(T=J._babylonTransformNode)||void 0===T?void 0:T.rotationQuaternion},set:(J,T)=>{var b,q;return null===(b=T._babylonTransformNode)||void 0===b||null===(q=b.rotationQuaternion)||void 0===q?void 0:q.p(J)},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"pi",get:J=>{var T;return null===(T=J._babylonTransformNode)||void 0===T?void 0:T.ii},set:(J,T)=>{var b;return null===(b=T._babylonTransformNode)||void 0===b?void 0:b.ii.p(J)},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"ii"]},weights:{length:{type:"number",get:J=>J._numMorphTargets,getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(J,T)=>{var b,q;return void 0!==T?null===(b=J._primitiveBabylonMeshes)||void 0===b||null===(q=b[0].morphTargetManager)||void 0===q?void 0:q.getTarget(T).influence:void 0},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(J,T)=>[0],getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:J=>{var T,b,t;return q.e.Compose(null===(T=J._babylonTransformNode)||void 0===T?void 0:T.ii,null===(b=J._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion,null===(t=J._babylonTransformNode)||void 0===t?void 0:t.position)},getTarget:J=>J._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:J=>{var T,b,t,j;const B=q.e.Identity();let Y=J.parent;for(;Y&&Y.parent;)Y=Y.parent;const C=(null===(T=J._babylonTransformNode)||void 0===T?void 0:T.position._isDirty)||(null===(b=J._babylonTransformNode)||void 0===b||null===(t=b.rotationQuaternion)||void 0===t?void 0:t._isDirty)||(null===(j=J._babylonTransformNode)||void 0===j?void 0:j.ii._isDirty);if(Y){var F;const T=null===(F=Y._babylonTransformNode)||void 0===F?void 0:F.ti(!0).invert();var A,a;if(T)null===(A=J._babylonTransformNode)||void 0===A||null===(a=A.ti(C))||void 0===a||a.multiplyToRef(T,B)}else J._babylonTransformNode&&B.p(J._babylonTransformNode.ti(C));return B},getTarget:J=>J._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:J=>{var T,b;return null===(T=J._babylonTransformNode)||void 0===T||null===(b=T.getChildren((J=>J instanceof B.c),!0)[0])||void 0===b?void 0:b.Kl},getTarget:J=>{var T;return null===(T=J._babylonTransformNode)||void 0===T?void 0:T.getChildren((J=>J instanceof B.c),!0)[0]},set:(J,T)=>{if(T._babylonTransformNode){const b=T._babylonTransformNode.getChildren((J=>J instanceof B.c),!0)[0];b&&(b.Kl=J)}}},color:{type:"Vi",get:J=>{var T,b;return null===(T=J._babylonTransformNode)||void 0===T||null===(b=T.getChildren((J=>J instanceof B.c),!0)[0])||void 0===b?void 0:b.Sk},getTarget:J=>{var T;return null===(T=J._babylonTransformNode)||void 0===T?void 0:T.getChildren((J=>J instanceof B.c),!0)[0]},set:(J,T)=>{if(T._babylonTransformNode){const b=T._babylonTransformNode.getChildren((J=>J instanceof B.c),!0)[0];b&&(b.Sk=J)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Vi",get:(J,T,b)=>A(J,T,b).emissiveColor,set:(J,T,b,q)=>A(T,b,q).emissiveColor.p(J),getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:a("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(J,T,b)=>{var q;return null===(q=F(J,b,"bumpTexture"))||void 0===q?void 0:q.level},set:(J,T,b,q)=>{const t=F(T,q,"bumpTexture");t&&(t.level=J)},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:a("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(J,T,b)=>A(J,T,b).ambientTextureStrength,set:(J,T,b,q)=>{const t=A(T,b,q);t&&(t.ambientTextureStrength=J)},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:a("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Wi",get:(J,T,b)=>{const q=A(J,T,b);return j.d.FromColor3(q.albedoColor,q.alpha)},set:(J,T,b,q)=>{const t=A(T,b,q);t.albedoColor.set(J.r,J.g,J.b),t.alpha=J.a},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:a("albedoTexture")}},metallicFactor:{type:"number",get:(J,T,b)=>A(J,T,b).metallic,set:(J,T,b,q)=>{const t=A(T,b,q);t&&(t.metallic=J)},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(J,T,b)=>A(J,T,b).roughness,set:(J,T,b,q)=>{const t=A(T,b,q);t&&(t.roughness=J)},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:a("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(J,T,b)=>A(J,T,b).anisotropy.Kl,set:(J,T,b,q)=>{A(T,b,q).anisotropy.Kl=J},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(J,T,b)=>A(J,T,b).anisotropy.angle,set:(J,T,b,q)=>{A(T,b,q).anisotropy.angle=J},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:a("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(J,T,b)=>A(J,T,b).clearCoat.Kl,set:(J,T,b,q)=>{A(T,b,q).clearCoat.Kl=J},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(J,T,b)=>A(J,T,b).clearCoat.roughness,set:(J,T,b,q)=>{A(T,b,q).clearCoat.roughness=J},getTarget:(J,T,b)=>A(J,T,b),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:a("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(J,T,b)=>{var q;return null===(q=A(J,T,b).clearCoat.bumpTexture)||void 0===q?void 0:q.level},getTarget:A,set:(J,T,b,q)=>A(T,b,q).clearCoat.bumpTexture.level=J},extensions:{KHR_texture_transform:a("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:a("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(J,T,b)=>A(J,T,b).subSurface.dispersion,getTarget:A,set:(J,T,b,q)=>A(T,b,q).subSurface.dispersion=J}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(J,T,b)=>A(J,T,b).emissiveIntensity,getTarget:A,set:(J,T,b,q)=>A(T,b,q).emissiveIntensity=J}},KHR_materials_ior:{ior:{type:"number",get:(J,T,b)=>A(J,T,b).indexOfRefraction,getTarget:A,set:(J,T,b,q)=>A(T,b,q).indexOfRefraction=J}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(J,T,b)=>A(J,T,b).iridescence.Kl,getTarget:A,set:(J,T,b,q)=>A(T,b,q).iridescence.Kl=J},iridescenceIor:{type:"number",get:(J,T,b)=>A(J,T,b).iridescence.indexOfRefraction,getTarget:A,set:(J,T,b,q)=>A(T,b,q).iridescence.indexOfRefraction=J},iridescenceTexture:{extensions:{KHR_texture_transform:a("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(J,T,b)=>A(J,T,b).iridescence.maximumThickness,getTarget:A,set:(J,T,b,q)=>A(T,b,q).iridescence.maximumThickness=J},iridescenceThicknessMinimum:{type:"number",get:(J,T,b)=>A(J,T,b).iridescence.minimumThickness,getTarget:A,set:(J,T,b,q)=>A(T,b,q).iridescence.minimumThickness=J},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:a("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Vi",get:(J,T,b)=>A(J,T,b).sheen.color,getTarget:A,set:(J,T,b,q)=>A(T,b,q).sheen.color.p(J)},sheenColorTexture:{extensions:{KHR_texture_transform:a("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(J,T,b)=>A(J,T,b).sheen.Kl,getTarget:A,set:(J,T,b,q)=>A(T,b,q).sheen.Kl=J},sheenRoughnessTexture:{extensions:{KHR_texture_transform:a("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(J,T,b)=>A(J,T,b).metallicF0Factor,getTarget:A,set:(J,T,b,q)=>A(T,b,q).metallicF0Factor=J,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Vi",get:(J,T,b)=>A(J,T,b).metallicReflectanceColor,getTarget:A,set:(J,T,b,q)=>A(T,b,q).metallicReflectanceColor.p(J),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:a("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:a("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(J,T,b)=>A(J,T,b).subSurface.refractionIntensity,getTarget:A,set:(J,T,b,q)=>A(T,b,q).subSurface.refractionIntensity=J,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:a("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(J,T,b)=>A(J,T,b).subSurface.translucencyIntensity,getTarget:A,set:(J,T,b,q)=>A(T,b,q).subSurface.translucencyIntensity=J},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:a("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Vi",get:(J,T,b)=>A(J,T,b).subSurface.translucencyColor,getTarget:A,set:(J,T,b,q)=>{var t;return J&&(null===(t=A(T,b,q).subSurface.translucencyColor)||void 0===t?void 0:t.p(J))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:a("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Vi",get:(J,T,b)=>A(J,T,b).subSurface.tintColor,getTarget:A,set:(J,T,b,q)=>A(T,b,q).subSurface.tintColor.p(J)},attenuationDistance:{type:"number",get:(J,T,b)=>A(J,T,b).subSurface.tintColorAtDistance,getTarget:A,set:(J,T,b,q)=>A(T,b,q).subSurface.tintColorAtDistance=J},thicknessFactor:{type:"number",get:(J,T,b)=>A(J,T,b).subSurface.maximumThickness,getTarget:A,set:(J,T,b,q)=>A(T,b,q).subSurface.maximumThickness=J},thicknessTexture:{extensions:{KHR_texture_transform:a("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:J=>J.length,getTarget:J=>J.map((J=>J._babylonLight)),getPropertyName:[J=>"length"]},__array__:{__target__:!0,color:{type:"Vi",get:J=>{var T;return null===(T=J._babylonLight)||void 0===T?void 0:T.Sk},set:(J,T)=>{var b;return null===(b=T._babylonLight)||void 0===b?void 0:b.Sk.p(J)},getTarget:J=>J._babylonLight,getPropertyName:[J=>"diffuse"]},Kl:{type:"number",get:J=>{var T;return null===(T=J._babylonLight)||void 0===T?void 0:T.Kl},set:(J,T)=>T._babylonLight?T._babylonLight.Kl=J:void 0,getTarget:J=>J._babylonLight,getPropertyName:[J=>"intensity"]},range:{type:"number",get:J=>{var T;return null===(T=J._babylonLight)||void 0===T?void 0:T.range},set:(J,T)=>T._babylonLight?T._babylonLight.range=J:void 0,getTarget:J=>J._babylonLight,getPropertyName:[J=>"range"]},spot:{innerConeAngle:{type:"number",get:J=>{var T;return null===(T=J._babylonLight)||void 0===T?void 0:T.innerAngle},set:(J,T)=>T._babylonLight?T._babylonLight.innerAngle=J:void 0,getTarget:J=>J._babylonLight,getPropertyName:[J=>"innerConeAngle"]},outerConeAngle:{type:"number",get:J=>{var T;return null===(T=J._babylonLight)||void 0===T?void 0:T.angle},set:(J,T)=>T._babylonLight?T._babylonLight.angle=J:void 0,getTarget:J=>J._babylonLight,getPropertyName:[J=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:J=>J.length,getTarget:J=>J.map((J=>J._babylonLight)),getPropertyName:[J=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:J=>J.length,getTarget:J=>J.map((J=>J._babylonTexture)),getPropertyName:[J=>"length"]},__array__:{__target__:!0,Kl:{type:"number",get:J=>{var T;return null===(T=J._babylonTexture)||void 0===T?void 0:T.level},set:(J,T)=>{T._babylonTexture&&(T._babylonTexture.level=J)},getTarget:J=>J._babylonTexture},rotation:{type:"Quaternion",get:J=>{var T;return J._babylonTexture&&q.h.FromRotationMatrix(null===(T=J._babylonTexture)||void 0===T?void 0:T.getReflectionTextureMatrix())},set:(J,T)=>{var b;T._babylonTexture&&(null!==(b=T._babylonTexture.va())&&void 0!==b&&b.useRightHandedSystem||(J=q.h.Inverse(J)),q.e.FromQuaternionToRef(J,T._babylonTexture.getReflectionTextureMatrix()))},getTarget:J=>J._babylonTexture}}}}},animations:{length:{type:"number",get:J=>J.length,getTarget:J=>J.map((J=>J._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:J=>J.length,getTarget:J=>J.map((J=>{var T;return null===(T=J.primitives[0]._instanceData)||void 0===T?void 0:T.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function v(J){return new C(J,P)}function G(J){const T=J.split("/").map((J=>J.replace(/{}/g,"__array__")));let b=P;for(const q of T)q&&(b=b[q]);if(b&&b.type&&b.get)return b}function x(J,T){const b=J.split("/").map((J=>J.replace(/{}/g,"__array__")));let q=P;for(const t of b)t&&(q=q[t]);q&&q.type&&q.get&&(q.interpolation=T)}function I(J,T){const b=J.split("/").map((J=>J.replace(/{}/g,"__array__")));let q=P;for(const t of b)if(t){if(!q[t]){if("?"===t){q.__ignoreObjectTree__=!0;continue}q[t]={},"__array__"===t&&(q[t].__target__=!0)}q=q[t]}Object.assign(q,T)}},12536:(J,T,b)=>{"use strict";b.r(T),b.d(T,{AnimationPropertyInfo:()=>F,TransformNodeAnimationPropertyInfo:()=>A,WeightAnimationPropertyInfo:()=>a,getQuaternion:()=>Y,getVector3:()=>B,getWeights:()=>C});var q=b(12484),t=b(697),j=b(12513);function B(J,T,b,q){return t.n.ni(T,b).scaleInPlace(q)}function Y(J,T,b,q){return t.h.ni(T,b).scaleInPlace(q)}function C(J,T,b,q){const t=new Array(J._numMorphTargets);for(let j=0;j<t.length;j++)t[j]=T[b++]*q;return t}class F{constructor(J,T,b,q){this.type=J,this.name=T,this.getValue=b,this.getStride=q}_buildAnimation(J,T,b){const t=new q.b(J,this.name,T,this.type);return t.setKeys(b),t}}class A extends F{buildAnimations(J,T,b,q){const t=[];return t.push({babylonAnimatable:J._babylonTransformNode,babylonAnimation:this._buildAnimation(T,b,q)}),t}}class a extends F{buildAnimations(J,T,b,t){const j=[];if(J._numMorphTargets)for(let B=0;B<J._numMorphTargets;B++){const Y=new q.b(`${T}_${B}`,this.name,b,this.type);if(Y.setKeys(t.map((J=>({frame:J.frame,inTangent:J.inTangent?J.inTangent[B]:void 0,value:J.value[B],outTangent:J.outTangent?J.outTangent[B]:void 0,interpolation:J.interpolation})))),J._primitiveBabylonMeshes)for(const T of J._primitiveBabylonMeshes)if(T.morphTargetManager){const J=T.morphTargetManager.getTarget(B),b=Y.clone();J.animations.push(b),j.push({babylonAnimatable:J,babylonAnimation:b})}}return j}}(0,j.m)("/nodes/{}/translation",[new A(q.b.ANIMATIONTYPE_VECTOR3,"position",B,(()=>3))]),(0,j.m)("/nodes/{}/rotation",[new A(q.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",Y,(()=>4))]),(0,j.m)("/nodes/{}/scale",[new A(q.b.ANIMATIONTYPE_VECTOR3,"ii",B,(()=>3))]),(0,j.m)("/nodes/{}/weights",[new a(q.b.ANIMATIONTYPE_FLOAT,"influence",C,(J=>J._numMorphTargets))])},12447:(J,T,b)=>{"use strict";class q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((J,T)=>{this._resolve=J,this._reject=T}))}}var t=b(697),j=b(731),B=b(505),Y=b(670),C=b(12456),F=b(12482),A=b(497),a=b(12101),P=b(12484),v=b(12487),G=b(550),x=b(519),I=b(526);class u{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(J){this._useTextureToStoreBoneMatrices=J,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(J){this._animationPropertiesOverride=J}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(J,T,b){this.name=J,this.id=T,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=t.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new A.b,this.bones=[],this._scene=b||G.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const q=this._scene.getEngine().getCaps();this._canUseTextureForBones=q.textureFloat&&q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((J=>!J.getParent()))}getTransformMatrices(J){if(this.needInitialSkinMatrix){if(!J)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return J._bonesTransformMatrices||this.prepare(!0),J._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(J){return this.needInitialSkinMatrix&&J._transformMatrixTexture?J._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(J){let T=`Name: ${this.name}, nBones: ${this.bones.length}`;if(T+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,J){T+=", Ranges: {";let J=!0;for(const b in this._ranges)J&&(T+=", ",J=!1),T+=b;T+="}"}return T}getBoneIndexByName(J){for(let T=0,b=this.bones.length;T<b;T++)if(this.bones[T].name===J)return T;return-1}createAnimationRange(J,T,b){if(!this._ranges[J]){this._ranges[J]=new v.b(J,T,b);for(let q=0,t=this.bones.length;q<t;q++)this.bones[q].animations[0]&&this.bones[q].animations[0].createRange(J,T,b)}}deleteAnimationRange(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,q=this.bones.length;b<q;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(J,T);this._ranges[J]=null}getAnimationRange(J){return this._ranges[J]||null}getAnimationRanges(){const J=[];let T;for(T in this._ranges)J.push(this._ranges[T]);return J}copyAnimationRange(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[T]||!J.getAnimationRange(T))return!1;let q=!0;const t=this._getHighestAnimationFrame()+1,j={},B=J.bones;let Y,C;for(C=0,Y=B.length;C<Y;C++)j[B[C].name]=B[C];this.bones.length!==B.length&&(x.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${B.length}`),q=!1);const F=b&&this.dimensionsAtRest&&J.dimensionsAtRest?this.dimensionsAtRest.divide(J.dimensionsAtRest):null;for(C=0,Y=this.bones.length;C<Y;C++){const J=this.bones[C].name,B=j[J];B?q=q&&this.bones[C].copyAnimationRange(B,T,t,b,F):(x.d.Warn("copyAnimationRange: not same rig, missing source bone "+J),q=!1)}const A=J.getAnimationRange(T);return A&&(this._ranges[T]=new v.b(T,A.from+t,A.to+t)),q}returnToRest(){for(const J of this.bones)-1!==J._index&&J.returnToRest()}_getHighestAnimationFrame(){let J=0;for(let T=0,b=this.bones.length;T<b;T++)if(this.bones[T].animations[0]){const b=this.bones[T].animations[0].getHighestFrame();J<b&&(J=b)}return J}beginAnimation(J,T,b,q){const t=this.getAnimationRange(J);return t?this._scene.beginAnimation(this,t.from,t.to,T,b,q):null}static MakeAnimationAdditive(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const q=J.getAnimationRange(b);if(!q)return null;const t=J._scene.getAllAnimatablesByTarget(J);let j=null;for(let Y=0;Y<t.length;Y++){const J=t[Y];if(J.fromFrame===(null===q||void 0===q?void 0:q.from)&&J.toFrame===(null===q||void 0===q?void 0:q.to)){j=J;break}}const B=J.getAnimatables();for(let Y=0;Y<B.length;Y++){const J=B[Y].animations;if(J)for(let q=0;q<J.length;q++)P.b.MakeAnimationAdditive(J[q],T,b)}return j&&(j.isAdditive=!0),J}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(J){this._meshesWithPoseMatrix.push(J)}_unregisterMeshWithPoseMatrix(J){const T=this._meshesWithPoseMatrix.indexOf(J);T>-1&&this._meshesWithPoseMatrix.splice(T,1)}_computeTransformMatrices(J,T){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const q=this.bones[b];q._childUpdateId++;const t=q.getParent();if(t?q.getLocalMatrix().multiplyToRef(t.getFinalMatrix(),q.getFinalMatrix()):T?q.getLocalMatrix().multiplyToRef(T,q.getFinalMatrix()):q.getFinalMatrix().p(q.getLocalMatrix()),-1!==q._index){const T=null===q._index?b:q._index;q.getAbsoluteInverseBindMatrix().multiplyToArray(q.getFinalMatrix(),J,16*T)}}this._identity.copyToArray(J,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const J=this.va().getRenderId();if(this._currentRenderId===J)return;this._currentRenderId=J}if(this._numBonesWithLinkedTransformNode>0)for(const J of this.bones)if(J._linkedTransformNode){const T=J._linkedTransformNode;J.position=T.position,T.rotationQuaternion?J.rotationQuaternion=T.rotationQuaternion:J.rotation=T.rotation,J.ii=T.ii}if(this.needInitialSkinMatrix)for(const J of this._meshesWithPoseMatrix){const T=J.getPoseMatrix();let b=this._isDirty;if(J._bonesTransformMatrices&&J._bonesTransformMatrices.length===16*(this.bones.length+1)||(J._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==J){this._synchronizedWithMesh=J;for(const J of this.bones)if(!J.getParent()){J.getBindMatrix().multiplyToRef(T,t.j.Matrix[1]),J._updateAbsoluteBindMatrices(t.j.Matrix[1])}if(this.isUsingTextureForMatrices){const T=4*(this.bones.length+1);J._transformMatrixTexture&&J._transformMatrixTexture.getSize().width===T||(J._transformMatrixTexture&&J._transformMatrixTexture.dispose(),J._transformMatrixTexture=a.e.CreateRGBATexture(J._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(J._bonesTransformMatrices,T),this.isUsingTextureForMatrices&&J._transformMatrixTexture&&J._transformMatrixTexture.update(J._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=a.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let J=0;J<this.bones.length;J++)this._animatables.push(this.bones[J])}return this._animatables}clone(J,T){const b=new u(J,T||J,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let q=0;q<this.bones.length;q++){const J=this.bones[q];let T=null;const t=J.getParent();if(t){const J=this.bones.indexOf(t);T=b.bones[J]}const j=new F.b(J.name,b,T,J.getBindMatrix().clone(),J.getRestMatrix().clone());j._index=J._index,J._linkedTransformNode&&j.linkTransformNode(J._linkedTransformNode),I.d.DeepCopy(J.animations,j.animations)}if(this._ranges){b._ranges={};for(const J in this._ranges){const T=this._ranges[J];T&&(b._ranges[J]=T.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const T of this.bones)for(const b of T.animations)b.enableBlending=!0,b.blendingSpeed=J}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const J=this._parentContainer.skeletons.indexOf(this);J>-1&&this._parentContainer.skeletons.splice(J,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const J={};J.name=this.name,J.id=this.id,this.dimensionsAtRest&&(J.dimensionsAtRest=this.dimensionsAtRest.Ai()),J.bones=[],J.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var T;const q=this.bones[b],t=q.getParent(),j={parentBoneIndex:t?this.bones.indexOf(t):-1,index:q.getIndex(),name:q.name,id:q.id,matrix:q.getBindMatrix().Ai(),rest:q.getRestMatrix().Ai(),linkedTransformNodeId:null===(T=q.getTransformNode())||void 0===T?void 0:T.id};J.bones.push(j),q.length&&(j.length=q.length),q.metadata&&(j.metadata=q.metadata),q.animations&&q.animations.length>0&&(j.animation=q.animations[0].serialize()),J.ranges=[];for(const T in this._ranges){const b=this._ranges[T];if(!b)continue;const q={};q.name=T,q.from=b.from,q.to=b.to,J.ranges.push(q)}}return J}static Parse(J,T){const b=new u(J.name,J.id,T);let q;for(J.dimensionsAtRest&&(b.dimensionsAtRest=t.n.ni(J.dimensionsAtRest)),b.needInitialSkinMatrix=J.needInitialSkinMatrix,q=0;q<J.bones.length;q++){const T=J.bones[q],j=J.bones[q].index;let B=null;T.parentBoneIndex>-1&&(B=b.bones[T.parentBoneIndex]);const Y=T.rest?t.e.ni(T.rest):null,C=new F.b(T.name,b,B,t.e.ni(T.matrix),Y,null,j);void 0!==T.id&&null!==T.id&&(C.id=T.id),T.length&&(C.length=T.length),T.metadata&&(C.metadata=T.metadata),T.animation&&C.animations.push(P.b.Parse(T.animation)),void 0!==T.linkedTransformNodeId&&null!==T.linkedTransformNodeId&&(b._hasWaitingData=!0,C._waitingTransformNodeId=T.linkedTransformNodeId)}if(J.ranges)for(q=0;q<J.ranges.length;q++){const T=J.ranges[q];b.createAnimationRange(T.name,T.from,T.to)}return b}computeAbsoluteMatrices(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||J)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(J)}getPoseMatrix(){let J=null;return this._meshesWithPoseMatrix.length>0&&(J=this._meshesWithPoseMatrix[0].getPoseMatrix()),J}sortBones(){const J=[],T=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,J,T);this.bones=J}_sortBones(J,T,b){if(b[J])return;b[J]=!0;const q=this.bones[J];if(!q)return;void 0===q._index&&(q._index=J);const t=q.getParent();t&&this._sortBones(this.bones.indexOf(t),T,b),T.push(q)}setCurrentPoseAsRest(){for(const J of this.bones)J.setCurrentPoseAsRest()}}var U=b(855),K=b(674),E=b(680),l=b(12493),W=b(12495),p=b(639),o=b(727);class S extends W.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(J){this.subSurface.refractionTexture=J,J?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(J){this.subSurface.indexOfRefraction=J}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(J){this.subSurface.invertRefractionY=J}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(J){this.subSurface.linkRefractionWithTransparency=J,J&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===W.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(J){J!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=J?W.d.LIGHTFALLOFF_PHYSICAL:W.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===W.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(J){J!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=J?W.d.LIGHTFALLOFF_GLTF:W.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(J){this._attachImageProcessingConfiguration(J),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(J){this.imageProcessingConfiguration.colorCurvesEnabled=J}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(J){this.imageProcessingConfiguration.colorGradingEnabled=J}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(J){this._imageProcessingConfiguration.toneMappingEnabled=J}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(J){this._imageProcessingConfiguration.exposure=J}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(J){this._imageProcessingConfiguration.contrast=J}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(J){this._imageProcessingConfiguration.colorGradingTexture=J}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(J){this._imageProcessingConfiguration.colorCurves=J}constructor(J,T){super(J,T,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=j.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new j.b(0,0,0),this.albedoColor=new j.b(1,1,1),this.baseWeight=1,this.reflectivityColor=new j.b(1,1,1),this.reflectionColor=new j.b(1,1,1),this.emissiveColor=new j.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,l.d)(this.va())}getClassName(){return"PBRMaterial"}clone(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const q=o.d.Clone((()=>new S(J,this.va())),this,{cloneTexturesOnlyOnce:T});return q.id=J,q.name=J,this.stencil.copyTo(q.stencil),this._clonePlugins(q,b),q}serialize(){const J=super.serialize();return J.customType="BABYLON.PBRMaterial",J}static Parse(J,T,b){const q=o.d.Parse((()=>new S(J.name,T)),J,T,b);return J.stencil&&q.stencil.parse(J.stencil,T,b),U.c._ParsePlugins(J,q,T,b),J.clearCoat&&q.clearCoat.parse(J.clearCoat,T,b),J.anisotropy&&q.anisotropy.parse(J.anisotropy,T,b),J.brdf&&q.brdf.parse(J.brdf,T,b),J.sheen&&q.sheen.parse(J.sheen,T,b),J.subSurface&&q.subSurface.parse(J.subSurface,T,b),J.iridescence&&q.iridescence.parse(J.iridescence,T,b),q}}S.PBRMATERIAL_OPAQUE=W.d.PBRMATERIAL_OPAQUE,S.PBRMATERIAL_ALPHATEST=W.d.PBRMATERIAL_ALPHATEST,S.PBRMATERIAL_ALPHABLEND=W.d.PBRMATERIAL_ALPHABLEND,S.PBRMATERIAL_ALPHATESTANDBLEND=W.d.PBRMATERIAL_ALPHATESTANDBLEND,S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=W.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"directIntensity",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveIntensity",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentIntensity",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularIntensity",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"disableBumpMap",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseWeightTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseDiffuseRoughnessTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureStrength",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicTexture",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallic",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicF0Factor",void 0),(0,K.e)([(0,E.o)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceColor",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectanceTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurfaceTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,K.e)([(0,E.D)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty",null)],S.prototype,"lightmapTexture",void 0),(0,K.e)([(0,E.o)("ambient"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientColor",void 0),(0,K.e)([(0,E.o)("albedo"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoColor",void 0),(0,K.e)([(0,E.M)("baseWeight"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseWeight",void 0),(0,K.e)([(0,E.M)("baseDiffuseRoughness"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseDiffuseRoughness",void 0),(0,K.e)([(0,E.o)("reflectivity"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityColor",void 0),(0,K.e)([(0,E.o)("reflection"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionColor",void 0),(0,K.e)([(0,E.o)("emissive"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveColor",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurface",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromAlbedoTexture",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"forceAlphaTest",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"alphaCutOff",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientInGrayScale",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,K.e)([(0,E.M)()],S.prototype,"usePhysicalLightFalloff",null),(0,K.e)([(0,E.M)()],S.prototype,"useGLTFLightFalloff",null),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOverAlpha",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"parallaxScaleBias",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceIrradianceInFragment",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAlphaFresnel",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLinearAlphaFresnel",void 0),(0,K.e)([(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentBRDFTexture",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceNormalForward",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"enableSpecularAntiAliasing",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useHorizonOcclusion",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOcclusion",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"unlit",void 0),(0,K.e)([(0,E.M)(),(0,E.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,p.g)("BABYLON.PBRMaterial",S);var H=b(2319),s=b(837),g=b(751),d=b(812),w=b(834),Z=b(494);class e{get influence(){return this._influence}set influence(J){if(this._influence===J)return;const T=this._influence;this._influence=J,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===T||0===J)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(J){this._animationPropertiesOverride=J}constructor(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=J,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new A.b,this._onDataLayoutChanged=new A.b,this._animationPropertiesOverride=null,this.id=J,this._scene=b||G.e.LastCreatedScene,this.influence=T,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(J){const T=this.hasPositions;this._positions=J,T!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(J){const T=this.hasNormals;this._normals=J,T!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(J){const T=this.hasTangents;this._tangents=J,T!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(J){const T=this.hasUVs;this._uvs=J,T!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(J){const T=this.hasUV2s;this._uv2s=J,T!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(J){const T=this.hasColors;this._colors=J,T!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const J=o.d.Clone((()=>new e(this.name,this.influence,this._scene)),this);return J._positions=this._positions,J._normals=this._normals,J._tangents=this._tangents,J._uvs=this._uvs,J._uv2s=this._uv2s,J._colors=this._colors,J}serialize(){const J={};return J.name=this.name,J.influence=this.influence,J.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(J.id=this.id),this.hasNormals&&(J.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(J.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(J.Aa=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(J.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(J.za=Array.prototype.slice.call(this.getColors())),o.d.AppendSerializedAnimations(this,J),J}getClassName(){return"MorphTarget"}static Parse(J,T){const b=new e(J.name,J.influence);if(b.setPositions(J.xa),null!=J.id&&(b.id=J.id),J.ya&&b.setNormals(J.ya),J.tangents&&b.setTangents(J.tangents),J.Aa&&b.setUVs(J.Aa),J.uv2s&&b.setUV2s(J.uv2s),J.za&&b.setColors(J.za),J.animations){for(let T=0;T<J.animations.length;T++){const q=J.animations[T],t=(0,p.c)("BABYLON.Animation");t&&b.animations.push(t.Parse(q))}J.autoAnimate&&T&&T.beginAnimation(b,J.autoAnimateFrom,J.autoAnimateTo,J.autoAnimateLoop,J.autoAnimateSpeed||1)}return b}static FromMesh(J,T,b){T||(T=J.name);const q=new e(T,b,J.va());return q.setPositions(J.getVerticesData(g.e.PositionKind)),J.isVerticesDataPresent(g.e.NormalKind)&&q.setNormals(J.getVerticesData(g.e.NormalKind)),J.isVerticesDataPresent(g.e.TangentKind)&&q.setTangents(J.getVerticesData(g.e.TangentKind)),J.isVerticesDataPresent(g.e.UVKind)&&q.setUVs(J.getVerticesData(g.e.UVKind)),J.isVerticesDataPresent(g.e.UV2Kind)&&q.setUV2s(J.getVerticesData(g.e.UV2Kind)),J.isVerticesDataPresent(g.e.ColorKind)&&q.setColors(J.getVerticesData(g.e.ColorKind)),q}}(0,K.e)([(0,E.M)()],e.prototype,"id",void 0);var c=b(689),V=b(12400);class Q{set areUpdatesFrozen(J){J?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new c.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,J||(J=G.e.LastCreatedScene),this._scene=J,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const J=this._scene.getEngine().getCaps();this._canUseTextureForTargets=J.canUseGLVertexID&&J.textureFloat&&J.maxVertexTextureImageUnits>0&&J.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return Q.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?Q.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(J){this._numMaxInfluencers!==J&&(this._numMaxInfluencers=J,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(J){this._useTextureToStoreTargets!==J&&(this._useTextureToStoreTargets=J,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var J;return Q.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(J=this._scene)&&void 0!==J&&J.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(J){return this._activeTargets.data[J]}getTarget(J){return this._targets[J]}getTargetByName(J){for(const T of this._targets)if(T.name===J)return T;return null}addTarget(J){this._targets.push(J),this._targetInfluenceChangedObservers.push(J.onInfluenceChanged.add((J=>{this.areUpdatesFrozen&&J&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(J)}))),this._targetDataLayoutChangedObservers.push(J._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(J){const T=this._targets.indexOf(J);T>=0&&(this._targets.splice(T,1),J.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(T,1)[0]),J._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(T,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(J)}_bind(J){J.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),J.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),J.setTexture("morphTargets",this._targetStoreTexture),J.setInt("morphTargetCount",this.numInfluencers)}clone(){const J=new Q(this._scene);for(const T of this._targets)J.addTarget(T.clone());return J.enablePositionMorphing=this.enablePositionMorphing,J.enableNormalMorphing=this.enableNormalMorphing,J.enableTangentMorphing=this.enableTangentMorphing,J.enableUVMorphing=this.enableUVMorphing,J.enableUV2Morphing=this.enableUV2Morphing,J.enableColorMorphing=this.enableColorMorphing,J}serialize(){const J={};J.id=this.uniqueId,J.targets=[];for(const T of this._targets)J.targets.push(T.serialize());return J}_syncActiveTargets(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const T=!!this._targetStoreTexture,b=this.isUsingTextureForTargets;(this._mustSynchronize||T!==b)&&(this._mustSynchronize=!1,this.synchronize());let q=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let t=-1;for(const j of this._targets)if(t++,0!==j.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=Q.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(j),this._morphTargetTextureIndices[q]=t,this._tempInfluences[q++]=j.influence}this._morphTargetTextureIndices.length!==q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,q)),this._influences&&this._influences.length===q||(this._influences=new Float32Array(q));for(let j=0;j<q;j++)this._influences[j]=this._tempInfluences[j];if(J&&this._scene)for(const j of this._scene.meshes)j.morphTargetManager===this&&(b?j._markSubMeshesAsAttributesDirty():j._syncGeometryWithMorphTargetManager())}synchronize(){var J;if(!this._scene||this.areUpdatesFrozen)return;const T=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(J=this._targetStoreTexture)||void 0===J||J.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>T.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const b of this._targets){this._supportsPositions=this._supportsPositions&&b.hasPositions,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs,this._supportsUV2s=this._supportsUV2s&&b.hasUV2s,this._supportsColors=this._supportsColors&&b.hasColors;const J=b.vertexCount;if(0===this._vertexCount)this._vertexCount=J;else if(this._vertexCount!==J)return void x.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${b.name}": ${J}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const J=T.getCaps().maxTextureSize;this._textureWidth>J&&(this._textureHeight=Math.ceil(this._textureWidth/J),this._textureWidth=J);const b=this._targets.length,q=new Float32Array(b*this._textureWidth*this._textureHeight*4);let t=0;for(let T=0;T<b;T++){const J=this._targets[T],b=J.getPositions(),j=J.getNormals(),B=J.getUVs(),Y=J.getTangents(),C=J.getUV2s(),F=J.getColors();t=T*this._textureWidth*this._textureHeight*4;for(let T=0;T<this._vertexCount;T++)this._supportsPositions&&b&&(q[t]=b[3*T],q[t+1]=b[3*T+1],q[t+2]=b[3*T+2],t+=4),this._supportsNormals&&j&&(q[t]=j[3*T],q[t+1]=j[3*T+1],q[t+2]=j[3*T+2],t+=4),this._supportsUVs&&B&&(q[t]=B[2*T],q[t+1]=B[2*T+1],t+=4),this._supportsTangents&&Y&&(q[t]=Y[3*T],q[t+1]=Y[3*T+1],q[t+2]=Y[3*T+2],t+=4),this._supportsUV2s&&C&&(q[t]=C[2*T],q[t+1]=C[2*T+1],t+=4),this._supportsColors&&F&&(q[t]=F[4*T],q[t+1]=F[4*T+1],q[t+2]=F[4*T+2],q[t+3]=F[4*T+3],t+=4)}this._targetStoreTexture=V.d.CreateRGBATexture(q,this._textureWidth,this._textureHeight,b,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const b of this._scene.meshes)b.morphTargetManager===this&&b._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const J=this._parentContainer.morphTargetManagers.indexOf(this);J>-1&&this._parentContainer.morphTargetManagers.splice(J,1),this._parentContainer=null}for(const J of this._targets)this._scene.stopAnimation(J)}}static Parse(J,T){const b=new Q(T);for(const q of J.targets)b.addTarget(e.Parse(q,T));return b}}Q.EnableTextureStorage=!0,Q.MaxActiveMorphTargetsInVertexAttributeMode=8,Q.ConstantTargetCountForTextureMode=0;var h=b(12498),i=b(556),m=b(789);const O=new Map,X=O;function L(J,T,b){r(J)&&x.d.Warn(`Extension with the name '${J}' already exists`),O.set(J,{isGLTFExtension:T,factory:b})}function r(J){return O.delete(J)}var N=b(12513);function R(){const J=J=>!!J&&"object"===typeof J;for(var T=arguments.length,b=new Array(T),q=0;q<T;q++)b[q]=arguments[q];return b.reduce(((T,b)=>{const q=Object.keys(b);for(const t of q){const q=T[t],j=b[t];Array.isArray(q)&&Array.isArray(j)?T[t]=q.concat(...j):J(q)&&J(j)?T[t]=R(q,j):T[t]=j}return T}),{})}var n=b(763);class D{static Get(J,T,b){if(!T||void 0==b||!T[b])throw new Error(`${J}: Failed to find index (${b})`);return T[b]}static TryGet(J,T){return J&&void 0!=T&&J[T]?J[T]:null}static Assign(J){if(J)for(let T=0;T<J.length;T++)J[T].index=T}}function f(J){if(J.min&&J.max){const T=J.min,b=J.max,q=t.j.pi[0].hi(T[0],T[1],T[2]),j=t.j.pi[1].hi(b[0],b[1],b[2]);if(J.normalized&&5126!==J.componentType){let T=1;switch(J.componentType){case 5120:T=127;break;case 5121:T=255;break;case 5122:T=32767;break;case 5123:T=65535}const b=1/T;q.scaleInPlace(b),j.scaleInPlace(b)}return new m.b(q,j)}return null}class z{static RegisterExtension(J,T){L(J,!1,T)}static UnregisterExtension(J){return r(J)}get Hi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(J){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=J}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((J=>J.dispose&&J.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(J,T,b,q,t,j){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=T,this._assetContainer=b,this._loadData(q);let j=null;if(J){const T={};if(this._gltf.nodes)for(const J of this._gltf.nodes)J.name&&(T[J.name]=J.index);j=(J instanceof Array?J:[J]).map((J=>{const b=T[J];if(void 0===b)throw new Error(`Failed to find node '${J}'`);return b}))}return await this._loadAsync(t,B,j,(()=>({meshes:this._getMeshes(),si:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=J,this._loadData(T),await this._loadAsync(b,t,null,(()=>{}))}async _loadAsync(J,T,b,q){return await Promise.resolve().then((async()=>{this._rootUrl=J,this._uniqueRootUrl=!J.startsWith("file:")&&T?J:`${J}${Date.now()}/`,this._fileName=T,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const t=`${h.n[h.n.LOADING]} => ${h.n[h.n.READY]}`,j=`${h.n[h.n.LOADING]} => ${h.n[h.n.COMPLETE]}`;this._parent._startPerformanceCounter(t),this._parent._startPerformanceCounter(j),this._parent._setState(h.n.LOADING),this._extensionsOnLoading();const Y=new Array;if(!this.parent.loadOnlyMaterials)if(b)Y.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.cg||this._gltf.scenes&&this._gltf.scenes[0]){const J=D.Get("/scene",this._gltf.scenes,this._gltf.cg||0);Y.push(this.loadSceneAsync(`/scenes/${J.index}`,J))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let J=0;J<this._gltf.materials.length;++J){const T=this._gltf.materials[J],b="/materials/"+J,q=U.c.TriangleFillMode;Y.push(this._loadMaterialAsync(b,T,null,q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&Y.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&Y.push(this._compileShadowGeneratorsAsync());const C=Promise.all(Y).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.di(!0);for(const J of this._babylonScene.materials){const T=J;void 0!==T.maxSimultaneousLights&&(T.maxSimultaneousLights=Math.max(T.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(h.n.READY),this._skipStartAnimationStep||this._startAnimations(),q()}));return await C.then((J=>(this._parent._endPerformanceCounter(t),B.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(j),this._parent._setState(h.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(J=>{this._parent.onErrorObservable.notifyObservers(J),this._parent.onErrorObservable.clear(),this.dispose()}))})),J)))})).catch((J=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(J),this._parent.onErrorObservable.clear(),this.dispose()),J}))}_loadData(J){if(this._gltf=J.json,this._setupData(),J.bin){const T=this._gltf.buffers;if(T&&T[0]&&!T[0].uri){const b=T[0];(b.byteLength<J.bin.byteLength-3||b.byteLength>J.bin.byteLength)&&x.d.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${J.bin.byteLength})`),this._bin=J.bin}else x.d.Warn("Unexpected BIN chunk")}}_setupData(){if(D.Assign(this._gltf.accessors),D.Assign(this._gltf.animations),D.Assign(this._gltf.buffers),D.Assign(this._gltf.bufferViews),D.Assign(this._gltf.cameras),D.Assign(this._gltf.images),D.Assign(this._gltf.materials),D.Assign(this._gltf.meshes),D.Assign(this._gltf.nodes),D.Assign(this._gltf.samplers),D.Assign(this._gltf.scenes),D.Assign(this._gltf.skins),D.Assign(this._gltf.textures),this._gltf.nodes){const J={};for(const b of this._gltf.nodes)if(b.children)for(const T of b.children)J[T]=b.index;const T=this._createRootNode();for(const b of this._gltf.nodes){const q=J[b.index];b.parent=void 0===q?T:this._gltf.nodes[q]}}}async _loadExtensionsAsync(){const J=[];if(X.forEach(((T,b)=>{var q;!1===(null===(q=this.parent.extensionOptions[b])||void 0===q?void 0:q.enabled)?T.isGLTFExtension&&this.isExtensionUsed(b)&&x.d.Warn(`Extension ${b} is used but has been explicitly disabled.`):T.isGLTFExtension&&!this.isExtensionUsed(b)||J.push((async()=>{const J=await T.factory(this);return J.name!==b&&x.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${J.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(J),J})())})),this._extensions.push(...await Promise.all(J)),this._extensions.sort(((J,T)=>(J.order||Number.MAX_VALUE)-(T.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((J=>J.name===b&&J.enabled))){var T;if(!1===(null===(T=this.parent.extensionOptions[b])||void 0===T?void 0:T.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const J=new Z.e("__root__",this._babylonScene);this._rootBabylonMesh=J,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.di(!1);const T={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case h.k.AUTO:this._babylonScene.useRightHandedSystem||(T.rotation=[0,1,0,0],T.scale=[1,1,-1],z._LoadTransform(T,this._rootBabylonMesh));break;case h.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(J),T}loadSceneAsync(J,T){const b=this._extensionsLoadSceneAsync(J,T);if(b)return b;const q=new Array;if(this.logOpen(`${J} ${T.name||""}`),T.nodes)for(const t of T.nodes){const T=D.Get(`${J}/nodes/${t}`,this._gltf.nodes,t);q.push(this.loadNodeAsync(`/nodes/${T.index}`,T,(J=>{J.parent=this._rootBabylonMesh})))}for(const t of this._postSceneLoadActions)t();return q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(q).then((()=>{}))}_forEachPrimitive(J,T){if(J._primitiveBabylonMeshes)for(const b of J._primitiveBabylonMeshes)T(b)}_getGeometries(){const J=[],T=this._gltf.nodes;if(T)for(const b of T)this._forEachPrimitive(b,(T=>{const b=T.qi;b&&-1===J.indexOf(b)&&J.push(b)}));return J}_getMeshes(){const J=[];this._rootBabylonMesh instanceof w.d&&J.push(this._rootBabylonMesh);const T=this._gltf.nodes;if(T)for(const b of T)this._forEachPrimitive(b,(T=>{J.push(T)}));return J}_getTransformNodes(){const J=[],T=this._gltf.nodes;if(T)for(const b of T)b._babylonTransformNode&&"cj"===b._babylonTransformNode.getClassName()&&J.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&J.push(b._babylonTransformNodeForSkin);return J}_getSkeletons(){const J=[],T=this._gltf.skins;if(T)for(const b of T)b._data&&J.push(b._data.babylonSkeleton);return J}_getAnimationGroups(){const J=[],T=this._gltf.animations;if(T)for(const b of T)b._babylonAnimationGroup&&J.push(b._babylonAnimationGroup);return J}_startAnimations(){switch(this._parent.animationStartMode){case h.g.NONE:break;case h.g.FIRST:{const J=this._getAnimationGroups();0!==J.length&&J[0].start(!0);break}case h.g.ALL:{const J=this._getAnimationGroups();for(const T of J)T.start(!0);break}default:return void x.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadNodeAsync(J,T,b);if(q)return q;if(T._babylonTransformNode)throw new Error(`${J}: Invalid recursive node hierarchy`);const t=new Array;this.logOpen(`${J} ${T.name||""}`);const j=q=>{if(z.AddPointerMetadata(q,J),z._LoadTransform(T,q),void 0!=T.camera){const b=D.Get(`${J}/camera`,this._gltf.cameras,T.camera);t.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(J=>{J.parent=q,this._babylonScene.useRightHandedSystem||(q.ii.x=-1)})))}if(T.children)for(const b of T.children){const T=D.Get(`${J}/children/${b}`,this._gltf.nodes,b);t.push(this.loadNodeAsync(`/nodes/${T.index}`,T,(J=>{J.parent=q})))}b(q)},B=void 0!=T.mesh,Y=this._parent.loadSkins&&void 0!=T.skin;if(!B||Y){const J=T.name||`node${T.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new s.e(J,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==T.mesh?T._babylonTransformNode=b:T._babylonTransformNodeForSkin=b,j(b)}if(B)if(Y){const b=D.Get(`${J}/mesh`,this._gltf.meshes,T.mesh);t.push(this._loadMeshAsync(`/meshes/${b.index}`,T,b,(b=>{const q=T._babylonTransformNodeForSkin;b.metadata=R(q.metadata,b.metadata||{});const j=D.Get(`${J}/skin`,this._gltf.skins,T.skin);t.push(this._loadSkinAsync(`/skins/${j.index}`,T,j,(J=>{this._forEachPrimitive(T,(T=>{T.skeleton=J})),this._postSceneLoadActions.push((()=>{if(void 0!=j.skeleton){const J=D.Get(`/skins/${j.index}/skeleton`,this._gltf.nodes,j.skeleton).parent;T.index===J.index?b.parent=q.parent:b.parent=J._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:q,skinnedNode:b})}))})))})))}else{const b=D.Get(`${J}/mesh`,this._gltf.meshes,T.mesh);t.push(this._loadMeshAsync(`/meshes/${b.index}`,T,b,j))}return this.logClose(),Promise.all(t).then((()=>(this._forEachPrimitive(T,(J=>{const T=J;!T.isAnInstance&&T.qi&&T.qi.useBoundingInfoFromGeometry?J.Ea():J.refreshBoundingInfo(!0,!0)})),T._babylonTransformNode)))}_loadMeshAsync(J,T,b,q){const t=b.primitives;if(!t||!t.length)throw new Error(`${J}: Primitives are missing`);void 0==t[0].index&&D.Assign(t);const j=new Array;this.logOpen(`${J} ${b.name||""}`);const B=T.name||`node${T.index}`;if(1===t.length){const q=b.primitives[0];j.push(this._loadMeshPrimitiveAsync(`${J}/primitives/${q.index}`,B,T,b,q,(J=>{T._babylonTransformNode=J,T._primitiveBabylonMeshes=[J]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,T._babylonTransformNode=new s.e(B,this._babylonScene),T._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T._primitiveBabylonMeshes=[];for(const q of t)j.push(this._loadMeshPrimitiveAsync(`${J}/primitives/${q.index}`,`${B}_primitive${q.index}`,T,b,q,(J=>{J.parent=T._babylonTransformNode,T._primitiveBabylonMeshes.push(J)})))}return q(T._babylonTransformNode),this.logClose(),Promise.all(j).then((()=>T._babylonTransformNode))}_loadMeshPrimitiveAsync(J,T,b,q,t,j){const B=this._extensionsLoadMeshPrimitiveAsync(J,T,b,q,t,j);if(B)return B;this.logOpen(`${J}`);const Y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!q.primitives[0].targets;let C,F;if(Y&&t._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=t._instanceData.babylonSourceMesh.createInstance(T),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F=t._instanceData.promise;else{const j=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new Z.e(T,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.sideOrientation=this._babylonScene.useRightHandedSystem?U.c.CounterClockWiseSideOrientation:U.c.ClockWiseSideOrientation,this._createMorphTargets(J,b,q,t,B),j.push(this._loadVertexDataAsync(J,t,B).then((async T=>await this._loadMorphTargetsAsync(J,t,B,T).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,T.Ca(B),T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const A=z._GetDrawMode(J,t.mode);if(void 0==t.material){let J=this._defaultBabylonMaterialData[A];J||(J=this._createDefaultMaterial("__GLTFLoader._default",A),this._parent.onMaterialLoadedObservable.notifyObservers(J),this._defaultBabylonMaterialData[A]=J),B.material=J}else if(!this.parent.skipMaterials){const T=D.Get(`${J}/material`,this._gltf.materials,t.material);j.push(this._loadMaterialAsync(`/materials/${T.index}`,T,B,A,(J=>{B.material=J})))}F=Promise.all(j),Y&&(t._instanceData={babylonSourceMesh:B,promise:F}),C=B}return z.AddPointerMetadata(C,J),this._parent.onMeshLoadedObservable.notifyObservers(C),j(C),this.logClose(),F.then((()=>C))}_loadVertexDataAsync(J,T,b){const q=this._extensionsLoadVertexDataAsync(J,T,b);if(q)return q;const t=T.attributes;if(!t)throw new Error(`${J}: Attributes are missing`);const j=new Array,B=new d.c(b.name,this._babylonScene);if(void 0==T.indices)b.isUnIndexed=!0;else{const b=D.Get(`${J}/indices`,this._gltf.accessors,T.indices);j.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((J=>{B.setIndices(J)})))}const Y=(T,q,Y)=>{if(void 0==t[T])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(q)&&b._delayInfo.push(q);const C=D.Get(`${J}/attributes/${T}`,this._gltf.accessors,t[T]);j.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,q).then((J=>{if(J.getKind()===g.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton){const J=f(C);J&&(B._boundingInfo=J,B.useBoundingInfoFromGeometry=!0)}B.setVerticesBuffer(J,C.count)}))),q==g.e.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),Y&&Y(C)};return Y("POSITION",g.e.PositionKind),Y("NORMAL",g.e.NormalKind),Y("TANGENT",g.e.TangentKind),Y("TEXCOORD_0",g.e.UVKind),Y("TEXCOORD_1",g.e.UV2Kind),Y("TEXCOORD_2",g.e.UV3Kind),Y("TEXCOORD_3",g.e.UV4Kind),Y("TEXCOORD_4",g.e.UV5Kind),Y("TEXCOORD_5",g.e.UV6Kind),Y("JOINTS_0",g.e.MatricesIndicesKind),Y("WEIGHTS_0",g.e.MatricesWeightsKind),Y("JOINTS_1",g.e.MatricesIndicesExtraKind),Y("WEIGHTS_1",g.e.MatricesWeightsExtraKind),Y("COLOR_0",g.e.ColorKind,(J=>{"VEC4"===J.type&&(b.hasVertexAlpha=!0)})),Promise.all(j).then((()=>B))}_createMorphTargets(J,T,b,q,t){if(!q.targets||!this._parent.loadMorphTargets)return;if(void 0==T._numMorphTargets)T._numMorphTargets=q.targets.length;else if(q.targets.length!==T._numMorphTargets)throw new Error(`${J}: Primitives do not have the same number of targets`);const j=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,t.morphTargetManager=new Q(this._babylonScene),t.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.morphTargetManager.areUpdatesFrozen=!0;for(let B=0;B<q.targets.length;B++){const J=T.weights?T.weights[B]:b.weights?b.weights[B]:0,q=j?j[B]:`morphTarget${B}`;t.morphTargetManager.addTarget(new e(q,J,t.va()))}}_loadMorphTargetsAsync(J,T,b,q){if(!T.targets||!this._parent.loadMorphTargets)return Promise.resolve();const t=new Array,j=b.morphTargetManager;for(let B=0;B<j.numTargets;B++){const b=j.getTarget(B);t.push(this._loadMorphTargetVertexDataAsync(`${J}/targets/${B}`,q,T.targets[B],b))}return Promise.all(t).then((()=>{j.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(J,T,b,q){const t=new Array,j=(q,j,B)=>{if(void 0==b[q])return;const Y=T.getVertexBuffer(j);if(!Y)return;const C=D.Get(`${J}/${q}`,this._gltf.accessors,b[q]);t.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((J=>{B(Y,J)})))};return j("POSITION",g.e.PositionKind,((J,T)=>{const b=new Float32Array(T.length);J.forEach(T.length,((J,q)=>{b[q]=T[q]+J})),q.setPositions(b)})),j("NORMAL",g.e.NormalKind,((J,T)=>{const b=new Float32Array(T.length);J.forEach(b.length,((J,q)=>{b[q]=T[q]+J})),q.setNormals(b)})),j("TANGENT",g.e.TangentKind,((J,T)=>{const b=new Float32Array(T.length/3*4);let t=0;J.forEach(T.length/3*4,((J,q)=>{(q+1)%4!==0&&(b[t]=T[t]+J,t++)})),q.setTangents(b)})),j("TEXCOORD_0",g.e.UVKind,((J,T)=>{const b=new Float32Array(T.length);J.forEach(T.length,((J,q)=>{b[q]=T[q]+J})),q.setUVs(b)})),j("TEXCOORD_1",g.e.UV2Kind,((J,T)=>{const b=new Float32Array(T.length);J.forEach(T.length,((J,q)=>{b[q]=T[q]+J})),q.setUV2s(b)})),j("COLOR_0",g.e.ColorKind,((T,b)=>{let t=null;const j=T.getSize();if(3===j){t=new Float32Array(b.length/3*4),T.forEach(b.length,((J,T)=>{const q=Math.floor(T/3),j=T%3;t[4*q+j]=b[3*q+j]+J}));for(let J=0;J<b.length/3;++J)t[4*J+3]=1}else{if(4!==j)throw new Error(`${J}: Invalid number of components (${j}) for COLOR_0 attribute`);t=new Float32Array(b.length),T.forEach(b.length,((J,T)=>{t[T]=b[T]+J}))}q.setColors(t)})),await Promise.all(t).then((()=>{}))}static _LoadTransform(J,T){if(void 0!=J.skin)return;let b=t.n.Zero(),q=t.h.Identity(),j=t.n.One();if(J.matrix){t.e.ni(J.matrix).decompose(j,q,b)}else J.translation&&(b=t.n.ni(J.translation)),J.rotation&&(q=t.h.ni(J.rotation)),J.scale&&(j=t.n.ni(J.scale));T.position=b,T.rotationQuaternion=q,T.ii=j}_loadSkinAsync(J,T,b,q){if(!this._parent.loadSkins)return Promise.resolve();const t=this._extensionsLoadSkinAsync(J,T,b);if(t)return t;if(b._data)return q(b._data.babylonSkeleton),b._data.promise;const j=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new u(b.name||j,j,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(J,b,B);const Y=this._loadSkinInverseBindMatricesDataAsync(J,b).then((J=>{this._updateBoneMatrices(B,J)}));return b._data={babylonSkeleton:B,promise:Y},q(B),Y}_loadBones(J,T,b){if(void 0==T.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${J}/joints`,T.joints);if(b)if(void 0===T.skeleton)T.skeleton=b.index;else{const q=(J,T)=>{for(;T.parent;T=T.parent)if(T.parent===J)return!0;return!1},t=D.Get(`${J}/skeleton`,this._gltf.nodes,T.skeleton);t===b||q(t,b)||(x.d.Warn(`${J}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),T.skeleton=b.index)}else x.d.Warn(`${J}: Failed to find common root`)}const q={};for(const t of T.joints){const j=D.Get(`${J}/joints/${t}`,this._gltf.nodes,t);this._loadBone(j,T,b,q)}}_findSkeletonRootNode(J,T){if(0===T.length)return null;const b={};for(const t of T){const T=[];let q=D.Get(`${J}/${t}`,this._gltf.nodes,t);for(;-1!==q.index;)T.unshift(q),q=q.parent;b[t]=T}let q=null;for(let t=0;;++t){let J=b[T[0]];if(t>=J.length)return q;const j=J[t];for(let B=1;B<T.length;++B)if(J=b[T[B]],t>=J.length||j!==J[t])return q;q=j}}_loadBone(J,T,b,q){J._isJoint=!0;let t=q[J.index];if(t)return t;let j=null;J.index!==T.skeleton&&(J.parent&&-1!==J.parent.index?j=this._loadBone(J.parent,T,b,q):void 0!==T.skeleton&&x.d.Warn(`/skins/${T.index}/skeleton: Skeleton node is not a common root`));const B=T.joints.indexOf(J.index);return t=new F.b(J.name||`joint${J.index}`,b,j,this._getNodeMatrix(J),null,null,B),q[J.index]=t,this._postSceneLoadActions.push((()=>{t.linkTransformNode(J._babylonTransformNode)})),t}_loadSkinInverseBindMatricesDataAsync(J,T){if(void 0==T.inverseBindMatrices)return Promise.resolve(null);const b=D.Get(`${J}/inverseBindMatrices`,this._gltf.accessors,T.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(J,T){for(const b of J.bones){const J=t.e.Identity(),q=b._index;T&&-1!==q&&(t.e.FromArrayToRef(T,16*q,J),J.invertToRef(J));const j=b.getParent();j&&J.multiplyToRef(j.getAbsoluteInverseBindMatrix(),J),b.Zi(J,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(J){return J.matrix?t.e.ni(J.matrix):t.e.Compose(J.scale?t.n.ni(J.scale):t.n.One(),J.rotation?t.h.ni(J.rotation):t.h.Identity(),J.translation?t.n.ni(J.translation):t.n.Zero())}loadCameraAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadCameraAsync(J,T,b);if(q)return q;const j=new Array;this.logOpen(`${J} ${T.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new C.e(T.name||`camera${T.index}`,t.n.Zero(),this._babylonScene,!1);switch(B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T._babylonCamera=B,B.setTarget(new t.n(0,0,-1)),T.type){case"perspective":{const b=T.perspective;if(!b)throw new Error(`${J}: Camera perspective properties are missing`);B.fov=b.yfov,B.wi=b.znear,B.maxZ=b.zfar||0;break}case"orthographic":if(!T.orthographic)throw new Error(`${J}: Camera orthographic properties are missing`);B.mode=Y.b.ORTHOGRAPHIC_CAMERA,B.orthoLeft=-T.orthographic.xmag,B.orthoRight=T.orthographic.xmag,B.orthoBottom=-T.orthographic.ymag,B.orthoTop=T.orthographic.ymag,B.wi=T.orthographic.znear,B.maxZ=T.orthographic.zfar;break;default:throw new Error(`${J}: Invalid camera type (${T.type})`)}return z.AddPointerMetadata(B,J),this._parent.onCameraLoadedObservable.notifyObservers(B),b(B),this.logClose(),Promise.all(j).then((()=>B))}_loadAnimationsAsync(){const J=this._gltf.animations;if(!J)return Promise.resolve();const T=new Array;for(let b=0;b<J.length;b++){const q=J[b];T.push(this.loadAnimationAsync(`/animations/${q.index}`,q).then((J=>{0===J.targetedAnimations.length&&J.dispose()})))}return Promise.all(T).then((()=>{}))}loadAnimationAsync(J,T){const q=this._extensionsLoadAnimationAsync(J,T);return q||b.e(49).then(b.bind(b,13729)).then((b=>{let{AnimationGroup:q}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new q(T.name||`animation${T.index}`,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T._babylonAnimationGroup=t;const j=new Array;D.Assign(T.channels),D.Assign(T.samplers);for(const B of T.channels)j.push(this._loadAnimationChannelAsync(`${J}/channels/${B.index}`,J,T,B,((J,T)=>{J.animations=J.animations||[],J.animations.push(T),t.addTargetedAnimation(T,J)})));return Promise.all(j).then((()=>(t.normalize(0),t)))}))}async _loadAnimationChannelAsync(J,T,q,t,j){const B=this._extensionsLoadAnimationChannelAsync(J,T,q,t,j);if(B)return await B;if(void 0==t.target.node)return await Promise.resolve();const Y=D.Get(`${J}/target/node`,this._gltf.nodes,t.target.node),C=t.target.path,F="weights"===C;if(F&&!Y._numMorphTargets||!F&&!Y._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!F&&!Y._isJoint)return await Promise.resolve();let A;switch(await Promise.resolve().then(b.bind(b,12536)),C){case"translation":var a;A=null===(a=(0,N.e)("/nodes/{}/translation"))||void 0===a?void 0:a.interpolation;break;case"rotation":var P;A=null===(P=(0,N.e)("/nodes/{}/rotation"))||void 0===P?void 0:P.interpolation;break;case"scale":var v;A=null===(v=(0,N.e)("/nodes/{}/scale"))||void 0===v?void 0:v.interpolation;break;case"weights":var G;A=null===(G=(0,N.e)("/nodes/{}/weights"))||void 0===G?void 0:G.interpolation;break;default:throw new Error(`${J}/target/path: Invalid value (${t.target.path})`)}if(!A)throw new Error(`${J}/target/path: Could not find interpolation properties for target path (${t.target.path})`);const x={object:Y,info:A};return await this._loadAnimationChannelFromTargetInfoAsync(J,T,q,t,x,j)}_loadAnimationChannelFromTargetInfoAsync(J,T,b,q,t,j){const B=this.parent.targetFps,Y=1/B,C=D.Get(`${J}/sampler`,b.samplers,q.sampler);return this._loadAnimationSamplerAsync(`${T}/samplers/${q.sampler}`,C).then((J=>{let T=0;const C=t.object,F=t.info;for(const t of F){const F=t.getStride(C),A=J.input,a=J.output,P=new Array(A.length);let v=0;switch(J.interpolation){case"STEP":for(let J=0;J<A.length;J++){const T=t.getValue(C,a,v,1);v+=F,P[J]={frame:A[J]*B,value:T,interpolation:1}}break;case"CUBICSPLINE":for(let J=0;J<A.length;J++){const T=t.getValue(C,a,v,Y);v+=F;const b=t.getValue(C,a,v,1);v+=F;const q=t.getValue(C,a,v,Y);v+=F,P[J]={frame:A[J]*B,inTangent:T,value:b,outTangent:q}}break;case"LINEAR":for(let J=0;J<A.length;J++){const T=t.getValue(C,a,v,1);v+=F,P[J]={frame:A[J]*B,value:T}}}if(v>0){const J=`${b.name||`animation${b.index}`}_channel${q.index}_${T}`,Y=t.buildAnimations(C,J,B,P);for(const b of Y)T++,j(b.babylonAnimatable,b.babylonAnimation)}}}))}_loadAnimationSamplerAsync(J,T){if(T._data)return T._data;const b=T.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${J}/interpolation: Invalid value (${T.interpolation})`)}const q=D.Get(`${J}/input`,this._gltf.accessors,T.input),t=D.Get(`${J}/output`,this._gltf.accessors,T.output);return T._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${q.index}`,q),this._loadFloatAccessorAsync(`/accessors/${t.index}`,t)]).then((J=>{let[T,q]=J;return{input:T,interpolation:b,output:q}})),T._data}loadBufferAsync(J,T,b,q){const t=this._extensionsLoadBufferAsync(J,T,b,q);if(t)return t;if(!T._data)if(T.uri)T._data=this.loadUriAsync(`${J}/uri`,T,T.uri);else{if(!this._bin)throw new Error(`${J}: Uri is missing or the binary glTF is missing its binary chunk`);T._data=this._bin.readAsync(0,T.byteLength)}return T._data.then((T=>{try{return new Uint8Array(T.buffer,T.byteOffset+b,q)}catch(t){throw new Error(`${J}: ${t.message}`)}}))}loadBufferViewAsync(J,T){const b=this._extensionsLoadBufferViewAsync(J,T);if(b)return b;if(T._data)return T._data;const q=D.Get(`${J}/buffer`,this._gltf.buffers,T.buffer);return T._data=this.loadBufferAsync(`/buffers/${q.index}`,q,T.byteOffset||0,T.byteLength),T._data}_loadAccessorAsync(J,T,b){if(T._data)return T._data;const q=z._GetNumComponents(J,T.type),t=q*g.e.GetTypeByteLength(T.componentType),j=q*T.count;if(void 0==T.bufferView)T._data=Promise.resolve(new b(j));else{const B=D.Get(`${J}/bufferView`,this._gltf.bufferViews,T.bufferView);T._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((Y=>{if(5126!==T.componentType||T.normalized||B.byteStride&&B.byteStride!==t){const J=new b(j);return g.e.ForEach(Y,T.byteOffset||0,B.byteStride||t,q,T.componentType,J.length,T.normalized||!1,((T,b)=>{J[b]=T})),J}return z._GetTypedArray(J,T.componentType,Y,T.byteOffset,j)}))}if(T.sparse){const j=T.sparse;T._data=T._data.then((B=>{const Y=B,C=D.Get(`${J}/sparse/indices/bufferView`,this._gltf.bufferViews,j.indices.bufferView),F=D.Get(`${J}/sparse/values/bufferView`,this._gltf.bufferViews,j.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${F.index}`,F)]).then((B=>{let[C,F]=B;const A=z._GetTypedArray(`${J}/sparse/indices`,j.indices.componentType,C,j.indices.byteOffset,j.count),a=q*j.count;let P;if(5126!==T.componentType||T.normalized){const B=z._GetTypedArray(`${J}/sparse/values`,T.componentType,F,j.values.byteOffset,a);P=new b(a),g.e.ForEach(B,0,t,q,T.componentType,P.length,T.normalized||!1,((J,T)=>{P[T]=J}))}else P=z._GetTypedArray(`${J}/sparse/values`,T.componentType,F,j.values.byteOffset,a);let v=0;for(let J=0;J<A.length;J++){let T=A[J]*q;for(let J=0;J<q;J++)Y[T++]=P[v++]}return Y}))}))}return T._data}_loadFloatAccessorAsync(J,T){return this._loadAccessorAsync(J,T,Float32Array)}_loadIndicesAccessorAsync(J,T){if("SCALAR"!==T.type)throw new Error(`${J}/type: Invalid value ${T.type}`);if(5121!==T.componentType&&5123!==T.componentType&&5125!==T.componentType)throw new Error(`${J}/componentType: Invalid value ${T.componentType}`);if(T._data)return T._data;if(T.sparse){const b=z._GetTypedArrayConstructor(`${J}/componentType`,T.componentType);T._data=this._loadAccessorAsync(J,T,b)}else{const b=D.Get(`${J}/bufferView`,this._gltf.bufferViews,T.bufferView);T._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>z._GetTypedArray(J,T.componentType,b,T.byteOffset,T.count)))}return T._data}_loadVertexBufferViewAsync(J){if(J._babylonBuffer)return J._babylonBuffer;const T=this._babylonScene.getEngine();return J._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${J.index}`,J).then((J=>new g.c(T,J,!1))),J._babylonBuffer}_loadVertexAccessorAsync(J,T,b){var q;if(null!==(q=T._babylonVertexBuffer)&&void 0!==q&&q[b])return T._babylonVertexBuffer[b];T._babylonVertexBuffer||(T._babylonVertexBuffer={});const t=this._babylonScene.getEngine();if(T.sparse||void 0==T.bufferView)T._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(J,T).then((J=>new g.e(t,J,b,!1)));else{const q=D.Get(`${J}/bufferView`,this._gltf.bufferViews,T.bufferView);T._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(q).then((j=>{const B=z._GetNumComponents(J,T.type);return new g.e(t,j,b,!1,void 0,q.byteStride,void 0,T.byteOffset,B,T.componentType,T.normalized,!0,void 0,!0)}))}return T._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return T&&(T.baseColorFactor?(b.albedoColor=j.b.ni(T.baseColorFactor),b.alpha=T.baseColorFactor[3]):b.albedoColor=j.b.White(),b.metallic=void 0==T.metallicFactor?1:T.metallicFactor,b.roughness=void 0==T.roughnessFactor?1:T.roughnessFactor,T.baseColorTexture&&q.push(this.loadTextureInfoAsync(`${J}/baseColorTexture`,T.baseColorTexture,(J=>{J.name=`${b.name} (Base Color)`,b.albedoTexture=J}))),T.metallicRoughnessTexture&&(T.metallicRoughnessTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${J}/metallicRoughnessTexture`,T.metallicRoughnessTexture,(J=>{J.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=J}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(q).then((()=>{}))}_loadMaterialAsync(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const j=this._extensionsLoadMaterialAsync(J,T,b,q,t);if(j)return j;T._data=T._data||{};let B=T._data[q];if(!B){this.logOpen(`${J} ${T.name||""}`);const b=this.createMaterial(J,T,q);B={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(J,T,b)},T._data[q]=B,z.AddPointerMetadata(b,J),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(B.babylonMeshes.push(b),b.Ki.addOnce((()=>{const J=B.babylonMeshes.indexOf(b);-1!==J&&B.babylonMeshes.splice(J,1)}))),t(B.babylonMaterial),B.promise.then((()=>B.babylonMaterial))}_createDefaultMaterial(J,T){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new S(J,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=T,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=S.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(J,T,b){const q=this._extensionsCreateMaterial(J,T,b);if(q)return q;const t=T.name||`material${T.index}`;return this._createDefaultMaterial(t,b)}loadMaterialPropertiesAsync(J,T,b){const q=this._extensionsLoadMaterialPropertiesAsync(J,T,b);if(q)return q;const t=new Array;return t.push(this.loadMaterialBasePropertiesAsync(J,T,b)),T.pbrMetallicRoughness&&t.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${J}/pbrMetallicRoughness`,T.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(J,T,b),Promise.all(t).then((()=>{}))}loadMaterialBasePropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return b.emissiveColor=T.emissiveFactor?j.b.ni(T.emissiveFactor):new j.b(0,0,0),T.doubleSided&&(b.zi=!1,b.twoSidedLighting=!0),T.normalTexture&&(T.normalTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${J}/normalTexture`,T.normalTexture,(J=>{J.name=`${b.name} (Normal)`,b.bumpTexture=J}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=T.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=T.normalTexture.scale),b.forceIrradianceInFragment=!0),T.occlusionTexture&&(T.occlusionTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${J}/occlusionTexture`,T.occlusionTexture,(J=>{J.name=`${b.name} (Occlusion)`,b.ambientTexture=J}))),b.useAmbientInGrayScale=!0,void 0!=T.occlusionTexture.strength&&(b.ambientTextureStrength=T.occlusionTexture.strength)),T.emissiveTexture&&q.push(this.loadTextureInfoAsync(`${J}/emissiveTexture`,T.emissiveTexture,(J=>{J.name=`${b.name} (Emissive)`,b.emissiveTexture=J}))),Promise.all(q).then((()=>{}))}loadMaterialAlphaProperties(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);switch(T.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=S.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=S.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==T.alphaCutoff?.5:T.alphaCutoff,b.albedoTexture&&(b.albedoTexture.Fj=!0);break;case"BLEND":b.transparencyMode=S.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.Fj=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${J}/alphaMode: Invalid value (${T.alphaMode})`)}}loadTextureInfoAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadTextureInfoAsync(J,T,b);if(q)return q;if(this.logOpen(`${J}`),T.texCoord>=6)throw new Error(`${J}/texCoord: Invalid value (${T.texCoord})`);const t=D.Get(`${J}/index`,this._gltf.textures,T.index);t._textureInfo=T;const j=this._loadTextureAsync(`/textures/${T.index}`,t,(q=>{q.coordinatesIndex=T.texCoord||0,z.AddPointerMetadata(q,J),this._parent.onTextureLoadedObservable.notifyObservers(q),b(q)}));return this.logClose(),j}_loadTextureAsync(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadTextureAsync(J,T,b);if(q)return q;this.logOpen(`${J} ${T.name||""}`);const t=void 0==T.sampler?z.DefaultSampler:D.Get(`${J}/sampler`,this._gltf.samplers,T.sampler),j=D.Get(`${J}/source`,this._gltf.images,T.source),B=this._createTextureAsync(J,t,j,b,void 0,!T._textureInfo.nonColorData);return this.logClose(),B}_createTextureAsync(J,T,b){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},j=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const Y=this._loadSampler(`/samplers/${T.index}`,T),C=new Array,F=new q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A={noMipmap:Y.noMipMaps,invertY:!1,samplingMode:Y.samplingMode,X:()=>{this._disposed||F.resolve()},onError:(T,b)=>{this._disposed||F.reject(new Error(`${J}: ${b&&b.message?b.message:T||"Failed to load texture"}`))},mimeType:b.mimeType??(0,i.g)(b.uri??""),loaderOptions:j,useSRGBBuffer:!!B&&this._parent.useSRGBBuffers},a=new H.b(null,this._babylonScene,A);return a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(F.promise),C.push(this.loadImageAsync(`/images/${b.index}`,b).then((J=>{const T=b.uri||`${this._fileName}#image${b.index}`,q=`data:${this._uniqueRootUrl}${T}`;a.updateURL(q,J);const t=a.getInternalTexture();t&&(t.label=b.name)}))),a.wrapU=Y.wrapU,a.wrapV=Y.wrapV,t(a),this._parent.useGltfTextureNames&&(a.name=b.name||b.uri||`image${b.index}`),Promise.all(C).then((()=>a))}_loadSampler(J,T){return T._data||(T._data={noMipMaps:9728===T.minFilter||9729===T.minFilter,samplingMode:z._GetTextureSamplingMode(J,T),wrapU:z._GetTextureWrapMode(`${J}/wrapS`,T.wrapS),wrapV:z._GetTextureWrapMode(`${J}/wrapT`,T.wrapT)}),T._data}loadImageAsync(J,T){if(!T._data){if(this.logOpen(`${J} ${T.name||""}`),T.uri)T._data=this.loadUriAsync(`${J}/uri`,T,T.uri);else{const b=D.Get(`${J}/bufferView`,this._gltf.bufferViews,T.bufferView);T._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return T._data}loadUriAsync(J,T,b){const q=this._extensionsLoadUriAsync(J,T,b);if(q)return q;if(!z._ValidateUri(b))throw new Error(`${J}: '${b}' is invalid`);if((0,i.i)(b)){const T=new Uint8Array((0,i.d)(b));return this.log(`${J}: Decoded ${b.substring(0,64)}... (${T.length} bytes)`),Promise.resolve(T)}return this.log(`${J}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((T=>new Promise(((q,t)=>{this._parent._loadFile(this._babylonScene,T,(T=>{this._disposed||(this.log(`${J}: Loaded ${b} (${T.byteLength} bytes)`),q(new Uint8Array(T)))}),!0,(T=>{t(new i.j(`${J}: Failed to load '${b}'${T?": "+T.status+" "+T.statusText:""}`,T))}))}))))}static AddPointerMetadata(J,T){J.metadata=J.metadata||{};const b=J._internalMetadata=J._internalMetadata||{},q=b.Hi=b.Hi||{};(q.pointers=q.pointers||[]).push(T)}static _GetTextureWrapMode(J,T){switch(T=void 0==T?10497:T){case 33071:return H.b.CLAMP_ADDRESSMODE;case 33648:return H.b.MIRROR_ADDRESSMODE;case 10497:return H.b.WRAP_ADDRESSMODE;default:return x.d.Warn(`${J}: Invalid value (${T})`),H.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(J,T){const b=void 0==T.magFilter?9729:T.magFilter,q=void 0==T.minFilter?9987:T.minFilter;if(9729===b)switch(q){case 9728:return H.b.LINEAR_NEAREST;case 9729:return H.b.LINEAR_LINEAR;case 9984:return H.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return H.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return H.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return H.b.LINEAR_LINEAR_MIPLINEAR;default:return x.d.Warn(`${J}/minFilter: Invalid value (${q})`),H.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&x.d.Warn(`${J}/magFilter: Invalid value (${b})`),q){case 9728:return H.b.NEAREST_NEAREST;case 9729:return H.b.NEAREST_LINEAR;case 9984:return H.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return H.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return H.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return H.b.NEAREST_LINEAR_MIPLINEAR;default:return x.d.Warn(`${J}/minFilter: Invalid value (${q})`),H.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(J,T){try{return(0,n.j)(T)}catch(b){throw new Error(`${J}: ${b.message}`)}}static _GetTypedArray(J,T,b,q,t){const j=b.buffer;q=b.byteOffset+(q||0);const B=z._GetTypedArrayConstructor(`${J}/componentType`,T),Y=g.e.GetTypeByteLength(T);return q%Y!==0?(x.d.Warn(`${J}: Copying buffer as byte offset (${q}) is not a multiple of component type byte length (${Y})`),new B(j.slice(q,q+t*Y),0)):new B(j,q,t)}static _GetNumComponents(J,T){switch(T){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${J}: Invalid type (${T})`)}static _ValidateUri(J){return B.e.IsBase64(J)||-1===J.indexOf("..")}static _GetDrawMode(J,T){switch(void 0==T&&(T=4),T){case 0:return U.c.PointListDrawMode;case 1:return U.c.LineListDrawMode;case 2:return U.c.LineLoopDrawMode;case 3:return U.c.LineStripDrawMode;case 4:return U.c.TriangleFillMode;case 5:return U.c.TriangleStripDrawMode;case 6:return U.c.TriangleFanDrawMode}throw new Error(`${J}: Invalid mesh primitive mode (${T})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const J=new Array;if(this._gltf.materials)for(const T of this._gltf.materials)if(T._data)for(const b in T._data){const q=T._data[b];for(const T of q.babylonMeshes){T.ti(!0);const b=q.babylonMaterial;J.push(b.forceCompilationAsync(T)),J.push(b.forceCompilationAsync(T,{useInstances:!0})),this._parent.useClipPlane&&(J.push(b.forceCompilationAsync(T,{clipPlane:!0})),J.push(b.forceCompilationAsync(T,{clipPlane:!0,useInstances:!0})))}}return Promise.all(J).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const J=new Array,T=this._babylonScene.lights;for(const b of T){const T=b.getShadowGenerator();T&&J.push(T.forceCompilationAsync())}return Promise.all(J).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(J){for(const T of this._extensions)T.enabled&&J(T)}_applyExtensions(J,T,b){for(const q of this._extensions)if(q.enabled){const t=`${q.name}.${T}`,j=J;j._activeLoaderExtensionFunctions=j._activeLoaderExtensionFunctions||{};const B=j._activeLoaderExtensionFunctions;if(!B[t]){B[t]=!0;try{const J=b(q);if(J)return J}finally{delete B[t]}}}return null}_extensionsOnLoading(){this._forEachExtensions((J=>J.onLoading&&J.onLoading()))}_extensionsOnReady(){this._forEachExtensions((J=>J.onReady&&J.onReady()))}_extensionsLoadSceneAsync(J,T){return this._applyExtensions(T,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(J,T)))}_extensionsLoadNodeAsync(J,T,b){return this._applyExtensions(T,"loadNode",(q=>q.loadNodeAsync&&q.loadNodeAsync(J,T,b)))}_extensionsLoadCameraAsync(J,T,b){return this._applyExtensions(T,"loadCamera",(q=>q.loadCameraAsync&&q.loadCameraAsync(J,T,b)))}_extensionsLoadVertexDataAsync(J,T,b){return this._applyExtensions(T,"loadVertexData",(q=>q._loadVertexDataAsync&&q._loadVertexDataAsync(J,T,b)))}_extensionsLoadMeshPrimitiveAsync(J,T,b,q,t,j){return this._applyExtensions(t,"loadMeshPrimitive",(B=>B._loadMeshPrimitiveAsync&&B._loadMeshPrimitiveAsync(J,T,b,q,t,j)))}_extensionsLoadMaterialAsync(J,T,b,q,t){return this._applyExtensions(T,"loadMaterial",(j=>j._loadMaterialAsync&&j._loadMaterialAsync(J,T,b,q,t)))}_extensionsCreateMaterial(J,T,b){return this._applyExtensions(T,"createMaterial",(q=>q.createMaterial&&q.createMaterial(J,T,b)))}_extensionsLoadMaterialPropertiesAsync(J,T,b){return this._applyExtensions(T,"loadMaterialProperties",(q=>q.loadMaterialPropertiesAsync&&q.loadMaterialPropertiesAsync(J,T,b)))}_extensionsLoadTextureInfoAsync(J,T,b){return this._applyExtensions(T,"loadTextureInfo",(q=>q.loadTextureInfoAsync&&q.loadTextureInfoAsync(J,T,b)))}_extensionsLoadTextureAsync(J,T,b){return this._applyExtensions(T,"loadTexture",(q=>q._loadTextureAsync&&q._loadTextureAsync(J,T,b)))}_extensionsLoadAnimationAsync(J,T){return this._applyExtensions(T,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(J,T)))}_extensionsLoadAnimationChannelAsync(J,T,b,q,t){return this._applyExtensions(b,"loadAnimationChannel",(j=>j._loadAnimationChannelAsync&&j._loadAnimationChannelAsync(J,T,b,q,t)))}_extensionsLoadSkinAsync(J,T,b){return this._applyExtensions(b,"loadSkin",(q=>q._loadSkinAsync&&q._loadSkinAsync(J,T,b)))}_extensionsLoadUriAsync(J,T,b){return this._applyExtensions(T,"loadUri",(q=>q._loadUriAsync&&q._loadUriAsync(J,T,b)))}_extensionsLoadBufferViewAsync(J,T){return this._applyExtensions(T,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(J,T)))}_extensionsLoadBufferAsync(J,T,b,q){return this._applyExtensions(T,"loadBuffer",(t=>t.loadBufferAsync&&t.loadBufferAsync(J,T,b,q)))}static LoadExtensionAsync(J,T,b,q){if(!T.extensions)return null;const t=T.extensions[b];return t?q(`${J}/extensions/${b}`,t):null}static LoadExtraAsync(J,T,b,q){if(!T.extras)return null;const t=T.extras[b];return t?q(`${J}/extras/${b}`,t):null}isExtensionUsed(J){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(J)}logOpen(J){this._parent._logOpen(J)}logClose(){this._parent._logClose()}log(J){this._parent._log(J)}startPerformanceCounter(J){this._parent._startPerformanceCounter(J)}endPerformanceCounter(J){this._parent._endPerformanceCounter(J)}}z.DefaultSampler={index:-1},h.c._CreateGLTF2Loader=J=>new z(J);var M=b(12536),y=b(2279),k=b(2433),JJ=b(12544);class TJ extends JJ.c{constructor(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",J),this._texture=J.getEngine().createRawCubeTexture(T,b,q,t,j,B,Y,C)}update(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,J,T,b,q,t)}updateRGBDAsync(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,k.h)(this._texture,J,T,b,q).then((()=>{}))}clone(){return o.d.Clone((()=>{const J=this.va(),T=this._texture,b=new TJ(J,T._bufferViewArray,T.width,T.format,T.type,T.generateMipMaps,T.invertY,T.samplingMode,T._compression);return 13===T.source&&b.updateRGBDAsync(T._bufferViewArrayArray,T._sphericalPolynomial,T._lodGenerationScale,T._lodGenerationOffset),b}),this)}}const bJ="EXT_lights_image_based";class qJ{constructor(J){this.name=bJ,this._loader=J,this.enabled=this._loader.isExtensionUsed(bJ)}dispose(){this._loader=null,delete this._lights}onLoading(){const J=this._loader.Hi.extensions;if(J&&J[this.name]){const T=J[this.name];this._lights=T.lights}}loadSceneAsync(J,T){return z.LoadExtensionAsync(J,T,this.name,(async(b,q)=>{this._loader._allMaterialsDirtyRequired=!0;const t=new Array;t.push(this._loader.loadSceneAsync(J,T)),this._loader.logOpen(`${b}`);const j=D.Get(`${b}/light`,this._lights,q.ab);return t.push(this._loadLightAsync(`/extensions/${this.name}/lights/${q.ab}`,j).then((J=>{this._loader.babylonScene.environmentTexture=J}))),this._loader.logClose(),await Promise.all(t).then((()=>{}))}))}_loadLightAsync(J,T){if(!T._loaded){const b=new Array;this._loader.logOpen(`${J}`);const q=new Array(T.specularImages.length);for(let t=0;t<T.specularImages.length;t++){const j=T.specularImages[t];q[t]=new Array(j.length);for(let T=0;T<j.length;T++){const B=`${J}/specularImages/${t}/${T}`;this._loader.logOpen(`${B}`);const Y=j[T],C=D.Get(B,this._loader.Hi.images,Y);b.push(this._loader.loadImageAsync(`/images/${Y}`,C).then((J=>{q[t][T]=J}))),this._loader.logClose()}}this._loader.logClose(),T._loaded=Promise.all(b).then((async()=>{const b=new TJ(this._loader.babylonScene,null,T.specularImageSize);if(b.name=T.name||"environment",T._babylonTexture=b,void 0!=T.Kl&&(b.level=T.Kl),T.rotation){let J=t.h.ni(T.rotation);this._loader.babylonScene.useRightHandedSystem||(J=t.h.Inverse(J)),t.e.FromQuaternionToRef(J,b.getReflectionTextureMatrix())}if(!T.irradianceCoefficients)throw new Error(`${J}: Irradiance coefficients are missing`);const j=y.e.ni(T.irradianceCoefficients);j.scaleInPlace(T.Kl),j.convertIrradianceToLambertianRadiance();const B=y.i.FromHarmonics(j),Y=(q.length-1)/Math.log2(T.specularImageSize);return await b.updateRGBDAsync(q,B,Y)}))}return T._loaded.then((()=>T._babylonTexture))}}r(bJ),L(bJ,!0,(J=>new qJ(J)));b(486);const tJ="EXT_mesh_gpu_instancing";class jJ{constructor(J){this.name=tJ,this._loader=J,this.enabled=this._loader.isExtensionUsed(tJ)}dispose(){this._loader=null}loadNodeAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(J,q)=>{this._loader._disableInstancedMesh++;const j=this._loader.loadNodeAsync(`/nodes/${T.index}`,T,b);if(this._loader._disableInstancedMesh--,!T._primitiveBabylonMeshes)return await j;const B=new Array;let Y=0;const C=T=>{if(void 0==q.attributes[T])return void B.push(Promise.resolve(null));const b=D.Get(`${J}/attributes/${T}`,this._loader.Hi.accessors,q.attributes[T]);if(B.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===Y)Y=b.count;else if(Y!==b.count)throw new Error(`${J}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),await j.then((async J=>{const[b,q,j]=await Promise.all(B),C=new Float32Array(16*Y);t.j.pi[0].hi(0,0,0),t.j.Quaternion[0].hi(0,0,0,1),t.j.pi[1].hi(1,1,1);for(let T=0;T<Y;++T)b&&t.n.FromArrayToRef(b,3*T,t.j.pi[0]),q&&t.h.FromArrayToRef(q,4*T,t.j.Quaternion[0]),j&&t.n.FromArrayToRef(j,3*T,t.j.pi[1]),t.e.ComposeToRef(t.j.pi[1],t.j.Quaternion[0],t.j.pi[0],t.j.Matrix[0]),t.j.Matrix[0].copyToArray(C,16*T);for(const t of T._primitiveBabylonMeshes)t.li("matrix",C,16,!0);return J}))}))}}r(tJ),L(tJ,!0,(J=>new jJ(J)));let BJ=0,YJ=null;class CJ{static get Default(){return CJ._Default||(CJ._Default=new CJ),CJ._Default}constructor(){const J=CJ.Configuration.decoder;this._decoderModulePromise=B.e.LoadBabylonScriptAsync(J.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(J,T,b,q,t){await this._decoderModulePromise,0===BJ&&(MeshoptDecoder.useWorkers(1),BJ=1);const j=await MeshoptDecoder.decodeGltfBufferAsync(T,b,J,q,t);return null!==YJ&&clearTimeout(YJ),YJ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),BJ=0,YJ=null}),1e3),j}}CJ.Configuration={decoder:{url:`${B.e._DefaultCdnUrl}/meshopt_decoder.js`}},CJ._Default=null;const FJ="EXT_meshopt_compression";class AJ{constructor(J){this.name=FJ,this.enabled=J.isExtensionUsed(FJ),this._loader=J}dispose(){this._loader=null}loadBufferViewAsync(J,T){return z.LoadExtensionAsync(J,T,this.name,(async(b,q)=>{const t=T;if(t._meshOptData)return await t._meshOptData;const j=D.Get(`${J}/buffer`,this._loader.Hi.buffers,q.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${j.index}`,j,q.byteOffset||0,q.byteLength).then((async J=>await CJ.Default.decodeGltfBufferAsync(J,q.count,q.byteStride,q.mode,q.filter))),await t._meshOptData}))}}r(FJ),L(FJ,!0,(J=>new AJ(J)));const aJ="EXT_texture_webp";class PJ{constructor(J){this.name=aJ,this._loader=J,this.enabled=J.isExtensionUsed(aJ)}dispose(){this._loader=null}_loadTextureAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=void 0==T.sampler?z.DefaultSampler:D.Get(`${J}/sampler`,this._loader.Hi.samplers,T.sampler),B=D.Get(`${q}/source`,this._loader.Hi.images,t.source);return await this._loader._createTextureAsync(J,j,B,(J=>{b(J)}),void 0,!T._textureInfo.nonColorData)}))}}r(aJ),L(aJ,!0,(J=>new PJ(J)));const vJ="EXT_texture_avif";class GJ{constructor(J){this.name=vJ,this._loader=J,this.enabled=J.isExtensionUsed(vJ)}dispose(){this._loader=null}_loadTextureAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=void 0==T.sampler?z.DefaultSampler:D.Get(`${J}/sampler`,this._loader.Hi.samplers,T.sampler),B=D.Get(`${q}/source`,this._loader.Hi.images,t.source);return await this._loader._createTextureAsync(J,j,B,(J=>{b(J)}),void 0,!T._textureInfo.nonColorData)}))}}r(vJ),L(vJ,!0,(J=>new GJ(J)));var xJ=b(12523),IJ=b(12504);const uJ="EXT_lights_ies";class UJ{constructor(J){this.name=uJ,this._loader=J,this.enabled=this._loader.isExtensionUsed(uJ)}dispose(){this._loader=null,delete this._lights}onLoading(){const J=this._loader.Hi.extensions;if(J&&J[this.name]){const T=J[this.name];this._lights=T.lights,D.Assign(this._lights)}}loadNodeAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,B)=>{let Y,C;this._loader._allMaterialsDirtyRequired=!0;const F=await this._loader.loadNodeAsync(J,T,(J=>{C=D.Get(q,this._lights,B.ab);const T=C.name||J.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y=new xJ.c(T,t.n.Zero(),t.n.Backward(),0,1,this._loader.babylonScene),Y.angle=Math.PI/2,Y.innerAngle=0,Y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=Y,Y.falloffType=IJ.c.FALLOFF_GLTF,Y.Sk=B.color?j.b.ni(B.color):j.b.White(),Y.Kl=B.multiplier||1,Y.range=Number.MAX_VALUE,Y.parent=J,this._loader._babylonLights.push(Y),z.AddPointerMetadata(Y,q),b(J)}));let A;if(C.uri)A=await this._loader.loadUriAsync(J,C,C.uri);else{const T=D.Get(`${J}/bufferView`,this._loader.Hi.bufferViews,C.bufferView);A=await this._loader.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}return Y.iesProfileTexture=new H.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,A,!0,void 0,void 0,void 0,void 0,".ies"),F}))}}r(uJ),L(uJ,!0,(J=>new UJ(J)));var KJ=b(12551);const EJ="KHR_draco_mesh_compression";class lJ{constructor(J){this.name=EJ,this.useNormalizedFlagFromAccessor=!0,this._loader=J,this.enabled=KJ.b.DefaultAvailable&&this._loader.isExtensionUsed(EJ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{if(void 0!=T.mode&&4!==T.mode&&5!==T.mode)throw new Error(`${J}: Unsupported mode ${T.mode}`);const j={},B={},Y=(J,q)=>{const Y=t.attributes[J];if(void 0!=Y&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(q)&&b._delayInfo.push(q),j[q]=Y,this.useNormalizedFlagFromAccessor)){const b=D.TryGet(this._loader.Hi.accessors,T.attributes[J]);b&&(B[q]=b.normalized||!1)}};Y("POSITION",g.e.PositionKind),Y("NORMAL",g.e.NormalKind),Y("TANGENT",g.e.TangentKind),Y("TEXCOORD_0",g.e.UVKind),Y("TEXCOORD_1",g.e.UV2Kind),Y("TEXCOORD_2",g.e.UV3Kind),Y("TEXCOORD_3",g.e.UV4Kind),Y("TEXCOORD_4",g.e.UV5Kind),Y("TEXCOORD_5",g.e.UV6Kind),Y("JOINTS_0",g.e.MatricesIndicesKind),Y("WEIGHTS_0",g.e.MatricesWeightsKind),Y("COLOR_0",g.e.ColorKind);const C=D.Get(q,this._loader.Hi.bufferViews,t.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((async q=>{const t=this.dracoDecoder||KJ.b.Default,Y=D.TryGet(this._loader.Hi.accessors,T.attributes.POSITION),C=this._loader.parent.alwaysComputeBoundingBox||b.skeleton||!Y?null:f(Y);return await t._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,q,j,B,C).catch((T=>{throw new Error(`${J}: ${T.message}`)}))}))),await C._dracoBabylonGeometry}))}}r(EJ),L(EJ,!0,(J=>new lJ(J)));var WJ=b(12577),pJ=b(722),oJ=b(12529);pJ.b.AddNodeConstructor("Light_Type_0",((J,T)=>()=>new SJ(J,t.n.Zero(),T)));class SJ extends oJ.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(J){this._shadowAngle=J,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(J){const T=this.needCube();if(this._direction=J,this.needCube()!==T&&this._shadowGenerators){const J=this._shadowGenerators.values();for(let T=J.next();!0!==T.done;T=J.next()){T.value.recreateShadowMap()}}}constructor(J,T,b){super(J,b),this._shadowAngle=Math.PI/2,this.position=T}getClassName(){return"PointLight"}getTypeID(){return IJ.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(J){if(this.direction)return super.getShadowDirection(J);switch(J){case 0:return new t.n(1,0,0);case 1:return new t.n(-1,0,0);case 2:return new t.n(0,-1,0);case 3:return new t.n(0,1,0);case 4:return new t.n(0,0,1);case 5:return new t.n(0,0,-1)}return t.n.Zero()}_setDefaultShadowProjectionMatrix(J,T,b){const q=this.va().activeCamera;if(!q)return;const j=void 0!==this.shadowMinZ?this.shadowMinZ:q.wi,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,Y=this.va().getEngine().useReverseDepthBuffer;t.e.PerspectiveFovLHToRef(this.shadowAngle,1,Y?B:j,Y?j:B,J,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Y)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(J,T){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,T):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,T),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,T),this}transferToNodeMaterialEffect(J,T){return this.computeTransformedInformation()?J.setFloat3(T,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):J.setFloat3(T,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(J,T){J["POINTLIGHT"+T]=!0}}(0,K.e)([(0,E.M)()],SJ.prototype,"shadowAngle",null),(0,p.g)("BABYLON.PointLight",SJ);const HJ="KHR_lights_punctual";class sJ{constructor(J){this.name=HJ,this._loader=J,this.enabled=this._loader.isExtensionUsed(HJ)}dispose(){this._loader=null,delete this._lights}onLoading(){const J=this._loader.Hi.extensions;if(J&&J[this.name]){const T=J[this.name];this._lights=T.lights,D.Assign(this._lights)}}loadNodeAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,B)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(J,T,(J=>{let T;const Y=D.Get(q,this._lights,B.ab),C=Y.name||J.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y.type){case"directional":{const J=new WJ.d(C,t.n.Backward(),this._loader.babylonScene);J.position.oi(0),T=J;break}case"point":T=new SJ(C,t.n.Zero(),this._loader.babylonScene);break;case"spot":{const J=new xJ.c(C,t.n.Zero(),t.n.Backward(),0,1,this._loader.babylonScene);J.angle=2*(Y.spot&&Y.spot.outerConeAngle||Math.PI/4),J.innerAngle=2*(Y.spot&&Y.spot.innerConeAngle||0),T=J;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${q}: Invalid light type (${Y.type})`)}T._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Y._babylonLight=T,T.falloffType=IJ.c.FALLOFF_GLTF,T.Sk=Y.color?j.b.ni(Y.color):j.b.White(),T.Kl=void 0==Y.Kl?1:Y.Kl,T.range=void 0==Y.range?Number.MAX_VALUE:Y.range,T.parent=J,this._loader._babylonLights.push(T),z.AddPointerMetadata(T,q),b(J)})))))}}r(HJ),L(HJ,!0,(J=>new sJ(J)));const gJ="KHR_materials_pbrSpecularGlossiness";class dJ{constructor(J){this.name=gJ,this.order=200,this._loader=J,this.enabled=this._loader.isExtensionUsed(gJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialBasePropertiesAsync(J,T,b)),j.push(this._loadSpecularGlossinessPropertiesAsync(q,t,b)),this._loader.loadMaterialAlphaProperties(J,T,b),await Promise.all(j).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return b.metallic=null,b.roughness=null,T.diffuseFactor?(b.albedoColor=j.b.ni(T.diffuseFactor),b.alpha=T.diffuseFactor[3]):b.albedoColor=j.b.White(),b.reflectivityColor=T.specularFactor?j.b.ni(T.specularFactor):j.b.White(),b.microSurface=void 0==T.glossinessFactor?1:T.glossinessFactor,T.diffuseTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/diffuseTexture`,T.diffuseTexture,(J=>{J.name=`${b.name} (Diffuse)`,b.albedoTexture=J}))),T.specularGlossinessTexture&&(q.push(this._loader.loadTextureInfoAsync(`${J}/specularGlossinessTexture`,T.specularGlossinessTexture,(J=>{J.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=J,b.reflectivityTexture.Fj=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(q).then((()=>{}))}}r(gJ),L(gJ,!0,(J=>new dJ(J)));const wJ="KHR_materials_unlit";class ZJ{constructor(J){this.name=wJ,this.order=210,this._loader=J,this.enabled=this._loader.isExtensionUsed(wJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async()=>await this._loadUnlitPropertiesAsync(J,T,b)))}_loadUnlitPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;b.unlit=!0;const t=T.pbrMetallicRoughness;return t&&(t.baseColorFactor?(b.albedoColor=j.b.ni(t.baseColorFactor),b.alpha=t.baseColorFactor[3]):b.albedoColor=j.b.White(),t.baseColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/baseColorTexture`,t.baseColorTexture,(J=>{J.name=`${b.name} (Base Color)`,b.albedoTexture=J})))),T.doubleSided&&(b.zi=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(J,T,b),Promise.all(q).then((()=>{}))}}r(wJ),L(wJ,!0,(J=>new ZJ(J)));const eJ="KHR_materials_clearcoat";class cJ{constructor(J){this.name=eJ,this.order=190,this._loader=J,this.enabled=this._loader.isExtensionUsed(eJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadClearCoatPropertiesAsync(q,t,b)),await Promise.all(j)}))}_loadClearCoatPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=T.clearcoatFactor?b.clearCoat.Kl=T.clearcoatFactor:b.clearCoat.Kl=0,T.clearcoatTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/clearcoatTexture`,T.clearcoatTexture,(J=>{J.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=J}))),void 0!=T.clearcoatRoughnessFactor?b.clearCoat.roughness=T.clearcoatRoughnessFactor:b.clearCoat.roughness=0,T.clearcoatRoughnessTexture&&(T.clearcoatRoughnessTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${J}/clearcoatRoughnessTexture`,T.clearcoatRoughnessTexture,(J=>{J.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=J})))),T.clearcoatNormalTexture&&(T.clearcoatNormalTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${J}/clearcoatNormalTexture`,T.clearcoatNormalTexture,(J=>{J.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=J}))),b.invertNormalMapX=!b.va().useRightHandedSystem,b.invertNormalMapY=b.va().useRightHandedSystem,void 0!=T.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=T.clearcoatNormalTexture.scale)),Promise.all(q).then((()=>{}))}}r(eJ),L(eJ,!0,(J=>new cJ(J)));const VJ="KHR_materials_iridescence";class QJ{constructor(J){this.name=VJ,this.order=195,this._loader=J,this.enabled=this._loader.isExtensionUsed(VJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadIridescencePropertiesAsync(q,t,b)),await Promise.all(j).then((()=>{}))}))}_loadIridescencePropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return b.iridescence.isEnabled=!0,b.iridescence.Kl=T.iridescenceFactor??0,b.iridescence.indexOfRefraction=T.iridescenceIor??T.iridescenceIOR??1.3,b.iridescence.minimumThickness=T.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=T.iridescenceThicknessMaximum??400,T.iridescenceTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/iridescenceTexture`,T.iridescenceTexture,(J=>{J.name=`${b.name} (Iridescence)`,b.iridescence.texture=J}))),T.iridescenceThicknessTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/iridescenceThicknessTexture`,T.iridescenceThicknessTexture,(J=>{J.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=J}))),Promise.all(q).then((()=>{}))}}r(VJ),L(VJ,!0,(J=>new QJ(J)));const hJ="KHR_materials_anisotropy";class iJ{constructor(J){this.name=hJ,this.order=195,this._loader=J,this.enabled=this._loader.isExtensionUsed(hJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadIridescencePropertiesAsync(q,t,b)),await Promise.all(j)}))}async _loadIridescencePropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;b.anisotropy.isEnabled=!0,b.anisotropy.Kl=T.anisotropyStrength??0,b.anisotropy.angle=T.anisotropyRotation??0,T.anisotropyTexture&&(T.anisotropyTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${J}/anisotropyTexture`,T.anisotropyTexture,(J=>{J.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=J})))),await Promise.all(q)}}r(hJ),L(hJ,!0,(J=>new iJ(J)));const mJ="KHR_materials_emissive_strength";class OJ{constructor(J){this.name=mJ,this.order=170,this._loader=J,this.enabled=this._loader.isExtensionUsed(mJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>await this._loader.loadMaterialPropertiesAsync(J,T,b).then((()=>{this._loadEmissiveProperties(q,t,b)}))))}_loadEmissiveProperties(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);void 0!==T.emissiveStrength&&(b.emissiveIntensity=T.emissiveStrength)}}r(mJ),L(mJ,!0,(J=>new OJ(J)));const XJ="KHR_materials_sheen";class LJ{constructor(J){this.name=XJ,this.order=190,this._loader=J,this.enabled=this._loader.isExtensionUsed(XJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadSheenPropertiesAsync(q,t,b)),await Promise.all(j).then((()=>{}))}))}_loadSheenPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return b.sheen.isEnabled=!0,b.sheen.Kl=1,void 0!=T.sheenColorFactor?b.sheen.color=j.b.ni(T.sheenColorFactor):b.sheen.color=j.b.Black(),T.sheenColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/sheenColorTexture`,T.sheenColorTexture,(J=>{J.name=`${b.name} (Sheen Color)`,b.sheen.texture=J}))),void 0!==T.sheenRoughnessFactor?b.sheen.roughness=T.sheenRoughnessFactor:b.sheen.roughness=0,T.sheenRoughnessTexture&&(T.sheenRoughnessTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${J}/sheenRoughnessTexture`,T.sheenRoughnessTexture,(J=>{J.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=J})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(q).then((()=>{}))}}r(XJ),L(XJ,!0,(J=>new LJ(J)));var rJ=b(12518);const NJ="KHR_materials_specular";class RJ{constructor(J){this.name=NJ,this.order=190,this._loader=J,this.enabled=this._loader.isExtensionUsed(NJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;if(j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadSpecularPropertiesAsync(q,t,b)),t.extensions&&t.extensions.EXT_materials_specular_edge_color&&b instanceof S){t.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(b.brdf.dielectricSpecularModel=rJ.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,b.brdf.conductorSpecularModel=rJ.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(j).then((()=>{}))}))}_loadSpecularPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return void 0!==T.specularFactor&&(b.metallicF0Factor=T.specularFactor),void 0!==T.specularColorFactor&&(b.metallicReflectanceColor=j.b.ni(T.specularColorFactor)),T.specularTexture&&(T.specularTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${J}/specularTexture`,T.specularTexture,(J=>{J.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=J,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),T.specularColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/specularColorTexture`,T.specularColorTexture,(J=>{J.name=`${b.name} (Specular Color)`,b.reflectanceTexture=J}))),Promise.all(q).then((()=>{}))}}r(NJ),L(NJ,!0,(J=>new RJ(J)));const nJ="KHR_materials_ior";class DJ{constructor(J){this.name=nJ,this.order=180,this._loader=J,this.enabled=this._loader.isExtensionUsed(nJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadIorPropertiesAsync(q,t,b)),await Promise.all(j).then((()=>{}))}))}_loadIorPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);return void 0!==T.ior?b.indexOfRefraction=T.ior:b.indexOfRefraction=DJ._DEFAULT_IOR,Promise.resolve()}}DJ._DEFAULT_IOR=1.5,r(nJ),L(nJ,!0,(J=>new DJ(J)));const fJ="KHR_materials_variants";class zJ{constructor(J){this.name=fJ,this._loader=J,this.enabled=this._loader.isExtensionUsed(fJ)}dispose(){this._loader=null}static GetAvailableVariants(J){const T=this._GetExtensionMetadata(J);return T?Object.keys(T.variants):[]}getAvailableVariants(J){return zJ.GetAvailableVariants(J)}static SelectVariant(J,T){const b=this._GetExtensionMetadata(J);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${fJ} extension`);const q=J=>{const T=b.variants[J];if(T)for(const b of T)b.mesh.material=b.material};if(T instanceof Array)for(const t of T)q(t);else q(T);b.lastSelected=T}selectVariant(J,T){zJ.SelectVariant(J,T)}static Reset(J){const T=this._GetExtensionMetadata(J);if(!T)throw new Error(`Cannot reset on a glTF mesh that does not have the ${fJ} extension`);for(const b of T.original)b.mesh.material=b.material;T.lastSelected=null}reset(J){zJ.Reset(J)}static GetLastSelectedVariant(J){const T=this._GetExtensionMetadata(J);if(!T)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${fJ} extension`);return T.lastSelected}getLastSelectedVariant(J){return zJ.GetLastSelectedVariant(J)}static _GetExtensionMetadata(J){var T,b;return(null===J||void 0===J||null===(T=J._internalMetadata)||void 0===T||null===(b=T.Hi)||void 0===b?void 0:b[fJ])||null}onLoading(){const J=this._loader.Hi.extensions;if(J&&J[this.name]){const T=J[this.name];this._variants=T.variants}}onReady(){const J=this._loader.rootBabylonMesh;if(J){var T;const b=this._loader.parent.extensionOptions[fJ];null!==b&&void 0!==b&&b.defaultVariant&&zJ.SelectVariant(J,b.defaultVariant),null===b||void 0===b||null===(T=b.onLoaded)||void 0===T||T.call(b,{get variants(){return zJ.GetAvailableVariants(J)},get selectedVariant(){const T=zJ.GetLastSelectedVariant(J);return T?Array.isArray(T)?T[0]:T:zJ.GetAvailableVariants(J)[0]},set selectedVariant(T){zJ.SelectVariant(J,T)}})}}_loadMeshPrimitiveAsync(J,T,b,q,t,j){return z.LoadExtensionAsync(J,t,this.name,(async(B,Y)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(J,T,b,q,t,(T=>{if(j(T),T instanceof Z.e){const b=z._GetDrawMode(J,t.mode),q=this._loader.rootBabylonMesh,j=q?q._internalMetadata=q._internalMetadata||{}:{},F=j.Hi=j.Hi||{},A=F[fJ]=F[fJ]||{lastSelected:null,original:[],variants:{}};A.original.push({mesh:T,material:T.material});for(let J=0;J<Y.mappings.length;++J){const t=Y.mappings[J],j=D.Get(`${B}/mappings/${J}/material`,this._loader.Hi.materials,t.material);C.push(this._loader._loadMaterialAsync(`#/materials/${t.material}`,j,T,b,(J=>{for(let b=0;b<t.variants.length;++b){const j=t.variants[b],B=D.Get(`/extensions/${fJ}/variants/${j}`,this._variants,j);A.variants[B.name]=A.variants[B.name]||[],A.variants[B.name].push({mesh:T,material:J}),T.onClonedObservable.add((J=>{const b=J;let t=null,j=b;do{if(j=j.parent,!j)return;t=zJ._GetExtensionMetadata(j)}while(null===t);if(q&&t===zJ._GetExtensionMetadata(q)){j._internalMetadata={};for(const J in q._internalMetadata)j._internalMetadata[J]=q._internalMetadata[J];j._internalMetadata.Hi=[];for(const J in q._internalMetadata.Hi)j._internalMetadata.Hi[J]=q._internalMetadata.Hi[J];j._internalMetadata.Hi[fJ]={lastSelected:null,original:[],variants:{}};for(const J of t.original)j._internalMetadata.Hi[fJ].original.push({mesh:J.mesh,material:J.material});for(const J in t.variants)if(Object.prototype.hasOwnProperty.call(t.variants,J)){j._internalMetadata.Hi[fJ].variants[J]=[];for(const T of t.variants[J])j._internalMetadata.Hi[fJ].variants[J].push({mesh:T.mesh,material:T.material})}t=j._internalMetadata.Hi[fJ]}for(const q of t.original)q.mesh===T&&(q.mesh=b);for(const q of t.variants[B.name])q.mesh===T&&(q.mesh=b)}))}})))}}}))),await Promise.all(C).then((J=>{let[T]=J;return T}))}))}}r(fJ),L(fJ,!0,(J=>new zJ(J)));var MJ=b(2325);class yJ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:rJ.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(J,T){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...yJ._GetDefaultOptions(),...J},this._scene=T,this._scene._transmissionHelper=this,this.onErrorObservable=new A.b,this._scene.Ki.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(J){if(!Object.keys(J).filter((T=>this._options[T]!==J[T])).length)return;const T={...this._options,...J},b=this._options;this._options=T,T.renderSize===b.renderSize&&T.renderTargetTextureType===b.renderTargetTextureType&&T.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=T.samples,this._opaqueRenderTarget.lodGenerationScale=T.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=T.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(J){return!!J&&!!(J instanceof S&&J.subSurface.isRefractionEnabled)}_addMesh(J){this._materialObservers[J.uniqueId]=J.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),B.e.SetImmediate((()=>{this._shouldRenderAsTransmission(J.material)?(J.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(J)&&this._transparentMeshesCache.push(J)):-1===this._opaqueMeshesCache.indexOf(J)&&this._opaqueMeshesCache.push(J)}))}_removeMesh(J){J.onMaterialChangedObservable.remove(this._materialObservers[J.uniqueId]),delete this._materialObservers[J.uniqueId];let T=this._transparentMeshesCache.indexOf(J);-1!==T&&this._transparentMeshesCache.splice(T,1),T=this._opaqueMeshesCache.indexOf(J),-1!==T&&this._opaqueMeshesCache.splice(T,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(J){const T=this._transparentMeshesCache.indexOf(J),b=this._opaqueMeshesCache.indexOf(J);this._shouldRenderAsTransmission(J.material)?(J.material instanceof S&&(J.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(J)):-1===T&&this._transparentMeshesCache.push(J)):-1!==T?(this._transparentMeshesCache.splice(T,1),this._opaqueMeshesCache.push(J)):-1===b&&this._opaqueMeshesCache.push(J)}_isRenderTargetValid(){var J;return null!==(null===(J=this._opaqueRenderTarget)||void 0===J?void 0:J.getInternalTexture())}_setupRenderTargets(){var J;let T;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new MJ.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(J=this._options.clearColor)||void 0===J?void 0:J.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((J=>{T=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?J.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(J.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=T}));for(const b of this._transparentMeshesCache)this._shouldRenderAsTransmission(b.material)&&(b.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const kJ="KHR_materials_transmission";class JT{constructor(J){this.name=kJ,this.order=175,this._loader=J,this.enabled=this._loader.isExtensionUsed(kJ),this.enabled&&(J.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadTransparentPropertiesAsync(q,T,b,t)),await Promise.all(j).then((()=>{}))}))}_loadTransparentPropertiesAsync(J,T,b,q){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const t=b;if(t.subSurface.isRefractionEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.useAlbedoToTintRefraction=!0,void 0===q.transmissionFactor)return t.subSurface.refractionIntensity=0,t.subSurface.isRefractionEnabled=!1,Promise.resolve();{var j;t.subSurface.refractionIntensity=q.transmissionFactor;const J=t.va();if(t.subSurface.refractionIntensity&&!J._transmissionHelper)new yJ({},t.va());else if(t.subSurface.refractionIntensity&&(null===(j=J._transmissionHelper)||void 0===j||!j._isRenderTargetValid())){var B;null===(B=J._transmissionHelper)||void 0===B||B._setupRenderTargets()}}return t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,q.transmissionTexture?(q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${J}/transmissionTexture`,q.transmissionTexture,void 0).then((J=>{J.name=`${b.name} (Transmission)`,t.subSurface.refractionIntensityTexture=J,t.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}r(kJ),L(kJ,!0,(J=>new JT(J)));const TT="KHR_materials_diffuse_transmission";class bT{constructor(J){this.name=TT,this.order=174,this._loader=J,this.enabled=this._loader.isExtensionUsed(TT),this.enabled&&(J.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadTranslucentPropertiesAsync(q,T,b,t)),await Promise.all(j).then((()=>{}))}))}_loadTranslucentPropertiesAsync(J,T,b,q){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const t=b;if(t.subSurface.isTranslucencyEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,t.subSurface.useAlbedoToTintTranslucency=!1,void 0===q.diffuseTransmissionFactor)return t.subSurface.translucencyIntensity=0,t.subSurface.isTranslucencyEnabled=!1,Promise.resolve();t.subSurface.translucencyIntensity=q.diffuseTransmissionFactor;const B=new Array;return t.subSurface.useGltfStyleTextures=!0,q.diffuseTransmissionTexture&&(q.diffuseTransmissionTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${J}/diffuseTransmissionTexture`,q.diffuseTransmissionTexture).then((J=>{J.name=`${b.name} (Diffuse Transmission)`,t.subSurface.translucencyIntensityTexture=J})))),void 0!==q.diffuseTransmissionColorFactor?t.subSurface.translucencyColor=j.b.ni(q.diffuseTransmissionColorFactor):t.subSurface.translucencyColor=j.b.White(),q.diffuseTransmissionColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${J}/diffuseTransmissionColorTexture`,q.diffuseTransmissionColorTexture).then((J=>{J.name=`${b.name} (Diffuse Transmission Color)`,t.subSurface.translucencyColorTexture=J}))),Promise.all(B).then((()=>{}))}}r(TT),L(TT,!0,(J=>new bT(J)));const qT="KHR_materials_volume";class tT{constructor(J){this.name=qT,this.order=173,this._loader=J,this.enabled=this._loader.isExtensionUsed(qT),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadVolumePropertiesAsync(q,T,b,t)),await Promise.all(j).then((()=>{}))}))}_loadVolumePropertiesAsync(J,T,b,q){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!q.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const t=void 0!==q.attenuationDistance?q.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=t,void 0!==q.attenuationColor&&3==q.attenuationColor.length&&b.subSurface.tintColor.hi(q.attenuationColor[0],q.attenuationColor[1],q.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=q.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,q.thicknessTexture?(q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${J}/thicknessTexture`,q.thicknessTexture).then((J=>{J.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=J,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}r(qT),L(qT,!0,(J=>new tT(J)));const jT="KHR_materials_dispersion";class BT{constructor(J){this.name=jT,this.order=174,this._loader=J,this.enabled=this._loader.isExtensionUsed(jT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadDispersionPropertiesAsync(q,T,b,t)),await Promise.all(j).then((()=>{}))}))}_loadDispersionPropertiesAsync(J,T,b,q){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);return b.subSurface.isRefractionEnabled&&q.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=q.dispersion,Promise.resolve()):Promise.resolve()}}r(jT),L(jT,!0,(J=>new BT(J)));const YT="EXT_materials_diffuse_roughness";class CT{constructor(J){this.name=YT,this.order=190,this._loader=J,this.enabled=this._loader.isExtensionUsed(YT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(J,T,b)),j.push(this._loadDiffuseRoughnessPropertiesAsync(q,t,b)),await Promise.all(j).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(J,T,b){if(!(b instanceof S))throw new Error(`${J}: Material type not supported`);const q=new Array;return b.brdf.baseDiffuseModel=rJ.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=T.diffuseRoughnessFactor?b.baseDiffuseRoughness=T.diffuseRoughnessFactor:b.baseDiffuseRoughness=0,T.diffuseRoughnessTexture&&q.push(this._loader.loadTextureInfoAsync(`${J}/diffuseRoughnessTexture`,T.diffuseRoughnessTexture,(J=>{J.name=`${b.name} (Diffuse Roughness)`,b.baseDiffuseRoughnessTexture=J}))),Promise.all(q).then((()=>{}))}}r(YT),L(YT,!0,(J=>new CT(J)));const FT="KHR_mesh_quantization";class AT{constructor(J){this.name=FT,this.enabled=J.isExtensionUsed(FT)}dispose(){}}r(FT),L(FT,!0,(J=>new AT(J)));const aT="KHR_texture_basisu";class PT{constructor(J){this.name=aT,this._loader=J,this.enabled=J.isExtensionUsed(aT)}dispose(){this._loader=null}_loadTextureAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>{const j=void 0==T.sampler?z.DefaultSampler:D.Get(`${J}/sampler`,this._loader.Hi.samplers,T.sampler),B=D.Get(`${q}/source`,this._loader.Hi.images,t.source);return await this._loader._createTextureAsync(J,j,B,(J=>{b(J)}),T._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!T._textureInfo.nonColorData)}))}}r(aT),L(aT,!0,(J=>new PT(J)));const vT="KHR_texture_transform";class GT{constructor(J){this.name=vT,this._loader=J,this.enabled=this._loader.isExtensionUsed(vT)}dispose(){this._loader=null}loadTextureInfoAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(q,t)=>await this._loader.loadTextureInfoAsync(J,T,(J=>{if(!(J instanceof H.b))throw new Error(`${q}: Texture type not supported`);t.offset&&(J.uOffset=t.offset[0],J.vOffset=t.offset[1]),J.uRotationCenter=0,J.vRotationCenter=0,t.rotation&&(J.wAng=-t.rotation),t.scale&&(J.uScale=t.scale[0],J.vScale=t.scale[1]),void 0!=t.texCoord&&(J.coordinatesIndex=t.texCoord),b(J)}))))}}r(vT),L(vT,!0,(J=>new GT(J)));const xT="KHR_xmp_json_ld";class IT{constructor(J){this.name=xT,this.order=100,this._loader=J,this.enabled=this._loader.isExtensionUsed(xT)}dispose(){this._loader=null}onLoading(){var J,T,b;if(null===this._loader.rootBabylonMesh)return;const q=null===(J=this._loader.Hi.extensions)||void 0===J?void 0:J.KHR_xmp_json_ld,t=null===(T=this._loader.Hi.asset)||void 0===T||null===(b=T.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(q&&t){const J=+t.packet;q.packets&&J<q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=q.packets[J])}}}function uT(J,T,b,q){return j.b.ni(T,b).scale(q)}function UT(J,T,b,q){return T[b]*q}function KT(J,T,b,q){return-T[b]*q}function ET(J,T,b,q){return T[b+1]*q}function lT(J,T,b,q){return T[b]*q*2}function WT(J){return{scale:[new oT(P.b.ANIMATIONTYPE_FLOAT,`${J}.uScale`,UT,(()=>2)),new oT(P.b.ANIMATIONTYPE_FLOAT,`${J}.vScale`,ET,(()=>2))],offset:[new oT(P.b.ANIMATIONTYPE_FLOAT,`${J}.uOffset`,UT,(()=>2)),new oT(P.b.ANIMATIONTYPE_FLOAT,`${J}.vOffset`,ET,(()=>2))],rotation:[new oT(P.b.ANIMATIONTYPE_FLOAT,`${J}.wAng`,KT,(()=>1))]}}r(xT),L(xT,!0,(J=>new IT(J)));class pT extends M.AnimationPropertyInfo{buildAnimations(J,T,b,q){return[{babylonAnimatable:J._babylonCamera,babylonAnimation:this._buildAnimation(T,b,q)}]}}class oT extends M.AnimationPropertyInfo{buildAnimations(J,T,b,q){const t=[];for(const j in J._data)t.push({babylonAnimatable:J._data[j].babylonMaterial,babylonAnimation:this._buildAnimation(T,b,q)});return t}}class ST extends M.AnimationPropertyInfo{buildAnimations(J,T,b,q){return[{babylonAnimatable:J._babylonLight,babylonAnimation:this._buildAnimation(T,b,q)}]}}(0,N.m)("/cameras/{}/orthographic/xmag",[new pT(P.b.ANIMATIONTYPE_FLOAT,"orthoLeft",KT,(()=>1)),new pT(P.b.ANIMATIONTYPE_FLOAT,"orthoRight",ET,(()=>1))]),(0,N.m)("/cameras/{}/orthographic/ymag",[new pT(P.b.ANIMATIONTYPE_FLOAT,"orthoBottom",KT,(()=>1)),new pT(P.b.ANIMATIONTYPE_FLOAT,"orthoTop",ET,(()=>1))]),(0,N.m)("/cameras/{}/orthographic/zfar",[new pT(P.b.ANIMATIONTYPE_FLOAT,"maxZ",UT,(()=>1))]),(0,N.m)("/cameras/{}/orthographic/znear",[new pT(P.b.ANIMATIONTYPE_FLOAT,"wi",UT,(()=>1))]),(0,N.m)("/cameras/{}/perspective/yfov",[new pT(P.b.ANIMATIONTYPE_FLOAT,"fov",UT,(()=>1))]),(0,N.m)("/cameras/{}/perspective/zfar",[new pT(P.b.ANIMATIONTYPE_FLOAT,"maxZ",UT,(()=>1))]),(0,N.m)("/cameras/{}/perspective/znear",[new pT(P.b.ANIMATIONTYPE_FLOAT,"wi",UT,(()=>1))]),(0,N.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new oT(P.b.ANIMATIONTYPE_COLOR3,"albedoColor",uT,(()=>4)),new oT(P.b.ANIMATIONTYPE_FLOAT,"alpha",(function(J,T,b,q){return T[b+3]*q}),(()=>4))]),(0,N.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"metallic",UT,(()=>1))]),(0,N.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"roughness",UT,(()=>1))]);const HT=WT("albedoTexture");(0,N.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",HT.scale),(0,N.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",HT.offset),(0,N.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",HT.rotation);const sT=WT("metallicTexture");(0,N.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",sT.scale),(0,N.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",sT.offset),(0,N.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",sT.rotation),(0,N.m)("/materials/{}/emissiveFactor",[new oT(P.b.ANIMATIONTYPE_COLOR3,"emissiveColor",uT,(()=>3))]);const gT=WT("bumpTexture");(0,N.m)("/materials/{}/normalTexture/scale",[new oT(P.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",UT,(()=>1))]),(0,N.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",gT.scale),(0,N.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",gT.offset),(0,N.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",gT.rotation),(0,N.m)("/materials/{}/occlusionTexture/strength",[new oT(P.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",UT,(()=>1))]);const dT=WT("ambientTexture");(0,N.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",dT.scale),(0,N.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",dT.offset),(0,N.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",dT.rotation);const wT=WT("emissiveTexture");(0,N.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",wT.scale),(0,N.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",wT.offset),(0,N.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",wT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new oT(P.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new oT(P.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",UT,(()=>1))]);const ZT=WT("anisotropy.texture");(0,N.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",ZT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",ZT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",ZT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",UT,(()=>1))]);const eT=WT("clearCoat.texture");(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",eT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",eT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",eT.rotation);const cT=WT("clearCoat.bumpTexture");(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new oT(P.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",cT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",cT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",cT.rotation);const VT=WT("clearCoat.textureRoughness");(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",VT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",VT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",VT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new oT(P.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new oT(P.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new oT(P.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new oT(P.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",UT,(()=>1))]);const QT=WT("iridescence.texture");(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",QT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",QT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",QT.rotation);const hT=WT("iridescence.thicknessTexture");(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",hT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",hT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",hT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new oT(P.b.ANIMATIONTYPE_COLOR3,"sheen.color",uT,(()=>3))]),(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",UT,(()=>1))]);const iT=WT("sheen.texture");(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",iT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",iT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",iT.rotation);const mT=WT("sheen.textureRoughness");(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",mT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",mT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",mT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new oT(P.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",uT,(()=>3))]);const OT=WT("metallicReflectanceTexture");(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",OT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",OT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",OT.rotation);const XT=WT("reflectanceTexture");(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",XT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",XT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",XT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",UT,(()=>1))]);const LT=WT("subSurface.refractionIntensityTexture");(0,N.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",LT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",LT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",LT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new oT(P.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",uT,(()=>3))]),(0,N.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new oT(P.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",UT,(()=>1))]),(0,N.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",UT,(()=>1))]);const rT=WT("subSurface.thicknessTexture");(0,N.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",rT.scale),(0,N.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",rT.offset),(0,N.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",rT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new oT(P.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",UT,(()=>1))]);const NT=WT("subSurface.translucencyIntensityTexture");(0,N.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",NT.scale),(0,N.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",NT.offset),(0,N.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",NT.rotation),(0,N.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new oT(P.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",uT,(()=>3))]);const RT=WT("subSurface.translucencyColorTexture");(0,N.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",RT.scale),(0,N.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",RT.offset),(0,N.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",RT.rotation),(0,N.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new ST(P.b.ANIMATIONTYPE_COLOR3,"diffuse",uT,(()=>3))]),(0,N.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ST(P.b.ANIMATIONTYPE_FLOAT,"intensity",UT,(()=>1))]),(0,N.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new ST(P.b.ANIMATIONTYPE_FLOAT,"range",UT,(()=>1))]),(0,N.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ST(P.b.ANIMATIONTYPE_FLOAT,"innerAngle",lT,(()=>1))]),(0,N.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ST(P.b.ANIMATIONTYPE_FLOAT,"angle",lT,(()=>1))]),(0,N.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new ST(P.b.ANIMATIONTYPE_COLOR3,"diffuse",uT,(()=>3))]),(0,N.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ST(P.b.ANIMATIONTYPE_FLOAT,"intensity",UT,(()=>1))]);const nT="KHR_animation_pointer";class DT{constructor(J){this.name=nT,this._loader=J,this._pathToObjectConverter=(0,N.i)(this._loader.Hi)}get enabled(){return this._loader.isExtensionUsed(nT)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(J,T,b,q,t){var j;const B=null===(j=q.target.extensions)||void 0===j?void 0:j.KHR_animation_pointer;if(!B||!this._pathToObjectConverter)return null;"pointer"!==q.target.path&&x.d.Warn(`${J}/target/path: Value (${q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=q.target.node&&x.d.Warn(`${J}/target/node: Value (${q.target.node}) must not be present when using the ${this.name} extension`);const Y=`${J}/extensions/${this.name}`,C=B.pointer;if(!C)throw new Error(`${Y}: Pointer is missing`);try{const j=this._pathToObjectConverter.convert(C);if(!j.info.interpolation)throw new Error(`${Y}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(J,T,b,q,{object:j.object,info:j.info.interpolation},t)}catch(F){return x.d.Warn(`${Y}/pointer: Invalid pointer (${C}) skipped`),null}}}r(nT),L(nT,!0,(J=>new DT(J)));class fT{constructor(J,T,b){this.frame=J,this.action=T,this.onlyOnce=b,this.isDone=!1}_clone(){return new fT(this.frame,this.action,this.onlyOnce)}}var zT=b(533),MT=b(581),yT=b(575);class kT{get loop(){return this._loop}set loop(J){J!==this._loop&&(this._loop=J,this.updateOptions({loop:J}))}get currentTime(){var J;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(J=MT.b.audioEngine)&&void 0!==J&&J.audioContext&&(this.isPlaying||this.isPaused)){const J=this.isPaused?0:MT.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+J}return 0}get spatialSound(){return this._spatialSound}set spatialSound(J){if(J==this._spatialSound)return;const T=this.isPlaying;this.pause(),J?(this._spatialSound=J,this._updateSpatialParameters()):this._disableSpatialSound(),T&&this.play()}constructor(J,T,b){var q;let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new A.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=t.n.Zero(),this._localDirection=new t.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=J,b=b||G.e.LastCreatedScene)if(this._scene=b,kT._SceneComponentInitialization(b),this._readyToPlayCallback=j,this._customAttenuationFunction=(J,T,b,q,t)=>T<b?J*(1-T/b):0,Y&&(this.autoplay=Y.autoplay||!1,this._loop=Y.loop||!1,void 0!==Y.volume&&(this._volume=Y.volume),this._spatialSound=Y.spatialSound??!1,this.maxDistance=Y.maxDistance??100,this.useCustomAttenuation=Y.useCustomAttenuation??!1,this.rolloffFactor=Y.rolloffFactor||1,this.refDistance=Y.refDistance||1,this.distanceModel=Y.distanceModel||"linear",this._playbackRate=Y.playbackRate||1,this._streaming=Y.streaming??!1,this._length=Y.length,this._offset=Y.offset),null!==(q=MT.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&MT.b.audioEngine.audioContext){this._soundGain=MT.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let J=!0;if(T)try{"string"===typeof T?(this._urlType="String",this._url=T):T instanceof ArrayBuffer?this._urlType="ArrayBuffer":T instanceof HTMLMediaElement?this._urlType="MediaElement":T instanceof MediaStream?this._urlType="MediaStream":T instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(T)&&(this._urlType="Array");let b=[],q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=MT.b.audioEngine.audioContext.createMediaElementSource(T),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=MT.b.audioEngine.audioContext.createMediaStreamSource(T),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":T.byteLength>0&&(q=!0,this._soundLoaded(T));break;case"AudioBuffer":this._audioBufferLoaded(T);break;case"String":b.push(T);case"Array":0===b.length&&(b=T);for(let J=0;J<b.length;J++){const T=b[J];if(q=Y&&Y.skipCodecCheck||-1!==T.indexOf(".mp3",T.length-4)&&MT.b.audioEngine.isMP3supported||-1!==T.indexOf(".ogg",T.length-4)&&MT.b.audioEngine.isOGGsupported||-1!==T.indexOf(".wav",T.length-4)||-1!==T.indexOf(".m4a",T.length-4)||-1!==T.indexOf(".mp4",T.length-4)||-1!==T.indexOf("blob:"),q){this._streaming?(this._htmlAudioElement=new Audio(T),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,B.e.SetCorsBehavior(T,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(T,(J=>{this._soundLoaded(J)}),void 0,!0,!0,(J=>{J&&x.d.Error("XHR "+J.status+" error on: "+T+"."),x.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:J=!1}J?q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):x.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){x.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),MT.b.audioEngine&&!MT.b.audioEngine.WarnedWebAudioUnsupported&&(x.d.Error("Web Audio is not supported by your browser."),MT.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var J;null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(J){var T;null!==(T=MT.b.audioEngine)&&void 0!==T&&T.audioContext&&(this._audioBuffer=J,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(J){var T;null!==(T=MT.b.audioEngine)&&void 0!==T&&T.audioContext&&MT.b.audioEngine.audioContext.decodeAudioData(J,(J=>{this._audioBufferLoaded(J)}),(J=>{x.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+J)}))}setAudioBuffer(J){var T;null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&(this._audioBuffer=J,this._isReadyToPlay=!0)}updateOptions(J){J&&(this.loop=J.loop??this.loop,this.maxDistance=J.maxDistance??this.maxDistance,this.useCustomAttenuation=J.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=J.rolloffFactor??this.rolloffFactor,this.refDistance=J.refDistance??this.refDistance,this.distanceModel=J.distanceModel??this.distanceModel,this._playbackRate=J.playbackRate??this._playbackRate,this._length=J.length??void 0,this.spatialSound=J.spatialSound??this._spatialSound,this._setOffset(J.offset??void 0),this.setVolume(J.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var J;null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&MT.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??MT.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var J;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(J=this._soundPanner)||void 0===J||J.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var J;null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(J){var T;null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(J),this._isOutputConnected=!0)}setDirectionalCone(J,T,b){T<J?x.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=J,this._coneOuterAngle=T,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(J){if(J!=this._coneInnerAngle){var T;if(this._coneOuterAngle<J)return void x.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=J,null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(J){if(J!=this._coneOuterAngle){var T;if(J<this._coneInnerAngle)return void x.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=J,null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(J){var T;J.equals(this._position)||(this._position.p(J),null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(J){var T;this._localDirection=J,null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const J=this._connectedTransformNode.getWorldMatrix(),T=t.n.TransformNormal(this._localDirection,J);T.normalize(),this._soundPanner.orientationX.value=T.x,this._soundPanner.orientationY.value=T.y,this._soundPanner.orientationZ.value=T.z}updateDistanceFromListener(){var J;if(null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const J=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Jg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,J,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(J){this._customAttenuationFunction=J}play(J,T,b){var q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(q=MT.b.audioEngine)&&void 0!==q&&q.audioContext)try{var t,j;this._clearTimeoutsAndObservers();let q=J?(null===(t=MT.b.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+J:null===(j=MT.b.audioEngine)||void 0===j?void 0:j.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=MT.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const J=()=>{var b;if(null!==(b=MT.b.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=T??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var T,b;(null===(T=MT.b.audioEngine)||void 0===T||T.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=MT.b.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{J()})))}))}else{var q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(q=MT.b.audioEngine)||void 0===q?void 0:q.onAudioUnlockedObservable.addOnce((()=>{J()}))}};J()}}else{var B;const t=()=>{var t;if(null!==(t=MT.b.audioEngine)&&void 0!==t&&t.audioContext){var j;if(b=b||this._length,void 0!==T&&this._setOffset(T),this._soundSource){const J=this._soundSource;J.onended=()=>{J.disconnect()}}if(this._soundSource=null===(j=MT.b.audioEngine)||void 0===j?void 0:j.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var B;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==T&&(this._soundSource.loopStart=T),void 0!==b&&(this._soundSource.loopEnd=(0|T)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},q=J?(null===(B=MT.b.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+J:MT.b.audioEngine.audioContext.currentTime;const t=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(q,t,this.loop?void 0:b)}}};"suspended"===(null===(B=MT.b.audioEngine)||void 0===B?void 0:B.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var J;"suspended"===(null===(J=MT.b.audioEngine)||void 0===J?void 0:J.audioContext.state)?(MT.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=MT.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{t()})))):t()}),500):t()}this._startTime=q,this.isPlaying=!0,this.isPaused=!1}catch(Y){x.d.Error("Error while trying to play audio: "+this.name+", "+Y.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(J){var T;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(T=MT.b.audioEngine)&&void 0!==T&&T.audioContext&&this._soundSource){const T=J?MT.b.audioEngine.audioContext.currentTime+J:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(T)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var J;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var T;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(T=this._streamingSource)||void 0===T||T.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(J=MT.b.audioEngine)&&void 0!==J&&J.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=MT.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(J,T){var b;null!==(b=MT.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(T&&MT.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(MT.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,MT.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(J,MT.b.audioEngine.audioContext.currentTime+T)):this._soundGain.gain.value=J),this._volume=J}setPlaybackRate(J){this._playbackRate=J,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(J){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=J,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=J=>this._onRegisterAfterWorldMatrixUpdate(J),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(J){var T;if(J.getBoundingInfo){const T=J.getBoundingInfo();this.setPosition(T.boundingSphere.centerWorld)}else this.setPosition(J.absolutePosition);null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const J=()=>{(0,yT.h)((()=>this._isReadyToPlay),(()=>{b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)}),void 0,300)},T={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new kT(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,T);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),J(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const J={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(J.connectedMeshId=this._connectedTransformNode.id),J.position=this._position.Ai(),J.refDistance=this.refDistance,J.distanceModel=this.distanceModel,J.isDirectional=this._isDirectional,J.localDirectionToMesh=this._localDirection.Ai(),J.coneInnerAngle=this._coneInnerAngle,J.coneOuterAngle=this._coneOuterAngle,J.coneOuterGain=this._coneOuterGain),J}static Parse(J,T,b,q){const j=J.name;let B;B=J.url?b+J.url:b+j;const Y={autoplay:J.autoplay,loop:J.loop,volume:J.volume,spatialSound:J.spatialSound,maxDistance:J.maxDistance,rolloffFactor:J.rolloffFactor,refDistance:J.refDistance,distanceModel:J.distanceModel,playbackRate:J.playbackRate};let C;if(q){const J=()=>{(0,yT.h)((()=>q._isReadyToPlay),(()=>{C._audioBuffer=q.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)}),void 0,300)};C=new kT(j,new ArrayBuffer(0),T,null,Y),J()}else C=new kT(j,B,T,(()=>{T.removePendingData(C)}),Y),T.addPendingData(C);if(J.position){const T=t.n.ni(J.position);C.setPosition(T)}if(J.isDirectional&&(C.setDirectionalCone(J.coneInnerAngle||360,J.coneOuterAngle||360,J.coneOuterGain||0),J.localDirectionToMesh)){const T=t.n.ni(J.localDirectionToMesh);C.setLocalDirectionToMesh(T)}if(J.connectedMeshId){const b=T.getMeshById(J.connectedMeshId);b&&C.attachToMesh(b)}return J.metadata&&(C.metadata=J.metadata),C}_setOffset(J){this._offset!==J&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=J)}_clearTimeoutsAndObservers(){var J;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(J=MT.b.audioEngine)||void 0===J||J.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}kT._SceneComponentInitialization=J=>{throw(0,zT.e)("AudioSceneComponent")},(0,p.g)("BABYLON.Sound",kT);class Jb{constructor(J,T,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],T.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=J,this._weights=b;let q=0;for(const j of b)q+=j;const t=q>0?1/q:0;for(let j=0;j<this._weights.length;j++)this._weights[j]*=t;this._sounds=T;for(const j of this._sounds)j.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(J){if(J!==this._coneInnerAngle){if(this._coneOuterAngle<J)return void x.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=J;for(const T of this._sounds)T.directionalConeInnerAngle=J}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(J){if(J!==this._coneOuterAngle){if(J<this._coneInnerAngle)return void x.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=J;for(const T of this._sounds)T.directionalConeOuterAngle=J}}get volume(){return this._volume}set volume(J){if(J!==this._volume)for(const T of this._sounds)T.setVolume(J)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(J){if(!this.isPaused){this.stop();const J=Math.random();let T=0;for(let b=0;b<this._weights.length;b++)if(T+=this._weights[b],J<=T){this._currentIndex=b;break}}const T=this._sounds[this._currentIndex??0];T.isReady()?T.play(0,this.isPaused?void 0:J):T.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Tb{constructor(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(J=J||G.e.LastCreatedScene)&&(this._scene=J,this.soundCollection=[],this._options=T,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var J;null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&MT.b.audioEngine.audioContext&&(this._outputAudioNode=MT.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(MT.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(MT.b.audioEngine&&MT.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(J){var T;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&J.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==J.soundTrackId&&(-1===J.soundTrackId?this._scene.mainSoundTrack.removeSound(J):this._scene.soundTracks&&this._scene.soundTracks[J.soundTrackId].removeSound(J)),this.soundCollection.push(J),J.soundTrackId=this.id}removeSound(J){const T=this.soundCollection.indexOf(J);-1!==T&&this.soundCollection.splice(T,1)}setVolume(J){var T;null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=J)}switchPanningModelToHRTF(){var J;if(null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio)for(let T=0;T<this.soundCollection.length;T++)this.soundCollection[T].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var J;if(null!==(J=MT.b.audioEngine)&&void 0!==J&&J.canUseWebAudio)for(let T=0;T<this.soundCollection.length;T++)this.soundCollection[T].switchPanningModelToEqualPower()}connectToAnalyser(J){var T;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=J,null!==(T=MT.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,MT.b.audioEngine.masterGain))}}var bb=b(884),qb=b(2440),tb=b(510);MT.b.AudioEngineFactory=(J,T,b)=>new jb(J,T,b);class jb{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new A.b,this.onAudioLockedObservable=new A.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,tb.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const q=document.createElement("audio");this._hostElement=J,this._audioContext=T,this._audioDestination=b;try{q&&q.canPlayType&&(q.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||q.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{q&&q.canPlayType&&q.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){var J,T;if("running"===(null===(J=this._audioContext)||void 0===J?void 0:J.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(T=this._audioContext)||void 0===T||T.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{x.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var J;null===(J=this._audioContext)||void 0===J||J.addEventListener("statechange",(()=>{var J;this.unlocked&&"running"!==(null===(J=this._audioContext)||void 0===J?void 0:J.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var J;return null!==(J=this._audioContext)&&void 0!==J&&J.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(J){this.canUseWebAudio=!1,x.d.Error("Web Audio: "+J.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(J){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const J=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",T=document.createElement("style");T.appendChild(document.createTextNode(J)),document.getElementsByTagName("head")[0].appendChild(T),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var J;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(J=this._audioContext)||void 0===J||J.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(J){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=J)}connectToAnalyser(J){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=J,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Bb=b(529);(0,b(12174).f)(bb.e.NAME_AUDIO,((J,T,b,q)=>{let t,j=[];if(b.om=b.om||[],void 0!==J.om&&null!==J.om)for(let Y=0,C=J.om.length;Y<C;Y++){var B;const C=J.om[Y];null!==(B=MT.b.audioEngine)&&void 0!==B&&B.canUseWebAudio?(C.url||(C.url=C.name),j[C.url]?b.om.push(kT.Parse(C,T,q,j[C.url])):(t=kT.Parse(C,T,q),j[C.url]=t,b.om.push(t))):b.om.push(new kT(C.name,null,T))}j=[]})),Object.defineProperty(qb.b.prototype,"mainSoundTrack",{get:function(){let J=this._getComponent(bb.e.NAME_AUDIO);return J||(J=new Yb(this),this.bb(J)),this._mainSoundTrack||(this._mainSoundTrack=new Tb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),qb.b.prototype.getSoundByName=function(J){let T;for(T=0;T<this.mainSoundTrack.soundCollection.length;T++)if(this.mainSoundTrack.soundCollection[T].name===J)return this.mainSoundTrack.soundCollection[T];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(T=0;T<this.soundTracks[b].soundCollection.length;T++)if(this.soundTracks[b].soundCollection[T].name===J)return this.soundTracks[b].soundCollection[T];return null},Object.defineProperty(qb.b.prototype,"audioEnabled",{get:function(){let J=this._getComponent(bb.e.NAME_AUDIO);return J||(J=new Yb(this),this.bb(J)),J.audioEnabled},set:function(J){let T=this._getComponent(bb.e.NAME_AUDIO);T||(T=new Yb(this),this.bb(T)),J?T.enableAudio():T.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(qb.b.prototype,"headphone",{get:function(){let J=this._getComponent(bb.e.NAME_AUDIO);return J||(J=new Yb(this),this.bb(J)),J.headphone},set:function(J){let T=this._getComponent(bb.e.NAME_AUDIO);T||(T=new Yb(this),this.bb(T)),J?T.switchAudioModeForHeadphones():T.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(qb.b.prototype,"audioListenerPositionProvider",{get:function(){let J=this._getComponent(bb.e.NAME_AUDIO);return J||(J=new Yb(this),this.bb(J)),J.audioListenerPositionProvider},set:function(J){let T=this._getComponent(bb.e.NAME_AUDIO);if(T||(T=new Yb(this),this.bb(T)),J&&"function"!==typeof J)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");T.audioListenerPositionProvider=J},enumerable:!0,configurable:!0}),Object.defineProperty(qb.b.prototype,"audioListenerRotationProvider",{get:function(){let J=this._getComponent(bb.e.NAME_AUDIO);return J||(J=new Yb(this),this.bb(J)),J.audioListenerRotationProvider},set:function(J){let T=this._getComponent(bb.e.NAME_AUDIO);if(T||(T=new Yb(this),this.bb(T)),J&&"function"!==typeof J)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");T.audioListenerRotationProvider=J},enumerable:!0,configurable:!0}),Object.defineProperty(qb.b.prototype,"audioPositioningRefreshRate",{get:function(){let J=this._getComponent(bb.e.NAME_AUDIO);return J||(J=new Yb(this),this.bb(J)),J.audioPositioningRefreshRate},set:function(J){let T=this._getComponent(bb.e.NAME_AUDIO);T||(T=new Yb(this),this.bb(T)),T.audioPositioningRefreshRate=J},enumerable:!0,configurable:!0});class Yb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(J){this.name=bb.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new t.n,this._cachedCameraPosition=new t.n,this._lastCheck=0,this._invertMatrixTemp=new t.e,this._cameraDirectionTemp=new t.n,(J=J||G.e.LastCreatedScene)&&(this.cg=J,J.soundTracks=[],J.om=[])}register(){this.cg._afterRenderStage.registerStep(bb.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(J){if(J.om=[],this.cg.soundTracks)for(let T=0;T<this.cg.soundTracks.length;T++){const b=this.cg.soundTracks[T];for(let T=0;T<b.soundCollection.length;T++)J.om.push(b.soundCollection[T].serialize())}}addFromContainer(J){if(J.om)for(const T of J.om)T.play(),T.autoplay=!0,this.cg.mainSoundTrack.addSound(T)}removeFromContainer(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(J.om)for(const b of J.om)b.stop(),b.autoplay=!1,this.cg.mainSoundTrack.removeSound(b),T&&b.dispose()}dispose(){const J=this.cg;if(J._mainSoundTrack&&J.mainSoundTrack.dispose(),J.soundTracks)for(let T=0;T<J.soundTracks.length;T++)J.soundTracks[T].dispose()}disableAudio(){const J=this.cg;let T;for(this._audioEnabled=!1,MT.b.audioEngine&&MT.b.audioEngine.audioContext&&MT.b.audioEngine.audioContext.suspend(),T=0;T<J.mainSoundTrack.soundCollection.length;T++)J.mainSoundTrack.soundCollection[T].pause();if(J.soundTracks)for(T=0;T<J.soundTracks.length;T++)for(let b=0;b<J.soundTracks[T].soundCollection.length;b++)J.soundTracks[T].soundCollection[b].pause()}enableAudio(){const J=this.cg;let T;for(this._audioEnabled=!0,MT.b.audioEngine&&MT.b.audioEngine.audioContext&&MT.b.audioEngine.audioContext.resume(),T=0;T<J.mainSoundTrack.soundCollection.length;T++)J.mainSoundTrack.soundCollection[T].isPaused&&J.mainSoundTrack.soundCollection[T].play();if(J.soundTracks)for(T=0;T<J.soundTracks.length;T++)for(let b=0;b<J.soundTracks[T].soundCollection.length;b++)J.soundTracks[T].soundCollection[b].isPaused&&J.soundTracks[T].soundCollection[b].play()}switchAudioModeForHeadphones(){const J=this.cg;if(this._headphone=!0,J.mainSoundTrack.switchPanningModelToHRTF(),J.soundTracks)for(let T=0;T<J.soundTracks.length;T++)J.soundTracks[T].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const J=this.cg;if(this._headphone=!1,J.mainSoundTrack.switchPanningModelToEqualPower(),J.soundTracks)for(let T=0;T<J.soundTracks.length;T++)J.soundTracks[T].switchPanningModelToEqualPower()}_afterRender(){const J=Bb.b.Now;if(this._lastCheck&&J-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=J;const T=this.cg;if(!this._audioEnabled||!T._mainSoundTrack||!T.soundTracks||0===T._mainSoundTrack.soundCollection.length&&1===T.soundTracks.length)return;const b=MT.b.audioEngine;if(b&&b.audioContext){let J,q=T.activeCamera;if(T.activeCameras&&T.activeCameras.length>0&&(q=T.activeCameras[0]),this.audioListenerPositionProvider){const J=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(J.x||0,J.y||0,J.z||0)}else q?this._cachedCameraPosition.equals(q.globalPosition)||(this._cachedCameraPosition.p(q.globalPosition),b.audioContext.listener.setPosition(q.globalPosition.x,q.globalPosition.y,q.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const J=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(J.x||0,J.y||0,J.z||0,0,1,0)}else q?(q.rigCameras&&q.rigCameras.length>0&&(q=q.rigCameras[0]),q.getViewMatrix().invertToRef(this._invertMatrixTemp),t.n.TransformNormalToRef(Yb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(J=0;J<T.mainSoundTrack.soundCollection.length;J++){const b=T.mainSoundTrack.soundCollection[J];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(T.soundTracks)for(J=0;J<T.soundTracks.length;J++)for(let b=0;b<T.soundTracks[J].soundCollection.length;b++){const q=T.soundTracks[J].soundCollection[b];q.useCustomAttenuation&&q.updateDistanceFromListener()}}}}Yb._CameraDirection=new t.n(0,0,-1),kT._SceneComponentInitialization=J=>{let T=J._getComponent(bb.e.NAME_AUDIO);T||(T=new Yb(J),J.bb(T))};const Cb="MSFT_audio_emitter";class Fb{constructor(J){this.name=Cb,this._loader=J,this.enabled=this._loader.isExtensionUsed(Cb)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const J=this._loader.Hi.extensions;if(J&&J[this.name]){const T=J[this.name];this._clips=T.clips,this._emitters=T.emitters,D.Assign(this._clips),D.Assign(this._emitters)}}loadSceneAsync(J,T){return z.LoadExtensionAsync(J,T,this.name,(async(b,q)=>{const t=new Array;t.push(this._loader.loadSceneAsync(J,T));for(const J of q.emitters){const T=D.Get(`${b}/emitters`,this._emitters,J);if(void 0!=T.refDistance||void 0!=T.maxDistance||void 0!=T.rolloffFactor||void 0!=T.distanceModel||void 0!=T.innerAngle||void 0!=T.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);t.push(this._loadEmitterAsync(`${b}/emitters/${T.index}`,T))}await Promise.all(t)}))}loadNodeAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(J,q)=>{const j=new Array,Y=await this._loader.loadNodeAsync(J,T,(T=>{for(const b of q.emitters){const q=D.Get(`${J}/emitters`,this._emitters,b);j.push(this._loadEmitterAsync(`${J}/emitters/${q.index}`,q).then((()=>{for(const J of q._babylonSounds)J.attachToMesh(T),void 0==q.innerAngle&&void 0==q.outerAngle||(J.setLocalDirectionToMesh(t.n.Forward()),J.setDirectionalCone(2*B.e.ToDegrees(void 0==q.innerAngle?Math.PI:q.innerAngle),2*B.e.ToDegrees(void 0==q.outerAngle?Math.PI:q.outerAngle),0))})))}b(T)}));return await Promise.all(j),Y}))}loadAnimationAsync(J,T){return z.LoadExtensionAsync(J,T,this.name,(async(b,q)=>{const t=await this._loader.loadAnimationAsync(J,T),j=new Array;D.Assign(q.events);for(const B of q.events)j.push(this._loadAnimationEventAsync(`${b}/events/${B.index}`,J,T,B,t));return await Promise.all(j),t}))}_loadClipAsync(J,T){if(T._objectURL)return T._objectURL;let b;if(T.uri)b=this._loader.loadUriAsync(J,T,T.uri);else{const q=D.Get(`${J}/bufferView`,this._loader.Hi.bufferViews,T.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}return T._objectURL=b.then((J=>URL.createObjectURL(new Blob([J],{type:T.mimeType})))),T._objectURL}_loadEmitterAsync(J,T){if(T._babylonSounds=T._babylonSounds||[],!T._babylonData){const J=new Array,b=T.name||`emitter${T.index}`,q={loop:!1,autoplay:!1,volume:void 0==T.volume?1:T.volume};for(let j=0;j<T.clips.length;j++){const t=`/extensions/${this.name}/clips`,B=D.Get(t,this._clips,T.clips[j].clip);J.push(this._loadClipAsync(`${t}/${T.clips[j].clip}`,B).then((J=>{const t=T._babylonSounds[j]=new kT(b,J,this._loader.babylonScene,null,q);t.refDistance=T.refDistance||1,t.maxDistance=T.maxDistance||256,t.rolloffFactor=T.rolloffFactor||1,t.distanceModel=T.distanceModel||"exponential"})))}const t=Promise.all(J).then((()=>{const J=T.clips.map((J=>J.weight||1)),b=new Jb(T.loop||!1,T._babylonSounds,J);T.innerAngle&&(b.directionalConeInnerAngle=2*B.e.ToDegrees(T.innerAngle)),T.outerAngle&&(b.directionalConeOuterAngle=2*B.e.ToDegrees(T.outerAngle)),T.volume&&(b.volume=T.volume),T._babylonData.sound=b}));T._babylonData={loaded:t}}return T._babylonData.loaded}_getEventAction(J,T,b,q,t){switch(b){case"play":return J=>{const b=(t||0)+(J-q);T.play(b)};case"stop":return()=>{T.stop()};case"pause":return()=>{T.pause()};default:throw new Error(`${J}: Unsupported action ${b}`)}}_loadAnimationEventAsync(J,T,b,q,t){if(0==t.targetedAnimations.length)return Promise.resolve();const j=t.targetedAnimations[0],B=q.j,Y=D.Get(`/extensions/${this.name}/emitters`,this._emitters,B);return this._loadEmitterAsync(J,Y).then((()=>{const T=Y._babylonData.sound;if(T){const b=new fT(q.time,this._getEventAction(J,T,q.action,q.time,q.startOffset));j.animation.addEvent(b),t.onAnimationGroupEndObservable.add((()=>{T.stop()})),t.onAnimationGroupPauseObservable.add((()=>{T.pause()}))}}))}}r(Cb),L(Cb,!0,(J=>new Fb(J)));const Ab="MSFT_lod";class ab{constructor(J){var T;this.name=Ab,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new A.b,this.onMaterialLODsLoadedObservable=new A.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=J,this.maxLODsToLoad=(null===(T=this._loader.parent.extensionOptions[Ab])||void 0===T?void 0:T.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Ab)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let J=0;J<this._nodePromiseLODs.length;J++){const T=Promise.all(this._nodePromiseLODs[J]).then((()=>{0!==J&&(this._loader.endPerformanceCounter(`Node LOD ${J}`),this._loader.log(`Loaded node LOD ${J}`)),this.onNodeLODsLoadedObservable.notifyObservers(J),J!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${J+1}`),this._loadBufferLOD(this._nodeBufferLODs,J+1),this._nodeSignalLODs[J]&&this._nodeSignalLODs[J].resolve())}));this._loader._completePromises.push(T)}for(let J=0;J<this._materialPromiseLODs.length;J++){const T=Promise.all(this._materialPromiseLODs[J]).then((()=>{0!==J&&(this._loader.endPerformanceCounter(`Material LOD ${J}`),this._loader.log(`Loaded material LOD ${J}`)),this.onMaterialLODsLoadedObservable.notifyObservers(J),J!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${J+1}`),this._loadBufferLOD(this._materialBufferLODs,J+1),this._materialSignalLODs[J]&&this._materialSignalLODs[J].resolve())}));this._loader._completePromises.push(T)}}loadSceneAsync(J,T){const b=this._loader.loadSceneAsync(J,T);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(J,T,b){return z.LoadExtensionAsync(J,T,this.name,(async(J,t)=>{let j;const B=this._getLODs(J,T,this._loader.Hi.nodes,t.ids);this._loader.logOpen(`${J}`);for(let T=0;T<B.length;T++){const J=B[T];0!==T&&(this._nodeIndexLOD=T,this._nodeSignalLODs[T]=this._nodeSignalLODs[T]||new q);const t=J=>{b(J),J.di(!1)},Y=this._loader.loadNodeAsync(`/nodes/${J.index}`,J,t).then((J=>{if(0!==T){const J=B[T-1];J._babylonTransformNode&&(this._disposeTransformNode(J._babylonTransformNode),delete J._babylonTransformNode)}return J.di(!0),J}));this._nodePromiseLODs[T]=this._nodePromiseLODs[T]||[],0===T?j=Y:(this._nodeIndexLOD=null,this._nodePromiseLODs[T].push(Y))}return this._loader.logClose(),await j}))}_loadMaterialAsync(J,T,b,q,t){return this._nodeIndexLOD?null:z.LoadExtensionAsync(J,T,this.name,(async(J,j)=>{let B;const Y=this._getLODs(J,T,this._loader.Hi.materials,j.ids);this._loader.logOpen(`${J}`);for(let T=0;T<Y.length;T++){const J=Y[T];0!==T&&(this._materialIndexLOD=T);const j=this._loader._loadMaterialAsync(`/materials/${J.index}`,J,b,q,(J=>{0===T&&t(J)})).then((J=>{if(0!==T){t(J);const b=Y[T-1]._data;b[q]&&(this._disposeMaterials([b[q].babylonMaterial]),delete b[q])}return J}));this._materialPromiseLODs[T]=this._materialPromiseLODs[T]||[],0===T?B=j:(this._materialIndexLOD=null,this._materialPromiseLODs[T].push(j))}return this._loader.logClose(),await B}))}_loadUriAsync(J,T,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const t=this._nodeIndexLOD-1;return this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(J,T,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const t=this._materialIndexLOD-1;return this._materialSignalLODs[t]=this._materialSignalLODs[t]||new q,this._materialSignalLODs[t].promise.then((async()=>await this._loader.loadUriAsync(J,T,b)))}return null}loadBufferAsync(J,T,b,t){if(this._loader.parent.useRangeRequests&&!T.uri){if(!this._loader.bin)throw new Error(`${J}: Uri is missing or the binary glTF is missing its binary chunk`);const T=async(J,T)=>{const j=b,B=j+t-1;let Y=J[T];return Y?(Y.start=Math.min(Y.start,j),Y.end=Math.max(Y.end,B)):(Y={start:j,end:B,loaded:new q},J[T]=Y),await Y.loaded.promise.then((J=>new Uint8Array(J.buffer,J.byteOffset+b-Y.start,t)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?T(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?T(this._materialBufferLODs,this._materialIndexLOD):T(this._bufferLODs,0)}return null}_loadBufferLOD(J,T){const b=J[T];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((J=>{b.loaded.resolve(J)}),(J=>{b.loaded.reject(J)})))}_getLODs(J,T,b,q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const t=[];for(let j=q.length-1;j>=0;j--)if(t.push(D.Get(`${J}/ids/${q[j]}`,b,q[j])),t.length===this.maxLODsToLoad)return t;return t.push(T),t}_disposeTransformNode(J){const T=[],b=J.material;b&&T.push(b);for(const t of J.getChildMeshes())t.material&&T.push(t.material);J.dispose();const q=T.filter((J=>this._loader.babylonScene.meshes.every((T=>T.material!=J))));this._disposeMaterials(q)}_disposeMaterials(J){const T={};for(const b of J){for(const J of b.getActiveTextures())T[J.uniqueId]=J;b.dispose()}for(const b in T)for(const J of this._loader.babylonScene.materials)J.hasTexture(T[b])&&delete T[b];for(const b in T)T[b].dispose()}}r(Ab),L(Ab,!0,(J=>new ab(J)));const Pb="MSFT_minecraftMesh";class vb{constructor(J){this.name=Pb,this._loader=J,this.enabled=this._loader.isExtensionUsed(Pb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtraAsync(J,T,this.name,(async(q,t)=>{if(t){if(!(b instanceof S))throw new Error(`${q}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(J,T,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.zi=b.forceDepthWrite,b.twoSidedLighting=!0,await t}}))}}r(Pb),L(Pb,!0,(J=>new vb(J)));const Gb="MSFT_sRGBFactors";class xb{constructor(J){this.name=Gb,this._loader=J,this.enabled=this._loader.isExtensionUsed(Gb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(J,T,b){return z.LoadExtraAsync(J,T,this.name,(async(q,t)=>{if(t){if(!(b instanceof S))throw new Error(`${q}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(J,T,b),j=b.va().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,j),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,j),await t}}))}}r(Gb),L(Gb,!0,(J=>new xb(J)));var Ib=b(12582);const ub={};var Ub=b(12639),Kb=b(12620),Eb=b(12591),lb=b(12603);function Wb(J,T){for(const b of J)for(const J of b.dataOutputs)if(J.uniqueId===T)return J;throw new Error("Could not find data out connection with unique id "+T)}function pb(J,T){for(const b of J)if(b instanceof Kb.c)for(const J of b.signalInputs)if(J.uniqueId===T)return J;throw new Error("Could not find signal in connection with unique id "+T)}async function ob(J,T){const q=await Promise.all(J.allBlocks.map((async J=>{const T=function(J){switch(J){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([b.e(49),b.e(54)]).then(b.bind(b,13798))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await b.e(55).then(b.bind(b,13801))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await b.e(56).then(b.bind(b,13806))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await b.e(57).then(b.bind(b,13810))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await b.e(58).then(b.bind(b,13818))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await b.e(59).then(b.bind(b,13825))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await b.e(60).then(b.bind(b,13834))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await b.e(61).then(b.bind(b,13840))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await b.e(62).then(b.bind(b,13849))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await b.e(65).then(b.bind(b,13887))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await b.e(65).then(b.bind(b,13887))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await b.e(65).then(b.bind(b,13887))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await b.e(65).then(b.bind(b,13887))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await b.e(70).then(b.bind(b,13893))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await b.e(71).then(b.bind(b,13895))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await b.e(72).then(b.bind(b,13903))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await b.e(73).then(b.bind(b,13912))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await b.e(74).then(b.bind(b,13919))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await b.e(75).then(b.bind(b,13928))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await b.e(76).then(b.bind(b,13935))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await b.e(77).then(b.bind(b,13940))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await b.e(78).then(b.bind(b,13945))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await b.e(79).then(b.bind(b,13954))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await b.e(80).then(b.bind(b,13959))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await b.e(81).then(b.bind(b,13961))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await b.e(82).then(b.bind(b,13969))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await b.e(83).then(b.bind(b,13977))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await b.e(84).then(b.bind(b,13985))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await b.e(85).then(b.bind(b,13989))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await b.e(86).then(b.bind(b,13993))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await b.e(87).then(b.bind(b,14e3))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await b.e(88).then(b.bind(b,14003))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await b.e(67).then(b.bind(b,14006))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await b.e(89).then(b.bind(b,14012))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await b.e(90).then(b.bind(b,14016))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await b.e(91).then(b.bind(b,14018))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await b.e(68).then(b.bind(b,14022))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await b.e(63).then(b.bind(b,13853))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await b.e(69).then(b.bind(b,14026))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await b.e(64).then(b.bind(b,13878))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await b.e(65).then(b.bind(b,13887))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await b.e(65).then(b.bind(b,13887))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await b.e(66).then(b.bind(b,14033))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await b.e(66).then(b.bind(b,14033))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await b.e(66).then(b.bind(b,14033))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await b.e(66).then(b.bind(b,14033))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await b.e(66).then(b.bind(b,14033))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await b.e(66).then(b.bind(b,14033))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await b.e(92).then(b.bind(b,14037))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await b.e(93).then(b.bind(b,14042))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await b.e(94).then(b.bind(b,14044))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await b.e(95).then(b.bind(b,14046))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await b.e(96).then(b.bind(b,14054))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await b.e(97).then(b.bind(b,14056))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await b.e(98).then(b.bind(b,14065))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await b.e(99).then(b.bind(b,14074))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await b.e(100).then(b.bind(b,14080))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await b.e(101).then(b.bind(b,14089))).FlowGraphDataSwitchBlock;default:if(ub[J])return ub[J];throw new Error(`Unknown block name ${J}`)}}(J.className);return await T()})));return function(J,T,b){const q=T.coordinator.createGraph(),t=[],j=T.valueParseFunction??Eb.d;for(let B=0;B<J.allBlocks.length;B++){const Y=Hb(J.allBlocks[B],{cg:T.coordinator.config.cg,pathConverter:T.pathConverter,assetsContainer:T.coordinator.config.cg,valueParseFunction:j},b[B]);t.push(Y),Y instanceof Ub.d&&q.addEventBlock(Y)}for(const B of t){for(const J of B.dataInputs)for(const T of J.connectedPointIds){const b=Wb(t,T);J.connectTo(b)}if(B instanceof Kb.c)for(const J of B.signalOutputs)for(const T of J.connectedPointIds){const b=pb(t,T);J.connectTo(b)}}for(const B of J.executionContexts)Sb(B,{graph:q,valueParseFunction:j},J.rightHanded);return q}(J,T,q)}function Sb(J,T,b){const q=T.graph.createContext();J.enableLogging&&(q.enableLogging=!0),q.treatDataAsRightHanded=b||!1;const t=T.valueParseFunction??Eb.d;q.uniqueId=J.uniqueId;const j=q.va();if(J._assetsContext){var B,Y,C,F,A,a,P,v,G,x;const T=J._assetsContext,b={meshes:null===(B=T.meshes)||void 0===B?void 0:B.map((J=>j.getMeshById(J))),lights:null===(Y=T.lights)||void 0===Y?void 0:Y.map((J=>j.getLightByName(J))),cameras:null===(C=T.cameras)||void 0===C?void 0:C.map((J=>j.getCameraByName(J))),materials:null===(F=T.materials)||void 0===F?void 0:F.map((J=>j.getMaterialById(J))),textures:null===(A=T.textures)||void 0===A?void 0:A.map((J=>j.getTextureByName(J))),animations:null===(a=T.animations)||void 0===a?void 0:a.map((J=>j.animations.find((T=>T.name===J)))),skeletons:null===(P=T.skeletons)||void 0===P?void 0:P.map((J=>j.getSkeletonByName(J))),si:null===(v=T.si)||void 0===v?void 0:v.map((J=>j.getParticleSystemById(J))),animationGroups:null===(G=T.animationGroups)||void 0===G?void 0:G.map((J=>j.getAnimationGroupByName(J))),transformNodes:null===(x=T.transformNodes)||void 0===x?void 0:x.map((J=>j.getTransformNodeById(J))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],om:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};q.assetsContext=b}for(const I in J._userVariables){const T=t(I,J._userVariables,q.assetsContext,j);q.userVariables[I]=T}for(const I in J._connectionValues){const T=t(I,J._connectionValues,q.assetsContext,j);q._setConnectionValueByKey(I,T)}return q}function Hb(J,T,b){const q={},t=T.valueParseFunction??Eb.d;if(J.config)for(const B in J.config)q[B]=t(B,J.config,T.assetsContainer||T.cg,T.cg);if((0,Eb.h)(J.className)){if(!T.pathConverter)throw new Error("Path converter is required for this block");q.pathConverter=T.pathConverter}const j=new b(q);j.uniqueId=J.uniqueId;for(let B=0;B<J.dataInputs.length;B++){const T=j.getDataInput(J.dataInputs[B].name);if(!T)throw new Error("Could not find data input with name "+J.dataInputs[B].name+" in block "+J.className);T.deserialize(J.dataInputs[B])}for(let B=0;B<J.dataOutputs.length;B++){const T=j.getDataOutput(J.dataOutputs[B].name);if(!T)throw new Error("Could not find data output with name "+J.dataOutputs[B].name+" in block "+J.className);T.deserialize(J.dataOutputs[B])}return j.metadata=J.metadata,j.deserialize&&j.deserialize(J),j}function sb(J){const[T,b]=J.split(":");return gb({op:T,extension:b})}function gb(J){var T;let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=J.extension?null===(T=wb[J.extension])||void 0===T?void 0:T[J.op]:Zb[J.op];if(!q&&(x.d.Warn(`No mapping found for operation ${J.op} and extension ${J.extension||"KHR_interactivity"}`),b)){const T={},b={flows:{}};if(J.inputValueSockets){T.values={};for(const b in J.inputValueSockets)T.values[b]={name:b}}return J.outputValueSockets&&(b.values={},Object.keys(J.outputValueSockets).forEach((J=>{b.values[J]={name:J}}))),{Tk:[],inputs:T,outputs:b}}return q}function db(J,T,b){wb[T]||(wb[T]={}),wb[T][J]=b}const wb={BABYLON:{"flow/log":{Tk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Zb={"event/onStart":{Tk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Tk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Tk:["FlowGraphSendCustomEventBlock"],extraProcessor(J,T,b,q,t){if("event/send"!==T.op||!J.configuration||1!==Object.keys(J.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const j=J.configuration.event.value[0];if("number"!==typeof j)throw new Error("Event id should be a number");const B=q.arrays.events[j],Y=t[0];return Y.config||(Y.config={}),Y.config.eventId=B.eventId,Y.config.eventData=B.eventData,t}},"event/receive":{Tk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(J,T){var b;if(!J.configuration)return x.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const q=J.configuration.event;if(!q)return x.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const t=q.value[0];if("number"!==typeof t)return x.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(b=T.events)||void 0===b?void 0:b[t])?{valid:!0}:(x.d.Error(`Event with id ${t} not found`),{valid:!1,error:`Event with id ${t} not found`})},extraProcessor(J,T,b,q,t){if("event/receive"!==T.op||!J.configuration||1!==Object.keys(J.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const j=J.configuration.event.value[0];if("number"!==typeof j)throw new Error("Event id should be a number");const B=q.arrays.events[j],Y=t[0];return Y.config||(Y.config={}),Y.config.eventId=B.eventId,Y.config.eventData=B.eventData,t}},"math/e":eb("FlowGraphEBlock"),"math/pi":eb("FlowGraphPIBlock"),"math/inf":eb("FlowGraphInfBlock"),"math/nan":eb("FlowGraphNaNBlock"),"math/abs":eb("FlowGraphAbsBlock"),"math/sign":eb("FlowGraphSignBlock"),"math/trunc":eb("FlowGraphTruncBlock"),"math/floor":eb("FlowGraphFloorBlock"),"math/ceil":eb("FlowGraphCeilBlock"),"math/round":{Tk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t){var j;return(j=t[0]).config||(j.config={}),t[0].config.roundHalfAwayFromZero=!0,t}},"math/fract":eb("FlowGraphFractBlock"),"math/neg":eb("FlowGraphNegationBlock"),"math/add":eb("FlowGraphAddBlock",["a","b"],!0),"math/sub":eb("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Tk:["FlowGraphMultiplyBlock"],extraProcessor(J,T,b,q,t){var j;(j=t[0]).config||(j.config={}),t[0].config.useMatrixPerComponent=!0,t[0].config.preventIntegerFloatArithmetic=!0;let B=-1;return Object.keys(J.values||{}).find((T=>{var b;return void 0!==(null===(b=J.values)||void 0===b?void 0:b[T].type)&&(B=J.values[T].type,!0)})),-1!==B&&(t[0].config.type=q.arrays.types[B].flowGraphType),t},validation:J=>J.values?cb(J):{valid:!0}},"math/div":eb("FlowGraphDivideBlock",["a","b"],!0),"math/rem":eb("FlowGraphModuloBlock",["a","b"]),"math/min":eb("FlowGraphMinBlock",["a","b"]),"math/max":eb("FlowGraphMaxBlock",["a","b"]),"math/clamp":eb("FlowGraphClampBlock",["a","b","c"]),"math/saturate":eb("FlowGraphSaturateBlock"),"math/mix":eb("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":eb("FlowGraphEqualityBlock",["a","b"]),"math/lt":eb("FlowGraphLessThanBlock",["a","b"]),"math/le":eb("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":eb("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":eb("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":eb("FlowGraphIsNaNBlock"),"math/isinf":eb("FlowGraphIsInfBlock"),"math/select":{Tk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Tk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":eb("FlowGraphSinBlock"),"math/cos":eb("FlowGraphCosBlock"),"math/tan":eb("FlowGraphTanBlock"),"math/asin":eb("FlowGraphASinBlock"),"math/acos":eb("FlowGraphACosBlock"),"math/atan":eb("FlowGraphATanBlock"),"math/atan2":eb("FlowGraphATan2Block",["a","b"]),"math/sinh":eb("FlowGraphSinhBlock"),"math/cosh":eb("FlowGraphCoshBlock"),"math/tanh":eb("FlowGraphTanhBlock"),"math/asinh":eb("FlowGraphASinhBlock"),"math/acosh":eb("FlowGraphACoshBlock"),"math/atanh":eb("FlowGraphATanhBlock"),"math/exp":eb("FlowGraphExponentialBlock"),"math/log":eb("FlowGraphLogBlock"),"math/log2":eb("FlowGraphLog2Block"),"math/log10":eb("FlowGraphLog10Block"),"math/sqrt":eb("FlowGraphSquareRootBlock"),"math/cbrt":eb("FlowGraphCubeRootBlock"),"math/pow":eb("FlowGraphPowerBlock",["a","b"]),"math/length":eb("FlowGraphLengthBlock"),"math/normalize":eb("FlowGraphNormalizeBlock"),"math/dot":eb("FlowGraphDotBlock",["a","b"]),"math/cross":eb("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":eb("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":eb("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Tk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Tk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Tk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Tk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Tk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Tk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Tk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":eb("FlowGraphTransposeBlock"),"math/determinant":eb("FlowGraphDeterminantBlock"),"math/inverse":eb("FlowGraphInvertMatrixBlock"),"math/matmul":eb("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Tk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ii",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t,j){const B=t[0].dataInputs.find((J=>"rotationQuaternion"===J.name));if(!B)throw new Error("Rotation quaternion input not found");return j._connectionValues[B.uniqueId]&&(j._connectionValues[B.uniqueId].type="Quaternion"),t}},"math/matDecompose":{Tk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ii"}}}},"math/quatConjugate":eb("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Tk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t){var j;return(j=t[0]).config||(j.config={}),t[0].config.type="Quaternion",t}},"math/quatAngleBetween":eb("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Tk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":eb("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":eb("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Tk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t){var j;return(j=t[0]).config||(j.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract2x2":{Tk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Tk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t){var j;return(j=t[0]).config||(j.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract3x3":{Tk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Tk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t){var j;return(j=t[0]).config||(j.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract4x4":{Tk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Tk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t,j){var B,Y;(Y=t[0]).config||(Y.config={});const C=t[0].dataInputs[0];return t[0].config.valueType=(null===(B=j._connectionValues[C.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",t}},"math/and":{Tk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t,j){var B,Y,C;(C=t[0]).config||(C.config={});const F=t[0].dataInputs[0],A=t[0].dataInputs[1];return t[0].config.valueType=(null===(B=j._connectionValues[F.uniqueId])||void 0===B?void 0:B.type)??(null===(Y=j._connectionValues[A.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",t}},"math/or":{Tk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t,j){var B,Y,C;(C=t[0]).config||(C.config={});const F=t[0].dataInputs[0],A=t[0].dataInputs[1];return t[0].config.valueType=(null===(B=j._connectionValues[F.uniqueId])||void 0===B?void 0:B.type)??(null===(Y=j._connectionValues[A.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",t}},"math/xor":{Tk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(J,T,b,q,t,j){var B,Y,C;(C=t[0]).config||(C.config={});const F=t[0].dataInputs[0],A=t[0].dataInputs[1];return t[0].config.valueType=(null===(B=j._connectionValues[F.uniqueId])||void 0===B?void 0:B.type)??(null===(Y=j._connectionValues[A.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",t}},"math/asr":eb("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":eb("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":eb("FlowGraphLeadingZerosBlock"),"math/ctz":eb("FlowGraphTrailingZerosBlock"),"math/popcnt":eb("FlowGraphOneBitsCounterBlock"),"math/rad":eb("FlowGraphDegToRadBlock"),"math/deg":eb("FlowGraphRadToDegBlock"),"type/boolToInt":eb("FlowGraphBooleanToInt"),"type/boolToFloat":eb("FlowGraphBooleanToFloat"),"type/intToBool":eb("FlowGraphIntToBoolean"),"type/intToFloat":eb("FlowGraphIntToFloat"),"type/floatToInt":eb("FlowGraphFloatToInt"),"type/floatToBool":eb("FlowGraphFloatToBoolean"),"flow/sequence":{Tk:["FlowGraphSequenceBlock"],extraProcessor(J,T,b,q,t){const j=t[0];return j.config||(j.config={}),j.config.outputSignalCount=Object.keys(J.flows||[]).length,j.signalOutputs.forEach(((J,T)=>{J.name="out_"+T})),t}},"flow/branch":{Tk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Tk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(J){if(J.configuration&&J.configuration.cases){const T=J.configuration.cases.value;if(!T.every((J=>"number"===typeof J&&/^-?\d+$/.test(J.toString()))))return x.d.Warn("Switch cases should be integers. Using empty array instead."),J.configuration.cases.value=[],{valid:!0};const b=new Set(T);J.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(J,T,b,q,t){if("flow/switch"!==T.op||!J.flows||0===Object.keys(J.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return t[0].signalOutputs.forEach((J=>{"default"!==J.name&&(J.name="out_"+J.name)})),t}},"flow/while":{Tk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Tk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(J,T,b,q,t){const j=t[0];return j.config||(j.config={}),j.config.incrementIndexWhenLoopDone=!0,t}},"flow/doN":{Tk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Tk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(J,T,b,q,t){if("flow/multiGate"!==T.op||!J.flows||0===Object.keys(J.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const j=t[0];return j.config||(j.config={}),j.config.outputSignalCount=Object.keys(J.flows).length,j.signalOutputs.forEach(((J,T)=>{J.name="out_"+T})),t}},"flow/waitAll":{Tk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(J){var T,b;return"number"!==typeof(null===(T=J.configuration)||void 0===T||null===(b=T.inputFlows)||void 0===b?void 0:b.value[0])&&(J.configuration=J.configuration||{inputFlows:{value:[0]}},J.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Tk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Tk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Tk:["FlowGraphCancelDelayBlock"]},"variable/get":{Tk:["FlowGraphGetVariableBlock"],validation(J){var T,b;return null!==(T=J.configuration)&&void 0!==T&&null!==(b=T.variable)&&void 0!==b&&b.value?{valid:!0}:(x.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(J,T)=>[T.getVariableName(J[0])]}}},"variable/set":{Tk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(J,T)=>[T.getVariableName(J[0])]}}},"variable/setMultiple":{Tk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(J,T)=>[J[0].map((J=>T.getVariableName(J)))]}},extraProcessor:(J,T,b,q,t)=>(t[0].dataInputs.forEach((J=>{J.name=q.getVariableName(+J.name)})),t)},"variable/interpolate":{Tk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(J,T)=>[T.getVariableName(J[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:J=>!0===J[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(J,T,b,q,t){var j,B,Y;const C=t[0],F=null===(j=J.configuration)||void 0===j?void 0:j.variable.value[0];if("number"!==typeof F)throw x.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const A=q.arrays.staticVariables[F];"undefined"===typeof C.config.animationType.value&&(q.arrays.staticVariables,C.config.animationType.value=(0,lb.M)(A.type));const a=t[4];return a.config||(a.config={}),(B=a.config).variable||(B.variable={}),a.config.variable.value=q.getVariableName(F),(Y=t[3]).config||(Y.config={}),t}},"pointer/get":{Tk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(J,T,b,q,t)=>(t.forEach((J=>{"FlowGraphJsonPointerParserBlock"===J.className&&(J.config||(J.config={}),J.config.outputValue=!0)})),t)},"pointer/set":{Tk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(J,T,b,q,t)=>(t.forEach((J=>{"FlowGraphJsonPointerParserBlock"===J.className&&(J.config||(J.config={}),J.config.outputValue=!0)})),t)},"pointer/interpolate":{Tk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(J,T,b,q,t)=>(t.forEach((T=>{"FlowGraphJsonPointerParserBlock"===T.className?(T.config||(T.config={}),T.config.outputValue=!0):"FlowGraphInterpolationBlock"===T.className&&(T.config||(T.config={}),Object.keys(J.values||[]).forEach((b=>{var t;const j=null===(t=J.values)||void 0===t?void 0:t[b];if("value"===b&&j){const J=j.type;void 0!==J&&(T.config.animationType=q.arrays.types[J].flowGraphType)}})))})),t)},"animation/start":{Tk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(J,T)=>[J[0]*T._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(J,T)=>[J[0]*T._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(J,T,b,q,t,j,B){const Y=t[t.length-1];return Y.config||(Y.config={}),Y.config.glTF=B,t}},"animation/stop":{Tk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(J,T,b,q,t,j,B){const Y=t[t.length-1];return Y.config||(Y.config={}),Y.config.glTF=B,t}},"animation/stopAt":{Tk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(J,T)=>[J[0]*T._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(J,T,b,q,t,j,B){const Y=t[t.length-1];return Y.config||(Y.config={}),Y.config.glTF=B,t}},"math/switch":{Tk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(J){if(J.configuration&&J.configuration.cases){const T=J.configuration.cases.value;if(!T.every((J=>"number"===typeof J&&/^-?\d+$/.test(J.toString()))))return x.d.Warn("Switch cases should be integers. Using empty array instead."),J.configuration.cases.value=[],{valid:!0};const b=new Set(T);J.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(J,T,b,q,t){const j=t[0];return j.dataInputs.forEach((J=>{"default"!==J.name&&"case"!==J.name&&(J.name="in_"+J.name)})),j.config||(j.config={}),j.config.treatCasesAsIntegers=!0,t}},"debug/log":{Tk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function eb(J){let T=arguments.length>2?arguments[2]:void 0;return{Tk:[J],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((J,T)=>(J[T]={name:T},J)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(J,b,q,t,j){var B;if(T){(B=j[0]).config||(B.config={}),j[0].config.preventIntegerFloatArithmetic=!0;let T=-1;Object.keys(J.values||{}).find((b=>{var q;return void 0!==(null===(q=J.values)||void 0===q?void 0:q[b].type)&&(T=J.values[b].type,!0)})),-1!==T&&(j[0].config.type=t.arrays.types[T].flowGraphType)}return j},validation:J=>T?cb(J):{valid:!0}}}function cb(J){if(J.values){const T=Object.keys(J.values).map((T=>J.values[T].type)).filter((J=>void 0!==J));if(!T.every((J=>J===T[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Zb["math/compose"]=Zb["math/matCompose"],Zb["math/decompose"]=Zb["math/matDecompose"];var Vb=b(644);const Qb={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"pi",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class hb{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=J,this._gltf=T,this._animationTargetFps=b,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const J of this._interactivityGraph.types)this._types.push(Qb[J.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const J of this._interactivityGraph.declarations){const T=gb(J);if(!T)throw x.d.Error(["No mapping found for declaration",J]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:T,fullOperationName:J.extension?J.op+":"+J.extension:J.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const J of this._interactivityGraph.variables){const T=this._parseVariable(J);this._staticVariables.push(T)}}_parseVariable(J,T){const b=this._types[J.type];if(!b)throw x.d.Error(["No type found for variable",J]),new Error("Error parsing variables");if(J.value&&J.value.length!==b.length)throw x.d.Error(["Invalid value length for variable",J,b]),new Error("Error parsing variables");const q=J.value||[];if(!q.length)switch(b.flowGraphType){case"boolean":q.push(!1);break;case"FlowGraphInteger":q.push(0);break;case"number":q.push(NaN);break;case"Vector2":q.push(NaN,NaN);break;case"pi":q.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":q.fill(NaN,0,4);break;case"Matrix":q.fill(NaN,0,16);break;case"Matrix3D":q.fill(NaN,0,9)}return"number"===b.elementType&&"string"===typeof q[0]&&(q[0]=parseFloat(q[0])),{type:b.flowGraphType,value:T?T(q,this):q}}_parseEvents(){if(this._interactivityGraph.events)for(const J of this._interactivityGraph.events){const T={eventId:J.id||"internalEvent_"+this._internalEventsCounter++};J.values&&(T.eventData=Object.keys(J.values).map((T=>{var b;const q=null===(b=J.values)||void 0===b?void 0:b[T];if(!q)throw x.d.Error(["No value found for event key",T]),new Error("Error parsing events");const t=this._types[q.type];if(!t)throw x.d.Error(["No type found for event value",q]),new Error("Error parsing events");const j="undefined"!==typeof q.value?this._parseVariable(q):void 0;return{id:T,type:t.flowGraphType,eventData:!0,value:j}}))),this._events.push(T)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const T of this._interactivityGraph.nodes){if("number"!==typeof T.declaration)throw x.d.Error(["No declaration found for node",T]),new Error("Error parsing nodes");const b=this._mappings[T.declaration];if(!b)throw x.d.Error(["No mapping found for node",T]),new Error("Error parsing nodes");if(b.flowGraphMapping.validation){const q=b.flowGraphMapping.validation(T,this._interactivityGraph,this._gltf);var J;if(!q.valid)throw new Error(`Error validating interactivity node ${null===(J=this._interactivityGraph.declarations)||void 0===J?void 0:J[T.declaration].op} - ${q.error}`)}const q=[];for(const J of b.flowGraphMapping.Tk){const t=this._getEmptyBlock(J,b.fullOperationName);this._parseNodeConfiguration(T,t,b.flowGraphMapping,J),q.push(t)}this._nodes.push({Tk:q,fullOperationName:b.fullOperationName})}}_getEmptyBlock(J,T){return{uniqueId:(0,Vb.e)(),className:J,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:T,metadata:{}}}_parseNodeConfiguration(J,T,b,q){const t=T.config;if(J.configuration){const T=Object.keys(J.configuration);for(const Y of T){var j,B;const T=null===(j=J.configuration)||void 0===j?void 0:j[Y];if(!T)throw x.d.Error(["No value found for node configuration",Y]),new Error("Error parsing node configuration");const C=null===(B=b.configuration)||void 0===B?void 0:B[Y];if(C&&C.toBlock?C.toBlock===q:0===b.Tk.indexOf(q)){const J=(null===C||void 0===C?void 0:C.name)||Y;T&&"undefined"!==typeof T.value||"undefined"===typeof(null===C||void 0===C?void 0:C.defaultValue)?T.value.length>=0?t[J]={value:1===T.value.length?T.value[0]:T.value}:x.d.Warn(["Invalid value for node configuration",T]):t[J]={value:C.defaultValue},C&&C.dataTransformer&&(t[J].value=C.dataTransformer([t[J].value],this)[0])}}}}_parseNodeConnections(J){for(let W=0;W<this._nodes.length;W++){var T;const p=null===(T=this._interactivityGraph.nodes)||void 0===T?void 0:T[W];if(!p)throw x.d.Error(["No node found for interactivity node",this._nodes[W]]),new Error("Error parsing node connections");const o=this._nodes[W],S=this._mappings[p.declaration];if(!S)throw x.d.Error(["No mapping found for node",p]),new Error("Error parsing node connections");const H=p.flows||{},s=Object.keys(H).sort();for(const J of s){var b,q,t,j;const T=H[J],F=null===(b=S.flowGraphMapping.outputs)||void 0===b||null===(q=b.flows)||void 0===q?void 0:q[J],A=(null===F||void 0===F?void 0:F.name)||J,a=this._createNewSocketConnection(A,!0);(F&&F.toBlock&&o.Tk.find((J=>J.className===F.toBlock))||o.Tk[0]).signalOutputs.push(a);const P=T.node,v=this._nodes[P];if(!v)throw x.d.Error(["No node found for input node id",P]),new Error("Error parsing node connections");const G=sb(v.fullOperationName);if(!G)throw x.d.Error(["No mapping found for input node",v]),new Error("Error parsing node connections");let I=null===(t=G.inputs)||void 0===t||null===(j=t.flows)||void 0===j?void 0:j[T.socket||"in"],u=!1;if(!I)for(const J in null===(B=G.inputs)||void 0===B?void 0:B.flows){var B,Y,C;if(J.startsWith("[")&&J.endsWith("]"))u=!0,I=null===(Y=G.inputs)||void 0===Y||null===(C=Y.flows)||void 0===C?void 0:C[J]}const U=I?u?I.name.replace("$1",T.socket||""):I.name:T.socket||"in",K=I&&I.toBlock&&v.Tk.find((J=>J.className===I.toBlock))||v.Tk[0];let E=K.signalInputs.find((J=>J.name===U));E||(E=this._createNewSocketConnection(U),K.signalInputs.push(E)),E.connectedPointIds.push(a.uniqueId),a.connectedPointIds.push(E.uniqueId)}const g=p.values||{},d=Object.keys(g);for(const T of d){var F,A;const b=g[T];let q=null===(F=S.flowGraphMapping.inputs)||void 0===F||null===(A=F.values)||void 0===A?void 0:A[T],t=!1;if(!q)for(const J in null===(a=S.flowGraphMapping.inputs)||void 0===a?void 0:a.values){var a,P,v;if(J.startsWith("[")&&J.endsWith("]"))t=!0,q=null===(P=S.flowGraphMapping.inputs)||void 0===P||null===(v=P.values)||void 0===v?void 0:v[J]}const j=q?t?q.name.replace("$1",T):q.name:T,B=this._createNewSocketConnection(j);if((q&&q.toBlock&&o.Tk.find((J=>J.className===q.toBlock))||o.Tk[0]).dataInputs.push(B),void 0!==b.value){const T=this._parseVariable(b,q&&q.dataTransformer);J._connectionValues[B.uniqueId]=T}else{if("undefined"===typeof b.node)throw x.d.Error(["Invalid value for value connection",b]),new Error("Error parsing node connections");{var G,I,u;const J=b.node,T=b.socket||"value",q=this._nodes[J];if(!q)throw x.d.Error(["No node found for output socket reference",b]),new Error("Error parsing node connections");const t=sb(q.fullOperationName);if(!t)throw x.d.Error(["No mapping found for output socket reference",b]),new Error("Error parsing node connections");let j=null===(G=t.outputs)||void 0===G||null===(I=G.values)||void 0===I?void 0:I[T],Y=!1;if(!j)for(const b in null===(U=t.outputs)||void 0===U?void 0:U.values){var U,K,E;if(b.startsWith("[")&&b.endsWith("]"))Y=!0,j=null===(K=t.outputs)||void 0===K||null===(E=K.values)||void 0===E?void 0:E[b]}const C=j?Y?j.name.replace("$1",T):null===(u=j)||void 0===u?void 0:u.name:T,F=j&&j.toBlock&&q.Tk.find((J=>J.className===j.toBlock))||q.Tk[0];let A=F.dataOutputs.find((J=>J.name===C));A||(A=this._createNewSocketConnection(C,!0),F.dataOutputs.push(A)),B.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(B.uniqueId)}}}if(S.flowGraphMapping.interBlockConnectors)for(const J of S.flowGraphMapping.interBlockConnectors){const T=J.input,b=J.output,q=J.isVariable;this._connectFlowGraphNodes(T,b,o.Tk[J.inputBlockIndex],o.Tk[J.outputBlockIndex],q)}if(S.flowGraphMapping.extraProcessor){var l;const T=null===(l=this._interactivityGraph.declarations)||void 0===l?void 0:l[p.declaration];if(!T)throw x.d.Error(["No declaration found for extra processor",p]),new Error("Error parsing node connections");o.Tk=S.flowGraphMapping.extraProcessor(p,T,S.flowGraphMapping,this,o.Tk,J,this._gltf)}}}_createNewSocketConnection(J,T){return{uniqueId:(0,Vb.e)(),name:J,_connectionType:T?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(J,T,b,q,t){const j=t?b.dataInputs:b.signalInputs,B=t?q.dataOutputs:q.signalOutputs,Y=j.find((T=>T.name===J))||this._createNewSocketConnection(J),C=B.find((J=>J.name===T))||this._createNewSocketConnection(T,!0);j.find((T=>T.name===J))||j.push(Y),B.find((J=>J.name===T))||B.push(C),Y.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(Y.uniqueId)}getVariableName(J){return"staticVariable_"+J}serializeToFlowGraph(){const J={uniqueId:(0,Vb.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(J);for(let T=0;T<this._staticVariables.length;T++){const b=this._staticVariables[T];J._userVariables[this.getVariableName(T)]=b}return{rightHanded:!0,allBlocks:this._nodes.reduce(((J,T)=>J.concat(T.Tk)),[]),executionContexts:[J]}}}const ib="KHR_interactivity";class mb{constructor(J){this._loader=J,this.name=ib,this.enabled=this._loader.isExtensionUsed(ib),this._pathConverter=(0,N.i)(this._loader.Hi),J._skipStartAnimationStep=!0;const T=J.babylonScene;T&&function(J){(0,N.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!J.activeCamera)return new t.h(NaN,NaN,NaN,NaN);const T=t.h.FromRotationMatrix(J.activeCamera.getWorldMatrix()).normalize();return J.useRightHandedSystem||(T.w*=-1,T.x*=-1),T},type:"Quaternion",getTarget:()=>J.activeCamera}),(0,N.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!J.activeCamera)return new t.n(NaN,NaN,NaN);const T=J.activeCamera.getWorldMatrix().getTranslation();return J.useRightHandedSystem||(T.x*=-1),T},type:"pi",getTarget:()=>J.activeCamera}),(0,N.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:J=>{var T;return(null===(T=J._babylonAnimationGroup)||void 0===T?void 0:T.isPlaying)??!1},type:"boolean",getTarget:J=>J._babylonAnimationGroup}),(0,N.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:J=>{var T;return((null===(T=J._babylonAnimationGroup)||void 0===T?void 0:T.from)??0)/60},type:"number",getTarget:J=>J._babylonAnimationGroup}),(0,N.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:J=>{var T;return((null===(T=J._babylonAnimationGroup)||void 0===T?void 0:T.to)??0)/60},type:"number",getTarget:J=>J._babylonAnimationGroup}),(0,N.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:J=>{var T;return((null===(T=J._babylonAnimationGroup)||void 0===T?void 0:T.getCurrentFrame())??0)/60},type:"number",getTarget:J=>J._babylonAnimationGroup}),(0,N.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:J=>{var T;return((null===(T=J._babylonAnimationGroup)||void 0===T?void 0:T.getCurrentFrame())??0)/60},type:"number",getTarget:J=>J._babylonAnimationGroup})}(T)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var J;if(!this._loader.babylonScene||!this._pathConverter)return;const T=this._loader.babylonScene,b=null===(J=this._loader.Hi.extensions)||void 0===J?void 0:J.KHR_interactivity;if(!b)return;const q=new Ib.c({cg:T});q.dispatchEventsSynchronously=!1;const t=b.graphs.map((J=>new hb(J,this._loader.Hi,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(t.map((async J=>await ob(J,{coordinator:q,pathConverter:this._pathConverter})))),q.start()}}var Ob;Ob=async()=>(await Promise.resolve().then(b.bind(b,12654))).FlowGraphGLTFDataProvider,ub[`${ib}/${"FlowGraphGLTFDataProvider"}`]=Ob,r(ib),L(ib,!0,(J=>new mb(J)));const Xb="KHR_node_visibility";(0,N.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:J=>{const T=J._babylonTransformNode;return!T||void 0===T.isVisible||T.isVisible},set:(J,T)=>{var b,q;null===(b=T._primitiveBabylonMeshes)||void 0===b||b.forEach((J=>{J.inheritVisibility=!0})),T._babylonTransformNode&&(T._babylonTransformNode.isVisible=J),null===(q=T._primitiveBabylonMeshes)||void 0===q||q.forEach((T=>{T.isVisible=J}))},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Lb{constructor(J){this.name=Xb,this._loader=J,this.enabled=J.isExtensionUsed(Xb)}async onReady(){var J;null===(J=this._loader.Hi.nodes)||void 0===J||J.forEach((J=>{var T,b,q,t;(null===(T=J._primitiveBabylonMeshes)||void 0===T||T.forEach((J=>{J.inheritVisibility=!0})),null!==(b=J.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(q=J.extensions)||void 0===q?void 0:q.KHR_node_visibility.visible)&&(J._babylonTransformNode&&(J._babylonTransformNode.isVisible=!1),null===(t=J._primitiveBabylonMeshes)||void 0===t||t.forEach((J=>{J.isVisible=!1}))))}))}dispose(){this._loader=null}}r(Xb),L(Xb,!0,(J=>new Lb(J)));const rb="KHR_node_selectability";db("event/onSelect",rb,{Tk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:J=>["pickedMesh_"+J[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(J,T,b,q,t,j,B){var Y,C,F,A,a,P;const v=t[t.length-1];v.config=v.config||{},v.config.glTF=B;const G=null===(Y=J.configuration)||void 0===Y||null===(C=Y.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const x="pickedMesh_"+G;return t[1].config.variable=x,j._userVariables[x]={className:"Mesh",id:null===B||void 0===B||null===(F=B.nodes)||void 0===F||null===(A=F[G]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===B||void 0===B||null===(a=B.nodes)||void 0===a||null===(P=a[G]._babylonTransformNode)||void 0===P?void 0:P.uniqueId},t}}),(0,N.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:J=>{const T=J._babylonTransformNode;return!T||void 0===T.Bi||T.Bi},set:(J,T)=>{var b;null===(b=T._primitiveBabylonMeshes)||void 0===b||b.forEach((T=>{T.Bi=J}))},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"Bi"],type:"boolean"});class Nb{constructor(J){this.name=rb,this._loader=J,this.enabled=J.isExtensionUsed(rb)}async onReady(){var J;null===(J=this._loader.Hi.nodes)||void 0===J||J.forEach((J=>{var T,b,q;null!==(T=J.extensions)&&void 0!==T&&T.KHR_node_selectability&&!1===(null===(b=J.extensions)||void 0===b?void 0:b.KHR_node_selectability.selectable)&&(null===(q=J._babylonTransformNode)||void 0===q||q.getChildMeshes().forEach((J=>{J.Bi=!1})))}))}dispose(){this._loader=null}}r(rb),L(rb,!0,(J=>new Nb(J)));const Rb="KHR_node_hoverability",nb="targetMeshPointerOver_";db("event/onHoverIn",Rb,{Tk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:J=>[nb+J[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(J,T,b,q,t,j,B){var Y,C,F,A,a,P;const v=t[t.length-1];v.config=v.config||{},v.config.glTF=B;const G=null===(Y=J.configuration)||void 0===Y||null===(C=Y.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const x=nb+G;return t[1].config.variable=x,j._userVariables[x]={className:"Mesh",id:null===B||void 0===B||null===(F=B.nodes)||void 0===F||null===(A=F[G]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===B||void 0===B||null===(a=B.nodes)||void 0===a||null===(P=a[G]._babylonTransformNode)||void 0===P?void 0:P.uniqueId},t}});const Db="targetMeshPointerOut_";db("event/onHoverOut",Rb,{Tk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:J=>[Db+J[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(J,T,b,q,t,j,B){var Y,C,F,A,a,P;const v=t[t.length-1];v.config=v.config||{},v.config.glTF=B;const G=null===(Y=J.configuration)||void 0===Y||null===(C=Y.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const x=Db+G;return t[1].config.variable=x,j._userVariables[x]={className:"Mesh",id:null===B||void 0===B||null===(F=B.nodes)||void 0===F||null===(A=F[G]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===B||void 0===B||null===(a=B.nodes)||void 0===a||null===(P=a[G]._babylonTransformNode)||void 0===P?void 0:P.uniqueId},t}}),(0,N.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:J=>{const T=J._babylonTransformNode;return!T||void 0===T.pointerOverDisableMeshTesting||T.pointerOverDisableMeshTesting},set:(J,T)=>{var b;null===(b=T._primitiveBabylonMeshes)||void 0===b||b.forEach((T=>{T.pointerOverDisableMeshTesting=!J}))},getTarget:J=>J._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class fb{constructor(J){this.name=Rb,this._loader=J,this.enabled=J.isExtensionUsed(Rb)}async onReady(){var J;null===(J=this._loader.Hi.nodes)||void 0===J||J.forEach((J=>{var T,b,q;null!==(T=J.extensions)&&void 0!==T&&T.KHR_node_hoverability&&!1===(null===(b=J.extensions)||void 0===b?void 0:b.KHR_node_hoverability.hoverable)&&(null===(q=J._babylonTransformNode)||void 0===q||q.getChildMeshes().forEach((J=>{J.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}r(Rb),L(Rb,!0,(J=>new fb(J)));const zb="ExtrasAsMetadata";class Mb{_assignExtras(J,T){if(T.extras&&Object.keys(T.extras).length>0){const b=J.metadata=J.metadata||{};(b.Hi=b.Hi||{}).extras=T.extras}}constructor(J){this.name=zb,this.enabled=!0,this._loader=J}dispose(){this._loader=null}loadNodeAsync(J,T,b){return this._loader.loadNodeAsync(J,T,(J=>{this._assignExtras(J,T),b(J)}))}loadCameraAsync(J,T,b){return this._loader.loadCameraAsync(J,T,(J=>{this._assignExtras(J,T),b(J)}))}createMaterial(J,T,b){const q=this._loader.createMaterial(J,T,b);return this._assignExtras(q,T),q}}r(zb),L(zb,!1,(J=>new Mb(J)));b(12654)},12498:(J,T,b)=>{"use strict";b.d(T,{c:()=>Z,g:()=>S,k:()=>o,n:()=>H});var q=b(497),t=b(505),j=b(12067),B=b(494),Y=b(837),C=b(834),F=b(519),A=b(550),a=b(12502),P=b(12504),v=b(670),G=b(654);class x{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.si=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.om=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(J){this._environmentTexture=J}getNodes(){let J=[];J=J.concat(this.meshes),J=J.concat(this.lights),J=J.concat(this.cameras),J=J.concat(this.transformNodes);for(const T of this.skeletons)J=J.concat(T.bones);return J}}class I extends x{}class u{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const J=this.rootNodes;for(const q of J)q.dispose();J.length=0;const T=this.skeletons;for(const q of T)q.dispose();T.length=0;const b=this.animationGroups;for(const q of b)q.dispose();b.length=0}}class U extends x{constructor(J){super(),this._wasAddedToScene=!1,(J=J||A.e.LastCreatedScene)&&(this.cg=J,this.proceduralTextures=[],J.Ki.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=J.getEngine().onContextRestoredObservable.add((()=>{for(const J of this.geometries)J._rebuild();for(const J of this.meshes)J._rebuild();for(const J of this.si)J.rebuild();for(const J of this.textures)J._rebuild()})))}_topologicalSort(J){const T=new Map;for(const B of J)T.set(B.uniqueId,B);const b={dependsOn:new Map,dependedBy:new Map};for(const B of J){const J=B.uniqueId;b.dependsOn.set(J,new Set),b.dependedBy.set(J,new Set)}for(const B of J){const J=B.uniqueId,q=b.dependsOn.get(J);if(B instanceof a.c){const t=B.sourceMesh;T.has(t.uniqueId)&&(q.add(t.uniqueId),b.dependedBy.get(t.uniqueId).add(J))}const t=b.dependedBy.get(J);for(const j of B.getDescendants()){const q=j.uniqueId;if(T.has(q)){t.add(q);b.dependsOn.get(q).add(J)}}}const q=[],t=[];for(const B of J){const J=B.uniqueId;0===b.dependsOn.get(J).size&&(t.push(B),T.delete(J))}const j=t;for(;j.length>0;){const J=j.shift();q.push(J);const t=b.dependedBy.get(J.uniqueId);for(const q of Array.from(t.values())){const t=b.dependsOn.get(q);t.delete(J.uniqueId),0===t.size&&T.get(q)&&(j.push(T.get(q)),T.delete(q))}}return T.size>0&&(F.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),T.forEach((J=>{F.d.Error(J.name)}))),q}_addNodeAndDescendantsToList(J,T,b,q){if(b&&(!q||q(b))&&!T.has(b.uniqueId)){J.push(b),T.add(b.uniqueId);for(const t of b.getDescendants(!0))this._addNodeAndDescendantsToList(J,T,t,q)}}_isNodeInContainer(J){return J instanceof C.d&&-1!==this.meshes.indexOf(J)||(J instanceof Y.e&&-1!==this.transformNodes.indexOf(J)||(J instanceof P.c&&-1!==this.lights.indexOf(J)||J instanceof v.b&&-1!==this.cameras.indexOf(J)))}_isValidHierarchy(){for(const J of this.meshes)if(J.parent&&!this._isNodeInContainer(J.parent))return F.d.Warn(`Node ${J.name} has a parent that is not in the container.`),!1;for(const J of this.transformNodes)if(J.parent&&!this._isNodeInContainer(J.parent))return F.d.Warn(`Node ${J.name} has a parent that is not in the container.`),!1;for(const J of this.lights)if(J.parent&&!this._isNodeInContainer(J.parent))return F.d.Warn(`Node ${J.name} has a parent that is not in the container.`),!1;for(const J of this.cameras)if(J.parent&&!this._isNodeInContainer(J.parent))return F.d.Warn(`Node ${J.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||t.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const q={},j={},Y=new u,C=[],F=[],A={doNotInstantiate:!0,...b},a=[],P=new Set;for(const t of this.transformNodes)null===t.parent&&this._addNodeAndDescendantsToList(a,P,t,A.predicate);for(const t of this.meshes)null===t.parent&&this._addNodeAndDescendantsToList(a,P,t,A.predicate);const v=this._topologicalSort(a),G=(b,t)=>{if(((T,b)=>{if(q[T.uniqueId]=b.uniqueId,j[b.uniqueId]=b,J&&(b.name=J(T.name)),b instanceof B.e){const J=b;if(J.morphTargetManager){const b=T.morphTargetManager;J.morphTargetManager=b.clone();for(let T=0;T<b.numTargets;T++){const t=b.getTarget(T),B=J.morphTargetManager.getTarget(T);q[t.uniqueId]=B.uniqueId,j[B.uniqueId]=B}}}})(b,t),b.parent){const J=q[b.parent.uniqueId],T=j[J];t.parent=T||b.parent}if(t.position&&b.position&&t.position.p(b.position),t.rotationQuaternion&&b.rotationQuaternion&&t.rotationQuaternion.p(b.rotationQuaternion),t.rotation&&b.rotation&&t.rotation.p(b.rotation),t.ii&&b.ii&&t.ii.p(b.ii),t.material){const B=t;if(B.material)if(T){const T=b.material;if(-1===F.indexOf(T)){let b=T.clone(J?J(T.name):"Clone of "+T.name);if(F.push(T),q[T.uniqueId]=b.uniqueId,j[b.uniqueId]=b,"MultiMaterial"===T.getClassName()){const t=T;for(const T of t.Ci)T&&(b=T.clone(J?J(T.name):"Clone of "+T.name),F.push(T),q[T.uniqueId]=b.uniqueId,j[b.uniqueId]=b);t.Ci=t.Ci.map((J=>J&&j[q[J.uniqueId]]))}}"InstancedMesh"!==B.getClassName()&&(B.material=j[q[T.uniqueId]])}else"MultiMaterial"===B.material.getClassName()?-1===this.cg.multiMaterials.indexOf(B.material)&&this.cg.addMultiMaterial(B.material):-1===this.cg.materials.indexOf(B.material)&&this.cg.addMaterial(B.material)}null===t.parent&&Y.rootNodes.push(t)};for(const t of v)if("InstancedMesh"===t.getClassName()){const J=t,T=J.sourceMesh,b=q[T.uniqueId];G(J,("number"===typeof b?j[b]:T).createInstance(J.name))}else{let J=!0;"cj"===t.getClassName()||"Node"===t.getClassName()||t.skeleton||!t.getTotalVertices||0===t.getTotalVertices()?J=!1:A.doNotInstantiate&&(J="function"===typeof A.doNotInstantiate?!A.doNotInstantiate(t):!A.doNotInstantiate);const T=J?t.createInstance(`instance of ${t.name}`):t.clone(`Clone of ${t.name}`,null,!0);if(!T)throw new Error(`Could not clone or instantiate node on Asset Container ${t.name}`);G(t,T)}for(const t of this.skeletons){if(A.predicate&&!A.predicate(t))continue;const T=t.clone(J?J(t.name):"Clone of "+t.name);for(const J of this.meshes)if(J.skeleton===t&&!J.isAnInstance){const b=j[q[J.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=T,-1!==C.indexOf(T))continue;C.push(T);for(const J of T.bones)J._linkedTransformNode&&(J._linkedTransformNode=j[q[J._linkedTransformNode.uniqueId]])}Y.skeletons.push(T)}for(const t of this.animationGroups){if(A.predicate&&!A.predicate(t))continue;const T=t.clone(J?J(t.name):"Clone of "+t.name,(J=>j[q[J.uniqueId]]||J));Y.animationGroups.push(T)}return Y}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||t.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.cg.environmentTexture=this.environmentTexture);for(const J of this.cg._serializableComponents)J.addFromContainer(this);this.cg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const T=[];for(const b of this.cameras)J&&!J(b)||(this.cg.addCamera(b),T.push(b));for(const b of this.lights)J&&!J(b)||(this.cg.addLight(b),T.push(b));for(const b of this.meshes)J&&!J(b)||(this.cg.Yi(b),T.push(b));for(const b of this.skeletons)J&&!J(b)||this.cg.addSkeleton(b);for(const b of this.animations)J&&!J(b)||this.cg.addAnimation(b);for(const b of this.animationGroups)J&&!J(b)||this.cg.addAnimationGroup(b);for(const b of this.multiMaterials)J&&!J(b)||this.cg.addMultiMaterial(b);for(const b of this.materials)J&&!J(b)||this.cg.addMaterial(b);for(const b of this.morphTargetManagers)J&&!J(b)||this.cg.addMorphTargetManager(b);for(const b of this.geometries)J&&!J(b)||this.cg.addGeometry(b);for(const b of this.transformNodes)J&&!J(b)||(this.cg.addTransformNode(b),T.push(b));for(const b of this.actionManagers)J&&!J(b)||this.cg.addActionManager(b);for(const b of this.textures)J&&!J(b)||this.cg.addTexture(b);for(const b of this.reflectionProbes)J&&!J(b)||this.cg.addReflectionProbe(b);for(const b of T)b.parent&&-1===this.cg.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||t.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.cg.environmentTexture&&(this.cg.environmentTexture=null);for(const J of this.cg._serializableComponents)J.removeFromContainer(this)}removeFromScene(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const T of this.cameras)J&&!J(T)||this.cg.removeCamera(T);for(const T of this.lights)J&&!J(T)||this.cg.removeLight(T);for(const T of this.meshes)J&&!J(T)||this.cg._i(T,!0);for(const T of this.skeletons)J&&!J(T)||this.cg.removeSkeleton(T);for(const T of this.animations)J&&!J(T)||this.cg.removeAnimation(T);for(const T of this.animationGroups)J&&!J(T)||this.cg.removeAnimationGroup(T);for(const T of this.multiMaterials)J&&!J(T)||this.cg.removeMultiMaterial(T);for(const T of this.materials)J&&!J(T)||this.cg.removeMaterial(T);for(const T of this.morphTargetManagers)J&&!J(T)||this.cg.removeMorphTargetManager(T);for(const T of this.geometries)J&&!J(T)||this.cg.removeGeometry(T);for(const T of this.transformNodes)J&&!J(T)||this.cg.removeTransformNode(T);for(const T of this.actionManagers)J&&!J(T)||this.cg.removeActionManager(T);for(const T of this.textures)J&&!J(T)||this.cg.removeTexture(T);for(const T of this.reflectionProbes)J&&!J(T)||this.cg.removeReflectionProbe(T)}dispose(){const J=this.cameras.slice(0);for(const v of J)v.dispose();this.cameras.length=0;const T=this.lights.slice(0);for(const v of T)v.dispose();this.lights.length=0;const b=this.meshes.slice(0);for(const v of b)v.dispose();this.meshes.length=0;const q=this.skeletons.slice(0);for(const v of q)v.dispose();this.skeletons.length=0;const t=this.animationGroups.slice(0);for(const v of t)v.dispose();this.animationGroups.length=0;const j=this.multiMaterials.slice(0);for(const v of j)v.dispose();this.multiMaterials.length=0;const B=this.materials.slice(0);for(const v of B)v.dispose();this.materials.length=0;const Y=this.geometries.slice(0);for(const v of Y)v.dispose();this.geometries.length=0;const C=this.transformNodes.slice(0);for(const v of C)v.dispose();this.transformNodes.length=0;const F=this.actionManagers.slice(0);for(const v of F)v.dispose();this.actionManagers.length=0;const A=this.textures.slice(0);for(const v of A)v.dispose();this.textures.length=0;const a=this.reflectionProbes.slice(0);for(const v of a)v.dispose();this.reflectionProbes.length=0;const P=this.morphTargetManagers.slice(0);for(const v of P)v.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const v of this.cg._serializableComponents)v.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.cg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(J,T,b){if(J&&T)for(const q of J){let J=!0;if(b)for(const T of b)if(q===T){J=!1;break}J&&(T.push(q),q._parentContainer=this)}}moveAllFromScene(J){this._wasAddedToScene=!1,void 0===J&&(J=new I);for(const T in this)Object.prototype.hasOwnProperty.call(this,T)&&(this[T]=this[T]||("_environmentTexture"===T?null:[]),this._moveAssets(this.cg[T],this[T],J[T]));this.environmentTexture=this.cg.environmentTexture,this.removeAllFromScene()}createRootMesh(){const J=new B.e("assetContainerRootMesh",this.cg);for(const T of this.meshes)T.parent||J.addChild(T);return this.meshes.unshift(J),J}mergeAnimationsTo(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.e.LastCreatedScene,T=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!J)return F.d.Error("No scene available to merge animations to"),[];const q=b||(T=>{let b=null;const q=T.animations.length?T.animations[0].targetProperty:"",t=T.name.split(".").join("").split("_primitive")[0];switch(q){case"position":case"rotationQuaternion":b=J.getTransformNodeByName(T.name)||J.getTransformNodeByName(t);break;case"influence":b=J.getMorphTargetByName(T.name)||J.getMorphTargetByName(t);break;default:b=J.getNodeByName(T.name)||J.getNodeByName(t)}return b}),t=this.getNodes();for(const Y of t){const J=q(Y);if(null!==J){for(const T of Y.animations){const b=J.animations.filter((J=>J.targetProperty===T.targetProperty));for(const T of b){const b=J.animations.indexOf(T,0);b>-1&&J.animations.splice(b,1)}}J.animations=J.animations.concat(Y.animations)}}const j=[],B=this.animationGroups.slice();for(const Y of B){j.push(Y.clone(Y.name,q));for(const J of Y.animatables)J.stop()}for(const Y of T){const T=q(Y.target);T&&(J.beginAnimation(T,Y.fromFrame,Y.toFrame,Y.loopAnimation,Y.speedRatio,Y.onAnimationEnd?Y.onAnimationEnd:void 0,void 0,!0,void 0,Y.onAnimationLoop?Y.onAnimationLoop:void 0),J.stopAnimation(Y.target))}return j}populateRootNodes(){this.rootNodes.length=0;for(const J of this.meshes)J.parent||-1!==this.rootNodes.indexOf(J)||this.rootNodes.push(J);for(const J of this.transformNodes)J.parent||-1!==this.rootNodes.indexOf(J)||this.rootNodes.push(J);for(const J of this.lights)J.parent||-1!==this.rootNodes.indexOf(J)||this.rootNodes.push(J);for(const J of this.cameras)J.parent||-1!==this.rootNodes.indexOf(J)||this.rootNodes.push(J)}addAllAssetsToContainer(J){if(!J)return;const T=[],b=new Set;for(T.push(J);T.length>0;){const J=T.pop();if(J instanceof B.e?(J.qi&&-1===this.geometries.indexOf(J.qi)&&this.geometries.push(J.qi),this.meshes.push(J)):J instanceof a.c?this.meshes.push(J):J instanceof Y.e?this.transformNodes.push(J):J instanceof P.c?this.lights.push(J):J instanceof v.b&&this.cameras.push(J),J instanceof C.d){if(J.material&&-1===this.materials.indexOf(J.material)){this.materials.push(J.material);for(const T of J.material.getActiveTextures())-1===this.textures.indexOf(T)&&this.textures.push(T)}J.skeleton&&-1===this.skeletons.indexOf(J.skeleton)&&this.skeletons.push(J.skeleton),J.morphTargetManager&&-1===this.morphTargetManagers.indexOf(J.morphTargetManager)&&this.morphTargetManagers.push(J.morphTargetManager)}for(const q of J.getChildren())b.has(q)||T.push(q);b.add(J)}this.populateRootNodes()}_getByTags(J,T,b){if(void 0===T)return J;const q=[];for(const t in J){const j=J[t];G.c&&G.c.MatchesQuery(j,T)&&(!b||b(j))&&q.push(j)}return q}getMeshesByTags(J,T){return this._getByTags(this.meshes,J,T)}getCamerasByTags(J,T){return this._getByTags(this.cameras,J,T)}getLightsByTags(J,T){return this._getByTags(this.lights,J,T)}getMaterialsByTags(J,T){return this._getByTags(this.materials,J,T).concat(this._getByTags(this.multiMaterials,J,T))}getTransformNodesByTags(J,T){return this._getByTags(this.transformNodes,J,T)}}var K=b(563);class E{constructor(J){this.byteOffset=0,this.buffer=J}async loadAsync(J){const T=await this.buffer.readAsync(this.byteOffset,J);this._dataView=new DataView(T.buffer,T.byteOffset,T.byteLength),this._dataByteOffset=0}readUint32(){const J=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,J}readUint8Array(J){const T=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,J);return this._dataByteOffset+=J,this.byteOffset+=J,T}readString(J){return(0,K.g)(this.readUint8Array(J))}skipBytes(J){this._dataByteOffset+=J,this.byteOffset+=J}}var l=b(12507);const W="Z2xURg",p={name:"Hi",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:J=>-1!==J.indexOf("asset")&&-1!==J.indexOf("version")||J.startsWith("data:base64,"+W)||J.startsWith("data:;base64,"+W)||J.startsWith("data:application/octet-stream;base64,"+W)||J.startsWith("data:model/gltf-binary;base64,"+W)};var o,S,H,s=b(556),g=b(559);function d(J,T,b){try{return Promise.resolve(new Uint8Array(J,T,b))}catch(q){return Promise.reject(q)}}!function(J){J[J.AUTO=0]="AUTO",J[J.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(o||(o={})),function(J){J[J.NONE=0]="NONE",J[J.FIRST=1]="FIRST",J[J.ALL=2]="ALL"}(S||(S={})),function(J){J[J.LOADING=0]="LOADING",J[J.READY=1]="READY",J[J.COMPLETE=2]="COMPLETE"}(H||(H={}));class w{constructor(){this.coordinateSystemMode=o.AUTO,this.animationStartMode=S.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=J=>Promise.resolve(J),this.extensionOptions={}}p(J){J&&(this.onParsed=J.onParsed,this.coordinateSystemMode=J.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=J.animationStartMode??this.animationStartMode,this.loadNodeAnimations=J.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=J.loadSkins??this.loadSkins,this.loadMorphTargets=J.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=J.compileMaterials??this.compileMaterials,this.useClipPlane=J.useClipPlane??this.useClipPlane,this.compileShadowGenerators=J.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=J.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=J.useRangeRequests??this.useRangeRequests,this.createInstances=J.createInstances??this.createInstances,this.alwaysComputeBoundingBox=J.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=J.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=J.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=J.skipMaterials??this.skipMaterials,this.useSRGBBuffers=J.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=J.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=J.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=J.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=J.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=J.customRootNode,this.onMeshLoaded=J.onMeshLoaded,this.onSkinLoaded=J.onSkinLoaded,this.onTextureLoaded=J.onTextureLoaded,this.onMaterialLoaded=J.onMaterialLoaded,this.onCameraLoaded=J.onCameraLoaded,this.extensionOptions=J.extensionOptions??this.extensionOptions)}}class Z extends w{constructor(J){super(),this.onParsedObservable=new q.b,this.onMeshLoadedObservable=new q.b,this.onSkinLoadedObservable=new q.b,this.onTextureLoadedObservable=new q.b,this.onMaterialLoadedObservable=new q.b,this.onCameraLoadedObservable=new q.b,this.onCompleteObservable=new q.b,this.onErrorObservable=new q.b,this.Ki=new q.b,this.onExtensionLoadedObservable=new q.b,this.validate=!1,this.onValidatedObservable=new q.b,this._loader=null,this._state=null,this._requests=new Array,this.name=p.name,this.extensions=p.extensions,this.onLoaderStateChangedObservable=new q.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(J)}set onParsed(J){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),J&&(this._onParsedObserver=this.onParsedObservable.add(J))}set onMeshLoaded(J){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),J&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(J))}set onSkinLoaded(J){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),J&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((T=>J(T.node,T.skinnedNode))))}set onTextureLoaded(J){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),J&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(J))}set onMaterialLoaded(J){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),J&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(J))}set onCameraLoaded(J){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),J&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(J))}set onComplete(J){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(J)}set onError(J){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(J)}set onDispose(J){this._onDisposeObserver&&this.Ki.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ki.add(J)}set onExtensionLoaded(J){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(J)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(J){this._loggingEnabled!==J&&(this._loggingEnabled=J,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(J){this._capturePerformanceCounters!==J&&(this._capturePerformanceCounters=J,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(J){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(J)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const J of this._requests)J.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=J=>Promise.resolve(J),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ki.notifyObservers(void 0),this.Ki.clear()}loadFile(J,T,b,j,B,Y,C,A){if(ArrayBuffer.isView(T))return this._loadBinary(J,T,b,j,C,A),null;this._progressCallback=B;const a=T.name||t.e.GetFilename(T);if(Y){if(this.useRangeRequests){this.validate&&F.d.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new q.b},t={readAsync:(b,q)=>new Promise(((t,j)=>{this._loadFile(J,T,(J=>{t(new Uint8Array(J))}),!0,(J=>{j(J)}),(J=>{J.setRequestHeader("Range",`bytes=${b}-${b+q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(t)).then((J=>{b.onCompleteObservable.notifyObservers(b),j(J)}),C?J=>C(void 0,J):void 0),b}return this._loadFile(J,T,(T=>{this._validate(J,new Uint8Array(T,0,T.byteLength),b,a),this._unpackBinaryAsync(new E({readAsync:(J,b)=>d(T,J,b),byteLength:T.byteLength})).then((J=>{j(J)}),C?J=>C(void 0,J):void 0)}),!0,C)}return this._loadFile(J,T,(T=>{try{this._validate(J,T,b,a),j({json:this._parseJson(T)})}catch{C&&C()}}),!1,C)}_loadBinary(J,T,b,q,t,j){this._validate(J,new Uint8Array(T.buffer,T.byteOffset,T.byteLength),b,j),this._unpackBinaryAsync(new E({readAsync:(J,b)=>function(J,T,b){try{if(T<0||T>=J.byteLength)throw new RangeError("Offset is out of range.");if(T+b>J.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(J.buffer,J.byteOffset+T,b))}catch(q){return Promise.reject(q)}}(T,J,b),byteLength:T.byteLength})).then((J=>{q(J)}),t?J=>t(void 0,J):void 0)}importMeshAsync(J,T,b,q,t,j){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${j||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(J,T,null,b,q,t,j))))}loadAsync(J,T,b,q,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(T),this._loader.loadAsync(J,T,b,q,t))))}loadAssetContainerAsync(J,T,b,q,t){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(T);const j=new U(J),B=[];this.onMaterialLoadedObservable.add((J=>{B.push(J)}));const Y=[];this.onTextureLoadedObservable.add((J=>{Y.push(J)}));const C=[];this.onCameraLoadedObservable.add((J=>{C.push(J)}));const F=[];return this.onMeshLoadedObservable.add((J=>{J.morphTargetManager&&F.push(J.morphTargetManager)})),this._loader.importMeshAsync(null,J,j,T,b,q,t).then((J=>(Array.prototype.push.apply(j.geometries,J.geometries),Array.prototype.push.apply(j.meshes,J.meshes),Array.prototype.push.apply(j.si,J.si),Array.prototype.push.apply(j.skeletons,J.skeletons),Array.prototype.push.apply(j.animationGroups,J.animationGroups),Array.prototype.push.apply(j.materials,B),Array.prototype.push.apply(j.textures,Y),Array.prototype.push.apply(j.lights,J.lights),Array.prototype.push.apply(j.transformNodes,J.transformNodes),Array.prototype.push.apply(j.cameras,C),Array.prototype.push.apply(j.morphTargetManagers,F),j)))}))}canDirectLoad(J){return p.canDirectLoad(J)}directLoad(J,T){if(T.startsWith("base64,"+W)||T.startsWith(";base64,"+W)||T.startsWith("application/octet-stream;base64,"+W)||T.startsWith("model/gltf-binary;base64,"+W)){const b=(0,s.d)(T);return this._validate(J,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new E({readAsync:(J,T)=>d(b,J,T),byteLength:b.byteLength}))}return this._validate(J,T),Promise.resolve({json:this._parseJson(T)})}createPlugin(J){return new Z(J[p.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((J,T)=>{this.onCompleteObservable.addOnce((()=>{J()})),this.onErrorObservable.addOnce((J=>{T(J)}))}))}_setState(J){this._state!==J&&(this._state=J,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(H[this._state]))}_loadFile(J,T,b,q,t,j){const B=J._loadFile(T,b,(J=>{this._onProgress(J,B)}),!0,q,t,j);return B.onCompleteObservable.add((()=>{B._lengthComputable=!0,B._total=B._loaded})),this._requests.push(B),B}_onProgress(J,T){if(!this._progressCallback)return;T._lengthComputable=J.lengthComputable,T._loaded=J.loaded,T._total=J.total;let b=!0,q=0,t=0;for(const j of this._requests){if(void 0===j._lengthComputable||void 0===j._loaded||void 0===j._total)return;b=b&&j._lengthComputable,q+=j._loaded,t+=j._total}this._progressCallback({lengthComputable:b,loaded:q,total:b?t:0})}_validate(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),l.b.ValidateAsync(T,b,q,(T=>this.preprocessUrlAsync(b+T).then((T=>J._loadFileAsync(T,void 0,!0,!0).then((J=>new Uint8Array(J,0,J.byteLength))))))).then((J=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(J),this.onValidatedObservable.clear()}),(J=>{this._endPerformanceCounter("Validate JSON"),t.e.Warn(`Failed to validate: ${J.message}`),this.onValidatedObservable.clear()})))}_getLoader(J){const T=J.json.asset||{};this._log(`Asset version: ${T.version}`),T.minVersion&&this._log(`Asset minimum version: ${T.minVersion}`),T.generator&&this._log(`Asset generator: ${T.generator}`);const b=Z._parseVersion(T.version);if(!b)throw new Error("Invalid version: "+T.version);if(void 0!==T.minVersion){const J=Z._parseVersion(T.minVersion);if(!J)throw new Error("Invalid minimum version: "+T.minVersion);if(Z._compareVersion(J,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+T.minVersion)}const q={1:Z._CreateGLTF1Loader,2:Z._CreateGLTF2Loader}[b.major];if(!q)throw new Error("Unsupported version: "+T.version);return q(this)}_parseJson(J){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${J.length}`);const T=JSON.parse(J);return this._endPerformanceCounter("Parse JSON"),T}_unpackBinaryAsync(J){return this._startPerformanceCounter("Unpack Binary"),J.loadAsync(20).then((()=>{const T=J.readUint32();if(1179937895!==T)throw new g.k("Unexpected magic: "+T,g.h.GLTFLoaderUnexpectedMagicError);const b=J.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const q=J.readUint32();let t;switch(this.useRangeRequests||q===J.buffer.byteLength||F.d.Warn(`Length in header does not match actual data length: ${q} != ${J.buffer.byteLength}`),b){case 1:t=this._unpackBinaryV1Async(J,q);break;case 2:t=this._unpackBinaryV2Async(J,q);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),t}))}_unpackBinaryV1Async(J,T){const b=J.readUint32(),q=J.readUint32();if(0!==q)throw new Error(`Unexpected content format: ${q}`);const t=T-J.byteOffset,j={json:this._parseJson(J.readString(b)),bin:null};if(0!==t){const T=J.byteOffset;j.bin={readAsync:(b,q)=>J.buffer.readAsync(T+b,q),byteLength:t}}return Promise.resolve(j)}_unpackBinaryV2Async(J,T){const b=1313821514,q=5130562,t=J.readUint32();if(J.readUint32()!==b)throw new Error("First chunk format is not JSON");return J.byteOffset+t===T?J.loadAsync(t).then((()=>({json:this._parseJson(J.readString(t)),bin:null}))):J.loadAsync(t+8).then((()=>{const j={json:this._parseJson(J.readString(t)),bin:null},B=()=>{const t=J.readUint32();switch(J.readUint32()){case b:throw new Error("Unexpected JSON chunk");case q:{const T=J.byteOffset;j.bin={readAsync:(b,q)=>J.buffer.readAsync(T+b,q),byteLength:t},J.skipBytes(t);break}default:J.skipBytes(t)}return J.byteOffset!==T?J.loadAsync(8).then(B):Promise.resolve(j)};return B()}))}static _parseVersion(J){if("1.0"===J||"1.0.1"===J)return{major:1,minor:0};const T=(J+"").match(/^(\d+)\.(\d+)/);return T?{major:parseInt(T[1]),minor:parseInt(T[2])}:null}static _compareVersion(J,T){return J.major>T.major?1:J.major<T.major?-1:J.minor>T.minor?1:J.minor<T.minor?-1:0}_logOpen(J){this._log(J),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(J){const T=Z._logSpaces.substring(0,2*this._logIndentLevel);F.d.Log(`${T}${J}`)}_logDisabled(J){}_startPerformanceCounterEnabled(J){t.e.StartPerformanceCounter(J)}_startPerformanceCounterDisabled(J){}_endPerformanceCounterEnabled(J){t.e.EndPerformanceCounter(J)}_endPerformanceCounterDisabled(J){}}Z.IncrementalLoading=!0,Z.HomogeneousCoordinates=!1,Z._logSpaces="                                ",(0,j.b)(new Z)},12507:(J,T,b)=>{"use strict";b.d(T,{b:()=>B});var q=b(505);function t(J,T,b,q){const t={externalResourceFunction:q};return b&&(t.uri="file:"===T?b:T+b),ArrayBuffer.isView(J)?GLTFValidator.validateBytes(J,t):GLTFValidator.validateString(J,t)}function j(){const J=[];onmessage=T=>{const b=T.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":t(b.data,b.rootUrl,b.fileName,(T=>new Promise(((b,q)=>{const t=J.length;J.push({resolve:b,reject:q}),postMessage({id:"getExternalResource",index:t,uri:T})})))).then((J=>{postMessage({id:"validate.resolve",value:J})}),(J=>{postMessage({id:"validate.reject",reason:J})}));break;case"getExternalResource.resolve":J[b.index].resolve(b.value);break;case"getExternalResource.reject":J[b.index].reject(b.reason)}}}class B{static ValidateAsync(J,T,b,B){return"function"===typeof Worker?new Promise(((Y,C)=>{const F=`${t}(${j})()`,A=URL.createObjectURL(new Blob([F],{type:"application/javascript"})),a=new Worker(A),P=J=>{a.removeEventListener("error",P),a.removeEventListener("message",v),C(J)},v=J=>{const T=J.data;switch(T.id){case"getExternalResource":B(T.uri).then((J=>{a.postMessage({id:"getExternalResource.resolve",index:T.index,value:J},[J.buffer])}),(J=>{a.postMessage({id:"getExternalResource.reject",index:T.index,reason:J})}));break;case"validate.resolve":a.removeEventListener("error",P),a.removeEventListener("message",v),Y(T.value),a.terminate();break;case"validate.reject":a.removeEventListener("error",P),a.removeEventListener("message",v),C(T.reason),a.terminate()}};if(a.addEventListener("error",P),a.addEventListener("message",v),a.postMessage({id:"init",url:q.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(J)){const q=J.slice();a.postMessage({id:"validate",data:q,rootUrl:T,fileName:b},[q.buffer])}else a.postMessage({id:"validate",data:J,rootUrl:T,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=q.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>t(J,T,b,B))))}}B.Configuration={url:`${q.e._DefaultCdnUrl}/gltf_validator.js`}},12874:(J,T,b)=>{"use strict";b.d(T,{e:()=>p});var q=b(674),t=b(680),j=b(727),B=b(697),Y=b(11994),C=b(11996),F=b(751),A=b(2440),a=b(639),P=b(596);b(12195),b(12110),b(12126),b(12116),b(12135),b(12144),b(12149);const v="imageProcessingCompatibility",G="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";P.c.IncludesShadersStore[v]||(P.c.IncludesShadersStore[v]=G);const x="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";P.c.ShadersStore[x]||(P.c.ShadersStore[x]=I);b(12213),b(12154),b(12160),b(12170),b(12166);const u="skyVertexShader",U="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";P.c.ShadersStore[u]||(P.c.ShadersStore[u]=U);var K=b(12005),E=b(869),l=b(864);class W extends Y.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class p extends C.b{constructor(J,T){super(J,T),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new B.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=B.n.Zero(),this.up=B.n.Up(),this.dithering=!1,this._cameraPosition=B.n.Zero(),this._skyOrientation=new B.h}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(J,T){const b=T._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;T.materialDefines||(T.materialDefines=new W);const q=T.materialDefines,t=this.va();if(this._isReadyForSubMesh(T))return!0;if((0,l.Q)(J,t,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,q),(0,l.I)(J,q,!0,!1),q.IMAGEPROCESSINGPOSTPROCESS!==t.imageProcessingConfiguration.applyByPostProcess&&q.markAsMiscDirty(),q.DITHER!==this.dithering&&q.markAsMiscDirty(),q.isDirty){q.markAsProcessed(),t.resetCachedMaterial();const J=new K.d;q.FOG&&J.addFallback(1,"FOG"),q.IMAGEPROCESSINGPOSTPROCESS=t.imageProcessingConfiguration.applyByPostProcess,q.DITHER=this.dithering;const b=[F.e.PositionKind];q.VERTEXCOLOR&&b.push(F.e.ColorKind);const j="sky",B=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.e)(B);const Y=q.toString();T.setEffect(t.getEngine().createEffect(j,b,B,[],Y,J,this.onCompiled,this.onError),q,this._materialContext)}return!(!T.effect||!T.effect.isReady())&&(q._renderId=t.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(J,T,b){const q=this.va(),t=b.materialDefines;if(!t)return;const j=b.effect;if(!j)return;this._activeEffect=j,this.bindOnlyWorldMatrix(J),this._activeEffect.setMatrix("viewProjection",q.getTransformMatrix()),this._mustRebind(q,j,b)&&((0,E.h)(j,this,q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,l.j)(t,j,q)),q.fogEnabled&&T.applyFog&&q.fogMode!==A.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",q.getViewMatrix()),(0,l.c)(q,T,this._activeEffect);const Y=q.activeCamera;if(Y){const J=Y.getWorldMatrix();this._cameraPosition.x=J.m[12],this._cameraPosition.y=J.m[13],this._cameraPosition.z=J.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const J=Math.PI*(this.inclination-.5),T=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(T)*Math.cos(J),this.sunPosition.y=this.distance*Math.sin(-J),this.sunPosition.z=this.distance*Math.sin(T)*Math.cos(J),B.h.FromUnitVectorsToRef(B.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(T,this._activeEffect,b)}getAnimatables(){return[]}dispose(J){super.dispose(J)}clone(J){return j.d.Clone((()=>new p(J,this.va())),this)}serialize(){const J=super.serialize();return J.customType="BABYLON.SkyMaterial",J}getClassName(){return"SkyMaterial"}static Parse(J,T,b){return j.d.Parse((()=>new p(J.name,T)),J,T,b)}}(0,q.e)([(0,t.M)()],p.prototype,"luminance",void 0),(0,q.e)([(0,t.M)()],p.prototype,"turbidity",void 0),(0,q.e)([(0,t.M)()],p.prototype,"rayleigh",void 0),(0,q.e)([(0,t.M)()],p.prototype,"mieCoefficient",void 0),(0,q.e)([(0,t.M)()],p.prototype,"mieDirectionalG",void 0),(0,q.e)([(0,t.M)()],p.prototype,"distance",void 0),(0,q.e)([(0,t.M)()],p.prototype,"inclination",void 0),(0,q.e)([(0,t.M)()],p.prototype,"azimuth",void 0),(0,q.e)([(0,t.I)()],p.prototype,"sunPosition",void 0),(0,q.e)([(0,t.M)()],p.prototype,"useSunPosition",void 0),(0,q.e)([(0,t.I)()],p.prototype,"cameraOffset",void 0),(0,q.e)([(0,t.I)()],p.prototype,"up",void 0),(0,q.e)([(0,t.M)()],p.prototype,"dithering",void 0),(0,a.g)("BABYLON.SkyMaterial",p)},11686:(J,T,b)=>{"use strict";function q(J,T){T.headers=J.headers||{},T.statusMessage=J.statusText,T.statusCode=J.status,T.data=J.response}function t(J,T,b){return new Promise((function(t,j){b=b||{};var B,Y,C,F=new XMLHttpRequest,A=b.body,a=b.headers||{};for(B in b.timeout&&(F.timeout=b.timeout),F.ontimeout=F.onerror=function(J){J.timeout="timeout"==J.type,j(J)},F.open(J,T.href||T),F.onload=function(){for(C=F.getAllResponseHeaders().trim().split(/[\r\n]+/),q(F,F);Y=C.shift();)Y=Y.split(": "),F.headers[Y.shift().toLowerCase()]=Y.join(": ");if((Y=F.headers["content-type"])&&~Y.indexOf("application/json"))try{F.data=JSON.parse(F.data,b.reviver)}catch(J){return q(F,J),j(J)}(F.status>=400?j:t)(F)},typeof FormData<"u"&&A instanceof FormData||A&&"object"==typeof A&&(a["content-type"]="application/json",A=JSON.stringify(A)),F.withCredentials=!!b.withCredentials,a)F.setRequestHeader(B,a[B]);F.send(A)}))}b.r(T),b.d(T,{del:()=>C,get:()=>j,patch:()=>Y,post:()=>B,put:()=>F,send:()=>t});var j=t.bind(t,"GET"),B=t.bind(t,"POST"),Y=t.bind(t,"PATCH"),C=t.bind(t,"DELETE"),F=t.bind(t,"PUT")},13018:(J,T,b)=>{"use strict";b.d(T,{d:()=>a});const q=.5*(Math.sqrt(3)-1),t=(3-Math.sqrt(3))/6,j=1/3,B=1/6,Y=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,F=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),A=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const a=class{constructor(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const T="function"==typeof J?J:function(J){let T=0,b=0,q=0,t=1;const j=function(){let J=4022871197;return function(T){T=T.toString();for(let b=0;b<T.length;b++){J+=T.charCodeAt(b);let q=.02519603282416938*J;J=q>>>0,q-=J,q*=J,J=q>>>0,q-=J,J+=4294967296*q}return 2.3283064365386963e-10*(J>>>0)}}();T=j(" "),b=j(" "),q=j(" "),T-=j(J),T<0&&(T+=1);b-=j(J),b<0&&(b+=1);q-=j(J),q<0&&(q+=1);return function(){const J=2091639*T+2.3283064365386963e-10*t;return T=b,b=q,q=J-(t=0|J)}}(J);this.p=function(J){const T=new Uint8Array(256);for(let b=0;b<256;b++)T[b]=b;for(let b=0;b<255;b++){const q=b+~~(J()*(256-b)),t=T[b];T[b]=T[q],T[q]=t}return T}(T),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(J,T){const b=this.permMod12,j=this.perm;let B=0,Y=0,C=0;const A=(J+T)*q,a=Math.floor(J+A),P=Math.floor(T+A),v=(a+P)*t,G=J-(a-v),x=T-(P-v);let I,u;G>x?(I=1,u=0):(I=0,u=1);const U=G-I+t,K=x-u+t,E=G-1+2*t,l=x-1+2*t,W=255&a,p=255&P;let o=.5-G*G-x*x;if(o>=0){const J=3*b[W+j[p]];o*=o,B=o*o*(F[J]*G+F[J+1]*x)}let S=.5-U*U-K*K;if(S>=0){const J=3*b[W+I+j[p+u]];S*=S,Y=S*S*(F[J]*U+F[J+1]*K)}let H=.5-E*E-l*l;if(H>=0){const J=3*b[W+1+j[p+1]];H*=H,C=H*H*(F[J]*E+F[J+1]*l)}return 70*(B+Y+C)}noise3D(J,T,b){const q=this.permMod12,t=this.perm;let Y,C,A,a;const P=(J+T+b)*j,v=Math.floor(J+P),G=Math.floor(T+P),x=Math.floor(b+P),I=(v+G+x)*B,u=J-(v-I),U=T-(G-I),K=b-(x-I);let E,l,W,p,o,S;u>=U?U>=K?(E=1,l=0,W=0,p=1,o=1,S=0):u>=K?(E=1,l=0,W=0,p=1,o=0,S=1):(E=0,l=0,W=1,p=1,o=0,S=1):U<K?(E=0,l=0,W=1,p=0,o=1,S=1):u<K?(E=0,l=1,W=0,p=0,o=1,S=1):(E=0,l=1,W=0,p=1,o=1,S=0);const H=u-E+B,s=U-l+B,g=K-W+B,d=u-p+2*B,w=U-o+2*B,Z=K-S+2*B,e=u-1+.5,c=U-1+.5,V=K-1+.5,Q=255&v,h=255&G,i=255&x;let m=.6-u*u-U*U-K*K;if(m<0)Y=0;else{const J=3*q[Q+t[h+t[i]]];m*=m,Y=m*m*(F[J]*u+F[J+1]*U+F[J+2]*K)}let O=.6-H*H-s*s-g*g;if(O<0)C=0;else{const J=3*q[Q+E+t[h+l+t[i+W]]];O*=O,C=O*O*(F[J]*H+F[J+1]*s+F[J+2]*g)}let X=.6-d*d-w*w-Z*Z;if(X<0)A=0;else{const J=3*q[Q+p+t[h+o+t[i+S]]];X*=X,A=X*X*(F[J]*d+F[J+1]*w+F[J+2]*Z)}let L=.6-e*e-c*c-V*V;if(L<0)a=0;else{const J=3*q[Q+1+t[h+1+t[i+1]]];L*=L,a=L*L*(F[J]*e+F[J+1]*c+F[J+2]*V)}return 32*(Y+C+A+a)}noise4D(J,T,b,q){const t=this.perm;let j,B,F,a,P;const v=(J+T+b+q)*Y,G=Math.floor(J+v),x=Math.floor(T+v),I=Math.floor(b+v),u=Math.floor(q+v),U=(G+x+I+u)*C,K=J-(G-U),E=T-(x-U),l=b-(I-U),W=q-(u-U);let p=0,o=0,S=0,H=0;K>E?p++:o++,K>l?p++:S++,K>W?p++:H++,E>l?o++:S++,E>W?o++:H++,l>W?S++:H++;const s=p>=3?1:0,g=o>=3?1:0,d=S>=3?1:0,w=H>=3?1:0,Z=p>=2?1:0,e=o>=2?1:0,c=S>=2?1:0,V=H>=2?1:0,Q=p>=1?1:0,h=o>=1?1:0,i=S>=1?1:0,m=H>=1?1:0,O=K-s+C,X=E-g+C,L=l-d+C,r=W-w+C,N=K-Z+2*C,R=E-e+2*C,n=l-c+2*C,D=W-V+2*C,f=K-Q+3*C,z=E-h+3*C,M=l-i+3*C,y=W-m+3*C,k=K-1+4*C,JJ=E-1+4*C,TJ=l-1+4*C,bJ=W-1+4*C,qJ=255&G,tJ=255&x,jJ=255&I,BJ=255&u;let YJ=.6-K*K-E*E-l*l-W*W;if(YJ<0)j=0;else{const J=t[qJ+t[tJ+t[jJ+t[BJ]]]]%32*4;YJ*=YJ,j=YJ*YJ*(A[J]*K+A[J+1]*E+A[J+2]*l+A[J+3]*W)}let CJ=.6-O*O-X*X-L*L-r*r;if(CJ<0)B=0;else{const J=t[qJ+s+t[tJ+g+t[jJ+d+t[BJ+w]]]]%32*4;CJ*=CJ,B=CJ*CJ*(A[J]*O+A[J+1]*X+A[J+2]*L+A[J+3]*r)}let FJ=.6-N*N-R*R-n*n-D*D;if(FJ<0)F=0;else{const J=t[qJ+Z+t[tJ+e+t[jJ+c+t[BJ+V]]]]%32*4;FJ*=FJ,F=FJ*FJ*(A[J]*N+A[J+1]*R+A[J+2]*n+A[J+3]*D)}let AJ=.6-f*f-z*z-M*M-y*y;if(AJ<0)a=0;else{const J=t[qJ+Q+t[tJ+h+t[jJ+i+t[BJ+m]]]]%32*4;AJ*=AJ,a=AJ*AJ*(A[J]*f+A[J+1]*z+A[J+2]*M+A[J+3]*y)}let aJ=.6-k*k-JJ*JJ-TJ*TJ-bJ*bJ;if(aJ<0)P=0;else{const J=t[qJ+1+t[tJ+1+t[jJ+1+t[BJ+1]]]]%32*4;aJ*=aJ,P=aJ*aJ*(A[J]*k+A[J+1]*JJ+A[J+2]*TJ+A[J+3]*bJ)}return 27*(j+B+F+a+P)}}}}]);