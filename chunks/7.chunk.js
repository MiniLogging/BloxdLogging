/*! For license information please see 67xw0a.7.0dfa48f2.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{13427:Q=>{"use strict";Q.exports=function(Q,X,C,l,h,M){var f=+X[0],O=+X[1],m=+X[2],W=+C[0],U=+C[1],L=+C[2],w=Math.sqrt(W*W+U*U+L*L);if(0===w)throw new Error("Can't raycast along a zero vector");return function(Q,X,C,l,h,M,f,O,m,W){for(var U=0,L=Math.floor,w=0|L(X),i=0|L(C),a=0|L(l),F=h>0?1:-1,s=M>0?1:-1,z=f>0?1:-1,x=Math.abs(1/h),r=Math.abs(1/M),P=Math.abs(1/f),j=x<1/0?x*(F>0?w+1-X:X-w):1/0,v=r<1/0?r*(s>0?i+1-C:C-i):1/0,Z=P<1/0?P*(z>0?a+1-l:l-a):1/0,g=-1;U<=O;){var S=Q(w,i,a);if(S)return m&&(m[0]=X+U*h,m[1]=C+U*M,m[2]=l+U*f),W&&(W[0]=W[1]=W[2]=0,0===g&&(W[0]=-F),1===g&&(W[1]=-s),2===g&&(W[2]=-z)),S;j<v?j<Z?(w+=F,U=j,j+=x,g=0):(a+=z,U=Z,Z+=P,g=2):v<Z?(i+=s,U=v,v+=r,g=1):(a+=z,U=Z,Z+=P,g=2)}return m&&(m[0]=X+U*h,m[1]=C+U*M,m[2]=l+U*f),W&&(W[0]=W[1]=W[2]=0),0}(Q,f,O,m,W/=w,U/=w,L/=w,l="undefined"===typeof l?64:+l,h,M)}},13458:(Q,X,C)=>{"use strict";C.d(X,{d:()=>M});var l=C(87);function h(){this.Ll=!1,this.stopPropagation=!1,this.Ml=!1,this.disabled=!1}class M{constructor(Q,X){this.version="0.7.0";var C=Object.assign({},new h,X||{});this.element=Q||document,this.Ll=!!C.Ll,this.stopPropagation=!!C.stopPropagation,this.Ml=!!C.Ml,this.disabled=!!C.disabled,this.filterEvents=(Q,X)=>!0,this.down=new l.EventEmitter,this.up=new l.EventEmitter,this.state={},this.Gg={dx:0,dy:0,sm:0,ah:0,tm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?O(this):document.addEventListener("DOMContentLoaded",(Q=>{O(this)}),{once:!0})}bind(Q){for(var X=arguments.length,C=new Array(X>1?X-1:0),l=1;l<X;l++)C[l-1]=arguments[l];C.forEach((X=>{var C=this._keyBindmap[X]||[];C.includes(Q)||(C.push(Q),this._keyBindmap[X]=C)})),this.state[Q]=!!this.state[Q],this.pressCount[Q]=this.pressCount[Q]||0,this.releaseCount[Q]=this.releaseCount[Q]||0}unbind(Q){for(var X in this._keyBindmap){var C=this._keyBindmap[X],l=C.indexOf(Q);l>-1&&C.splice(l,1)}}getBindings(){var Q={};for(var X in this._keyBindmap){this._keyBindmap[X].forEach((C=>{Q[C]=Q[C]||[],Q[C].push(X)}))}return Q}se(){f(this.Gg),f(this.pressCount),f(this.releaseCount)}}function f(Q){for(var X in Q)Q[X]=0}function O(Q){window.addEventListener("keydown",a.bind(null,Q,!0),!1),window.addEventListener("keyup",a.bind(null,Q,!1),!1);var X={passive:!0};Q.element.addEventListener("touchstart",L.bind(void 0,Q),{passive:!1}),Q.element.addEventListener("touchend",i.bind(void 0,Q),X),Q.element.addEventListener("mousedown",F.bind(null,Q,!0),X),window.document.addEventListener("mouseup",F.bind(null,Q,!1),X),Q.element.addEventListener("touchmove",s.bind(null,Q),X),Q.element.addEventListener("mousemove",s.bind(null,Q),X),window.PointerEvent,Q.element.addEventListener("wheel",z.bind(null,Q),X),Q.element.addEventListener("contextmenu",x.bind(null,Q),!1),window.addEventListener("blur",r.bind(null,Q),!1)}var m=0,W=0,U=null;function L(Q,X){X.preventDefault(),w(X)}function w(Q){let X=!1;for(let C=0;C<Q.touches.length;++C)if(Q.touches[C].identifier===U){X=!0;break}if(!X){const X=Q.changedTouches[0];m=X.clientX,W=X.clientY,U=X.identifier}}function i(Q,X){for(var C=X.changedTouches,l=0;l<C.length;++l)C[l].identifier===U&&(U=null)}function a(Q,X,C){P(C.code,X,Q,C)}function F(Q,X,C){if("pointerId"in C)if(X){if(null!==Q._touches.currID)return;Q._touches.currID=C.pointerId}else{if(Q._touches.currID!==C.pointerId)return;Q._touches.currID=null}return P("Mouse"+("button"in C?C.button+1:1),X,Q,C),!1}function s(Q,X){var C=X.movementX||X.mozMovementX||0,l=X.movementY||X.mozMovementY||0;if(X.touches&&0===(C|l)){var h=function(Q){w(Q);for(let X=0;X<Q.changedTouches.length;++X)if(Q.changedTouches[X].identifier==U){const C=Q.changedTouches[X],l=[C.clientX-m,C.clientY-W];return m=C.clientX,W=C.clientY,l}return console.error(`Did not find touch id ${U}`),[0,0]}(X);C=h[0],l=h[1]}Q.Gg.dx+=C,Q.Gg.dy+=l}function z(Q,X){var C=1;switch(X.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=Q.element.clientHeight||window.innerHeight}Q.Gg.sm+=(X.deltaX||0)*C,Q.Gg.ah+=(X.deltaY||0)*C,Q.Gg.tm+=(X.deltaZ||0)*C}function x(Q,X){if(!Q.Ml)return X.preventDefault(),!1}function r(Q){for(var X in Q._keyStates)Q._keyStates[X]&&(/^Mouse\d/.test(X)||P(X,!1,Q,{code:X,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function P(Q,X,C,l){var h=C._keyBindmap[Q];h&&(j(C._keyStates[Q],X)&&(C._keyStates[Q]=X,h.forEach((Q=>{(!C.filterEvents||C.filterEvents(l,Q))&&function(Q,X,C,l){var h=X?C.pressCount:C.releaseCount;h[Q]=(h[Q]||0)+1;var M=C._bindPressCount[Q]||0;(M+=X?1:-1)<0&&(M=0);C._bindPressCount[Q]=M;var f=C.state[Q];if(j(f,M)){C.state[Q]=M>0;var O=X?C.down:C.up;C.disabled||O.emit(Q,l)}}(Q,X,C,l)}))),"button"in l||(C.Ll&&!l.defaultPrevented&&l.preventDefault(),C.stopPropagation&&l.stopPropagation()))}function j(Q,X){return Q?!X:X}},13430:(Q,X,C)=>{"use strict";C.d(X,{c:()=>l});class l{constructor(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Sk=!1,this.Tk=!1,this.sf=30,this.Rk=0,this.$k=!1,this.fullscreen=!1,this.Vk=function(Q){},this.Wk=function(){},this.Yk=function(){},this.k=function(){},this.Xk=function(Q){},this.onFullscreenChanged=function(Q){},W((()=>{!function(Q,X){Q._nowObject=performance||Date,Q._lastTick=0,Q._renderAccum=0,Q._rt=0,Q._frameCB=O.bind(null,Q),requestAnimationFrame(Q._frameCB),X>0&&(Q._intervalCB=f.bind(null,Q),Q._interval=setInterval(Q._intervalCB,Math.max(X,1e3/Q.sf/2)))}(this,X),function(Q,X){if(!X)return;var C=!1,l=!1;document.addEventListener("pointerlockchange",(l=>{C=document.pointerLockElement===X,Q.Xk(C)})),document.addEventListener("fullscreenchange",(C=>{l=document.fullscreenElement===X,Q.onFullscreenChanged(l)})),Object.defineProperty(Q,"$k",{get:()=>C,set:Q=>{Q&&!C?m(X):C&&!Q&&function(Q){Q.exitPointerLock&&Q.exitPointerLock()}(document)}}),Object.defineProperty(Q,"fullscreen",{get:()=>l,set:Q=>{Q&&!l?X.requestFullscreen():l&&!Q&&document.exitFullscreen()}}),X.addEventListener("click",(h=>{Q.Sk&&!C&&m(X),Q.Tk&&!l&&X.requestFullscreen()}));var h=()=>Q.k();if(window.ResizeObserver){new ResizeObserver(h).observe(X)}else window.addEventListener("resize",h)}(this,Q),this.Yk()}))}}var h=3,M=20;function f(Q){for(var X=1e3/Q.sf,C=Q._nowObject.now()+M,l=0;Q._nowObject.now()>=Q._lastTick+X&&Q._nowObject.now()<C&&++l<=h;)Q.Vk(X),Q._lastTick+=X;var f=5*(X+5),O=Q._nowObject.now();if(O-Q._lastTick>f)for(;O>=Q._lastTick+X;)Q._lastTick+=X}function O(Q){requestAnimationFrame(Q._frameCB),f(Q);var X=Q._nowObject.now(),C=X-Q._rt;if(Q._rt=X,Q.Rk>0){Q._renderAccum+=C;var l=1e3/Q.Rk;if(Q._renderAccum<l)return;Q._renderAccum=Math.min(Q._renderAccum-l,l)}var h=1e3/Q.sf,M=(X-Q._lastTick)/h;Q.Wk(C,M,h)}function m(Q){Q.requestPointerLock&&Q.requestPointerLock()}var W=Q=>{if("loading"===document.readyState){var X=()=>{document.removeEventListener("readystatechange",X),Q()};document.addEventListener("readystatechange",X)}else setTimeout(Q,1)}},13462:(Q,X,C)=>{"use strict";C.d(X,{d:()=>L});var l=C(893),h=C(137);class M{constructor(Q,X,C,M,f,O,m){this.zf=new l(Q.base,Q.ce),this.mass=X,this.friction=C,this.restitution=M,this.Rd=f,this.Ne=O,this.Sd=!!m,this.Kk=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Ih=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Af=h.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=h.create(),this._impulses=h.create(),this._sleepFrameCount=10}loadFromCopy(Q){h.i(this.zf.base,Q.zf.base),h.i(this.zf.ce,Q.zf.ce),h.i(this.zf.max,Q.zf.max),this.zf.mag=Q.zf.mag,this.mass=Q.mass,this.friction=Q.friction,this.restitution=Q.restitution,this.Rd=Q.Rd,this.Ne=Q.Ne,this.Sd=Q.Sd,this.Kk=Q.Kk,this.fluidDrag=Q.fluidDrag,this.Ih=Q.Ih,this.preventFallOffEdge=Q.preventFallOffEdge,this.rolledBackLastTick=Q.rolledBackLastTick,h.i(this.Af,Q.Af),h.i(this.resting,Q.resting),this.inFluid=Q.inFluid,this._ratioInFluid=Q._ratioInFluid,h.i(this._forces,Q._forces),h.i(this._impulses,Q._impulses),this._sleepFrameCount=Q._sleepFrameCount}setPosition(Q){f(Q),h.Od(Q,Q,this.zf.base),this.zf.translate(Q),this.Bh()}qg(){return h.clone(this.zf.base)}applyForce(Q){f(Q),h.add(this._forces,this._forces,Q),this.Bh()}applyImpulse(Q){f(Q),h.add(this._impulses,this._impulses,Q),this.Bh()}Bh(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var f=Q=>{};var O=C(893),m=C(137),W=C(896);function U(){this.Kk=.1,this.fluidDrag=.4,this.Zd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function L(Q,X,C){Q=Object.assign(new U,Q),this.gravity=Q.gravity||[0,-10,0],this.Kk=Q.Kk||.1,this.Zd=Q.Zd||2,this.fluidDrag=Q.fluidDrag||.4,this.minBounceImpulse=Q.minBounceImpulse,this.bodies=[],this.jm=Q.jm,this.testSolid=X,this.testFluid=C}L.prototype.lf=function(Q,X,C,l,h,f){Q=Q||new O([0,0,0],[1,1,1]),"undefined"==typeof X&&(X=1),"undefined"==typeof C&&(C=1),"undefined"==typeof l&&(l=0),"undefined"==typeof h&&(h=1);var m=new M(Q,X,C,l,h,f);return this.bodies.push(m),m},L.prototype.mf=function(Q){var X=this.bodies.indexOf(Q);X<0||(this.bodies.splice(X,1),Q.zf=Q.Ne=null)};var w=m.create(),i=m.create(),a=m.create(),F=m.create(),s=m.create(),z=m.create(),x=m.create(),r=new O([0,0,0],[1,1,1]),P=new M(r,1,1,0,1,(()=>{}),!1);function j(Q,X,C){return X=C,X*=1-(1-Q.ratioInFluid)**2}L.prototype.se=function(Q){Q/=1e3;var X=n(0,m.squaredLength(this.gravity));this.bodies.forEach((C=>function(Q,X,C,l){m.i(s,X.resting),Q.jm&&P.loadFromCopy(X);if(X.mass<=0)return m.set(X.Af,0,0,0),m.set(X._forces,0,0,0),void m.set(X._impulses,0,0,0);var h=l||0===X.Rd;if(function(Q,X,C,l){if(X._sleepFrameCount>0)return!1;if(l)return!0;var h=!1,M=.5*C*C*X.Rd;return m.scale(q,Q.gravity,M),W(Q.testSolid,X.zf,q,(function(){return h=!0,!0}),!0),h}(Q,X,C,h))return;X._sleepFrameCount--,function(Q,X){var C=X.zf,l=Math.floor(C.base[0]),h=Math.floor(C.base[2]),M=Math.floor(C.base[1]),f=Math.floor(C.max[1]);if(!Q.testFluid(l,M,h))return X.inFluid=!1,void(X.ratioInFluid=0);var O=1,W=M+1;for(;W<=f&&Q.testFluid(l,W,h);)O++,W++;var U=(M+O-C.base[1])/C.ce[1];U>1&&(U=1);var L=C.ce[0]*C.ce[1]*C.ce[2]*U,w=Z;m.scale(w,Q.gravity,-Q.Zd*L*X.Rd),X.applyForce(w),X.inFluid=!0,X.ratioInFluid=U}(Q,X),E(X._forces),E(X._impulses),E(X.Af),E(X.resting),m.scale(w,X._forces,1/X.mass),m.ue(w,w,Q.gravity,X.Rd),m.scale(i,X._impulses,1/X.mass),m.ue(i,i,w,C),m.add(X.Af,X.Af,i),X.friction&&(g(Q,0,X,i,C),g(Q,1,X,i,C),g(Q,2,X,i,C));var M=X.fluidDrag>=0?X.fluidDrag:Q.fluidDrag,f=X.Kk>=0?X.Kk:Q.Kk,O=f,U=f;X.inFluid&&(O=j(X,O,X.fluidDragHoriz>=0?X.fluidDragHoriz:M),U=j(X,U,X.fluidDragVert>=0?X.fluidDragVert:M));O=Math.max(1-O*C/X.mass,0),U=Math.max(1-U*C/X.mass,0),m.set(v,O,U,O),m.multiply(X.Af,X.Af,v),m.scale(a,X.Af,C),m.set(X._forces,0,0,0),m.set(X._impulses,0,0,0),X.Sd&&c(k,X.zf);m.i(z,a),m.set(x,0,0,0),X.preventFallOffEdge&&function(Q,X,C,l){if(!X.resting[1]||C[1]>0)return;var h=J;c(h,X.zf);for(var M=0;M<3;M+=2){m.set(Y,0,0,0),Y[M]=C[M];var f=!0;(f=(f=(f=(f=f&&!N(Q,h.base[0]+Y[0]+1e-5,h.base[1],h.base[2]+Y[2]+1e-5))&&!N(Q,h.max[0]+Y[0]-1e-5,h.base[1],h.base[2]+Y[2]+1e-5))&&!N(Q,h.base[0]+Y[0]+1e-5,h.base[1],h.max[2]+Y[2]-1e-5))&&!N(Q,h.max[0]+Y[0]-1e-5,h.base[1],h.max[2]+Y[2]-1e-5))?(l[M]=C[M]>0?1:-1,C[M]=0):0===M&&(m.set(K,C[0],0,0),e(Q,h,K,l,X.slideOnCollision))}}(Q,X,a,x);e(Q,X.zf,a,X.resting,X.slideOnCollision),X.Sd&&function(Q,X,C,l){if(X.resting[1]>=0&&!X.inFluid)return;var h=0!==X.resting[0],M=0!==X.resting[2];if(!h&&!M)return;var f=Math.abs(l[0]/l[2]),O=4;if(!h&&f>O)return;if(!M&&f<1/O)return;m.add(H,C.base,l);var U=Q.testSolid;W(U,C,l,(function(Q,X,C,l){if(1!==X)return!0;l[X]=0}));var L=C.base[1],w=X.inFluid?1.951:1.001,i=Math.floor(L+w)-L;m.set(o,0,i,0);var a=!1;if(W(U,C,o,(function(Q,X,C,l){return a=!0,!0})),a)return;m.Od(T,H,C.base),T[1]=0,e(Q,C,T,R,!0);var F=n(C.base[0],H[0]),s=n(C.base[2],H[2]);if(h&&!F&&(!s||!M))return;if(M&&(!F||!h)&&!s)return;var z=!0;if(z=z&&!N(Q,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),z=z&&!N(Q,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),z=z&&!N(Q,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),z=z&&!N(Q,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),z)return;c(X.zf,C),X.resting[0]=R[0],X.resting[2]=R[2],X.Ih&&X.Ih()}(Q,X,k,z);for(var L=0;L<3;++L)X.resting[L]=X.resting[L]||x[L],F[L]=0,X.resting[L]&&(s[L]||(F[L]=-X.Af[L]),X.Af[L]=0);var r=m.length(F);r>.001&&(m.scale(F,F,X.mass),X.Ne&&X.Ne(F),X.restitution>0&&r>Q.minBounceImpulse&&(m.scale(F,F,X.restitution),X.applyImpulse(F)));var S=m.squaredLength(X.Af);S>1e-5&&X.Bh();Q.jm&&Q.jm(X)?(X.loadFromCopy(P),X.rolledBackLastTick=!0):X.rolledBackLastTick=!1}(this,C,Q,X)))};var v=m.create([0,0,0]);var Z=m.create();function g(Q,X,C,l,h){var M=C.resting[X],f=l[X];if(!C.alwaysApplyHorizFriction||1!==X){if(0===M)return;if(M*f<=0)return}m.i(S,C.Af),S[X]=0;var O=m.length(S);if(!n(O,0)){var W=Math.abs(C.friction*Q.gravity[X]*h),U=O>W?(O-W)/O:0;C.Af[(X+1)%3]*=U,C.Af[(X+2)%3]*=U}}var S=m.create();function e(Q,X,C,l,h){return m.set(l,0,0,0),W(Q.testSolid,X,C,(function(Q,X,C,M){l[X]=C,M[X]=0,h||(M[0]=0,M[1]=0,M[2]=0)}))}var k=new O([],[]),R=m.create(),H=m.create(),o=m.create(),T=m.create();var Y=m.create(),J=new O([],[]),K=m.create();function N(Q,X,C,l){return Q.testSolid(Math.floor(X),Math.floor(C-1),Math.floor(l))}var q=m.create();function n(Q,X){return Math.abs(Q-X)<1e-5}function c(Q,X){for(var C=0;C<3;C++)Q.base[C]=X.base[C],Q.max[C]=X.max[C],Q.ce[C]=X.ce[C]}var E=function(Q){}},12373:function(Q,X){!function(Q){"use strict";var X=function(Q,C){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Q,X){Q.__proto__=X}||function(Q,X){for(var C in X)Object.prototype.hasOwnProperty.call(X,C)&&(Q[C]=X[C])},X(Q,C)};function C(Q,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function l(){this.constructor=Q}X(Q,C),Q.prototype=null===C?Object.create(C):(l.prototype=C.prototype,new l)}function l(Q,X,C,l){var h,M=arguments.length,f=M<3?X:null===l?l=Object.getOwnPropertyDescriptor(X,C):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(Q,X,C,l);else for(var O=Q.length-1;O>=0;O--)(h=Q[O])&&(f=(M<3?h(f):M>3?h(X,C,f):h(X,C))||f);return M>3&&f&&Object.defineProperty(X,C,f),f}function h(Q,X,C){if(C||2===arguments.length)for(var l,h=0,M=X.length;h<M;h++)!l&&h in X||(l||(l=Array.prototype.slice.call(X,0,h)),l[h]=X[h]);return Q.concat(l||Array.prototype.slice.call(X))}var M,f=255,O=213;Q.OPERATION=void 0,(M=Q.OPERATION||(Q.OPERATION={}))[M.ADD=128]="ADD",M[M.REPLACE=0]="REPLACE",M[M.DELETE=64]="DELETE",M[M.DELETE_AND_ADD=192]="DELETE_AND_ADD",M[M.TOUCH=1]="TOUCH",M[M.CLEAR=10]="CLEAR";var m=function(){function X(Q,X,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Q,this.setParent(X,C)}return X.prototype.setParent=function(Q,X,C){var l=this;if(this.indexes||(this.indexes=this.ref instanceof TQ?this.ref._definition.indexes:{}),this.parent=Q,this.parentIndex=C,X)if(this.root=X,this.ref instanceof TQ){var h=this.ref._definition;for(var M in h.schema){var f=this.ref[M];if(f&&f.$changes){var O=h.indexes[M];f.$changes.setParent(this.ref,X,O)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Q,X){if(Q instanceof TQ){var C=Q.$changes,h=l.ref.$changes.indexes[X];C.setParent(l.ref,l.root,h)}}))},X.prototype.operation=function(Q){this.changes.set(--this.currentCustomOperation,Q)},X.prototype.change=function(X,C){void 0===C&&(C=Q.OPERATION.ADD);var l="number"===typeof X?X:this.indexes[X];this.assertValidIndex(l,X);var h=this.changes.get(l);h&&h.op!==Q.OPERATION.DELETE&&h.op!==Q.OPERATION.TOUCH||this.changes.set(l,{op:h&&h.op===Q.OPERATION.DELETE?Q.OPERATION.DELETE_AND_ADD:C,index:l}),this.allChanges.add(l),this.changed=!0,this.touchParents()},X.prototype.touch=function(X){var C="number"===typeof X?X:this.indexes[X];this.assertValidIndex(C,X),this.changes.has(C)||this.changes.set(C,{op:Q.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},X.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},X.prototype.getType=function(Q){if(this.ref._definition)return(X=this.ref._definition).schema[X.fieldsByIndex[Q]];var X,C=(X=this.parent._definition).schema[X.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},X.prototype.getChildrenFilter=function(){var Q=this.parent._definition.childFilters;return Q&&Q[this.parentIndex]},X.prototype.getValue=function(Q){return this.ref.getByIndex(Q)},X.prototype.delete=function(X){var C="number"===typeof X?X:this.indexes[X];if(void 0!==C){var l=this.getValue(C);this.changes.set(C,{op:Q.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],l&&l.$changes&&(l.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(X," (").concat(C,")"))},X.prototype.discard=function(X,C){var l=this;void 0===X&&(X=!1),void 0===C&&(C=!1),this.ref instanceof TQ||this.changes.forEach((function(X){if(X.op===Q.OPERATION.DELETE){var C=l.ref.getIndex(X.index);delete l.indexes[C]}})),this.changes.clear(),this.changed=X,C&&this.allChanges.clear(),this.currentCustomOperation=0},X.prototype.discardAll=function(){var Q=this;this.changes.forEach((function(X){var C=Q.getValue(X.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},X.prototype.cache=function(Q,X){this.caches[Q]=X},X.prototype.clone=function(){return new X(this.ref,this.parent,this.root)},X.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},X.prototype.assertValidIndex=function(Q,X){if(void 0===Q)throw new Error('ChangeTree: missing index for field "'.concat(X,'"'))},X}();function W(Q,X,C,l){return Q[X]||(Q[X]=[]),Q[X].push(C),null===l||void 0===l||l.forEach((function(Q,X){return C(Q,X)})),function(){return L(Q[X],Q[X].indexOf(C))}}function U(X){var C=this,l="string"!==typeof this.$changes.getType();this.$items.forEach((function(h,M){X.push({refId:C.$changes.refId,op:Q.OPERATION.DELETE,field:M,value:void 0,previousValue:h}),l&&C.$changes.root.removeRef(h.$changes.refId)}))}function L(Q,X){if(-1===X||X>=Q.length)return!1;for(var C=Q.length-1,l=X;l<C;l++)Q[l]=Q[l+1];return Q.length=C,!0}var w=function(Q,X){var C=Q.toString(),l=X.toString();return C<l?-1:C>l?1:0};function i(Q){return Q.$proxy=!0,Q=new Proxy(Q,{get:function(Q,X){return"symbol"===typeof X||isNaN(X)?Q[X]:Q.at(X)},set:function(Q,X,C){if("symbol"===typeof X||isNaN(X))Q[X]=C;else{var l=Array.from(Q.$items.keys()),h=parseInt(l[X]||X);void 0===C||null===C?Q.deleteAt(h):Q.setAt(h,C)}return!0},deleteProperty:function(Q,X){return"number"===typeof X?Q.deleteAt(X):delete Q[X],!0}})}var a=function(){function X(){for(var Q=[],X=0;X<arguments.length;X++)Q[X]=arguments[X];this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Q)}return X.prototype.Yb=function(X,C){return void 0===C&&(C=!0),W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.ADD,X,C?this.$items:void 0)},X.prototype.gc=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.REPLACE,X)},X.is=function(Q){return Array.isArray(Q)||void 0!==Q.array},Object.defineProperty(X.prototype,"length",{get:function(){return this.$items.size},set:function(Q){0===Q?this.clear():this.splice(Q,this.length-Q)},enumerable:!1,configurable:!0}),X.prototype.push=function(){for(var Q,X=this,C=[],l=0;l<arguments.length;l++)C[l]=arguments[l];return C.forEach((function(C){Q=X.$refId++,X.setAt(Q,C)})),Q},X.prototype.pop=function(){var Q=Array.from(this.$indexes.values()).pop();if(void 0!==Q){this.$changes.delete(Q),this.$indexes.delete(Q);var X=this.$items.get(Q);return this.$items.delete(Q),X}},X.prototype.at=function(Q){var X=Array.from(this.$items.keys())[Q];return this.$items.get(X)},X.prototype.setAt=function(X,C){var l,h;if(void 0!==C&&null!==C){if(this.$items.get(X)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,X);var M=null!==(h=null===(l=this.$changes.indexes[X])||void 0===l?void 0:l.op)&&void 0!==h?h:Q.OPERATION.ADD;this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,C),this.$changes.change(X,M)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},X.prototype.deleteAt=function(Q){var X=Array.from(this.$items.keys())[Q];return void 0!==X&&this.$deleteAt(X)},X.prototype.$deleteAt=function(Q){return this.$changes.delete(Q),this.$indexes.delete(Q),this.$items.delete(Q)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&U.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:Q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.concat=function(){for(var Q,C=[],l=0;l<arguments.length;l++)C[l]=arguments[l];return new(X.bind.apply(X,h([void 0],(Q=Array.from(this.$items.values())).concat.apply(Q,C),!1)))},X.prototype.join=function(Q){return Array.from(this.$items.values()).join(Q)},X.prototype.reverse=function(){var Q=this,X=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,l){Q.setAt(X[l],C)})),this},X.prototype.shift=function(){var Q=Array.from(this.$items.keys()).shift();if(void 0!==Q){var X=this.$items.get(Q);return this.$deleteAt(Q),X}},X.prototype.slice=function(Q,C){var l=new X;return l.push.apply(l,Array.from(this.$items.values()).slice(Q,C)),l},X.prototype.sort=function(Q){var X=this;void 0===Q&&(Q=w);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Q).forEach((function(Q,l){X.setAt(C[l],Q)})),this},X.prototype.splice=function(Q,X){void 0===X&&(X=this.length-Q);for(var C=Array.from(this.$items.keys()),l=[],h=Q;h<Q+X;h++)l.push(this.$items.get(C[h])),this.$deleteAt(C[h]);return l},X.prototype.unshift=function(){for(var Q=this,X=[],C=0;C<arguments.length;C++)X[C]=arguments[C];var l=this.length,h=X.length,M=Array.from(this.$items.values());return X.forEach((function(X,C){Q.setAt(C,X)})),M.forEach((function(X,C){Q.setAt(h+C,X)})),l+h},X.prototype.indexOf=function(Q,X){return Array.from(this.$items.values()).indexOf(Q,X)},X.prototype.lastIndexOf=function(Q,X){return void 0===X&&(X=this.length-1),Array.from(this.$items.values()).lastIndexOf(Q,X)},X.prototype.every=function(Q,X){return Array.from(this.$items.values()).every(Q,X)},X.prototype.some=function(Q,X){return Array.from(this.$items.values()).some(Q,X)},X.prototype.forEach=function(Q,X){Array.from(this.$items.values()).forEach(Q,X)},X.prototype.map=function(Q,X){return Array.from(this.$items.values()).map(Q,X)},X.prototype.filter=function(Q,X){return Array.from(this.$items.values()).filter(Q,X)},X.prototype.reduce=function(Q,X){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},X.prototype.reduceRight=function(Q,X){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},X.prototype.find=function(Q,X){return Array.from(this.$items.values()).find(Q,X)},X.prototype.findIndex=function(Q,X){return Array.from(this.$items.values()).findIndex(Q,X)},X.prototype.fill=function(Q,X,C){throw new Error("ArraySchema#fill() not implemented")},X.prototype.copyWithin=function(Q,X,C){throw new Error("ArraySchema#copyWithin() not implemented")},X.prototype.toString=function(){return this.$items.toString()},X.prototype.toLocaleString=function(){return this.$items.toLocaleString()},X.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},X.prototype.includes=function(Q,X){return Array.from(this.$items.values()).includes(Q,X)},X.prototype.flatMap=function(Q,X){throw new Error("ArraySchema#flatMap() is not supported.")},X.prototype.flat=function(Q){throw new Error("ArraySchema#flat() is not supported.")},X.prototype.findLast=function(){var Q=Array.from(this.$items.values());return Q.findLast.apply(Q,arguments)},X.prototype.findLastIndex=function(){var Q=Array.from(this.$items.values());return Q.findLastIndex.apply(Q,arguments)},X.prototype.setIndex=function(Q,X){this.$indexes.set(Q,X)},X.prototype.getIndex=function(Q){return this.$indexes.get(Q)},X.prototype.getByIndex=function(Q){return this.$items.get(this.$indexes.get(Q))},X.prototype.deleteByIndex=function(Q){var X=this.$indexes.get(Q);this.$items.delete(X),this.$indexes.delete(Q)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){return this.toArray().map((function(Q){return"function"===typeof Q.toJSON?Q.toJSON():Q}))},X.prototype.clone=function(Q){return Q?new(X.bind.apply(X,h([void 0],Array.from(this.$items.values()),!1))):new(X.bind.apply(X,h([void 0],this.map((function(Q){return Q.$changes?Q.clone():Q})),!1)))},X}();function F(Q){return Q.$proxy=!0,Q=new Proxy(Q,{get:function(Q,X){return"symbol"!==typeof X&&"undefined"===typeof Q[X]?Q.get(X):Q[X]},set:function(Q,X,C){return"symbol"!==typeof X&&-1===X.indexOf("$")&&"Yb"!==X&&"gc"!==X&&"onChange"!==X?Q.set(X,C):Q[X]=C,!0},deleteProperty:function(Q,X){return Q.delete(X),!0}})}var s=function(){function X(Q){var C=this;if(this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Q)if(Q instanceof Map||Q instanceof X)Q.forEach((function(Q,X){return C.set(X,Q)}));else for(var l in Q)this.set(l,Q[l])}return X.prototype.Yb=function(X,C){return void 0===C&&(C=!0),W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.ADD,X,C?this.$items:void 0)},X.prototype.gc=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.REPLACE,X)},X.is=function(Q){return void 0!==Q.map},X.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(X.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.set=function(X,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(X,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(X,"'."));X=X.toString();var l="undefined"!==typeof this.$changes.indexes[X],h=l?this.$changes.indexes[X]:this.$refId++,M=l?Q.OPERATION.REPLACE:Q.OPERATION.ADD,f=void 0!==C.$changes;if(f&&C.$changes.setParent(this,this.$changes.root,h),l){if(!f&&this.$items.get(X)===C)return;f&&this.$items.get(X)!==C&&(M=Q.OPERATION.ADD)}else this.$changes.indexes[X]=h,this.$indexes.set(h,X);return this.$items.set(X,C),this.$changes.change(X,M),this},X.prototype.get=function(Q){return this.$items.get(Q)},X.prototype.delete=function(Q){return this.$changes.delete(Q),this.$items.delete(Q)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&U.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:Q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(Q){return this.$items.has(Q)},X.prototype.forEach=function(Q){this.$items.forEach(Q)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(Q,X){this.$indexes.set(Q,X)},X.prototype.getIndex=function(Q){return this.$indexes.get(Q)},X.prototype.getByIndex=function(Q){return this.$items.get(this.$indexes.get(Q))},X.prototype.deleteByIndex=function(Q){var X=this.$indexes.get(Q);this.$items.delete(X),this.$indexes.delete(Q)},X.prototype.toJSON=function(){var Q={};return this.forEach((function(X,C){Q[C]="function"===typeof X.toJSON?X.toJSON():X})),Q},X.prototype.clone=function(Q){var C;return Q?C=Object.assign(new X,this):(C=new X,this.forEach((function(Q,X){Q.$changes?C.set(X,Q.clone()):C.set(X,Q)}))),C},X}(),z={};function x(Q,X){z[Q]=X}function r(Q){return z[Q]}var P=function(){function Q(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Q.create=function(X){var C=new Q;return C.schema=Object.assign({},X&&X.schema||{}),C.indexes=Object.assign({},X&&X.indexes||{}),C.fieldsByIndex=Object.assign({},X&&X.fieldsByIndex||{}),C.descriptors=Object.assign({},X&&X.descriptors||{}),C.deprecated=Object.assign({},X&&X.deprecated||{}),C},Q.prototype.addField=function(Q,X){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=Q,this.indexes[Q]=C,this.schema[Q]=Array.isArray(X)?{array:X[0]}:X},Q.prototype.hasField=function(Q){return void 0!==this.indexes[Q]},Q.prototype.addFilter=function(Q,X){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Q]]=X,this.indexesWithFilters.push(this.indexes[Q]),!0},Q.prototype.addChildrenFilter=function(Q,X){var C=this.indexes[Q],l=this.schema[Q];if(r(Object.keys(l)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=X,!0;console.warn("@filterChildren: field '".concat(Q,"' can't have children. Ignoring filter."))},Q.prototype.getChildrenFilter=function(Q){return this.childFilters&&this.childFilters[this.indexes[Q]]},Q.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Q}();function j(Q){return Q._context&&Q._context.useFilters}var v=function(){function Q(){this.types={},this.schemas=new Map,this.useFilters=!1}return Q.prototype.has=function(Q){return this.schemas.has(Q)},Q.prototype.get=function(Q){return this.types[Q]},Q.prototype.add=function(Q,X){void 0===X&&(X=this.schemas.size),Q._definition=P.create(Q._definition),Q._typeid=X,this.types[X]=Q,this.schemas.set(Q,X)},Q.create=function(X){return void 0===X&&(X={}),function(C){return X.context||(X.context=new Q),g(C,X)}},Q}(),Z=new v;function g(Q,X){return void 0===X&&(X={}),function(C,l){var M=X.context||Z,f=C.constructor;if(f._context=M,!Q)throw new Error("".concat(f.name,': @type() reference provided for "').concat(l,"\" is undefined. Make sure you don't have any circular dependencies."));M.has(f)||M.add(f);var O=f._definition;if(O.addField(l,Q),O.descriptors[l]){if(O.deprecated[l])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(l,"' definition on '").concat(f.name,"'.\nCheck @type() annotation"))}catch(z){var m=z.stack.split("\n")[4].trim();throw new Error("".concat(z.message," ").concat(m))}}var W=a.is(Q),U=!W&&s.is(Q);if("string"!==typeof Q&&!TQ.is(Q)){var L=Object.values(Q)[0];"string"===typeof L||M.has(L)||M.add(L)}if(X.manual)O.descriptors[l]={enumerable:!0,configurable:!0,writable:!0};else{var w="_".concat(l);O.descriptors[w]={enumerable:!1,configurable:!1,writable:!0},O.descriptors[l]={get:function(){return this[w]},set:function(Q){Q!==this[w]&&(void 0!==Q&&null!==Q?(!W||Q instanceof a||(Q=new(a.bind.apply(a,h([void 0],Q,!1)))),!U||Q instanceof s||(Q=new s(Q)),void 0===Q.$proxy&&(U?Q=F(Q):W&&(Q=i(Q))),this.$changes.change(l),Q.$changes&&Q.$changes.setParent(this,this.$changes.root,this._definition.indexes[l])):this[w]&&this.$changes.delete(l),this[w]=Q)},enumerable:!0,configurable:!0}}}}function S(Q){return function(X,C){var l=X.constructor;l._definition.addFilter(C,Q)&&(l._context.useFilters=!0)}}function e(Q){return function(X,C){var l=X.constructor;l._definition.addChildrenFilter(C,Q)&&(l._context.useFilters=!0)}}function k(Q){return void 0===Q&&(Q=!0),function(X,C){var l=X.constructor._definition;l.deprecated[C]=!0,Q&&(l.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(Q){},enumerable:!1,configurable:!0})}}function R(Q,X,C){for(var l in void 0===C&&(C={}),C.context||(C.context=Q._context||C.context||Z),X)g(X[l],C)(Q.prototype,l);return Q}function H(Q){for(var X=0,C=0,l=0,h=Q.length;l<h;l++)(X=Q.charCodeAt(l))<128?C+=1:X<2048?C+=2:X<55296||X>=57344?C+=3:(l++,C+=4);return C}function o(Q,X,C){for(var l=0,h=0,M=C.length;h<M;h++)(l=C.charCodeAt(h))<128?Q[X++]=l:l<2048?(Q[X++]=192|l>>6,Q[X++]=128|63&l):l<55296||l>=57344?(Q[X++]=224|l>>12,Q[X++]=128|l>>6&63,Q[X++]=128|63&l):(h++,l=65536+((1023&l)<<10|1023&C.charCodeAt(h)),Q[X++]=240|l>>18,Q[X++]=128|l>>12&63,Q[X++]=128|l>>6&63,Q[X++]=128|63&l)}function T(Q,X){Q.push(255&X)}function Y(Q,X){Q.push(255&X)}function J(Q,X){Q.push(255&X),Q.push(X>>8&255)}function K(Q,X){Q.push(255&X),Q.push(X>>8&255)}function N(Q,X){Q.push(255&X),Q.push(X>>8&255),Q.push(X>>16&255),Q.push(X>>24&255)}function q(Q,X){var C=X>>24,l=X>>16,h=X>>8,M=X;Q.push(255&M),Q.push(255&h),Q.push(255&l),Q.push(255&C)}function n(Q,X){var C=Math.floor(X/Math.pow(2,32));q(Q,X>>>0),q(Q,C)}function c(Q,X){var C=X/Math.pow(2,32)|0;q(Q,X>>>0),q(Q,C)}function E(Q,X){I(Q,X)}function B(Q,X){t(Q,X)}var G=new Int32Array(2),b=new Float32Array(G.buffer),p=new Float64Array(G.buffer);function I(Q,X){b[0]=X,N(Q,G[0])}function t(Q,X){p[0]=X,N(Q,G[0]),N(Q,G[1])}function y(Q,X){return Y(Q,X?1:0)}function A(Q,X){X||(X="");var C=H(X),l=0;if(C<32)Q.push(160|C),l=1;else if(C<256)Q.push(217),Y(Q,C),l=2;else if(C<65536)Q.push(218),K(Q,C),l=3;else{if(!(C<4294967296))throw new Error("String too long");Q.push(219),q(Q,C),l=5}return o(Q,Q.length,X),l+C}function D(Q,X){return isNaN(X)?D(Q,0):isFinite(X)?X!==(0|X)?(Q.push(203),t(Q,X),9):X>=0?X<128?(Y(Q,X),1):X<256?(Q.push(204),Y(Q,X),2):X<65536?(Q.push(205),K(Q,X),3):X<4294967296?(Q.push(206),q(Q,X),5):(Q.push(207),c(Q,X),9):X>=-32?(Q.push(224|X+32),1):X>=-128?(Q.push(208),T(Q,X),2):X>=-32768?(Q.push(209),J(Q,X),3):X>=-2147483648?(Q.push(210),N(Q,X),5):(Q.push(211),n(Q,X),9):D(Q,X>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var u=Object.freeze({__proto__:null,utf8Write:o,int8:T,uint8:Y,int16:J,uint16:K,int32:N,uint32:q,int64:n,uint64:c,float32:E,float64:B,writeFloat32:I,writeFloat64:t,boolean:y,string:A,number:D});function V(Q,X,C){for(var l="",h=0,M=X,f=X+C;M<f;M++){var O=Q[M];0!==(128&O)?192!==(224&O)?224!==(240&O)?240!==(248&O)?console.error("Invalid byte "+O.toString(16)):(h=(7&O)<<18|(63&Q[++M])<<12|(63&Q[++M])<<6|63&Q[++M])>=65536?(h-=65536,l+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):l+=String.fromCharCode(h):l+=String.fromCharCode((15&O)<<12|(63&Q[++M])<<6|63&Q[++M]):l+=String.fromCharCode((31&O)<<6|63&Q[++M]):l+=String.fromCharCode(O)}return l}function d(Q,X){return QQ(Q,X)<<24>>24}function QQ(Q,X){return Q[X.offset++]}function XQ(Q,X){return CQ(Q,X)<<16>>16}function CQ(Q,X){return Q[X.offset++]|Q[X.offset++]<<8}function lQ(Q,X){return Q[X.offset++]|Q[X.offset++]<<8|Q[X.offset++]<<16|Q[X.offset++]<<24}function hQ(Q,X){return lQ(Q,X)>>>0}function MQ(Q,X){return wQ(Q,X)}function fQ(Q,X){return iQ(Q,X)}function OQ(Q,X){var C=hQ(Q,X);return lQ(Q,X)*Math.pow(2,32)+C}function mQ(Q,X){var C=hQ(Q,X);return hQ(Q,X)*Math.pow(2,32)+C}var WQ=new Int32Array(2),UQ=new Float32Array(WQ.buffer),LQ=new Float64Array(WQ.buffer);function wQ(Q,X){return WQ[0]=lQ(Q,X),UQ[0]}function iQ(Q,X){return WQ[0]=lQ(Q,X),WQ[1]=lQ(Q,X),LQ[0]}function aQ(Q,X){return QQ(Q,X)>0}function FQ(Q,X){var C,l=Q[X.offset++];l<192?C=31&l:217===l?C=QQ(Q,X):218===l?C=CQ(Q,X):219===l&&(C=hQ(Q,X));var h=V(Q,X.offset,C);return X.offset+=C,h}function sQ(Q,X){var C=Q[X.offset];return C<192&&C>160||217===C||218===C||219===C}function zQ(Q,X){var C=Q[X.offset++];return C<128?C:202===C?wQ(Q,X):203===C?iQ(Q,X):204===C?QQ(Q,X):205===C?CQ(Q,X):206===C?hQ(Q,X):207===C?mQ(Q,X):208===C?d(Q,X):209===C?XQ(Q,X):210===C?lQ(Q,X):211===C?OQ(Q,X):C>223?-1*(255-C+1):void 0}function xQ(Q,X){var C=Q[X.offset];return C<128||C>=202&&C<=211}function rQ(Q,X){return Q[X.offset]<160}function PQ(Q,X){return Q[X.offset-1]===f&&(Q[X.offset]<128||Q[X.offset]>=202&&Q[X.offset]<=211)}var jQ=Object.freeze({__proto__:null,int8:d,uint8:QQ,int16:XQ,uint16:CQ,int32:lQ,uint32:hQ,float32:MQ,float64:fQ,int64:OQ,uint64:mQ,readFloat32:wQ,readFloat64:iQ,boolean:aQ,string:FQ,stringCheck:sQ,number:zQ,numberCheck:xQ,arrayCheck:rQ,switchStructureCheck:PQ}),vQ=function(){function X(Q){var X=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Q&&Q.forEach((function(Q){return X.add(Q)}))}return X.prototype.Yb=function(X,C){return void 0===C&&(C=!0),W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.ADD,X,C?this.$items:void 0)},X.prototype.gc=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.REPLACE,X)},X.is=function(Q){return void 0!==Q.collection},X.prototype.add=function(Q){var X=this.$refId++;return void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,X),this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,Q),this.$changes.change(X),X},X.prototype.at=function(Q){var X=Array.from(this.$items.keys())[Q];return this.$items.get(X)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(Q){for(var X,C,l=this.$items.entries();(C=l.next())&&!C.done;)if(Q===C.value[1]){X=C.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&U.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:Q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(Q){return Array.from(this.$items.values()).some((function(X){return X===Q}))},X.prototype.forEach=function(Q){var X=this;this.$items.forEach((function(C,l,h){return Q(C,l,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(Q,X){this.$indexes.set(Q,X)},X.prototype.getIndex=function(Q){return this.$indexes.get(Q)},X.prototype.getByIndex=function(Q){return this.$items.get(this.$indexes.get(Q))},X.prototype.deleteByIndex=function(Q){var X=this.$indexes.get(Q);this.$items.delete(X),this.$indexes.delete(Q)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var Q=[];return this.forEach((function(X,C){Q.push("function"===typeof X.toJSON?X.toJSON():X)})),Q},X.prototype.clone=function(Q){var C;return Q?C=Object.assign(new X,this):(C=new X,this.forEach((function(Q){Q.$changes?C.add(Q.clone()):C.add(Q)}))),C},X}(),ZQ=function(){function X(Q){var X=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Q&&Q.forEach((function(Q){return X.add(Q)}))}return X.prototype.Yb=function(X,C){return void 0===C&&(C=!0),W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.ADD,X,C?this.$items:void 0)},X.prototype.gc=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.REPLACE,X)},X.is=function(Q){return void 0!==Q.set},X.prototype.add=function(X){var C,l;if(this.has(X))return!1;var h=this.$refId++;void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,h);var M=null!==(l=null===(C=this.$changes.indexes[h])||void 0===C?void 0:C.op)&&void 0!==l?l:Q.OPERATION.ADD;return this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,X),this.$changes.change(h,M),h},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(Q){for(var X,C,l=this.$items.entries();(C=l.next())&&!C.done;)if(Q===C.value[1]){X=C.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&U.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:Q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(Q){for(var X,C=this.$items.values(),l=!1;(X=C.next())&&!X.done;)if(Q===X.value){l=!0;break}return l},X.prototype.forEach=function(Q){var X=this;this.$items.forEach((function(C,l,h){return Q(C,l,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(Q,X){this.$indexes.set(Q,X)},X.prototype.getIndex=function(Q){return this.$indexes.get(Q)},X.prototype.getByIndex=function(Q){return this.$items.get(this.$indexes.get(Q))},X.prototype.deleteByIndex=function(Q){var X=this.$indexes.get(Q);this.$items.delete(X),this.$indexes.delete(Q)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var Q=[];return this.forEach((function(X,C){Q.push("function"===typeof X.toJSON?X.toJSON():X)})),Q},X.prototype.clone=function(Q){var C;return Q?C=Object.assign(new X,this):(C=new X,this.forEach((function(Q){Q.$changes?C.add(Q.clone()):C.add(Q)}))),C},X}(),gQ=function(){function Q(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Q.prototype.addRefId=function(Q){this.refIds.has(Q)||(this.refIds.add(Q),this.containerIndexes.set(Q,new Set))},Q.get=function(X){return void 0===X.$filterState&&(X.$filterState=new Q),X.$filterState},Q}(),SQ=function(){function Q(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Q.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Q.prototype.addRef=function(Q,X,C){void 0===C&&(C=!0),this.refs.set(Q,X),C&&(this.refCounts[Q]=(this.refCounts[Q]||0)+1)},Q.prototype.removeRef=function(Q){this.refCounts[Q]=this.refCounts[Q]-1,this.deletedRefs.add(Q)},Q.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Q.prototype.garbageCollectDeletedRefs=function(){var Q=this;this.deletedRefs.forEach((function(X){if(!(Q.refCounts[X]>0)){var C=Q.refs.get(X);if(C instanceof TQ)for(var l in C._definition.schema)"string"!==typeof C._definition.schema[l]&&C[l]&&C[l].$changes&&Q.removeRef(C[l].$changes.refId);else{var h=C.$changes.parent._definition,M=h.schema[h.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(M)[0]&&Array.from(C.values()).forEach((function(X){return Q.removeRef(X.$changes.refId)}))}Q.refs.delete(X),delete Q.refCounts[X]}})),this.deletedRefs.clear()},Q}(),eQ=function(Q){function X(){return null!==Q&&Q.apply(this,arguments)||this}return C(X,Q),X}(Error);function kQ(Q,X,C,l){var h,M=!1;switch(X){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":h="number",isNaN(Q)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(l));break;case"string":h="string",M=!0;break;case"boolean":return}if(typeof Q!==h&&(!M||M&&null!==Q)){var f="'".concat(JSON.stringify(Q),"'").concat(Q&&Q.constructor&&" (".concat(Q.constructor.name,")")||"");throw new eQ("a '".concat(h,"' was expected, but ").concat(f," was provided in ").concat(C.constructor.name,"#").concat(l))}}function RQ(Q,X,C,l){if(!(Q instanceof X))throw new eQ("a '".concat(X.name,"' was expected, but '").concat(Q.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(l))}function HQ(Q,X,C,l,h){kQ(C,Q,l,h);var M=u[Q];if(!M)throw new eQ("a '".concat(Q,"' was expected, but ").concat(C," was provided in ").concat(l.constructor.name,"#").concat(h));M(X,C)}function oQ(Q,X,C){return jQ[Q](X,C)}var TQ=function(){function X(){for(var Q=[],X=0;X<arguments.length;X++)Q[X]=arguments[X];Object.defineProperties(this,{$changes:{value:new m(this,void 0,new SQ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),Q[0]&&this.assign(Q[0])}return X.onError=function(Q){console.error(Q)},X.is=function(Q){return Q._definition&&void 0!==Q._definition.schema},X.prototype.onChange=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.REPLACE,X)},X.prototype.gc=function(X){return W(this.$callbacks||(this.$callbacks=[]),Q.OPERATION.DELETE,X)},X.prototype.assign=function(Q){return Object.assign(this,Q),this},Object.defineProperty(X.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),X.prototype.setDirty=function(Q,X){this.$changes.change(Q,X)},X.prototype.listen=function(Q,X,C){var l=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Q]||(this.$callbacks[Q]=[]),this.$callbacks[Q].push(X),C&&void 0!==this[Q]&&X(this[Q],void 0),function(){return L(l.$callbacks[Q],l.$callbacks[Q].indexOf(X))}},X.prototype.decode=function(C,l,h){var M;void 0===l&&(l={offset:0}),void 0===h&&(h=this);var O=[],m=this.$changes.root,W=C.length,U=0;for(m.refs.set(U,this);l.offset<W;){var L=C[l.offset++];if(L!=f){var w=h.$changes,i=void 0!==h._definition,F=i?L>>6<<6:L;if(F!==Q.OPERATION.CLEAR){var z=i?L%(F||255):zQ(C,l),x=i?h._definition.fieldsByIndex[z]:"",P=w.getType(z),j=void 0,v=void 0,Z=void 0;if(i?v=h["_".concat(x)]:(v=h.getByIndex(z),(F&Q.OPERATION.ADD)===Q.OPERATION.ADD?(Z=h instanceof s?FQ(C,l):z,h.setIndex(z,Z)):Z=h.getIndex(z)),(F&Q.OPERATION.DELETE)===Q.OPERATION.DELETE&&(F!==Q.OPERATION.DELETE_AND_ADD&&h.deleteByIndex(z),v&&v.$changes&&m.removeRef(v.$changes.refId),j=null),void 0!==x){if(F===Q.OPERATION.DELETE);else if(X.is(P)){var g=zQ(C,l);if(j=m.refs.get(g),F!==Q.OPERATION.REPLACE){var S=this.getSchemaType(C,l,P);j||((j=this.createTypeInstance(S)).$changes.refId=g,v&&(j.$callbacks=v.$callbacks,v.$changes.refId&&g!==v.$changes.refId&&m.removeRef(v.$changes.refId))),m.addRef(g,j,j!==v)}}else if("string"===typeof P)j=oQ(P,C,l);else{var e=r(Object.keys(P)[0]),k=zQ(C,l),R=m.refs.has(k)?v||m.refs.get(k):new e.constructor;if((j=R.clone(!0)).$changes.refId=k,v&&(j.$callbacks=v.$callbacks,v.$changes.refId&&k!==v.$changes.refId)){m.removeRef(v.$changes.refId);for(var H=v.entries(),o=void 0;(o=H.next())&&!o.done;){var T=(M=o.value)[0],Y=M[1];O.push({refId:k,op:Q.OPERATION.DELETE,field:T,value:void 0,previousValue:Y})}}m.addRef(k,j,R!==v)}if(null!==j&&void 0!==j)if(j.$changes&&j.$changes.setParent(w.ref,w.root,z),h instanceof X)h[x]=j;else if(h instanceof s)T=Z,h.$items.set(T,j),h.$changes.allChanges.add(z);else if(h instanceof a)h.setAt(z,j);else if(h instanceof vQ){var J=h.add(j);h.setIndex(z,J)}else h instanceof ZQ&&!1!==(J=h.add(j))&&h.setIndex(z,J);v!==j&&O.push({refId:U,op:F,field:x,dynamicIndex:Z,value:j,previousValue:v})}else{console.warn("@colyseus/schema: definition mismatch");for(var K={offset:l.offset};l.offset<W&&(!PQ(C,l)||(K.offset=l.offset+1,!m.refs.has(zQ(C,K))));)l.offset++}}else h.clear(O)}else{U=zQ(C,l);var N=m.refs.get(U);if(!N)throw new Error('"refId" not found: '.concat(U));h=N}}return this._triggerChanges(O),m.garbageCollectDeletedRefs(),O},X.prototype.encode=function(C,l,h){void 0===C&&(C=!1),void 0===l&&(l=[]),void 0===h&&(h=!1);for(var M=this.$changes,O=new WeakSet,m=[M],W=1,U=0;U<W;U++){var L=m[U],w=L.ref,i=w instanceof X;L.ensureRefId(),O.add(L),L!==M&&(L.changed||C)&&(Y(l,f),D(l,L.refId));for(var a=C?Array.from(L.allChanges):Array.from(L.changes.values()),F=0,z=a.length;F<z;F++){var x=C?{op:Q.OPERATION.ADD,index:a[F]}:a[F],P=x.index,j=i?w._definition.fieldsByIndex&&w._definition.fieldsByIndex[P]:P,v=l.length;if(x.op!==Q.OPERATION.TOUCH)if(i)Y(l,P|x.op);else{if(Y(l,x.op),x.op===Q.OPERATION.CLEAR)continue;D(l,P)}if(i||(x.op&Q.OPERATION.ADD)!=Q.OPERATION.ADD||w instanceof s&&A(l,L.ref.$indexes.get(P)),x.op!==Q.OPERATION.DELETE){var Z=L.getType(P),g=L.getValue(P);if(g&&g.$changes&&!O.has(g.$changes)&&(m.push(g.$changes),g.$changes.ensureRefId(),W++),x.op!==Q.OPERATION.TOUCH){if(X.is(Z))RQ(g,Z,w,j),D(l,g.$changes.refId),(x.op&Q.OPERATION.ADD)===Q.OPERATION.ADD&&this.tryEncodeTypeId(l,Z,g.constructor);else if("string"===typeof Z)HQ(Z,l,g,w,j);else{var S=r(Object.keys(Z)[0]);RQ(w["_".concat(j)],S.constructor,w,j),D(l,g.$changes.refId)}h&&L.cache(P,l.slice(v))}}}C||h||L.discard()}return l},X.prototype.encodeAll=function(Q){return this.encode(!0,[],Q)},X.prototype.applyFilters=function(C,l){var h,M;void 0===l&&(l=!1);for(var O=this,m=new Set,W=gQ.get(C),U=[this.$changes],L=1,w=[],i=function(i){var a=U[i];if(m.has(a.refId))return"continue";var F=a.ref,z=F instanceof X;Y(w,f),D(w,a.refId);var x=W.refIds.has(a),r=l||!x;W.addRefId(a);var P=W.containerIndexes.get(a),j=r?Array.from(a.allChanges):Array.from(a.changes.values());!l&&z&&F._definition.indexesWithFilters&&F._definition.indexesWithFilters.forEach((function(X){!P.has(X)&&a.allChanges.has(X)&&(r?j.push(X):j.push({op:Q.OPERATION.ADD,index:X}))}));for(var v=0,Z=j.length;v<Z;v++){var g=r?{op:Q.OPERATION.ADD,index:j[v]}:j[v];if(g.op!==Q.OPERATION.CLEAR){var S=g.index;if(g.op!==Q.OPERATION.DELETE){var e=a.getValue(S),k=a.getType(S);if(z){if((R=F._definition.filters&&F._definition.filters[S])&&!R.call(F,C,e,O)){e&&e.$changes&&m.add(e.$changes.refId);continue}}else{var R,H=a.parent;if((R=a.getChildrenFilter())&&!R.call(H,C,F.$indexes.get(S),e,O)){e&&e.$changes&&m.add(e.$changes.refId);continue}}if(e.$changes&&(U.push(e.$changes),L++),g.op!==Q.OPERATION.TOUCH)if(g.op===Q.OPERATION.ADD||z)w.push.apply(w,null!==(h=a.caches[S])&&void 0!==h?h:[]),P.add(S);else if(P.has(S))w.push.apply(w,null!==(M=a.caches[S])&&void 0!==M?M:[]);else{if(P.add(S),Y(w,Q.OPERATION.ADD),D(w,S),F instanceof s){var o=a.ref.$indexes.get(S);A(w,o)}e.$changes?D(w,e.$changes.refId):u[k](w,e)}else e.$changes&&!z&&(Y(w,Q.OPERATION.ADD),D(w,S),F instanceof s&&(o=a.ref.$indexes.get(S),A(w,o)),D(w,e.$changes.refId))}else z?Y(w,g.op|S):(Y(w,g.op),D(w,S))}else Y(w,g.op)}},a=0;a<L;a++)i(a);return w},X.prototype.clone=function(){var Q,X=new this.constructor,C=this._definition.schema;for(var l in C)"object"===typeof this[l]&&"function"===typeof(null===(Q=this[l])||void 0===Q?void 0:Q.clone)?X[l]=this[l].clone():X[l]=this[l];return X},X.prototype.toJSON=function(){var Q=this._definition.schema,X=this._definition.deprecated,C={};for(var l in Q)X[l]||null===this[l]||"undefined"===typeof this[l]||(C[l]="function"===typeof this[l].toJSON?this[l].toJSON():this["_".concat(l)]);return C},X.prototype.discardAllChanges=function(){this.$changes.discardAll()},X.prototype.getByIndex=function(Q){return this[this._definition.fieldsByIndex[Q]]},X.prototype.deleteByIndex=function(Q){this[this._definition.fieldsByIndex[Q]]=void 0},X.prototype.tryEncodeTypeId=function(Q,X,C){X._typeid!==C._typeid&&(Y(Q,O),D(Q,C._typeid))},X.prototype.getSchemaType=function(Q,X,C){var l;return Q[X.offset]===O&&(X.offset++,l=this.constructor._context.get(zQ(Q,X))),l||C},X.prototype.createTypeInstance=function(Q){var X=new Q;return X.$changes.root=this.$changes.root,X},X.prototype._triggerChanges=function(C){for(var l,h,M,f,O,m,W,U,L,w=new Set,i=this.$changes.root.refs,a=function(a){var F=C[a],s=F.refId,z=i.get(s),x=z.$callbacks;if((F.op&Q.OPERATION.DELETE)===Q.OPERATION.DELETE&&F.previousValue instanceof X&&(null===(h=null===(l=F.previousValue.$callbacks)||void 0===l?void 0:l[Q.OPERATION.DELETE])||void 0===h||h.forEach((function(Q){return Q()}))),!x)return"continue";if(z instanceof X){if(!w.has(s))try{null===(M=null===x||void 0===x?void 0:x[Q.OPERATION.REPLACE])||void 0===M||M.forEach((function(Q){return Q()}))}catch(r){X.onError(r)}try{x.hasOwnProperty(F.field)&&(null===(f=x[F.field])||void 0===f||f.forEach((function(Q){return Q(F.value,F.previousValue)})))}catch(r){X.onError(r)}}else F.op===Q.OPERATION.ADD&&void 0===F.previousValue?null===(O=x[Q.OPERATION.ADD])||void 0===O||O.forEach((function(Q){var X;return Q(F.value,null!==(X=F.dynamicIndex)&&void 0!==X?X:F.field)})):F.op===Q.OPERATION.DELETE?void 0!==F.previousValue&&(null===(m=x[Q.OPERATION.DELETE])||void 0===m||m.forEach((function(Q){var X;return Q(F.previousValue,null!==(X=F.dynamicIndex)&&void 0!==X?X:F.field)}))):F.op===Q.OPERATION.DELETE_AND_ADD&&(void 0!==F.previousValue&&(null===(W=x[Q.OPERATION.DELETE])||void 0===W||W.forEach((function(Q){var X;return Q(F.previousValue,null!==(X=F.dynamicIndex)&&void 0!==X?X:F.field)}))),null===(U=x[Q.OPERATION.ADD])||void 0===U||U.forEach((function(Q){var X;return Q(F.value,null!==(X=F.dynamicIndex)&&void 0!==X?X:F.field)}))),F.value!==F.previousValue&&(null===(L=x[Q.OPERATION.REPLACE])||void 0===L||L.forEach((function(Q){var X;return Q(F.value,null!==(X=F.dynamicIndex)&&void 0!==X?X:F.field)})));w.add(s)},F=0;F<C.length;F++)a(F)},X._definition=P.create(),X}();function YQ(Q){for(var X=[Q.$changes],C=1,l={},h=l,M=function(Q){var C=X[Q];C.changes.forEach((function(Q){var X=C.ref,l=Q.index,M=X._definition?X._definition.fieldsByIndex[l]:X.$indexes.get(l);h[M]=C.getValue(l)}))},f=0;f<C;f++)M(f);return l}var JQ={context:new v},KQ=function(Q){function X(){return null!==Q&&Q.apply(this,arguments)||this}return C(X,Q),l([g("string",JQ)],X.prototype,"name",void 0),l([g("string",JQ)],X.prototype,"type",void 0),l([g("number",JQ)],X.prototype,"referencedType",void 0),X}(TQ),NQ=function(Q){function X(){var X=null!==Q&&Q.apply(this,arguments)||this;return X.fields=new a,X}return C(X,Q),l([g("number",JQ)],X.prototype,"id",void 0),l([g([KQ],JQ)],X.prototype,"fields",void 0),X}(TQ),qQ=function(Q){function X(){var X=null!==Q&&Q.apply(this,arguments)||this;return X.types=new a,X}return C(X,Q),X.encode=function(Q){var C=Q.constructor,l=new X;l.rootType=C._typeid;var h=function(Q,X){for(var C in X){var h=new KQ;h.name=C;var M=void 0;if("string"===typeof X[C])M=X[C];else{var f=X[C],O=void 0;TQ.is(f)?(M="ref",O=X[C]):"string"===typeof f[M=Object.keys(f)[0]]?M+=":"+f[M]:O=f[M],h.referencedType=O?O._typeid:-1}h.type=M,Q.fields.push(h)}l.types.push(Q)},M=C._context.types;for(var f in M){var O=new NQ;O.id=Number(f),h(O,M[f]._definition.schema)}return l.encodeAll()},X.decode=function(Q,l){var h=new v,M=new X;M.decode(Q,l);var f=M.types.reduce((function(Q,X){var l=function(Q){function X(){return null!==Q&&Q.apply(this,arguments)||this}return C(X,Q),X}(TQ),M=X.id;return Q[M]=l,h.add(l,M),Q}),{});M.types.forEach((function(Q){var X=f[Q.id];Q.fields.forEach((function(Q){var C;if(void 0!==Q.referencedType){var l=Q.type,M=f[Q.referencedType];if(!M){var O=Q.type.split(":");l=O[0],M=O[1]}"ref"===l?g(M,{context:h})(X.prototype,Q.name):g(((C={})[l]=M,C),{context:h})(X.prototype,Q.name)}else g(Q.type,{context:h})(X.prototype,Q.name)}))}));var O=f[M.rootType],m=new O;for(var W in O._definition.schema){var U=O._definition.schema[W];"string"!==typeof U&&(m[W]="function"===typeof U?new U:new(r(Object.keys(U)[0]).constructor))}return m},l([g([NQ],JQ)],X.prototype,"types",void 0),l([g("number",JQ)],X.prototype,"rootType",void 0),X}(TQ);x("map",{constructor:s}),x("array",{constructor:a}),x("set",{constructor:ZQ}),x("collection",{constructor:vQ}),Q.ArraySchema=a,Q.CollectionSchema=vQ,Q.Context=v,Q.MapSchema=s,Q.Reflection=qQ,Q.ReflectionField=KQ,Q.ReflectionType=NQ,Q.Schema=TQ,Q.SchemaDefinition=P,Q.SetSchema=ZQ,Q.decode=jQ,Q.defineTypes=R,Q.deprecated=k,Q.dumpChanges=YQ,Q.encode=u,Q.filter=S,Q.filterChildren=e,Q.hasFilter=j,Q.registerType=x,Q.type=g,Object.defineProperty(Q,"__esModule",{value:!0})}(X)},13325:Q=>{"use strict";Q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13316:(Q,X,C)=>{var l=C(13325),h=C(13331),M=Object.hasOwnProperty,f=Object.create(null);for(var O in l)M.call(l,O)&&(f[l[O]]=O);var m=Q.exports={to:{},get:{}};function W(Q,X,C){return Math.min(Math.max(X,Q),C)}function U(Q){var X=Math.round(Q).toString(16).toUpperCase();return X.length<2?"0"+X:X}m.get=function(Q){var X,C;switch(Q.substring(0,3).toLowerCase()){case"hsl":X=m.get.hsl(Q),C="hsl";break;case"hwb":X=m.get.hwb(Q),C="hwb";break;default:X=m.get.rgb(Q),C="rgb"}return X?{model:C,value:X}:null},m.get.rgb=function(Q){if(!Q)return null;var X,C,h,f=[0,0,0,1];if(X=Q.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(h=X[2],X=X[1],C=0;C<3;C++){var O=2*C;f[C]=parseInt(X.slice(O,O+2),16)}h&&(f[3]=parseInt(h,16)/255)}else if(X=Q.match(/^#([a-f0-9]{3,4})$/i)){for(h=(X=X[1])[3],C=0;C<3;C++)f[C]=parseInt(X[C]+X[C],16);h&&(f[3]=parseInt(h+h,16)/255)}else if(X=Q.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)f[C]=parseInt(X[C+1],0);X[4]&&(X[5]?f[3]=.01*parseFloat(X[4]):f[3]=parseFloat(X[4]))}else{if(!(X=Q.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(X=Q.match(/^(\w+)$/))?"transparent"===X[1]?[0,0,0,0]:M.call(l,X[1])?((f=l[X[1]])[3]=1,f):null:null;for(C=0;C<3;C++)f[C]=Math.round(2.55*parseFloat(X[C+1]));X[4]&&(X[5]?f[3]=.01*parseFloat(X[4]):f[3]=parseFloat(X[4]))}for(C=0;C<3;C++)f[C]=W(f[C],0,255);return f[3]=W(f[3],0,1),f},m.get.hsl=function(Q){if(!Q)return null;var X=Q.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var C=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,W(parseFloat(X[2]),0,100),W(parseFloat(X[3]),0,100),W(isNaN(C)?1:C,0,1)]}return null},m.get.hwb=function(Q){if(!Q)return null;var X=Q.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var C=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,W(parseFloat(X[2]),0,100),W(parseFloat(X[3]),0,100),W(isNaN(C)?1:C,0,1)]}return null},m.to.hex=function(){var Q=h(arguments);return"#"+U(Q[0])+U(Q[1])+U(Q[2])+(Q[3]<1?U(Math.round(255*Q[3])):"")},m.to.rgb=function(){var Q=h(arguments);return Q.length<4||1===Q[3]?"rgb("+Math.round(Q[0])+", "+Math.round(Q[1])+", "+Math.round(Q[2])+")":"rgba("+Math.round(Q[0])+", "+Math.round(Q[1])+", "+Math.round(Q[2])+", "+Q[3]+")"},m.to.rgb.percent=function(){var Q=h(arguments),X=Math.round(Q[0]/255*100),C=Math.round(Q[1]/255*100),l=Math.round(Q[2]/255*100);return Q.length<4||1===Q[3]?"rgb("+X+"%, "+C+"%, "+l+"%)":"rgba("+X+"%, "+C+"%, "+l+"%, "+Q[3]+")"},m.to.hsl=function(){var Q=h(arguments);return Q.length<4||1===Q[3]?"hsl("+Q[0]+", "+Q[1]+"%, "+Q[2]+"%)":"hsla("+Q[0]+", "+Q[1]+"%, "+Q[2]+"%, "+Q[3]+")"},m.to.hwb=function(){var Q=h(arguments),X="";return Q.length>=4&&1!==Q[3]&&(X=", "+Q[3]),"hwb("+Q[0]+", "+Q[1]+"%, "+Q[2]+"%"+X+")"},m.to.keyword=function(Q){return f[Q.slice(0,3)]}},13309:(Q,X,C)=>{const l=C(13316),h=C(13340),M=["keyword","gray","hex"],f={};for(const i of Object.keys(h))f[[...h[i].labels].sort().join("")]=i;const O={};function m(Q,X){if(!(this instanceof m))return new m(Q,X);if(X&&X in M&&(X=null),X&&!(X in h))throw new Error("Unknown model: "+X);let C,W;if(null==Q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Q instanceof m)this.model=Q.model,this.color=[...Q.color],this.valpha=Q.valpha;else if("string"===typeof Q){const X=l.get(Q);if(null===X)throw new Error("Unable to parse color from string: "+Q);this.model=X.model,W=h[this.model].channels,this.color=X.value.slice(0,W),this.valpha="number"===typeof X.value[W]?X.value[W]:1}else if(Q.length>0){this.model=X||"rgb",W=h[this.model].channels;const C=Array.prototype.slice.call(Q,0,W);this.color=w(C,W),this.valpha="number"===typeof Q[W]?Q[W]:1}else if("number"===typeof Q)this.model="rgb",this.color=[Q>>16&255,Q>>8&255,255&Q],this.valpha=1;else{this.valpha=1;const X=Object.keys(Q);"alpha"in Q&&(X.splice(X.indexOf("alpha"),1),this.valpha="number"===typeof Q.alpha?Q.alpha:0);const l=X.sort().join("");if(!(l in f))throw new Error("Unable to parse color from object: "+JSON.stringify(Q));this.model=f[l];const{labels:M}=h[this.model],O=[];for(C=0;C<M.length;C++)O.push(Q[M[C]]);this.color=w(O)}if(O[this.model])for(W=h[this.model].channels,C=0;C<W;C++){const Q=O[this.model][C];Q&&(this.color[C]=Q(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}m.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Q){let X=this.model in l.to?this:this.rgb();X=X.round("number"===typeof Q?Q:1);const C=1===X.valpha?X.color:[...X.color,this.valpha];return l.to[X.model](C)},percentString(Q){const X=this.rgb().round("number"===typeof Q?Q:1),C=1===X.valpha?X.color:[...X.color,this.valpha];return l.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Q={},{channels:X}=h[this.model],{labels:C}=h[this.model];for(let l=0;l<X;l++)Q[C[l]]=this.color[l];return 1!==this.valpha&&(Q.alpha=this.valpha),Q},unitArray(){const Q=this.rgb().color;return Q[0]/=255,Q[1]/=255,Q[2]/=255,1!==this.valpha&&Q.push(this.valpha),Q},unitObject(){const Q=this.rgb().object();return Q.r/=255,Q.g/=255,Q.b/=255,1!==this.valpha&&(Q.alpha=this.valpha),Q},round(Q){return Q=Math.max(Q||0,0),new m([...this.color.map(W(Q)),this.valpha],this.model)},alpha(Q){return void 0!==Q?new m([...this.color,Math.max(0,Math.min(1,Q))],this.model):this.valpha},red:U("rgb",0,L(255)),green:U("rgb",1,L(255)),blue:U("rgb",2,L(255)),hue:U(["hsl","hsv","hsl","hwb","hcg"],0,(Q=>(Q%360+360)%360)),saturationl:U("hsl",1,L(100)),lightness:U("hsl",2,L(100)),saturationv:U("hsv",1,L(100)),value:U("hsv",2,L(100)),chroma:U("hcg",1,L(100)),gray:U("hcg",2,L(100)),white:U("hwb",1,L(100)),wblack:U("hwb",2,L(100)),cyan:U("cmyk",0,L(100)),magenta:U("cmyk",1,L(100)),yellow:U("cmyk",2,L(100)),black:U("cmyk",3,L(100)),x:U("xyz",0,L(95.047)),y:U("xyz",1,L(100)),z:U("xyz",2,L(108.833)),l:U("lab",0,L(100)),a:U("lab",1),b:U("lab",2),keyword(Q){return void 0!==Q?new m(Q):h[this.model].keyword(this.color)},hex(Q){return void 0!==Q?new m(Q):l.to.hex(this.rgb().round().color)},hexa(Q){if(void 0!==Q)return new m(Q);const X=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),l.to.hex(X)+C},rgbNumber(){const Q=this.rgb().color;return(255&Q[0])<<16|(255&Q[1])<<8|255&Q[2]},luminosity(){const Q=this.rgb().color,X=[];for(const[C,l]of Q.entries()){const Q=l/255;X[C]=Q<=.04045?Q/12.92:((Q+.055)/1.055)**2.4}return.2126*X[0]+.7152*X[1]+.0722*X[2]},contrast(Q){const X=this.luminosity(),C=Q.luminosity();return X>C?(X+.05)/(C+.05):(C+.05)/(X+.05)},level(Q){const X=this.contrast(Q);return X>=7?"AAA":X>=4.5?"AA":""},isDark(){const Q=this.rgb().color;return(2126*Q[0]+7152*Q[1]+722*Q[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Q=this.rgb();for(let X=0;X<3;X++)Q.color[X]=255-Q.color[X];return Q},lighten(Q){const X=this.hsl();return X.color[2]+=X.color[2]*Q,X},darken(Q){const X=this.hsl();return X.color[2]-=X.color[2]*Q,X},saturate(Q){const X=this.hsl();return X.color[1]+=X.color[1]*Q,X},desaturate(Q){const X=this.hsl();return X.color[1]-=X.color[1]*Q,X},whiten(Q){const X=this.hwb();return X.color[1]+=X.color[1]*Q,X},blacken(Q){const X=this.hwb();return X.color[2]+=X.color[2]*Q,X},grayscale(){const Q=this.rgb().color,X=.3*Q[0]+.59*Q[1]+.11*Q[2];return m.rgb(X,X,X)},fade(Q){return this.alpha(this.valpha-this.valpha*Q)},opaquer(Q){return this.alpha(this.valpha+this.valpha*Q)},rotate(Q){const X=this.hsl();let C=X.color[0];return C=(C+Q)%360,C=C<0?360+C:C,X.color[0]=C,X},mix(Q,X){if(!Q||!Q.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Q);const C=Q.rgb(),l=this.rgb(),h=void 0===X?.5:X,M=2*h-1,f=C.alpha()-l.alpha(),O=((M*f===-1?M:(M+f)/(1+M*f))+1)/2,W=1-O;return m.rgb(O*C.red()+W*l.red(),O*C.green()+W*l.green(),O*C.blue()+W*l.blue(),C.alpha()*h+l.alpha()*(1-h))}};for(const i of Object.keys(h)){if(M.includes(i))continue;const{channels:Q}=h[i];m.prototype[i]=function(){if(this.model===i)return new m(this);for(var Q=arguments.length,X=new Array(Q),C=0;C<Q;C++)X[C]=arguments[C];return X.length>0?new m(X,i):new m([...(l=h[this.model][i].raw(this.color),Array.isArray(l)?l:[l]),this.valpha],i);var l},m[i]=function(){for(var X=arguments.length,C=new Array(X),l=0;l<X;l++)C[l]=arguments[l];let h=C[0];return"number"===typeof h&&(h=w(C,Q)),new m(h,i)}}function W(Q){return function(X){return function(Q,X){return Number(Q.toFixed(X))}(X,Q)}}function U(Q,X,C){Q=Array.isArray(Q)?Q:[Q];for(const l of Q)(O[l]||(O[l]=[]))[X]=C;return Q=Q[0],function(l){let h;return void 0!==l?(C&&(l=C(l)),h=this[Q](),h.color[X]=l,h):(h=this[Q]().color[X],C&&(h=C(h)),h)}}function L(Q){return function(X){return Math.max(0,Math.min(Q,X))}}function w(Q,X){for(let C=0;C<X;C++)"number"!==typeof Q[C]&&(Q[C]=0);return Q}Q.exports=m},13349:(Q,X,C)=>{const l=C(13356),h={};for(const f of Object.keys(l))h[l[f]]=f;const M={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Q.exports=M;for(const f of Object.keys(M)){if(!("channels"in M[f]))throw new Error("missing channels property: "+f);if(!("labels"in M[f]))throw new Error("missing channel labels property: "+f);if(M[f].labels.length!==M[f].channels)throw new Error("channel and label counts mismatch: "+f);const{channels:Q,labels:X}=M[f];delete M[f].channels,delete M[f].labels,Object.defineProperty(M[f],"channels",{value:Q}),Object.defineProperty(M[f],"labels",{value:X})}M.rgb.hsl=function(Q){const X=Q[0]/255,C=Q[1]/255,l=Q[2]/255,h=Math.min(X,C,l),M=Math.max(X,C,l),f=M-h;let O,m;M===h?O=0:X===M?O=(C-l)/f:C===M?O=2+(l-X)/f:l===M&&(O=4+(X-C)/f),O=Math.min(60*O,360),O<0&&(O+=360);const W=(h+M)/2;return m=M===h?0:W<=.5?f/(M+h):f/(2-M-h),[O,100*m,100*W]},M.rgb.hsv=function(Q){let X,C,l,h,M;const f=Q[0]/255,O=Q[1]/255,m=Q[2]/255,W=Math.max(f,O,m),U=W-Math.min(f,O,m),L=function(Q){return(W-Q)/6/U+.5};return 0===U?(h=0,M=0):(M=U/W,X=L(f),C=L(O),l=L(m),f===W?h=l-C:O===W?h=1/3+X-l:m===W&&(h=2/3+C-X),h<0?h+=1:h>1&&(h-=1)),[360*h,100*M,100*W]},M.rgb.hwb=function(Q){const X=Q[0],C=Q[1];let l=Q[2];const h=M.rgb.hsl(Q)[0],f=1/255*Math.min(X,Math.min(C,l));return l=1-1/255*Math.max(X,Math.max(C,l)),[h,100*f,100*l]},M.rgb.cmyk=function(Q){const X=Q[0]/255,C=Q[1]/255,l=Q[2]/255,h=Math.min(1-X,1-C,1-l);return[100*((1-X-h)/(1-h)||0),100*((1-C-h)/(1-h)||0),100*((1-l-h)/(1-h)||0),100*h]},M.rgb.keyword=function(Q){const X=h[Q];if(X)return X;let C,M=1/0;for(const h of Object.keys(l)){const X=l[h],m=(O=X,((f=Q)[0]-O[0])**2+(f[1]-O[1])**2+(f[2]-O[2])**2);m<M&&(M=m,C=h)}var f,O;return C},M.keyword.rgb=function(Q){return l[Q]},M.rgb.xyz=function(Q){let X=Q[0]/255,C=Q[1]/255,l=Q[2]/255;X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92;return[100*(.4124*X+.3576*C+.1805*l),100*(.2126*X+.7152*C+.0722*l),100*(.0193*X+.1192*C+.9505*l)]},M.rgb.lab=function(Q){const X=M.rgb.xyz(Q);let C=X[0],l=X[1],h=X[2];C/=95.047,l/=100,h/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,h=h>.008856?h**(1/3):7.787*h+16/116;return[116*l-16,500*(C-l),200*(l-h)]},M.hsl.rgb=function(Q){const X=Q[0]/360,C=Q[1]/100,l=Q[2]/100;let h,M,f;if(0===C)return f=255*l,[f,f,f];h=l<.5?l*(1+C):l+C-l*C;const O=2*l-h,m=[0,0,0];for(let W=0;W<3;W++)M=X+1/3*-(W-1),M<0&&M++,M>1&&M--,f=6*M<1?O+6*(h-O)*M:2*M<1?h:3*M<2?O+(h-O)*(2/3-M)*6:O,m[W]=255*f;return m},M.hsl.hsv=function(Q){const X=Q[0];let C=Q[1]/100,l=Q[2]/100,h=C;const M=Math.max(l,.01);l*=2,C*=l<=1?l:2-l,h*=M<=1?M:2-M;return[X,100*(0===l?2*h/(M+h):2*C/(l+C)),100*((l+C)/2)]},M.hsv.rgb=function(Q){const X=Q[0]/60,C=Q[1]/100;let l=Q[2]/100;const h=Math.floor(X)%6,M=X-Math.floor(X),f=255*l*(1-C),O=255*l*(1-C*M),m=255*l*(1-C*(1-M));switch(l*=255,h){case 0:return[l,m,f];case 1:return[O,l,f];case 2:return[f,l,m];case 3:return[f,O,l];case 4:return[m,f,l];case 5:return[l,f,O]}},M.hsv.hsl=function(Q){const X=Q[0],C=Q[1]/100,l=Q[2]/100,h=Math.max(l,.01);let M,f;f=(2-C)*l;const O=(2-C)*h;return M=C*h,M/=O<=1?O:2-O,M=M||0,f/=2,[X,100*M,100*f]},M.hwb.rgb=function(Q){const X=Q[0]/360;let C=Q[1]/100,l=Q[2]/100;const h=C+l;let M;h>1&&(C/=h,l/=h);const f=Math.floor(6*X),O=1-l;M=6*X-f,0!==(1&f)&&(M=1-M);const m=C+M*(O-C);let W,U,L;switch(f){default:case 6:case 0:W=O,U=m,L=C;break;case 1:W=m,U=O,L=C;break;case 2:W=C,U=O,L=m;break;case 3:W=C,U=m,L=O;break;case 4:W=m,U=C,L=O;break;case 5:W=O,U=C,L=m}return[255*W,255*U,255*L]},M.cmyk.rgb=function(Q){const X=Q[0]/100,C=Q[1]/100,l=Q[2]/100,h=Q[3]/100;return[255*(1-Math.min(1,X*(1-h)+h)),255*(1-Math.min(1,C*(1-h)+h)),255*(1-Math.min(1,l*(1-h)+h))]},M.xyz.rgb=function(Q){const X=Q[0]/100,C=Q[1]/100,l=Q[2]/100;let h,M,f;return h=3.2406*X+-1.5372*C+-.4986*l,M=-.9689*X+1.8758*C+.0415*l,f=.0557*X+-.204*C+1.057*l,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,h=Math.min(Math.max(0,h),1),M=Math.min(Math.max(0,M),1),f=Math.min(Math.max(0,f),1),[255*h,255*M,255*f]},M.xyz.lab=function(Q){let X=Q[0],C=Q[1],l=Q[2];X/=95.047,C/=100,l/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;return[116*C-16,500*(X-C),200*(C-l)]},M.lab.xyz=function(Q){let X,C,l;C=(Q[0]+16)/116,X=Q[1]/500+C,l=C-Q[2]/200;const h=C**3,M=X**3,f=l**3;return C=h>.008856?h:(C-16/116)/7.787,X=M>.008856?M:(X-16/116)/7.787,l=f>.008856?f:(l-16/116)/7.787,X*=95.047,C*=100,l*=108.883,[X,C,l]},M.lab.lch=function(Q){const X=Q[0],C=Q[1],l=Q[2];let h;h=360*Math.atan2(l,C)/2/Math.PI,h<0&&(h+=360);return[X,Math.sqrt(C*C+l*l),h]},M.lch.lab=function(Q){const X=Q[0],C=Q[1],l=Q[2]/360*2*Math.PI;return[X,C*Math.cos(l),C*Math.sin(l)]},M.rgb.ansi16=function(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,l,h]=Q;let f=null===X?M.rgb.hsv(Q)[2]:X;if(f=Math.round(f/50),0===f)return 30;let O=30+(Math.round(h/255)<<2|Math.round(l/255)<<1|Math.round(C/255));return 2===f&&(O+=60),O},M.hsv.ansi16=function(Q){return M.rgb.ansi16(M.hsv.rgb(Q),Q[2])},M.rgb.ansi256=function(Q){const X=Q[0],C=Q[1],l=Q[2];if(X===C&&C===l)return X<8?16:X>248?231:Math.round((X-8)/247*24)+232;return 16+36*Math.round(X/255*5)+6*Math.round(C/255*5)+Math.round(l/255*5)},M.ansi16.rgb=function(Q){let X=Q%10;if(0===X||7===X)return Q>50&&(X+=3.5),X=X/10.5*255,[X,X,X];const C=.5*(1+~~(Q>50));return[(1&X)*C*255,(X>>1&1)*C*255,(X>>2&1)*C*255]},M.ansi256.rgb=function(Q){if(Q>=232){const X=10*(Q-232)+8;return[X,X,X]}let X;Q-=16;return[Math.floor(Q/36)/5*255,Math.floor((X=Q%36)/6)/5*255,X%6/5*255]},M.rgb.hex=function(Q){const X=(((255&Math.round(Q[0]))<<16)+((255&Math.round(Q[1]))<<8)+(255&Math.round(Q[2]))).toString(16).toUpperCase();return"000000".substring(X.length)+X},M.hex.rgb=function(Q){const X=Q.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!X)return[0,0,0];let C=X[0];3===X[0].length&&(C=C.split("").map((Q=>Q+Q)).join(""));const l=parseInt(C,16);return[l>>16&255,l>>8&255,255&l]},M.rgb.hcg=function(Q){const X=Q[0]/255,C=Q[1]/255,l=Q[2]/255,h=Math.max(Math.max(X,C),l),M=Math.min(Math.min(X,C),l),f=h-M;let O,m;return O=f<1?M/(1-f):0,m=f<=0?0:h===X?(C-l)/f%6:h===C?2+(l-X)/f:4+(X-C)/f,m/=6,m%=1,[360*m,100*f,100*O]},M.hsl.hcg=function(Q){const X=Q[1]/100,C=Q[2]/100,l=C<.5?2*X*C:2*X*(1-C);let h=0;return l<1&&(h=(C-.5*l)/(1-l)),[Q[0],100*l,100*h]},M.hsv.hcg=function(Q){const X=Q[1]/100,C=Q[2]/100,l=X*C;let h=0;return l<1&&(h=(C-l)/(1-l)),[Q[0],100*l,100*h]},M.hcg.rgb=function(Q){const X=Q[0]/360,C=Q[1]/100,l=Q[2]/100;if(0===C)return[255*l,255*l,255*l];const h=[0,0,0],M=X%1*6,f=M%1,O=1-f;let m=0;switch(Math.floor(M)){case 0:h[0]=1,h[1]=f,h[2]=0;break;case 1:h[0]=O,h[1]=1,h[2]=0;break;case 2:h[0]=0,h[1]=1,h[2]=f;break;case 3:h[0]=0,h[1]=O,h[2]=1;break;case 4:h[0]=f,h[1]=0,h[2]=1;break;default:h[0]=1,h[1]=0,h[2]=O}return m=(1-C)*l,[255*(C*h[0]+m),255*(C*h[1]+m),255*(C*h[2]+m)]},M.hcg.hsv=function(Q){const X=Q[1]/100,C=X+Q[2]/100*(1-X);let l=0;return C>0&&(l=X/C),[Q[0],100*l,100*C]},M.hcg.hsl=function(Q){const X=Q[1]/100,C=Q[2]/100*(1-X)+.5*X;let l=0;return C>0&&C<.5?l=X/(2*C):C>=.5&&C<1&&(l=X/(2*(1-C))),[Q[0],100*l,100*C]},M.hcg.hwb=function(Q){const X=Q[1]/100,C=X+Q[2]/100*(1-X);return[Q[0],100*(C-X),100*(1-C)]},M.hwb.hcg=function(Q){const X=Q[1]/100,C=1-Q[2]/100,l=C-X;let h=0;return l<1&&(h=(C-l)/(1-l)),[Q[0],100*l,100*h]},M.apple.rgb=function(Q){return[Q[0]/65535*255,Q[1]/65535*255,Q[2]/65535*255]},M.rgb.apple=function(Q){return[Q[0]/255*65535,Q[1]/255*65535,Q[2]/255*65535]},M.gray.rgb=function(Q){return[Q[0]/100*255,Q[0]/100*255,Q[0]/100*255]},M.gray.hsl=function(Q){return[0,0,Q[0]]},M.gray.hsv=M.gray.hsl,M.gray.hwb=function(Q){return[0,100,Q[0]]},M.gray.cmyk=function(Q){return[0,0,0,Q[0]]},M.gray.lab=function(Q){return[Q[0],0,0]},M.gray.hex=function(Q){const X=255&Math.round(Q[0]/100*255),C=((X<<16)+(X<<8)+X).toString(16).toUpperCase();return"000000".substring(C.length)+C},M.rgb.gray=function(Q){return[(Q[0]+Q[1]+Q[2])/3/255*100]}},13340:(Q,X,C)=>{const l=C(13349),h=C(13358),M={};Object.keys(l).forEach((Q=>{M[Q]={},Object.defineProperty(M[Q],"channels",{value:l[Q].channels}),Object.defineProperty(M[Q],"labels",{value:l[Q].labels});const X=h(Q);Object.keys(X).forEach((C=>{const l=X[C];M[Q][C]=function(Q){const X=function(){for(var X=arguments.length,C=new Array(X),l=0;l<X;l++)C[l]=arguments[l];const h=C[0];if(void 0===h||null===h)return h;h.length>1&&(C=h);const M=Q(C);if("object"===typeof M)for(let Q=M.length,f=0;f<Q;f++)M[f]=Math.round(M[f]);return M};return"conversion"in Q&&(X.conversion=Q.conversion),X}(l),M[Q][C].raw=function(Q){const X=function(){for(var X=arguments.length,C=new Array(X),l=0;l<X;l++)C[l]=arguments[l];const h=C[0];return void 0===h||null===h?h:(h.length>1&&(C=h),Q(C))};return"conversion"in Q&&(X.conversion=Q.conversion),X}(l)}))})),Q.exports=M},13358:(Q,X,C)=>{const l=C(13349);function h(Q){const X=function(){const Q={},X=Object.keys(l);for(let C=X.length,l=0;l<C;l++)Q[X[l]]={distance:-1,parent:null};return Q}(),C=[Q];for(X[Q].distance=0;C.length;){const Q=C.pop(),h=Object.keys(l[Q]);for(let l=h.length,M=0;M<l;M++){const l=h[M],f=X[l];-1===f.distance&&(f.distance=X[Q].distance+1,f.parent=Q,C.unshift(l))}}return X}function M(Q,X){return function(C){return X(Q(C))}}function f(Q,X){const C=[X[Q].parent,Q];let h=l[X[Q].parent][Q],f=X[Q].parent;for(;X[f].parent;)C.unshift(X[f].parent),h=M(l[X[f].parent][f],h),f=X[f].parent;return h.conversion=C,h}Q.exports=function(Q){const X=h(Q),C={},l=Object.keys(X);for(let h=l.length,M=0;M<h;M++){const Q=l[M];null!==X[Q].parent&&(C[Q]=f(Q,X))}return C}},13356:Q=>{"use strict";Q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12381:function(Q,X,C){"use strict";var l=this&&this.__createBinding||(Object.create?function(Q,X,C,l){void 0===l&&(l=C);var h=Object.getOwnPropertyDescriptor(X,C);h&&!("get"in h?!X.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return X[C]}}),Object.defineProperty(Q,l,h)}:function(Q,X,C,l){void 0===l&&(l=C),Q[l]=X[C]}),h=this&&this.__setModuleDefault||(Object.create?function(Q,X){Object.defineProperty(Q,"default",{enumerable:!0,value:X})}:function(Q,X){Q.default=X}),M=this&&this.__importStar||function(Q){if(Q&&Q.__esModule)return Q;var X={};if(null!=Q)for(var C in Q)"default"!==C&&Object.prototype.hasOwnProperty.call(Q,C)&&l(X,Q,C);return h(X,Q),X},f=this&&this.__awaiter||function(Q,X,C,l){return new(C||(C=Promise))((function(h,M){function f(Q){try{m(l.next(Q))}catch(X){M(X)}}function O(Q){try{m(l.throw(Q))}catch(X){M(X)}}function m(Q){var X;Q.done?h(Q.value):(X=Q.value,X instanceof C?X:new C((function(Q){Q(X)}))).then(f,O)}m((l=l.apply(Q,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Auth=X.Platform=void 0;const O=M(C(12300)),m=C(12383),W="colyseus-auth-token";!function(Q){Q.ios="ios",Q.android="android"}(X.Platform||(X.Platform={}));X.Auth=class{constructor(Q){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=Q.replace("ws","http"),(0,m.getItem)(W,(Q=>this.token=Q))}get hasToken(){return!!this.token}login(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,void 0,void 0,(function*(){const X=Object.assign({},Q);this.hasToken&&(X.token=this.token);const C=yield this.request("post","/auth",X);this.token=C.token,(0,m.setItem)(W,this.token);for(let Q in C)this.hasOwnProperty(Q)&&(this[Q]=C[Q]);return this.registerPingService(),this}))}save(){return f(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(Q){return f(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:Q})}))}acceptFriendRequest(Q){return f(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:Q})}))}declineFriendRequest(Q){return f(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:Q})}))}blockUser(Q){return f(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:Q})}))}unblockUser(Q){return f(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:Q})}))}request(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return f(this,void 0,void 0,(function*(){h.Accept="application/json",this.hasToken&&(h.Authorization="Bearer "+this.token);const M=[];for(const Q in C)M.push(`${Q}=${C[Q]}`);const f=M.length>0?`?${M.join("&")}`:"",m={headers:h};return l&&(m.body=l),(yield O[Q](`${this.endpoint}${X}${f}`,m)).data}))}logout(){this.token=void 0,(0,m.removeItem)(W),this.unregisterPingService()}registerPingService(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),Q)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},12296:function(Q,X,C){"use strict";var l,h=this&&this.__awaiter||function(Q,X,C,l){return new(C||(C=Promise))((function(h,M){function f(Q){try{m(l.next(Q))}catch(X){M(X)}}function O(Q){try{m(l.throw(Q))}catch(X){M(X)}}function m(Q){var X;Q.done?h(Q.value):(X=Q.value,X instanceof C?X:new C((function(Q){Q(X)}))).then(f,O)}m((l=l.apply(Q,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Client=X.MatchMakeError=void 0;const M=C(12300),f=C(12309),O=C(12313);class m extends Error{constructor(Q,X){super(Q),this.code=X,Object.setPrototypeOf(this,m.prototype)}}X.MatchMakeError=m;const W="undefined"!==typeof window&&"undefined"!==typeof(null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";X.Client=class{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W;if("string"===typeof Q){const X=new URL(Q),C="https:"===X.protocol||"wss:"===X.protocol,l=Number(X.port||(C?443:80));this.settings={hostname:X.hostname,pathname:"/"!==X.pathname?X.pathname:"",port:l,secure:C}}else void 0===Q.port&&(Q.port=Q.secure?443:80),void 0===Q.pathname&&(Q.pathname=""),this.settings=Q}joinOrCreate(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Q,X,C)}))}create(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Q,X,C)}))}join(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Q,X,C)}))}joinById(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Q,X,C)}))}reconnect(Q,X){return h(this,void 0,void 0,(function*(){if("string"===typeof Q&&"string"===typeof X)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,l]=Q.split(":");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:l},X)}))}getAvailableRooms(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return h(this,void 0,void 0,(function*(){return(yield(0,M.get)(this.getHttpEndpoint(`${Q}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Q,X,C){return h(this,void 0,void 0,(function*(){const l=this.createRoom(Q.room.name,X);l.roomId=Q.room.roomId,l.sessionId=Q.sessionId;const M={sessionId:l.sessionId};Q.reconnectionToken&&(M.reconnectionToken=Q.reconnectionToken);const O=C||l;return l.connect(this.buildEndpoint(Q.room,M),Q.devMode&&(()=>h(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${l.roomId}'...`);let C=0;const M=()=>h(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(Q,X,O),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${l.roomId}'`)}catch(h){C<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${C} out of 8)`),setTimeout(M,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(M,2e3)}))),O),new Promise(((Q,X)=>{const C=(Q,C)=>X(new f.ServerError(Q,C));O.onError.once(C),O.onJoin.once((()=>{O.onError.remove(C),Q(O)}))}))}))}createMatchMakeRequest(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;return h(this,void 0,void 0,(function*(){const h=(yield(0,M.post)(this.getHttpEndpoint(`${Q}/${X}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(h.error)throw new m(h.error,h.code);return"reconnect"===Q&&(h.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(h,l,f)}))}createRoom(Q,X){return new O.Room(Q,X)}buildEndpoint(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const h in X)X.hasOwnProperty(h)&&C.push(`${h}=${X[h]}`);let l=this.settings.secure?"wss://":"ws://";return Q.publicAddress?l+=`${Q.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${l}/${Q.processId}/${Q.roomId}?${C.join("&")}`}getHttpEndpoint(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${Q}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12325:(Q,X,C)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Connection=void 0;const l=C(12334);X.Connection=class{constructor(){this.events={},this.transport=new l.WebSocketTransport(this.events)}send(Q){this.transport.send(Q)}connect(Q){this.transport.connect(Q)}close(Q,X){this.transport.close(Q,X)}get isOpen(){return this.transport.isOpen}}},12344:(Q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.utf8Length=X.utf8Read=X.ErrorCode=X.Protocol=void 0,function(Q){Q[Q.HANDSHAKE=9]="HANDSHAKE",Q[Q.JOIN_ROOM=10]="JOIN_ROOM",Q[Q.ERROR=11]="ERROR",Q[Q.LEAVE_ROOM=12]="LEAVE_ROOM",Q[Q.ROOM_DATA=13]="ROOM_DATA",Q[Q.ROOM_STATE=14]="ROOM_STATE",Q[Q.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Q[Q.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Q[Q.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(X.Protocol||(X.Protocol={})),function(Q){Q[Q.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Q[Q.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Q[Q.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Q[Q.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Q[Q.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Q[Q.AUTH_FAILED=4215]="AUTH_FAILED",Q[Q.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(X.ErrorCode||(X.ErrorCode={})),X.utf8Read=function(Q,X){const C=Q[X++];for(var l="",h=0,M=X,f=X+C;M<f;M++){var O=Q[M];if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(h=(7&O)<<18|(63&Q[++M])<<12|(63&Q[++M])<<6|63&Q[++M])>=65536?(h-=65536,l+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):l+=String.fromCharCode(h)}else l+=String.fromCharCode((15&O)<<12|(63&Q[++M])<<6|63&Q[++M]);else l+=String.fromCharCode((31&O)<<6|63&Q[++M]);else l+=String.fromCharCode(O)}return l},X.utf8Length=function(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",X=0,C=0;for(let l=0,h=Q.length;l<h;l++)X=Q.charCodeAt(l),X<128?C+=1:X<2048?C+=2:X<55296||X>=57344?C+=3:(l++,C+=4);return C+1}},12313:function(Q,X,C){"use strict";var l=this&&this.__createBinding||(Object.create?function(Q,X,C,l){void 0===l&&(l=C);var h=Object.getOwnPropertyDescriptor(X,C);h&&!("get"in h?!X.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return X[C]}}),Object.defineProperty(Q,l,h)}:function(Q,X,C,l){void 0===l&&(l=C),Q[l]=X[C]}),h=this&&this.__setModuleDefault||(Object.create?function(Q,X){Object.defineProperty(Q,"default",{enumerable:!0,value:X})}:function(Q,X){Q.default=X}),M=this&&this.__importStar||function(Q){if(Q&&Q.__esModule)return Q;var X={};if(null!=Q)for(var C in Q)"default"!==C&&Object.prototype.hasOwnProperty.call(Q,C)&&l(X,Q,C);return h(X,Q),X};Object.defineProperty(X,"__esModule",{value:!0}),X.Room=void 0;const f=M(C(12318)),O=C(12325),m=C(12344),W=C(12353),U=C(12356),L=C(12365),w=C(12373),i=C(12309);class a{constructor(Q,X){this.onStateChange=(0,L.createSignal)(),this.onError=(0,L.createSignal)(),this.onLeave=(0,L.createSignal)(),this.onJoin=(0,L.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,U.createNanoEvents)(),this.roomId=null,this.name=Q,X&&(this.serializer=new((0,W.getSerializer)("schema")),this.rootSchema=X,this.serializer.state=new X),this.onError(((Q,X)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,`colyseus.js - onError => (${Q}) ${X}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const l=new O.Connection;C.connection=l,l.events.onmessage=a.prototype.onMessageCallback.bind(C),l.events.onclose=function(Q){var l;if(!C.hasJoined)return null===(l=console.warn)||void 0===l||l.call(console,`Room connection was closed unexpectedly (${Q.code}): ${Q.reason}`),void C.onError.invoke(Q.code,Q.reason);Q.code===i.CloseCode.DEVMODE_RESTART&&X?X():(C.onLeave.invoke(Q.code),C.destroy())},l.events.onerror=function(Q){var X;null===(X=console.warn)||void 0===X||X.call(console,`Room, onError (${Q.code}): ${Q.reason}`),C.onError.invoke(Q.code,Q.reason)},l.connect(Q)}leave(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((X=>{this.onLeave((Q=>X(Q))),this.connection?Q?this.connection.send([m.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(i.CloseCode.CONSENTED)}))}onMessage(Q,X){return this.onMessageHandlers.on(this.getMessageHandlerKey(Q),X)}send(Q,X){const C=[m.Protocol.ROOM_DATA];let l;if("string"===typeof Q?w.encode.string(C,Q):w.encode.number(C,Q),void 0!==X){const Q=f.encode(X);l=new Uint8Array(C.length+Q.byteLength),l.set(new Uint8Array(C),0),l.set(new Uint8Array(Q),C.length)}else l=new Uint8Array(C);this.connection.send(l.buffer)}sendBytes(Q,X){const C=[m.Protocol.ROOM_DATA_BYTES];let l;"string"===typeof Q?w.encode.string(C,Q):w.encode.number(C,Q),l=new Uint8Array(C.length+(X.byteLength||X.length)),l.set(new Uint8Array(C),0),l.set(new Uint8Array(X),C.length),this.connection.send(l.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Q){const X=Array.from(new Uint8Array(Q.data)),C=X[0];if(C===m.Protocol.JOIN_ROOM){let Q=1;const C=(0,m.utf8Read)(X,Q);if(Q+=(0,m.utf8Length)(C),this.serializerId=(0,m.utf8Read)(X,Q),Q+=(0,m.utf8Length)(this.serializerId),!this.serializer){const Q=(0,W.getSerializer)(this.serializerId);this.serializer=new Q}X.length>Q&&this.serializer.handshake&&this.serializer.handshake(X,{offset:Q}),this.reconnectionToken=`${this.roomId}:${C}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([m.Protocol.JOIN_ROOM])}else if(C===m.Protocol.ERROR){const Q={offset:1},C=w.decode.number(X,Q),l=w.decode.string(X,Q);this.onError.invoke(C,l)}else if(C===m.Protocol.LEAVE_ROOM)this.leave();else if(C===m.Protocol.ROOM_DATA_SCHEMA){const Q={offset:1},C=this.serializer.getState().constructor._context.get(w.decode.number(X,Q)),l=new C;l.decode(X,Q),this.dispatchMessage(C,l)}else if(C===m.Protocol.ROOM_STATE)X.shift(),this.setState(X);else if(C===m.Protocol.ROOM_STATE_PATCH)X.shift(),this.patch(X);else if(C===m.Protocol.ROOM_DATA){const C={offset:1},l=w.decode.stringCheck(X,C)?w.decode.string(X,C):w.decode.number(X,C),h=X.length>C.offset?f.decode(Q.data,C.offset):void 0;this.dispatchMessage(l,h)}else if(C===m.Protocol.ROOM_DATA_BYTES){const Q={offset:1},C=w.decode.stringCheck(X,Q)?w.decode.string(X,Q):w.decode.number(X,Q);this.dispatchMessage(C,new Uint8Array(X.slice(Q.offset)))}}setState(Q){this.serializer.setState(Q),this.onStateChange.invoke(this.serializer.getState())}patch(Q){this.serializer.patch(Q),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Q,X){var C;const l=this.getMessageHandlerKey(Q);this.onMessageHandlers.events[l]?this.onMessageHandlers.emit(l,X):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Q,X):null===(C=console.warn)||void 0===C||C.call(console,`colyseus.js: onMessage() not registered for type '${Q}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Q){switch(typeof Q){case"function":return`$${Q._typeid}`;case"string":return Q;case"number":return`i${Q}`;default:throw new Error("invalid message type.")}}}X.Room=a},12383:(Q,X)=>{"use strict";let C;function l(){return C||(C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(Q,X){this.cache[Q]=X},getItem:function(Q){this.cache[Q]},removeItem:function(Q){delete this.cache[Q]}}),C}Object.defineProperty(X,"__esModule",{value:!0}),X.getItem=X.removeItem=X.setItem=void 0,X.setItem=function(Q,X){l().setItem(Q,X)},X.removeItem=function(Q){l().removeItem(Q)},X.getItem=function(Q,X){const C=l().getItem(Q);"undefined"!==typeof Promise&&C instanceof Promise?C.then((Q=>X(Q))):X(C)}},12356:(Q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createNanoEvents=void 0;X.createNanoEvents=()=>({emit(Q){let X=this.events[Q]||[];for(var C=arguments.length,l=new Array(C>1?C-1:0),h=1;h<C;h++)l[h-1]=arguments[h];for(let M=0,f=X.length;M<f;M++)X[M](...l)},events:{},on(Q,X){var C;return(null===(C=this.events[Q])||void 0===C?void 0:C.push(X))||(this.events[Q]=[X]),()=>{var C;this.events[Q]=null===(C=this.events[Q])||void 0===C?void 0:C.filter((Q=>X!==Q))}}})},12365:(Q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createSignal=X.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(Q){return this.handlers.push(Q),this}invoke(){for(var Q=arguments.length,X=new Array(Q),C=0;C<Q;C++)X[C]=arguments[C];this.handlers.forEach((Q=>Q.apply(this,X)))}invokeAsync(){for(var Q=arguments.length,X=new Array(Q),C=0;C<Q;C++)X[C]=arguments[C];return Promise.all(this.handlers.map((Q=>Q.apply(this,X))))}remove(Q){const X=this.handlers.indexOf(Q);this.handlers[X]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}X.EventEmitter=C,X.createSignal=function(){const Q=new C;function X(X){return Q.register(X,null===this)}return X.once=X=>{const C=function(){for(var l=arguments.length,h=new Array(l),M=0;M<l;M++)h[M]=arguments[M];X.apply(this,h),Q.remove(C)};Q.register(C)},X.remove=X=>Q.remove(X),X.invoke=function(){return Q.invoke(...arguments)},X.invokeAsync=function(){return Q.invokeAsync(...arguments)},X.clear=()=>Q.clear(),X}},12309:(Q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ServerError=X.CloseCode=void 0,function(Q){Q[Q.CONSENTED=4e3]="CONSENTED",Q[Q.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(X.CloseCode||(X.CloseCode={}));class C extends Error{constructor(Q,X){super(X),this.name="ServerError",this.code=Q}}X.ServerError=C},12291:(Q,X,C)=>{"use strict";X.c=void 0,C(12293);var l=C(12296);Object.defineProperty(X,"c",{enumerable:!0,get:function(){return l.Client}});var h=C(12344);var M=C(12313);var f=C(12381);const O=C(12388);const m=C(12393),W=C(12353);(0,W.registerSerializer)("schema",O.SchemaSerializer),(0,W.registerSerializer)("none",m.NoneSerializer)},12293:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Q=>null!==Q&&"object"===typeof Q&&Q.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12318:(Q,X)=>{"use strict";function C(Q,X){if(this._offset=X,Q instanceof ArrayBuffer)this._buffer=Q,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Q))throw new Error("Invalid argument");this._buffer=Q.buffer,this._view=new DataView(this._buffer,Q.byteOffset,Q.byteLength)}}Object.defineProperty(X,"__esModule",{value:!0}),X.decode=X.encode=void 0,C.prototype._array=function(Q){for(var X=new Array(Q),C=0;C<Q;C++)X[C]=this._parse();return X},C.prototype._map=function(Q){for(var X={},C=0;C<Q;C++)X[this._parse()]=this._parse();return X},C.prototype._str=function(Q){var X=function(Q,X,C){for(var l="",h=0,M=X,f=X+C;M<f;M++){var O=Q.getUint8(M);if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(h=(7&O)<<18|(63&Q.getUint8(++M))<<12|(63&Q.getUint8(++M))<<6|63&Q.getUint8(++M))>=65536?(h-=65536,l+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):l+=String.fromCharCode(h)}else l+=String.fromCharCode((15&O)<<12|(63&Q.getUint8(++M))<<6|63&Q.getUint8(++M));else l+=String.fromCharCode((31&O)<<6|63&Q.getUint8(++M));else l+=String.fromCharCode(O)}return l}(this._view,this._offset,Q);return this._offset+=Q,X},C.prototype._bin=function(Q){var X=this._buffer.slice(this._offset,this._offset+Q);return this._offset+=Q,X},C.prototype._parse=function(){var Q,X=this._view.getUint8(this._offset++),C=0,l=0,h=0,M=0;if(X<192)return X<128?X:X<144?this._map(15&X):X<160?this._array(15&X):this._str(31&X);if(X>223)return-1*(255-X+1);switch(X){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),l=this._view.getInt8(this._offset+1),this._offset+=2,-1===l){var f=this._view.getUint32(this._offset);return h=this._view.getInt32(this._offset+4),M=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*h+M)+f/1e6)}return[l,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),l=this._view.getInt8(this._offset+2),this._offset+=3,[l,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),l=this._view.getInt8(this._offset+4),this._offset+=5,[l,this._bin(C)];case 202:return Q=this._view.getFloat32(this._offset),this._offset+=4,Q;case 203:return Q=this._view.getFloat64(this._offset),this._offset+=8,Q;case 204:return Q=this._view.getUint8(this._offset),this._offset+=1,Q;case 205:return Q=this._view.getUint16(this._offset),this._offset+=2,Q;case 206:return Q=this._view.getUint32(this._offset),this._offset+=4,Q;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,h+M;case 208:return Q=this._view.getInt8(this._offset),this._offset+=1,Q;case 209:return Q=this._view.getInt16(this._offset),this._offset+=2,Q;case 210:return Q=this._view.getInt32(this._offset),this._offset+=4,Q;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,h+M;case 212:return l=this._view.getInt8(this._offset),this._offset+=1,0===l?void(this._offset+=1):[l,this._bin(1)];case 213:return l=this._view.getInt8(this._offset),this._offset+=1,[l,this._bin(2)];case 214:return l=this._view.getInt8(this._offset),this._offset+=1,-1===l?(Q=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Q)):[l,this._bin(4)];case 215:return l=this._view.getInt8(this._offset),this._offset+=1,0===l?(h=this._view.getInt32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+M)):-1===l?(h=this._view.getUint32(this._offset),M=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&h)+M)+(h>>>2)/1e6)):[l,this._bin(8)];case 216:return l=this._view.getInt8(this._offset),this._offset+=1,[l,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},X.decode=function(Q){var X=new C(Q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),l=X._parse();if(X._offset!==Q.byteLength)throw new Error(Q.byteLength-X._offset+" trailing bytes");return l};function l(Q,X,C){for(var l=0,h=0,M=C.length;h<M;h++)(l=C.charCodeAt(h))<128?Q.setUint8(X++,l):l<2048?(Q.setUint8(X++,192|l>>6),Q.setUint8(X++,128|63&l)):l<55296||l>=57344?(Q.setUint8(X++,224|l>>12),Q.setUint8(X++,128|l>>6&63),Q.setUint8(X++,128|63&l)):(h++,l=65536+((1023&l)<<10|1023&C.charCodeAt(h)),Q.setUint8(X++,240|l>>18),Q.setUint8(X++,128|l>>12&63),Q.setUint8(X++,128|l>>6&63),Q.setUint8(X++,128|63&l))}function h(Q,X,C){var l=typeof C,M=0,f=0,O=0,m=0,W=0,U=0;if("string"===l){if(W=function(Q){for(var X=0,C=0,l=0,h=Q.length;l<h;l++)(X=Q.charCodeAt(l))<128?C+=1:X<2048?C+=2:X<55296||X>=57344?C+=3:(l++,C+=4);return C}(C),W<32)Q.push(160|W),U=1;else if(W<256)Q.push(217,W),U=2;else if(W<65536)Q.push(218,W>>8,W),U=3;else{if(!(W<4294967296))throw new Error("String too long");Q.push(219,W>>24,W>>16,W>>8,W),U=5}return X.push({_str:C,_length:W,_offset:Q.length}),U+W}if("number"===l)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(Q.push(C),1):C<256?(Q.push(204,C),2):C<65536?(Q.push(205,C>>8,C),3):C<4294967296?(Q.push(206,C>>24,C>>16,C>>8,C),5):(O=C/Math.pow(2,32)|0,m=C>>>0,Q.push(207,O>>24,O>>16,O>>8,O,m>>24,m>>16,m>>8,m),9):C>=-32?(Q.push(C),1):C>=-128?(Q.push(208,C),2):C>=-32768?(Q.push(209,C>>8,C),3):C>=-2147483648?(Q.push(210,C>>24,C>>16,C>>8,C),5):(O=Math.floor(C/Math.pow(2,32)),m=C>>>0,Q.push(211,O>>24,O>>16,O>>8,O,m>>24,m>>16,m>>8,m),9):(Q.push(203),X.push({_float:C,_length:8,_offset:Q.length}),9);if("object"===l){if(null===C)return Q.push(192),1;if(Array.isArray(C)){if((W=C.length)<16)Q.push(144|W),U=1;else if(W<65536)Q.push(220,W>>8,W),U=3;else{if(!(W<4294967296))throw new Error("Array too large");Q.push(221,W>>24,W>>16,W>>8,W),U=5}for(M=0;M<W;M++)U+=h(Q,X,C[M]);return U}if(C instanceof Date){var L=C.getTime(),w=Math.floor(L/1e3),i=1e6*(L-1e3*w);return w>=0&&i>=0&&w<=17179869183?0===i&&w<=4294967295?(Q.push(214,255,w>>24,w>>16,w>>8,w),6):(O=w/4294967296,m=4294967295&w,Q.push(215,255,i>>22,i>>14,i>>6,O,m>>24,m>>16,m>>8,m),10):(O=Math.floor(w/4294967296),m=w>>>0,Q.push(199,12,255,i>>24,i>>16,i>>8,i,O>>24,O>>16,O>>8,O,m>>24,m>>16,m>>8,m),15)}if(C instanceof ArrayBuffer){if((W=C.byteLength)<256)Q.push(196,W),U=2;else if(W<65536)Q.push(197,W>>8,W),U=3;else{if(!(W<4294967296))throw new Error("Buffer too large");Q.push(198,W>>24,W>>16,W>>8,W),U=5}return X.push({_bin:C,_length:W,_offset:Q.length}),U+W}if("function"===typeof C.toJSON)return h(Q,X,C.toJSON());var a=[],F="",s=Object.keys(C);for(M=0,f=s.length;M<f;M++)void 0!==C[F=s[M]]&&"function"!==typeof C[F]&&a.push(F);if((W=a.length)<16)Q.push(128|W),U=1;else if(W<65536)Q.push(222,W>>8,W),U=3;else{if(!(W<4294967296))throw new Error("Object too large");Q.push(223,W>>24,W>>16,W>>8,W),U=5}for(M=0;M<W;M++)U+=h(Q,X,F=a[M]),U+=h(Q,X,C[F]);return U}if("boolean"===l)return Q.push(C?195:194),1;if("undefined"===l)return Q.push(192),1;if("function"===typeof C.toJSON)return h(Q,X,C.toJSON());throw new Error("Could not encode")}X.encode=function(Q){var X=[],C=[],M=h(X,C,Q),f=new ArrayBuffer(M),O=new DataView(f),m=0,W=0,U=-1;C.length>0&&(U=C[0]._offset);for(var L,w=0,i=0,a=0,F=X.length;a<F;a++)if(O.setUint8(W+a,X[a]),a+1===U){if(w=(L=C[m])._length,i=W+U,L._bin)for(var s=new Uint8Array(L._bin),z=0;z<w;z++)O.setUint8(i+z,s[z]);else L._str?l(O,i,L._str):void 0!==L._float&&O.setFloat64(i,L._float);W+=w,C[++m]&&(U=C[m]._offset)}return f}},12393:(Q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NoneSerializer=void 0;X.NoneSerializer=class{setState(Q){}getState(){return null}patch(Q){}teardown(){}handshake(Q){}}},12388:(Q,X,C)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.SchemaSerializer=void 0;const l=C(12373);X.SchemaSerializer=class{setState(Q){return this.state.decode(Q)}getState(){return this.state}patch(Q){return this.state.decode(Q)}teardown(){var Q,X;null===(X=null===(Q=this.state)||void 0===Q?void 0:Q.$changes)||void 0===X||X.root.clearRefs()}handshake(Q,X){if(this.state){(new l.Reflection).decode(Q,X)}else this.state=l.Reflection.decode(Q,X)}}},12353:(Q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getSerializer=X.registerSerializer=void 0;const C={};X.registerSerializer=function(Q,X){C[Q]=X},X.getSerializer=function(Q){const X=C[Q];if(!X)throw new Error("missing serializer: "+Q);return X}},12334:function(Q,X,C){"use strict";var l=this&&this.__importDefault||function(Q){return Q&&Q.__esModule?Q:{default:Q}};Object.defineProperty(X,"__esModule",{value:!0}),X.WebSocketTransport=void 0;const h=l(C(12338)),M=globalThis.WebSocket||h.default;X.WebSocketTransport=class{constructor(Q){this.events=Q}send(Q){Q instanceof ArrayBuffer?this.ws.send(Q):Array.isArray(Q)&&this.ws.send(new Uint8Array(Q).buffer)}connect(Q){this.ws=new M(Q,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Q,X){this.ws.close(Q,X)}get isOpen(){return this.ws.readyState===M.OPEN}}},12338:Q=>{"use strict";Q.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12490:Q=>{"use strict";Q.exports=function(Q){for(var X=new Array(Q),C=0;C<Q;++C)X[C]=C;return X}},12499:Q=>{function X(Q){return!!Q.constructor&&"function"===typeof Q.constructor.isBuffer&&Q.constructor.isBuffer(Q)}Q.exports=function(Q){return null!=Q&&(X(Q)||function(Q){return"function"===typeof Q.readFloatLE&&"function"===typeof Q.slice&&X(Q.slice(0,0))}(Q)||!!Q._isBuffer)}},12484:(Q,X,C)=>{var l=C(12490),h=C(12499),M="undefined"!==typeof Float64Array;function f(Q,X){return Q[0]-X[0]}function O(){var Q,X=this.stride,C=new Array(X.length);for(Q=0;Q<C.length;++Q)C[Q]=[Math.abs(X[Q]),Q];C.sort(f);var l=new Array(C.length);for(Q=0;Q<l.length;++Q)l[Q]=C[Q][1];return l}function m(Q,X){var C=["View",X,"d",Q].join("");X<0&&(C="View_Nil"+Q);var h="generic"===Q;if(-1===X){var M="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+Q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(M)()}if(0===X){M="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+Q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",M)(W[Q][0])}M=["'use strict'"];var f=l(X),m=f.map((function(Q){return"i"+Q})),U="this.offset+"+f.map((function(Q){return"this.stride["+Q+"]*i"+Q})).join("+"),L=f.map((function(Q){return"b"+Q})).join(","),w=f.map((function(Q){return"c"+Q})).join(",");M.push("function "+C+"(a,"+L+","+w+",d){this.data=a","this.shape=["+L+"]","this.stride=["+w+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+Q+"'","proto.dimension="+X),M.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+f.map((function(Q){return"this.shape["+Q+"]"})).join("*"),"}})"),1===X?M.push("proto.order=[0]"):(M.push("Object.defineProperty(proto,'order',{get:"),X<4?(M.push("function "+C+"_order(){"),2===X?M.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&M.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):M.push("ORDER})")),M.push("proto.set=function "+C+"_set("+m.join(",")+",v){"),h?M.push("return this.data.set("+U+",v)}"):M.push("return this.data["+U+"]=v}"),M.push("proto.get=function "+C+"_get("+m.join(",")+"){"),h?M.push("return this.data.get("+U+")}"):M.push("return this.data["+U+"]}"),M.push("proto.index=function "+C+"_index(",m.join(),"){return "+U+"}"),M.push("proto.hi=function "+C+"_hi("+m.join(",")+"){return new "+C+"(this.data,"+f.map((function(Q){return["(typeof i",Q,"!=='number'||i",Q,"<0)?this.shape[",Q,"]:i",Q,"|0"].join("")})).join(",")+","+f.map((function(Q){return"this.stride["+Q+"]"})).join(",")+",this.offset)}");var i=f.map((function(Q){return"a"+Q+"=this.shape["+Q+"]"})),a=f.map((function(Q){return"c"+Q+"=this.stride["+Q+"]"}));M.push("proto.lo=function "+C+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+i.join(",")+","+a.join(","));for(var F=0;F<X;++F)M.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");M.push("return new "+C+"(this.data,"+f.map((function(Q){return"a"+Q})).join(",")+","+f.map((function(Q){return"c"+Q})).join(",")+",b)}"),M.push("proto.step=function "+C+"_step("+m.join(",")+"){var "+f.map((function(Q){return"a"+Q+"=this.shape["+Q+"]"})).join(",")+","+f.map((function(Q){return"b"+Q+"=this.stride["+Q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<X;++F)M.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");M.push("return new "+C+"(this.data,"+f.map((function(Q){return"a"+Q})).join(",")+","+f.map((function(Q){return"b"+Q})).join(",")+",c)}");var s=new Array(X),z=new Array(X);for(F=0;F<X;++F)s[F]="a[i"+F+"]",z[F]="b[i"+F+"]";M.push("proto.transpose=function "+C+"_transpose("+m+"){"+m.map((function(Q,X){return Q+"=("+Q+"===undefined?"+X+":"+Q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+s.join(",")+","+z.join(",")+",this.offset)}"),M.push("proto.pick=function "+C+"_pick("+m+"){var a=[],b=[],c=this.offset");for(F=0;F<X;++F)M.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return M.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),M.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+f.map((function(Q){return"shape["+Q+"]"})).join(",")+","+f.map((function(Q){return"stride["+Q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",M.join("\n"))(W[Q],O)}var W={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Q.exports=function(Q,X,C,l){if(void 0===Q)return(0,W.array[0])([]);"number"===typeof Q&&(Q=[Q]),void 0===X&&(X=[Q.length]);var f=X.length;if(void 0===C){C=new Array(f);for(var O=f-1,U=1;O>=0;--O)C[O]=U,U*=X[O]}if(void 0===l){l=0;for(O=0;O<f;++O)C[O]<0&&(l-=(X[O]-1)*C[O])}for(var L=function(Q){if(h(Q))return"buffer";if(M)switch(Object.prototype.toString.call(Q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Q)?"array":"generic"}(Q),w=W[L];w.length<=f+1;)w.push(m(L,w.length-1));return(0,w[f+1])(Q,X,C,l)}},13286:Q=>{var X;self,X=()=>(()=>{"use strict";var Q={d:(X,C)=>{for(var l in C)Q.o(C,l)&&!Q.o(X,l)&&Object.defineProperty(X,l,{enumerable:!0,get:C[l]})},o:(Q,X)=>Object.prototype.hasOwnProperty.call(Q,X)},X={};Q.d(X,{default:()=>Y});var C,l=function(Q,X){var C=X.x-Q.x,l=X.y-Q.y;return Math.sqrt(C*C+l*l)},h=function(Q){return Q*(Math.PI/180)},M=new Map,f=function(Q){M.has(Q)&&clearTimeout(M.get(Q)),M.set(Q,setTimeout(Q,100))},O=function(Q,X,C){for(var l,h=X.split(/[ ,]+/g),M=0;M<h.length;M+=1)l=h[M],Q.addEventListener?Q.addEventListener(l,C,!1):Q.attachEvent&&Q.attachEvent(l,C)},m=function(Q,X,C){for(var l,h=X.split(/[ ,]+/g),M=0;M<h.length;M+=1)l=h[M],Q.removeEventListener?Q.removeEventListener(l,C):Q.detachEvent&&Q.detachEvent(l,C)},W=function(Q){return Q.preventDefault(),Q.type.match(/^touch/)?Q.changedTouches:Q},U=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},L=function(Q,X){X.top||X.right||X.bottom||X.left?(Q.style.top=X.top,Q.style.right=X.right,Q.style.bottom=X.bottom,Q.style.left=X.left):(Q.style.left=X.x+"px",Q.style.top=X.y+"px")},w=function(Q,X,C){var l=i(Q);for(var h in l)if(l.hasOwnProperty(h))if("string"==typeof X)l[h]=X+" "+C;else{for(var M="",f=0,O=X.length;f<O;f+=1)M+=X[f]+" "+C+", ";l[h]=M.slice(0,-2)}return l},i=function(Q){var X={};return X[Q]="",["webkit","Moz","o"].forEach((function(C){X[C+Q.charAt(0).toUpperCase()+Q.slice(1)]=""})),X},a=function(Q,X){for(var C in X)X.hasOwnProperty(C)&&(Q[C]=X[C]);return Q},F=function(Q,X){if(Q.length)for(var C=0,l=Q.length;C<l;C+=1)X(Q[C]);else X(Q)},s="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,z=window.matchMedia("(any-hover: none)").matches,x=!!("ontouchstart"in window),r=!!window.PointerEvent,P=!!window.MSPointerEvent,j={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v={start:"mousedown",move:"mousemove",end:"mouseup"},Z={};function g(){}s&&!z?C=j:r?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:P?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:x?(C=j,Z=v):C=v,g.prototype.on=function(Q,X){var C,l=this,h=Q.split(/[ ,]+/g);l._handlers_=l._handlers_||{};for(var M=0;M<h.length;M+=1)C=h[M],l._handlers_[C]=l._handlers_[C]||[],l._handlers_[C].push(X);return l},g.prototype.off=function(Q,X){var C=this;return C._handlers_=C._handlers_||{},void 0===Q?C._handlers_={}:void 0===X?C._handlers_[Q]=null:C._handlers_[Q]&&C._handlers_[Q].indexOf(X)>=0&&C._handlers_[Q].splice(C._handlers_[Q].indexOf(X),1),C},g.prototype.trigger=function(Q,X){var C,l=this,h=Q.split(/[ ,]+/g);l._handlers_=l._handlers_||{};for(var M=0;M<h.length;M+=1)C=h[M],l._handlers_[C]&&l._handlers_[C].length&&l._handlers_[C].forEach((function(Q){Q.call(l,{type:C,target:l},X)}))},g.prototype.config=function(Q){var X=this;X.options=X.defaults||{},Q&&(X.options=function(Q,X){var C={};for(var l in Q)Q.hasOwnProperty(l)&&X.hasOwnProperty(l)?C[l]=X[l]:Q.hasOwnProperty(l)&&(C[l]=Q[l]);return C}(X.options,Q))},g.prototype.bindEvt=function(Q,X){var l=this;return l._domHandlers_=l._domHandlers_||{},l._domHandlers_[X]=function(){"function"==typeof l["on"+X]?l["on"+X].apply(l,arguments):console.warn('[WARNING] : Missing "on'+X+'" handler.')},O(Q,C[X],l._domHandlers_[X]),Z[X]&&O(Q,Z[X],l._domHandlers_[X]),l},g.prototype.unbindEvt=function(Q,X){var l=this;return l._domHandlers_=l._domHandlers_||{},m(Q,C[X],l._domHandlers_[X]),Z[X]&&m(Q,Z[X],l._domHandlers_[X]),delete l._domHandlers_[X],this};const S=g;function e(Q,X){return this.identifier=X.identifier,this.position=X.position,this.frontPosition=X.frontPosition,this.collection=Q,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(X),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=e.id,e.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}e.prototype=new S,e.constructor=e,e.id=0,e.prototype.buildEl=function(Q){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},e.prototype.stylize=function(){if(this.options.dataOnly)return this;var Q=this.options.fadeTime+"ms",X=function(){var Q=i("borderRadius");for(var X in Q)Q.hasOwnProperty(X)&&(Q[X]="50%");return Q}(),C=w("transition","opacity",Q),l={};return l.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},l.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},l.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},a(l.el,C),"circle"===this.options.shape&&a(l.back,X),a(l.front,X),this.applyStyles(l),this},e.prototype.applyStyles=function(Q){for(var X in this.ui)if(this.ui.hasOwnProperty(X))for(var C in Q[X])this.ui[X].style[C]=Q[X][C];return this},e.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},e.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},e.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},e.prototype.show=function(Q){var X=this;return X.options.dataOnly||(clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.addToDom(),X.restCallback(),setTimeout((function(){X.ui.el.style.opacity=1}),0),X.showTimeout=setTimeout((function(){X.trigger("shown",X.instance),"function"==typeof Q&&Q.call(this)}),X.options.fadeTime)),X},e.prototype.hide=function(Q){var X=this;if(X.options.dataOnly)return X;if(X.ui.el.style.opacity=X.options.restOpacity,clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.removeTimeout=setTimeout((function(){var C="dynamic"===X.options.mode?"none":"block";X.ui.el.style.display=C,"function"==typeof Q&&Q.call(X),X.trigger("hidden",X.instance)}),X.options.fadeTime),X.options.restJoystick){var C=X.options.restJoystick,l={};l.x=!0===C||!1!==C.x?0:X.instance.frontPosition.x,l.y=!0===C||!1!==C.y?0:X.instance.frontPosition.y,X.setPosition(Q,l)}return X},e.prototype.setPosition=function(Q,X){var C=this;C.frontPosition={x:X.x,y:X.y};var l=C.options.fadeTime+"ms",h={};h.front=w("transition",["transform"],l);var M={front:{}};M.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(h),C.applyStyles(M),C.restTimeout=setTimeout((function(){"function"==typeof Q&&Q.call(C),C.restCallback()}),C.options.fadeTime)},e.prototype.restCallback=function(){var Q=this,X={};X.front=w("transition","none",""),Q.applyStyles(X),Q.trigger("rested",Q.instance)},e.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},e.prototype.computeDirection=function(Q){var X,C,l,h=Q.angle.radian,M=Math.PI/4,f=Math.PI/2;if(h>M&&h<3*M&&!Q.lockX?X="up":h>-M&&h<=M&&!Q.lockY?X="left":h>3*-M&&h<=-M&&!Q.lockX?X="down":Q.lockY||(X="right"),Q.lockY||(C=h>-f&&h<f?"left":"right"),Q.lockX||(l=h>0?"up":"down"),Q.force>this.options.threshold){var O,m={};for(O in this.direction)this.direction.hasOwnProperty(O)&&(m[O]=this.direction[O]);var W={};for(O in this.direction={x:C,y:l,angle:X},Q.direction=this.direction,m)m[O]===this.direction[O]&&(W[O]=!0);if(W.x&&W.y&&W.angle)return Q;W.x&&W.y||this.trigger("plain",Q),W.x||this.trigger("plain:"+C,Q),W.y||this.trigger("plain:"+l,Q),W.angle||this.trigger("dir dir:"+X,Q)}else this.resetDirection();return Q};const k=e;function R(Q,X){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=Q,C.id=R.id,R.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(X),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var l=getComputedStyle(C.options.zone.parentElement);return l&&"flex"===l.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.Nl(),C.begin(),C.nipples}R.prototype=new S,R.constructor=R,R.id=0,R.prototype.prepareNipples=function(){var Q=this,X=Q.nipples;X.on=Q.on.bind(Q),X.off=Q.off.bind(Q),X.options=Q.options,X.destroy=Q.destroy.bind(Q),X.ids=Q.ids,X.id=Q.id,X.processOnMove=Q.processOnMove.bind(Q),X.processOnEnd=Q.processOnEnd.bind(Q),X.get=function(Q){if(void 0===Q)return X[0];for(var C=0,l=X.length;C<l;C+=1)if(X[C].identifier===Q)return X[C];return!1}},R.prototype.Nl=function(){var Q=this;Q.bindEvt(Q.options.zone,"start"),Q.options.zone.style.touchAction="none",Q.options.zone.style.msTouchAction="none"},R.prototype.begin=function(){var Q=this,X=Q.options;if("static"===X.mode){var C=Q.createNipple(X.position,Q.manager.getIdentifier());C.add(),Q.idles.push(C)}},R.prototype.createNipple=function(Q,X){var C=this,l=C.manager.scroll,h={},M=C.options,f=C.parentIsFlex?l.x:l.x+C.box.left,O=C.parentIsFlex?l.y:l.y+C.box.top;if(Q.x&&Q.y)h={x:Q.x-f,y:Q.y-O};else if(Q.top||Q.right||Q.bottom||Q.left){var m=document.createElement("DIV");m.style.display="hidden",m.style.top=Q.top,m.style.right=Q.right,m.style.bottom=Q.bottom,m.style.left=Q.left,m.style.position="absolute",M.zone.appendChild(m);var W=m.getBoundingClientRect();M.zone.removeChild(m),h=Q,Q={x:W.left+l.x,y:W.top+l.y}}var U=new k(C,{color:M.color,size:M.size,threshold:M.threshold,fadeTime:M.fadeTime,dataOnly:M.dataOnly,restJoystick:M.restJoystick,restOpacity:M.restOpacity,mode:M.mode,identifier:X,position:Q,zone:M.zone,frontPosition:{x:0,y:0},shape:M.shape});return M.dataOnly||(L(U.ui.el,h),L(U.ui.front,U.frontPosition)),C.nipples.push(U),C.trigger("added "+U.identifier+":added",U),C.manager.trigger("added "+U.identifier+":added",U),C.bindNipple(U),U},R.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},R.prototype.bindNipple=function(Q){var X,C=this,l=function(Q,l){X=Q.type+" "+l.id+":"+Q.type,C.trigger(X,l)};Q.on("destroyed",C.onDestroyed.bind(C)),Q.on("shown hidden rested dir plain",l),Q.on("dir:up dir:right dir:down dir:left",l),Q.on("plain:up plain:right plain:down plain:left",l)},R.prototype.pressureFn=function(Q,X,C){var l=this,h=0;clearInterval(l.pressureIntervals[C]),l.pressureIntervals[C]=setInterval(function(){var C=Q.force||Q.pressure||Q.webkitForce||0;C!==h&&(X.trigger("pressure",C),l.trigger("pressure "+X.identifier+":pressure",C),h=C)}.bind(l),100)},R.prototype.onstart=function(Q){var X=this,C=X.options,l=Q;return Q=W(Q),X.updateBox(),F(Q,(function(h){X.actives.length<C.maxNumberOfNipples?X.processOnStart(h):l.type.match(/^touch/)&&(Object.keys(X.manager.ids).forEach((function(C){if(Object.values(l.touches).findIndex((function(Q){return Q.identifier===C}))<0){var h=[Q[0]];h.identifier=C,X.processOnEnd(h)}})),X.actives.length<C.maxNumberOfNipples&&X.processOnStart(h))})),X.manager.bindDocument(),!1},R.prototype.processOnStart=function(Q){var X,C=this,h=C.options,M=C.manager.getIdentifier(Q),f=Q.force||Q.pressure||Q.webkitForce||0,O={x:Q.pageX,y:Q.pageY},m=C.getOrCreate(M,O);m.identifier!==M&&C.manager.removeIdentifier(m.identifier),m.identifier=M;var W=function(X){X.trigger("start",X),C.trigger("start "+X.id+":start",X),X.show(),f>0&&C.pressureFn(Q,X,X.identifier),C.processOnMove(Q)};if((X=C.idles.indexOf(m))>=0&&C.idles.splice(X,1),C.actives.push(m),C.ids.push(m.identifier),"semi"!==h.mode)W(m);else{if(!(l(O,m.position)<=h.catchDistance))return m.destroy(),void C.processOnStart(Q);W(m)}return m},R.prototype.getOrCreate=function(Q,X){var C,l=this,h=l.options;return/(semi|static)/.test(h.mode)?(C=l.idles[0])?(l.idles.splice(0,1),C):"semi"===h.mode?l.createNipple(X,Q):(console.warn("Coudln't find the needed nipple."),!1):C=l.createNipple(X,Q)},R.prototype.processOnMove=function(Q){var X=this,C=X.options,M=X.manager.getIdentifier(Q),f=X.nipples.get(M),O=X.manager.scroll;if(function(Q){return isNaN(Q.buttons)?0!==Q.pressure:0!==Q.buttons}(Q)){if(!f)return console.error("Found zombie joystick with ID "+M),void X.manager.removeIdentifier(M);if(C.dynamicPage){var m=f.el.getBoundingClientRect();f.position={x:O.x+m.left,y:O.y+m.top}}f.identifier=M;var W=f.options.size/2,U={x:Q.pageX,y:Q.pageY};C.lockX&&(U.y=f.position.y),C.lockY&&(U.x=f.position.x);var L,w,i,a,F,s,z,x,r,P,j=l(U,f.position),v=(L=U,i=(w=f.position).x-L.x,a=w.y-L.y,function(Q){return Q*(180/Math.PI)}(Math.atan2(a,i))),Z=h(v),g=j/W,S={distance:j,position:U};if("circle"===f.options.shape?(F=Math.min(j,W),z=f.position,x=F,P={x:0,y:0},r=h(r=v),P.x=z.x-x*Math.cos(r),P.y=z.y-x*Math.sin(r),s=P):(s=function(Q,X,C){return{x:Math.min(Math.max(Q.x,X.x-C),X.x+C),y:Math.min(Math.max(Q.y,X.y-C),X.y+C)}}(U,f.position,W),F=l(s,f.position)),C.follow){if(j>W){var e=U.x-s.x,k=U.y-s.y;f.position.x+=e,f.position.y+=k,f.el.style.top=f.position.y-(X.box.top+O.y)+"px",f.el.style.left=f.position.x-(X.box.left+O.x)+"px",j=l(U,f.position)}}else U=s,j=F;var R=U.x-f.position.x,H=U.y-f.position.y;f.frontPosition={x:R,y:H},C.dataOnly||(f.ui.front.style.transform="translate("+R+"px,"+H+"px)");var o={identifier:f.identifier,position:U,force:g,pressure:Q.force||Q.pressure||Q.webkitForce||0,distance:j,angle:{radian:Z,degree:v},vector:{x:R/W,y:-H/W},raw:S,instance:f,lockX:C.lockX,lockY:C.lockY};(o=f.computeDirection(o)).angle={radian:h(180-v),degree:180-v},f.trigger("move",o),X.trigger("move "+f.id+":move",o)}else this.processOnEnd(Q)},R.prototype.processOnEnd=function(Q){var X=this,C=X.options,l=X.manager.getIdentifier(Q),h=X.nipples.get(l),M=X.manager.removeIdentifier(h.identifier);h&&(C.dataOnly||h.hide((function(){"dynamic"===C.mode&&(h.trigger("removed",h),X.trigger("removed "+h.id+":removed",h),X.manager.trigger("removed "+h.id+":removed",h),h.destroy())})),clearInterval(X.pressureIntervals[h.identifier]),h.resetDirection(),h.trigger("end",h),X.trigger("end "+h.id+":end",h),X.ids.indexOf(h.identifier)>=0&&X.ids.splice(X.ids.indexOf(h.identifier),1),X.actives.indexOf(h)>=0&&X.actives.splice(X.actives.indexOf(h),1),/(semi|static)/.test(C.mode)?X.idles.push(h):X.nipples.indexOf(h)>=0&&X.nipples.splice(X.nipples.indexOf(h),1),X.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(X.manager.ids[M.id]=M.identifier))},R.prototype.onDestroyed=function(Q,X){var C=this;C.nipples.indexOf(X)>=0&&C.nipples.splice(C.nipples.indexOf(X),1),C.actives.indexOf(X)>=0&&C.actives.splice(C.actives.indexOf(X),1),C.idles.indexOf(X)>=0&&C.idles.splice(C.idles.indexOf(X),1),C.ids.indexOf(X.identifier)>=0&&C.ids.splice(C.ids.indexOf(X.identifier),1),C.manager.removeIdentifier(X.identifier),C.manager.unbindDocument()},R.prototype.destroy=function(){var Q=this;for(var X in Q.unbindEvt(Q.options.zone,"start"),Q.nipples.forEach((function(Q){Q.destroy()})),Q.pressureIntervals)Q.pressureIntervals.hasOwnProperty(X)&&clearInterval(Q.pressureIntervals[X]);Q.trigger("destroyed",Q.nipples),Q.manager.unbindDocument(),Q.off()};const H=R;function o(Q){var X=this;X.ids={},X.index=0,X.collections=[],X.scroll=U(),X.config(Q),X.prepareCollections();var C=function(){var Q;X.collections.forEach((function(C){C.forEach((function(C){Q=C.el.getBoundingClientRect(),C.position={x:X.scroll.x+Q.left,y:X.scroll.y+Q.top}}))}))};O(window,"resize",(function(){f(C)}));var l=function(){X.scroll=U()};return O(window,"scroll",(function(){f(l)})),X.collections}o.prototype=new S,o.constructor=o,o.prototype.prepareCollections=function(){var Q=this;Q.collections.create=Q.create.bind(Q),Q.collections.on=Q.on.bind(Q),Q.collections.off=Q.off.bind(Q),Q.collections.destroy=Q.destroy.bind(Q),Q.collections.get=function(X){var C;return Q.collections.every((function(Q){return!(C=Q.get(X))})),C}},o.prototype.create=function(Q){return this.createCollection(Q)},o.prototype.createCollection=function(Q){var X=this,C=new H(X,Q);return X.bindCollection(C),X.collections.push(C),C},o.prototype.bindCollection=function(Q){var X,C=this,l=function(Q,l){X=Q.type+" "+l.id+":"+Q.type,C.trigger(X,l)};Q.on("destroyed",C.onDestroyed.bind(C)),Q.on("shown hidden rested dir plain",l),Q.on("dir:up dir:right dir:down dir:left",l),Q.on("plain:up plain:right plain:down plain:left",l)},o.prototype.bindDocument=function(){var Q=this;Q.binded||(Q.bindEvt(document,"move").bindEvt(document,"end"),Q.binded=!0)},o.prototype.unbindDocument=function(Q){var X=this;Object.keys(X.ids).length&&!0!==Q||(X.unbindEvt(document,"move").unbindEvt(document,"end"),X.binded=!1)},o.prototype.getIdentifier=function(Q){var X;return Q?void 0===(X=void 0===Q.identifier?Q.pointerId:Q.identifier)&&(X=this.latest||0):X=this.index,void 0===this.ids[X]&&(this.ids[X]=this.index,this.index+=1),this.latest=X,this.ids[X]},o.prototype.removeIdentifier=function(Q){var X={};for(var C in this.ids)if(this.ids[C]===Q){X.id=C,X.identifier=this.ids[C],delete this.ids[C];break}return X},o.prototype.onmove=function(Q){return this.onAny("move",Q),!1},o.prototype.onend=function(Q){return this.onAny("end",Q),!1},o.prototype.oncancel=function(Q){return this.onAny("end",Q),!1},o.prototype.onAny=function(Q,X){var C,l=this,h="processOn"+Q.charAt(0).toUpperCase()+Q.slice(1);X=W(X);var M=function(Q,X,C){C.ids.indexOf(X)>=0&&(C[h](Q),Q._found_=!0)};return F(X,(function(Q){C=l.getIdentifier(Q),F(l.collections,M.bind(null,Q,C)),Q._found_||l.removeIdentifier(C)})),!1},o.prototype.destroy=function(){var Q=this;Q.unbindDocument(!0),Q.ids={},Q.index=0,Q.collections.forEach((function(Q){Q.destroy()})),Q.off()},o.prototype.onDestroyed=function(Q,X){var C=this;if(C.collections.indexOf(X)<0)return!1;C.collections.splice(C.collections.indexOf(X),1)};var T=new o;const Y={create:function(Q){return T.create(Q)},factory:T};return X.default})(),Q.exports=X()},12509:(Q,X,C)=>{"use strict";const{Deflate:l,deflate:h,deflateRaw:M,gzip:f}=C(12515),{Inflate:O,inflate:m,inflateRaw:W,ungzip:U}=C(12569),L=C(12547);Q.exports.Deflate=l,Q.exports.deflate=h,Q.exports.deflateRaw=M,Q.exports.gzip=f,Q.exports.Inflate=O,Q.exports.inflate=m,Q.exports.inflateRaw=W,Q.exports.ungzip=U,Q.exports.constants=L},12515:(Q,X,C)=>{"use strict";const l=C(12517),h=C(12555),M=C(12561),f=C(12540),O=C(12564),m=Object.prototype.toString,{Z_NO_FLUSH:W,Z_SYNC_FLUSH:U,Z_FULL_FLUSH:L,Z_FINISH:w,Z_OK:i,Z_STREAM_END:a,Z_DEFAULT_COMPRESSION:F,Z_DEFAULT_STRATEGY:s,Z_DEFLATED:z}=C(12547);function x(Q){this.options=h.assign({level:F,method:z,Ja:16384,windowBits:15,memLevel:8,strategy:s},Q||{});let X=this.options;X.raw&&X.windowBits>0?X.windowBits=-X.windowBits:X.gzip&&X.windowBits>0&&X.windowBits<16&&(X.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let C=l.deflateInit2(this.strm,X.level,X.method,X.windowBits,X.memLevel,X.strategy);if(C!==i)throw new Error(f[C]);if(X.header&&l.deflateSetHeader(this.strm,X.header),X.dictionary){let Q;if(Q="string"===typeof X.dictionary?M.string2buf(X.dictionary):"[object ArrayBuffer]"===m.call(X.dictionary)?new Uint8Array(X.dictionary):X.dictionary,C=l.deflateSetDictionary(this.strm,Q),C!==i)throw new Error(f[C]);this._dict_set=!0}}function r(Q,X){const C=new x(X);if(C.push(Q,!0),C.err)throw C.msg||f[C.err];return C.result}x.prototype.push=function(Q,X){const C=this.strm,h=this.options.Ja;let f,O;if(this.ended)return!1;for(O=X===~~X?X:!0===X?w:W,"string"===typeof Q?C.input=M.string2buf(Q):"[object ArrayBuffer]"===m.call(Q)?C.input=new Uint8Array(Q):C.input=Q,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(h),C.next_out=0,C.avail_out=h),(O===U||O===L)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(f=l.deflate(C,O),f===a)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),f=l.deflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===i;if(0!==C.avail_out){if(O>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},x.prototype.onData=function(Q){this.chunks.push(Q)},x.prototype.onEnd=function(Q){Q===i&&(this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=Q,this.msg=this.strm.msg},Q.exports.Deflate=x,Q.exports.deflate=r,Q.exports.deflateRaw=function(Q,X){return(X=X||{}).raw=!0,r(Q,X)},Q.exports.gzip=function(Q,X){return(X=X||{}).gzip=!0,r(Q,X)},Q.exports.constants=C(12547)},12569:(Q,X,C)=>{"use strict";const l=C(12571),h=C(12555),M=C(12561),f=C(12540),O=C(12564),m=C(12582),W=Object.prototype.toString,{Z_NO_FLUSH:U,Z_FINISH:L,Z_OK:w,Z_STREAM_END:i,Z_NEED_DICT:a,Z_STREAM_ERROR:F,Z_DATA_ERROR:s,Z_MEM_ERROR:z}=C(12547);function x(Q){this.options=h.assign({Ja:65536,windowBits:15,to:""},Q||{});const X=this.options;X.raw&&X.windowBits>=0&&X.windowBits<16&&(X.windowBits=-X.windowBits,0===X.windowBits&&(X.windowBits=-15)),!(X.windowBits>=0&&X.windowBits<16)||Q&&Q.windowBits||(X.windowBits+=32),X.windowBits>15&&X.windowBits<48&&0===(15&X.windowBits)&&(X.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let C=l.inflateInit2(this.strm,X.windowBits);if(C!==w)throw new Error(f[C]);if(this.header=new m,l.inflateGetHeader(this.strm,this.header),X.dictionary&&("string"===typeof X.dictionary?X.dictionary=M.string2buf(X.dictionary):"[object ArrayBuffer]"===W.call(X.dictionary)&&(X.dictionary=new Uint8Array(X.dictionary)),X.raw&&(C=l.inflateSetDictionary(this.strm,X.dictionary),C!==w)))throw new Error(f[C])}function r(Q,X){const C=new x(X);if(C.push(Q),C.err)throw C.msg||f[C.err];return C.result}x.prototype.push=function(Q,X){const C=this.strm,h=this.options.Ja,f=this.options.dictionary;let O,m,x;if(this.ended)return!1;for(m=X===~~X?X:!0===X?L:U,"[object ArrayBuffer]"===W.call(Q)?C.input=new Uint8Array(Q):C.input=Q,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(h),C.next_out=0,C.avail_out=h),O=l.inflate(C,m),O===a&&f&&(O=l.inflateSetDictionary(C,f),O===w?O=l.inflate(C,m):O===s&&(O=a));C.avail_in>0&&O===i&&C.state.wrap>0&&0!==Q[C.next_in];)l.inflateReset(C),O=l.inflate(C,m);switch(O){case F:case s:case a:case z:return this.onEnd(O),this.ended=!0,!1}if(x=C.avail_out,C.next_out&&(0===C.avail_out||O===i))if("string"===this.options.to){let Q=M.utf8border(C.output,C.next_out),X=C.next_out-Q,l=M.buf2string(C.output,Q);C.next_out=X,C.avail_out=h-X,X&&C.output.set(C.output.subarray(Q,Q+X),0),this.onData(l)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(O!==w||0!==x){if(O===i)return O=l.inflateEnd(this.strm),this.onEnd(O),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},x.prototype.onData=function(Q){this.chunks.push(Q)},x.prototype.onEnd=function(Q){Q===w&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=Q,this.msg=this.strm.msg},Q.exports.Inflate=x,Q.exports.inflate=r,Q.exports.inflateRaw=function(Q,X){return(X=X||{}).raw=!0,r(Q,X)},Q.exports.ungzip=r,Q.exports.constants=C(12547)},12555:Q=>{"use strict";const X=(Q,X)=>Object.prototype.hasOwnProperty.call(Q,X);Q.exports.assign=function(Q){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const l=C.shift();if(l){if("object"!==typeof l)throw new TypeError(l+"must be non-object");for(const C in l)X(l,C)&&(Q[C]=l[C])}}return Q},Q.exports.flattenChunks=Q=>{let X=0;for(let l=0,h=Q.length;l<h;l++)X+=Q[l].length;const C=new Uint8Array(X);for(let l=0,h=0,M=Q.length;l<M;l++){let X=Q[l];C.set(X,h),h+=X.length}return C}},12561:Q=>{"use strict";let X=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){X=!1}const C=new Uint8Array(256);for(let h=0;h<256;h++)C[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;C[254]=C[254]=1,Q.exports.string2buf=Q=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Q);let X,C,l,h,M,f=Q.length,O=0;for(h=0;h<f;h++)C=Q.charCodeAt(h),55296===(64512&C)&&h+1<f&&(l=Q.charCodeAt(h+1),56320===(64512&l)&&(C=65536+(C-55296<<10)+(l-56320),h++)),O+=C<128?1:C<2048?2:C<65536?3:4;for(X=new Uint8Array(O),M=0,h=0;M<O;h++)C=Q.charCodeAt(h),55296===(64512&C)&&h+1<f&&(l=Q.charCodeAt(h+1),56320===(64512&l)&&(C=65536+(C-55296<<10)+(l-56320),h++)),C<128?X[M++]=C:C<2048?(X[M++]=192|C>>>6,X[M++]=128|63&C):C<65536?(X[M++]=224|C>>>12,X[M++]=128|C>>>6&63,X[M++]=128|63&C):(X[M++]=240|C>>>18,X[M++]=128|C>>>12&63,X[M++]=128|C>>>6&63,X[M++]=128|63&C);return X};Q.exports.buf2string=(Q,l)=>{const h=l||Q.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Q.subarray(0,l));let M,f;const O=new Array(2*h);for(f=0,M=0;M<h;){let X=Q[M++];if(X<128){O[f++]=X;continue}let l=C[X];if(l>4)O[f++]=65533,M+=l-1;else{for(X&=2===l?31:3===l?15:7;l>1&&M<h;)X=X<<6|63&Q[M++],l--;l>1?O[f++]=65533:X<65536?O[f++]=X:(X-=65536,O[f++]=55296|X>>10&1023,O[f++]=56320|1023&X)}}return((Q,C)=>{if(C<65534&&Q.subarray&&X)return String.fromCharCode.apply(null,Q.length===C?Q:Q.subarray(0,C));let l="";for(let X=0;X<C;X++)l+=String.fromCharCode(Q[X]);return l})(O,f)},Q.exports.utf8border=(Q,X)=>{(X=X||Q.length)>Q.length&&(X=Q.length);let l=X-1;for(;l>=0&&128===(192&Q[l]);)l--;return l<0||0===l?X:l+C[Q[l]]>X?l:X}},12529:Q=>{"use strict";Q.exports=(Q,X,C,l)=>{let h=65535&Q,M=Q>>>16&65535,f=0;for(;0!==C;){f=C>2e3?2e3:C,C-=f;do{h=h+X[l++]|0,M=M+h|0}while(--f);h%=65521,M%=65521}return h|M<<16}},12547:Q=>{"use strict";Q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12533:Q=>{"use strict";const X=new Uint32Array((()=>{let Q,X=[];for(var C=0;C<256;C++){Q=C;for(var l=0;l<8;l++)Q=1&Q?3988292384^Q>>>1:Q>>>1;X[C]=Q}return X})());Q.exports=(Q,C,l,h)=>{const M=X,f=h+l;Q^=-1;for(let X=h;X<f;X++)Q=Q>>>8^M[255&(Q^C[X])];return~Q}},12517:(Q,X,C)=>{"use strict";const{_tr_init:l,_tr_stored_block:h,_tr_flush_block:M,_tr_tally:f,_tr_align:O}=C(12523),m=C(12529),W=C(12533),U=C(12540),{Z_NO_FLUSH:L,Z_PARTIAL_FLUSH:w,Z_FULL_FLUSH:i,Z_FINISH:a,Z_BLOCK:F,Z_OK:s,Z_STREAM_END:z,Z_STREAM_ERROR:x,Z_DATA_ERROR:r,Z_BUF_ERROR:P,Z_DEFAULT_COMPRESSION:j,Z_FILTERED:v,Z_HUFFMAN_ONLY:Z,Z_RLE:g,Z_FIXED:S,Z_DEFAULT_STRATEGY:e,Z_UNKNOWN:k,Z_DEFLATED:R}=C(12547),H=258,o=262,T=103,Y=113,J=666,K=(Q,X)=>(Q.msg=U[X],X),N=Q=>(Q<<1)-(Q>4?9:0),q=Q=>{let X=Q.length;for(;--X>=0;)Q[X]=0};let n=(Q,X,C)=>(X<<Q.hash_shift^C)&Q.hash_mask;const c=Q=>{const X=Q.state;let C=X.pending;C>Q.avail_out&&(C=Q.avail_out),0!==C&&(Q.output.set(X.pending_buf.subarray(X.pending_out,X.pending_out+C),Q.next_out),Q.next_out+=C,X.pending_out+=C,Q.total_out+=C,Q.avail_out-=C,X.pending-=C,0===X.pending&&(X.pending_out=0))},E=(Q,X)=>{M(Q,Q.block_start>=0?Q.block_start:-1,Q.strstart-Q.block_start,X),Q.block_start=Q.strstart,c(Q.strm)},B=(Q,X)=>{Q.pending_buf[Q.pending++]=X},G=(Q,X)=>{Q.pending_buf[Q.pending++]=X>>>8&255,Q.pending_buf[Q.pending++]=255&X},b=(Q,X,C,l)=>{let h=Q.avail_in;return h>l&&(h=l),0===h?0:(Q.avail_in-=h,X.set(Q.input.subarray(Q.next_in,Q.next_in+h),C),1===Q.state.wrap?Q.adler=m(Q.adler,X,h,C):2===Q.state.wrap&&(Q.adler=W(Q.adler,X,h,C)),Q.next_in+=h,Q.total_in+=h,h)},p=(Q,X)=>{let C,l,h=Q.max_chain_length,M=Q.strstart,f=Q.prev_length,O=Q.nice_match;const m=Q.strstart>Q.w_size-o?Q.strstart-(Q.w_size-o):0,W=Q.window,U=Q.w_mask,L=Q.prev,w=Q.strstart+H;let i=W[M+f-1],a=W[M+f];Q.prev_length>=Q.good_match&&(h>>=2),O>Q.lookahead&&(O=Q.lookahead);do{if(C=X,W[C+f]===a&&W[C+f-1]===i&&W[C]===W[M]&&W[++C]===W[M+1]){M+=2,C++;do{}while(W[++M]===W[++C]&&W[++M]===W[++C]&&W[++M]===W[++C]&&W[++M]===W[++C]&&W[++M]===W[++C]&&W[++M]===W[++C]&&W[++M]===W[++C]&&W[++M]===W[++C]&&M<w);if(l=H-(w-M),M=w-H,l>f){if(Q.match_start=X,f=l,l>=O)break;i=W[M+f-1],a=W[M+f]}}}while((X=L[X&U])>m&&0!==--h);return f<=Q.lookahead?f:Q.lookahead},I=Q=>{const X=Q.w_size;let C,l,h,M,f;do{if(M=Q.window_size-Q.lookahead-Q.strstart,Q.strstart>=X+(X-o)){Q.window.set(Q.window.subarray(X,X+X),0),Q.match_start-=X,Q.strstart-=X,Q.block_start-=X,l=Q.hash_size,C=l;do{h=Q.head[--C],Q.head[C]=h>=X?h-X:0}while(--l);l=X,C=l;do{h=Q.prev[--C],Q.prev[C]=h>=X?h-X:0}while(--l);M+=X}if(0===Q.strm.avail_in)break;if(l=b(Q.strm,Q.window,Q.strstart+Q.lookahead,M),Q.lookahead+=l,Q.lookahead+Q.insert>=3)for(f=Q.strstart-Q.insert,Q.ins_h=Q.window[f],Q.ins_h=n(Q,Q.ins_h,Q.window[f+1]);Q.insert&&(Q.ins_h=n(Q,Q.ins_h,Q.window[f+3-1]),Q.prev[f&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=f,f++,Q.insert--,!(Q.lookahead+Q.insert<3)););}while(Q.lookahead<o&&0!==Q.strm.avail_in)},t=(Q,X)=>{let C,l;for(;;){if(Q.lookahead<o){if(I(Q),Q.lookahead<o&&X===L)return 1;if(0===Q.lookahead)break}if(C=0,Q.lookahead>=3&&(Q.ins_h=n(Q,Q.ins_h,Q.window[Q.strstart+3-1]),C=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart),0!==C&&Q.strstart-C<=Q.w_size-o&&(Q.match_length=p(Q,C)),Q.match_length>=3)if(l=f(Q,Q.strstart-Q.match_start,Q.match_length-3),Q.lookahead-=Q.match_length,Q.match_length<=Q.max_lazy_match&&Q.lookahead>=3){Q.match_length--;do{Q.strstart++,Q.ins_h=n(Q,Q.ins_h,Q.window[Q.strstart+3-1]),C=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart}while(0!==--Q.match_length);Q.strstart++}else Q.strstart+=Q.match_length,Q.match_length=0,Q.ins_h=Q.window[Q.strstart],Q.ins_h=n(Q,Q.ins_h,Q.window[Q.strstart+1]);else l=f(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++;if(l&&(E(Q,!1),0===Q.strm.avail_out))return 1}return Q.insert=Q.strstart<2?Q.strstart:2,X===a?(E(Q,!0),0===Q.strm.avail_out?3:4):Q.last_lit&&(E(Q,!1),0===Q.strm.avail_out)?1:2},y=(Q,X)=>{let C,l,h;for(;;){if(Q.lookahead<o){if(I(Q),Q.lookahead<o&&X===L)return 1;if(0===Q.lookahead)break}if(C=0,Q.lookahead>=3&&(Q.ins_h=n(Q,Q.ins_h,Q.window[Q.strstart+3-1]),C=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart),Q.prev_length=Q.match_length,Q.prev_match=Q.match_start,Q.match_length=2,0!==C&&Q.prev_length<Q.max_lazy_match&&Q.strstart-C<=Q.w_size-o&&(Q.match_length=p(Q,C),Q.match_length<=5&&(Q.strategy===v||3===Q.match_length&&Q.strstart-Q.match_start>4096)&&(Q.match_length=2)),Q.prev_length>=3&&Q.match_length<=Q.prev_length){h=Q.strstart+Q.lookahead-3,l=f(Q,Q.strstart-1-Q.prev_match,Q.prev_length-3),Q.lookahead-=Q.prev_length-1,Q.prev_length-=2;do{++Q.strstart<=h&&(Q.ins_h=n(Q,Q.ins_h,Q.window[Q.strstart+3-1]),C=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart)}while(0!==--Q.prev_length);if(Q.match_available=0,Q.match_length=2,Q.strstart++,l&&(E(Q,!1),0===Q.strm.avail_out))return 1}else if(Q.match_available){if(l=f(Q,0,Q.window[Q.strstart-1]),l&&E(Q,!1),Q.strstart++,Q.lookahead--,0===Q.strm.avail_out)return 1}else Q.match_available=1,Q.strstart++,Q.lookahead--}return Q.match_available&&(l=f(Q,0,Q.window[Q.strstart-1]),Q.match_available=0),Q.insert=Q.strstart<2?Q.strstart:2,X===a?(E(Q,!0),0===Q.strm.avail_out?3:4):Q.last_lit&&(E(Q,!1),0===Q.strm.avail_out)?1:2};function A(Q,X,C,l,h){this.good_length=Q,this.max_lazy=X,this.nice_length=C,this.max_chain=l,this.func=h}const D=[new A(0,0,0,0,((Q,X)=>{let C=65535;for(C>Q.pending_buf_size-5&&(C=Q.pending_buf_size-5);;){if(Q.lookahead<=1){if(I(Q),0===Q.lookahead&&X===L)return 1;if(0===Q.lookahead)break}Q.strstart+=Q.lookahead,Q.lookahead=0;const l=Q.block_start+C;if((0===Q.strstart||Q.strstart>=l)&&(Q.lookahead=Q.strstart-l,Q.strstart=l,E(Q,!1),0===Q.strm.avail_out))return 1;if(Q.strstart-Q.block_start>=Q.w_size-o&&(E(Q,!1),0===Q.strm.avail_out))return 1}return Q.insert=0,X===a?(E(Q,!0),0===Q.strm.avail_out?3:4):(Q.strstart>Q.block_start&&(E(Q,!1),Q.strm.avail_out),1)})),new A(4,4,8,4,t),new A(4,5,16,8,t),new A(4,6,32,32,t),new A(4,4,16,16,y),new A(8,16,32,32,y),new A(8,16,128,128,y),new A(8,32,128,256,y),new A(32,128,258,1024,y),new A(32,258,258,4096,y)];function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const V=Q=>{if(!Q||!Q.state)return K(Q,x);Q.total_in=Q.total_out=0,Q.data_type=k;const X=Q.state;return X.pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?42:Y,Q.adler=2===X.wrap?0:1,X.last_flush=L,l(X),s},d=Q=>{const X=V(Q);var C;return X===s&&((C=Q.state).window_size=2*C.w_size,q(C.head),C.max_lazy_match=D[C.level].max_lazy,C.good_match=D[C.level].good_length,C.nice_match=D[C.level].nice_length,C.max_chain_length=D[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),X},QQ=(Q,X,C,l,h,M)=>{if(!Q)return x;let f=1;if(X===j&&(X=6),l<0?(f=0,l=-l):l>15&&(f=2,l-=16),h<1||h>9||C!==R||l<8||l>15||X<0||X>9||M<0||M>S)return K(Q,x);8===l&&(l=9);const O=new u;return Q.state=O,O.strm=Q,O.wrap=f,O.gzhead=null,O.w_bits=l,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=h+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+3-1)/3),O.window=new Uint8Array(2*O.w_size),O.head=new Uint16Array(O.hash_size),O.prev=new Uint16Array(O.w_size),O.lit_bufsize=1<<h+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new Uint8Array(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=X,O.strategy=M,O.method=C,d(Q)};Q.exports.deflateInit=(Q,X)=>QQ(Q,X,R,15,8,e),Q.exports.deflateInit2=QQ,Q.exports.deflateReset=d,Q.exports.deflateResetKeep=V,Q.exports.deflateSetHeader=(Q,X)=>Q&&Q.state?2!==Q.state.wrap?x:(Q.state.gzhead=X,s):x,Q.exports.deflate=(Q,X)=>{let C,l;if(!Q||!Q.state||X>F||X<0)return Q?K(Q,x):x;const M=Q.state;if(!Q.output||!Q.input&&0!==Q.avail_in||M.status===J&&X!==a)return K(Q,0===Q.avail_out?P:x);M.strm=Q;const m=M.last_flush;if(M.last_flush=X,42===M.status)if(2===M.wrap)Q.adler=0,B(M,31),B(M,139),B(M,8),M.gzhead?(B(M,(M.gzhead.text?1:0)+(M.gzhead.hcrc?2:0)+(M.gzhead.extra?4:0)+(M.gzhead.name?8:0)+(M.gzhead.comment?16:0)),B(M,255&M.gzhead.time),B(M,M.gzhead.time>>8&255),B(M,M.gzhead.time>>16&255),B(M,M.gzhead.time>>24&255),B(M,9===M.level?2:M.strategy>=Z||M.level<2?4:0),B(M,255&M.gzhead.os),M.gzhead.extra&&M.gzhead.extra.length&&(B(M,255&M.gzhead.extra.length),B(M,M.gzhead.extra.length>>8&255)),M.gzhead.hcrc&&(Q.adler=W(Q.adler,M.pending_buf,M.pending,0)),M.gzindex=0,M.status=69):(B(M,0),B(M,0),B(M,0),B(M,0),B(M,0),B(M,9===M.level?2:M.strategy>=Z||M.level<2?4:0),B(M,3),M.status=Y);else{let X=R+(M.w_bits-8<<4)<<8,C=-1;C=M.strategy>=Z||M.level<2?0:M.level<6?1:6===M.level?2:3,X|=C<<6,0!==M.strstart&&(X|=32),X+=31-X%31,M.status=Y,G(M,X),0!==M.strstart&&(G(M,Q.adler>>>16),G(M,65535&Q.adler)),Q.adler=1}if(69===M.status)if(M.gzhead.extra){for(C=M.pending;M.gzindex<(65535&M.gzhead.extra.length)&&(M.pending!==M.pending_buf_size||(M.gzhead.hcrc&&M.pending>C&&(Q.adler=W(Q.adler,M.pending_buf,M.pending-C,C)),c(Q),C=M.pending,M.pending!==M.pending_buf_size));)B(M,255&M.gzhead.extra[M.gzindex]),M.gzindex++;M.gzhead.hcrc&&M.pending>C&&(Q.adler=W(Q.adler,M.pending_buf,M.pending-C,C)),M.gzindex===M.gzhead.extra.length&&(M.gzindex=0,M.status=73)}else M.status=73;if(73===M.status)if(M.gzhead.name){C=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>C&&(Q.adler=W(Q.adler,M.pending_buf,M.pending-C,C)),c(Q),C=M.pending,M.pending===M.pending_buf_size)){l=1;break}l=M.gzindex<M.gzhead.name.length?255&M.gzhead.name.charCodeAt(M.gzindex++):0,B(M,l)}while(0!==l);M.gzhead.hcrc&&M.pending>C&&(Q.adler=W(Q.adler,M.pending_buf,M.pending-C,C)),0===l&&(M.gzindex=0,M.status=91)}else M.status=91;if(91===M.status)if(M.gzhead.comment){C=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>C&&(Q.adler=W(Q.adler,M.pending_buf,M.pending-C,C)),c(Q),C=M.pending,M.pending===M.pending_buf_size)){l=1;break}l=M.gzindex<M.gzhead.comment.length?255&M.gzhead.comment.charCodeAt(M.gzindex++):0,B(M,l)}while(0!==l);M.gzhead.hcrc&&M.pending>C&&(Q.adler=W(Q.adler,M.pending_buf,M.pending-C,C)),0===l&&(M.status=T)}else M.status=T;if(M.status===T&&(M.gzhead.hcrc?(M.pending+2>M.pending_buf_size&&c(Q),M.pending+2<=M.pending_buf_size&&(B(M,255&Q.adler),B(M,Q.adler>>8&255),Q.adler=0,M.status=Y)):M.status=Y),0!==M.pending){if(c(Q),0===Q.avail_out)return M.last_flush=-1,s}else if(0===Q.avail_in&&N(X)<=N(m)&&X!==a)return K(Q,P);if(M.status===J&&0!==Q.avail_in)return K(Q,P);if(0!==Q.avail_in||0!==M.lookahead||X!==L&&M.status!==J){let C=M.strategy===Z?((Q,X)=>{let C;for(;;){if(0===Q.lookahead&&(I(Q),0===Q.lookahead)){if(X===L)return 1;break}if(Q.match_length=0,C=f(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,C&&(E(Q,!1),0===Q.strm.avail_out))return 1}return Q.insert=0,X===a?(E(Q,!0),0===Q.strm.avail_out?3:4):Q.last_lit&&(E(Q,!1),0===Q.strm.avail_out)?1:2})(M,X):M.strategy===g?((Q,X)=>{let C,l,h,M;const O=Q.window;for(;;){if(Q.lookahead<=H){if(I(Q),Q.lookahead<=H&&X===L)return 1;if(0===Q.lookahead)break}if(Q.match_length=0,Q.lookahead>=3&&Q.strstart>0&&(h=Q.strstart-1,l=O[h],l===O[++h]&&l===O[++h]&&l===O[++h])){M=Q.strstart+H;do{}while(l===O[++h]&&l===O[++h]&&l===O[++h]&&l===O[++h]&&l===O[++h]&&l===O[++h]&&l===O[++h]&&l===O[++h]&&h<M);Q.match_length=H-(M-h),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=3?(C=f(Q,1,Q.match_length-3),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(C=f(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),C&&(E(Q,!1),0===Q.strm.avail_out))return 1}return Q.insert=0,X===a?(E(Q,!0),0===Q.strm.avail_out?3:4):Q.last_lit&&(E(Q,!1),0===Q.strm.avail_out)?1:2})(M,X):D[M.level].func(M,X);if(3!==C&&4!==C||(M.status=J),1===C||3===C)return 0===Q.avail_out&&(M.last_flush=-1),s;if(2===C&&(X===w?O(M):X!==F&&(h(M,0,0,!1),X===i&&(q(M.head),0===M.lookahead&&(M.strstart=0,M.block_start=0,M.insert=0))),c(Q),0===Q.avail_out))return M.last_flush=-1,s}return X!==a?s:M.wrap<=0?z:(2===M.wrap?(B(M,255&Q.adler),B(M,Q.adler>>8&255),B(M,Q.adler>>16&255),B(M,Q.adler>>24&255),B(M,255&Q.total_in),B(M,Q.total_in>>8&255),B(M,Q.total_in>>16&255),B(M,Q.total_in>>24&255)):(G(M,Q.adler>>>16),G(M,65535&Q.adler)),c(Q),M.wrap>0&&(M.wrap=-M.wrap),0!==M.pending?s:z)},Q.exports.deflateEnd=Q=>{if(!Q||!Q.state)return x;const X=Q.state.status;return 42!==X&&69!==X&&73!==X&&91!==X&&X!==T&&X!==Y&&X!==J?K(Q,x):(Q.state=null,X===Y?K(Q,r):s)},Q.exports.deflateSetDictionary=(Q,X)=>{let C=X.length;if(!Q||!Q.state)return x;const l=Q.state,h=l.wrap;if(2===h||1===h&&42!==l.status||l.lookahead)return x;if(1===h&&(Q.adler=m(Q.adler,X,C,0)),l.wrap=0,C>=l.w_size){0===h&&(q(l.head),l.strstart=0,l.block_start=0,l.insert=0);let Q=new Uint8Array(l.w_size);Q.set(X.subarray(C-l.w_size,C),0),X=Q,C=l.w_size}const M=Q.avail_in,f=Q.next_in,O=Q.input;for(Q.avail_in=C,Q.next_in=0,Q.input=X,I(l);l.lookahead>=3;){let Q=l.strstart,X=l.lookahead-2;do{l.ins_h=n(l,l.ins_h,l.window[Q+3-1]),l.prev[Q&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=Q,Q++}while(--X);l.strstart=Q,l.lookahead=2,I(l)}return l.strstart+=l.lookahead,l.block_start=l.strstart,l.insert=l.lookahead,l.lookahead=0,l.match_length=l.prev_length=2,l.match_available=0,Q.next_in=f,Q.input=O,Q.avail_in=M,l.wrap=h,s},Q.exports.deflateInfo="pako deflate (from Nodeca project)"},12582:Q=>{"use strict";Q.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12574:Q=>{"use strict";Q.exports=function(Q,X){let C,l,h,M,f,O,m,W,U,L,w,i,a,F,s,z,x,r,P,j,v,Z,g,S;const e=Q.state;C=Q.next_in,g=Q.input,l=C+(Q.avail_in-5),h=Q.next_out,S=Q.output,M=h-(X-Q.avail_out),f=h+(Q.avail_out-257),O=e.dmax,m=e.wsize,W=e.whave,U=e.wnext,L=e.window,w=e.hold,i=e.bits,a=e.lencode,F=e.distcode,s=(1<<e.lenbits)-1,z=(1<<e.distbits)-1;Q:do{i<15&&(w+=g[C++]<<i,i+=8,w+=g[C++]<<i,i+=8),x=a[w&s];X:for(;;){if(r=x>>>24,w>>>=r,i-=r,r=x>>>16&255,0===r)S[h++]=65535&x;else{if(!(16&r)){if(0===(64&r)){x=a[(65535&x)+(w&(1<<r)-1)];continue X}if(32&r){e.mode=12;break Q}Q.msg="invalid literal/length code",e.mode=30;break Q}P=65535&x,r&=15,r&&(i<r&&(w+=g[C++]<<i,i+=8),P+=w&(1<<r)-1,w>>>=r,i-=r),i<15&&(w+=g[C++]<<i,i+=8,w+=g[C++]<<i,i+=8),x=F[w&z];C:for(;;){if(r=x>>>24,w>>>=r,i-=r,r=x>>>16&255,!(16&r)){if(0===(64&r)){x=F[(65535&x)+(w&(1<<r)-1)];continue C}Q.msg="invalid distance code",e.mode=30;break Q}if(j=65535&x,r&=15,i<r&&(w+=g[C++]<<i,i+=8,i<r&&(w+=g[C++]<<i,i+=8)),j+=w&(1<<r)-1,j>O){Q.msg="invalid distance too far back",e.mode=30;break Q}if(w>>>=r,i-=r,r=h-M,j>r){if(r=j-r,r>W&&e.sane){Q.msg="invalid distance too far back",e.mode=30;break Q}if(v=0,Z=L,0===U){if(v+=m-r,r<P){P-=r;do{S[h++]=L[v++]}while(--r);v=h-j,Z=S}}else if(U<r){if(v+=m+U-r,r-=U,r<P){P-=r;do{S[h++]=L[v++]}while(--r);if(v=0,U<P){r=U,P-=r;do{S[h++]=L[v++]}while(--r);v=h-j,Z=S}}}else if(v+=U-r,r<P){P-=r;do{S[h++]=L[v++]}while(--r);v=h-j,Z=S}for(;P>2;)S[h++]=Z[v++],S[h++]=Z[v++],S[h++]=Z[v++],P-=3;P&&(S[h++]=Z[v++],P>1&&(S[h++]=Z[v++]))}else{v=h-j;do{S[h++]=S[v++],S[h++]=S[v++],S[h++]=S[v++],P-=3}while(P>2);P&&(S[h++]=S[v++],P>1&&(S[h++]=S[v++]))}break}}break}}while(C<l&&h<f);P=i>>3,C-=P,i-=P<<3,w&=(1<<i)-1,Q.next_in=C,Q.next_out=h,Q.avail_in=C<l?l-C+5:5-(C-l),Q.avail_out=h<f?f-h+257:257-(h-f),e.hold=w,e.bits=i}},12571:(Q,X,C)=>{"use strict";const l=C(12529),h=C(12533),M=C(12574),f=C(12578),{Z_FINISH:O,Z_BLOCK:m,Z_TREES:W,Z_OK:U,Z_STREAM_END:L,Z_NEED_DICT:w,Z_STREAM_ERROR:i,Z_DATA_ERROR:a,Z_MEM_ERROR:F,Z_BUF_ERROR:s,Z_DEFLATED:z}=C(12547),x=12,r=30,P=Q=>(Q>>>24&255)+(Q>>>8&65280)+((65280&Q)<<8)+((255&Q)<<24);function j(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const v=Q=>{if(!Q||!Q.state)return i;const X=Q.state;return Q.total_in=Q.total_out=X.total=0,Q.msg="",X.wrap&&(Q.adler=1&X.wrap),X.mode=1,X.last=0,X.havedict=0,X.dmax=32768,X.head=null,X.hold=0,X.bits=0,X.lencode=X.lendyn=new Int32Array(852),X.distcode=X.distdyn=new Int32Array(592),X.sane=1,X.back=-1,U},Z=Q=>{if(!Q||!Q.state)return i;const X=Q.state;return X.wsize=0,X.whave=0,X.wnext=0,v(Q)},g=(Q,X)=>{let C;if(!Q||!Q.state)return i;const l=Q.state;return X<0?(C=0,X=-X):(C=1+(X>>4),X<48&&(X&=15)),X&&(X<8||X>15)?i:(null!==l.window&&l.wbits!==X&&(l.window=null),l.wrap=C,l.wbits=X,Z(Q))},S=(Q,X)=>{if(!Q)return i;const C=new j;Q.state=C,C.window=null;const l=g(Q,X);return l!==U&&(Q.state=null),l};let e,k,R=!0;const H=Q=>{if(R){e=new Int32Array(512),k=new Int32Array(32);let X=0;for(;X<144;)Q.lens[X++]=8;for(;X<256;)Q.lens[X++]=9;for(;X<280;)Q.lens[X++]=7;for(;X<288;)Q.lens[X++]=8;for(f(1,Q.lens,0,288,e,0,Q.work,{bits:9}),X=0;X<32;)Q.lens[X++]=5;f(2,Q.lens,0,32,k,0,Q.work,{bits:5}),R=!1}Q.lencode=e,Q.lenbits=9,Q.distcode=k,Q.distbits=5},o=(Q,X,C,l)=>{let h;const M=Q.state;return null===M.window&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new Uint8Array(M.wsize)),l>=M.wsize?(M.window.set(X.subarray(C-M.wsize,C),0),M.wnext=0,M.whave=M.wsize):(h=M.wsize-M.wnext,h>l&&(h=l),M.window.set(X.subarray(C-l,C-l+h),M.wnext),(l-=h)?(M.window.set(X.subarray(C-l,C),0),M.wnext=l,M.whave=M.wsize):(M.wnext+=h,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=h))),0};Q.exports.inflateReset=Z,Q.exports.inflateReset2=g,Q.exports.inflateResetKeep=v,Q.exports.inflateInit=Q=>S(Q,15),Q.exports.inflateInit2=S,Q.exports.inflate=(Q,X)=>{let C,j,v,Z,g,S,e,k,R,T,Y,J,K,N,q,n,c,E,B,G,b,p,I=0;const t=new Uint8Array(4);let y,A;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Q||!Q.state||!Q.output||!Q.input&&0!==Q.avail_in)return i;C=Q.state,C.mode===x&&(C.mode=13),g=Q.next_out,v=Q.output,e=Q.avail_out,Z=Q.next_in,j=Q.input,S=Q.avail_in,k=C.hold,R=C.bits,T=S,Y=e,p=U;Q:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;R<16;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(2&C.wrap&&35615===k){C.check=0,t[0]=255&k,t[1]=k>>>8&255,C.check=h(C.check,t,2,0),k=0,R=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&k)<<8)+(k>>8))%31){Q.msg="incorrect header check",C.mode=r;break}if((15&k)!==z){Q.msg="unknown compression method",C.mode=r;break}if(k>>>=4,R-=4,b=8+(15&k),0===C.wbits)C.wbits=b;else if(b>C.wbits){Q.msg="invalid window size",C.mode=r;break}C.dmax=1<<C.wbits,Q.adler=C.check=1,C.mode=512&k?10:x,k=0,R=0;break;case 2:for(;R<16;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(C.flags=k,(255&C.flags)!==z){Q.msg="unknown compression method",C.mode=r;break}if(57344&C.flags){Q.msg="unknown header flags set",C.mode=r;break}C.head&&(C.head.text=k>>8&1),512&C.flags&&(t[0]=255&k,t[1]=k>>>8&255,C.check=h(C.check,t,2,0)),k=0,R=0,C.mode=3;case 3:for(;R<32;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}C.head&&(C.head.time=k),512&C.flags&&(t[0]=255&k,t[1]=k>>>8&255,t[2]=k>>>16&255,t[3]=k>>>24&255,C.check=h(C.check,t,4,0)),k=0,R=0,C.mode=4;case 4:for(;R<16;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}C.head&&(C.head.xflags=255&k,C.head.os=k>>8),512&C.flags&&(t[0]=255&k,t[1]=k>>>8&255,C.check=h(C.check,t,2,0)),k=0,R=0,C.mode=5;case 5:if(1024&C.flags){for(;R<16;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}C.length=k,C.head&&(C.head.extra_len=k),512&C.flags&&(t[0]=255&k,t[1]=k>>>8&255,C.check=h(C.check,t,2,0)),k=0,R=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(J=C.length,J>S&&(J=S),J&&(C.head&&(b=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(j.subarray(Z,Z+J),b)),512&C.flags&&(C.check=h(C.check,j,J,Z)),S-=J,Z+=J,C.length-=J),C.length))break Q;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===S)break Q;J=0;do{b=j[Z+J++],C.head&&b&&C.length<65536&&(C.head.name+=String.fromCharCode(b))}while(b&&J<S);if(512&C.flags&&(C.check=h(C.check,j,J,Z)),S-=J,Z+=J,b)break Q}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===S)break Q;J=0;do{b=j[Z+J++],C.head&&b&&C.length<65536&&(C.head.comment+=String.fromCharCode(b))}while(b&&J<S);if(512&C.flags&&(C.check=h(C.check,j,J,Z)),S-=J,Z+=J,b)break Q}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;R<16;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(k!==(65535&C.check)){Q.msg="header crc mismatch",C.mode=r;break}k=0,R=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),Q.adler=C.check=0,C.mode=x;break;case 10:for(;R<32;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}Q.adler=C.check=P(k),k=0,R=0,C.mode=11;case 11:if(0===C.havedict)return Q.next_out=g,Q.avail_out=e,Q.next_in=Z,Q.avail_in=S,C.hold=k,C.bits=R,w;Q.adler=C.check=1,C.mode=x;case x:if(X===m||X===W)break Q;case 13:if(C.last){k>>>=7&R,R-=7&R,C.mode=27;break}for(;R<3;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}switch(C.last=1&k,k>>>=1,R-=1,3&k){case 0:C.mode=14;break;case 1:if(H(C),C.mode=20,X===W){k>>>=2,R-=2;break Q}break;case 2:C.mode=17;break;case 3:Q.msg="invalid block type",C.mode=r}k>>>=2,R-=2;break;case 14:for(k>>>=7&R,R-=7&R;R<32;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if((65535&k)!==(k>>>16^65535)){Q.msg="invalid stored block lengths",C.mode=r;break}if(C.length=65535&k,k=0,R=0,C.mode=15,X===W)break Q;case 15:C.mode=16;case 16:if(J=C.length,J){if(J>S&&(J=S),J>e&&(J=e),0===J)break Q;v.set(j.subarray(Z,Z+J),g),S-=J,Z+=J,e-=J,g+=J,C.length-=J;break}C.mode=x;break;case 17:for(;R<14;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(C.nlen=257+(31&k),k>>>=5,R-=5,C.ndist=1+(31&k),k>>>=5,R-=5,C.ncode=4+(15&k),k>>>=4,R-=4,C.nlen>286||C.ndist>30){Q.msg="too many length or distance symbols",C.mode=r;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;R<3;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}C.lens[D[C.have++]]=7&k,k>>>=3,R-=3}for(;C.have<19;)C.lens[D[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,y={bits:C.lenbits},p=f(0,C.lens,0,19,C.lencode,0,C.work,y),C.lenbits=y.bits,p){Q.msg="invalid code lengths set",C.mode=r;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;I=C.lencode[k&(1<<C.lenbits)-1],q=I>>>24,n=I>>>16&255,c=65535&I,!(q<=R);){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(c<16)k>>>=q,R-=q,C.lens[C.have++]=c;else{if(16===c){for(A=q+2;R<A;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(k>>>=q,R-=q,0===C.have){Q.msg="invalid bit length repeat",C.mode=r;break}b=C.lens[C.have-1],J=3+(3&k),k>>>=2,R-=2}else if(17===c){for(A=q+3;R<A;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}k>>>=q,R-=q,b=0,J=3+(7&k),k>>>=3,R-=3}else{for(A=q+7;R<A;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}k>>>=q,R-=q,b=0,J=11+(127&k),k>>>=7,R-=7}if(C.have+J>C.nlen+C.ndist){Q.msg="invalid bit length repeat",C.mode=r;break}for(;J--;)C.lens[C.have++]=b}}if(C.mode===r)break;if(0===C.lens[256]){Q.msg="invalid code -- missing end-of-block",C.mode=r;break}if(C.lenbits=9,y={bits:C.lenbits},p=f(1,C.lens,0,C.nlen,C.lencode,0,C.work,y),C.lenbits=y.bits,p){Q.msg="invalid literal/lengths set",C.mode=r;break}if(C.distbits=6,C.distcode=C.distdyn,y={bits:C.distbits},p=f(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,y),C.distbits=y.bits,p){Q.msg="invalid distances set",C.mode=r;break}if(C.mode=20,X===W)break Q;case 20:C.mode=21;case 21:if(S>=6&&e>=258){Q.next_out=g,Q.avail_out=e,Q.next_in=Z,Q.avail_in=S,C.hold=k,C.bits=R,M(Q,Y),g=Q.next_out,v=Q.output,e=Q.avail_out,Z=Q.next_in,j=Q.input,S=Q.avail_in,k=C.hold,R=C.bits,C.mode===x&&(C.back=-1);break}for(C.back=0;I=C.lencode[k&(1<<C.lenbits)-1],q=I>>>24,n=I>>>16&255,c=65535&I,!(q<=R);){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(n&&0===(240&n)){for(E=q,B=n,G=c;I=C.lencode[G+((k&(1<<E+B)-1)>>E)],q=I>>>24,n=I>>>16&255,c=65535&I,!(E+q<=R);){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}k>>>=E,R-=E,C.back+=E}if(k>>>=q,R-=q,C.back+=q,C.length=c,0===n){C.mode=26;break}if(32&n){C.back=-1,C.mode=x;break}if(64&n){Q.msg="invalid literal/length code",C.mode=r;break}C.extra=15&n,C.mode=22;case 22:if(C.extra){for(A=C.extra;R<A;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}C.length+=k&(1<<C.extra)-1,k>>>=C.extra,R-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;I=C.distcode[k&(1<<C.distbits)-1],q=I>>>24,n=I>>>16&255,c=65535&I,!(q<=R);){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(0===(240&n)){for(E=q,B=n,G=c;I=C.distcode[G+((k&(1<<E+B)-1)>>E)],q=I>>>24,n=I>>>16&255,c=65535&I,!(E+q<=R);){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}k>>>=E,R-=E,C.back+=E}if(k>>>=q,R-=q,C.back+=q,64&n){Q.msg="invalid distance code",C.mode=r;break}C.offset=c,C.extra=15&n,C.mode=24;case 24:if(C.extra){for(A=C.extra;R<A;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}C.offset+=k&(1<<C.extra)-1,k>>>=C.extra,R-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){Q.msg="invalid distance too far back",C.mode=r;break}C.mode=25;case 25:if(0===e)break Q;if(J=Y-e,C.offset>J){if(J=C.offset-J,J>C.whave&&C.sane){Q.msg="invalid distance too far back",C.mode=r;break}J>C.wnext?(J-=C.wnext,K=C.wsize-J):K=C.wnext-J,J>C.length&&(J=C.length),N=C.window}else N=v,K=g-C.offset,J=C.length;J>e&&(J=e),e-=J,C.length-=J;do{v[g++]=N[K++]}while(--J);0===C.length&&(C.mode=21);break;case 26:if(0===e)break Q;v[g++]=C.length,e--,C.mode=21;break;case 27:if(C.wrap){for(;R<32;){if(0===S)break Q;S--,k|=j[Z++]<<R,R+=8}if(Y-=e,Q.total_out+=Y,C.total+=Y,Y&&(Q.adler=C.check=C.flags?h(C.check,v,Y,g-Y):l(C.check,v,Y,g-Y)),Y=e,(C.flags?k:P(k))!==C.check){Q.msg="incorrect data check",C.mode=r;break}k=0,R=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;R<32;){if(0===S)break Q;S--,k+=j[Z++]<<R,R+=8}if(k!==(4294967295&C.total)){Q.msg="incorrect length check",C.mode=r;break}k=0,R=0}C.mode=29;case 29:p=L;break Q;case r:p=a;break Q;case 31:return F;default:return i}return Q.next_out=g,Q.avail_out=e,Q.next_in=Z,Q.avail_in=S,C.hold=k,C.bits=R,(C.wsize||Y!==Q.avail_out&&C.mode<r&&(C.mode<27||X!==O))&&o(Q,Q.output,Q.next_out,Y-Q.avail_out)?(C.mode=31,F):(T-=Q.avail_in,Y-=Q.avail_out,Q.total_in+=T,Q.total_out+=Y,C.total+=Y,C.wrap&&Y&&(Q.adler=C.check=C.flags?h(C.check,v,Y,Q.next_out-Y):l(C.check,v,Y,Q.next_out-Y)),Q.data_type=C.bits+(C.last?64:0)+(C.mode===x?128:0)+(20===C.mode||15===C.mode?256:0),(0===T&&0===Y||X===O)&&p===U&&(p=s),p)},Q.exports.inflateEnd=Q=>{if(!Q||!Q.state)return i;let X=Q.state;return X.window&&(X.window=null),Q.state=null,U},Q.exports.inflateGetHeader=(Q,X)=>{if(!Q||!Q.state)return i;const C=Q.state;return 0===(2&C.wrap)?i:(C.head=X,X.done=!1,U)},Q.exports.inflateSetDictionary=(Q,X)=>{const C=X.length;let h,M,f;return Q&&Q.state?(h=Q.state,0!==h.wrap&&11!==h.mode?i:11===h.mode&&(M=1,M=l(M,X,C,0),M!==h.check)?a:(f=o(Q,X,C,C),f?(h.mode=31,F):(h.havedict=1,U))):i},Q.exports.inflateInfo="pako inflate (from Nodeca project)"},12578:Q=>{"use strict";const X=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),M=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Q.exports=(Q,f,O,m,W,U,L,w)=>{const i=w.bits;let a,F,s,z,x,r,P=0,j=0,v=0,Z=0,g=0,S=0,e=0,k=0,R=0,H=0,o=null,T=0;const Y=new Uint16Array(16),J=new Uint16Array(16);let K,N,q,n=null,c=0;for(P=0;P<=X;P++)Y[P]=0;for(j=0;j<m;j++)Y[f[O+j]]++;for(g=i,Z=X;Z>=1&&0===Y[Z];Z--);if(g>Z&&(g=Z),0===Z)return W[U++]=20971520,W[U++]=20971520,w.bits=1,0;for(v=1;v<Z&&0===Y[v];v++);for(g<v&&(g=v),k=1,P=1;P<=X;P++)if(k<<=1,k-=Y[P],k<0)return-1;if(k>0&&(0===Q||1!==Z))return-1;for(J[1]=0,P=1;P<X;P++)J[P+1]=J[P]+Y[P];for(j=0;j<m;j++)0!==f[O+j]&&(L[J[f[O+j]]++]=j);if(0===Q?(o=n=L,r=19):1===Q?(o=C,T-=257,n=l,c-=257,r=256):(o=h,n=M,r=-1),H=0,j=0,P=v,x=U,S=g,e=0,s=-1,R=1<<g,z=R-1,1===Q&&R>852||2===Q&&R>592)return 1;for(;;){K=P-e,L[j]<r?(N=0,q=L[j]):L[j]>r?(N=n[c+L[j]],q=o[T+L[j]]):(N=96,q=0),a=1<<P-e,F=1<<S,v=F;do{F-=a,W[x+(H>>e)+F]=K<<24|N<<16|q}while(0!==F);for(a=1<<P-1;H&a;)a>>=1;if(0!==a?(H&=a-1,H+=a):H=0,j++,0===--Y[P]){if(P===Z)break;P=f[O+L[j]]}if(P>g&&(H&z)!==s){for(0===e&&(e=g),x+=v,S=P-e,k=1<<S;S+e<Z&&(k-=Y[S+e],!(k<=0));)S++,k<<=1;if(R+=1<<S,1===Q&&R>852||2===Q&&R>592)return 1;s=H&z,W[s]=g<<24|S<<16|x-U}}return 0!==H&&(W[x+H]=P-e<<24|64<<16),w.bits=g,0}},12540:Q=>{"use strict";Q.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12523:Q=>{"use strict";function X(Q){let X=Q.length;for(;--X>=0;)Q[X]=0}const C=256,l=286,h=30,M=15,f=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),m=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),U=new Array(576);X(U);const L=new Array(60);X(L);const w=new Array(512);X(w);const i=new Array(256);X(i);const a=new Array(29);X(a);const F=new Array(h);function s(Q,X,C,l,h){this.static_tree=Q,this.extra_bits=X,this.extra_base=C,this.elems=l,this.max_length=h,this.has_stree=Q&&Q.length}let z,x,r;function P(Q,X){this.dyn_tree=Q,this.max_code=0,this.stat_desc=X}X(F);const j=Q=>Q<256?w[Q]:w[256+(Q>>>7)],v=(Q,X)=>{Q.pending_buf[Q.pending++]=255&X,Q.pending_buf[Q.pending++]=X>>>8&255},Z=(Q,X,C)=>{Q.bi_valid>16-C?(Q.bi_buf|=X<<Q.bi_valid&65535,v(Q,Q.bi_buf),Q.bi_buf=X>>16-Q.bi_valid,Q.bi_valid+=C-16):(Q.bi_buf|=X<<Q.bi_valid&65535,Q.bi_valid+=C)},g=(Q,X,C)=>{Z(Q,C[2*X],C[2*X+1])},S=(Q,X)=>{let C=0;do{C|=1&Q,Q>>>=1,C<<=1}while(--X>0);return C>>>1},e=(Q,X,C)=>{const l=new Array(16);let h,f,O=0;for(h=1;h<=M;h++)l[h]=O=O+C[h-1]<<1;for(f=0;f<=X;f++){let X=Q[2*f+1];0!==X&&(Q[2*f]=S(l[X]++,X))}},k=Q=>{let X;for(X=0;X<l;X++)Q.dyn_ltree[2*X]=0;for(X=0;X<h;X++)Q.dyn_dtree[2*X]=0;for(X=0;X<19;X++)Q.bl_tree[2*X]=0;Q.dyn_ltree[512]=1,Q.opt_len=Q.static_len=0,Q.last_lit=Q.matches=0},R=Q=>{Q.bi_valid>8?v(Q,Q.bi_buf):Q.bi_valid>0&&(Q.pending_buf[Q.pending++]=Q.bi_buf),Q.bi_buf=0,Q.bi_valid=0},H=(Q,X,C,l)=>{const h=2*X,M=2*C;return Q[h]<Q[M]||Q[h]===Q[M]&&l[X]<=l[C]},o=(Q,X,C)=>{const l=Q.heap[C];let h=C<<1;for(;h<=Q.heap_len&&(h<Q.heap_len&&H(X,Q.heap[h+1],Q.heap[h],Q.depth)&&h++,!H(X,l,Q.heap[h],Q.depth));)Q.heap[C]=Q.heap[h],C=h,h<<=1;Q.heap[C]=l},T=(Q,X,l)=>{let h,M,m,W,U=0;if(0!==Q.last_lit)do{h=Q.pending_buf[Q.d_buf+2*U]<<8|Q.pending_buf[Q.d_buf+2*U+1],M=Q.pending_buf[Q.l_buf+U],U++,0===h?g(Q,M,X):(m=i[M],g(Q,m+C+1,X),W=f[m],0!==W&&(M-=a[m],Z(Q,M,W)),h--,m=j(h),g(Q,m,l),W=O[m],0!==W&&(h-=F[m],Z(Q,h,W)))}while(U<Q.last_lit);g(Q,256,X)},Y=(Q,X)=>{const C=X.dyn_tree,l=X.stat_desc.static_tree,h=X.stat_desc.has_stree,f=X.stat_desc.elems;let O,m,W,U=-1;for(Q.heap_len=0,Q.heap_max=573,O=0;O<f;O++)0!==C[2*O]?(Q.heap[++Q.heap_len]=U=O,Q.depth[O]=0):C[2*O+1]=0;for(;Q.heap_len<2;)W=Q.heap[++Q.heap_len]=U<2?++U:0,C[2*W]=1,Q.depth[W]=0,Q.opt_len--,h&&(Q.static_len-=l[2*W+1]);for(X.max_code=U,O=Q.heap_len>>1;O>=1;O--)o(Q,C,O);W=f;do{O=Q.heap[1],Q.heap[1]=Q.heap[Q.heap_len--],o(Q,C,1),m=Q.heap[1],Q.heap[--Q.heap_max]=O,Q.heap[--Q.heap_max]=m,C[2*W]=C[2*O]+C[2*m],Q.depth[W]=(Q.depth[O]>=Q.depth[m]?Q.depth[O]:Q.depth[m])+1,C[2*O+1]=C[2*m+1]=W,Q.heap[1]=W++,o(Q,C,1)}while(Q.heap_len>=2);Q.heap[--Q.heap_max]=Q.heap[1],((Q,X)=>{const C=X.dyn_tree,l=X.max_code,h=X.stat_desc.static_tree,f=X.stat_desc.has_stree,O=X.stat_desc.extra_bits,m=X.stat_desc.extra_base,W=X.stat_desc.max_length;let U,L,w,i,a,F,s=0;for(i=0;i<=M;i++)Q.bl_count[i]=0;for(C[2*Q.heap[Q.heap_max]+1]=0,U=Q.heap_max+1;U<573;U++)L=Q.heap[U],i=C[2*C[2*L+1]+1]+1,i>W&&(i=W,s++),C[2*L+1]=i,L>l||(Q.bl_count[i]++,a=0,L>=m&&(a=O[L-m]),F=C[2*L],Q.opt_len+=F*(i+a),f&&(Q.static_len+=F*(h[2*L+1]+a)));if(0!==s){do{for(i=W-1;0===Q.bl_count[i];)i--;Q.bl_count[i]--,Q.bl_count[i+1]+=2,Q.bl_count[W]--,s-=2}while(s>0);for(i=W;0!==i;i--)for(L=Q.bl_count[i];0!==L;)w=Q.heap[--U],w>l||(C[2*w+1]!==i&&(Q.opt_len+=(i-C[2*w+1])*C[2*w],C[2*w+1]=i),L--)}})(Q,X),e(C,U,Q.bl_count)},J=(Q,X,C)=>{let l,h,M=-1,f=X[1],O=0,m=7,W=4;for(0===f&&(m=138,W=3),X[2*(C+1)+1]=65535,l=0;l<=C;l++)h=f,f=X[2*(l+1)+1],++O<m&&h===f||(O<W?Q.bl_tree[2*h]+=O:0!==h?(h!==M&&Q.bl_tree[2*h]++,Q.bl_tree[32]++):O<=10?Q.bl_tree[34]++:Q.bl_tree[36]++,O=0,M=h,0===f?(m=138,W=3):h===f?(m=6,W=3):(m=7,W=4))},K=(Q,X,C)=>{let l,h,M=-1,f=X[1],O=0,m=7,W=4;for(0===f&&(m=138,W=3),l=0;l<=C;l++)if(h=f,f=X[2*(l+1)+1],!(++O<m&&h===f)){if(O<W)do{g(Q,h,Q.bl_tree)}while(0!==--O);else 0!==h?(h!==M&&(g(Q,h,Q.bl_tree),O--),g(Q,16,Q.bl_tree),Z(Q,O-3,2)):O<=10?(g(Q,17,Q.bl_tree),Z(Q,O-3,3)):(g(Q,18,Q.bl_tree),Z(Q,O-11,7));O=0,M=h,0===f?(m=138,W=3):h===f?(m=6,W=3):(m=7,W=4)}};let N=!1;const q=(Q,X,C,l)=>{Z(Q,0+(l?1:0),3),((Q,X,C,l)=>{R(Q),l&&(v(Q,C),v(Q,~C)),Q.pending_buf.set(Q.window.subarray(X,X+C),Q.pending),Q.pending+=C})(Q,X,C,!0)};Q.exports._tr_init=Q=>{N||((()=>{let Q,X,C,W,P;const j=new Array(16);for(C=0,W=0;W<28;W++)for(a[W]=C,Q=0;Q<1<<f[W];Q++)i[C++]=W;for(i[C-1]=W,P=0,W=0;W<16;W++)for(F[W]=P,Q=0;Q<1<<O[W];Q++)w[P++]=W;for(P>>=7;W<h;W++)for(F[W]=P<<7,Q=0;Q<1<<O[W]-7;Q++)w[256+P++]=W;for(X=0;X<=M;X++)j[X]=0;for(Q=0;Q<=143;)U[2*Q+1]=8,Q++,j[8]++;for(;Q<=255;)U[2*Q+1]=9,Q++,j[9]++;for(;Q<=279;)U[2*Q+1]=7,Q++,j[7]++;for(;Q<=287;)U[2*Q+1]=8,Q++,j[8]++;for(e(U,287,j),Q=0;Q<h;Q++)L[2*Q+1]=5,L[2*Q]=S(Q,5);z=new s(U,f,257,l,M),x=new s(L,O,0,h,M),r=new s(new Array(0),m,0,19,7)})(),N=!0),Q.l_desc=new P(Q.dyn_ltree,z),Q.d_desc=new P(Q.dyn_dtree,x),Q.bl_desc=new P(Q.bl_tree,r),Q.bi_buf=0,Q.bi_valid=0,k(Q)},Q.exports._tr_stored_block=q,Q.exports._tr_flush_block=(Q,X,l,h)=>{let M,f,O=0;Q.level>0?(2===Q.strm.data_type&&(Q.strm.data_type=(Q=>{let X,l=4093624447;for(X=0;X<=31;X++,l>>>=1)if(1&l&&0!==Q.dyn_ltree[2*X])return 0;if(0!==Q.dyn_ltree[18]||0!==Q.dyn_ltree[20]||0!==Q.dyn_ltree[26])return 1;for(X=32;X<C;X++)if(0!==Q.dyn_ltree[2*X])return 1;return 0})(Q)),Y(Q,Q.l_desc),Y(Q,Q.d_desc),O=(Q=>{let X;for(J(Q,Q.dyn_ltree,Q.l_desc.max_code),J(Q,Q.dyn_dtree,Q.d_desc.max_code),Y(Q,Q.bl_desc),X=18;X>=3&&0===Q.bl_tree[2*W[X]+1];X--);return Q.opt_len+=3*(X+1)+5+5+4,X})(Q),M=Q.opt_len+3+7>>>3,f=Q.static_len+3+7>>>3,f<=M&&(M=f)):M=f=l+5,l+4<=M&&-1!==X?q(Q,X,l,h):4===Q.strategy||f===M?(Z(Q,2+(h?1:0),3),T(Q,U,L)):(Z(Q,4+(h?1:0),3),((Q,X,C,l)=>{let h;for(Z(Q,X-257,5),Z(Q,C-1,5),Z(Q,l-4,4),h=0;h<l;h++)Z(Q,Q.bl_tree[2*W[h]+1],3);K(Q,Q.dyn_ltree,X-1),K(Q,Q.dyn_dtree,C-1)})(Q,Q.l_desc.max_code+1,Q.d_desc.max_code+1,O+1),T(Q,Q.dyn_ltree,Q.dyn_dtree)),k(Q),h&&R(Q)},Q.exports._tr_tally=(Q,X,l)=>(Q.pending_buf[Q.d_buf+2*Q.last_lit]=X>>>8&255,Q.pending_buf[Q.d_buf+2*Q.last_lit+1]=255&X,Q.pending_buf[Q.l_buf+Q.last_lit]=255&l,Q.last_lit++,0===X?Q.dyn_ltree[2*l]++:(Q.matches++,X--,Q.dyn_ltree[2*(i[l]+C+1)]++,Q.dyn_dtree[2*j(X)]++),Q.last_lit===Q.lit_bufsize-1),Q.exports._tr_align=Q=>{Z(Q,2,3),g(Q,256,U),(Q=>{16===Q.bi_valid?(v(Q,Q.bi_buf),Q.bi_buf=0,Q.bi_valid=0):Q.bi_valid>=8&&(Q.pending_buf[Q.pending++]=255&Q.bi_buf,Q.bi_buf>>=8,Q.bi_valid-=8)})(Q)}},12564:Q=>{"use strict";Q.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12461:Q=>{function X(Q,X,C){for(var l=Q.length,h=-1/0,M=1/0,f=0;f<l;f++){var O=(C[0][f]-Q[f])/X[f],m=(C[1][f]-Q[f])/X[f];if(O>m){var W=O;O=m,m=W}if(m<h||O>M)return 1/0;O>h&&(h=O),m<M&&(M=m)}return h>M?1/0:h}Q.exports=function(Q,C,l,h){var M=X(C,l,h);if(M===1/0)Q=null;else{Q=Q||[];for(var f=0;f<C.length;f++)Q[f]=C[f]+l[f]*M}return Q},Q.exports.distance=X},13386:(Q,X,C)=>{"use strict";C.d(X,{c:()=>f});var l=C(37);const h=l.useLayoutEffect;const M=function(Q){var X=(0,l.useRef)(Q);return h((function(){X.current=Q})),X};var f=function(Q){var X=M(Q);(0,l.bd)((function(){var Q=function(Q){var C;if(null!=X.current&&(C=X.current(Q)),Q.defaultPrevented&&(Q.returnValue=""),"string"===typeof C)return Q.returnValue=C,C};return window.addEventListener("beforeunload",Q),function(){window.removeEventListener("beforeunload",Q)}}),[])}},13331:(Q,X,C)=>{"use strict";var l=C(13334),h=Array.prototype.concat,M=Array.prototype.slice,f=Q.exports=function(Q){for(var X=[],C=0,f=Q.length;C<f;C++){var O=Q[C];l(O)?X=h.call(X,M.call(O)):X.push(O)}return X};f.wrap=function(Q){return function(){return Q(f(arguments))}}},13334:Q=>{Q.exports=function(Q){return!(!Q||"string"===typeof Q)&&(Q instanceof Array||Array.isArray(Q)||Q.length>=0&&(Q.splice instanceof Function||Object.getOwnPropertyDescriptor(Q,Q.length-1)&&"String"!==Q.constructor.name))}},12479:(Q,X,C)=>{var l=C(12482);function h(Q){for(var X,C,h=0,M=Q.length,f=0;f<Q.length;){for(X=Q[f],C=0;f<M&&Q[f]===X;)++f,++C;h+=l.log2(C)/7|0,h+=l.log2(X>>>0)/7|0,h+=2}return h}X.size=h,X.encode=function(Q,X){X||(X=new Uint8Array(h(Q)));for(var C,l,M=0,f=X.length,O=0;O<Q.length;){for(C=Q[O],l=0;O<Q.length&&Q[O]===C;)++O,++l;for(;M<f&&l>=128;)X[M++]=128+(127&l),l>>>=7;if(M>=f)throw new Error("RLE buffer overflow");for(X[M++]=l,C>>>=0;M<f&&C>=128;)X[M++]=128+(127&C),C>>>=7;if(M>=f)throw new Error("RLE buffer overflow");X[M++]=C}return X},X.decode=function(Q,X){for(var C,l,h,M,f=X.length,O=Q.length,m=0,W=0;W<O;){for(C=0,l=0;W<O&&Q[W]>=128;)C+=(127&Q[W++])<<l,l+=7;if(C+=Q[W++]<<l,W>=O)throw new Error("RLE buffer underrun");if(m+C>f)throw new Error("Chunk buffer overflow");for(h=0,l=0;W<O&&Q[W]>=128;)h+=(127&Q[W++])<<l,l+=7;if(W>=O)throw new Error("RLE buffer underrun");for(h+=Q[W++]<<l,M=0;M<C;++M)X[m++]=h}return X}},12482:(Q,X)=>{"use strict";function C(Q){var X=32;return(Q&=-Q)&&X--,65535&Q&&(X-=16),16711935&Q&&(X-=8),252645135&Q&&(X-=4),858993459&Q&&(X-=2),1431655765&Q&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(Q){return(Q>0)-(Q<0)},X.abs=function(Q){var X=Q>>31;return(Q^X)-X},X.min=function(Q,X){return X^(Q^X)&-(Q<X)},X.max=function(Q,X){return Q^(Q^X)&-(Q<X)},X.isPow2=function(Q){return!(Q&Q-1)&&!!Q},X.log2=function(Q){var X,C;return X=(Q>65535)<<4,X|=C=((Q>>>=X)>255)<<3,X|=C=((Q>>>=C)>15)<<2,(X|=C=((Q>>>=C)>3)<<1)|(Q>>>=C)>>1},X.log10=function(Q){return Q>=1e9?9:Q>=1e8?8:Q>=1e7?7:Q>=1e6?6:Q>=1e5?5:Q>=1e4?4:Q>=1e3?3:Q>=100?2:Q>=10?1:0},X.popCount=function(Q){return 16843009*((Q=(858993459&(Q-=Q>>>1&1431655765))+(Q>>>2&858993459))+(Q>>>4)&252645135)>>>24},X.countTrailingZeros=C,X.nextPow2=function(Q){return Q+=0===Q,--Q,Q|=Q>>>1,Q|=Q>>>2,Q|=Q>>>4,Q|=Q>>>8,(Q|=Q>>>16)+1},X.prevPow2=function(Q){return Q|=Q>>>1,Q|=Q>>>2,Q|=Q>>>4,Q|=Q>>>8,(Q|=Q>>>16)-(Q>>>1)},X.parity=function(Q){return Q^=Q>>>16,Q^=Q>>>8,Q^=Q>>>4,27030>>>(Q&=15)&1};var l=new Array(256);!function(Q){for(var X=0;X<256;++X){var C=X,l=X,h=7;for(C>>>=1;C;C>>>=1)l<<=1,l|=1&C,--h;Q[X]=l<<h&255}}(l),X.reverse=function(Q){return l[255&Q]<<24|l[Q>>>8&255]<<16|l[Q>>>16&255]<<8|l[Q>>>24&255]},X.interleave2=function(Q,X){return(Q=1431655765&((Q=858993459&((Q=252645135&((Q=16711935&((Q&=65535)|Q<<8))|Q<<4))|Q<<2))|Q<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(Q,X){return(Q=65535&((Q=16711935&((Q=252645135&((Q=858993459&((Q=Q>>>X&1431655765)|Q>>>1))|Q>>>2))|Q>>>4))|Q>>>16))<<16>>16},X.interleave3=function(Q,X,C){return Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2),(Q|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},X.deinterleave3=function(Q,X){return(Q=1023&((Q=4278190335&((Q=251719695&((Q=3272356035&((Q=Q>>>X&1227133513)|Q>>>2))|Q>>>4))|Q>>>8))|Q>>>16))<<22>>22},X.nextCombination=function(Q){var X=Q|Q-1;return X+1|(~X&-~X)-1>>>C(Q)+1}},12507:Q=>{"use strict";Q.exports=function(Q,X,C,l){var h=self||window;try{try{var M;try{M=new h.Blob([Q])}catch(W){(M=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(Q),M=M.getBlob()}var f=h.URL||h.webkitURL,O=f.createObjectURL(M),m=new h[X](O,C);return f.revokeObjectURL(O),m}catch(W){return new h[X]("data:application/javascript,".concat(encodeURIComponent(Q)),C)}}catch(W){if(!l)throw Error("Inline worker is not supported");return new h[X](l,C)}}},12444:(Q,X,C)=>{"use strict";function l(Q,X,C,l,h){var M={};return Object.keys(l).forEach((function(Q){M[Q]=l[Q]})),M.enumerable=!!M.enumerable,M.configurable=!!M.configurable,("value"in M||M.initializer)&&(M.writable=!0),M=C.slice().reverse().reduce((function(C,l){return l(Q,X,C)||C}),M),h&&void 0!==M.initializer&&(M.value=M.initializer?M.initializer.call(h):void 0,M.initializer=void 0),void 0===M.initializer&&(Object.defineProperty(Q,X,M),M=null),M}C.d(X,{d:()=>l})},12440:(Q,X,C)=>{"use strict";function l(Q,X,C,l){C&&Object.defineProperty(Q,X,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(l):void 0})}C.d(X,{c:()=>l})},13372:(Q,X,C)=>{"use strict";C.d(X,{e:()=>f,h:()=>L,l:()=>O,o:()=>M,p:()=>m,q:()=>h,t:()=>W,w:()=>U});var l=C(2365);class h{constructor(){this._easingMode=h.EASINGMODE_EASEIN}setEasingMode(Q){const X=Math.min(Math.max(Q,0),2);this._easingMode=X}getEasingMode(){return this._easingMode}easeInCore(Q){throw new Error("You must implement this method")}ease(Q){switch(this._easingMode){case h.EASINGMODE_EASEIN:return this.easeInCore(Q);case h.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Q)}return Q>=.5?.5*(1-this.easeInCore(2*(1-Q)))+.5:.5*this.easeInCore(2*Q)}}h.EASINGMODE_EASEIN=0,h.EASINGMODE_EASEOUT=1,h.EASINGMODE_EASEINOUT=2;class M extends h{easeInCore(Q){return Q=Math.max(0,Math.min(1,Q)),1-Math.sqrt(1-Q*Q)}}class f extends h{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Q}easeInCore(Q){const X=Math.max(0,this.amplitude);return Math.pow(Q,3)-Q*X*Math.sin(3.141592653589793*Q)}}class O extends h{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Q,this.bounciness=X}easeInCore(Q){const X=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const l=Math.pow(C,X),h=1-C,M=(1-l)/h+.5*l,f=Q*M,O=Math.log(-f*(1-C)+1)/Math.log(C),m=Math.floor(O),W=m+1,U=(1-Math.pow(C,m))/(h*M),L=.5*(U+(1-Math.pow(C,W))/(h*M)),w=Q-L,i=L-U;return-Math.pow(1/C,X-m)/(i*i)*(w-i)*(w+i)}}class m extends h{easeInCore(Q){return Q*Q*Q}}class W extends h{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Q,this.springiness=X}easeInCore(Q){let X;const C=Math.max(0,this.oscillations),l=Math.max(0,this.springiness);return X=0==l?Q:(Math.exp(l*Q)-1)/(Math.exp(l)-1),X*Math.sin((6.283185307179586*C+1.5707963267948966)*Q)}}class U extends h{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Q}easeInCore(Q){return this.exponent<=0?Q:(Math.exp(this.exponent*Q)-1)/(Math.exp(this.exponent)-1)}}class L extends h{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Q,this.y1=X,this.x2=C,this.y2=l}easeInCore(Q){return l.e.Interpolate(Q,this.x1,this.y1,this.x2,this.y2)}}},12994:(Q,X,C)=>{"use strict";C.d(X,{d:()=>f});var l=C(668),h=C(686),M=C(693);class f extends M.e{get _matrix(){return this._compose(),this.Fk}set _matrix(Q){(Q.updateFlag!==this.Fk.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Fk.p(Q),this._markAsDirtyAndDecompose())}constructor(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Q,X.va(),!1),this.name=Q,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=X,this.Fk=(null===h||void 0===h?void 0:h.clone())??l.b.Identity(),this._restMatrix=M??this.Fk.clone(),this._bindMatrix=f??this.Fk.clone(),this._index=O,this._absoluteMatrix=new l.b,this._absoluteBindMatrix=new l.b,this._absoluteInverseBindMatrix=new l.b,this._finalMatrix=new l.b,X.bones.push(this),this.setParent(C,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Q){this.setParent(Q)}setParent(Q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Q){if(this.parent){const Q=this.parent.children.indexOf(this);-1!==Q&&this.parent.children.splice(Q,1)}this._parentNode=Q,this.parent&&this.parent.children.push(this),X&&this._updateAbsoluteBindMatrices(),this.Uj()}}getLocalMatrix(){return this._compose(),this.Fk}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Q){this._restMatrix.p(Q)}setRestPose(Q){this.setRestMatrix(Q)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Q){this.jk(Q)}setBindPose(Q){this.setBindMatrix(Q)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Q=l.e.Yj[0],X=l.e.Quaternion[0],C=l.e.Yj[1];this.getRestMatrix().decompose(Q,X,C),this._linkedTransformNode.position.p(C),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??l.c.Identity(),this._linkedTransformNode.rotationQuaternion.p(X),this._linkedTransformNode._c.p(Q)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Q){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Q,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Xc}set position(Q){this._decompose(),this.Xc.p(Q),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Q){this.setRotation(Q)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Q){this.setRotationQuaternion(Q)}get _c(){return this.getScale()}set _c(Q){this.setScale(Q)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=l.k.Zero(),this._localRotation=l.c.Zero(),this.Xc=l.k.Zero()),this.Fk.decompose(this._localScaling,this._localRotation,this.Xc))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,l.b.ComposeToRef(this._localScaling,this._localRotation,this.Xc,this.Fk)):this._needToCompose=!1)}jk(Q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(Q),X&&this._updateAbsoluteBindMatrices(),C?this._matrix=Q:this.Uj()}_updateAbsoluteBindMatrices(Q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Q||(Q=this._bindMatrix),this.parent?Q.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(Q),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),X)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Uj(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Uj(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Uj(),this._needToDecompose=!0}_updatePosition(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const M=this.getLocalMatrix();if(0==X)h?(M.addAtIndex(12,Q.x),M.addAtIndex(13,Q.y),M.addAtIndex(14,Q.z)):M.setTranslationFromFloats(Q.x,Q.y,Q.z);else{let X=null;C&&(X=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=f._TmpMats[0],m=f._TmpVecs[0];this.parent?C&&X?(O.p(this.parent.getAbsoluteMatrix()),O.multiplyToRef(X,O)):O.p(this.parent.getAbsoluteMatrix()):l.b.IdentityToRef(O),h&&O.setTranslationFromFloats(0,0,0),O.invert(),l.k.TransformCoordinatesToRef(Q,O,m),h?(M.addAtIndex(12,m.x),M.addAtIndex(13,m.y),M.addAtIndex(14,m.z)):M.setTranslationFromFloats(m.x,m.y,m.z)}this._markAsDirtyAndDecompose()}translate(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(Q,X,C,!0)}setPosition(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(Q,X,C,!1)}setAbsolutePosition(Q,X){this.setPosition(Q,1,X)}scale(Q,X,C){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const M=this.getLocalMatrix(),O=f._TmpMats[0];l.b.ScalingToRef(Q,X,C,O),O.multiplyToRef(M,M),O.invert();for(const l of this.children){const h=l.getLocalMatrix();h.multiplyToRef(O,h),h.multiplyAtIndex(12,Q),h.multiplyAtIndex(13,X),h.multiplyAtIndex(14,C),l._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),h)for(const l of this.children)l.scale(Q,X,C,h)}setScale(Q){this._decompose(),this._localScaling.p(Q),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Q){this._decompose(),Q.p(this._localScaling)}setYawPitchRoll(Q,X,C){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4?arguments[4]:void 0;if(0===h){const O=f._TmpQuat;return l.c.RotationYawPitchRollToRef(Q,X,C,O),void this.setRotationQuaternion(O,h,M)}const O=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,M))return;const m=f._TmpMats[1];l.b.RotationYawPitchRollToRef(Q,X,C,m),O.multiplyToRef(m,m),this._rotateWithMatrix(m,h,M)}rotate(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;const M=f._TmpMats[0];M.setTranslationFromFloats(0,0,0),l.b.RotationAxisToRef(Q,X,M),this._rotateWithMatrix(M,C,h)}setAxisAngle(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;if(0===C){const M=f._TmpQuat;return l.c.RotationAxisToRef(Q,X,M),void this.setRotationQuaternion(M,C,h)}const M=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(M,h))return;const O=f._TmpMats[1];l.b.RotationAxisToRef(Q,X,O),M.multiplyToRef(O,O),this._rotateWithMatrix(O,C,h)}setRotation(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Q.y,Q.x,Q.z,X,C)}setRotationQuaternion(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===X)return this._decompose(),this._localRotation.p(Q),void this._markAsDirtyAndCompose();const h=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,C))return;const M=f._TmpMats[1];l.b.FromQuaternionToRef(Q,M),h.multiplyToRef(M,M),this._rotateWithMatrix(M,X,C)}setRotationMatrix(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===X){const h=f._TmpQuat;return l.c.FromRotationMatrixToRef(Q,h),void this.setRotationQuaternion(h,X,C)}const h=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,C))return;const M=f._TmpMats[1];M.p(Q),h.multiplyToRef(Q,M),this._rotateWithMatrix(M,X,C)}_rotateWithMatrix(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const l=this.getLocalMatrix(),h=l.m[12],M=l.m[13],O=l.m[14],m=this.getParent(),W=f._TmpMats[3],U=f._TmpMats[4];m&&1==X?(C?(W.p(C.getWorldMatrix()),m.getAbsoluteMatrix().multiplyToRef(W,W)):W.p(m.getAbsoluteMatrix()),U.p(W),U.invert(),l.multiplyToRef(W,l),l.multiplyToRef(Q,l),l.multiplyToRef(U,l)):1==X&&C?(W.p(C.getWorldMatrix()),U.p(W),U.invert(),l.multiplyToRef(W,l),l.multiplyToRef(Q,l),l.multiplyToRef(U,l)):l.multiplyToRef(Q,l),l.setTranslationFromFloats(h,M,O),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Q,X){const C=f._TmpMats[2];return Q.p(this.getAbsoluteMatrix()),X?(Q.multiplyToRef(X.getWorldMatrix(),Q),l.b.ScalingToRef(X._c.x,X._c.y,X._c.z,C)):l.b.IdentityToRef(C),Q.invert(),!isNaN(Q.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyToRef(C,Q),!0)}qg(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=l.k.Zero();return this.getPositionToRef(Q,X,C),C}getPositionToRef(){let Q=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Q=this.getLocalMatrix();X.x=Q.m[12],X.y=Q.m[13],X.z=Q.m[14]}else{let C=null;Q&&(C=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let l=f._TmpMats[0];Q&&C?(l.p(this.getAbsoluteMatrix()),l.multiplyToRef(C,l)):l=this.getAbsoluteMatrix(),X.x=l.m[12],X.y=l.m[13],X.z=l.m[14]}}getAbsolutePosition(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=l.k.Zero();return this.getPositionToRef(1,Q,X),X}getAbsolutePositionToRef(Q,X){this.getPositionToRef(1,Q,X)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Fk.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Fk);const Q=this._skeleton.getPoseMatrix();Q&&this._absoluteMatrix.multiplyToRef(Q,this._absoluteMatrix)}const Q=this.children,X=Q.length;for(let C=0;C<X;C++)Q[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}yg(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=l.k.Zero();return this.getDirectionToRef(Q,X,C),C}getDirectionToRef(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,h=null;X&&(h=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=f._TmpMats[0];M.p(this.getAbsoluteMatrix()),X&&h&&M.multiplyToRef(h,M),l.k.TransformNormalToRef(Q,M,C),C.normalize()}getRotation(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=l.k.Zero();return this.getRotationToRef(Q,X,C),C}getRotationToRef(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const l=f._TmpQuat;this.getRotationQuaternionToRef(Q,X,l),l.toEulerAnglesToRef(C)}getRotationQuaternion(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=l.c.Identity();return this.getRotationQuaternionToRef(Q,X,C),C}getRotationQuaternionToRef(){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),X.p(this._localRotation);else{const C=f._TmpMats[0],l=this.getAbsoluteMatrix();Q?l.multiplyToRef(Q.getWorldMatrix(),C):C.p(l),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,X,void 0)}}getRotationMatrix(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1?arguments[1]:void 0;const C=l.b.Identity();return this.getRotationMatrixToRef(Q,X,C),C}getRotationMatrixToRef(){let Q=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(X);else{const C=f._TmpMats[0],l=this.getAbsoluteMatrix();Q?l.multiplyToRef(Q.getWorldMatrix(),C):C.p(l),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(X)}}getAbsolutePositionFromLocal(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=l.k.Zero();return this.getAbsolutePositionFromLocalToRef(Q,X,C),C}getAbsolutePositionFromLocalToRef(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,h=null;X&&(h=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=f._TmpMats[0];M.p(this.getAbsoluteMatrix()),X&&h&&M.multiplyToRef(h,M),l.k.TransformCoordinatesToRef(Q,M,C)}getLocalPositionFromAbsolute(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=l.k.Zero();return this.getLocalPositionFromAbsoluteToRef(Q,X,C),C}getLocalPositionFromAbsoluteToRef(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,h=null;X&&(h=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=f._TmpMats[0];M.p(this.getAbsoluteMatrix()),X&&h&&M.multiplyToRef(h,M),M.invert(),l.k.TransformCoordinatesToRef(Q,M,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Q=this._skeleton.bones.indexOf(this);if(-1!==Q&&this._skeleton.bones.splice(Q,1),this._parentNode&&this._parentNode.children){const Q=this._parentNode.children,X=Q.indexOf(this);-1!==X&&Q.splice(X,1)}super.dispose()}}f._TmpVecs=(0,h.b)(2,l.k.Zero),f._TmpQuat=l.c.Identity(),f._TmpMats=(0,h.b)(5,l.b.Identity)},13367:(Q,X,C)=>{"use strict";C.d(X,{c:()=>Y});var l=C(644),h=C(650),M=C(482),f=C(668),O=C(690),m=C(693),W=C(477),U=C(2545),L=C(507),w=C(677);class i{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Q){this._zoomStopsAnimation=Q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Q){this._idleRotationSpeed=Q}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Q){this._idleRotationWaitTime=Q}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Q){this._idleRotationSpinupTime=Q}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Q){this._attachedCamera=Q;const X=this._attachedCamera.va();this._onPrePointerObservableObserver=X.onPrePointerObservable.add((Q=>{Q.type!==U.b.POINTERDOWN?Q.type===U.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Q.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Q=L.c.Now;let X=0;null!=this._lastFrameTime&&(X=Q-this._lastFrameTime),this._lastFrameTime=Q,this._applyUserInteraction();const C=Q-this._lastInteractionTime-this._idleRotationWaitTime,l=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*l,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(X/1e3))}))}detach(){if(!this._attachedCamera)return;const Q=this._attachedCamera.va();this._onPrePointerObservableObserver&&Q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Q){this._lastInteractionTime=Q??L.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<w.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Q=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Q=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Q:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=L.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var a=C(13372),F=C(12229);class s{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Q){if(this._autoTransitionRange===Q)return;this._autoTransitionRange=Q;const X=this._attachedCamera;X&&(Q?this._onMeshTargetChangedObserver=X.onMeshTargetChangedObservable.add((Q=>{if(Q&&(Q.Vj(!0),Q.getBoundingInfo)){const X=Q.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*X,this.upperRadiusTransitionRange=.05*X}})):this._onMeshTargetChangedObserver&&X.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Q){this._attachedCamera=Q,this._onAfterCheckInputsObserver=Q.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Q){return!!this._attachedCamera&&(this._attachedCamera.radius===Q&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Q){if(!this._attachedCamera)return;this._radiusBounceTransition||(s.EasingFunction.setEasingMode(s.EasingMode),this._radiusBounceTransition=F.e.CreateAnimation("radius",F.e.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const X=F.e.TransitionTo("radius",this._attachedCamera.radius+Q,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));X&&this._animatables.push(X)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}s.EasingFunction=new a.e(.3),s.EasingMode=a.q.EASINGMODE_EASEOUT;class z{constructor(){this.onTargetFramingAnimationEndObservable=new M.e,this._mode=z.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Q){this._mode=Q}get mode(){return this._mode}set radiusScale(Q){this._radiusScale=Q}get radiusScale(){return this._radiusScale}set positionScale(Q){this._positionScale=Q}get positionScale(){return this._positionScale}set defaultElevation(Q){this._defaultElevation=Q}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Q){this._elevationReturnTime=Q}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Q){this._elevationReturnWaitTime=Q}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Q){this._zoomStopsAnimation=Q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Q){this._framingTime=Q}get framingTime(){return this._framingTime}init(){}attach(Q){this._attachedCamera=Q;const X=this._attachedCamera.va();z.EasingFunction.setEasingMode(z.EasingMode),this._onPrePointerObservableObserver=X.onPrePointerObservable.add((Q=>{Q.type!==U.b.POINTERDOWN?Q.type===U.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Q.onMeshTargetChangedObservable.add((Q=>{Q&&Q.getBoundingInfo&&this.zoomOnMesh(Q,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Q.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Q=this._attachedCamera.va();this._onPrePointerObservableObserver&&Q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q.Vj(!0);const l=Q.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(l.minimumWorld,l.maximumWorld,X,C)}zoomOnMeshHierarchy(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q.Vj(!0);const l=Q.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(l.min,l.max,X,C)}zoomOnMeshesHierarchy(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new f.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new f.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let M=0;M<Q.length;M++){const X=Q[M].getHierarchyBoundingVectors(!0);f.k.CheckExtends(X.min,l,h),f.k.CheckExtends(X.max,l,h)}this.zoomOnBoundingInfo(l,h,X,C)}zoomOnBoundingInfo(Q,X){let C,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const M=Q.y,O=M+(X.y-M)*this._positionScale,m=X.Od(Q).scale(.5);if(!isFinite(O))return!1;if(l)C=new f.k(0,O,0);else{const X=Q.add(m);C=new f.k(X.x,O,X.z)}this._vectorTransition||(this._vectorTransition=F.e.CreateAnimation("target",F.e.ANIMATIONTYPE_VECTOR3,60,z.EasingFunction)),this._betaIsAnimating=!0;let W=F.e.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);W&&this._animatables.push(W);let U=0;if(this._mode===z.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(Q,X);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=m.length()+this._attachedCamera.Rj),U=C}else this._mode===z.IgnoreBoundsSizeMode&&(U=this._calculateLowerRadiusFromModelBoundingSphere(Q,X),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Rj));if(this.autoCorrectCameraLimitsAndSensibility){const C=X.Od(Q).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/U}return this._radiusTransition||(this._radiusTransition=F.e.CreateAnimation("radius",F.e.ANIMATIONTYPE_FLOAT,60,z.EasingFunction)),W=F.e.TransitionTo("radius",U,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),h&&h(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),W&&this._animatables.push(W),!0}_calculateLowerRadiusFromModelBoundingSphere(Q,X){const C=this._attachedCamera;if(!C)return 0;let l=C._calculateLowerRadiusFromModelBoundingSphere(Q,X,this._radiusScale);return C.lowerRadiusLimit&&this._mode===z.IgnoreBoundsSizeMode&&(l=l<C.lowerRadiusLimit?C.lowerRadiusLimit:l),C.upperRadiusLimit&&(l=l>C.upperRadiusLimit?C.upperRadiusLimit:l),l}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Q=L.c.Now-this._lastInteractionTime,X=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&Q>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.e.CreateAnimation("beta",F.e.ANIMATIONTYPE_FLOAT,60,z.EasingFunction));const Q=F.e.TransitionTo("beta",X,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Q&&this._animatables.push(Q)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=L.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}z.EasingFunction=new a.w,z.EasingMode=a.q.EASINGMODE_EASEINOUT,z.IgnoreBoundsSizeMode=0,z.FitFrustumSidesMode=1;var x=C(642),r=C(12149),P=C(12987),j=C(487);class v{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Q){Q=j.i.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),C=X.getInputElement();let l=0,h=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=M=>{var f,O;const m=M.event,W="touch"===m.pointerType;if(M.type!==U.b.POINTERMOVE&&-1===this.buttons.indexOf(m.button))return;const L=m.target;if(this._altKey=m.altKey,this._ctrlKey=m.ctrlKey,this._metaKey=m.metaKey,this._shiftKey=m.shiftKey,this._buttonsPressed=m.buttons,X.isPointerLock){const Q=m.movementX,X=m.movementY;this.onTouch(null,Q,X),this._pointA=null,this._pointB=null}else{if(M.type!==U.b.POINTERDOWN&&M.type!==U.b.POINTERDOUBLETAP&&W&&(null===(f=this._pointA)||void 0===f?void 0:f.pointerId)!==m.pointerId&&(null===(O=this._pointB)||void 0===O?void 0:O.pointerId)!==m.pointerId)return;if(M.type!==U.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!W)if(M.type===U.b.POINTERDOUBLETAP)this.onDoubleTap(m.pointerType);else if(M.type!==U.b.POINTERUP||this._currentMousePointerIdDown!==m.pointerId&&!W){if(M.type===U.b.POINTERMOVE)if(Q||m.preventDefault(),this._pointA&&null===this._pointB){const Q=m.clientX-this._pointA.x,X=m.clientY-this._pointA.y;this._pointA.x=m.clientX,this._pointA.y=m.clientY,this.onTouch(this._pointA,Q,X)}else if(this._pointA&&this._pointB){const Q=this._pointA.pointerId===m.pointerId?this._pointA:this._pointB;Q.x=m.clientX,Q.y=m.clientY;const X=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,f=X*X+C*C,O={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:m.pointerId,type:M.type};this.onMultiTouch(this._pointA,this._pointB,l,f,h,O),h=O,l=f}}else{try{null===L||void 0===L||L.releasePointerCapture(m.pointerId)}catch(w){}W||(this._pointB=null),X._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==m.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==m.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==l||h)&&(this.onMultiTouch(this._pointA,this._pointB,l,0,h,null),l=0,h=null),this._currentMousePointerIdDown=-1,this.onButtonUp(m),Q||m.preventDefault()}else{try{null===L||void 0===L||L.setPointerCapture(m.pointerId)}catch(w){}if(null===this._pointA)this._pointA={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType};else{if(null!==this._pointB)return;this._pointB={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType}}-1!==this._currentMousePointerIdDown||W||(this._currentMousePointerIdDown=m.pointerId),this.onButtonDown(m),Q||(m.preventDefault(),C&&C.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,U.b.POINTERDOWN|U.b.POINTERUP|U.b.POINTERMOVE|U.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,l=0,h=null,this.onLostFocus()},this._contextMenuBind=Q=>this.onContextMenu(Q),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const M=this.camera.va().getEngine().getHostWindow();M&&j.i.RegisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}Tj(){if(this._onLostFocus){const Q=this.camera.va().getEngine().getHostWindow();Q&&j.i.UnregisterTopRootEvents(Q,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Q=this.camera.va().getEngine().getInputElement();Q&&Q.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Q){}onTouch(Q,X,C){}onMultiTouch(Q,X,C,l,h,M){}onContextMenu(Q){Q.preventDefault()}onButtonDown(Q){}onButtonUp(Q){}onLostFocus(){}}(0,l.c)([(0,h.N)()],v.prototype,"buttons",void 0);class Z extends v{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Q,X){if(0!==this.panningSensibility&&Q&&X){const C=X.x-Q.x,l=X.y-Q.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility}}_computePinchZoom(Q,X){const C=this.camera.radius||Z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(Q)/Math.sqrt(X):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(X-Q)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(X-Q)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Q,X,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=X/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Q,X,C,l,h,M){0===C&&null===h||0===l&&null===M||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,l),this._computeMultiTouchPanning(h,M)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(l)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,l),this._isPinching=!0):this._computeMultiTouchPanning(h,M)):this.multiTouchPanning?this._computeMultiTouchPanning(h,M):this.pinchZoom&&this._computePinchZoom(C,l))}onButtonDown(Q){this._isPanClick=Q.button===this.camera._panningMouseButton}onButtonUp(Q){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Z.MinimumRadiusForPinch=.001,(0,l.c)([(0,h.N)()],Z.prototype,"buttons",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"angularSensibilityX",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"angularSensibilityY",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"pinchPrecision",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"pinchDeltaPercentage",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"useNaturalPinchZoom",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"pinchZoom",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"panningSensibility",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"multiTouchPanning",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"multiTouchPanAndZoom",void 0),P.c.ArcRotateCameraPointersInput=Z;var g=C(2547);class S{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Q){Q=j.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const C=X.event;if(!C.metaKey)if(X.type===g.d.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(Q||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const X=this._keys.indexOf(C.keyCode);X>=0&&this._keys.splice(X,1),C.preventDefault&&(Q||C.preventDefault())}})))}Tj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Q=this.camera;for(let X=0;X<this._keys.length;X++){const C=this._keys[X];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Q.inertialPanningX-=1/this.panningSensibility:Q.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Q.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Q.inertialRadiusOffset+=1/this.zoomingSensibility:Q.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Q.inertialPanningX+=1/this.panningSensibility:Q.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Q.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Q.inertialRadiusOffset-=1/this.zoomingSensibility:Q.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&Q.useInputToRestoreState&&Q.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,l.c)([(0,h.N)()],S.prototype,"keysUp",void 0),(0,l.c)([(0,h.N)()],S.prototype,"keysDown",void 0),(0,l.c)([(0,h.N)()],S.prototype,"keysLeft",void 0),(0,l.c)([(0,h.N)()],S.prototype,"keysRight",void 0),(0,l.c)([(0,h.N)()],S.prototype,"keysReset",void 0),(0,l.c)([(0,h.N)()],S.prototype,"panningSensibility",void 0),(0,l.c)([(0,h.N)()],S.prototype,"zoomingSensibility",void 0),(0,l.c)([(0,h.N)()],S.prototype,"useAltToZoom",void 0),(0,l.c)([(0,h.N)()],S.prototype,"angularSpeed",void 0),P.c.ArcRotateCameraKeyboardMoveInput=S;var e=C(719),k=C(2550);class R{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new f.k(0,0,0),this._globalOffset=new f.k(0,0,0),this._inertialPanning=f.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Q,X){let C=0;const l=.01*Q*this.wheelDeltaPercentage*X;return C=Q>0?l/(1+this.wheelDeltaPercentage):l*(1+this.wheelDeltaPercentage),C}attachControl(Q){Q=j.i.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==U.b.POINTERWHEEL)return;const C=X.event;let l=0;const h=C.deltaMode===k.b.DOM_DELTA_LINE?40:1,M=-C.deltaY*h;if(this.customComputeDeltaFromMouseWheel)l=this.customComputeDeltaFromMouseWheel(M,this,C);else if(this.wheelDeltaPercentage){if(l=this._computeDeltaFromMouseWheelLegacyEvent(M,this.camera.radius),l>0){let Q=this.camera.radius,X=this.camera.inertialRadiusOffset+l;for(let C=0;C<20&&!(Q<=X)&&!(Math.abs(X*this.camera.inertia)<.001);C++)Q-=X,X*=this.camera.inertia;Q=(0,O.Clamp)(Q,0,Number.MAX_VALUE),l=this._computeDeltaFromMouseWheelLegacyEvent(M,Q)}}else l=M/(40*this.wheelPrecision);l&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(l)):this.camera.inertialRadiusOffset+=l),C.preventDefault&&(Q||C.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,U.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Zj(0)}Tj(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Q=this.camera;0+Q.inertialAlphaOffset+Q.inertialBetaOffset+Q.inertialRadiusOffset&&(this._updateHitPlane(),Q.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Q.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Q=this.camera,X=Q.target.Od(Q.position);this._hitPlane=e.b.FromPositionAndNormal(Q.target,X)}_getPosition(){const Q=this.camera,X=Q.va(),C=X.createPickingRay(X.pointerX,X.pointerY,f.b.Identity(),Q,!1);0===Q.targetScreenOffset.x&&0===Q.targetScreenOffset.y||(this._viewOffset.set(Q.targetScreenOffset.x,Q.targetScreenOffset.y,0),Q.getViewMatrix().invertToRef(Q._cameraTransformMatrix),this._globalOffset=f.k.TransformNormal(this._viewOffset,Q._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let l=0;return this._hitPlane&&(l=C.intersectsPlane(this._hitPlane)??0),C.origin.addInPlace(C.direction.scaleInPlace(l))}_zoomToMouse(Q){const X=this.camera,C=1-X.inertia;if(X.lowerRadiusLimit){const l=X.lowerRadiusLimit??0;X.radius-(X.inertialRadiusOffset+Q)/C<l&&(Q=(X.radius-l)*C-X.inertialRadiusOffset)}if(X.upperRadiusLimit){const l=X.upperRadiusLimit??0;X.radius-(X.inertialRadiusOffset+Q)/C>l&&(Q=(X.radius-l)*C-X.inertialRadiusOffset)}const l=Q/C/X.radius,h=this._getPosition(),M=f.e.Yj[6];h.subtractToRef(X.target,M),M.scaleInPlace(l),M.scaleInPlace(C),this._inertialPanning.addInPlace(M),X.inertialRadiusOffset+=Q}_zeroIfClose(Q){Math.abs(Q.x)<w.b&&(Q.x=0),Math.abs(Q.y)<w.b&&(Q.y=0),Math.abs(Q.z)<w.b&&(Q.z=0)}}(0,l.c)([(0,h.N)()],R.prototype,"wheelPrecision",void 0),(0,l.c)([(0,h.N)()],R.prototype,"zoomToMouseLocation",void 0),(0,l.c)([(0,h.N)()],R.prototype,"wheelDeltaPercentage",void 0),P.c.ArcRotateCameraMouseWheelInput=R;class H extends P.g{constructor(Q){super(Q)}addMouseWheel(){return this.add(new R),this}addPointers(){return this.add(new Z),this}addKeyboard(){return this.add(new S),this}}var o=C(620);function T(Q,X){return isNaN(Q)?X:Q}m.e.AddNodeConstructor("ArcRotateCamera",((Q,X)=>()=>new Y(Q,0,0,1,f.k.Zero(),X)));class Y extends r.e{get target(){return this._target}set target(Q){this.setTarget(Q)}get targetHost(){return this._targetHost}set targetHost(Q){Q&&this.setTarget(Q)}getTarget(){return this.target}get position(){return this._position}set position(Q){this.setPosition(Q)}set upVector(Q){this._upToYMatrix||(this._yToUpMatrix=new f.b,this._upToYMatrix=new f.b,this._upVector=f.k.Zero()),Q.normalize(),this._upVector.p(Q),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){f.b.RotationAlignToRef(f.k.UpReadOnly,this._upVector,this._yToUpMatrix),f.b.RotationAlignToRef(this._upVector,f.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Q=this.inputs.attached.pointers;return Q?Q.angularSensibilityX:0}set angularSensibilityX(Q){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityX=Q)}get angularSensibilityY(){const Q=this.inputs.attached.pointers;return Q?Q.angularSensibilityY:0}set angularSensibilityY(Q){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityY=Q)}get pinchPrecision(){const Q=this.inputs.attached.pointers;return Q?Q.pinchPrecision:0}set pinchPrecision(Q){const X=this.inputs.attached.pointers;X&&(X.pinchPrecision=Q)}get pinchDeltaPercentage(){const Q=this.inputs.attached.pointers;return Q?Q.pinchDeltaPercentage:0}set pinchDeltaPercentage(Q){const X=this.inputs.attached.pointers;X&&(X.pinchDeltaPercentage=Q)}get useNaturalPinchZoom(){const Q=this.inputs.attached.pointers;return!!Q&&Q.useNaturalPinchZoom}set useNaturalPinchZoom(Q){const X=this.inputs.attached.pointers;X&&(X.useNaturalPinchZoom=Q)}get panningSensibility(){const Q=this.inputs.attached.pointers;return Q?Q.panningSensibility:0}set panningSensibility(Q){const X=this.inputs.attached.pointers;X&&(X.panningSensibility=Q)}get keysUp(){const Q=this.inputs.attached.keyboard;return Q?Q.keysUp:[]}set keysUp(Q){const X=this.inputs.attached.keyboard;X&&(X.keysUp=Q)}get keysDown(){const Q=this.inputs.attached.keyboard;return Q?Q.keysDown:[]}set keysDown(Q){const X=this.inputs.attached.keyboard;X&&(X.keysDown=Q)}get keysLeft(){const Q=this.inputs.attached.keyboard;return Q?Q.keysLeft:[]}set keysLeft(Q){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=Q)}get keysRight(){const Q=this.inputs.attached.keyboard;return Q?Q.keysRight:[]}set keysRight(Q){const X=this.inputs.attached.keyboard;X&&(X.keysRight=Q)}get wheelPrecision(){const Q=this.inputs.attached.mousewheel;return Q?Q.wheelPrecision:0}set wheelPrecision(Q){const X=this.inputs.attached.mousewheel;X&&(X.wheelPrecision=Q)}get zoomToMouseLocation(){const Q=this.inputs.attached.mousewheel;return!!Q&&Q.zoomToMouseLocation}set zoomToMouseLocation(Q){const X=this.inputs.attached.mousewheel;X&&(X.zoomToMouseLocation=Q)}get wheelDeltaPercentage(){const Q=this.inputs.attached.mousewheel;return Q?Q.wheelDeltaPercentage:0}set wheelDeltaPercentage(Q){const X=this.inputs.attached.mousewheel;X&&(X.wheelDeltaPercentage=Q)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Q){Q!==this.useBouncingBehavior&&(Q?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Q){Q!==this.useFramingBehavior&&(Q?(this._framingBehavior=new z,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Q){Q!==this.useAutoRotationBehavior&&(Q?(this._autoRotationBehavior=new i,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Q,X,C,l,h,O){var m;let W=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Q,f.k.Zero(),O,W),m=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=f.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=f.h.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new f.b,this.panningAxis=new f.k(1,1,0),this._transformedDirection=new f.k,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new M.e,this.checkCollisions=!1,this.collisionRadius=new f.k(.5,.5,.5),this._previousPosition=f.k.Zero(),this._collisionVelocity=f.k.Zero(),this._newPosition=f.k.Zero(),this._computationVector=f.k.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new f.k(NaN,NaN,NaN),this._goalTargetScreenOffset=new f.h(NaN,NaN),this._onCollisionPositionChange=function(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(m.setPosition(X),m.Ne&&m.Ne(C)):m._previousPosition.p(m._position);const l=Math.cos(m.alpha),h=Math.sin(m.alpha),M=Math.cos(m.beta);let f=Math.sin(m.beta);0===f&&(f=1e-4);const O=m._getTargetPosition();m._computationVector.Yc(m.radius*l*f,m.radius*M,m.radius*h*f),O.addToRef(m._computationVector,m._newPosition),m._position.p(m._newPosition);let W=m.upVector;m.allowUpsideDown&&m.beta<0&&(W=W.clone(),W=W.negate()),m._computeViewMatrix(m._position,O,W),m._viewMatrix.addAtIndex(12,m.targetScreenOffset.x),m._viewMatrix.addAtIndex(13,m.targetScreenOffset.y),m._collisionTriggered=!1},this._target=f.k.Zero(),h&&this.setTarget(h),this.alpha=X,this.beta=C,this.radius=l,this.getViewMatrix(),this.inputs=new H(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new f.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=f.h.Zero()}_updateCache(Q){Q||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Q=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Q.addToRef(this._targetBoundingCenter,this._target):this._target.p(Q)}const Q=this._getLockedTargetPosition();return Q||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>w.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,M=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=M?this._currentInterpolationFactor=M:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=T(Q,this._goalAlpha),this._goalBeta=T(X,this._goalBeta),this._goalRadius=T(C,this._goalRadius),this._goalTarget.set(T(l.x,this._goalTarget.x),T(l.y,this._goalTarget.y),T(l.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(T(h.x,this._goalTargetScreenOffset.x),T(h.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,O.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,O.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,O.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,O.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Q,X){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const h=arguments;X=j.i.BackCompatCameraNoPreventDefault(h),this._useCtrlForPanning=C,this._panningMouseButton=l,"boolean"===typeof h[0]&&(h.length>1&&(this._useCtrlForPanning=h[1]),h.length>2&&(this._panningMouseButton=h[2])),this.inputs.attachElement(X),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Tj(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Q=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Q=!0;const X=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let l=this.inertialAlphaOffset*C;this.beta<0&&(l*=-1),this.alpha+=l*X,this.beta+=this.inertialBetaOffset*X,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<w.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<w.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*w.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Q=!0;const X=new f.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),X.multiplyInPlace(this.panningAxis),f.k.TransformNormalToRef(X,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Q=this.upVector,X=f.k.CrossToRef(this._transformedDirection,Q,this._transformedDirection);f.k.CrossToRef(Q,X,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);f.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const Q=f.e.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Q),Q.transposeToRef(Q),f.k.TransformCoordinatesToRef(this._transformedDirection,Q,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*w.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*w.b&&(this.inertialPanningY=0)}if(Q)this.stopInterpolation();else if(this._isInterpolating){let Q=!1;const X=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-X/this._currentInterpolationFactor),l=T(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const X=f.e.Yj[0].set(T(this._goalTarget.x,this._target.x),T(this._goalTarget.y,this._target.y),T(this._goalTarget.z,this._target.z));f.k.LerpToRef(this.target,X,C,this._target),10*f.k.Distance(this.target,X)/l<w.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(X),this.setTarget(this.target,!1,!0,!0)):Q=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const X=f.c.RotationAlphaBetaGammaToRef(T(this._goalAlpha,this.alpha),T(this._goalBeta,this.beta),0,f.e.Quaternion[0]),l=f.c.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,f.e.Quaternion[1]),h=f.c.SlerpToRef(l,X,C,f.e.Quaternion[2]);h.normalize();const M=h.toAlphaBetaGammaToRef(f.e.Yj[0]);if(this.alpha=M.x,this.beta=M.y,h.isApprox(X,w.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Q=X.toAlphaBetaGammaToRef(f.e.Yj[0]);this.alpha=Q.x,this.beta=Q.y}else Q=!0}if(isNaN(this._goalRadius)||(this.radius+=(l-this.radius)*C,Math.abs(l/this.radius-1)<w.b?(this._goalRadius=NaN,this.radius=l):Q=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const X=f.e.Vector2[0].set(T(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),T(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));f.h.LerpToRef(this.targetScreenOffset,X,C,this.targetScreenOffset),f.h.Distance(this.targetScreenOffset,X)<w.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(X)):Q=!0}this._isInterpolating=Q}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Q=this.alpha;var X,C;this.alpha=function(Q){let X=Math.PI/2;return 0===Q.x&&0===Q.z||(X=Math.acos(Q.x/Math.sqrt(Math.pow(Q.x,2)+Math.pow(Q.z,2)))),Q.z<0&&(X=2*Math.PI-X),X}(this._computationVector),this.beta=(X=this._computationVector.y,C=this.radius,Math.acos(X/C));const l=Math.round((Q-this.alpha)/(2*Math.PI));this.alpha+=2*l*Math.PI,this._checkLimits()}setPosition(Q){this._position.equals(Q)||(this._position.p(Q),this.rebuildAnglesAndRadius())}setTarget(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(l=this.overrideCloneAlphaBetaRadius??l,Q.Vj)X&&Q.getBoundingInfo?this._targetBoundingCenter=Q.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Q.Vj(),this._targetHost=Q,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const X=Q,l=this._getTargetPosition();if(l&&!C&&l.equals(X))return;this._targetHost=null,this._target=X,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}l||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Q=Math.cos(this.alpha),X=Math.sin(this.alpha),C=Math.cos(this.beta);let l=Math.sin(this.beta);0===l&&(l=1e-4),0===this.radius&&(this.radius=1e-4);const h=this._getTargetPosition();if(this._computationVector.Yc(this.radius*Q*l,this.radius*C,this.radius*X*l),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),h.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const Q=this.va().collisionCoordinator;this._collider||(this._collider=Q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let Q=this.upVector;this.allowUpsideDown&&l<0&&(Q=Q.negate()),this._computeViewMatrix(this._position,h,Q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(h),this._viewMatrix}zoomOn(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Q=Q||this.va().meshes;const C=W.c.MinMax(Q);let l=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(l=Math.max(Math.min(l,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=l*this.zoomOnFactor,this.mode===x.d.ORTHOGRAPHIC_CAMERA){const Q=this.va().getEngine().getAspectRatio(this),X=l*this.zoomOnFactor/2;this.orthoLeft=-X*Q,this.orthoRight=X*Q,this.orthoBottom=-X,this.orthoTop=X}this.focusOn({min:C.min,max:C.max,distance:l},X)}focusOn(Q){let X,C,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Q.min){const l=Q||this.va().meshes;X=W.c.MinMax(l),C=f.k.Distance(X.min,X.max)}else{X=Q,C=Q.distance}this._target=W.c.Center(X),l||(this.maxZ=2*C)}createRigCamera(Q,X){let C=0;switch(this.cameraRigMode){case x.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case x.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case x.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case x.d.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===X?1:-1);break;case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===X?-1:1)}const l=new Y(Q,this.alpha+C,this.beta,this.radius,this._target,this.va());return l._cameraRigParams={},l.isRigCamera=!0,l.rigParent=this,l.upVector=this.upVector,l.mode=this.mode,l.orthoLeft=this.orthoLeft,l.orthoRight=this.orthoRight,l.orthoBottom=this.orthoBottom,l.orthoTop=this.orthoTop,l}_updateRigCameras(){const Q=this._rigCameras[0],X=this._rigCameras[1];switch(Q.beta=X.beta=this.beta,this.cameraRigMode){case x.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case x.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case x.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case x.d.RIG_MODE_VR:Q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const l=f.k.Distance(Q,X),h=this.va().getEngine().getAspectRatio(this),M=Math.tan(this.fov/2),O=M*h,m=.5*l*C,W=m*Math.sqrt(1+1/(O*O)),U=m*Math.sqrt(1+1/(M*M));return Math.max(W,U)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,l.c)([(0,h.N)()],Y.prototype,"alpha",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"beta",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"radius",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,l.c)([(0,h.K)("target")],Y.prototype,"_target",void 0),(0,l.c)([(0,h.C)("targetHost")],Y.prototype,"_targetHost",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"inertialAlphaOffset",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"inertialBetaOffset",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"inertialRadiusOffset",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"lowerAlphaLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"upperAlphaLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"lowerBetaLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"upperBetaLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"lowerRadiusLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"upperRadiusLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"lowerTargetYLimit",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"inertialPanningX",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"inertialPanningY",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"pinchToPanMaxDistance",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"panningDistanceLimit",void 0),(0,l.c)([(0,h.K)()],Y.prototype,"panningOriginTarget",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"panningInertia",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"zoomToMouseLocation",null),(0,l.c)([(0,h.N)()],Y.prototype,"zoomOnFactor",void 0),(0,l.c)([(0,h.H)()],Y.prototype,"targetScreenOffset",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"allowUpsideDown",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"useInputToRestoreState",void 0),(0,l.c)([(0,h.N)()],Y.prototype,"restoreStateInterpolationFactor",void 0),(0,o.g)("BABYLON.ArcRotateCamera",Y)},12987:(Q,X,C)=>{"use strict";C.d(X,{c:()=>f,g:()=>O});var l=C(501),h=C(695),M=C(642),f={};class O{constructor(Q){this.attachedToElement=!1,this.attached={},this.camera=Q,this.checkInputs=()=>{}}add(Q){const X=Q.getSimpleName();this.attached[X]?l.c.Warn("camera input of type "+X+" already exists on camera"):(this.attached[X]=Q,Q.camera=this.camera,Q.checkInputs&&(this.checkInputs=this._addCheckInputs(Q.checkInputs.bind(Q))),this.attachedToElement&&Q.attachControl(this.noPreventDefault))}remove(Q){for(const X in this.attached){const C=this.attached[X];if(C===Q)return C.Tj(),C.camera=null,delete this.attached[X],void this.rebuildInputCheck()}}removeByType(Q){for(const X in this.attached){const C=this.attached[X];C.getClassName()===Q&&(C.Tj(),C.camera=null,delete this.attached[X],this.rebuildInputCheck())}}_addCheckInputs(Q){const X=this.checkInputs;return()=>{X(),Q()}}attachInput(Q){this.attachedToElement&&Q.attachControl(this.noPreventDefault)}attachElement(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Q=!M.d.ForceAttachControlToAlwaysPreventDefault&&Q,this.attachedToElement=!0,this.noPreventDefault=Q;for(const X in this.attached)this.attached[X].attachControl(Q)}}detachElement(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const X in this.attached)this.attached[X].Tj(),Q&&(this.attached[X].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Q in this.attached){const X=this.attached[Q];X.checkInputs&&(this.checkInputs=this._addCheckInputs(X.checkInputs.bind(X)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Q){const X={};for(const C in this.attached){const Q=this.attached[C],l=h.d.Serialize(Q);X[Q.getClassName()]=l}Q.inputsmgr=X}parse(Q){const X=Q.inputsmgr;if(X){this.clear();for(const Q in X){const C=f[Q];if(C){const l=X[Q],M=h.d.Parse((()=>new C),l,null);this.add(M)}}}else for(const C in this.attached){const X=f[this.attached[C].getClassName()];if(X){const l=h.d.Parse((()=>new X),Q,null);this.remove(this.attached[C]),this.add(l)}}}}},12978:(Q,X,C)=>{"use strict";C.d(X,{e:()=>v});var l=C(644),h=C(650),M=C(668),f=C(12149),O=C(12987),m=C(2547),W=C(487);class U{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Q){Q=W.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const C=X.event;if(!C.metaKey)if(X.type===m.d.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),Q||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const X=this._keys.indexOf(C.keyCode);X>=0&&this._keys.splice(X,1),Q||C.preventDefault()}})))}Tj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Q=this.camera;for(let X=0;X<this._keys.length;X++){const C=this._keys[X],l=Q._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?Q._localDirection.Yc(-l,0,0):-1!==this.keysUp.indexOf(C)?Q._localDirection.Yc(0,0,l):-1!==this.keysRight.indexOf(C)?Q._localDirection.Yc(l,0,0):-1!==this.keysDown.indexOf(C)?Q._localDirection.Yc(0,0,-l):-1!==this.keysUpward.indexOf(C)?Q._localDirection.Yc(0,l,0):-1!==this.keysDownward.indexOf(C)?Q._localDirection.Yc(0,-l,0):-1!==this.keysRotateLeft.indexOf(C)?(Q._localDirection.Yc(0,0,0),Q.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(Q._localDirection.Yc(0,0,0),Q.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(Q._localDirection.Yc(0,0,0),Q.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(Q._localDirection.Yc(0,0,0),Q.cameraRotation.x+=this._getLocalRotation()),Q.va().useRightHandedSystem&&(Q._localDirection.z*=-1),Q.getViewMatrix().invertToRef(Q._cameraTransformMatrix),M.k.TransformNormalToRef(Q._localDirection,Q._cameraTransformMatrix,Q._transformedDirection),Q.cameraDirection.addInPlace(Q._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Q=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Q}}(0,l.c)([(0,h.N)()],U.prototype,"keysUp",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysUpward",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysDown",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysDownward",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysLeft",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysRight",void 0),(0,l.c)([(0,h.N)()],U.prototype,"rotationSpeed",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysRotateLeft",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysRotateRight",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysRotateUp",void 0),(0,l.c)([(0,h.N)()],U.prototype,"keysRotateDown",void 0),O.c.FreeCameraKeyboardMoveInput=U;var L=C(482),w=C(2545);class i{constructor(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Q,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new L.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Q){Q=W.i.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),C=X.getInputElement();this._pointerInput||(this._pointerInput=l=>{const h=l.event,M="touch"===h.pointerType;if(!this.touchEnabled&&M)return;if(l.type!==w.b.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const f=h.target;if(l.type===w.b.POINTERDOWN){if(M&&-1!==this._activePointerId||!M&&-1!==this._currentActiveButton)return;this._activePointerId=h.pointerId;try{null===f||void 0===f||f.setPointerCapture(h.pointerId)}catch(O){}-1===this._currentActiveButton&&(this._currentActiveButton=h.button),this._previousPosition={x:h.clientX,y:h.clientY},Q||(h.preventDefault(),C&&C.focus()),X.isPointerLock&&this._onMouseMove&&this._onMouseMove(l.event)}else if(l.type===w.b.POINTERUP){if(M&&this._activePointerId!==h.pointerId||!M&&this._currentActiveButton!==h.button)return;try{null===f||void 0===f||f.releasePointerCapture(h.pointerId)}catch(O){}this._currentActiveButton=-1,this._previousPosition=null,Q||h.preventDefault(),this._activePointerId=-1}else if(l.type===w.b.POINTERMOVE&&(this._activePointerId===h.pointerId||!M))if(X.isPointerLock&&this._onMouseMove)this._onMouseMove(l.event);else if(this._previousPosition){const X=this.camera._calculateHandednessMultiplier(),C=(h.clientX-this._previousPosition.x)*X,l=h.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=l/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:l}),this._previousPosition={x:h.clientX,y:h.clientY},Q||h.preventDefault()}}),this._onMouseMove=C=>{if(!X.isPointerLock)return;const l=this.camera._calculateHandednessMultiplier(),h=C.movementX*l;this.camera.cameraRotation.y+=h/this.angularSensibility;const M=C.movementY;this.camera.cameraRotation.x+=M/this.angularSensibility,this._previousPosition=null,Q||C.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,w.b.POINTERDOWN|w.b.POINTERUP|w.b.POINTERMOVE),C&&(this._contextMenuBind=Q=>this.onContextMenu(Q),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Q){Q.preventDefault()}Tj(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Q=this.camera.getEngine().getInputElement();Q&&Q.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,l.c)([(0,h.N)()],i.prototype,"buttons",void 0),(0,l.c)([(0,h.N)()],i.prototype,"angularSensibility",void 0),O.c.FreeCameraMouseInput=i;var a,F=C(2550);class s{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new L.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Q){Q=W.i.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==w.b.POINTERWHEEL)return;const C=X.event,l=C.deltaMode===F.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*l*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*l*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*l*C.deltaZ/this._normalize,C.preventDefault&&(Q||C.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,w.b.POINTERWHEEL)}Tj(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,l.c)([(0,h.N)()],s.prototype,"wheelPrecisionX",void 0),(0,l.c)([(0,h.N)()],s.prototype,"wheelPrecisionY",void 0),(0,l.c)([(0,h.N)()],s.prototype,"wheelPrecisionZ",void 0),function(Q){Q[Q.MoveRelative=0]="MoveRelative",Q[Q.RotateRelative=1]="RotateRelative",Q[Q.MoveScene=2]="MoveScene"}(a||(a={}));class z extends s{constructor(){super(...arguments),this._moveRelative=M.k.Zero(),this._rotateRelative=M.k.Zero(),this._moveScene=M.k.Zero(),this._wheelXAction=a.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=a.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Q){null===Q&&this._wheelXAction!==a.MoveRelative||(this._wheelXAction=a.MoveRelative,this._wheelXActionCoordinate=Q)}get wheelXMoveRelative(){return this._wheelXAction!==a.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Q){null===Q&&this._wheelYAction!==a.MoveRelative||(this._wheelYAction=a.MoveRelative,this._wheelYActionCoordinate=Q)}get wheelYMoveRelative(){return this._wheelYAction!==a.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Q){null===Q&&this._wheelZAction!==a.MoveRelative||(this._wheelZAction=a.MoveRelative,this._wheelZActionCoordinate=Q)}get wheelZMoveRelative(){return this._wheelZAction!==a.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Q){null===Q&&this._wheelXAction!==a.RotateRelative||(this._wheelXAction=a.RotateRelative,this._wheelXActionCoordinate=Q)}get wheelXRotateRelative(){return this._wheelXAction!==a.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Q){null===Q&&this._wheelYAction!==a.RotateRelative||(this._wheelYAction=a.RotateRelative,this._wheelYActionCoordinate=Q)}get wheelYRotateRelative(){return this._wheelYAction!==a.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Q){null===Q&&this._wheelZAction!==a.RotateRelative||(this._wheelZAction=a.RotateRelative,this._wheelZActionCoordinate=Q)}get wheelZRotateRelative(){return this._wheelZAction!==a.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Q){null===Q&&this._wheelXAction!==a.MoveScene||(this._wheelXAction=a.MoveScene,this._wheelXActionCoordinate=Q)}get wheelXMoveScene(){return this._wheelXAction!==a.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Q){null===Q&&this._wheelYAction!==a.MoveScene||(this._wheelYAction=a.MoveScene,this._wheelYActionCoordinate=Q)}get wheelYMoveScene(){return this._wheelYAction!==a.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Q){null===Q&&this._wheelZAction!==a.MoveScene||(this._wheelZAction=a.MoveScene,this._wheelZActionCoordinate=Q)}get wheelZMoveScene(){return this._wheelZAction!==a.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Zj(0),this._rotateRelative.Zj(0),this._moveScene.Zj(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const Q=M.b.Zero();this.camera.getViewMatrix().invertToRef(Q);const X=M.k.Zero();M.k.TransformNormalToRef(this._moveRelative,Q,X),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(X),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Q,X,C){if(0===Q)return;if(null===X||null===C)return;let l=null;switch(X){case a.MoveRelative:l=this._moveRelative;break;case a.RotateRelative:l=this._rotateRelative;break;case a.MoveScene:l=this._moveScene}switch(C){case 0:l.set(Q,0,0);break;case 1:l.set(0,Q,0);break;case 2:l.set(0,0,Q)}}}(0,l.c)([(0,h.N)()],z.prototype,"wheelXMoveRelative",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelYMoveRelative",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelZMoveRelative",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelXRotateRelative",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelYRotateRelative",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelZRotateRelative",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelXMoveScene",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelYMoveScene",null),(0,l.c)([(0,h.N)()],z.prototype,"wheelZMoveScene",null),O.c.FreeCameraMouseWheelInput=z;class x{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Q,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=W.i.IsSafari()}attachControl(Q){Q=W.i.BackCompatCameraNoPreventDefault(arguments);let X=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const l=C.event,h="mouse"===l.pointerType||this._isSafari&&"undefined"===typeof l.pointerType;if(this.allowMouse||!h)if(C.type===w.b.POINTERDOWN){if(Q||l.preventDefault(),this._pointerPressed.push(l.pointerId),1!==this._pointerPressed.length)return;X={x:l.clientX,y:l.clientY}}else if(C.type===w.b.POINTERUP){Q||l.preventDefault();const C=this._pointerPressed.indexOf(l.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;X=null,this._offsetX=null,this._offsetY=null}else if(C.type===w.b.POINTERMOVE){if(Q||l.preventDefault(),!X)return;if(0!=this._pointerPressed.indexOf(l.pointerId))return;this._offsetX=l.clientX-X.x,this._offsetY=-(l.clientY-X.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,w.b.POINTERDOWN|w.b.POINTERUP|w.b.POINTERMOVE),this._onLostFocus){const Q=this.camera.getEngine().getInputElement();Q&&Q.addEventListener("blur",this._onLostFocus)}}Tj(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Q=this.camera.getEngine().getInputElement();Q&&Q.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Q=this.camera,X=Q._calculateHandednessMultiplier();Q.cameraRotation.y=X*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Q.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const X=Q._computeLocalCameraSpeed(),C=new M.k(0,0,0!==this.touchMoveSensibility?X*this._offsetY/this.touchMoveSensibility:0);M.b.RotationYawPitchRollToRef(Q.rotation.y,Q.rotation.x,0,Q._cameraRotationMatrix),Q.cameraDirection.addInPlace(M.k.TransformCoordinates(C,Q._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,l.c)([(0,h.N)()],x.prototype,"touchAngularSensibility",void 0),(0,l.c)([(0,h.N)()],x.prototype,"touchMoveSensibility",void 0),O.c.FreeCameraTouchInput=x;class r extends O.g{constructor(Q){super(Q),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new U),this}addMouse(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new i(Q),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new z,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new x),this}clear(){super.clear(),this._mouseInput=null}}var P=C(620),j=C(554);class v extends f.e{get angularSensibility(){const Q=this.inputs.attached.mouse;return Q?Q.angularSensibility:0}set angularSensibility(Q){const X=this.inputs.attached.mouse;X&&(X.angularSensibility=Q)}get keysUp(){const Q=this.inputs.attached.keyboard;return Q?Q.keysUp:[]}set keysUp(Q){const X=this.inputs.attached.keyboard;X&&(X.keysUp=Q)}get keysUpward(){const Q=this.inputs.attached.keyboard;return Q?Q.keysUpward:[]}set keysUpward(Q){const X=this.inputs.attached.keyboard;X&&(X.keysUpward=Q)}get keysDown(){const Q=this.inputs.attached.keyboard;return Q?Q.keysDown:[]}set keysDown(Q){const X=this.inputs.attached.keyboard;X&&(X.keysDown=Q)}get keysDownward(){const Q=this.inputs.attached.keyboard;return Q?Q.keysDownward:[]}set keysDownward(Q){const X=this.inputs.attached.keyboard;X&&(X.keysDownward=Q)}get keysLeft(){const Q=this.inputs.attached.keyboard;return Q?Q.keysLeft:[]}set keysLeft(Q){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=Q)}get keysRight(){const Q=this.inputs.attached.keyboard;return Q?Q.keysRight:[]}set keysRight(Q){const X=this.inputs.attached.keyboard;X&&(X.keysRight=Q)}get keysRotateLeft(){const Q=this.inputs.attached.keyboard;return Q?Q.keysRotateLeft:[]}set keysRotateLeft(Q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateLeft=Q)}get keysRotateRight(){const Q=this.inputs.attached.keyboard;return Q?Q.keysRotateRight:[]}set keysRotateRight(Q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateRight=Q)}get keysRotateUp(){const Q=this.inputs.attached.keyboard;return Q?Q.keysRotateUp:[]}set keysRotateUp(Q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateUp=Q)}get keysRotateDown(){const Q=this.inputs.attached.keyboard;return Q?Q.keysRotateDown:[]}set keysRotateDown(Q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateDown=Q)}constructor(Q,X,C){var l;super(Q,X,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),l=this,this.ellipsoid=new M.k(.5,1,.5),this.ellipsoidOffset=new M.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=M.k.Zero(),this._diffPosition=M.k.Zero(),this._newPosition=M.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l._newPosition.p(X),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>j.e.CollisionsEpsilon&&(l.position.addToRef(l._diffPosition,l._deferredPositionUpdate),l._deferOnly?l._deferredUpdated=!0:l.position.p(l._deferredPositionUpdate),l.Ne&&C&&l.Ne(C))},this.inputs=new r(this),this.inputs.addKeyboard().addMouse()}attachControl(Q,X){X=W.i.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(X)}Tj(){this.inputs.detachElement(),this.cameraDirection=new M.k(0,0,0),this.cameraRotation=new M.h(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Q){this._collisionMask=isNaN(Q)?-1:Q}_collideWithWorld(Q){let X;X=this.parent?M.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,X.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.va().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let l=Q;this.applyGravity&&(l=Q.add(this.va().gravity)),C.getNewPosition(this._oldPosition,l,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=M.k.Zero(),this._transformedDirection=M.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Q){this._needMoveForGravity=Q}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,l.c)([(0,h.K)()],v.prototype,"ellipsoid",void 0),(0,l.c)([(0,h.K)()],v.prototype,"ellipsoidOffset",void 0),(0,l.c)([(0,h.N)()],v.prototype,"checkCollisions",void 0),(0,l.c)([(0,h.N)()],v.prototype,"applyGravity",void 0),(0,P.g)("BABYLON.FreeCamera",v)},13435:(Q,X,C)=>{"use strict";C.d(X,{c:()=>M});var l=C(663),h=C(13443);class M{constructor(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.bl=[],this._maxBlockCapacity=X||64,this._selectionContent=new l.c(1024),this._creationFunc=Q}update(Q,X,C){h.c._CreateBlocks(Q,X,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}rk(Q){for(let X=0;X<this.Mk.length;X++){this.Mk[X].addEntry(Q)}}sk(Q){for(let X=0;X<this.Mk.length;X++){this.Mk[X].removeEntry(Q)}}select(Q,X){this._selectionContent.reset();for(let C=0;C<this.Mk.length;C++){this.Mk[C].select(Q,this._selectionContent,X)}return X?this._selectionContent.concat(this.bl):this._selectionContent.concatWithNoDuplicate(this.bl),this._selectionContent}intersects(Q,X,C){this._selectionContent.reset();for(let l=0;l<this.Mk.length;l++){this.Mk[l].intersects(Q,X,this._selectionContent,C)}return C?this._selectionContent.concat(this.bl):this._selectionContent.concatWithNoDuplicate(this.bl),this._selectionContent}intersectsRay(Q){this._selectionContent.reset();for(let X=0;X<this.Mk.length;X++){this.Mk[X].intersectsRay(Q,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bl),this._selectionContent}}M.CreationFuncForMeshes=(Q,X)=>{const C=Q.getBoundingInfo();!Q.isBlocked&&C.boundingBox.intersectsMinMax(X.dl,X.el)&&X.entries.push(Q)},M.CreationFuncForSubMeshes=(Q,X)=>{Q.getBoundingInfo().boundingBox.intersectsMinMax(X.dl,X.el)&&X.entries.push(Q)}},13443:(Q,X,C)=>{"use strict";C.d(X,{c:()=>M});var l=C(668),h=C(756);class M{constructor(Q,X,C,l,h,M){this.entries=[],this.fl=new Array,this._capacity=C,this._depth=l,this._maxDepth=h,this._creationFunc=M,this._minPoint=Q,this._maxPoint=X,this.fl.push(Q.clone()),this.fl.push(X.clone()),this.fl.push(Q.clone()),this.fl[2].x=X.x,this.fl.push(Q.clone()),this.fl[3].y=X.y,this.fl.push(Q.clone()),this.fl[4].z=X.z,this.fl.push(X.clone()),this.fl[5].z=Q.z,this.fl.push(X.clone()),this.fl[6].x=Q.x,this.fl.push(X.clone()),this.fl[7].y=Q.y}get xb(){return this._capacity}get dl(){return this._minPoint}get el(){return this._maxPoint}addEntry(Q){if(this.Mk)for(let X=0;X<this.Mk.length;X++){this.Mk[X].addEntry(Q)}else this._creationFunc(Q,this),this.entries.length>this.xb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Q){if(this.Mk){for(let X=0;X<this.Mk.length;X++){this.Mk[X].removeEntry(Q)}return}const X=this.entries.indexOf(Q);X>-1&&this.entries.splice(X,1)}addEntries(Q){for(let X=0;X<Q.length;X++){const C=Q[X];this.addEntry(C)}}select(Q,X,C){if(h.d.IsInFrustum(this.fl,Q)){if(this.Mk){for(let l=0;l<this.Mk.length;l++){this.Mk[l].select(Q,X,C)}return}C?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersects(Q,X,C,l){if(h.d.IntersectsSphere(this._minPoint,this._maxPoint,Q,X)){if(this.Mk){for(let h=0;h<this.Mk.length;h++){this.Mk[h].intersects(Q,X,C,l)}return}l?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(Q,X){if(Q.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Mk){for(let C=0;C<this.Mk.length;C++){this.Mk[C].intersectsRay(Q,X)}return}X.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){M._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Q,X,C,h,f,O,m,W){m.Mk=new Array;const U=new l.k((X.x-Q.x)/2,(X.y-Q.y)/2,(X.z-Q.z)/2);for(let l=0;l<2;l++)for(let X=0;X<2;X++)for(let L=0;L<2;L++){const w=Q.add(U.multiplyByFloats(l,X,L)),i=Q.add(U.multiplyByFloats(l+1,X+1,L+1)),a=new M(w,i,h,f+1,O,W);a.addEntries(C),m.Mk.push(a)}}}},13451:(Q,X,C)=>{"use strict";C.d(X,{d:()=>U});var l=C(2522),h=C(668),M=C(800),f=C(12753),O=C(863),m=C(13435),W=C(524);l.e.prototype.createOrUpdateSelectionOctree=function(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(O.b.NAME_OCTREE);C||(C=new U(this),this.bb(C)),this._k||(this._k=new m.c(m.c.CreationFuncForMeshes,Q,X));const l=this.getWorldExtends();return this._k.update(l.min,l.max,this.meshes),this._k},Object.defineProperty(l.e.prototype,"selectionOctree",{get:function(){return this._k},enumerable:!0,configurable:!0}),M.d.prototype.createOrUpdateSubmeshesOctree=function(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.va();let l=C._getComponent(O.b.NAME_OCTREE);l||(l=new U(C),C.bb(l)),this._submeshesOctree||(this._submeshesOctree=new m.c(m.c.CreationFuncForSubMeshes,Q,X)),this.Vj(!0);const h=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(h.minimumWorld,h.maximumWorld,this.hk),this._submeshesOctree};class U{constructor(Q){this.name=O.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new f.d(h.k.Zero(),new h.k(1,1,1)),(Q=Q||W.b.LastCreatedScene)&&(this.ld=Q,this.ld.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ld.getActiveSubMeshCandidates=Q=>this.getActiveSubMeshCandidates(Q),this.ld.getCollidingSubMeshCandidates=(Q,X)=>this.getCollidingSubMeshCandidates(Q,X),this.ld.getIntersectingSubMeshCandidates=(Q,X)=>this.getIntersectingSubMeshCandidates(Q,X))}register(){this.ld.onMeshRemovedObservable.add((Q=>{const X=this.ld.selectionOctree;if(void 0!==X&&null!==X){const C=X.bl.indexOf(Q);-1!==C&&X.bl.splice(C,1)}})),this.ld.onMeshImportedObservable.add((Q=>{const X=this.ld.selectionOctree;void 0!==X&&null!==X&&X.rk(Q)}))}getActiveMeshCandidates(){var Q;return(null===(Q=this.ld._k)||void 0===Q?void 0:Q.select(this.ld.frustumPlanes))||this.ld._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Q){if(Q._submeshesOctree&&Q.useOctreeForRenderingSelection){return Q._submeshesOctree.select(this.ld.frustumPlanes)}return this.ld._getDefaultSubMeshCandidates(Q)}getIntersectingSubMeshCandidates(Q,X){if(Q._submeshesOctree&&Q.useOctreeForPicking){f.d.TransformToRef(X,Q.getWorldMatrix(),this._tempRay);return Q._submeshesOctree.intersectsRay(this._tempRay)}return this.ld._getDefaultSubMeshCandidates(Q)}getCollidingSubMeshCandidates(Q,X){if(Q._submeshesOctree&&Q.useOctreeForCollisions){const C=X._velocityWorldLength+Math.max(X._radius.x,X._radius.y,X._radius.z);return Q._submeshesOctree.intersects(X._basePointWorld,C)}return this.ld._getDefaultSubMeshCandidates(Q)}rebuild(){}dispose(){}}},12753:(Q,X,C)=>{"use strict";C.d(X,{d:()=>i});var l=C(2522),h=C(642),M=C(677),f=C(668),O=C(686),m=C(740),W=C(814),U=C(524),L=C(2555);const w={internalPickerForMesh:void 0};class i{constructor(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.b;this.origin=Q,this.direction=X,this.length=C,this.epsilon=l}clone(){return new i(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l=i._TmpVector3[0].Yc(Q.x-C,Q.y-C,Q.z-C),h=i._TmpVector3[1].Yc(X.x+C,X.y+C,X.z+C);let M,f,O,m,W=0,U=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<l.x||this.origin.x>h.x)return!1}else if(M=1/this.direction.x,f=(l.x-this.origin.x)*M,O=(h.x-this.origin.x)*M,O===-1/0&&(O=1/0),f>O&&(m=f,f=O,O=m),W=Math.max(f,W),U=Math.min(O,U),W>U)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<l.y||this.origin.y>h.y)return!1}else if(M=1/this.direction.y,f=(l.y-this.origin.y)*M,O=(h.y-this.origin.y)*M,O===-1/0&&(O=1/0),f>O&&(m=f,f=O,O=m),W=Math.max(f,W),U=Math.min(O,U),W>U)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<l.z||this.origin.z>h.z)return!1}else if(M=1/this.direction.z,f=(l.z-this.origin.z)*M,O=(h.z-this.origin.z)*M,O===-1/0&&(O=1/0),f>O&&(m=f,f=O,O=m),W=Math.max(f,W),U=Math.min(O,U),W>U)return!1;return!0}intersectsBox(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Q.minimum,Q.maximum,X)}intersectsSphere(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=Q.center.x-this.origin.x,l=Q.center.y-this.origin.y,h=Q.center.z-this.origin.z,M=C*C+l*l+h*h,f=Q.radius+X,O=f*f;if(M<=O)return!0;const m=C*this.direction.x+l*this.direction.y+h*this.direction.z;if(m<0)return!1;return M-m*m<=O}intersectsTriangle(Q,X,C){const l=i._TmpVector3[0],h=i._TmpVector3[1],M=i._TmpVector3[2],O=i._TmpVector3[3],W=i._TmpVector3[4];X.subtractToRef(Q,l),C.subtractToRef(Q,h),f.k.CrossToRef(this.direction,h,M);const U=f.k.Dot(l,M);if(0===U)return null;const L=1/U;this.origin.subtractToRef(Q,O);const w=f.k.Dot(O,M)*L;if(w<-this.epsilon||w>1+this.epsilon)return null;f.k.CrossToRef(O,l,W);const a=f.k.Dot(this.direction,W)*L;if(a<-this.epsilon||w+a>1+this.epsilon)return null;const F=f.k.Dot(h,W)*L;return F>this.length?null:new m.e(1-w-a,w,F)}intersectsPlane(Q){let X;const C=f.k.Dot(Q.ek,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const l=f.k.Dot(Q.ek,this.origin);return X=(-Q.d-l)/C,X<0?X<-9.99999997475243e-7?null:0:X}}intersectsAxis(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Q){case"y":{const Q=(this.origin.y-X)/this.direction.y;return Q>0?null:new f.k(this.origin.x+this.direction.x*-Q,X,this.origin.z+this.direction.z*-Q)}case"x":{const Q=(this.origin.x-X)/this.direction.x;return Q>0?null:new f.k(X,this.origin.y+this.direction.y*-Q,this.origin.z+this.direction.z*-Q)}case"z":{const Q=(this.origin.z-X)/this.direction.z;return Q>0?null:new f.k(this.origin.x+this.direction.x*-Q,this.origin.y+this.direction.y*-Q,X)}default:return null}}intersectsMesh(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=f.e.Matrix[0];return Q.getWorldMatrix().invertToRef(O),this._tmpRay?i.TransformToRef(this,O,this._tmpRay):this._tmpRay=i.Transform(this,O),Q.intersects(this._tmpRay,X,C,l,h,M)}intersectsMeshes(Q,X,C){C?C.length=0:C=[];for(let l=0;l<Q.length;l++){const h=this.intersectsMesh(Q[l],X);h.hit&&C.push(h)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(Q,X){return Q.distance<X.distance?-1:Q.distance>X.distance?1:0}intersectionSegment(Q,X,C){const l=this.origin,h=f.e.Yj[0],M=f.e.Yj[1],O=f.e.Yj[2],m=f.e.Yj[3];X.subtractToRef(Q,h),this.direction.scaleToRef(i._Rayl,O),l.addToRef(O,M),Q.subtractToRef(l,m);const W=f.k.Dot(h,h),U=f.k.Dot(h,O),L=f.k.Dot(O,O),w=f.k.Dot(h,m),a=f.k.Dot(O,m),F=W*L-U*U;let s,z,x=F,r=F;F<i._Smallnum?(s=0,x=1,z=a,r=L):(s=U*a-L*w,z=W*a-U*w,s<0?(s=0,z=a,r=L):s>x&&(s=x,z=a+U,r=L)),z<0?(z=0,-w<0?s=0:-w>W?s=x:(s=-w,x=W)):z>r&&(z=r,-w+U<0?s=0:-w+U>W?s=x:(s=-w+U,x=W));const P=Math.abs(s)<i._Smallnum?0:s/x,j=Math.abs(z)<i._Smallnum?0:z/r,v=f.e.Yj[4];O.scaleToRef(j,v);const Z=f.e.Yj[5];h.scaleToRef(P,Z),Z.addInPlace(m);const g=f.e.Yj[6];Z.subtractToRef(v,g);return j>0&&j<=this.length&&g.lengthSquared()<C*C?Z.length():-1}update(Q,X,C,l,h,M,O){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){i._RayDistant||(i._RayDistant=i.Zero()),i._RayDistant.unprojectRayToRef(Q,X,C,l,f.b.IdentityReadOnly,M,O);const m=f.e.Matrix[0];h.invertToRef(m),i.TransformToRef(i._RayDistant,m,this)}else this.unprojectRayToRef(Q,X,C,l,h,M,O);return this}static Zero(){return new i(f.k.Zero(),f.k.Zero())}static CreateNew(Q,X,C,l,h,M,f){return i.Zero().update(Q,X,C,l,h,M,f)}static CreateNewFromTo(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.IdentityReadOnly;const l=new i(new f.k(0,0,0),new f.k(0,0,0));return i.CreateFromToToRef(Q,X,l,C)}static CreateFromToToRef(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.b.IdentityReadOnly;C.origin.p(Q);const h=X.subtractToRef(Q,C.direction),M=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);return C.length=M,C.direction.normalize(),i.TransformToRef(C,l,C)}static Transform(Q,X){const C=new i(new f.k(0,0,0),new f.k(0,0,0));return i.TransformToRef(Q,X,C),C}static TransformToRef(Q,X,C){f.k.TransformCoordinatesToRef(Q.origin,X,C.origin),f.k.TransformNormalToRef(Q.direction,X,C.direction),C.length=Q.length,C.epsilon=Q.epsilon;const l=C.direction,h=l.length();if(0!==h&&1!==h){const Q=1/h;l.x*=Q,l.y*=Q,l.z*=Q,C.length*=h}return C}unprojectRayToRef(Q,X,C,l,h,M,O){const m=f.e.Matrix[0];h.multiplyToRef(M,m),m.multiplyToRef(O,m),m.invert();const W=U.b.LastCreatedEngine,L=f.e.Yj[0];L.x=Q/C*2-1,L.y=-(X/l*2-1),L.z=null!==W&&void 0!==W&&W.useReverseDepthBuffer?1:null!==W&&void 0!==W&&W.isNDCHalfZRange?0:-1;const w=f.e.Yj[1].Yc(L.x,L.y,1-1e-8),i=f.e.Yj[2],a=f.e.Yj[3];f.k._UnprojectFromInvertedMatrixToRef(L,m,i),f.k._UnprojectFromInvertedMatrixToRef(w,m,a),this.origin.p(i),a.subtractToRef(i,this.direction),this.direction.normalize()}}function a(Q,X,C,l,h){let M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=i.Zero();return F(Q,X,C,l,f,h,M),f}function F(Q,X,C,l,h,M){let O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const W=Q.getEngine();if(!M&&!(M=Q.activeCamera))return Q;const U=M.viewport,L=W.getRenderHeight(),{x:w,y:i,width:a,height:F}=U.toGlobal(W.getRenderWidth(),L),s=1/W.getHardwareScalingLevel();return X=X*s-w,C=C*s-(L-i-F),h.update(X,C,a,F,l||f.b.IdentityReadOnly,O?f.b.IdentityReadOnly:M.getViewMatrix(),M.getProjectionMatrix(),m),Q}function s(Q,X,C,l,h){if(!W.d)return Q;const M=Q.getEngine();if(!h&&!(h=Q.activeCamera))throw new Error("Active camera not set");const O=h.viewport,m=M.getRenderHeight(),{x:U,y:L,width:w,height:i}=O.toGlobal(M.getRenderWidth(),m),a=f.b.Identity(),F=1/M.getHardwareScalingLevel();return X=X*F-U,C=C*F-(m-L-i),l.update(X,C,w,i,a,a,h.getProjectionMatrix()),Q}function z(Q,X,C,l,h,M,f,O){const m=X(l,C.enableDistantPicking),W=C.intersects(m,h,f,M,l,O);return W&&W.hit?!h&&null!=Q&&W.distance>=Q.distance?null:W:null}function x(Q,X,C,l,h,M){let O=null;const m=!!(Q.activeCameras&&Q.activeCameras.length>1&&Q.cameraToUseForPointers!==Q.activeCamera),U=Q.cameraToUseForPointers||Q.activeCamera,L=w.internalPickerForMesh||z;for(let W=0;W<Q.meshes.length;W++){const w=Q.meshes[W];if(C){if(!C(w,-1))continue}else if(!w.isEnabled()||!w.isVisible||!w.gf)continue;const i=m&&w.isWorldMatrixCameraDependent(),a=w.Vj(i,U);if(w.hasThinInstances&&w.thinInstanceEnablePicking){const Q=L(O,X,w,a,!0,!0,M);if(Q){if(h)return Q;const m=f.e.Matrix[1],W=w.thinInstanceGetWorldMatrices();for(let Q=0;Q<W.length;Q++){if(C&&!C(w,Q))continue;W[Q].multiplyToRef(a,m);const f=L(O,X,w,m,l,h,M,!0);if(f&&(O=f,O.thinInstanceIndex=Q,l))return O}}}else{const Q=L(O,X,w,a,l,h,M);if(Q&&(O=Q,l))return O}}return O||new W.d}function r(Q,X,C,l){if(!W.d)return null;const h=[],M=!!(Q.activeCameras&&Q.activeCameras.length>1&&Q.cameraToUseForPointers!==Q.activeCamera),O=Q.cameraToUseForPointers||Q.activeCamera,m=w.internalPickerForMesh||z;for(let W=0;W<Q.meshes.length;W++){const U=Q.meshes[W];if(C){if(!C(U,-1))continue}else if(!U.isEnabled()||!U.isVisible||!U.gf)continue;const L=M&&U.isWorldMatrixCameraDependent(),w=U.Vj(L,O);if(U.hasThinInstances&&U.thinInstanceEnablePicking){if(m(null,X,U,w,!0,!0,l)){const Q=f.e.Matrix[1],M=U.thinInstanceGetWorldMatrices();for(let f=0;f<M.length;f++){if(C&&!C(U,f))continue;M[f].multiplyToRef(w,Q);const O=m(null,X,U,Q,!1,!1,l,!0);O&&(O.thinInstanceIndex=f,h.push(O))}}}else{const Q=m(null,X,U,w,!1,!1,l);Q&&h.push(Q)}}return h}function P(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;l||(l=Q.getWorldMatrix()),X.length=C,h?X.origin.p(h):X.origin.p(Q.position);const M=f.e.Yj[2];M.set(0,0,Q._scene.useRightHandedSystem?-1:1);const O=f.e.Yj[3];return f.k.TransformNormalToRef(M,l,O),f.k.NormalizeToRef(O,X.direction),X}var j,v;i._TmpVector3=(0,O.b)(6,f.k.Zero),i._RayDistant=i.Zero(),i._Smallnum=1e-8,i._Rayl=1e9,j=l.e,(v=h.d)&&(v.prototype.getForwardRay=function(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,X=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return P(this,new i(f.k.Zero(),f.k.Zero(),Q),Q,X,C)},v.prototype.getForwardRayToRef=function(Q){return P(this,Q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),j&&(L.d._IsPickingAvailable=!0,j.prototype.createPickingRay=function(Q,X,C,l){return a(this,Q,X,C,l,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),l.e.prototype.createPickingRayToRef=function(Q,X,C,l,h){return F(this,Q,X,C,l,h,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},l.e.prototype.createPickingRayInCameraSpace=function(Q,X,C){return function(Q,X,C,l){const h=i.Zero();return s(Q,X,C,h,l),h}(this,Q,X,C)},l.e.prototype.createPickingRayInCameraSpaceToRef=function(Q,X,C,l){return s(this,Q,X,C,l)},l.e.prototype.pickWithBoundingInfo=function(Q,X,C,l,h){return function(Q,X,C,l,h,M){if(!W.d)return null;const O=x(Q,(l=>(Q._tempPickingRay||(Q._tempPickingRay=i.Zero()),F(Q,X,C,l,Q._tempPickingRay,M||null),Q._tempPickingRay)),l,h,!0);return O&&(O.ray=a(Q,X,C,f.b.Identity(),M||null)),O}(this,Q,X,C,l,h)},l.e.prototype.Md=function(Q,X,C,l,h,M){return function(Q,X,C,l,h,M,O){const m=x(Q,((l,h)=>(Q._tempPickingRay||(Q._tempPickingRay=i.Zero()),F(Q,X,C,l,Q._tempPickingRay,M||null,!1,h),Q._tempPickingRay)),l,h,!1,O);return m&&(m.ray=a(Q,X,C,f.b.Identity(),M||null)),m}(this,Q,X,C,l,h,M)},l.e.prototype.pickWithRay=function(Q,X,C,l){return function(Q,X,C,l,h){const M=x(Q,(C=>(Q._pickWithRayInverseMatrix||(Q._pickWithRayInverseMatrix=f.b.Identity()),C.invertToRef(Q._pickWithRayInverseMatrix),Q._cachedRayForTransform||(Q._cachedRayForTransform=i.Zero()),i.TransformToRef(X,Q._pickWithRayInverseMatrix,Q._cachedRayForTransform),Q._cachedRayForTransform)),C,l,!1,h);return M&&(M.ray=X),M}(this,Q,X,C,l)},l.e.prototype.multiPick=function(Q,X,C,l,h){return function(Q,X,C,l,h,M){return r(Q,(l=>a(Q,X,C,l,h||null)),l,M)}(this,Q,X,C,l,h)},l.e.prototype.multiPickWithRay=function(Q,X,C){return function(Q,X,C,l){return r(Q,(C=>(Q._pickWithRayInverseMatrix||(Q._pickWithRayInverseMatrix=f.b.Identity()),C.invertToRef(Q._pickWithRayInverseMatrix),Q._cachedRayForTransform||(Q._cachedRayForTransform=i.Zero()),i.TransformToRef(X,Q._pickWithRayInverseMatrix,Q._cachedRayForTransform),Q._cachedRayForTransform)),C,l)}(this,Q,X,C)}},2508:(Q,X,C)=>{"use strict";var l=C(594),h=C(501),M=C(526),f=C(627),O=C(554),m=C(608);O.e.prototype._partialLoadFile=function(Q,X,C,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Q,(Q=>{C[X]=Q,C._internalCount++,6===C._internalCount&&l(C)}),void 0,void 0,!0,((Q,X)=>{h&&Q&&h(Q.status+" "+Q.statusText,X)}))},O.e.prototype._cascadeLoadFiles=function(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=[];h._internalCount=0;for(let M=0;M<6;M++)this._partialLoadFile(C[M],M,h,X,l)},O.e.prototype._cascadeLoadImgs=function(Q,X,C,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5?arguments[5]:void 0;const f=[];f._internalCount=0;for(let O=0;O<6;O++)this._partialLoadImg(l[O],O,f,Q,X,C,h,M)},O.e.prototype._partialLoadImg=function(Q,X,C,l,h,O){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0;const U=(0,f.d)();(0,M.s)(Q,(Q=>{C[X]=Q,C._internalCount++,l&&l.removePendingData(U),6===C._internalCount&&O&&O(h,C)}),((Q,X)=>{l&&l.removePendingData(U),m&&m(Q,X)}),l?l.offlineProvider:null,W),l&&l.addPendingData(U)},O.e.prototype.createCubeTextureBase=function(Q,X,C,M){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6?arguments[6]:void 0,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]&&arguments[8],w=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,s=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,z=arguments.length>14&&void 0!==arguments[14]&&arguments[14],x=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const r=a||new l.d(this,7);r.isCube=!0,r.url=Q,r.generateMipMaps=!M,r._lodGenerationScale=w,r._lodGenerationOffset=i,r._useSRGBBuffer=!!z&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!M),r!==a&&(r.label=Q.substring(0,60)),this._doNotHandleContextLost||(r._extension=U,r._files=C,r._buffer=x);const P=Q;this._transformTextureUrl&&!a&&(Q=this._transformTextureUrl(Q));const j=U??function(Q){const X=Q.split("?")[0],C=X.lastIndexOf(".");return C>-1?X.substring(C).toLowerCase():""}(Q),v=(0,m.e)(j),Z=(Q,X)=>{r.dispose(),O?O(Q,X):Q&&h.c.Warn(Q)},g=(l,O)=>{Q===P?l&&Z(l.status+" "+l.statusText,O):(h.c.Warn(`Failed to load ${Q}, falling back to the ${P}`),this.createCubeTextureBase(P,X,C,!!M,f,Z,W,U,L,w,i,r,F,s,z,x))};if(v)v.then((l=>{const h=Q=>{F&&F(r,Q),l.loadCubeData(Q,r,L,f,((Q,X)=>{Z(Q,X)}))};x?h(x):C&&6===C.length?l.supportCascades?this._cascadeLoadFiles(X,(Q=>h(Q.map((Q=>new Uint8Array(Q))))),C,Z):Z("Textures type does not support cascades."):this._loadFile(Q,(Q=>h(new Uint8Array(Q))),void 0,void 0,!0,g)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(X,r,((Q,X)=>{s&&s(Q,X)}),C,Z)}return this._internalTexturesCache.push(r),r}},13453:(Q,X,C)=>{"use strict";C(501);var l=C(2443);C(594),C(727),C(588),C(2492),C(2456);l.e},13060:(Q,X,C)=>{"use strict";C.d(X,{d:()=>h});var l=C(620);class h{constructor(Q){this.value=this._toInt(Q)}_toInt(Q){return 0|Q}add(Q){return new h(this.value+Q.value)}Od(Q){return new h(this.value-Q.value)}multiply(Q){return new h(Math.imul(this.value,Q.value))}divide(Q){return new h(this.value/Q.value)}getClassName(){return h.ClassName}equals(Q){return this.value===Q.value}static FromValue(Q){return new h(Q)}toString(){return this.value.toString()}}h.ClassName="FlowGraphInteger",(0,l.g)("FlowGraphInteger",h)},13067:(Q,X,C)=>{"use strict";C.d(X,{b:()=>h,e:()=>M});var l=C(668);class h{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ck=Q}get m(){return this.ck}transformVector(Q){return this.transformVectorToRef(Q,new l.h)}transformVectorToRef(Q,X){return X.x=Q.x*this.ck[0]+Q.y*this.ck[1],X.y=Q.x*this.ck[2]+Q.y*this.ck[3],X}dk(){return this.toArray()}toArray(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<4;X++)Q[X]=this.ck[X];return Q}Pd(Q){for(let X=0;X<4;X++)this.ck[X]=Q[X];return this}multiplyToRef(Q,X){const C=Q.ck,l=this.ck,h=X.ck;return h[0]=C[0]*l[0]+C[1]*l[2],h[1]=C[0]*l[1]+C[1]*l[3],h[2]=C[2]*l[0]+C[3]*l[2],h[3]=C[2]*l[1]+C[3]*l[3],X}multiply(Q){return this.multiplyToRef(Q,new h)}divideToRef(Q,X){const C=this.ck,l=Q.ck,h=X.ck;return h[0]=C[0]/l[0],h[1]=C[1]/l[1],h[2]=C[2]/l[2],h[3]=C[3]/l[3],X}divide(Q){return this.divideToRef(Q,new h)}addToRef(Q,X){const C=this.ck,l=Q.m,h=X.m;return h[0]=C[0]+l[0],h[1]=C[1]+l[1],h[2]=C[2]+l[2],h[3]=C[3]+l[3],X}add(Q){return this.addToRef(Q,new h)}subtractToRef(Q,X){const C=this.ck,l=Q.m,h=X.m;return h[0]=C[0]-l[0],h[1]=C[1]-l[1],h[2]=C[2]-l[2],h[3]=C[3]-l[3],X}Od(Q){return this.subtractToRef(Q,new h)}transpose(){const Q=this.ck;return new h([Q[0],Q[2],Q[1],Q[3]])}determinant(){const Q=this.ck;return Q[0]*Q[3]-Q[1]*Q[2]}inverse(){const Q=this.determinant();if(0===Q)throw new Error("Matrix is not invertible");const X=this.ck,C=1/Q;return new h([X[3]*C,-X[1]*C,-X[2]*C,X[0]*C])}equals(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.ck,l=Q.m;return 0===X?C[0]===l[0]&&C[1]===l[1]&&C[2]===l[2]&&C[3]===l[3]:Math.abs(C[0]-l[0])<X&&Math.abs(C[1]-l[1])<X&&Math.abs(C[2]-l[2])<X&&Math.abs(C[3]-l[3])<X}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ck.join(", ")})`}}class M{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ck=Q}get m(){return this.ck}transformVector(Q){return this.transformVectorToRef(Q,new l.k)}transformVectorToRef(Q,X){const C=this.ck;return X.x=Q.x*C[0]+Q.y*C[1]+Q.z*C[2],X.y=Q.x*C[3]+Q.y*C[4]+Q.z*C[5],X.z=Q.x*C[6]+Q.y*C[7]+Q.z*C[8],X}multiplyToRef(Q,X){const C=Q.ck,l=this.ck,h=X.m;return h[0]=C[0]*l[0]+C[1]*l[3]+C[2]*l[6],h[1]=C[0]*l[1]+C[1]*l[4]+C[2]*l[7],h[2]=C[0]*l[2]+C[1]*l[5]+C[2]*l[8],h[3]=C[3]*l[0]+C[4]*l[3]+C[5]*l[6],h[4]=C[3]*l[1]+C[4]*l[4]+C[5]*l[7],h[5]=C[3]*l[2]+C[4]*l[5]+C[5]*l[8],h[6]=C[6]*l[0]+C[7]*l[3]+C[8]*l[6],h[7]=C[6]*l[1]+C[7]*l[4]+C[8]*l[7],h[8]=C[6]*l[2]+C[7]*l[5]+C[8]*l[8],X}multiply(Q){return this.multiplyToRef(Q,new M)}divideToRef(Q,X){const C=this.ck,l=Q.m,h=X.m;return h[0]=C[0]/l[0],h[1]=C[1]/l[1],h[2]=C[2]/l[2],h[3]=C[3]/l[3],h[4]=C[4]/l[4],h[5]=C[5]/l[5],h[6]=C[6]/l[6],h[7]=C[7]/l[7],h[8]=C[8]/l[8],X}divide(Q){return this.divideToRef(Q,new M)}addToRef(Q,X){const C=this.ck,l=Q.m,h=X.m;return h[0]=C[0]+l[0],h[1]=C[1]+l[1],h[2]=C[2]+l[2],h[3]=C[3]+l[3],h[4]=C[4]+l[4],h[5]=C[5]+l[5],h[6]=C[6]+l[6],h[7]=C[7]+l[7],h[8]=C[8]+l[8],X}add(Q){return this.addToRef(Q,new M)}subtractToRef(Q,X){const C=this.ck,l=Q.m,h=X.m;return h[0]=C[0]-l[0],h[1]=C[1]-l[1],h[2]=C[2]-l[2],h[3]=C[3]-l[3],h[4]=C[4]-l[4],h[5]=C[5]-l[5],h[6]=C[6]-l[6],h[7]=C[7]-l[7],h[8]=C[8]-l[8],X}Od(Q){return this.subtractToRef(Q,new M)}toArray(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<9;X++)Q[X]=this.ck[X];return Q}dk(){return this.toArray()}Pd(Q){for(let X=0;X<9;X++)this.ck[X]=Q[X];return this}transpose(){const Q=this.ck;return new M([Q[0],Q[3],Q[6],Q[1],Q[4],Q[7],Q[2],Q[5],Q[8]])}determinant(){const Q=this.ck;return Q[0]*(Q[4]*Q[8]-Q[5]*Q[7])-Q[1]*(Q[3]*Q[8]-Q[5]*Q[6])+Q[2]*(Q[3]*Q[7]-Q[4]*Q[6])}inverse(){const Q=this.determinant();if(0===Q)throw new Error("Matrix is not invertible");const X=this.ck,C=1/Q;return new M([(X[4]*X[8]-X[5]*X[7])*C,(X[2]*X[7]-X[1]*X[8])*C,(X[1]*X[5]-X[2]*X[4])*C,(X[5]*X[6]-X[3]*X[8])*C,(X[0]*X[8]-X[2]*X[6])*C,(X[2]*X[3]-X[0]*X[5])*C,(X[3]*X[7]-X[4]*X[6])*C,(X[1]*X[6]-X[0]*X[7])*C,(X[0]*X[4]-X[1]*X[3])*C])}equals(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.ck,l=Q.m;return 0===X?C[0]===l[0]&&C[1]===l[1]&&C[2]===l[2]&&C[3]===l[3]&&C[4]===l[4]&&C[5]===l[5]&&C[6]===l[6]&&C[7]===l[7]&&C[8]===l[8]:Math.abs(C[0]-l[0])<X&&Math.abs(C[1]-l[1])<X&&Math.abs(C[2]-l[2])<X&&Math.abs(C[3]-l[3])<X&&Math.abs(C[4]-l[4])<X&&Math.abs(C[5]-l[5])<X&&Math.abs(C[6]-l[6])<X&&Math.abs(C[7]-l[7])<X&&Math.abs(C[8]-l[8])<X}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ck.join(", ")})`}}},13075:(Q,X,C)=>{"use strict";var l;function h(Q,X,C,l){switch(X){case"Animation":return l?Q.animations.find((Q=>Q.uniqueId===C))??null:Q.animations[C]??null;case"AnimationGroup":return l?Q.animationGroups.find((Q=>Q.uniqueId===C))??null:Q.animationGroups[C]??null;case"Mesh":return l?Q.meshes.find((Q=>Q.uniqueId===C))??null:Q.meshes[C]??null;case"Material":return l?Q.materials.find((Q=>Q.uniqueId===C))??null:Q.materials[C]??null;case"Sj":return l?Q.cameras.find((Q=>Q.uniqueId===C))??null:Q.cameras[C]??null;case"Light":return l?Q.lights.find((Q=>Q.uniqueId===C))??null:Q.lights[C]??null;default:return null}}C.d(X,{e:()=>h}),function(Q){Q.Animation="Animation",Q.AnimationGroup="AnimationGroup",Q.Mesh="Mesh",Q.Material="Material",Q.Sj="Sj",Q.Light="Light"}(l||(l={}))},13111:(Q,X,C)=>{"use strict";C.d(X,{c:()=>h});var l=C(13120);class h extends l.c{constructor(Q,X){if(super(Q),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),X)for(const C of X)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(Q){}_startPendingTasks(Q){Q._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Q),this._resetAfterCanceled(Q)),this._preparePendingTasks(Q),Q._addPendingBlock(this),this.out._activateSignal(Q),Q._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Q){Q._deleteExecutionVariable(this,"_initialized"),Q._removePendingBlock(this)}}},13092:(Q,X,C)=>{"use strict";C.d(X,{c:()=>W});var l=C(627),h=C(620),M=C(13096),f=C(482),O=C(13052);class m extends M.c{constructor(Q,X,C,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.defaultValue,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Q,X,C),this.richType=l,this._defaultValue=h,this._optional=M,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new f.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Q){this._isDisabled!==Q&&(this._isDisabled=Q,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Q,X){X._getConnectionValue(this)!==Q&&(X._setConnectionValue(this,Q),this.onValueChangedObservable.notifyObservers(Q))}resetToDefaultValue(Q){Q._setConnectionValue(this,this._defaultValue)}connectTo(Q){this._isDisabled||super.connectTo(Q)}_getValueOrDefault(Q){const X=Q._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(X):X}getValue(Q){if(1===this.connectionType){Q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Q);const X=this._getValueOrDefault(Q);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}const X=this.isConnected()?this._connectedPoint[0].getValue(Q):this._getValueOrDefault(Q);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Q),Q.richType={},this.richType.serialize(Q.richType),Q.optional=this._optional,(0,O.f)("defaultValue",this._defaultValue,Q)}}(0,h.g)("FlowGraphDataConnection",m);class W{constructor(Q){var X;this.config=Q,this.uniqueId=(0,l.d)(),this.name=(null===(X=this.config)||void 0===X?void 0:X.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Q){}registerDataInput(Q,X,C){const l=new m(Q,0,this,X,C);return this.dataInputs.push(l),l}registerDataOutput(Q,X,C){const l=new m(Q,1,this,X,C);return this.dataOutputs.push(l),l}getDataInput(Q){return this.dataInputs.find((X=>X.name===Q))}getDataOutput(Q){return this.dataOutputs.find((X=>X.name===Q))}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.f;if(Q.uniqueId=this.uniqueId,Q.config={},this.config){const C=this.config,l=Object.keys(C);for(const h of l)X(h,C[h],Q.config)}Q.dataInputs=[],Q.dataOutputs=[],Q.className=this.getClassName();for(const C of this.dataInputs){const X={};C.serialize(X),Q.dataInputs.push(X)}for(const C of this.dataOutputs){const X={};C.serialize(X),Q.dataOutputs.push(X)}}deserialize(Q){}_log(Q,X,C){var l;null===(l=Q.logger)||void 0===l||l.addLogItem({action:X,payload:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13096:(Q,X,C)=>{"use strict";C.d(X,{c:()=>M});var l,h=C(627);!function(Q){Q[Q.Input=0]="Input",Q[Q.Output=1]="Output"}(l||(l={}));class M{constructor(Q,X,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,h.d)(),this.connectedPointIds=[],this.name=Q,this._connectionType=X}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Q){if(this._connectionType===Q._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Q._isSingularConnection()&&Q._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Q),Q._connectedPoint.push(this)}disconnectFrom(Q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(Q),l=Q._connectedPoint.indexOf(this);-1!==C&&-1!==l&&(X&&this._connectedPoint.splice(C,1),Q._connectedPoint.splice(l,1))}disconnectFromAll(){for(const Q of this._connectedPoint)this.disconnectFrom(Q,!1);this._connectedPoint.length=0}dispose(){for(const Q of this._connectedPoint)this.disconnectFrom(Q)}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Q.uniqueId=this.uniqueId,Q.name=this.name,Q._connectionType=this._connectionType,Q.connectedPointIds=[],Q.className=this.getClassName();for(const X of this._connectedPoint)Q.connectedPointIds.push(X.uniqueId)}getClassName(){return"FGConnection"}deserialize(Q){this.uniqueId=Q.uniqueId,this.name=Q.name,this._connectionType=Q._connectionType,this.connectedPointIds=Q.connectedPointIds}}},13048:(Q,X,C)=>{"use strict";C.d(X,{c:()=>r});var l,h=C(482),M=C(644),f=C(650),O=C(627),m=C(13052),W=C(13075),U=C(501);!function(Q){Q.ExecuteBlock="ExecuteBlock",Q.ExecuteEvent="ExecuteEvent",Q.TriggerConnection="TriggerConnection",Q.ContextVariableSet="ContextVariableSet",Q.GlobalVariableSet="GlobalVariableSet",Q.GlobalVariableDelete="GlobalVariableDelete",Q.GlobalVariableGet="GlobalVariableGet",Q.AddConnection="AddConnection",Q.GetConnectionValue="GetConnectionValue",Q.SetConnectionValue="SetConnectionValue",Q.ActivateSignal="ActivateSignal",Q.ContextVariableGet="ContextVariableGet"}(l||(l={}));class L{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Q){if(Q.time||(Q.time=Date.now()),this.log.push(Q),this.logToConsole){var X;const C=null===(X=Q.payload)||void 0===X?void 0:X.value;"object"===typeof C&&C.getClassName?U.c.Log(`[FGLog] ${Q.className}:${Q.uniqueId.split("-")[0]} ${Q.action} - ${JSON.stringify(C.getClassName())}: ${C.toString()}`):U.c.Log(`[FGLog] ${Q.className}:${Q.uniqueId.split("-")[0]} ${Q.action} - ${JSON.stringify(Q.payload)}`)}}getItemsOfType(Q){return this.log.filter((X=>X.action===Q))}}class w{get enableLogging(){return this._enableLogging}set enableLogging(Q){this._enableLogging!==Q&&(this._enableLogging=Q,this._enableLogging?(this.logger=new L,this.logger.logToConsole=!0):this.logger=null)}constructor(Q){this.uniqueId=(0,O.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new h.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Q,this.assetsContext=Q.assetsContext??Q.ld}hasVariable(Q){return Q in this._userVariables}setVariable(Q,X){var C;this._userVariables[Q]=X,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:Q,value:X}})}getAsset(Q,X){return(0,W.e)(this.assetsContext,Q,X)}getVariable(Q){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:Q,value:this._userVariables[Q]}}),this._userVariables[Q]}get userVariables(){return this._userVariables}va(){return this._configuration.ld}_getUniqueIdPrefixedName(Q,X){return`${Q.uniqueId}_${X}`}_getGlobalContextVariable(Q,X){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:Q,defaultValue:X,possibleValue:this._globalContextVariables[Q]}}),this._hasGlobalContextVariable(Q)?this._globalContextVariables[Q]:X}_setGlobalContextVariable(Q,X){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:Q,value:X}}),this._globalContextVariables[Q]=X}_deleteGlobalContextVariable(Q){var X;null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:Q}}),delete this._globalContextVariables[Q]}_hasGlobalContextVariable(Q){return Q in this._globalContextVariables}_setExecutionVariable(Q,X,C){this._executionVariables[this._getUniqueIdPrefixedName(Q,X)]=C}_getExecutionVariable(Q,X,C){return this._hasExecutionVariable(Q,X)?this._executionVariables[this._getUniqueIdPrefixedName(Q,X)]:C}_deleteExecutionVariable(Q,X){delete this._executionVariables[this._getUniqueIdPrefixedName(Q,X)]}_hasExecutionVariable(Q,X){return this._getUniqueIdPrefixedName(Q,X)in this._executionVariables}_hasConnectionValue(Q){return Q.uniqueId in this._connectionValues}_setConnectionValue(Q,X){var C;this._connectionValues[Q.uniqueId]=X,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:Q.uniqueId,value:X}})}_setConnectionValueByKey(Q,X){this._connectionValues[Q]=X}_getConnectionValue(Q){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:Q.uniqueId,value:this._connectionValues[Q.uniqueId]}}),this._connectionValues[Q.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Q){this._pendingBlocks.includes(Q)||(this._pendingBlocks.push(Q),this._pendingBlocks.sort(((Q,X)=>Q.priority-X.priority)))}_removePendingBlock(Q){const X=this._pendingBlocks.indexOf(Q);-1!==X&&this._pendingBlocks.splice(X,1)}_clearPendingBlocks(){for(const Q of this._pendingBlocks)Q._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Q){var X;this.onNodeExecutedObservable.notifyObservers(Q),null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:Q.getClassName(),uniqueId:Q.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Q){this._setGlobalContextVariable("timeSinceStart",Q.timeSinceStart),this._setGlobalContextVariable("deltaTime",Q.deltaTime);for(const C of this._pendingBlocks){var X;null===(X=C._executeOnTick)||void 0===X||X.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.f;Q.uniqueId=this.uniqueId,Q._userVariables={};for(const l in this._userVariables)X(l,this._userVariables[l],Q._userVariables);Q._connectionValues={};for(const l in this._connectionValues)X(l,this._connectionValues[l],Q._connectionValues);var C;this.assetsContext!==this.va()&&(Q._assetsContext={meshes:this.assetsContext.meshes.map((Q=>Q.id)),materials:this.assetsContext.materials.map((Q=>Q.id)),textures:this.assetsContext.textures.map((Q=>Q.name)),animations:this.assetsContext.animations.map((Q=>Q.name)),lights:this.assetsContext.lights.map((Q=>Q.id)),cameras:this.assetsContext.cameras.map((Q=>Q.id)),fm:null===(C=this.assetsContext.fm)||void 0===C?void 0:C.map((Q=>Q.name)),skeletons:this.assetsContext.skeletons.map((Q=>Q.id)),tk:this.assetsContext.tk.map((Q=>Q.name)),geometries:this.assetsContext.geometries.map((Q=>Q.id)),multiMaterials:this.assetsContext.multiMaterials.map((Q=>Q.id)),transformNodes:this.assetsContext.transformNodes.map((Q=>Q.id))})}getClassName(){return"FlowGraphContext"}}(0,M.c)([(0,f.N)()],w.prototype,"uniqueId",void 0);var i=C(13083),a=C(2545);class F{constructor(Q){this.onEventTriggeredObservable=new h.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Q,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.bk.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Q=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:Q}}),this._startingTime+=Q})),this._meshPickedObserver=this._scene.onPointerObservable.add((Q=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:Q})}),a.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Q=>{const X=Q.pointerId,C=Q.mesh,l=this._pointerUnderMeshState[X];!l&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:X,mesh:C}}):l&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:X,mesh:l}}):l&&C&&l!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:X,mesh:l,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:X,mesh:C,out:l}})),this._pointerUnderMeshState[X]=C}),a.b.POINTERMOVE)}dispose(){var Q,X,C,l,h;null===(Q=this._sceneDisposeObserver)||void 0===Q||Q.remove(),null===(X=this._sceneReadyObserver)||void 0===X||X.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(l=this._meshPickedObserver)||void 0===l||l.remove(),null===(h=this._meshUnderPointerObserver)||void 0===h||h.remove(),this.onEventTriggeredObservable.clear()}}var s,z=C(13104);!function(Q){Q[Q.Stopped=0]="Stopped",Q[Q.Started=1]="Started"}(s||(s={}));class x{get state(){return this._state}set state(Q){this._state=Q,this.onStateChangedObservable.notifyObservers(Q)}constructor(Q){this.onStateChangedObservable=new h.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Q.ld,this._sceneEventCoordinator=new F(this._scene),this._coordinator=Q.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Q=>{for(const X of this._executionContexts){const C=this._getContextualOrder(Q.type,X);for(const l of C)if(!l._executeEvent(X,Q.payload))break}switch(Q.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const X of this._executionContexts)X._notifyOnTick(Q.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const Q=new w({ld:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Q),Q}getContext(Q){return this._executionContexts[Q]}addEventBlock(Q){if("PointerOver"!==Q.type&&"PointerOut"!==Q.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Q.type&&this._eventBlocks[Q.type].push(Q),1===this.state)for(const X of this._executionContexts)Q._startPendingTasks(X);else this.onStateChangedObservable.addOnce((X=>{if(1===X)for(const C of this._executionContexts)Q._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Q=>{1===Q&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Q of this._executionContexts)for(const X in this._eventBlocks){const C=this._getContextualOrder(X,Q);for(const X of C)X._startPendingTasks(Q)}}_getContextualOrder(Q,X){const C=this._eventBlocks[Q].sort(((Q,X)=>X.initPriority-Q.initPriority));if("MeshPick"===Q){const Q=[];for(const l of C){const h=l.asset.getValue(X);let M=0;for(;M<C.length;M++){const Q=C[M].asset.getValue(X);if(h&&Q&&(0,z.o)(h,Q))break}Q.splice(M,0,l)}return Q}return C}dispose(){var Q;if(0!==this.state){this.state=0;for(const Q of this._executionContexts)Q._clearPendingBlocks();this._executionContexts.length=0;for(const Q in this._eventBlocks)this._eventBlocks[Q].length=0;null===(Q=this._eventObserver)||void 0===Q||Q.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Q){const X=[],C=new Set;for(const l in this._eventBlocks)for(const Q of this._eventBlocks[l])X.push(Q),C.add(Q.uniqueId);for(;X.length>0;){const l=X.pop();Q(l);for(const Q of l.dataInputs)for(const l of Q._connectedPoint)C.has(l._ownerBlock.uniqueId)||(X.push(l._ownerBlock),C.add(l._ownerBlock.uniqueId));if(l instanceof i.b)for(const Q of l.signalOutputs)for(const l of Q._connectedPoint)C.has(l._ownerBlock.uniqueId)||(X.push(l._ownerBlock),C.add(l._ownerBlock.uniqueId))}}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1?arguments[1]:void 0;Q.allBlocks=[],this.visitAllBlocks((X=>{const C={};X.serialize(C),Q.allBlocks.push(C)})),Q.executionContexts=[];for(const C of this._executionContexts){const l={};C.serialize(l,X),Q.executionContexts.push(l)}}}class r{constructor(Q){this.config=Q,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ld.bk.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ld.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Q=this._executeOnNextFrame.slice(0);if(Q.length)for(const X of Q){this.notifyCustomEvent(X.id,X.data,!1);const Q=this._executeOnNextFrame.findIndex((Q=>Q.uniqueId===X.uniqueId));-1!==Q&&this._executeOnNextFrame.splice(Q,1)}}));(r.SceneCoordinators.get(this.config.ld)??[]).push(this)}createGraph(){const Q=new x({ld:this.config.ld,coordinator:this});return this._flowGraphs.push(Q),Q}removeGraph(Q){const X=this._flowGraphs.indexOf(Q);-1!==X&&(Q.dispose(),this._flowGraphs.splice(X,1))}start(){for(const Q of this._flowGraphs)Q.start()}dispose(){var Q,X;for(const h of this._flowGraphs)h.dispose();this._flowGraphs.length=0,null===(Q=this._disposeObserver)||void 0===Q||Q.remove(),null===(X=this._onBeforeRenderObserver)||void 0===X||X.remove();const C=r.SceneCoordinators.get(this.config.ld)??[],l=C.indexOf(this);-1!==l&&C.splice(l,1)}serialize(Q,X){Q._flowGraphs=[];for(const C of this._flowGraphs){const l={};C.serialize(l,X),Q._flowGraphs.push(l)}Q.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Q){let X=this._customEventsMap.get(Q);return X||(X=new h.e,this._customEventsMap.set(Q,X)),X}notifyCustomEvent(Q,X){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Q,data:X,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Q)){const X=this._eventExecutionCounter.get(Q);if(this._eventExecutionCounter.set(Q,X+1),X>=r.MaxEventTypeExecutionPerFrame)return void(X===r.MaxEventTypeExecutionPerFrame&&U.c.Warn(`FlowGraphCoordinator: Too many executions of event "${Q}".`))}else this._eventExecutionCounter.set(Q,1);const C=this._customEventsMap.get(Q);C&&C.notifyObservers(X)}}r.MaxEventsPerType=30,r.MaxEventTypeExecutionPerFrame=30,r.SceneCoordinators=new Map},13107:(Q,X,C)=>{"use strict";C.d(X,{e:()=>h});var l=C(13111);class h extends l.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Q){Q._notifyExecuteNode(this),this.done._activateSignal(Q)}}},13083:(Q,X,C)=>{"use strict";C.d(X,{b:()=>O});var l=C(13092),h=C(13096),M=C(620);class f extends h.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Q){super.connectTo(Q),this._connectedPoint.sort(((Q,X)=>X.priority-Q.priority))}_activateSignal(Q){var X;if(null===(X=Q.logger)||void 0===X||X.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Q,this),Q._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(Q)}}(0,M.g)("FlowGraphSignalConnection",f);class O extends l.c{constructor(Q){super(Q),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Q){const X=new f(Q,0,this);return this.signalInputs.push(X),X}_registerSignalOutput(Q){const X=new f(Q,1,this);return this.signalOutputs.push(X),X}_unregisterSignalInput(Q){const X=this.signalInputs.findIndex((X=>X.name===Q));-1!==X&&(this.signalInputs[X].dispose(),this.signalInputs.splice(X,1))}_unregisterSignalOutput(Q){const X=this.signalOutputs.findIndex((X=>X.name===Q));-1!==X&&(this.signalOutputs[X].dispose(),this.signalOutputs.splice(X,1))}_reportError(Q,X){this.error.payload="string"===typeof X?new Error(X):X,this.error._activateSignal(Q)}getSignalInput(Q){return this.signalInputs.find((X=>X.name===Q))}getSignalOutput(Q){return this.signalOutputs.find((X=>X.name===Q))}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Q),Q.signalInputs=[],Q.signalOutputs=[];for(const X of this.signalInputs){const C={};X.serialize(C),Q.signalInputs.push(C)}for(const X of this.signalOutputs){const C={};X.serialize(C),Q.signalOutputs.push(C)}}deserialize(Q){for(let X=0;X<Q.signalInputs.length;X++){const C=this.getSignalInput(Q.signalInputs[X].name);if(!C)throw new Error("Could not find signal input with name "+Q.signalInputs[X].name+" in block "+Q.className);C.deserialize(Q.signalInputs[X])}for(let X=0;X<Q.signalOutputs.length;X++){const C=this.getSignalOutput(Q.signalOutputs[X].name);if(!C)throw new Error("Could not find signal output with name "+Q.signalOutputs[X].name+" in block "+Q.className);C.deserialize(Q.signalOutputs[X])}}getClassName(){return"FlowGraphExecutionBlock"}}},13120:(Q,X,C)=>{"use strict";C.d(X,{c:()=>h});var l=C(13083);class h extends l.b{constructor(Q){super(Q),this.out=this._registerSignalOutput("out")}}},13063:(Q,X,C)=>{"use strict";C.d(X,{B:()=>F,C:()=>S,G:()=>e,H:()=>g,J:()=>Z,d:()=>W,e:()=>w,f:()=>v,h:()=>s,l:()=>z,n:()=>x,p:()=>L,t:()=>j,v:()=>U,w:()=>i,y:()=>a});var l,h=C(668),M=C(702),f=C(13060),O=C(13067);!function(Q){Q.Any="any",Q.String="string",Q.Number="number",Q.Boolean="boolean",Q.Object="object",Q.Integer="FlowGraphInteger",Q.Vector2="Vector2",Q.Yj="Yj",Q.Vector4="Vector4",Q.Quaternion="Quaternion",Q.Matrix="Matrix",Q.Matrix2D="Matrix2D",Q.Matrix3D="Matrix3D",Q.mk="mk",Q.nk="nk"}(l||(l={}));class m{constructor(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Q,this.defaultValue=X,this.animationType=C}serialize(Q){Q.typeName=this.typeName,Q.defaultValue=this.defaultValue}}const W=new m("any",void 0),U=new m("string",""),L=new m("number",0,0),w=new m("boolean",!1),i=new m("Vector2",h.h.Zero(),5),a=new m("Yj",h.k.Zero(),1),F=new m("Vector4",h.o.Zero()),s=new m("Matrix",h.b.Identity(),3),z=new m("Matrix2D",new O.b),x=new m("Matrix3D",new O.e),r=new m("mk",M.b.Black(),4),P=new m("nk",new M.d(0,0,0,0),7),j=new m("Quaternion",h.c.Identity(),2);j.typeTransformer=Q=>{if(Q.getClassName){if("Vector4"===Q.getClassName())return h.c.Wj(Q.dk());if("Yj"===Q.getClassName())return h.c.FromEulerVector(Q);if("Matrix"===Q.getClassName())return h.c.FromRotationMatrix(Q)}return Q};const v=new m("FlowGraphInteger",new f.d(0),0);function Z(Q){const X=Q;switch(typeof Q){case"string":return U;case"number":return L;case"boolean":return w;case"object":if(X.getClassName)switch(X.getClassName()){case"Vector2":return i;case"Yj":return a;case"Vector4":return F;case"Matrix":return s;case"mk":return r;case"nk":return P;case"Quaternion":return j;case"FlowGraphInteger":return v;case"Matrix2D":return z;case"Matrix3D":return x}return W;default:return W}}function g(Q){switch(Q){case"string":return U;case"number":return L;case"boolean":return w;case"Vector2":return i;case"Yj":return a;case"Vector4":return F;case"Matrix":return s;case"mk":return r;case"nk":return P;case"Quaternion":return j;case"FlowGraphInteger":return v;case"Matrix2D":return z;case"Matrix3D":return x;default:return W}}function S(Q){switch(Q){case"number":default:return 0;case"Vector2":return 5;case"Yj":return 1;case"Matrix":return 3;case"mk":return 4;case"nk":return 7;case"Quaternion":return 2}}function e(Q){switch(Q){case 0:return L;case 5:return i;case 1:return a;case 3:return s;case 4:return r;case 7:return P;case 2:return j;default:return W}}},13052:(Q,X,C)=>{"use strict";C.d(X,{d:()=>U,f:()=>W,i:()=>L});var l=C(702),h=C(668),M=C(13060),f=C(13063),O=C(13067);function m(Q){return"Vector2"===Q||"Yj"===Q||"Vector4"===Q||"Quaternion"===Q||"mk"===Q||"nk"===Q}function W(Q,X,C){var l;const h=(null===X||void 0===X||null===(l=X.getClassName)||void 0===l?void 0:l.call(X))??"";if(m(h)||function(Q){return"Matrix"===Q||"Matrix2D"===Q||"Matrix3D"===Q}(h))C[Q]={value:X.dk(),className:h};else if("FlowGraphInteger"===h)C[Q]={value:X.value,className:h};else if(h&&(X.id||X.name))C[Q]={id:X.id,name:X.name,className:h};else{if("object"===typeof X)throw new Error(`Could not serialize value ${X}`);C[Q]=X}}function U(Q,X,C,W){const L=X[Q];let w;const i=(null===L||void 0===L?void 0:L.type)??(null===L||void 0===L?void 0:L.className);if(function(Q){return"Mesh"===Q||"AbstractMesh"===Q||"GroundMesh"===Q||"InstanceMesh"===Q||"LinesMesh"===Q||"GoldbergMesh"===Q||"GreasedLineMesh"===Q||"TrailMesh"===Q}(i)){let Q=W.meshes.filter((Q=>L.id?Q.id===L.id:Q.name===L.name));0===Q.length&&(Q=W.transformNodes.filter((Q=>L.id?Q.id===L.id:Q.name===L.name))),w=L.uniqueId?Q.find((Q=>Q.uniqueId===L.uniqueId)):Q[0]}else if(m(i))w=function(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Q)return h.h.Wj(X);if("Yj"===Q)return C&&(X[2]*=-1),h.k.Wj(X);if("Vector4"===Q)return h.o.Wj(X);if("Quaternion"===Q)return C&&(X[2]*=-1,X[3]*=-1),h.c.Wj(X);if("mk"===Q)return new l.b(X[0],X[1],X[2]);if("nk"===Q)return new l.d(X[0],X[1],X[2],X[3]);throw new Error(`Unknown vector class name ${Q}`)}(i,L.value);else if(function(Q){return"AnimationGroup"===Q}(i)){const Q=W.animationGroups.filter((Q=>Q.name===L.name));w=1===Q.length?Q[0]:Q.find((Q=>Q.uniqueId===L.uniqueId))}else w="Matrix"===i?h.b.Wj(L.value):"Matrix2D"===i?new O.b(L.value):"Matrix3D"===i?new O.e(L.value):"FlowGraphInteger"===i?M.d.FromValue(L.value):"number"===i||"string"===i||"boolean"===i?L.value[0]:L&&void 0!==L.value?L.value:Array.isArray(L)?L.reduce(((Q,X)=>X.eventData?(Q[X.id]={type:(0,f.H)(X.type)},"undefined"!==typeof X.value&&(Q[X.id].value=U("value",X,C,W)),Q):Q),{}):L;return w}function L(Q){return"FlowGraphJsonPointerParserBlock"===Q}},13104:(Q,X,C)=>{"use strict";function l(Q,X){return!(!Q.parent||Q.parent!==X&&!l(Q.parent,X))}function h(Q){if(Q.getClassName)return Q.getClassName()}function M(Q,X){return Q===X&&("Vector2"===Q||"Yj"===Q||"Vector4"===Q||"Quaternion"===Q)}function f(Q,X){return Q===X&&("Matrix"===Q||"Matrix2D"===Q||"Matrix3D"===Q)}function O(Q,X){return"FlowGraphInteger"===Q&&"FlowGraphInteger"===X}function m(Q,X){const C="number"===typeof Q||"number"===typeof(null===Q||void 0===Q?void 0:Q.value);return C&&!X?!isNaN(W(Q)):C}function W(Q){return"number"===typeof Q?Q:Q.value}C.d(X,{d:()=>O,h:()=>f,j:()=>M,m:()=>h,o:()=>l,s:()=>W,w:()=>m})},12503:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{SceneInstrumentation:()=>M});var l=C(487),h=C(2505);class M{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Q){Q!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Q,Q?(this._onBeforeActiveMeshesEvaluationObserver=this.ld.onBeforeActiveMeshesEvaluationObservable.add((()=>{l.i.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ld.onAfterActiveMeshesEvaluationObservable.add((()=>{l.i.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ld.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ld.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Q){Q!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Q,Q?(this._onBeforeRenderTargetsRenderObserver=this.ld.onBeforeRenderTargetsRenderObservable.add((()=>{l.i.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ld.onAfterRenderTargetsRenderObservable.add((()=>{l.i.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ld.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ld.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Q){Q!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Q,Q?(this._onBeforeParticlesRenderingObserver=this.ld.onBeforeParticlesRenderingObservable.add((()=>{l.i.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ld.onAfterParticlesRenderingObservable.add((()=>{l.i.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ld.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ld.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Q){Q!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Q,this.ld.spriteManagers&&(Q?(this._onBeforeSpritesRenderingObserver=this.ld.onBeforeSpritesRenderingObservable.add((()=>{l.i.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ld.onAfterSpritesRenderingObservable.add((()=>{l.i.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ld.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ld.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Q){Q!==this._capturePhysicsTime&&this.ld.onBeforePhysicsObservable&&(this._capturePhysicsTime=Q,Q?(this._onBeforePhysicsObserver=this.ld.onBeforePhysicsObservable.add((()=>{l.i.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ld.onAfterPhysicsObservable.add((()=>{l.i.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.ld.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ld.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Q){Q!==this._captureAnimationsTime&&(this._captureAnimationsTime=Q,Q?this._onAfterAnimationsObserver=this.ld.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ld.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Q){this._captureFrameTime=Q}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Q){this._captureInterFrameTime=Q}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Q){Q!==this._captureRenderTime&&(this._captureRenderTime=Q,Q?(this._onBeforeDrawPhaseObserver=this.ld.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),l.i.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ld.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),l.i.EndPerformanceCounter("Main render")}))):(this.ld.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ld.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Q){Q!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Q,Q?(this._onBeforeCameraRenderObserver=this.ld.onBeforeCameraRenderObservable.add((Q=>{this._cameraRenderTime.beginMonitoring(),l.i.StartPerformanceCounter(`Rendering camera ${Q.name}`)})),this._onAfterCameraRenderObserver=this.ld.onAfterCameraRenderObservable.add((Q=>{this._cameraRenderTime.endMonitoring(!1),l.i.EndPerformanceCounter(`Rendering camera ${Q.name}`)}))):(this.ld.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ld.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ld.getEngine()._drawCalls}constructor(Q){this.ld=Q,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new h.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new h.e,this._captureFrameTime=!1,this._frameTime=new h.e,this._captureRenderTime=!1,this._renderTime=new h.e,this._captureInterFrameTime=!1,this._interFrameTime=new h.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new h.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new h.e,this._capturePhysicsTime=!1,this._physicsTime=new h.e,this._captureAnimationsTime=!1,this._animationsTime=new h.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new h.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Q.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(l.i.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ld.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Q.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(l.i.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ak(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ak(),this._captureParticlesRenderTime&&this._particlesRenderTime.ak(),this._captureSpritesRenderTime&&this._spritesRenderTime.ak(),this._captureRenderTime&&this._renderTime.ak(),this._captureCameraRenderTime&&this._cameraRenderTime.ak()}))}dispose(){this._disposed||(this.ld.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ld.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ld.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ld.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ld.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ld.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ld.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ld.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ld.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ld.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ld.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ld.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ld.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ld.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ld.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ld.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ld.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ld=null,this._disposed=!0)}}},13041:(Q,X,C)=>{"use strict";C.d(X,{b:()=>U});var l=C(644),h=C(650),M=C(668),f=C(693),O=C(12240),m=C(12282),W=C(620);f.e.AddNodeConstructor("Light_Type_1",((Q,X)=>()=>new U(Q,M.k.Zero(),X)));class U extends m.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Q){this._shadowFrustumSize=Q,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Q){this._shadowOrthoScale=Q,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Q){this._orthoLeft=Q}get orthoRight(){return this._orthoRight}set orthoRight(Q){this._orthoRight=Q}get orthoTop(){return this._orthoTop}set orthoTop(Q){this._orthoTop=Q}get orthoBottom(){return this._orthoBottom}set orthoBottom(Q){this._orthoBottom=Q}constructor(Q,X,C){super(Q,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=X.scale(-1),this.direction=X}getClassName(){return"lb"}getTypeID(){return O.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Q,X,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Q):this._setDefaultAutoExtendShadowProjectionMatrix(Q,X,C)}_setDefaultFixedFrustumShadowProjectionMatrix(Q){const X=this.va().activeCamera;X&&M.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:X.Rj,void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,Q,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Q,X,C){const l=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Q=M.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let f=0;f<C.length;f++){const O=C[f];if(!O)continue;const m=O.getBoundingInfo().boundingBox;for(let C=0;C<m.vectorsWorld.length;C++)M.k.TransformCoordinatesToRef(m.vectorsWorld[C],X,Q),Q.x<this._orthoLeft&&(this._orthoLeft=Q.x),Q.y<this._orthoBottom&&(this._orthoBottom=Q.y),Q.x>this._orthoRight&&(this._orthoRight=Q.x),Q.y>this._orthoTop&&(this._orthoTop=Q.y),this.autoCalcShadowZBounds&&(Q.z<l&&(l=Q.z),Q.z>h&&(h=Q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=l,this._shadowMaxZ=h)}const h=this._orthoRight-this._orthoLeft,f=this._orthoTop-this._orthoBottom,O=void 0!==this.shadowMinZ?this.shadowMinZ:(null===l||void 0===l?void 0:l.Rj)||0,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===l||void 0===l?void 0:l.maxZ)||1e4,W=this.va().getEngine().useReverseDepthBuffer;M.b.OrthoOffCenterLHToRef(this._orthoLeft-h*this.shadowOrthoScale,this._orthoRight+h*this.shadowOrthoScale,this._orthoBottom-f*this.shadowOrthoScale,this._orthoTop+f*this.shadowOrthoScale,W?m:O,W?O:m,Q,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Q,X){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,X),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,X),this)}transferToNodeMaterialEffect(Q,X){return this.computeTransformedInformation()?(Q.setFloat3(X,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Q.setFloat3(X,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Q){const X=this._scene.getEngine();return!X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}getDepthMaxZ(Q){const X=this._scene.getEngine();return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Q,X){Q["DIRLIGHT"+X]=!0}}(0,l.c)([(0,h.N)()],U.prototype,"shadowFrustumSize",null),(0,l.c)([(0,h.N)()],U.prototype,"shadowOrthoScale",null),(0,l.c)([(0,h.N)()],U.prototype,"autoUpdateExtends",void 0),(0,l.c)([(0,h.N)()],U.prototype,"autoCalcShadowZBounds",void 0),(0,l.c)([(0,h.N)("orthoLeft")],U.prototype,"_orthoLeft",void 0),(0,l.c)([(0,h.N)("orthoRight")],U.prototype,"_orthoRight",void 0),(0,l.c)([(0,h.N)("orthoTop")],U.prototype,"_orthoTop",void 0),(0,l.c)([(0,h.N)("orthoBottom")],U.prototype,"_orthoBottom",void 0),(0,W.g)("BABYLON.DirectionalLight",U)},13377:(Q,X,C)=>{"use strict";C.d(X,{b:()=>U});var l=C(644),h=C(650),M=C(668),f=C(702),O=C(693),m=C(12240),W=C(620);O.e.AddNodeConstructor("Light_Type_3",((Q,X)=>()=>new U(Q,M.k.Zero(),X)));class U extends m.b{constructor(Q,X,C){super(Q,C),this.groundColor=new f.b(0,0,0),this.direction=X||M.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(Q){return this.direction=M.k.Normalize(Q.Od(M.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Q,X){const C=M.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,X),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.cb),X),this}transferToNodeMaterialEffect(Q,X){const C=M.k.Normalize(this.direction);return Q.setFloat3(X,C.x,C.y,C.z),this}Vj(){return this._worldMatrix||(this._worldMatrix=M.b.Identity()),this._worldMatrix}getTypeID(){return m.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Q,X){Q["HEMILIGHT"+X]=!0}}(0,l.c)([(0,h.p)()],U.prototype,"groundColor",void 0),(0,l.c)([(0,h.K)()],U.prototype,"direction",void 0),(0,W.g)("BABYLON.HemisphericLight",U)},13017:(Q,X,C)=>{"use strict";C.d(X,{c:()=>L});var l=C(644),h=C(650),M=C(668),f=C(693),O=C(12240),m=C(12282),W=C(2397),U=C(620);f.e.AddNodeConstructor("Light_Type_2",((Q,X)=>()=>new L(Q,M.k.Zero(),M.k.Zero(),0,0,X)));class L extends m.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Q){this._iesProfileTexture!==Q&&(this._iesProfileTexture=Q,this._iesProfileTexture&&L._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Q){this._angle=Q,this._cosHalfAngle=Math.cos(.5*Q),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Q){this._innerAngle=Q,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Q){this._shadowAngleScale=Q,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Q){this._projectionTextureLightNear=Q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Q){this._projectionTextureLightFar=Q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Q){this._projectionTextureUpDirection=Q,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Q){this._projectionTexture!==Q&&(this._projectionTexture=Q,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(L._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):L._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Q){return void 0!==Q.onGeneratedObservable}static _IsTexture(Q){return void 0!==Q.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Q){this._projectionTextureProjectionLightMatrix=Q,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Q,X,C,l,h,f){super(Q,f),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=M.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=M.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=M.k.Zero(),this._projectionTextureViewLightMatrix=M.b.Zero(),this._projectionTextureProjectionLightMatrix=M.b.Zero(),this._projectionTextureScalingMatrix=M.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=X,this.direction=C,this.angle=l,this.exponent=h}getClassName(){return"SpotLight"}getTypeID(){return O.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(Q){super._setDirection(Q),this._projectionTextureViewLightDirty=!0}_setPosition(Q){super._setPosition(Q),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Q,X,C){const l=this.va().activeCamera;if(!l)return;this._shadowAngleScale=this._shadowAngleScale||1;const h=this._shadowAngleScale*this._angle,f=void 0!==this.shadowMinZ?this.shadowMinZ:l.Rj,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,m=this.va().getEngine().useReverseDepthBuffer;M.b.PerspectiveFovLHToRef(h,1,m?O:f,m?f:O,Q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,m)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),M.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Q=this.projectionTextureLightFar,X=this.projectionTextureLightNear,C=Q/(Q-X),l=-C*X,h=1/Math.tan(this._angle/2);M.b.FromValuesToRef(h/1,0,0,0,0,h,0,0,0,0,C,1,0,0,l,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof W.e){const Q=this._projectionTexture.uScale/2,X=this._projectionTexture.vScale/2;M.b.FromValuesToRef(Q,0,0,0,0,X,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Q,X){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Q.setMatrix("textureProjectionMatrix"+X,this._projectionTextureMatrix),Q.setTexture("projectionLightTexture"+X,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Q.setTexture("iesLightTexture"+X,this._iesProfileTexture),this}transferToEffect(Q,X){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,X),C=M.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,X),C=M.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,X),this}transferToNodeMaterialEffect(Q,X){let C;return C=this.computeTransformedInformation()?M.k.Normalize(this.transformedDirection):M.k.Normalize(this.direction),this.va().useRightHandedSystem?Q.setFloat3(X,-C.x,-C.y,-C.z):Q.setFloat3(X,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Q){const X=this._scene.getEngine(),C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Q||void 0===Q?void 0:Q.Rj)??0;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?C:this._scene.getEngine().isNDCHalfZRange?0:C}getDepthMaxZ(Q){const X=this._scene.getEngine(),C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Q||void 0===Q?void 0:Q.maxZ)??1e4;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:C}prepareLightSpecificDefines(Q,X){Q["SPOTLIGHT"+X]=!0,Q["PROJECTEDLIGHTTEXTURE"+X]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Q["IESLIGHTTEXTURE"+X]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,l.c)([(0,h.N)()],L.prototype,"angle",null),(0,l.c)([(0,h.N)()],L.prototype,"innerAngle",null),(0,l.c)([(0,h.N)()],L.prototype,"shadowAngleScale",null),(0,l.c)([(0,h.N)()],L.prototype,"exponent",void 0),(0,l.c)([(0,h.N)()],L.prototype,"projectionTextureLightNear",null),(0,l.c)([(0,h.N)()],L.prototype,"projectionTextureLightFar",null),(0,l.c)([(0,h.N)()],L.prototype,"projectionTextureUpDirection",null),(0,l.c)([(0,h.G)("projectedLightTexture")],L.prototype,"_projectionTexture",void 0),(0,U.g)("BABYLON.SpotLight",L)},12749:(Q,X,C)=>{"use strict";C.d(X,{c:()=>f,f:()=>M,j:()=>O});const l={},h={};function M(Q,X){l[Q]=X}function f(Q,X){h[Q]=X}function O(Q){return h[Q]?h[Q]:null}},12664:(Q,X,C)=>{"use strict";C.d(X,{e:()=>Z,i:()=>K});var l,h=C(487),M=C(482),f=C(2522),O=C(524),m=C(501),W=C(792),U=C(526),L=C(530),w=C(627),i=C(554),a=C(517);!function(Q){Q[Q.Clean=0]="Clean",Q[Q.Stop=1]="Stop",Q[Q.Sync=2]="Sync",Q[Q.NoSync=3]="NoSync"}(l||(l={}));const F=new M.e,s={};let z=!1;function x(){return s[".babylon"]}function r(Q,X){const C=s[Q];return C||(m.c.Warn("Unable to find a plugin to load "+Q+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),X?x():void 0)}function P(Q,X,C){let l="Unable to load from "+(Q.rawData?"binary data":Q.url);return X?l+=`: ${X}`:C&&(l+=`: ${C}`),l}async function j(Q,X,C,l,h,M,f,O,m){var W;const L="data:"===(w=Q.url).substring(0,5)?w.substring(5):null;var w;if(Q.rawData&&!f)throw"When using ArrayBufferView to load data the file extension must be provided.";const z=L||f?"":function(Q){const X=Q.indexOf("?");-1!==X&&(Q=Q.substring(0,X));const C=Q.lastIndexOf(".");return Q.substring(C,Q.length).toLowerCase()}(Q.url);let P=f?r(f,!0):L?function(Q){for(const X in s){const C=s[X].plugin;if(C.canDirectLoad&&C.canDirectLoad(Q))return s[X]}return x()}(Q.url):r(z,!1);if(!P&&z){if(Q.url&&!Q.url.startsWith("blob:")){const X=await async function(Q,X){const C=X.method||"GET";return await new Promise(((l,h)=>{const M=new a.e;M.addEventListener("readystatechange",(()=>{if(4==M.readyState)if(200==M.status){const Q={};if(X.responseHeaders)for(const C of X.responseHeaders)Q[C]=M.getResponseHeader(C)||"";l({response:M.response,headerValues:Q})}else h(`Unable to fetch data from ${Q}. Error code: ${M.status}`)})),M.open(C,Q),M.send()}))}(Q.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=X.headerValues?X.headerValues["Content-Type"]:"";C&&(P=function(Q){for(const X in s){const C=s[X];if(C.mimeType===Q)return C}}(C))}P||(P=x())}if(!P)throw new Error(`No plugin or fallback for ${f??Q.url}`);if(!1===(null===m||void 0===m||null===(W=m[P.plugin.name])||void 0===W?void 0:W.enabled))throw new Error(`The '${P.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Q.rawData&&!P.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Q=>{if(P.plugin.createPlugin){const X=P.plugin.createPlugin(m??{});return X instanceof Promise?(X.then(Q).catch((Q=>{h("Error instantiating plugin.",Q)})),null):(Q(X),X)}return Q(P.plugin),P.plugin})((m=>{var W;if(!m)throw`The loader plugin corresponding to the '${f}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(F.notifyObservers(m),L&&(m.canDirectLoad&&m.canDirectLoad(Q.url)||!(0,U.k)(Q.url))){if(m.directLoad){const Q=m.directLoad(X,L);Q instanceof Promise?Q.then((Q=>{C(m,Q)})).catch((Q=>{h("Error in directLoad of _loadData: "+Q,Q)})):C(m,Q)}else C(m,L);return}const w=P.isBinary,a=(Q,l)=>{X.u?h("Scene has been disposed"):C(m,Q,l)};let s=null,z=!1;null===(W=m.bk)||void 0===W||W.add((()=>{z=!0,s&&(s.abort(),s=null),M()}));const x=()=>{if(z)return;const C=(Q,X)=>{h(null===Q||void 0===Q?void 0:Q.statusText,X)};if(!m.loadFile&&Q.rawData)throw"Plugin does not support loading ArrayBufferView.";s=m.loadFile?m.loadFile(X,Q.rawData||Q.file||Q.url,Q.rootUrl,a,l,w,C,O):X._loadFile(Q.file||Q.url,a,l,!0,w,C)},r=X.getEngine();let j=r.enableOfflineSupport;if(j){let C=!1;for(const l of X.disableOfflineSupportExceptionRules)if(l.test(Q.url)){C=!0;break}j=!C}j&&i.e.OfflineProviderFactory?X.offlineProvider=i.e.OfflineProviderFactory(Q.url,x,r.disableManifestCheck):x()}))}function v(Q,X){let C,l,M=null,f=null;if(X)if(X.name)C=`file:${X.name}`,l=X.name,M=X;else if(ArrayBuffer.isView(X))C="",l=(0,w.d)(),f=X;else if(X.startsWith("data:"))C=X,l="";else if(Q){const M=X;if("/"===M.substring(0,1))return h.i.Error("Wrong sceneFilename parameter"),null;C=Q+M,l=M}else C=X,l=h.i.GetFilename(X),Q=h.i.GetFolderPath(X);else C=Q,l=h.i.GetFilename(Q),Q=h.i.GetFolderPath(Q);return{url:C,rootUrl:Q,name:l,file:M,rawData:f}}function Z(Q){if("string"===typeof Q.extensions){const X=Q.extensions;s[X.toLowerCase()]={plugin:Q,isBinary:!1}}else{const X=Q.extensions,C=Object.keys(X);for(const l of C)s[l.toLowerCase()]={plugin:Q,isBinary:X[l].isBinary,mimeType:X[l].mimeType}}}async function g(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.b.LastCreatedScene,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",w=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!l)return m.c.Error("No scene available to import mesh to"),null;const i=v(X,C);if(!i)return null;const a={};l.addPendingData(a);const F=()=>{l.removePendingData(a)},s=(Q,X)=>{const C=P(i,Q,X);f?f(l,C,new L.k(C,L.g.SceneLoaderError,X)):m.c.Error(C),F()},z=M?Q=>{try{M(Q)}catch(X){s("Error in onProgress callback: "+X,X)}}:void 0,x=(Q,X,C,M,f,O,m,W)=>{if(l.importedMeshesFiles.push(i.url),h)try{h(Q,X,C,M,f,O,m,W)}catch(U){s("Error in onSuccess callback: "+U,U)}l.removePendingData(a)};return await j(i,l,((X,C,h)=>{if(X.rewriteRootURL&&(i.rootUrl=X.rewriteRootURL(i.rootUrl,h)),X.importMesh){const h=[],M=[],f=[];if(!X.importMesh(Q,l,C,i.rootUrl,h,M,f,s))return;l.loadingPluginName=X.name,x(h,M,f,[],[],[],[],[])}else{X.importMeshAsync(Q,l,C,i.rootUrl,z,i.name).then((Q=>{l.loadingPluginName=X.name,x(Q.meshes,Q.tk,Q.skeletons,Q.animationGroups,Q.transformNodes,Q.geometries,Q.lights,Q.spriteManagers)})).catch((Q=>{s(Q.message,Q)}))}}),z,s,F,W,U,w)}async function S(Q,X,C,l,h,M,f,O){return await new Promise(((m,W)=>{try{g(Q,X,C,l,((Q,X,C,l,h,M,f,O)=>{m({meshes:Q,tk:X,skeletons:C,animationGroups:l,transformNodes:h,geometries:M,lights:f,spriteManagers:O})}),h,((Q,X,C)=>{W(C||new Error(X))}),M,f,O).catch(W)}catch(L){W(L)}}))}async function e(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedEngine,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await R(Q,X,new f.e(C),l,M,m,W,U,L):h.i.Error("No engine available")}async function k(Q,X,C,l,h,M,f){return await new Promise(((O,m)=>{e(Q,X,C,(Q=>{O(Q)}),l,((Q,X,C)=>{m(C||new Error(X))}),h,M,f)}))}async function R(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return m.c.Error("No scene available to append to"),null;const i=v(Q,X);if(!i)return null;const a={};C.addPendingData(a);const F=()=>{C.removePendingData(a)};W.d.ShowLoadingScreen&&!z&&(z=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),z=!1})));const s=(Q,X)=>{const l=P(i,Q,X);M?M(C,l,new L.k(l,L.g.SceneLoaderError,X)):m.c.Error(l),F()},x=h?Q=>{try{h(Q)}catch(X){s("Error in onProgress callback",X)}}:void 0,r=()=>{if(l)try{l(C)}catch(Q){s("Error in onSuccess callback",Q)}C.removePendingData(a)};return await j(i,C,((Q,X)=>{if(Q.load){if(!Q.load(C,X,i.rootUrl,s))return;C.loadingPluginName=Q.name,r()}else{Q.loadAsync(C,X,i.rootUrl,x,i.name).then((()=>{C.loadingPluginName=Q.name,r()})).catch((Q=>{s(Q.message,Q)}))}}),x,s,F,f,U,w)}async function H(Q,X,C,l,h,M,f){return await new Promise(((O,m)=>{try{R(Q,X,C,(Q=>{O(Q)}),l,((Q,X,C)=>{m(C||new Error(X))}),h,M,f).catch(m)}catch(L){m(L)}}))}async function o(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return m.c.Error("No scene available to load asset container to"),null;const w=v(Q,X);if(!w)return null;const i={};C.addPendingData(i);const a=()=>{C.removePendingData(i)},F=(Q,X)=>{const l=P(w,Q,X);M?M(C,l,new L.k(l,L.g.SceneLoaderError,X)):m.c.Error(l),a()},s=h?Q=>{try{h(Q)}catch(X){F("Error in onProgress callback",X)}}:void 0,z=Q=>{if(l)try{l(Q)}catch(X){F("Error in onSuccess callback",X)}C.removePendingData(i)};return await j(w,C,((Q,X)=>{if(Q.loadAssetContainer){const l=Q.loadAssetContainer(C,X,w.rootUrl,F);if(!l)return;l.populateRootNodes(),C.loadingPluginName=Q.name,z(l)}else if(Q.loadAssetContainerAsync){Q.loadAssetContainerAsync(C,X,w.rootUrl,s,w.name).then((X=>{X.populateRootNodes(),C.loadingPluginName=Q.name,z(X)})).catch((Q=>{F(Q.message,Q)}))}else F("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),s,F,a,f,W,U)}async function T(Q,X,C,l,h,M,f){return await new Promise(((O,m)=>{try{o(Q,X,C,(Q=>{O(Q)}),l,((Q,X,C)=>{m(C||new Error(X))}),h,M,f).catch(m)}catch(L){m(L)}}))}async function Y(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void m.c.Error("No scene available to load animations to");if(l){for(const l of C.animatables)l.reset();C.stopAllAnimations();const Q=C.animationGroups.slice();for(const C of Q)C.dispose();const X=C.getNodes();for(const C of X)C.animations&&(C.animations=[])}else switch(h){case 0:const Q=C.animationGroups.slice();for(const X of Q)X.dispose();break;case 1:for(const X of C.animationGroups)X.stop();break;case 2:for(const X of C.animationGroups)X.reset(),X.restart();break;case 3:break;default:return void m.c.Error("Unknown animation group loading mode value '"+h+"'")}const a=C.animatables.length;await o(Q,X,C,(Q=>{Q.mergeAnimationsTo(C,C.animatables.slice(a),M),Q.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),f&&f(C)}),W,U,L,w,i)}async function J(Q,X,C,l,h,M,f,O,m,W){return await new Promise(((U,w)=>{try{Y(Q,X,C,l,h,M,(Q=>{U(Q)}),f,((Q,X,C)=>{w(C||new Error(X))}),O,m,W).catch(w)}catch(L){w(L)}}))}class K{static get ForceFullSceneLoadingForIncremental(){return W.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Q){W.d.ForceFullSceneLoadingForIncremental=Q}static get ShowLoadingScreen(){return W.d.ShowLoadingScreen}static set ShowLoadingScreen(Q){W.d.ShowLoadingScreen=Q}static get loggingLevel(){return W.d.loggingLevel}static set loggingLevel(Q){W.d.loggingLevel=Q}static get CleanBoneMatrixWeights(){return W.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Q){W.d.CleanBoneMatrixWeights=Q}static GetDefaultPlugin(){return x()}static GetPluginForExtension(Q){var X;return null===(X=r(Q,!0))||void 0===X?void 0:X.plugin}static IsPluginForExtensionAvailable(Q){return function(Q){return!!s[Q]}(Q)}static RegisterPlugin(Q){Z(Q)}static ImportMesh(Q,X,C,l,h,M,f,m,W){g(Q,X,C,l,h,M,f,m,W).catch((Q=>null===f||void 0===f?void 0:f(O.b.LastCreatedScene,null===Q||void 0===Q?void 0:Q.message,Q)))}static async ImportMeshAsync(Q,X,C,l,h,M,f){return await S(Q,X,C,l,h,M,f)}static Load(Q,X,C,l,h,M,f,m){e(Q,X,C,l,h,M,f,m).catch((Q=>null===M||void 0===M?void 0:M(O.b.LastCreatedScene,null===Q||void 0===Q?void 0:Q.message,Q)))}static async LoadAsync(Q,X,C,l,h,M){return await k(Q,X,C,l,h,M)}static Append(Q,X,C,l,h,M,f,m){R(Q,X,C,l,h,M,f,m).catch((Q=>null===M||void 0===M?void 0:M(C??O.b.LastCreatedScene,null===Q||void 0===Q?void 0:Q.message,Q)))}static async AppendAsync(Q,X,C,l,h,M){return await H(Q,X,C,l,h,M)}static LoadAssetContainer(Q,X,C,l,h,M,f,m){o(Q,X,C,l,h,M,f,m).catch((Q=>null===M||void 0===M?void 0:M(C??O.b.LastCreatedScene,null===Q||void 0===Q?void 0:Q.message,Q)))}static async LoadAssetContainerAsync(Q,X,C,l,h,M){return await T(Q,X,C,l,h,M)}static ImportAnimations(Q,X,C,l,h,M,f,m,W,U,L){Y(Q,X,C,l,h,M,f,m,W,U,L).catch((Q=>null===W||void 0===W?void 0:W(C??O.b.LastCreatedScene,null===Q||void 0===Q?void 0:Q.message,Q)))}static async ImportAnimationsAsync(Q,X,C,l,h,M,f,O,m,W,U){return await J(Q,X,C,l,h,M,O,W,U)}}K.NO_LOGGING=0,K.MINIMAL_LOGGING=1,K.SUMMARY_LOGGING=2,K.DETAILED_LOGGING=3,K.OnPluginActivatedObservable=F},13030:(Q,X,C)=>{"use strict";C.d(X,{c:()=>w});var l=C(644),h=C(650),M=C(487),f=C(668),O=C(2404),m=C(2397),W=C(620),U=C(482),L=C(695);C(2508);class w extends O.d{set boundingBoxSize(Q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Q))return;this._boundingBoxSize=Q;const X=this.va();X&&X.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Q){this._rotationY=Q,this.setReflectionTextureMatrix(f.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Q,X,C){let l="";for(const h of Q)l+=h;return new w(l,X,null,C,Q)}static CreateFromPrefilteredData(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=X.useDelayedTextureLoading;X.useDelayedTextureLoading=!1;const M=new w(Q,X,null,!1,null,null,null,void 0,!0,C,l);return X.useDelayedTextureLoading=h,M}constructor(Q,X){var C;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,w=arguments.length>8&&void 0!==arguments[8]&&arguments[8],i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,s=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,z=arguments.length>13?arguments[13]:void 0,x=arguments.length>14?arguments[14]:void 0;super(X),this.onLoadObservable=new U.e,this.boundingBoxPosition=f.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new f.b,this._buffer=null,this.name=Q,this.url=Q,this._noMipmap=h,this.mi=!1,this.isCube=!0,this._textureMatrix=f.b.Identity(),this.coordinatesMode=m.e.CUBIC_MODE;let r=null,P=null;null===l||Array.isArray(l)?(this._noMipmap=h,this._format=L,this._createPolynomials=a,r=l,this._loaderOptions=z,this._useSRGBBuffer=x,this._lodScale=F,this._lodOffset=s):(r=l.extensions??null,this._noMipmap=l.noMipmap??!1,M=l.files??null,P=l.buffer??null,this._format=l.format??5,w=l.prefiltered??!1,i=l.forcedExtension??null,this._createPolynomials=l.createPolynomials??!1,this._lodScale=l.lodScale??.8,this._lodOffset=l.lodOffset??0,this._loaderOptions=l.loaderOptions,this._useSRGBBuffer=l.useSRGBBuffer,O=l.X??null,W=l.onError??null),(Q||M)&&this.updateURL(Q,i,O,w,W,r,null===(C=this.va())||void 0===C?void 0:C.useDelayedTextureLoading,M,P)}getClassName(){return"CubeTexture"}updateURL(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Q),this.url=Q,X&&(this._forcedExtension=X);const W=Q.lastIndexOf("."),U=X||(W>-1?Q.substring(W).toLowerCase():""),L=0===U.indexOf(".dds"),w=0===U.indexOf(".env"),i=0===U.indexOf(".basis");if(w?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=l,l&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),O)this._files=O;else if(i||w||L||M||(M=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,M){for(let X=0;X<M.length;X++)this._files.push(Q+M[X]);this._extensions=M}this._buffer=m,f?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=h):this._loadTexture(C,h)}delayLoad(Q){4===this.delayLoadState&&(Q&&(this._forcedExtension=Q),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Q){var X,C;if(Q.updateFlag===this._textureMatrix.updateFlag)return;Q.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.va())||void 0===C||C.markAllMaterialsAsDirty(1,(Q=>-1!==Q.getActiveTextures().indexOf(this))));if(this._textureMatrix=Q,null===(X=this.va())||void 0===X||!X.useRightHandedSystem)return;const l=f.e.Yj[0],h=f.e.Quaternion[0],M=f.e.Yj[1];this._textureMatrix.decompose(l,h,M),h.z*=-1,h.w*=-1,f.b.ComposeToRef(l,h,M,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Q;return null!==(Q=this.va())&&void 0!==Q&&Q.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.va(),l=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const h=()=>{var X;(this.onLoadObservable.notifyObservers(this),l)&&(l.dispose(),null===(X=this.va())||void 0===X||X.markAllMaterialsAsDirty(1));Q&&Q()},f=(Q,C)=>{this._loadingError=!0,this._errorObject={message:Q,exception:C},X&&X(Q,C),m.e.OnTextureLoadErrorObservable.notifyObservers(this)};var O;this._texture?this._texture.isReady?M.i.SetImmediate((()=>h())):this._texture.onLoadedObservable.add((()=>h())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,Q,f,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,Q,f,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(O=this._texture)||void 0===O||O.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Q,X,C){const l=L.d.Parse((()=>{let l=!1;return Q.prefiltered&&(l=Q.prefiltered),new w(C+(Q.url??Q.name),X,Q.extensions,!1,Q.files||null,null,null,void 0,l,Q.forcedExtension)}),Q,X);if(Q.boundingBoxPosition&&(l.boundingBoxPosition=f.k.Wj(Q.boundingBoxPosition)),Q.boundingBoxSize&&(l.boundingBoxSize=f.k.Wj(Q.boundingBoxSize)),Q.animations)for(let h=0;h<Q.animations.length;h++){const X=Q.animations[h],C=(0,W.e)("BABYLON.Animation");C&&l.animations.push(C.Parse(X))}return l}clone(){let Q=0;const X=L.d.Clone((()=>{const X=new w(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Q=X.uniqueId,X}),this);return X.uniqueId=Q,X}}(0,l.c)([(0,h.N)()],w.prototype,"url",void 0),(0,l.c)([(0,h.K)()],w.prototype,"boundingBoxPosition",void 0),(0,l.c)([(0,h.K)()],w.prototype,"boundingBoxSize",null),(0,l.c)([(0,h.N)("rotationY")],w.prototype,"rotationY",null),(0,l.c)([(0,h.N)("files")],w.prototype,"_files",void 0),(0,l.c)([(0,h.N)("forcedExtension")],w.prototype,"_forcedExtension",void 0),(0,l.c)([(0,h.N)("extensions")],w.prototype,"_extensions",void 0),(0,l.c)([(0,h.z)("textureMatrix")],w.prototype,"_textureMatrix",void 0),(0,l.c)([(0,h.z)("textureMatrixRefraction")],w.prototype,"_textureMatrixRefraction",void 0),m.e._CubeTextureParser=w.Parse,(0,W.g)("BABYLON.CubeTexture",w)},13391:(Q,X,C)=>{"use strict";C.d(X,{b:()=>m});var l=C(501),h=C(2397),M=C(631),f=C(2449),O=C(594);f.ThinEngine.prototype.createDynamicTexture=function(Q,X,C,l){const h=new O.d(this,4);return h.baseWidth=Q,h.baseHeight=X,C&&(Q=this.needPOTTextures?(0,M.g)(Q,this._caps.maxTextureSize):Q,X=this.needPOTTextures?(0,M.g)(X,this._caps.maxTextureSize):X),h.width=Q,h.height=X,h.isReady=!1,h.generateMipMaps=C,h.samplingMode=l,this.updateTextureSamplingMode(l,h),this._internalTexturesCache.push(h),h},f.ThinEngine.prototype.updateDynamicTexture=function(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Q)return;const f=this._gl,O=f.TEXTURE_2D,m=this._bindTextureDirectly(O,Q,!0,M);this._unpackFlipY(void 0===C?Q.invertY:C),l&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const W=this._getWebGLTextureType(Q.type),U=this._getInternalFormat(h||Q.format),L=this._getRGBABufferInternalSizedFormat(Q.type,U);f.texImage2D(O,0,L,U,W,X),Q.generateMipMaps&&f.generateMipmap(O),m||this._bindTextureDirectly(O,null),l&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),h&&(Q.format=h),Q._dynamicTextureSource=X,Q._premulAlpha=l,Q.invertY=C||!1,Q.isReady=!0};class m extends h.e{constructor(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,O=arguments.length>6?arguments[6]:void 0;const m=!C||C._isScene;super(null,m?C:null===C||void 0===C?void 0:C.ld,m?!l:C,O,M,void 0,void 0,void 0,void 0,f),this.name=Q,this.wrapU=h.e.CLAMP_ADDRESSMODE,this.wrapV=h.e.CLAMP_ADDRESSMODE,this._generateMipMaps=l;const W=this._getEngine();if(!W)return;if(X.getContext)this._canvas=X,this._ownCanvas=!1,this._texture=W.createDynamicTexture(this._canvas.width,this._canvas.height,l,M);else{this._canvas=W.createCanvas(1,1),this._ownCanvas=!0;const Q=X;Q.width||0===Q.width?this._texture=W.createDynamicTexture(Q.width,Q.height,l,M):this._texture=W.createDynamicTexture(X,X,l,M)}const U=this.getSize();this._canvas.width!==U.width&&(this._canvas.width=U.width),this._canvas.height!==U.height&&(this._canvas.height=U.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Q){this._canvas.width=Q.width,this._canvas.height=Q.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Q.width,Q.height,this._generateMipMaps,this.samplingMode)}scale(Q){const X=this.getSize();X.width*=Q,X.height*=Q,this._recreate(X)}scaleTo(Q,X){const C=this.getSize();C.width=Q,C.height=X,this._recreate(C)}getContext(){return this._context}clear(Q){const X=this.getSize();Q&&(this._context.fillStyle=Q),this._context.clearRect(0,0,X.width,X.height)}update(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Q||Q,X,this._format||void 0,void 0,C)}drawText(Q,X,C,l,h,M,f){let O=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const m=this.getSize();if(M&&(this._context.fillStyle=M,this._context.fillRect(0,0,m.width,m.height)),this._context.font=l,null===X||void 0===X){const C=this._context.measureText(Q);X=(m.width-C.width)/2}if(null===C||void 0===C){const Q=parseInt(l.replace(/\D/g,""));C=m.height/2+Q/3.65}this._context.fillStyle=h||"",this._context.fillText(Q,X,C),O&&this.update(f)}dispose(){var Q,X;(super.dispose(),this._ownCanvas)&&(null===(Q=this._canvas)||void 0===Q||null===(X=Q.remove)||void 0===X||X.call(Q));this._canvas=null,this._context=null}clone(){const Q=this.va();if(!Q)return this;const X=this.getSize(),C=new m(this.name,X,Q,this._generateMipMaps);return C.mi=this.mi,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const Q=this.va();Q&&!Q.isReady()&&l.c.Warn("The scene must be ready before serializing the dynamic texture");const X=super.serialize();return m._IsCanvasElement(this._canvas)&&(X.base64String=this._canvas.toDataURL()),X.invertY=this._invertY,X.samplingMode=this.samplingMode,X}static _IsCanvasElement(Q){return void 0!==Q.toDataURL}_rebuild(){this.update()}}},12939:(Q,X,C)=>{"use strict";C.d(X,{d:()=>h});var l=C(2397);class h extends l.e{get depth(){return this._depth}constructor(Q,X,C,h,M,f){let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:l.e.TRILINEAR_SAMPLINGMODE,U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10?arguments[10]:void 0;super(null,f,!O,m),this.format=M,this._texture=f.getEngine().createRawTexture2DArray(Q,X,C,h,M,O,m,W,null,U,L),this._depth=h,this.is2DArray=!0}update(Q){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Q,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Q,X,C,l,M){return new h(Q,X,C,l,5,M,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12761:(Q,X,C)=>{"use strict";C.d(X,{d:()=>O,e:()=>m,h:()=>M,j:()=>f});var l=C(690),h=C(668);function M(Q,X){return`{X: ${Q.x.toFixed(X)} Y: ${Q.y.toFixed(X)}}`}function f(Q,X){return`{X: ${Q._x.toFixed(X)} Y: ${Q._y.toFixed(X)} Z: ${Q._z.toFixed(X)}}`}function O(Q,X){return 2*Math.acos((0,l.Clamp)(h.c.Dot(Q,X)))}function m(Q,X){const C=new h.c;return function(Q,X,C){const M=h.k.Cross(Q,X),f=Math.acos((0,l.Clamp)(h.k.Dot(Q,X),-1,1));h.c.RotationAxisToRef(M,f,C)}(Q,X,C),C}},12611:(Q,X,C)=>{"use strict";C.d(X,{c:()=>W});var l=C(668),h=C(702),M=C(477),f=C(735),O=C(795);C(12620);function m(Q){let X=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],M=[];let m=[];const W=Q.width||Q.size||1,U=Q.height||Q.size||1,L=Q.depth||Q.size||1,w=Q.wrap||!1;let i=void 0===Q.topBaseAt?1:Q.topBaseAt,a=void 0===Q.bottomBaseAt?0:Q.bottomBaseAt;i=(i+4)%4,a=(a+4)%4;let F=[2,0,3,1][i],s=[2,0,1,3][a],z=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(w){X=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],z=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Q=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const l=[17,18,19,16],h=[22,23,20,21];for(;F>0;)Q.unshift(Q.pop()),l.unshift(l.pop()),F--;for(;s>0;)C.unshift(C.pop()),h.unshift(h.pop()),s--;Q=Q.flat(),C=C.flat(),z=z.concat(Q).concat(C),X.push(l[0],l[2],l[3],l[0],l[1],l[2]),X.push(h[0],h[2],h[3],h[0],h[1],h[2])}const x=[W/2,U/2,L/2];m=z.reduce(((Q,X,C)=>Q.concat(X*x[C%3])),[]);const r=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,P=Q.faceUV||new Array(6),j=Q.faceColors,v=[];for(let f=0;f<6;f++)void 0===P[f]&&(P[f]=new l.o(0,0,1,1)),j&&void 0===j[f]&&(j[f]=new h.d(1,1,1,1));for(let l=0;l<6;l++)if(M.push(P[l].z,O.b?1-P[l].w:P[l].w),M.push(P[l].x,O.b?1-P[l].w:P[l].w),M.push(P[l].x,O.b?1-P[l].y:P[l].y),M.push(P[l].z,O.b?1-P[l].y:P[l].y),j)for(let Q=0;Q<4;Q++)v.push(j[l].r,j[l].g,j[l].b,j[l].a);f.b._ComputeSides(r,m,X,C,M,Q.frontUVs,Q.backUVs);const Z=new f.b;if(Z.indices=X,Z.xa=m,Z.ya=C,Z.Aa=M,j){const Q=r===f.b.DOUBLESIDE?v.concat(v):v;Z.za=Q}return Z}function W(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(Q,C);X.sideOrientation=M.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return m(X).Ca(l,X.updatable),l}f.b.CreateBox=m,M.c.CreateBox=function(Q,X){return W(Q,{size:X,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12620:(Q,X,C)=>{"use strict";C.d(X,{h:()=>s,e:()=>x,j:()=>z});var l=C(668),h=C(702),M=C(477),f=C(735),O=C(722);M.c._GroundMeshParser=(Q,X)=>m.Parse(Q,X);class m extends M.c{constructor(Q,X){super(Q,X),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Q,this._subdivisionsY=Q,this.subdivide(Q);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(X)}getHeightAtCoordinates(Q,X){const C=this.getWorldMatrix(),h=l.e.Matrix[5];C.invertToRef(h);const M=l.e.Yj[8];if(l.k.TransformCoordinatesFromFloatsToRef(Q,0,X,h,M),Q=M.x,X=M.z,Q<this._minX||Q>=this._maxX||X<=this._minZ||X>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const f=this._getFacetAt(Q,X),O=-(f.x*Q+f.z*X+f.w)/f.y;return l.k.TransformCoordinatesFromFloatsToRef(0,O,0,C,M),M.y}getNormalAtCoordinates(Q,X){const C=new l.k(0,1,0);return this.getNormalAtCoordinatesToRef(Q,X,C),C}getNormalAtCoordinatesToRef(Q,X,C){const h=this.getWorldMatrix(),M=l.e.Matrix[5];h.invertToRef(M);const f=l.e.Yj[8];if(l.k.TransformCoordinatesFromFloatsToRef(Q,0,X,M,f),Q=f.x,X=f.z,Q<this._minX||Q>this._maxX||X<this._minZ||X>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const O=this._getFacetAt(Q,X);return l.k.TransformNormalFromFloatsToRef(O.x,O.y,O.z,h,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Q,X){const C=Math.floor((Q+this._maxX)*this._subdivisionsX/this._width),l=Math.floor(-(X+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),h=this._heightQuads[l*this._subdivisionsX+C];let M;return M=X<h.slope.x*Q+h.slope.y?h.facet1:h.facet2,M}_initHeightQuads(){const Q=this._subdivisionsX,X=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<X;C++)for(let X=0;X<Q;X++){const h={slope:l.h.Zero(),facet1:new l.o(0,0,0,0),facet2:new l.o(0,0,0,0)};this._heightQuads[C*Q+X]=h}return this}_computeHeightQuads(){const Q=this.getVerticesData(O.g.PositionKind);if(!Q)return this;const X=l.e.Yj[3],C=l.e.Yj[2],h=l.e.Yj[1],M=l.e.Yj[0],f=l.e.Yj[4],m=l.e.Yj[5],W=l.e.Yj[6],U=l.e.Yj[7],L=l.e.Yj[8];let w=0,i=0,a=0,F=0,s=0,z=0,x=0;const r=this._subdivisionsX,P=this._subdivisionsY;for(let O=0;O<P;O++)for(let P=0;P<r;P++){w=3*P,i=O*(r+1)*3,a=(O+1)*(r+1)*3,X.x=Q[i+w],X.y=Q[i+w+1],X.z=Q[i+w+2],C.x=Q[i+w+3],C.y=Q[i+w+4],C.z=Q[i+w+5],h.x=Q[a+w],h.y=Q[a+w+1],h.z=Q[a+w+2],M.x=Q[a+w+3],M.y=Q[a+w+4],M.z=Q[a+w+5],F=(M.z-X.z)/(M.x-X.x),s=X.z-F*X.x,C.subtractToRef(X,f),h.subtractToRef(X,m),M.subtractToRef(X,W),l.k.CrossToRef(W,m,U),l.k.CrossToRef(f,W,L),U.normalize(),L.normalize(),z=-(U.x*X.x+U.y*X.y+U.z*X.z),x=-(L.x*C.x+L.y*C.y+L.z*C.z);const j=this._heightQuads[O*r+P];j.slope.Yc(F,s),j.facet1.Yc(U.x,U.y,U.z,z),j.facet2.Yc(L.x,L.y,L.z,x)}return this}serialize(Q){super.serialize(Q),Q.subdivisionsX=this._subdivisionsX,Q.subdivisionsY=this._subdivisionsY,Q.minX=this._minX,Q.maxX=this._maxX,Q.Rj=this._minZ,Q.maxZ=this._maxZ,Q.width=this._width,Q.height=this._height}static Parse(Q,X){const C=new m(Q.name,X);return C._subdivisionsX=Q.subdivisionsX||1,C._subdivisionsY=Q.subdivisionsY||1,C._minX=Q.minX,C._maxX=Q.maxX,C._minZ=Q.Rj,C._maxZ=Q.maxZ,C._width=Q.width,C._height=Q.height,C}}var W=C(487),U=C(524),L=C(677),w=C(795);function i(Q){const X=[],C=[],h=[],M=[];let O,m;const W=Q.width||Q.size||1,U=Q.height||Q.size||1,L=0|(Q.subdivisionsX||Q.subdivisions||1),i=0|(Q.subdivisionsY||Q.subdivisions||1);for(O=0;O<=i;O++)for(m=0;m<=L;m++){const Q=new l.k(m*W/L-W/2,0,(i-O)*U/i-U/2),X=new l.k(0,1,0);C.push(Q.x,Q.y,Q.z),h.push(X.x,X.y,X.z),M.push(m/L,w.b?O/i:1-O/i)}for(O=0;O<i;O++)for(m=0;m<L;m++)X.push(m+1+(O+1)*(L+1)),X.push(m+1+O*(L+1)),X.push(m+O*(L+1)),X.push(m+(O+1)*(L+1)),X.push(m+1+(O+1)*(L+1)),X.push(m+O*(L+1));const a=new f.b;return a.indices=X,a.xa=C,a.ya=h,a.Aa=M,a}function a(Q){const X=void 0!==Q.xmin&&null!==Q.xmin?Q.xmin:-1,C=void 0!==Q.zmin&&null!==Q.zmin?Q.zmin:-1,h=void 0!==Q.xmax&&null!==Q.xmax?Q.xmax:1,M=void 0!==Q.zmax&&null!==Q.zmax?Q.zmax:1,O=Q.subdivisions||{w:1,h:1},m=Q.precision||{w:1,h:1},W=[],U=[],L=[],w=[];let i,a,F,s;O.h=O.h<1?1:O.h,O.w=O.w<1?1:O.w,m.w=m.w<1?1:m.w,m.h=m.h<1?1:m.h;const z=(h-X)/O.w,x=(M-C)/O.h;function r(Q,X,C,h){const M=U.length/3,f=m.w+1;for(i=0;i<m.h;i++)for(a=0;a<m.w;a++){const Q=[M+a+i*f,M+(a+1)+i*f,M+(a+1)+(i+1)*f,M+a+(i+1)*f];W.push(Q[1]),W.push(Q[2]),W.push(Q[3]),W.push(Q[0]),W.push(Q[1]),W.push(Q[3])}const O=l.k.Zero(),F=new l.k(0,1,0);for(i=0;i<=m.h;i++)for(O.z=i*(h-X)/m.h+X,a=0;a<=m.w;a++)O.x=a*(C-Q)/m.w+Q,O.y=0,U.push(O.x,O.y,O.z),L.push(F.x,F.y,F.z),w.push(a/m.w,i/m.h)}for(F=0;F<O.h;F++)for(s=0;s<O.w;s++)r(X+s*z,C+F*x,X+(s+1)*z,C+(F+1)*x);const P=new f.b;return P.indices=W,P.xa=U,P.ya=L,P.Aa=w,P}function F(Q){const X=[],C=[],M=[],O=[];let m,W;const U=Q.colorFilter||new h.b(.3,.59,.11),w=Q.alphaFilter||0;let i=!1;if(Q.minHeight>Q.maxHeight){i=!0;const X=Q.maxHeight;Q.maxHeight=Q.minHeight,Q.minHeight=X}for(m=0;m<=Q.subdivisions;m++)for(W=0;W<=Q.subdivisions;W++){const X=new l.k(W*Q.width/Q.subdivisions-Q.width/2,0,(Q.subdivisions-m)*Q.height/Q.subdivisions-Q.height/2),h=4*(((X.x+Q.width/2)/Q.width*(Q.bufferWidth-1)|0)+((1-(X.z+Q.height/2)/Q.height)*(Q.bufferHeight-1)|0)*Q.bufferWidth);let f=Q.buffer[h]/255,a=Q.buffer[h+1]/255,F=Q.buffer[h+2]/255;const s=Q.buffer[h+3]/255;i&&(f=1-f,a=1-a,F=1-F);const z=f*U.r+a*U.g+F*U.b;X.y=s>=w?Q.minHeight+(Q.maxHeight-Q.minHeight)*z:Q.minHeight-L.b,Q.heightBuffer&&(Q.heightBuffer[m*(Q.subdivisions+1)+W]=X.y),C.push(X.x,X.y,X.z),M.push(0,0,0),O.push(W/Q.subdivisions,1-m/Q.subdivisions)}for(m=0;m<Q.subdivisions;m++)for(W=0;W<Q.subdivisions;W++){const l=W+1+(m+1)*(Q.subdivisions+1),h=W+1+m*(Q.subdivisions+1),M=W+m*(Q.subdivisions+1),f=W+(m+1)*(Q.subdivisions+1),O=C[3*l+1]>=Q.minHeight,U=C[3*h+1]>=Q.minHeight,L=C[3*M+1]>=Q.minHeight;O&&U&&L&&(X.push(l),X.push(h),X.push(M));C[3*f+1]>=Q.minHeight&&O&&L&&(X.push(f),X.push(l),X.push(M))}f.b.ComputeNormals(C,X,M);const a=new f.b;return a.indices=X,a.xa=C,a.ya=M,a.Aa=O,a}function s(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new m(Q,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=X.subdivisionsX||X.subdivisions||1,C._subdivisionsY=X.subdivisionsY||X.subdivisions||1,C._width=X.width||1,C._height=X.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return i(X).Ca(C,X.updatable),C._setReady(!0),C}function z(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new M.c(Q,C);return a(X).Ca(l,X.updatable),l}function x(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const M=C.width||10,f=C.height||10,O=C.subdivisions||1,L=C.minHeight||0,w=C.maxHeight||1,i=C.colorFilter||new h.b(.3,.59,.11),a=C.alphaFilter||0,s=C.updatable,z=C.onReady;l=l||U.b.LastCreatedScene;const x=new m(Q,l);let r;x._subdivisionsX=O,x._subdivisionsY=O,x._width=M,x._height=f,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ,x._setReady(!1),C.passHeightBufferInCallback&&(r=new Float32Array((O+1)*(O+1)));const P=(Q,X,C)=>{F({width:M,height:f,subdivisions:O,minHeight:L,maxHeight:w,colorFilter:i,buffer:Q,bufferWidth:X,bufferHeight:C,alphaFilter:a,heightBuffer:r}).Ca(x,s),z&&z(x,r),x._setReady(!0)};if("string"===typeof X){const Q=Q=>{var X;const C=Q.width,h=Q.height;if(l.u)return;const M=null===(X=l)||void 0===X?void 0:X.getEngine().resizeImageBitmap(Q,C,h);P(M,C,h)};W.i.LoadImage(X,Q,C.onError?C.onError:()=>{},l.offlineProvider)}else P(X.data,X.width,X.height);return x}f.b.CreateGround=i,f.b.CreateTiledGround=a,f.b.CreateGroundFromHeightMap=F,M.c.CreateGround=(Q,X,C,l,h,M)=>s(Q,{width:X,height:C,subdivisions:l,updatable:M},h),M.c.CreateTiledGround=(Q,X,C,l,h,M,f,O,m)=>z(Q,{xmin:X,zmin:C,xmax:l,zmax:h,subdivisions:M,precision:f,updatable:m},O),M.c.CreateGroundFromHeightMap=(Q,X,C,l,h,M,f,O,m,W,U)=>x(Q,X,{width:C,height:l,subdivisions:h,minHeight:M,maxHeight:f,updatable:m,onReady:W,alphaFilter:U},O)},13265:(Q,X,C)=>{"use strict";C.d(X,{d:()=>i,g:()=>L,k:()=>w});var l=C(668),h=C(477),M=C(735),f=C(12244),O=C(722),m=C(501);function W(Q){const X=[],C=[],l=Q.lines,h=Q.za,f=[];let O=0;for(let M=0;M<l.length;M++){const Q=l[M];for(let l=0;l<Q.length;l++){const{x:m,y:W,z:U}=Q[l];if(C.push(m,W,U),h){const Q=h[M],{r:X,g:C,b:O,a:m}=Q[l];f.push(X,C,O,m)}l>0&&(X.push(O-1),X.push(O)),O++}}const m=new M.b;return m.indices=X,m.xa=C,h&&(m.za=f),m}function U(Q){const X=Q.dashSize||3,C=Q.gapSize||1,h=Q.dashNb||200,f=Q.points,O=[],m=[],W=l.k.Zero();let U=0,L=0,w=0,i=0,a=0,F=0,s=0;for(s=0;s<f.length-1;s++)f[s+1].subtractToRef(f[s],W),U+=W.length();for(w=U/h,i=X*w/(X+C),s=0;s<f.length-1;s++){f[s+1].subtractToRef(f[s],W),L=Math.floor(W.length()/w),W.normalize();for(let Q=0;Q<L;Q++)a=w*Q,O.push(f[s].x+a*W.x,f[s].y+a*W.y,f[s].z+a*W.z),O.push(f[s].x+(a+i)*W.x,f[s].y+(a+i)*W.y,f[s].z+(a+i)*W.z),m.push(F,F+1),F+=2}const z=new M.b;return z.xa=O,z.indices=m,z}function L(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=X.instance,h=X.lines,M=X.za;if(l){const Q=l.getVerticesData(O.g.PositionKind);let X,C;M&&(X=l.getVerticesData(O.g.ColorKind));let f=0,m=0;for(let l=0;l<h.length;l++){const O=h[l];for(let h=0;h<O.length;h++)Q[f]=O[h].x,Q[f+1]=O[h].y,Q[f+2]=O[h].z,M&&X&&(C=M[l],X[m]=C[h].r,X[m+1]=C[h].g,X[m+2]=C[h].b,X[m+3]=C[h].a,m+=4),f+=3}return l.updateVerticesData(O.g.PositionKind,Q,!1,!1),M&&X&&l.updateVerticesData(O.g.ColorKind,X,!1,!1),l.refreshBoundingInfo(),l}const m=!!M,U=new f.e(Q,C,null,void 0,void 0,m,X.useVertexAlpha,X.material);return W(X).Ca(U,X.updatable),U}function w(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=X.za?[X.za]:null;return L(Q,{lines:[X.points],updatable:X.updatable,instance:X.instance,za:l,useVertexAlpha:X.useVertexAlpha,material:X.material},C)}function i(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=X.points,O=X.instance,W=X.gapSize||1,L=X.dashSize||3;if(O){const Q=Q=>{const X=l.k.Zero(),C=Q.length/6;let h=0,f=0,m=0,W=0,U=0,L=0,w=0,i=0;for(w=0;w<M.length-1;w++)M[w+1].subtractToRef(M[w],X),h+=X.length();m=h/C;const a=O._creationDataStorage.dashSize;for(W=a*m/(a+O._creationDataStorage.gapSize),w=0;w<M.length-1;w++)for(M[w+1].subtractToRef(M[w],X),f=Math.floor(X.length()/m),X.normalize(),i=0;i<f&&L<Q.length;)U=m*i,Q[L]=M[w].x+U*X.x,Q[L+1]=M[w].y+U*X.y,Q[L+2]=M[w].z+U*X.z,Q[L+3]=M[w].x+(U+W)*X.x,Q[L+4]=M[w].y+(U+W)*X.y,Q[L+5]=M[w].z+(U+W)*X.z,L+=6,i++;for(;L<Q.length;)Q[L]=M[w].x,Q[L+1]=M[w].y,Q[L+2]=M[w].z,L+=3};return(X.dashNb||X.dashSize||X.gapSize||X.useVertexAlpha||X.material)&&m.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),O.updateMeshPositions(Q,!1),O}const w=new f.e(Q,C,null,void 0,void 0,void 0,X.useVertexAlpha,X.material);return U(X).Ca(w,X.updatable),w._creationDataStorage=new h.d,w._creationDataStorage.dashSize=L,w._creationDataStorage.gapSize=W,w}M.b.CreateLineSystem=W,M.b.CreateDashedLines=U,h.c.Ak=function(Q,X){return w(Q,{points:X,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},h.c.CreateDashedLines=function(Q,X,C,l,h){return i(Q,{points:X,dashSize:C,gapSize:l,dashNb:h,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12667:(Q,X,C)=>{"use strict";C.d(X,{d:()=>O,g:()=>m});var l=C(477),h=C(735),M=C(795);function f(Q){const X=[],C=[],l=[],f=[],O=void 0!==Q.width?Q.width:void 0!==Q.size?Q.size:1,m=void 0!==Q.height?Q.height:void 0!==Q.size?Q.size:1,W=0===Q.sideOrientation?0:Q.sideOrientation||h.b.DEFAULTSIDE,U=O/2,L=m/2;C.push(-U,-L,0),l.push(0,0,-1),f.push(0,M.b?1:0),C.push(U,-L,0),l.push(0,0,-1),f.push(1,M.b?1:0),C.push(U,L,0),l.push(0,0,-1),f.push(1,M.b?0:1),C.push(-U,L,0),l.push(0,0,-1),f.push(0,M.b?0:1),X.push(0),X.push(1),X.push(2),X.push(0),X.push(2),X.push(3),h.b._ComputeSides(W,C,X,l,f,Q.frontUVs,Q.backUVs);const w=new h.b;return w.indices=X,w.xa=C,w.ya=l,w.Aa=f,w}function O(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new l.c(Q,C);X.sideOrientation=l.c._GetDefaultSideOrientation(X.sideOrientation),h._originalBuilderSideOrientation=X.sideOrientation;return f(X).Ca(h,X.updatable),X.sourcePlane&&(h.translate(X.sourcePlane.ek,-X.sourcePlane.d),h.setDirection(X.sourcePlane.ek.scale(-1))),h}const m={Bk:O};h.b.Bk=f,l.c.Bk=(Q,X,C,l,h)=>O(Q,{size:X,width:X,height:X,sideOrientation:h,updatable:l},C)},12746:(Q,X,C)=>{"use strict";C.d(X,{e:()=>m});var l=C(668),h=C(477),M=C(735),f=C(795);function O(Q){const X=0|(Q.segments||32),C=Q.diameterX||Q.diameter||1,h=Q.diameterY||Q.diameter||1,O=Q.diameterZ||Q.diameter||1,m=Q.arc&&(Q.arc<=0||Q.arc>1)?1:Q.arc||1,W=Q.slice&&Q.slice<=0?1:Q.slice||1,U=0===Q.sideOrientation?0:Q.sideOrientation||M.b.DEFAULTSIDE,L=!!Q.dedupTopBottomIndices,w=new l.k(C/2,h/2,O/2),i=2+X,a=2*i,F=[],s=[],z=[],x=[];for(let M=0;M<=i;M++){const Q=M/i,X=Q*Math.PI*W;for(let C=0;C<=a;C++){const h=C/a,M=h*Math.PI*2*m,O=l.b.RotationZ(-X),W=l.b.RotationY(M),U=l.k.TransformCoordinates(l.k.Up(),O),L=l.k.TransformCoordinates(U,W),i=L.multiply(w),F=L.divide(w).normalize();s.push(i.x,i.y,i.z),z.push(F.x,F.y,F.z),x.push(h,f.b?1-Q:Q)}if(M>0){const Q=s.length/3;for(let X=Q-2*(a+1);X+a+2<Q;X++)L?(M>1&&(F.push(X),F.push(X+1),F.push(X+a+1)),(M<i||W<1)&&(F.push(X+a+1),F.push(X+1),F.push(X+a+2))):(F.push(X),F.push(X+1),F.push(X+a+1),F.push(X+a+1),F.push(X+1),F.push(X+a+2))}}M.b._ComputeSides(U,s,F,z,x,Q.frontUVs,Q.backUVs);const r=new M.b;return r.indices=F,r.xa=s,r.ya=z,r.Aa=x,r}function m(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return O(X).Ca(l,X.updatable),l}M.b.CreateSphere=O,h.c.CreateSphere=(Q,X,C,l,h,M)=>m(Q,{segments:X,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:M,updatable:h},l)},13402:(Q,X,C)=>{"use strict";C.d(X,{e:()=>O});var l=C(12267),h=C(13037),M=C(12273),f=C(735);class O{static get Configuration(){return{get decoder(){return h.e.DefaultConfiguration},set decoder(Q){h.e.DefaultConfiguration=Q}}}static set Configuration(Q){h.e.DefaultConfiguration=Q.decoder}static get DecoderAvailable(){return(0,l.i)(h.e.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(Q){O._Default&&(Q||O._Default.dispose(),O._Default=null)}constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultNumWorkers;const X="number"===typeof Q?{...h.e.DefaultConfiguration,numWorkers:Q}:{...h.e.DefaultConfiguration,...Q};this._decoder=new h.e(X)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Q,X,C){return this._decoder.decodeMeshToMeshDataAsync(Q,X,C)}async decodeMeshToGeometryAsync(Q,X,C,l){return await this._decoder.decodeMeshToGeometryAsync(Q,X,C,l)}async _decodeMeshToGeometryForGltfAsync(Q,X,C,l,h,M){return await this._decoder._decodeMeshToGeometryForGltfAsync(Q,X,C,l,h,M)}async decodeMeshAsync(Q,X){const C=await this._decoder.decodeMeshToMeshDataAsync(Q,X),l=new f.b;C.indices&&(l.indices=C.indices);for(const h of C.attributes){const Q=M.d.GetFloatData(h.data,h.size,M.d.GetDataType(h.data),h.byteOffset,h.byteStride,h.normalized,C.totalVertices);l.set(Q,h.kind)}return l}}O.DefaultNumWorkers=(0,l.g)(),O._Default=null},13037:(Q,X,C)=>{"use strict";C.d(X,{e:()=>W});var l=C(12267),h=C(487),M=C(783),f=C(12273),O=C(501),m=C(12270);class W extends l.c{static get DefaultAvailable(){return(0,l.i)(W.DefaultConfiguration)}static get Default(){return W._Default??(W._Default=new W),W._Default}static ResetDefault(Q){W._Default&&(Q||W._Default.dispose(),W._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Q,X){return{module:await(X||DracoDecoderModule)({wasmBinary:Q})}}_getWorkerContent(){return`${m.e}(${m.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DefaultConfiguration)}decodeMeshToMeshDataAsync(Q,X,C){const l=Q instanceof ArrayBuffer?new Int8Array(Q):new Int8Array(Q.buffer,Q.byteOffset,Q.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Q=>await new Promise(((h,M)=>{Q.push(((Q,f)=>{let m=null;const W=[],U=X=>{Q.removeEventListener("error",U),Q.removeEventListener("message",L),M(X),f()},L=X=>{const l=X.data;switch(l.id){case"indices":m=l.data;break;case"attribute":W.push({kind:l.kind,data:l.data,size:l.size,byteOffset:l.byteOffset,byteStride:l.byteStride,normalized:(M=l.kind,w=l.normalized,C&&void 0!==C[M]?(w!==C[M]&&O.c.Warn(`Normalized flag from Draco data (${w}) does not match normalized flag from glTF accessor (${C[M]}). Using flag from glTF accessor.`),C[M]):w)});break;case"decodeMeshDone":Q.removeEventListener("error",U),Q.removeEventListener("message",L),h({indices:m,attributes:W,totalVertices:l.totalVertices}),f()}var M,w};Q.addEventListener("error",U),Q.addEventListener("message",L);const w=l.slice();Q.postMessage({id:"decodeMesh",dataView:w,attributes:X},[w.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Q=>{let C=null;const h=[],M=(0,m.e)(Q.module,l,X,(Q=>{C=Q}),((Q,X,C,l,M,f)=>{h.push({kind:Q,data:X,size:C,byteOffset:l,byteStride:M,normalized:f})}));return{indices:C,attributes:h,totalVertices:M}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Q,X,C,l){const h=await this.decodeMeshToMeshDataAsync(C,l),O=new M.e(Q,X);h.indices&&O.setIndices(h.indices);for(const M of h.attributes)O.setVerticesBuffer(new f.d(X.getEngine(),M.data,M.kind,!1,void 0,M.byteStride,void 0,M.byteOffset,M.size,void 0,M.normalized,!0),h.totalVertices);return O}async _decodeMeshToGeometryForGltfAsync(Q,X,C,l,h,O){const m=await this.decodeMeshToMeshDataAsync(C,l,h),W=new M.e(Q,X);O&&(W._boundingInfo=O,W.useBoundingInfoFromGeometry=!0),m.indices&&W.setIndices(m.indices);for(const M of m.attributes)W.setVerticesBuffer(new f.d(X.getEngine(),M.data,M.kind,!1,void 0,M.byteStride,void 0,M.byteOffset,M.size,void 0,M.normalized,!0),m.totalVertices);return W}}W.DefaultConfiguration={wasmUrl:`${h.i._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${h.i._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${h.i._DefaultCdnUrl}/draco_decoder_gltf.js`},W._Default=null},13258:(Q,X,C)=>{"use strict";C.d(X,{c:()=>OQ});var l=C(668),h=C(477),M=C(722),f=C(735),O=C(795);function m(Q){let X=Q.pathArray;const C=Q.closeArray||!1,l=Q.closePath||!1,h=Q.invertUV||!1,m=Math.floor(X[0].length/2);let W=Q.offset||m;W=W>m?m:Math.floor(W);const U=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,L=Q.Aa,w=Q.za,i=[],a=[],F=[],s=[],z=[],x=[],r=[],P=[];let j;const v=[],Z=[];let g,S,e;if(X.length<2){const Q=[],C=[];for(S=0;S<X[0].length-W;S++)Q.push(X[0][S]),C.push(X[0][S+W]);X=[Q,C]}let k=0;const R=l?1:0,H=C?1:0;let o,T,Y,J,K,N;for(j=X[0].length,g=0;g<X.length+H;g++){for(r[g]=0,z[g]=[0],o=g===X.length?X[0]:X[g],T=o.length,j=j<T?j:T,e=0;e<T;)i.push(o[e].x,o[e].y,o[e].z),e>0&&(Y=o[e].Od(o[e-1]).length(),J=Y+r[g],z[g].push(J),r[g]=J),e++;l&&(e--,i.push(o[0].x,o[0].y,o[0].z),Y=o[e].Od(o[0]).length(),J=Y+r[g],z[g].push(J),r[g]=J),v[g]=T+R,Z[g]=k,k+=T+R}let q,n,c=null,E=null;for(S=0;S<j+R;S++)for(P[S]=0,x[S]=[0],g=0;g<X.length-1+H;g++)K=X[g],N=g===X.length-1?X[0]:X[g+1],S===j?(c=K[0],E=N[0]):(c=K[S],E=N[S]),Y=E.Od(c).length(),J=Y+P[S],x[S].push(J),P[S]=J;if(L)for(g=0;g<L.length;g++)s.push(L[g].x,O.b?1-L[g].y:L[g].y);else for(g=0;g<X.length+H;g++)for(S=0;S<j+R;S++)q=0!=r[g]?z[g][S]/r[g]:0,n=0!=P[S]?x[S][g]/P[S]:0,h?s.push(n,q):s.push(q,O.b?1-n:n);g=0;let B=0,G=v[g]-1,b=v[g+1]-1,p=G<b?G:b,I=Z[1]-Z[0];const t=v.length-1;for(;B<=p&&g<t;)a.push(B,B+I,B+1),a.push(B+I+1,B+1,B+I),B+=1,B===p&&(g++,I=Z[g+1]-Z[g],G=v[g]-1,b=v[g+1]-1,B=Z[g],p=G<b?G+B:b+B);if(f.b.ComputeNormals(i,a,F),l){let Q=0,C=0;for(g=0;g<X.length;g++){Q=3*Z[g],C=g+1<X.length?3*(Z[g+1]-1):F.length-3,F[Q]=.5*(F[Q]+F[C]),F[Q+1]=.5*(F[Q+1]+F[C+1]),F[Q+2]=.5*(F[Q+2]+F[C+2]);const l=Math.sqrt(F[Q]*F[Q]+F[Q+1]*F[Q+1]+F[Q+2]*F[Q+2]);F[Q]/=l,F[Q+1]/=l,F[Q+2]/=l,F[C]=F[Q],F[C+1]=F[Q+1],F[C+2]=F[Q+2]}}if(C){let Q=3*Z[0],C=3*Z[X.length];for(S=0;S<j+R;S++){F[Q]=.5*(F[Q]+F[C]),F[Q+1]=.5*(F[Q+1]+F[C+1]),F[Q+2]=.5*(F[Q+2]+F[C+2]);const X=Math.sqrt(F[Q]*F[Q]+F[Q+1]*F[Q+1]+F[Q+2]*F[Q+2]);F[Q]/=X,F[Q+1]/=X,F[Q+2]/=X,F[C]=F[Q],F[C+1]=F[Q+1],F[C+2]=F[Q+2],Q+=3,C+=3}}f.b._ComputeSides(U,i,a,F,s,Q.frontUVs,Q.backUVs);let y=null;if(w){y=new Float32Array(4*w.length);for(let Q=0;Q<w.length;Q++)y[4*Q]=w[Q].r,y[4*Q+1]=w[Q].g,y[4*Q+2]=w[Q].b,y[4*Q+3]=w[Q].a}const A=new f.b,D=new Float32Array(i),u=new Float32Array(F),V=new Float32Array(s);return A.indices=a,A.xa=D,A.ya=u,A.Aa=V,y&&A.set(y,M.g.ColorKind),l&&(A._idx=Z),A}function W(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=X.pathArray,U=X.closeArray,L=X.closePath,w=h.c._GetDefaultSideOrientation(X.sideOrientation),i=X.instance,a=X.updatable;if(i){const Q=l.e.Yj[0].Zj(Number.MAX_VALUE),C=l.e.Yj[1].Zj(-Number.MAX_VALUE),m=X=>{let l=W[0].length;const M=i;let f=0;const O=M._originalBuilderSideOrientation===h.c.DOUBLESIDE?2:1;for(let h=1;h<=O;++h)for(let O=0;O<W.length;++O){const h=W[O],m=h.length;l=l<m?l:m;for(let M=0;M<l;++M){const l=h[M];X[f]=l.x,X[f+1]=l.y,X[f+2]=l.z,Q.minimizeInPlaceFromFloats(l.x,l.y,l.z),C.maximizeInPlaceFromFloats(l.x,l.y,l.z),f+=3}if(M._creationDataStorage&&M._creationDataStorage.closePath){const Q=h[0];X[f]=Q.x,X[f+1]=Q.y,X[f+2]=Q.z,f+=3}}},U=i.getVerticesData(M.g.PositionKind);if(m(U),i.hasBoundingInfo?i.getBoundingInfo().reConstruct(Q,C,i._worldMatrix):i.buildBoundingInfo(Q,C,i._worldMatrix),i.updateVerticesData(M.g.PositionKind,U,!1,!1),X.za){const Q=i.getVerticesData(M.g.ColorKind);for(let C=0,l=0;C<X.za.length;C++,l+=4){const h=X.za[C];Q[l]=h.r,Q[l+1]=h.g,Q[l+2]=h.b,Q[l+3]=h.a}i.updateVerticesData(M.g.ColorKind,Q,!1,!1)}if(X.Aa){const Q=i.getVerticesData(M.g.UVKind);for(let C=0;C<X.Aa.length;C++)Q[2*C]=X.Aa[C].x,Q[2*C+1]=O.b?1-X.Aa[C].y:X.Aa[C].y;i.updateVerticesData(M.g.UVKind,Q,!1,!1)}if(!i.areNormalsFrozen||i.isFacetDataEnabled){const Q=i.Xj(),X=i.getVerticesData(M.g.NormalKind),C=i.isFacetDataEnabled?i.getFacetDataParameters():null;if(f.b.ComputeNormals(U,Q,X,C),i._creationDataStorage&&i._creationDataStorage.closePath){let Q=0,C=0;for(let l=0;l<W.length;l++)Q=3*i._creationDataStorage.idx[l],C=l+1<W.length?3*(i._creationDataStorage.idx[l+1]-1):X.length-3,X[Q]=.5*(X[Q]+X[C]),X[Q+1]=.5*(X[Q+1]+X[C+1]),X[Q+2]=.5*(X[Q+2]+X[C+2]),X[C]=X[Q],X[C+1]=X[Q+1],X[C+2]=X[Q+2]}i.areNormalsFrozen||i.updateVerticesData(M.g.NormalKind,X,!1,!1)}return i}{const l=new h.c(Q,C);l._originalBuilderSideOrientation=w,l._creationDataStorage=new h.d;const M=m(X);return L&&(l._creationDataStorage.idx=M._idx),l._creationDataStorage.closePath=L,l._creationDataStorage.closeArray=U,M.Ca(l,a),l}}f.b.CreateRibbon=m,h.c.CreateRibbon=function(Q,X){return W(Q,{pathArray:X,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var U=C(869),L=C(12611),w=C(702);function i(Q){const X=Q.pattern||h.c.NO_FLIP,C=Q.tileWidth||Q.tileSize||1,l=Q.tileHeight||Q.tileSize||1,M=Q.alignHorizontal||0,O=Q.alignVertical||0,m=Q.width||Q.size||1,W=Math.floor(m/C);let U=m-W*C;const L=Q.height||Q.size||1,w=Math.floor(L/l);let i=L-w*l;const a=C*W/2,F=l*w/2;let s=0,z=0,x=0,r=0,P=0,j=0;if(U>0||i>0){switch(x=-a,r=-F,P=a,j=F,M){case h.c.CENTER:U/=2,x-=U,P+=U;break;case h.c.LEFT:P+=U,s=-U/2;break;case h.c.RIGHT:x-=U,s=U/2}switch(O){case h.c.CENTER:i/=2,r-=i,j+=i;break;case h.c.BOTTOM:j+=i,z=-i/2;break;case h.c.TOP:r-=i,z=i/2}}const v=[],Z=[],g=[];g[0]=[0,0,1,0,1,1,0,1],g[1]=[0,0,1,0,1,1,0,1],X!==h.c.ROTATE_TILE&&X!==h.c.ROTATE_ROW||(g[1]=[1,1,0,1,0,0,1,0]),X!==h.c.FLIP_TILE&&X!==h.c.FLIP_ROW||(g[1]=[1,0,0,0,0,1,1,1]),X!==h.c.FLIP_N_ROTATE_TILE&&X!==h.c.FLIP_N_ROTATE_ROW||(g[1]=[0,1,1,1,1,0,0,0]);let S=[];const e=[],k=[];let R=0;for(let f=0;f<w;f++)for(let Q=0;Q<W;Q++)v.push(Q*C-a+s,f*l-F+z,0),v.push((Q+1)*C-a+s,f*l-F+z,0),v.push((Q+1)*C-a+s,(f+1)*l-F+z,0),v.push(Q*C-a+s,(f+1)*l-F+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),S=X===h.c.FLIP_TILE||X===h.c.ROTATE_TILE||X===h.c.FLIP_N_ROTATE_TILE?S.concat(g[(Q%2+f%2)%2]):X===h.c.FLIP_ROW||X===h.c.ROTATE_ROW||X===h.c.FLIP_N_ROTATE_ROW?S.concat(g[f%2]):S.concat(g[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),R+=4;if(U>0||i>0){const Q=i>0&&(O===h.c.CENTER||O===h.c.TOP),f=i>0&&(O===h.c.CENTER||O===h.c.BOTTOM),m=U>0&&(M===h.c.CENTER||M===h.c.RIGHT),L=U>0&&(M===h.c.CENTER||M===h.c.LEFT);let g,H,o,T,Y=[];if(Q&&m&&(v.push(x+s,r+z,0),v.push(-a+s,r+z,0),v.push(-a+s,r+i+z,0),v.push(x+s,r+i+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,g=1-U/C,H=1-i/l,o=1,T=1,Y=[g,H,o,H,o,T,g,T],X===h.c.ROTATE_ROW&&(Y=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),X===h.c.FLIP_ROW&&(Y=[1-g,H,1-o,H,1-o,T,1-g,T]),X===h.c.FLIP_N_ROTATE_ROW&&(Y=[g,1-H,o,1-H,o,1-T,g,1-T]),S=S.concat(Y),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&L&&(v.push(a+s,r+z,0),v.push(P+s,r+z,0),v.push(P+s,r+i+z,0),v.push(a+s,r+i+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,g=0,H=1-i/l,o=U/C,T=1,Y=[g,H,o,H,o,T,g,T],(X===h.c.ROTATE_ROW||X===h.c.ROTATE_TILE&&W%2===0)&&(Y=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),(X===h.c.FLIP_ROW||X===h.c.FLIP_TILE&&W%2===0)&&(Y=[1-g,H,1-o,H,1-o,T,1-g,T]),(X===h.c.FLIP_N_ROTATE_ROW||X===h.c.FLIP_N_ROTATE_TILE&&W%2===0)&&(Y=[g,1-H,o,1-H,o,1-T,g,1-T]),S=S.concat(Y),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&m&&(v.push(x+s,F+z,0),v.push(-a+s,F+z,0),v.push(-a+s,j+z,0),v.push(x+s,j+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,g=1-U/C,H=0,o=1,T=i/l,Y=[g,H,o,H,o,T,g,T],(X===h.c.ROTATE_ROW&&w%2===1||X===h.c.ROTATE_TILE&&w%1===0)&&(Y=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),(X===h.c.FLIP_ROW&&w%2===1||X===h.c.FLIP_TILE&&w%2===0)&&(Y=[1-g,H,1-o,H,1-o,T,1-g,T]),(X===h.c.FLIP_N_ROTATE_ROW&&w%2===1||X===h.c.FLIP_N_ROTATE_TILE&&w%2===0)&&(Y=[g,1-H,o,1-H,o,1-T,g,1-T]),S=S.concat(Y),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&L&&(v.push(a+s,F+z,0),v.push(P+s,F+z,0),v.push(P+s,j+z,0),v.push(a+s,j+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,g=0,H=0,o=U/C,T=i/l,Y=[g,H,o,H,o,T,g,T],(X===h.c.ROTATE_ROW&&w%2===1||X===h.c.ROTATE_TILE&&(w+W)%2===1)&&(Y=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),(X===h.c.FLIP_ROW&&w%2===1||X===h.c.FLIP_TILE&&(w+W)%2===1)&&(Y=[1-g,H,1-o,H,1-o,T,1-g,T]),(X===h.c.FLIP_N_ROTATE_ROW&&w%2===1||X===h.c.FLIP_N_ROTATE_TILE&&(w+W)%2===1)&&(Y=[g,1-H,o,1-H,o,1-T,g,1-T]),S=S.concat(Y),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q){const Q=[];g=0,H=1-i/l,o=1,T=1,Q[0]=[g,H,o,H,o,T,g,T],Q[1]=[g,H,o,H,o,T,g,T],X!==h.c.ROTATE_TILE&&X!==h.c.ROTATE_ROW||(Q[1]=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),X!==h.c.FLIP_TILE&&X!==h.c.FLIP_ROW||(Q[1]=[1-g,H,1-o,H,1-o,T,1-g,T]),X!==h.c.FLIP_N_ROTATE_TILE&&X!==h.c.FLIP_N_ROTATE_ROW||(Q[1]=[g,1-H,o,1-H,o,1-T,g,1-T]);for(let l=0;l<W;l++)v.push(l*C-a+s,r+z,0),v.push((l+1)*C-a+s,r+z,0),v.push((l+1)*C-a+s,r+i+z,0),v.push(l*C-a+s,r+i+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,S=X===h.c.FLIP_TILE||X===h.c.ROTATE_TILE||X===h.c.FLIP_N_ROTATE_TILE?S.concat(Q[(l+1)%2]):X===h.c.FLIP_ROW||X===h.c.ROTATE_ROW||X===h.c.FLIP_N_ROTATE_ROW?S.concat(Q[1]):S.concat(Q[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(f){const Q=[];g=0,H=0,o=1,T=i/l,Q[0]=[g,H,o,H,o,T,g,T],Q[1]=[g,H,o,H,o,T,g,T],X!==h.c.ROTATE_TILE&&X!==h.c.ROTATE_ROW||(Q[1]=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),X!==h.c.FLIP_TILE&&X!==h.c.FLIP_ROW||(Q[1]=[1-g,H,1-o,H,1-o,T,1-g,T]),X!==h.c.FLIP_N_ROTATE_TILE&&X!==h.c.FLIP_N_ROTATE_ROW||(Q[1]=[g,1-H,o,1-H,o,1-T,g,1-T]);for(let l=0;l<W;l++)v.push(l*C-a+s,j-i+z,0),v.push((l+1)*C-a+s,j-i+z,0),v.push((l+1)*C-a+s,j+z,0),v.push(l*C-a+s,j+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,S=X===h.c.FLIP_TILE||X===h.c.ROTATE_TILE||X===h.c.FLIP_N_ROTATE_TILE?S.concat(Q[(l+w)%2]):X===h.c.FLIP_ROW||X===h.c.ROTATE_ROW||X===h.c.FLIP_N_ROTATE_ROW?S.concat(Q[w%2]):S.concat(Q[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const Q=[];g=1-U/C,H=0,o=1,T=1,Q[0]=[g,H,o,H,o,T,g,T],Q[1]=[g,H,o,H,o,T,g,T],X!==h.c.ROTATE_TILE&&X!==h.c.ROTATE_ROW||(Q[1]=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),X!==h.c.FLIP_TILE&&X!==h.c.FLIP_ROW||(Q[1]=[1-g,H,1-o,H,1-o,T,1-g,T]),X!==h.c.FLIP_N_ROTATE_TILE&&X!==h.c.FLIP_N_ROTATE_ROW||(Q[1]=[g,1-H,o,1-H,o,1-T,g,1-T]);for(let C=0;C<w;C++)v.push(x+s,C*l-F+z,0),v.push(x+U+s,C*l-F+z,0),v.push(x+U+s,(C+1)*l-F+z,0),v.push(x+s,(C+1)*l-F+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,S=X===h.c.FLIP_TILE||X===h.c.ROTATE_TILE||X===h.c.FLIP_N_ROTATE_TILE?S.concat(Q[(C+1)%2]):X===h.c.FLIP_ROW||X===h.c.ROTATE_ROW||X===h.c.FLIP_N_ROTATE_ROW?S.concat(Q[C%2]):S.concat(Q[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const Q=[];g=0,H=0,o=U/l,T=1,Q[0]=[g,H,o,H,o,T,g,T],Q[1]=[g,H,o,H,o,T,g,T],X!==h.c.ROTATE_TILE&&X!==h.c.ROTATE_ROW||(Q[1]=[1-g,1-H,1-o,1-H,1-o,1-T,1-g,1-T]),X!==h.c.FLIP_TILE&&X!==h.c.FLIP_ROW||(Q[1]=[1-g,H,1-o,H,1-o,T,1-g,T]),X!==h.c.FLIP_N_ROTATE_TILE&&X!==h.c.FLIP_N_ROTATE_ROW||(Q[1]=[g,1-H,o,1-H,o,1-T,g,1-T]);for(let C=0;C<w;C++)v.push(P-U+s,C*l-F+z,0),v.push(P+s,C*l-F+z,0),v.push(P+s,(C+1)*l-F+z,0),v.push(P-U+s,(C+1)*l-F+z,0),k.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,S=X===h.c.FLIP_TILE||X===h.c.ROTATE_TILE||X===h.c.FLIP_N_ROTATE_TILE?S.concat(Q[(C+W)%2]):X===h.c.FLIP_ROW||X===h.c.ROTATE_ROW||X===h.c.FLIP_N_ROTATE_ROW?S.concat(Q[C%2]):S.concat(Q[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const H=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE;f.b._ComputeSides(H,v,k,Z,S,Q.frontUVs,Q.backUVs);const o=new f.b;o.indices=k,o.xa=v,o.ya=Z,o.Aa=S;const T=H===f.b.DOUBLESIDE?e.concat(e):e;return o.za=T,o}function a(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return i(X).Ca(l,X.updatable),l}function F(Q){const X=Q.faceUV||new Array(6),C=Q.faceColors,M=Q.pattern||h.c.NO_FLIP,m=Q.width||Q.size||1,W=Q.height||Q.size||1,U=Q.depth||Q.size||1,L=Q.tileWidth||Q.tileSize||1,a=Q.tileHeight||Q.tileSize||1,F=Q.alignHorizontal||0,s=Q.alignVertical||0,z=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE;for(let h=0;h<6;h++)void 0===X[h]&&(X[h]=new l.o(0,0,1,1)),C&&void 0===C[h]&&(C[h]=new w.d(1,1,1,1));const x=m/2,r=W/2,P=U/2,j=[];for(let l=0;l<2;l++)j[l]=i({pattern:M,tileWidth:L,tileHeight:a,width:m,height:W,alignVertical:s,alignHorizontal:F,sideOrientation:z});for(let l=2;l<4;l++)j[l]=i({pattern:M,tileWidth:L,tileHeight:a,width:U,height:W,alignVertical:s,alignHorizontal:F,sideOrientation:z});let v=s;s===h.c.BOTTOM?v=h.c.TOP:s===h.c.TOP&&(v=h.c.BOTTOM);for(let l=4;l<6;l++)j[l]=i({pattern:M,tileWidth:L,tileHeight:a,width:m,height:U,alignVertical:v,alignHorizontal:F,sideOrientation:z});let Z=[],g=[],S=[],e=[];const k=[],R=[],H=[],o=[];let T=0,Y=0;for(let h=0;h<6;h++){const Q=j[h].xa.length;R[h]=[],H[h]=[];for(let X=0;X<Q/3;X++)R[h].push(new l.k(j[h].xa[3*X],j[h].xa[3*X+1],j[h].xa[3*X+2])),H[h].push(new l.k(j[h].ya[3*X],j[h].ya[3*X+1],j[h].ya[3*X+2]));T=j[h].Aa.length,o[h]=[];for(let C=0;C<T;C+=2)o[h][C]=X[h].x+(X[h].z-X[h].x)*j[h].Aa[C],o[h][C+1]=X[h].y+(X[h].w-X[h].y)*j[h].Aa[C+1],O.b&&(o[h][C+1]=1-o[h][C+1]);if(S=S.concat(o[h]),e=e.concat(j[h].indices.map((Q=>Q+Y))),Y+=R[h].length,C)for(let X=0;X<4;X++)k.push(C[h].r,C[h].g,C[h].b,C[h].a)}const J=new l.k(0,0,P),K=l.b.RotationY(Math.PI);Z=R[0].map((Q=>l.k.TransformNormal(Q,K).add(J))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[]),g=H[0].map((Q=>l.k.TransformNormal(Q,K))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[]),Z=Z.concat(R[1].map((Q=>Q.Od(J))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[])),g=g.concat(H[1].map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[]));const N=new l.k(x,0,0),q=l.b.RotationY(-Math.PI/2);Z=Z.concat(R[2].map((Q=>l.k.TransformNormal(Q,q).add(N))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[])),g=g.concat(H[2].map((Q=>l.k.TransformNormal(Q,q))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[]));const n=l.b.RotationY(Math.PI/2);Z=Z.concat(R[3].map((Q=>l.k.TransformNormal(Q,n).Od(N))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[])),g=g.concat(H[3].map((Q=>l.k.TransformNormal(Q,n))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[]));const c=new l.k(0,r,0),E=l.b.RotationX(Math.PI/2);Z=Z.concat(R[4].map((Q=>l.k.TransformNormal(Q,E).add(c))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[])),g=g.concat(H[4].map((Q=>l.k.TransformNormal(Q,E))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[]));const B=l.b.RotationX(-Math.PI/2);Z=Z.concat(R[5].map((Q=>l.k.TransformNormal(Q,B).Od(c))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[])),g=g.concat(H[5].map((Q=>l.k.TransformNormal(Q,B))).map((Q=>[Q.x,Q.y,Q.z])).reduce(((Q,X)=>Q.concat(X)),[])),f.b._ComputeSides(z,Z,e,g,S);const G=new f.b;if(G.indices=e,G.xa=Z,G.ya=g,G.Aa=S,C){const Q=z===f.b.DOUBLESIDE?k.concat(k):k;G.za=Q}return G}function s(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return F(X).Ca(l,X.updatable),l}f.b.CreateTiledPlane=i;f.b.CreateTiledBox=F;var z=C(12746),x=C(2522),r=C(828);function P(Q){const X=Q.height||2;let C=0===Q.diameterTop?0:Q.diameterTop||Q.diameter||1,M=0===Q.diameterBottom?0:Q.diameterBottom||Q.diameter||1;C=C||1e-5,M=M||1e-5;const m=0|(Q.tessellation||24),W=0|(Q.subdivisions||1),U=!!Q.hasRings,L=!!Q.enclose,i=0===Q.cap?0:Q.cap||h.c.CAP_ALL,a=Q.arc&&(Q.arc<=0||Q.arc>1)?1:Q.arc||1,F=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,s=Q.faceUV||new Array(3),z=Q.faceColors,x=2+(1+(1!==a&&L?2:0))*(U?W:1);let P;for(P=0;P<x;P++)z&&void 0===z[P]&&(z[P]=new w.d(1,1,1,1));for(P=0;P<x;P++)s&&void 0===s[P]&&(s[P]=new l.o(0,0,1,1));const j=[],v=[],Z=[],g=[],S=[],e=2*Math.PI*a/m;let k,R,H;const o=(M-C)/2/X,T=l.k.Zero(),Y=l.k.Zero(),J=l.k.Zero(),K=l.k.Zero(),N=l.k.Zero(),q=r.b.Y;let n,c,E,B=1,G=1,b=0,p=0;for(n=0;n<=W;n++)for(R=n/W,H=(R*(C-M)+M)/2,B=U&&0!==n&&n!==W?2:1,E=0;E<B;E++){for(U&&(G+=E),L&&(G+=2*E),c=0;c<=m;c++)k=c*e,T.x=Math.cos(-k)*H,T.y=-X/2+R*X,T.z=Math.sin(-k)*H,0===C&&n===W?(Y.x=Z[Z.length-3*(m+1)],Y.y=Z[Z.length-3*(m+1)+1],Y.z=Z[Z.length-3*(m+1)+2]):(Y.x=T.x,Y.z=T.z,Y.y=Math.sqrt(Y.x*Y.x+Y.z*Y.z)*o,Y.normalize()),0===c&&(J.p(T),K.p(Y)),v.push(T.x,T.y,T.z),Z.push(Y.x,Y.y,Y.z),p=U?b!==G?s[G].y:s[G].w:s[G].y+(s[G].w-s[G].y)*R,g.push(s[G].x+(s[G].z-s[G].x)*c/m,O.b?1-p:p),z&&S.push(z[G].r,z[G].g,z[G].b,z[G].a);1!==a&&L&&(v.push(T.x,T.y,T.z),v.push(0,T.y,0),v.push(0,T.y,0),v.push(J.x,J.y,J.z),l.k.CrossToRef(q,Y,N),N.normalize(),Z.push(N.x,N.y,N.z,N.x,N.y,N.z),l.k.CrossToRef(K,q,N),N.normalize(),Z.push(N.x,N.y,N.z,N.x,N.y,N.z),p=U?b!==G?s[G+1].y:s[G+1].w:s[G+1].y+(s[G+1].w-s[G+1].y)*R,g.push(s[G+1].x,O.b?1-p:p),g.push(s[G+1].z,O.b?1-p:p),p=U?b!==G?s[G+2].y:s[G+2].w:s[G+2].y+(s[G+2].w-s[G+2].y)*R,g.push(s[G+2].x,O.b?1-p:p),g.push(s[G+2].z,O.b?1-p:p),z&&(S.push(z[G+1].r,z[G+1].g,z[G+1].b,z[G+1].a),S.push(z[G+1].r,z[G+1].g,z[G+1].b,z[G+1].a),S.push(z[G+2].r,z[G+2].g,z[G+2].b,z[G+2].a),S.push(z[G+2].r,z[G+2].g,z[G+2].b,z[G+2].a))),b!==G&&(b=G)}const I=1!==a&&L?m+4:m;for(n=0,G=0;G<W;G++){let Q=0,X=0,C=0,l=0;for(c=0;c<m;c++)Q=n*(I+1)+c,X=(n+1)*(I+1)+c,C=n*(I+1)+(c+1),l=(n+1)*(I+1)+(c+1),j.push(Q,X,C),j.push(l,C,X);1!==a&&L&&(j.push(Q+2,X+2,C+2),j.push(l+2,C+2,X+2),j.push(Q+4,X+4,C+4),j.push(l+4,C+4,X+4)),n=U?n+2:n+1}const t=Q=>{const h=Q?C/2:M/2;if(0===h)return;let f,W,U;const L=Q?s[x-1]:s[0];let w=null;z&&(w=Q?z[x-1]:z[0]);const i=v.length/3,F=Q?X/2:-X/2,r=new l.k(0,F,0);v.push(r.x,r.y,r.z),Z.push(0,Q?1:-1,0);const P=L.y+.5*(L.w-L.y);g.push(L.x+.5*(L.z-L.x),O.b?1-P:P),w&&S.push(w.r,w.g,w.b,w.a);const e=new l.h(.5,.5);for(U=0;U<=m;U++){f=2*Math.PI*U*a/m;const X=Math.cos(-f),C=Math.sin(-f);W=new l.k(X*h,F,C*h);const M=new l.h(X*e.x+.5,C*e.y+.5);v.push(W.x,W.y,W.z),Z.push(0,Q?1:-1,0);const i=L.y+(L.w-L.y)*M.y;g.push(L.x+(L.z-L.x)*M.x,O.b?1-i:i),w&&S.push(w.r,w.g,w.b,w.a)}for(U=0;U<m;U++)Q?(j.push(i),j.push(i+(U+2)),j.push(i+(U+1))):(j.push(i),j.push(i+(U+1)),j.push(i+(U+2)))};i!==h.c.CAP_START&&i!==h.c.CAP_ALL||t(!1),i!==h.c.CAP_END&&i!==h.c.CAP_ALL||t(!0),f.b._ComputeSides(F,v,j,Z,g,Q.frontUVs,Q.backUVs);const y=new f.b;return y.indices=j,y.xa=v,y.ya=Z,y.Aa=g,z&&(y.za=S),y}function j(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return P(X).Ca(l,X.updatable),l}function v(Q){const X=[],C=[],h=[],M=[],m=Q.diameter||1,W=Q.thickness||.5,U=0|(Q.tessellation||16),L=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,w=U+1;for(let f=0;f<=U;f++){const Q=f/U,L=f*Math.PI*2/U-Math.PI/2,i=l.b.Translation(m/2,0,0).multiply(l.b.RotationY(L));for(let m=0;m<=U;m++){const L=1-m/U,a=m*Math.PI*2/U+Math.PI,F=Math.cos(a),s=Math.sin(a);let z=new l.k(F,s,0),x=z.scale(W/2);const r=new l.h(Q,L);x=l.k.TransformCoordinates(x,i),z=l.k.TransformNormal(z,i),C.push(x.x,x.y,x.z),h.push(z.x,z.y,z.z),M.push(r.x,O.b?1-r.y:r.y);const P=(f+1)%w,j=(m+1)%w;X.push(f*w+m),X.push(f*w+j),X.push(P*w+m),X.push(f*w+j),X.push(P*w+j),X.push(P*w+m)}}f.b._ComputeSides(L,C,X,h,M,Q.frontUVs,Q.backUVs);const i=new f.b;return i.indices=X,i.xa=C,i.ya=h,i.Aa=M,i}function Z(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return v(X).Ca(l,X.updatable),l}f.b.CreateCylinder=P,h.c.CreateCylinder=(Q,X,C,l,M,f,O,m,W)=>{void 0!==O&&O instanceof x.e||(void 0!==O&&(W=m||h.c.DEFAULTSIDE,m=O),O=f,f=1);return j(Q,{height:X,diameterTop:C,diameterBottom:l,tessellation:M,subdivisions:f,sideOrientation:W,updatable:m},O)};function g(Q){const X=[],C=[],h=[],M=[],m=Q.radius||2,W=Q.tube||.5,U=Q.radialSegments||32,L=Q.tubularSegments||32,w=Q.p||2,i=Q.q||3,a=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,F=Q=>{const X=Math.cos(Q),C=Math.sin(Q),h=i/w*Q,M=Math.cos(h),f=m*(2+M)*.5*X,O=m*(2+M)*C*.5,W=m*Math.sin(h)*.5;return new l.k(f,O,W)};let s,z;for(s=0;s<=U;s++){const Q=s%U/U*2*w*Math.PI,X=F(Q),h=F(Q+.01),f=h.Od(X);let m=h.add(X);const i=l.k.Cross(f,m);for(m=l.k.Cross(i,f),i.normalize(),m.normalize(),z=0;z<L;z++){const Q=z%L/L*2*Math.PI,l=-W*Math.cos(Q),h=W*Math.sin(Q);C.push(X.x+l*m.x+h*i.x),C.push(X.y+l*m.y+h*i.y),C.push(X.z+l*m.z+h*i.z),M.push(s/U),M.push(O.b?1-z/L:z/L)}}for(s=0;s<U;s++)for(z=0;z<L;z++){const Q=(z+1)%L,C=s*L+z,l=(s+1)*L+z,h=(s+1)*L+Q,M=s*L+Q;X.push(M),X.push(l),X.push(C),X.push(M),X.push(h),X.push(l)}f.b.ComputeNormals(C,X,h),f.b._ComputeSides(a,C,X,h,M,Q.frontUVs,Q.backUVs);const x=new f.b;return x.indices=X,x.xa=C,x.ya=h,x.Aa=M,x}function S(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return g(X).Ca(l,X.updatable),l}f.b.CreateTorus=v,h.c.CreateTorus=(Q,X,C,l,h,M,f)=>Z(Q,{diameter:X,thickness:C,tessellation:l,sideOrientation:f,updatable:M},h);f.b.CreateTorusKnot=g,h.c.CreateTorusKnot=(Q,X,C,l,h,M,f,O,m,W)=>S(Q,{radius:X,tube:C,radialSegments:l,tubularSegments:h,p:M,q:f,sideOrientation:W,updatable:m},O);var e=C(13265),k=C(12262),R=C(2365);function H(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=X.path,M=X.shape,f=X.scale||1,O=X.rotation||0,m=0===X.cap?0:X.cap||h.c.NO_CAP,W=X.updatable,U=h.c._GetDefaultSideOrientation(X.sideOrientation),L=X.instance||null,w=X.invertUV||!1,i=X.closeShape||!1,a=X.closePath||!1,F=X.capFunction||null;return T(Q,M,l,f,O,null,null,a,i,m,!1,C,!!W,U,L,w,X.frontUVs||null,X.backUVs||null,X.firstNormal||null,!!X.adjustFrame,F)}function o(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=X.path,M=X.shape,f=X.scaleFunction||(()=>1),O=X.rotationFunction||(()=>0),m=X.closePath||X.ribbonCloseArray||!1,W=X.closeShape||X.ribbonClosePath||!1,U=0===X.cap?0:X.cap||h.c.NO_CAP,L=X.updatable,w=X.firstNormal||null,i=X.adjustFrame||!1,a=h.c._GetDefaultSideOrientation(X.sideOrientation),F=X.instance,s=X.invertUV||!1,z=X.capFunction||null;return T(Q,M,l,null,null,f,O,m,W,U,!0,C,!!L,a,F||null,s,X.frontUVs||null,X.backUVs||null,w,i,z||null)}function T(Q,X,C,M,f,O,m,U,L,w,i,a,F,s,z,x,r,P,j,v,Z){const g=(Q,X,C,M,f,O,m,W,U,L,w)=>{const i=C.getTangents(),a=C.getNormals(),F=C.getBinormals(),s=C.getDistances();if(w)for(let h=0;h<i.length;h++)if(0==i[h].x&&0==i[h].y&&0==i[h].z&&i[h].p(i[h-1]),0==a[h].x&&0==a[h].y&&0==a[h].z&&a[h].p(a[h-1]),0==F[h].x&&0==F[h].y&&0==F[h].z&&F[h].p(F[h-1]),h>0){let Q=i[h-1];l.k.Dot(Q,i[h])<0&&i[h].scaleInPlace(-1),Q=a[h-1],l.k.Dot(Q,a[h])<0&&a[h].scaleInPlace(-1),Q=F[h-1],l.k.Dot(Q,F[h])<0&&F[h].scaleInPlace(-1)}let z=0;const x=L&&W?W:()=>null!==O?O:0,r=L&&m?m:()=>null!==f?f:1;let P=U===h.c.NO_CAP||U===h.c.CAP_END?0:2;const j=l.e.Matrix[0];for(let h=0;h<X.length;h++){const C=[],f=x(h,s[h]),O=r(h,s[h]);l.b.RotationAxisToRef(i[h],z,j);for(let M=0;M<Q.length;M++){const f=i[h].scale(Q[M].z).add(a[h].scale(Q[M].x)).add(F[h].scale(Q[M].y)),m=l.k.Zero();l.k.TransformCoordinatesToRef(f,j,m),m.scaleInPlace(O).addInPlace(X[h]),C[M]=m}M[P]=C,z+=f,P++}const v=Z||(Q=>{const X=Array(),C=l.k.Zero();let h;for(h=0;h<Q.length;h++)C.addInPlace(Q[h]);for(C.scaleInPlace(1/Q.length),h=0;h<Q.length;h++)X.push(C);return X});switch(U){case h.c.NO_CAP:break;case h.c.CAP_START:M[0]=v(M[2]),M[1]=M[2];break;case h.c.CAP_END:M[P]=M[P-1],M[P+1]=v(M[P-1]);break;case h.c.CAP_ALL:M[0]=v(M[2]),M[1]=M[2],M[P]=M[P-1],M[P+1]=v(M[P-1])}return M};let S,e;if(z){const Q=z._creationDataStorage;return S=j?Q.path3D.update(C,j):Q.path3D.update(C),e=g(X,C,Q.path3D,Q.pathArray,M,f,O,m,Q.cap,i,v),z=W("",{pathArray:e,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:z},a||void 0)}S=j?new R.m(C,j):new R.m(C);e=g(X,C,S,new Array,M,f,O,m,w=w<0||w>3?0:w,i,v);const k=W(Q,{pathArray:e,closeArray:U,closePath:L,updatable:F,sideOrientation:s,invertUV:x,frontUVs:r||void 0,backUVs:P||void 0},a);return k._creationDataStorage.pathArray=e,k._creationDataStorage.path3D=S,k._creationDataStorage.cap=w,k}function Y(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=X.arc?X.arc<=0||X.arc>1?1:X.arc:1,f=void 0===X.closed||X.closed,O=X.shape,m=X.radius||1,U=X.tessellation||64,L=X.clip||0,w=X.updatable,i=h.c._GetDefaultSideOrientation(X.sideOrientation),a=X.cap||h.c.NO_CAP,F=2*Math.PI,s=[],z=X.invertUV||!1;let x=0,r=0;const P=F/U*M;let j,v;for(x=0;x<=U-L;x++){for(v=[],a!=h.c.CAP_START&&a!=h.c.CAP_ALL||(v.push(new l.k(0,O[0].y,0)),v.push(new l.k(Math.cos(x*P)*O[0].x*m,O[0].y,Math.sin(x*P)*O[0].x*m))),r=0;r<O.length;r++)j=new l.k(Math.cos(x*P)*O[r].x*m,O[r].y,Math.sin(x*P)*O[r].x*m),v.push(j);a!=h.c.CAP_END&&a!=h.c.CAP_ALL||(v.push(new l.k(Math.cos(x*P)*O[O.length-1].x*m,O[O.length-1].y,Math.sin(x*P)*O[O.length-1].x*m)),v.push(new l.k(0,O[O.length-1].y,0))),s.push(v)}return W(Q,{pathArray:s,closeArray:f,sideOrientation:i,updatable:w,invertUV:z,frontUVs:X.frontUVs,backUVs:X.backUVs},C)}h.c.ExtrudeShape=function(Q,X,C,l,M,f){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7?arguments[7]:void 0,W=arguments.length>8?arguments[8]:void 0,U=arguments.length>9?arguments[9]:void 0;return H(Q,{shape:X,path:C,scale:l,rotation:M,cap:0===f?0:f||h.c.NO_CAP,sideOrientation:W,instance:U,updatable:m},O)},h.c.ExtrudeShapeCustom=(Q,X,C,l,M,f,O,m,W,U,L,w)=>o(Q,{shape:X,path:C,scaleFunction:l,rotationFunction:M,ribbonCloseArray:f,ribbonClosePath:O,cap:0===m?0:m||h.c.NO_CAP,sideOrientation:L,instance:w,updatable:U},W);h.c.CreateLathe=(Q,X,C,l,h,M,f)=>Y(Q,{shape:X,radius:C,tessellation:l,sideOrientation:f,updatable:M},h);var J=C(12667),K=C(12620);function N(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=X.path;let f=X.instance,O=1;void 0!==X.radius?O=X.radius:f&&(O=f._creationDataStorage.radius);const m=X.tessellation||64,U=X.radiusFunction||null;let L=X.cap||h.c.NO_CAP;const w=X.invertUV||!1,i=X.updatable,a=h.c._GetDefaultSideOrientation(X.sideOrientation);X.arc=X.arc&&(X.arc<=0||X.arc>1)?1:X.arc||1;const F=(Q,X,C,M,f,O,m,W)=>{const U=X.getTangents(),L=X.getNormals(),w=X.getDistances(),i=2*Math.PI/f*W,a=O||(()=>M);let F,s,z,x;const r=l.e.Matrix[0];let P=m===h.c.NO_CAP||m===h.c.CAP_END?0:2;for(let h=0;h<Q.length;h++){s=a(h,w[h]),F=Array(),z=L[h];for(let X=0;X<f;X++)l.b.RotationAxisToRef(U[h],i*X,r),x=F[X]?F[X]:l.k.Zero(),l.k.TransformCoordinatesToRef(z,r,x),x.scaleInPlace(s).addInPlace(Q[h]),F[X]=x;C[P]=F,P++}const j=(X,C)=>{const l=Array();for(let h=0;h<X;h++)l.push(Q[C]);return l};switch(m){case h.c.NO_CAP:break;case h.c.CAP_START:C[0]=j(f,0),C[1]=C[2].slice(0);break;case h.c.CAP_END:C[P]=C[P-1].slice(0),C[P+1]=j(f,Q.length-1);break;case h.c.CAP_ALL:C[0]=j(f,0),C[1]=C[2].slice(0),C[P]=C[P-1].slice(0),C[P+1]=j(f,Q.length-1)}return C};let s,z;if(f){const Q=f._creationDataStorage,C=X.arc||Q.arc;return s=Q.path3D.update(M),z=F(M,s,Q.pathArray,O,Q.tessellation,U,Q.cap,C),f=W("",{pathArray:z,instance:f}),Q.path3D=s,Q.pathArray=z,Q.arc=C,Q.radius=O,f}s=new R.m(M);L=L<0||L>3?0:L,z=F(M,s,new Array,O,m,U,L,X.arc);const x=W(Q,{pathArray:z,closePath:!0,closeArray:!1,updatable:i,sideOrientation:a,invertUV:w,frontUVs:X.frontUVs,backUVs:X.backUVs},C);return x._creationDataStorage.pathArray=z,x._creationDataStorage.path3D=s,x._creationDataStorage.tessellation=m,x._creationDataStorage.cap=L,x._creationDataStorage.arc=X.arc,x._creationDataStorage.radius=O,x}function q(Q){const X=[];X[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},X[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},X[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},X[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},X[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},X[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},X[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},X[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},X[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},X[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},X[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},X[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},X[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},X[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},X[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=Q.type&&(Q.type<0||Q.type>=X.length)?0:Q.type||0,h=Q.size,M=Q.sizeX||h||1,m=Q.sizeY||h||1,W=Q.sizeZ||h||1,U=Q.custom||X[C],L=U.face.length,i=Q.faceUV||new Array(L),a=Q.faceColors,F=void 0===Q.flat||Q.flat,s=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,z=[],x=[],r=[],P=[],j=[];let v=0,Z=0;const g=[];let S,e,k,R,H,o,T=0,Y=0;if(F)for(Y=0;Y<L;Y++)a&&void 0===a[Y]&&(a[Y]=new w.d(1,1,1,1)),i&&void 0===i[Y]&&(i[Y]=new l.o(0,0,1,1));if(F)for(Y=0;Y<L;Y++){const Q=U.face[Y].length;for(k=2*Math.PI/Q,R=.5*Math.tan(k/2),H=.5,T=0;T<Q;T++)z.push(U.vertex[U.face[Y][T]][0]*M,U.vertex[U.face[Y][T]][1]*m,U.vertex[U.face[Y][T]][2]*W),g.push(v),v++,S=i[Y].x+(i[Y].z-i[Y].x)*(.5+R),e=i[Y].y+(i[Y].w-i[Y].y)*(H-.5),P.push(S,O.b?1-e:e),o=R*Math.cos(k)-H*Math.sin(k),H=R*Math.sin(k)+H*Math.cos(k),R=o,a&&j.push(a[Y].r,a[Y].g,a[Y].b,a[Y].a);for(T=0;T<Q-2;T++)x.push(g[0+Z],g[T+2+Z],g[T+1+Z]);Z+=Q}else{for(T=0;T<U.vertex.length;T++)z.push(U.vertex[T][0]*M,U.vertex[T][1]*m,U.vertex[T][2]*W),P.push(0,O.b?1:0);for(Y=0;Y<L;Y++)for(T=0;T<U.face[Y].length-2;T++)x.push(U.face[Y][0],U.face[Y][T+2],U.face[Y][T+1])}f.b.ComputeNormals(z,x,r),f.b._ComputeSides(s,z,x,r,P,Q.frontUVs,Q.backUVs);const J=new f.b;return J.xa=z,J.indices=x,J.ya=r,J.Aa=P,a&&F&&(J.za=j),J}function n(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return q(X).Ca(l,X.updatable),l}h.c.CreateTube=(Q,X,C,l,h,M,f,O,m,W)=>N(Q,{path:X,radius:C,tessellation:l,radiusFunction:h,arc:1,cap:M,updatable:O,sideOrientation:m,instance:W},f);function c(Q){const X=Q.sideOrientation||f.b.DEFAULTSIDE,C=Q.radius||1,h=void 0===Q.flat||Q.flat,M=0|(Q.subdivisions||4),m=Q.radiusX||C,W=Q.radiusY||C,U=Q.radiusZ||C,L=(1+Math.sqrt(5))/2,w=[-1,L,-0,1,L,0,-1,-L,0,1,-L,0,0,-1,-L,0,1,-L,0,-1,L,0,1,L,L,0,1,L,0,-1,-L,0,1,-L,0,-1],i=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],a=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],F=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],s=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],z=[],x=[],r=[],P=[];let j=0;const v=new Array(3),Z=new Array(3);let g;for(g=0;g<3;g++)v[g]=l.k.Zero(),Z[g]=l.h.Zero();for(let f=0;f<20;f++){for(g=0;g<3;g++){const Q=i[3*f+g];v[g].Yc(w[3*a[Q]],w[3*a[Q]+1],w[3*a[Q]+2]),v[g].normalize(),Z[g].Yc(.134765625*F[2*Q]+.05859375+-.0390625*s[f],.2333984375*F[2*Q+1]+.025390625+.01953125*s[f])}const Q=(Q,X,C,f)=>{const L=l.k.Lerp(v[0],v[2],X/M),w=l.k.Lerp(v[1],v[2],X/M),i=M===X?v[2]:l.k.Lerp(L,w,Q/(M-X));let a;if(i.normalize(),h){const Q=l.k.Lerp(v[0],v[2],f/M),X=l.k.Lerp(v[1],v[2],f/M);a=l.k.Lerp(Q,X,C/(M-f))}else a=new l.k(i.x,i.y,i.z);a.x/=m,a.y/=W,a.z/=U,a.normalize();const F=l.h.Lerp(Z[0],Z[2],X/M),s=l.h.Lerp(Z[1],Z[2],X/M),g=M===X?Z[2]:l.h.Lerp(F,s,Q/(M-X));x.push(i.x*m,i.y*W,i.z*U),r.push(a.x,a.y,a.z),P.push(g.x,O.b?1-g.y:g.y),z.push(j),j++};for(let X=0;X<M;X++)for(let C=0;C+X<M;C++)Q(C,X,C+1/3,X+1/3),Q(C+1,X,C+1/3,X+1/3),Q(C,X+1,C+1/3,X+1/3),C+X+1<M&&(Q(C+1,X,C+2/3,X+2/3),Q(C+1,X+1,C+2/3,X+2/3),Q(C,X+1,C+2/3,X+2/3))}f.b._ComputeSides(X,x,z,r,P,Q.frontUVs,Q.backUVs);const S=new f.b;return S.indices=z,S.xa=x,S.ya=r,S.Aa=P,S}function E(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new h.c(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),l._originalBuilderSideOrientation=X.sideOrientation;return c(X).Ca(l,X.updatable),l}f.b.CreatePolyhedron=q,h.c.CreatePolyhedron=(Q,X,C)=>n(Q,X,C);f.b.CreateIcoSphere=c,h.c.CreateIcoSphere=(Q,X,C)=>E(Q,X,C);var B=C(690);const G=new l.k(1,0,0),b=new l.k(-1,0,0),p=new l.k(0,1,0),I=new l.k(0,-1,0),t=new l.k(0,0,1),y=new l.k(0,0,-1);class A{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.k.Zero(),X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.k.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.h.Zero(),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Q,this.ek=X,this.uv=C,this.vertexIdx=h,this.vertexIdxForBones=M,this.localPositionOverride=f,this.localNormalOverride=O,this.matrixIndicesOverride=m,this.matrixWeightsOverride=W}clone(){var Q,X,C,l;return new A(this.position.clone(),this.ek.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Q=this.localPositionOverride)||void 0===Q?void 0:Q.slice(),null===(X=this.localNormalOverride)||void 0===X?void 0:X.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(l=this.matrixWeightsOverride)||void 0===l?void 0:l.slice())}}function D(Q,X,C){var m,W,U,L,w;const i=!!X.skeleton,a=!(null===(m=X.morphTargetManager)||void 0===m||!m.numTargets),F=C.localMode||i,s=X.Xj(),z=i||a?X.Bc(!0,!0):X.getVerticesData(M.g.PositionKind),x=i||a?X.getNormalsData(!0,!0):X.getVerticesData(M.g.NormalKind),r=F?i?X.getVerticesData(M.g.PositionKind):z:null,P=F?i?X.getVerticesData(M.g.NormalKind):x:null,j=X.getVerticesData(M.g.UVKind),v=i?X.getVerticesData(M.g.MatricesIndicesKind):null,Z=i?X.getVerticesData(M.g.MatricesWeightsKind):null,g=i?X.getVerticesData(M.g.MatricesIndicesExtraKind):null,S=i?X.getVerticesData(M.g.MatricesWeightsExtraKind):null,e=C.position||l.k.Zero();let k=C.ek||l.k.Up();const R=C.size||l.k.One(),H=C.angle||0;if(!k){const Q=new l.k(0,0,1),C=X.va().activeCamera,h=l.k.TransformCoordinates(Q,C.getWorldMatrix());k=C.globalPosition.Od(h)}const o=-Math.atan2(k.z,k.x)-Math.PI/2,T=Math.sqrt(k.x*k.x+k.z*k.z),Y=Math.atan2(k.y,T),J=new f.b;J.indices=[],J.xa=[],J.ya=[],J.Aa=[],J.matricesIndices=i?[]:null,J.matricesWeights=i?[]:null,J.matricesIndicesExtra=g?[]:null,J.matricesWeightsExtra=S?[]:null;let K=0;const N=(Q,X)=>{const h=new A;if(!s||!z||!x)return h;const M=s[Q];if(h.vertexIdx=3*M,h.vertexIdxForBones=4*M,h.position=new l.k(z[3*M],z[3*M+1],z[3*M+2]),l.k.TransformCoordinatesToRef(h.position,X,h.position),h.ek=new l.k(x[3*M],x[3*M+1],x[3*M+2]),l.k.TransformNormalToRef(h.ek,X,h.ek),C.captureUVS&&j){const Q=j[2*M+1];h.uv=new l.h(j[2*M],O.b?1-Q:Q)}return h},q=[0,0,0,0],n=(Q,X)=>{if(0===Q.length)return Q;const C=.5*Math.abs(l.k.Dot(R,X)),h=(Q,X,C,l)=>{for(let h=0;h<l;++h)if(Q[C+h]===X)return C+h;return-1},M=(Q,M)=>{const f=l.k.GetClipFactor(Q.position,M.position,X,C);let O=q,m=q;if(v&&Z){const X=Q.matrixIndicesOverride?0:Q.vertexIdxForBones,C=Q.matrixIndicesOverride??v,l=Q.matrixWeightsOverride??Z,W=M.matrixIndicesOverride?0:M.vertexIdxForBones,U=M.matrixIndicesOverride??v,L=M.matrixWeightsOverride??Z;O=[0,0,0,0],m=[0,0,0,0];let w=0;for(let Q=0;Q<4;++Q)if(l[X+Q]>0){const M=h(U,C[X+Q],W,4);O[w]=C[X+Q],m[w]=(0,B.Lerp)(l[X+Q],M>=0?L[M]:0,f),w++}for(let Q=0;Q<4&&w<4;++Q){const l=U[W+Q];-1===h(C,l,X,4)&&(O[w]=l,m[w]=(0,B.Lerp)(0,L[W+Q],f),w++)}const i=m[0]+m[1]+m[2]+m[3];m[0]/=i,m[1]/=i,m[2]/=i,m[3]/=i}const W=Q.localPositionOverride?Q.localPositionOverride[0]:(null===r||void 0===r?void 0:r[Q.vertexIdx])??0,U=Q.localPositionOverride?Q.localPositionOverride[1]:(null===r||void 0===r?void 0:r[Q.vertexIdx+1])??0,L=Q.localPositionOverride?Q.localPositionOverride[2]:(null===r||void 0===r?void 0:r[Q.vertexIdx+2])??0,w=M.localPositionOverride?M.localPositionOverride[0]:(null===r||void 0===r?void 0:r[M.vertexIdx])??0,i=M.localPositionOverride?M.localPositionOverride[1]:(null===r||void 0===r?void 0:r[M.vertexIdx+1])??0,a=M.localPositionOverride?M.localPositionOverride[2]:(null===r||void 0===r?void 0:r[M.vertexIdx+2])??0,F=Q.localNormalOverride?Q.localNormalOverride[0]:(null===P||void 0===P?void 0:P[Q.vertexIdx])??0,s=Q.localNormalOverride?Q.localNormalOverride[1]:(null===P||void 0===P?void 0:P[Q.vertexIdx+1])??0,z=Q.localNormalOverride?Q.localNormalOverride[2]:(null===P||void 0===P?void 0:P[Q.vertexIdx+2])??0,x=F+((M.localNormalOverride?M.localNormalOverride[0]:(null===P||void 0===P?void 0:P[M.vertexIdx])??0)-F)*f,j=s+((M.localNormalOverride?M.localNormalOverride[1]:(null===P||void 0===P?void 0:P[M.vertexIdx+1])??0)-s)*f,g=z+((M.localNormalOverride?M.localNormalOverride[2]:(null===P||void 0===P?void 0:P[M.vertexIdx+2])??0)-z)*f,S=Math.sqrt(x*x+j*j+g*g);return new A(l.k.Lerp(Q.position,M.position,f),l.k.Lerp(Q.ek,M.ek,f).normalize(),l.h.Lerp(Q.uv,M.uv,f),-1,-1,r?[W+(w-W)*f,U+(i-U)*f,L+(a-L)*f]:null,P?[x/S,j/S,g/S]:null,O,m)};let f=null;Q.length>3&&(f=[]);for(let O=0;O<Q.length;O+=3){let h=0,m=null,W=null,U=null,L=null;const w=l.k.Dot(Q[O].position,X)-C>0,i=l.k.Dot(Q[O+1].position,X)-C>0,a=l.k.Dot(Q[O+2].position,X)-C>0;switch(h=(w?1:0)+(i?1:0)+(a?1:0),h){case 0:Q.length>3?(f.push(Q[O]),f.push(Q[O+1]),f.push(Q[O+2])):f=Q;break;case 1:if(f=f??new Array,w&&(m=Q[O+1],W=Q[O+2],U=M(Q[O],m),L=M(Q[O],W)),i){m=Q[O],W=Q[O+2],U=M(Q[O+1],m),L=M(Q[O+1],W),f.push(U),f.push(W.clone()),f.push(m.clone()),f.push(W.clone()),f.push(U.clone()),f.push(L);break}a&&(m=Q[O],W=Q[O+1],U=M(Q[O+2],m),L=M(Q[O+2],W)),m&&W&&U&&L&&(f.push(m.clone()),f.push(W.clone()),f.push(U),f.push(L),f.push(U.clone()),f.push(W.clone()));break;case 2:f=f??new Array,w||(m=Q[O].clone(),W=M(m,Q[O+1]),U=M(m,Q[O+2]),f.push(m),f.push(W),f.push(U)),i||(m=Q[O+1].clone(),W=M(m,Q[O+2]),U=M(m,Q[O]),f.push(m),f.push(W),f.push(U)),a||(m=Q[O+2].clone(),W=M(m,Q[O]),U=M(m,Q[O+1]),f.push(m),f.push(W),f.push(U))}}return f},c=X instanceof h.c?X:null,E=null===c||void 0===c?void 0:c._thinInstanceDataStorage.matrixData,D=(null===c||void 0===c?void 0:c.Dk)||1,u=l.e.Matrix[0];u.p(l.b.IdentityReadOnly);for(let h=0;h<D;++h){if(null!==c&&void 0!==c&&c.hasThinInstances&&E){const Q=16*h;u.setRowFromFloats(0,E[Q+0],E[Q+1],E[Q+2],E[Q+3]),u.setRowFromFloats(1,E[Q+4],E[Q+5],E[Q+6],E[Q+7]),u.setRowFromFloats(2,E[Q+8],E[Q+9],E[Q+10],E[Q+11]),u.setRowFromFloats(3,E[Q+12],E[Q+13],E[Q+14],E[Q+15])}const Q=l.b.RotationYawPitchRoll(o,Y,H).multiply(l.b.Translation(e.x,e.y,e.z)),M=l.b.Invert(Q),f=X.getWorldMatrix(),m=u.multiply(f).multiply(M),W=new Array(3);for(let X=0;X<s.length;X+=3){let Q=W;if(Q[0]=N(X,m),Q[1]=N(X+1,m),Q[2]=N(X+2,m),!(C.cullBackFaces&&-Q[0].ek.z<=0&&-Q[1].ek.z<=0&&-Q[2].ek.z<=0)&&(Q=n(Q,G),Q&&(Q=n(Q,b),Q&&(Q=n(Q,p),Q&&(Q=n(Q,I),Q&&(Q=n(Q,t),Q&&(Q=n(Q,y),Q)))))))for(let X=0;X<Q.length;X++){const l=Q[X];if(J.indices.push(K),F?(l.localPositionOverride?(J.xa[3*K]=l.localPositionOverride[0],J.xa[3*K+1]=l.localPositionOverride[1],J.xa[3*K+2]=l.localPositionOverride[2]):r&&(J.xa[3*K]=r[l.vertexIdx],J.xa[3*K+1]=r[l.vertexIdx+1],J.xa[3*K+2]=r[l.vertexIdx+2]),l.localNormalOverride?(J.ya[3*K]=l.localNormalOverride[0],J.ya[3*K+1]=l.localNormalOverride[1],J.ya[3*K+2]=l.localNormalOverride[2]):P&&(J.ya[3*K]=P[l.vertexIdx],J.ya[3*K+1]=P[l.vertexIdx+1],J.ya[3*K+2]=P[l.vertexIdx+2])):(l.position.toArray(J.xa,3*K),l.ek.toArray(J.ya,3*K)),J.matricesIndices&&J.matricesWeights&&(l.matrixIndicesOverride?(J.matricesIndices[4*K]=l.matrixIndicesOverride[0],J.matricesIndices[4*K+1]=l.matrixIndicesOverride[1],J.matricesIndices[4*K+2]=l.matrixIndicesOverride[2],J.matricesIndices[4*K+3]=l.matrixIndicesOverride[3]):(v&&(J.matricesIndices[4*K]=v[l.vertexIdxForBones],J.matricesIndices[4*K+1]=v[l.vertexIdxForBones+1],J.matricesIndices[4*K+2]=v[l.vertexIdxForBones+2],J.matricesIndices[4*K+3]=v[l.vertexIdxForBones+3]),g&&J.matricesIndicesExtra&&(J.matricesIndicesExtra[4*K]=g[l.vertexIdxForBones],J.matricesIndicesExtra[4*K+1]=g[l.vertexIdxForBones+1],J.matricesIndicesExtra[4*K+2]=g[l.vertexIdxForBones+2],J.matricesIndicesExtra[4*K+3]=g[l.vertexIdxForBones+3])),l.matrixWeightsOverride?(J.matricesWeights[4*K]=l.matrixWeightsOverride[0],J.matricesWeights[4*K+1]=l.matrixWeightsOverride[1],J.matricesWeights[4*K+2]=l.matrixWeightsOverride[2],J.matricesWeights[4*K+3]=l.matrixWeightsOverride[3]):(Z&&(J.matricesWeights[4*K]=Z[l.vertexIdxForBones],J.matricesWeights[4*K+1]=Z[l.vertexIdxForBones+1],J.matricesWeights[4*K+2]=Z[l.vertexIdxForBones+2],J.matricesWeights[4*K+3]=Z[l.vertexIdxForBones+3]),S&&J.matricesWeightsExtra&&(J.matricesWeightsExtra[4*K]=S[l.vertexIdxForBones],J.matricesWeightsExtra[4*K+1]=S[l.vertexIdxForBones+1],J.matricesWeightsExtra[4*K+2]=S[l.vertexIdxForBones+2],J.matricesWeightsExtra[4*K+3]=S[l.vertexIdxForBones+3]))),C.captureUVS)l.uv.toArray(J.Aa,2*K);else{J.Aa.push(.5+l.position.x/R.x);const Q=.5+l.position.y/R.y;J.Aa.push(O.b?1-Q:Q)}K++}}}0===J.indices.length&&(J.indices=null),0===J.xa.length&&(J.xa=null),0===J.ya.length&&(J.ya=null),0===J.Aa.length&&(J.Aa=null),0===(null===(W=J.matricesIndices)||void 0===W?void 0:W.length)&&(J.matricesIndices=null),0===(null===(U=J.matricesWeights)||void 0===U?void 0:U.length)&&(J.matricesWeights=null),0===(null===(L=J.matricesIndicesExtra)||void 0===L?void 0:L.length)&&(J.matricesIndicesExtra=null),0===(null===(w=J.matricesWeightsExtra)||void 0===w?void 0:w.length)&&(J.matricesWeightsExtra=null);const V=new h.c(Q,X.va());return J.Ca(V),F?(V.skeleton=X.skeleton,V.parent=X):(V.position=e.clone(),V.rotation=new l.k(Y,o,H)),V.Vj(!0),V.refreshBoundingInfo(!0,!0),V}function u(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const X=0|Math.max(Q.subdivisions?Q.subdivisions:2,1),C=0|Math.max(Q.tessellation?Q.tessellation:16,3),h=Math.max(Q.height?Q.height:1,0),M=Math.max(Q.radius?Q.radius:.25,0),m=0|Math.max(Q.capSubdivisions?Q.capSubdivisions:6,1),W=C,U=X,L=Math.max(Q.radiusTop?Q.radiusTop:M,0),w=Math.max(Q.radiusBottom?Q.radiusBottom:M,0),i=h-(L+w),a=2*Math.PI,F=Math.max(Q.topCapSubdivisions?Q.topCapSubdivisions:m,1),s=Math.max(Q.bottomCapSubdivisions?Q.bottomCapSubdivisions:m,1),z=Math.acos((w-L)/h);let x=[];const r=[],P=[],j=[];let v=0;const Z=[],g=.5*i,S=.5*Math.PI;let e,k;const R=l.k.Zero(),H=l.k.Zero(),o=Math.cos(z),T=Math.sin(z),Y=new l.h(L*T,g+L*o).Od(new l.h(w*T,w*o-g)).length(),J=L*z+Y+w*(S-z);let K=0;for(k=0;k<=F;k++){const Q=[],X=S-z*(k/F);K+=L*z/F;const C=Math.cos(X),l=Math.sin(X),h=C*L;for(e=0;e<=W;e++){const X=e/W,M=X*a+0,f=Math.sin(M),m=Math.cos(M);H.x=h*f,H.y=g+l*L,H.z=h*m,r.push(H.x,H.y,H.z),R.set(C*f,l,C*m),P.push(R.x,R.y,R.z),j.push(X,O.b?K/J:1-K/J),Q.push(v),v++}Z.push(Q)}const N=h-L-w+o*L-o*w,q=T*(w-L)/N;for(k=1;k<=U;k++){const Q=[];K+=Y/U;const X=T*(k*(w-L)/U+L);for(e=0;e<=W;e++){const C=e/W,l=C*a+0,h=Math.sin(l),M=Math.cos(l);H.x=X*h,H.y=g+o*L-k*N/U,H.z=X*M,r.push(H.x,H.y,H.z),R.set(h,q,M).normalize(),P.push(R.x,R.y,R.z),j.push(C,O.b?K/J:1-K/J),Q.push(v),v++}Z.push(Q)}for(k=1;k<=s;k++){const Q=[],X=S-z-(Math.PI-z)*(k/s);K+=w*z/s;const C=Math.cos(X),l=Math.sin(X),h=C*w;for(e=0;e<=W;e++){const X=e/W,M=X*a+0,f=Math.sin(M),m=Math.cos(M);H.x=h*f,H.y=l*w-g,H.z=h*m,r.push(H.x,H.y,H.z),R.set(C*f,l,C*m),P.push(R.x,R.y,R.z),j.push(X,O.b?K/J:1-K/J),Q.push(v),v++}Z.push(Q)}for(e=0;e<W;e++)for(k=0;k<F+U+s;k++){const Q=Z[k][e],X=Z[k+1][e],C=Z[k+1][e+1],l=Z[k][e+1];x.push(Q),x.push(X),x.push(l),x.push(X),x.push(C),x.push(l)}if(x=x.reverse(),Q.orientation&&!Q.orientation.equals(l.k.Up())){const X=new l.b;Q.orientation.clone().scale(.5*Math.PI).cross(l.k.Up()).toQuaternion().toRotationMatrix(X);const C=l.k.Zero();for(let Q=0;Q<r.length;Q+=3)C.set(r[Q],r[Q+1],r[Q+2]),l.k.TransformCoordinatesToRef(C.clone(),X,C),r[Q]=C.x,r[Q+1]=C.y,r[Q+2]=C.z}const n=new f.b;return n.xa=r,n.ya=P,n.Aa=j,n.indices=x,n}function V(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:l.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new h.c(Q,C);return u(X).Ca(M,X.updatable),M}h.c.CreateDecal=(Q,X,C,l,h,M)=>D(Q,X,{position:C,ek:l,size:h,angle:M});h.c.CreateCapsule=(Q,X,C)=>V(Q,X,C),f.b.CreateCapsule=u;var d=C(501),QQ=C(677);class XQ{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Q,this.y=X,Q!==Math.floor(Q)&&(Q=Math.floor(Q),d.c.Warn("x is not an integer, floor(x) used")),X!==Math.floor(X)&&(X=Math.floor(X),d.c.Warn("y is not an integer, floor(y) used"))}clone(){return new XQ(this.x,this.y)}rotate60About(Q){const X=this.x;return this.x=Q.x+Q.y-this.y,this.y=X+this.y-Q.x,this}rotateNeg60About(Q){const X=this.x;return this.x=X+this.y-Q.y,this.y=Q.x+Q.y-X,this}rotate120(Q,X){Q!==Math.floor(Q)&&(Q=Math.floor(Q),d.c.Warn("m not an integer only floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),d.c.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=Q-C-this.y,this.y=X+C,this}rotateNeg120(Q,X){Q!==Math.floor(Q)&&(Q=Math.floor(Q),d.c.Warn("m is not an integer, floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),d.c.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-X,this.y=Q+X-C-this.y,this}toCartesianOrigin(Q,X){const C=l.k.Zero();return C.x=Q.x+2*this.x*X+this.y*X,C.y=Q.y+Math.sqrt(3)*this.y*X,C}static Zero(){return new XQ(0,0)}}class CQ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new lQ("icosahedron","Regular",[[0,QQ.e,-1],[-QQ.e,1,0],[-1,0,-QQ.e],[1,0,-QQ.e],[QQ.e,1,0],[0,QQ.e,1],[-1,0,QQ.e],[-QQ.e,-1,0],[0,-QQ.e,-1],[QQ.e,-1,0],[1,0,QQ.e],[0,-QQ.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Q=12;const X={},C=this.m,l=this.n;let h,M,f,O,m,W=C,U=1,L=0;0!==l&&(W=(0,B.HighestCommonFactor)(C,l)),U=C/W,L=l/W;const w=XQ.Zero(),i=new XQ(C,l),a=new XQ(-l,C+l),F=XQ.Zero(),s=XQ.Zero(),z=XQ.Zero();let x,r,P,j,v=[];const Z=[],g=this.vertByDist,S=(C,l,h,M)=>{x=C+"|"+h,r=l+"|"+M,x in X||r in X?x in X&&!(r in X)?X[r]=X[x]:r in X&&!(x in X)&&(X[x]=X[r]):(X[x]=Q,X[r]=Q,Q++),g[h][0]>2?Z[X[x]]=[-g[h][0],g[h][1],X[x]]:Z[X[x]]=[v[g[h][0]],g[h][1],X[x]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let e=0;e<20;e++){if(v=this.IDATA.face[e],f=v[2],O=v[1],m=v[0],P=w.x+"|"+w.y,x=e+"|"+P,x in X||(X[x]=f,Z[f]=[v[g[P][0]],g[P][1]]),P=i.x+"|"+i.y,x=e+"|"+P,x in X||(X[x]=O,Z[O]=[v[g[P][0]],g[P][1]]),P=a.x+"|"+a.y,x=e+"|"+P,x in X||(X[x]=m,Z[m]=[v[g[P][0]],g[P][1]]),h=this.IDATA.edgematch[e][0],M=this.IDATA.edgematch[e][1],"B"===M)for(let Q=1;Q<W;Q++)s.x=C-Q*(U+L),s.y=l+Q*U,z.x=-Q*L,z.y=Q*(U+L),P=s.x+"|"+s.y,j=z.x+"|"+z.y,S(e,h,P,j);if("O"===M)for(let Q=1;Q<W;Q++)z.x=-Q*L,z.y=Q*(U+L),F.x=Q*U,F.y=Q*L,P=z.x+"|"+z.y,j=F.x+"|"+F.y,S(e,h,P,j);if(h=this.IDATA.edgematch[e][2],M=this.IDATA.edgematch[e][3],M&&"A"===M)for(let Q=1;Q<W;Q++)F.x=Q*U,F.y=Q*L,s.x=C-(W-Q)*(U+L),s.y=l+(W-Q)*U,P=F.x+"|"+F.y,j=s.x+"|"+s.y,S(e,h,P,j);for(let C=0;C<this.vertices.length;C++)P=this.vertices[C].x+"|"+this.vertices[C].y,x=e+"|"+P,x in X||(X[x]=Q++,g[P][0]>2?Z[X[x]]=[-g[P][0],g[P][1],X[x]]:Z[X[x]]=[v[g[P][0]],g[P][1],X[x]])}this.closestTo=Z,this.vecToidx=X}calcCoeffs(){const Q=this.m,X=this.n,C=Math.sqrt(3)/3,l=Q*Q+X*X+Q*X;this.coau=(Q+X)/l,this.cobu=-X/l,this.coav=-C*(Q-X)/l,this.cobv=C*(2*Q+X)/l}createInnerFacets(){const Q=this.m,X=this.n;for(let C=0;C<X+Q+1;C++)for(let Q=this.min[C];Q<this.max[C]+1;Q++)Q<this.max[C]&&Q<this.max[C+1]+1&&this.innerFacets.push(["|"+Q+"|"+C,"|"+Q+"|"+(C+1),"|"+(Q+1)+"|"+C]),C>0&&Q<this.max[C-1]&&Q+1<this.max[C]+1&&this.innerFacets.push(["|"+Q+"|"+C,"|"+(Q+1)+"|"+C,"|"+(Q+1)+"|"+(C-1)])}edgeVecsABOB(){const Q=this.m,X=this.n,C=new XQ(-X,Q+X);for(let l=1;l<Q+X;l++){const Q=new XQ(this.min[l],l),X=new XQ(this.min[l-1],l-1),h=new XQ(this.min[l+1],l+1),M=Q.clone(),f=X.clone(),O=h.clone();M.rotate60About(C),f.rotate60About(C),O.rotate60About(C);const m=new XQ(this.max[M.y],M.y),W=new XQ(this.max[M.y-1],M.y-1),U=new XQ(this.max[M.y-1]-1,M.y-1);M.x===m.x&&M.y===m.y||(M.x!==W.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Q,W,U]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Q,U,m])):M.y===O.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Q,X,W]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Q,W,h])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Q,X,W]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Q,W,m])))}}mapABOBtoOBOA(){const Q=new XQ(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const C=[];for(let l=0;l<3;l++)Q.x=this.isoVecsABOB[X][l].x,Q.y=this.isoVecsABOB[X][l].y,0===this.vertexTypes[X][l]&&Q.rotateNeg120(this.m,this.n),C.push(Q.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const Q=new XQ(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const C=[];for(let l=0;l<3;l++)Q.x=this.isoVecsABOB[X][l].x,Q.y=this.isoVecsABOB[X][l].y,1===this.vertexTypes[X][l]&&Q.rotate120(this.m,this.n),C.push(Q.clone());this.isoVecsBAOA.push(C)}}MapToFace(Q,X){const C=this.IDATA.face[Q],h=C[2],M=C[1],f=C[0],O=l.k.Wj(this.IDATA.vertex[h]),m=l.k.Wj(this.IDATA.vertex[M]),W=l.k.Wj(this.IDATA.vertex[f]),U=m.Od(O),L=W.Od(O),w=U.scale(this.coau).add(L.scale(this.cobu)),i=U.scale(this.coav).add(L.scale(this.cobv)),a=[];let F,s=l.e.Yj[0];for(let l=0;l<this.cartesian.length;l++)s=w.scale(this.cartesian[l].x).add(i.scale(this.cartesian[l].y)).add(O),a[l]=[s.x,s.y,s.z],F=Q+"|"+this.vertices[l].x+"|"+this.vertices[l].y,X.vertex[this.vecToidx[F]]=[s.x,s.y,s.z]}build(Q,X){const C=[],l=XQ.Zero(),h=new XQ(Q,X),M=new XQ(-X,Q+X);C.push(l,h,M);for(let P=X;P<Q+1;P++)for(let X=0;X<Q+1-P;X++)C.push(new XQ(X,P));if(X>0){const l=(0,B.HighestCommonFactor)(Q,X),h=Q/l,M=X/l;for(let O=1;O<l;O++)C.push(new XQ(O*h,O*M)),C.push(new XQ(-O*M,O*(h+M))),C.push(new XQ(Q-O*(h+M),X+O*h));const f=Q/X;for(let O=1;O<X;O++)for(let l=0;l<O*f;l++)C.push(new XQ(l,O)),C.push(new XQ(l,O).rotate120(Q,X)),C.push(new XQ(l,O).rotateNeg120(Q,X))}C.sort(((Q,X)=>Q.x-X.x)),C.sort(((Q,X)=>Q.y-X.y));const f=new Array(Q+X+1),O=new Array(Q+X+1);for(let P=0;P<f.length;P++)f[P]=1/0,O[P]=-1/0;let m=0,W=0;const U=C.length;for(let P=0;P<U;P++)W=C[P].x,m=C[P].y,f[m]=Math.min(W,f[m]),O[m]=Math.max(W,O[m]);const L=(C,l)=>{const h=C.clone();return"A"===l&&h.rotateNeg120(Q,X),"B"===l&&h.rotate120(Q,X),h.x<0?h.y:h.x+h.y},w=[],i=[],a=[],F=[],s={},z=[];let x=-1,r=-1;for(let P=0;P<U;P++)w[P]=C[P].toCartesianOrigin(new XQ(0,0),.5),i[P]=L(C[P],"O"),a[P]=L(C[P],"A"),F[P]=L(C[P],"B"),i[P]===a[P]&&a[P]===F[P]?(x=3,r=i[P]):i[P]===a[P]?(x=4,r=i[P]):a[P]===F[P]?(x=5,r=a[P]):F[P]===i[P]&&(x=6,r=i[P]),i[P]<a[P]&&i[P]<F[P]&&(x=2,r=i[P]),a[P]<i[P]&&a[P]<F[P]&&(x=1,r=a[P]),F[P]<a[P]&&F[P]<i[P]&&(x=0,r=F[P]),z.push([x,r,C[P].x,C[P].y]);z.sort(((Q,X)=>Q[2]-X[2])),z.sort(((Q,X)=>Q[3]-X[3])),z.sort(((Q,X)=>Q[1]-X[1])),z.sort(((Q,X)=>Q[0]-X[0]));for(let P=0;P<z.length;P++)s[z[P][2]+"|"+z[P][3]]=[z[P][0],z[P][1],P];return this.m=Q,this.n=X,this.vertices=C,this.vertByDist=s,this.cartesian=w,this.min=f,this.max=O,this}}class lQ{constructor(Q,X,C,l){this.name=Q,this.category=X,this.vertex=C,this.face=l}}class hQ extends lQ{innerToData(Q,X){for(let C=0;C<X.innerFacets.length;C++)this.face.push(X.innerFacets[C].map((C=>X.vecToidx[Q+C])))}mapABOBtoDATA(Q,X){const C=X.IDATA.edgematch[Q][0];for(let l=0;l<X.isoVecsABOB.length;l++){const h=[];for(let M=0;M<3;M++)0===X.vertexTypes[l][M]?h.push(Q+"|"+X.isoVecsABOB[l][M].x+"|"+X.isoVecsABOB[l][M].y):h.push(C+"|"+X.isoVecsABOB[l][M].x+"|"+X.isoVecsABOB[l][M].y);this.face.push([X.vecToidx[h[0]],X.vecToidx[h[1]],X.vecToidx[h[2]]])}}mapOBOAtoDATA(Q,X){const C=X.IDATA.edgematch[Q][0];for(let l=0;l<X.isoVecsOBOA.length;l++){const h=[];for(let M=0;M<3;M++)1===X.vertexTypes[l][M]?h.push(Q+"|"+X.isoVecsOBOA[l][M].x+"|"+X.isoVecsOBOA[l][M].y):h.push(C+"|"+X.isoVecsOBOA[l][M].x+"|"+X.isoVecsOBOA[l][M].y);this.face.push([X.vecToidx[h[0]],X.vecToidx[h[1]],X.vecToidx[h[2]]])}}mapBAOAtoDATA(Q,X){const C=X.IDATA.edgematch[Q][2];for(let l=0;l<X.isoVecsBAOA.length;l++){const h=[];for(let M=0;M<3;M++)1===X.vertexTypes[l][M]?h.push(Q+"|"+X.isoVecsBAOA[l][M].x+"|"+X.isoVecsBAOA[l][M].y):h.push(C+"|"+X.isoVecsBAOA[l][M].x+"|"+X.isoVecsBAOA[l][M].y);this.face.push([X.vecToidx[h[0]],X.vecToidx[h[1]],X.vecToidx[h[2]]])}}orderData(Q){const X=[];for(let M=0;M<13;M++)X[M]=[];const C=Q.closestTo;for(let M=0;M<C.length;M++)C[M][0]>-1?C[M][1]>0&&X[C[M][0]].push([M,C[M][1]]):X[12].push([M,C[M][0]]);const l=[];for(let M=0;M<12;M++)l[M]=M;let h=12;for(let M=0;M<12;M++){X[M].sort(((Q,X)=>Q[1]-X[1]));for(let Q=0;Q<X[M].length;Q++)l[X[M][Q][0]]=h++}for(let M=0;M<X[12].length;M++)l[X[12][M][0]]=h++;for(let M=0;M<this.vertex.length;M++)this.vertex[M].push(l[M]);this.vertex.sort(((Q,X)=>Q[3]-X[3]));for(let M=0;M<this.vertex.length;M++)this.vertex[M].pop();for(let M=0;M<this.face.length;M++)for(let Q=0;Q<this.face[M].length;Q++)this.face[M][Q]=l[this.face[M][Q]];this.sharedNodes=X[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Q,X){const C=[],l=[];let h=X.pop();l.push(h);let M=this.face[h].indexOf(Q);M=(M+2)%3;let f=this.face[h][M];C.push(f);let O=0;for(;X.length>0;)h=X[O],this.face[h].indexOf(f)>-1?(M=(this.face[h].indexOf(f)+1)%3,f=this.face[h][M],C.push(f),l.push(h),X.splice(O,1),O=0):O++;return this.adjacentFaces.push(C),l}toGoldbergPolyhedronData(){const Q=new lQ("GeoDual","Goldberg",[],[]);Q.name="GD dual";const X=this.vertex.length,C=new Array(X);for(let m=0;m<X;m++)C[m]=[];for(let m=0;m<this.face.length;m++)for(let Q=0;Q<3;Q++)C[this.face[m][Q]].push(m);let l=0,h=0,M=0,f=[],O=[];this.adjacentFaces=[];for(let m=0;m<C.length;m++){Q.face[m]=this.setOrder(m,C[m].concat([]));for(const X of C[m]){l=0,h=0,M=0,f=this.face[X];for(let Q=0;Q<3;Q++)O=this.vertex[f[Q]],l+=O[0],h+=O[1],M+=O[2];Q.vertex[X]=[l/3,h/3,M/3]}}return Q}static BuildGeodesicData(Q){const X=new hQ("Geodesic-m-n","Geodesic",[[0,QQ.e,-1],[-QQ.e,1,0],[-1,0,-QQ.e],[1,0,-QQ.e],[QQ.e,1,0],[0,QQ.e,1],[-1,0,QQ.e],[-QQ.e,-1,0],[0,-QQ.e,-1],[QQ.e,-1,0],[1,0,QQ.e],[0,-QQ.e,1]],[]);Q.setIndices(),Q.calcCoeffs(),Q.createInnerFacets(),Q.edgeVecsABOB(),Q.mapABOBtoOBOA(),Q.mapABOBtoBAOA();for(let C=0;C<Q.IDATA.face.length;C++)Q.MapToFace(C,X),X.innerToData(C,Q),"B"===Q.IDATA.edgematch[C][1]&&X.mapABOBtoDATA(C,Q),"O"===Q.IDATA.edgematch[C][1]&&X.mapOBOAtoDATA(C,Q),"A"===Q.IDATA.edgematch[C][3]&&X.mapBAOAtoDATA(C,Q);X.orderData(Q);return X.vertex=X.vertex.map((function(Q){const X=Q[0],C=Q[1],l=Q[2],h=Math.sqrt(X*X+C*C+l*l);return Q[0]*=1/h,Q[1]*=1/h,Q[2]*=1/h,Q})),X}}h.c._GoldbergMeshParser=(Q,X)=>MQ.Parse(Q,X);class MQ extends h.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Q,X){return void 0===X?(Q>this.goldbergData.nbUnsharedFaces-1&&(d.c.Warn("Maximum number of unshared faces used"),Q=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Q):(Q>11&&(d.c.Warn("Last pole used"),Q=11),X>this.goldbergData.nbFacesAtPole-1&&(d.c.Warn("Maximum number of faces at a pole used"),X=this.goldbergData.nbFacesAtPole-1),12+Q*this.goldbergData.nbFacesAtPole+X)}_changeGoldbergFaceColors(Q){for(let C=0;C<Q.length;C++){const X=Q[C][0],l=Q[C][1],h=Q[C][2];for(let Q=X;Q<l+1;Q++)this.goldbergData.faceColors[Q]=h}const X=[];for(let C=0;C<12;C++)for(let Q=0;Q<5;Q++)X.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let Q=0;Q<6;Q++)X.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return X}setGoldbergFaceColors(Q){const X=this._changeGoldbergFaceColors(Q);this.Ga(M.g.ColorKind,X)}updateGoldbergFaceColors(Q){const X=this._changeGoldbergFaceColors(Q);this.updateVerticesData(M.g.ColorKind,X)}_changeGoldbergFaceUVs(Q){const X=this.getVerticesData(M.g.UVKind);for(let C=0;C<Q.length;C++){const l=Q[C][0],h=Q[C][1],M=Q[C][2],f=Q[C][3],O=Q[C][4],m=[],W=[];let U,L;for(let Q=0;Q<5;Q++)U=M.x+f*Math.cos(O+Q*Math.PI/2.5),L=M.y+f*Math.sin(O+Q*Math.PI/2.5),U<0&&(U=0),U>1&&(U=1),m.push(U,L);for(let Q=0;Q<6;Q++)U=M.x+f*Math.cos(O+Q*Math.PI/3),L=M.y+f*Math.sin(O+Q*Math.PI/3),U<0&&(U=0),U>1&&(U=1),W.push(U,L);for(let Q=l;Q<Math.min(12,h+1);Q++)for(let C=0;C<5;C++)X[10*Q+2*C]=m[2*C],X[10*Q+2*C+1]=m[2*C+1];for(let Q=Math.max(12,l);Q<h+1;Q++)for(let C=0;C<6;C++)X[12*Q-24+2*C]=W[2*C],X[12*Q-23+2*C]=W[2*C+1]}return X}setGoldbergFaceUVs(Q){const X=this._changeGoldbergFaceUVs(Q);this.Ga(M.g.UVKind,X)}updateGoldbergFaceUVs(Q){const X=this._changeGoldbergFaceUVs(Q);this.updateVerticesData(M.g.UVKind,X)}placeOnGoldbergFaceAt(Q,X,C){const h=l.k.RotationFromAxis(this.goldbergData.faceXaxis[X],this.goldbergData.faceYaxis[X],this.goldbergData.faceZaxis[X]);Q.rotation=h,Q.position=this.goldbergData.faceCenters[X].add(this.goldbergData.faceXaxis[X].scale(C.x)).add(this.goldbergData.faceYaxis[X].scale(C.y)).add(this.goldbergData.faceZaxis[X].scale(C.z))}serialize(Q){super.serialize(Q),Q.type="GoldbergMesh";const X={};if(X.adjacentFaces=this.goldbergData.adjacentFaces,X.nbSharedFaces=this.goldbergData.nbSharedFaces,X.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,X.nbFaces=this.goldbergData.nbFaces,X.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){X.faceColors=[];for(const Q of this.goldbergData.faceColors)X.faceColors.push(Q.dk())}if(this.goldbergData.faceCenters){X.faceCenters=[];for(const Q of this.goldbergData.faceCenters)X.faceCenters.push(Q.dk())}if(this.goldbergData.faceZaxis){X.faceZaxis=[];for(const Q of this.goldbergData.faceZaxis)X.faceZaxis.push(Q.dk())}if(this.goldbergData.faceYaxis){X.faceYaxis=[];for(const Q of this.goldbergData.faceYaxis)X.faceYaxis.push(Q.dk())}if(this.goldbergData.faceXaxis){X.faceXaxis=[];for(const Q of this.goldbergData.faceXaxis)X.faceXaxis.push(Q.dk())}Q.goldbergData=X}static Parse(Q,X){const C=Q.goldbergData;C.faceColors=C.faceColors.map((Q=>w.d.Wj(Q))),C.faceCenters=C.faceCenters.map((Q=>l.k.Wj(Q))),C.faceZaxis=C.faceZaxis.map((Q=>l.k.Wj(Q))),C.faceXaxis=C.faceXaxis.map((Q=>l.k.Wj(Q))),C.faceYaxis=C.faceYaxis.map((Q=>l.k.Wj(Q)));const h=new MQ(Q.name,X);return h.goldbergData=C,h}}var fQ=C(12253);const OQ={CreateBox:L.c,CreateTiledBox:s,CreateSphere:z.e,CreateDisc:U.e,CreateIcoSphere:E,CreateRibbon:W,CreateCylinder:j,CreateTorus:Z,CreateTorusKnot:S,CreateLineSystem:e.g,Ak:e.k,CreateDashedLines:e.d,ExtrudeShape:H,ExtrudeShapeCustom:o,CreateLathe:Y,CreateTiledPlane:a,Bk:J.d,CreateGround:K.h,CreateTiledGround:K.j,CreateGroundFromHeightMap:K.e,CreatePolygon:k.b,ExtrudePolygon:k.c,CreateTube:N,CreatePolyhedron:n,CreateGeodesic:function(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=X.m||1;l!==Math.floor(l)&&(l=Math.floor(l),d.c.Warn("m not an integer only floor(m) used"));let h=X.n||0;if(h!==Math.floor(h)&&(h=Math.floor(h),d.c.Warn("n not an integer only floor(n) used")),h>l){const Q=h;h=l,l=Q,d.c.Warn("n > m therefore m and n swapped")}const M=new CQ;return M.build(l,h),n(Q,{custom:hQ.BuildGeodesicData(M),size:X.size,sizeX:X.sizeX,sizeY:X.sizeY,sizeZ:X.sizeZ,faceUV:X.faceUV,faceColors:X.faceColors,flat:X.flat,updatable:X.updatable,sideOrientation:X.sideOrientation,frontUVs:X.frontUVs,backUVs:X.backUVs},C)},CreateGoldberg:function(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=X.size,m=X.sizeX||M||1,W=X.sizeY||M||1,U=X.sizeZ||M||1;let L=X.m||1;L!==Math.floor(L)&&(L=Math.floor(L),d.c.Warn("m not an integer only floor(m) used"));let i=X.n||0;if(i!==Math.floor(i)&&(i=Math.floor(i),d.c.Warn("n not an integer only floor(n) used")),i>L){const Q=i;i=L,L=Q,d.c.Warn("n > m therefore m and n swapped")}const a=new CQ;a.build(L,i);const F=hQ.BuildGeodesicData(a),s=F.toGoldbergPolyhedronData(),z=new MQ(Q,C);X.sideOrientation=h.c._GetDefaultSideOrientation(X.sideOrientation),z._originalBuilderSideOrientation=X.sideOrientation;(function(Q,X){const C=Q.size,h=Q.sizeX||C||1,M=Q.sizeY||C||1,m=Q.sizeZ||C||1,W=0===Q.sideOrientation?0:Q.sideOrientation||f.b.DEFAULTSIDE,U=[],L=[],w=[],i=[];let a=1/0,F=-1/0,s=1/0,z=-1/0;for(let l=0;l<X.vertex.length;l++)a=Math.min(a,X.vertex[l][0]*h),F=Math.max(F,X.vertex[l][0]*h),s=Math.min(s,X.vertex[l][1]*M),z=Math.max(z,X.vertex[l][1]*M);let x=0;for(let f=0;f<X.face.length;f++){const Q=X.face[f],C=l.k.Wj(X.vertex[Q[0]]),W=l.k.Wj(X.vertex[Q[2]]),r=l.k.Wj(X.vertex[Q[1]]),P=W.Od(C),j=r.Od(C),v=l.k.Cross(j,P).normalize();for(let l=0;l<Q.length;l++){w.push(v.x,v.y,v.z);const C=X.vertex[Q[l]];U.push(C[0]*h,C[1]*M,C[2]*m);const f=(C[1]*M-s)/(z-s);i.push((C[0]*h-a)/(F-a),O.b?1-f:f)}for(let X=0;X<Q.length-2;X++)L.push(x,x+X+2,x+X+1);x+=Q.length}f.b._ComputeSides(W,U,L,w,i);const r=new f.b;return r.xa=U,r.indices=L,r.ya=w,r.Aa=i,r})(X,s).Ca(z,X.updatable),z.goldbergData.nbSharedFaces=F.sharedNodes,z.goldbergData.nbUnsharedFaces=F.poleNodes,z.goldbergData.adjacentFaces=F.adjacentFaces,z.goldbergData.nbFaces=z.goldbergData.nbSharedFaces+z.goldbergData.nbUnsharedFaces,z.goldbergData.nbFacesAtPole=(z.goldbergData.nbUnsharedFaces-12)/12;for(let h=0;h<F.vertex.length;h++)z.goldbergData.faceCenters.push(l.k.Wj(F.vertex[h])),z.goldbergData.faceCenters[h].x*=m,z.goldbergData.faceCenters[h].y*=W,z.goldbergData.faceCenters[h].z*=U,z.goldbergData.faceColors.push(new w.d(1,1,1,1));for(let h=0;h<s.face.length;h++){const Q=s.face[h],X=l.k.Wj(s.vertex[Q[0]]),C=l.k.Wj(s.vertex[Q[2]]),M=l.k.Wj(s.vertex[Q[1]]),f=C.Od(X),O=M.Od(X),m=l.k.Cross(O,f).normalize(),W=l.k.Cross(O,m).normalize();z.goldbergData.faceXaxis.push(O.normalize()),z.goldbergData.faceYaxis.push(m),z.goldbergData.faceZaxis.push(W)}return z},CreateDecal:D,CreateCapsule:V,CreateText:fQ.h}},12682:(Q,X,C)=>{"use strict";C.d(X,{e:()=>OX});var l=C(668),h=C(12174);class M extends h.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var f=C(702),O=(C(2482),C(620));class m{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Q){this._targetStopDuration!==Q&&(this._targetStopDuration=Q)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Q){this._noiseTexture!==Q&&(this._noiseTexture=Q,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Q){this._animationSheetEnabled!==Q&&(this._animationSheetEnabled=Q)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Q){this._isAnimationSheetEnabled!=Q&&(this._isAnimationSheetEnabled=Q,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Q){this._useLogarithmicDepth=Q&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Q){switch(Q){case m.BLENDMODE_MULTIPLYADD:return;case m.BLENDMODE_ADD:Q=1;break;case m.BLENDMODE_ONEONE:Q=6;break;case m.BLENDMODE_STANDARD:Q=2;break;case m.BLENDMODE_MULTIPLY:Q=4;break;case m.BLENDMODE_SUBTRACT:Q=3}this._engine.setAlphaMode(Q)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:l.k.Zero()}set direction1(Q){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Q)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:l.k.Zero()}set direction2(Q){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Q)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:l.k.Zero()}set minEmitBox(Q){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Q)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:l.k.Zero()}set maxEmitBox(Q){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Q)}get billboardMode(){return this._billboardMode}set billboardMode(Q){this._billboardMode!==Q&&(this._billboardMode=Q,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Q){this._isBillboardBased!==Q&&(this._isBillboardBased=Q,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Q){this._attachImageProcessingConfiguration(Q)}_attachImageProcessingConfiguration(Q){Q!==this._imageProcessingConfiguration&&(!Q&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Q)}_reset(){}_removeGradientAndTexture(Q,X,C){if(!X)return this;let l=0;for(const h of X){if(h.gradient===Q){X.splice(l,1);break}l++}return C&&C.dispose(),this}constructor(Q){this.animations=[],this.renderingGroupId=0,this.j=l.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new l.k(10,10,10),this.onAnimationEnd=null,this.blendMode=m.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new l.h(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Qg=new l.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=l.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new f.d(1,1,1,1),this.color2=new f.d(1,1,1,1),this.colorDead=new f.d(0,0,0,1),this.textureMask=new f.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new M,this.id=Q,this.name=Q}createPointEmitter(Q,X){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new l.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new l.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new l.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new l.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new l.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new l.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Q,X,C,l){throw new Error("Method not implemented.")}}m.BLENDMODE_ONEONE=0,m.BLENDMODE_STANDARD=1,m.BLENDMODE_ADD=2,m.BLENDMODE_MULTIPLY=3,m.BLENDMODE_MULTIPLYADD=4,m.BLENDMODE_SUBTRACT=-1,(0,O.g)("BABYLON.BaseParticleSystem",m);var W=C(690),U=C(504);class L{constructor(){this.direction1=new l.k(0,1,0),this.direction2=new l.k(0,1,0),this.minEmitBox=new l.k(-.5,-.5,-.5),this.maxEmitBox=new l.k(.5,.5,.5)}startDirectionFunction(Q,X,C,h){const M=(0,W.RandomRange)(this.direction1.x,this.direction2.x),f=(0,W.RandomRange)(this.direction1.y,this.direction2.y),O=(0,W.RandomRange)(this.direction1.z,this.direction2.z);if(h)return X.x=M,X.y=f,void(X.z=O);l.k.TransformNormalFromFloatsToRef(M,f,O,Q,X)}startPositionFunction(Q,X,C,h){const M=(0,W.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),f=(0,W.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),O=(0,W.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(h)return X.x=M,X.y=f,void(X.z=O);l.k.TransformCoordinatesFromFloatsToRef(M,f,O,Q,X)}clone(){const Q=new L;return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setVector3("direction1",this.direction1),Q.setVector3("direction2",this.direction2),Q.setVector3("minEmitBox",this.minEmitBox),Q.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Q){Q.addUniform("direction1",3),Q.addUniform("direction2",3),Q.addUniform("minEmitBox",3),Q.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.direction1=this.direction1.dk(),Q.direction2=this.direction2.dk(),Q.minEmitBox=this.minEmitBox.dk(),Q.maxEmitBox=this.maxEmitBox.dk(),Q}parse(Q){l.k.FromArrayToRef(Q.direction1,0,this.direction1),l.k.FromArrayToRef(Q.direction2,0,this.direction2),l.k.FromArrayToRef(Q.minEmitBox,0,this.minEmitBox),l.k.FromArrayToRef(Q.maxEmitBox,0,this.maxEmitBox)}}class w{get radius(){return this._radius}set radius(Q){this._radius=Q,this._buildHeight()}get angle(){return this._angle}set angle(Q){this._angle=Q,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=X,this.radius=Q}startDirectionFunction(Q,X,C,h){h?l.e.Yj[0].p(C.Xc).normalize():C.position.subtractToRef(Q.getTranslation(),l.e.Yj[0]).normalize();const M=(0,W.RandomRange)(0,this.directionRandomizer),f=(0,W.RandomRange)(0,this.directionRandomizer),O=(0,W.RandomRange)(0,this.directionRandomizer);X.x=l.e.Yj[0].x+M,X.y=l.e.Yj[0].y+f,X.z=l.e.Yj[0].z+O,X.normalize()}startPositionFunction(Q,X,C,h){const M=(0,W.RandomRange)(0,2*Math.PI);let f;this.emitFromSpawnPointOnly?f=1e-4:(f=(0,W.RandomRange)(0,this.heightRange),f=1-f*f);let O=this._radius-(0,W.RandomRange)(0,this._radius*this.radiusRange);O*=f;const m=O*Math.sin(M),U=O*Math.cos(M),L=f*this._height;if(h)return X.x=m,X.y=L,void(X.z=U);l.k.TransformCoordinatesFromFloatsToRef(m,L,U,Q,X)}clone(){const Q=new w(this._radius,this._angle,this.directionRandomizer);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat2("radius",this._radius,this.radiusRange),Q.setFloat("coneAngle",this._angle),Q.setFloat2("height",this._height,this.heightRange),Q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Q){Q.addUniform("radius",2),Q.addUniform("coneAngle",1),Q.addUniform("height",2),Q.addUniform("directionRandomizer",1)}getEffectDefines(){let Q="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Q+="\n#define CONEEMITTERSPAWNPOINT"),Q}getClassName(){return"ConeParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.radius=this._radius,Q.angle=this._angle,Q.directionRandomizer=this.directionRandomizer,Q.radiusRange=this.radiusRange,Q.heightRange=this.heightRange,Q.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Q}parse(Q){this.radius=Q.radius,this.angle=Q.angle,this.directionRandomizer=Q.directionRandomizer,this.radiusRange=void 0!==Q.radiusRange?Q.radiusRange:1,this.heightRange=void 0!==Q.radiusRange?Q.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Q.emitFromSpawnPointOnly&&Q.emitFromSpawnPointOnly}}class i extends w{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0);super(Q,X),this.direction1=C,this.direction2=h}startDirectionFunction(Q,X){const C=(0,W.RandomRange)(this.direction1.x,this.direction2.x),h=(0,W.RandomRange)(this.direction1.y,this.direction2.y),M=(0,W.RandomRange)(this.direction1.z,this.direction2.z);l.k.TransformNormalFromFloatsToRef(C,h,M,Q,X)}clone(){const Q=new i(this.radius,this.angle,this.direction1,this.direction2);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat("radius",this.radius),Q.setFloat("radiusRange",this.radiusRange),Q.setVector3("direction1",this.direction1),Q.setVector3("direction2",this.direction2)}buildUniformLayout(Q){Q.addUniform("radius",1),Q.addUniform("radiusRange",1),Q.addUniform("direction1",3),Q.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Q=super.serialize();return Q.direction1=this.direction1.dk(),Q.direction2=this.direction2.dk(),Q}parse(Q){super.parse(Q),this.direction1.p(Q.direction1),this.direction2.p(Q.direction2)}}class a{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Q,this.height=X,this.radiusRange=C,this.directionRandomizer=h,this._tempVector=l.k.Zero()}startDirectionFunction(Q,X,C,h,M){C.position.subtractToRef(Q.getTranslation(),this._tempVector),this._tempVector.normalize(),l.k.TransformNormalToRef(this._tempVector,M,this._tempVector);const f=(0,W.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let O=Math.atan2(this._tempVector.x,this._tempVector.z);O+=(0,W.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=f,this._tempVector.x=Math.sin(O),this._tempVector.z=Math.cos(O),this._tempVector.normalize(),h?X.p(this._tempVector):l.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Q,X)}startPositionFunction(Q,X,C,h){const M=(0,W.RandomRange)(-this.height/2,this.height/2),f=(0,W.RandomRange)(0,2*Math.PI),O=(0,W.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),m=Math.sqrt(O)*this.radius,U=m*Math.cos(f),L=m*Math.sin(f);h?X.Yc(U,M,L):l.k.TransformCoordinatesFromFloatsToRef(U,M,L,Q,X)}clone(){const Q=new a(this.radius,this.directionRandomizer);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat("radius",this.radius),Q.setFloat("height",this.height),Q.setFloat("radiusRange",this.radiusRange),Q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Q){Q.addUniform("radius",1),Q.addUniform("height",1),Q.addUniform("radiusRange",1),Q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.radius=this.radius,Q.height=this.height,Q.radiusRange=this.radiusRange,Q.directionRandomizer=this.directionRandomizer,Q}parse(Q){this.radius=Q.radius,this.height=Q.height,this.radiusRange=Q.radiusRange,this.directionRandomizer=Q.directionRandomizer}}class F extends a{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0),M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.k(0,1,0);super(Q,X,C),this.direction1=h,this.direction2=M}startDirectionFunction(Q,X,C,h){const M=(0,W.RandomRange)(this.direction1.x,this.direction2.x),f=(0,W.RandomRange)(this.direction1.y,this.direction2.y),O=(0,W.RandomRange)(this.direction1.z,this.direction2.z);h?X.Yc(M,f,O):l.k.TransformNormalFromFloatsToRef(M,f,O,Q,X)}clone(){const Q=new F(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat("radius",this.radius),Q.setFloat("height",this.height),Q.setFloat("radiusRange",this.radiusRange),Q.setVector3("direction1",this.direction1),Q.setVector3("direction2",this.direction2)}buildUniformLayout(Q){Q.addUniform("radius",1),Q.addUniform("height",1),Q.addUniform("radiusRange",1),Q.addUniform("direction1",3),Q.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Q=super.serialize();return Q.direction1=this.direction1.dk(),Q.direction2=this.direction2.dk(),Q}parse(Q){super.parse(Q),l.k.FromArrayToRef(Q.direction1,0,this.direction1),l.k.FromArrayToRef(Q.direction2,0,this.direction2)}}class s{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Q,this.radiusRange=X,this.directionRandomizer=C}startDirectionFunction(Q,X,C,h){const M=C.position.Od(Q.getTranslation()).normalize(),f=(0,W.RandomRange)(0,this.directionRandomizer),O=(0,W.RandomRange)(0,this.directionRandomizer),m=(0,W.RandomRange)(0,this.directionRandomizer);M.x+=f,M.y+=O,M.z+=m,M.normalize(),h?X.p(M):l.k.TransformNormalFromFloatsToRef(M.x,M.y,M.z,Q,X)}startPositionFunction(Q,X,C,h){const M=this.radius-(0,W.RandomRange)(0,this.radius*this.radiusRange),f=(0,W.RandomRange)(0,1),O=(0,W.RandomRange)(0,2*Math.PI),m=Math.acos(2*f-1),U=M*Math.cos(O)*Math.sin(m),L=M*Math.cos(m),w=M*Math.sin(O)*Math.sin(m);h?X.Yc(U,Math.abs(L),w):l.k.TransformCoordinatesFromFloatsToRef(U,Math.abs(L),w,Q,X)}clone(){const Q=new s(this.radius,this.directionRandomizer);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat("radius",this.radius),Q.setFloat("radiusRange",this.radiusRange),Q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Q){Q.addUniform("radius",1),Q.addUniform("radiusRange",1),Q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.radius=this.radius,Q.radiusRange=this.radiusRange,Q.directionRandomizer=this.directionRandomizer,Q}parse(Q){this.radius=Q.radius,this.radiusRange=Q.radiusRange,this.directionRandomizer=Q.directionRandomizer}}class z{constructor(){this.direction1=new l.k(0,1,0),this.direction2=new l.k(0,1,0)}startDirectionFunction(Q,X,C,h){const M=(0,W.RandomRange)(this.direction1.x,this.direction2.x),f=(0,W.RandomRange)(this.direction1.y,this.direction2.y),O=(0,W.RandomRange)(this.direction1.z,this.direction2.z);h?X.Yc(M,f,O):l.k.TransformNormalFromFloatsToRef(M,f,O,Q,X)}startPositionFunction(Q,X,C,h){h?X.Yc(0,0,0):l.k.TransformCoordinatesFromFloatsToRef(0,0,0,Q,X)}clone(){const Q=new z;return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setVector3("direction1",this.direction1),Q.setVector3("direction2",this.direction2)}buildUniformLayout(Q){Q.addUniform("direction1",3),Q.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.direction1=this.direction1.dk(),Q.direction2=this.direction2.dk(),Q}parse(Q){l.k.FromArrayToRef(Q.direction1,0,this.direction1),l.k.FromArrayToRef(Q.direction2,0,this.direction2)}}class x{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Q,this.radiusRange=X,this.directionRandomizer=C}startDirectionFunction(Q,X,C,h){const M=C.position.Od(Q.getTranslation()).normalize(),f=(0,W.RandomRange)(0,this.directionRandomizer),O=(0,W.RandomRange)(0,this.directionRandomizer),m=(0,W.RandomRange)(0,this.directionRandomizer);M.x+=f,M.y+=O,M.z+=m,M.normalize(),h?X.p(M):l.k.TransformNormalFromFloatsToRef(M.x,M.y,M.z,Q,X)}startPositionFunction(Q,X,C,h){const M=this.radius-(0,W.RandomRange)(0,this.radius*this.radiusRange),f=(0,W.RandomRange)(0,1),O=(0,W.RandomRange)(0,2*Math.PI),m=Math.acos(2*f-1),U=M*Math.cos(O)*Math.sin(m),L=M*Math.cos(m),w=M*Math.sin(O)*Math.sin(m);h?X.Yc(U,L,w):l.k.TransformCoordinatesFromFloatsToRef(U,L,w,Q,X)}clone(){const Q=new x(this.radius,this.directionRandomizer);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat("radius",this.radius),Q.setFloat("radiusRange",this.radiusRange),Q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Q){Q.addUniform("radius",1),Q.addUniform("radiusRange",1),Q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.radius=this.radius,Q.radiusRange=this.radiusRange,Q.directionRandomizer=this.directionRandomizer,Q}parse(Q){this.radius=Q.radius,this.radiusRange=Q.radiusRange,this.directionRandomizer=Q.directionRandomizer}}class r extends x{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.k(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0);super(Q),this.direction1=X,this.direction2=C}startDirectionFunction(Q,X){const C=(0,W.RandomRange)(this.direction1.x,this.direction2.x),h=(0,W.RandomRange)(this.direction1.y,this.direction2.y),M=(0,W.RandomRange)(this.direction1.z,this.direction2.z);l.k.TransformNormalFromFloatsToRef(C,h,M,Q,X)}clone(){const Q=new r(this.radius,this.direction1,this.direction2);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setFloat("radius",this.radius),Q.setFloat("radiusRange",this.radiusRange),Q.setVector3("direction1",this.direction1),Q.setVector3("direction2",this.direction2)}buildUniformLayout(Q){Q.addUniform("radius",1),Q.addUniform("radiusRange",1),Q.addUniform("direction1",3),Q.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Q=super.serialize();return Q.direction1=this.direction1.dk(),Q.direction2=this.direction2.dk(),Q}parse(Q){super.parse(Q),this.direction1.p(Q.direction1),this.direction2.p(Q.direction2)}}class P{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Q,X,C,h){const M=l.e.Yj[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,M);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,M);const Q=l.e.Yj[1];M.subtractToRef(C.position,Q),Q.scaleToRef(1/C.lifeTime,M)}else M.set(0,0,0);h?X.p(M):l.k.TransformNormalToRef(M,Q,X)}startPositionFunction(Q,X,C,h){const M=l.e.Yj[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,M):M.set(0,0,0),h?X.p(M):l.k.TransformCoordinatesToRef(M,Q,X)}clone(){const Q=new P;return U.c.DeepCopy(this,Q),Q}applyToShader(Q){}buildUniformLayout(Q){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Q={};return Q.type=this.getClassName(),Q.particlePositionGenerator=this.particlePositionGenerator,Q.particleDestinationGenerator=this.particleDestinationGenerator,Q}parse(Q){Q.particlePositionGenerator&&(this.particlePositionGenerator=Q.particlePositionGenerator),Q.particleDestinationGenerator&&(this.particleDestinationGenerator=Q.particleDestinationGenerator)}}var j=C(722);class v{get mesh(){return this._mesh}set mesh(Q){this._mesh!==Q&&(this._mesh=Q,Q?(this._indices=Q.Xj(),this._positions=Q.getVerticesData(j.g.PositionKind),this._normals=Q.getVerticesData(j.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=l.k.Zero(),this._mesh=null,this.direction1=new l.k(0,1,0),this.direction2=new l.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Q}startDirectionFunction(Q,X,C,h){if(this.useMeshNormalsForDirection&&this._normals)return void l.k.TransformNormalToRef(this._storedNormal,Q,X);const M=(0,W.RandomRange)(this.direction1.x,this.direction2.x),f=(0,W.RandomRange)(this.direction1.y,this.direction2.y),O=(0,W.RandomRange)(this.direction1.z,this.direction2.z);h?X.Yc(M,f,O):l.k.TransformNormalFromFloatsToRef(M,f,O,Q,X)}startPositionFunction(Q,X,C,h){if(!this._indices||!this._positions)return;const M=3*(Math.random()*(this._indices.length/3)|0),f=Math.random(),O=Math.random()*(1-f),m=1-f-O,W=this._indices[M],U=this._indices[M+1],L=this._indices[M+2],w=l.e.Yj[0],i=l.e.Yj[1],a=l.e.Yj[2],F=l.e.Yj[3];l.k.FromArrayToRef(this._positions,3*W,w),l.k.FromArrayToRef(this._positions,3*U,i),l.k.FromArrayToRef(this._positions,3*L,a),F.x=f*w.x+O*i.x+m*a.x,F.y=f*w.y+O*i.y+m*a.y,F.z=f*w.z+O*i.z+m*a.z,h?X.Yc(F.x,F.y,F.z):l.k.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,Q,X),this.useMeshNormalsForDirection&&this._normals&&(l.k.FromArrayToRef(this._normals,3*W,w),l.k.FromArrayToRef(this._normals,3*U,i),l.k.FromArrayToRef(this._normals,3*L,a),this._storedNormal.x=f*w.x+O*i.x+m*a.x,this._storedNormal.y=f*w.y+O*i.y+m*a.y,this._storedNormal.z=f*w.z+O*i.z+m*a.z)}clone(){const Q=new v(this.mesh);return U.c.DeepCopy(this,Q),Q}applyToShader(Q){Q.setVector3("direction1",this.direction1),Q.setVector3("direction2",this.direction2)}buildUniformLayout(Q){Q.addUniform("direction1",3),Q.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Q;const X={};return X.type=this.getClassName(),X.direction1=this.direction1.dk(),X.direction2=this.direction2.dk(),X.meshId=null===(Q=this.mesh)||void 0===Q?void 0:Q.id,X.useMeshNormalsForDirection=this.useMeshNormalsForDirection,X}parse(Q,X){l.k.FromArrayToRef(Q.direction1,0,this.direction1),l.k.FromArrayToRef(Q.direction2,0,this.direction2),Q.meshId&&X&&(this.mesh=X.getLastMeshById(Q.meshId)),this.useMeshNormalsForDirection=Q.useMeshNormalsForDirection}}class Z{_isUbo(Q){return void 0!==Q.addUniform}constructor(Q){this._isUbo(Q)?(this.setMatrix3x3=Q.updateMatrix3x3.bind(Q),this.setMatrix2x2=Q.updateMatrix2x2.bind(Q),this.setFloat=Q.updateFloat.bind(Q),this.setFloat2=Q.updateFloat2.bind(Q),this.setFloat3=Q.updateFloat3.bind(Q),this.setFloat4=Q.updateFloat4.bind(Q),this.setFloatArray=Q.updateFloatArray.bind(Q),this.setArray=Q.updateArray.bind(Q),this.setIntArray=Q.updateIntArray.bind(Q),this.setMatrix=Q.jk.bind(Q),this.setMatrices=Q.updateMatrices.bind(Q),this.setVector3=Q.updateVector3.bind(Q),this.setVector4=Q.updateVector4.bind(Q),this.setColor3=Q.updateColor3.bind(Q),this.setColor4=Q.updateColor4.bind(Q),this.setDirectColor4=Q.updateDirectColor4.bind(Q),this.setInt=Q.updateInt.bind(Q),this.setInt2=Q.updateInt2.bind(Q),this.setInt3=Q.updateInt3.bind(Q),this.setInt4=Q.updateInt4.bind(Q)):(this.setMatrix3x3=Q.setMatrix3x3.bind(Q),this.setMatrix2x2=Q.setMatrix2x2.bind(Q),this.setFloat=Q.setFloat.bind(Q),this.setFloat2=Q.setFloat2.bind(Q),this.setFloat3=Q.setFloat3.bind(Q),this.setFloat4=Q.setFloat4.bind(Q),this.setFloatArray=Q.setFloatArray.bind(Q),this.setArray=Q.setArray.bind(Q),this.setIntArray=Q.setIntArray.bind(Q),this.setMatrix=Q.setMatrix.bind(Q),this.setMatrices=Q.setMatrices.bind(Q),this.setVector3=Q.setVector3.bind(Q),this.setVector4=Q.setVector4.bind(Q),this.setColor3=Q.setColor3.bind(Q),this.setColor4=Q.setColor4.bind(Q),this.setDirectColor4=Q.setDirectColor4.bind(Q),this.setInt=Q.setInt.bind(Q),this.setInt2=Q.setInt2.bind(Q),this.setInt3=Q.setInt3.bind(Q),this.setInt4=Q.setInt4.bind(Q))}}var g=C(568);const S="gpuUpdateParticlesPixelShader",e="#version 300 es\nvoid main() {discard;}\n";g.b.ShadersStore[S]||(g.b.ShadersStore[S]=e);const k="gpuUpdateParticlesVertexShader",R="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";g.b.ShadersStore[k]||(g.b.ShadersStore[k]=R);(0,O.g)("BABYLON.WebGL2ParticleSystem",class{constructor(Q,X){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Q,this._engine=X,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Q;return(null===(Q=this._updateEffect)||void 0===Q?void 0:Q.isReady())??!1}createUpdateBuffer(Q){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof P&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Q,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Z(this._updateEffect)}createVertexBuffers(Q,X){this._updateVAO.push(this._createUpdateVAO(Q)),this._renderVAO.push(this._engine.recordVertexArrayObject(X,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=X}createParticleBuffer(Q){return Q}bindDrawBuffers(Q,X,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,X):this._engine.bindVertexArrayObject(this._renderVAO[Q],null)}preUpdateParticleBuffer(){const Q=this._engine;if(this._engine.enableEffect(this._updateEffect),!Q.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Q,X,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Q],null);const l=this._engine;l.bindTransformFeedbackBuffer(X.getBuffer()),l.setRasterizerState(!1),l.beginTransformFeedback(!0),l.drawArraysType(3,0,C),l.endTransformFeedback(),l.setRasterizerState(!0),l.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Q=0;Q<this._updateVAO.length;Q++)this._engine.releaseVertexArrayObject(this._updateVAO[Q]);this._updateVAO.length=0;for(let Q=0;Q<this._renderVAO.length;Q++)this._engine.releaseVertexArrayObject(this._renderVAO[Q]);this._renderVAO.length=0}_createUpdateVAO(Q){const X={};X.position=Q.createVertexBuffer("position",0,3);let C=3;X.age=Q.createVertexBuffer("age",C,1),C+=1,X.size=Q.createVertexBuffer("size",C,3),C+=3,X.life=Q.createVertexBuffer("life",C,1),C+=1,X.seed=Q.createVertexBuffer("seed",C,4),C+=4,X.direction=Q.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof P&&(X.initialPosition=Q.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(X.color=Q.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(X.initialDirection=Q.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(X.noiseCoordinates1=Q.createVertexBuffer("noiseCoordinates1",C,3),C+=3,X.noiseCoordinates2=Q.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(X.angle=Q.createVertexBuffer("angle",C,1),C+=1):(X.angle=Q.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(X.cellIndex=Q.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(X.cellStartOffset=Q.createVertexBuffer("cellStartOffset",C,1),C+=1));const l=this._engine.recordVertexArrayObject(X,null,this._updateEffect);return this._engine.bindArrayBuffer(null),l}});class H{constructor(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,l=arguments.length>3?arguments[3]:void 0;this._engine=Q,this._label=l,this._engine._storageBuffers.push(this),this._create(X,C)}_create(Q,X){this._bufferSize=Q,this._creationFlags=X,this._buffer=this._engine.createStorageBuffer(Q,X,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Q,X,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Q,X,C)}async read(Q,X,C,l){return await this._engine.readFromStorageBuffer(this._buffer,Q,X,C,l)}dispose(){const Q=this._engine._storageBuffers,X=Q.indexOf(this);-1!==X&&(Q[X]=Q[Q.length-1],Q.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var o=C(644),T=C(650),Y=C(695),J=C(2397),K=C(2564),N=C(501),q=C(602),n=C(2505);class c{constructor(){this._gpuTimeInFrameId=-1,this.counter=new n.e}_addDuration(Q,X){Q<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Q?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(X,!1),this._gpuTimeInFrameId=Q):this.counter.addCount(X,!1))}}var E=C(550);class B{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Q,this._engine=X,this.uniqueId=K.b.UniqueId,X.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new c),this._engine.getCaps().supportComputeShaders?l.bindingsMapping?(this._context=X.createComputeContext(),this._shaderPath=C,this._options={bindingsMapping:{},defines:[],...l}):N.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):N.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Q,X){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=this._bindings[Q];this._bindings[Q]={type:C?0:4,object:X,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!l||l.object!==X||l.type!==this._bindings[Q].type)}setStorageTexture(Q,X){const C=this._bindings[Q];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==X),this._bindings[Q]={type:1,object:X,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(Q,X){const C=this._bindings[Q];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==X),this._bindings[Q]={type:6,object:X,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(Q,X){return!!X.externalTexture&&(this.setExternalTexture(Q,X.externalTexture),!0)}setUniformBuffer(Q,X){const C=this._bindings[Q];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==X),this._bindings[Q]={type:B._BufferIsDataBuffer(X)?7:2,object:X,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(Q,X){const C=this._bindings[Q];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==X),this._bindings[Q]={type:B._BufferIsDataBuffer(X)?7:3,object:X,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(Q,X){const C=this._bindings[Q];this._contextIsDirty||(this._contextIsDirty=!C||!X.compareSampler(C.object)),this._bindings[Q]={type:5,object:X,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let Q=this._effect;for(const h in this._bindings){const Q=this._bindings[h],X=Q.type,C=Q.object;switch(X){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const X=[],C=this._shaderPath;if(this._options.defines)for(let h=0;h<this._options.defines.length;h++)X.push(this._options.defines[h]);const l=X.join("\n");return this._cachedDefines!==l&&(this._cachedDefines=l,Q=this._engine.createComputeEffect(C,{defines:l,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Q),!!Q.isReady()}dispatch(Q,X,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Q,X,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=B._BufferIsDataBuffer(Q)?Q:Q.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const X in this._bindings){const C=this._bindings[X];if(!this._options.bindingsMapping[X])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+X+"'");switch(C.type){case 0:{const l=this._samplers[X],h=C.object;var Q;if(!l||!h._texture||!l.compareSampler(h._texture))this._samplers[X]=(new q.c).setParameters(h.wrapU,h.wrapV,h.wrapR,h.anisotropicFilteringLevel,h._texture.samplingMode,null===(Q=h._texture)||void 0===Q?void 0:Q._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Q=C.object;Q.getBuffer()!==C.buffer&&(C.buffer=Q.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((h=>{(0,E.e)((()=>this.dispatch(Q,X,C)),h,void 0,l)}))}serialize(){const Q=Y.d.Serialize(this);Q.options=this._options,Q.shaderPath=this._shaderPath,Q.Nl={},Q.textures={};for(const X in this._bindings){const C=this._bindings[X],l=C.object;switch(C.type){case 0:case 4:case 1:{const h=l.serialize();h&&(Q.textures[X]=h,Q.Nl[X]={type:C.type});break}}}return Q}static Parse(Q,X,C){const l=Y.d.Parse((()=>new B(Q.name,X.getEngine(),Q.shaderPath,Q.options)),Q,X,C);for(const h in Q.textures){const M=Q.Nl[h],f=J.e.Parse(Q.textures[h],X,C);0===M.type?l.setTexture(h,f):4===M.type?l.setTexture(h,f,!1):l.setStorageTexture(h,f)}return l}static _BufferIsDataBuffer(Q){return void 0!==Q.underlyingResource}}(0,o.c)([(0,T.N)()],B.prototype,"name",void 0),(0,o.c)([(0,T.N)()],B.prototype,"fastMode",void 0),(0,O.g)("BABYLON.ComputeShader",B);var G=C(819);const b="gpuUpdateParticlesComputeShader",p="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";g.b.ShadersStoreWGSL[b]||(g.b.ShadersStoreWGSL[b]=p);(0,O.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(Q,X){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Q,this._engine=X}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Q;return(null===(Q=this._updateComputeShader)||void 0===Q?void 0:Q.isReady())??!1}createUpdateBuffer(Q){var X;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new B("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:Q.split("\n")}),null===(X=this._simParamsComputeShader)||void 0===X||X.dispose(),this._simParamsComputeShader=new G.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Z(this._simParamsComputeShader)}createVertexBuffers(Q,X){this._renderVertexBuffers.push(X)}createParticleBuffer(Q){const X=new H(this._engine,4*Q.length,11,"ComputeShaderParticleSystemBuffer");return X.update(Q),this._bufferComputeShader.push(X),X.getBuffer()}bindDrawBuffers(Q,X,C){this._engine.bindBuffers(this._renderVertexBuffers[Q],C,X)}preUpdateParticleBuffer(){}updateParticleBuffer(Q,X,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Q]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Q]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var Q;for(let X=0;X<this._bufferComputeShader.length;++X)this._bufferComputeShader[X].dispose();this._bufferComputeShader.length=0,null===(Q=this._simParamsComputeShader)||void 0===Q||Q.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(Q,X,C){this.gradient=Q,this.color1=X,this.color2=C}getColorToRef(Q){this.color2?f.d.LerpToRef(this.color1,this.color2,Math.random(),Q):Q.p(this.color1)}}class t{constructor(Q,X){this.gradient=Q,this.color=X}}class y{constructor(Q,X,C){this.gradient=Q,this.factor1=X,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class A{static GetCurrentGradient(Q,X,C){if(X[0].gradient>Q)return void C(X[0],X[0],1);for(let h=0;h<X.length-1;h++){const l=X[h],M=X[h+1];if(Q>=l.gradient&&Q<=M.gradient){return void C(l,M,(Q-l.gradient)/(M.gradient-l.gradient))}}const l=X.length-1;C(X[l],X[l],1)}}var D=C(482),u=C(12142),V=C(524);class d{constructor(Q){this.particleSystem=Q,this.position=l.k.Zero(),this.direction=l.k.Zero(),this.color=new f.d(0,0,0,0),this.colorStep=new f.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new l.h(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new f.d(0,0,0,0),this._currentColor2=new f.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=d._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Q=this.age,X=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===X?(X=1,Q=this._randomCellOffset):Q+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let l;l=this._initialSpriteCellLoop?(0,W.Clamp)(Q*X%this.lifeTime/this.lifeTime):(0,W.Clamp)(Q*X/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+l*C|0}_inheritParticleInfoToSubEmitter(Q){if(Q.particleSystem.j.position){const X=Q.particleSystem.j;if(X.position.p(this.position),Q.inheritDirection){const Q=l.e.Yj[0];this.direction.normalizeToRef(Q),X.setDirection(Q,0,Math.PI/2)}}else{Q.particleSystem.j.p(this.position)}this.direction.scaleToRef(Q.inheritedVelocityAmount/2,l.e.Yj[0]),Q.particleSystem._inheritedVelocityOffset.p(l.e.Yj[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Q of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Q)}_reset(){this.age=0,this.id=d._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Q){Q.position.p(this.position),this._initialDirection?Q._initialDirection?Q._initialDirection.p(this._initialDirection):Q._initialDirection=this._initialDirection.clone():Q._initialDirection=null,Q.direction.p(this.direction),this.Xc&&(Q.Xc?Q.Xc.p(this.Xc):Q.Xc=this.Xc.clone()),Q.color.p(this.color),Q.colorStep.p(this.colorStep),Q.lifeTime=this.lifeTime,Q.age=this.age,Q._randomCellOffset=this._randomCellOffset,Q.size=this.size,Q.scale.p(this.scale),Q.angle=this.angle,Q.angularSpeed=this.angularSpeed,Q.particleSystem=this.particleSystem,Q.cellIndex=this.cellIndex,Q.id=this.id,Q._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Q._currentColorGradient=this._currentColorGradient,Q._currentColor1.p(this._currentColor1),Q._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(Q._currentSizeGradient=this._currentSizeGradient,Q._currentSize1=this._currentSize1,Q._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Q._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Q._currentAngularSpeed1=this._currentAngularSpeed1,Q._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Q._currentVelocityGradient=this._currentVelocityGradient,Q._currentVelocity1=this._currentVelocity1,Q._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Q._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Q._currentLimitVelocity1=this._currentLimitVelocity1,Q._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Q._currentDragGradient=this._currentDragGradient,Q._currentDrag1=this._currentDrag1,Q._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Q._initialStartSpriteCellId=this._initialStartSpriteCellId,Q._initialEndSpriteCellId=this._initialEndSpriteCellId,Q._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Q.remapData&&this.remapData?Q.remapData.p(this.remapData):Q.remapData=new l.o(0,0,0,0)),this._randomNoiseCoordinates1&&(Q._randomNoiseCoordinates1?(Q._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),Q._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(Q._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Q._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}d._Count=0;var QQ=C(776),XQ=(C(2475),C(854)),CQ=C(846),lQ=C(2543);function hQ(Q,X){const C=(0,W.RandomRange)(0,1);f.d.LerpToRef(X.color1,X.color2,C,Q.color),X.colorDead.subtractToRef(Q.color,X._colorDiff),X._colorDiff.scaleToRef(1/Q.lifeTime,Q.colorStep)}function MQ(Q,X){Q._currentColorGradient=X._colorGradients[0],Q._currentColorGradient.getColorToRef(Q.color),Q._currentColor1.p(Q.color),X._colorGradients.length>1?X._colorGradients[1].getColorToRef(Q._currentColor2):Q._currentColor2.p(Q.color)}function fQ(Q,X){const C=X._colorGradients;A.GetCurrentGradient(X._ratio,C,((X,C,l)=>{X!==Q._currentColorGradient&&(Q._currentColor1.p(Q._currentColor2),C.getColorToRef(Q._currentColor2),Q._currentColorGradient=X),f.d.LerpToRef(Q._currentColor1,Q._currentColor2,l,Q.color)}))}function OQ(Q,X){Q.colorStep.scaleToRef(X._scaledUpdateSpeed,X._scaledColorStep),Q.color.addInPlace(X._scaledColorStep),Q.color.a<0&&(Q.color.a=0)}function mQ(Q,X){A.GetCurrentGradient(X._ratio,X._angularSpeedGradients,((X,C,l)=>{X!==Q._currentAngularSpeedGradient&&(Q._currentAngularSpeed1=Q._currentAngularSpeed2,Q._currentAngularSpeed2=C.getFactor(),Q._currentAngularSpeedGradient=X),Q.angularSpeed=(0,W.Lerp)(Q._currentAngularSpeed1,Q._currentAngularSpeed2,l)}))}function WQ(Q,X){Q.angle+=Q.angularSpeed*X._scaledUpdateSpeed}function UQ(Q,X){X.particleEmitterType.startDirectionFunction(X._emitterWorldMatrix,Q.direction,Q,X.isLocal,X._emitterInverseWorldMatrix)}function LQ(Q,X){X.startDirectionFunction(X._emitterWorldMatrix,Q.direction,Q,X.isLocal)}function wQ(Q,X){Q._currentVelocityGradient=X._velocityGradients[0],Q._currentVelocity1=Q._currentVelocityGradient.getFactor(),X._velocityGradients.length>1?Q._currentVelocity2=X._velocityGradients[1].getFactor():Q._currentVelocity2=Q._currentVelocity1}function iQ(Q,X){Q._currentLimitVelocityGradient=X._limitVelocityGradients[0],Q._currentLimitVelocity1=Q._currentLimitVelocityGradient.getFactor(),X._limitVelocityGradients.length>1?Q._currentLimitVelocity2=X._limitVelocityGradients[1].getFactor():Q._currentLimitVelocity2=Q._currentLimitVelocity1}function aQ(Q,X){A.GetCurrentGradient(X._ratio,X._velocityGradients,((C,l,h)=>{C!==Q._currentVelocityGradient&&(Q._currentVelocity1=Q._currentVelocity2,Q._currentVelocity2=l.getFactor(),Q._currentVelocityGradient=C),X._directionScale*=(0,W.Lerp)(Q._currentVelocity1,Q._currentVelocity2,h)}))}function FQ(Q,X){A.GetCurrentGradient(X._ratio,X._limitVelocityGradients,((C,l,h)=>{C!==Q._currentLimitVelocityGradient&&(Q._currentLimitVelocity1=Q._currentLimitVelocity2,Q._currentLimitVelocity2=l.getFactor(),Q._currentLimitVelocityGradient=C);const M=(0,W.Lerp)(Q._currentLimitVelocity1,Q._currentLimitVelocity2,h);Q.direction.length()>M&&Q.direction.scaleInPlace(X.limitVelocityDamping)}))}function sQ(Q,X){Q.direction.scaleToRef(X._directionScale,X._scaledDirection)}function zQ(Q,X){X.particleEmitterType.startPositionFunction(X._emitterWorldMatrix,Q.position,Q,X.isLocal)}function xQ(Q,X){X.startPositionFunction(X._emitterWorldMatrix,Q.position,Q,X.isLocal)}function rQ(Q,X){Q.Xc?Q.Xc.p(Q.position):Q.Xc=Q.position.clone(),l.k.TransformCoordinatesToRef(Q.Xc,X._emitterWorldMatrix,Q.position)}function PQ(Q,X){X.isLocal&&Q.Xc?(Q.Xc.addInPlace(X._scaledDirection),l.k.TransformCoordinatesToRef(Q.Xc,X._emitterWorldMatrix,Q.position)):Q.position.addInPlace(X._scaledDirection)}function jQ(Q,X){Q._currentDragGradient=X._dragGradients[0],Q._currentDrag1=Q._currentDragGradient.getFactor(),X._dragGradients.length>1?Q._currentDrag2=X._dragGradients[1].getFactor():Q._currentDrag2=Q._currentDrag1}function vQ(Q,X){A.GetCurrentGradient(X._ratio,X._dragGradients,((C,l,h)=>{C!==Q._currentDragGradient&&(Q._currentDrag1=Q._currentDrag2,Q._currentDrag2=l.getFactor(),Q._currentDragGradient=C);const M=(0,W.Lerp)(Q._currentDrag1,Q._currentDrag2,h);X._scaledDirection.scaleInPlace(1-M)}))}function ZQ(Q,X){Q._randomNoiseCoordinates1?(Q._randomNoiseCoordinates1.Yc(Math.random(),Math.random(),Math.random()),Q._randomNoiseCoordinates2.Yc(Math.random(),Math.random(),Math.random())):(Q._randomNoiseCoordinates1=new l.k(Math.random(),Math.random(),Math.random()),Q._randomNoiseCoordinates2=new l.k(Math.random(),Math.random(),Math.random()))}function gQ(Q,X){const C=X._noiseTextureData,h=X._noiseTextureSize;if(C&&h&&Q._randomNoiseCoordinates1){const M=X._fetchR(Q._randomNoiseCoordinates1.x,Q._randomNoiseCoordinates1.y,h.width,h.height,C),f=X._fetchR(Q._randomNoiseCoordinates1.z,Q._randomNoiseCoordinates2.x,h.width,h.height,C),O=X._fetchR(Q._randomNoiseCoordinates2.y,Q._randomNoiseCoordinates2.z,h.width,h.height,C),m=l.e.Yj[0],W=l.e.Yj[1];m.Yc((2*M-1)*X.noiseStrength.x,(2*f-1)*X.noiseStrength.y,(2*O-1)*X.noiseStrength.z),m.scaleToRef(X._tempScaledUpdateSpeed,W),Q.direction.addInPlace(W)}}function SQ(Q,X){X.gravity.scaleToRef(X._tempScaledUpdateSpeed,X._scaledGravity),Q.direction.addInPlace(X._scaledGravity)}function eQ(Q,X){Q.size=(0,W.RandomRange)(X.minSize,X.maxSize),Q.scale.Yc((0,W.RandomRange)(X.minScaleX,X.maxScaleX),(0,W.RandomRange)(X.minScaleY,X.maxScaleY))}function kQ(Q,X){Q._currentSizeGradient=X._sizeGradients[0],Q._currentSize1=Q._currentSizeGradient.getFactor(),Q.size=Q._currentSize1,X._sizeGradients.length>1?Q._currentSize2=X._sizeGradients[1].getFactor():Q._currentSize2=Q._currentSize1,Q.scale.Yc((0,W.RandomRange)(X.minScaleX,X.maxScaleX),(0,W.RandomRange)(X.minScaleY,X.maxScaleY))}function RQ(Q,X){const C=X._actualFrame/X.targetStopDuration;A.GetCurrentGradient(C,X._startSizeGradients,((C,l,h)=>{C!==X._currentStartSizeGradient&&(X._currentStartSize1=X._currentStartSize2,X._currentStartSize2=l.getFactor(),X._currentStartSizeGradient=C);const M=(0,W.Lerp)(X._currentStartSize1,X._currentStartSize2,h);Q.scale.scaleInPlace(M)}))}function HQ(Q,X){A.GetCurrentGradient(X._ratio,X._sizeGradients,((X,C,l)=>{X!==Q._currentSizeGradient&&(Q._currentSize1=Q._currentSize2,Q._currentSize2=C.getFactor(),Q._currentSizeGradient=X),Q.size=(0,W.Lerp)(Q._currentSize1,Q._currentSize2,l)}))}function oQ(Q,X){Q.remapData=new l.o(0,1,0,1)}function TQ(Q,X){X._colorRemapGradients&&X._colorRemapGradients.length>0&&A.GetCurrentGradient(X._ratio,X._colorRemapGradients,((X,C,l)=>{const h=(0,W.Lerp)(X.factor1,C.factor1,l),M=(0,W.Lerp)(X.factor2,C.factor2,l);Q.remapData.x=h,Q.remapData.y=M-h})),X._alphaRemapGradients&&X._alphaRemapGradients.length>0&&A.GetCurrentGradient(X._ratio,X._alphaRemapGradients,((X,C,l)=>{const h=(0,W.Lerp)(X.factor1,C.factor1,l),M=(0,W.Lerp)(X.factor2,C.factor2,l);Q.remapData.z=h,Q.remapData.w=M-h}))}function YQ(Q,X){const C=(0,W.Clamp)(X._actualFrame/X.targetStopDuration);A.GetCurrentGradient(C,X._lifeTimeGradients,((X,l)=>{const h=X,M=l,f=h.getFactor(),O=M.getFactor(),m=(C-h.gradient)/(M.gradient-h.gradient);Q.lifeTime=(0,W.Lerp)(f,O,m)})),X._emitPower=(0,W.RandomRange)(X.minEmitPower,X.maxEmitPower)}function JQ(Q,X){Q.lifeTime=(0,W.RandomRange)(X.minLifeTime,X.maxLifeTime),X._emitPower=(0,W.RandomRange)(X.minEmitPower,X.maxEmitPower)}function KQ(Q,X){0===X._emitPower?(Q._initialDirection?Q._initialDirection.p(Q.direction):Q._initialDirection=Q.direction.clone(),Q.direction.set(0,0,0)):(Q._initialDirection=null,Q.direction.scaleInPlace(X._emitPower)),Q.direction.addInPlace(X._inheritedVelocityOffset)}function NQ(Q,X){Q.angularSpeed=(0,W.RandomRange)(X.minAngularSpeed,X.maxAngularSpeed),Q.angle=(0,W.RandomRange)(X.minInitialRotation,X.maxInitialRotation)}function qQ(Q,X){Q._currentAngularSpeedGradient=X._angularSpeedGradients[0],Q.angularSpeed=Q._currentAngularSpeedGradient.getFactor(),Q._currentAngularSpeed1=Q.angularSpeed,X._angularSpeedGradients.length>1?Q._currentAngularSpeed2=X._angularSpeedGradients[1].getFactor():Q._currentAngularSpeed2=Q._currentAngularSpeed1,Q.angle=(0,W.RandomRange)(X.minInitialRotation,X.maxInitialRotation)}function nQ(Q,X){Q._initialStartSpriteCellId=X.startSpriteCellID,Q._initialEndSpriteCellId=X.endSpriteCellID,Q._initialSpriteCellLoop=X.spriteCellLoop}function cQ(Q,X){Q.previousItem=X.previousItem,Q.nextItem=X,X.previousItem&&(X.previousItem.nextItem=Q),X.previousItem=Q}function EQ(Q,X){Q.previousItem=X,Q.nextItem=X.nextItem,X.nextItem&&(X.nextItem.previousItem=Q),X.nextItem=Q}function BQ(Q,X){let C=X;for(;C.nextItem;)C=C.nextItem;Q.previousItem=C,Q.nextItem=C.nextItem,C.nextItem=Q}function GQ(Q){Q.previousItem&&(Q.previousItem.nextItem=Q.nextItem),Q.nextItem&&(Q.nextItem.previousItem=Q.previousItem)}class bQ extends m{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Q){this._startDirectionFunction!==Q&&(this._startDirectionFunction=Q,this._directionProcessing.process=Q?LQ:UQ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Q){this._startPositionFunction!==Q&&(this._startPositionFunction=Q,this._positionCreation.process=Q?xQ:zQ)}set onDispose(Q){this._onDisposeObserver&&this.bk.remove(this._onDisposeObserver),this._onDisposeObserver=this.bk.add(Q)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Q){this._useRampGradients!==Q&&(this._useRampGradients=Q,this._resetEffect(),Q?(this._rampCreation={process:oQ,previousItem:null,nextItem:null},EQ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:TQ,previousItem:null,nextItem:null},EQ(this._remapGradientProcessing,this._gravityProcessing)):(GQ(this._rampCreation),GQ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Q){this._isLocal!==Q&&(this._isLocal=Q,Q?(this._isLocalCreation={process:rQ,previousItem:null,nextItem:null},EQ(this._isLocalCreation,this._positionCreation)):GQ(this._isLocalCreation))}get particles(){return this.Il}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Q){this._animationSheetEnabled!==Q&&(this._animationSheetEnabled=Q,Q?(this._sheetCreation={process:nQ,previousItem:null,nextItem:null},EQ(this._sheetCreation,this._colorCreation)):GQ(this._sheetCreation),this._reset())}getActiveCount(){return this.Il.length}getClassName(){return"Ik"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Q;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Q=this._customWrappers[X])||void 0===Q?void 0:Q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Q]??this._customWrappers[0]}setCustomEffect(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new QQ.d(this._engine),this._customWrappers[X].effect=Q,this._customWrappers[X].drawContext&&(this._customWrappers[X].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new D.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Q){if(this.noiseTexture!==Q){if(this._noiseTexture=Q,!Q)return GQ(this._noiseCreation),void GQ(this._noiseProcessing);this._noiseCreation={process:ZQ,previousItem:null,nextItem:null},EQ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:gQ,previousItem:null,nextItem:null},EQ(this._noiseProcessing,this._positionProcessing)}}constructor(Q,X,C){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Q),this._emitterInverseWorldMatrix=l.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new l.k,this.bk=new D.e,this.onStoppedObservable=new D.e,this.onStartedObservable=new D.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Il=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new f.d(0,0,0,0),this._colorDiff=new f.d(0,0,0,0),this._scaledDirection=l.k.Zero(),this._scaledGravity=l.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Q=>{},this.recycleParticle=Q=>{const X=this.Il.pop();X!==Q&&X.copyTo(Q),this._stockParticles.push(X)},this._createParticle=()=>{let Q;return 0!==this._stockParticles.length?(Q=this._stockParticles.pop(),Q._reset()):Q=new d(this),this._prepareParticle(Q),Q},this.paused=!1,this._shadersLoaded=!1,this._capacity=X,this._epsilon=O,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=l.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||V.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.tk.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:JQ,previousItem:null,nextItem:null},this._positionCreation={process:zQ,previousItem:null,nextItem:null},EQ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:UQ,previousItem:null,nextItem:null},EQ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:KQ,previousItem:null,nextItem:null},EQ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:eQ,previousItem:null,nextItem:null},EQ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:NQ,previousItem:null,nextItem:null},EQ(this._angleCreation,this._sizeCreation),this._colorCreation={process:hQ,previousItem:null,nextItem:null},EQ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,m||(this._colorProcessing={process:OQ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:WQ,previousItem:null,nextItem:null},EQ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:sQ,previousItem:null,nextItem:null},EQ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:PQ,previousItem:null,nextItem:null},EQ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:SQ,previousItem:null,nextItem:null},EQ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=M,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new QQ.d(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new L,this.updateFunction=Q=>{var X;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(X=this.noiseTexture.getContent())||void 0===X||X.then((Q=>{this._noiseTextureData=Q})));const C=Q===this.Il;for(let l=0;l<Q.length;l++){const X=Q[l];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const h=X.age;if(X.age+=this._tempScaledUpdateSpeed,X.age>X.lifeTime){const Q=X.age-h,C=X.lifeTime-h;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/Q,X.age=X.lifeTime}this._ratio=X.age/X.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let M=this._updateQueueStart;for(;M;)M.process(X,this),M=M.nextItem;if(this._isAnimationSheetEnabled&&!m&&X.updateCellIndex(),X._inheritParticleInfoToSubEmitters(),X.age>=X.lifeTime){if(this._emitFromParticle(X),X._attachedSubEmitters){for(const Q of X._attachedSubEmitters)Q.particleSystem.disposeOnStop=!0,Q.particleSystem.stop();X._attachedSubEmitters=null}this.recycleParticle(X),C&&l--}else;}}}serialize(Q){throw new Error("Method not implemented.")}clone(Q,X){throw new Error("Method not implemented.")}_addFactorGradient(Q,X,C,l){const h=new y(X,C,l);Q.push(h),Q.sort(((Q,X)=>Q.gradient<X.gradient?-1:Q.gradient>X.gradient?1:0))}_removeFactorGradient(Q,X){if(!Q)return;let C=0;for(const l of Q){if(l.gradient===X){Q.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=YQ:this._lifeTimeCreation.process=JQ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:RQ,previousItem:null,nextItem:null},EQ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(GQ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Q){this.targetStopDuration!==Q&&(this._targetStopDuration=Q,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Q,X,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Q,X,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Q){return this._removeFactorGradient(this._lifeTimeGradients,Q),this._syncLifeTimeCreation(),this}addSizeGradient(Q,X,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=kQ,this._sizeGradientProcessing={process:HQ,previousItem:null,nextItem:null},cQ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Q,X,C),this}removeSizeGradient(Q){var X;return this._removeFactorGradient(this._sizeGradients,Q),0===(null===(X=this._sizeGradients)||void 0===X?void 0:X.length)&&(GQ(this._sizeGradientProcessing),this._sizeCreation.process=eQ),this}addColorRemapGradient(Q,X,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Q,X,C),this}removeColorRemapGradient(Q){return this._removeFactorGradient(this._colorRemapGradients,Q),this}addAlphaRemapGradient(Q,X,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Q,X,C),this}removeAlphaRemapGradient(Q){return this._removeFactorGradient(this._alphaRemapGradients,Q),this}addAngularSpeedGradient(Q,X,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=qQ,this._angularSpeedGradientProcessing={process:mQ,previousItem:null,nextItem:null},cQ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Q,X,C),this}removeAngularSpeedGradient(Q){var X;return this._removeFactorGradient(this._angularSpeedGradients,Q),0===(null===(X=this._angularSpeedGradients)||void 0===X?void 0:X.length)&&(this._angleCreation.process=NQ,GQ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Q,X,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:wQ,previousItem:null,nextItem:null},EQ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:aQ,previousItem:null,nextItem:null},cQ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Q,X,C),this}removeVelocityGradient(Q){var X;return this._removeFactorGradient(this._velocityGradients,Q),0===(null===(X=this._velocityGradients)||void 0===X?void 0:X.length)&&(GQ(this._velocityCreation),GQ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Q,X,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:iQ,previousItem:null,nextItem:null},EQ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:FQ,previousItem:null,nextItem:null},EQ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Q,X,C),this}removeLimitVelocityGradient(Q){var X;return this._removeFactorGradient(this._limitVelocityGradients,Q),0===(null===(X=this._limitVelocityGradients)||void 0===X?void 0:X.length)&&(GQ(this._limitVelocityCreation),GQ(this._limitVelocityGradientProcessing)),this}addDragGradient(Q,X,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:jQ,previousItem:null,nextItem:null},cQ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:vQ,previousItem:null,nextItem:null},cQ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Q,X,C),this}removeDragGradient(Q){var X;return this._removeFactorGradient(this._dragGradients,Q),0===(null===(X=this._dragGradients)||void 0===X?void 0:X.length)&&(GQ(this._dragCreation),GQ(this._dragGradientProcessing)),this}addEmitRateGradient(Q,X,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Q,X,C),this}removeEmitRateGradient(Q){return this._removeFactorGradient(this._emitRateGradients,Q),this}addStartSizeGradient(Q,X,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Q,X,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(Q){return this._removeFactorGradient(this._startSizeGradients,Q),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Q=new Uint8Array(4*this._rawTextureWidth),X=f.h.mk[0];for(let C=0;C<this._rawTextureWidth;C++){const l=C/this._rawTextureWidth;A.GetCurrentGradient(l,this._rampGradients,((l,h,M)=>{f.b.LerpToRef(l.color,h.color,M,X),Q[4*C]=255*X.r,Q[4*C+1]=255*X.g,Q[4*C+2]=255*X.b,Q[4*C+3]=255}))}this._rampGradientsTexture=u.b.CreateRGBATexture(Q,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Q,X)=>Q.gradient<X.gradient?-1:Q.gradient>X.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Q,X){this._rampGradients||(this._rampGradients=[]);const C=new t(Q,X);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(Q){return this._removeGradientAndTexture(Q,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Q,X,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=MQ,this._colorProcessing.process=fQ);const l=new I(Q,X,C);return this._colorGradients.push(l),this._colorGradients.sort(((Q,X)=>Q.gradient<X.gradient?-1:Q.gradient>X.gradient?1:0)),this}removeColorGradient(Q){if(!this._colorGradients)return this;let X=0;for(const C of this._colorGradients){if(C.gradient===Q){this._colorGradients.splice(X,1);break}X++}return 0===this._colorGradients.length&&(this._colorCreation.process=hQ,this._colorProcessing.process=OQ),this}resetDrawCache(){if(this._drawWrappers){for(const Q of this._drawWrappers)if(Q)for(const X of Q)null===X||void 0===X||X.dispose();this._drawWrappers=[]}}_fetchR(Q,X,C,l,h){return h[4*(((Q=.5*Math.abs(Q)+.5)*C%C|0)+((X=.5*Math.abs(X)+.5)*l%l|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Q=this._engine,X=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*X),this._vertexBuffer=new j.e(Q,this._vertexData,!0,X);let C=0;const l=this._vertexBuffer.createVertexBuffer(j.g.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.g.PositionKind]=l,C+=3;const h=this._vertexBuffer.createVertexBuffer(j.g.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.g.ColorKind]=h,C+=4;const M=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=M,C+=1;const f=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=f,C+=2,this._isAnimationSheetEnabled){const Q=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Q,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Q=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Q,C+=3}if(this._useRampGradients){const Q=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Q,C+=4}let O;if(this._useInstancing){const X=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new j.e(Q,X,!1,2),O=this._spriteBuffer.createVertexBuffer("offset",0,2)}else O=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=O,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Q=[],X=[];let C=0;for(let l=0;l<this._capacity;l++)Q.push(C),Q.push(C+1),Q.push(C+2),Q.push(C),Q.push(C+2),Q.push(C+3),X.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(Q),this._linesIndexBuffer=this._engine.createIndexBuffer(X)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Q)setTimeout((()=>{this.start(0)}),Q);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var X;-1!==(null===(X=this.j)||void 0===X?void 0:X.getClassName().indexOf("Mesh"))&&this.j.Vj(!0);const Q=this.noiseTexture;if(Q&&Q.onGeneratedObservable)Q.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let X=0;X<this.preWarmCycles;X++)this.animate(!0),Q.render()}))}));else for(let X=0;X<this.preWarmCycles;X++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Q))}_postStop(Q){}reset(){this._stockParticles.length=0,this.Il.length=0}_appendParticleVertex(Q,X,C,h){let M=Q*this._vertexBufferSize;if(this._vertexData[M++]=X.position.x+this.Qg.x,this._vertexData[M++]=X.position.y+this.Qg.y,this._vertexData[M++]=X.position.z+this.Qg.z,this._vertexData[M++]=X.color.r,this._vertexData[M++]=X.color.g,this._vertexData[M++]=X.color.b,this._vertexData[M++]=X.color.a,this._vertexData[M++]=X.angle,this._vertexData[M++]=X.scale.x*X.size,this._vertexData[M++]=X.scale.y*X.size,this._isAnimationSheetEnabled&&(this._vertexData[M++]=X.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[M++]=X.direction.x,this._vertexData[M++]=X.direction.y,this._vertexData[M++]=X.direction.z);else if(X._initialDirection){let Q=X._initialDirection;this.isLocal&&(l.k.TransformNormalToRef(Q,this._emitterWorldMatrix,l.e.Yj[0]),Q=l.e.Yj[0]),0===Q.x&&0===Q.z&&(Q.x=.001),this._vertexData[M++]=Q.x,this._vertexData[M++]=Q.y,this._vertexData[M++]=Q.z}else{let Q=X.direction;this.isLocal&&(l.k.TransformNormalToRef(Q,this._emitterWorldMatrix,l.e.Yj[0]),Q=l.e.Yj[0]),0===Q.x&&0===Q.z&&(Q.x=.001),this._vertexData[M++]=Q.x,this._vertexData[M++]=Q.y,this._vertexData[M++]=Q.z}this._useRampGradients&&X.remapData&&(this._vertexData[M++]=X.remapData.x,this._vertexData[M++]=X.remapData.y,this._vertexData[M++]=X.remapData.z,this._vertexData[M++]=X.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===h?h=this._epsilon:1===h&&(h=1-this._epsilon)),this._vertexData[M++]=C,this._vertexData[M++]=h)}_prepareParticle(Q){}_createNewOnes(Q){let X;for(let C=0;C<Q&&this.Il.length!==this._capacity;C++){X=this._createParticle(),this.Il.push(X);let Q=this._createQueueStart;for(;Q;)Q.process(X,this),Q=Q.nextItem;X._inheritParticleInfoToSubEmitters()}}_update(Q){if(this._alive=this.Il.length>0,this.j.position){const Q=this.j;this._emitterWorldMatrix=Q.getWorldMatrix()}else{const Q=this.j;this._emitterWorldMatrix=l.b.Translation(Q.x,Q.y,Q.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Il),this._createNewOnes(Q)}static _GetAttributeNamesOrOptions(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=[j.g.PositionKind,j.g.ColorKind,"angle","offset","size"];return Q&&l.push("cellIndex"),X||l.push("direction"),C&&l.push("remapData"),l}static _GetEffectCreationOptions(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,XQ.d)(l),Q&&l.push("particlesInfos"),X&&l.push("logarithmicDepthConstant"),C&&(l.push("vFogInfos"),l.push("vFogColor")),l}fillDefines(Q,X){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,XQ.l)(this,this._scene,Q),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Q.push("#define FOG")),this._isAnimationSheetEnabled&&Q.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Q.push("#define LOGARITHMICDEPTH"),X===m.BLENDMODE_MULTIPLY&&Q.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Q.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Q.push("#define BILLBOARD"),this.billboardMode){case 2:Q.push("#define BILLBOARDY");break;case 8:case 9:Q.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Q.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Q.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Q.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Q,X,C){X.push(...bQ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Q.push(...bQ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,lQ.g)(Q,this._imageProcessingConfigurationDefines),(0,lQ.c)(C,this._imageProcessingConfigurationDefines))}_getWrapper(Q){const X=this._getCustomDrawWrapper(Q);if(null!==X&&void 0!==X&&X.effect)return X;const C=[];this.fillDefines(C,Q);const l=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let h=this._drawWrappers[l];h||(h=this._drawWrappers[l]=[]);let M=h[Q];M||(M=new QQ.d(this._engine),M.drawContext&&(M.drawContext.useInstancing=this._useInstancing),h[Q]=M);const f=C.join("\n");if(M.defines!==f){const Q=[],X=[],C=[];this.fillUniformsAttributesAndSamplerNames(X,Q,C),M.setEffect(this._engine.createEffect("particles",Q,X,C,f,void 0,void 0,void 0,void 0,this._shaderLanguage),f)}return M}animate(){var Q;let X,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(Q=this._scene)||void 0===Q?void 0:Q.getAnimationRatio())||1),this.manualEmitCount>-1)X=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Q=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const X=this._actualFrame/this.targetStopDuration;A.GetCurrentGradient(X,this._emitRateGradients,((X,C,l)=>{X!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=X),Q=(0,W.Lerp)(this._currentEmitRate1,this._currentEmitRate2,l)}))}X=Q*this._scaledUpdateSpeed|0,this._newPartsExcess+=Q*this._scaledUpdateSpeed-X}if(this._newPartsExcess>1&&(X+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?X=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(X),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let Q=0;for(let X=0;X<this.Il.length;X++){const C=this.Il[X];this._appendParticleVertices(Q,C),Q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Il.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Q,X){this._appendParticleVertex(Q++,X,0,0),this._useInstancing||(this._appendParticleVertex(Q++,X,1,0),this._appendParticleVertex(Q++,X,1,1),this._appendParticleVertex(Q++,X,0,1))}rebuild(){var Q;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Q=this._spriteBuffer)||void 0===Q||Q._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!bQ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,12830)),Promise.resolve().then(C.bind(C,12779))])):await Promise.all([Promise.resolve().then(C.bind(C,12771)),Promise.resolve().then(C.bind(C,12764))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==m.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(m.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(m.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Q){const X=this._getWrapper(Q),C=X.effect,h=this._engine;h.enableEffect(X);const M=this.defaultViewMatrix??this._scene.getViewMatrix();if(C.setTexture("diffuseSampler",this.particleTexture),C.setMatrix("view",M),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Q=this.particleTexture.getBaseSize();C.setFloat3("particlesInfos",this.spriteCellWidth/Q.width,this.spriteCellHeight/Q.height,this.spriteCellWidth/Q.width)}if(C.setVector2("translationPivot",this.translationPivot),C.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Q=this._scene.activeCamera;C.setVector3("eyePosition",Q.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),C.setTexture("rampSampler",this._rampGradientsTexture));const f=C.defines;var O,m,W,U,L,w;(this._scene&&((0,XQ.h)(C,this,this._scene),this.applyFog&&(0,CQ.e)(this._scene,void 0,C)),f.indexOf("#define BILLBOARDMODE_ALL")>=0&&(M.invertToRef(l.e.Matrix[0]),C.setMatrix("invView",l.e.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?h.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,C):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,C)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?h.bindBuffers(this._vertexBuffers,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBuffer:this._indexBuffer,C):h.bindBuffers(this._vertexBuffers,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null,C);(this.useLogarithmicDepth&&this._scene&&(0,CQ.i)(f,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(Q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),this._useInstancing)?null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?h.drawElementsType(6,0,10,this.Il.length):h.drawArraysType(7,0,4,this.Il.length):null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?h.drawElementsType(1,0,10*this.Il.length):h.drawElementsType(0,0,6*this.Il.length);return this.Il.length}render(){if(!this.isReady()||!this.Il.length)return 0;const Q=this._engine;Q.setState&&(Q.setState(!1),this.forceDepthWrite&&Q.setDepthWrite(!0));let X=0;return X=this.blendMode===m.BLENDMODE_MULTIPLYADD?this._render(m.BLENDMODE_MULTIPLY)+this._render(m.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),X}_onDispose(){}dispose(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(X,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Q=this._scene.tk.indexOf(this);Q>-1&&this._scene.tk.splice(Q,1),this._scene._activeParticleSystems.dispose()}this.bk.notifyObservers(this),this.bk.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}bQ.ForceGLSL=!1;var pQ,IQ=C(509);!function(Q){Q[Q.ATTACHED=0]="ATTACHED",Q[Q.END=1]="END"}(pQ||(pQ={}));class tQ{constructor(Q){if(this.particleSystem=Q,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Q.j||!Q.j.dispose){const X=(0,O.e)("BABYLON.AbstractMesh");Q.j=new X("SubemitterSystemEmitter",Q.va()),Q._disposeEmitterOnDispose=!0}}clone(){let Q=this.particleSystem.j;if(Q){if(Q instanceof l.k)Q=Q.clone();else if(-1!==Q.getClassName().indexOf("Mesh")){Q=new((0,O.e)("BABYLON.Mesh"))("",Q.va()),Q.isVisible=!1}}else Q=new l.k;const X=new tQ(this.particleSystem.clone(this.particleSystem.name,Q));return X.particleSystem.name+="Clone",X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem._disposeEmitterOnDispose=!0,X.particleSystem.disposeOnStop=!0,X}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem=this.particleSystem.serialize(Q),X}static _ParseParticleSystem(Q,X,C){throw(0,IQ.c)("ParseParticle")}static Parse(Q,X,C){const l=Q.particleSystem,h=new tQ(tQ._ParseParticleSystem(l,X,C,!0));return h.type=Q.type,h.inheritDirection=Q.inheritDirection,h.inheritedVelocityAmount=Q.inheritedVelocityAmount,h.particleSystem._isSubEmitter=!0,h}dispose(){this.particleSystem.dispose()}}var yQ=C(554);function AQ(Q,X){const C=new z;return C.direction1=Q,C.direction2=X,C}function DQ(){return new s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function uQ(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function VQ(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.k(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0);return new r(Q,X,C)}function dQ(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function QX(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0),M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.k(0,1,0);return new F(Q,X,C,h,M)}function XX(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new w(Q,X)}function CX(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0);return new i(Q,X,C,h)}const lX=l.k.Zero(),hX=l.k.Zero(),MX=l.k.Zero();class fX{constructor(){this.strength=0,this.position=l.k.Zero()}_processParticle(Q,X){this.position.subtractToRef(Q.position,lX);const C=lX.lengthSquared()+1;lX.normalize().scaleToRef(this.strength/C,hX),hX.scaleToRef(X._tempScaledUpdateSpeed,MX),Q.direction.addInPlace(MX)}serialize(){return{position:this.position.dk(),strength:this.strength}}}class OX extends bQ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Q=>{if(!this._subEmitters||0===this._subEmitters.length)return;const X=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[X])if(1===C.type){const X=C.clone();Q._inheritParticleInfoToSubEmitter(X),X.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(X.particleSystem),X.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Q,X){const C=AQ(Q,X);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(Q){this._flowMap!==Q&&(this._flowMap=Q,this._flowMapUpdate&&(GQ(this._flowMapUpdate),this._flowMapUpdate=null),Q&&(this._flowMapUpdate={process:Q=>{var X;const C=null===(X=this.va())||void 0===X?void 0:X.getTransformMatrix();this._flowMap._processParticle(Q,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},EQ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Q){this._attractors.push(Q),1===this._attractors.length&&(this._attractorUpdate={process:Q=>{for(const X of this._attractors)X._processParticle(Q,this)},previousItem:null,nextItem:null},EQ(this._attractorUpdate,this._directionProcessing))}removeAttractor(Q){const X=this._attractors.indexOf(Q);-1!==X&&this._attractors.splice(X,1),0===this._attractors.length&&GQ(this._attractorUpdate)}start(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Q)}createHemisphericEmitter(){const Q=DQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Q,Q}createSphereEmitter(){const Q=uQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Q,Q}createDirectedSphereEmitter(){const Q=VQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0));return this.particleEmitterType=Q,Q}createCylinderEmitter(){const Q=dQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Q,Q}createDirectedCylinderEmitter(){const Q=QX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.k(0,1,0));return this.particleEmitterType=Q,Q}createConeEmitter(){const Q=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Q,Q}createDirectedConeEmitter(){const Q=CX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0));return this.particleEmitterType=Q,Q}createBoxEmitter(Q,X,C,l){const h=new L;return this.particleEmitterType=h,this.direction1=Q,this.direction2=X,this.minEmitBox=C,this.maxEmitBox=l,h}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Q of this.subEmitters)Q instanceof OX?this._subEmitters.push([new tQ(Q)]):Q instanceof tQ?this._subEmitters.push([Q]):Q instanceof Array&&this._subEmitters.push(Q)}_stopSubEmitters(){if(this.activeSubSystems){for(const Q of this.activeSubSystems)Q.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Q=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Q&&this._rootParticleSystem.activeSubSystems.splice(Q,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Q){Q&&this._stopSubEmitters()}_prepareParticle(Q){if(this._subEmitters&&this._subEmitters.length>0){const X=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Q._attachedSubEmitters=[];for(const C of X)if(0===C.type){const X=C.clone();Q._attachedSubEmitters.push(X),X.particleSystem.start()}}}_onDispose(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Q&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let Q=C._attachedSubEmitters.length-1;Q>=0;Q-=1)C._attachedSubEmitters[Q].dispose();if(X&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Q=0;Q<this._subEmitters.length;Q++)for(const X of this._subEmitters[Q])X.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(Q,X,C,h){let M;M=C instanceof yQ.e?null:C;const m=(0,O.e)("BABYLON.Texture");if(m&&M&&(Q.texture?X.particleTexture=m.Parse(Q.texture,M,h):Q.textureName&&(X.particleTexture=new m(h+Q.textureName,M,!1,void 0===Q.invertY||Q.invertY),X.particleTexture.name=Q.textureName)),Q.emitterId||0===Q.emitterId||void 0!==Q.j?Q.emitterId&&M?X.j=M.getLastMeshById(Q.emitterId):X.j=l.k.Wj(Q.j):X.j=l.k.Zero(),X.isLocal=!!Q.isLocal,void 0!==Q.renderingGroupId&&(X.renderingGroupId=Q.renderingGroupId),void 0!==Q.isBillboardBased&&(X.isBillboardBased=Q.isBillboardBased),void 0!==Q.billboardMode&&(X.billboardMode=Q.billboardMode),void 0!==Q.useLogarithmicDepth&&(X.useLogarithmicDepth=Q.useLogarithmicDepth),Q.animations){for(let C=0;C<Q.animations.length;C++){const l=Q.animations[C],h=(0,O.e)("BABYLON.Animation");h&&X.animations.push(h.Parse(l))}X.beginAnimationOnStart=Q.beginAnimationOnStart,X.beginAnimationFrom=Q.beginAnimationFrom,X.beginAnimationTo=Q.beginAnimationTo,X.beginAnimationLoop=Q.beginAnimationLoop}if(Q.autoAnimate&&M&&M.beginAnimation(X,Q.autoAnimateFrom,Q.autoAnimateTo,Q.autoAnimateLoop,Q.autoAnimateSpeed||1),X.startDelay=0|Q.startDelay,X.minAngularSpeed=Q.minAngularSpeed,X.maxAngularSpeed=Q.maxAngularSpeed,X.minSize=Q.minSize,X.maxSize=Q.maxSize,Q.minScaleX&&(X.minScaleX=Q.minScaleX,X.maxScaleX=Q.maxScaleX,X.minScaleY=Q.minScaleY,X.maxScaleY=Q.maxScaleY),void 0!==Q.preWarmCycles&&(X.preWarmCycles=Q.preWarmCycles,X.preWarmStepOffset=Q.preWarmStepOffset),void 0!==Q.minInitialRotation&&(X.minInitialRotation=Q.minInitialRotation,X.maxInitialRotation=Q.maxInitialRotation),X.minLifeTime=Q.minLifeTime,X.maxLifeTime=Q.maxLifeTime,X.minEmitPower=Q.minEmitPower,X.maxEmitPower=Q.maxEmitPower,X.emitRate=Q.emitRate,X.gravity=l.k.Wj(Q.gravity),Q.noiseStrength&&(X.noiseStrength=l.k.Wj(Q.noiseStrength)),X.color1=f.d.Wj(Q.color1),X.color2=f.d.Wj(Q.color2),X.colorDead=f.d.Wj(Q.colorDead),X.updateSpeed=Q.updateSpeed,X.targetStopDuration=Q.targetStopDuration,X.blendMode=Q.blendMode,Q.colorGradients)for(const l of Q.colorGradients)X.addColorGradient(l.gradient,f.d.Wj(l.color1),l.color2?f.d.Wj(l.color2):void 0);if(Q.rampGradients){for(const C of Q.rampGradients)X.addRampGradient(C.gradient,f.b.Wj(C.color));X.useRampGradients=Q.useRampGradients}if(Q.colorRemapGradients)for(const l of Q.colorRemapGradients)X.addColorRemapGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.alphaRemapGradients)for(const l of Q.alphaRemapGradients)X.addAlphaRemapGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.sizeGradients)for(const l of Q.sizeGradients)X.addSizeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.angularSpeedGradients)for(const l of Q.angularSpeedGradients)X.addAngularSpeedGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.velocityGradients)for(const l of Q.velocityGradients)X.addVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.dragGradients)for(const l of Q.dragGradients)X.addDragGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.emitRateGradients)for(const l of Q.emitRateGradients)X.addEmitRateGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.startSizeGradients)for(const l of Q.startSizeGradients)X.addStartSizeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.lifeTimeGradients)for(const l of Q.lifeTimeGradients)X.addLifeTimeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(Q.limitVelocityGradients){for(const C of Q.limitVelocityGradients)X.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);X.limitVelocityDamping=Q.limitVelocityDamping}if(Q.noiseTexture&&M){const C=(0,O.e)("BABYLON.ProceduralTexture");X.noiseTexture=C.Parse(Q.noiseTexture,M,h)}let W;if(Q.particleEmitterType){switch(Q.particleEmitterType.type){case"SphereParticleEmitter":W=new x;break;case"SphereDirectedParticleEmitter":W=new r;break;case"ConeEmitter":case"ConeParticleEmitter":W=new w;break;case"ConeDirectedParticleEmitter":W=new i;break;case"CylinderParticleEmitter":W=new a;break;case"CylinderDirectedParticleEmitter":W=new F;break;case"HemisphericParticleEmitter":W=new s;break;case"PointParticleEmitter":W=new z;break;case"MeshParticleEmitter":W=new v;break;case"CustomParticleEmitter":W=new P;break;default:W=new L}W.parse(Q.particleEmitterType,M)}else W=new L,W.parse(Q,M);X.particleEmitterType=W,X.startSpriteCellID=Q.startSpriteCellID,X.endSpriteCellID=Q.endSpriteCellID,X.spriteCellLoop=Q.spriteCellLoop??!0,X.spriteCellWidth=Q.spriteCellWidth,X.spriteCellHeight=Q.spriteCellHeight,X.spriteCellChangeSpeed=Q.spriteCellChangeSpeed,X.spriteRandomStartCell=Q.spriteRandomStartCell,X.disposeOnStop=Q.disposeOnStop??!1,X.manualEmitCount=Q.manualEmitCount??-1}static Parse(Q,X,C){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4?arguments[4]:void 0;const O=Q.name;let m,W,U=null,L=null;if(X instanceof yQ.e?m=X:(W=X,m=W.getEngine()),Q.customShader&&m.createEffectForParticles){L=Q.customShader;const X=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";U=m.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,X)}const w=new OX(O,M||Q.xb,X,U,Q.isAnimationSheetEnabled);if(w.customShader=L,w._rootUrl=C,Q.id&&(w.id=Q.id),Q.subEmitters){w.subEmitters=[];for(const l of Q.subEmitters){const Q=[];for(const h of l)Q.push(tQ.Parse(h,X,C));w.subEmitters.push(Q)}}if(Q.attractors)for(const f of Q.attractors){const Q=new fX;Q.position=l.k.Wj(f.position),Q.strength=f.strength,w.addAttractor(Q)}return OX._Parse(Q,w,X,C),Q.textureMask&&(w.textureMask=f.d.Wj(Q.textureMask)),Q.Qg&&(w.Qg=l.k.Wj(Q.Qg)),Q.preventAutoStart&&(w.preventAutoStart=Q.preventAutoStart),h||w.preventAutoStart||w.start(),w}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};if(OX._Serialize(X,this,Q),X.textureMask=this.textureMask.dk(),X.customShader=this.customShader,X.preventAutoStart=this.preventAutoStart,X.Qg=this.Qg.dk(),this.subEmitters){X.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const l=[];for(const X of C)l.push(X.serialize(Q));X.subEmitters.push(l)}}if(this._attractors&&this._attractors.length){X.attractors=[];for(const Q of this._attractors)X.attractors.push(Q.serialize())}return X}static _Serialize(Q,X,C){if(Q.name=X.name,Q.id=X.id,Q.xb=X.getCapacity(),Q.disposeOnStop=X.disposeOnStop,Q.manualEmitCount=X.manualEmitCount,X.j.position){const C=X.j;Q.emitterId=C.id}else{const C=X.j;Q.j=C.dk()}X.particleEmitterType&&(Q.particleEmitterType=X.particleEmitterType.serialize()),X.particleTexture&&(C?Q.texture=X.particleTexture.serialize():(Q.textureName=X.particleTexture.name,Q.invertY=!!X.particleTexture._invertY)),Q.isLocal=X.isLocal,Y.d.AppendSerializedAnimations(X,Q),Q.beginAnimationOnStart=X.beginAnimationOnStart,Q.beginAnimationFrom=X.beginAnimationFrom,Q.beginAnimationTo=X.beginAnimationTo,Q.beginAnimationLoop=X.beginAnimationLoop,Q.startDelay=X.startDelay,Q.renderingGroupId=X.renderingGroupId,Q.isBillboardBased=X.isBillboardBased,Q.billboardMode=X.billboardMode,Q.minAngularSpeed=X.minAngularSpeed,Q.maxAngularSpeed=X.maxAngularSpeed,Q.minSize=X.minSize,Q.maxSize=X.maxSize,Q.minScaleX=X.minScaleX,Q.maxScaleX=X.maxScaleX,Q.minScaleY=X.minScaleY,Q.maxScaleY=X.maxScaleY,Q.minEmitPower=X.minEmitPower,Q.maxEmitPower=X.maxEmitPower,Q.minLifeTime=X.minLifeTime,Q.maxLifeTime=X.maxLifeTime,Q.emitRate=X.emitRate,Q.gravity=X.gravity.dk(),Q.noiseStrength=X.noiseStrength.dk(),Q.color1=X.color1.dk(),Q.color2=X.color2.dk(),Q.colorDead=X.colorDead.dk(),Q.updateSpeed=X.updateSpeed,Q.targetStopDuration=X.targetStopDuration,Q.blendMode=X.blendMode,Q.preWarmCycles=X.preWarmCycles,Q.preWarmStepOffset=X.preWarmStepOffset,Q.minInitialRotation=X.minInitialRotation,Q.maxInitialRotation=X.maxInitialRotation,Q.startSpriteCellID=X.startSpriteCellID,Q.spriteCellLoop=X.spriteCellLoop,Q.endSpriteCellID=X.endSpriteCellID,Q.spriteCellChangeSpeed=X.spriteCellChangeSpeed,Q.spriteCellWidth=X.spriteCellWidth,Q.spriteCellHeight=X.spriteCellHeight,Q.spriteRandomStartCell=X.spriteRandomStartCell,Q.isAnimationSheetEnabled=X.isAnimationSheetEnabled,Q.useLogarithmicDepth=X.useLogarithmicDepth;const l=X.getColorGradients();if(l){Q.colorGradients=[];for(const X of l){const C={gradient:X.gradient,color1:X.color1.dk()};X.color2?C.color2=X.color2.dk():C.color2=X.color1.dk(),Q.colorGradients.push(C)}}const h=X.getRampGradients();if(h){Q.rampGradients=[];for(const X of h){const C={gradient:X.gradient,color:X.color.dk()};Q.rampGradients.push(C)}Q.useRampGradients=X.useRampGradients}const M=X.getColorRemapGradients();if(M){Q.colorRemapGradients=[];for(const X of M){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.colorRemapGradients.push(C)}}const f=X.getAlphaRemapGradients();if(f){Q.alphaRemapGradients=[];for(const X of f){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.alphaRemapGradients.push(C)}}const O=X.getSizeGradients();if(O){Q.sizeGradients=[];for(const X of O){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.sizeGradients.push(C)}}const m=X.getAngularSpeedGradients();if(m){Q.angularSpeedGradients=[];for(const X of m){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.angularSpeedGradients.push(C)}}const W=X.getVelocityGradients();if(W){Q.velocityGradients=[];for(const X of W){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.velocityGradients.push(C)}}const U=X.getDragGradients();if(U){Q.dragGradients=[];for(const X of U){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.dragGradients.push(C)}}const L=X.getEmitRateGradients();if(L){Q.emitRateGradients=[];for(const X of L){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.emitRateGradients.push(C)}}const w=X.getStartSizeGradients();if(w){Q.startSizeGradients=[];for(const X of w){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.startSizeGradients.push(C)}}const i=X.getLifeTimeGradients();if(i){Q.lifeTimeGradients=[];for(const X of i){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.lifeTimeGradients.push(C)}}const a=X.getLimitVelocityGradients();if(a){Q.limitVelocityGradients=[];for(const X of a){const C={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?C.factor2=X.factor2:C.factor2=X.factor1,Q.limitVelocityGradients.push(C)}Q.limitVelocityDamping=X.limitVelocityDamping}X.noiseTexture&&(Q.noiseTexture=X.noiseTexture.serialize())}clone(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l={...this._customWrappers};let h=null;const M=this._engine;if(M.createEffectForParticles&&null!=this.customShader){h=this.customShader;const Q=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",X=M.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,Q);l[0]?l[0].effect=X:this.setCustomEffect(X,0)}const f=this.serialize(C),O=OX.Parse(f,this._scene||this._engine,this._rootUrl);return O.name=Q,O.customShader=h,O._customWrappers=l,void 0===X&&(X=this.j),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.j=X,this.preventAutoStart||O.start(),O}}OX.BILLBOARDMODE_Y=2,OX.BILLBOARDMODE_ALL=7,OX.BILLBOARDMODE_STRETCHED=8,OX.BILLBOARDMODE_STRETCHED_LOCAL=9,tQ._ParseParticleSystem=OX.Parse;var mX=C(2531),WX=C(2522),UX=C(2443);UX.e.prototype.createTransformFeedback=function(){const Q=this._gl.createTransformFeedback();if(!Q)throw new Error("Unable to create Transform Feedback");return Q},UX.e.prototype.deleteTransformFeedback=function(Q){this._gl.deleteTransformFeedback(Q)},UX.e.prototype.bindTransformFeedback=function(Q){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Q)},UX.e.prototype.beginTransformFeedback=function(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Q?this._gl.POINTS:this._gl.TRIANGLES)},UX.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},UX.e.prototype.setTranformFeedbackVaryings=function(Q,X){this._gl.transformFeedbackVaryings(Q,X,this._gl.INTERLEAVED_ATTRIBS)},UX.e.prototype.bindTransformFeedbackBuffer=function(Q){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Q?Q.underlyingResource:null)},UX.e.prototype.readTransformFeedbackBuffer=function(Q){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Q)};const LX="clipPlaneFragmentDeclaration2",wX="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";g.b.IncludesShadersStore[LX]||(g.b.IncludesShadersStore[LX]=wX);C(12685),C(12692),C(12698),C(12705),C(12712),C(12719),C(12722),C(12727);const iX="gpuRenderParticlesPixelShader",aX="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";g.b.ShadersStore[iX]||(g.b.ShadersStore[iX]=aX);const FX="clipPlaneVertexDeclaration2",sX="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";g.b.IncludesShadersStore[FX]||(g.b.IncludesShadersStore[FX]=sX);C(12730),C(12732),C(12737),C(12744);const zX="gpuRenderParticlesVertexShader",xX="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";g.b.ShadersStore[zX]||(g.b.ShadersStore[zX]=xX);class rX extends m{static get IsSupported(){if(!V.b.LastCreatedEngine)return!1;const Q=V.b.LastCreatedEngine.getCaps();return Q.supportTransformFeedbacks||Q.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Q){this._maxActiveParticleCount=Math.min(Q,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Q){this.maxActiveParticleCount=Q}createPointEmitter(Q,X){const C=AQ(Q,X);return this.particleEmitterType=C,C}createHemisphericEmitter(){const Q=DQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Q,Q}createSphereEmitter(){const Q=uQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Q,Q}createDirectedSphereEmitter(){const Q=VQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0));return this.particleEmitterType=Q,Q}createCylinderEmitter(){const Q=dQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Q,Q}createDirectedCylinderEmitter(){const Q=QX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.k(0,1,0));return this.particleEmitterType=Q,Q}createConeEmitter(){const Q=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Q,Q}createDirectedConeEmitter(){const Q=CX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.k(0,1,0));return this.particleEmitterType=Q,Q}createBoxEmitter(Q,X,C,l){const h=new L;return this.particleEmitterType=h,this.direction1=Q,this.direction2=X,this.minEmitBox=C,this.maxEmitBox=l,h}get flowMap(){return this._flowMap}set flowMap(Q){this._flowMap!==Q&&(this._flowMap=Q)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==OX.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(OX.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(OX.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Q?setTimeout((()=>{this.start(0)}),Q):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Q;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Q=this._customWrappers[X])||void 0===Q?void 0:Q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Q]??this._customWrappers[0]}setCustomEffect(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new QQ.d(this._engine),this._customWrappers[X].effect=Q}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new D.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Q,X,C){return super._removeGradientAndTexture(Q,X,C),this._releaseBuffers(),this}addColorGradient(Q,X){this._colorGradients||(this._colorGradients=[]);const C=new I(Q,X);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Q&&this._colorGradients.sort(((Q,X)=>Q.gradient<X.gradient?-1:Q.gradient>X.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Q){return this._removeGradientAndTexture(Q,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const X in this._drawWrappers){var Q;null===(Q=this._drawWrappers[X].drawContext)||void 0===Q||Q.reset()}}_addFactorGradient(Q,X,C){const l=new y(X,C);Q.push(l),this._releaseBuffers()}addSizeGradient(Q,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Q,X),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Q){return this._removeGradientAndTexture(Q,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Q,X){if(!Q)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Q.sort(((Q,X)=>Q.gradient<X.gradient?-1:Q.gradient>X.gradient?1:0));const C=this;C[X]&&(C[X].dispose(),C[X]=null)}addAngularSpeedGradient(Q,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Q,X),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Q){return this._removeGradientAndTexture(Q,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Q,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Q,X),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Q){return this._removeGradientAndTexture(Q,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Q,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Q,X),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Q){return this._removeGradientAndTexture(Q,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Q,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Q,X),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Q){return this._removeGradientAndTexture(Q,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Q){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Q,X,C){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Q),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.bk=new D.e,this.onStoppedObservable=new D.e,this.onStartedObservable=new D.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=l.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||V.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.tk.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,O.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,O.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new QQ.d(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers={0:new QQ.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(X=X??{}).randomTextureSize||delete X.randomTextureSize;const f={xb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...X},m=X;isFinite(m)&&(f.xb=m),this._capacity=f.xb,this._maxActiveParticleCount=f.xb,this._currentActiveCount=0,this._isAnimationSheetEnabled=M,this.particleEmitterType=new L;const W=Math.min(this._engine.getCaps().maxTextureSize,f.randomTextureSize);let U=[];for(let l=0;l<W;++l)U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random());this._randomTexture=new u.b(new Float32Array(U),W,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,U=[];for(let l=0;l<W;++l)U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random());this._randomTexture2=new u.b(new Float32Array(U),W,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=W}_reset(){this._releaseBuffers()}_createVertexBuffers(Q,X,C){const l={};l.position=X.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let h=3;l.age=X.createVertexBuffer("age",h,1,this._attributesStrideSize,!0),h+=1,l.size=X.createVertexBuffer("size",h,3,this._attributesStrideSize,!0),h+=3,l.life=X.createVertexBuffer("life",h,1,this._attributesStrideSize,!0),h+=1,h+=4,this.billboardMode===OX.BILLBOARDMODE_STRETCHED&&(l.direction=X.createVertexBuffer("direction",h,3,this._attributesStrideSize,!0)),h+=3,this._platform.alignDataInBuffer&&(h+=1),this.particleEmitterType instanceof P&&(h+=3,this._platform.alignDataInBuffer&&(h+=1)),this._colorGradientsTexture||(l.color=X.createVertexBuffer("color",h,4,this._attributesStrideSize,!0),h+=4),this._isBillboardBased||(l.initialDirection=X.createVertexBuffer("initialDirection",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),this.noiseTexture&&(l.noiseCoordinates1=X.createVertexBuffer("noiseCoordinates1",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1),l.noiseCoordinates2=X.createVertexBuffer("noiseCoordinates2",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),l.angle=X.createVertexBuffer("angle",h,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?h++:h+=2,this._isAnimationSheetEnabled&&(l.cellIndex=X.createVertexBuffer("cellIndex",h,1,this._attributesStrideSize,!0),h+=1,this.spriteRandomStartCell&&(l.cellStartOffset=X.createVertexBuffer("cellStartOffset",h,1,this._attributesStrideSize,!0),h+=1)),l.offset=C.createVertexBuffer("offset",0,2),l.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(l),this._platform.createVertexBuffers(Q,l),this.resetDrawCache()}_initialize(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Q)return;const X=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof P&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const h=this.particleEmitterType instanceof P,M=l.e.Yj[0];let f=0;for(let l=0;l<this._capacity;l++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),h?(this.particleEmitterType.particleDestinationGenerator(l,null,M),C.push(M.x),C.push(M.y),C.push(M.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),f+=16,h&&(this.particleEmitterType.particlePositionGenerator(l,null,M),C.push(M.x),C.push(M.y),C.push(M.z),this._platform.alignDataInBuffer&&C.push(0),f+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),f+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),f+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),f+=8),C.push(0),f+=1,this._angularSpeedGradientsTexture||(C.push(0),f+=1),this._isAnimationSheetEnabled&&(C.push(0),f+=1,this.spriteRandomStartCell&&(C.push(0),f+=1)),this._platform.alignDataInBuffer){let Q=3-(f+3&3);for(f+=Q;Q-- >0;)C.push(0)}const O=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),m=this._platform.createParticleBuffer(C),W=this._platform.createParticleBuffer(C);this._buffer0=new j.e(X,m,!1,this._attributesStrideSize),this._buffer1=new j.e(X,W,!1,this._attributesStrideSize),this._spriteBuffer=new j.e(X,O,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Q=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Q+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Q+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Q+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Q+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Q+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Q+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Q+="\n#define DRAGGRADIENTS"),this._flowMap&&(Q+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Q+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Q+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Q+="\n#define NOISE"),this.isLocal&&(Q+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Q||(this._cachedUpdateDefines=Q,this._updateBuffer=this._platform.createUpdateBuffer(Q)),this._platform.isUpdateBufferReady()}_getWrapper(Q){const X=this._getCustomDrawWrapper(Q);if(null!==X&&void 0!==X&&X.effect)return X;const C=[];this.fillDefines(C,Q);let l=this._drawWrappers[Q];l||(l=new QQ.d(this._engine),l.drawContext&&(l.drawContext.useInstancing=!0),this._drawWrappers[Q]=l);const h=C.join("\n");if(l.defines!==h){const Q=[],X=[],C=[];this.fillUniformsAttributesAndSamplerNames(X,Q,C),l.setEffect(this._engine.createEffect("gpuRenderParticles",Q,X,C,h),h)}return l}static _GetAttributeNamesOrOptions(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=[j.g.PositionKind,"age","life","size","angle"];return Q||h.push(j.g.ColorKind),X&&h.push("cellIndex"),C||h.push("initialDirection"),l&&h.push("direction"),h.push("offset",j.g.UVKind),h}static _GetEffectCreationOptions(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=["emitterWM","Qg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,XQ.d)(l),Q&&l.push("sheetInfos"),X&&l.push("logarithmicDepthConstant"),C&&(l.push("vFogInfos"),l.push("vFogColor")),l}fillDefines(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,XQ.l)(this,this._scene,Q),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==WX.e.FOGMODE_NONE&&Q.push("#define FOG")),X===OX.BLENDMODE_MULTIPLY&&Q.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Q.push("#define LOCAL"),this.useLogarithmicDepth&&Q.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Q.push("#define BILLBOARD"),this.billboardMode){case OX.BILLBOARDMODE_Y:Q.push("#define BILLBOARDY");break;case OX.BILLBOARDMODE_STRETCHED:Q.push("#define BILLBOARDSTRETCHED");break;case OX.BILLBOARDMODE_ALL:Q.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Q.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Q.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Q.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Q,X,C){X.push(...rX._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===OX.BILLBOARDMODE_STRETCHED)),Q.push(...rX._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(mX.d.PrepareUniforms(Q,this._imageProcessingConfigurationDefines),mX.d.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var Q;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(X?this.preWarmStepOffset:(null===(Q=this._scene)||void 0===Q?void 0:Q.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Q,X){const C=this[X];if(!Q||!Q.length||C)return;const l=new Float32Array(this._rawTextureWidth);for(let h=0;h<this._rawTextureWidth;h++){const X=h/this._rawTextureWidth;A.GetCurrentGradient(X,Q,((Q,X,C)=>{l[h]=(0,W.Lerp)(Q.factor1,X.factor1,C)}))}this[X]=u.b.CreateRTexture(l,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[X].name=X.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Q=new Uint8Array(4*this._rawTextureWidth),X=f.h.nk[0];for(let C=0;C<this._rawTextureWidth;C++){const l=C/this._rawTextureWidth;A.GetCurrentGradient(l,this._colorGradients,((l,h,M)=>{f.d.LerpToRef(l.color1,h.color1,M,X),Q[4*C]=255*X.r,Q[4*C+1]=255*X.g,Q[4*C+2]=255*X.b,Q[4*C+3]=255*X.a}))}this._colorGradientsTexture=u.b.CreateRGBATexture(Q,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Q,X){var C,h,M,f;const O=this._getWrapper(Q),m=O.effect;this._engine.enableEffect(O);const W=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||l.b.IdentityReadOnly;if(m.setMatrix("view",W),m.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),m.setTexture("diffuseSampler",this.particleTexture),m.setVector2("translationPivot",this.translationPivot),m.setVector3("Qg",this.Qg),this.isLocal&&m.setMatrix("emitterWM",X),this._colorGradientsTexture?m.setTexture("colorGradientSampler",this._colorGradientsTexture):m.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Q=this.particleTexture.getBaseSize();m.setFloat3("sheetInfos",this.spriteCellWidth/Q.width,this.spriteCellHeight/Q.height,Q.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Q=this._scene.activeCamera;m.setVector3("eyePosition",Q.globalPosition)}const U=m.defines;if(this._scene&&((0,XQ.h)(m,this,this._scene),this.applyFog&&(0,CQ.e)(this._scene,void 0,m)),U.indexOf("#define BILLBOARDMODE_ALL")>=0){const Q=W.clone();Q.invert(),m.setMatrix("invView",Q)}return this.useLogarithmicDepth&&this._scene&&(0,CQ.i)(U,m,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(m),this._setEngineBasedOnBlendMode(Q),this._platform.bindDrawBuffers(this._targetIndex,m,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(m),null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(f=this._scene)&&void 0!==f&&f.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Q){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Q)if(this.j.position){Q=this.j.getWorldMatrix()}else{const X=this.j;Q=l.e.Matrix[0],l.b.TranslationToRef(X.x,X.y,X.z,Q)}const X=this._engine,C=X.getDepthWrite();if(X.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Q=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Q.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const h=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=h,X.setDepthWrite(C)}render(){let Q,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!X&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Q=0;Q<this.preWarmCycles;Q++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Q=0|this._accumulatedCount;this._accumulatedCount-=Q,this._currentActiveCount+=Q}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){Q=this.j.getWorldMatrix()}else{const X=this.j;Q=l.e.Matrix[0],l.b.TranslationToRef(X.x,X.y,X.z,Q)}const h=this._engine;this.updateInAnimate||this._update(Q);let M=0;return X||C||(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0),M=this.blendMode===OX.BLENDMODE_MULTIPLYADD?this._render(OX.BLENDMODE_MULTIPLY,Q)+this._render(OX.BLENDMODE_ADD,Q):this._render(this.blendMode,Q),this._engine.setAlphaMode(0)),M}rebuild(){const Q=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Q,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Q()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const X in this._drawWrappers){this._drawWrappers[X].dispose()}if(this._drawWrappers={},this._scene){const Q=this._scene.tk.indexOf(this);Q>-1&&this._scene.tk.splice(Q,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let X=0;X<this._renderVertexBuffers.length;++X){const Q=this._renderVertexBuffers[X];for(const X in Q)Q[X].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.bk.notifyObservers(this),this.bk.clear()}clone(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l={...this._customWrappers};let h=null;const M=this._engine;if(M.createEffectForParticles&&null!=this.customShader){h=this.customShader;const Q=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";l[0]=M.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,Q,void 0,void 0,void 0,this)}const f=this.serialize(C),O=rX.Parse(f,this._scene||this._engine,this._rootUrl);return O.name=Q,O.customShader=h,O._customWrappers=l,void 0===X&&(X=this.j),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.j=X,O}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return OX._Serialize(X,this,Q),X.activeParticleCount=this.activeParticleCount,X.randomTextureSize=this._randomTextureSize,X.customShader=this.customShader,X}static Parse(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const M=Q.name;let f,O;X instanceof yQ.e?f=X:(O=X,f=O.getEngine());const m=new rX(M,{xb:h||Q.xb,randomTextureSize:Q.randomTextureSize},X,null,Q.isAnimationSheetEnabled);if(m._rootUrl=C,Q.customShader&&f.createEffectForParticles){const X=Q.customShader,C=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",l=f.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,C,void 0,void 0,void 0,m);m.setCustomEffect(l,0),m.customShader=X}return Q.id&&(m.id=Q.id),Q.activeParticleCount&&(m.activeParticleCount=Q.activeParticleCount),OX._Parse(Q,m,X,C),Q.preventAutoStart&&(m.preventAutoStart=Q.preventAutoStart),l||m.preventAutoStart||m.start(),m}}var PX=C(487),jX=C(12746),vX=C(12222);class ZX{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Q){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const X of this.systems)X.j=Q;this._emitterNode=Q}setEmitterAsSphere(Q,X,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Q,renderingGroupId:X};const l=(0,jX.e)("emitterSphere",{diameter:Q.diameter,segments:Q.segments},C);l.renderingGroupId=X;const h=new vX.b("emitterSphereMaterial",C);h.emissiveColor=Q.color,l.material=h;for(const M of this.systems)M.j=l;this._emitterNode=l}start(Q){for(const X of this.systems)Q&&(X.j=Q),X.start()}dispose(){for(const Q of this.systems)Q.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={systems:[]};for(const C of this.systems)X.systems.push(C.serialize(Q));return this._emitterNode&&(X.j=this._emitterCreationOptions),X}static Parse(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;const h=new ZX,M=this.BaseAssetsUrl+"/textures/";X=X||V.b.LastCreatedScene;for(const f of Q.systems)h.systems.push(C?rX.Parse(f,X,M,!0,l):OX.Parse(f,X,M,!0,l));if(Q.j){const C=Q.j.options;if("Sphere"===Q.j.kind)h.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:f.b.Wj(C.color)},Q.j.renderingGroupId,X)}return h}}ZX.BaseAssetsUrl="https://assets.babylonjs.com/particles";var gX=C(517);class SX{static CreateDefault(Q){let X,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,l=arguments.length>2?arguments[2]:void 0;X=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new rX("default system",{xb:C},l):new OX("default system",C,l),X.j=Q;const h=PX.i.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return X.particleTexture=new J.e(h,X.va()),X.createConeEmitter(.1,Math.PI/4),X.color1=new f.d(1,1,1,1),X.color2=new f.d(1,1,1,1),X.colorDead=new f.d(1,1,1,0),X.minSize=.1,X.maxSize=.1,X.minEmitPower=2,X.maxEmitPower=2,X.updateSpeed=1/60,X.emitRate=30,X}static CreateAsync(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;X||(X=V.b.LastCreatedScene);const h={};return X.addPendingData(h),new Promise(((M,f)=>{if(C&&!rX.IsSupported)return X.removePendingData(h),f("Particle system with GPU is not supported.");PX.i.LoadFile(`${SX.BaseAssetsUrl}/systems/${Q}.json`,(Q=>{X.removePendingData(h);const f=JSON.parse(Q.toString());return M(ZX.Parse(f,X,C,l))}),void 0,void 0,void 0,(()=>(X.removePendingData(h),f(`An error occurred with the creation of your particle system. Check if your type '${Q}' exists.`))))}))}static ExportSet(Q){const X=new ZX;for(const C of Q)X.systems.push(C);return X}static ParseFromFileAsync(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",M=arguments.length>5?arguments[5]:void 0;return new Promise(((f,O)=>{const m=new gX.e;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const X=JSON.parse(m.responseText);let O;O=l?rX.Parse(X,C,h,!1,M):OX.Parse(X,C,h,!1,M),Q&&(O.name=Q),f(O)}else O("Unable to load the particle system")})),m.open("GET",X),m.send()}))}static ParseFromSnippetAsync(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Q){const Q=this.CreateDefault(null);return Q.start(),Promise.resolve(Q)}return new Promise(((M,f)=>{const O=new gX.e;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const f=JSON.parse(JSON.parse(O.responseText).jsonPayload),m=JSON.parse(f.particleSystem);let W;W=C?rX.Parse(m,X,l,!1,h):OX.Parse(m,X,l,!1,h),W.snippetId=Q,M(W)}else f("Unable to load the snippet "+Q)})),O.open("GET",this.SnippetUrl+"/"+Q.replace(/#/g,"/")),O.send()}))}}SX.BaseAssetsUrl=ZX.BaseAssetsUrl,SX.SnippetUrl="https://snippet.babylonjs.com",SX.CreateFromSnippetAsync=SX.ParseFromSnippetAsync;var eX=C(477),kX=C(863),RX=C(12749);(0,RX.f)(kX.b.NAME_PARTICLESYSTEM,((Q,X,C,l)=>{const h=(0,RX.j)(kX.b.NAME_PARTICLESYSTEM);if(h&&void 0!==Q.tk&&null!==Q.tk)for(let M=0,f=Q.tk.length;M<f;M++){const f=Q.tk[M];C.tk.push(h(f,X,l))}})),(0,RX.c)(kX.b.NAME_PARTICLESYSTEM,((Q,X,C)=>{if(Q.activeParticleCount){return rX.Parse(Q,X,C)}return OX.Parse(Q,X,C)})),yQ.e.prototype.createEffectForParticles=function(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",M=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,U=arguments.length>9?arguments[9]:void 0,L=[],w=[];const i=[];return m?m.fillUniformsAttributesAndSamplerNames(w,L,i):(L=OX._GetAttributeNamesOrOptions(),w=OX._GetEffectCreationOptions()),-1===h.indexOf(" BILLBOARD")&&(h+="\n#define BILLBOARD\n"),null!==m&&void 0!==m&&m.isAnimationSheetEnabled&&-1===h.indexOf(" ANIMATESHEET")&&(h+="\n#define ANIMATESHEET\n"),-1===l.indexOf("diffuseSampler")&&l.push("diffuseSampler"),this.createEffect({vertex:U??(null===m||void 0===m?void 0:m.vertexShaderName)??"particles",fragmentElement:Q},L,w.concat(X),i.concat(l),h,M,f,O,void 0,W,(async()=>{0===W?await Promise.resolve().then(C.bind(C,12771)):await Promise.resolve().then(C.bind(C,12830))}))},eX.c.prototype.getEmittedParticleSystems=function(){const Q=[];for(let X=0;X<this.va().tk.length;X++){const C=this.va().tk[X];C.j===this&&Q.push(C)}return Q},eX.c.prototype.getHierarchyEmittedParticleSystems=function(){const Q=[],X=this.getDescendants();X.push(this);for(let C=0;C<this.va().tk.length;C++){const l=this.va().tk[C],h=l.j;h.position&&-1!==X.indexOf(h)&&Q.push(l)}return Q};C(749),C(765),C(800);C(735),C(869),C(828),C(738),C(858);C(2362);var HX;C(12753),C(2404);!function(Q){Q[Q.Color=2]="Color",Q[Q.UV=1]="UV",Q[Q.Random=0]="Random",Q[Q.Stated=3]="Stated"}(HX||(HX={}));var oX=C(2394);const TX=new l.k(0,0,0),YX=new l.k(0,0,0),JX=new l.k(0,0,0);class KX{constructor(Q,X,C){this.width=Q,this.height=X,this.data=C}processFlowable(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof l.b?l.k.TransformCoordinatesToRef(Q.position,C,JX):(JX.x=C.x,JX.y=C.y,JX.z=C.z);const h=.5*JX.x+.5,M=1-(.5*JX.y+.5),f=Math.floor(h*this.width),O=Math.floor(M*this.height);if(f<0||f>=this.width||O<0||O>=this.height)return;const m=4*(O*this.width+f),W=this.data[m]/255*2-1,U=this.data[m+1]/255*2-1,L=this.data[m+2]/255*2-1,w=this.data[m+3]/255;TX.set(W,U,L),TX.scaleToRef(X*w,YX),Q.direction.addInPlace(YX)}_processParticle(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(Q,X,C)}static async FromUrlAsync(Q){return await new Promise(((X,C)=>{const l=document.createElement("canvas"),h=l.getContext("2d");let M=null;const f=new Image;f.crossOrigin="anonymous",f.src=Q,f.onerror=X=>{C(new Error(`Failed to load image: ${Q} : ${X}`))},f.onload=()=>{l.width=f.width,l.height=f.height,h.drawImage(f,0,0),M=h.getImageData(0,0,l.width,l.height),X(new KX(l.width,l.height,M.data))}}))}static async ExtractFromTextureAsync(Q){return await new Promise(((X,C)=>{if(!Q.isReady())return void Q.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(Q);X(C)}catch(l){C(l)}}));const l=Q.getSize();oX.j.GetTextureDataAsync(Q,l.width,l.height).then((Q=>{X(new KX(l.width,l.height,new Uint8ClampedArray(Q)))})).catch(C)}))}}var NX,qX,nX,cX,EX,BX,GX,bX,pX;!function(Q){Q[Q.Int=1]="Int",Q[Q.Float=2]="Float",Q[Q.Vector2=4]="Vector2",Q[Q.Yj=8]="Yj",Q[Q.Matrix=16]="Matrix",Q[Q.Particle=32]="Particle",Q[Q.Texture=64]="Texture",Q[Q.nk=128]="nk",Q[Q.FloatGradient=256]="FloatGradient",Q[Q.Vector2Gradient=512]="Vector2Gradient",Q[Q.Vector3Gradient=1024]="Vector3Gradient",Q[Q.Color4Gradient=2048]="Color4Gradient",Q[Q.System=4096]="System",Q[Q.AutoDetect=8192]="AutoDetect",Q[Q.BasedOnInput=16384]="BasedOnInput",Q[Q.Undefined=32768]="Undefined",Q[Q.All=65535]="All"}(NX||(NX={})),function(Q){Q[Q.Compatible=0]="Compatible",Q[Q.TypeIncompatible=1]="TypeIncompatible",Q[Q.HierarchyIssue=2]="HierarchyIssue"}(qX||(qX={})),function(Q){Q[Q.Input=0]="Input",Q[Q.Output=1]="Output"}(nX||(nX={}));class IX{get direction(){return this._direction}get type(){if(this._type===NX.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===NX.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Q){this._type=Q}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Q=>Q.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Q,X,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=NX.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new D.e,this.onDisconnectionObservable=new D.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=X,this.name=Q,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Q){var X;return this.isConnected?null!==(X=this._connectedPoint)&&void 0!==X&&X._storedFunction?this._connectedPoint._storedFunction(Q):this._connectedPoint._storedValue:this.value}canConnectTo(Q){return 0===this.checkCompatibilityState(Q)}checkCompatibilityState(Q){const X=this._ownerBlock,C=Q.ownerBlock;if(this.type!==Q.type&&Q.innerType!==NX.AutoDetect)return Q.acceptedConnectionPointTypes&&-1!==Q.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Q.excludedConnectionPointTypes&&-1!==Q.excludedConnectionPointTypes.indexOf(this.type))return 1;let l=C,h=X;return 0===this.direction&&(l=X,h=C),l.isAnAncestorOf(h)?2:0}connectTo(Q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Q))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Q.ownerBlock.name}".${Q.name}`;return this._endpoints.push(Q),Q._connectedPoint=this,this.onConnectionObservable.notifyObservers(Q),Q.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Q){const X=this._endpoints.indexOf(Q);return-1===X||(this._endpoints.splice(X,1),Q._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Q),Q.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Q){let X=1;for(;X<NX.All;)Q&X||this.excludedConnectionPointTypes.push(X),X<<=1}serialize(){let Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const X={};return X.name=this.name,X.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.dk?(X.valueType="BABYLON."+this.value.getClassName(),X.value=this.value.dk()):(X.valueType="number",X.value=this.value)),Q&&this.connectedPoint&&(X.inputName=this.name,X.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,X.targetConnectionName=this.connectedPoint.name,X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),X}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class tX{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Q){this._name=Q}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Q){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new D.e,this.bk=new D.e,this.onInputChangedObservable=new D.e,this.visibleOnFrame=!1,this._name=Q,this.uniqueId=K.b.UniqueId}_inputRename(Q){return Q}_outputRename(Q){return Q}isAnAncestorOf(Q){for(const X of this._outputs)if(X.hasEndpoints)for(const C of X.endpoints){if(C.ownerBlock===Q)return!0;if(C.ownerBlock.isAnAncestorOf(Q))return!0}return!1}isAnAncestorOfType(Q){if(this.getClassName()===Q)return!0;for(const X of this._outputs)if(X.hasEndpoints)for(const C of X.endpoints)if(C.ownerBlock.isAnAncestorOfType(Q))return!0;return!1}getInputByName(Q){const X=this._inputs.filter((X=>X.name===Q));return X.length?X[0]:null}_linkConnectionTypes(Q,X){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[X]._acceptedConnectionPointType=this._inputs[Q]:(this._inputs[Q]._linkedConnectionSource=this._inputs[X],this._inputs[Q]._isMainLinkSource=!0),this._inputs[X]._linkedConnectionSource=this._inputs[Q]}registerInput(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;const f=new IX(Q,this,0);return f.type=X,f.isOptional=C,f.defaultValue=l,f.value=l,f.valueMin=h,f.valueMax=M,this._inputs.push(f),this.onInputChangedObservable.notifyObservers(f),this}registerOutput(Q,X,C){return(C=C??new IX(Q,this,1)).type=X,this._outputs.push(C),this}_build(Q){}_customBuildStep(Q){}build(Q){if(this._buildId===Q.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Q=>Q.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Q.buildId;for(const X of this._inputs){if(!X.connectedPoint){X.isOptional||Q.notConnectedNonOptionalInputs.push(X);continue}const C=X.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(Q)}return this._customBuildStep(Q),Q.verbose&&N.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Q),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Q={};Q.customType="BABYLON."+this.getClassName(),Q.id=this.uniqueId,Q.name=this.name,Q.visibleOnFrame=this.visibleOnFrame,Q.inputs=[],Q.outputs=[];for(const X of this.inputs)Q.inputs.push(X.serialize());for(const X of this.outputs)Q.outputs.push(X.serialize(!1));return Q}_deserialize(Q){this._name=Q.name,this.comments=Q.comments,this.visibleOnFrame=!!Q.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Q)}_deserializePortDisplayNamesAndExposedOnFrame(Q){const X=Q.inputs,C=Q.outputs;if(X)for(const l of X){const Q=this.inputs.find((Q=>Q.name===l.name));if(!Q)return;if(l.displayName&&(Q.displayName=l.displayName),l.isExposedOnFrame&&(Q.isExposedOnFrame=l.isExposedOnFrame,Q.exposedPortPosition=l.exposedPortPosition),void 0!==l.value&&null!==l.value)if("number"===l.valueType)Q.value=l.value;else{const X=(0,O.e)(l.valueType);X&&(Q.value=X.Wj(l.value))}}if(C)for(let l=0;l<C.length;l++){const Q=C[l];Q.displayName&&(this.outputs[l].displayName=Q.displayName),Q.isExposedOnFrame&&(this.outputs[l].isExposedOnFrame=Q.isExposedOnFrame,this.outputs[l].exposedPortPosition=Q.exposedPortPosition)}}clone(){const Q=this.serialize(),X=(0,O.e)(Q.customType);if(X){const C=new X;return C._deserialize(Q),C}return null}dispose(){this.bk.notifyObservers(this),this.bk.clear();for(const Q of this.inputs)Q.dispose();for(const Q of this.outputs)Q.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function yX(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",l=arguments.length>3?arguments[3]:void 0;return(h,M)=>{let f=h._propStore;f||(f=[],h._propStore=f),f.push({propertyName:M,displayName:Q,type:X,groupName:C,options:l??{},className:h.getClassName()})}}(0,o.c)([(0,T.N)("comment")],tX.prototype,"comments",void 0),function(Q){Q[Q.Boolean=0]="Boolean",Q[Q.Float=1]="Float",Q[Q.Int=2]="Int",Q[Q.Vector2=3]="Vector2",Q[Q.List=4]="List",Q[Q.nk=5]="nk",Q[Q.SamplingMode=6]="SamplingMode",Q[Q.TextureFormat=7]="TextureFormat",Q[Q.TextureType=8]="TextureType"}(cX||(cX={})),function(Q){Q[Q.None=0]="None",Q[Q.Position=1]="Position",Q[Q.Direction=2]="Direction",Q[Q.Age=3]="Age",Q[Q.Lifetime=4]="Lifetime",Q[Q.Color=5]="Color",Q[Q.ScaledDirection=6]="ScaledDirection",Q[Q.Scale=7]="Scale",Q[Q.AgeGradient=8]="AgeGradient",Q[Q.Angle=9]="Angle",Q[Q.SpriteCellIndex=16]="SpriteCellIndex",Q[Q.SpriteCellStart=17]="SpriteCellStart",Q[Q.SpriteCellEnd=18]="SpriteCellEnd"}(EX||(EX={})),function(Q){Q[Q.None=0]="None",Q[Q.Time=1]="Time",Q[Q.Delta=2]="Delta",Q[Q.Emitter=3]="Emitter"}(BX||(BX={}));class AX{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Q="";for(const X of this.notConnectedNonOptionalInputs)Q+=`input ${X.name} from block ${X.ownerBlock.name}[${X.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Q)throw"Build of Node Particle System Set failed:\n"+Q}adapt(Q,X){const C=Q.getConnectedValue(this)||0;if(Q.type===X)return C;switch(X){case NX.Vector2:return new l.h(C,C);case NX.Yj:return new l.k(C,C,C);case NX.nk:return new f.d(C,C,C,C)}return null}getContextualValue(Q){if(!this.particleContext||!this.systemContext)return null;switch(Q){case EX.Position:return this.particleContext.position;case EX.Direction:return this.particleContext.direction;case EX.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case EX.Color:return this.particleContext.color;case EX.Age:return this.particleContext.age;case EX.Lifetime:return this.particleContext.lifeTime;case EX.Angle:return this.particleContext.angle;case EX.Scale:return this.particleContext.scale;case EX.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case EX.SpriteCellEnd:return this.systemContext.endSpriteCellID;case EX.SpriteCellIndex:return this.particleContext.cellIndex;case EX.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(Q){if(!this.particleContext||!this.systemContext)return null;switch(Q){case BX.Time:return this.systemContext._actualFrame;case BX.Delta:return this.systemContext._scaledUpdateSpeed;case BX.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function DX(Q,X,C){const l=new AX;l.ld=X;const h=Q.createSystem(l);return h.canStart=()=>!0,h.j=C.clone(),h.disposeOnStop=!0,h.start(),h}class uX extends tX{constructor(Q){super(Q),this.blendMode=m.BLENDMODE_ONEONE,this.xb=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",NX.Particle),this.registerInput("texture",NX.Texture),this.registerInput("onStart",NX.System,!0),this.registerInput("onEnd",NX.System,!0),this.registerOutput("system",NX.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Q){Q.xb=this.xb,Q.buildId=this._buildId++,this.build(Q);const X=this.particle.getConnectedValue(Q);return X.particleTexture=this.texture.getConnectedValue(Q),X.emitRate=this.emitRate,X.blendMode=this.blendMode,X.name=this.name,X._nodeGenerated=!0,X._targetStopDuration=this.targetStopDuration,X.startDelay=this.startDelay,this.system._storedValue=this,X.canStart=()=>!this.doNoStart,X.onStartedObservable.add((C=>{const l=this.onStart.getConnectedValue(Q);l&&C.onStartedObservable.addOnce((()=>{Q.systemContext=X;const C=DX(l,Q.ld,Q.emitterPosition);this.bk.addOnce((()=>{C.dispose()}))}));const h=this.onEnd.getConnectedValue(Q);h&&C.onStoppedObservable.addOnce((()=>{Q.systemContext=X;const C=DX(h,Q.ld,Q.emitterPosition);this.bk.addOnce((()=>{C.dispose()}))}))})),this.bk.addOnce((()=>{X.dispose()})),X}serialize(){const Q=super.serialize();return Q.xb=this.xb,Q.emitRate=this.emitRate,Q.blendMode=this.blendMode,Q.doNoStart=this.doNoStart,Q.targetStopDuration=this.targetStopDuration,Q.startDelay=this.startDelay,Q}_deserialize(Q){super._deserialize(Q),this.xb=Q.xb,this.emitRate=Q.emitRate,this.doNoStart=!!Q.doNoStart,void 0!==Q.blendMode&&(this.blendMode=Q.blendMode),void 0!==Q.targetStopDuration&&(this.targetStopDuration=Q.targetStopDuration),void 0!==Q.startDelay&&(this.startDelay=Q.startDelay)}}(0,o.c)([yX("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:m.BLENDMODE_ONEONE},{label:"Standard",value:m.BLENDMODE_STANDARD},{label:"Add",value:m.BLENDMODE_ADD},{label:"Multiply",value:m.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:m.BLENDMODE_MULTIPLYADD}]})],uX.prototype,"blendMode",void 0),(0,o.c)([yX("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],uX.prototype,"xb",void 0),(0,o.c)([yX("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uX.prototype,"emitRate",void 0),(0,o.c)([yX("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uX.prototype,"targetStopDuration",void 0),(0,o.c)([yX("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uX.prototype,"startDelay",void 0),(0,o.c)([yX("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uX.prototype,"doNoStart",void 0),(0,O.g)("BABYLON.SystemBlock",uX);class VX extends tX{get type(){if(this._type===NX.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=NX.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=NX.Vector2,this._type;case"Yj":return this._type=NX.Yj,this._type;case"nk":return this._type=NX.nk,this._type;case"Matrix":return this._type=NX.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===EX.None&&this._systemSource!==BX.None}get systemSource(){return this._systemSource}set systemSource(Q){if(this._systemSource=Q,Q!==BX.None){switch(this._contextualSource=EX.None,this._type=NX.Float,Q){case BX.Time:case BX.Delta:this._type=NX.Float;break;case BX.Emitter:this._type=NX.Yj}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==EX.None}get contextualValue(){return this._contextualSource}set contextualValue(Q){if(this._contextualSource=Q,Q!==EX.None){switch(this._systemSource=BX.None,Q){case EX.Scale:this._type=NX.Vector2;break;case EX.Position:case EX.Direction:case EX.ScaledDirection:this._type=NX.Yj;break;case EX.Color:this._type=NX.nk;break;case EX.Age:case EX.Lifetime:case EX.Angle:case EX.AgeGradient:this._type=NX.Float;break;case EX.SpriteCellEnd:case EX.SpriteCellStart:case EX.SpriteCellIndex:this._type=NX.Int}this.output&&(this.output.type=this._type)}}constructor(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NX.AutoDetect;super(Q),this._type=NX.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new D.e,this._systemSource=BX.None,this._contextualSource=EX.None,this._type=X,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",X)}get value(){return this._storedValue}set value(Q){this.type===NX.Float&&this.min!==this.max&&(Q=Math.max(this.min,Q),Q=Math.min(this.max,Q)),this._storedValue=Q,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Q){this._valueCallback=Q}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case NX.Int:case NX.Float:this.value=0;break;case NX.Vector2:this.value=l.h.Zero();break;case NX.Yj:this.value=l.k.Zero();break;case NX.nk:this.value=new f.d(1,1,1,1);break;case NX.Matrix:this.value=l.b.Identity()}}_build(Q){super._build(Q),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Q=>Q.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Q=>Q.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Q=super.serialize();return Q.type=this.type,Q.contextualValue=this.contextualValue,Q.systemSource=this.systemSource,Q.min=this.min,Q.max=this.max,Q.groupInInspector=this.groupInInspector,Q.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.dk?(Q.valueType="BABYLON."+this._storedValue.getClassName(),Q.value=this._storedValue.dk()):(Q.valueType="number",Q.value=this._storedValue)),Q}_deserialize(Q){if(super._deserialize(Q),this._type=Q.type,this.contextualValue=Q.contextualValue,this.systemSource=Q.systemSource||BX.None,this.min=Q.min||0,this.max=Q.max||0,this.groupInInspector=Q.groupInInspector||"",void 0!==Q.displayInInspector&&(this.displayInInspector=Q.displayInInspector),Q.valueType)if("number"===Q.valueType)this._storedValue=Q.value;else{const X=(0,O.e)(Q.valueType);X&&(this._storedValue=X.Wj(Q.value))}}}(0,O.g)("BABYLON.ParticleInputBlock",VX);class dX extends tX{get url(){return this._url}set url(Q){this._url!==Q&&(this._cachedData=null,this._url=Q,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Q){this._textureDataUrl!==Q&&(this._cachedData=null,this._textureDataUrl=Q,this._url="",this._sourceTexture=null)}set sourceTexture(Q){this._sourceTexture!==Q&&(this._cachedData=null,this._sourceTexture=Q,this._url="",this._textureDataUrl="")}constructor(Q){super(Q),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",NX.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Q=this.texture._storedValue;return await new Promise(((X,C)=>{if(!Q.isReady())return void Q.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),X(this._cachedData)}catch(Q){C(Q)}}));const l=Q.getSize();oX.j.GetTextureDataAsync(Q,l.width,l.height).then((C=>{this._cachedData={width:l.width,height:l.height,data:new Uint8ClampedArray(C)},Q.dispose(),X(this._cachedData)})).catch(C)}))}_build(Q){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new J.e(this._textureDataUrl,Q.ld):this.texture._storedValue=new J.e(this._url,Q.ld):this.texture._storedValue=null}serialize(){const Q=super.serialize();return Q.url=this.url,Q.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Q.textureDataUrl=this.textureDataUrl),Q}_deserialize(Q){super._deserialize(Q),this.url=Q.url,this.serializedCachedData=!!Q.serializedCachedData,Q.textureDataUrl&&(this.textureDataUrl=Q.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,O.g)("BABYLON.ParticleTextureSourceBlock",dX);class QC extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("position",NX.Yj),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Q){const X=this.particle.getConnectedValue(Q);if(this.output._storedValue=X,!this.position.isConnected)return;const C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.position.p(this.position.getConnectedValue(Q))},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C}}(0,O.g)("BABYLON.UpdatePositionBlock",QC),function(Q){Q[Q.Add=0]="Add",Q[Q.Subtract=1]="Subtract",Q[Q.Multiply=2]="Multiply",Q[Q.Divide=3]="Divide",Q[Q.Max=4]="Max",Q[Q.Min=5]="Min"}(GX||(GX={}));class XC extends tX{constructor(Q){super(Q),this.operation=GX.Add,this.registerInput("left",NX.AutoDetect),this.registerInput("right",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this.output._typeConnectionSource=this.left;const X=[NX.Matrix,NX.Particle,NX.Texture,NX.System,NX.FloatGradient,NX.Color4Gradient,NX.Vector2Gradient,NX.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...X),this.right.excludedConnectionPointTypes.push(...X),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Q){let X;const C=this.left,h=this.right;if(!C.isConnected||!h.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const M=C.type===NX.Float||C.type===NX.Int,O=h.type===NX.Float||h.type===NX.Int,m=M&&O;switch(this.operation){case GX.Add:X=m?Q=>C.getConnectedValue(Q)+h.getConnectedValue(Q):M?Q=>Q.adapt(C,h.type).add(h.getConnectedValue(Q)):Q=>C.getConnectedValue(Q).add(Q.adapt(h,C.type));break;case GX.Subtract:X=m?Q=>C.getConnectedValue(Q)-h.getConnectedValue(Q):M?Q=>Q.adapt(C,h.type).Od(h.getConnectedValue(Q)):Q=>C.getConnectedValue(Q).Od(Q.adapt(h,C.type));break;case GX.Multiply:X=m?Q=>C.getConnectedValue(Q)*h.getConnectedValue(Q):M?Q=>Q.adapt(C,h.type).multiply(h.getConnectedValue(Q)):Q=>C.getConnectedValue(Q).multiply(Q.adapt(h,C.type));break;case GX.Divide:X=m?Q=>C.getConnectedValue(Q)/h.getConnectedValue(Q):M?Q=>Q.adapt(C,h.type).divide(h.getConnectedValue(Q)):Q=>C.getConnectedValue(Q).divide(Q.adapt(h,C.type));break;case GX.Min:if(m)X=Q=>Math.min(C.getConnectedValue(Q),h.getConnectedValue(Q));else{const[Q,O]=M?[h,C]:[C,h];switch(Q.type){case NX.Vector2:X=X=>l.h.Minimize(Q.getConnectedValue(X),X.adapt(O,Q.type));break;case NX.Yj:X=X=>l.k.Minimize(Q.getConnectedValue(X),X.adapt(O,Q.type));break;case NX.nk:X=X=>{const C=Q.getConnectedValue(X),{r:l,g:h,b:M,a:m}=X.adapt(O,Q.type);return new f.d(Math.min(C.r,l),Math.min(C.g,h),Math.min(C.b,M),Math.min(C.a,m))}}}break;case GX.Max:if(!m){const[Q,O]=M?[h,C]:[C,h];switch(Q.type){case NX.Vector2:X=X=>l.h.Maximize(Q.getConnectedValue(X),X.adapt(O,Q.type));break;case NX.Yj:X=X=>l.k.Maximize(Q.getConnectedValue(X),X.adapt(O,Q.type));break;case NX.nk:X=X=>{const C=Q.getConnectedValue(X),{r:l,g:h,b:M,a:m}=X.adapt(O,Q.type);return new f.d(Math.max(C.r,l),Math.min(C.g,h),Math.min(C.b,M),Math.min(C.a,m))}}break}X=Q=>Math.max(C.getConnectedValue(Q),h.getConnectedValue(Q))}this.output._storedFunction=Q=>C.type===NX.Int?0|X(Q):X(Q)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===NX.Int||this.left.type===NX.Float&&this.right.type!==NX.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Q,X]of[[this.left,this.right],[this.right,this.left]])Q.acceptedConnectionPointTypes=[NX.Int,NX.Float],X.isConnected&&(Q.acceptedConnectionPointTypes.push(X.type),X.type!==NX.Int&&X.type!==NX.Float||Q.acceptedConnectionPointTypes.push(NX.Vector2,NX.Yj,NX.nk))}dispose(){super.dispose();for(const Q of this._connectionObservers)Q.remove();this._connectionObservers.length=0}serialize(){const Q=super.serialize();return Q.operation=this.operation,Q}_deserialize(Q){super._deserialize(Q),this.operation=Q.operation}}(0,o.c)([yX("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:GX.Add},{label:"Subtract",value:GX.Subtract},{label:"Multiply",value:GX.Multiply},{label:"Divide",value:GX.Divide},{label:"Max",value:GX.Max},{label:"Min",value:GX.Min}]})],XC.prototype,"operation",void 0),(0,O.g)("BABYLON.ParticleMathBlock",XC);class CC extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("direction1",NX.Yj,!0,new l.k(0,1,0)),this.registerInput("direction2",NX.Yj,!0,new l.k(0,1,0)),this.registerInput("minEmitBox",NX.Yj,!0,new l.k(-.5,-.5,-.5)),this.registerInput("maxEmitBox",NX.Yj,!0,new l.k(.5,.5,.5)),this.registerOutput("output",NX.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Q){const X=this.particle.getConnectedValue(Q);X._directionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.direction1.getConnectedValue(Q),M=this.direction2.getConnectedValue(Q),f=(0,W.RandomRange)(h.x,M.x),O=(0,W.RandomRange)(h.y,M.y),m=(0,W.RandomRange)(h.z,M.z);Q.isEmitterTransformNode?l.k.TransformNormalFromFloatsToRef(f,O,m,Q.emitterWorldMatrix,C.direction):C.direction.Yc(f,O,m)},X._positionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.minEmitBox.getConnectedValue(Q),M=this.maxEmitBox.getConnectedValue(Q),f=(0,W.RandomRange)(h.x,M.x),O=(0,W.RandomRange)(h.y,M.y),m=(0,W.RandomRange)(h.z,M.z);Q.isEmitterTransformNode?l.k.TransformCoordinatesFromFloatsToRef(f,O,m,Q.emitterWorldMatrix,C.position):(C.position.Yc(f,O,m),C.position.addInPlace(Q.emitterPosition))},this.output._storedValue=X}}(0,O.g)("BABYLON.BoxShapeBlock",CC);class lC extends tX{constructor(Q){super(Q),this.registerInput("emitPower",NX.Float,!0,1),this.registerInput("lifeTime",NX.Float,!0,1),this.registerInput("color",NX.nk,!0,new f.d(1,1,1,1)),this.registerInput("scale",NX.Vector2,!0,new l.h(1,1)),this.registerInput("angle",NX.Float,!0,0),this.registerOutput("particle",NX.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Q){const X=new OX(this.name,Q.xb,Q.ld,null,!1,void 0,!0);X.particleEmitterType=new z,X._lifeTimeCreation.process=(X,C)=>{Q.particleContext=X,X.lifeTime=this.lifeTime.getConnectedValue(Q),C._emitPower=this.emitPower.getConnectedValue(Q)},X._colorCreation.process=X=>{Q.particleContext=X,X.color.p(this.color.getConnectedValue(Q))},X._sizeCreation.process=X=>{Q.particleContext=X,X.size=1,X.scale.p(this.scale.getConnectedValue(Q))},X._angleCreation.process=X=>{Q.particleContext=X,X.angle=this.angle.getConnectedValue(Q)},this.particle._storedValue=X}}(0,O.g)("BABYLON.CreateParticleBlock",lC);class hC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Q=[];for(const X of this.attachedBlocks)X.isInput&&Q.push(X);return Q}constructor(Q){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new D.e,this.name=Q}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Q)&&this.attachedBlocks.push(Q);for(const C of Q.inputs){const l=C.connectedPoint;if(l){const C=l.ownerBlock;C!==Q&&this._initializeBlock(C,X)}}}async buildAsync(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const l=new ZX;for(const Q of this._systemBlocks)this._initializeBlock(Q);for(const h of this.systemBlocks){const C=new AX;C.buildId=this._buildId++,C.ld=Q,C.verbose=X;const M=h.createSystem(C);C.emitErrors(),l.systems.push(M)}this.onBuildObservable.notifyObservers(this),C(l)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Q=new uX("Particle system"),X=new QC("Update position");X.output.connectTo(Q.particle);const C=new VX("Position");C.contextualValue=EX.Position;const l=new VX("Scaled direction");l.contextualValue=EX.ScaledDirection;const h=new XC("Add");h.operation=GX.Add,C.output.connectTo(h.left),l.output.connectTo(h.right),h.output.connectTo(X.position);const M=new lC("Create particle"),f=new CC("Box shape");M.particle.connectTo(f.particle),f.output.connectTo(X.particle);const O=new dX("Texture");O.texture.connectTo(Q.texture),O.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Q)}removeBlock(Q){const X=this.attachedBlocks.indexOf(Q);if(X>-1&&this.attachedBlocks.splice(X,1),Q.isSystem){const X=this._systemBlocks.indexOf(Q);X>-1&&this._systemBlocks.splice(X,1)}}parseSerializedObject(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];X||this.clear();const C={};for(const l of Q.Mk){const Q=(0,O.e)(l.customType);if(Q){const X=new Q;X._deserialize(l),C[l.id]=X,this.attachedBlocks.push(X),X.isSystem&&this._systemBlocks.push(X)}}for(const l of this.attachedBlocks)if(l.isTeleportOut){const Q=l,X=Q._tempEntryPointUniqueId;if(X){const l=C[X];l&&l.attachToEndpoint(Q)}}for(let l=0;l<Q.Mk.length;l++){const h=Q.Mk[l],M=C[h.id];M&&(M.inputs.length&&h.inputs.some((Q=>Q.targetConnectionName))&&!X||this._restoreConnections(M,Q,C))}if(Q.locations||Q.editorData&&Q.editorData.locations){const l=Q.locations||Q.editorData.locations;for(const Q of l)C[Q.blockId]&&(Q.blockId=C[Q.blockId].uniqueId);X&&this.editorData&&this.editorData.locations&&l.concat(this.editorData.locations),Q.locations?this.editorData={locations:l}:(this.editorData=Q.editorData,this.editorData.locations=l);const h=[];for(const Q in C)h[Q]=C[Q].uniqueId;this.editorData.map=h}this.comment=Q.comment}_restoreConnections(Q,X,C){for(const l of Q.outputs)for(const h of X.Mk){const M=C[h.id];if(M)for(const f of h.inputs)if(C[f.targetBlockId]!==Q||f.targetConnectionName!==l.name);else{const Q=M.getInputByName(f.inputName);if(!Q||Q.isConnected)continue;l.connectTo(Q,!0),this._restoreConnections(M,X,C)}}}serialize(Q){const X=Q?{}:Y.d.Serialize(this);X.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];Q?C=Q:X.customType="BABYLON.NodeParticleSystemSet",X.Mk=[];for(const l of C)X.Mk.push(l.serialize());if(!Q)for(const l of this.attachedBlocks)-1===C.indexOf(l)&&X.Mk.push(l.serialize());return X}dispose(){for(const Q of this.attachedBlocks)Q.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Q){const X=new hC(Q);return X.setToDefault(),X}static Parse(Q){const X=Y.d.Parse((()=>new hC(Q.name)),Q,null);return X.parseSerializedObject(Q),X}static ParseFromSnippetAsync(Q,X){return"_BLANK"===Q?Promise.resolve(hC.CreateDefault("blank")):new Promise(((C,l)=>{const h=new gX.e;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const f=JSON.parse(JSON.parse(h.responseText).jsonPayload),O=JSON.parse(f.nodeParticle);X||(X=Y.d.Parse((()=>new hC(Q)),O,null)),X.parseSerializedObject(O),X.snippetId=Q;try{C(X)}catch(M){l(M)}}else l("Unable to load the snippet "+Q)})),h.open("GET",this.SnippetUrl+"/"+Q.replace(/#/g,"/")),h.send()}))}}hC.EditorURL=`${PX.i._DefaultCdnUrl}/v${yQ.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,hC.SnippetUrl="https://snippet.babylonjs.com",(0,o.c)([(0,T.N)()],hC.prototype,"name",void 0),(0,o.c)([(0,T.N)("comment")],hC.prototype,"comment",void 0),function(Q){Q[Q.None=0]="None",Q[Q.PerParticle=1]="PerParticle",Q[Q.PerSystem=2]="PerSystem"}(bX||(bX={}));class MC extends tX{constructor(Q){super(Q),this._currentLockId=-2,this.lockMode=bX.PerParticle,this.registerInput("min",NX.AutoDetect,!0,0),this.registerInput("max",NX.AutoDetect,!0,1),this.registerOutput("output",NX.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NX.Float|NX.Int|NX.Vector2|NX.Yj|NX.nk),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(NX.Float|NX.Int|NX.Vector2|NX.Yj|NX.nk),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=NX.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Q=null;switch(this._currentLockId=-2,this.min.type){case NX.AutoDetect:case NX.Int:case NX.Float:Q=Q=>{const X=this.min.getConnectedValue(Q)||0,C=this.max.getConnectedValue(Q)||1;return X+Math.random()*(C-X)};break;case NX.Vector2:Q=Q=>{const X=this.min.getConnectedValue(Q)||l.h.Zero(),C=this.max.getConnectedValue(Q)||l.h.One();return new l.h(X.x+Math.random()*(C.x-X.x),X.y+Math.random()*(C.y-X.y))};break;case NX.Yj:Q=Q=>{const X=this.min.getConnectedValue(Q)||l.k.Zero(),C=this.max.getConnectedValue(Q)||l.k.One();return new l.k(X.x+Math.random()*(C.x-X.x),X.y+Math.random()*(C.y-X.y),X.z+Math.random()*(C.z-X.z))};break;case NX.nk:Q=Q=>{const X=this.min.getConnectedValue(Q)||new f.d(0,0,0,0),C=this.max.getConnectedValue(Q)||new f.d(1,1,1,1);return new f.d(X.x+Math.random()*(C.x-X.x),X.y+Math.random()*(C.y-X.y),X.z+Math.random()*(C.z-X.z),X.w+Math.random()*(C.w-X.w))}}this.output._storedFunction=X=>{var C;let l=0;switch(this.lockMode){case bX.PerParticle:l=(null===(C=X.particleContext)||void 0===C?void 0:C.id)||-1;break;case bX.PerSystem:l=X.buildId||0}return this._currentLockId!==l&&(this.lockMode!==bX.None&&(this._currentLockId=l),this.output._storedValue=Q(X)),this.output._storedValue}}serialize(){const Q=super.serialize();return Q.lockMode=this.lockMode,Q}_deserialize(Q){super._deserialize(Q),this.lockMode=Q.lockMode}}(0,o.c)([yX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:bX.None},{label:"Per particle",value:bX.PerParticle},{label:"Per system",value:bX.PerSystem}]})],MC.prototype,"lockMode",void 0),(0,O.g)("BABYLON.ParticleRandomBlock",MC);class fC extends tX{constructor(Q){super(Q),this._currentLockId=-2,this.lockMode=bX.PerParticle,this.registerInput("min",NX.AutoDetect),this.registerInput("max",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const X=[NX.Matrix,NX.Particle,NX.Texture,NX.System,NX.FloatGradient,NX.Color4Gradient,NX.Vector2Gradient,NX.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...X),this.max.excludedConnectionPointTypes.push(...X)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Q=null;switch(this._currentLockId=-2,this.min.type){case NX.Float:case NX.Int:Q=Q=>{const X=this.min.getConnectedValue(Q),C=this.max.getConnectedValue(Q);return Math.random()*(C-X)+X};break;case NX.Vector2:Q=Q=>{const X=this.min.getConnectedValue(Q),C=this.max.getConnectedValue(Q);return new l.h(Math.random()*(C.x-X.x)+X.x,Math.random()*(C.y-X.y)+X.y)};break;case NX.Yj:Q=Q=>{const X=this.min.getConnectedValue(Q),C=this.max.getConnectedValue(Q);return new l.k(Math.random()*(C.x-X.x)+X.x,Math.random()*(C.y-X.y)+X.y,Math.random()*(C.z-X.z)+X.z)};break;case NX.nk:Q=Q=>{const X=this.min.getConnectedValue(Q),C=this.max.getConnectedValue(Q);return new f.d(Math.random()*(C.r-X.r)+X.r,Math.random()*(C.g-X.g)+X.g,Math.random()*(C.b-X.b)+X.b,Math.random()*(C.a-X.a)+X.a)}}this.output._storedFunction=X=>{var C;let l=0;switch(this.lockMode){case bX.PerParticle:l=(null===(C=X.particleContext)||void 0===C?void 0:C.id)||-1;break;case bX.PerSystem:l=X.buildId||0}return this._currentLockId!==l&&(this.lockMode!==bX.None&&(this._currentLockId=l),this.output._storedValue=Q(X)),this.output._storedValue}}serialize(){const Q=super.serialize();return Q.lockMode=this.lockMode,Q}_deserialize(Q){super._deserialize(Q),void 0!==Q.lockMode&&(this.lockMode=Q.lockMode)}}(0,o.c)([yX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:bX.None},{label:"Per particle",value:bX.PerParticle},{label:"Per system",value:bX.PerSystem}]})],fC.prototype,"lockMode",void 0),(0,O.g)("BABYLON.RandomRangeBlock",fC);(0,O.g)("BABYLON.ParticleLerpBlock",class extends tX{constructor(Q){super(Q),this.registerInput("left",NX.AutoDetect),this.registerInput("right",NX.AutoDetect),this.registerInput("gradient",NX.Float,!0,0,0,1),this.registerOutput("output",NX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NX.Float|NX.Int|NX.Vector2|NX.Yj|NX.nk)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Q=(Q,X,C)=>(1-Q)*X+Q*C;this.output._storedFunction=X=>{const C=this.left.getConnectedValue(X),h=this.right.getConnectedValue(X),M=this.gradient.getConnectedValue(X);switch(this.left.type){case NX.Int:case NX.Float:return Q(M,C,h);case NX.Vector2:return new l.h(Q(M,C.x,h.x),Q(M,C.y,h.y));case NX.Yj:return new l.k(Q(M,C.x,h.x),Q(M,C.y,h.y),Q(M,C.z,h.z));case NX.nk:return new f.d(Q(M,C.r,h.r),Q(M,C.g,h.g),Q(M,C.b,h.b),Q(M,C.a,h.a))}return 0}}});(0,O.g)("BABYLON.UpdateDirectionBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("direction",NX.Yj),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Q){const X=this.particle.getConnectedValue(Q);if(this.output._storedValue=X,!this.direction.isConnected)return;const C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.direction.p(this.direction.getConnectedValue(Q))},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C}});(0,O.g)("BABYLON.UpdateColorBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("color",NX.nk),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Q){const X=this.particle.getConnectedValue(Q);if(this.output._storedValue=X,!this.color.isConnected)return;const C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.color.p(this.color.getConnectedValue(Q))},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C}});(0,O.g)("BABYLON.UpdateScaleBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("scale",NX.Vector2),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Q){const X=this.particle.getConnectedValue(Q);if(this.output._storedValue=X,!this.scale.isConnected)return;const C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.scale.p(this.scale.getConnectedValue(Q))},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C}});(0,O.g)("BABYLON.UpdateAngleBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("angle",NX.Float),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Q){const X=this.particle.getConnectedValue(Q);if(this.output._storedValue=X,!this.angle.isConnected)return;const C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.angle=this.angle.getConnectedValue(Q)},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C}});(0,O.g)("BABYLON.BasicPositionUpdateBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Q){const X=this.particle.getConnectedValue(Q),C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.direction.scaleToRef(X._directionScale,X._scaledDirection),C.position.addInPlace(X._scaledDirection)},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C,this.output._storedValue=X}});(0,O.g)("BABYLON.BasicSpriteUpdateBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Q){const X=this.particle.getConnectedValue(Q),C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.updateCellIndex()},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C,this.output._storedValue=X}});(0,O.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("cellIndex",NX.Int),this.registerOutput("output",NX.Particle),this.cellIndex.acceptedConnectionPointTypes=[NX.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Q){const X=this.particle.getConnectedValue(Q);if(this.output._storedValue=X,!this.cellIndex.isConnected)return;const C={process:C=>{Q.particleContext=C,Q.systemContext=X,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Q))},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C}});class OC extends tX{constructor(Q){super(Q),this.strength=1,this.registerInput("particle",NX.Particle),this.registerInput("flowMap",NX.Texture),this.registerOutput("output",NX.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Q){var X;const C=this.particle.getConnectedValue(Q),l=Q.ld;let h;(null===(X=this.flowMap.connectedPoint)||void 0===X?void 0:X.ownerBlock).extractTextureContentAsync().then((Q=>{Q&&(h=new KX(Q.width,Q.height,Q.data))}));const M={process:Q=>{const X=l.getTransformMatrix();h&&h._processParticle(Q,this.strength*C._tempScaledUpdateSpeed,X)},previousItem:null,nextItem:null};C._updateQueueStart?BQ(M,C._updateQueueStart):C._updateQueueStart=M,this.output._storedValue=C}serialize(){const Q=super.serialize();return Q.strength=this.strength,Q}_deserialize(Q){super._deserialize(Q),this.strength=Q.strength}}(0,o.c)([yX("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OC.prototype,"strength",void 0),(0,O.g)("BABYLON.UpdateFlowMapBlock",OC);(0,O.g)("BABYLON.SphereShapeBlock",class extends tX{constructor(Q){super(Q),this.registerInput("input",NX.Particle),this.registerInput("radius",NX.Float,!0,1),this.registerInput("radiusRange",NX.Float,!0,1,0,1),this.registerInput("directionRandomizer",NX.Float,!0,0,0,1),this.registerOutput("output",NX.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Q){const X=this.input.getConnectedValue(Q);X._directionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.directionRandomizer.getConnectedValue(Q),M=C.position.Od(Q.emitterPosition).normalize(),f=(0,W.RandomRange)(0,h),O=(0,W.RandomRange)(0,h),m=(0,W.RandomRange)(0,h);M.x+=f,M.y+=O,M.z+=m,M.normalize(),Q.isEmitterTransformNode?l.k.TransformNormalFromFloatsToRef(f,O,m,Q.emitterWorldMatrix,C.direction):C.direction.Yc(f,O,m)},X._positionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.radius.getConnectedValue(Q),M=this.radiusRange.getConnectedValue(Q),f=h-(0,W.RandomRange)(0,h*M),O=(0,W.RandomRange)(0,1),m=(0,W.RandomRange)(0,2*Math.PI),U=Math.acos(2*O-1),L=f*Math.cos(m)*Math.sin(U),w=f*Math.cos(U),i=f*Math.sin(m)*Math.sin(U);Q.isEmitterTransformNode?l.k.TransformCoordinatesFromFloatsToRef(L,w,i,Q.emitterWorldMatrix,C.position):(C.position.Yc(L,w,i),C.position.addInPlace(Q.emitterPosition))},this.output._storedValue=X}});(0,O.g)("BABYLON.PointShapeBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("direction1",NX.Yj,!0,new l.k(0,1,0)),this.registerInput("direction2",NX.Yj,!0,new l.k(0,1,0)),this.registerOutput("output",NX.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Q){const X=this.particle.getConnectedValue(Q);X._directionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.direction1.getConnectedValue(Q),M=this.direction2.getConnectedValue(Q),f=(0,W.RandomRange)(h.x,M.x),O=(0,W.RandomRange)(h.y,M.y),m=(0,W.RandomRange)(h.z,M.z);Q.isEmitterTransformNode?l.k.TransformNormalFromFloatsToRef(f,O,m,Q.emitterWorldMatrix,C.direction):C.direction.Yc(f,O,m)},X._positionCreation.process=C=>{Q.systemContext=X,Q.isEmitterTransformNode?l.k.TransformCoordinatesFromFloatsToRef(0,0,0,Q.emitterWorldMatrix,C.position):C.position.p(Q.emitterPosition)},this.output._storedValue=X}});(0,O.g)("BABYLON.CustomShapeBlock",class extends tX{constructor(Q){super(Q),this.registerInput("particle",NX.Particle),this.registerInput("position",NX.Yj,!0,new l.k(0,0,0)),this.registerInput("direction",NX.Yj,!0,new l.k(0,1,0)),this.registerOutput("output",NX.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Q){const X=this.particle.getConnectedValue(Q);X._directionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.direction.getConnectedValue(Q);Q.isEmitterTransformNode?l.k.TransformNormalToRef(h,Q.emitterWorldMatrix,C.direction):C.direction.p(h)},X._positionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.position.getConnectedValue(Q);Q.isEmitterTransformNode?l.k.TransformCoordinatesToRef(h,Q.emitterWorldMatrix,C.position):(C.position.p(h),C.position.addInPlace(Q.emitterPosition))},this.output._storedValue=X}});(0,O.g)("BABYLON.CylinderShapeBlock",class extends tX{constructor(Q){super(Q),this._tempVector=l.k.Zero(),this.registerInput("particle",NX.Particle),this.registerInput("radius",NX.Float,!0,1),this.registerInput("height",NX.Float,!0,1,0),this.registerInput("radiusRange",NX.Float,!0,1,0,1),this.registerInput("directionRandomizer",NX.Float,!0,0,0,1),this.registerOutput("output",NX.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Q){const X=this.particle.getConnectedValue(Q);X._directionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.directionRandomizer.getConnectedValue(Q);C.position.subtractToRef(Q.emitterPosition,this._tempVector),this._tempVector.normalize(),Q.isEmitterTransformNode&&l.k.TransformNormalToRef(this._tempVector,Q.emitterInverseWorldMatrix,this._tempVector);const M=(0,W.RandomRange)(-h/2,h/2);let f=Math.atan2(this._tempVector.x,this._tempVector.z);f+=(0,W.RandomRange)(-Math.PI/2,Math.PI/2)*h,this._tempVector.y=M,this._tempVector.x=Math.sin(f),this._tempVector.z=Math.cos(f),this._tempVector.normalize(),Q.isEmitterTransformNode?l.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Q.emitterWorldMatrix,C.direction):C.direction.p(this._tempVector)},X._positionCreation.process=C=>{Q.particleContext=C,Q.systemContext=X;const h=this.height.getConnectedValue(Q),M=this.radiusRange.getConnectedValue(Q),f=this.radius.getConnectedValue(Q),O=(0,W.RandomRange)(-h/2,h/2),m=(0,W.RandomRange)(0,2*Math.PI),U=(0,W.RandomRange)((1-M)*(1-M),1),L=Math.sqrt(U)*f,w=L*Math.cos(m),i=L*Math.sin(m);Q.isEmitterTransformNode?l.k.TransformCoordinatesFromFloatsToRef(w,O,i,Q.emitterWorldMatrix,C.position):(C.position.Yc(w,O,i),C.position.addInPlace(Q.emitterPosition))},this.output._storedValue=X}});class mC extends tX{constructor(Q){super(Q),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",NX.Particle),this.registerOutput("output",NX.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Q){super._build(Q);const X=this.particle.getConnectedValue(Q);X._isAnimationSheetEnabled=!0,X.spriteCellWidth=this.width,X.spriteCellHeight=this.height,X.startSpriteCellID=this.start,X.endSpriteCellID=this.end,X.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=X}serialize(){const Q=super.serialize();return Q.width=this.width,Q.height=this.height,Q.start=this.start,Q.end=this.end,Q.randomStartCell=this.randomStartCell,Q}_deserialize(Q){super._deserialize(Q),this.width=Q.width,this.height=Q.height,this.start=Q.start,this.end=Q.end,this.randomStartCell=Q.randomStartCell}}(0,o.c)([yX("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mC.prototype,"start",void 0),(0,o.c)([yX("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mC.prototype,"end",void 0),(0,o.c)([yX("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mC.prototype,"width",void 0),(0,o.c)([yX("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mC.prototype,"height",void 0),(0,o.c)([yX("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mC.prototype,"loop",void 0),(0,o.c)([yX("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mC.prototype,"randomStartCell",void 0),(0,O.g)("BABYLON.SetupSpriteSheetBlock",mC);class WC extends tX{constructor(Q){super(Q),this.reference=0,this.registerInput("value",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Q=>{switch(Q){case NX.Float:return NX.FloatGradient;case NX.Vector2:return NX.Vector2Gradient;case NX.Yj:return NX.Vector3Gradient;case NX.nk:return NX.Color4Gradient}return Q},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NX.Float|NX.Vector2|NX.Yj|NX.nk)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Q=>null}serialize(){const Q=super.serialize();return Q.reference=this.reference,Q}_deserialize(Q){super._deserialize(Q),this.reference=Q.reference}}(0,o.c)([yX("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],WC.prototype,"reference",void 0),(0,O.g)("BABYLON.ParticleGradientValueBlock",WC);(0,O.g)("BABYLON.ParticleGradientBlock",class extends tX{constructor(Q){super(Q),this._entryCount=1,this.registerInput("gradient",NX.Float,!0,1,0,1),this.registerInput("value0",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Q=>{switch(Q){case NX.FloatGradient:return NX.Float;case NX.Vector2Gradient:return NX.Vector2;case NX.Vector3Gradient:return NX.Yj;case NX.Color4Gradient:return NX.nk}return Q},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(NX.FloatGradient|NX.Vector2Gradient|NX.Vector3Gradient|NX.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Q){this._inputs[Q].onConnectionObservable.add((()=>{this._entryCount>Q||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),NX.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Q=[];for(let C=1;C<this._inputs.length;C++){var X;if(this._inputs[C].isConnected)Q.push(null===(X=this._inputs[C].connectedPoint)||void 0===X?void 0:X.ownerBlock)}Q.sort(((Q,X)=>Q.reference-X.reference)),this.output._storedFunction=X=>{const C=this.gradient.getConnectedValue(X);if(1===Q.length)return Q[0].value.getConnectedValue(X);let h=null;for(let M=Q.length-1;M>=0;M--){const O=Q[M];if(O.reference<=C){const Q=O.value.getConnectedValue(X);if(h){const M=h.value.getConnectedValue(X),m=h.reference,U=O.reference,L=Math.max(0,Math.min(1,(C-U)/(m-U)));switch(this.output.type){case NX.Float:return(0,W.Lerp)(Q,M,L);case NX.Vector2:return l.h.Lerp(Q,M,L);case NX.Yj:return l.k.Lerp(Q,M,L);case NX.nk:return f.d.Lerp(Q,M,L)}}return Q}h=O}return 0}}});(0,O.g)("BABYLON.ParticleConverterBlock",class extends tX{constructor(Q){super(Q),this.registerInput("color ",NX.nk,!0),this.registerInput("xyz ",NX.Yj,!0),this.registerInput("xy ",NX.Vector2,!0),this.registerInput("zw ",NX.Vector2,!0),this.registerInput("x ",NX.Float,!0),this.registerInput("y ",NX.Float,!0),this.registerInput("z ",NX.Float,!0),this.registerInput("w ",NX.Float,!0),this.registerOutput("color",NX.nk),this.registerOutput("xyz",NX.Yj),this.registerOutput("xy",NX.Vector2),this.registerOutput("zw",NX.Vector2),this.registerOutput("x",NX.Float),this.registerOutput("y",NX.Float),this.registerOutput("z",NX.Float),this.registerOutput("w",NX.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Q){return"color "===Q?"colorIn":"xyz "===Q?"xyzIn":"xy "===Q?"xyIn":"zw "===Q?"zwIn":"x "===Q?"xIn":"y "===Q?"yIn":"z "===Q?"zIn":"w "===Q?"wIn":Q}_outputRename(Q){switch(Q){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Q}}_build(Q){super._build(Q);const X=this.xIn,C=this.yIn,h=this.zIn,M=this.wIn,O=this.xyIn,m=this.zwIn,W=this.xyzIn,U=this.colorIn,L=this.colorOut,w=this.xyzOut,i=this.xyOut,a=this.zwOut,F=this.xOut,s=this.yOut,z=this.zOut,x=this.wOut,r=Q=>{if(U.isConnected)return U.getConnectedValue(Q);let l=0,L=0,w=0,i=0;if(X.isConnected&&(l=X.getConnectedValue(Q)),C.isConnected&&(L=C.getConnectedValue(Q)),h.isConnected&&(w=h.getConnectedValue(Q)),M.isConnected&&(i=M.getConnectedValue(Q)),O.isConnected){const X=O.getConnectedValue(Q);X&&(l=X.x,L=X.y)}if(m.isConnected){const X=m.getConnectedValue(Q);X&&(w=X.x,i=X.y)}if(W.isConnected){const X=W.getConnectedValue(Q);X&&(l=X.x,L=X.y,w=X.z)}return new f.d(l,L,w,i)};L._storedFunction=Q=>r(Q),w._storedFunction=Q=>{const X=r(Q);return new l.k(X.r,X.g,X.b)},i._storedFunction=Q=>{const X=r(Q);return new l.h(X.r,X.g)},a._storedFunction=Q=>{const X=r(Q);return new l.h(X.b,X.a)},F._storedFunction=Q=>r(Q).r,s._storedFunction=Q=>r(Q).g,z._storedFunction=Q=>r(Q).b,x._storedFunction=Q=>r(Q).a}}),function(Q){Q[Q.Cos=0]="Cos",Q[Q.Sin=1]="Sin",Q[Q.Abs=2]="Abs",Q[Q.Exp=3]="Exp",Q[Q.Exp2=4]="Exp2",Q[Q.Round=5]="Round",Q[Q.Floor=6]="Floor",Q[Q.Ceiling=7]="Ceiling",Q[Q.Sqrt=8]="Sqrt",Q[Q.Log=9]="Log",Q[Q.Tan=10]="Tan",Q[Q.ArcTan=11]="ArcTan",Q[Q.ArcCos=12]="ArcCos",Q[Q.ArcSin=13]="ArcSin",Q[Q.Sign=14]="Sign",Q[Q.Negate=15]="Negate",Q[Q.OneMinus=16]="OneMinus",Q[Q.Reciprocal=17]="Reciprocal",Q[Q.ToDegrees=18]="ToDegrees",Q[Q.ToRadians=19]="ToRadians",Q[Q.Fract=20]="Fract"}(pX||(pX={}));class UC extends tX{constructor(Q){super(Q),this.operation=pX.Cos,this.registerInput("input",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NX.Float|NX.Int|NX.Vector2|NX.Yj|NX.nk)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Q){super._build(Q);let X=null;switch(this.operation){case pX.Cos:X=Q=>Math.cos(Q);break;case pX.Sin:X=Q=>Math.sin(Q);break;case pX.Abs:X=Q=>Math.abs(Q);break;case pX.Exp:X=Q=>Math.exp(Q);break;case pX.Exp2:X=Q=>Math.pow(2,Q);break;case pX.Round:X=Q=>Math.round(Q);break;case pX.Floor:X=Q=>Math.floor(Q);break;case pX.Ceiling:X=Q=>Math.ceil(Q);break;case pX.Sqrt:X=Q=>Math.sqrt(Q);break;case pX.Log:X=Q=>Math.log(Q);break;case pX.Tan:X=Q=>Math.tan(Q);break;case pX.ArcTan:X=Q=>Math.atan(Q);break;case pX.ArcCos:X=Q=>Math.acos(Q);break;case pX.ArcSin:X=Q=>Math.asin(Q);break;case pX.Sign:X=Q=>Math.sign(Q);break;case pX.Negate:X=Q=>-Q;break;case pX.OneMinus:X=Q=>1-Q;break;case pX.Reciprocal:X=Q=>1/Q;break;case pX.ToRadians:X=Q=>Q*Math.PI/180;break;case pX.ToDegrees:X=Q=>180*Q/Math.PI;break;case pX.Fract:X=Q=>Q>=0?Q-Math.floor(Q):Q-Math.ceil(Q)}if(!X)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case NX.Int:case NX.Float:this.output._storedFunction=Q=>{const C=this.input.getConnectedValue(Q);return X(C)};break;case NX.Vector2:this.output._storedFunction=Q=>{const C=this.input.getConnectedValue(Q);return new l.h(X(C.x),X(C.y))};break;case NX.Yj:this.output._storedFunction=Q=>{const C=this.input.getConnectedValue(Q);return new l.k(X(C.x),X(C.y),X(C.z))};break;case NX.nk:this.output._storedFunction=Q=>{const C=this.input.getConnectedValue(Q);return new f.d(X(C.r),X(C.g),X(C.b),X(C.a))}}return this}serialize(){const Q=super.serialize();return Q.operation=this.operation,Q}_deserialize(Q){super._deserialize(Q),this.operation=Q.operation}}(0,o.c)([yX("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:pX.Cos},{label:"Sin",value:pX.Sin},{label:"Abs",value:pX.Abs},{label:"Exp",value:pX.Exp},{label:"Exp2",value:pX.Exp2},{label:"Round",value:pX.Round},{label:"Floor",value:pX.Floor},{label:"Ceiling",value:pX.Ceiling},{label:"Sqrt",value:pX.Sqrt},{label:"Log",value:pX.Log},{label:"Tan",value:pX.Tan},{label:"ArcTan",value:pX.ArcTan},{label:"ArcCos",value:pX.ArcCos},{label:"ArcSin",value:pX.ArcSin},{label:"Sign",value:pX.Sign},{label:"Negate",value:pX.Negate},{label:"OneMinus",value:pX.OneMinus},{label:"Reciprocal",value:pX.Reciprocal},{label:"ToDegrees",value:pX.ToDegrees},{label:"ToRadians",value:pX.ToRadians},{label:"Fract",value:pX.Fract}]})],UC.prototype,"operation",void 0),(0,O.g)("BABYLON.ParticleTrigonometryBlock",UC);var LC,wC=C(12761);class iC extends tX{constructor(Q){super(Q),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(NX.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(NX.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(NX.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(NX.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(NX.System),this._inputs[0].excludedConnectionPointTypes.push(NX.Particle),this._inputs[0].excludedConnectionPointTypes.push(NX.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Q){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const X=Q=>{const X=this.input.getConnectedValue(Q);if(this.log.length>=this.stackSize)return X;if(null===X||void 0===X)return this.log.push(["null",""]),X;switch(this.input.type){case NX.Vector2:this.log.push([(0,wC.h)(X,4),X.toString()]);break;case NX.Yj:this.log.push([(0,wC.j)(X,4),X.toString()]);break;case NX.nk:this.log.push([`{R: ${X.r.toFixed(4)} G: ${X.g.toFixed(4)} B: ${X.b.toFixed(4)} A: ${X.a.toFixed(4)}}`,X.toString()]);break;default:this.log.push([X.toString(),X.toString()])}return X};this.output.isConnected?this.output._storedFunction=X:this.output._storedValue=X(Q)}serialize(){const Q=super.serialize();return Q.stackSize=this.stackSize,Q}_deserialize(Q){super._deserialize(Q),this.stackSize=Q.stackSize}}(0,o.c)([yX("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],iC.prototype,"stackSize",void 0),(0,O.g)("BABYLON.ParticleDebugBlock",iC);(0,O.g)("BABYLON.ParticleElbowBlock",class extends tX{constructor(Q){super(Q),this.registerInput("input",NX.AutoDetect),this.registerOutput("output",NX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Q){super._build(Q);const X=this._outputs[0],C=this._inputs[0];X._storedFunction=Q=>C.getConnectedValue(Q)}});(0,O.g)("BABYLON.ParticleTeleportInBlock",class extends tX{get endpoints(){return this._endpoints}constructor(Q){super(Q),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",NX.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Q){if(this.getClassName()===Q)return!0;for(const X of this.endpoints)if(X.isAnAncestorOfType(Q))return!0;return!1}isAnAncestorOf(Q){for(const X of this.endpoints){if(X===Q)return!0;if(X.isAnAncestorOf(Q))return!0}return!1}attachToEndpoint(Q){Q.detach(),this._endpoints.push(Q),Q._entryPoint=this,Q._outputs[0]._typeConnectionSource=this._inputs[0],Q._tempEntryPointUniqueId=null,Q.name="> "+this.name}detachFromEndpoint(Q){const X=this._endpoints.indexOf(Q);-1!==X&&(this._endpoints.splice(X,1),Q._outputs[0]._typeConnectionSource=null,Q._entryPoint=null)}_build(){for(const Q of this._endpoints)Q.output._storedFunction=Q=>this.input.getConnectedValue(Q)}});(0,O.g)("BABYLON.ParticleTeleportOutBlock",class extends tX{constructor(Q){super(Q),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",NX.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Q){this.entryPoint&&this.entryPoint.build(Q)}clone(){const Q=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Q),Q}serialize(){var Q;const X=super.serialize();return X.entryPoint=(null===(Q=this.entryPoint)||void 0===Q?void 0:Q.uniqueId)??"",X}_deserialize(Q){super._deserialize(Q),this._tempEntryPointUniqueId=Q.entryPoint}}),function(Q){Q[Q.Equal=0]="Equal",Q[Q.NotEqual=1]="NotEqual",Q[Q.LessThan=2]="LessThan",Q[Q.GreaterThan=3]="GreaterThan",Q[Q.LessOrEqual=4]="LessOrEqual",Q[Q.GreaterOrEqual=5]="GreaterOrEqual",Q[Q.Xor=6]="Xor",Q[Q.Or=7]="Or",Q[Q.And=8]="And"}(LC||(LC={}));class aC extends tX{constructor(Q){super(Q),this.test=LC.Equal,this.epsilon=0,this.registerInput("left",NX.Float),this.registerInput("right",NX.Float,!0,0),this.registerInput("ifTrue",NX.AutoDetect,!0,1),this.registerInput("ifFalse",NX.AutoDetect,!0,0),this.registerOutput("output",NX.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=NX.Float,this._inputs[0].acceptedConnectionPointTypes.push(NX.Int),this._inputs[1].acceptedConnectionPointTypes.push(NX.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Q=Q=>{const X=this.left.getConnectedValue(Q),C=this.right.getConnectedValue(Q);let l=!1;switch(this.test){case LC.Equal:l=(0,W.WithinEpsilon)(X,C,this.epsilon);break;case LC.NotEqual:l=!(0,W.WithinEpsilon)(X,C,this.epsilon);break;case LC.LessThan:l=X<C+this.epsilon;break;case LC.GreaterThan:l=X>C-this.epsilon;break;case LC.LessOrEqual:l=X<=C+this.epsilon;break;case LC.GreaterOrEqual:l=X>=C-this.epsilon;break;case LC.Xor:l=!!X&&!C||!X&&!!C;break;case LC.Or:l=!!X||!!C;break;case LC.And:l=!!X&&!!C}return l};this.output._storedFunction=X=>Q(X)?this.ifTrue.getConnectedValue(X):this.ifFalse.getConnectedValue(X)}serialize(){const Q=super.serialize();return Q.test=this.test,Q.epsilon=this.epsilon,Q}_deserialize(Q){super._deserialize(Q),this.test=Q.test,void 0!==Q.epsilon&&(this.epsilon=Q.epsilon)}}(0,o.c)([yX("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:LC.Equal},{label:"NotEqual",value:LC.NotEqual},{label:"LessThan",value:LC.LessThan},{label:"GreaterThan",value:LC.GreaterThan},{label:"LessOrEqual",value:LC.LessOrEqual},{label:"GreaterOrEqual",value:LC.GreaterOrEqual},{label:"Xor",value:LC.Xor},{label:"Or",value:LC.Or},{label:"And",value:LC.And}]})],aC.prototype,"test",void 0),(0,o.c)([yX("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aC.prototype,"epsilon",void 0),(0,O.g)("BABYLON.ParticleConditionBlock",aC);class FC extends tX{constructor(Q){super(Q),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",NX.Particle),this.registerInput("condition",NX.Float,!0,0),this.registerInput("system",NX.System),this.registerOutput("output",NX.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Q){this._triggerCount=0;const X=this.input.getConnectedValue(Q),C={process:C=>{if(Q.particleContext=C,Q.systemContext=X,0!==this.condition.getConnectedValue(Q)&&(0===this.limit||this._triggerCount<this.limit)){const l=(new Date).getTime();if(this._previousOne&&l-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=l;const h=this.system.getConnectedValue(Q);if(h){const l=DX(h,Q.ld,C.position);l.bk.addOnce((()=>{this._triggerCount--})),X.bk.addOnce((()=>{l.dispose()}))}}},previousItem:null,nextItem:null};X._updateQueueStart?BQ(C,X._updateQueueStart):X._updateQueueStart=C,this.output._storedValue=X}serialize(){const Q=super.serialize();return Q.limit=this.limit,Q.delay=this.delay,Q}_deserialize(Q){super._deserialize(Q),void 0!==Q.limit&&(this.limit=Q.limit),void 0!==Q.delay&&(this.delay=Q.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,o.c)([yX("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FC.prototype,"limit",void 0),(0,o.c)([yX("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FC.prototype,"delay",void 0),(0,O.g)("BABYLON.ParticleTriggerBlock",FC);C(12764),C(12771),C(12779),C(12830)},12816:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneFragment",M="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12784:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneFragmentDeclaration",M="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12846:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneVertex",M="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12839:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneVertexDeclaration",M="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12824:(Q,X,C)=>{"use strict";var l=C(568);const h="fogFragment",M="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12808:(Q,X,C)=>{"use strict";var l=C(568);const h="fogFragmentDeclaration",M="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12851:(Q,X,C)=>{"use strict";var l=C(568);const h="fogVertex",M="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12842:(Q,X,C)=>{"use strict";var l=C(568);const h="fogVertexDeclaration",M="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12797:(Q,X,C)=>{"use strict";var l=C(568);const h="helperFunctions",M="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12792:(Q,X,C)=>{"use strict";var l=C(568);const h="imageProcessingDeclaration",M="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12804:(Q,X,C)=>{"use strict";var l=C(568);const h="imageProcessingFunctions",M="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12795:(Q,X,C)=>{"use strict";var l=C(568);const h="logDepthDeclaration",M="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12818:(Q,X,C)=>{"use strict";var l=C(568);const h="logDepthFragment",M="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12855:(Q,X,C)=>{"use strict";var l=C(568);const h="logDepthVertex",M="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";l.b.IncludesShadersStoreWGSL[h]||(l.b.IncludesShadersStoreWGSL[h]=M)},12779:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{particlesPixelShaderWGSL:()=>f});var l=C(568);C(12784),C(12792),C(12795),C(12797),C(12804),C(12808),C(12816),C(12818),C(12824);const h="particlesPixelShader",M="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";l.b.ShadersStoreWGSL[h]||(l.b.ShadersStoreWGSL[h]=M);const f={name:h,shader:M}},12830:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{particlesVertexShaderWGSL:()=>f});var l=C(568);C(12839),C(12842),C(12795),C(12846),C(12851),C(12855);const h="particlesVertexShader",M="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";l.b.ShadersStoreWGSL[h]||(l.b.ShadersStoreWGSL[h]=M);const f={name:h,shader:M}},12719:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneFragment",M="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12766:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneFragmentDeclaration",M="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12732:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneVertex",M="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12775:(Q,X,C)=>{"use strict";var l=C(568);const h="clipPlaneVertexDeclaration",M="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12727:(Q,X,C)=>{"use strict";var l=C(568);const h="fogFragment",M="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12712:(Q,X,C)=>{"use strict";var l=C(568);const h="fogFragmentDeclaration",M="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12737:(Q,X,C)=>{"use strict";var l=C(568);const h="fogVertex",M="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12730:(Q,X,C)=>{"use strict";var l=C(568);const h="fogVertexDeclaration",M="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12698:(Q,X,C)=>{"use strict";var l=C(568);const h="helperFunctions",M="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12685:(Q,X,C)=>{"use strict";var l=C(568);const h="imageProcessingDeclaration",M="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12705:(Q,X,C)=>{"use strict";var l=C(568);const h="imageProcessingFunctions",M="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12692:(Q,X,C)=>{"use strict";var l=C(568);const h="logDepthDeclaration",M="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12722:(Q,X,C)=>{"use strict";var l=C(568);const h="logDepthFragment",M="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12744:(Q,X,C)=>{"use strict";var l=C(568);const h="logDepthVertex",M="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";l.b.IncludesShadersStore[h]||(l.b.IncludesShadersStore[h]=M)},12764:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{particlesPixelShader:()=>f});var l=C(568);C(12766),C(12685),C(12692),C(12698),C(12705),C(12712),C(12719),C(12722),C(12727);const h="particlesPixelShader",M="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";l.b.ShadersStore[h]||(l.b.ShadersStore[h]=M);const f={name:h,shader:M}},12771:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{particlesVertexShader:()=>f});var l=C(568);C(12775),C(12730),C(12692),C(12732),C(12737),C(12744);const h="particlesVertexShader",M="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";l.b.ShadersStore[h]||(l.b.ShadersStore[h]=M);const f={name:h,shader:M}},13129:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{FlowGraphGLTFDataProvider:()=>M});var l=C(13092),h=C(13063);class M extends l.c{constructor(Q){var X,C;super();const l=Q.glTF,M=(null===(X=l.animations)||void 0===X?void 0:X.map((Q=>Q._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",h.d,M);const f=(null===(C=l.nodes)||void 0===C?void 0:C.map((Q=>Q._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",h.d,f)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13014:(Q,X,C)=>{"use strict";C.d(X,{b:()=>s,f:()=>a,j:()=>i,m:()=>F});var l=C(668),h=C(12145),M=C(702),f=C(13017);const O=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class m{constructor(Q,X){this._gltf=Q,this._infoTree=X}convert(Q){let X,C=this._gltf,l=this._infoTree;if(!Q.startsWith("/"))throw new Error("Path must start with a /");const h=Q.split("/");if(h.shift(),h[h.length-1].includes(".length")){const Q=h[h.length-1].split(".");h.pop(),h.push(...Q)}let M=!1;for(const m of h){const h="length"===m;if(h&&!l.__array__)throw new Error(`Path ${Q} is invalid`);if(l.__ignoreObjectTree__&&(M=!0),l.__array__&&!h)l=l.__array__;else if(l=l[m],!l)throw new Error(`Path ${Q} is invalid`);if(!M)if(void 0===C){if(!O.find((X=>X.regex.test(Q))))throw new Error(`Path ${Q} is invalid`)}else if(!h){var f;C=null===(f=C)||void 0===f?void 0:f[m]}(l.__target__||h)&&(X=C)}return{object:X,info:l}}}function W(Q,X,C,l){const h=U(Q,X);return l?h[C][l]:h[C]}function U(Q,X,C){var l,M;return null===(l=Q._data)||void 0===l||null===(M=l[(null===C||void 0===C?void 0:C.fillMode)??h.c.MATERIAL_TriangleFillMode])||void 0===M?void 0:M.babylonMaterial}function L(Q,X){return{offset:{componentsCount:2,type:"Vector2",get:(C,h,M)=>{const f=W(C,M,Q,X);return new l.h(null===f||void 0===f?void 0:f.uOffset,null===f||void 0===f?void 0:f.vOffset)},getTarget:U,set:(C,l,h,M)=>{const f=W(l,M,Q,X);f.uOffset=C.x,f.vOffset=C.y},getPropertyName:[()=>`${Q}${X?"."+X:""}.uOffset`,()=>`${Q}${X?"."+X:""}.vOffset`]},rotation:{type:"number",get:(C,l,h)=>{var M;return null===(M=W(C,h,Q,X))||void 0===M?void 0:M.wAng},getTarget:U,set:(C,l,h,M)=>W(l,M,Q,X).wAng=C,getPropertyName:[()=>`${Q}${X?"."+X:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(C,h,M)=>{const f=W(C,M,Q,X);return new l.h(null===f||void 0===f?void 0:f.uScale,null===f||void 0===f?void 0:f.vScale)},getTarget:U,set:(C,l,h,M)=>{const f=W(l,M,Q,X);f.uScale=C.x,f.vScale=C.y},getPropertyName:[()=>`${Q}${X?"."+X:""}.uScale`,()=>`${Q}${X?"."+X:""}.vScale`]}}}const w={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Q=>{var X,C;return new l.h((null===(X=Q._babylonCamera)||void 0===X?void 0:X.orthoLeft)??0,(null===(C=Q._babylonCamera)||void 0===C?void 0:C.orthoRight)??0)},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.orthoLeft=Q.x,X._babylonCamera.orthoRight=Q.y)},getTarget:Q=>Q,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Q=>{var X,C;return new l.h((null===(X=Q._babylonCamera)||void 0===X?void 0:X.orthoBottom)??0,(null===(C=Q._babylonCamera)||void 0===C?void 0:C.orthoTop)??0)},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.orthoBottom=Q.x,X._babylonCamera.orthoTop=Q.y)},getTarget:Q=>Q,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Q=>{var X;return null===(X=Q._babylonCamera)||void 0===X?void 0:X.maxZ},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=Q)},getTarget:Q=>Q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Q=>{var X;return null===(X=Q._babylonCamera)||void 0===X?void 0:X.Rj},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.Rj=Q)},getTarget:Q=>Q,getPropertyName:[()=>"Rj"]}},perspective:{aspectRatio:{type:"number",get:Q=>{var X;return null===(X=Q._babylonCamera)||void 0===X?void 0:X.getEngine().getAspectRatio(Q._babylonCamera)},getTarget:Q=>Q,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Q=>{var X;return null===(X=Q._babylonCamera)||void 0===X?void 0:X.fov},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.fov=Q)},getTarget:Q=>Q,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Q=>{var X;return null===(X=Q._babylonCamera)||void 0===X?void 0:X.maxZ},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=Q)},getTarget:Q=>Q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Q=>{var X;return null===(X=Q._babylonCamera)||void 0===X?void 0:X.Rj},set:(Q,X)=>{X._babylonCamera&&(X._babylonCamera.Rj=Q)},getTarget:Q=>Q,getPropertyName:[()=>"Rj"]}}}},nodes:{length:{type:"number",get:Q=>Q.length,getTarget:Q=>Q.map((Q=>Q._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Yj",get:Q=>{var X;return null===(X=Q._babylonTransformNode)||void 0===X?void 0:X.position},set:(Q,X)=>{var C;return null===(C=X._babylonTransformNode)||void 0===C?void 0:C.position.p(Q)},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Q=>{var X;return null===(X=Q._babylonTransformNode)||void 0===X?void 0:X.rotationQuaternion},set:(Q,X)=>{var C,l;return null===(C=X._babylonTransformNode)||void 0===C||null===(l=C.rotationQuaternion)||void 0===l?void 0:l.p(Q)},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Yj",get:Q=>{var X;return null===(X=Q._babylonTransformNode)||void 0===X?void 0:X._c},set:(Q,X)=>{var C;return null===(C=X._babylonTransformNode)||void 0===C?void 0:C._c.p(Q)},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"_c"]},weights:{length:{type:"number",get:Q=>Q._numMorphTargets,getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Q,X)=>{var C,l;return void 0!==X?null===(C=Q._primitiveBabylonMeshes)||void 0===C||null===(l=C[0].morphTargetManager)||void 0===l?void 0:l.getTarget(X).influence:void 0},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Q,X)=>[0],getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Q=>{var X,C,h;return l.b.Compose(null===(X=Q._babylonTransformNode)||void 0===X?void 0:X._c,null===(C=Q._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(h=Q._babylonTransformNode)||void 0===h?void 0:h.position)},getTarget:Q=>Q._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Q=>{var X,C,h,M;const f=l.b.Identity();let O=Q.parent;for(;O&&O.parent;)O=O.parent;const m=(null===(X=Q._babylonTransformNode)||void 0===X?void 0:X.position._isDirty)||(null===(C=Q._babylonTransformNode)||void 0===C||null===(h=C.rotationQuaternion)||void 0===h?void 0:h._isDirty)||(null===(M=Q._babylonTransformNode)||void 0===M?void 0:M._c._isDirty);if(O){var W;const X=null===(W=O._babylonTransformNode)||void 0===W?void 0:W.Vj(!0).invert();var U,L;if(X)null===(U=Q._babylonTransformNode)||void 0===U||null===(L=U.Vj(m))||void 0===L||L.multiplyToRef(X,f)}else Q._babylonTransformNode&&f.p(Q._babylonTransformNode.Vj(m));return f},getTarget:Q=>Q._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Q=>{var X,C;return null===(X=Q._babylonTransformNode)||void 0===X||null===(C=X.getChildren((Q=>Q instanceof f.c),!0)[0])||void 0===C?void 0:C.cb},getTarget:Q=>{var X;return null===(X=Q._babylonTransformNode)||void 0===X?void 0:X.getChildren((Q=>Q instanceof f.c),!0)[0]},set:(Q,X)=>{if(X._babylonTransformNode){const C=X._babylonTransformNode.getChildren((Q=>Q instanceof f.c),!0)[0];C&&(C.cb=Q)}}},color:{type:"mk",get:Q=>{var X,C;return null===(X=Q._babylonTransformNode)||void 0===X||null===(C=X.getChildren((Q=>Q instanceof f.c),!0)[0])||void 0===C?void 0:C.eb},getTarget:Q=>{var X;return null===(X=Q._babylonTransformNode)||void 0===X?void 0:X.getChildren((Q=>Q instanceof f.c),!0)[0]},set:(Q,X)=>{if(X._babylonTransformNode){const C=X._babylonTransformNode.getChildren((Q=>Q instanceof f.c),!0)[0];C&&(C.eb=Q)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"mk",get:(Q,X,C)=>U(Q,X,C).emissiveColor,set:(Q,X,C,l)=>U(X,C,l).emissiveColor.p(Q),getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:L("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Q,X,C)=>{var l;return null===(l=W(Q,C,"bumpTexture"))||void 0===l?void 0:l.level},set:(Q,X,C,l)=>{const h=W(X,l,"bumpTexture");h&&(h.level=Q)},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:L("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Q,X,C)=>U(Q,X,C).ambientTextureStrength,set:(Q,X,C,l)=>{const h=U(X,C,l);h&&(h.ambientTextureStrength=Q)},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:L("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"nk",get:(Q,X,C)=>{const l=U(Q,X,C);return M.d.FromColor3(l.albedoColor,l.alpha)},set:(Q,X,C,l)=>{const h=U(X,C,l);h.albedoColor.set(Q.r,Q.g,Q.b),h.alpha=Q.a},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:L("albedoTexture")}},metallicFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).metallic,set:(Q,X,C,l)=>{const h=U(X,C,l);h&&(h.metallic=Q)},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).roughness,set:(Q,X,C,l)=>{const h=U(X,C,l);h&&(h.roughness=Q)},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:L("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Q,X,C)=>U(Q,X,C).anisotropy.cb,set:(Q,X,C,l)=>{U(X,C,l).anisotropy.cb=Q},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Q,X,C)=>U(Q,X,C).anisotropy.angle,set:(Q,X,C,l)=>{U(X,C,l).anisotropy.angle=Q},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:L("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).clearCoat.cb,set:(Q,X,C,l)=>{U(X,C,l).clearCoat.cb=Q},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).clearCoat.roughness,set:(Q,X,C,l)=>{U(X,C,l).clearCoat.roughness=Q},getTarget:(Q,X,C)=>U(Q,X,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:L("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Q,X,C)=>{var l;return null===(l=U(Q,X,C).clearCoat.bumpTexture)||void 0===l?void 0:l.level},getTarget:U,set:(Q,X,C,l)=>U(X,C,l).clearCoat.bumpTexture.level=Q},extensions:{KHR_texture_transform:L("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:L("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Q,X,C)=>U(Q,X,C).subSurface.dispersion,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).subSurface.dispersion=Q}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Q,X,C)=>U(Q,X,C).emissiveIntensity,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).emissiveIntensity=Q}},KHR_materials_ior:{ior:{type:"number",get:(Q,X,C)=>U(Q,X,C).indexOfRefraction,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).indexOfRefraction=Q}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).iridescence.cb,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).iridescence.cb=Q},iridescenceIor:{type:"number",get:(Q,X,C)=>U(Q,X,C).iridescence.indexOfRefraction,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).iridescence.indexOfRefraction=Q},iridescenceTexture:{extensions:{KHR_texture_transform:L("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Q,X,C)=>U(Q,X,C).iridescence.maximumThickness,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).iridescence.maximumThickness=Q},iridescenceThicknessMinimum:{type:"number",get:(Q,X,C)=>U(Q,X,C).iridescence.minimumThickness,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).iridescence.minimumThickness=Q},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:L("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"mk",get:(Q,X,C)=>U(Q,X,C).sheen.color,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).sheen.color.p(Q)},sheenColorTexture:{extensions:{KHR_texture_transform:L("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).sheen.cb,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).sheen.cb=Q},sheenRoughnessTexture:{extensions:{KHR_texture_transform:L("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).metallicF0Factor,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).metallicF0Factor=Q,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"mk",get:(Q,X,C)=>U(Q,X,C).metallicReflectanceColor,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).metallicReflectanceColor.p(Q),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:L("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:L("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).subSurface.refractionIntensity,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).subSurface.refractionIntensity=Q,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:L("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).subSurface.translucencyIntensity,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).subSurface.translucencyIntensity=Q},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:L("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"mk",get:(Q,X,C)=>U(Q,X,C).subSurface.translucencyColor,getTarget:U,set:(Q,X,C,l)=>{var h;return Q&&(null===(h=U(X,C,l).subSurface.translucencyColor)||void 0===h?void 0:h.p(Q))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:L("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"mk",get:(Q,X,C)=>U(Q,X,C).subSurface.tintColor,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).subSurface.tintColor.p(Q)},attenuationDistance:{type:"number",get:(Q,X,C)=>U(Q,X,C).subSurface.tintColorAtDistance,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).subSurface.tintColorAtDistance=Q},thicknessFactor:{type:"number",get:(Q,X,C)=>U(Q,X,C).subSurface.maximumThickness,getTarget:U,set:(Q,X,C,l)=>U(X,C,l).subSurface.maximumThickness=Q},thicknessTexture:{extensions:{KHR_texture_transform:L("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Q=>Q.length,getTarget:Q=>Q.map((Q=>Q._babylonLight)),getPropertyName:[Q=>"length"]},__array__:{__target__:!0,color:{type:"mk",get:Q=>{var X;return null===(X=Q._babylonLight)||void 0===X?void 0:X.eb},set:(Q,X)=>{var C;return null===(C=X._babylonLight)||void 0===C?void 0:C.eb.p(Q)},getTarget:Q=>Q._babylonLight,getPropertyName:[Q=>"diffuse"]},cb:{type:"number",get:Q=>{var X;return null===(X=Q._babylonLight)||void 0===X?void 0:X.cb},set:(Q,X)=>X._babylonLight?X._babylonLight.cb=Q:void 0,getTarget:Q=>Q._babylonLight,getPropertyName:[Q=>"intensity"]},range:{type:"number",get:Q=>{var X;return null===(X=Q._babylonLight)||void 0===X?void 0:X.range},set:(Q,X)=>X._babylonLight?X._babylonLight.range=Q:void 0,getTarget:Q=>Q._babylonLight,getPropertyName:[Q=>"range"]},spot:{innerConeAngle:{type:"number",get:Q=>{var X;return null===(X=Q._babylonLight)||void 0===X?void 0:X.innerAngle},set:(Q,X)=>X._babylonLight?X._babylonLight.innerAngle=Q:void 0,getTarget:Q=>Q._babylonLight,getPropertyName:[Q=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Q=>{var X;return null===(X=Q._babylonLight)||void 0===X?void 0:X.angle},set:(Q,X)=>X._babylonLight?X._babylonLight.angle=Q:void 0,getTarget:Q=>Q._babylonLight,getPropertyName:[Q=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Q=>Q.length,getTarget:Q=>Q.map((Q=>Q._babylonLight)),getPropertyName:[Q=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Q=>Q.length,getTarget:Q=>Q.map((Q=>Q._babylonTexture)),getPropertyName:[Q=>"length"]},__array__:{__target__:!0,cb:{type:"number",get:Q=>{var X;return null===(X=Q._babylonTexture)||void 0===X?void 0:X.level},set:(Q,X)=>{X._babylonTexture&&(X._babylonTexture.level=Q)},getTarget:Q=>Q._babylonTexture},rotation:{type:"Quaternion",get:Q=>{var X;return Q._babylonTexture&&l.c.FromRotationMatrix(null===(X=Q._babylonTexture)||void 0===X?void 0:X.getReflectionTextureMatrix())},set:(Q,X)=>{var C;X._babylonTexture&&(null!==(C=X._babylonTexture.va())&&void 0!==C&&C.useRightHandedSystem||(Q=l.c.Inverse(Q)),l.b.FromQuaternionToRef(Q,X._babylonTexture.getReflectionTextureMatrix()))},getTarget:Q=>Q._babylonTexture}}}}},animations:{length:{type:"number",get:Q=>Q.length,getTarget:Q=>Q.map((Q=>Q._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Q=>Q.length,getTarget:Q=>Q.map((Q=>{var X;return null===(X=Q.primitives[0]._instanceData)||void 0===X?void 0:X.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function i(Q){return new m(Q,w)}function a(Q){const X=Q.split("/").map((Q=>Q.replace(/{}/g,"__array__")));let C=w;for(const l of X)l&&(C=C[l]);if(C&&C.type&&C.get)return C}function F(Q,X){const C=Q.split("/").map((Q=>Q.replace(/{}/g,"__array__")));let l=w;for(const h of C)h&&(l=l[h]);l&&l.type&&l.get&&(l.interpolation=X)}function s(Q,X){const C=Q.split("/").map((Q=>Q.replace(/{}/g,"__array__")));let l=w;for(const h of C)if(h){if(!l[h]){if("?"===h){l.__ignoreObjectTree__=!0;continue}l[h]={},"__array__"===h&&(l[h].__target__=!0)}l=l[h]}Object.assign(l,X)}},13025:(Q,X,C)=>{"use strict";C.r(X),C.d(X,{AnimationPropertyInfo:()=>W,TransformNodeAnimationPropertyInfo:()=>U,WeightAnimationPropertyInfo:()=>L,getQuaternion:()=>O,getVector3:()=>f,getWeights:()=>m});var l=C(12229),h=C(668),M=C(13014);function f(Q,X,C,l){return h.k.Wj(X,C).scaleInPlace(l)}function O(Q,X,C,l){return h.c.Wj(X,C).scaleInPlace(l)}function m(Q,X,C,l){const h=new Array(Q._numMorphTargets);for(let M=0;M<h.length;M++)h[M]=X[C++]*l;return h}class W{constructor(Q,X,C,l){this.type=Q,this.name=X,this.getValue=C,this.getStride=l}_buildAnimation(Q,X,C){const h=new l.e(Q,this.name,X,this.type);return h.setKeys(C),h}}class U extends W{buildAnimations(Q,X,C,l){const h=[];return h.push({babylonAnimatable:Q._babylonTransformNode,babylonAnimation:this._buildAnimation(X,C,l)}),h}}class L extends W{buildAnimations(Q,X,C,h){const M=[];if(Q._numMorphTargets)for(let f=0;f<Q._numMorphTargets;f++){const O=new l.e(`${X}_${f}`,this.name,C,this.type);if(O.setKeys(h.map((Q=>({frame:Q.frame,inTangent:Q.inTangent?Q.inTangent[f]:void 0,value:Q.value[f],outTangent:Q.outTangent?Q.outTangent[f]:void 0,interpolation:Q.interpolation})))),Q._primitiveBabylonMeshes)for(const X of Q._primitiveBabylonMeshes)if(X.morphTargetManager){const Q=X.morphTargetManager.getTarget(f),C=O.clone();Q.animations.push(C),M.push({babylonAnimatable:Q,babylonAnimation:C})}}return M}}(0,M.m)("/nodes/{}/translation",[new U(l.e.ANIMATIONTYPE_VECTOR3,"position",f,(()=>3))]),(0,M.m)("/nodes/{}/rotation",[new U(l.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",O,(()=>4))]),(0,M.m)("/nodes/{}/scale",[new U(l.e.ANIMATIONTYPE_VECTOR3,"_c",f,(()=>3))]),(0,M.m)("/nodes/{}/weights",[new L(l.e.ANIMATIONTYPE_FLOAT,"influence",m,(Q=>Q._numMorphTargets))])},12974:(Q,X,C)=>{"use strict";class l{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Q,X)=>{this._resolve=Q,this._reject=X}))}}var h=C(668),M=C(702),f=C(487),O=C(642),m=C(12978),W=C(12994),U=C(482),L=C(12142),w=C(12229),i=C(12231),a=C(524),F=C(501),s=C(504);class z{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Q){this._useTextureToStoreBoneMatrices=Q,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Q){this._animationPropertiesOverride=Q}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Q,X,C){this.name=Q,this.id=X,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=h.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new U.e,this.bones=[],this._scene=C||a.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const l=this._scene.getEngine().getCaps();this._canUseTextureForBones=l.textureFloat&&l.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Q=>!Q.getParent()))}getTransformMatrices(Q){if(this.needInitialSkinMatrix){if(!Q)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Q._bonesTransformMatrices||this.prepare(!0),Q._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Q){return this.needInitialSkinMatrix&&Q._transformMatrixTexture?Q._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(Q){let X=`Name: ${this.name}, nBones: ${this.bones.length}`;if(X+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Q){X+=", Ranges: {";let Q=!0;for(const C in this._ranges)Q&&(X+=", ",Q=!1),X+=C;X+="}"}return X}getBoneIndexByName(Q){for(let X=0,C=this.bones.length;X<C;X++)if(this.bones[X].name===Q)return X;return-1}createAnimationRange(Q,X,C){if(!this._ranges[Q]){this._ranges[Q]=new i.e(Q,X,C);for(let l=0,h=this.bones.length;l<h;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].createRange(Q,X,C)}}deleteAnimationRange(Q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,l=this.bones.length;C<l;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(Q,X);this._ranges[Q]=null}getAnimationRange(Q){return this._ranges[Q]||null}getAnimationRanges(){const Q=[];let X;for(X in this._ranges)Q.push(this._ranges[X]);return Q}copyAnimationRange(Q,X){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[X]||!Q.getAnimationRange(X))return!1;let l=!0;const h=this._getHighestAnimationFrame()+1,M={},f=Q.bones;let O,m;for(m=0,O=f.length;m<O;m++)M[f[m].name]=f[m];this.bones.length!==f.length&&(F.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${f.length}`),l=!1);const W=C&&this.dimensionsAtRest&&Q.dimensionsAtRest?this.dimensionsAtRest.divide(Q.dimensionsAtRest):null;for(m=0,O=this.bones.length;m<O;m++){const Q=this.bones[m].name,f=M[Q];f?l=l&&this.bones[m].copyAnimationRange(f,X,h,C,W):(F.c.Warn("copyAnimationRange: not same rig, missing source bone "+Q),l=!1)}const U=Q.getAnimationRange(X);return U&&(this._ranges[X]=new i.e(X,U.from+h,U.to+h)),l}returnToRest(){for(const Q of this.bones)-1!==Q._index&&Q.returnToRest()}_getHighestAnimationFrame(){let Q=0;for(let X=0,C=this.bones.length;X<C;X++)if(this.bones[X].animations[0]){const C=this.bones[X].animations[0].getHighestFrame();Q<C&&(Q=C)}return Q}beginAnimation(Q,X,C,l){const h=this.getAnimationRange(Q);return h?this._scene.beginAnimation(this,h.from,h.to,X,C,l):null}static MakeAnimationAdditive(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const l=Q.getAnimationRange(C);if(!l)return null;const h=Q._scene.getAllAnimatablesByTarget(Q);let M=null;for(let O=0;O<h.length;O++){const Q=h[O];if(Q.fromFrame===(null===l||void 0===l?void 0:l.from)&&Q.toFrame===(null===l||void 0===l?void 0:l.to)){M=Q;break}}const f=Q.getAnimatables();for(let O=0;O<f.length;O++){const Q=f[O].animations;if(Q)for(let l=0;l<Q.length;l++)w.e.MakeAnimationAdditive(Q[l],X,C)}return M&&(M.isAdditive=!0),Q}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Q){this._meshesWithPoseMatrix.push(Q)}_unregisterMeshWithPoseMatrix(Q){const X=this._meshesWithPoseMatrix.indexOf(Q);X>-1&&this._meshesWithPoseMatrix.splice(X,1)}_computeTransformMatrices(Q,X){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const l=this.bones[C];l._childUpdateId++;const h=l.getParent();if(h?l.getLocalMatrix().multiplyToRef(h.getFinalMatrix(),l.getFinalMatrix()):X?l.getLocalMatrix().multiplyToRef(X,l.getFinalMatrix()):l.getFinalMatrix().p(l.getLocalMatrix()),-1!==l._index){const X=null===l._index?C:l._index;l.getAbsoluteInverseBindMatrix().multiplyToArray(l.getFinalMatrix(),Q,16*X)}}this._identity.copyToArray(Q,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Q=this.va().getRenderId();if(this._currentRenderId===Q)return;this._currentRenderId=Q}if(this._numBonesWithLinkedTransformNode>0)for(const Q of this.bones)if(Q._linkedTransformNode){const X=Q._linkedTransformNode;Q.position=X.position,X.rotationQuaternion?Q.rotationQuaternion=X.rotationQuaternion:Q.rotation=X.rotation,Q._c=X._c}if(this.needInitialSkinMatrix)for(const Q of this._meshesWithPoseMatrix){const X=Q.getPoseMatrix();let C=this._isDirty;if(Q._bonesTransformMatrices&&Q._bonesTransformMatrices.length===16*(this.bones.length+1)||(Q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==Q){this._synchronizedWithMesh=Q;for(const Q of this.bones)if(!Q.getParent()){Q.getBindMatrix().multiplyToRef(X,h.e.Matrix[1]),Q._updateAbsoluteBindMatrices(h.e.Matrix[1])}if(this.isUsingTextureForMatrices){const X=4*(this.bones.length+1);Q._transformMatrixTexture&&Q._transformMatrixTexture.getSize().width===X||(Q._transformMatrixTexture&&Q._transformMatrixTexture.dispose(),Q._transformMatrixTexture=L.b.CreateRGBATexture(Q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Q._bonesTransformMatrices,X),this.isUsingTextureForMatrices&&Q._transformMatrixTexture&&Q._transformMatrixTexture.update(Q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=L.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Q=0;Q<this.bones.length;Q++)this._animatables.push(this.bones[Q])}return this._animatables}clone(Q,X){const C=new z(Q,X||Q,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){const Q=this.bones[l];let X=null;const h=Q.getParent();if(h){const Q=this.bones.indexOf(h);X=C.bones[Q]}const M=new W.d(Q.name,C,X,Q.getBindMatrix().clone(),Q.getRestMatrix().clone());M._index=Q._index,Q._linkedTransformNode&&M.linkTransformNode(Q._linkedTransformNode),s.c.DeepCopy(Q.animations,M.animations)}if(this._ranges){C._ranges={};for(const Q in this._ranges){const X=this._ranges[Q];X&&(C._ranges[Q]=X.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const X of this.bones)for(const C of X.animations)C.enableBlending=!0,C.blendingSpeed=Q}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const Q=this._parentContainer.skeletons.indexOf(this);Q>-1&&this._parentContainer.skeletons.splice(Q,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Q={};Q.name=this.name,Q.id=this.id,this.dimensionsAtRest&&(Q.dimensionsAtRest=this.dimensionsAtRest.dk()),Q.bones=[],Q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var X;const l=this.bones[C],h=l.getParent(),M={parentBoneIndex:h?this.bones.indexOf(h):-1,index:l.getIndex(),name:l.name,id:l.id,matrix:l.getBindMatrix().dk(),rest:l.getRestMatrix().dk(),linkedTransformNodeId:null===(X=l.getTransformNode())||void 0===X?void 0:X.id};Q.bones.push(M),l.length&&(M.length=l.length),l.metadata&&(M.metadata=l.metadata),l.animations&&l.animations.length>0&&(M.animation=l.animations[0].serialize()),Q.ranges=[];for(const X in this._ranges){const C=this._ranges[X];if(!C)continue;const l={};l.name=X,l.from=C.from,l.to=C.to,Q.ranges.push(l)}}return Q}static Parse(Q,X){const C=new z(Q.name,Q.id,X);let l;for(Q.dimensionsAtRest&&(C.dimensionsAtRest=h.k.Wj(Q.dimensionsAtRest)),C.needInitialSkinMatrix=Q.needInitialSkinMatrix,l=0;l<Q.bones.length;l++){const X=Q.bones[l],M=Q.bones[l].index;let f=null;X.parentBoneIndex>-1&&(f=C.bones[X.parentBoneIndex]);const O=X.rest?h.b.Wj(X.rest):null,m=new W.d(X.name,C,f,h.b.Wj(X.matrix),O,null,M);void 0!==X.id&&null!==X.id&&(m.id=X.id),X.length&&(m.length=X.length),X.metadata&&(m.metadata=X.metadata),X.animation&&m.animations.push(w.e.Parse(X.animation)),void 0!==X.linkedTransformNodeId&&null!==X.linkedTransformNodeId&&(C._hasWaitingData=!0,m._waitingTransformNodeId=X.linkedTransformNodeId)}if(Q.ranges)for(l=0;l<Q.ranges.length;l++){const X=Q.ranges[l];C.createAnimationRange(X.name,X.from,X.to)}return C}computeAbsoluteMatrices(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Q)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Q)}getPoseMatrix(){let Q=null;return this._meshesWithPoseMatrix.length>0&&(Q=this._meshesWithPoseMatrix[0].getPoseMatrix()),Q}sortBones(){const Q=[],X=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,Q,X);this.bones=Q}_sortBones(Q,X,C){if(C[Q])return;C[Q]=!0;const l=this.bones[Q];if(!l)return;void 0===l._index&&(l._index=Q);const h=l.getParent();h&&this._sortBones(this.bones.indexOf(h),X,C),X.push(l)}setCurrentPoseAsRest(){for(const Q of this.bones)Q.setCurrentPoseAsRest()}}var x=C(837),r=C(12157),P=C(2397),j=C(806),v=C(722),Z=C(783),g=C(800),S=C(477),e=C(12237),k=C(663),R=C(12939);class H{set areUpdatesFrozen(Q){Q?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new k.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Q||(Q=a.b.LastCreatedScene),this._scene=Q,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Q=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Q.canUseGLVertexID&&Q.textureFloat&&Q.maxVertexTextureImageUnits>0&&Q.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return H.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?H.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Q){this._numMaxInfluencers!==Q&&(this._numMaxInfluencers=Q,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Q){this._useTextureToStoreTargets!==Q&&(this._useTextureToStoreTargets=Q,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Q;return H.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Q=this._scene)&&void 0!==Q&&Q.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Q){return this._activeTargets.data[Q]}getTarget(Q){return this._targets[Q]}getTargetByName(Q){for(const X of this._targets)if(X.name===Q)return X;return null}addTarget(Q){this._targets.push(Q),this._targetInfluenceChangedObservers.push(Q.onInfluenceChanged.add((Q=>{this.areUpdatesFrozen&&Q&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Q)}))),this._targetDataLayoutChangedObservers.push(Q._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Q){const X=this._targets.indexOf(Q);X>=0&&(this._targets.splice(X,1),Q.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(X,1)[0]),Q._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(X,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Q)}_bind(Q){Q.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Q.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Q.setTexture("morphTargets",this._targetStoreTexture),Q.setInt("morphTargetCount",this.numInfluencers)}clone(){const Q=new H(this._scene);for(const X of this._targets)Q.addTarget(X.clone());return Q.enablePositionMorphing=this.enablePositionMorphing,Q.enableNormalMorphing=this.enableNormalMorphing,Q.enableTangentMorphing=this.enableTangentMorphing,Q.enableUVMorphing=this.enableUVMorphing,Q.enableUV2Morphing=this.enableUV2Morphing,Q.enableColorMorphing=this.enableColorMorphing,Q}serialize(){const Q={};Q.id=this.uniqueId,Q.targets=[];for(const X of this._targets)Q.targets.push(X.serialize());return Q}_syncActiveTargets(){let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const X=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||X!==C)&&(this._mustSynchronize=!1,this.synchronize());let l=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let h=-1;for(const M of this._targets)if(h++,0!==M.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=H.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(M),this._morphTargetTextureIndices[l]=h,this._tempInfluences[l++]=M.influence}this._morphTargetTextureIndices.length!==l&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,l)),this._influences&&this._influences.length===l||(this._influences=new Float32Array(l));for(let M=0;M<l;M++)this._influences[M]=this._tempInfluences[M];if(Q&&this._scene)for(const M of this._scene.meshes)M.morphTargetManager===this&&(C?M._markSubMeshesAsAttributesDirty():M._syncGeometryWithMorphTargetManager())}synchronize(){var Q;if(!this._scene||this.areUpdatesFrozen)return;const X=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Q=this._targetStoreTexture)||void 0===Q||Q.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>X.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const Q=C.vertexCount;if(0===this._vertexCount)this._vertexCount=Q;else if(this._vertexCount!==Q)return void F.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${C.name}": ${Q}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Q=X.getCaps().maxTextureSize;this._textureWidth>Q&&(this._textureHeight=Math.ceil(this._textureWidth/Q),this._textureWidth=Q);const C=this._targets.length,l=new Float32Array(C*this._textureWidth*this._textureHeight*4);let h=0;for(let X=0;X<C;X++){const Q=this._targets[X],C=Q.getPositions(),M=Q.getNormals(),f=Q.getUVs(),O=Q.getTangents(),m=Q.getUV2s(),W=Q.getColors();h=X*this._textureWidth*this._textureHeight*4;for(let X=0;X<this._vertexCount;X++)this._supportsPositions&&C&&(l[h]=C[3*X],l[h+1]=C[3*X+1],l[h+2]=C[3*X+2],h+=4),this._supportsNormals&&M&&(l[h]=M[3*X],l[h+1]=M[3*X+1],l[h+2]=M[3*X+2],h+=4),this._supportsUVs&&f&&(l[h]=f[2*X],l[h+1]=f[2*X+1],h+=4),this._supportsTangents&&O&&(l[h]=O[3*X],l[h+1]=O[3*X+1],l[h+2]=O[3*X+2],h+=4),this._supportsUV2s&&m&&(l[h]=m[2*X],l[h+1]=m[2*X+1],h+=4),this._supportsColors&&W&&(l[h]=W[4*X],l[h+1]=W[4*X+1],l[h+2]=W[4*X+2],l[h+3]=W[4*X+3],h+=4)}this._targetStoreTexture=R.d.CreateRGBATexture(l,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Q=this._parentContainer.morphTargetManagers.indexOf(this);Q>-1&&this._parentContainer.morphTargetManagers.splice(Q,1),this._parentContainer=null}for(const Q of this._targets)this._scene.stopAnimation(Q)}}static Parse(Q,X){const C=new H(X);for(const l of Q.targets)C.addTarget(e.c.Parse(l,X));return C}}H.EnableTextureStorage=!0,H.MaxActiveMorphTargetsInVertexAttributeMode=8,H.ConstantTargetCountForTextureMode=0;var o=C(13001),T=C(526),Y=C(749);const J=new Map,K=J;function N(Q,X,C){q(Q)&&F.c.Warn(`Extension with the name '${Q}' already exists`),J.set(Q,{isGLTFExtension:X,factory:C})}function q(Q){return J.delete(Q)}var n=C(13014),c=C(12279),E=C(730);class B{static Get(Q,X,C){if(!X||void 0==C||!X[C])throw new Error(`${Q}: Failed to find index (${C})`);return X[C]}static TryGet(Q,X){return Q&&void 0!=X&&Q[X]?Q[X]:null}static Assign(Q){if(Q)for(let X=0;X<Q.length;X++)Q[X].index=X}}function G(Q){if(Q.min&&Q.max){const X=Q.min,C=Q.max,l=h.e.Yj[0].Yc(X[0],X[1],X[2]),M=h.e.Yj[1].Yc(C[0],C[1],C[2]);if(Q.normalized&&5126!==Q.componentType){let X=1;switch(Q.componentType){case 5120:X=127;break;case 5121:X=255;break;case 5122:X=32767;break;case 5123:X=65535}const C=1/X;l.scaleInPlace(C),M.scaleInPlace(C)}return new Y.d(l,M)}return null}class b{static RegisterExtension(Q,X){N(Q,!1,X)}static UnregisterExtension(Q){return q(Q)}get Hk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Q){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Q}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Q=>Q.dispose&&Q.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Q,X,C,l,h,M){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=X,this._assetContainer=C,this._loadData(l);let M=null;if(Q){const X={};if(this._gltf.nodes)for(const Q of this._gltf.nodes)Q.name&&(X[Q.name]=Q.index);M=(Q instanceof Array?Q:[Q]).map((Q=>{const C=X[Q];if(void 0===C)throw new Error(`Failed to find node '${Q}'`);return C}))}return await this._loadAsync(h,f,M,(()=>({meshes:this._getMeshes(),tk:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Q,X,C,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Q,this._loadData(X),await this._loadAsync(C,h,null,(()=>{}))}async _loadAsync(Q,X,C,l){return await Promise.resolve().then((async()=>{this._rootUrl=Q,this._uniqueRootUrl=!Q.startsWith("file:")&&X?Q:`${Q}${Date.now()}/`,this._fileName=X,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const h=`${o.k[o.k.LOADING]} => ${o.k[o.k.READY]}`,M=`${o.k[o.k.LOADING]} => ${o.k[o.k.COMPLETE]}`;this._parent._startPerformanceCounter(h),this._parent._startPerformanceCounter(M),this._parent._setState(o.k.LOADING),this._extensionsOnLoading();const O=new Array;if(!this.parent.loadOnlyMaterials)if(C)O.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.ld||this._gltf.scenes&&this._gltf.scenes[0]){const Q=B.Get("/scene",this._gltf.scenes,this._gltf.ld||0);O.push(this.loadSceneAsync(`/scenes/${Q.index}`,Q))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Q=0;Q<this._gltf.materials.length;++Q){const X=this._gltf.materials[Q],C="/materials/"+Q,l=x.e.TriangleFillMode;O.push(this._loadMaterialAsync(C,X,null,l,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&O.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&O.push(this._compileShadowGeneratorsAsync());const m=Promise.all(O).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.bc(!0);for(const Q of this._babylonScene.materials){const X=Q;void 0!==X.maxSimultaneousLights&&(X.maxSimultaneousLights=Math.max(X.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(o.k.READY),this._skipStartAnimationStep||this._startAnimations(),l()}));return await m.then((Q=>(this._parent._endPerformanceCounter(h),f.i.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(M),this._parent._setState(o.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Q=>{this._parent.onErrorObservable.notifyObservers(Q),this._parent.onErrorObservable.clear(),this.dispose()}))})),Q)))})).catch((Q=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Q),this._parent.onErrorObservable.clear(),this.dispose()),Q}))}_loadData(Q){if(this._gltf=Q.json,this._setupData(),Q.bin){const X=this._gltf.buffers;if(X&&X[0]&&!X[0].uri){const C=X[0];(C.byteLength<Q.bin.byteLength-3||C.byteLength>Q.bin.byteLength)&&F.c.Warn(`Binary buffer length (${C.byteLength}) from JSON does not match chunk length (${Q.bin.byteLength})`),this._bin=Q.bin}else F.c.Warn("Unexpected BIN chunk")}}_setupData(){if(B.Assign(this._gltf.accessors),B.Assign(this._gltf.animations),B.Assign(this._gltf.buffers),B.Assign(this._gltf.bufferViews),B.Assign(this._gltf.cameras),B.Assign(this._gltf.images),B.Assign(this._gltf.materials),B.Assign(this._gltf.meshes),B.Assign(this._gltf.nodes),B.Assign(this._gltf.samplers),B.Assign(this._gltf.scenes),B.Assign(this._gltf.skins),B.Assign(this._gltf.textures),this._gltf.nodes){const Q={};for(const C of this._gltf.nodes)if(C.children)for(const X of C.children)Q[X]=C.index;const X=this._createRootNode();for(const C of this._gltf.nodes){const l=Q[C.index];C.parent=void 0===l?X:this._gltf.nodes[l]}}}async _loadExtensionsAsync(){const Q=[];if(K.forEach(((X,C)=>{var l;!1===(null===(l=this.parent.extensionOptions[C])||void 0===l?void 0:l.enabled)?X.isGLTFExtension&&this.isExtensionUsed(C)&&F.c.Warn(`Extension ${C} is used but has been explicitly disabled.`):X.isGLTFExtension&&!this.isExtensionUsed(C)||Q.push((async()=>{const Q=await X.factory(this);return Q.name!==C&&F.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Q.name} !== ${C}`),this._parent.onExtensionLoadedObservable.notifyObservers(Q),Q})())})),this._extensions.push(...await Promise.all(Q)),this._extensions.sort(((Q,X)=>(Q.order||Number.MAX_VALUE)-(X.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((Q=>Q.name===C&&Q.enabled))){var X;if(!1===(null===(X=this.parent.extensionOptions[C])||void 0===X?void 0:X.enabled))throw new Error(`Required extension ${C} is disabled`);throw new Error(`Required extension ${C} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new S.c("__root__",this._babylonScene);this._rootBabylonMesh=Q,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.bc(!1);const X={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case o.j.AUTO:this._babylonScene.useRightHandedSystem||(X.rotation=[0,1,0,0],X.scale=[1,1,-1],b._LoadTransform(X,this._rootBabylonMesh));break;case o.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Q),X}loadSceneAsync(Q,X){const C=this._extensionsLoadSceneAsync(Q,X);if(C)return C;const l=new Array;if(this.logOpen(`${Q} ${X.name||""}`),X.nodes)for(const h of X.nodes){const X=B.Get(`${Q}/nodes/${h}`,this._gltf.nodes,h);l.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(Q=>{Q.parent=this._rootBabylonMesh})))}for(const h of this._postSceneLoadActions)h();return l.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(l).then((()=>{}))}_forEachPrimitive(Q,X){if(Q._primitiveBabylonMeshes)for(const C of Q._primitiveBabylonMeshes)X(C)}_getGeometries(){const Q=[],X=this._gltf.nodes;if(X)for(const C of X)this._forEachPrimitive(C,(X=>{const C=X.ik;C&&-1===Q.indexOf(C)&&Q.push(C)}));return Q}_getMeshes(){const Q=[];this._rootBabylonMesh instanceof g.d&&Q.push(this._rootBabylonMesh);const X=this._gltf.nodes;if(X)for(const C of X)this._forEachPrimitive(C,(X=>{Q.push(X)}));return Q}_getTransformNodes(){const Q=[],X=this._gltf.nodes;if(X)for(const C of X)C._babylonTransformNode&&"Gk"===C._babylonTransformNode.getClassName()&&Q.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&Q.push(C._babylonTransformNodeForSkin);return Q}_getSkeletons(){const Q=[],X=this._gltf.skins;if(X)for(const C of X)C._data&&Q.push(C._data.babylonSkeleton);return Q}_getAnimationGroups(){const Q=[],X=this._gltf.animations;if(X)for(const C of X)C._babylonAnimationGroup&&Q.push(C._babylonAnimationGroup);return Q}_startAnimations(){switch(this._parent.animationStartMode){case o.g.NONE:break;case o.g.FIRST:{const Q=this._getAnimationGroups();0!==Q.length&&Q[0].start(!0);break}case o.g.ALL:{const Q=this._getAnimationGroups();for(const X of Q)X.start(!0);break}default:return void F.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadNodeAsync(Q,X,C);if(l)return l;if(X._babylonTransformNode)throw new Error(`${Q}: Invalid recursive node hierarchy`);const h=new Array;this.logOpen(`${Q} ${X.name||""}`);const M=l=>{if(b.AddPointerMetadata(l,Q),b._LoadTransform(X,l),void 0!=X.camera){const C=B.Get(`${Q}/camera`,this._gltf.cameras,X.camera);h.push(this.loadCameraAsync(`/cameras/${C.index}`,C,(Q=>{Q.parent=l,this._babylonScene.useRightHandedSystem||(l._c.x=-1)})))}if(X.children)for(const C of X.children){const X=B.Get(`${Q}/children/${C}`,this._gltf.nodes,C);h.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(Q=>{Q.parent=l})))}C(l)},f=void 0!=X.mesh,O=this._parent.loadSkins&&void 0!=X.skin;if(!f||O){const Q=X.name||`node${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new j.e(Q,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==X.mesh?X._babylonTransformNode=C:X._babylonTransformNodeForSkin=C,M(C)}if(f)if(O){const C=B.Get(`${Q}/mesh`,this._gltf.meshes,X.mesh);h.push(this._loadMeshAsync(`/meshes/${C.index}`,X,C,(C=>{const l=X._babylonTransformNodeForSkin;C.metadata=(0,c.d)(l.metadata,C.metadata||{});const M=B.Get(`${Q}/skin`,this._gltf.skins,X.skin);h.push(this._loadSkinAsync(`/skins/${M.index}`,X,M,(Q=>{this._forEachPrimitive(X,(X=>{X.skeleton=Q})),this._postSceneLoadActions.push((()=>{if(void 0!=M.skeleton){const Q=B.Get(`/skins/${M.index}/skeleton`,this._gltf.nodes,M.skeleton).parent;X.index===Q.index?C.parent=l.parent:C.parent=Q._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:l,skinnedNode:C})}))})))})))}else{const C=B.Get(`${Q}/mesh`,this._gltf.meshes,X.mesh);h.push(this._loadMeshAsync(`/meshes/${C.index}`,X,C,M))}return this.logClose(),Promise.all(h).then((()=>(this._forEachPrimitive(X,(Q=>{const X=Q;!X.isAnInstance&&X.ik&&X.ik.useBoundingInfoFromGeometry?Q.Ea():Q.refreshBoundingInfo(!0,!0)})),X._babylonTransformNode)))}_loadMeshAsync(Q,X,C,l){const h=C.primitives;if(!h||!h.length)throw new Error(`${Q}: Primitives are missing`);void 0==h[0].index&&B.Assign(h);const M=new Array;this.logOpen(`${Q} ${C.name||""}`);const f=X.name||`node${X.index}`;if(1===h.length){const l=C.primitives[0];M.push(this._loadMeshPrimitiveAsync(`${Q}/primitives/${l.index}`,f,X,C,l,(Q=>{X._babylonTransformNode=Q,X._primitiveBabylonMeshes=[Q]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,X._babylonTransformNode=new j.e(f,this._babylonScene),X._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._primitiveBabylonMeshes=[];for(const l of h)M.push(this._loadMeshPrimitiveAsync(`${Q}/primitives/${l.index}`,`${f}_primitive${l.index}`,X,C,l,(Q=>{Q.parent=X._babylonTransformNode,X._primitiveBabylonMeshes.push(Q)})))}return l(X._babylonTransformNode),this.logClose(),Promise.all(M).then((()=>X._babylonTransformNode))}_loadMeshPrimitiveAsync(Q,X,C,l,h,M){const f=this._extensionsLoadMeshPrimitiveAsync(Q,X,C,l,h,M);if(f)return f;this.logOpen(`${Q}`);const O=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!l.primitives[0].targets;let m,W;if(O&&h._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,m=h._instanceData.babylonSourceMesh.createInstance(X),m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W=h._instanceData.promise;else{const M=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new S.c(X,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.sideOrientation=this._babylonScene.useRightHandedSystem?x.e.CounterClockWiseSideOrientation:x.e.ClockWiseSideOrientation,this._createMorphTargets(Q,C,l,h,f),M.push(this._loadVertexDataAsync(Q,h,f).then((async X=>await this._loadMorphTargetsAsync(Q,h,f,X).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,X.Ca(f),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const U=b._GetDrawMode(Q,h.mode);if(void 0==h.material){let Q=this._defaultBabylonMaterialData[U];Q||(Q=this._createDefaultMaterial("__GLTFLoader._default",U),this._parent.onMaterialLoadedObservable.notifyObservers(Q),this._defaultBabylonMaterialData[U]=Q),f.material=Q}else if(!this.parent.skipMaterials){const X=B.Get(`${Q}/material`,this._gltf.materials,h.material);M.push(this._loadMaterialAsync(`/materials/${X.index}`,X,f,U,(Q=>{f.material=Q})))}W=Promise.all(M),O&&(h._instanceData={babylonSourceMesh:f,promise:W}),m=f}return b.AddPointerMetadata(m,Q),this._parent.onMeshLoadedObservable.notifyObservers(m),M(m),this.logClose(),W.then((()=>m))}_loadVertexDataAsync(Q,X,C){const l=this._extensionsLoadVertexDataAsync(Q,X,C);if(l)return l;const h=X.attributes;if(!h)throw new Error(`${Q}: Attributes are missing`);const M=new Array,f=new Z.e(C.name,this._babylonScene);if(void 0==X.indices)C.isUnIndexed=!0;else{const C=B.Get(`${Q}/indices`,this._gltf.accessors,X.indices);M.push(this._loadIndicesAccessorAsync(`/accessors/${C.index}`,C).then((Q=>{f.setIndices(Q)})))}const O=(X,l,O)=>{if(void 0==h[X])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(l)&&C._delayInfo.push(l);const m=B.Get(`${Q}/attributes/${X}`,this._gltf.accessors,h[X]);M.push(this._loadVertexAccessorAsync(`/accessors/${m.index}`,m,l).then((Q=>{if(Q.getKind()===v.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const Q=G(m);Q&&(f._boundingInfo=Q,f.useBoundingInfoFromGeometry=!0)}f.setVerticesBuffer(Q,m.count)}))),l==v.g.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),O&&O(m)};return O("POSITION",v.g.PositionKind),O("NORMAL",v.g.NormalKind),O("TANGENT",v.g.TangentKind),O("TEXCOORD_0",v.g.UVKind),O("TEXCOORD_1",v.g.UV2Kind),O("TEXCOORD_2",v.g.UV3Kind),O("TEXCOORD_3",v.g.UV4Kind),O("TEXCOORD_4",v.g.UV5Kind),O("TEXCOORD_5",v.g.UV6Kind),O("JOINTS_0",v.g.MatricesIndicesKind),O("WEIGHTS_0",v.g.MatricesWeightsKind),O("JOINTS_1",v.g.MatricesIndicesExtraKind),O("WEIGHTS_1",v.g.MatricesWeightsExtraKind),O("COLOR_0",v.g.ColorKind,(Q=>{"VEC4"===Q.type&&(C.hasVertexAlpha=!0)})),Promise.all(M).then((()=>f))}_createMorphTargets(Q,X,C,l,h){if(!l.targets||!this._parent.loadMorphTargets)return;if(void 0==X._numMorphTargets)X._numMorphTargets=l.targets.length;else if(l.targets.length!==X._numMorphTargets)throw new Error(`${Q}: Primitives do not have the same number of targets`);const M=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,h.morphTargetManager=new H(this._babylonScene),h.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.morphTargetManager.areUpdatesFrozen=!0;for(let f=0;f<l.targets.length;f++){const Q=X.weights?X.weights[f]:C.weights?C.weights[f]:0,l=M?M[f]:`morphTarget${f}`;h.morphTargetManager.addTarget(new e.c(l,Q,h.va()))}}_loadMorphTargetsAsync(Q,X,C,l){if(!X.targets||!this._parent.loadMorphTargets)return Promise.resolve();const h=new Array,M=C.morphTargetManager;for(let f=0;f<M.numTargets;f++){const C=M.getTarget(f);h.push(this._loadMorphTargetVertexDataAsync(`${Q}/targets/${f}`,l,X.targets[f],C))}return Promise.all(h).then((()=>{M.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Q,X,C,l){const h=new Array,M=(l,M,f)=>{if(void 0==C[l])return;const O=X.getVertexBuffer(M);if(!O)return;const m=B.Get(`${Q}/${l}`,this._gltf.accessors,C[l]);h.push(this._loadFloatAccessorAsync(`/accessors/${m.index}`,m).then((Q=>{f(O,Q)})))};return M("POSITION",v.g.PositionKind,((Q,X)=>{const C=new Float32Array(X.length);Q.forEach(X.length,((Q,l)=>{C[l]=X[l]+Q})),l.setPositions(C)})),M("NORMAL",v.g.NormalKind,((Q,X)=>{const C=new Float32Array(X.length);Q.forEach(C.length,((Q,l)=>{C[l]=X[l]+Q})),l.setNormals(C)})),M("TANGENT",v.g.TangentKind,((Q,X)=>{const C=new Float32Array(X.length/3*4);let h=0;Q.forEach(X.length/3*4,((Q,l)=>{(l+1)%4!==0&&(C[h]=X[h]+Q,h++)})),l.setTangents(C)})),M("TEXCOORD_0",v.g.UVKind,((Q,X)=>{const C=new Float32Array(X.length);Q.forEach(X.length,((Q,l)=>{C[l]=X[l]+Q})),l.setUVs(C)})),M("TEXCOORD_1",v.g.UV2Kind,((Q,X)=>{const C=new Float32Array(X.length);Q.forEach(X.length,((Q,l)=>{C[l]=X[l]+Q})),l.setUV2s(C)})),M("COLOR_0",v.g.ColorKind,((X,C)=>{let h=null;const M=X.getSize();if(3===M){h=new Float32Array(C.length/3*4),X.forEach(C.length,((Q,X)=>{const l=Math.floor(X/3),M=X%3;h[4*l+M]=C[3*l+M]+Q}));for(let Q=0;Q<C.length/3;++Q)h[4*Q+3]=1}else{if(4!==M)throw new Error(`${Q}: Invalid number of components (${M}) for COLOR_0 attribute`);h=new Float32Array(C.length),X.forEach(C.length,((Q,X)=>{h[X]=C[X]+Q}))}l.setColors(h)})),await Promise.all(h).then((()=>{}))}static _LoadTransform(Q,X){if(void 0!=Q.skin)return;let C=h.k.Zero(),l=h.c.Identity(),M=h.k.One();if(Q.matrix){h.b.Wj(Q.matrix).decompose(M,l,C)}else Q.translation&&(C=h.k.Wj(Q.translation)),Q.rotation&&(l=h.c.Wj(Q.rotation)),Q.scale&&(M=h.k.Wj(Q.scale));X.position=C,X.rotationQuaternion=l,X._c=M}_loadSkinAsync(Q,X,C,l){if(!this._parent.loadSkins)return Promise.resolve();const h=this._extensionsLoadSkinAsync(Q,X,C);if(h)return h;if(C._data)return l(C._data.babylonSkeleton),C._data.promise;const M=`skeleton${C.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new z(C.name||M,M,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Q,C,f);const O=this._loadSkinInverseBindMatricesDataAsync(Q,C).then((Q=>{this._updateBoneMatrices(f,Q)}));return C._data={babylonSkeleton:f,promise:O},l(f),O}_loadBones(Q,X,C){if(void 0==X.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode(`${Q}/joints`,X.joints);if(C)if(void 0===X.skeleton)X.skeleton=C.index;else{const l=(Q,X)=>{for(;X.parent;X=X.parent)if(X.parent===Q)return!0;return!1},h=B.Get(`${Q}/skeleton`,this._gltf.nodes,X.skeleton);h===C||l(h,C)||(F.c.Warn(`${Q}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),X.skeleton=C.index)}else F.c.Warn(`${Q}: Failed to find common root`)}const l={};for(const h of X.joints){const M=B.Get(`${Q}/joints/${h}`,this._gltf.nodes,h);this._loadBone(M,X,C,l)}}_findSkeletonRootNode(Q,X){if(0===X.length)return null;const C={};for(const h of X){const X=[];let l=B.Get(`${Q}/${h}`,this._gltf.nodes,h);for(;-1!==l.index;)X.unshift(l),l=l.parent;C[h]=X}let l=null;for(let h=0;;++h){let Q=C[X[0]];if(h>=Q.length)return l;const M=Q[h];for(let f=1;f<X.length;++f)if(Q=C[X[f]],h>=Q.length||M!==Q[h])return l;l=M}}_loadBone(Q,X,C,l){Q._isJoint=!0;let h=l[Q.index];if(h)return h;let M=null;Q.index!==X.skeleton&&(Q.parent&&-1!==Q.parent.index?M=this._loadBone(Q.parent,X,C,l):void 0!==X.skeleton&&F.c.Warn(`/skins/${X.index}/skeleton: Skeleton node is not a common root`));const f=X.joints.indexOf(Q.index);return h=new W.d(Q.name||`joint${Q.index}`,C,M,this._getNodeMatrix(Q),null,null,f),l[Q.index]=h,this._postSceneLoadActions.push((()=>{h.linkTransformNode(Q._babylonTransformNode)})),h}_loadSkinInverseBindMatricesDataAsync(Q,X){if(void 0==X.inverseBindMatrices)return Promise.resolve(null);const C=B.Get(`${Q}/inverseBindMatrices`,this._gltf.accessors,X.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)}_updateBoneMatrices(Q,X){for(const C of Q.bones){const Q=h.b.Identity(),l=C._index;X&&-1!==l&&(h.b.FromArrayToRef(X,16*l,Q),Q.invertToRef(Q));const M=C.getParent();M&&Q.multiplyToRef(M.getAbsoluteInverseBindMatrix(),Q),C.jk(Q,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Q){return Q.matrix?h.b.Wj(Q.matrix):h.b.Compose(Q.scale?h.k.Wj(Q.scale):h.k.One(),Q.rotation?h.c.Wj(Q.rotation):h.c.Identity(),Q.translation?h.k.Wj(Q.translation):h.k.Zero())}loadCameraAsync(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadCameraAsync(Q,X,C);if(l)return l;const M=new Array;this.logOpen(`${Q} ${X.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new m.e(X.name||`camera${X.index}`,h.k.Zero(),this._babylonScene,!1);switch(f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonCamera=f,f.setTarget(new h.k(0,0,-1)),X.type){case"perspective":{const C=X.perspective;if(!C)throw new Error(`${Q}: Camera perspective properties are missing`);f.fov=C.yfov,f.Rj=C.znear,f.maxZ=C.zfar||0;break}case"orthographic":if(!X.orthographic)throw new Error(`${Q}: Camera orthographic properties are missing`);f.mode=O.d.ORTHOGRAPHIC_CAMERA,f.orthoLeft=-X.orthographic.xmag,f.orthoRight=X.orthographic.xmag,f.orthoBottom=-X.orthographic.ymag,f.orthoTop=X.orthographic.ymag,f.Rj=X.orthographic.znear,f.maxZ=X.orthographic.zfar;break;default:throw new Error(`${Q}: Invalid camera type (${X.type})`)}return b.AddPointerMetadata(f,Q),this._parent.onCameraLoadedObservable.notifyObservers(f),C(f),this.logClose(),Promise.all(M).then((()=>f))}_loadAnimationsAsync(){const Q=this._gltf.animations;if(!Q)return Promise.resolve();const X=new Array;for(let C=0;C<Q.length;C++){const l=Q[C];X.push(this.loadAnimationAsync(`/animations/${l.index}`,l).then((Q=>{0===Q.targetedAnimations.length&&Q.dispose()})))}return Promise.all(X).then((()=>{}))}loadAnimationAsync(Q,X){const l=this._extensionsLoadAnimationAsync(Q,X);return l||C.e(62).then(C.bind(C,14242)).then((C=>{let{AnimationGroup:l}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new l(X.name||`animation${X.index}`,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonAnimationGroup=h;const M=new Array;B.Assign(X.channels),B.Assign(X.samplers);for(const f of X.channels)M.push(this._loadAnimationChannelAsync(`${Q}/channels/${f.index}`,Q,X,f,((Q,X)=>{Q.animations=Q.animations||[],Q.animations.push(X),h.addTargetedAnimation(X,Q)})));return Promise.all(M).then((()=>(h.normalize(0),h)))}))}async _loadAnimationChannelAsync(Q,X,l,h,M){const f=this._extensionsLoadAnimationChannelAsync(Q,X,l,h,M);if(f)return await f;if(void 0==h.target.node)return await Promise.resolve();const O=B.Get(`${Q}/target/node`,this._gltf.nodes,h.target.node),m=h.target.path,W="weights"===m;if(W&&!O._numMorphTargets||!W&&!O._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!W&&!O._isJoint)return await Promise.resolve();let U;switch(await Promise.resolve().then(C.bind(C,13025)),m){case"translation":var L;U=null===(L=(0,n.f)("/nodes/{}/translation"))||void 0===L?void 0:L.interpolation;break;case"rotation":var w;U=null===(w=(0,n.f)("/nodes/{}/rotation"))||void 0===w?void 0:w.interpolation;break;case"scale":var i;U=null===(i=(0,n.f)("/nodes/{}/scale"))||void 0===i?void 0:i.interpolation;break;case"weights":var a;U=null===(a=(0,n.f)("/nodes/{}/weights"))||void 0===a?void 0:a.interpolation;break;default:throw new Error(`${Q}/target/path: Invalid value (${h.target.path})`)}if(!U)throw new Error(`${Q}/target/path: Could not find interpolation properties for target path (${h.target.path})`);const F={object:O,info:U};return await this._loadAnimationChannelFromTargetInfoAsync(Q,X,l,h,F,M)}_loadAnimationChannelFromTargetInfoAsync(Q,X,C,l,h,M){const f=this.parent.targetFps,O=1/f,m=B.Get(`${Q}/sampler`,C.samplers,l.sampler);return this._loadAnimationSamplerAsync(`${X}/samplers/${l.sampler}`,m).then((Q=>{let X=0;const m=h.object,W=h.info;for(const h of W){const W=h.getStride(m),U=Q.input,L=Q.output,w=new Array(U.length);let i=0;switch(Q.interpolation){case"STEP":for(let Q=0;Q<U.length;Q++){const X=h.getValue(m,L,i,1);i+=W,w[Q]={frame:U[Q]*f,value:X,interpolation:1}}break;case"CUBICSPLINE":for(let Q=0;Q<U.length;Q++){const X=h.getValue(m,L,i,O);i+=W;const C=h.getValue(m,L,i,1);i+=W;const l=h.getValue(m,L,i,O);i+=W,w[Q]={frame:U[Q]*f,inTangent:X,value:C,outTangent:l}}break;case"LINEAR":for(let Q=0;Q<U.length;Q++){const X=h.getValue(m,L,i,1);i+=W,w[Q]={frame:U[Q]*f,value:X}}}if(i>0){const Q=`${C.name||`animation${C.index}`}_channel${l.index}_${X}`,O=h.buildAnimations(m,Q,f,w);for(const C of O)X++,M(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Q,X){if(X._data)return X._data;const C=X.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Q}/interpolation: Invalid value (${X.interpolation})`)}const l=B.Get(`${Q}/input`,this._gltf.accessors,X.input),h=B.Get(`${Q}/output`,this._gltf.accessors,X.output);return X._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${l.index}`,l),this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)]).then((Q=>{let[X,l]=Q;return{input:X,interpolation:C,output:l}})),X._data}loadBufferAsync(Q,X,C,l){const h=this._extensionsLoadBufferAsync(Q,X,C,l);if(h)return h;if(!X._data)if(X.uri)X._data=this.loadUriAsync(`${Q}/uri`,X,X.uri);else{if(!this._bin)throw new Error(`${Q}: Uri is missing or the binary glTF is missing its binary chunk`);X._data=this._bin.readAsync(0,X.byteLength)}return X._data.then((X=>{try{return new Uint8Array(X.buffer,X.byteOffset+C,l)}catch(h){throw new Error(`${Q}: ${h.message}`)}}))}loadBufferViewAsync(Q,X){const C=this._extensionsLoadBufferViewAsync(Q,X);if(C)return C;if(X._data)return X._data;const l=B.Get(`${Q}/buffer`,this._gltf.buffers,X.buffer);return X._data=this.loadBufferAsync(`/buffers/${l.index}`,l,X.byteOffset||0,X.byteLength),X._data}_loadAccessorAsync(Q,X,C){if(X._data)return X._data;const l=b._GetNumComponents(Q,X.type),h=l*v.g.GetTypeByteLength(X.componentType),M=l*X.count;if(void 0==X.bufferView)X._data=Promise.resolve(new C(M));else{const f=B.Get(`${Q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((O=>{if(5126!==X.componentType||X.normalized||f.byteStride&&f.byteStride!==h){const Q=new C(M);return v.g.ForEach(O,X.byteOffset||0,f.byteStride||h,l,X.componentType,Q.length,X.normalized||!1,((X,C)=>{Q[C]=X})),Q}return b._GetTypedArray(Q,X.componentType,O,X.byteOffset,M)}))}if(X.sparse){const M=X.sparse;X._data=X._data.then((f=>{const O=f,m=B.Get(`${Q}/sparse/indices/bufferView`,this._gltf.bufferViews,M.indices.bufferView),W=B.Get(`${Q}/sparse/values/bufferView`,this._gltf.bufferViews,M.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${m.index}`,m),this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)]).then((f=>{let[m,W]=f;const U=b._GetTypedArray(`${Q}/sparse/indices`,M.indices.componentType,m,M.indices.byteOffset,M.count),L=l*M.count;let w;if(5126!==X.componentType||X.normalized){const f=b._GetTypedArray(`${Q}/sparse/values`,X.componentType,W,M.values.byteOffset,L);w=new C(L),v.g.ForEach(f,0,h,l,X.componentType,w.length,X.normalized||!1,((Q,X)=>{w[X]=Q}))}else w=b._GetTypedArray(`${Q}/sparse/values`,X.componentType,W,M.values.byteOffset,L);let i=0;for(let Q=0;Q<U.length;Q++){let X=U[Q]*l;for(let Q=0;Q<l;Q++)O[X++]=w[i++]}return O}))}))}return X._data}_loadFloatAccessorAsync(Q,X){return this._loadAccessorAsync(Q,X,Float32Array)}_loadIndicesAccessorAsync(Q,X){if("SCALAR"!==X.type)throw new Error(`${Q}/type: Invalid value ${X.type}`);if(5121!==X.componentType&&5123!==X.componentType&&5125!==X.componentType)throw new Error(`${Q}/componentType: Invalid value ${X.componentType}`);if(X._data)return X._data;if(X.sparse){const C=b._GetTypedArrayConstructor(`${Q}/componentType`,X.componentType);X._data=this._loadAccessorAsync(Q,X,C)}else{const C=B.Get(`${Q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>b._GetTypedArray(Q,X.componentType,C,X.byteOffset,X.count)))}return X._data}_loadVertexBufferViewAsync(Q){if(Q._babylonBuffer)return Q._babylonBuffer;const X=this._babylonScene.getEngine();return Q._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((Q=>new v.e(X,Q,!1))),Q._babylonBuffer}_loadVertexAccessorAsync(Q,X,C){var l;if(null!==(l=X._babylonVertexBuffer)&&void 0!==l&&l[C])return X._babylonVertexBuffer[C];X._babylonVertexBuffer||(X._babylonVertexBuffer={});const h=this._babylonScene.getEngine();if(X.sparse||void 0==X.bufferView)X._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(Q,X).then((Q=>new v.g(h,Q,C,!1)));else{const l=B.Get(`${Q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(l).then((M=>{const f=b._GetNumComponents(Q,X.type);return new v.g(h,M,C,!1,void 0,l.byteStride,void 0,X.byteOffset,f,X.componentType,X.normalized,!0,void 0,!0)}))}return X._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return X&&(X.baseColorFactor?(C.albedoColor=M.b.Wj(X.baseColorFactor),C.alpha=X.baseColorFactor[3]):C.albedoColor=M.b.White(),C.metallic=void 0==X.metallicFactor?1:X.metallicFactor,C.roughness=void 0==X.roughnessFactor?1:X.roughnessFactor,X.baseColorTexture&&l.push(this.loadTextureInfoAsync(`${Q}/baseColorTexture`,X.baseColorTexture,(Q=>{Q.name=`${C.name} (Base Color)`,C.albedoTexture=Q}))),X.metallicRoughnessTexture&&(X.metallicRoughnessTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${Q}/metallicRoughnessTexture`,X.metallicRoughnessTexture,(Q=>{Q.name=`${C.name} (Metallic Roughness)`,C.metallicTexture=Q}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(l).then((()=>{}))}_loadMaterialAsync(Q,X,C,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const M=this._extensionsLoadMaterialAsync(Q,X,C,l,h);if(M)return M;X._data=X._data||{};let f=X._data[l];if(!f){this.logOpen(`${Q} ${X.name||""}`);const C=this.createMaterial(Q,X,l);f={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Q,X,C)},X._data[l]=f,b.AddPointerMetadata(C,Q),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(f.babylonMeshes.push(C),C.bk.addOnce((()=>{const Q=f.babylonMeshes.indexOf(C);-1!==Q&&f.babylonMeshes.splice(Q,1)}))),h(f.babylonMaterial),f.promise.then((()=>f.babylonMaterial))}_createDefaultMaterial(Q,X){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new r.b(Q,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=X,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=r.b.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(Q,X,C){const l=this._extensionsCreateMaterial(Q,X,C);if(l)return l;const h=X.name||`material${X.index}`;return this._createDefaultMaterial(h,C)}loadMaterialPropertiesAsync(Q,X,C){const l=this._extensionsLoadMaterialPropertiesAsync(Q,X,C);if(l)return l;const h=new Array;return h.push(this.loadMaterialBasePropertiesAsync(Q,X,C)),X.pbrMetallicRoughness&&h.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Q}/pbrMetallicRoughness`,X.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(Q,X,C),Promise.all(h).then((()=>{}))}loadMaterialBasePropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return C.emissiveColor=X.emissiveFactor?M.b.Wj(X.emissiveFactor):new M.b(0,0,0),X.doubleSided&&(C.fk=!1,C.twoSidedLighting=!0),X.normalTexture&&(X.normalTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${Q}/normalTexture`,X.normalTexture,(Q=>{Q.name=`${C.name} (Normal)`,C.bumpTexture=Q}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=X.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=X.normalTexture.scale),C.forceIrradianceInFragment=!0),X.occlusionTexture&&(X.occlusionTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${Q}/occlusionTexture`,X.occlusionTexture,(Q=>{Q.name=`${C.name} (Occlusion)`,C.ambientTexture=Q}))),C.useAmbientInGrayScale=!0,void 0!=X.occlusionTexture.strength&&(C.ambientTextureStrength=X.occlusionTexture.strength)),X.emissiveTexture&&l.push(this.loadTextureInfoAsync(`${Q}/emissiveTexture`,X.emissiveTexture,(Q=>{Q.name=`${C.name} (Emissive)`,C.emissiveTexture=Q}))),Promise.all(l).then((()=>{}))}loadMaterialAlphaProperties(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);switch(X.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=r.b.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=r.b.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==X.alphaCutoff?.5:X.alphaCutoff,C.albedoTexture&&(C.albedoTexture.mi=!0);break;case"BLEND":C.transparencyMode=r.b.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.mi=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Q}/alphaMode: Invalid value (${X.alphaMode})`)}}loadTextureInfoAsync(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadTextureInfoAsync(Q,X,C);if(l)return l;if(this.logOpen(`${Q}`),X.texCoord>=6)throw new Error(`${Q}/texCoord: Invalid value (${X.texCoord})`);const h=B.Get(`${Q}/index`,this._gltf.textures,X.index);h._textureInfo=X;const M=this._loadTextureAsync(`/textures/${X.index}`,h,(l=>{l.coordinatesIndex=X.texCoord||0,b.AddPointerMetadata(l,Q),this._parent.onTextureLoadedObservable.notifyObservers(l),C(l)}));return this.logClose(),M}_loadTextureAsync(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadTextureAsync(Q,X,C);if(l)return l;this.logOpen(`${Q} ${X.name||""}`);const h=void 0==X.sampler?b.DefaultSampler:B.Get(`${Q}/sampler`,this._gltf.samplers,X.sampler),M=B.Get(`${Q}/source`,this._gltf.images,X.source),f=this._createTextureAsync(Q,h,M,C,void 0,!X._textureInfo.nonColorData);return this.logClose(),f}_createTextureAsync(Q,X,C){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},M=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0;const O=this._loadSampler(`/samplers/${X.index}`,X),m=new Array,W=new l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U={noMipmap:O.noMipMaps,invertY:!1,samplingMode:O.samplingMode,X:()=>{this._disposed||W.resolve()},onError:(X,C)=>{this._disposed||W.reject(new Error(`${Q}: ${C&&C.message?C.message:X||"Failed to load texture"}`))},mimeType:C.mimeType??(0,T.g)(C.uri??""),loaderOptions:M,useSRGBBuffer:!!f&&this._parent.useSRGBBuffers},L=new P.e(null,this._babylonScene,U);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.push(W.promise),m.push(this.loadImageAsync(`/images/${C.index}`,C).then((Q=>{const X=C.uri||`${this._fileName}#image${C.index}`,l=`data:${this._uniqueRootUrl}${X}`;L.updateURL(l,Q);const h=L.getInternalTexture();h&&(h.label=C.name)}))),L.wrapU=O.wrapU,L.wrapV=O.wrapV,h(L),this._parent.useGltfTextureNames&&(L.name=C.name||C.uri||`image${C.index}`),Promise.all(m).then((()=>L))}_loadSampler(Q,X){return X._data||(X._data={noMipMaps:9728===X.minFilter||9729===X.minFilter,samplingMode:b._GetTextureSamplingMode(Q,X),wrapU:b._GetTextureWrapMode(`${Q}/wrapS`,X.wrapS),wrapV:b._GetTextureWrapMode(`${Q}/wrapT`,X.wrapT)}),X._data}loadImageAsync(Q,X){if(!X._data){if(this.logOpen(`${Q} ${X.name||""}`),X.uri)X._data=this.loadUriAsync(`${Q}/uri`,X,X.uri);else{const C=B.Get(`${Q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}this.logClose()}return X._data}loadUriAsync(Q,X,C){const l=this._extensionsLoadUriAsync(Q,X,C);if(l)return l;if(!b._ValidateUri(C))throw new Error(`${Q}: '${C}' is invalid`);if((0,T.k)(C)){const X=new Uint8Array((0,T.b)(C));return this.log(`${Q}: Decoded ${C.substring(0,64)}... (${X.length} bytes)`),Promise.resolve(X)}return this.log(`${Q}: Loading ${C}`),this._parent.preprocessUrlAsync(this._rootUrl+C).then((X=>new Promise(((l,h)=>{this._parent._loadFile(this._babylonScene,X,(X=>{this._disposed||(this.log(`${Q}: Loaded ${C} (${X.byteLength} bytes)`),l(new Uint8Array(X)))}),!0,(X=>{h(new T.m(`${Q}: Failed to load '${C}'${X?": "+X.status+" "+X.statusText:""}`,X))}))}))))}static AddPointerMetadata(Q,X){Q.metadata=Q.metadata||{};const C=Q._internalMetadata=Q._internalMetadata||{},l=C.Hk=C.Hk||{};(l.pointers=l.pointers||[]).push(X)}static _GetTextureWrapMode(Q,X){switch(X=void 0==X?10497:X){case 33071:return P.e.CLAMP_ADDRESSMODE;case 33648:return P.e.MIRROR_ADDRESSMODE;case 10497:return P.e.WRAP_ADDRESSMODE;default:return F.c.Warn(`${Q}: Invalid value (${X})`),P.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Q,X){const C=void 0==X.magFilter?9729:X.magFilter,l=void 0==X.minFilter?9987:X.minFilter;if(9729===C)switch(l){case 9728:return P.e.LINEAR_NEAREST;case 9729:return P.e.LINEAR_LINEAR;case 9984:return P.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return P.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return P.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return P.e.LINEAR_LINEAR_MIPLINEAR;default:return F.c.Warn(`${Q}/minFilter: Invalid value (${l})`),P.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&F.c.Warn(`${Q}/magFilter: Invalid value (${C})`),l){case 9728:return P.e.NEAREST_NEAREST;case 9729:return P.e.NEAREST_LINEAR;case 9984:return P.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return P.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return P.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return P.e.NEAREST_LINEAR_MIPLINEAR;default:return F.c.Warn(`${Q}/minFilter: Invalid value (${l})`),P.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Q,X){try{return(0,E.q)(X)}catch(C){throw new Error(`${Q}: ${C.message}`)}}static _GetTypedArray(Q,X,C,l,h){const M=C.buffer;l=C.byteOffset+(l||0);const f=b._GetTypedArrayConstructor(`${Q}/componentType`,X),O=v.g.GetTypeByteLength(X);return l%O!==0?(F.c.Warn(`${Q}: Copying buffer as byte offset (${l}) is not a multiple of component type byte length (${O})`),new f(M.slice(l,l+h*O),0)):new f(M,l,h)}static _GetNumComponents(Q,X){switch(X){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Q}: Invalid type (${X})`)}static _ValidateUri(Q){return f.i.IsBase64(Q)||-1===Q.indexOf("..")}static _GetDrawMode(Q,X){switch(void 0==X&&(X=4),X){case 0:return x.e.PointListDrawMode;case 1:return x.e.LineListDrawMode;case 2:return x.e.LineLoopDrawMode;case 3:return x.e.LineStripDrawMode;case 4:return x.e.TriangleFillMode;case 5:return x.e.TriangleStripDrawMode;case 6:return x.e.TriangleFanDrawMode}throw new Error(`${Q}: Invalid mesh primitive mode (${X})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Q=new Array;if(this._gltf.materials)for(const X of this._gltf.materials)if(X._data)for(const C in X._data){const l=X._data[C];for(const X of l.babylonMeshes){X.Vj(!0);const C=l.babylonMaterial;Q.push(C.forceCompilationAsync(X)),Q.push(C.forceCompilationAsync(X,{useInstances:!0})),this._parent.useClipPlane&&(Q.push(C.forceCompilationAsync(X,{clipPlane:!0})),Q.push(C.forceCompilationAsync(X,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Q).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Q=new Array,X=this._babylonScene.lights;for(const C of X){const X=C.getShadowGenerator();X&&Q.push(X.forceCompilationAsync())}return Promise.all(Q).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Q){for(const X of this._extensions)X.enabled&&Q(X)}_applyExtensions(Q,X,C){for(const l of this._extensions)if(l.enabled){const h=`${l.name}.${X}`,M=Q;M._activeLoaderExtensionFunctions=M._activeLoaderExtensionFunctions||{};const f=M._activeLoaderExtensionFunctions;if(!f[h]){f[h]=!0;try{const Q=C(l);if(Q)return Q}finally{delete f[h]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Q=>Q.onLoading&&Q.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Q=>Q.onReady&&Q.onReady()))}_extensionsLoadSceneAsync(Q,X){return this._applyExtensions(X,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(Q,X)))}_extensionsLoadNodeAsync(Q,X,C){return this._applyExtensions(X,"loadNode",(l=>l.loadNodeAsync&&l.loadNodeAsync(Q,X,C)))}_extensionsLoadCameraAsync(Q,X,C){return this._applyExtensions(X,"loadCamera",(l=>l.loadCameraAsync&&l.loadCameraAsync(Q,X,C)))}_extensionsLoadVertexDataAsync(Q,X,C){return this._applyExtensions(X,"loadVertexData",(l=>l._loadVertexDataAsync&&l._loadVertexDataAsync(Q,X,C)))}_extensionsLoadMeshPrimitiveAsync(Q,X,C,l,h,M){return this._applyExtensions(h,"loadMeshPrimitive",(f=>f._loadMeshPrimitiveAsync&&f._loadMeshPrimitiveAsync(Q,X,C,l,h,M)))}_extensionsLoadMaterialAsync(Q,X,C,l,h){return this._applyExtensions(X,"loadMaterial",(M=>M._loadMaterialAsync&&M._loadMaterialAsync(Q,X,C,l,h)))}_extensionsCreateMaterial(Q,X,C){return this._applyExtensions(X,"createMaterial",(l=>l.createMaterial&&l.createMaterial(Q,X,C)))}_extensionsLoadMaterialPropertiesAsync(Q,X,C){return this._applyExtensions(X,"loadMaterialProperties",(l=>l.loadMaterialPropertiesAsync&&l.loadMaterialPropertiesAsync(Q,X,C)))}_extensionsLoadTextureInfoAsync(Q,X,C){return this._applyExtensions(X,"loadTextureInfo",(l=>l.loadTextureInfoAsync&&l.loadTextureInfoAsync(Q,X,C)))}_extensionsLoadTextureAsync(Q,X,C){return this._applyExtensions(X,"loadTexture",(l=>l._loadTextureAsync&&l._loadTextureAsync(Q,X,C)))}_extensionsLoadAnimationAsync(Q,X){return this._applyExtensions(X,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(Q,X)))}_extensionsLoadAnimationChannelAsync(Q,X,C,l,h){return this._applyExtensions(C,"loadAnimationChannel",(M=>M._loadAnimationChannelAsync&&M._loadAnimationChannelAsync(Q,X,C,l,h)))}_extensionsLoadSkinAsync(Q,X,C){return this._applyExtensions(C,"loadSkin",(l=>l._loadSkinAsync&&l._loadSkinAsync(Q,X,C)))}_extensionsLoadUriAsync(Q,X,C){return this._applyExtensions(X,"loadUri",(l=>l._loadUriAsync&&l._loadUriAsync(Q,X,C)))}_extensionsLoadBufferViewAsync(Q,X){return this._applyExtensions(X,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(Q,X)))}_extensionsLoadBufferAsync(Q,X,C,l){return this._applyExtensions(X,"loadBuffer",(h=>h.loadBufferAsync&&h.loadBufferAsync(Q,X,C,l)))}static LoadExtensionAsync(Q,X,C,l){if(!X.extensions)return null;const h=X.extensions[C];return h?l(`${Q}/extensions/${C}`,h):null}static LoadExtraAsync(Q,X,C,l){if(!X.extras)return null;const h=X.extras[C];return h?l(`${Q}/extras/${C}`,h):null}isExtensionUsed(Q){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Q)}logOpen(Q){this._parent._logOpen(Q)}logClose(){this._parent._logClose()}log(Q){this._parent._log(Q)}startPerformanceCounter(Q){this._parent._startPerformanceCounter(Q)}endPerformanceCounter(Q){this._parent._endPerformanceCounter(Q)}}b.DefaultSampler={index:-1},o.d._CreateGLTF2Loader=Q=>new b(Q);var p=C(13025),I=C(2354),t=C(695),y=C(2520),A=C(13030);class D extends A.c{constructor(Q,X,C){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Q),this._texture=Q.getEngine().createRawCubeTexture(X,C,l,h,M,f,O,m)}update(Q,X,C,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Q,X,C,l,h)}updateRGBDAsync(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,y.i)(this._texture,Q,X,C,l).then((()=>{}))}clone(){return t.d.Clone((()=>{const Q=this.va(),X=this._texture,C=new D(Q,X._bufferViewArray,X.width,X.format,X.type,X.generateMipMaps,X.invertY,X.samplingMode,X._compression);return 13===X.source&&C.updateRGBDAsync(X._bufferViewArrayArray,X._sphericalPolynomial,X._lodGenerationScale,X._lodGenerationOffset),C}),this)}}const u="EXT_lights_image_based";class V{constructor(Q){this.name=u,this._loader=Q,this.enabled=this._loader.isExtensionUsed(u)}dispose(){this._loader=null,delete this._lights}onLoading(){const Q=this._loader.Hk.extensions;if(Q&&Q[this.name]){const X=Q[this.name];this._lights=X.lights}}loadSceneAsync(Q,X){return b.LoadExtensionAsync(Q,X,this.name,(async(C,l)=>{this._loader._allMaterialsDirtyRequired=!0;const h=new Array;h.push(this._loader.loadSceneAsync(Q,X)),this._loader.logOpen(`${C}`);const M=B.Get(`${C}/light`,this._lights,l.ab);return h.push(this._loadLightAsync(`/extensions/${this.name}/lights/${l.ab}`,M).then((Q=>{this._loader.babylonScene.environmentTexture=Q}))),this._loader.logClose(),await Promise.all(h).then((()=>{}))}))}_loadLightAsync(Q,X){if(!X._loaded){const C=new Array;this._loader.logOpen(`${Q}`);const l=new Array(X.specularImages.length);for(let h=0;h<X.specularImages.length;h++){const M=X.specularImages[h];l[h]=new Array(M.length);for(let X=0;X<M.length;X++){const f=`${Q}/specularImages/${h}/${X}`;this._loader.logOpen(`${f}`);const O=M[X],m=B.Get(f,this._loader.Hk.images,O);C.push(this._loader.loadImageAsync(`/images/${O}`,m).then((Q=>{l[h][X]=Q}))),this._loader.logClose()}}this._loader.logClose(),X._loaded=Promise.all(C).then((async()=>{const C=new D(this._loader.babylonScene,null,X.specularImageSize);if(C.name=X.name||"environment",X._babylonTexture=C,void 0!=X.cb&&(C.level=X.cb),X.rotation){let Q=h.c.Wj(X.rotation);this._loader.babylonScene.useRightHandedSystem||(Q=h.c.Inverse(Q)),h.b.FromQuaternionToRef(Q,C.getReflectionTextureMatrix())}if(!X.irradianceCoefficients)throw new Error(`${Q}: Irradiance coefficients are missing`);const M=I.e.Wj(X.irradianceCoefficients);M.scaleInPlace(X.cb),M.convertIrradianceToLambertianRadiance();const f=I.h.FromHarmonics(M),O=(l.length-1)/Math.log2(X.specularImageSize);return await C.updateRGBDAsync(l,f,O)}))}return X._loaded.then((()=>X._babylonTexture))}}q(u),N(u,!0,(Q=>new V(Q)));C(471);const d="EXT_mesh_gpu_instancing";class QQ{constructor(Q){this.name=d,this._loader=Q,this.enabled=this._loader.isExtensionUsed(d)}dispose(){this._loader=null}loadNodeAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(Q,l)=>{this._loader._disableInstancedMesh++;const M=this._loader.loadNodeAsync(`/nodes/${X.index}`,X,C);if(this._loader._disableInstancedMesh--,!X._primitiveBabylonMeshes)return await M;const f=new Array;let O=0;const m=X=>{if(void 0==l.attributes[X])return void f.push(Promise.resolve(null));const C=B.Get(`${Q}/attributes/${X}`,this._loader.Hk.accessors,l.attributes[X]);if(f.push(this._loader._loadFloatAccessorAsync(`/accessors/${C.bufferView}`,C)),0===O)O=C.count;else if(O!==C.count)throw new Error(`${Q}/attributes: Instance buffer accessors do not have the same count.`)};return m("TRANSLATION"),m("ROTATION"),m("SCALE"),await M.then((async Q=>{const[C,l,M]=await Promise.all(f),m=new Float32Array(16*O);h.e.Yj[0].Yc(0,0,0),h.e.Quaternion[0].Yc(0,0,0,1),h.e.Yj[1].Yc(1,1,1);for(let X=0;X<O;++X)C&&h.k.FromArrayToRef(C,3*X,h.e.Yj[0]),l&&h.c.FromArrayToRef(l,4*X,h.e.Quaternion[0]),M&&h.k.FromArrayToRef(M,3*X,h.e.Yj[1]),h.b.ComposeToRef(h.e.Yj[1],h.e.Quaternion[0],h.e.Yj[0],h.e.Matrix[0]),h.e.Matrix[0].copyToArray(m,16*X);for(const h of X._primitiveBabylonMeshes)h.wk("matrix",m,16,!0);return Q}))}))}}q(d),N(d,!0,(Q=>new QQ(Q)));let XQ=0,CQ=null;class lQ{static get Default(){return lQ._Default||(lQ._Default=new lQ),lQ._Default}constructor(){const Q=lQ.Configuration.decoder;this._decoderModulePromise=f.i.LoadBabylonScriptAsync(Q.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Q,X,C,l,h){await this._decoderModulePromise,0===XQ&&(MeshoptDecoder.useWorkers(1),XQ=1);const M=await MeshoptDecoder.decodeGltfBufferAsync(X,C,Q,l,h);return null!==CQ&&clearTimeout(CQ),CQ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),XQ=0,CQ=null}),1e3),M}}lQ.Configuration={decoder:{url:`${f.i._DefaultCdnUrl}/meshopt_decoder.js`}},lQ._Default=null;const hQ="EXT_meshopt_compression";class MQ{constructor(Q){this.name=hQ,this.enabled=Q.isExtensionUsed(hQ),this._loader=Q}dispose(){this._loader=null}loadBufferViewAsync(Q,X){return b.LoadExtensionAsync(Q,X,this.name,(async(C,l)=>{const h=X;if(h._meshOptData)return await h._meshOptData;const M=B.Get(`${Q}/buffer`,this._loader.Hk.buffers,l.buffer);return h._meshOptData=this._loader.loadBufferAsync(`/buffers/${M.index}`,M,l.byteOffset||0,l.byteLength).then((async Q=>await lQ.Default.decodeGltfBufferAsync(Q,l.count,l.byteStride,l.mode,l.filter))),await h._meshOptData}))}}q(hQ),N(hQ,!0,(Q=>new MQ(Q)));const fQ="EXT_texture_webp";class OQ{constructor(Q){this.name=fQ,this._loader=Q,this.enabled=Q.isExtensionUsed(fQ)}dispose(){this._loader=null}_loadTextureAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=void 0==X.sampler?b.DefaultSampler:B.Get(`${Q}/sampler`,this._loader.Hk.samplers,X.sampler),f=B.Get(`${l}/source`,this._loader.Hk.images,h.source);return await this._loader._createTextureAsync(Q,M,f,(Q=>{C(Q)}),void 0,!X._textureInfo.nonColorData)}))}}q(fQ),N(fQ,!0,(Q=>new OQ(Q)));const mQ="EXT_texture_avif";class WQ{constructor(Q){this.name=mQ,this._loader=Q,this.enabled=Q.isExtensionUsed(mQ)}dispose(){this._loader=null}_loadTextureAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=void 0==X.sampler?b.DefaultSampler:B.Get(`${Q}/sampler`,this._loader.Hk.samplers,X.sampler),f=B.Get(`${l}/source`,this._loader.Hk.images,h.source);return await this._loader._createTextureAsync(Q,M,f,(Q=>{C(Q)}),void 0,!X._textureInfo.nonColorData)}))}}q(mQ),N(mQ,!0,(Q=>new WQ(Q)));var UQ=C(13017),LQ=C(12240);const wQ="EXT_lights_ies";class iQ{constructor(Q){this.name=wQ,this._loader=Q,this.enabled=this._loader.isExtensionUsed(wQ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Q=this._loader.Hk.extensions;if(Q&&Q[this.name]){const X=Q[this.name];this._lights=X.lights,B.Assign(this._lights)}}loadNodeAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,f)=>{let O,m;this._loader._allMaterialsDirtyRequired=!0;const W=await this._loader.loadNodeAsync(Q,X,(Q=>{m=B.Get(l,this._lights,f.ab);const X=m.name||Q.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O=new UQ.c(X,h.k.Zero(),h.k.Backward(),0,1,this._loader.babylonScene),O.angle=Math.PI/2,O.innerAngle=0,O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,m._babylonLight=O,O.falloffType=LQ.b.FALLOFF_GLTF,O.eb=f.color?M.b.Wj(f.color):M.b.White(),O.cb=f.multiplier||1,O.range=Number.MAX_VALUE,O.parent=Q,this._loader._babylonLights.push(O),b.AddPointerMetadata(O,l),C(Q)}));let U;if(m.uri)U=await this._loader.loadUriAsync(Q,m,m.uri);else{const X=B.Get(`${Q}/bufferView`,this._loader.Hk.bufferViews,m.bufferView);U=await this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return O.iesProfileTexture=new P.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,U,!0,void 0,void 0,void 0,void 0,".ies"),W}))}}q(wQ),N(wQ,!0,(Q=>new iQ(Q)));var aQ=C(13037);const FQ="KHR_draco_mesh_compression";class sQ{constructor(Q){this.name=FQ,this.useNormalizedFlagFromAccessor=!0,this._loader=Q,this.enabled=aQ.e.DefaultAvailable&&this._loader.isExtensionUsed(FQ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{if(void 0!=X.mode&&4!==X.mode&&5!==X.mode)throw new Error(`${Q}: Unsupported mode ${X.mode}`);const M={},f={},O=(Q,l)=>{const O=h.attributes[Q];if(void 0!=O&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(l)&&C._delayInfo.push(l),M[l]=O,this.useNormalizedFlagFromAccessor)){const C=B.TryGet(this._loader.Hk.accessors,X.attributes[Q]);C&&(f[l]=C.normalized||!1)}};O("POSITION",v.g.PositionKind),O("NORMAL",v.g.NormalKind),O("TANGENT",v.g.TangentKind),O("TEXCOORD_0",v.g.UVKind),O("TEXCOORD_1",v.g.UV2Kind),O("TEXCOORD_2",v.g.UV3Kind),O("TEXCOORD_3",v.g.UV4Kind),O("TEXCOORD_4",v.g.UV5Kind),O("TEXCOORD_5",v.g.UV6Kind),O("JOINTS_0",v.g.MatricesIndicesKind),O("WEIGHTS_0",v.g.MatricesWeightsKind),O("COLOR_0",v.g.ColorKind);const m=B.Get(l,this._loader.Hk.bufferViews,h.bufferView);return m._dracoBabylonGeometry||(m._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((async l=>{const h=this.dracoDecoder||aQ.e.Default,O=B.TryGet(this._loader.Hk.accessors,X.attributes.POSITION),m=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!O?null:G(O);return await h._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,l,M,f,m).catch((X=>{throw new Error(`${Q}: ${X.message}`)}))}))),await m._dracoBabylonGeometry}))}}q(FQ),N(FQ,!0,(Q=>new sQ(Q)));var zQ=C(13041),xQ=C(644),rQ=C(650),PQ=C(693),jQ=C(12282),vQ=C(620);PQ.e.AddNodeConstructor("Light_Type_0",((Q,X)=>()=>new ZQ(Q,h.k.Zero(),X)));class ZQ extends jQ.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(Q){this._shadowAngle=Q,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Q){const X=this.needCube();if(this._direction=Q,this.needCube()!==X&&this._shadowGenerators){const Q=this._shadowGenerators.values();for(let X=Q.next();!0!==X.done;X=Q.next()){X.value.recreateShadowMap()}}}constructor(Q,X,C){super(Q,C),this._shadowAngle=Math.PI/2,this.position=X}getClassName(){return"PointLight"}getTypeID(){return LQ.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Q){if(this.direction)return super.getShadowDirection(Q);switch(Q){case 0:return new h.k(1,0,0);case 1:return new h.k(-1,0,0);case 2:return new h.k(0,-1,0);case 3:return new h.k(0,1,0);case 4:return new h.k(0,0,1);case 5:return new h.k(0,0,-1)}return h.k.Zero()}_setDefaultShadowProjectionMatrix(Q,X,C){const l=this.va().activeCamera;if(!l)return;const M=void 0!==this.shadowMinZ?this.shadowMinZ:l.Rj,f=void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,O=this.va().getEngine().useReverseDepthBuffer;h.b.PerspectiveFovLHToRef(this.shadowAngle,1,O?f:M,O?M:f,Q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Q,X){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,X):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,X),this}transferToNodeMaterialEffect(Q,X){return this.computeTransformedInformation()?Q.setFloat3(X,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Q.setFloat3(X,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Q,X){Q["POINTLIGHT"+X]=!0}}(0,xQ.c)([(0,rQ.N)()],ZQ.prototype,"shadowAngle",null),(0,vQ.g)("BABYLON.PointLight",ZQ);const gQ="KHR_lights_punctual";class SQ{constructor(Q){this.name=gQ,this._loader=Q,this.enabled=this._loader.isExtensionUsed(gQ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Q=this._loader.Hk.extensions;if(Q&&Q[this.name]){const X=Q[this.name];this._lights=X.lights,B.Assign(this._lights)}}loadNodeAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,f)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Q,X,(Q=>{let X;const O=B.Get(l,this._lights,f.ab),m=O.name||Q.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O.type){case"directional":{const Q=new zQ.b(m,h.k.Backward(),this._loader.babylonScene);Q.position.Zj(0),X=Q;break}case"point":X=new ZQ(m,h.k.Zero(),this._loader.babylonScene);break;case"spot":{const Q=new UQ.c(m,h.k.Zero(),h.k.Backward(),0,1,this._loader.babylonScene);Q.angle=2*(O.spot&&O.spot.outerConeAngle||Math.PI/4),Q.innerAngle=2*(O.spot&&O.spot.innerConeAngle||0),X=Q;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${O.type})`)}X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,O._babylonLight=X,X.falloffType=LQ.b.FALLOFF_GLTF,X.eb=O.color?M.b.Wj(O.color):M.b.White(),X.cb=void 0==O.cb?1:O.cb,X.range=void 0==O.range?Number.MAX_VALUE:O.range,X.parent=Q,this._loader._babylonLights.push(X),b.AddPointerMetadata(X,l),C(Q)})))))}}q(gQ),N(gQ,!0,(Q=>new SQ(Q)));const eQ="KHR_materials_pbrSpecularGlossiness";class kQ{constructor(Q){this.name=eQ,this.order=200,this._loader=Q,this.enabled=this._loader.isExtensionUsed(eQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialBasePropertiesAsync(Q,X,C)),M.push(this._loadSpecularGlossinessPropertiesAsync(l,h,C)),this._loader.loadMaterialAlphaProperties(Q,X,C),await Promise.all(M).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return C.metallic=null,C.roughness=null,X.diffuseFactor?(C.albedoColor=M.b.Wj(X.diffuseFactor),C.alpha=X.diffuseFactor[3]):C.albedoColor=M.b.White(),C.reflectivityColor=X.specularFactor?M.b.Wj(X.specularFactor):M.b.White(),C.microSurface=void 0==X.glossinessFactor?1:X.glossinessFactor,X.diffuseTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/diffuseTexture`,X.diffuseTexture,(Q=>{Q.name=`${C.name} (Diffuse)`,C.albedoTexture=Q}))),X.specularGlossinessTexture&&(l.push(this._loader.loadTextureInfoAsync(`${Q}/specularGlossinessTexture`,X.specularGlossinessTexture,(Q=>{Q.name=`${C.name} (Specular Glossiness)`,C.reflectivityTexture=Q,C.reflectivityTexture.mi=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(l).then((()=>{}))}}q(eQ),N(eQ,!0,(Q=>new kQ(Q)));const RQ="KHR_materials_unlit";class HQ{constructor(Q){this.name=RQ,this.order=210,this._loader=Q,this.enabled=this._loader.isExtensionUsed(RQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async()=>await this._loadUnlitPropertiesAsync(Q,X,C)))}_loadUnlitPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;C.unlit=!0;const h=X.pbrMetallicRoughness;return h&&(h.baseColorFactor?(C.albedoColor=M.b.Wj(h.baseColorFactor),C.alpha=h.baseColorFactor[3]):C.albedoColor=M.b.White(),h.baseColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/baseColorTexture`,h.baseColorTexture,(Q=>{Q.name=`${C.name} (Base Color)`,C.albedoTexture=Q})))),X.doubleSided&&(C.fk=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Q,X,C),Promise.all(l).then((()=>{}))}}q(RQ),N(RQ,!0,(Q=>new HQ(Q)));const oQ="KHR_materials_clearcoat";class TQ{constructor(Q){this.name=oQ,this.order=190,this._loader=Q,this.enabled=this._loader.isExtensionUsed(oQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadClearCoatPropertiesAsync(l,h,C)),await Promise.all(M)}))}_loadClearCoatPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=X.clearcoatFactor?C.clearCoat.cb=X.clearcoatFactor:C.clearCoat.cb=0,X.clearcoatTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/clearcoatTexture`,X.clearcoatTexture,(Q=>{Q.name=`${C.name} (ClearCoat)`,C.clearCoat.texture=Q}))),void 0!=X.clearcoatRoughnessFactor?C.clearCoat.roughness=X.clearcoatRoughnessFactor:C.clearCoat.roughness=0,X.clearcoatRoughnessTexture&&(X.clearcoatRoughnessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${Q}/clearcoatRoughnessTexture`,X.clearcoatRoughnessTexture,(Q=>{Q.name=`${C.name} (ClearCoat Roughness)`,C.clearCoat.textureRoughness=Q})))),X.clearcoatNormalTexture&&(X.clearcoatNormalTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${Q}/clearcoatNormalTexture`,X.clearcoatNormalTexture,(Q=>{Q.name=`${C.name} (ClearCoat Normal)`,C.clearCoat.bumpTexture=Q}))),C.invertNormalMapX=!C.va().useRightHandedSystem,C.invertNormalMapY=C.va().useRightHandedSystem,void 0!=X.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=X.clearcoatNormalTexture.scale)),Promise.all(l).then((()=>{}))}}q(oQ),N(oQ,!0,(Q=>new TQ(Q)));const YQ="KHR_materials_iridescence";class JQ{constructor(Q){this.name=YQ,this.order=195,this._loader=Q,this.enabled=this._loader.isExtensionUsed(YQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadIridescencePropertiesAsync(l,h,C)),await Promise.all(M).then((()=>{}))}))}_loadIridescencePropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return C.iridescence.isEnabled=!0,C.iridescence.cb=X.iridescenceFactor??0,C.iridescence.indexOfRefraction=X.iridescenceIor??X.iridescenceIOR??1.3,C.iridescence.minimumThickness=X.iridescenceThicknessMinimum??100,C.iridescence.maximumThickness=X.iridescenceThicknessMaximum??400,X.iridescenceTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/iridescenceTexture`,X.iridescenceTexture,(Q=>{Q.name=`${C.name} (Iridescence)`,C.iridescence.texture=Q}))),X.iridescenceThicknessTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/iridescenceThicknessTexture`,X.iridescenceThicknessTexture,(Q=>{Q.name=`${C.name} (Iridescence Thickness)`,C.iridescence.thicknessTexture=Q}))),Promise.all(l).then((()=>{}))}}q(YQ),N(YQ,!0,(Q=>new JQ(Q)));const KQ="KHR_materials_anisotropy";class NQ{constructor(Q){this.name=KQ,this.order=195,this._loader=Q,this.enabled=this._loader.isExtensionUsed(KQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadIridescencePropertiesAsync(l,h,C)),await Promise.all(M)}))}async _loadIridescencePropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.cb=X.anisotropyStrength??0,C.anisotropy.angle=X.anisotropyRotation??0,X.anisotropyTexture&&(X.anisotropyTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${Q}/anisotropyTexture`,X.anisotropyTexture,(Q=>{Q.name=`${C.name} (Anisotropy Intensity)`,C.anisotropy.texture=Q})))),await Promise.all(l)}}q(KQ),N(KQ,!0,(Q=>new NQ(Q)));const qQ="KHR_materials_emissive_strength";class nQ{constructor(Q){this.name=qQ,this.order=170,this._loader=Q,this.enabled=this._loader.isExtensionUsed(qQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>await this._loader.loadMaterialPropertiesAsync(Q,X,C).then((()=>{this._loadEmissiveProperties(l,h,C)}))))}_loadEmissiveProperties(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);void 0!==X.emissiveStrength&&(C.emissiveIntensity=X.emissiveStrength)}}q(qQ),N(qQ,!0,(Q=>new nQ(Q)));const cQ="KHR_materials_sheen";class EQ{constructor(Q){this.name=cQ,this.order=190,this._loader=Q,this.enabled=this._loader.isExtensionUsed(cQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadSheenPropertiesAsync(l,h,C)),await Promise.all(M).then((()=>{}))}))}_loadSheenPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return C.sheen.isEnabled=!0,C.sheen.cb=1,void 0!=X.sheenColorFactor?C.sheen.color=M.b.Wj(X.sheenColorFactor):C.sheen.color=M.b.Black(),X.sheenColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/sheenColorTexture`,X.sheenColorTexture,(Q=>{Q.name=`${C.name} (Sheen Color)`,C.sheen.texture=Q}))),void 0!==X.sheenRoughnessFactor?C.sheen.roughness=X.sheenRoughnessFactor:C.sheen.roughness=0,X.sheenRoughnessTexture&&(X.sheenRoughnessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${Q}/sheenRoughnessTexture`,X.sheenRoughnessTexture,(Q=>{Q.name=`${C.name} (Sheen Roughness)`,C.sheen.textureRoughness=Q})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(l).then((()=>{}))}}q(cQ),N(cQ,!0,(Q=>new EQ(Q)));var BQ=C(12145);const GQ="KHR_materials_specular";class bQ{constructor(Q){this.name=GQ,this.order=190,this._loader=Q,this.enabled=this._loader.isExtensionUsed(GQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;if(M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadSpecularPropertiesAsync(l,h,C)),h.extensions&&h.extensions.EXT_materials_specular_edge_color&&C instanceof r.b){h.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=BQ.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=BQ.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(M).then((()=>{}))}))}_loadSpecularPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return void 0!==X.specularFactor&&(C.metallicF0Factor=X.specularFactor),void 0!==X.specularColorFactor&&(C.metallicReflectanceColor=M.b.Wj(X.specularColorFactor)),X.specularTexture&&(X.specularTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${Q}/specularTexture`,X.specularTexture,(Q=>{Q.name=`${C.name} (Specular)`,C.metallicReflectanceTexture=Q,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),X.specularColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/specularColorTexture`,X.specularColorTexture,(Q=>{Q.name=`${C.name} (Specular Color)`,C.reflectanceTexture=Q}))),Promise.all(l).then((()=>{}))}}q(GQ),N(GQ,!0,(Q=>new bQ(Q)));const pQ="KHR_materials_ior";class IQ{constructor(Q){this.name=pQ,this.order=180,this._loader=Q,this.enabled=this._loader.isExtensionUsed(pQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadIorPropertiesAsync(l,h,C)),await Promise.all(M).then((()=>{}))}))}_loadIorPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);return void 0!==X.ior?C.indexOfRefraction=X.ior:C.indexOfRefraction=IQ._DEFAULT_IOR,Promise.resolve()}}IQ._DEFAULT_IOR=1.5,q(pQ),N(pQ,!0,(Q=>new IQ(Q)));const tQ="KHR_materials_variants";class yQ{constructor(Q){this.name=tQ,this._loader=Q,this.enabled=this._loader.isExtensionUsed(tQ)}dispose(){this._loader=null}static GetAvailableVariants(Q){const X=this._GetExtensionMetadata(Q);return X?Object.keys(X.variants):[]}getAvailableVariants(Q){return yQ.GetAvailableVariants(Q)}static SelectVariant(Q,X){const C=this._GetExtensionMetadata(Q);if(!C)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${tQ} extension`);const l=Q=>{const X=C.variants[Q];if(X)for(const C of X)C.mesh.material=C.material};if(X instanceof Array)for(const h of X)l(h);else l(X);C.lastSelected=X}selectVariant(Q,X){yQ.SelectVariant(Q,X)}static Reset(Q){const X=this._GetExtensionMetadata(Q);if(!X)throw new Error(`Cannot reset on a glTF mesh that does not have the ${tQ} extension`);for(const C of X.original)C.mesh.material=C.material;X.lastSelected=null}reset(Q){yQ.Reset(Q)}static GetLastSelectedVariant(Q){const X=this._GetExtensionMetadata(Q);if(!X)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${tQ} extension`);return X.lastSelected}getLastSelectedVariant(Q){return yQ.GetLastSelectedVariant(Q)}static _GetExtensionMetadata(Q){var X,C;return(null===Q||void 0===Q||null===(X=Q._internalMetadata)||void 0===X||null===(C=X.Hk)||void 0===C?void 0:C[tQ])||null}onLoading(){const Q=this._loader.Hk.extensions;if(Q&&Q[this.name]){const X=Q[this.name];this._variants=X.variants}}onReady(){const Q=this._loader.rootBabylonMesh;if(Q){var X;const C=this._loader.parent.extensionOptions[tQ];null!==C&&void 0!==C&&C.defaultVariant&&yQ.SelectVariant(Q,C.defaultVariant),null===C||void 0===C||null===(X=C.onLoaded)||void 0===X||X.call(C,{get variants(){return yQ.GetAvailableVariants(Q)},get selectedVariant(){const X=yQ.GetLastSelectedVariant(Q);return X?Array.isArray(X)?X[0]:X:yQ.GetAvailableVariants(Q)[0]},set selectedVariant(X){yQ.SelectVariant(Q,X)}})}}_loadMeshPrimitiveAsync(Q,X,C,l,h,M){return b.LoadExtensionAsync(Q,h,this.name,(async(f,O)=>{const m=new Array;return m.push(this._loader._loadMeshPrimitiveAsync(Q,X,C,l,h,(X=>{if(M(X),X instanceof S.c){const C=b._GetDrawMode(Q,h.mode),l=this._loader.rootBabylonMesh,M=l?l._internalMetadata=l._internalMetadata||{}:{},W=M.Hk=M.Hk||{},U=W[tQ]=W[tQ]||{lastSelected:null,original:[],variants:{}};U.original.push({mesh:X,material:X.material});for(let Q=0;Q<O.mappings.length;++Q){const h=O.mappings[Q],M=B.Get(`${f}/mappings/${Q}/material`,this._loader.Hk.materials,h.material);m.push(this._loader._loadMaterialAsync(`#/materials/${h.material}`,M,X,C,(Q=>{for(let C=0;C<h.variants.length;++C){const M=h.variants[C],f=B.Get(`/extensions/${tQ}/variants/${M}`,this._variants,M);U.variants[f.name]=U.variants[f.name]||[],U.variants[f.name].push({mesh:X,material:Q}),X.onClonedObservable.add((Q=>{const C=Q;let h=null,M=C;do{if(M=M.parent,!M)return;h=yQ._GetExtensionMetadata(M)}while(null===h);if(l&&h===yQ._GetExtensionMetadata(l)){M._internalMetadata={};for(const Q in l._internalMetadata)M._internalMetadata[Q]=l._internalMetadata[Q];M._internalMetadata.Hk=[];for(const Q in l._internalMetadata.Hk)M._internalMetadata.Hk[Q]=l._internalMetadata.Hk[Q];M._internalMetadata.Hk[tQ]={lastSelected:null,original:[],variants:{}};for(const Q of h.original)M._internalMetadata.Hk[tQ].original.push({mesh:Q.mesh,material:Q.material});for(const Q in h.variants)if(Object.prototype.hasOwnProperty.call(h.variants,Q)){M._internalMetadata.Hk[tQ].variants[Q]=[];for(const X of h.variants[Q])M._internalMetadata.Hk[tQ].variants[Q].push({mesh:X.mesh,material:X.material})}h=M._internalMetadata.Hk[tQ]}for(const l of h.original)l.mesh===X&&(l.mesh=C);for(const l of h.variants[f.name])l.mesh===X&&(l.mesh=C)}))}})))}}}))),await Promise.all(m).then((Q=>{let[X]=Q;return X}))}))}}q(tQ),N(tQ,!0,(Q=>new yQ(Q)));var AQ=C(2412);class DQ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:BQ.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Q,X){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...DQ._GetDefaultOptions(),...Q},this._scene=X,this._scene._transmissionHelper=this,this.onErrorObservable=new U.e,this._scene.bk.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Q){if(!Object.keys(Q).filter((X=>this._options[X]!==Q[X])).length)return;const X={...this._options,...Q},C=this._options;this._options=X,X.renderSize===C.renderSize&&X.renderTargetTextureType===C.renderTargetTextureType&&X.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=X.samples,this._opaqueRenderTarget.lodGenerationScale=X.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=X.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Q){return!!Q&&!!(Q instanceof r.b&&Q.subSurface.isRefractionEnabled)}_addMesh(Q){this._materialObservers[Q.uniqueId]=Q.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),f.i.SetImmediate((()=>{this._shouldRenderAsTransmission(Q.material)?(Q.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Q)&&this._transparentMeshesCache.push(Q)):-1===this._opaqueMeshesCache.indexOf(Q)&&this._opaqueMeshesCache.push(Q)}))}_removeMesh(Q){Q.onMaterialChangedObservable.remove(this._materialObservers[Q.uniqueId]),delete this._materialObservers[Q.uniqueId];let X=this._transparentMeshesCache.indexOf(Q);-1!==X&&this._transparentMeshesCache.splice(X,1),X=this._opaqueMeshesCache.indexOf(Q),-1!==X&&this._opaqueMeshesCache.splice(X,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Q){const X=this._transparentMeshesCache.indexOf(Q),C=this._opaqueMeshesCache.indexOf(Q);this._shouldRenderAsTransmission(Q.material)?(Q.material instanceof r.b&&(Q.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(Q)):-1===X&&this._transparentMeshesCache.push(Q)):-1!==X?(this._transparentMeshesCache.splice(X,1),this._opaqueMeshesCache.push(Q)):-1===C&&this._opaqueMeshesCache.push(Q)}_isRenderTargetValid(){var Q;return null!==(null===(Q=this._opaqueRenderTarget)||void 0===Q?void 0:Q.getInternalTexture())}_setupRenderTargets(){var Q;let X;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new AQ.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Q=this._options.clearColor)||void 0===Q?void 0:Q.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Q=>{X=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Q.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Q.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=X}));for(const C of this._transparentMeshesCache)this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const uQ="KHR_materials_transmission";class VQ{constructor(Q){this.name=uQ,this.order=175,this._loader=Q,this.enabled=this._loader.isExtensionUsed(uQ),this.enabled&&(Q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadTransparentPropertiesAsync(l,X,C,h)),await Promise.all(M).then((()=>{}))}))}_loadTransparentPropertiesAsync(Q,X,C,l){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const h=C;if(h.subSurface.isRefractionEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.useAlbedoToTintRefraction=!0,void 0===l.transmissionFactor)return h.subSurface.refractionIntensity=0,h.subSurface.isRefractionEnabled=!1,Promise.resolve();{var M;h.subSurface.refractionIntensity=l.transmissionFactor;const Q=h.va();if(h.subSurface.refractionIntensity&&!Q._transmissionHelper)new DQ({},h.va());else if(h.subSurface.refractionIntensity&&(null===(M=Q._transmissionHelper)||void 0===M||!M._isRenderTargetValid())){var f;null===(f=Q._transmissionHelper)||void 0===f||f._setupRenderTargets()}}return h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,l.transmissionTexture?(l.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Q}/transmissionTexture`,l.transmissionTexture,void 0).then((Q=>{Q.name=`${C.name} (Transmission)`,h.subSurface.refractionIntensityTexture=Q,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}q(uQ),N(uQ,!0,(Q=>new VQ(Q)));const dQ="KHR_materials_diffuse_transmission";class QX{constructor(Q){this.name=dQ,this.order=174,this._loader=Q,this.enabled=this._loader.isExtensionUsed(dQ),this.enabled&&(Q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadTranslucentPropertiesAsync(l,X,C,h)),await Promise.all(M).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Q,X,C,l){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const h=C;if(h.subSurface.isTranslucencyEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,h.subSurface.useAlbedoToTintTranslucency=!1,void 0===l.diffuseTransmissionFactor)return h.subSurface.translucencyIntensity=0,h.subSurface.isTranslucencyEnabled=!1,Promise.resolve();h.subSurface.translucencyIntensity=l.diffuseTransmissionFactor;const f=new Array;return h.subSurface.useGltfStyleTextures=!0,l.diffuseTransmissionTexture&&(l.diffuseTransmissionTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${Q}/diffuseTransmissionTexture`,l.diffuseTransmissionTexture).then((Q=>{Q.name=`${C.name} (Diffuse Transmission)`,h.subSurface.translucencyIntensityTexture=Q})))),void 0!==l.diffuseTransmissionColorFactor?h.subSurface.translucencyColor=M.b.Wj(l.diffuseTransmissionColorFactor):h.subSurface.translucencyColor=M.b.White(),l.diffuseTransmissionColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${Q}/diffuseTransmissionColorTexture`,l.diffuseTransmissionColorTexture).then((Q=>{Q.name=`${C.name} (Diffuse Transmission Color)`,h.subSurface.translucencyColorTexture=Q}))),Promise.all(f).then((()=>{}))}}q(dQ),N(dQ,!0,(Q=>new QX(Q)));const XX="KHR_materials_volume";class CX{constructor(Q){this.name=XX,this.order=173,this._loader=Q,this.enabled=this._loader.isExtensionUsed(XX),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadVolumePropertiesAsync(l,X,C,h)),await Promise.all(M).then((()=>{}))}))}_loadVolumePropertiesAsync(Q,X,C,l){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!l.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const h=void 0!==l.attenuationDistance?l.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=h,void 0!==l.attenuationColor&&3==l.attenuationColor.length&&C.subSurface.tintColor.Yc(l.attenuationColor[0],l.attenuationColor[1],l.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=l.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,l.thicknessTexture?(l.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Q}/thicknessTexture`,l.thicknessTexture).then((Q=>{Q.name=`${C.name} (Thickness)`,C.subSurface.thicknessTexture=Q,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}q(XX),N(XX,!0,(Q=>new CX(Q)));const lX="KHR_materials_dispersion";class hX{constructor(Q){this.name=lX,this.order=174,this._loader=Q,this.enabled=this._loader.isExtensionUsed(lX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadDispersionPropertiesAsync(l,X,C,h)),await Promise.all(M).then((()=>{}))}))}_loadDispersionPropertiesAsync(Q,X,C,l){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);return C.subSurface.isRefractionEnabled&&l.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=l.dispersion,Promise.resolve()):Promise.resolve()}}q(lX),N(lX,!0,(Q=>new hX(Q)));const MX="EXT_materials_diffuse_roughness";class fX{constructor(Q){this.name=MX,this.order=190,this._loader=Q,this.enabled=this._loader.isExtensionUsed(MX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(Q,X,C)),M.push(this._loadDiffuseRoughnessPropertiesAsync(l,h,C)),await Promise.all(M).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Q,X,C){if(!(C instanceof r.b))throw new Error(`${Q}: Material type not supported`);const l=new Array;return C.brdf.baseDiffuseModel=BQ.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=X.diffuseRoughnessFactor?C.baseDiffuseRoughness=X.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,X.diffuseRoughnessTexture&&l.push(this._loader.loadTextureInfoAsync(`${Q}/diffuseRoughnessTexture`,X.diffuseRoughnessTexture,(Q=>{Q.name=`${C.name} (Diffuse Roughness)`,C.baseDiffuseRoughnessTexture=Q}))),Promise.all(l).then((()=>{}))}}q(MX),N(MX,!0,(Q=>new fX(Q)));const OX="KHR_mesh_quantization";class mX{constructor(Q){this.name=OX,this.enabled=Q.isExtensionUsed(OX)}dispose(){}}q(OX),N(OX,!0,(Q=>new mX(Q)));const WX="KHR_texture_basisu";class UX{constructor(Q){this.name=WX,this._loader=Q,this.enabled=Q.isExtensionUsed(WX)}dispose(){this._loader=null}_loadTextureAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>{const M=void 0==X.sampler?b.DefaultSampler:B.Get(`${Q}/sampler`,this._loader.Hk.samplers,X.sampler),f=B.Get(`${l}/source`,this._loader.Hk.images,h.source);return await this._loader._createTextureAsync(Q,M,f,(Q=>{C(Q)}),X._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!X._textureInfo.nonColorData)}))}}q(WX),N(WX,!0,(Q=>new UX(Q)));const LX="KHR_texture_transform";class wX{constructor(Q){this.name=LX,this._loader=Q,this.enabled=this._loader.isExtensionUsed(LX)}dispose(){this._loader=null}loadTextureInfoAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(l,h)=>await this._loader.loadTextureInfoAsync(Q,X,(Q=>{if(!(Q instanceof P.e))throw new Error(`${l}: Texture type not supported`);h.offset&&(Q.uOffset=h.offset[0],Q.vOffset=h.offset[1]),Q.uRotationCenter=0,Q.vRotationCenter=0,h.rotation&&(Q.wAng=-h.rotation),h.scale&&(Q.uScale=h.scale[0],Q.vScale=h.scale[1]),void 0!=h.texCoord&&(Q.coordinatesIndex=h.texCoord),C(Q)}))))}}q(LX),N(LX,!0,(Q=>new wX(Q)));const iX="KHR_xmp_json_ld";class aX{constructor(Q){this.name=iX,this.order=100,this._loader=Q,this.enabled=this._loader.isExtensionUsed(iX)}dispose(){this._loader=null}onLoading(){var Q,X,C;if(null===this._loader.rootBabylonMesh)return;const l=null===(Q=this._loader.Hk.extensions)||void 0===Q?void 0:Q.KHR_xmp_json_ld,h=null===(X=this._loader.Hk.asset)||void 0===X||null===(C=X.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(l&&h){const Q=+h.packet;l.packets&&Q<l.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=l.packets[Q])}}}function FX(Q,X,C,l){return M.b.Wj(X,C).scale(l)}function sX(Q,X,C,l){return X[C]*l}function zX(Q,X,C,l){return-X[C]*l}function xX(Q,X,C,l){return X[C+1]*l}function rX(Q,X,C,l){return X[C]*l*2}function PX(Q){return{scale:[new vX(w.e.ANIMATIONTYPE_FLOAT,`${Q}.uScale`,sX,(()=>2)),new vX(w.e.ANIMATIONTYPE_FLOAT,`${Q}.vScale`,xX,(()=>2))],offset:[new vX(w.e.ANIMATIONTYPE_FLOAT,`${Q}.uOffset`,sX,(()=>2)),new vX(w.e.ANIMATIONTYPE_FLOAT,`${Q}.vOffset`,xX,(()=>2))],rotation:[new vX(w.e.ANIMATIONTYPE_FLOAT,`${Q}.wAng`,zX,(()=>1))]}}q(iX),N(iX,!0,(Q=>new aX(Q)));class jX extends p.AnimationPropertyInfo{buildAnimations(Q,X,C,l){return[{babylonAnimatable:Q._babylonCamera,babylonAnimation:this._buildAnimation(X,C,l)}]}}class vX extends p.AnimationPropertyInfo{buildAnimations(Q,X,C,l){const h=[];for(const M in Q._data)h.push({babylonAnimatable:Q._data[M].babylonMaterial,babylonAnimation:this._buildAnimation(X,C,l)});return h}}class ZX extends p.AnimationPropertyInfo{buildAnimations(Q,X,C,l){return[{babylonAnimatable:Q._babylonLight,babylonAnimation:this._buildAnimation(X,C,l)}]}}(0,n.m)("/cameras/{}/orthographic/xmag",[new jX(w.e.ANIMATIONTYPE_FLOAT,"orthoLeft",zX,(()=>1)),new jX(w.e.ANIMATIONTYPE_FLOAT,"orthoRight",xX,(()=>1))]),(0,n.m)("/cameras/{}/orthographic/ymag",[new jX(w.e.ANIMATIONTYPE_FLOAT,"orthoBottom",zX,(()=>1)),new jX(w.e.ANIMATIONTYPE_FLOAT,"orthoTop",xX,(()=>1))]),(0,n.m)("/cameras/{}/orthographic/zfar",[new jX(w.e.ANIMATIONTYPE_FLOAT,"maxZ",sX,(()=>1))]),(0,n.m)("/cameras/{}/orthographic/znear",[new jX(w.e.ANIMATIONTYPE_FLOAT,"Rj",sX,(()=>1))]),(0,n.m)("/cameras/{}/perspective/yfov",[new jX(w.e.ANIMATIONTYPE_FLOAT,"fov",sX,(()=>1))]),(0,n.m)("/cameras/{}/perspective/zfar",[new jX(w.e.ANIMATIONTYPE_FLOAT,"maxZ",sX,(()=>1))]),(0,n.m)("/cameras/{}/perspective/znear",[new jX(w.e.ANIMATIONTYPE_FLOAT,"Rj",sX,(()=>1))]),(0,n.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new vX(w.e.ANIMATIONTYPE_COLOR3,"albedoColor",FX,(()=>4)),new vX(w.e.ANIMATIONTYPE_FLOAT,"alpha",(function(Q,X,C,l){return X[C+3]*l}),(()=>4))]),(0,n.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"metallic",sX,(()=>1))]),(0,n.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"roughness",sX,(()=>1))]);const gX=PX("albedoTexture");(0,n.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",gX.scale),(0,n.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",gX.offset),(0,n.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",gX.rotation);const SX=PX("metallicTexture");(0,n.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",SX.scale),(0,n.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",SX.offset),(0,n.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",SX.rotation),(0,n.m)("/materials/{}/emissiveFactor",[new vX(w.e.ANIMATIONTYPE_COLOR3,"emissiveColor",FX,(()=>3))]);const eX=PX("bumpTexture");(0,n.m)("/materials/{}/normalTexture/scale",[new vX(w.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",sX,(()=>1))]),(0,n.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",eX.scale),(0,n.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",eX.offset),(0,n.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",eX.rotation),(0,n.m)("/materials/{}/occlusionTexture/strength",[new vX(w.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",sX,(()=>1))]);const kX=PX("ambientTexture");(0,n.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",kX.scale),(0,n.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",kX.offset),(0,n.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",kX.rotation);const RX=PX("emissiveTexture");(0,n.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",RX.scale),(0,n.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",RX.offset),(0,n.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",RX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new vX(w.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new vX(w.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",sX,(()=>1))]);const HX=PX("anisotropy.texture");(0,n.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",HX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",HX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",HX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",sX,(()=>1))]);const oX=PX("clearCoat.texture");(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",oX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",oX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",oX.rotation);const TX=PX("clearCoat.bumpTexture");(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new vX(w.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",TX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",TX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",TX.rotation);const YX=PX("clearCoat.textureRoughness");(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",YX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",YX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",YX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new vX(w.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new vX(w.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new vX(w.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new vX(w.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",sX,(()=>1))]);const JX=PX("iridescence.texture");(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",JX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",JX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",JX.rotation);const KX=PX("iridescence.thicknessTexture");(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",KX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",KX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",KX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new vX(w.e.ANIMATIONTYPE_COLOR3,"sheen.color",FX,(()=>3))]),(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",sX,(()=>1))]);const NX=PX("sheen.texture");(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",NX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",NX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",NX.rotation);const qX=PX("sheen.textureRoughness");(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",qX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",qX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",qX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new vX(w.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",FX,(()=>3))]);const nX=PX("metallicReflectanceTexture");(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",nX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",nX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",nX.rotation);const cX=PX("reflectanceTexture");(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",cX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",cX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",cX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",sX,(()=>1))]);const EX=PX("subSurface.refractionIntensityTexture");(0,n.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",EX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",EX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",EX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new vX(w.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",FX,(()=>3))]),(0,n.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new vX(w.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",sX,(()=>1))]),(0,n.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",sX,(()=>1))]);const BX=PX("subSurface.thicknessTexture");(0,n.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",BX.scale),(0,n.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",BX.offset),(0,n.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",BX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new vX(w.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",sX,(()=>1))]);const GX=PX("subSurface.translucencyIntensityTexture");(0,n.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",GX.scale),(0,n.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",GX.offset),(0,n.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",GX.rotation),(0,n.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new vX(w.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",FX,(()=>3))]);const bX=PX("subSurface.translucencyColorTexture");(0,n.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",bX.scale),(0,n.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",bX.offset),(0,n.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",bX.rotation),(0,n.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new ZX(w.e.ANIMATIONTYPE_COLOR3,"diffuse",FX,(()=>3))]),(0,n.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ZX(w.e.ANIMATIONTYPE_FLOAT,"intensity",sX,(()=>1))]),(0,n.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new ZX(w.e.ANIMATIONTYPE_FLOAT,"range",sX,(()=>1))]),(0,n.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ZX(w.e.ANIMATIONTYPE_FLOAT,"innerAngle",rX,(()=>1))]),(0,n.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ZX(w.e.ANIMATIONTYPE_FLOAT,"angle",rX,(()=>1))]),(0,n.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new ZX(w.e.ANIMATIONTYPE_COLOR3,"diffuse",FX,(()=>3))]),(0,n.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ZX(w.e.ANIMATIONTYPE_FLOAT,"intensity",sX,(()=>1))]);const pX="KHR_animation_pointer";class IX{constructor(Q){this.name=pX,this._loader=Q,this._pathToObjectConverter=(0,n.j)(this._loader.Hk)}get enabled(){return this._loader.isExtensionUsed(pX)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Q,X,C,l,h){var M;const f=null===(M=l.target.extensions)||void 0===M?void 0:M.KHR_animation_pointer;if(!f||!this._pathToObjectConverter)return null;"pointer"!==l.target.path&&F.c.Warn(`${Q}/target/path: Value (${l.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=l.target.node&&F.c.Warn(`${Q}/target/node: Value (${l.target.node}) must not be present when using the ${this.name} extension`);const O=`${Q}/extensions/${this.name}`,m=f.pointer;if(!m)throw new Error(`${O}: Pointer is missing`);try{const M=this._pathToObjectConverter.convert(m);if(!M.info.interpolation)throw new Error(`${O}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Q,X,C,l,{object:M.object,info:M.info.interpolation},h)}catch(W){return F.c.Warn(`${O}/pointer: Invalid pointer (${m}) skipped`),null}}}q(pX),N(pX,!0,(Q=>new IX(Q)));class tX{constructor(Q,X,C){this.frame=Q,this.action=X,this.onlyOnce=C,this.isDone=!1}_clone(){return new tX(this.frame,this.action,this.onlyOnce)}}var yX=C(509),AX=C(554),DX=C(550);class uX{get loop(){return this._loop}set loop(Q){Q!==this._loop&&(this._loop=Q,this.updateOptions({loop:Q}))}get currentTime(){var Q;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.audioContext&&(this.isPlaying||this.isPaused)){const Q=this.isPaused?0:AX.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Q}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Q){if(Q==this._spatialSound)return;const X=this.isPlaying;this.pause(),Q?(this._spatialSound=Q,this._updateSpatialParameters()):this._disableSpatialSound(),X&&this.play()}constructor(Q,X,C){var l;let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new U.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=h.k.Zero(),this._localDirection=new h.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Q,C=C||a.b.LastCreatedScene)if(this._scene=C,uX._SceneComponentInitialization(C),this._readyToPlayCallback=M,this._customAttenuationFunction=(Q,X,C,l,h)=>X<C?Q*(1-X/C):0,O&&(this.autoplay=O.autoplay||!1,this._loop=O.loop||!1,void 0!==O.volume&&(this._volume=O.volume),this._spatialSound=O.spatialSound??!1,this.maxDistance=O.maxDistance??100,this.useCustomAttenuation=O.useCustomAttenuation??!1,this.rolloffFactor=O.rolloffFactor||1,this.refDistance=O.refDistance||1,this.distanceModel=O.distanceModel||"linear",this._playbackRate=O.playbackRate||1,this._streaming=O.streaming??!1,this._length=O.length,this._offset=O.offset),null!==(l=AX.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&AX.e.audioEngine.audioContext){this._soundGain=AX.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Q=!0;if(X)try{"string"===typeof X?(this._urlType="String",this._url=X):X instanceof ArrayBuffer?this._urlType="ArrayBuffer":X instanceof HTMLMediaElement?this._urlType="MediaElement":X instanceof MediaStream?this._urlType="MediaStream":X instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(X)&&(this._urlType="Array");let C=[],l=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=AX.e.audioEngine.audioContext.createMediaElementSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=AX.e.audioEngine.audioContext.createMediaStreamSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":X.byteLength>0&&(l=!0,this._soundLoaded(X));break;case"AudioBuffer":this._audioBufferLoaded(X);break;case"String":C.push(X);case"Array":0===C.length&&(C=X);for(let Q=0;Q<C.length;Q++){const X=C[Q];if(l=O&&O.skipCodecCheck||-1!==X.indexOf(".mp3",X.length-4)&&AX.e.audioEngine.isMP3supported||-1!==X.indexOf(".ogg",X.length-4)&&AX.e.audioEngine.isOGGsupported||-1!==X.indexOf(".wav",X.length-4)||-1!==X.indexOf(".m4a",X.length-4)||-1!==X.indexOf(".mp4",X.length-4)||-1!==X.indexOf("blob:"),l){this._streaming?(this._htmlAudioElement=new Audio(X),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,f.i.SetCorsBehavior(X,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(X,(Q=>{this._soundLoaded(Q)}),void 0,!0,!0,(Q=>{Q&&F.c.Error("XHR "+Q.status+" error on: "+X+"."),F.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Q=!1}Q?l||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):F.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(m){F.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),AX.e.audioEngine&&!AX.e.audioEngine.WarnedWebAudioUnsupported&&(F.c.Error("Web Audio is not supported by your browser."),AX.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Q;null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Q){var X;null!==(X=AX.e.audioEngine)&&void 0!==X&&X.audioContext&&(this._audioBuffer=Q,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Q){var X;null!==(X=AX.e.audioEngine)&&void 0!==X&&X.audioContext&&AX.e.audioEngine.audioContext.decodeAudioData(Q,(Q=>{this._audioBufferLoaded(Q)}),(Q=>{F.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+Q)}))}setAudioBuffer(Q){var X;null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&(this._audioBuffer=Q,this._isReadyToPlay=!0)}updateOptions(Q){Q&&(this.loop=Q.loop??this.loop,this.maxDistance=Q.maxDistance??this.maxDistance,this.useCustomAttenuation=Q.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Q.rolloffFactor??this.rolloffFactor,this.refDistance=Q.refDistance??this.refDistance,this.distanceModel=Q.distanceModel??this.distanceModel,this._playbackRate=Q.playbackRate??this._playbackRate,this._length=Q.length??void 0,this.spatialSound=Q.spatialSound??this._spatialSound,this._setOffset(Q.offset??void 0),this.setVolume(Q.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Q;null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&AX.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??AX.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Q;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Q=this._soundPanner)||void 0===Q||Q.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Q;null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Q){var X;null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Q),this._isOutputConnected=!0)}setDirectionalCone(Q,X,C){X<Q?F.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Q,this._coneOuterAngle=X,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Q){if(Q!=this._coneInnerAngle){var X;if(this._coneOuterAngle<Q)return void F.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Q,null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Q){if(Q!=this._coneOuterAngle){var X;if(Q<this._coneInnerAngle)return void F.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Q,null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Q){var X;Q.equals(this._position)||(this._position.p(Q),null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Q){var X;this._localDirection=Q,null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Q=this._connectedTransformNode.getWorldMatrix(),X=h.k.TransformNormal(this._localDirection,Q);X.normalize(),this._soundPanner.orientationX.value=X.x,this._soundPanner.orientationY.value=X.y,this._soundPanner.orientationZ.value=X.z}updateDistanceFromListener(){var Q;if(null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Q=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Od(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Q,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Q){this._customAttenuationFunction=Q}play(Q,X,C){var l;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(l=AX.e.audioEngine)&&void 0!==l&&l.audioContext)try{var h,M;this._clearTimeoutsAndObservers();let l=Q?(null===(h=AX.e.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+Q:null===(M=AX.e.audioEngine)||void 0===M?void 0:M.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=AX.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Q=()=>{var C;if(null!==(C=AX.e.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=X??0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var X,C;(null===(X=AX.e.audioEngine)||void 0===X||X.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=AX.e.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{Q()})))}))}else{var l;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(l=AX.e.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{Q()}))}};Q()}}else{var f;const h=()=>{var h;if(null!==(h=AX.e.audioEngine)&&void 0!==h&&h.audioContext){var M;if(C=C||this._length,void 0!==X&&this._setOffset(X),this._soundSource){const Q=this._soundSource;Q.onended=()=>{Q.disconnect()}}if(this._soundSource=null===(M=AX.e.audioEngine)||void 0===M?void 0:M.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var f;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==X&&(this._soundSource.loopStart=X),void 0!==C&&(this._soundSource.loopEnd=(0|X)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},l=Q?(null===(f=AX.e.audioEngine)||void 0===f?void 0:f.audioContext.currentTime)+Q:AX.e.audioEngine.audioContext.currentTime;const h=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(l,h,this.loop?void 0:C)}}};"suspended"===(null===(f=AX.e.audioEngine)||void 0===f?void 0:f.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Q;"suspended"===(null===(Q=AX.e.audioEngine)||void 0===Q?void 0:Q.audioContext.state)?(AX.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=AX.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{h()})))):h()}),500):h()}this._startTime=l,this.isPlaying=!0,this.isPaused=!1}catch(O){F.c.Error("Error while trying to play audio: "+this.name+", "+O.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Q){var X;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(X=AX.e.audioEngine)&&void 0!==X&&X.audioContext&&this._soundSource){const X=Q?AX.e.audioEngine.audioContext.currentTime+Q:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(X)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=AX.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Q,X){var C;null!==(C=AX.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(X&&AX.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(AX.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,AX.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Q,AX.e.audioEngine.audioContext.currentTime+X)):this._soundGain.gain.value=Q),this._volume=Q}setPlaybackRate(Q){this._playbackRate=Q,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Q){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Q,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Q=>this._onRegisterAfterWorldMatrixUpdate(Q),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Q){var X;if(Q.getBoundingInfo){const X=Q.getBoundingInfo();this.setPosition(X.boundingSphere.centerWorld)}else this.setPosition(Q.absolutePosition);null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Q=()=>{(0,DX.e)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},X={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new uX(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,X);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),Q(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Q={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Q.connectedMeshId=this._connectedTransformNode.id),Q.position=this._position.dk(),Q.refDistance=this.refDistance,Q.distanceModel=this.distanceModel,Q.isDirectional=this._isDirectional,Q.localDirectionToMesh=this._localDirection.dk(),Q.coneInnerAngle=this._coneInnerAngle,Q.coneOuterAngle=this._coneOuterAngle,Q.coneOuterGain=this._coneOuterGain),Q}static Parse(Q,X,C,l){const M=Q.name;let f;f=Q.url?C+Q.url:C+M;const O={autoplay:Q.autoplay,loop:Q.loop,volume:Q.volume,spatialSound:Q.spatialSound,maxDistance:Q.maxDistance,rolloffFactor:Q.rolloffFactor,refDistance:Q.refDistance,distanceModel:Q.distanceModel,playbackRate:Q.playbackRate};let m;if(l){const Q=()=>{(0,DX.e)((()=>l._isReadyToPlay),(()=>{m._audioBuffer=l.getAudioBuffer(),m._isReadyToPlay=!0,m.autoplay&&m.play(0,m._offset,m._length)}),void 0,300)};m=new uX(M,new ArrayBuffer(0),X,null,O),Q()}else m=new uX(M,f,X,(()=>{X.removePendingData(m)}),O),X.addPendingData(m);if(Q.position){const X=h.k.Wj(Q.position);m.setPosition(X)}if(Q.isDirectional&&(m.setDirectionalCone(Q.coneInnerAngle||360,Q.coneOuterAngle||360,Q.coneOuterGain||0),Q.localDirectionToMesh)){const X=h.k.Wj(Q.localDirectionToMesh);m.setLocalDirectionToMesh(X)}if(Q.connectedMeshId){const C=X.getMeshById(Q.connectedMeshId);C&&m.attachToMesh(C)}return Q.metadata&&(m.metadata=Q.metadata),m}_setOffset(Q){this._offset!==Q&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Q)}_clearTimeoutsAndObservers(){var Q;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Q=AX.e.audioEngine)||void 0===Q||Q.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}uX._SceneComponentInitialization=Q=>{throw(0,yX.c)("AudioSceneComponent")},(0,vQ.g)("BABYLON.Sound",uX);class VX{constructor(Q,X,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],X.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=Q,this._weights=C;let l=0;for(const M of C)l+=M;const h=l>0?1/l:0;for(let M=0;M<this._weights.length;M++)this._weights[M]*=h;this._sounds=X;for(const M of this._sounds)M.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Q){if(Q!==this._coneInnerAngle){if(this._coneOuterAngle<Q)return void F.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Q;for(const X of this._sounds)X.directionalConeInnerAngle=Q}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Q){if(Q!==this._coneOuterAngle){if(Q<this._coneInnerAngle)return void F.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Q;for(const X of this._sounds)X.directionalConeOuterAngle=Q}}get volume(){return this._volume}set volume(Q){if(Q!==this._volume)for(const X of this._sounds)X.setVolume(Q)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Q){if(!this.isPaused){this.stop();const Q=Math.random();let X=0;for(let C=0;C<this._weights.length;C++)if(X+=this._weights[C],Q<=X){this._currentIndex=C;break}}const X=this._sounds[this._currentIndex??0];X.isReady()?X.play(0,this.isPaused?void 0:Q):X.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class dX{constructor(Q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Q=Q||a.b.LastCreatedScene)&&(this._scene=Q,this.soundCollection=[],this._options=X,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Q;null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&AX.e.audioEngine.audioContext&&(this._outputAudioNode=AX.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(AX.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(AX.e.audioEngine&&AX.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Q){var X;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&Q.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Q.soundTrackId&&(-1===Q.soundTrackId?this._scene.mainSoundTrack.removeSound(Q):this._scene.soundTracks&&this._scene.soundTracks[Q.soundTrackId].removeSound(Q)),this.soundCollection.push(Q),Q.soundTrackId=this.id}removeSound(Q){const X=this.soundCollection.indexOf(Q);-1!==X&&this.soundCollection.splice(X,1)}setVolume(Q){var X;null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Q)}switchPanningModelToHRTF(){var Q;if(null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Q;if(null!==(Q=AX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToEqualPower()}connectToAnalyser(Q){var X;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Q,null!==(X=AX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,AX.e.audioEngine.masterGain))}}var QC=C(863),XC=C(2522),CC=C(494);AX.e.AudioEngineFactory=(Q,X,C)=>new lC(Q,X,C);class lC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new U.e,this.onAudioLockedObservable=new U.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CC.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const l=document.createElement("audio");this._hostElement=Q,this._audioContext=X,this._audioDestination=C;try{l&&l.canPlayType&&(l.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||l.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(h){}try{l&&l.canPlayType&&l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(h){}}lock(){this._triggerSuspendedState()}unlock(){var Q,X;if("running"===(null===(Q=this._audioContext)||void 0===Q?void 0:Q.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(X=this._audioContext)||void 0===X||X.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{F.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Q;null===(Q=this._audioContext)||void 0===Q||Q.addEventListener("statechange",(()=>{var Q;this.unlocked&&"running"!==(null===(Q=this._audioContext)||void 0===Q?void 0:Q.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Q;return null!==(Q=this._audioContext)&&void 0!==Q&&Q.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Q){this.canUseWebAudio=!1,F.c.Error("Web Audio: "+Q.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Q){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Q=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",X=document.createElement("style");X.appendChild(document.createTextNode(Q)),document.getElementsByTagName("head")[0].appendChild(X),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Q;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Q=this._audioContext)||void 0===Q||Q.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Q){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Q)}connectToAnalyser(Q){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Q,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var hC=C(507);(0,C(12749).f)(QC.b.NAME_AUDIO,((Q,X,C,l)=>{let h,M=[];if(C.fm=C.fm||[],void 0!==Q.fm&&null!==Q.fm)for(let O=0,m=Q.fm.length;O<m;O++){var f;const m=Q.fm[O];null!==(f=AX.e.audioEngine)&&void 0!==f&&f.canUseWebAudio?(m.url||(m.url=m.name),M[m.url]?C.fm.push(uX.Parse(m,X,l,M[m.url])):(h=uX.Parse(m,X,l),M[m.url]=h,C.fm.push(h))):C.fm.push(new uX(m.name,null,X))}M=[]})),Object.defineProperty(XC.e.prototype,"mainSoundTrack",{get:function(){let Q=this._getComponent(QC.b.NAME_AUDIO);return Q||(Q=new MC(this),this.bb(Q)),this._mainSoundTrack||(this._mainSoundTrack=new dX(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),XC.e.prototype.getSoundByName=function(Q){let X;for(X=0;X<this.mainSoundTrack.soundCollection.length;X++)if(this.mainSoundTrack.soundCollection[X].name===Q)return this.mainSoundTrack.soundCollection[X];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(X=0;X<this.soundTracks[C].soundCollection.length;X++)if(this.soundTracks[C].soundCollection[X].name===Q)return this.soundTracks[C].soundCollection[X];return null},Object.defineProperty(XC.e.prototype,"audioEnabled",{get:function(){let Q=this._getComponent(QC.b.NAME_AUDIO);return Q||(Q=new MC(this),this.bb(Q)),Q.audioEnabled},set:function(Q){let X=this._getComponent(QC.b.NAME_AUDIO);X||(X=new MC(this),this.bb(X)),Q?X.enableAudio():X.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(XC.e.prototype,"headphone",{get:function(){let Q=this._getComponent(QC.b.NAME_AUDIO);return Q||(Q=new MC(this),this.bb(Q)),Q.headphone},set:function(Q){let X=this._getComponent(QC.b.NAME_AUDIO);X||(X=new MC(this),this.bb(X)),Q?X.switchAudioModeForHeadphones():X.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(XC.e.prototype,"audioListenerPositionProvider",{get:function(){let Q=this._getComponent(QC.b.NAME_AUDIO);return Q||(Q=new MC(this),this.bb(Q)),Q.audioListenerPositionProvider},set:function(Q){let X=this._getComponent(QC.b.NAME_AUDIO);if(X||(X=new MC(this),this.bb(X)),Q&&"function"!==typeof Q)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");X.audioListenerPositionProvider=Q},enumerable:!0,configurable:!0}),Object.defineProperty(XC.e.prototype,"audioListenerRotationProvider",{get:function(){let Q=this._getComponent(QC.b.NAME_AUDIO);return Q||(Q=new MC(this),this.bb(Q)),Q.audioListenerRotationProvider},set:function(Q){let X=this._getComponent(QC.b.NAME_AUDIO);if(X||(X=new MC(this),this.bb(X)),Q&&"function"!==typeof Q)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");X.audioListenerRotationProvider=Q},enumerable:!0,configurable:!0}),Object.defineProperty(XC.e.prototype,"audioPositioningRefreshRate",{get:function(){let Q=this._getComponent(QC.b.NAME_AUDIO);return Q||(Q=new MC(this),this.bb(Q)),Q.audioPositioningRefreshRate},set:function(Q){let X=this._getComponent(QC.b.NAME_AUDIO);X||(X=new MC(this),this.bb(X)),X.audioPositioningRefreshRate=Q},enumerable:!0,configurable:!0});class MC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Q){this.name=QC.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new h.k,this._cachedCameraPosition=new h.k,this._lastCheck=0,this._invertMatrixTemp=new h.b,this._cameraDirectionTemp=new h.k,(Q=Q||a.b.LastCreatedScene)&&(this.ld=Q,Q.soundTracks=[],Q.fm=[])}register(){this.ld._afterRenderStage.registerStep(QC.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Q){if(Q.fm=[],this.ld.soundTracks)for(let X=0;X<this.ld.soundTracks.length;X++){const C=this.ld.soundTracks[X];for(let X=0;X<C.soundCollection.length;X++)Q.fm.push(C.soundCollection[X].serialize())}}addFromContainer(Q){if(Q.fm)for(const X of Q.fm)X.play(),X.autoplay=!0,this.ld.mainSoundTrack.addSound(X)}removeFromContainer(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Q.fm)for(const C of Q.fm)C.stop(),C.autoplay=!1,this.ld.mainSoundTrack.removeSound(C),X&&C.dispose()}dispose(){const Q=this.ld;if(Q._mainSoundTrack&&Q.mainSoundTrack.dispose(),Q.soundTracks)for(let X=0;X<Q.soundTracks.length;X++)Q.soundTracks[X].dispose()}disableAudio(){const Q=this.ld;let X;for(this._audioEnabled=!1,AX.e.audioEngine&&AX.e.audioEngine.audioContext&&AX.e.audioEngine.audioContext.suspend(),X=0;X<Q.mainSoundTrack.soundCollection.length;X++)Q.mainSoundTrack.soundCollection[X].pause();if(Q.soundTracks)for(X=0;X<Q.soundTracks.length;X++)for(let C=0;C<Q.soundTracks[X].soundCollection.length;C++)Q.soundTracks[X].soundCollection[C].pause()}enableAudio(){const Q=this.ld;let X;for(this._audioEnabled=!0,AX.e.audioEngine&&AX.e.audioEngine.audioContext&&AX.e.audioEngine.audioContext.resume(),X=0;X<Q.mainSoundTrack.soundCollection.length;X++)Q.mainSoundTrack.soundCollection[X].isPaused&&Q.mainSoundTrack.soundCollection[X].play();if(Q.soundTracks)for(X=0;X<Q.soundTracks.length;X++)for(let C=0;C<Q.soundTracks[X].soundCollection.length;C++)Q.soundTracks[X].soundCollection[C].isPaused&&Q.soundTracks[X].soundCollection[C].play()}switchAudioModeForHeadphones(){const Q=this.ld;if(this._headphone=!0,Q.mainSoundTrack.switchPanningModelToHRTF(),Q.soundTracks)for(let X=0;X<Q.soundTracks.length;X++)Q.soundTracks[X].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Q=this.ld;if(this._headphone=!1,Q.mainSoundTrack.switchPanningModelToEqualPower(),Q.soundTracks)for(let X=0;X<Q.soundTracks.length;X++)Q.soundTracks[X].switchPanningModelToEqualPower()}_afterRender(){const Q=hC.c.Now;if(this._lastCheck&&Q-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Q;const X=this.ld;if(!this._audioEnabled||!X._mainSoundTrack||!X.soundTracks||0===X._mainSoundTrack.soundCollection.length&&1===X.soundTracks.length)return;const C=AX.e.audioEngine;if(C&&C.audioContext){let Q,l=X.activeCamera;if(X.activeCameras&&X.activeCameras.length>0&&(l=X.activeCameras[0]),this.audioListenerPositionProvider){const Q=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(Q.x||0,Q.y||0,Q.z||0)}else l?this._cachedCameraPosition.equals(l.globalPosition)||(this._cachedCameraPosition.p(l.globalPosition),C.audioContext.listener.setPosition(l.globalPosition.x,l.globalPosition.y,l.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Q=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(Q.x||0,Q.y||0,Q.z||0,0,1,0)}else l?(l.rigCameras&&l.rigCameras.length>0&&(l=l.rigCameras[0]),l.getViewMatrix().invertToRef(this._invertMatrixTemp),h.k.TransformNormalToRef(MC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Q=0;Q<X.mainSoundTrack.soundCollection.length;Q++){const C=X.mainSoundTrack.soundCollection[Q];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(X.soundTracks)for(Q=0;Q<X.soundTracks.length;Q++)for(let C=0;C<X.soundTracks[Q].soundCollection.length;C++){const l=X.soundTracks[Q].soundCollection[C];l.useCustomAttenuation&&l.updateDistanceFromListener()}}}}MC._CameraDirection=new h.k(0,0,-1),uX._SceneComponentInitialization=Q=>{let X=Q._getComponent(QC.b.NAME_AUDIO);X||(X=new MC(Q),Q.bb(X))};const fC="MSFT_audio_emitter";class OC{constructor(Q){this.name=fC,this._loader=Q,this.enabled=this._loader.isExtensionUsed(fC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Q=this._loader.Hk.extensions;if(Q&&Q[this.name]){const X=Q[this.name];this._clips=X.clips,this._emitters=X.emitters,B.Assign(this._clips),B.Assign(this._emitters)}}loadSceneAsync(Q,X){return b.LoadExtensionAsync(Q,X,this.name,(async(C,l)=>{const h=new Array;h.push(this._loader.loadSceneAsync(Q,X));for(const Q of l.emitters){const X=B.Get(`${C}/emitters`,this._emitters,Q);if(void 0!=X.refDistance||void 0!=X.maxDistance||void 0!=X.rolloffFactor||void 0!=X.distanceModel||void 0!=X.innerAngle||void 0!=X.outerAngle)throw new Error(`${C}: Direction or Distance properties are not allowed on emitters attached to a scene`);h.push(this._loadEmitterAsync(`${C}/emitters/${X.index}`,X))}await Promise.all(h)}))}loadNodeAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(Q,l)=>{const M=new Array,O=await this._loader.loadNodeAsync(Q,X,(X=>{for(const C of l.emitters){const l=B.Get(`${Q}/emitters`,this._emitters,C);M.push(this._loadEmitterAsync(`${Q}/emitters/${l.index}`,l).then((()=>{for(const Q of l._babylonSounds)Q.attachToMesh(X),void 0==l.innerAngle&&void 0==l.outerAngle||(Q.setLocalDirectionToMesh(h.k.Forward()),Q.setDirectionalCone(2*f.i.ToDegrees(void 0==l.innerAngle?Math.PI:l.innerAngle),2*f.i.ToDegrees(void 0==l.outerAngle?Math.PI:l.outerAngle),0))})))}C(X)}));return await Promise.all(M),O}))}loadAnimationAsync(Q,X){return b.LoadExtensionAsync(Q,X,this.name,(async(C,l)=>{const h=await this._loader.loadAnimationAsync(Q,X),M=new Array;B.Assign(l.events);for(const f of l.events)M.push(this._loadAnimationEventAsync(`${C}/events/${f.index}`,Q,X,f,h));return await Promise.all(M),h}))}_loadClipAsync(Q,X){if(X._objectURL)return X._objectURL;let C;if(X.uri)C=this._loader.loadUriAsync(Q,X,X.uri);else{const l=B.Get(`${Q}/bufferView`,this._loader.Hk.bufferViews,X.bufferView);C=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}return X._objectURL=C.then((Q=>URL.createObjectURL(new Blob([Q],{type:X.mimeType})))),X._objectURL}_loadEmitterAsync(Q,X){if(X._babylonSounds=X._babylonSounds||[],!X._babylonData){const Q=new Array,C=X.name||`emitter${X.index}`,l={loop:!1,autoplay:!1,volume:void 0==X.volume?1:X.volume};for(let M=0;M<X.clips.length;M++){const h=`/extensions/${this.name}/clips`,f=B.Get(h,this._clips,X.clips[M].clip);Q.push(this._loadClipAsync(`${h}/${X.clips[M].clip}`,f).then((Q=>{const h=X._babylonSounds[M]=new uX(C,Q,this._loader.babylonScene,null,l);h.refDistance=X.refDistance||1,h.maxDistance=X.maxDistance||256,h.rolloffFactor=X.rolloffFactor||1,h.distanceModel=X.distanceModel||"exponential"})))}const h=Promise.all(Q).then((()=>{const Q=X.clips.map((Q=>Q.weight||1)),C=new VX(X.loop||!1,X._babylonSounds,Q);X.innerAngle&&(C.directionalConeInnerAngle=2*f.i.ToDegrees(X.innerAngle)),X.outerAngle&&(C.directionalConeOuterAngle=2*f.i.ToDegrees(X.outerAngle)),X.volume&&(C.volume=X.volume),X._babylonData.sound=C}));X._babylonData={loaded:h}}return X._babylonData.loaded}_getEventAction(Q,X,C,l,h){switch(C){case"play":return Q=>{const C=(h||0)+(Q-l);X.play(C)};case"stop":return()=>{X.stop()};case"pause":return()=>{X.pause()};default:throw new Error(`${Q}: Unsupported action ${C}`)}}_loadAnimationEventAsync(Q,X,C,l,h){if(0==h.targetedAnimations.length)return Promise.resolve();const M=h.targetedAnimations[0],f=l.j,O=B.Get(`/extensions/${this.name}/emitters`,this._emitters,f);return this._loadEmitterAsync(Q,O).then((()=>{const X=O._babylonData.sound;if(X){const C=new tX(l.time,this._getEventAction(Q,X,l.action,l.time,l.startOffset));M.animation.addEvent(C),h.onAnimationGroupEndObservable.add((()=>{X.stop()})),h.onAnimationGroupPauseObservable.add((()=>{X.pause()}))}}))}}q(fC),N(fC,!0,(Q=>new OC(Q)));const mC="MSFT_lod";class WC{constructor(Q){var X;this.name=mC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new U.e,this.onMaterialLODsLoadedObservable=new U.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Q,this.maxLODsToLoad=(null===(X=this._loader.parent.extensionOptions[mC])||void 0===X?void 0:X.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(mC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Q=0;Q<this._nodePromiseLODs.length;Q++){const X=Promise.all(this._nodePromiseLODs[Q]).then((()=>{0!==Q&&(this._loader.endPerformanceCounter(`Node LOD ${Q}`),this._loader.log(`Loaded node LOD ${Q}`)),this.onNodeLODsLoadedObservable.notifyObservers(Q),Q!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Q+1}`),this._loadBufferLOD(this._nodeBufferLODs,Q+1),this._nodeSignalLODs[Q]&&this._nodeSignalLODs[Q].resolve())}));this._loader._completePromises.push(X)}for(let Q=0;Q<this._materialPromiseLODs.length;Q++){const X=Promise.all(this._materialPromiseLODs[Q]).then((()=>{0!==Q&&(this._loader.endPerformanceCounter(`Material LOD ${Q}`),this._loader.log(`Loaded material LOD ${Q}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Q),Q!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Q+1}`),this._loadBufferLOD(this._materialBufferLODs,Q+1),this._materialSignalLODs[Q]&&this._materialSignalLODs[Q].resolve())}));this._loader._completePromises.push(X)}}loadSceneAsync(Q,X){const C=this._loader.loadSceneAsync(Q,X);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(Q,X,C){return b.LoadExtensionAsync(Q,X,this.name,(async(Q,h)=>{let M;const f=this._getLODs(Q,X,this._loader.Hk.nodes,h.ids);this._loader.logOpen(`${Q}`);for(let X=0;X<f.length;X++){const Q=f[X];0!==X&&(this._nodeIndexLOD=X,this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new l);const h=Q=>{C(Q),Q.bc(!1)},O=this._loader.loadNodeAsync(`/nodes/${Q.index}`,Q,h).then((Q=>{if(0!==X){const Q=f[X-1];Q._babylonTransformNode&&(this._disposeTransformNode(Q._babylonTransformNode),delete Q._babylonTransformNode)}return Q.bc(!0),Q}));this._nodePromiseLODs[X]=this._nodePromiseLODs[X]||[],0===X?M=O:(this._nodeIndexLOD=null,this._nodePromiseLODs[X].push(O))}return this._loader.logClose(),await M}))}_loadMaterialAsync(Q,X,C,l,h){return this._nodeIndexLOD?null:b.LoadExtensionAsync(Q,X,this.name,(async(Q,M)=>{let f;const O=this._getLODs(Q,X,this._loader.Hk.materials,M.ids);this._loader.logOpen(`${Q}`);for(let X=0;X<O.length;X++){const Q=O[X];0!==X&&(this._materialIndexLOD=X);const M=this._loader._loadMaterialAsync(`/materials/${Q.index}`,Q,C,l,(Q=>{0===X&&h(Q)})).then((Q=>{if(0!==X){h(Q);const C=O[X-1]._data;C[l]&&(this._disposeMaterials([C[l].babylonMaterial]),delete C[l])}return Q}));this._materialPromiseLODs[X]=this._materialPromiseLODs[X]||[],0===X?f=M:(this._materialIndexLOD=null,this._materialPromiseLODs[X].push(M))}return this._loader.logClose(),await f}))}_loadUriAsync(Q,X,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const h=this._nodeIndexLOD-1;return this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new l,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Q,X,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const h=this._materialIndexLOD-1;return this._materialSignalLODs[h]=this._materialSignalLODs[h]||new l,this._materialSignalLODs[h].promise.then((async()=>await this._loader.loadUriAsync(Q,X,C)))}return null}loadBufferAsync(Q,X,C,h){if(this._loader.parent.useRangeRequests&&!X.uri){if(!this._loader.bin)throw new Error(`${Q}: Uri is missing or the binary glTF is missing its binary chunk`);const X=async(Q,X)=>{const M=C,f=M+h-1;let O=Q[X];return O?(O.start=Math.min(O.start,M),O.end=Math.max(O.end,f)):(O={start:M,end:f,loaded:new l},Q[X]=O),await O.loaded.promise.then((Q=>new Uint8Array(Q.buffer,Q.byteOffset+C-O.start,h)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?X(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?X(this._materialBufferLODs,this._materialIndexLOD):X(this._bufferLODs,0)}return null}_loadBufferLOD(Q,X){const C=Q[X];C&&(this._loader.log(`Loading buffer range [${C.start}-${C.end}]`),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((Q=>{C.loaded.resolve(Q)}),(Q=>{C.loaded.reject(Q)})))}_getLODs(Q,X,C,l){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const h=[];for(let M=l.length-1;M>=0;M--)if(h.push(B.Get(`${Q}/ids/${l[M]}`,C,l[M])),h.length===this.maxLODsToLoad)return h;return h.push(X),h}_disposeTransformNode(Q){const X=[],C=Q.material;C&&X.push(C);for(const h of Q.getChildMeshes())h.material&&X.push(h.material);Q.dispose();const l=X.filter((Q=>this._loader.babylonScene.meshes.every((X=>X.material!=Q))));this._disposeMaterials(l)}_disposeMaterials(Q){const X={};for(const C of Q){for(const Q of C.getActiveTextures())X[Q.uniqueId]=Q;C.dispose()}for(const C in X)for(const Q of this._loader.babylonScene.materials)Q.hasTexture(X[C])&&delete X[C];for(const C in X)X[C].dispose()}}q(mC),N(mC,!0,(Q=>new WC(Q)));const UC="MSFT_minecraftMesh";class LC{constructor(Q){this.name=UC,this._loader=Q,this.enabled=this._loader.isExtensionUsed(UC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtraAsync(Q,X,this.name,(async(l,h)=>{if(h){if(!(C instanceof r.b))throw new Error(`${l}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(Q,X,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.fk=C.forceDepthWrite,C.twoSidedLighting=!0,await h}}))}}q(UC),N(UC,!0,(Q=>new LC(Q)));const wC="MSFT_sRGBFactors";class iC{constructor(Q){this.name=wC,this._loader=Q,this.enabled=this._loader.isExtensionUsed(wC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Q,X,C){return b.LoadExtraAsync(Q,X,this.name,(async(l,h)=>{if(h){if(!(C instanceof r.b))throw new Error(`${l}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(Q,X,C),M=C.va().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,M),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,M),await h}}))}}q(wC),N(wC,!0,(Q=>new iC(Q)));var aC=C(13048);const FC={};var sC=C(13107),zC=C(13083),xC=C(13052),rC=C(13063);function PC(Q,X){for(const C of Q)for(const Q of C.dataOutputs)if(Q.uniqueId===X)return Q;throw new Error("Could not find data out connection with unique id "+X)}function jC(Q,X){for(const C of Q)if(C instanceof zC.b)for(const Q of C.signalInputs)if(Q.uniqueId===X)return Q;throw new Error("Could not find signal in connection with unique id "+X)}async function vC(Q,X){const l=await Promise.all(Q.allBlocks.map((async Q=>{const X=function(Q){switch(Q){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(62),C.e(63)]).then(C.bind(C,14250))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(64).then(C.bind(C,14258))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(65).then(C.bind(C,14266))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(66).then(C.bind(C,14274))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(67).then(C.bind(C,14281))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(68).then(C.bind(C,14285))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(69).then(C.bind(C,14289))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(70).then(C.bind(C,14294))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(71).then(C.bind(C,14300))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(74).then(C.bind(C,14341))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(74).then(C.bind(C,14341))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(74).then(C.bind(C,14341))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(74).then(C.bind(C,14341))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(79).then(C.bind(C,14345))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(80).then(C.bind(C,14352))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(81).then(C.bind(C,14355))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(82).then(C.bind(C,14363))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(83).then(C.bind(C,14370))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(84).then(C.bind(C,14377))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(85).then(C.bind(C,14386))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(86).then(C.bind(C,14389))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(87).then(C.bind(C,14393))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(88).then(C.bind(C,14397))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(89).then(C.bind(C,14406))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(90).then(C.bind(C,14411))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(91).then(C.bind(C,14414))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(92).then(C.bind(C,14422))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(93).then(C.bind(C,14425))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(94).then(C.bind(C,14431))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(95).then(C.bind(C,14433))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(96).then(C.bind(C,14437))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(97).then(C.bind(C,14446))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(76).then(C.bind(C,14450))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(98).then(C.bind(C,14452))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(99).then(C.bind(C,14461))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(100).then(C.bind(C,14469))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(77).then(C.bind(C,14473))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(72).then(C.bind(C,14308))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(78).then(C.bind(C,14477))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(73).then(C.bind(C,14335))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(74).then(C.bind(C,14341))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(74).then(C.bind(C,14341))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(75).then(C.bind(C,14484))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(75).then(C.bind(C,14484))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(75).then(C.bind(C,14484))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(75).then(C.bind(C,14484))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(75).then(C.bind(C,14484))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(75).then(C.bind(C,14484))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(101).then(C.bind(C,14486))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(102).then(C.bind(C,14492))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(103).then(C.bind(C,14497))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(104).then(C.bind(C,14506))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(105).then(C.bind(C,14513))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(106).then(C.bind(C,14515))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(107).then(C.bind(C,14520))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(108).then(C.bind(C,14526))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(109).then(C.bind(C,14529))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(110).then(C.bind(C,14532))).FlowGraphDataSwitchBlock;default:if(FC[Q])return FC[Q];throw new Error(`Unknown block name ${Q}`)}}(Q.className);return await X()})));return function(Q,X,C){const l=X.coordinator.createGraph(),h=[],M=X.valueParseFunction??xC.d;for(let f=0;f<Q.allBlocks.length;f++){const O=gC(Q.allBlocks[f],{ld:X.coordinator.config.ld,pathConverter:X.pathConverter,assetsContainer:X.coordinator.config.ld,valueParseFunction:M},C[f]);h.push(O),O instanceof sC.e&&l.addEventBlock(O)}for(const f of h){for(const Q of f.dataInputs)for(const X of Q.connectedPointIds){const C=PC(h,X);Q.connectTo(C)}if(f instanceof zC.b)for(const Q of f.signalOutputs)for(const X of Q.connectedPointIds){const C=jC(h,X);Q.connectTo(C)}}for(const f of Q.executionContexts)ZC(f,{graph:l,valueParseFunction:M},Q.rightHanded);return l}(Q,X,l)}function ZC(Q,X,C){const l=X.graph.createContext();Q.enableLogging&&(l.enableLogging=!0),l.treatDataAsRightHanded=C||!1;const h=X.valueParseFunction??xC.d;l.uniqueId=Q.uniqueId;const M=l.va();if(Q._assetsContext){var f,O,m,W,U,L,w,i,a,F;const X=Q._assetsContext,C={meshes:null===(f=X.meshes)||void 0===f?void 0:f.map((Q=>M.getMeshById(Q))),lights:null===(O=X.lights)||void 0===O?void 0:O.map((Q=>M.getLightByName(Q))),cameras:null===(m=X.cameras)||void 0===m?void 0:m.map((Q=>M.getCameraByName(Q))),materials:null===(W=X.materials)||void 0===W?void 0:W.map((Q=>M.getMaterialById(Q))),textures:null===(U=X.textures)||void 0===U?void 0:U.map((Q=>M.getTextureByName(Q))),animations:null===(L=X.animations)||void 0===L?void 0:L.map((Q=>M.animations.find((X=>X.name===Q)))),skeletons:null===(w=X.skeletons)||void 0===w?void 0:w.map((Q=>M.getSkeletonByName(Q))),tk:null===(i=X.tk)||void 0===i?void 0:i.map((Q=>M.getParticleSystemById(Q))),animationGroups:null===(a=X.animationGroups)||void 0===a?void 0:a.map((Q=>M.getAnimationGroupByName(Q))),transformNodes:null===(F=X.transformNodes)||void 0===F?void 0:F.map((Q=>M.getTransformNodeById(Q))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],fm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};l.assetsContext=C}for(const s in Q._userVariables){const X=h(s,Q._userVariables,l.assetsContext,M);l.userVariables[s]=X}for(const s in Q._connectionValues){const X=h(s,Q._connectionValues,l.assetsContext,M);l._setConnectionValueByKey(s,X)}return l}function gC(Q,X,C){const l={},h=X.valueParseFunction??xC.d;if(Q.config)for(const f in Q.config)l[f]=h(f,Q.config,X.assetsContainer||X.ld,X.ld);if((0,xC.i)(Q.className)){if(!X.pathConverter)throw new Error("Path converter is required for this block");l.pathConverter=X.pathConverter}const M=new C(l);M.uniqueId=Q.uniqueId;for(let f=0;f<Q.dataInputs.length;f++){const X=M.getDataInput(Q.dataInputs[f].name);if(!X)throw new Error("Could not find data input with name "+Q.dataInputs[f].name+" in block "+Q.className);X.deserialize(Q.dataInputs[f])}for(let f=0;f<Q.dataOutputs.length;f++){const X=M.getDataOutput(Q.dataOutputs[f].name);if(!X)throw new Error("Could not find data output with name "+Q.dataOutputs[f].name+" in block "+Q.className);X.deserialize(Q.dataOutputs[f])}return M.metadata=Q.metadata,M.deserialize&&M.deserialize(Q),M}function SC(Q){const[X,C]=Q.split(":");return eC({op:X,extension:C})}function eC(Q){var X;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=Q.extension?null===(X=RC[Q.extension])||void 0===X?void 0:X[Q.op]:HC[Q.op];if(!l&&(F.c.Warn(`No mapping found for operation ${Q.op} and extension ${Q.extension||"KHR_interactivity"}`),C)){const X={},C={flows:{}};if(Q.inputValueSockets){X.values={};for(const C in Q.inputValueSockets)X.values[C]={name:C}}return Q.outputValueSockets&&(C.values={},Object.keys(Q.outputValueSockets).forEach((Q=>{C.values[Q]={name:Q}}))),{Mk:[],inputs:X,outputs:C}}return l}function kC(Q,X,C){RC[X]||(RC[X]={}),RC[X][Q]=C}const RC={BABYLON:{"flow/log":{Mk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},HC={"event/onStart":{Mk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Mk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Mk:["FlowGraphSendCustomEventBlock"],extraProcessor(Q,X,C,l,h){if("event/send"!==X.op||!Q.configuration||1!==Object.keys(Q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const M=Q.configuration.event.value[0];if("number"!==typeof M)throw new Error("Event id should be a number");const f=l.arrays.events[M],O=h[0];return O.config||(O.config={}),O.config.eventId=f.eventId,O.config.eventData=f.eventData,h}},"event/receive":{Mk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Q,X){var C;if(!Q.configuration)return F.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const l=Q.configuration.event;if(!l)return F.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const h=l.value[0];if("number"!==typeof h)return F.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=X.events)||void 0===C?void 0:C[h])?{valid:!0}:(F.c.Error(`Event with id ${h} not found`),{valid:!1,error:`Event with id ${h} not found`})},extraProcessor(Q,X,C,l,h){if("event/receive"!==X.op||!Q.configuration||1!==Object.keys(Q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const M=Q.configuration.event.value[0];if("number"!==typeof M)throw new Error("Event id should be a number");const f=l.arrays.events[M],O=h[0];return O.config||(O.config={}),O.config.eventId=f.eventId,O.config.eventData=f.eventData,h}},"math/e":oC("FlowGraphEBlock"),"math/pi":oC("FlowGraphPIBlock"),"math/inf":oC("FlowGraphInfBlock"),"math/nan":oC("FlowGraphNaNBlock"),"math/abs":oC("FlowGraphAbsBlock"),"math/sign":oC("FlowGraphSignBlock"),"math/trunc":oC("FlowGraphTruncBlock"),"math/floor":oC("FlowGraphFloorBlock"),"math/ceil":oC("FlowGraphCeilBlock"),"math/round":{Mk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h){var M;return(M=h[0]).config||(M.config={}),h[0].config.roundHalfAwayFromZero=!0,h}},"math/fract":oC("FlowGraphFractBlock"),"math/neg":oC("FlowGraphNegationBlock"),"math/add":oC("FlowGraphAddBlock",["a","b"],!0),"math/sub":oC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Mk:["FlowGraphMultiplyBlock"],extraProcessor(Q,X,C,l,h){var M;(M=h[0]).config||(M.config={}),h[0].config.useMatrixPerComponent=!0,h[0].config.preventIntegerFloatArithmetic=!0;let f=-1;return Object.keys(Q.values||{}).find((X=>{var C;return void 0!==(null===(C=Q.values)||void 0===C?void 0:C[X].type)&&(f=Q.values[X].type,!0)})),-1!==f&&(h[0].config.type=l.arrays.types[f].flowGraphType),h},validation:Q=>Q.values?TC(Q):{valid:!0}},"math/div":oC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":oC("FlowGraphModuloBlock",["a","b"]),"math/min":oC("FlowGraphMinBlock",["a","b"]),"math/max":oC("FlowGraphMaxBlock",["a","b"]),"math/clamp":oC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":oC("FlowGraphSaturateBlock"),"math/mix":oC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":oC("FlowGraphEqualityBlock",["a","b"]),"math/lt":oC("FlowGraphLessThanBlock",["a","b"]),"math/le":oC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":oC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":oC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":oC("FlowGraphIsNaNBlock"),"math/isinf":oC("FlowGraphIsInfBlock"),"math/select":{Mk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Mk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":oC("FlowGraphSinBlock"),"math/cos":oC("FlowGraphCosBlock"),"math/tan":oC("FlowGraphTanBlock"),"math/asin":oC("FlowGraphASinBlock"),"math/acos":oC("FlowGraphACosBlock"),"math/atan":oC("FlowGraphATanBlock"),"math/atan2":oC("FlowGraphATan2Block",["a","b"]),"math/sinh":oC("FlowGraphSinhBlock"),"math/cosh":oC("FlowGraphCoshBlock"),"math/tanh":oC("FlowGraphTanhBlock"),"math/asinh":oC("FlowGraphASinhBlock"),"math/acosh":oC("FlowGraphACoshBlock"),"math/atanh":oC("FlowGraphATanhBlock"),"math/exp":oC("FlowGraphExponentialBlock"),"math/log":oC("FlowGraphLogBlock"),"math/log2":oC("FlowGraphLog2Block"),"math/log10":oC("FlowGraphLog10Block"),"math/sqrt":oC("FlowGraphSquareRootBlock"),"math/cbrt":oC("FlowGraphCubeRootBlock"),"math/pow":oC("FlowGraphPowerBlock",["a","b"]),"math/length":oC("FlowGraphLengthBlock"),"math/normalize":oC("FlowGraphNormalizeBlock"),"math/dot":oC("FlowGraphDotBlock",["a","b"]),"math/cross":oC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":oC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":oC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Mk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Mk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Mk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Mk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Mk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Mk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Mk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":oC("FlowGraphTransposeBlock"),"math/determinant":oC("FlowGraphDeterminantBlock"),"math/inverse":oC("FlowGraphInvertMatrixBlock"),"math/matmul":oC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Mk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"_c",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h,M){const f=h[0].dataInputs.find((Q=>"rotationQuaternion"===Q.name));if(!f)throw new Error("Rotation quaternion input not found");return M._connectionValues[f.uniqueId]&&(M._connectionValues[f.uniqueId].type="Quaternion"),h}},"math/matDecompose":{Mk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"_c"}}}},"math/quatConjugate":oC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Mk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h){var M;return(M=h[0]).config||(M.config={}),h[0].config.type="Quaternion",h}},"math/quatAngleBetween":oC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Mk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":oC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":oC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Mk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h){var M;return(M=h[0]).config||(M.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract2x2":{Mk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Mk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h){var M;return(M=h[0]).config||(M.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract3x3":{Mk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Mk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h){var M;return(M=h[0]).config||(M.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract4x4":{Mk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Mk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h,M){var f,O;(O=h[0]).config||(O.config={});const m=h[0].dataInputs[0];return h[0].config.valueType=(null===(f=M._connectionValues[m.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",h}},"math/and":{Mk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h,M){var f,O,m;(m=h[0]).config||(m.config={});const W=h[0].dataInputs[0],U=h[0].dataInputs[1];return h[0].config.valueType=(null===(f=M._connectionValues[W.uniqueId])||void 0===f?void 0:f.type)??(null===(O=M._connectionValues[U.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",h}},"math/or":{Mk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h,M){var f,O,m;(m=h[0]).config||(m.config={});const W=h[0].dataInputs[0],U=h[0].dataInputs[1];return h[0].config.valueType=(null===(f=M._connectionValues[W.uniqueId])||void 0===f?void 0:f.type)??(null===(O=M._connectionValues[U.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",h}},"math/xor":{Mk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,X,C,l,h,M){var f,O,m;(m=h[0]).config||(m.config={});const W=h[0].dataInputs[0],U=h[0].dataInputs[1];return h[0].config.valueType=(null===(f=M._connectionValues[W.uniqueId])||void 0===f?void 0:f.type)??(null===(O=M._connectionValues[U.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",h}},"math/asr":oC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":oC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":oC("FlowGraphLeadingZerosBlock"),"math/ctz":oC("FlowGraphTrailingZerosBlock"),"math/popcnt":oC("FlowGraphOneBitsCounterBlock"),"math/rad":oC("FlowGraphDegToRadBlock"),"math/deg":oC("FlowGraphRadToDegBlock"),"type/boolToInt":oC("FlowGraphBooleanToInt"),"type/boolToFloat":oC("FlowGraphBooleanToFloat"),"type/intToBool":oC("FlowGraphIntToBoolean"),"type/intToFloat":oC("FlowGraphIntToFloat"),"type/floatToInt":oC("FlowGraphFloatToInt"),"type/floatToBool":oC("FlowGraphFloatToBoolean"),"flow/sequence":{Mk:["FlowGraphSequenceBlock"],extraProcessor(Q,X,C,l,h){const M=h[0];return M.config||(M.config={}),M.config.outputSignalCount=Object.keys(Q.flows||[]).length,M.signalOutputs.forEach(((Q,X)=>{Q.name="out_"+X})),h}},"flow/branch":{Mk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Mk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Q){if(Q.configuration&&Q.configuration.cases){const X=Q.configuration.cases.value;if(!X.every((Q=>"number"===typeof Q&&/^-?\d+$/.test(Q.toString()))))return F.c.Warn("Switch cases should be integers. Using empty array instead."),Q.configuration.cases.value=[],{valid:!0};const C=new Set(X);Q.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(Q,X,C,l,h){if("flow/switch"!==X.op||!Q.flows||0===Object.keys(Q.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return h[0].signalOutputs.forEach((Q=>{"default"!==Q.name&&(Q.name="out_"+Q.name)})),h}},"flow/while":{Mk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Mk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Q,X,C,l,h){const M=h[0];return M.config||(M.config={}),M.config.incrementIndexWhenLoopDone=!0,h}},"flow/doN":{Mk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Mk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Q,X,C,l,h){if("flow/multiGate"!==X.op||!Q.flows||0===Object.keys(Q.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const M=h[0];return M.config||(M.config={}),M.config.outputSignalCount=Object.keys(Q.flows).length,M.signalOutputs.forEach(((Q,X)=>{Q.name="out_"+X})),h}},"flow/waitAll":{Mk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Q){var X,C;return"number"!==typeof(null===(X=Q.configuration)||void 0===X||null===(C=X.inputFlows)||void 0===C?void 0:C.value[0])&&(Q.configuration=Q.configuration||{inputFlows:{value:[0]}},Q.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Mk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Mk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Mk:["FlowGraphCancelDelayBlock"]},"variable/get":{Mk:["FlowGraphGetVariableBlock"],validation(Q){var X,C;return null!==(X=Q.configuration)&&void 0!==X&&null!==(C=X.variable)&&void 0!==C&&C.value?{valid:!0}:(F.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Q,X)=>[X.getVariableName(Q[0])]}}},"variable/set":{Mk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Q,X)=>[X.getVariableName(Q[0])]}}},"variable/setMultiple":{Mk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Q,X)=>[Q[0].map((Q=>X.getVariableName(Q)))]}},extraProcessor:(Q,X,C,l,h)=>(h[0].dataInputs.forEach((Q=>{Q.name=l.getVariableName(+Q.name)})),h)},"variable/interpolate":{Mk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Q,X)=>[X.getVariableName(Q[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Q=>!0===Q[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Q,X,C,l,h){var M,f,O;const m=h[0],W=null===(M=Q.configuration)||void 0===M?void 0:M.variable.value[0];if("number"!==typeof W)throw F.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const U=l.arrays.staticVariables[W];"undefined"===typeof m.config.animationType.value&&(l.arrays.staticVariables,m.config.animationType.value=(0,rC.C)(U.type));const L=h[4];return L.config||(L.config={}),(f=L.config).variable||(f.variable={}),L.config.variable.value=l.getVariableName(W),(O=h[3]).config||(O.config={}),h}},"pointer/get":{Mk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Q,X,C,l,h)=>(h.forEach((Q=>{"FlowGraphJsonPointerParserBlock"===Q.className&&(Q.config||(Q.config={}),Q.config.outputValue=!0)})),h)},"pointer/set":{Mk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Q,X,C,l,h)=>(h.forEach((Q=>{"FlowGraphJsonPointerParserBlock"===Q.className&&(Q.config||(Q.config={}),Q.config.outputValue=!0)})),h)},"pointer/interpolate":{Mk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Q,X,C,l,h)=>(h.forEach((X=>{"FlowGraphJsonPointerParserBlock"===X.className?(X.config||(X.config={}),X.config.outputValue=!0):"FlowGraphInterpolationBlock"===X.className&&(X.config||(X.config={}),Object.keys(Q.values||[]).forEach((C=>{var h;const M=null===(h=Q.values)||void 0===h?void 0:h[C];if("value"===C&&M){const Q=M.type;void 0!==Q&&(X.config.animationType=l.arrays.types[Q].flowGraphType)}})))})),h)},"animation/start":{Mk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Q,X)=>[Q[0]*X._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Q,X)=>[Q[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Q,X,C,l,h,M,f){const O=h[h.length-1];return O.config||(O.config={}),O.config.glTF=f,h}},"animation/stop":{Mk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Q,X,C,l,h,M,f){const O=h[h.length-1];return O.config||(O.config={}),O.config.glTF=f,h}},"animation/stopAt":{Mk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Q,X)=>[Q[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Q,X,C,l,h,M,f){const O=h[h.length-1];return O.config||(O.config={}),O.config.glTF=f,h}},"math/switch":{Mk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Q){if(Q.configuration&&Q.configuration.cases){const X=Q.configuration.cases.value;if(!X.every((Q=>"number"===typeof Q&&/^-?\d+$/.test(Q.toString()))))return F.c.Warn("Switch cases should be integers. Using empty array instead."),Q.configuration.cases.value=[],{valid:!0};const C=new Set(X);Q.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(Q,X,C,l,h){const M=h[0];return M.dataInputs.forEach((Q=>{"default"!==Q.name&&"case"!==Q.name&&(Q.name="in_"+Q.name)})),M.config||(M.config={}),M.config.treatCasesAsIntegers=!0,h}},"debug/log":{Mk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function oC(Q){let X=arguments.length>2?arguments[2]:void 0;return{Mk:[Q],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Q,X)=>(Q[X]={name:X},Q)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Q,C,l,h,M){var f;if(X){(f=M[0]).config||(f.config={}),M[0].config.preventIntegerFloatArithmetic=!0;let X=-1;Object.keys(Q.values||{}).find((C=>{var l;return void 0!==(null===(l=Q.values)||void 0===l?void 0:l[C].type)&&(X=Q.values[C].type,!0)})),-1!==X&&(M[0].config.type=h.arrays.types[X].flowGraphType)}return M},validation:Q=>X?TC(Q):{valid:!0}}}function TC(Q){if(Q.values){const X=Object.keys(Q.values).map((X=>Q.values[X].type)).filter((Q=>void 0!==Q));if(!X.every((Q=>Q===X[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}HC["math/compose"]=HC["math/matCompose"],HC["math/decompose"]=HC["math/matDecompose"];var YC=C(627);const JC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Yj",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class KC{constructor(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Q,this._gltf=X,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Q of this._interactivityGraph.types)this._types.push(JC[Q.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Q of this._interactivityGraph.declarations){const X=eC(Q);if(!X)throw F.c.Error(["No mapping found for declaration",Q]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:X,fullOperationName:Q.extension?Q.op+":"+Q.extension:Q.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Q of this._interactivityGraph.variables){const X=this._parseVariable(Q);this._staticVariables.push(X)}}_parseVariable(Q,X){const C=this._types[Q.type];if(!C)throw F.c.Error(["No type found for variable",Q]),new Error("Error parsing variables");if(Q.value&&Q.value.length!==C.length)throw F.c.Error(["Invalid value length for variable",Q,C]),new Error("Error parsing variables");const l=Q.value||[];if(!l.length)switch(C.flowGraphType){case"boolean":l.push(!1);break;case"FlowGraphInteger":l.push(0);break;case"number":l.push(NaN);break;case"Vector2":l.push(NaN,NaN);break;case"Yj":l.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":l.fill(NaN,0,4);break;case"Matrix":l.fill(NaN,0,16);break;case"Matrix3D":l.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof l[0]&&(l[0]=parseFloat(l[0])),{type:C.flowGraphType,value:X?X(l,this):l}}_parseEvents(){if(this._interactivityGraph.events)for(const Q of this._interactivityGraph.events){const X={eventId:Q.id||"internalEvent_"+this._internalEventsCounter++};Q.values&&(X.eventData=Object.keys(Q.values).map((X=>{var C;const l=null===(C=Q.values)||void 0===C?void 0:C[X];if(!l)throw F.c.Error(["No value found for event key",X]),new Error("Error parsing events");const h=this._types[l.type];if(!h)throw F.c.Error(["No type found for event value",l]),new Error("Error parsing events");const M="undefined"!==typeof l.value?this._parseVariable(l):void 0;return{id:X,type:h.flowGraphType,eventData:!0,value:M}}))),this._events.push(X)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const X of this._interactivityGraph.nodes){if("number"!==typeof X.declaration)throw F.c.Error(["No declaration found for node",X]),new Error("Error parsing nodes");const C=this._mappings[X.declaration];if(!C)throw F.c.Error(["No mapping found for node",X]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const l=C.flowGraphMapping.validation(X,this._interactivityGraph,this._gltf);var Q;if(!l.valid)throw new Error(`Error validating interactivity node ${null===(Q=this._interactivityGraph.declarations)||void 0===Q?void 0:Q[X.declaration].op} - ${l.error}`)}const l=[];for(const Q of C.flowGraphMapping.Mk){const h=this._getEmptyBlock(Q,C.fullOperationName);this._parseNodeConfiguration(X,h,C.flowGraphMapping,Q),l.push(h)}this._nodes.push({Mk:l,fullOperationName:C.fullOperationName})}}_getEmptyBlock(Q,X){return{uniqueId:(0,YC.d)(),className:Q,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:X,metadata:{}}}_parseNodeConfiguration(Q,X,C,l){const h=X.config;if(Q.configuration){const X=Object.keys(Q.configuration);for(const O of X){var M,f;const X=null===(M=Q.configuration)||void 0===M?void 0:M[O];if(!X)throw F.c.Error(["No value found for node configuration",O]),new Error("Error parsing node configuration");const m=null===(f=C.configuration)||void 0===f?void 0:f[O];if(m&&m.toBlock?m.toBlock===l:0===C.Mk.indexOf(l)){const Q=(null===m||void 0===m?void 0:m.name)||O;X&&"undefined"!==typeof X.value||"undefined"===typeof(null===m||void 0===m?void 0:m.defaultValue)?X.value.length>=0?h[Q]={value:1===X.value.length?X.value[0]:X.value}:F.c.Warn(["Invalid value for node configuration",X]):h[Q]={value:m.defaultValue},m&&m.dataTransformer&&(h[Q].value=m.dataTransformer([h[Q].value],this)[0])}}}}_parseNodeConnections(Q){for(let v=0;v<this._nodes.length;v++){var X;const Z=null===(X=this._interactivityGraph.nodes)||void 0===X?void 0:X[v];if(!Z)throw F.c.Error(["No node found for interactivity node",this._nodes[v]]),new Error("Error parsing node connections");const g=this._nodes[v],S=this._mappings[Z.declaration];if(!S)throw F.c.Error(["No mapping found for node",Z]),new Error("Error parsing node connections");const e=Z.flows||{},k=Object.keys(e).sort();for(const Q of k){var C,l,h,M;const X=e[Q],W=null===(C=S.flowGraphMapping.outputs)||void 0===C||null===(l=C.flows)||void 0===l?void 0:l[Q],U=(null===W||void 0===W?void 0:W.name)||Q,L=this._createNewSocketConnection(U,!0);(W&&W.toBlock&&g.Mk.find((Q=>Q.className===W.toBlock))||g.Mk[0]).signalOutputs.push(L);const w=X.node,i=this._nodes[w];if(!i)throw F.c.Error(["No node found for input node id",w]),new Error("Error parsing node connections");const a=SC(i.fullOperationName);if(!a)throw F.c.Error(["No mapping found for input node",i]),new Error("Error parsing node connections");let s=null===(h=a.inputs)||void 0===h||null===(M=h.flows)||void 0===M?void 0:M[X.socket||"in"],z=!1;if(!s)for(const Q in null===(f=a.inputs)||void 0===f?void 0:f.flows){var f,O,m;if(Q.startsWith("[")&&Q.endsWith("]"))z=!0,s=null===(O=a.inputs)||void 0===O||null===(m=O.flows)||void 0===m?void 0:m[Q]}const x=s?z?s.name.replace("$1",X.socket||""):s.name:X.socket||"in",r=s&&s.toBlock&&i.Mk.find((Q=>Q.className===s.toBlock))||i.Mk[0];let P=r.signalInputs.find((Q=>Q.name===x));P||(P=this._createNewSocketConnection(x),r.signalInputs.push(P)),P.connectedPointIds.push(L.uniqueId),L.connectedPointIds.push(P.uniqueId)}const R=Z.values||{},H=Object.keys(R);for(const X of H){var W,U;const C=R[X];let l=null===(W=S.flowGraphMapping.inputs)||void 0===W||null===(U=W.values)||void 0===U?void 0:U[X],h=!1;if(!l)for(const Q in null===(L=S.flowGraphMapping.inputs)||void 0===L?void 0:L.values){var L,w,i;if(Q.startsWith("[")&&Q.endsWith("]"))h=!0,l=null===(w=S.flowGraphMapping.inputs)||void 0===w||null===(i=w.values)||void 0===i?void 0:i[Q]}const M=l?h?l.name.replace("$1",X):l.name:X,f=this._createNewSocketConnection(M);if((l&&l.toBlock&&g.Mk.find((Q=>Q.className===l.toBlock))||g.Mk[0]).dataInputs.push(f),void 0!==C.value){const X=this._parseVariable(C,l&&l.dataTransformer);Q._connectionValues[f.uniqueId]=X}else{if("undefined"===typeof C.node)throw F.c.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var a,s,z;const Q=C.node,X=C.socket||"value",l=this._nodes[Q];if(!l)throw F.c.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const h=SC(l.fullOperationName);if(!h)throw F.c.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let M=null===(a=h.outputs)||void 0===a||null===(s=a.values)||void 0===s?void 0:s[X],O=!1;if(!M)for(const C in null===(x=h.outputs)||void 0===x?void 0:x.values){var x,r,P;if(C.startsWith("[")&&C.endsWith("]"))O=!0,M=null===(r=h.outputs)||void 0===r||null===(P=r.values)||void 0===P?void 0:P[C]}const m=M?O?M.name.replace("$1",X):null===(z=M)||void 0===z?void 0:z.name:X,W=M&&M.toBlock&&l.Mk.find((Q=>Q.className===M.toBlock))||l.Mk[0];let U=W.dataOutputs.find((Q=>Q.name===m));U||(U=this._createNewSocketConnection(m,!0),W.dataOutputs.push(U)),f.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(f.uniqueId)}}}if(S.flowGraphMapping.interBlockConnectors)for(const Q of S.flowGraphMapping.interBlockConnectors){const X=Q.input,C=Q.output,l=Q.isVariable;this._connectFlowGraphNodes(X,C,g.Mk[Q.inputBlockIndex],g.Mk[Q.outputBlockIndex],l)}if(S.flowGraphMapping.extraProcessor){var j;const X=null===(j=this._interactivityGraph.declarations)||void 0===j?void 0:j[Z.declaration];if(!X)throw F.c.Error(["No declaration found for extra processor",Z]),new Error("Error parsing node connections");g.Mk=S.flowGraphMapping.extraProcessor(Z,X,S.flowGraphMapping,this,g.Mk,Q,this._gltf)}}}_createNewSocketConnection(Q,X){return{uniqueId:(0,YC.d)(),name:Q,_connectionType:X?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Q,X,C,l,h){const M=h?C.dataInputs:C.signalInputs,f=h?l.dataOutputs:l.signalOutputs,O=M.find((X=>X.name===Q))||this._createNewSocketConnection(Q),m=f.find((Q=>Q.name===X))||this._createNewSocketConnection(X,!0);M.find((X=>X.name===Q))||M.push(O),f.find((Q=>Q.name===X))||f.push(m),O.connectedPointIds.push(m.uniqueId),m.connectedPointIds.push(O.uniqueId)}getVariableName(Q){return"staticVariable_"+Q}serializeToFlowGraph(){const Q={uniqueId:(0,YC.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Q);for(let X=0;X<this._staticVariables.length;X++){const C=this._staticVariables[X];Q._userVariables[this.getVariableName(X)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Q,X)=>Q.concat(X.Mk)),[]),executionContexts:[Q]}}}const NC="KHR_interactivity";class qC{constructor(Q){this._loader=Q,this.name=NC,this.enabled=this._loader.isExtensionUsed(NC),this._pathConverter=(0,n.j)(this._loader.Hk),Q._skipStartAnimationStep=!0;const X=Q.babylonScene;X&&function(Q){(0,n.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Q.activeCamera)return new h.c(NaN,NaN,NaN,NaN);const X=h.c.FromRotationMatrix(Q.activeCamera.getWorldMatrix()).normalize();return Q.useRightHandedSystem||(X.w*=-1,X.x*=-1),X},type:"Quaternion",getTarget:()=>Q.activeCamera}),(0,n.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Q.activeCamera)return new h.k(NaN,NaN,NaN);const X=Q.activeCamera.getWorldMatrix().getTranslation();return Q.useRightHandedSystem||(X.x*=-1),X},type:"Yj",getTarget:()=>Q.activeCamera}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Q=>{var X;return(null===(X=Q._babylonAnimationGroup)||void 0===X?void 0:X.isPlaying)??!1},type:"boolean",getTarget:Q=>Q._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Q=>{var X;return((null===(X=Q._babylonAnimationGroup)||void 0===X?void 0:X.from)??0)/60},type:"number",getTarget:Q=>Q._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Q=>{var X;return((null===(X=Q._babylonAnimationGroup)||void 0===X?void 0:X.to)??0)/60},type:"number",getTarget:Q=>Q._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Q=>{var X;return((null===(X=Q._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:Q=>Q._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Q=>{var X;return((null===(X=Q._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:Q=>Q._babylonAnimationGroup})}(X)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Q;if(!this._loader.babylonScene||!this._pathConverter)return;const X=this._loader.babylonScene,C=null===(Q=this._loader.Hk.extensions)||void 0===Q?void 0:Q.KHR_interactivity;if(!C)return;const l=new aC.c({ld:X});l.dispatchEventsSynchronously=!1;const h=C.graphs.map((Q=>new KC(Q,this._loader.Hk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(h.map((async Q=>await vC(Q,{coordinator:l,pathConverter:this._pathConverter})))),l.start()}}var nC;nC=async()=>(await Promise.resolve().then(C.bind(C,13129))).FlowGraphGLTFDataProvider,FC[`${NC}/${"FlowGraphGLTFDataProvider"}`]=nC,q(NC),N(NC,!0,(Q=>new qC(Q)));const cC="KHR_node_visibility";(0,n.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Q=>{const X=Q._babylonTransformNode;return!X||void 0===X.isVisible||X.isVisible},set:(Q,X)=>{var C,l;null===(C=X._primitiveBabylonMeshes)||void 0===C||C.forEach((Q=>{Q.inheritVisibility=!0})),X._babylonTransformNode&&(X._babylonTransformNode.isVisible=Q),null===(l=X._primitiveBabylonMeshes)||void 0===l||l.forEach((X=>{X.isVisible=Q}))},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class EC{constructor(Q){this.name=cC,this._loader=Q,this.enabled=Q.isExtensionUsed(cC)}async onReady(){var Q;null===(Q=this._loader.Hk.nodes)||void 0===Q||Q.forEach((Q=>{var X,C,l,h;(null===(X=Q._primitiveBabylonMeshes)||void 0===X||X.forEach((Q=>{Q.inheritVisibility=!0})),null!==(C=Q.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(l=Q.extensions)||void 0===l?void 0:l.KHR_node_visibility.visible)&&(Q._babylonTransformNode&&(Q._babylonTransformNode.isVisible=!1),null===(h=Q._primitiveBabylonMeshes)||void 0===h||h.forEach((Q=>{Q.isVisible=!1}))))}))}dispose(){this._loader=null}}q(cC),N(cC,!0,(Q=>new EC(Q)));const BC="KHR_node_selectability";kC("event/onSelect",BC,{Mk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:Q=>["pickedMesh_"+Q[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Q,X,C,l,h,M,f){var O,m,W,U,L,w;const i=h[h.length-1];i.config=i.config||{},i.config.glTF=f;const a=null===(O=Q.configuration)||void 0===O||null===(m=O.nodeIndex)||void 0===m?void 0:m.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const F="pickedMesh_"+a;return h[1].config.variable=F,M._userVariables[F]={className:"Mesh",id:null===f||void 0===f||null===(W=f.nodes)||void 0===W||null===(U=W[a]._babylonTransformNode)||void 0===U?void 0:U.id,uniqueId:null===f||void 0===f||null===(L=f.nodes)||void 0===L||null===(w=L[a]._babylonTransformNode)||void 0===w?void 0:w.uniqueId},h}}),(0,n.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Q=>{const X=Q._babylonTransformNode;return!X||void 0===X.gf||X.gf},set:(Q,X)=>{var C;null===(C=X._primitiveBabylonMeshes)||void 0===C||C.forEach((X=>{X.gf=Q}))},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"gf"],type:"boolean"});class GC{constructor(Q){this.name=BC,this._loader=Q,this.enabled=Q.isExtensionUsed(BC)}async onReady(){var Q;null===(Q=this._loader.Hk.nodes)||void 0===Q||Q.forEach((Q=>{var X,C,l;null!==(X=Q.extensions)&&void 0!==X&&X.KHR_node_selectability&&!1===(null===(C=Q.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(l=Q._babylonTransformNode)||void 0===l||l.getChildMeshes().forEach((Q=>{Q.gf=!1})))}))}dispose(){this._loader=null}}q(BC),N(BC,!0,(Q=>new GC(Q)));const bC="KHR_node_hoverability",pC="targetMeshPointerOver_";kC("event/onHoverIn",bC,{Mk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:Q=>[pC+Q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Q,X,C,l,h,M,f){var O,m,W,U,L,w;const i=h[h.length-1];i.config=i.config||{},i.config.glTF=f;const a=null===(O=Q.configuration)||void 0===O||null===(m=O.nodeIndex)||void 0===m?void 0:m.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const F=pC+a;return h[1].config.variable=F,M._userVariables[F]={className:"Mesh",id:null===f||void 0===f||null===(W=f.nodes)||void 0===W||null===(U=W[a]._babylonTransformNode)||void 0===U?void 0:U.id,uniqueId:null===f||void 0===f||null===(L=f.nodes)||void 0===L||null===(w=L[a]._babylonTransformNode)||void 0===w?void 0:w.uniqueId},h}});const IC="targetMeshPointerOut_";kC("event/onHoverOut",bC,{Mk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:Q=>[IC+Q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Q,X,C,l,h,M,f){var O,m,W,U,L,w;const i=h[h.length-1];i.config=i.config||{},i.config.glTF=f;const a=null===(O=Q.configuration)||void 0===O||null===(m=O.nodeIndex)||void 0===m?void 0:m.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const F=IC+a;return h[1].config.variable=F,M._userVariables[F]={className:"Mesh",id:null===f||void 0===f||null===(W=f.nodes)||void 0===W||null===(U=W[a]._babylonTransformNode)||void 0===U?void 0:U.id,uniqueId:null===f||void 0===f||null===(L=f.nodes)||void 0===L||null===(w=L[a]._babylonTransformNode)||void 0===w?void 0:w.uniqueId},h}}),(0,n.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Q=>{const X=Q._babylonTransformNode;return!X||void 0===X.pointerOverDisableMeshTesting||X.pointerOverDisableMeshTesting},set:(Q,X)=>{var C;null===(C=X._primitiveBabylonMeshes)||void 0===C||C.forEach((X=>{X.pointerOverDisableMeshTesting=!Q}))},getTarget:Q=>Q._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class tC{constructor(Q){this.name=bC,this._loader=Q,this.enabled=Q.isExtensionUsed(bC)}async onReady(){var Q;null===(Q=this._loader.Hk.nodes)||void 0===Q||Q.forEach((Q=>{var X,C,l;null!==(X=Q.extensions)&&void 0!==X&&X.KHR_node_hoverability&&!1===(null===(C=Q.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(l=Q._babylonTransformNode)||void 0===l||l.getChildMeshes().forEach((Q=>{Q.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}q(bC),N(bC,!0,(Q=>new tC(Q)));const yC="ExtrasAsMetadata";class AC{_assignExtras(Q,X){if(X.extras&&Object.keys(X.extras).length>0){const C=Q.metadata=Q.metadata||{};(C.Hk=C.Hk||{}).extras=X.extras}}constructor(Q){this.name=yC,this.enabled=!0,this._loader=Q}dispose(){this._loader=null}loadNodeAsync(Q,X,C){return this._loader.loadNodeAsync(Q,X,(Q=>{this._assignExtras(Q,X),C(Q)}))}loadCameraAsync(Q,X,C){return this._loader.loadCameraAsync(Q,X,(Q=>{this._assignExtras(Q,X),C(Q)}))}createMaterial(Q,X,C){const l=this._loader.createMaterial(Q,X,C);return this._assignExtras(l,X),l}}q(yC),N(yC,!1,(Q=>new AC(Q)));C(13129)},13001:(Q,X,C)=>{"use strict";C.d(X,{d:()=>T,g:()=>S,j:()=>g,k:()=>e});var l=C(482),h=C(487),M=C(12664),f=C(477),O=C(806),m=C(800),W=C(501),U=C(524),L=C(12137),w=C(12240),i=C(642),a=C(633);class F{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.tk=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.fm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Q){this._environmentTexture=Q}getNodes(){let Q=[];Q=Q.concat(this.meshes),Q=Q.concat(this.lights),Q=Q.concat(this.cameras),Q=Q.concat(this.transformNodes);for(const X of this.skeletons)Q=Q.concat(X.bones);return Q}}class s extends F{}class z{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Q=this.rootNodes;for(const l of Q)l.dispose();Q.length=0;const X=this.skeletons;for(const l of X)l.dispose();X.length=0;const C=this.animationGroups;for(const l of C)l.dispose();C.length=0}}class x extends F{constructor(Q){super(),this._wasAddedToScene=!1,(Q=Q||U.b.LastCreatedScene)&&(this.ld=Q,this.proceduralTextures=[],Q.bk.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Q.getEngine().onContextRestoredObservable.add((()=>{for(const Q of this.geometries)Q._rebuild();for(const Q of this.meshes)Q._rebuild();for(const Q of this.tk)Q.rebuild();for(const Q of this.textures)Q._rebuild()})))}_topologicalSort(Q){const X=new Map;for(const f of Q)X.set(f.uniqueId,f);const C={dependsOn:new Map,dependedBy:new Map};for(const f of Q){const Q=f.uniqueId;C.dependsOn.set(Q,new Set),C.dependedBy.set(Q,new Set)}for(const f of Q){const Q=f.uniqueId,l=C.dependsOn.get(Q);if(f instanceof L.d){const h=f.sourceMesh;X.has(h.uniqueId)&&(l.add(h.uniqueId),C.dependedBy.get(h.uniqueId).add(Q))}const h=C.dependedBy.get(Q);for(const M of f.getDescendants()){const l=M.uniqueId;if(X.has(l)){h.add(l);C.dependsOn.get(l).add(Q)}}}const l=[],h=[];for(const f of Q){const Q=f.uniqueId;0===C.dependsOn.get(Q).size&&(h.push(f),X.delete(Q))}const M=h;for(;M.length>0;){const Q=M.shift();l.push(Q);const h=C.dependedBy.get(Q.uniqueId);for(const l of Array.from(h.values())){const h=C.dependsOn.get(l);h.delete(Q.uniqueId),0===h.size&&X.get(l)&&(M.push(X.get(l)),X.delete(l))}}return X.size>0&&(W.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),X.forEach((Q=>{W.c.Error(Q.name)}))),l}_addNodeAndDescendantsToList(Q,X,C,l){if(C&&(!l||l(C))&&!X.has(C.uniqueId)){Q.push(C),X.add(C.uniqueId);for(const h of C.getDescendants(!0))this._addNodeAndDescendantsToList(Q,X,h,l)}}_isNodeInContainer(Q){return Q instanceof m.d&&-1!==this.meshes.indexOf(Q)||(Q instanceof O.e&&-1!==this.transformNodes.indexOf(Q)||(Q instanceof w.b&&-1!==this.lights.indexOf(Q)||Q instanceof i.d&&-1!==this.cameras.indexOf(Q)))}_isValidHierarchy(){for(const Q of this.meshes)if(Q.parent&&!this._isNodeInContainer(Q.parent))return W.c.Warn(`Node ${Q.name} has a parent that is not in the container.`),!1;for(const Q of this.transformNodes)if(Q.parent&&!this._isNodeInContainer(Q.parent))return W.c.Warn(`Node ${Q.name} has a parent that is not in the container.`),!1;for(const Q of this.lights)if(Q.parent&&!this._isNodeInContainer(Q.parent))return W.c.Warn(`Node ${Q.name} has a parent that is not in the container.`),!1;for(const Q of this.cameras)if(Q.parent&&!this._isNodeInContainer(Q.parent))return W.c.Warn(`Node ${Q.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||h.i.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const l={},M={},O=new z,m=[],W=[],U={doNotInstantiate:!0,...C},L=[],w=new Set;for(const h of this.transformNodes)null===h.parent&&this._addNodeAndDescendantsToList(L,w,h,U.predicate);for(const h of this.meshes)null===h.parent&&this._addNodeAndDescendantsToList(L,w,h,U.predicate);const i=this._topologicalSort(L),a=(C,h)=>{if(((X,C)=>{if(l[X.uniqueId]=C.uniqueId,M[C.uniqueId]=C,Q&&(C.name=Q(X.name)),C instanceof f.c){const Q=C;if(Q.morphTargetManager){const C=X.morphTargetManager;Q.morphTargetManager=C.clone();for(let X=0;X<C.numTargets;X++){const h=C.getTarget(X),f=Q.morphTargetManager.getTarget(X);l[h.uniqueId]=f.uniqueId,M[f.uniqueId]=f}}}})(C,h),C.parent){const Q=l[C.parent.uniqueId],X=M[Q];h.parent=X||C.parent}if(h.position&&C.position&&h.position.p(C.position),h.rotationQuaternion&&C.rotationQuaternion&&h.rotationQuaternion.p(C.rotationQuaternion),h.rotation&&C.rotation&&h.rotation.p(C.rotation),h._c&&C._c&&h._c.p(C._c),h.material){const f=h;if(f.material)if(X){const X=C.material;if(-1===W.indexOf(X)){let C=X.clone(Q?Q(X.name):"Clone of "+X.name);if(W.push(X),l[X.uniqueId]=C.uniqueId,M[C.uniqueId]=C,"MultiMaterial"===X.getClassName()){const h=X;for(const X of h.lk)X&&(C=X.clone(Q?Q(X.name):"Clone of "+X.name),W.push(X),l[X.uniqueId]=C.uniqueId,M[C.uniqueId]=C);h.lk=h.lk.map((Q=>Q&&M[l[Q.uniqueId]]))}}"InstancedMesh"!==f.getClassName()&&(f.material=M[l[X.uniqueId]])}else"MultiMaterial"===f.material.getClassName()?-1===this.ld.multiMaterials.indexOf(f.material)&&this.ld.addMultiMaterial(f.material):-1===this.ld.materials.indexOf(f.material)&&this.ld.addMaterial(f.material)}null===h.parent&&O.rootNodes.push(h)};for(const h of i)if("InstancedMesh"===h.getClassName()){const Q=h,X=Q.sourceMesh,C=l[X.uniqueId];a(Q,("number"===typeof C?M[C]:X).createInstance(Q.name))}else{let Q=!0;"Gk"===h.getClassName()||"Node"===h.getClassName()||h.skeleton||!h.getTotalVertices||0===h.getTotalVertices()?Q=!1:U.doNotInstantiate&&(Q="function"===typeof U.doNotInstantiate?!U.doNotInstantiate(h):!U.doNotInstantiate);const X=Q?h.createInstance(`instance of ${h.name}`):h.clone(`Clone of ${h.name}`,null,!0);if(!X)throw new Error(`Could not clone or instantiate node on Asset Container ${h.name}`);a(h,X)}for(const h of this.skeletons){if(U.predicate&&!U.predicate(h))continue;const X=h.clone(Q?Q(h.name):"Clone of "+h.name);for(const Q of this.meshes)if(Q.skeleton===h&&!Q.isAnInstance){const C=M[l[Q.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=X,-1!==m.indexOf(X))continue;m.push(X);for(const Q of X.bones)Q._linkedTransformNode&&(Q._linkedTransformNode=M[l[Q._linkedTransformNode.uniqueId]])}O.skeletons.push(X)}for(const h of this.animationGroups){if(U.predicate&&!U.predicate(h))continue;const X=h.clone(Q?Q(h.name):"Clone of "+h.name,(Q=>M[l[Q.uniqueId]]||Q));O.animationGroups.push(X)}return O}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||h.i.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ld.environmentTexture=this.environmentTexture);for(const Q of this.ld._serializableComponents)Q.addFromContainer(this);this.ld.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=[];for(const C of this.cameras)Q&&!Q(C)||(this.ld.addCamera(C),X.push(C));for(const C of this.lights)Q&&!Q(C)||(this.ld.addLight(C),X.push(C));for(const C of this.meshes)Q&&!Q(C)||(this.ld.rk(C),X.push(C));for(const C of this.skeletons)Q&&!Q(C)||this.ld.addSkeleton(C);for(const C of this.animations)Q&&!Q(C)||this.ld.addAnimation(C);for(const C of this.animationGroups)Q&&!Q(C)||this.ld.addAnimationGroup(C);for(const C of this.multiMaterials)Q&&!Q(C)||this.ld.addMultiMaterial(C);for(const C of this.materials)Q&&!Q(C)||this.ld.addMaterial(C);for(const C of this.morphTargetManagers)Q&&!Q(C)||this.ld.addMorphTargetManager(C);for(const C of this.geometries)Q&&!Q(C)||this.ld.addGeometry(C);for(const C of this.transformNodes)Q&&!Q(C)||(this.ld.addTransformNode(C),X.push(C));for(const C of this.actionManagers)Q&&!Q(C)||this.ld.addActionManager(C);for(const C of this.textures)Q&&!Q(C)||this.ld.addTexture(C);for(const C of this.reflectionProbes)Q&&!Q(C)||this.ld.addReflectionProbe(C);for(const C of X)C.parent&&-1===this.ld.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||h.i.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ld.environmentTexture&&(this.ld.environmentTexture=null);for(const Q of this.ld._serializableComponents)Q.removeFromContainer(this)}removeFromScene(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const X of this.cameras)Q&&!Q(X)||this.ld.removeCamera(X);for(const X of this.lights)Q&&!Q(X)||this.ld.removeLight(X);for(const X of this.meshes)Q&&!Q(X)||this.ld.sk(X,!0);for(const X of this.skeletons)Q&&!Q(X)||this.ld.removeSkeleton(X);for(const X of this.animations)Q&&!Q(X)||this.ld.removeAnimation(X);for(const X of this.animationGroups)Q&&!Q(X)||this.ld.removeAnimationGroup(X);for(const X of this.multiMaterials)Q&&!Q(X)||this.ld.removeMultiMaterial(X);for(const X of this.materials)Q&&!Q(X)||this.ld.removeMaterial(X);for(const X of this.morphTargetManagers)Q&&!Q(X)||this.ld.removeMorphTargetManager(X);for(const X of this.geometries)Q&&!Q(X)||this.ld.removeGeometry(X);for(const X of this.transformNodes)Q&&!Q(X)||this.ld.removeTransformNode(X);for(const X of this.actionManagers)Q&&!Q(X)||this.ld.removeActionManager(X);for(const X of this.textures)Q&&!Q(X)||this.ld.removeTexture(X);for(const X of this.reflectionProbes)Q&&!Q(X)||this.ld.removeReflectionProbe(X)}dispose(){const Q=this.cameras.slice(0);for(const i of Q)i.dispose();this.cameras.length=0;const X=this.lights.slice(0);for(const i of X)i.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const i of C)i.dispose();this.meshes.length=0;const l=this.skeletons.slice(0);for(const i of l)i.dispose();this.skeletons.length=0;const h=this.animationGroups.slice(0);for(const i of h)i.dispose();this.animationGroups.length=0;const M=this.multiMaterials.slice(0);for(const i of M)i.dispose();this.multiMaterials.length=0;const f=this.materials.slice(0);for(const i of f)i.dispose();this.materials.length=0;const O=this.geometries.slice(0);for(const i of O)i.dispose();this.geometries.length=0;const m=this.transformNodes.slice(0);for(const i of m)i.dispose();this.transformNodes.length=0;const W=this.actionManagers.slice(0);for(const i of W)i.dispose();this.actionManagers.length=0;const U=this.textures.slice(0);for(const i of U)i.dispose();this.textures.length=0;const L=this.reflectionProbes.slice(0);for(const i of L)i.dispose();this.reflectionProbes.length=0;const w=this.morphTargetManagers.slice(0);for(const i of w)i.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const i of this.ld._serializableComponents)i.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ld.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Q,X,C){if(Q&&X)for(const l of Q){let Q=!0;if(C)for(const X of C)if(l===X){Q=!1;break}Q&&(X.push(l),l._parentContainer=this)}}moveAllFromScene(Q){this._wasAddedToScene=!1,void 0===Q&&(Q=new s);for(const X in this)Object.prototype.hasOwnProperty.call(this,X)&&(this[X]=this[X]||("_environmentTexture"===X?null:[]),this._moveAssets(this.ld[X],this[X],Q[X]));this.environmentTexture=this.ld.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Q=new f.c("assetContainerRootMesh",this.ld);for(const X of this.meshes)X.parent||Q.addChild(X);return this.meshes.unshift(Q),Q}mergeAnimationsTo(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.b.LastCreatedScene,X=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Q)return W.c.Error("No scene available to merge animations to"),[];const l=C||(X=>{let C=null;const l=X.animations.length?X.animations[0].targetProperty:"",h=X.name.split(".").join("").split("_primitive")[0];switch(l){case"position":case"rotationQuaternion":C=Q.getTransformNodeByName(X.name)||Q.getTransformNodeByName(h);break;case"influence":C=Q.getMorphTargetByName(X.name)||Q.getMorphTargetByName(h);break;default:C=Q.getNodeByName(X.name)||Q.getNodeByName(h)}return C}),h=this.getNodes();for(const O of h){const Q=l(O);if(null!==Q){for(const X of O.animations){const C=Q.animations.filter((Q=>Q.targetProperty===X.targetProperty));for(const X of C){const C=Q.animations.indexOf(X,0);C>-1&&Q.animations.splice(C,1)}}Q.animations=Q.animations.concat(O.animations)}}const M=[],f=this.animationGroups.slice();for(const O of f){M.push(O.clone(O.name,l));for(const Q of O.animatables)Q.stop()}for(const O of X){const X=l(O.target);X&&(Q.beginAnimation(X,O.fromFrame,O.toFrame,O.loopAnimation,O.speedRatio,O.onAnimationEnd?O.onAnimationEnd:void 0,void 0,!0,void 0,O.onAnimationLoop?O.onAnimationLoop:void 0),Q.stopAnimation(O.target))}return M}populateRootNodes(){this.rootNodes.length=0;for(const Q of this.meshes)Q.parent||-1!==this.rootNodes.indexOf(Q)||this.rootNodes.push(Q);for(const Q of this.transformNodes)Q.parent||-1!==this.rootNodes.indexOf(Q)||this.rootNodes.push(Q);for(const Q of this.lights)Q.parent||-1!==this.rootNodes.indexOf(Q)||this.rootNodes.push(Q);for(const Q of this.cameras)Q.parent||-1!==this.rootNodes.indexOf(Q)||this.rootNodes.push(Q)}addAllAssetsToContainer(Q){if(!Q)return;const X=[],C=new Set;for(X.push(Q);X.length>0;){const Q=X.pop();if(Q instanceof f.c?(Q.ik&&-1===this.geometries.indexOf(Q.ik)&&this.geometries.push(Q.ik),this.meshes.push(Q)):Q instanceof L.d?this.meshes.push(Q):Q instanceof O.e?this.transformNodes.push(Q):Q instanceof w.b?this.lights.push(Q):Q instanceof i.d&&this.cameras.push(Q),Q instanceof m.d){if(Q.material&&-1===this.materials.indexOf(Q.material)){this.materials.push(Q.material);for(const X of Q.material.getActiveTextures())-1===this.textures.indexOf(X)&&this.textures.push(X)}Q.skeleton&&-1===this.skeletons.indexOf(Q.skeleton)&&this.skeletons.push(Q.skeleton),Q.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Q.morphTargetManager)&&this.morphTargetManagers.push(Q.morphTargetManager)}for(const l of Q.getChildren())C.has(l)||X.push(l);C.add(Q)}this.populateRootNodes()}_getByTags(Q,X,C){if(void 0===X)return Q;const l=[];for(const h in Q){const M=Q[h];a.e&&a.e.MatchesQuery(M,X)&&(!C||C(M))&&l.push(M)}return l}getMeshesByTags(Q,X){return this._getByTags(this.meshes,Q,X)}getCamerasByTags(Q,X){return this._getByTags(this.cameras,Q,X)}getLightsByTags(Q,X){return this._getByTags(this.lights,Q,X)}getMaterialsByTags(Q,X){return this._getByTags(this.materials,Q,X).concat(this._getByTags(this.multiMaterials,Q,X))}getTransformNodesByTags(Q,X){return this._getByTags(this.transformNodes,Q,X)}}var r=C(537);class P{constructor(Q){this.byteOffset=0,this.buffer=Q}async loadAsync(Q){const X=await this.buffer.readAsync(this.byteOffset,Q);this._dataView=new DataView(X.buffer,X.byteOffset,X.byteLength),this._dataByteOffset=0}readUint32(){const Q=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Q}readUint8Array(Q){const X=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Q);return this._dataByteOffset+=Q,this.byteOffset+=Q,X}readString(Q){return(0,r.j)(this.readUint8Array(Q))}skipBytes(Q){this._dataByteOffset+=Q,this.byteOffset+=Q}}var j=C(13005);const v="Z2xURg",Z={name:"Hk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Q=>-1!==Q.indexOf("asset")&&-1!==Q.indexOf("version")||Q.startsWith("data:base64,"+v)||Q.startsWith("data:;base64,"+v)||Q.startsWith("data:application/octet-stream;base64,"+v)||Q.startsWith("data:model/gltf-binary;base64,"+v)};var g,S,e,k=C(526),R=C(530);function H(Q,X,C){try{return Promise.resolve(new Uint8Array(Q,X,C))}catch(l){return Promise.reject(l)}}!function(Q){Q[Q.AUTO=0]="AUTO",Q[Q.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(g||(g={})),function(Q){Q[Q.NONE=0]="NONE",Q[Q.FIRST=1]="FIRST",Q[Q.ALL=2]="ALL"}(S||(S={})),function(Q){Q[Q.LOADING=0]="LOADING",Q[Q.READY=1]="READY",Q[Q.COMPLETE=2]="COMPLETE"}(e||(e={}));class o{constructor(){this.coordinateSystemMode=g.AUTO,this.animationStartMode=S.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Q=>Promise.resolve(Q),this.extensionOptions={}}p(Q){Q&&(this.onParsed=Q.onParsed,this.coordinateSystemMode=Q.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Q.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Q.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Q.loadSkins??this.loadSkins,this.loadMorphTargets=Q.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Q.compileMaterials??this.compileMaterials,this.useClipPlane=Q.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Q.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Q.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Q.useRangeRequests??this.useRangeRequests,this.createInstances=Q.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Q.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Q.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Q.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Q.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Q.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Q.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Q.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Q.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Q.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Q.customRootNode,this.onMeshLoaded=Q.onMeshLoaded,this.onSkinLoaded=Q.onSkinLoaded,this.onTextureLoaded=Q.onTextureLoaded,this.onMaterialLoaded=Q.onMaterialLoaded,this.onCameraLoaded=Q.onCameraLoaded,this.extensionOptions=Q.extensionOptions??this.extensionOptions)}}class T extends o{constructor(Q){super(),this.onParsedObservable=new l.e,this.onMeshLoadedObservable=new l.e,this.onSkinLoadedObservable=new l.e,this.onTextureLoadedObservable=new l.e,this.onMaterialLoadedObservable=new l.e,this.onCameraLoadedObservable=new l.e,this.onCompleteObservable=new l.e,this.onErrorObservable=new l.e,this.bk=new l.e,this.onExtensionLoadedObservable=new l.e,this.validate=!1,this.onValidatedObservable=new l.e,this._loader=null,this._state=null,this._requests=new Array,this.name=Z.name,this.extensions=Z.extensions,this.onLoaderStateChangedObservable=new l.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(Q)}set onParsed(Q){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Q&&(this._onParsedObserver=this.onParsedObservable.add(Q))}set onMeshLoaded(Q){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Q&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Q))}set onSkinLoaded(Q){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Q&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((X=>Q(X.node,X.skinnedNode))))}set onTextureLoaded(Q){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Q&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Q))}set onMaterialLoaded(Q){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Q&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Q))}set onCameraLoaded(Q){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Q&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Q))}set onComplete(Q){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Q)}set onError(Q){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Q)}set onDispose(Q){this._onDisposeObserver&&this.bk.remove(this._onDisposeObserver),this._onDisposeObserver=this.bk.add(Q)}set onExtensionLoaded(Q){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Q)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Q){this._loggingEnabled!==Q&&(this._loggingEnabled=Q,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Q){this._capturePerformanceCounters!==Q&&(this._capturePerformanceCounters=Q,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Q){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Q)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Q of this._requests)Q.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Q=>Promise.resolve(Q),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.bk.notifyObservers(void 0),this.bk.clear()}loadFile(Q,X,C,M,f,O,m,U){if(ArrayBuffer.isView(X))return this._loadBinary(Q,X,C,M,m,U),null;this._progressCallback=f;const L=X.name||h.i.GetFilename(X);if(O){if(this.useRangeRequests){this.validate&&W.c.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new l.e},h={readAsync:(C,l)=>new Promise(((h,M)=>{this._loadFile(Q,X,(Q=>{h(new Uint8Array(Q))}),!0,(Q=>{M(Q)}),(Q=>{Q.setRequestHeader("Range",`bytes=${C}-${C+l-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new P(h)).then((Q=>{C.onCompleteObservable.notifyObservers(C),M(Q)}),m?Q=>m(void 0,Q):void 0),C}return this._loadFile(Q,X,(X=>{this._validate(Q,new Uint8Array(X,0,X.byteLength),C,L),this._unpackBinaryAsync(new P({readAsync:(Q,C)=>H(X,Q,C),byteLength:X.byteLength})).then((Q=>{M(Q)}),m?Q=>m(void 0,Q):void 0)}),!0,m)}return this._loadFile(Q,X,(X=>{try{this._validate(Q,X,C,L),M({json:this._parseJson(X)})}catch{m&&m()}}),!1,m)}_loadBinary(Q,X,C,l,h,M){this._validate(Q,new Uint8Array(X.buffer,X.byteOffset,X.byteLength),C,M),this._unpackBinaryAsync(new P({readAsync:(Q,C)=>function(Q,X,C){try{if(X<0||X>=Q.byteLength)throw new RangeError("Offset is out of range.");if(X+C>Q.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Q.buffer,Q.byteOffset+X,C))}catch(l){return Promise.reject(l)}}(X,Q,C),byteLength:X.byteLength})).then((Q=>{l(Q)}),h?Q=>h(void 0,Q):void 0)}importMeshAsync(Q,X,C,l,h,M){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log(`Loading ${M||""}`),this._loader=this._getLoader(C),this._loader.importMeshAsync(Q,X,null,C,l,h,M))))}loadAsync(Q,X,C,l,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(X),this._loader.loadAsync(Q,X,C,l,h))))}loadAssetContainerAsync(Q,X,C,l,h){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(X);const M=new x(Q),f=[];this.onMaterialLoadedObservable.add((Q=>{f.push(Q)}));const O=[];this.onTextureLoadedObservable.add((Q=>{O.push(Q)}));const m=[];this.onCameraLoadedObservable.add((Q=>{m.push(Q)}));const W=[];return this.onMeshLoadedObservable.add((Q=>{Q.morphTargetManager&&W.push(Q.morphTargetManager)})),this._loader.importMeshAsync(null,Q,M,X,C,l,h).then((Q=>(Array.prototype.push.apply(M.geometries,Q.geometries),Array.prototype.push.apply(M.meshes,Q.meshes),Array.prototype.push.apply(M.tk,Q.tk),Array.prototype.push.apply(M.skeletons,Q.skeletons),Array.prototype.push.apply(M.animationGroups,Q.animationGroups),Array.prototype.push.apply(M.materials,f),Array.prototype.push.apply(M.textures,O),Array.prototype.push.apply(M.lights,Q.lights),Array.prototype.push.apply(M.transformNodes,Q.transformNodes),Array.prototype.push.apply(M.cameras,m),Array.prototype.push.apply(M.morphTargetManagers,W),M)))}))}canDirectLoad(Q){return Z.canDirectLoad(Q)}directLoad(Q,X){if(X.startsWith("base64,"+v)||X.startsWith(";base64,"+v)||X.startsWith("application/octet-stream;base64,"+v)||X.startsWith("model/gltf-binary;base64,"+v)){const C=(0,k.b)(X);return this._validate(Q,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new P({readAsync:(Q,X)=>H(C,Q,X),byteLength:C.byteLength}))}return this._validate(Q,X),Promise.resolve({json:this._parseJson(X)})}createPlugin(Q){return new T(Q[Z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Q,X)=>{this.onCompleteObservable.addOnce((()=>{Q()})),this.onErrorObservable.addOnce((Q=>{X(Q)}))}))}_setState(Q){this._state!==Q&&(this._state=Q,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(e[this._state]))}_loadFile(Q,X,C,l,h,M){const f=Q._loadFile(X,C,(Q=>{this._onProgress(Q,f)}),!0,l,h,M);return f.onCompleteObservable.add((()=>{f._lengthComputable=!0,f._total=f._loaded})),this._requests.push(f),f}_onProgress(Q,X){if(!this._progressCallback)return;X._lengthComputable=Q.lengthComputable,X._loaded=Q.loaded,X._total=Q.total;let C=!0,l=0,h=0;for(const M of this._requests){if(void 0===M._lengthComputable||void 0===M._loaded||void 0===M._total)return;C=C&&M._lengthComputable,l+=M._loaded,h+=M._total}this._progressCallback({lengthComputable:C,loaded:l,total:C?h:0})}_validate(Q,X){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),j.c.ValidateAsync(X,C,l,(X=>this.preprocessUrlAsync(C+X).then((X=>Q._loadFileAsync(X,void 0,!0,!0).then((Q=>new Uint8Array(Q,0,Q.byteLength))))))).then((Q=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Q),this.onValidatedObservable.clear()}),(Q=>{this._endPerformanceCounter("Validate JSON"),h.i.Warn(`Failed to validate: ${Q.message}`),this.onValidatedObservable.clear()})))}_getLoader(Q){const X=Q.json.asset||{};this._log(`Asset version: ${X.version}`),X.minVersion&&this._log(`Asset minimum version: ${X.minVersion}`),X.generator&&this._log(`Asset generator: ${X.generator}`);const C=T._parseVersion(X.version);if(!C)throw new Error("Invalid version: "+X.version);if(void 0!==X.minVersion){const Q=T._parseVersion(X.minVersion);if(!Q)throw new Error("Invalid minimum version: "+X.minVersion);if(T._compareVersion(Q,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+X.minVersion)}const l={1:T._CreateGLTF1Loader,2:T._CreateGLTF2Loader}[C.major];if(!l)throw new Error("Unsupported version: "+X.version);return l(this)}_parseJson(Q){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Q.length}`);const X=JSON.parse(Q);return this._endPerformanceCounter("Parse JSON"),X}_unpackBinaryAsync(Q){return this._startPerformanceCounter("Unpack Binary"),Q.loadAsync(20).then((()=>{const X=Q.readUint32();if(1179937895!==X)throw new R.k("Unexpected magic: "+X,R.g.GLTFLoaderUnexpectedMagicError);const C=Q.readUint32();this.loggingEnabled&&this._log(`Binary version: ${C}`);const l=Q.readUint32();let h;switch(this.useRangeRequests||l===Q.buffer.byteLength||W.c.Warn(`Length in header does not match actual data length: ${l} != ${Q.buffer.byteLength}`),C){case 1:h=this._unpackBinaryV1Async(Q,l);break;case 2:h=this._unpackBinaryV2Async(Q,l);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),h}))}_unpackBinaryV1Async(Q,X){const C=Q.readUint32(),l=Q.readUint32();if(0!==l)throw new Error(`Unexpected content format: ${l}`);const h=X-Q.byteOffset,M={json:this._parseJson(Q.readString(C)),bin:null};if(0!==h){const X=Q.byteOffset;M.bin={readAsync:(C,l)=>Q.buffer.readAsync(X+C,l),byteLength:h}}return Promise.resolve(M)}_unpackBinaryV2Async(Q,X){const C=1313821514,l=5130562,h=Q.readUint32();if(Q.readUint32()!==C)throw new Error("First chunk format is not JSON");return Q.byteOffset+h===X?Q.loadAsync(h).then((()=>({json:this._parseJson(Q.readString(h)),bin:null}))):Q.loadAsync(h+8).then((()=>{const M={json:this._parseJson(Q.readString(h)),bin:null},f=()=>{const h=Q.readUint32();switch(Q.readUint32()){case C:throw new Error("Unexpected JSON chunk");case l:{const X=Q.byteOffset;M.bin={readAsync:(C,l)=>Q.buffer.readAsync(X+C,l),byteLength:h},Q.skipBytes(h);break}default:Q.skipBytes(h)}return Q.byteOffset!==X?Q.loadAsync(8).then(f):Promise.resolve(M)};return f()}))}static _parseVersion(Q){if("1.0"===Q||"1.0.1"===Q)return{major:1,minor:0};const X=(Q+"").match(/^(\d+)\.(\d+)/);return X?{major:parseInt(X[1]),minor:parseInt(X[2])}:null}static _compareVersion(Q,X){return Q.major>X.major?1:Q.major<X.major?-1:Q.minor>X.minor?1:Q.minor<X.minor?-1:0}_logOpen(Q){this._log(Q),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Q){const X=T._logSpaces.substring(0,2*this._logIndentLevel);W.c.Log(`${X}${Q}`)}_logDisabled(Q){}_startPerformanceCounterEnabled(Q){h.i.StartPerformanceCounter(Q)}_startPerformanceCounterDisabled(Q){}_endPerformanceCounterEnabled(Q){h.i.EndPerformanceCounter(Q)}_endPerformanceCounterDisabled(Q){}}T.IncrementalLoading=!0,T.HomogeneousCoordinates=!1,T._logSpaces="                                ",(0,M.e)(new T)},13005:(Q,X,C)=>{"use strict";C.d(X,{c:()=>f});var l=C(487);function h(Q,X,C,l){const h={externalResourceFunction:l};return C&&(h.uri="file:"===X?C:X+C),ArrayBuffer.isView(Q)?GLTFValidator.validateBytes(Q,h):GLTFValidator.validateString(Q,h)}function M(){const Q=[];onmessage=X=>{const C=X.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":h(C.data,C.rootUrl,C.fileName,(X=>new Promise(((C,l)=>{const h=Q.length;Q.push({resolve:C,reject:l}),postMessage({id:"getExternalResource",index:h,uri:X})})))).then((Q=>{postMessage({id:"validate.resolve",value:Q})}),(Q=>{postMessage({id:"validate.reject",reason:Q})}));break;case"getExternalResource.resolve":Q[C.index].resolve(C.value);break;case"getExternalResource.reject":Q[C.index].reject(C.reason)}}}class f{static ValidateAsync(Q,X,C,f){return"function"===typeof Worker?new Promise(((O,m)=>{const W=`${h}(${M})()`,U=URL.createObjectURL(new Blob([W],{type:"application/javascript"})),L=new Worker(U),w=Q=>{L.removeEventListener("error",w),L.removeEventListener("message",i),m(Q)},i=Q=>{const X=Q.data;switch(X.id){case"getExternalResource":f(X.uri).then((Q=>{L.postMessage({id:"getExternalResource.resolve",index:X.index,value:Q},[Q.buffer])}),(Q=>{L.postMessage({id:"getExternalResource.reject",index:X.index,reason:Q})}));break;case"validate.resolve":L.removeEventListener("error",w),L.removeEventListener("message",i),O(X.value),L.terminate();break;case"validate.reject":L.removeEventListener("error",w),L.removeEventListener("message",i),m(X.reason),L.terminate()}};if(L.addEventListener("error",w),L.addEventListener("message",i),L.postMessage({id:"init",url:l.i.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Q)){const l=Q.slice();L.postMessage({id:"validate",data:l,rootUrl:X,fileName:C},[l.buffer])}else L.postMessage({id:"validate",data:Q,rootUrl:X,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=l.i.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>h(Q,X,C,f))))}}f.Configuration={url:`${l.i._DefaultCdnUrl}/gltf_validator.js`}},13393:(Q,X,C)=>{"use strict";C.d(X,{b:()=>Z});var l=C(644),h=C(650),M=C(695),f=C(668),O=C(12174),m=C(12193),W=C(722),U=C(2522),L=C(620),w=C(568);C(12766),C(12692),C(12712),C(12698),C(12719),C(12722),C(12727);const i="imageProcessingCompatibility",a="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";w.b.IncludesShadersStore[i]||(w.b.IncludesShadersStore[i]=a);const F="skyPixelShader",s="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";w.b.ShadersStore[F]||(w.b.ShadersStore[F]=s);C(12775),C(12730),C(12732),C(12744),C(12737);const z="skyVertexShader",x="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";w.b.ShadersStore[z]||(w.b.ShadersStore[z]=x);var r=C(12207),P=C(854),j=C(846);class v extends O.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Z extends m.c{constructor(Q,X){super(Q,X),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new f.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=f.k.Zero(),this.up=f.k.Up(),this.dithering=!1,this._cameraPosition=f.k.Zero(),this._skyOrientation=new f.c}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Q,X){const C=X._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;X.materialDefines||(X.materialDefines=new v);const l=X.materialDefines,h=this.va();if(this._isReadyForSubMesh(X))return!0;if((0,j._)(Q,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,l),(0,j.K)(Q,l,!0,!1),l.IMAGEPROCESSINGPOSTPROCESS!==h.imageProcessingConfiguration.applyByPostProcess&&l.markAsMiscDirty(),l.DITHER!==this.dithering&&l.markAsMiscDirty(),l.isDirty){l.markAsProcessed(),h.resetCachedMaterial();const Q=new r.c;l.FOG&&Q.addFallback(1,"FOG"),l.IMAGEPROCESSINGPOSTPROCESS=h.imageProcessingConfiguration.applyByPostProcess,l.DITHER=this.dithering;const C=[W.g.PositionKind];l.VERTEXCOLOR&&C.push(W.g.ColorKind);const M="sky",f=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,P.d)(f);const O=l.toString();X.setEffect(h.getEngine().createEffect(M,C,f,[],O,Q,this.onCompiled,this.onError),l,this._materialContext)}return!(!X.effect||!X.effect.isReady())&&(l._renderId=h.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(Q,X,C){const l=this.va(),h=C.materialDefines;if(!h)return;const M=C.effect;if(!M)return;this._activeEffect=M,this.bindOnlyWorldMatrix(Q),this._activeEffect.setMatrix("viewProjection",l.getTransformMatrix()),this._mustRebind(l,M,C)&&((0,P.h)(M,this,l),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,j.i)(h,M,l)),l.fogEnabled&&X.applyFog&&l.fogMode!==U.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",l.getViewMatrix()),(0,j.e)(l,X,this._activeEffect);const O=l.activeCamera;if(O){const Q=O.getWorldMatrix();this._cameraPosition.x=Q.m[12],this._cameraPosition.y=Q.m[13],this._cameraPosition.z=Q.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Q=Math.PI*(this.inclination-.5),X=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(X)*Math.cos(Q),this.sunPosition.y=this.distance*Math.sin(-Q),this.sunPosition.z=this.distance*Math.sin(X)*Math.cos(Q),f.c.FromUnitVectorsToRef(f.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(X,this._activeEffect,C)}getAnimatables(){return[]}dispose(Q){super.dispose(Q)}clone(Q){return M.d.Clone((()=>new Z(Q,this.va())),this)}serialize(){const Q=super.serialize();return Q.customType="BABYLON.SkyMaterial",Q}getClassName(){return"SkyMaterial"}static Parse(Q,X,C){return M.d.Parse((()=>new Z(Q.name,X)),Q,X,C)}}(0,l.c)([(0,h.N)()],Z.prototype,"luminance",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"turbidity",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"rayleigh",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"mieCoefficient",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"mieDirectionalG",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"distance",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"inclination",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"azimuth",void 0),(0,l.c)([(0,h.K)()],Z.prototype,"sunPosition",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"useSunPosition",void 0),(0,l.c)([(0,h.K)()],Z.prototype,"cameraOffset",void 0),(0,l.c)([(0,h.K)()],Z.prototype,"up",void 0),(0,l.c)([(0,h.N)()],Z.prototype,"dithering",void 0),(0,L.g)("BABYLON.SkyMaterial",Z)},12300:(Q,X,C)=>{"use strict";function l(Q,X){X.headers=Q.headers||{},X.statusMessage=Q.statusText,X.statusCode=Q.status,X.data=Q.response}function h(Q,X,C){return new Promise((function(h,M){C=C||{};var f,O,m,W=new XMLHttpRequest,U=C.body,L=C.headers||{};for(f in C.timeout&&(W.timeout=C.timeout),W.ontimeout=W.onerror=function(Q){Q.timeout="timeout"==Q.type,M(Q)},W.open(Q,X.href||X),W.onload=function(){for(m=W.getAllResponseHeaders().trim().split(/[\r\n]+/),l(W,W);O=m.shift();)O=O.split(": "),W.headers[O.shift().toLowerCase()]=O.join(": ");if((O=W.headers["content-type"])&&~O.indexOf("application/json"))try{W.data=JSON.parse(W.data,C.reviver)}catch(Q){return l(W,Q),M(Q)}(W.status>=400?M:h)(W)},typeof FormData<"u"&&U instanceof FormData||U&&"object"==typeof U&&(L["content-type"]="application/json",U=JSON.stringify(U)),W.withCredentials=!!C.withCredentials,L)W.setRequestHeader(f,L[f]);W.send(U)}))}C.r(X),C.d(X,{del:()=>m,get:()=>M,patch:()=>O,post:()=>f,put:()=>W,send:()=>h});var M=h.bind(h,"GET"),f=h.bind(h,"POST"),O=h.bind(h,"PATCH"),m=h.bind(h,"DELETE"),W=h.bind(h,"PUT")},13505:(Q,X,C)=>{"use strict";C.d(X,{d:()=>L});const l=.5*(Math.sqrt(3)-1),h=(3-Math.sqrt(3))/6,M=1/3,f=1/6,O=(Math.sqrt(5)-1)/4,m=(5-Math.sqrt(5))/20,W=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),U=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const L=class{constructor(){let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const X="function"==typeof Q?Q:function(Q){let X=0,C=0,l=0,h=1;const M=function(){let Q=4022871197;return function(X){X=X.toString();for(let C=0;C<X.length;C++){Q+=X.charCodeAt(C);let l=.02519603282416938*Q;Q=l>>>0,l-=Q,l*=Q,Q=l>>>0,l-=Q,Q+=4294967296*l}return 2.3283064365386963e-10*(Q>>>0)}}();X=M(" "),C=M(" "),l=M(" "),X-=M(Q),X<0&&(X+=1);C-=M(Q),C<0&&(C+=1);l-=M(Q),l<0&&(l+=1);return function(){const Q=2091639*X+2.3283064365386963e-10*h;return X=C,C=l,l=Q-(h=0|Q)}}(Q);this.p=function(Q){const X=new Uint8Array(256);for(let C=0;C<256;C++)X[C]=C;for(let C=0;C<255;C++){const l=C+~~(Q()*(256-C)),h=X[C];X[C]=X[l],X[l]=h}return X}(X),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(Q,X){const C=this.permMod12,M=this.perm;let f=0,O=0,m=0;const U=(Q+X)*l,L=Math.floor(Q+U),w=Math.floor(X+U),i=(L+w)*h,a=Q-(L-i),F=X-(w-i);let s,z;a>F?(s=1,z=0):(s=0,z=1);const x=a-s+h,r=F-z+h,P=a-1+2*h,j=F-1+2*h,v=255&L,Z=255&w;let g=.5-a*a-F*F;if(g>=0){const Q=3*C[v+M[Z]];g*=g,f=g*g*(W[Q]*a+W[Q+1]*F)}let S=.5-x*x-r*r;if(S>=0){const Q=3*C[v+s+M[Z+z]];S*=S,O=S*S*(W[Q]*x+W[Q+1]*r)}let e=.5-P*P-j*j;if(e>=0){const Q=3*C[v+1+M[Z+1]];e*=e,m=e*e*(W[Q]*P+W[Q+1]*j)}return 70*(f+O+m)}noise3D(Q,X,C){const l=this.permMod12,h=this.perm;let O,m,U,L;const w=(Q+X+C)*M,i=Math.floor(Q+w),a=Math.floor(X+w),F=Math.floor(C+w),s=(i+a+F)*f,z=Q-(i-s),x=X-(a-s),r=C-(F-s);let P,j,v,Z,g,S;z>=x?x>=r?(P=1,j=0,v=0,Z=1,g=1,S=0):z>=r?(P=1,j=0,v=0,Z=1,g=0,S=1):(P=0,j=0,v=1,Z=1,g=0,S=1):x<r?(P=0,j=0,v=1,Z=0,g=1,S=1):z<r?(P=0,j=1,v=0,Z=0,g=1,S=1):(P=0,j=1,v=0,Z=1,g=1,S=0);const e=z-P+f,k=x-j+f,R=r-v+f,H=z-Z+2*f,o=x-g+2*f,T=r-S+2*f,Y=z-1+.5,J=x-1+.5,K=r-1+.5,N=255&i,q=255&a,n=255&F;let c=.6-z*z-x*x-r*r;if(c<0)O=0;else{const Q=3*l[N+h[q+h[n]]];c*=c,O=c*c*(W[Q]*z+W[Q+1]*x+W[Q+2]*r)}let E=.6-e*e-k*k-R*R;if(E<0)m=0;else{const Q=3*l[N+P+h[q+j+h[n+v]]];E*=E,m=E*E*(W[Q]*e+W[Q+1]*k+W[Q+2]*R)}let B=.6-H*H-o*o-T*T;if(B<0)U=0;else{const Q=3*l[N+Z+h[q+g+h[n+S]]];B*=B,U=B*B*(W[Q]*H+W[Q+1]*o+W[Q+2]*T)}let G=.6-Y*Y-J*J-K*K;if(G<0)L=0;else{const Q=3*l[N+1+h[q+1+h[n+1]]];G*=G,L=G*G*(W[Q]*Y+W[Q+1]*J+W[Q+2]*K)}return 32*(O+m+U+L)}noise4D(Q,X,C,l){const h=this.perm;let M,f,W,L,w;const i=(Q+X+C+l)*O,a=Math.floor(Q+i),F=Math.floor(X+i),s=Math.floor(C+i),z=Math.floor(l+i),x=(a+F+s+z)*m,r=Q-(a-x),P=X-(F-x),j=C-(s-x),v=l-(z-x);let Z=0,g=0,S=0,e=0;r>P?Z++:g++,r>j?Z++:S++,r>v?Z++:e++,P>j?g++:S++,P>v?g++:e++,j>v?S++:e++;const k=Z>=3?1:0,R=g>=3?1:0,H=S>=3?1:0,o=e>=3?1:0,T=Z>=2?1:0,Y=g>=2?1:0,J=S>=2?1:0,K=e>=2?1:0,N=Z>=1?1:0,q=g>=1?1:0,n=S>=1?1:0,c=e>=1?1:0,E=r-k+m,B=P-R+m,G=j-H+m,b=v-o+m,p=r-T+2*m,I=P-Y+2*m,t=j-J+2*m,y=v-K+2*m,A=r-N+3*m,D=P-q+3*m,u=j-n+3*m,V=v-c+3*m,d=r-1+4*m,QQ=P-1+4*m,XQ=j-1+4*m,CQ=v-1+4*m,lQ=255&a,hQ=255&F,MQ=255&s,fQ=255&z;let OQ=.6-r*r-P*P-j*j-v*v;if(OQ<0)M=0;else{const Q=h[lQ+h[hQ+h[MQ+h[fQ]]]]%32*4;OQ*=OQ,M=OQ*OQ*(U[Q]*r+U[Q+1]*P+U[Q+2]*j+U[Q+3]*v)}let mQ=.6-E*E-B*B-G*G-b*b;if(mQ<0)f=0;else{const Q=h[lQ+k+h[hQ+R+h[MQ+H+h[fQ+o]]]]%32*4;mQ*=mQ,f=mQ*mQ*(U[Q]*E+U[Q+1]*B+U[Q+2]*G+U[Q+3]*b)}let WQ=.6-p*p-I*I-t*t-y*y;if(WQ<0)W=0;else{const Q=h[lQ+T+h[hQ+Y+h[MQ+J+h[fQ+K]]]]%32*4;WQ*=WQ,W=WQ*WQ*(U[Q]*p+U[Q+1]*I+U[Q+2]*t+U[Q+3]*y)}let UQ=.6-A*A-D*D-u*u-V*V;if(UQ<0)L=0;else{const Q=h[lQ+N+h[hQ+q+h[MQ+n+h[fQ+c]]]]%32*4;UQ*=UQ,L=UQ*UQ*(U[Q]*A+U[Q+1]*D+U[Q+2]*u+U[Q+3]*V)}let LQ=.6-d*d-QQ*QQ-XQ*XQ-CQ*CQ;if(LQ<0)w=0;else{const Q=h[lQ+1+h[hQ+1+h[MQ+1+h[fQ+1]]]]%32*4;LQ*=LQ,w=LQ*LQ*(U[Q]*d+U[Q+1]*QQ+U[Q+2]*XQ+U[Q+3]*CQ)}return 27*(M+f+W+L+w)}}}}]);