"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{10689:(j,S,h)=>{h.r(S),h.d(S,{Dispose:()=>p,DumpData:()=>O,DumpDataAsync:()=>M,DumpFramebuffer:()=>a,DumpTools:()=>e});var m=h(1479),I=h(1166),d=h(1005),U=h(1001);let f,r=null;async function a(j,S,h,m){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const f=await h.readPixels(0,0,j,S);O(j,S,new Uint8Array(f.buffer),m,I,d,!0,void 0,U)}function M(j,S,h){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7?arguments[7]:void 0;return new Promise((r=>{O(j,S,h,(j=>r(j)),m,I,d,U,f)}))}function O(j,S,a,M){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8?arguments[8]:void 0;(async function(){return r||(r=new Promise(((j,S)=>{let I,d=null;const r={Se:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,1399)).then((a=>{let{ThinEngine:M}=a;try{I=new OffscreenCanvas(100,100),d=new M(I,!1,r)}catch(e){I=document.createElement("canvas"),d=new M(I,!1,r)}U.d.Instances.pop(),U.d.OnEnginesDisposedObservable.add((j=>{d&&j!==d&&!d.u&&0===U.d.Instances.length&&p()})),d.getCaps().parallelShaderCompile=void 0;const O=new m.c(d);h.e(32).then(h.bind(h,11434)).then((h=>{let{passPixelShader:U}=h;if(!d)return void S("Engine is not defined");const r=new m.f({pb:d,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});f={canvas:I,pb:d,renderer:O,wrapper:r},j(f)}))})).catch(S)}))),await r})().then((h=>{if(h.pb.setSize(j,S,!0),a instanceof Float32Array){const j=new Uint8Array(a.length);let S=a.length;for(;S--;){const h=a[S];j[S]=Math.round(255*(0,d.d)(h))}a=j}const m=h.pb.createRawTexture(a,j,S,5,!1,!w,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",m),h.renderer.draw(),l?I.e.ToBlob(h.canvas,(j=>{const S=new FileReader;S.onload=j=>{const S=j.target.result;M&&M(S)},S.readAsArrayBuffer(j)}),O,P):I.e.EncodeScreenshotCanvasData(h.canvas,M,O,e,P),m.dispose()}))}function p(){var j;f?(f.wrapper.dispose(),f.renderer.dispose(),f.pb.dispose()):null===(j=r)||void 0===j||j.then((j=>{j.wrapper.dispose(),j.renderer.dispose(),j.pb.dispose()}));r=null,f=null}const e={DumpData:O,DumpDataAsync:M,DumpFramebuffer:a,Dispose:p};I.e.DumpData=O,I.e.DumpDataAsync=M,I.e.DumpFramebuffer=a}}]);