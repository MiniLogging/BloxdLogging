"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[47],{14093:(b,d,P)=>{P.r(d),P.d(d,{_BasisTextureLoader:()=>B});var G,W=P(11484),i=P(11658),q=P(11619);function C(){const b=0,d=1,P=2,G=3,W=6,i=8,q=9,C=10,J=14;let L=null;function x(b,d,P,G,W){const i=b.getImageTranscodedSizeInBytes(d,P,G);let q=new Uint8Array(i);if(!b.transcodeImage(q,d,P,G,1,0))return null;if(W){q=function(b,d,P,G){const W=new Uint16Array(4),i=new Uint16Array(P*G),q=P/4,C=G/4;for(let J=0;J<C;J++)for(let G=0;G<q;G++){const C=d+8*(J*q+G);W[0]=b[C]|b[C+1]<<8,W[1]=b[C+2]|b[C+3]<<8,W[2]=(2*(31&W[0])+1*(31&W[1]))/3|(2*(2016&W[0])+1*(2016&W[1]))/3&2016|(2*(63488&W[0])+1*(63488&W[1]))/3&63488,W[3]=(2*(31&W[1])+1*(31&W[0]))/3|(2*(2016&W[1])+1*(2016&W[0]))/3&2016|(2*(63488&W[1])+1*(63488&W[0]))/3&63488;for(let d=0;d<4;d++){const q=b[C+4+d];let L=(4*J+d)*P+4*G;i[L++]=W[3&q],i[L++]=W[q>>2&3],i[L++]=W[q>>4&3],i[L++]=W[q>>6&3]}}return i}(q,0,b.getImageWidth(d,P)+3&-4,b.getImageHeight(d,P)+3&-4)}return q}onmessage=Y=>{if("init"===Y.data.action){if(Y.data.url)try{importScripts(Y.data.url)}catch(s){postMessage({action:"error",error:s})}L||(L=BASIS({wasmBinary:Y.data.wasmBinary})),null!==L&&L.then((b=>{BASIS=b,b.initializeBasis(),postMessage({action:"init"})}))}else if("transcode"===Y.data.action){const L=Y.data.config,s=Y.data.imageData,E=new BASIS.BasisFile(s),w=function(b){const d=b.getHasAlpha(),P=b.getNumImages(),G=[];for(let W=0;W<P;W++){const d={levels:[]},P=b.getNumLevels(W);for(let G=0;G<P;G++){const P={width:b.getImageWidth(W,G),height:b.getImageHeight(W,G)};d.levels.push(P)}G.push(d)}return{ad:d,images:G}}(E);let t=Y.data.ignoreSupportedFormats?null:function(L,x){let Y=null;L.supportedCompressionFormats&&(Y=L.supportedCompressionFormats.astc?C:L.supportedCompressionFormats.bc7?W:L.supportedCompressionFormats.s3tc?x.ad?G:P:L.supportedCompressionFormats.pvrtc?x.ad?q:i:L.supportedCompressionFormats.etc2?d:L.supportedCompressionFormats.etc1?b:J);return Y}(Y.data.config,w),r=!1;null===t&&(r=!0,t=w.ad?G:P);let B=!0;E.startTranscoding()||(B=!1);const n=[];for(let b=0;b<w.images.length&&B;b++){const d=w.images[b];if(void 0===L.loadSingleImage||L.loadSingleImage===b){let P=d.levels.length;!1===L.loadMipmapLevels&&(P=1);for(let G=0;G<P;G++){const P=d.levels[G],W=x(E,b,G,t,r);if(!W){B=!1;break}P.transcodedPixels=W,n.push(P.transcodedPixels.buffer)}}}E.close(),E.delete(),r&&(t=-1),B?postMessage({action:"transcode",success:B,id:Y.data.id,fileInfo:w,format:t},n):postMessage({action:"transcode",success:B,id:Y.data.id})}}}!function(b){b[b.cTFETC1=0]="cTFETC1",b[b.cTFETC2=1]="cTFETC2",b[b.cTFBC1=2]="cTFBC1",b[b.cTFBC3=3]="cTFBC3",b[b.cTFBC4=4]="cTFBC4",b[b.cTFBC5=5]="cTFBC5",b[b.cTFBC7=6]="cTFBC7",b[b.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",b[b.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",b[b.cTFASTC_4x4=10]="cTFASTC_4x4",b[b.cTFATC_RGB=11]="cTFATC_RGB",b[b.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",b[b.cTFRGBA32=13]="cTFRGBA32",b[b.cTFRGB565=14]="cTFRGB565",b[b.cTFBGR565=15]="cTFBGR565",b[b.cTFRGBA4444=16]="cTFRGBA4444",b[b.cTFFXT1_RGB=17]="cTFFXT1_RGB",b[b.cTFPVRTC2_4_RGB=18]="cTFPVRTC2_4_RGB",b[b.cTFPVRTC2_4_RGBA=19]="cTFPVRTC2_4_RGBA",b[b.cTFETC2_EAC_R11=20]="cTFETC2_EAC_R11",b[b.cTFETC2_EAC_RG11=21]="cTFETC2_EAC_RG11"}(G||(G={}));const J={JSModuleURL:`${W.Tools._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.js`,WasmModuleURL:`${W.Tools._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.wasm`};let L=null,x=null,Y=0;const s=async()=>(L||(L=new Promise(((b,d)=>{x?b(x):W.Tools.LoadFileAsync(W.Tools.GetBabylonScriptURL(J.WasmModuleURL)).then((P=>{if("function"!==typeof URL)return d("Basis transcoder requires an environment with a URL constructor");const G=URL.createObjectURL(new Blob([`(${C})()`],{type:"application/javascript"}));x=new Worker(G),async function(b,d,P){return await new Promise(((G,i)=>{const q=d=>{"init"===d.data.action?(b.removeEventListener("message",q),G(b)):"error"===d.data.action&&i(d.data.error||"error initializing worker")};b.addEventListener("message",q),b.postMessage({action:"init",url:P?W.Tools.GetBabylonScriptURL(P):void 0,wasmBinary:d},[d])}))}(x,P,J.JSModuleURL).then(b,d)})).catch(d)}))),await L),E=async(b,d)=>{const P=b instanceof ArrayBuffer?new Uint8Array(b):b;return await new Promise(((b,G)=>{s().then((()=>{const W=Y++,i=d=>{"transcode"===d.data.action&&d.data.id===W&&(x.removeEventListener("message",i),d.data.success?b(d.data):G("Transcode is not supported on this device"))};x.addEventListener("message",i);const q=new Uint8Array(P.byteLength);q.set(new Uint8Array(P.buffer,P.byteOffset,P.byteLength)),x.postMessage({action:"transcode",id:W,imageData:q,config:d,ignoreSupportedFormats:false},[q.buffer])}),(b=>{G(b)}))}))},w=(b,d)=>{var P;let G=null===(P=d._gl)||void 0===P?void 0:P.TEXTURE_2D;var W;b.isCube&&(G=null===(W=d._gl)||void 0===W?void 0:W.TEXTURE_CUBE_MAP);d._bindTextureDirectly(G,b,!0)},t=(b,d)=>{const P=b.getEngine();for(let C=0;C<d.fileInfo.images.length;C++){const J=d.fileInfo.images[C].levels[0];if(b._invertVScale=b.invertY,-1===d.format||d.format===G.cTFRGB565)if(b.type=10,b.format=4,!P._features.basisNeedsPOT||Math.log2(J.width)%1===0&&Math.log2(J.height)%1===0)b._invertVScale=!b.invertY,b.width=J.width+3&-4,b.height=J.height+3&-4,b.samplingMode=2,w(b,P),P._uploadDataToTextureDirectly(b,new Uint16Array(J.transcodedPixels.buffer),C,0,4,!0);else{const d=new q.e(P,2);b._invertVScale=b.invertY,d.type=10,d.format=4,d.width=J.width+3&-4,d.height=J.height+3&-4,w(d,P),P._uploadDataToTextureDirectly(d,new Uint16Array(J.transcodedPixels.buffer),C,0,4,!0),P._rescaleTexture(d,b,P.scenes[0],P._getInternalFormat(4),(()=>{P._releaseTexture(d),w(b,P)}))}else{b.width=J.width,b.height=J.height,b.generateMipMaps=d.fileInfo.images[C].levels.length>1;const G=r.GetInternalFormatFromBasisFormat(d.format,P);b.format=G,w(b,P);const q=d.fileInfo.images[C].levels;for(let d=0;d<q.length;d++){const W=q[d];P._uploadCompressedDataToTextureDirectly(b,G,W.width,W.height,W.transcodedPixels,C,d)}!P._features.basisNeedsPOT||Math.log2(b.width)%1===0&&Math.log2(b.height)%1===0||(W.Tools.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),b._cachedWrapU=i.d.CLAMP_ADDRESSMODE,b._cachedWrapV=i.d.CLAMP_ADDRESSMODE)}}},r={JSModuleURL:J.JSModuleURL,WasmModuleURL:J.WasmModuleURL,GetInternalFormatFromBasisFormat:(b,d)=>{let P;switch(b){case G.cTFETC1:P=36196;break;case G.cTFBC1:P=33776;break;case G.cTFBC4:P=33779;break;case G.cTFASTC_4x4:P=37808;break;case G.cTFETC2:P=37496;break;case G.cTFBC7:P=36492}if(void 0===P)throw"The chosen Basis transcoder format is not currently supported";return P},TranscodeAsync:E,LoadTextureFromTranscodeResult:t};Object.defineProperty(r,"JSModuleURL",{get:function(){return J.JSModuleURL},set:function(b){J.JSModuleURL=b}}),Object.defineProperty(r,"WasmModuleURL",{get:function(){return J.WasmModuleURL},set:function(b){J.WasmModuleURL=b}});class B{constructor(){this.supportCascades=!1}loadCubeData(b,d,P,G,i){if(Array.isArray(b))return;const q=d.getEngine().getCaps(),C={supportedCompressionFormats:{etc1:!!q.etc1,s3tc:!!q.s3tc,pvrtc:!!q.pvrtc,etc2:!!q.etc2,astc:!!q.astc,bc7:!!q.bptc}};E(b,C).then((b=>{const P=b.fileInfo.images[0].levels.length>1&&d.generateMipMaps;t(d,b),d.getEngine()._setCubeMapTextureParams(d,P),d.isReady=!0,d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),G&&G()})).catch((b=>{W.Tools.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),d.isReady=!0,i&&i(b)}))}loadData(b,d,P){const G=d.getEngine().getCaps(),i={supportedCompressionFormats:{etc1:!!G.etc1,s3tc:!!G.s3tc,pvrtc:!!G.pvrtc,etc2:!!G.etc2,astc:!!G.astc,bc7:!!G.bptc}};E(b,i).then((b=>{const G=b.fileInfo.images[0].levels[0],W=b.fileInfo.images[0].levels.length>1&&d.generateMipMaps;P(G.width,G.height,W,-1!==b.format,(()=>{t(d,b)}))})).catch((b=>{W.Tools.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),W.Tools.Warn(`Failed to transcode Basis file: ${b}`),P(0,0,!1,!1,(()=>{}),!0)}))}}}}]);