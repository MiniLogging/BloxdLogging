"use strict";(self.nyfa010khv=self.nyfa010khv||[]).push([[47],{14597:(L,r,p)=>{p.r(r),p.d(r,{_BasisTextureLoader:()=>P});var J,i=p(11957),n=p(12111),j=p(12060);function z(){const L=0,r=1,p=2,J=3,i=6,n=8,j=9,z=10,G=14;let C=null;function t(L,r,p,J,i){const n=L.getImageTranscodedSizeInBytes(r,p,J);let j=new Uint8Array(n);if(!L.transcodeImage(j,r,p,J,1,0))return null;if(i){j=function(L,r,p,J){const i=new Uint16Array(4),n=new Uint16Array(p*J),j=p/4,z=J/4;for(let G=0;G<z;G++)for(let J=0;J<j;J++){const z=r+8*(G*j+J);i[0]=L[z]|L[z+1]<<8,i[1]=L[z+2]|L[z+3]<<8,i[2]=(2*(31&i[0])+1*(31&i[1]))/3|(2*(2016&i[0])+1*(2016&i[1]))/3&2016|(2*(63488&i[0])+1*(63488&i[1]))/3&63488,i[3]=(2*(31&i[1])+1*(31&i[0]))/3|(2*(2016&i[1])+1*(2016&i[0]))/3&2016|(2*(63488&i[1])+1*(63488&i[0]))/3&63488;for(let r=0;r<4;r++){const j=L[z+4+r];let C=(4*G+r)*p+4*J;n[C++]=i[3&j],n[C++]=i[j>>2&3],n[C++]=i[j>>4&3],n[C++]=i[j>>6&3]}}return n}(j,0,L.getImageWidth(r,p)+3&-4,L.getImageHeight(r,p)+3&-4)}return j}onmessage=E=>{if("init"===E.data.action){if(E.data.url)try{importScripts(E.data.url)}catch(x){postMessage({action:"error",error:x})}C||(C=BASIS({wasmBinary:E.data.wasmBinary})),null!==C&&C.then((L=>{BASIS=L,L.initializeBasis(),postMessage({action:"init"})}))}else if("transcode"===E.data.action){const C=E.data.config,x=E.data.imageData,w=new BASIS.BasisFile(x),g=function(L){const r=L.getHasAlpha(),p=L.getNumImages(),J=[];for(let i=0;i<p;i++){const r={levels:[]},p=L.getNumLevels(i);for(let J=0;J<p;J++){const p={width:L.getImageWidth(i,J),height:L.getImageHeight(i,J)};r.levels.push(p)}J.push(r)}return{pz:r,images:J}}(w);let b=E.data.ignoreSupportedFormats?null:function(C,t){let E=null;C.supportedCompressionFormats&&(E=C.supportedCompressionFormats.astc?z:C.supportedCompressionFormats.bc7?i:C.supportedCompressionFormats.s3tc?t.pz?J:p:C.supportedCompressionFormats.pvrtc?t.pz?j:n:C.supportedCompressionFormats.etc2?r:C.supportedCompressionFormats.etc1?L:G);return E}(E.data.config,g),c=!1;null===b&&(c=!0,b=g.pz?J:p);let P=!0;w.startTranscoding()||(P=!1);const O=[];for(let L=0;L<g.images.length&&P;L++){const r=g.images[L];if(void 0===C.loadSingleImage||C.loadSingleImage===L){let p=r.levels.length;!1===C.loadMipmapLevels&&(p=1);for(let J=0;J<p;J++){const p=r.levels[J],i=t(w,L,J,b,c);if(!i){P=!1;break}p.transcodedPixels=i,O.push(p.transcodedPixels.buffer)}}}w.close(),w.delete(),c&&(b=-1),P?postMessage({action:"transcode",success:P,id:E.data.id,fileInfo:g,format:b},O):postMessage({action:"transcode",success:P,id:E.data.id})}}}!function(L){L[L.cTFETC1=0]="cTFETC1",L[L.cTFETC2=1]="cTFETC2",L[L.cTFBC1=2]="cTFBC1",L[L.cTFBC3=3]="cTFBC3",L[L.cTFBC4=4]="cTFBC4",L[L.cTFBC5=5]="cTFBC5",L[L.cTFBC7=6]="cTFBC7",L[L.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",L[L.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",L[L.cTFASTC_4x4=10]="cTFASTC_4x4",L[L.cTFATC_RGB=11]="cTFATC_RGB",L[L.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",L[L.cTFRGBA32=13]="cTFRGBA32",L[L.cTFRGB565=14]="cTFRGB565",L[L.cTFBGR565=15]="cTFBGR565",L[L.cTFRGBA4444=16]="cTFRGBA4444",L[L.cTFFXT1_RGB=17]="cTFFXT1_RGB",L[L.cTFPVRTC2_4_RGB=18]="cTFPVRTC2_4_RGB",L[L.cTFPVRTC2_4_RGBA=19]="cTFPVRTC2_4_RGBA",L[L.cTFETC2_EAC_R11=20]="cTFETC2_EAC_R11",L[L.cTFETC2_EAC_RG11=21]="cTFETC2_EAC_RG11"}(J||(J={}));const G={JSModuleURL:`${i.Tools._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.js`,WasmModuleURL:`${i.Tools._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.wasm`};let C=null,t=null,E=0;const x=async()=>(C||(C=new Promise(((L,r)=>{t?L(t):i.Tools.LoadFileAsync(i.Tools.GetBabylonScriptURL(G.WasmModuleURL)).then((p=>{if("function"!==typeof URL)return r("Basis transcoder requires an environment with a URL constructor");const J=URL.createObjectURL(new Blob([`(${z})()`],{type:"application/javascript"}));t=new Worker(J),async function(L,r,p){return await new Promise(((J,n)=>{const j=r=>{"init"===r.data.action?(L.removeEventListener("message",j),J(L)):"error"===r.data.action&&n(r.data.error||"error initializing worker")};L.addEventListener("message",j),L.postMessage({action:"init",url:p?i.Tools.GetBabylonScriptURL(p):void 0,wasmBinary:r},[r])}))}(t,p,G.JSModuleURL).then(L,r)})).catch(r)}))),await C),w=async(L,r)=>{const p=L instanceof ArrayBuffer?new Uint8Array(L):L;return await new Promise(((L,J)=>{x().then((()=>{const i=E++,n=r=>{"transcode"===r.data.action&&r.data.id===i&&(t.removeEventListener("message",n),r.data.success?L(r.data):J("Transcode is not supported on this device"))};t.addEventListener("message",n);const j=new Uint8Array(p.byteLength);j.set(new Uint8Array(p.buffer,p.byteOffset,p.byteLength)),t.postMessage({action:"transcode",id:i,imageData:j,config:r,ignoreSupportedFormats:false},[j.buffer])}),(L=>{J(L)}))}))},g=(L,r)=>{var p;let J=null===(p=r._gl)||void 0===p?void 0:p.TEXTURE_2D;var i;L.isCube&&(J=null===(i=r._gl)||void 0===i?void 0:i.TEXTURE_CUBE_MAP);r._bindTextureDirectly(J,L,!0)},b=(L,r)=>{const p=L.getEngine();for(let z=0;z<r.fileInfo.images.length;z++){const G=r.fileInfo.images[z].levels[0];if(L._invertVScale=L.invertY,-1===r.format||r.format===J.cTFRGB565)if(L.type=10,L.format=4,!p._features.basisNeedsPOT||Math.log2(G.width)%1===0&&Math.log2(G.height)%1===0)L._invertVScale=!L.invertY,L.width=G.width+3&-4,L.height=G.height+3&-4,L.samplingMode=2,g(L,p),p._uploadDataToTextureDirectly(L,new Uint16Array(G.transcodedPixels.buffer),z,0,4,!0);else{const r=new j.b(p,2);L._invertVScale=L.invertY,r.type=10,r.format=4,r.width=G.width+3&-4,r.height=G.height+3&-4,g(r,p),p._uploadDataToTextureDirectly(r,new Uint16Array(G.transcodedPixels.buffer),z,0,4,!0),p._rescaleTexture(r,L,p.scenes[0],p._getInternalFormat(4),(()=>{p._releaseTexture(r),g(L,p)}))}else{L.width=G.width,L.height=G.height,L.generateMipMaps=r.fileInfo.images[z].levels.length>1;const J=c.GetInternalFormatFromBasisFormat(r.format,p);L.format=J,g(L,p);const j=r.fileInfo.images[z].levels;for(let r=0;r<j.length;r++){const i=j[r];p._uploadCompressedDataToTextureDirectly(L,J,i.width,i.height,i.transcodedPixels,z,r)}!p._features.basisNeedsPOT||Math.log2(L.width)%1===0&&Math.log2(L.height)%1===0||(i.Tools.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),L._cachedWrapU=n.c.CLAMP_ADDRESSMODE,L._cachedWrapV=n.c.CLAMP_ADDRESSMODE)}}},c={JSModuleURL:G.JSModuleURL,WasmModuleURL:G.WasmModuleURL,GetInternalFormatFromBasisFormat:(L,r)=>{let p;switch(L){case J.cTFETC1:p=36196;break;case J.cTFBC1:p=33776;break;case J.cTFBC4:p=33779;break;case J.cTFASTC_4x4:p=37808;break;case J.cTFETC2:p=37496;break;case J.cTFBC7:p=36492}if(void 0===p)throw"The chosen Basis transcoder format is not currently supported";return p},TranscodeAsync:w,LoadTextureFromTranscodeResult:b};Object.defineProperty(c,"JSModuleURL",{get:function(){return G.JSModuleURL},set:function(L){G.JSModuleURL=L}}),Object.defineProperty(c,"WasmModuleURL",{get:function(){return G.WasmModuleURL},set:function(L){G.WasmModuleURL=L}});class P{constructor(){this.supportCascades=!1}loadCubeData(L,r,p,J,n){if(Array.isArray(L))return;const j=r.getEngine().getCaps(),z={supportedCompressionFormats:{etc1:!!j.etc1,s3tc:!!j.s3tc,pvrtc:!!j.pvrtc,etc2:!!j.etc2,astc:!!j.astc,bc7:!!j.bptc}};w(L,z).then((L=>{const p=L.fileInfo.images[0].levels.length>1&&r.generateMipMaps;b(r,L),r.getEngine()._setCubeMapTextureParams(r,p),r.isReady=!0,r.onLoadedObservable.notifyObservers(r),r.onLoadedObservable.clear(),J&&J()})).catch((L=>{i.Tools.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),r.isReady=!0,n&&n(L)}))}loadData(L,r,p){const J=r.getEngine().getCaps(),n={supportedCompressionFormats:{etc1:!!J.etc1,s3tc:!!J.s3tc,pvrtc:!!J.pvrtc,etc2:!!J.etc2,astc:!!J.astc,bc7:!!J.bptc}};w(L,n).then((L=>{const J=L.fileInfo.images[0].levels[0],i=L.fileInfo.images[0].levels.length>1&&r.generateMipMaps;p(J.width,J.height,i,-1!==L.format,(()=>{b(r,L)}))})).catch((L=>{i.Tools.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),i.Tools.Warn(`Failed to transcode Basis file: ${L}`),p(0,0,!1,!1,(()=>{}),!0)}))}}}}]);