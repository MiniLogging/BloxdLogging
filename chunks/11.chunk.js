/*! For license information please see fblfu.11.277aae3d.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{12973:(x,O,Q)=>{"use strict";var X=Q(12982),Z=Q(12989),n=Q(12991);Q.g.__TYPEDARRAY_POOL||(Q.g.__TYPEDARRAY_POOL={UINT8:Z([32,0]),UINT16:Z([32,0]),UINT32:Z([32,0]),INT8:Z([32,0]),INT16:Z([32,0]),INT32:Z([32,0]),FLOAT:Z([32,0]),DOUBLE:Z([32,0]),DATA:Z([32,0]),UINT8C:Z([32,0]),BUFFER:Z([32,0])});var V="undefined"!==typeof Uint8ClampedArray,o=Q.g.__TYPEDARRAY_POOL;o.UINT8C||(o.UINT8C=Z([32,0])),o.BUFFER||(o.BUFFER=Z([32,0]));var l=o.DATA,C=o.BUFFER;function U(x){if(x){var O=x.length||x.byteLength,Q=X.log2(O);l[Q].push(x)}}function L(x){x=X.nextPow2(x);var O=X.log2(x),Q=l[O];return Q.length>0?Q.pop():new ArrayBuffer(x)}function h(x){return new Uint8Array(L(x),0,x)}function N(x){return new Uint16Array(L(2*x),0,x)}function a(x){return new Uint32Array(L(4*x),0,x)}function K(x){return new Int8Array(L(x),0,x)}function M(x){return new Int16Array(L(2*x),0,x)}function Y(x){return new Int32Array(L(4*x),0,x)}function g(x){return new Float32Array(L(4*x),0,x)}function v(x){return new Float64Array(L(8*x),0,x)}function R(x){return V?new Uint8ClampedArray(L(x),0,x):h(x)}function s(x){return new DataView(L(x),0,x)}O.free=function(x){if(n(x))C[X.log2(x.length)].push(x);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(x)&&(x=x.buffer),!x)return;var O=x.length||x.byteLength,Q=0|X.log2(O);l[Q].push(x)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(x){U(x.buffer)},O.freeArrayBuffer=U,O.freeBuffer=function(x){C[X.log2(x.length)].push(x)},O.malloc=function(x,O){if(void 0===O||"arraybuffer"===O)return L(x);switch(O){case"uint8":return h(x);case"uint16":return N(x);case"uint32":return a(x);case"int8":return K(x);case"int16":return M(x);case"int32":return Y(x);case"float":case"float32":return g(x);case"double":case"float64":return v(x);case"uint8_clamped":return R(x);case"buffer":throw"Buffer not supported";case"data":case"dataview":return s(x);default:return null}return null},O.mallocArrayBuffer=L,O.mallocUint8=h,O.mallocUint16=N,O.mallocUint32=a,O.mallocInt8=K,O.mallocInt16=M,O.mallocInt32=Y,O.mallocFloat32=O.mallocFloat=g,O.mallocFloat64=O.mallocDouble=v,O.mallocUint8Clamped=R,O.mallocDataView=s,O.clearCache=function(){for(var x=0;x<32;++x)o.UINT8[x].length=0,o.UINT16[x].length=0,o.UINT32[x].length=0,o.INT8[x].length=0,o.INT16[x].length=0,o.INT32[x].length=0,o.FLOAT[x].length=0,o.DOUBLE[x].length=0,o.UINT8C[x].length=0,l[x].length=0,C[x].length=0}},13090:(x,O,Q)=>{x.exports=Z;var X=Q(11809);function Z(x,O){if(!(this instanceof Z))return new Z(x,O);var Q=X.create();X.add(Q,x,O),this.base=X.min(X.create(),x,Q),this.AC=X.clone(O),this.max=X.max(X.create(),x,Q),this.mag=X.length(this.AC)}var n=Z.prototype;n.width=function(){return this.AC[0]},n.height=function(){return this.AC[1]},n.depth=function(){return this.AC[2]},n.x0=function(){return this.base[0]},n.y0=function(){return this.base[1]},n.z0=function(){return this.base[2]},n.x1=function(){return this.max[0]},n.y1=function(){return this.max[1]},n.z1=function(){return this.max[2]},n.translate=function(x){return X.add(this.max,this.max,x),X.add(this.base,this.base,x),this},n.setPosition=function(x){return X.add(this.max,x,this.AC),X.j(this.base,x),this},n.expand=function(x){var O=X.create(),Q=X.create();return X.max(O,x.max,this.max),X.min(Q,x.base,this.base),X.hQ(O,O,Q),new Z(Q,O)},n.intersects=function(x){return!(x.base[0]>this.max[0])&&(!(x.base[1]>this.max[1])&&(!(x.base[2]>this.max[2])&&(!(x.max[0]<this.base[0])&&(!(x.max[1]<this.base[1])&&!(x.max[2]<this.base[2])))))},n.touches=function(x){var O=this.union(x);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},n.union=function(x){if(!this.intersects(x))return null;var O=Math.max(x.base[0],this.base[0]),Q=Math.max(x.base[1],this.base[1]),X=Math.max(x.base[2],this.base[2]);return new Z([O,Q,X],[Math.min(x.max[0],this.max[0])-O,Math.min(x.max[1],this.max[1])-Q,Math.min(x.max[2],this.max[2])-X])}},12982:(x,O)=>{"use strict";function Q(x){var O=32;return(x&=-x)&&O--,65535&x&&(O-=16),16711935&x&&(O-=8),252645135&x&&(O-=4),858993459&x&&(O-=2),1431655765&x&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(x){return(x>0)-(x<0)},O.abs=function(x){var O=x>>31;return(x^O)-O},O.min=function(x,O){return O^(x^O)&-(x<O)},O.max=function(x,O){return x^(x^O)&-(x<O)},O.isPow2=function(x){return!(x&x-1)&&!!x},O.log2=function(x){var O,Q;return O=(x>65535)<<4,O|=Q=((x>>>=O)>255)<<3,O|=Q=((x>>>=Q)>15)<<2,(O|=Q=((x>>>=Q)>3)<<1)|(x>>>=Q)>>1},O.log10=function(x){return x>=1e9?9:x>=1e8?8:x>=1e7?7:x>=1e6?6:x>=1e5?5:x>=1e4?4:x>=1e3?3:x>=100?2:x>=10?1:0},O.popCount=function(x){return 16843009*((x=(858993459&(x-=x>>>1&1431655765))+(x>>>2&858993459))+(x>>>4)&252645135)>>>24},O.countTrailingZeros=Q,O.nextPow2=function(x){return x+=0===x,--x,x|=x>>>1,x|=x>>>2,x|=x>>>4,x|=x>>>8,(x|=x>>>16)+1},O.prevPow2=function(x){return x|=x>>>1,x|=x>>>2,x|=x>>>4,x|=x>>>8,(x|=x>>>16)-(x>>>1)},O.parity=function(x){return x^=x>>>16,x^=x>>>8,x^=x>>>4,27030>>>(x&=15)&1};var X=new Array(256);!function(x){for(var O=0;O<256;++O){var Q=O,X=O,Z=7;for(Q>>>=1;Q;Q>>>=1)X<<=1,X|=1&Q,--Z;x[O]=X<<Z&255}}(X),O.reverse=function(x){return X[255&x]<<24|X[x>>>8&255]<<16|X[x>>>16&255]<<8|X[x>>>24&255]},O.interleave2=function(x,O){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(x,O){return(x=65535&((x=16711935&((x=252645135&((x=858993459&((x=x>>>O&1431655765)|x>>>1))|x>>>2))|x>>>4))|x>>>16))<<16>>16},O.interleave3=function(x,O,Q){return x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2),(x|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},O.deinterleave3=function(x,O){return(x=1023&((x=4278190335&((x=251719695&((x=3272356035&((x=x>>>O&1227133513)|x>>>2))|x>>>4))|x>>>8))|x>>>16))<<22>>22},O.nextCombination=function(x){var O=x|x-1;return O+1|(~O&-~O)-1>>>Q(x)+1}},12966:(x,O,Q)=>{"use strict";x.exports=function(x,O,Q){switch(arguments.length){case 1:return X=[],C(Z=x,Z,U,!0),X;case 2:return"function"===typeof O?C(x,x,O,!0):function(x,O){return X=[],C(x,O,U,!1),X}(x,O);case 3:return C(x,O,Q,!1);default:throw new Error("box-intersect: Invalid arguments")}var Z};var X,Z=Q(12973),n=Q(12999),V=Q(13014);function o(x,O){for(var Q=0;Q<x;++Q)if(!(O[Q]<=O[Q+x]))return!0;return!1}function l(x,O,Q,X){for(var Z=0,n=0,V=0,l=x.length;V<l;++V){var C=x[V];if(!o(O,C)){for(var U=0;U<2*O;++U)Q[Z++]=C[U];X[n++]=V}}return n}function C(x,O,Q,X){var o=x.length,C=O.length;if(!(o<=0||C<=0)){var U=x[0].length>>>1;if(!(U<=0)){var L,h=Z.mallocDouble(2*U*o),N=Z.mallocInt32(o);if((o=l(x,U,h,N))>0){if(1===U&&X)n.init(o),L=n.sweepComplete(U,Q,0,o,h,N,0,o,h,N);else{var a=Z.mallocDouble(2*U*C),K=Z.mallocInt32(C);(C=l(O,U,a,K))>0&&(n.init(o+C),L=1===U?n.sweepBipartite(U,Q,0,o,h,N,0,C,a,K):V(U,Q,X,o,h,N,C,a,K),Z.free(a),Z.free(K))}Z.free(h),Z.free(N)}return L}}}function U(x,O){X.push([x,O])}},13023:(x,O)=>{"use strict";var Q="d",X="ax",Z="fp",n="es",V="rs",o="re",l="rb",C="bs",U="be",L="bb",h=[Q,X,"vv",V,o,l,"ri",C,U,L,"bi"];function N(x){var O="bruteForce"+(x?"Full":"Partial"),X=[],V=h.slice();x||V.splice(3,0,Z);var o=["function "+O+"("+V.join()+"){"];function l(O,Z){var V=function(x,O,X){var Z="bruteForce"+(x?"Red":"Blue")+(O?"Flip":"")+(X?"Full":""),V=["function ",Z,"(",h.join(),"){","var ",n,"=2*",Q,";"],o="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",l="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(X?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return x?V.push(o,"Q",":",l):V.push(l,"Q",":",o),X?V.push("if(y1<x0||x1<y0)continue;"):O?V.push("if(y0<=x0||x1<y0)continue;"):V.push("if(y0<x0||x1<y0)continue;"),V.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?V.push("yi,xi"):V.push("xi,yi"),V.push(");if(rv!==void 0)return rv;}}}"),{name:Z,code:V.join("")}}(O,Z,x);X.push(V.code),o.push("return "+V.name+"("+h.join()+");")}o.push("if(re-rs>be-bs){"),x?(l(!0,!1),o.push("}else{"),l(!1,!1)):(o.push("if(fp){"),l(!0,!0),o.push("}else{"),l(!0,!1),o.push("}}else{if(fp){"),l(!1,!0),o.push("}else{"),l(!1,!1),o.push("}")),o.push("}}return "+O);var C=X.join("")+o.join("");return new Function(C)()}O.partial=N(!1),O.full=N(!0)},13014:(x,O,Q)=>{"use strict";x.exports=function(x,O,Q,n,U,c,d,u,A){!function(x,O){var Q=8*Z.log2(O+1)*(x+1)|0,n=Z.nextPow2(R*Q);q.length<n&&(X.free(q),q=X.mallocInt32(n));var V=Z.nextPow2(s*Q);G.length<V&&(X.free(G),G=X.mallocDouble(V))}(x,n+d);var f,E=0,z=2*x;k(E++,0,0,n,0,d,Q?16:0,-1/0,1/0),Q||k(E++,0,0,d,0,n,1,-1/0,1/0);for(;E>0;){var F=(E-=1)*R,b=q[F],D=q[F+1],W=q[F+2],y=q[F+3],I=q[F+4],r=q[F+5],j=E*s,T=G[j],e=G[j+1],B=1&r,i=!!(16&r),H=U,S=c,p=u,P=A;if(B&&(H=u,S=A,p=U,P=c),!(2&r&&D>=(W=M(x,b,D,W,H,S,e)))&&!(4&r&&(D=Y(x,b,D,W,H,S,T))>=W)){var m=W-D,w=I-y;if(i){if(x*m*(m+w)<N){if(void 0!==(f=l.scanComplete(x,b,O,D,W,H,S,y,I,p,P)))return f;continue}}else{if(x*Math.min(m,w)<L){if(void 0!==(f=V(x,b,O,B,D,W,H,S,y,I,p,P)))return f;continue}if(x*m*w<h){if(void 0!==(f=l.scanBipartite(x,b,O,B,D,W,H,S,y,I,p,P)))return f;continue}}var xx=a(x,b,D,W,H,S,T,e);if(D<xx)if(x*(xx-D)<L){if(void 0!==(f=o(x,b+1,O,D,xx,H,S,y,I,p,P)))return f}else if(b===x-2){if(void 0!==(f=B?l.sweepBipartite(x,O,y,I,p,P,D,xx,H,S):l.sweepBipartite(x,O,D,xx,H,S,y,I,p,P)))return f}else k(E++,b+1,D,xx,y,I,B,-1/0,1/0),k(E++,b+1,y,I,D,xx,1^B,-1/0,1/0);if(xx<W){var Ox=C(x,b,y,I,p,P),Qx=p[z*Ox+b],Xx=K(x,b,Ox,I,p,P,Qx);if(Xx<I&&k(E++,b,xx,W,Xx,I,(4|B)+(i?16:0),Qx,e),y<Ox&&k(E++,b,xx,W,y,Ox,(2|B)+(i?16:0),T,Qx),Ox+1===Xx){if(void 0!==(f=i?t(x,b,O,xx,W,H,S,Ox,p,P[Ox]):J(x,b,O,B,xx,W,H,S,Ox,p,P[Ox])))return f}else if(Ox<Xx){var Zx;if(i){if(xx<(Zx=g(x,b,xx,W,H,S,Qx))){var nx=K(x,b,xx,Zx,H,S,Qx);if(b===x-2){if(xx<nx&&void 0!==(f=l.sweepComplete(x,O,xx,nx,H,S,Ox,Xx,p,P)))return f;if(nx<Zx&&void 0!==(f=l.sweepBipartite(x,O,nx,Zx,H,S,Ox,Xx,p,P)))return f}else xx<nx&&k(E++,b+1,xx,nx,Ox,Xx,16,-1/0,1/0),nx<Zx&&(k(E++,b+1,nx,Zx,Ox,Xx,0,-1/0,1/0),k(E++,b+1,Ox,Xx,nx,Zx,1,-1/0,1/0))}}else xx<(Zx=B?v(x,b,xx,W,H,S,Qx):g(x,b,xx,W,H,S,Qx))&&(b===x-2?f=B?l.sweepBipartite(x,O,Ox,Xx,p,P,xx,Zx,H,S):l.sweepBipartite(x,O,xx,Zx,H,S,Ox,Xx,p,P):(k(E++,b+1,xx,Zx,Ox,Xx,B,-1/0,1/0),k(E++,b+1,Ox,Xx,xx,Zx,1^B,-1/0,1/0)))}}}}};var X=Q(12973),Z=Q(12982),n=Q(13023),V=n.partial,o=n.full,l=Q(12999),C=Q(13032),U=Q(13037),L=128,h=1<<22,N=1<<22,a=U("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),K=U("lo===p0",["p0"]),M=U("lo<p0",["p0"]),Y=U("hi<=p0",["p0"]),g=U("lo<=p0&&p0<=hi",["p0"]),v=U("lo<p0&&p0<=hi",["p0"]),R=6,s=2,q=X.mallocInt32(1024),G=X.mallocDouble(1024);function k(x,O,Q,X,Z,n,V,o,l){var C=R*x;q[C]=O,q[C+1]=Q,q[C+2]=X,q[C+3]=Z,q[C+4]=n,q[C+5]=V;var U=s*x;G[U]=o,G[U+1]=l}function J(x,O,Q,X,Z,n,V,o,l,C,U){var L=2*x,h=l*L,N=C[h+O];x:for(var a=Z,K=Z*L;a<n;++a,K+=L){var M=V[K+O],Y=V[K+O+x];if(!(N<M||Y<N)&&(!X||N!==M)){for(var g,v=o[a],R=O+1;R<x;++R){M=V[K+R],Y=V[K+R+x];var s=C[h+R],q=C[h+R+x];if(Y<s||q<M)continue x}if(void 0!==(g=X?Q(U,v):Q(v,U)))return g}}}function t(x,O,Q,X,Z,n,V,o,l,C){var U=2*x,L=o*U,h=l[L+O];x:for(var N=X,a=X*U;N<Z;++N,a+=U){var K=V[N];if(K!==C){var M=n[a+O],Y=n[a+O+x];if(!(h<M||Y<h)){for(var g=O+1;g<x;++g){M=n[a+g],Y=n[a+g+x];var v=l[L+g],R=l[L+g+x];if(Y<v||R<M)continue x}var s=Q(K,C);if(void 0!==s)return s}}}}},13032:(x,O,Q)=>{"use strict";x.exports=function(x,O,Q,V,o,l){if(V<=Q+1)return Q;var C=Q,U=V,L=V+Q>>>1,h=2*x,N=L,a=o[h*L+O];for(;C<U;){if(U-C<Z){n(x,O,C,U,o,l),a=o[h*L+O];break}var K=U-C,M=Math.random()*K+C|0,Y=o[h*M+O],g=Math.random()*K+C|0,v=o[h*g+O],R=Math.random()*K+C|0,s=o[h*R+O];Y<=v?s>=v?(N=g,a=v):Y>=s?(N=M,a=Y):(N=R,a=s):v>=s?(N=g,a=v):s>=Y?(N=M,a=Y):(N=R,a=s);for(var q=h*(U-1),G=h*N,k=0;k<h;++k,++q,++G){var J=o[q];o[q]=o[G],o[G]=J}var t=l[U-1];l[U-1]=l[N],l[N]=t;for(q=h*(U-1),G=h*(N=X(x,O,C,U-1,o,l,a)),k=0;k<h;++k,++q,++G){J=o[q];o[q]=o[G],o[G]=J}t=l[U-1];if(l[U-1]=l[N],l[N]=t,L<N){for(U=N-1;C<U&&o[h*(U-1)+O]===a;)U-=1;U+=1}else{if(!(N<L))break;for(C=N+1;C<U&&o[h*C+O]===a;)C+=1}}return X(x,O,Q,L,o,l,o[h*L+O])};var X=Q(13037)("lo<p0",["p0"]),Z=8;function n(x,O,Q,X,Z,n){for(var V=2*x,o=V*(Q+1)+O,l=Q+1;l<X;++l,o+=V)for(var C=Z[o],U=l,L=V*(l-1);U>Q&&Z[L+O]>C;--U,L-=V){for(var h=L,N=L+V,a=0;a<V;++a,++h,++N){var K=Z[h];Z[h]=Z[N],Z[N]=K}var M=n[U];n[U]=n[U-1],n[U-1]=M}}},13037:x=>{"use strict";x.exports=function(x,Q){var X="abcdef".split("").concat(Q),Z=[];x.indexOf("lo")>=0&&Z.push("lo=e[k+n]");x.indexOf("hi")>=0&&Z.push("hi=e[k+o]");return X.push(O.replace("_",Z.join()).replace("$",x)),Function.apply(void 0,X)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13005:x=>{"use strict";x.exports=function(x,X){X<=4*O?Q(0,X-1,x):C(0,X-1,x)};var O=32;function Q(x,O,Q){for(var X=2*(x+1),Z=x+1;Z<=O;++Z){for(var n=Q[X++],V=Q[X++],o=Z,l=X-2;o-- >x;){var C=Q[l-2],U=Q[l-1];if(C<n)break;if(C===n&&U<V)break;Q[l]=C,Q[l+1]=U,l-=2}Q[l]=n,Q[l+1]=V}}function X(x,O,Q){O*=2;var X=Q[x*=2],Z=Q[x+1];Q[x]=Q[O],Q[x+1]=Q[O+1],Q[O]=X,Q[O+1]=Z}function Z(x,O,Q){O*=2,Q[x*=2]=Q[O],Q[x+1]=Q[O+1]}function n(x,O,Q,X){O*=2,Q*=2;var Z=X[x*=2],n=X[x+1];X[x]=X[O],X[x+1]=X[O+1],X[O]=X[Q],X[O+1]=X[Q+1],X[Q]=Z,X[Q+1]=n}function V(x,O,Q,X,Z){O*=2,Z[x*=2]=Z[O],Z[O]=Q,Z[x+1]=Z[O+1],Z[O+1]=X}function o(x,O,Q){O*=2;var X=Q[x*=2],Z=Q[O];return!(X<Z)&&(X!==Z||Q[x+1]>Q[O+1])}function l(x,O,Q,X){var Z=X[x*=2];return Z<O||Z===O&&X[x+1]<Q}function C(x,U,L){var h=(U-x+1)/6|0,N=x+h,a=U-h,K=x+U>>1,M=K-h,Y=K+h,g=N,v=M,R=K,s=Y,q=a,G=x+1,k=U-1,J=0;o(g,v,L)&&(J=g,g=v,v=J),o(s,q,L)&&(J=s,s=q,q=J),o(g,R,L)&&(J=g,g=R,R=J),o(v,R,L)&&(J=v,v=R,R=J),o(g,s,L)&&(J=g,g=s,s=J),o(R,s,L)&&(J=R,R=s,s=J),o(v,q,L)&&(J=v,v=q,q=J),o(v,R,L)&&(J=v,v=R,R=J),o(s,q,L)&&(J=s,s=q,q=J);for(var t=L[2*v],c=L[2*v+1],d=L[2*s],u=L[2*s+1],A=2*g,f=2*R,E=2*q,z=2*N,F=2*K,b=2*a,D=0;D<2;++D){var W=L[A+D],y=L[f+D],I=L[E+D];L[z+D]=W,L[F+D]=y,L[b+D]=I}Z(M,x,L),Z(Y,U,L);for(var r=G;r<=k;++r)if(l(r,t,c,L))r!==G&&X(r,G,L),++G;else if(!l(r,d,u,L))for(;;){if(l(k,d,u,L)){l(k,t,c,L)?(n(r,G,k,L),++G,--k):(X(r,k,L),--k);break}if(--k<r)break}V(x,G-1,t,c,L),V(U,k+1,d,u,L),G-2-x<=O?Q(x,G-2,L):C(x,G-2,L),U-(k+2)<=O?Q(k+2,U,L):C(k+2,U,L),k-G<=O?Q(G,k,L):C(G,k,L)}},12999:(x,O,Q)=>{"use strict";x.exports={init:function(x){var O=Z.nextPow2(x);l.length<O&&(X.free(l),l=X.mallocInt32(O));C.length<O&&(X.free(C),C=X.mallocInt32(O));U.length<O&&(X.free(U),U=X.mallocInt32(O));L.length<O&&(X.free(L),L=X.mallocInt32(O));h.length<O&&(X.free(h),h=X.mallocInt32(O));N.length<O&&(X.free(N),N=X.mallocInt32(O));var Q=8*O;a.length<Q&&(X.free(a),a=X.mallocDouble(Q))},sweepBipartite:function(x,O,Q,X,Z,o,h,N,Y,g){for(var v=0,R=2*x,s=x-1,q=R-1,G=Q;G<X;++G){var k=o[G],J=R*G;a[v++]=Z[J+s],a[v++]=-(k+1),a[v++]=Z[J+q],a[v++]=k}for(G=h;G<N;++G){k=g[G]+V;var t=R*G;a[v++]=Y[t+s],a[v++]=-k,a[v++]=Y[t+q],a[v++]=k}var c=v>>>1;n(a,c);var d=0,u=0;for(G=0;G<c;++G){var A=0|a[2*G+1];if(A>=V)K(U,L,u--,A=A-V|0);else if(A>=0)K(l,C,d--,A);else if(A<=-V){A=-A-V|0;for(var f=0;f<d;++f){if(void 0!==(E=O(l[f],A)))return E}M(U,L,u++,A)}else{A=-A-1|0;for(f=0;f<u;++f){var E;if(void 0!==(E=O(A,U[f])))return E}M(l,C,d++,A)}}},sweepComplete:function(x,O,Q,X,Z,V,o,Y,g,v){for(var R=0,s=2*x,q=x-1,G=s-1,k=Q;k<X;++k){var J=V[k]+1<<1,t=s*k;a[R++]=Z[t+q],a[R++]=-J,a[R++]=Z[t+G],a[R++]=J}for(k=o;k<Y;++k){J=v[k]+1<<1;var c=s*k;a[R++]=g[c+q],a[R++]=1|-J,a[R++]=g[c+G],a[R++]=1|J}var d=R>>>1;n(a,d);var u=0,A=0,f=0;for(k=0;k<d;++k){var E=0|a[2*k+1],z=1&E;if(k<d-1&&E>>1===a[2*k+3]>>1&&(z=2,k+=1),E<0){for(var F=-(E>>1)-1,b=0;b<f;++b){if(void 0!==(D=O(h[b],F)))return D}if(0!==z)for(b=0;b<u;++b){if(void 0!==(D=O(l[b],F)))return D}if(1!==z)for(b=0;b<A;++b){var D;if(void 0!==(D=O(U[b],F)))return D}0===z?M(l,C,u++,F):1===z?M(U,L,A++,F):2===z&&M(h,N,f++,F)}else{F=(E>>1)-1;0===z?K(l,C,u--,F):1===z?K(U,L,A--,F):2===z&&K(h,N,f--,F)}}},scanBipartite:function(x,O,Q,X,Z,o,U,L,h,N,Y,g){var v=0,R=2*x,s=O,q=O+x,G=1,k=1;X?k=V:G=V;for(var J=Z;J<o;++J){var t=J+G,c=R*J;a[v++]=U[c+s],a[v++]=-t,a[v++]=U[c+q],a[v++]=t}for(J=h;J<N;++J){t=J+k;var d=R*J;a[v++]=Y[d+s],a[v++]=-t}var u=v>>>1;n(a,u);var A=0;for(J=0;J<u;++J){var f=0|a[2*J+1];if(f<0){var E=!1;if((t=-f)>=V?(E=!X,t-=V):(E=!!X,t-=1),E)M(l,C,A++,t);else{var z=g[t],F=R*t,b=Y[F+O+1],D=Y[F+O+1+x];x:for(var W=0;W<A;++W){var y=l[W],I=R*y;if(!(D<U[I+O+1]||U[I+O+1+x]<b)){for(var r=O+2;r<x;++r)if(Y[F+r+x]<U[I+r]||U[I+r+x]<Y[F+r])continue x;var j,T=L[y];if(void 0!==(j=X?Q(z,T):Q(T,z)))return j}}}}else K(l,C,A--,f-G)}},scanComplete:function(x,O,Q,X,Z,o,C,U,L,h,N){for(var K=0,M=2*x,Y=O,g=O+x,v=X;v<Z;++v){var R=v+V,s=M*v;a[K++]=o[s+Y],a[K++]=-R,a[K++]=o[s+g],a[K++]=R}for(v=U;v<L;++v){R=v+1;var q=M*v;a[K++]=h[q+Y],a[K++]=-R}var G=K>>>1;n(a,G);var k=0;for(v=0;v<G;++v){var J=0|a[2*v+1];if(J<0){if((R=-J)>=V)l[k++]=R-V;else{var t=N[R-=1],c=M*R,d=h[c+O+1],u=h[c+O+1+x];x:for(var A=0;A<k;++A){var f=l[A],E=C[f];if(E===t)break;var z=M*f;if(!(u<o[z+O+1]||o[z+O+1+x]<d)){for(var F=O+2;F<x;++F)if(h[c+F+x]<o[z+F]||o[z+F+x]<h[c+F])continue x;var b=Q(E,t);if(void 0!==b)return b}}}}else{for(R=J-V,A=k-1;A>=0;--A)if(l[A]===R){for(F=A+1;F<k;++F)l[F-1]=l[F];break}--k}}}};var X=Q(12973),Z=Q(12982),n=Q(13005),V=1<<28,o=1024,l=X.mallocInt32(o),C=X.mallocInt32(o),U=X.mallocInt32(o),L=X.mallocInt32(o),h=X.mallocInt32(o),N=X.mallocInt32(o),a=X.mallocDouble(8192);function K(x,O,Q,X){var Z=O[X],n=x[Q-1];x[Z]=n,O[n]=Z}function M(x,O,Q,X){x[Q]=X,O[X]=Q}},12989:x=>{"use strict";function O(x,Q,X){var Z=0|x[X];if(Z<=0)return[];var n,V=new Array(Z);if(X===x.length-1)for(n=0;n<Z;++n)V[n]=Q;else for(n=0;n<Z;++n)V[n]=O(x,Q,X+1);return V}x.exports=function(x,Q){switch("undefined"===typeof Q&&(Q=0),typeof x){case"number":if(x>0)return function(x,O){var Q,X;for(Q=new Array(x),X=0;X<x;++X)Q[X]=O;return Q}(0|x,Q);break;case"object":if("number"===typeof x.length)return O(x,Q,0)}return[]}},12938:(x,O,Q)=>{x.exports=function(){var x=this;this.components={},this.comps=this.components;var O=this.components,Q=1,Z={},n=[],V=[],o={timeout:!1,removals:[],multiComps:[]};function l(x,Q){var X=O[Q],n=Z[Q],V=n.hash[x];V&&(n.remove(x),X.IX&&(X.multi?(V.forEach((O=>{O&&X.IX(x,O)})),V.length=0):X.IX(x,V)),o.removals.push(n),C())}function C(){o.timeout||(o.timeout=!0,setTimeout(U,1))}function U(){o.timeout=!1,L()}function L(){o.multiComps.length&&function(x){for(var O=0;O<x.length;O++){var{entID:Q,data:X}=x[O],Z=X.hash[Q];if(Z){for(var n=0;n<Z.length;n++)Z[n]||(Z.splice(n,1),n--);0===Z.length&&(X.remove(Q),o.removals.push(X))}}x.length=0}(o.multiComps),o.removals.length&&function(x){for(var O=0;O<x.length;O++){x[O].flush()}x.length=0}(o.removals)}this.BU=Z,this._systems=n,this._renderSystems=V,this.zC=function(O){var X=Q++;return Array.isArray(O)&&O.forEach((O=>x.Rl(X,O))),X},this.deleteEntity=function(O){return Object.keys(Z).forEach((x=>{Z[x].hash[O]&&l(O,x)})),x},this.PC=function(x){if(!x)throw new Error("Missing component definition");var Q=x.name;if(!Q)throw new Error("Component definition must have a name property.");if("string"!==typeof Q)throw new Error("Component name must be a string.");if(""===Q)throw new Error("Component name must be a non-empty string.");if(Z[Q])throw new Error(`Component ${Q} already exists.`);var o={};return o.name=Q,o.multi=!!x.multi,o.order=isNaN(x.order)?99:x.order,o.stateConstructor=x.stateConstructor||null,o.state=x.state||{},o.Go=x.Go||null,o.IX=x.IX||null,o.system=x.system||null,o.Eo=x.Eo||null,O[Q]=o,Z[Q]=new X,Z[Q]._pendingMultiCleanup=!1,Z[Q]._multiCleanupIDs=o.multi?[]:null,o.system&&(n.push(Q),n.sort(((x,Q)=>O[x].order-O[Q].order))),o.Eo&&(V.push(Q),V.sort(((x,Q)=>O[x].order-O[Q].order))),Q},this.overwriteComponent=function(x,Q){var X=O[x];if(!X)throw new Error(`Unknown component: ${x}`);if(!Q)throw new Error("Missing component definition");if(X.name!==Q.name)throw new Error("Overwriting component must use the same name property.");var o={};o.name=x,o.multi=!!Q.multi,o.order=isNaN(Q.order)?99:Q.order,o.state=Q.state||{},o.Go=Q.Go||null,o.IX=Q.IX||null,o.system=Q.system||null,o.Eo=Q.Eo||null,O[x]=o,Z[x]._pendingMultiCleanup=!1,Z[x]._multiCleanupIDs=o.multi?[]:null;var l=n.indexOf(x);o.system&&l<0&&n.push(x),!o.system&&l>=0&&n.splice(l,1),n.sort(((x,Q)=>O[x].order-O[Q].order));var C=V.indexOf(x);o.Eo&&C<0&&V.push(x),!o.Eo&&C>=0&&V.splice(C,1),V.sort(((x,Q)=>O[x].order-O[Q].order));var U=o.state;return this.YC(x).forEach((x=>{for(var O in U)O in x||(x[O]=U[O]);o.Go&&o.Go(x.Ao,x)})),x},this.deleteComponent=function(Q){var X=Z[Q];if(!X)throw new Error(`Unknown component: ${Q}`);X.flush(),X.list.forEach((x=>{x&&l(x.Ao||x[0].Ao,Q)}));var o=n.indexOf(Q),C=V.indexOf(Q);return o>-1&&n.splice(o,1),C>-1&&V.splice(C,1),Z[Q].dispose(),delete Z[Q],delete O[Q],x},this.Rl=function(x,Q,X){var n,V=O[Q],o=Z[Q];if(!o)throw new Error(`Unknown component: ${Q}.`);if(o.hash[x]&&!V.multi)throw new Error(`Entity ${x} already has component: ${Q}.`);if(V.stateConstructor){if(!(n=new V.stateConstructor).hasOwnProperty("Ao"))throw new Error(`Component ${V.name} stateConstructor type does not have property __id`)}else n=Object.assign({},{Ao:x},V.state,X);if(n.Ao=x,V.multi){var l=o.hash[x];l||(l=[],o.add(x,l)),l.push(n)}else o.add(x,n);return V.Go&&V.Go(x,n),this},this.Al=function(x,O){var Q=Z[O];if(!Q)throw new Error(`Unknown component: ${O}.`);return!!Q.hash[x]},this.kl=function(O,Q){if(!Z[Q])throw new Error(`Unknown component: ${Q}.`);return l(O,Q),x},this.getState=function(x,O){var Q=Z[O];if(!Q)throw new Error(`Unknown component: ${O}.`);return Q.hash[x]},this.YC=function(x){var O=Z[x];if(!O)throw new Error(`Unknown component: ${x}.`);return L(),O.list},this.Hh=function(x){if(!Z[x])throw new Error(`Unknown component: ${x}.`);var O=Z[x].hash;return x=>O[x]},this.xN=function(x){if(!Z[x])throw new Error(`Unknown component: ${x}.`);var O=Z[x].hash;return x=>!!O[x]},this.iV=function(Q){L();for(var X=0;X<n.length;X++){var V=n[X],o=O[V],l=Z[V];o.system(Q,l.list),L()}return x},this.render=function(Q){L();for(var X=0;X<V.length;X++){var n=V[X],o=O[n],l=Z[n];o.Eo(Q,l.list),L()}return x},this.removeMultiComponent=function(Q,X,n){var V=O[X],l=Z[X];if(!l)throw new Error(`Unknown component: ${X}.`);if(!V.multi)throw new Error("removeMultiComponent called on non-multi component");return function(x,O,Q,X){var Z=Q.hash[x];if(Z){var n=Z[X];n&&(Z[X]=null,O.IX&&O.IX(x,n),o.multiComps.push({entID:x,data:Q}),C())}}(Q,V,l,n),x}};var X=Q(12941)},12941:x=>{function O(x,O){var Q=x._map[O];if(delete x.hash[O],delete x._map[O],Q===x.list.length-1)x.list.pop();else{var X=x.list.pop();if(x.list[Q]=X,null===X||null===X[0]){var Z=x.list.length;for(var n in x._map)if(x._map[n]===Z)return void(x._map[n]=Q)}else{var V=X.Ao||X[0].Ao;x._map[V]=Q}}}x.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(x,O){if("number"===typeof this._map[x]){var Q=this._map[x];this.hash[x]=O,this.list[Q]=O}else this._map[x]=this.list.length,this.hash[x]=O,this.list.push(O)}remove(x){var O=this._map[x];this.hash[x]=null,this.list[O]=null,this._pendingRemovals.push(x)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var x=0;x<this._pendingRemovals.length;x++){var Q=this._pendingRemovals[x];null===this.hash[Q]&&O(this,Q)}this._pendingRemovals.length=0}}},12896:x=>{"use strict";var O,Q="object"===typeof Reflect?Reflect:null,X=function(x,O,Q){return Function.prototype.apply.call(x,O,Q)};O=Q&&"function"===typeof Q.ownKeys?Q.ownKeys:Object.getOwnPropertySymbols?function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:function(x){return Object.getOwnPropertyNames(x)};var Z=Number.isNaN||function(x){return x!==x};function n(){n.init.call(this)}x.exports=n,x.exports.once=function(x,O){return new Promise((function(Q,X){function Z(Q){x.removeListener(O,n),X(Q)}function n(){"function"===typeof x.removeListener&&x.removeListener("error",Z),Q([].slice.call(arguments))}K(x,O,n,{once:!0}),"error"!==O&&function(x,O,Q){"function"===typeof x.on&&K(x,"error",O,Q)}(x,Z,{once:!0})}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var V=10;function o(x){if("function"!==typeof x)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function l(x){return void 0===x._maxListeners?n.defaultMaxListeners:x._maxListeners}function C(x,O,Q,X){var Z,n,V,C;if(o(Q),void 0===(n=x._events)?(n=x._events=Object.create(null),x._eventsCount=0):(void 0!==n.newListener&&(x.emit("newListener",O,Q.listener?Q.listener:Q),n=x._events),V=n[O]),void 0===V)V=n[O]=Q,++x._eventsCount;else if("function"===typeof V?V=n[O]=X?[Q,V]:[V,Q]:X?V.unshift(Q):V.push(Q),(Z=l(x))>0&&V.length>Z&&!V.warned){V.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+V.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.i=x,U.type=O,U.count=V.length,C=U,console&&console.warn&&console.warn(C)}return x}function U(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function L(x,O,Q){var X={fired:!1,wrapFn:void 0,target:x,type:O,listener:Q},Z=U.bind(X);return Z.listener=Q,X.wrapFn=Z,Z}function h(x,O,Q){var X=x._events;if(void 0===X)return[];var Z=X[O];return void 0===Z?[]:"function"===typeof Z?Q?[Z.listener||Z]:[Z]:Q?function(x){for(var O=new Array(x.length),Q=0;Q<O.length;++Q)O[Q]=x[Q].listener||x[Q];return O}(Z):a(Z,Z.length)}function N(x){var O=this._events;if(void 0!==O){var Q=O[x];if("function"===typeof Q)return 1;if(void 0!==Q)return Q.length}return 0}function a(x,O){for(var Q=new Array(O),X=0;X<O;++X)Q[X]=x[X];return Q}function K(x,O,Q,X){if("function"===typeof x.on)X.once?x.once(O,Q):x.on(O,Q);else{if("function"!==typeof x.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(O,(function Z(n){X.once&&x.removeEventListener(O,Z),Q(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return V},set:function(x){if("number"!==typeof x||x<0||Z(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");V=x}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(x){if("number"!==typeof x||x<0||Z(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(x){for(var O=[],Q=1;Q<arguments.length;Q++)O.push(arguments[Q]);var Z="error"===x,n=this._events;if(void 0!==n)Z=Z&&void 0===n.error;else if(!Z)return!1;if(Z){var V;if(O.length>0&&(V=O[0]),V instanceof Error)throw V;var o=new Error("Unhandled error."+(V?" ("+V.message+")":""));throw o.context=V,o}var l=n[x];if(void 0===l)return!1;if("function"===typeof l)X(l,this,O);else{var C=l.length,U=a(l,C);for(Q=0;Q<C;++Q)X(U[Q],this,O)}return!0},n.prototype.addListener=function(x,O){return C(this,x,O,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(x,O){return C(this,x,O,!0)},n.prototype.once=function(x,O){return o(O),this.on(x,L(this,x,O)),this},n.prototype.prependOnceListener=function(x,O){return o(O),this.prependListener(x,L(this,x,O)),this},n.prototype.removeListener=function(x,O){var Q,X,Z,n,V;if(o(O),void 0===(X=this._events))return this;if(void 0===(Q=X[x]))return this;if(Q===O||Q.listener===O)0===--this._eventsCount?this._events=Object.create(null):(delete X[x],X.removeListener&&this.emit("removeListener",x,Q.listener||O));else if("function"!==typeof Q){for(Z=-1,n=Q.length-1;n>=0;n--)if(Q[n]===O||Q[n].listener===O){V=Q[n].listener,Z=n;break}if(Z<0)return this;0===Z?Q.shift():function(x,O){for(;O+1<x.length;O++)x[O]=x[O+1];x.pop()}(Q,Z),1===Q.length&&(X[x]=Q[0]),void 0!==X.removeListener&&this.emit("removeListener",x,V||O)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(x){var O,Q,X;if(void 0===(Q=this._events))return this;if(void 0===Q.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Q[x]&&(0===--this._eventsCount?this._events=Object.create(null):delete Q[x]),this;if(0===arguments.length){var Z,n=Object.keys(Q);for(X=0;X<n.length;++X)"removeListener"!==(Z=n[X])&&this.removeAllListeners(Z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(O=Q[x]))this.removeListener(x,O);else if(void 0!==O)for(X=O.length-1;X>=0;X--)this.removeListener(x,O[X]);return this},n.prototype.listeners=function(x){return h(this,x,!0)},n.prototype.rawListeners=function(x){return h(this,x,!1)},n.listenerCount=function(x,O){return"function"===typeof x.listenerCount?x.listenerCount(O):N.call(x,O)},n.prototype.listenerCount=N,n.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},13213:x=>{"use strict";x.exports=function(x,O,Q,X,Z,n){var V=+O[0],o=+O[1],l=+O[2],C=+Q[0],U=+Q[1],L=+Q[2],h=Math.sqrt(C*C+U*U+L*L);if(0===h)throw new Error("Can't raycast along a zero vector");return function(x,O,Q,X,Z,n,V,o,l,C){for(var U=0,L=Math.floor,h=0|L(O),N=0|L(Q),a=0|L(X),K=Z>0?1:-1,M=n>0?1:-1,Y=V>0?1:-1,g=Math.abs(1/Z),v=Math.abs(1/n),R=Math.abs(1/V),s=g<1/0?g*(K>0?h+1-O:O-h):1/0,q=v<1/0?v*(M>0?N+1-Q:Q-N):1/0,G=R<1/0?R*(Y>0?a+1-X:X-a):1/0,k=-1;U<=o;){var J=x(h,N,a);if(J)return l&&(l[0]=O+U*Z,l[1]=Q+U*n,l[2]=X+U*V),C&&(C[0]=C[1]=C[2]=0,0===k&&(C[0]=-K),1===k&&(C[1]=-M),2===k&&(C[2]=-Y)),J;s<q?s<G?(h+=K,U=s,s+=g,k=0):(a+=Y,U=G,G+=R,k=2):q<G?(N+=M,U=q,q+=v,k=1):(a+=Y,U=G,G+=R,k=2)}return l&&(l[0]=O+U*Z,l[1]=Q+U*n,l[2]=X+U*V),C&&(C[0]=C[1]=C[2]=0),0}(x,V,o,l,C/=h,U/=h,L/=h,X="undefined"===typeof X?64:+X,Z,n)}},13255:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>n});var X=Q(12896);function Z(){this.DL=!1,this.stopPropagation=!1,this.WL=!1,this.disabled=!1}class n{constructor(x,O){this.version="0.7.0";var Q=Object.assign({},new Z,O||{});this.element=x||document,this.DL=!!Q.DL,this.stopPropagation=!!Q.stopPropagation,this.WL=!!Q.WL,this.disabled=!!Q.disabled,this.filterEvents=(x,O)=>!0,this.down=new X.EventEmitter,this.up=new X.EventEmitter,this.state={},this.LC={dx:0,dy:0,Dh:0,UC:0,Wh:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?o(this):document.addEventListener("DOMContentLoaded",(x=>{o(this)}),{once:!0})}bind(x){for(var O=arguments.length,Q=new Array(O>1?O-1:0),X=1;X<O;X++)Q[X-1]=arguments[X];Q.forEach((O=>{var Q=this._keyBindmap[O]||[];Q.includes(x)||(Q.push(x),this._keyBindmap[O]=Q)})),this.state[x]=!!this.state[x],this.pressCount[x]=this.pressCount[x]||0,this.releaseCount[x]=this.releaseCount[x]||0}unbind(x){for(var O in this._keyBindmap){var Q=this._keyBindmap[O],X=Q.indexOf(x);X>-1&&Q.splice(X,1)}}getBindings(){var x={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((Q=>{x[Q]=x[Q]||[],x[Q].push(O)}))}return x}iV(){V(this.LC),V(this.pressCount),V(this.releaseCount)}}function V(x){for(var O in x)x[O]=0}function o(x){window.addEventListener("keydown",a.bind(null,x,!0),!1),window.addEventListener("keyup",a.bind(null,x,!1),!1);var O={passive:!0};x.element.addEventListener("touchstart",L.bind(void 0,x),{passive:!1}),x.element.addEventListener("touchend",N.bind(void 0,x),O),x.element.addEventListener("mousedown",K.bind(null,x,!0),O),window.document.addEventListener("mouseup",K.bind(null,x,!1),O),x.element.addEventListener("touchmove",M.bind(null,x),O),x.element.addEventListener("mousemove",M.bind(null,x),O),window.PointerEvent,x.element.addEventListener("wheel",Y.bind(null,x),O),x.element.addEventListener("contextmenu",g.bind(null,x),!1),window.addEventListener("blur",v.bind(null,x),!1)}var l=0,C=0,U=null;function L(x,O){O.preventDefault(),h(O)}function h(x){let O=!1;for(let Q=0;Q<x.touches.length;++Q)if(x.touches[Q].identifier===U){O=!0;break}if(!O){const O=x.changedTouches[0];l=O.clientX,C=O.clientY,U=O.identifier}}function N(x,O){for(var Q=O.changedTouches,X=0;X<Q.length;++X)Q[X].identifier===U&&(U=null)}function a(x,O,Q){R(Q.code,O,x,Q)}function K(x,O,Q){if("pointerId"in Q)if(O){if(null!==x._touches.currID)return;x._touches.currID=Q.pointerId}else{if(x._touches.currID!==Q.pointerId)return;x._touches.currID=null}return R("Mouse"+("button"in Q?Q.button+1:1),O,x,Q),!1}function M(x,O){var Q=O.movementX||O.mozMovementX||0,X=O.movementY||O.mozMovementY||0;if(O.touches&&0===(Q|X)){var Z=function(x){h(x);for(let O=0;O<x.changedTouches.length;++O)if(x.changedTouches[O].identifier==U){const Q=x.changedTouches[O],X=[Q.clientX-l,Q.clientY-C];return l=Q.clientX,C=Q.clientY,X}return console.error(`Did not find touch id ${U}`),[0,0]}(O);Q=Z[0],X=Z[1]}x.LC.dx+=Q,x.LC.dy+=X}function Y(x,O){var Q=1;switch(O.deltaMode){case 0:Q=1;break;case 1:Q=12;break;case 2:Q=x.element.clientHeight||window.innerHeight}x.LC.Dh+=(O.deltaX||0)*Q,x.LC.UC+=(O.deltaY||0)*Q,x.LC.Wh+=(O.deltaZ||0)*Q}function g(x,O){if(!x.WL)return O.preventDefault(),!1}function v(x){for(var O in x._keyStates)x._keyStates[O]&&(/^Mouse\d/.test(O)||R(O,!1,x,{code:O,note:"inaxs2hbts",preventDefault:()=>{},stopPropagation:()=>{}}))}function R(x,O,Q,X){var Z=Q._keyBindmap[x];Z&&(s(Q._keyStates[x],O)&&(Q._keyStates[x]=O,Z.forEach((x=>{(!Q.filterEvents||Q.filterEvents(X,x))&&function(x,O,Q,X){var Z=O?Q.pressCount:Q.releaseCount;Z[x]=(Z[x]||0)+1;var n=Q._bindPressCount[x]||0;(n+=O?1:-1)<0&&(n=0);Q._bindPressCount[x]=n;var V=Q.state[x];if(s(V,n)){Q.state[x]=n>0;var o=O?Q.down:Q.up;Q.disabled||o.emit(x,X)}}(x,O,Q,X)}))),"button"in X||(Q.DL&&!X.defaultPrevented&&X.preventDefault(),Q.stopPropagation&&X.stopPropagation()))}function s(x,O){return x?!O:O}},11874:x=>{x.exports=function(x,O,Q){return x[0]=O[0]+Q[0],x[1]=O[1]+Q[1],x[2]=O[2]+Q[2],x}},11835:(x,O,Q)=>{x.exports=function(x,O){var Q=X(x[0],x[1],x[2]),V=X(O[0],O[1],O[2]);Z(Q,Q),Z(V,V);var o=n(Q,V);return o>1?0:Math.acos(o)};var X=Q(11843),Z=Q(11846),n=Q(11853)},11914:x=>{x.exports=function(x,O){return x[0]=Math.ceil(O[0]),x[1]=Math.ceil(O[1]),x[2]=Math.ceil(O[2]),x}},11827:x=>{x.exports=function(x){var O=new Float32Array(3);return O[0]=x[0],O[1]=x[1],O[2]=x[2],O}},11855:x=>{x.exports=function(x,O){return x[0]=O[0],x[1]=O[1],x[2]=O[2],x}},11818:x=>{x.exports=function(){var x=new Float32Array(3);return x[0]=0,x[1]=0,x[2]=0,x}},11984:x=>{x.exports=function(x,O,Q){var X=O[0],Z=O[1],n=O[2],V=Q[0],o=Q[1],l=Q[2];return x[0]=Z*l-n*o,x[1]=n*V-X*l,x[2]=X*o-Z*V,x}},11933:(x,O,Q)=>{x.exports=Q(11930)},11930:x=>{x.exports=function(x,O){var Q=O[0]-x[0],X=O[1]-x[1],Z=O[2]-x[2];return Math.sqrt(Q*Q+X*X+Z*Z)}},11900:(x,O,Q)=>{x.exports=Q(11898)},11898:x=>{x.exports=function(x,O,Q){return x[0]=O[0]/Q[0],x[1]=O[1]/Q[1],x[2]=O[2]/Q[2],x}},11853:x=>{x.exports=function(x,O){return x[0]*O[0]+x[1]*O[1]+x[2]*O[2]}},11816:x=>{x.exports=1e-6},11866:(x,O,Q)=>{x.exports=function(x,O){var Q=x[0],Z=x[1],n=x[2],V=O[0],o=O[1],l=O[2];return Math.abs(Q-V)<=X*Math.max(1,Math.abs(Q),Math.abs(V))&&Math.abs(Z-o)<=X*Math.max(1,Math.abs(Z),Math.abs(o))&&Math.abs(n-l)<=X*Math.max(1,Math.abs(n),Math.abs(l))};var X=Q(11816)},11872:x=>{x.exports=function(x,O){return x[0]===O[0]&&x[1]===O[1]&&x[2]===O[2]}},11911:x=>{x.exports=function(x,O){return x[0]=Math.floor(O[0]),x[1]=Math.floor(O[1]),x[2]=Math.floor(O[2]),x}},12028:(x,O,Q)=>{x.exports=function(x,O,Q,Z,n,V){var o,l;O||(O=3);Q||(Q=0);l=Z?Math.min(Z*O+Q,x.length):x.length;for(o=Q;o<l;o+=O)X[0]=x[o],X[1]=x[o+1],X[2]=x[o+2],n(X,X,V),x[o]=X[0],x[o+1]=X[1],x[o+2]=X[2];return x};var X=Q(11818)()},11843:x=>{x.exports=function(x,O,Q){var X=new Float32Array(3);return X[0]=x,X[1]=O,X[2]=Q,X}},11809:(x,O,Q)=>{x.exports={EPSILON:Q(11816),create:Q(11818),clone:Q(11827),angle:Q(11835),DV:Q(11843),j:Q(11855),set:Q(11864),equals:Q(11866),exactEquals:Q(11872),add:Q(11874),hQ:Q(11876),sub:Q(11880),multiply:Q(11885),mul:Q(11892),divide:Q(11898),div:Q(11900),min:Q(11903),max:Q(11908),floor:Q(11911),ceil:Q(11914),round:Q(11920),scale:Q(11922),WV:Q(11925),distance:Q(11930),k:Q(11933),squaredDistance:Q(11940),sqrDist:Q(11942),length:Q(11948),len:Q(11952),squaredLength:Q(11960),yV:Q(11969),negate:Q(11972),inverse:Q(11977),normalize:Q(11846),dot:Q(11853),cross:Q(11984),EV:Q(11988),random:Q(11995),transformMat4:Q(11998),transformMat3:Q(12006),transformQuat:Q(12009),rV:Q(12016),jV:Q(12018),TV:Q(12026),forEach:Q(12028)}},11977:x=>{x.exports=function(x,O){return x[0]=1/O[0],x[1]=1/O[1],x[2]=1/O[2],x}},11952:(x,O,Q)=>{x.exports=Q(11948)},11948:x=>{x.exports=function(x){var O=x[0],Q=x[1],X=x[2];return Math.sqrt(O*O+Q*Q+X*X)}},11988:x=>{x.exports=function(x,O,Q,X){var Z=O[0],n=O[1],V=O[2];return x[0]=Z+X*(Q[0]-Z),x[1]=n+X*(Q[1]-n),x[2]=V+X*(Q[2]-V),x}},11908:x=>{x.exports=function(x,O,Q){return x[0]=Math.max(O[0],Q[0]),x[1]=Math.max(O[1],Q[1]),x[2]=Math.max(O[2],Q[2]),x}},11903:x=>{x.exports=function(x,O,Q){return x[0]=Math.min(O[0],Q[0]),x[1]=Math.min(O[1],Q[1]),x[2]=Math.min(O[2],Q[2]),x}},11892:(x,O,Q)=>{x.exports=Q(11885)},11885:x=>{x.exports=function(x,O,Q){return x[0]=O[0]*Q[0],x[1]=O[1]*Q[1],x[2]=O[2]*Q[2],x}},11972:x=>{x.exports=function(x,O){return x[0]=-O[0],x[1]=-O[1],x[2]=-O[2],x}},11846:x=>{x.exports=function(x,O){var Q=O[0],X=O[1],Z=O[2],n=Q*Q+X*X+Z*Z;n>0&&(n=1/Math.sqrt(n),x[0]=O[0]*n,x[1]=O[1]*n,x[2]=O[2]*n);return x}},11995:x=>{x.exports=function(x,O){O=O||1;var Q=2*Math.random()*Math.PI,X=2*Math.random()-1,Z=Math.sqrt(1-X*X)*O;return x[0]=Math.cos(Q)*Z,x[1]=Math.sin(Q)*Z,x[2]=X*O,x}},12016:x=>{x.exports=function(x,O,Q,X){var Z=Q[1],n=Q[2],V=O[1]-Z,o=O[2]-n,l=Math.sin(X),C=Math.cos(X);return x[0]=O[0],x[1]=Z+V*C-o*l,x[2]=n+V*l+o*C,x}},12018:x=>{x.exports=function(x,O,Q,X){var Z=Q[0],n=Q[2],V=O[0]-Z,o=O[2]-n,l=Math.sin(X),C=Math.cos(X);return x[0]=Z+o*l+V*C,x[1]=O[1],x[2]=n+o*C-V*l,x}},12026:x=>{x.exports=function(x,O,Q,X){var Z=Q[0],n=Q[1],V=O[0]-Z,o=O[1]-n,l=Math.sin(X),C=Math.cos(X);return x[0]=Z+V*C-o*l,x[1]=n+V*l+o*C,x[2]=O[2],x}},11920:x=>{x.exports=function(x,O){return x[0]=Math.round(O[0]),x[1]=Math.round(O[1]),x[2]=Math.round(O[2]),x}},11922:x=>{x.exports=function(x,O,Q){return x[0]=O[0]*Q,x[1]=O[1]*Q,x[2]=O[2]*Q,x}},11925:x=>{x.exports=function(x,O,Q,X){return x[0]=O[0]+Q[0]*X,x[1]=O[1]+Q[1]*X,x[2]=O[2]+Q[2]*X,x}},11864:x=>{x.exports=function(x,O,Q,X){return x[0]=O,x[1]=Q,x[2]=X,x}},11942:(x,O,Q)=>{x.exports=Q(11940)},11969:(x,O,Q)=>{x.exports=Q(11960)},11940:x=>{x.exports=function(x,O){var Q=O[0]-x[0],X=O[1]-x[1],Z=O[2]-x[2];return Q*Q+X*X+Z*Z}},11960:x=>{x.exports=function(x){var O=x[0],Q=x[1],X=x[2];return O*O+Q*Q+X*X}},11880:(x,O,Q)=>{x.exports=Q(11876)},11876:x=>{x.exports=function(x,O,Q){return x[0]=O[0]-Q[0],x[1]=O[1]-Q[1],x[2]=O[2]-Q[2],x}},12006:x=>{x.exports=function(x,O,Q){var X=O[0],Z=O[1],n=O[2];return x[0]=X*Q[0]+Z*Q[3]+n*Q[6],x[1]=X*Q[1]+Z*Q[4]+n*Q[7],x[2]=X*Q[2]+Z*Q[5]+n*Q[8],x}},11998:x=>{x.exports=function(x,O,Q){var X=O[0],Z=O[1],n=O[2],V=Q[3]*X+Q[7]*Z+Q[11]*n+Q[15];return V=V||1,x[0]=(Q[0]*X+Q[4]*Z+Q[8]*n+Q[12])/V,x[1]=(Q[1]*X+Q[5]*Z+Q[9]*n+Q[13])/V,x[2]=(Q[2]*X+Q[6]*Z+Q[10]*n+Q[14])/V,x}},12009:x=>{x.exports=function(x,O,Q){var X=O[0],Z=O[1],n=O[2],V=Q[0],o=Q[1],l=Q[2],C=Q[3],U=C*X+o*n-l*Z,L=C*Z+l*X-V*n,h=C*n+V*Z-o*X,N=-V*X-o*Z-l*n;return x[0]=U*C+N*-V+L*-l-h*-o,x[1]=L*C+N*-o+h*-V-U*-l,x[2]=h*C+N*-l+U*-o-L*-V,x}},12920:x=>{"use strict";x.exports=function(x){for(var O=new Array(x),Q=0;Q<x;++Q)O[Q]=Q;return O}},12991:x=>{x.exports=function(x){return null!=x&&null!=x.constructor&&"function"===typeof x.constructor.isBuffer&&x.constructor.isBuffer(x)}},13221:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>X});class X{constructor(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.YU=!1,this.gU=!1,this.KU=30,this.MU=0,this.tU=!1,this.fullscreen=!1,this.RU=function(x){},this.sU=function(){},this.kU=function(){},this.ln=function(){},this.qU=function(x){},this.onFullscreenChanged=function(x){},C((()=>{!function(x,O){x._nowObject=performance||Date,x._lastTick=0,x._renderAccum=0,x._rt=0,x._frameCB=o.bind(null,x),requestAnimationFrame(x._frameCB),O>0&&(x._intervalCB=V.bind(null,x),x._interval=setInterval(x._intervalCB,Math.max(O,1e3/x.KU/2)))}(this,O),function(x,O){if(!O)return;var Q=!1,X=!1;document.addEventListener("pointerlockchange",(X=>{Q=document.pointerLockElement===O,x.qU(Q)})),document.addEventListener("fullscreenchange",(Q=>{X=document.fullscreenElement===O,x.onFullscreenChanged(X)})),Object.defineProperty(x,"tU",{get:()=>Q,set:x=>{x&&!Q?l(O):Q&&!x&&function(x){x.exitPointerLock&&x.exitPointerLock()}(document)}}),Object.defineProperty(x,"fullscreen",{get:()=>X,set:x=>{x&&!X?O.requestFullscreen():X&&!x&&document.exitFullscreen()}}),O.addEventListener("click",(Z=>{x.YU&&!Q&&l(O),x.gU&&!X&&O.requestFullscreen()}));var Z=()=>x.ln();if(window.ResizeObserver){new ResizeObserver(Z).observe(O)}else window.addEventListener("resize",Z)}(this,x),this.kU()}))}}var Z=3,n=20;function V(x){for(var O=1e3/x.KU,Q=x._nowObject.now()+n,X=0;x._nowObject.now()>=x._lastTick+O&&x._nowObject.now()<Q&&++X<=Z;)x.RU(O),x._lastTick+=O;var V=5*(O+5),o=x._nowObject.now();if(o-x._lastTick>V)for(;o>=x._lastTick+O;)x._lastTick+=O}function o(x){requestAnimationFrame(x._frameCB),V(x);var O=x._nowObject.now(),Q=O-x._rt;if(x._rt=O,x.MU>0){x._renderAccum+=Q;var X=1e3/x.MU;if(x._renderAccum<X)return;x._renderAccum=Math.min(x._renderAccum-X,X)}var Z=1e3/x.KU,n=(O-x._lastTick)/Z;x.sU(Q,n,Z)}function l(x){x.requestPointerLock&&x.requestPointerLock()}var C=x=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),x()};document.addEventListener("readystatechange",O)}else setTimeout(x,1)}},12912:(x,O,Q)=>{var X=Q(12920),Z=Q(12929),n="undefined"!==typeof Float64Array;function V(x,O){return x[0]-O[0]}function o(){var x,O=this.stride,Q=new Array(O.length);for(x=0;x<Q.length;++x)Q[x]=[Math.abs(O[x]),x];Q.sort(V);var X=new Array(Q.length);for(x=0;x<X.length;++x)X[x]=Q[x][1];return X}function l(x,O){var Q=["View",O,"d",x].join("");O<0&&(Q="View_Nil"+x);var Z="generic"===x;if(-1===O){var n="function "+Q+"(a){this.data=a;};var proto="+Q+".prototype;proto.dtype='"+x+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Q+"(a){return new "+Q+"(a);}";return new Function(n)()}if(0===O){n="function "+Q+"(a,d) {this.data = a;this.offset = d};var proto="+Q+".prototype;proto.dtype='"+x+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Q+"_copy() {return new "+Q+"(this.data,this.offset)};proto.pick=function "+Q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Q+"_get(){return "+(Z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Q+"_set(v){return "+(Z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Q+"(a,b,c,d){return new "+Q+"(a,d)}";return new Function("TrivialArray",n)(C[x][0])}n=["'use strict'"];var V=X(O),l=V.map((function(x){return"i"+x})),U="this.offset+"+V.map((function(x){return"this.stride["+x+"]*i"+x})).join("+"),L=V.map((function(x){return"b"+x})).join(","),h=V.map((function(x){return"c"+x})).join(",");n.push("function "+Q+"(a,"+L+","+h+",d){this.data=a","this.shape=["+L+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+Q+".prototype","proto.dtype='"+x+"'","proto.dimension="+O),n.push("Object.defineProperty(proto,'size',{get:function "+Q+"_size(){return "+V.map((function(x){return"this.shape["+x+"]"})).join("*"),"}})"),1===O?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),O<4?(n.push("function "+Q+"_order(){"),2===O?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+Q+"_set("+l.join(",")+",v){"),Z?n.push("return this.data.set("+U+",v)}"):n.push("return this.data["+U+"]=v}"),n.push("proto.get=function "+Q+"_get("+l.join(",")+"){"),Z?n.push("return this.data.get("+U+")}"):n.push("return this.data["+U+"]}"),n.push("proto.index=function "+Q+"_index(",l.join(),"){return "+U+"}"),n.push("proto.hi=function "+Q+"_hi("+l.join(",")+"){return new "+Q+"(this.data,"+V.map((function(x){return["(typeof i",x,"!=='number'||i",x,"<0)?this.shape[",x,"]:i",x,"|0"].join("")})).join(",")+","+V.map((function(x){return"this.stride["+x+"]"})).join(",")+",this.offset)}");var N=V.map((function(x){return"a"+x+"=this.shape["+x+"]"})),a=V.map((function(x){return"c"+x+"=this.stride["+x+"]"}));n.push("proto.lo=function "+Q+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+a.join(","));for(var K=0;K<O;++K)n.push("if(typeof i"+K+"==='number'&&i"+K+">=0){d=i"+K+"|0;b+=c"+K+"*d;a"+K+"-=d}");n.push("return new "+Q+"(this.data,"+V.map((function(x){return"a"+x})).join(",")+","+V.map((function(x){return"c"+x})).join(",")+",b)}"),n.push("proto.step=function "+Q+"_step("+l.join(",")+"){var "+V.map((function(x){return"a"+x+"=this.shape["+x+"]"})).join(",")+","+V.map((function(x){return"b"+x+"=this.stride["+x+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(K=0;K<O;++K)n.push("if(typeof i"+K+"==='number'){d=i"+K+"|0;if(d<0){c+=b"+K+"*(a"+K+"-1);a"+K+"=ceil(-a"+K+"/d)}else{a"+K+"=ceil(a"+K+"/d)}b"+K+"*=d}");n.push("return new "+Q+"(this.data,"+V.map((function(x){return"a"+x})).join(",")+","+V.map((function(x){return"b"+x})).join(",")+",c)}");var M=new Array(O),Y=new Array(O);for(K=0;K<O;++K)M[K]="a[i"+K+"]",Y[K]="b[i"+K+"]";n.push("proto.transpose=function "+Q+"_transpose("+l+"){"+l.map((function(x,O){return x+"=("+x+"===undefined?"+O+":"+x+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Q+"(this.data,"+M.join(",")+","+Y.join(",")+",this.offset)}"),n.push("proto.pick=function "+Q+"_pick("+l+"){var a=[],b=[],c=this.offset");for(K=0;K<O;++K)n.push("if(typeof i"+K+"==='number'&&i"+K+">=0){c=(c+this.stride["+K+"]*i"+K+")|0}else{a.push(this.shape["+K+"]);b.push(this.stride["+K+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+Q+"(data,shape,stride,offset){return new "+Q+"(data,"+V.map((function(x){return"shape["+x+"]"})).join(",")+","+V.map((function(x){return"stride["+x+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(C[x],o)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};x.exports=function(x,O,Q,X){if(void 0===x)return(0,C.array[0])([]);"number"===typeof x&&(x=[x]),void 0===O&&(O=[x.length]);var V=O.length;if(void 0===Q){Q=new Array(V);for(var o=V-1,U=1;o>=0;--o)Q[o]=U,U*=O[o]}if(void 0===X){X=0;for(o=0;o<V;++o)Q[o]<0&&(X-=(O[o]-1)*Q[o])}for(var L=function(x){if(Z(x))return"buffer";if(n)switch(Object.prototype.toString.call(x)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(x)?"array":"generic"}(x),h=C[L];h.length<=V+1;)h.push(l(L,h.length-1));return(0,h[V+1])(x,O,Q,X)}},12929:x=>{function O(x){return!!x.constructor&&"function"===typeof x.constructor.isBuffer&&x.constructor.isBuffer(x)}x.exports=function(x){return null!=x&&(O(x)||function(x){return"function"===typeof x.readFloatLE&&"function"===typeof x.slice&&O(x.slice(0,0))}(x)||!!x._isBuffer)}},13094:x=>{"use strict";var O=[],Q=[],X=[],Z=[],n=[],V=[],o=[],l=[],C=[],U=[],L=[],h=[];x.exports=function(x,N,a,K,M,Y){for(var g=o,v=C,R=U,s=h,q=0;q<3;q++)g[q]=+a[q],R[q]=+N.max[q],v[q]=+N.base[q];Y||(Y=1e-10);var G=function(x,o,C,U,h,N){var a=O,K=Q,M=X,Y=Z,g=n,v=V,R=l,s=Math.floor,q=0,G=0,k=0,J=0,t=0;if(c(),0===k)return 0;for(J=A();G<=k;){if(d(J)&&u())return q;J=A()}for(q+=k,t=0;t<3;t++)U[t]+=C[t],h[t]+=C[t];return q;function c(){if(G=0,0!==(k=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])))for(var x=0;x<3;x++){var O=C[x]>=0;Y[x]=O?1:-1;var Q=O?h[x]:U[x];a[x]=O?U[x]:h[x],K[x]=f(Q,Y[x]),M[x]=E(a[x],Y[x]),R[x]=C[x]/k,g[x]=Math.abs(1/R[x]);var X=O?K[x]+1-Q:Q-K[x];v[x]=g[x]<1/0?g[x]*X:1/0}}function d(O){for(var Q=Y[0],X=0===O?K[0]:M[0],Z=K[0]+Q,n=Y[1],V=1===O?K[1]:M[1],o=K[1]+n,l=Y[2],C=2===O?K[2]:M[2],U=K[2]+l,L=X;L!=Z;L+=Q)for(var h=V;h!=o;h+=n)for(var N=C;N!=U;N+=l)if(x(L,h,N))return!0;return!1}function u(){q+=G;var x=Y[J],O=G/k,Q=L;for(t=0;t<3;t++){var X=C[t]*O;U[t]+=X,h[t]+=X,Q[t]=C[t]-X}if(x>0?h[J]=Math.round(h[J]):U[J]=Math.round(U[J]),o(q,J,x,Q))return!0;for(t=0;t<3;t++)C[t]=Q[t];return c(),0===k}function A(){var x=v[0]<v[1]?v[0]<v[2]?0:2:v[1]<v[2]?1:2,O=v[x]-G;for(G=v[x],K[x]+=Y[x],v[x]+=g[x],t=0;t<3;t++)a[t]+=O*R[t],M[t]=E(a[t],Y[t]);return x}function f(x,O){return s(x-O*N)}function E(x,O){return s(x+O*N)}}(x,K,g,v,R,Y);if(!M){for(q=0;q<3;q++)s[q]=a[q]>0?R[q]-N.max[q]:v[q]-N.base[q];N.translate(s)}return G}},13263:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>L});var X=Q(13090),Z=Q(11809);class n{constructor(x,O,Q,n,V,o,l){this.MC=new X(x.base,x.AC),this.JZ=O,this.friction=Q,this.restitution=n,this.JV=V,this.lN=o,this.tV=!!l,this.uC=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.SN=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Hl=Z.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Z.create(),this._impulses=Z.create(),this._sleepFrameCount=10}loadFromCopy(x){Z.j(this.MC.base,x.MC.base),Z.j(this.MC.AC,x.MC.AC),Z.j(this.MC.max,x.MC.max),this.MC.mag=x.MC.mag,this.JZ=x.JZ,this.friction=x.friction,this.restitution=x.restitution,this.JV=x.JV,this.lN=x.lN,this.tV=x.tV,this.uC=x.uC,this.fluidDrag=x.fluidDrag,this.SN=x.SN,this.preventFallOffEdge=x.preventFallOffEdge,this.rolledBackLastTick=x.rolledBackLastTick,Z.j(this.Hl,x.Hl),Z.j(this.resting,x.resting),this.inFluid=x.inFluid,this._ratioInFluid=x._ratioInFluid,Z.j(this._forces,x._forces),Z.j(this._impulses,x._impulses),this._sleepFrameCount=x._sleepFrameCount}setPosition(x){V(x),Z.hQ(x,x,this.MC.base),this.MC.translate(x),this.Pl()}en(){return Z.clone(this.MC.base)}applyForce(x){V(x),Z.add(this._forces,this._forces,x),this.Pl()}applyImpulse(x){V(x),Z.add(this._impulses,this._impulses,x),this.Pl()}Pl(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var V=x=>{};var o=Q(13090),l=Q(11809),C=Q(13094);function U(){this.uC=.1,this.fluidDrag=.4,this.fV=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function L(x,O,Q){x=Object.assign(new U,x),this.gravity=x.gravity||[0,-10,0],this.uC=x.uC||.1,this.fV=x.fV||2,this.fluidDrag=x.fluidDrag||.4,this.minBounceImpulse=x.minBounceImpulse,this.bodies=[],this.Gh=x.Gh,this.testSolid=O,this.testFluid=Q}L.prototype.KN=function(x,O,Q,X,Z,V){x=x||new o([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof Q&&(Q=1),"undefined"==typeof X&&(X=0),"undefined"==typeof Z&&(Z=1);var l=new n(x,O,Q,X,Z,V);return this.bodies.push(l),l},L.prototype.MN=function(x){var O=this.bodies.indexOf(x);O<0||(this.bodies.splice(O,1),x.MC=x.lN=null)};var h=l.create(),N=l.create(),a=l.create(),K=l.create(),M=l.create(),Y=l.create(),g=l.create(),v=new o([0,0,0],[1,1,1]),R=new n(v,1,1,0,1,(()=>{}),!1);function s(x,O,Q){return O=Q,O*=1-(1-x.ratioInFluid)**2}L.prototype.iV=function(x){x/=1e3;var O=W(0,l.squaredLength(this.gravity));this.bodies.forEach((Q=>function(x,O,Q,X){l.j(M,O.resting),x.Gh&&R.loadFromCopy(O);if(O.JZ<=0)return l.set(O.Hl,0,0,0),l.set(O._forces,0,0,0),void l.set(O._impulses,0,0,0);var Z=X||0===O.JV;if(function(x,O,Q,X){if(O._sleepFrameCount>0)return!1;if(X)return!0;var Z=!1,n=.5*Q*Q*O.JV;return l.scale(D,x.gravity,n),C(x.testSolid,O.MC,D,(function(){return Z=!0,!0}),!0),Z}(x,O,Q,Z))return;O._sleepFrameCount--,function(x,O){var Q=O.MC,X=Math.floor(Q.base[0]),Z=Math.floor(Q.base[2]),n=Math.floor(Q.base[1]),V=Math.floor(Q.max[1]);if(!x.testFluid(X,n,Z))return O.inFluid=!1,void(O.ratioInFluid=0);var o=1,C=n+1;for(;C<=V&&x.testFluid(X,C,Z);)o++,C++;var U=(n+o-Q.base[1])/Q.AC[1];U>1&&(U=1);var L=Q.AC[0]*Q.AC[1]*Q.AC[2]*U,h=G;l.scale(h,x.gravity,-x.fV*L*O.JV),O.applyForce(h),O.inFluid=!0,O.ratioInFluid=U}(x,O),I(O._forces),I(O._impulses),I(O.Hl),I(O.resting),l.scale(h,O._forces,1/O.JZ),l.WV(h,h,x.gravity,O.JV),l.scale(N,O._impulses,1/O.JZ),l.WV(N,N,h,Q),l.add(O.Hl,O.Hl,N),O.friction&&(k(x,0,O,N,Q),k(x,1,O,N,Q),k(x,2,O,N,Q));var n=O.fluidDrag>=0?O.fluidDrag:x.fluidDrag,V=O.uC>=0?O.uC:x.uC,o=V,U=V;O.inFluid&&(o=s(O,o,O.fluidDragHoriz>=0?O.fluidDragHoriz:n),U=s(O,U,O.fluidDragVert>=0?O.fluidDragVert:n));o=Math.max(1-o*Q/O.JZ,0),U=Math.max(1-U*Q/O.JZ,0),l.set(q,o,U,o),l.multiply(O.Hl,O.Hl,q),l.scale(a,O.Hl,Q),l.set(O._forces,0,0,0),l.set(O._impulses,0,0,0),O.tV&&y(c,O.MC);l.j(Y,a),l.set(g,0,0,0),O.preventFallOffEdge&&function(x,O,Q,X){if(!O.resting[1]||Q[1]>0)return;var Z=z;y(Z,O.MC);for(var n=0;n<3;n+=2){l.set(E,0,0,0),E[n]=Q[n];var V=!0;(V=(V=(V=(V=V&&!b(x,Z.base[0]+E[0]+1e-5,Z.base[1],Z.base[2]+E[2]+1e-5))&&!b(x,Z.max[0]+E[0]-1e-5,Z.base[1],Z.base[2]+E[2]+1e-5))&&!b(x,Z.base[0]+E[0]+1e-5,Z.base[1],Z.max[2]+E[2]-1e-5))&&!b(x,Z.max[0]+E[0]-1e-5,Z.base[1],Z.max[2]+E[2]-1e-5))?(X[n]=Q[n]>0?1:-1,Q[n]=0):0===n&&(l.set(F,Q[0],0,0),t(x,Z,F,X,O.slideOnCollision))}}(x,O,a,g);t(x,O.MC,a,O.resting,O.slideOnCollision),O.tV&&function(x,O,Q,X){if(O.resting[1]>=0&&!O.inFluid)return;var Z=0!==O.resting[0],n=0!==O.resting[2];if(!Z&&!n)return;var V=Math.abs(X[0]/X[2]),o=4;if(!Z&&V>o)return;if(!n&&V<1/o)return;l.add(u,Q.base,X);var U=x.testSolid;C(U,Q,X,(function(x,O,Q,X){if(1!==O)return!0;X[O]=0}));var L=Q.base[1],h=O.inFluid?1.951:1.001,N=Math.floor(L+h)-L;l.set(A,0,N,0);var a=!1;if(C(U,Q,A,(function(x,O,Q,X){return a=!0,!0})),a)return;l.hQ(f,u,Q.base),f[1]=0,t(x,Q,f,d,!0);var K=W(Q.base[0],u[0]),M=W(Q.base[2],u[2]);if(Z&&!K&&(!M||!n))return;if(n&&(!K||!Z)&&!M)return;var Y=!0;if(Y=Y&&!b(x,Q.base[0]+1e-5,Q.base[1],Q.base[2]+1e-5),Y=Y&&!b(x,Q.max[0]-1e-5,Q.base[1],Q.base[2]+1e-5),Y=Y&&!b(x,Q.base[0]+1e-5,Q.base[1],Q.max[2]-1e-5),Y=Y&&!b(x,Q.max[0]-1e-5,Q.base[1],Q.max[2]-1e-5),Y)return;y(O.MC,Q),O.resting[0]=d[0],O.resting[2]=d[2],O.SN&&O.SN()}(x,O,c,Y);for(var L=0;L<3;++L)O.resting[L]=O.resting[L]||g[L],K[L]=0,O.resting[L]&&(M[L]||(K[L]=-O.Hl[L]),O.Hl[L]=0);var v=l.length(K);v>.001&&(l.scale(K,K,O.JZ),O.lN&&O.lN(K),O.restitution>0&&v>x.minBounceImpulse&&(l.scale(K,K,O.restitution),O.applyImpulse(K)));var J=l.squaredLength(O.Hl);J>1e-5&&O.Pl();x.Gh&&x.Gh(O)?(O.loadFromCopy(R),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,Q,x,O)))};var q=l.create([0,0,0]);var G=l.create();function k(x,O,Q,X,Z){var n=Q.resting[O],V=X[O];if(!Q.alwaysApplyHorizFriction||1!==O){if(0===n)return;if(n*V<=0)return}l.j(J,Q.Hl),J[O]=0;var o=l.length(J);if(!W(o,0)){var C=Math.abs(Q.friction*x.gravity[O]*Z),U=o>C?(o-C)/o:0;Q.Hl[(O+1)%3]*=U,Q.Hl[(O+2)%3]*=U}}var J=l.create();function t(x,O,Q,X,Z){return l.set(X,0,0,0),C(x.testSolid,O,Q,(function(x,O,Q,n){X[O]=Q,n[O]=0,Z||(n[0]=0,n[1]=0,n[2]=0)}))}var c=new o([],[]),d=l.create(),u=l.create(),A=l.create(),f=l.create();var E=l.create(),z=new o([],[]),F=l.create();function b(x,O,Q,X){return x.testSolid(Math.floor(O),Math.floor(Q-1),Math.floor(X))}var D=l.create();function W(x,O){return Math.abs(x-O)<1e-5}function y(x,O){for(var Q=0;Q<3;Q++)x.base[Q]=O.base[Q],x.max[Q]=O.max[Q],x.AC[Q]=O.AC[Q]}var I=function(x){}},11698:function(x,O){!function(x){"use strict";var O=function(x,Q){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,O){x.__proto__=O}||function(x,O){for(var Q in O)Object.prototype.hasOwnProperty.call(O,Q)&&(x[Q]=O[Q])},O(x,Q)};function Q(x,Q){if("function"!==typeof Q&&null!==Q)throw new TypeError("Class extends value "+String(Q)+" is not a constructor or null");function X(){this.constructor=x}O(x,Q),x.prototype=null===Q?Object.create(Q):(X.prototype=Q.prototype,new X)}function X(x,O,Q,X){var Z,n=arguments.length,V=n<3?O:null===X?X=Object.getOwnPropertyDescriptor(O,Q):X;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)V=Reflect.decorate(x,O,Q,X);else for(var o=x.length-1;o>=0;o--)(Z=x[o])&&(V=(n<3?Z(V):n>3?Z(O,Q,V):Z(O,Q))||V);return n>3&&V&&Object.defineProperty(O,Q,V),V}function Z(x,O,Q){if(Q||2===arguments.length)for(var X,Z=0,n=O.length;Z<n;Z++)!X&&Z in O||(X||(X=Array.prototype.slice.call(O,0,Z)),X[Z]=O[Z]);return x.concat(X||Array.prototype.slice.call(O))}var n,V=255,o=213;x.OPERATION=void 0,(n=x.OPERATION||(x.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.TOUCH=1]="TOUCH",n[n.CLEAR=10]="CLEAR";var l=function(){function O(x,O,Q){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=x,this.setParent(O,Q)}return O.prototype.setParent=function(x,O,Q){var X=this;if(this.indexes||(this.indexes=this.ref instanceof fx?this.ref._definition.indexes:{}),this.parent=x,this.parentIndex=Q,O)if(this.root=O,this.ref instanceof fx){var Z=this.ref._definition;for(var n in Z.schema){var V=this.ref[n];if(V&&V.$changes){var o=Z.indexes[n];V.$changes.setParent(this.ref,O,o)}}}else"object"===typeof this.ref&&this.ref.forEach((function(x,O){if(x instanceof fx){var Q=x.$changes,Z=X.ref.$changes.indexes[O];Q.setParent(X.ref,X.root,Z)}}))},O.prototype.operation=function(x){this.changes.set(--this.currentCustomOperation,x)},O.prototype.change=function(O,Q){void 0===Q&&(Q=x.OPERATION.ADD);var X="number"===typeof O?O:this.indexes[O];this.assertValidIndex(X,O);var Z=this.changes.get(X);Z&&Z.op!==x.OPERATION.DELETE&&Z.op!==x.OPERATION.TOUCH||this.changes.set(X,{op:Z&&Z.op===x.OPERATION.DELETE?x.OPERATION.DELETE_AND_ADD:Q,index:X}),this.allChanges.add(X),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var Q="number"===typeof O?O:this.indexes[O];this.assertValidIndex(Q,O),this.changes.has(Q)||this.changes.set(Q,{op:x.OPERATION.TOUCH,index:Q}),this.allChanges.add(Q),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(x){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[x]];var O,Q=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(Q)[0]},O.prototype.getChildrenFilter=function(){var x=this.parent._definition.childFilters;return x&&x[this.parentIndex]},O.prototype.getValue=function(x){return this.ref.getByIndex(x)},O.prototype.delete=function(O){var Q="number"===typeof O?O:this.indexes[O];if(void 0!==Q){var X=this.getValue(Q);this.changes.set(Q,{op:x.OPERATION.DELETE,index:Q}),this.allChanges.delete(Q),delete this.caches[Q],X&&X.$changes&&(X.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(Q,")"))},O.prototype.discard=function(O,Q){var X=this;void 0===O&&(O=!1),void 0===Q&&(Q=!1),this.ref instanceof fx||this.changes.forEach((function(O){if(O.op===x.OPERATION.DELETE){var Q=X.ref.getIndex(O.index);delete X.indexes[Q]}})),this.changes.clear(),this.changed=O,Q&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var x=this;this.changes.forEach((function(O){var Q=x.getValue(O.index);Q&&Q.$changes&&Q.$changes.discardAll()})),this.discard()},O.prototype.cache=function(x,O){this.caches[x]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(x,O){if(void 0===x)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function C(x,O,Q,X){return x[O]||(x[O]=[]),x[O].push(Q),null===X||void 0===X||X.forEach((function(x,O){return Q(x,O)})),function(){return L(x[O],x[O].indexOf(Q))}}function U(O){var Q=this,X="string"!==typeof this.$changes.getType();this.$items.forEach((function(Z,n){O.push({refId:Q.$changes.refId,op:x.OPERATION.DELETE,field:n,value:void 0,previousValue:Z}),X&&Q.$changes.root.removeRef(Z.$changes.refId)}))}function L(x,O){if(-1===O||O>=x.length)return!1;for(var Q=x.length-1,X=O;X<Q;X++)x[X]=x[X+1];return x.length=Q,!0}var h=function(x,O){var Q=x.toString(),X=O.toString();return Q<X?-1:Q>X?1:0};function N(x){return x.$proxy=!0,x=new Proxy(x,{get:function(x,O){return"symbol"===typeof O||isNaN(O)?x[O]:x.at(O)},set:function(x,O,Q){if("symbol"===typeof O||isNaN(O))x[O]=Q;else{var X=Array.from(x.$items.keys()),Z=parseInt(X[O]||O);void 0===Q||null===Q?x.deleteAt(Z):x.setAt(Z,Q)}return!0},deleteProperty:function(x,O){return"number"===typeof O?x.deleteAt(O):delete x[O],!0}})}var a=function(){function O(){for(var x=[],O=0;O<arguments.length;O++)x[O]=arguments[O];this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,x)}return O.prototype.Go=function(O,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.ADD,O,Q?this.$items:void 0)},O.prototype.IX=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.REPLACE,O)},O.is=function(x){return Array.isArray(x)||void 0!==x.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(x){0===x?this.clear():this.splice(x,this.length-x)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var x,O=this,Q=[],X=0;X<arguments.length;X++)Q[X]=arguments[X];return Q.forEach((function(Q){x=O.$refId++,O.setAt(x,Q)})),x},O.prototype.pop=function(){var x=Array.from(this.$indexes.values()).pop();if(void 0!==x){this.$changes.delete(x),this.$indexes.delete(x);var O=this.$items.get(x);return this.$items.delete(x),O}},O.prototype.at=function(x){var O=Array.from(this.$items.keys())[x];return this.$items.get(O)},O.prototype.setAt=function(O,Q){var X,Z;if(void 0!==Q&&null!==Q){if(this.$items.get(O)!==Q){void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,O);var n=null!==(Z=null===(X=this.$changes.indexes[O])||void 0===X?void 0:X.op)&&void 0!==Z?Z:x.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,Q),this.$changes.change(O,n)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(x){var O=Array.from(this.$items.keys())[x];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(x){return this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&U.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:x.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var x,Q=[],X=0;X<arguments.length;X++)Q[X]=arguments[X];return new(O.bind.apply(O,Z([void 0],(x=Array.from(this.$items.values())).concat.apply(x,Q),!1)))},O.prototype.join=function(x){return Array.from(this.$items.values()).join(x)},O.prototype.reverse=function(){var x=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Q,X){x.setAt(O[X],Q)})),this},O.prototype.shift=function(){var x=Array.from(this.$items.keys()).shift();if(void 0!==x){var O=this.$items.get(x);return this.$deleteAt(x),O}},O.prototype.slice=function(x,Q){var X=new O;return X.push.apply(X,Array.from(this.$items.values()).slice(x,Q)),X},O.prototype.sort=function(x){var O=this;void 0===x&&(x=h);var Q=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(x).forEach((function(x,X){O.setAt(Q[X],x)})),this},O.prototype.splice=function(x,O){void 0===O&&(O=this.length-x);for(var Q=Array.from(this.$items.keys()),X=[],Z=x;Z<x+O;Z++)X.push(this.$items.get(Q[Z])),this.$deleteAt(Q[Z]);return X},O.prototype.unshift=function(){for(var x=this,O=[],Q=0;Q<arguments.length;Q++)O[Q]=arguments[Q];var X=this.length,Z=O.length,n=Array.from(this.$items.values());return O.forEach((function(O,Q){x.setAt(Q,O)})),n.forEach((function(O,Q){x.setAt(Z+Q,O)})),X+Z},O.prototype.indexOf=function(x,O){return Array.from(this.$items.values()).indexOf(x,O)},O.prototype.lastIndexOf=function(x,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(x,O)},O.prototype.every=function(x,O){return Array.from(this.$items.values()).every(x,O)},O.prototype.some=function(x,O){return Array.from(this.$items.values()).some(x,O)},O.prototype.forEach=function(x,O){Array.from(this.$items.values()).forEach(x,O)},O.prototype.map=function(x,O){return Array.from(this.$items.values()).map(x,O)},O.prototype.filter=function(x,O){return Array.from(this.$items.values()).filter(x,O)},O.prototype.reduce=function(x,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(x,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(x,O){return Array.from(this.$items.values()).find(x,O)},O.prototype.findIndex=function(x,O){return Array.from(this.$items.values()).findIndex(x,O)},O.prototype.fill=function(x,O,Q){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(x,O,Q){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(x,O){return Array.from(this.$items.values()).includes(x,O)},O.prototype.flatMap=function(x,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(x){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var x=Array.from(this.$items.values());return x.findLast.apply(x,arguments)},O.prototype.findLastIndex=function(){var x=Array.from(this.$items.values());return x.findLastIndex.apply(x,arguments)},O.prototype.setIndex=function(x,O){this.$indexes.set(x,O)},O.prototype.getIndex=function(x){return this.$indexes.get(x)},O.prototype.getByIndex=function(x){return this.$items.get(this.$indexes.get(x))},O.prototype.deleteByIndex=function(x){var O=this.$indexes.get(x);this.$items.delete(O),this.$indexes.delete(x)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(x){return"function"===typeof x.toJSON?x.toJSON():x}))},O.prototype.clone=function(x){return x?new(O.bind.apply(O,Z([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,Z([void 0],this.map((function(x){return x.$changes?x.clone():x})),!1)))},O}();function K(x){return x.$proxy=!0,x=new Proxy(x,{get:function(x,O){return"symbol"!==typeof O&&"undefined"===typeof x[O]?x.get(O):x[O]},set:function(x,O,Q){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"Go"!==O&&"IX"!==O&&"onChange"!==O?x.set(O,Q):x[O]=Q,!0},deleteProperty:function(x,O){return x.delete(O),!0}})}var M=function(){function O(x){var Q=this;if(this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,x)if(x instanceof Map||x instanceof O)x.forEach((function(x,O){return Q.set(O,x)}));else for(var X in x)this.set(X,x[X])}return O.prototype.Go=function(O,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.ADD,O,Q?this.$items:void 0)},O.prototype.IX=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.REPLACE,O)},O.is=function(x){return void 0!==x.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,Q){if(void 0===Q||null===Q)throw new Error("MapSchema#set('".concat(O,"', ").concat(Q,"): trying to set ").concat(Q," value on '").concat(O,"'."));O=O.toString();var X="undefined"!==typeof this.$changes.indexes[O],Z=X?this.$changes.indexes[O]:this.$refId++,n=X?x.OPERATION.REPLACE:x.OPERATION.ADD,V=void 0!==Q.$changes;if(V&&Q.$changes.setParent(this,this.$changes.root,Z),X){if(!V&&this.$items.get(O)===Q)return;V&&this.$items.get(O)!==Q&&(n=x.OPERATION.ADD)}else this.$changes.indexes[O]=Z,this.$indexes.set(Z,O);return this.$items.set(O,Q),this.$changes.change(O,n),this},O.prototype.get=function(x){return this.$items.get(x)},O.prototype.delete=function(x){return this.$changes.delete(x),this.$items.delete(x)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&U.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:x.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(x){return this.$items.has(x)},O.prototype.forEach=function(x){this.$items.forEach(x)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(x,O){this.$indexes.set(x,O)},O.prototype.getIndex=function(x){return this.$indexes.get(x)},O.prototype.getByIndex=function(x){return this.$items.get(this.$indexes.get(x))},O.prototype.deleteByIndex=function(x){var O=this.$indexes.get(x);this.$items.delete(O),this.$indexes.delete(x)},O.prototype.toJSON=function(){var x={};return this.forEach((function(O,Q){x[Q]="function"===typeof O.toJSON?O.toJSON():O})),x},O.prototype.clone=function(x){var Q;return x?Q=Object.assign(new O,this):(Q=new O,this.forEach((function(x,O){x.$changes?Q.set(O,x.clone()):Q.set(O,x)}))),Q},O}(),Y={};function g(x,O){Y[x]=O}function v(x){return Y[x]}var R=function(){function x(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return x.create=function(O){var Q=new x;return Q.schema=Object.assign({},O&&O.schema||{}),Q.indexes=Object.assign({},O&&O.indexes||{}),Q.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),Q.descriptors=Object.assign({},O&&O.descriptors||{}),Q.deprecated=Object.assign({},O&&O.deprecated||{}),Q},x.prototype.addField=function(x,O){var Q=this.getNextFieldIndex();this.fieldsByIndex[Q]=x,this.indexes[x]=Q,this.schema[x]=Array.isArray(O)?{array:O[0]}:O},x.prototype.hasField=function(x){return void 0!==this.indexes[x]},x.prototype.addFilter=function(x,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[x]]=O,this.indexesWithFilters.push(this.indexes[x]),!0},x.prototype.addChildrenFilter=function(x,O){var Q=this.indexes[x],X=this.schema[x];if(v(Object.keys(X)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Q]=O,!0;console.warn("@filterChildren: field '".concat(x,"' can't have children. Ignoring filter."))},x.prototype.getChildrenFilter=function(x){return this.childFilters&&this.childFilters[this.indexes[x]]},x.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},x}();function s(x){return x._context&&x._context.useFilters}var q=function(){function x(){this.types={},this.schemas=new Map,this.useFilters=!1}return x.prototype.has=function(x){return this.schemas.has(x)},x.prototype.get=function(x){return this.types[x]},x.prototype.add=function(x,O){void 0===O&&(O=this.schemas.size),x._definition=R.create(x._definition),x._typeid=O,this.types[O]=x,this.schemas.set(x,O)},x.create=function(O){return void 0===O&&(O={}),function(Q){return O.context||(O.context=new x),k(Q,O)}},x}(),G=new q;function k(x,O){return void 0===O&&(O={}),function(Q,X){var n=O.context||G,V=Q.constructor;if(V._context=n,!x)throw new Error("".concat(V.name,': @type() reference provided for "').concat(X,"\" is undefined. Make sure you don't have any circular dependencies."));n.has(V)||n.add(V);var o=V._definition;if(o.addField(X,x),o.descriptors[X]){if(o.deprecated[X])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(X,"' definition on '").concat(V.name,"'.\nCheck @type() annotation"))}catch(Y){var l=Y.stack.split("\n")[4].trim();throw new Error("".concat(Y.message," ").concat(l))}}var C=a.is(x),U=!C&&M.is(x);if("string"!==typeof x&&!fx.is(x)){var L=Object.values(x)[0];"string"===typeof L||n.has(L)||n.add(L)}if(O.manual)o.descriptors[X]={enumerable:!0,configurable:!0,writable:!0};else{var h="_".concat(X);o.descriptors[h]={enumerable:!1,configurable:!1,writable:!0},o.descriptors[X]={get:function(){return this[h]},set:function(x){x!==this[h]&&(void 0!==x&&null!==x?(!C||x instanceof a||(x=new(a.bind.apply(a,Z([void 0],x,!1)))),!U||x instanceof M||(x=new M(x)),void 0===x.$proxy&&(U?x=K(x):C&&(x=N(x))),this.$changes.change(X),x.$changes&&x.$changes.setParent(this,this.$changes.root,this._definition.indexes[X])):this[h]&&this.$changes.delete(X),this[h]=x)},enumerable:!0,configurable:!0}}}}function J(x){return function(O,Q){var X=O.constructor;X._definition.addFilter(Q,x)&&(X._context.useFilters=!0)}}function t(x){return function(O,Q){var X=O.constructor;X._definition.addChildrenFilter(Q,x)&&(X._context.useFilters=!0)}}function c(x){return void 0===x&&(x=!0),function(O,Q){var X=O.constructor._definition;X.deprecated[Q]=!0,x&&(X.descriptors[Q]={get:function(){throw new Error("".concat(Q," is deprecated."))},set:function(x){},enumerable:!1,configurable:!0})}}function d(x,O,Q){for(var X in void 0===Q&&(Q={}),Q.context||(Q.context=x._context||Q.context||G),O)k(O[X],Q)(x.prototype,X);return x}function u(x){for(var O=0,Q=0,X=0,Z=x.length;X<Z;X++)(O=x.charCodeAt(X))<128?Q+=1:O<2048?Q+=2:O<55296||O>=57344?Q+=3:(X++,Q+=4);return Q}function A(x,O,Q){for(var X=0,Z=0,n=Q.length;Z<n;Z++)(X=Q.charCodeAt(Z))<128?x[O++]=X:X<2048?(x[O++]=192|X>>6,x[O++]=128|63&X):X<55296||X>=57344?(x[O++]=224|X>>12,x[O++]=128|X>>6&63,x[O++]=128|63&X):(Z++,X=65536+((1023&X)<<10|1023&Q.charCodeAt(Z)),x[O++]=240|X>>18,x[O++]=128|X>>12&63,x[O++]=128|X>>6&63,x[O++]=128|63&X)}function f(x,O){x.push(255&O)}function E(x,O){x.push(255&O)}function z(x,O){x.push(255&O),x.push(O>>8&255)}function F(x,O){x.push(255&O),x.push(O>>8&255)}function b(x,O){x.push(255&O),x.push(O>>8&255),x.push(O>>16&255),x.push(O>>24&255)}function D(x,O){var Q=O>>24,X=O>>16,Z=O>>8,n=O;x.push(255&n),x.push(255&Z),x.push(255&X),x.push(255&Q)}function W(x,O){var Q=Math.floor(O/Math.pow(2,32));D(x,O>>>0),D(x,Q)}function y(x,O){var Q=O/Math.pow(2,32)|0;D(x,O>>>0),D(x,Q)}function I(x,O){B(x,O)}function r(x,O){i(x,O)}var j=new Int32Array(2),T=new Float32Array(j.buffer),e=new Float64Array(j.buffer);function B(x,O){T[0]=O,b(x,j[0])}function i(x,O){e[0]=O,b(x,j[0]),b(x,j[1])}function H(x,O){return E(x,O?1:0)}function S(x,O){O||(O="");var Q=u(O),X=0;if(Q<32)x.push(160|Q),X=1;else if(Q<256)x.push(217),E(x,Q),X=2;else if(Q<65536)x.push(218),F(x,Q),X=3;else{if(!(Q<4294967296))throw new Error("String too long");x.push(219),D(x,Q),X=5}return A(x,x.length,O),X+Q}function p(x,O){return isNaN(O)?p(x,0):isFinite(O)?O!==(0|O)?(x.push(203),i(x,O),9):O>=0?O<128?(E(x,O),1):O<256?(x.push(204),E(x,O),2):O<65536?(x.push(205),F(x,O),3):O<4294967296?(x.push(206),D(x,O),5):(x.push(207),y(x,O),9):O>=-32?(x.push(224|O+32),1):O>=-128?(x.push(208),f(x,O),2):O>=-32768?(x.push(209),z(x,O),3):O>=-2147483648?(x.push(210),b(x,O),5):(x.push(211),W(x,O),9):p(x,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var P=Object.freeze({__proto__:null,utf8Write:A,int8:f,uint8:E,int16:z,uint16:F,int32:b,uint32:D,int64:W,uint64:y,float32:I,float64:r,writeFloat32:B,writeFloat64:i,boolean:H,string:S,number:p});function m(x,O,Q){for(var X="",Z=0,n=O,V=O+Q;n<V;n++){var o=x[n];0!==(128&o)?192!==(224&o)?224!==(240&o)?240!==(248&o)?console.error("Invalid byte "+o.toString(16)):(Z=(7&o)<<18|(63&x[++n])<<12|(63&x[++n])<<6|63&x[++n])>=65536?(Z-=65536,X+=String.fromCharCode(55296+(Z>>>10),56320+(1023&Z))):X+=String.fromCharCode(Z):X+=String.fromCharCode((15&o)<<12|(63&x[++n])<<6|63&x[++n]):X+=String.fromCharCode((31&o)<<6|63&x[++n]):X+=String.fromCharCode(o)}return X}function w(x,O){return xx(x,O)<<24>>24}function xx(x,O){return x[O.offset++]}function Ox(x,O){return Qx(x,O)<<16>>16}function Qx(x,O){return x[O.offset++]|x[O.offset++]<<8}function Xx(x,O){return x[O.offset++]|x[O.offset++]<<8|x[O.offset++]<<16|x[O.offset++]<<24}function Zx(x,O){return Xx(x,O)>>>0}function nx(x,O){return hx(x,O)}function Vx(x,O){return Nx(x,O)}function ox(x,O){var Q=Zx(x,O);return Xx(x,O)*Math.pow(2,32)+Q}function lx(x,O){var Q=Zx(x,O);return Zx(x,O)*Math.pow(2,32)+Q}var Cx=new Int32Array(2),Ux=new Float32Array(Cx.buffer),Lx=new Float64Array(Cx.buffer);function hx(x,O){return Cx[0]=Xx(x,O),Ux[0]}function Nx(x,O){return Cx[0]=Xx(x,O),Cx[1]=Xx(x,O),Lx[0]}function ax(x,O){return xx(x,O)>0}function Kx(x,O){var Q,X=x[O.offset++];X<192?Q=31&X:217===X?Q=xx(x,O):218===X?Q=Qx(x,O):219===X&&(Q=Zx(x,O));var Z=m(x,O.offset,Q);return O.offset+=Q,Z}function Mx(x,O){var Q=x[O.offset];return Q<192&&Q>160||217===Q||218===Q||219===Q}function Yx(x,O){var Q=x[O.offset++];return Q<128?Q:202===Q?hx(x,O):203===Q?Nx(x,O):204===Q?xx(x,O):205===Q?Qx(x,O):206===Q?Zx(x,O):207===Q?lx(x,O):208===Q?w(x,O):209===Q?Ox(x,O):210===Q?Xx(x,O):211===Q?ox(x,O):Q>223?-1*(255-Q+1):void 0}function gx(x,O){var Q=x[O.offset];return Q<128||Q>=202&&Q<=211}function vx(x,O){return x[O.offset]<160}function Rx(x,O){return x[O.offset-1]===V&&(x[O.offset]<128||x[O.offset]>=202&&x[O.offset]<=211)}var sx=Object.freeze({__proto__:null,int8:w,uint8:xx,int16:Ox,uint16:Qx,int32:Xx,uint32:Zx,float32:nx,float64:Vx,int64:ox,uint64:lx,readFloat32:hx,readFloat64:Nx,boolean:ax,string:Kx,stringCheck:Mx,number:Yx,numberCheck:gx,arrayCheck:vx,switchStructureCheck:Rx}),qx=function(){function O(x){var O=this;this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,x&&x.forEach((function(x){return O.add(x)}))}return O.prototype.Go=function(O,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.ADD,O,Q?this.$items:void 0)},O.prototype.IX=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.REPLACE,O)},O.is=function(x){return void 0!==x.collection},O.prototype.add=function(x){var O=this.$refId++;return void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,x),this.$changes.change(O),O},O.prototype.at=function(x){var O=Array.from(this.$items.keys())[x];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(x){for(var O,Q,X=this.$items.entries();(Q=X.next())&&!Q.done;)if(x===Q.value[1]){O=Q.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&U.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:x.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(x){return Array.from(this.$items.values()).some((function(O){return O===x}))},O.prototype.forEach=function(x){var O=this;this.$items.forEach((function(Q,X,Z){return x(Q,X,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(x,O){this.$indexes.set(x,O)},O.prototype.getIndex=function(x){return this.$indexes.get(x)},O.prototype.getByIndex=function(x){return this.$items.get(this.$indexes.get(x))},O.prototype.deleteByIndex=function(x){var O=this.$indexes.get(x);this.$items.delete(O),this.$indexes.delete(x)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var x=[];return this.forEach((function(O,Q){x.push("function"===typeof O.toJSON?O.toJSON():O)})),x},O.prototype.clone=function(x){var Q;return x?Q=Object.assign(new O,this):(Q=new O,this.forEach((function(x){x.$changes?Q.add(x.clone()):Q.add(x)}))),Q},O}(),Gx=function(){function O(x){var O=this;this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,x&&x.forEach((function(x){return O.add(x)}))}return O.prototype.Go=function(O,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.ADD,O,Q?this.$items:void 0)},O.prototype.IX=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.REPLACE,O)},O.is=function(x){return void 0!==x.set},O.prototype.add=function(O){var Q,X;if(this.has(O))return!1;var Z=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,Z);var n=null!==(X=null===(Q=this.$changes.indexes[Z])||void 0===Q?void 0:Q.op)&&void 0!==X?X:x.OPERATION.ADD;return this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,O),this.$changes.change(Z,n),Z},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(x){for(var O,Q,X=this.$items.entries();(Q=X.next())&&!Q.done;)if(x===Q.value[1]){O=Q.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&U.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:x.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(x){for(var O,Q=this.$items.values(),X=!1;(O=Q.next())&&!O.done;)if(x===O.value){X=!0;break}return X},O.prototype.forEach=function(x){var O=this;this.$items.forEach((function(Q,X,Z){return x(Q,X,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(x,O){this.$indexes.set(x,O)},O.prototype.getIndex=function(x){return this.$indexes.get(x)},O.prototype.getByIndex=function(x){return this.$items.get(this.$indexes.get(x))},O.prototype.deleteByIndex=function(x){var O=this.$indexes.get(x);this.$items.delete(O),this.$indexes.delete(x)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var x=[];return this.forEach((function(O,Q){x.push("function"===typeof O.toJSON?O.toJSON():O)})),x},O.prototype.clone=function(x){var Q;return x?Q=Object.assign(new O,this):(Q=new O,this.forEach((function(x){x.$changes?Q.add(x.clone()):Q.add(x)}))),Q},O}(),kx=function(){function x(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return x.prototype.addRefId=function(x){this.refIds.has(x)||(this.refIds.add(x),this.containerIndexes.set(x,new Set))},x.get=function(O){return void 0===O.$filterState&&(O.$filterState=new x),O.$filterState},x}(),Jx=function(){function x(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return x.prototype.getNextUniqueId=function(){return this.nextUniqueId++},x.prototype.addRef=function(x,O,Q){void 0===Q&&(Q=!0),this.refs.set(x,O),Q&&(this.refCounts[x]=(this.refCounts[x]||0)+1)},x.prototype.removeRef=function(x){this.refCounts[x]=this.refCounts[x]-1,this.deletedRefs.add(x)},x.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},x.prototype.garbageCollectDeletedRefs=function(){var x=this;this.deletedRefs.forEach((function(O){if(!(x.refCounts[O]>0)){var Q=x.refs.get(O);if(Q instanceof fx)for(var X in Q._definition.schema)"string"!==typeof Q._definition.schema[X]&&Q[X]&&Q[X].$changes&&x.removeRef(Q[X].$changes.refId);else{var Z=Q.$changes.parent._definition,n=Z.schema[Z.fieldsByIndex[Q.$changes.parentIndex]];"function"===typeof Object.values(n)[0]&&Array.from(Q.values()).forEach((function(O){return x.removeRef(O.$changes.refId)}))}x.refs.delete(O),delete x.refCounts[O]}})),this.deletedRefs.clear()},x}(),tx=function(x){function O(){return null!==x&&x.apply(this,arguments)||this}return Q(O,x),O}(Error);function cx(x,O,Q,X){var Z,n=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":Z="number",isNaN(x)&&console.log('trying to encode "NaN" in '.concat(Q.constructor.name,"#").concat(X));break;case"string":Z="string",n=!0;break;case"boolean":return}if(typeof x!==Z&&(!n||n&&null!==x)){var V="'".concat(JSON.stringify(x),"'").concat(x&&x.constructor&&" (".concat(x.constructor.name,")")||"");throw new tx("a '".concat(Z,"' was expected, but ").concat(V," was provided in ").concat(Q.constructor.name,"#").concat(X))}}function dx(x,O,Q,X){if(!(x instanceof O))throw new tx("a '".concat(O.name,"' was expected, but '").concat(x.constructor.name,"' was provided in ").concat(Q.constructor.name,"#").concat(X))}function ux(x,O,Q,X,Z){cx(Q,x,X,Z);var n=P[x];if(!n)throw new tx("a '".concat(x,"' was expected, but ").concat(Q," was provided in ").concat(X.constructor.name,"#").concat(Z));n(O,Q)}function Ax(x,O,Q){return sx[x](O,Q)}var fx=function(){function O(){for(var x=[],O=0;O<arguments.length;O++)x[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new l(this,void 0,new Jx),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Q=this._definition.descriptors;Q&&Object.defineProperties(this,Q),x[0]&&this.assign(x[0])}return O.onError=function(x){console.error(x)},O.is=function(x){return x._definition&&void 0!==x._definition.schema},O.prototype.onChange=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.REPLACE,O)},O.prototype.IX=function(O){return C(this.$callbacks||(this.$callbacks=[]),x.OPERATION.DELETE,O)},O.prototype.assign=function(x){return Object.assign(this,x),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(x,O){this.$changes.change(x,O)},O.prototype.listen=function(x,O,Q){var X=this;return void 0===Q&&(Q=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[x]||(this.$callbacks[x]=[]),this.$callbacks[x].push(O),Q&&void 0!==this[x]&&O(this[x],void 0),function(){return L(X.$callbacks[x],X.$callbacks[x].indexOf(O))}},O.prototype.decode=function(Q,X,Z){var n;void 0===X&&(X={offset:0}),void 0===Z&&(Z=this);var o=[],l=this.$changes.root,C=Q.length,U=0;for(l.refs.set(U,this);X.offset<C;){var L=Q[X.offset++];if(L!=V){var h=Z.$changes,N=void 0!==Z._definition,K=N?L>>6<<6:L;if(K!==x.OPERATION.CLEAR){var Y=N?L%(K||255):Yx(Q,X),g=N?Z._definition.fieldsByIndex[Y]:"",R=h.getType(Y),s=void 0,q=void 0,G=void 0;if(N?q=Z["_".concat(g)]:(q=Z.getByIndex(Y),(K&x.OPERATION.ADD)===x.OPERATION.ADD?(G=Z instanceof M?Kx(Q,X):Y,Z.setIndex(Y,G)):G=Z.getIndex(Y)),(K&x.OPERATION.DELETE)===x.OPERATION.DELETE&&(K!==x.OPERATION.DELETE_AND_ADD&&Z.deleteByIndex(Y),q&&q.$changes&&l.removeRef(q.$changes.refId),s=null),void 0!==g){if(K===x.OPERATION.DELETE);else if(O.is(R)){var k=Yx(Q,X);if(s=l.refs.get(k),K!==x.OPERATION.REPLACE){var J=this.getSchemaType(Q,X,R);s||((s=this.createTypeInstance(J)).$changes.refId=k,q&&(s.$callbacks=q.$callbacks,q.$changes.refId&&k!==q.$changes.refId&&l.removeRef(q.$changes.refId))),l.addRef(k,s,s!==q)}}else if("string"===typeof R)s=Ax(R,Q,X);else{var t=v(Object.keys(R)[0]),c=Yx(Q,X),d=l.refs.has(c)?q||l.refs.get(c):new t.constructor;if((s=d.clone(!0)).$changes.refId=c,q&&(s.$callbacks=q.$callbacks,q.$changes.refId&&c!==q.$changes.refId)){l.removeRef(q.$changes.refId);for(var u=q.entries(),A=void 0;(A=u.next())&&!A.done;){var f=(n=A.value)[0],E=n[1];o.push({refId:c,op:x.OPERATION.DELETE,field:f,value:void 0,previousValue:E})}}l.addRef(c,s,d!==q)}if(null!==s&&void 0!==s)if(s.$changes&&s.$changes.setParent(h.ref,h.root,Y),Z instanceof O)Z[g]=s;else if(Z instanceof M)f=G,Z.$items.set(f,s),Z.$changes.allChanges.add(Y);else if(Z instanceof a)Z.setAt(Y,s);else if(Z instanceof qx){var z=Z.add(s);Z.setIndex(Y,z)}else Z instanceof Gx&&!1!==(z=Z.add(s))&&Z.setIndex(Y,z);q!==s&&o.push({refId:U,op:K,field:g,dynamicIndex:G,value:s,previousValue:q})}else{console.warn("@colyseus/schema: definition mismatch");for(var F={offset:X.offset};X.offset<C&&(!Rx(Q,X)||(F.offset=X.offset+1,!l.refs.has(Yx(Q,F))));)X.offset++}}else Z.clear(o)}else{U=Yx(Q,X);var b=l.refs.get(U);if(!b)throw new Error('"refId" not found: '.concat(U));Z=b}}return this._triggerChanges(o),l.garbageCollectDeletedRefs(),o},O.prototype.encode=function(Q,X,Z){void 0===Q&&(Q=!1),void 0===X&&(X=[]),void 0===Z&&(Z=!1);for(var n=this.$changes,o=new WeakSet,l=[n],C=1,U=0;U<C;U++){var L=l[U],h=L.ref,N=h instanceof O;L.ensureRefId(),o.add(L),L!==n&&(L.changed||Q)&&(E(X,V),p(X,L.refId));for(var a=Q?Array.from(L.allChanges):Array.from(L.changes.values()),K=0,Y=a.length;K<Y;K++){var g=Q?{op:x.OPERATION.ADD,index:a[K]}:a[K],R=g.index,s=N?h._definition.fieldsByIndex&&h._definition.fieldsByIndex[R]:R,q=X.length;if(g.op!==x.OPERATION.TOUCH)if(N)E(X,R|g.op);else{if(E(X,g.op),g.op===x.OPERATION.CLEAR)continue;p(X,R)}if(N||(g.op&x.OPERATION.ADD)!=x.OPERATION.ADD||h instanceof M&&S(X,L.ref.$indexes.get(R)),g.op!==x.OPERATION.DELETE){var G=L.getType(R),k=L.getValue(R);if(k&&k.$changes&&!o.has(k.$changes)&&(l.push(k.$changes),k.$changes.ensureRefId(),C++),g.op!==x.OPERATION.TOUCH){if(O.is(G))dx(k,G,h,s),p(X,k.$changes.refId),(g.op&x.OPERATION.ADD)===x.OPERATION.ADD&&this.tryEncodeTypeId(X,G,k.constructor);else if("string"===typeof G)ux(G,X,k,h,s);else{var J=v(Object.keys(G)[0]);dx(h["_".concat(s)],J.constructor,h,s),p(X,k.$changes.refId)}Z&&L.cache(R,X.slice(q))}}}Q||Z||L.discard()}return X},O.prototype.encodeAll=function(x){return this.encode(!0,[],x)},O.prototype.applyFilters=function(Q,X){var Z,n;void 0===X&&(X=!1);for(var o=this,l=new Set,C=kx.get(Q),U=[this.$changes],L=1,h=[],N=function(N){var a=U[N];if(l.has(a.refId))return"continue";var K=a.ref,Y=K instanceof O;E(h,V),p(h,a.refId);var g=C.refIds.has(a),v=X||!g;C.addRefId(a);var R=C.containerIndexes.get(a),s=v?Array.from(a.allChanges):Array.from(a.changes.values());!X&&Y&&K._definition.indexesWithFilters&&K._definition.indexesWithFilters.forEach((function(O){!R.has(O)&&a.allChanges.has(O)&&(v?s.push(O):s.push({op:x.OPERATION.ADD,index:O}))}));for(var q=0,G=s.length;q<G;q++){var k=v?{op:x.OPERATION.ADD,index:s[q]}:s[q];if(k.op!==x.OPERATION.CLEAR){var J=k.index;if(k.op!==x.OPERATION.DELETE){var t=a.getValue(J),c=a.getType(J);if(Y){if((d=K._definition.filters&&K._definition.filters[J])&&!d.call(K,Q,t,o)){t&&t.$changes&&l.add(t.$changes.refId);continue}}else{var d,u=a.parent;if((d=a.getChildrenFilter())&&!d.call(u,Q,K.$indexes.get(J),t,o)){t&&t.$changes&&l.add(t.$changes.refId);continue}}if(t.$changes&&(U.push(t.$changes),L++),k.op!==x.OPERATION.TOUCH)if(k.op===x.OPERATION.ADD||Y)h.push.apply(h,null!==(Z=a.caches[J])&&void 0!==Z?Z:[]),R.add(J);else if(R.has(J))h.push.apply(h,null!==(n=a.caches[J])&&void 0!==n?n:[]);else{if(R.add(J),E(h,x.OPERATION.ADD),p(h,J),K instanceof M){var A=a.ref.$indexes.get(J);S(h,A)}t.$changes?p(h,t.$changes.refId):P[c](h,t)}else t.$changes&&!Y&&(E(h,x.OPERATION.ADD),p(h,J),K instanceof M&&(A=a.ref.$indexes.get(J),S(h,A)),p(h,t.$changes.refId))}else Y?E(h,k.op|J):(E(h,k.op),p(h,J))}else E(h,k.op)}},a=0;a<L;a++)N(a);return h},O.prototype.clone=function(){var x,O=new this.constructor,Q=this._definition.schema;for(var X in Q)"object"===typeof this[X]&&"function"===typeof(null===(x=this[X])||void 0===x?void 0:x.clone)?O[X]=this[X].clone():O[X]=this[X];return O},O.prototype.toJSON=function(){var x=this._definition.schema,O=this._definition.deprecated,Q={};for(var X in x)O[X]||null===this[X]||"undefined"===typeof this[X]||(Q[X]="function"===typeof this[X].toJSON?this[X].toJSON():this["_".concat(X)]);return Q},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(x){return this[this._definition.fieldsByIndex[x]]},O.prototype.deleteByIndex=function(x){this[this._definition.fieldsByIndex[x]]=void 0},O.prototype.tryEncodeTypeId=function(x,O,Q){O._typeid!==Q._typeid&&(E(x,o),p(x,Q._typeid))},O.prototype.getSchemaType=function(x,O,Q){var X;return x[O.offset]===o&&(O.offset++,X=this.constructor._context.get(Yx(x,O))),X||Q},O.prototype.createTypeInstance=function(x){var O=new x;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(Q){for(var X,Z,n,V,o,l,C,U,L,h=new Set,N=this.$changes.root.refs,a=function(a){var K=Q[a],M=K.refId,Y=N.get(M),g=Y.$callbacks;if((K.op&x.OPERATION.DELETE)===x.OPERATION.DELETE&&K.previousValue instanceof O&&(null===(Z=null===(X=K.previousValue.$callbacks)||void 0===X?void 0:X[x.OPERATION.DELETE])||void 0===Z||Z.forEach((function(x){return x()}))),!g)return"continue";if(Y instanceof O){if(!h.has(M))try{null===(n=null===g||void 0===g?void 0:g[x.OPERATION.REPLACE])||void 0===n||n.forEach((function(x){return x()}))}catch(v){O.onError(v)}try{g.hasOwnProperty(K.field)&&(null===(V=g[K.field])||void 0===V||V.forEach((function(x){return x(K.value,K.previousValue)})))}catch(v){O.onError(v)}}else K.op===x.OPERATION.ADD&&void 0===K.previousValue?null===(o=g[x.OPERATION.ADD])||void 0===o||o.forEach((function(x){var O;return x(K.value,null!==(O=K.dynamicIndex)&&void 0!==O?O:K.field)})):K.op===x.OPERATION.DELETE?void 0!==K.previousValue&&(null===(l=g[x.OPERATION.DELETE])||void 0===l||l.forEach((function(x){var O;return x(K.previousValue,null!==(O=K.dynamicIndex)&&void 0!==O?O:K.field)}))):K.op===x.OPERATION.DELETE_AND_ADD&&(void 0!==K.previousValue&&(null===(C=g[x.OPERATION.DELETE])||void 0===C||C.forEach((function(x){var O;return x(K.previousValue,null!==(O=K.dynamicIndex)&&void 0!==O?O:K.field)}))),null===(U=g[x.OPERATION.ADD])||void 0===U||U.forEach((function(x){var O;return x(K.value,null!==(O=K.dynamicIndex)&&void 0!==O?O:K.field)}))),K.value!==K.previousValue&&(null===(L=g[x.OPERATION.REPLACE])||void 0===L||L.forEach((function(x){var O;return x(K.value,null!==(O=K.dynamicIndex)&&void 0!==O?O:K.field)})));h.add(M)},K=0;K<Q.length;K++)a(K)},O._definition=R.create(),O}();function Ex(x){for(var O=[x.$changes],Q=1,X={},Z=X,n=function(x){var Q=O[x];Q.changes.forEach((function(x){var O=Q.ref,X=x.index,n=O._definition?O._definition.fieldsByIndex[X]:O.$indexes.get(X);Z[n]=Q.getValue(X)}))},V=0;V<Q;V++)n(V);return X}var zx={context:new q},Fx=function(x){function O(){return null!==x&&x.apply(this,arguments)||this}return Q(O,x),X([k("string",zx)],O.prototype,"name",void 0),X([k("string",zx)],O.prototype,"type",void 0),X([k("number",zx)],O.prototype,"referencedType",void 0),O}(fx),bx=function(x){function O(){var O=null!==x&&x.apply(this,arguments)||this;return O.fields=new a,O}return Q(O,x),X([k("number",zx)],O.prototype,"id",void 0),X([k([Fx],zx)],O.prototype,"fields",void 0),O}(fx),Dx=function(x){function O(){var O=null!==x&&x.apply(this,arguments)||this;return O.types=new a,O}return Q(O,x),O.encode=function(x){var Q=x.constructor,X=new O;X.rootType=Q._typeid;var Z=function(x,O){for(var Q in O){var Z=new Fx;Z.name=Q;var n=void 0;if("string"===typeof O[Q])n=O[Q];else{var V=O[Q],o=void 0;fx.is(V)?(n="ref",o=O[Q]):"string"===typeof V[n=Object.keys(V)[0]]?n+=":"+V[n]:o=V[n],Z.referencedType=o?o._typeid:-1}Z.type=n,x.fields.push(Z)}X.types.push(x)},n=Q._context.types;for(var V in n){var o=new bx;o.id=Number(V),Z(o,n[V]._definition.schema)}return X.encodeAll()},O.decode=function(x,X){var Z=new q,n=new O;n.decode(x,X);var V=n.types.reduce((function(x,O){var X=function(x){function O(){return null!==x&&x.apply(this,arguments)||this}return Q(O,x),O}(fx),n=O.id;return x[n]=X,Z.add(X,n),x}),{});n.types.forEach((function(x){var O=V[x.id];x.fields.forEach((function(x){var Q;if(void 0!==x.referencedType){var X=x.type,n=V[x.referencedType];if(!n){var o=x.type.split(":");X=o[0],n=o[1]}"ref"===X?k(n,{context:Z})(O.prototype,x.name):k(((Q={})[X]=n,Q),{context:Z})(O.prototype,x.name)}else k(x.type,{context:Z})(O.prototype,x.name)}))}));var o=V[n.rootType],l=new o;for(var C in o._definition.schema){var U=o._definition.schema[C];"string"!==typeof U&&(l[C]="function"===typeof U?new U:new(v(Object.keys(U)[0]).constructor))}return l},X([k([bx],zx)],O.prototype,"types",void 0),X([k("number",zx)],O.prototype,"rootType",void 0),O}(fx);g("map",{constructor:M}),g("array",{constructor:a}),g("set",{constructor:Gx}),g("collection",{constructor:qx}),x.ArraySchema=a,x.CollectionSchema=qx,x.Context=q,x.MapSchema=M,x.Reflection=Dx,x.ReflectionField=Fx,x.ReflectionType=bx,x.Schema=fx,x.SchemaDefinition=R,x.SetSchema=Gx,x.decode=sx,x.defineTypes=d,x.deprecated=c,x.dumpChanges=Ex,x.encode=P,x.filter=J,x.filterChildren=t,x.hasFilter=s,x.registerType=g,x.type=k,Object.defineProperty(x,"__esModule",{value:!0})}(O)},13135:x=>{"use strict";x.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13127:(x,O,Q)=>{var X=Q(13135),Z=Q(13137),n=Object.hasOwnProperty,V=Object.create(null);for(var o in X)n.call(X,o)&&(V[X[o]]=o);var l=x.exports={to:{},get:{}};function C(x,O,Q){return Math.min(Math.max(O,x),Q)}function U(x){var O=Math.round(x).toString(16).toUpperCase();return O.length<2?"0"+O:O}l.get=function(x){var O,Q;switch(x.substring(0,3).toLowerCase()){case"hsl":O=l.get.hsl(x),Q="hsl";break;case"hwb":O=l.get.hwb(x),Q="hwb";break;default:O=l.get.rgb(x),Q="rgb"}return O?{model:Q,value:O}:null},l.get.rgb=function(x){if(!x)return null;var O,Q,Z,V=[0,0,0,1];if(O=x.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(Z=O[2],O=O[1],Q=0;Q<3;Q++){var o=2*Q;V[Q]=parseInt(O.slice(o,o+2),16)}Z&&(V[3]=parseInt(Z,16)/255)}else if(O=x.match(/^#([a-f0-9]{3,4})$/i)){for(Z=(O=O[1])[3],Q=0;Q<3;Q++)V[Q]=parseInt(O[Q]+O[Q],16);Z&&(V[3]=parseInt(Z+Z,16)/255)}else if(O=x.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Q=0;Q<3;Q++)V[Q]=parseInt(O[Q+1],0);O[4]&&(O[5]?V[3]=.01*parseFloat(O[4]):V[3]=parseFloat(O[4]))}else{if(!(O=x.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=x.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:n.call(X,O[1])?((V=X[O[1]])[3]=1,V):null:null;for(Q=0;Q<3;Q++)V[Q]=Math.round(2.55*parseFloat(O[Q+1]));O[4]&&(O[5]?V[3]=.01*parseFloat(O[4]):V[3]=parseFloat(O[4]))}for(Q=0;Q<3;Q++)V[Q]=C(V[Q],0,255);return V[3]=C(V[3],0,1),V},l.get.hsl=function(x){if(!x)return null;var O=x.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var Q=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,C(parseFloat(O[2]),0,100),C(parseFloat(O[3]),0,100),C(isNaN(Q)?1:Q,0,1)]}return null},l.get.hwb=function(x){if(!x)return null;var O=x.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var Q=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,C(parseFloat(O[2]),0,100),C(parseFloat(O[3]),0,100),C(isNaN(Q)?1:Q,0,1)]}return null},l.to.hex=function(){var x=Z(arguments);return"#"+U(x[0])+U(x[1])+U(x[2])+(x[3]<1?U(Math.round(255*x[3])):"")},l.to.rgb=function(){var x=Z(arguments);return x.length<4||1===x[3]?"rgb("+Math.round(x[0])+", "+Math.round(x[1])+", "+Math.round(x[2])+")":"rgba("+Math.round(x[0])+", "+Math.round(x[1])+", "+Math.round(x[2])+", "+x[3]+")"},l.to.rgb.percent=function(){var x=Z(arguments),O=Math.round(x[0]/255*100),Q=Math.round(x[1]/255*100),X=Math.round(x[2]/255*100);return x.length<4||1===x[3]?"rgb("+O+"%, "+Q+"%, "+X+"%)":"rgba("+O+"%, "+Q+"%, "+X+"%, "+x[3]+")"},l.to.hsl=function(){var x=Z(arguments);return x.length<4||1===x[3]?"hsl("+x[0]+", "+x[1]+"%, "+x[2]+"%)":"hsla("+x[0]+", "+x[1]+"%, "+x[2]+"%, "+x[3]+")"},l.to.hwb=function(){var x=Z(arguments),O="";return x.length>=4&&1!==x[3]&&(O=", "+x[3]),"hwb("+x[0]+", "+x[1]+"%, "+x[2]+"%"+O+")"},l.to.keyword=function(x){return V[x.slice(0,3)]}},13119:(x,O,Q)=>{const X=Q(13127),Z=Q(13143),n=["keyword","gray","hex"],V={};for(const N of Object.keys(Z))V[[...Z[N].labels].sort().join("")]=N;const o={};function l(x,O){if(!(this instanceof l))return new l(x,O);if(O&&O in n&&(O=null),O&&!(O in Z))throw new Error("Unknown model: "+O);let Q,C;if(null==x)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(x instanceof l)this.model=x.model,this.color=[...x.color],this.valpha=x.valpha;else if("string"===typeof x){const O=X.get(x);if(null===O)throw new Error("Unable to parse color from string: "+x);this.model=O.model,C=Z[this.model].channels,this.color=O.value.slice(0,C),this.valpha="number"===typeof O.value[C]?O.value[C]:1}else if(x.length>0){this.model=O||"rgb",C=Z[this.model].channels;const Q=Array.prototype.slice.call(x,0,C);this.color=h(Q,C),this.valpha="number"===typeof x[C]?x[C]:1}else if("number"===typeof x)this.model="rgb",this.color=[x>>16&255,x>>8&255,255&x],this.valpha=1;else{this.valpha=1;const O=Object.keys(x);"alpha"in x&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof x.alpha?x.alpha:0);const X=O.sort().join("");if(!(X in V))throw new Error("Unable to parse color from object: "+JSON.stringify(x));this.model=V[X];const{labels:n}=Z[this.model],o=[];for(Q=0;Q<n.length;Q++)o.push(x[n[Q]]);this.color=h(o)}if(o[this.model])for(C=Z[this.model].channels,Q=0;Q<C;Q++){const x=o[this.model][Q];x&&(this.color[Q]=x(this.color[Q]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}l.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(x){let O=this.model in X.to?this:this.rgb();O=O.round("number"===typeof x?x:1);const Q=1===O.valpha?O.color:[...O.color,this.valpha];return X.to[O.model](Q)},percentString(x){const O=this.rgb().round("number"===typeof x?x:1),Q=1===O.valpha?O.color:[...O.color,this.valpha];return X.to.rgb.percent(Q)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const x={},{channels:O}=Z[this.model],{labels:Q}=Z[this.model];for(let X=0;X<O;X++)x[Q[X]]=this.color[X];return 1!==this.valpha&&(x.alpha=this.valpha),x},unitArray(){const x=this.rgb().color;return x[0]/=255,x[1]/=255,x[2]/=255,1!==this.valpha&&x.push(this.valpha),x},unitObject(){const x=this.rgb().object();return x.r/=255,x.g/=255,x.b/=255,1!==this.valpha&&(x.alpha=this.valpha),x},round(x){return x=Math.max(x||0,0),new l([...this.color.map(C(x)),this.valpha],this.model)},alpha(x){return void 0!==x?new l([...this.color,Math.max(0,Math.min(1,x))],this.model):this.valpha},red:U("rgb",0,L(255)),green:U("rgb",1,L(255)),blue:U("rgb",2,L(255)),hue:U(["hsl","hsv","hsl","hwb","hcg"],0,(x=>(x%360+360)%360)),saturationl:U("hsl",1,L(100)),lightness:U("hsl",2,L(100)),saturationv:U("hsv",1,L(100)),value:U("hsv",2,L(100)),chroma:U("hcg",1,L(100)),gray:U("hcg",2,L(100)),white:U("hwb",1,L(100)),wblack:U("hwb",2,L(100)),cyan:U("cmyk",0,L(100)),magenta:U("cmyk",1,L(100)),yellow:U("cmyk",2,L(100)),black:U("cmyk",3,L(100)),x:U("xyz",0,L(95.047)),y:U("xyz",1,L(100)),z:U("xyz",2,L(108.833)),l:U("lab",0,L(100)),a:U("lab",1),b:U("lab",2),keyword(x){return void 0!==x?new l(x):Z[this.model].keyword(this.color)},hex(x){return void 0!==x?new l(x):X.to.hex(this.rgb().round().color)},hexa(x){if(void 0!==x)return new l(x);const O=this.rgb().round().color;let Q=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Q.length&&(Q="0"+Q),X.to.hex(O)+Q},rgbNumber(){const x=this.rgb().color;return(255&x[0])<<16|(255&x[1])<<8|255&x[2]},luminosity(){const x=this.rgb().color,O=[];for(const[Q,X]of x.entries()){const x=X/255;O[Q]=x<=.04045?x/12.92:((x+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(x){const O=this.luminosity(),Q=x.luminosity();return O>Q?(O+.05)/(Q+.05):(Q+.05)/(O+.05)},level(x){const O=this.contrast(x);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const x=this.rgb().color;return(2126*x[0]+7152*x[1]+722*x[2])/1e4<128},isLight(){return!this.isDark()},negate(){const x=this.rgb();for(let O=0;O<3;O++)x.color[O]=255-x.color[O];return x},lighten(x){const O=this.hsl();return O.color[2]+=O.color[2]*x,O},darken(x){const O=this.hsl();return O.color[2]-=O.color[2]*x,O},saturate(x){const O=this.hsl();return O.color[1]+=O.color[1]*x,O},desaturate(x){const O=this.hsl();return O.color[1]-=O.color[1]*x,O},whiten(x){const O=this.hwb();return O.color[1]+=O.color[1]*x,O},blacken(x){const O=this.hwb();return O.color[2]+=O.color[2]*x,O},grayscale(){const x=this.rgb().color,O=.3*x[0]+.59*x[1]+.11*x[2];return l.rgb(O,O,O)},fade(x){return this.alpha(this.valpha-this.valpha*x)},opaquer(x){return this.alpha(this.valpha+this.valpha*x)},rotate(x){const O=this.hsl();let Q=O.color[0];return Q=(Q+x)%360,Q=Q<0?360+Q:Q,O.color[0]=Q,O},mix(x,O){if(!x||!x.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof x);const Q=x.rgb(),X=this.rgb(),Z=void 0===O?.5:O,n=2*Z-1,V=Q.alpha()-X.alpha(),o=((n*V===-1?n:(n+V)/(1+n*V))+1)/2,C=1-o;return l.rgb(o*Q.red()+C*X.red(),o*Q.green()+C*X.green(),o*Q.blue()+C*X.blue(),Q.alpha()*Z+X.alpha()*(1-Z))}};for(const N of Object.keys(Z)){if(n.includes(N))continue;const{channels:x}=Z[N];l.prototype[N]=function(){if(this.model===N)return new l(this);for(var x=arguments.length,O=new Array(x),Q=0;Q<x;Q++)O[Q]=arguments[Q];return O.length>0?new l(O,N):new l([...(X=Z[this.model][N].raw(this.color),Array.isArray(X)?X:[X]),this.valpha],N);var X},l[N]=function(){for(var O=arguments.length,Q=new Array(O),X=0;X<O;X++)Q[X]=arguments[X];let Z=Q[0];return"number"===typeof Z&&(Z=h(Q,x)),new l(Z,N)}}function C(x){return function(O){return function(x,O){return Number(x.toFixed(O))}(O,x)}}function U(x,O,Q){x=Array.isArray(x)?x:[x];for(const X of x)(o[X]||(o[X]=[]))[O]=Q;return x=x[0],function(X){let Z;return void 0!==X?(Q&&(X=Q(X)),Z=this[x](),Z.color[O]=X,Z):(Z=this[x]().color[O],Q&&(Z=Q(Z)),Z)}}function L(x){return function(O){return Math.max(0,Math.min(x,O))}}function h(x,O){for(let Q=0;Q<O;Q++)"number"!==typeof x[Q]&&(x[Q]=0);return x}x.exports=l},13148:(x,O,Q)=>{const X=Q(13153),Z={};for(const V of Object.keys(X))Z[X[V]]=V;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};x.exports=n;for(const V of Object.keys(n)){if(!("channels"in n[V]))throw new Error("missing channels property: "+V);if(!("labels"in n[V]))throw new Error("missing channel labels property: "+V);if(n[V].labels.length!==n[V].channels)throw new Error("channel and label counts mismatch: "+V);const{channels:x,labels:O}=n[V];delete n[V].channels,delete n[V].labels,Object.defineProperty(n[V],"channels",{value:x}),Object.defineProperty(n[V],"labels",{value:O})}n.rgb.hsl=function(x){const O=x[0]/255,Q=x[1]/255,X=x[2]/255,Z=Math.min(O,Q,X),n=Math.max(O,Q,X),V=n-Z;let o,l;n===Z?o=0:O===n?o=(Q-X)/V:Q===n?o=2+(X-O)/V:X===n&&(o=4+(O-Q)/V),o=Math.min(60*o,360),o<0&&(o+=360);const C=(Z+n)/2;return l=n===Z?0:C<=.5?V/(n+Z):V/(2-n-Z),[o,100*l,100*C]},n.rgb.hsv=function(x){let O,Q,X,Z,n;const V=x[0]/255,o=x[1]/255,l=x[2]/255,C=Math.max(V,o,l),U=C-Math.min(V,o,l),L=function(x){return(C-x)/6/U+.5};return 0===U?(Z=0,n=0):(n=U/C,O=L(V),Q=L(o),X=L(l),V===C?Z=X-Q:o===C?Z=1/3+O-X:l===C&&(Z=2/3+Q-O),Z<0?Z+=1:Z>1&&(Z-=1)),[360*Z,100*n,100*C]},n.rgb.hwb=function(x){const O=x[0],Q=x[1];let X=x[2];const Z=n.rgb.hsl(x)[0],V=1/255*Math.min(O,Math.min(Q,X));return X=1-1/255*Math.max(O,Math.max(Q,X)),[Z,100*V,100*X]},n.rgb.cmyk=function(x){const O=x[0]/255,Q=x[1]/255,X=x[2]/255,Z=Math.min(1-O,1-Q,1-X);return[100*((1-O-Z)/(1-Z)||0),100*((1-Q-Z)/(1-Z)||0),100*((1-X-Z)/(1-Z)||0),100*Z]},n.rgb.keyword=function(x){const O=Z[x];if(O)return O;let Q,n=1/0;for(const Z of Object.keys(X)){const O=X[Z],l=(o=O,((V=x)[0]-o[0])**2+(V[1]-o[1])**2+(V[2]-o[2])**2);l<n&&(n=l,Q=Z)}var V,o;return Q},n.keyword.rgb=function(x){return X[x]},n.rgb.xyz=function(x){let O=x[0]/255,Q=x[1]/255,X=x[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92,X=X>.04045?((X+.055)/1.055)**2.4:X/12.92;return[100*(.4124*O+.3576*Q+.1805*X),100*(.2126*O+.7152*Q+.0722*X),100*(.0193*O+.1192*Q+.9505*X)]},n.rgb.lab=function(x){const O=n.rgb.xyz(x);let Q=O[0],X=O[1],Z=O[2];Q/=95.047,X/=100,Z/=108.883,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,X=X>.008856?X**(1/3):7.787*X+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116;return[116*X-16,500*(Q-X),200*(X-Z)]},n.hsl.rgb=function(x){const O=x[0]/360,Q=x[1]/100,X=x[2]/100;let Z,n,V;if(0===Q)return V=255*X,[V,V,V];Z=X<.5?X*(1+Q):X+Q-X*Q;const o=2*X-Z,l=[0,0,0];for(let C=0;C<3;C++)n=O+1/3*-(C-1),n<0&&n++,n>1&&n--,V=6*n<1?o+6*(Z-o)*n:2*n<1?Z:3*n<2?o+(Z-o)*(2/3-n)*6:o,l[C]=255*V;return l},n.hsl.hsv=function(x){const O=x[0];let Q=x[1]/100,X=x[2]/100,Z=Q;const n=Math.max(X,.01);X*=2,Q*=X<=1?X:2-X,Z*=n<=1?n:2-n;return[O,100*(0===X?2*Z/(n+Z):2*Q/(X+Q)),100*((X+Q)/2)]},n.hsv.rgb=function(x){const O=x[0]/60,Q=x[1]/100;let X=x[2]/100;const Z=Math.floor(O)%6,n=O-Math.floor(O),V=255*X*(1-Q),o=255*X*(1-Q*n),l=255*X*(1-Q*(1-n));switch(X*=255,Z){case 0:return[X,l,V];case 1:return[o,X,V];case 2:return[V,X,l];case 3:return[V,o,X];case 4:return[l,V,X];case 5:return[X,V,o]}},n.hsv.hsl=function(x){const O=x[0],Q=x[1]/100,X=x[2]/100,Z=Math.max(X,.01);let n,V;V=(2-Q)*X;const o=(2-Q)*Z;return n=Q*Z,n/=o<=1?o:2-o,n=n||0,V/=2,[O,100*n,100*V]},n.hwb.rgb=function(x){const O=x[0]/360;let Q=x[1]/100,X=x[2]/100;const Z=Q+X;let n;Z>1&&(Q/=Z,X/=Z);const V=Math.floor(6*O),o=1-X;n=6*O-V,0!==(1&V)&&(n=1-n);const l=Q+n*(o-Q);let C,U,L;switch(V){default:case 6:case 0:C=o,U=l,L=Q;break;case 1:C=l,U=o,L=Q;break;case 2:C=Q,U=o,L=l;break;case 3:C=Q,U=l,L=o;break;case 4:C=l,U=Q,L=o;break;case 5:C=o,U=Q,L=l}return[255*C,255*U,255*L]},n.cmyk.rgb=function(x){const O=x[0]/100,Q=x[1]/100,X=x[2]/100,Z=x[3]/100;return[255*(1-Math.min(1,O*(1-Z)+Z)),255*(1-Math.min(1,Q*(1-Z)+Z)),255*(1-Math.min(1,X*(1-Z)+Z))]},n.xyz.rgb=function(x){const O=x[0]/100,Q=x[1]/100,X=x[2]/100;let Z,n,V;return Z=3.2406*O+-1.5372*Q+-.4986*X,n=-.9689*O+1.8758*Q+.0415*X,V=.0557*O+-.204*Q+1.057*X,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,V=V>.0031308?1.055*V**(1/2.4)-.055:12.92*V,Z=Math.min(Math.max(0,Z),1),n=Math.min(Math.max(0,n),1),V=Math.min(Math.max(0,V),1),[255*Z,255*n,255*V]},n.xyz.lab=function(x){let O=x[0],Q=x[1],X=x[2];O/=95.047,Q/=100,X/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*Q-16,500*(O-Q),200*(Q-X)]},n.lab.xyz=function(x){let O,Q,X;Q=(x[0]+16)/116,O=x[1]/500+Q,X=Q-x[2]/200;const Z=Q**3,n=O**3,V=X**3;return Q=Z>.008856?Z:(Q-16/116)/7.787,O=n>.008856?n:(O-16/116)/7.787,X=V>.008856?V:(X-16/116)/7.787,O*=95.047,Q*=100,X*=108.883,[O,Q,X]},n.lab.lch=function(x){const O=x[0],Q=x[1],X=x[2];let Z;Z=360*Math.atan2(X,Q)/2/Math.PI,Z<0&&(Z+=360);return[O,Math.sqrt(Q*Q+X*X),Z]},n.lch.lab=function(x){const O=x[0],Q=x[1],X=x[2]/360*2*Math.PI;return[O,Q*Math.cos(X),Q*Math.sin(X)]},n.rgb.ansi16=function(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Q,X,Z]=x;let V=null===O?n.rgb.hsv(x)[2]:O;if(V=Math.round(V/50),0===V)return 30;let o=30+(Math.round(Z/255)<<2|Math.round(X/255)<<1|Math.round(Q/255));return 2===V&&(o+=60),o},n.hsv.ansi16=function(x){return n.rgb.ansi16(n.hsv.rgb(x),x[2])},n.rgb.ansi256=function(x){const O=x[0],Q=x[1],X=x[2];if(O===Q&&Q===X)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(Q/255*5)+Math.round(X/255*5)},n.ansi16.rgb=function(x){let O=x%10;if(0===O||7===O)return x>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const Q=.5*(1+~~(x>50));return[(1&O)*Q*255,(O>>1&1)*Q*255,(O>>2&1)*Q*255]},n.ansi256.rgb=function(x){if(x>=232){const O=10*(x-232)+8;return[O,O,O]}let O;x-=16;return[Math.floor(x/36)/5*255,Math.floor((O=x%36)/6)/5*255,O%6/5*255]},n.rgb.hex=function(x){const O=(((255&Math.round(x[0]))<<16)+((255&Math.round(x[1]))<<8)+(255&Math.round(x[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},n.hex.rgb=function(x){const O=x.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let Q=O[0];3===O[0].length&&(Q=Q.split("").map((x=>x+x)).join(""));const X=parseInt(Q,16);return[X>>16&255,X>>8&255,255&X]},n.rgb.hcg=function(x){const O=x[0]/255,Q=x[1]/255,X=x[2]/255,Z=Math.max(Math.max(O,Q),X),n=Math.min(Math.min(O,Q),X),V=Z-n;let o,l;return o=V<1?n/(1-V):0,l=V<=0?0:Z===O?(Q-X)/V%6:Z===Q?2+(X-O)/V:4+(O-Q)/V,l/=6,l%=1,[360*l,100*V,100*o]},n.hsl.hcg=function(x){const O=x[1]/100,Q=x[2]/100,X=Q<.5?2*O*Q:2*O*(1-Q);let Z=0;return X<1&&(Z=(Q-.5*X)/(1-X)),[x[0],100*X,100*Z]},n.hsv.hcg=function(x){const O=x[1]/100,Q=x[2]/100,X=O*Q;let Z=0;return X<1&&(Z=(Q-X)/(1-X)),[x[0],100*X,100*Z]},n.hcg.rgb=function(x){const O=x[0]/360,Q=x[1]/100,X=x[2]/100;if(0===Q)return[255*X,255*X,255*X];const Z=[0,0,0],n=O%1*6,V=n%1,o=1-V;let l=0;switch(Math.floor(n)){case 0:Z[0]=1,Z[1]=V,Z[2]=0;break;case 1:Z[0]=o,Z[1]=1,Z[2]=0;break;case 2:Z[0]=0,Z[1]=1,Z[2]=V;break;case 3:Z[0]=0,Z[1]=o,Z[2]=1;break;case 4:Z[0]=V,Z[1]=0,Z[2]=1;break;default:Z[0]=1,Z[1]=0,Z[2]=o}return l=(1-Q)*X,[255*(Q*Z[0]+l),255*(Q*Z[1]+l),255*(Q*Z[2]+l)]},n.hcg.hsv=function(x){const O=x[1]/100,Q=O+x[2]/100*(1-O);let X=0;return Q>0&&(X=O/Q),[x[0],100*X,100*Q]},n.hcg.hsl=function(x){const O=x[1]/100,Q=x[2]/100*(1-O)+.5*O;let X=0;return Q>0&&Q<.5?X=O/(2*Q):Q>=.5&&Q<1&&(X=O/(2*(1-Q))),[x[0],100*X,100*Q]},n.hcg.hwb=function(x){const O=x[1]/100,Q=O+x[2]/100*(1-O);return[x[0],100*(Q-O),100*(1-Q)]},n.hwb.hcg=function(x){const O=x[1]/100,Q=1-x[2]/100,X=Q-O;let Z=0;return X<1&&(Z=(Q-X)/(1-X)),[x[0],100*X,100*Z]},n.apple.rgb=function(x){return[x[0]/65535*255,x[1]/65535*255,x[2]/65535*255]},n.rgb.apple=function(x){return[x[0]/255*65535,x[1]/255*65535,x[2]/255*65535]},n.gray.rgb=function(x){return[x[0]/100*255,x[0]/100*255,x[0]/100*255]},n.gray.hsl=function(x){return[0,0,x[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(x){return[0,100,x[0]]},n.gray.cmyk=function(x){return[0,0,0,x[0]]},n.gray.lab=function(x){return[x[0],0,0]},n.gray.hex=function(x){const O=255&Math.round(x[0]/100*255),Q=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(Q.length)+Q},n.rgb.gray=function(x){return[(x[0]+x[1]+x[2])/3/255*100]}},13143:(x,O,Q)=>{const X=Q(13148),Z=Q(13161),n={};Object.keys(X).forEach((x=>{n[x]={},Object.defineProperty(n[x],"channels",{value:X[x].channels}),Object.defineProperty(n[x],"labels",{value:X[x].labels});const O=Z(x);Object.keys(O).forEach((Q=>{const X=O[Q];n[x][Q]=function(x){const O=function(){for(var O=arguments.length,Q=new Array(O),X=0;X<O;X++)Q[X]=arguments[X];const Z=Q[0];if(void 0===Z||null===Z)return Z;Z.length>1&&(Q=Z);const n=x(Q);if("object"===typeof n)for(let x=n.length,V=0;V<x;V++)n[V]=Math.round(n[V]);return n};return"conversion"in x&&(O.conversion=x.conversion),O}(X),n[x][Q].raw=function(x){const O=function(){for(var O=arguments.length,Q=new Array(O),X=0;X<O;X++)Q[X]=arguments[X];const Z=Q[0];return void 0===Z||null===Z?Z:(Z.length>1&&(Q=Z),x(Q))};return"conversion"in x&&(O.conversion=x.conversion),O}(X)}))})),x.exports=n},13161:(x,O,Q)=>{const X=Q(13148);function Z(x){const O=function(){const x={},O=Object.keys(X);for(let Q=O.length,X=0;X<Q;X++)x[O[X]]={distance:-1,parent:null};return x}(),Q=[x];for(O[x].distance=0;Q.length;){const x=Q.pop(),Z=Object.keys(X[x]);for(let X=Z.length,n=0;n<X;n++){const X=Z[n],V=O[X];-1===V.distance&&(V.distance=O[x].distance+1,V.parent=x,Q.unshift(X))}}return O}function n(x,O){return function(Q){return O(x(Q))}}function V(x,O){const Q=[O[x].parent,x];let Z=X[O[x].parent][x],V=O[x].parent;for(;O[V].parent;)Q.unshift(O[V].parent),Z=n(X[O[V].parent][V],Z),V=O[V].parent;return Z.conversion=Q,Z}x.exports=function(x){const O=Z(x),Q={},X=Object.keys(O);for(let Z=X.length,n=0;n<Z;n++){const x=X[n];null!==O[x].parent&&(Q[x]=V(x,O))}return Q}},13153:x=>{"use strict";x.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11700:function(x,O,Q){"use strict";var X=this&&this.__createBinding||(Object.create?function(x,O,Q,X){void 0===X&&(X=Q);var Z=Object.getOwnPropertyDescriptor(O,Q);Z&&!("get"in Z?!O.__esModule:Z.writable||Z.configurable)||(Z={enumerable:!0,get:function(){return O[Q]}}),Object.defineProperty(x,X,Z)}:function(x,O,Q,X){void 0===X&&(X=Q),x[X]=O[Q]}),Z=this&&this.__setModuleDefault||(Object.create?function(x,O){Object.defineProperty(x,"default",{enumerable:!0,value:O})}:function(x,O){x.default=O}),n=this&&this.__importStar||function(x){if(x&&x.__esModule)return x;var O={};if(null!=x)for(var Q in x)"default"!==Q&&Object.prototype.hasOwnProperty.call(x,Q)&&X(O,x,Q);return Z(O,x),O},V=this&&this.__awaiter||function(x,O,Q,X){return new(Q||(Q=Promise))((function(Z,n){function V(x){try{l(X.next(x))}catch(O){n(O)}}function o(x){try{l(X.throw(x))}catch(O){n(O)}}function l(x){var O;x.done?Z(x.value):(O=x.value,O instanceof Q?O:new Q((function(x){x(O)}))).then(V,o)}l((X=X.apply(x,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=O.Platform=void 0;const o=n(Q(11649)),l=Q(11706),C="colyseus-auth-token";!function(x){x.ios="ios",x.android="android"}(O.Platform||(O.Platform={}));O.Auth=class{constructor(x){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=x.replace("ws","http"),(0,l.getItem)(C,(x=>this.token=x))}get hasToken(){return!!this.token}login(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return V(this,void 0,void 0,(function*(){const O=Object.assign({},x);this.hasToken&&(O.token=this.token);const Q=yield this.request("post","/auth",O);this.token=Q.token,(0,l.setItem)(C,this.token);for(let x in Q)this.hasOwnProperty(x)&&(this[x]=Q[x]);return this.registerPingService(),this}))}save(){return V(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return V(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return V(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return V(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(x){return V(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:x})}))}acceptFriendRequest(x){return V(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:x})}))}declineFriendRequest(x){return V(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:x})}))}blockUser(x){return V(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:x})}))}unblockUser(x){return V(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:x})}))}request(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return V(this,void 0,void 0,(function*(){Z.Accept="application/json",this.hasToken&&(Z.Authorization="Bearer "+this.token);const n=[];for(const x in Q)n.push(`${x}=${Q[x]}`);const V=n.length>0?`?${n.join("&")}`:"",l={headers:Z};return X&&(l.body=X),(yield o[x](`${this.endpoint}${O}${V}`,l)).data}))}logout(){this.token=void 0,(0,l.removeItem)(C),this.unregisterPingService()}registerPingService(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),x)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11645:function(x,O,Q){"use strict";var X,Z=this&&this.__awaiter||function(x,O,Q,X){return new(Q||(Q=Promise))((function(Z,n){function V(x){try{l(X.next(x))}catch(O){n(O)}}function o(x){try{l(X.throw(x))}catch(O){n(O)}}function l(x){var O;x.done?Z(x.value):(O=x.value,O instanceof Q?O:new Q((function(x){x(O)}))).then(V,o)}l((X=X.apply(x,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const n=Q(11649),V=Q(11651),o=Q(11655);class l extends Error{constructor(x,O){super(x),this.code=O,Object.setPrototypeOf(this,l.prototype)}}O.MatchMakeError=l;const C="undefined"!==typeof window&&"undefined"!==typeof(null===(X=null===window||void 0===window?void 0:window.location)||void 0===X?void 0:X.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;if("string"===typeof x){const O=new URL(x),Q="https:"===O.protocol||"wss:"===O.protocol,X=Number(O.port||(Q?443:80));this.settings={hostname:O.hostname,pathname:"/"!==O.pathname?O.pathname:"",port:X,secure:Q}}else void 0===x.port&&(x.port=x.secure?443:80),void 0===x.pathname&&(x.pathname=""),this.settings=x}joinOrCreate(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",x,O,Q)}))}create(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",x,O,Q)}))}join(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",x,O,Q)}))}joinById(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",x,O,Q)}))}reconnect(x,O){return Z(this,void 0,void 0,(function*(){if("string"===typeof x&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Q,X]=x.split(":");return yield this.createMatchMakeRequest("reconnect",Q,{reconnectionToken:X},O)}))}getAvailableRooms(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Z(this,void 0,void 0,(function*(){return(yield(0,n.get)(this.getHttpEndpoint(`${x}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(x,O,Q){return Z(this,void 0,void 0,(function*(){const X=this.createRoom(x.room.name,O);X.roomId=x.room.roomId,X.sessionId=x.sessionId;const n={sessionId:X.sessionId};x.reconnectionToken&&(n.reconnectionToken=x.reconnectionToken);const o=Q||X;return X.connect(this.buildEndpoint(x.room,n),x.devMode&&(()=>Z(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${X.roomId}'...`);let Q=0;const n=()=>Z(this,void 0,void 0,(function*(){Q++;try{yield this.consumeSeatReservation(x,O,o),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${X.roomId}'`)}catch(Z){Q<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Q} out of 8)`),setTimeout(n,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(n,2e3)}))),o),new Promise(((x,O)=>{const Q=(x,Q)=>O(new V.ServerError(x,Q));o.onError.once(Q),o.onJoin.once((()=>{o.onError.remove(Q),x(o)}))}))}))}createMatchMakeRequest(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;return Z(this,void 0,void 0,(function*(){const Z=(yield(0,n.post)(this.getHttpEndpoint(`${x}/${O}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Q)})).data;if(Z.error)throw new l(Z.error,Z.code);return"reconnect"===x&&(Z.reconnectionToken=Q.reconnectionToken),yield this.consumeSeatReservation(Z,X,V)}))}createRoom(x,O){return new o.Room(x,O)}buildEndpoint(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=[];for(const Z in O)O.hasOwnProperty(Z)&&Q.push(`${Z}=${O[Z]}`);let X=this.settings.secure?"wss://":"ws://";return x.publicAddress?X+=`${x.publicAddress}`:X+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${X}/${x.processId}/${x.roomId}?${Q.join("&")}`}getHttpEndpoint(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${x}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11661:(x,O,Q)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const X=Q(11670);O.Connection=class{constructor(){this.events={},this.transport=new X.WebSocketTransport(this.events)}send(x){this.transport.send(x)}connect(x){this.transport.connect(x)}close(x,O){this.transport.close(x,O)}get isOpen(){return this.transport.isOpen}}},11677:(x,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(x){x[x.HANDSHAKE=9]="HANDSHAKE",x[x.JOIN_ROOM=10]="JOIN_ROOM",x[x.ERROR=11]="ERROR",x[x.LEAVE_ROOM=12]="LEAVE_ROOM",x[x.ROOM_DATA=13]="ROOM_DATA",x[x.ROOM_STATE=14]="ROOM_STATE",x[x.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",x[x.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",x[x.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(x){x[x.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",x[x.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",x[x.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",x[x.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",x[x.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",x[x.AUTH_FAILED=4215]="AUTH_FAILED",x[x.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(x,O){const Q=x[O++];for(var X="",Z=0,n=O,V=O+Q;n<V;n++){var o=x[n];if(0!==(128&o))if(192!==(224&o))if(224!==(240&o)){if(240!==(248&o))throw new Error("Invalid byte "+o.toString(16));(Z=(7&o)<<18|(63&x[++n])<<12|(63&x[++n])<<6|63&x[++n])>=65536?(Z-=65536,X+=String.fromCharCode(55296+(Z>>>10),56320+(1023&Z))):X+=String.fromCharCode(Z)}else X+=String.fromCharCode((15&o)<<12|(63&x[++n])<<6|63&x[++n]);else X+=String.fromCharCode((31&o)<<6|63&x[++n]);else X+=String.fromCharCode(o)}return X},O.utf8Length=function(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,Q=0;for(let X=0,Z=x.length;X<Z;X++)O=x.charCodeAt(X),O<128?Q+=1:O<2048?Q+=2:O<55296||O>=57344?Q+=3:(X++,Q+=4);return Q+1}},11655:function(x,O,Q){"use strict";var X=this&&this.__createBinding||(Object.create?function(x,O,Q,X){void 0===X&&(X=Q);var Z=Object.getOwnPropertyDescriptor(O,Q);Z&&!("get"in Z?!O.__esModule:Z.writable||Z.configurable)||(Z={enumerable:!0,get:function(){return O[Q]}}),Object.defineProperty(x,X,Z)}:function(x,O,Q,X){void 0===X&&(X=Q),x[X]=O[Q]}),Z=this&&this.__setModuleDefault||(Object.create?function(x,O){Object.defineProperty(x,"default",{enumerable:!0,value:O})}:function(x,O){x.default=O}),n=this&&this.__importStar||function(x){if(x&&x.__esModule)return x;var O={};if(null!=x)for(var Q in x)"default"!==Q&&Object.prototype.hasOwnProperty.call(x,Q)&&X(O,x,Q);return Z(O,x),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const V=n(Q(11657)),o=Q(11661),l=Q(11677),C=Q(11686),U=Q(11690),L=Q(11696),h=Q(11698),N=Q(11651);class a{constructor(x,O){this.onStateChange=(0,L.createSignal)(),this.onError=(0,L.createSignal)(),this.onLeave=(0,L.createSignal)(),this.onJoin=(0,L.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,U.createNanoEvents)(),this.roomId=null,this.name=x,O&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((x,O)=>{var Q;return null===(Q=console.warn)||void 0===Q?void 0:Q.call(console,`colyseus.js - onError => (${x}) ${O}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const X=new o.Connection;Q.connection=X,X.events.onmessage=a.prototype.onMessageCallback.bind(Q),X.events.onclose=function(x){var X;if(!Q.hasJoined)return null===(X=console.warn)||void 0===X||X.call(console,`Room connection was closed unexpectedly (${x.code}): ${x.reason}`),void Q.onError.invoke(x.code,x.reason);x.code===N.CloseCode.DEVMODE_RESTART&&O?O():(Q.onLeave.invoke(x.code),Q.destroy())},X.events.onerror=function(x){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${x.code}): ${x.reason}`),Q.onError.invoke(x.code,x.reason)},X.connect(x)}leave(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((x=>O(x))),this.connection?x?this.connection.send([l.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(N.CloseCode.CONSENTED)}))}onMessage(x,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(x),O)}send(x,O){const Q=[l.Protocol.ROOM_DATA];let X;if("string"===typeof x?h.encode.string(Q,x):h.encode.number(Q,x),void 0!==O){const x=V.encode(O);X=new Uint8Array(Q.length+x.byteLength),X.set(new Uint8Array(Q),0),X.set(new Uint8Array(x),Q.length)}else X=new Uint8Array(Q);this.connection.send(X.buffer)}sendBytes(x,O){const Q=[l.Protocol.ROOM_DATA_BYTES];let X;"string"===typeof x?h.encode.string(Q,x):h.encode.number(Q,x),X=new Uint8Array(Q.length+(O.byteLength||O.length)),X.set(new Uint8Array(Q),0),X.set(new Uint8Array(O),Q.length),this.connection.send(X.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(x){const O=Array.from(new Uint8Array(x.data)),Q=O[0];if(Q===l.Protocol.JOIN_ROOM){let x=1;const Q=(0,l.utf8Read)(O,x);if(x+=(0,l.utf8Length)(Q),this.serializerId=(0,l.utf8Read)(O,x),x+=(0,l.utf8Length)(this.serializerId),!this.serializer){const x=(0,C.getSerializer)(this.serializerId);this.serializer=new x}O.length>x&&this.serializer.handshake&&this.serializer.handshake(O,{offset:x}),this.reconnectionToken=`${this.roomId}:${Q}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([l.Protocol.JOIN_ROOM])}else if(Q===l.Protocol.ERROR){const x={offset:1},Q=h.decode.number(O,x),X=h.decode.string(O,x);this.onError.invoke(Q,X)}else if(Q===l.Protocol.LEAVE_ROOM)this.leave();else if(Q===l.Protocol.ROOM_DATA_SCHEMA){const x={offset:1},Q=this.serializer.getState().constructor._context.get(h.decode.number(O,x)),X=new Q;X.decode(O,x),this.dispatchMessage(Q,X)}else if(Q===l.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(Q===l.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(Q===l.Protocol.ROOM_DATA){const Q={offset:1},X=h.decode.stringCheck(O,Q)?h.decode.string(O,Q):h.decode.number(O,Q),Z=O.length>Q.offset?V.decode(x.data,Q.offset):void 0;this.dispatchMessage(X,Z)}else if(Q===l.Protocol.ROOM_DATA_BYTES){const x={offset:1},Q=h.decode.stringCheck(O,x)?h.decode.string(O,x):h.decode.number(O,x);this.dispatchMessage(Q,new Uint8Array(O.slice(x.offset)))}}setState(x){this.serializer.setState(x),this.onStateChange.invoke(this.serializer.getState())}patch(x){this.serializer.patch(x),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(x,O){var Q;const X=this.getMessageHandlerKey(x);this.onMessageHandlers.events[X]?this.onMessageHandlers.emit(X,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",x,O):null===(Q=console.warn)||void 0===Q||Q.call(console,`colyseus.js: onMessage() not registered for type '${x}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(x){switch(typeof x){case"function":return`$${x._typeid}`;case"string":return x;case"number":return`i${x}`;default:throw new Error("invalid message type.")}}}O.Room=a},11706:(x,O)=>{"use strict";let Q;function X(){return Q||(Q="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(x,O){this.cache[x]=O},getItem:function(x){this.cache[x]},removeItem:function(x){delete this.cache[x]}}),Q}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(x,O){X().setItem(x,O)},O.removeItem=function(x){X().removeItem(x)},O.getItem=function(x,O){const Q=X().getItem(x);"undefined"!==typeof Promise&&Q instanceof Promise?Q.then((x=>O(x))):O(Q)}},11690:(x,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(x){let O=this.events[x]||[];for(var Q=arguments.length,X=new Array(Q>1?Q-1:0),Z=1;Z<Q;Z++)X[Z-1]=arguments[Z];for(let n=0,V=O.length;n<V;n++)O[n](...X)},events:{},on(x,O){var Q;return(null===(Q=this.events[x])||void 0===Q?void 0:Q.push(O))||(this.events[x]=[O]),()=>{var Q;this.events[x]=null===(Q=this.events[x])||void 0===Q?void 0:Q.filter((x=>O!==x))}}})},11696:(x,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class Q{constructor(){this.handlers=[]}register(x){return this.handlers.push(x),this}invoke(){for(var x=arguments.length,O=new Array(x),Q=0;Q<x;Q++)O[Q]=arguments[Q];this.handlers.forEach((x=>x.apply(this,O)))}invokeAsync(){for(var x=arguments.length,O=new Array(x),Q=0;Q<x;Q++)O[Q]=arguments[Q];return Promise.all(this.handlers.map((x=>x.apply(this,O))))}remove(x){const O=this.handlers.indexOf(x);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=Q,O.createSignal=function(){const x=new Q;function O(O){return x.register(O,null===this)}return O.once=O=>{const Q=function(){for(var X=arguments.length,Z=new Array(X),n=0;n<X;n++)Z[n]=arguments[n];O.apply(this,Z),x.remove(Q)};x.register(Q)},O.remove=O=>x.remove(O),O.invoke=function(){return x.invoke(...arguments)},O.invokeAsync=function(){return x.invokeAsync(...arguments)},O.clear=()=>x.clear(),O}},11651:(x,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(x){x[x.CONSENTED=4e3]="CONSENTED",x[x.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class Q extends Error{constructor(x,O){super(O),this.name="ServerError",this.code=x}}O.ServerError=Q},11633:(x,O,Q)=>{"use strict";O.b=void 0,Q(11641);var X=Q(11645);Object.defineProperty(O,"b",{enumerable:!0,get:function(){return X.Client}});var Z=Q(11677);var n=Q(11655);var V=Q(11700);const o=Q(11709);const l=Q(11716),C=Q(11686);(0,C.registerSerializer)("schema",o.SchemaSerializer),(0,C.registerSerializer)("none",l.NoneSerializer)},11641:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=x=>null!==x&&"object"===typeof x&&x.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11657:(x,O)=>{"use strict";function Q(x,O){if(this._offset=O,x instanceof ArrayBuffer)this._buffer=x,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(x))throw new Error("Invalid argument");this._buffer=x.buffer,this._view=new DataView(this._buffer,x.byteOffset,x.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,Q.prototype._array=function(x){for(var O=new Array(x),Q=0;Q<x;Q++)O[Q]=this._parse();return O},Q.prototype._map=function(x){for(var O={},Q=0;Q<x;Q++)O[this._parse()]=this._parse();return O},Q.prototype._str=function(x){var O=function(x,O,Q){for(var X="",Z=0,n=O,V=O+Q;n<V;n++){var o=x.getUint8(n);if(0!==(128&o))if(192!==(224&o))if(224!==(240&o)){if(240!==(248&o))throw new Error("Invalid byte "+o.toString(16));(Z=(7&o)<<18|(63&x.getUint8(++n))<<12|(63&x.getUint8(++n))<<6|63&x.getUint8(++n))>=65536?(Z-=65536,X+=String.fromCharCode(55296+(Z>>>10),56320+(1023&Z))):X+=String.fromCharCode(Z)}else X+=String.fromCharCode((15&o)<<12|(63&x.getUint8(++n))<<6|63&x.getUint8(++n));else X+=String.fromCharCode((31&o)<<6|63&x.getUint8(++n));else X+=String.fromCharCode(o)}return X}(this._view,this._offset,x);return this._offset+=x,O},Q.prototype._bin=function(x){var O=this._buffer.slice(this._offset,this._offset+x);return this._offset+=x,O},Q.prototype._parse=function(){var x,O=this._view.getUint8(this._offset++),Q=0,X=0,Z=0,n=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Q=this._view.getUint8(this._offset),this._offset+=1,this._bin(Q);case 197:return Q=this._view.getUint16(this._offset),this._offset+=2,this._bin(Q);case 198:return Q=this._view.getUint32(this._offset),this._offset+=4,this._bin(Q);case 199:if(Q=this._view.getUint8(this._offset),X=this._view.getInt8(this._offset+1),this._offset+=2,-1===X){var V=this._view.getUint32(this._offset);return Z=this._view.getInt32(this._offset+4),n=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*Z+n)+V/1e6)}return[X,this._bin(Q)];case 200:return Q=this._view.getUint16(this._offset),X=this._view.getInt8(this._offset+2),this._offset+=3,[X,this._bin(Q)];case 201:return Q=this._view.getUint32(this._offset),X=this._view.getInt8(this._offset+4),this._offset+=5,[X,this._bin(Q)];case 202:return x=this._view.getFloat32(this._offset),this._offset+=4,x;case 203:return x=this._view.getFloat64(this._offset),this._offset+=8,x;case 204:return x=this._view.getUint8(this._offset),this._offset+=1,x;case 205:return x=this._view.getUint16(this._offset),this._offset+=2,x;case 206:return x=this._view.getUint32(this._offset),this._offset+=4,x;case 207:return Z=this._view.getUint32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,Z+n;case 208:return x=this._view.getInt8(this._offset),this._offset+=1,x;case 209:return x=this._view.getInt16(this._offset),this._offset+=2,x;case 210:return x=this._view.getInt32(this._offset),this._offset+=4,x;case 211:return Z=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,Z+n;case 212:return X=this._view.getInt8(this._offset),this._offset+=1,0===X?void(this._offset+=1):[X,this._bin(1)];case 213:return X=this._view.getInt8(this._offset),this._offset+=1,[X,this._bin(2)];case 214:return X=this._view.getInt8(this._offset),this._offset+=1,-1===X?(x=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*x)):[X,this._bin(4)];case 215:return X=this._view.getInt8(this._offset),this._offset+=1,0===X?(Z=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(Z+n)):-1===X?(Z=this._view.getUint32(this._offset),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&Z)+n)+(Z>>>2)/1e6)):[X,this._bin(8)];case 216:return X=this._view.getInt8(this._offset),this._offset+=1,[X,this._bin(16)];case 217:return Q=this._view.getUint8(this._offset),this._offset+=1,this._str(Q);case 218:return Q=this._view.getUint16(this._offset),this._offset+=2,this._str(Q);case 219:return Q=this._view.getUint32(this._offset),this._offset+=4,this._str(Q);case 220:return Q=this._view.getUint16(this._offset),this._offset+=2,this._array(Q);case 221:return Q=this._view.getUint32(this._offset),this._offset+=4,this._array(Q);case 222:return Q=this._view.getUint16(this._offset),this._offset+=2,this._map(Q);case 223:return Q=this._view.getUint32(this._offset),this._offset+=4,this._map(Q)}throw new Error("Could not parse")},O.decode=function(x){var O=new Q(x,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),X=O._parse();if(O._offset!==x.byteLength)throw new Error(x.byteLength-O._offset+" trailing bytes");return X};function X(x,O,Q){for(var X=0,Z=0,n=Q.length;Z<n;Z++)(X=Q.charCodeAt(Z))<128?x.setUint8(O++,X):X<2048?(x.setUint8(O++,192|X>>6),x.setUint8(O++,128|63&X)):X<55296||X>=57344?(x.setUint8(O++,224|X>>12),x.setUint8(O++,128|X>>6&63),x.setUint8(O++,128|63&X)):(Z++,X=65536+((1023&X)<<10|1023&Q.charCodeAt(Z)),x.setUint8(O++,240|X>>18),x.setUint8(O++,128|X>>12&63),x.setUint8(O++,128|X>>6&63),x.setUint8(O++,128|63&X))}function Z(x,O,Q){var X=typeof Q,n=0,V=0,o=0,l=0,C=0,U=0;if("string"===X){if(C=function(x){for(var O=0,Q=0,X=0,Z=x.length;X<Z;X++)(O=x.charCodeAt(X))<128?Q+=1:O<2048?Q+=2:O<55296||O>=57344?Q+=3:(X++,Q+=4);return Q}(Q),C<32)x.push(160|C),U=1;else if(C<256)x.push(217,C),U=2;else if(C<65536)x.push(218,C>>8,C),U=3;else{if(!(C<4294967296))throw new Error("String too long");x.push(219,C>>24,C>>16,C>>8,C),U=5}return O.push({_str:Q,_length:C,_offset:x.length}),U+C}if("number"===X)return Math.floor(Q)===Q&&isFinite(Q)?Q>=0?Q<128?(x.push(Q),1):Q<256?(x.push(204,Q),2):Q<65536?(x.push(205,Q>>8,Q),3):Q<4294967296?(x.push(206,Q>>24,Q>>16,Q>>8,Q),5):(o=Q/Math.pow(2,32)|0,l=Q>>>0,x.push(207,o>>24,o>>16,o>>8,o,l>>24,l>>16,l>>8,l),9):Q>=-32?(x.push(Q),1):Q>=-128?(x.push(208,Q),2):Q>=-32768?(x.push(209,Q>>8,Q),3):Q>=-2147483648?(x.push(210,Q>>24,Q>>16,Q>>8,Q),5):(o=Math.floor(Q/Math.pow(2,32)),l=Q>>>0,x.push(211,o>>24,o>>16,o>>8,o,l>>24,l>>16,l>>8,l),9):(x.push(203),O.push({_float:Q,_length:8,_offset:x.length}),9);if("object"===X){if(null===Q)return x.push(192),1;if(Array.isArray(Q)){if((C=Q.length)<16)x.push(144|C),U=1;else if(C<65536)x.push(220,C>>8,C),U=3;else{if(!(C<4294967296))throw new Error("Array too large");x.push(221,C>>24,C>>16,C>>8,C),U=5}for(n=0;n<C;n++)U+=Z(x,O,Q[n]);return U}if(Q instanceof Date){var L=Q.getTime(),h=Math.floor(L/1e3),N=1e6*(L-1e3*h);return h>=0&&N>=0&&h<=17179869183?0===N&&h<=4294967295?(x.push(214,255,h>>24,h>>16,h>>8,h),6):(o=h/4294967296,l=4294967295&h,x.push(215,255,N>>22,N>>14,N>>6,o,l>>24,l>>16,l>>8,l),10):(o=Math.floor(h/4294967296),l=h>>>0,x.push(199,12,255,N>>24,N>>16,N>>8,N,o>>24,o>>16,o>>8,o,l>>24,l>>16,l>>8,l),15)}if(Q instanceof ArrayBuffer){if((C=Q.byteLength)<256)x.push(196,C),U=2;else if(C<65536)x.push(197,C>>8,C),U=3;else{if(!(C<4294967296))throw new Error("Buffer too large");x.push(198,C>>24,C>>16,C>>8,C),U=5}return O.push({_bin:Q,_length:C,_offset:x.length}),U+C}if("function"===typeof Q.toJSON)return Z(x,O,Q.toJSON());var a=[],K="",M=Object.keys(Q);for(n=0,V=M.length;n<V;n++)void 0!==Q[K=M[n]]&&"function"!==typeof Q[K]&&a.push(K);if((C=a.length)<16)x.push(128|C),U=1;else if(C<65536)x.push(222,C>>8,C),U=3;else{if(!(C<4294967296))throw new Error("Object too large");x.push(223,C>>24,C>>16,C>>8,C),U=5}for(n=0;n<C;n++)U+=Z(x,O,K=a[n]),U+=Z(x,O,Q[K]);return U}if("boolean"===X)return x.push(Q?195:194),1;if("undefined"===X)return x.push(192),1;if("function"===typeof Q.toJSON)return Z(x,O,Q.toJSON());throw new Error("Could not encode")}O.encode=function(x){var O=[],Q=[],n=Z(O,Q,x),V=new ArrayBuffer(n),o=new DataView(V),l=0,C=0,U=-1;Q.length>0&&(U=Q[0]._offset);for(var L,h=0,N=0,a=0,K=O.length;a<K;a++)if(o.setUint8(C+a,O[a]),a+1===U){if(h=(L=Q[l])._length,N=C+U,L._bin)for(var M=new Uint8Array(L._bin),Y=0;Y<h;Y++)o.setUint8(N+Y,M[Y]);else L._str?X(o,N,L._str):void 0!==L._float&&o.setFloat64(N,L._float);C+=h,Q[++l]&&(U=Q[l]._offset)}return V}},11716:(x,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(x){}getState(){return null}patch(x){}teardown(){}handshake(x){}}},11709:(x,O,Q)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const X=Q(11698);O.SchemaSerializer=class{setState(x){return this.state.decode(x)}getState(){return this.state}patch(x){return this.state.decode(x)}teardown(){var x,O;null===(O=null===(x=this.state)||void 0===x?void 0:x.$changes)||void 0===O||O.root.clearRefs()}handshake(x,O){if(this.state){(new X.Reflection).decode(x,O)}else this.state=X.Reflection.decode(x,O)}}},11686:(x,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const Q={};O.registerSerializer=function(x,O){Q[x]=O},O.getSerializer=function(x){const O=Q[x];if(!O)throw new Error("missing serializer: "+x);return O}},11670:function(x,O,Q){"use strict";var X=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const Z=X(Q(11674)),n=globalThis.WebSocket||Z.default;O.WebSocketTransport=class{constructor(x){this.events=x}send(x){x instanceof ArrayBuffer?this.ws.send(x):Array.isArray(x)&&this.ws.send(new Uint8Array(x).buffer)}connect(x){this.ws=new n(x,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(x,O){this.ws.close(x,O)}get isOpen(){return this.ws.readyState===n.OPEN}}},11674:x=>{"use strict";x.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12072:x=>{"use strict";x.exports=function(x){for(var O=new Array(x),Q=0;Q<x;++Q)O[Q]=Q;return O}},12078:x=>{function O(x){return!!x.constructor&&"function"===typeof x.constructor.isBuffer&&x.constructor.isBuffer(x)}x.exports=function(x){return null!=x&&(O(x)||function(x){return"function"===typeof x.readFloatLE&&"function"===typeof x.slice&&O(x.slice(0,0))}(x)||!!x._isBuffer)}},12064:(x,O,Q)=>{var X=Q(12072),Z=Q(12078),n="undefined"!==typeof Float64Array;function V(x,O){return x[0]-O[0]}function o(){var x,O=this.stride,Q=new Array(O.length);for(x=0;x<Q.length;++x)Q[x]=[Math.abs(O[x]),x];Q.sort(V);var X=new Array(Q.length);for(x=0;x<X.length;++x)X[x]=Q[x][1];return X}function l(x,O){var Q=["View",O,"d",x].join("");O<0&&(Q="View_Nil"+x);var Z="generic"===x;if(-1===O){var n="function "+Q+"(a){this.data=a;};var proto="+Q+".prototype;proto.dtype='"+x+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Q+"(a){return new "+Q+"(a);}";return new Function(n)()}if(0===O){n="function "+Q+"(a,d) {this.data = a;this.offset = d};var proto="+Q+".prototype;proto.dtype='"+x+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Q+"_copy() {return new "+Q+"(this.data,this.offset)};proto.pick=function "+Q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Q+"_get(){return "+(Z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Q+"_set(v){return "+(Z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Q+"(a,b,c,d){return new "+Q+"(a,d)}";return new Function("TrivialArray",n)(C[x][0])}n=["'use strict'"];var V=X(O),l=V.map((function(x){return"i"+x})),U="this.offset+"+V.map((function(x){return"this.stride["+x+"]*i"+x})).join("+"),L=V.map((function(x){return"b"+x})).join(","),h=V.map((function(x){return"c"+x})).join(",");n.push("function "+Q+"(a,"+L+","+h+",d){this.data=a","this.shape=["+L+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+Q+".prototype","proto.dtype='"+x+"'","proto.dimension="+O),n.push("Object.defineProperty(proto,'size',{get:function "+Q+"_size(){return "+V.map((function(x){return"this.shape["+x+"]"})).join("*"),"}})"),1===O?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),O<4?(n.push("function "+Q+"_order(){"),2===O?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+Q+"_set("+l.join(",")+",v){"),Z?n.push("return this.data.set("+U+",v)}"):n.push("return this.data["+U+"]=v}"),n.push("proto.get=function "+Q+"_get("+l.join(",")+"){"),Z?n.push("return this.data.get("+U+")}"):n.push("return this.data["+U+"]}"),n.push("proto.index=function "+Q+"_index(",l.join(),"){return "+U+"}"),n.push("proto.hi=function "+Q+"_hi("+l.join(",")+"){return new "+Q+"(this.data,"+V.map((function(x){return["(typeof i",x,"!=='number'||i",x,"<0)?this.shape[",x,"]:i",x,"|0"].join("")})).join(",")+","+V.map((function(x){return"this.stride["+x+"]"})).join(",")+",this.offset)}");var N=V.map((function(x){return"a"+x+"=this.shape["+x+"]"})),a=V.map((function(x){return"c"+x+"=this.stride["+x+"]"}));n.push("proto.lo=function "+Q+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+a.join(","));for(var K=0;K<O;++K)n.push("if(typeof i"+K+"==='number'&&i"+K+">=0){d=i"+K+"|0;b+=c"+K+"*d;a"+K+"-=d}");n.push("return new "+Q+"(this.data,"+V.map((function(x){return"a"+x})).join(",")+","+V.map((function(x){return"c"+x})).join(",")+",b)}"),n.push("proto.step=function "+Q+"_step("+l.join(",")+"){var "+V.map((function(x){return"a"+x+"=this.shape["+x+"]"})).join(",")+","+V.map((function(x){return"b"+x+"=this.stride["+x+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(K=0;K<O;++K)n.push("if(typeof i"+K+"==='number'){d=i"+K+"|0;if(d<0){c+=b"+K+"*(a"+K+"-1);a"+K+"=ceil(-a"+K+"/d)}else{a"+K+"=ceil(a"+K+"/d)}b"+K+"*=d}");n.push("return new "+Q+"(this.data,"+V.map((function(x){return"a"+x})).join(",")+","+V.map((function(x){return"b"+x})).join(",")+",c)}");var M=new Array(O),Y=new Array(O);for(K=0;K<O;++K)M[K]="a[i"+K+"]",Y[K]="b[i"+K+"]";n.push("proto.transpose=function "+Q+"_transpose("+l+"){"+l.map((function(x,O){return x+"=("+x+"===undefined?"+O+":"+x+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Q+"(this.data,"+M.join(",")+","+Y.join(",")+",this.offset)}"),n.push("proto.pick=function "+Q+"_pick("+l+"){var a=[],b=[],c=this.offset");for(K=0;K<O;++K)n.push("if(typeof i"+K+"==='number'&&i"+K+">=0){c=(c+this.stride["+K+"]*i"+K+")|0}else{a.push(this.shape["+K+"]);b.push(this.stride["+K+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+Q+"(data,shape,stride,offset){return new "+Q+"(data,"+V.map((function(x){return"shape["+x+"]"})).join(",")+","+V.map((function(x){return"stride["+x+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(C[x],o)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};x.exports=function(x,O,Q,X){if(void 0===x)return(0,C.array[0])([]);"number"===typeof x&&(x=[x]),void 0===O&&(O=[x.length]);var V=O.length;if(void 0===Q){Q=new Array(V);for(var o=V-1,U=1;o>=0;--o)Q[o]=U,U*=O[o]}if(void 0===X){X=0;for(o=0;o<V;++o)Q[o]<0&&(X-=(O[o]-1)*Q[o])}for(var L=function(x){if(Z(x))return"buffer";if(n)switch(Object.prototype.toString.call(x)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(x)?"array":"generic"}(x),h=C[L];h.length<=V+1;)h.push(l(L,h.length-1));return(0,h[V+1])(x,O,Q,X)}},13104:x=>{var O;self,O=()=>(()=>{"use strict";var x={d:(O,Q)=>{for(var X in Q)x.o(Q,X)&&!x.o(O,X)&&Object.defineProperty(O,X,{enumerable:!0,get:Q[X]})},o:(x,O)=>Object.prototype.hasOwnProperty.call(x,O)},O={};x.d(O,{default:()=>E});var Q,X=function(x,O){var Q=O.x-x.x,X=O.y-x.y;return Math.sqrt(Q*Q+X*X)},Z=function(x){return x*(Math.PI/180)},n=new Map,V=function(x){n.has(x)&&clearTimeout(n.get(x)),n.set(x,setTimeout(x,100))},o=function(x,O,Q){for(var X,Z=O.split(/[ ,]+/g),n=0;n<Z.length;n+=1)X=Z[n],x.addEventListener?x.addEventListener(X,Q,!1):x.attachEvent&&x.attachEvent(X,Q)},l=function(x,O,Q){for(var X,Z=O.split(/[ ,]+/g),n=0;n<Z.length;n+=1)X=Z[n],x.removeEventListener?x.removeEventListener(X,Q):x.detachEvent&&x.detachEvent(X,Q)},C=function(x){return x.preventDefault(),x.type.match(/^touch/)?x.changedTouches:x},U=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},L=function(x,O){O.top||O.right||O.bottom||O.left?(x.style.top=O.top,x.style.right=O.right,x.style.bottom=O.bottom,x.style.left=O.left):(x.style.left=O.x+"px",x.style.top=O.y+"px")},h=function(x,O,Q){var X=N(x);for(var Z in X)if(X.hasOwnProperty(Z))if("string"==typeof O)X[Z]=O+" "+Q;else{for(var n="",V=0,o=O.length;V<o;V+=1)n+=O[V]+" "+Q+", ";X[Z]=n.slice(0,-2)}return X},N=function(x){var O={};return O[x]="",["webkit","Moz","o"].forEach((function(Q){O[Q+x.charAt(0).toUpperCase()+x.slice(1)]=""})),O},a=function(x,O){for(var Q in O)O.hasOwnProperty(Q)&&(x[Q]=O[Q]);return x},K=function(x,O){if(x.length)for(var Q=0,X=x.length;Q<X;Q+=1)O(x[Q]);else O(x)},M="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Y=window.matchMedia("(any-hover: none)").matches,g=!!("ontouchstart"in window),v=!!window.PointerEvent,R=!!window.MSPointerEvent,s={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},q={start:"mousedown",move:"mousemove",end:"mouseup"},G={};function k(){}M&&!Y?Q=s:v?Q={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:R?Q={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:g?(Q=s,G=q):Q=q,k.prototype.on=function(x,O){var Q,X=this,Z=x.split(/[ ,]+/g);X._handlers_=X._handlers_||{};for(var n=0;n<Z.length;n+=1)Q=Z[n],X._handlers_[Q]=X._handlers_[Q]||[],X._handlers_[Q].push(O);return X},k.prototype.off=function(x,O){var Q=this;return Q._handlers_=Q._handlers_||{},void 0===x?Q._handlers_={}:void 0===O?Q._handlers_[x]=null:Q._handlers_[x]&&Q._handlers_[x].indexOf(O)>=0&&Q._handlers_[x].splice(Q._handlers_[x].indexOf(O),1),Q},k.prototype.trigger=function(x,O){var Q,X=this,Z=x.split(/[ ,]+/g);X._handlers_=X._handlers_||{};for(var n=0;n<Z.length;n+=1)Q=Z[n],X._handlers_[Q]&&X._handlers_[Q].length&&X._handlers_[Q].forEach((function(x){x.call(X,{type:Q,target:X},O)}))},k.prototype.config=function(x){var O=this;O.options=O.defaults||{},x&&(O.options=function(x,O){var Q={};for(var X in x)x.hasOwnProperty(X)&&O.hasOwnProperty(X)?Q[X]=O[X]:x.hasOwnProperty(X)&&(Q[X]=x[X]);return Q}(O.options,x))},k.prototype.bindEvt=function(x,O){var X=this;return X._domHandlers_=X._domHandlers_||{},X._domHandlers_[O]=function(){"function"==typeof X["on"+O]?X["on"+O].apply(X,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},o(x,Q[O],X._domHandlers_[O]),G[O]&&o(x,G[O],X._domHandlers_[O]),X},k.prototype.unbindEvt=function(x,O){var X=this;return X._domHandlers_=X._domHandlers_||{},l(x,Q[O],X._domHandlers_[O]),G[O]&&l(x,G[O],X._domHandlers_[O]),delete X._domHandlers_[O],this};const J=k;function t(x,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=x,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=t.id,t.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}t.prototype=new J,t.constructor=t,t.id=0,t.prototype.buildEl=function(x){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},t.prototype.stylize=function(){if(this.options.dataOnly)return this;var x=this.options.fadeTime+"ms",O=function(){var x=N("borderRadius");for(var O in x)x.hasOwnProperty(O)&&(x[O]="50%");return x}(),Q=h("transition","opacity",x),X={};return X.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},X.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},X.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},a(X.el,Q),"circle"===this.options.shape&&a(X.back,O),a(X.front,O),this.applyStyles(X),this},t.prototype.applyStyles=function(x){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var Q in x[O])this.ui[O].style[Q]=x[O][Q];return this},t.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},t.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},t.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},t.prototype.show=function(x){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof x&&x.call(this)}),O.options.fadeTime)),O},t.prototype.hide=function(x){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var Q="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=Q,"function"==typeof x&&x.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var Q=O.options.restJoystick,X={};X.x=!0===Q||!1!==Q.x?0:O.instance.frontPosition.x,X.y=!0===Q||!1!==Q.y?0:O.instance.frontPosition.y,O.setPosition(x,X)}return O},t.prototype.setPosition=function(x,O){var Q=this;Q.frontPosition={x:O.x,y:O.y};var X=Q.options.fadeTime+"ms",Z={};Z.front=h("transition",["transform"],X);var n={front:{}};n.front={transform:"translate("+Q.frontPosition.x+"px,"+Q.frontPosition.y+"px)"},Q.applyStyles(Z),Q.applyStyles(n),Q.restTimeout=setTimeout((function(){"function"==typeof x&&x.call(Q),Q.restCallback()}),Q.options.fadeTime)},t.prototype.restCallback=function(){var x=this,O={};O.front=h("transition","none",""),x.applyStyles(O),x.trigger("rested",x.instance)},t.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},t.prototype.computeDirection=function(x){var O,Q,X,Z=x.angle.radian,n=Math.PI/4,V=Math.PI/2;if(Z>n&&Z<3*n&&!x.lockX?O="up":Z>-n&&Z<=n&&!x.lockY?O="left":Z>3*-n&&Z<=-n&&!x.lockX?O="down":x.lockY||(O="right"),x.lockY||(Q=Z>-V&&Z<V?"left":"right"),x.lockX||(X=Z>0?"up":"down"),x.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var C={};for(o in this.direction={x:Q,y:X,angle:O},x.direction=this.direction,l)l[o]===this.direction[o]&&(C[o]=!0);if(C.x&&C.y&&C.angle)return x;C.x&&C.y||this.trigger("plain",x),C.x||this.trigger("plain:"+Q,x),C.y||this.trigger("plain:"+X,x),C.angle||this.trigger("dir dir:"+O,x)}else this.resetDirection();return x};const c=t;function d(x,O){var Q=this;Q.nipples=[],Q.idles=[],Q.actives=[],Q.ids=[],Q.pressureIntervals={},Q.manager=x,Q.id=d.id,d.id+=1,Q.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Q.config(O),"static"!==Q.options.mode&&"semi"!==Q.options.mode||(Q.options.multitouch=!1),Q.options.multitouch||(Q.options.maxNumberOfNipples=1);var X=getComputedStyle(Q.options.zone.parentElement);return X&&"flex"===X.display&&(Q.parentIsFlex=!0),Q.updateBox(),Q.prepareNipples(),Q.yL(),Q.begin(),Q.nipples}d.prototype=new J,d.constructor=d,d.id=0,d.prototype.prepareNipples=function(){var x=this,O=x.nipples;O.on=x.on.bind(x),O.off=x.off.bind(x),O.options=x.options,O.destroy=x.destroy.bind(x),O.ids=x.ids,O.id=x.id,O.processOnMove=x.processOnMove.bind(x),O.processOnEnd=x.processOnEnd.bind(x),O.get=function(x){if(void 0===x)return O[0];for(var Q=0,X=O.length;Q<X;Q+=1)if(O[Q].identifier===x)return O[Q];return!1}},d.prototype.yL=function(){var x=this;x.bindEvt(x.options.zone,"start"),x.options.zone.style.touchAction="none",x.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var x=this,O=x.options;if("static"===O.mode){var Q=x.createNipple(O.position,x.manager.getIdentifier());Q.add(),x.idles.push(Q)}},d.prototype.createNipple=function(x,O){var Q=this,X=Q.manager.scroll,Z={},n=Q.options,V=Q.parentIsFlex?X.x:X.x+Q.box.left,o=Q.parentIsFlex?X.y:X.y+Q.box.top;if(x.x&&x.y)Z={x:x.x-V,y:x.y-o};else if(x.top||x.right||x.bottom||x.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=x.top,l.style.right=x.right,l.style.bottom=x.bottom,l.style.left=x.left,l.style.position="absolute",n.zone.appendChild(l);var C=l.getBoundingClientRect();n.zone.removeChild(l),Z=x,x={x:C.left+X.x,y:C.top+X.y}}var U=new c(Q,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:O,position:x,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(L(U.ui.el,Z),L(U.ui.front,U.frontPosition)),Q.nipples.push(U),Q.trigger("added "+U.identifier+":added",U),Q.manager.trigger("added "+U.identifier+":added",U),Q.bindNipple(U),U},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(x){var O,Q=this,X=function(x,X){O=x.type+" "+X.id+":"+x.type,Q.trigger(O,X)};x.on("destroyed",Q.onDestroyed.bind(Q)),x.on("shown hidden rested dir plain",X),x.on("dir:up dir:right dir:down dir:left",X),x.on("plain:up plain:right plain:down plain:left",X)},d.prototype.pressureFn=function(x,O,Q){var X=this,Z=0;clearInterval(X.pressureIntervals[Q]),X.pressureIntervals[Q]=setInterval(function(){var Q=x.force||x.pressure||x.webkitForce||0;Q!==Z&&(O.trigger("pressure",Q),X.trigger("pressure "+O.identifier+":pressure",Q),Z=Q)}.bind(X),100)},d.prototype.onstart=function(x){var O=this,Q=O.options,X=x;return x=C(x),O.updateBox(),K(x,(function(Z){O.actives.length<Q.maxNumberOfNipples?O.processOnStart(Z):X.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(Q){if(Object.values(X.touches).findIndex((function(x){return x.identifier===Q}))<0){var Z=[x[0]];Z.identifier=Q,O.processOnEnd(Z)}})),O.actives.length<Q.maxNumberOfNipples&&O.processOnStart(Z))})),O.manager.bindDocument(),!1},d.prototype.processOnStart=function(x){var O,Q=this,Z=Q.options,n=Q.manager.getIdentifier(x),V=x.force||x.pressure||x.webkitForce||0,o={x:x.pageX,y:x.pageY},l=Q.getOrCreate(n,o);l.identifier!==n&&Q.manager.removeIdentifier(l.identifier),l.identifier=n;var C=function(O){O.trigger("start",O),Q.trigger("start "+O.id+":start",O),O.show(),V>0&&Q.pressureFn(x,O,O.identifier),Q.processOnMove(x)};if((O=Q.idles.indexOf(l))>=0&&Q.idles.splice(O,1),Q.actives.push(l),Q.ids.push(l.identifier),"semi"!==Z.mode)C(l);else{if(!(X(o,l.position)<=Z.catchDistance))return l.destroy(),void Q.processOnStart(x);C(l)}return l},d.prototype.getOrCreate=function(x,O){var Q,X=this,Z=X.options;return/(semi|static)/.test(Z.mode)?(Q=X.idles[0])?(X.idles.splice(0,1),Q):"semi"===Z.mode?X.createNipple(O,x):(console.warn("Coudln't find the needed nipple."),!1):Q=X.createNipple(O,x)},d.prototype.processOnMove=function(x){var O=this,Q=O.options,n=O.manager.getIdentifier(x),V=O.nipples.get(n),o=O.manager.scroll;if(function(x){return isNaN(x.buttons)?0!==x.pressure:0!==x.buttons}(x)){if(!V)return console.error("Found zombie joystick with ID "+n),void O.manager.removeIdentifier(n);if(Q.dynamicPage){var l=V.el.getBoundingClientRect();V.position={x:o.x+l.left,y:o.y+l.top}}V.identifier=n;var C=V.options.size/2,U={x:x.pageX,y:x.pageY};Q.lockX&&(U.y=V.position.y),Q.lockY&&(U.x=V.position.x);var L,h,N,a,K,M,Y,g,v,R,s=X(U,V.position),q=(L=U,N=(h=V.position).x-L.x,a=h.y-L.y,function(x){return x*(180/Math.PI)}(Math.atan2(a,N))),G=Z(q),k=s/C,J={distance:s,position:U};if("circle"===V.options.shape?(K=Math.min(s,C),Y=V.position,g=K,R={x:0,y:0},v=Z(v=q),R.x=Y.x-g*Math.cos(v),R.y=Y.y-g*Math.sin(v),M=R):(M=function(x,O,Q){return{x:Math.min(Math.max(x.x,O.x-Q),O.x+Q),y:Math.min(Math.max(x.y,O.y-Q),O.y+Q)}}(U,V.position,C),K=X(M,V.position)),Q.follow){if(s>C){var t=U.x-M.x,c=U.y-M.y;V.position.x+=t,V.position.y+=c,V.el.style.top=V.position.y-(O.box.top+o.y)+"px",V.el.style.left=V.position.x-(O.box.left+o.x)+"px",s=X(U,V.position)}}else U=M,s=K;var d=U.x-V.position.x,u=U.y-V.position.y;V.frontPosition={x:d,y:u},Q.dataOnly||(V.ui.front.style.transform="translate("+d+"px,"+u+"px)");var A={identifier:V.identifier,position:U,force:k,pressure:x.force||x.pressure||x.webkitForce||0,distance:s,angle:{radian:G,degree:q},vector:{x:d/C,y:-u/C},raw:J,instance:V,lockX:Q.lockX,lockY:Q.lockY};(A=V.computeDirection(A)).angle={radian:Z(180-q),degree:180-q},V.trigger("move",A),O.trigger("move "+V.id+":move",A)}else this.processOnEnd(x)},d.prototype.processOnEnd=function(x){var O=this,Q=O.options,X=O.manager.getIdentifier(x),Z=O.nipples.get(X),n=O.manager.removeIdentifier(Z.identifier);Z&&(Q.dataOnly||Z.hide((function(){"dynamic"===Q.mode&&(Z.trigger("removed",Z),O.trigger("removed "+Z.id+":removed",Z),O.manager.trigger("removed "+Z.id+":removed",Z),Z.destroy())})),clearInterval(O.pressureIntervals[Z.identifier]),Z.resetDirection(),Z.trigger("end",Z),O.trigger("end "+Z.id+":end",Z),O.ids.indexOf(Z.identifier)>=0&&O.ids.splice(O.ids.indexOf(Z.identifier),1),O.actives.indexOf(Z)>=0&&O.actives.splice(O.actives.indexOf(Z),1),/(semi|static)/.test(Q.mode)?O.idles.push(Z):O.nipples.indexOf(Z)>=0&&O.nipples.splice(O.nipples.indexOf(Z),1),O.manager.unbindDocument(),/(semi|static)/.test(Q.mode)&&(O.manager.ids[n.id]=n.identifier))},d.prototype.onDestroyed=function(x,O){var Q=this;Q.nipples.indexOf(O)>=0&&Q.nipples.splice(Q.nipples.indexOf(O),1),Q.actives.indexOf(O)>=0&&Q.actives.splice(Q.actives.indexOf(O),1),Q.idles.indexOf(O)>=0&&Q.idles.splice(Q.idles.indexOf(O),1),Q.ids.indexOf(O.identifier)>=0&&Q.ids.splice(Q.ids.indexOf(O.identifier),1),Q.manager.removeIdentifier(O.identifier),Q.manager.unbindDocument()},d.prototype.destroy=function(){var x=this;for(var O in x.unbindEvt(x.options.zone,"start"),x.nipples.forEach((function(x){x.destroy()})),x.pressureIntervals)x.pressureIntervals.hasOwnProperty(O)&&clearInterval(x.pressureIntervals[O]);x.trigger("destroyed",x.nipples),x.manager.unbindDocument(),x.off()};const u=d;function A(x){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=U(),O.config(x),O.prepareCollections();var Q=function(){var x;O.collections.forEach((function(Q){Q.forEach((function(Q){x=Q.el.getBoundingClientRect(),Q.position={x:O.scroll.x+x.left,y:O.scroll.y+x.top}}))}))};o(window,"resize",(function(){V(Q)}));var X=function(){O.scroll=U()};return o(window,"scroll",(function(){V(X)})),O.collections}A.prototype=new J,A.constructor=A,A.prototype.prepareCollections=function(){var x=this;x.collections.create=x.create.bind(x),x.collections.on=x.on.bind(x),x.collections.off=x.off.bind(x),x.collections.destroy=x.destroy.bind(x),x.collections.get=function(O){var Q;return x.collections.every((function(x){return!(Q=x.get(O))})),Q}},A.prototype.create=function(x){return this.createCollection(x)},A.prototype.createCollection=function(x){var O=this,Q=new u(O,x);return O.bindCollection(Q),O.collections.push(Q),Q},A.prototype.bindCollection=function(x){var O,Q=this,X=function(x,X){O=x.type+" "+X.id+":"+x.type,Q.trigger(O,X)};x.on("destroyed",Q.onDestroyed.bind(Q)),x.on("shown hidden rested dir plain",X),x.on("dir:up dir:right dir:down dir:left",X),x.on("plain:up plain:right plain:down plain:left",X)},A.prototype.bindDocument=function(){var x=this;x.binded||(x.bindEvt(document,"move").bindEvt(document,"end"),x.binded=!0)},A.prototype.unbindDocument=function(x){var O=this;Object.keys(O.ids).length&&!0!==x||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},A.prototype.getIdentifier=function(x){var O;return x?void 0===(O=void 0===x.identifier?x.pointerId:x.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},A.prototype.removeIdentifier=function(x){var O={};for(var Q in this.ids)if(this.ids[Q]===x){O.id=Q,O.identifier=this.ids[Q],delete this.ids[Q];break}return O},A.prototype.onmove=function(x){return this.onAny("move",x),!1},A.prototype.onend=function(x){return this.onAny("end",x),!1},A.prototype.oncancel=function(x){return this.onAny("end",x),!1},A.prototype.onAny=function(x,O){var Q,X=this,Z="processOn"+x.charAt(0).toUpperCase()+x.slice(1);O=C(O);var n=function(x,O,Q){Q.ids.indexOf(O)>=0&&(Q[Z](x),x._found_=!0)};return K(O,(function(x){Q=X.getIdentifier(x),K(X.collections,n.bind(null,x,Q)),x._found_||X.removeIdentifier(Q)})),!1},A.prototype.destroy=function(){var x=this;x.unbindDocument(!0),x.ids={},x.index=0,x.collections.forEach((function(x){x.destroy()})),x.off()},A.prototype.onDestroyed=function(x,O){var Q=this;if(Q.collections.indexOf(O)<0)return!1;Q.collections.splice(Q.collections.indexOf(O),1)};var f=new A;const E={create:function(x){return f.create(x)},factory:f};return O.default})(),x.exports=O()},12092:(x,O,Q)=>{"use strict";const{Deflate:X,deflate:Z,deflateRaw:n,gzip:V}=Q(12094),{Inflate:o,inflate:l,inflateRaw:C,ungzip:U}=Q(12157),L=Q(12130);x.exports.Deflate=X,x.exports.deflate=Z,x.exports.deflateRaw=n,x.exports.gzip=V,x.exports.Inflate=o,x.exports.inflate=l,x.exports.inflateRaw=C,x.exports.ungzip=U,x.exports.constants=L},12094:(x,O,Q)=>{"use strict";const X=Q(12101),Z=Q(12138),n=Q(12142),V=Q(12124),o=Q(12148),l=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:U,Z_FULL_FLUSH:L,Z_FINISH:h,Z_OK:N,Z_STREAM_END:a,Z_DEFAULT_COMPRESSION:K,Z_DEFAULT_STRATEGY:M,Z_DEFLATED:Y}=Q(12130);function g(x){this.options=Z.assign({level:K,method:Y,Tx:16384,windowBits:15,memLevel:8,strategy:M},x||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.aO="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;let Q=X.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(Q!==N)throw new Error(V[Q]);if(O.header&&X.deflateSetHeader(this.strm,O.header),O.dictionary){let x;if(x="string"===typeof O.dictionary?n.string2buf(O.dictionary):"[object ArrayBuffer]"===l.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,Q=X.deflateSetDictionary(this.strm,x),Q!==N)throw new Error(V[Q]);this._dict_set=!0}}function v(x,O){const Q=new g(O);if(Q.push(x,!0),Q.err)throw Q.aO||V[Q.err];return Q.result}g.prototype.push=function(x,O){const Q=this.strm,Z=this.options.Tx;let V,o;if(this.ended)return!1;for(o=O===~~O?O:!0===O?h:C,"string"===typeof x?Q.input=n.string2buf(x):"[object ArrayBuffer]"===l.call(x)?Q.input=new Uint8Array(x):Q.input=x,Q.next_in=0,Q.avail_in=Q.input.length;;)if(0===Q.avail_out&&(Q.output=new Uint8Array(Z),Q.next_out=0,Q.avail_out=Z),(o===U||o===L)&&Q.avail_out<=6)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else{if(V=X.deflate(Q,o),V===a)return Q.next_out>0&&this.onData(Q.output.subarray(0,Q.next_out)),V=X.deflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===N;if(0!==Q.avail_out){if(o>0&&Q.next_out>0)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else if(0===Q.avail_in)break}else this.onData(Q.output)}return!0},g.prototype.onData=function(x){this.chunks.push(x)},g.prototype.onEnd=function(x){x===N&&(this.result=Z.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.aO=this.strm.aO},x.exports.Deflate=g,x.exports.deflate=v,x.exports.deflateRaw=function(x,O){return(O=O||{}).raw=!0,v(x,O)},x.exports.gzip=function(x,O){return(O=O||{}).gzip=!0,v(x,O)},x.exports.constants=Q(12130)},12157:(x,O,Q)=>{"use strict";const X=Q(12166),Z=Q(12138),n=Q(12142),V=Q(12124),o=Q(12148),l=Q(12184),C=Object.prototype.toString,{Z_NO_FLUSH:U,Z_FINISH:L,Z_OK:h,Z_STREAM_END:N,Z_NEED_DICT:a,Z_STREAM_ERROR:K,Z_DATA_ERROR:M,Z_MEM_ERROR:Y}=Q(12130);function g(x){this.options=Z.assign({Tx:65536,windowBits:15,to:""},x||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||x&&x.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.aO="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;let Q=X.inflateInit2(this.strm,O.windowBits);if(Q!==h)throw new Error(V[Q]);if(this.header=new l,X.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=n.string2buf(O.dictionary):"[object ArrayBuffer]"===C.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(Q=X.inflateSetDictionary(this.strm,O.dictionary),Q!==h)))throw new Error(V[Q])}function v(x,O){const Q=new g(O);if(Q.push(x),Q.err)throw Q.aO||V[Q.err];return Q.result}g.prototype.push=function(x,O){const Q=this.strm,Z=this.options.Tx,V=this.options.dictionary;let o,l,g;if(this.ended)return!1;for(l=O===~~O?O:!0===O?L:U,"[object ArrayBuffer]"===C.call(x)?Q.input=new Uint8Array(x):Q.input=x,Q.next_in=0,Q.avail_in=Q.input.length;;){for(0===Q.avail_out&&(Q.output=new Uint8Array(Z),Q.next_out=0,Q.avail_out=Z),o=X.inflate(Q,l),o===a&&V&&(o=X.inflateSetDictionary(Q,V),o===h?o=X.inflate(Q,l):o===M&&(o=a));Q.avail_in>0&&o===N&&Q.state.wrap>0&&0!==x[Q.next_in];)X.inflateReset(Q),o=X.inflate(Q,l);switch(o){case K:case M:case a:case Y:return this.onEnd(o),this.ended=!0,!1}if(g=Q.avail_out,Q.next_out&&(0===Q.avail_out||o===N))if("string"===this.options.to){let x=n.utf8border(Q.output,Q.next_out),O=Q.next_out-x,X=n.buf2string(Q.output,x);Q.next_out=O,Q.avail_out=Z-O,O&&Q.output.set(Q.output.subarray(x,x+O),0),this.onData(X)}else this.onData(Q.output.length===Q.next_out?Q.output:Q.output.subarray(0,Q.next_out));if(o!==h||0!==g){if(o===N)return o=X.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===Q.avail_in)break}}return!0},g.prototype.onData=function(x){this.chunks.push(x)},g.prototype.onEnd=function(x){x===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Z.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.aO=this.strm.aO},x.exports.Inflate=g,x.exports.inflate=v,x.exports.inflateRaw=function(x,O){return(O=O||{}).raw=!0,v(x,O)},x.exports.ungzip=v,x.exports.constants=Q(12130)},12138:x=>{"use strict";const O=(x,O)=>Object.prototype.hasOwnProperty.call(x,O);x.exports.assign=function(x){const Q=Array.prototype.slice.call(arguments,1);for(;Q.length;){const X=Q.shift();if(X){if("object"!==typeof X)throw new TypeError(X+"must be non-object");for(const Q in X)O(X,Q)&&(x[Q]=X[Q])}}return x},x.exports.flattenChunks=x=>{let O=0;for(let X=0,Z=x.length;X<Z;X++)O+=x[X].length;const Q=new Uint8Array(O);for(let X=0,Z=0,n=x.length;X<n;X++){let O=x[X];Q.set(O,Z),Z+=O.length}return Q}},12142:x=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(X){O=!1}const Q=new Uint8Array(256);for(let Z=0;Z<256;Z++)Q[Z]=Z>=252?6:Z>=248?5:Z>=240?4:Z>=224?3:Z>=192?2:1;Q[254]=Q[254]=1,x.exports.string2buf=x=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(x);let O,Q,X,Z,n,V=x.length,o=0;for(Z=0;Z<V;Z++)Q=x.charCodeAt(Z),55296===(64512&Q)&&Z+1<V&&(X=x.charCodeAt(Z+1),56320===(64512&X)&&(Q=65536+(Q-55296<<10)+(X-56320),Z++)),o+=Q<128?1:Q<2048?2:Q<65536?3:4;for(O=new Uint8Array(o),n=0,Z=0;n<o;Z++)Q=x.charCodeAt(Z),55296===(64512&Q)&&Z+1<V&&(X=x.charCodeAt(Z+1),56320===(64512&X)&&(Q=65536+(Q-55296<<10)+(X-56320),Z++)),Q<128?O[n++]=Q:Q<2048?(O[n++]=192|Q>>>6,O[n++]=128|63&Q):Q<65536?(O[n++]=224|Q>>>12,O[n++]=128|Q>>>6&63,O[n++]=128|63&Q):(O[n++]=240|Q>>>18,O[n++]=128|Q>>>12&63,O[n++]=128|Q>>>6&63,O[n++]=128|63&Q);return O};x.exports.buf2string=(x,X)=>{const Z=X||x.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(x.subarray(0,X));let n,V;const o=new Array(2*Z);for(V=0,n=0;n<Z;){let O=x[n++];if(O<128){o[V++]=O;continue}let X=Q[O];if(X>4)o[V++]=65533,n+=X-1;else{for(O&=2===X?31:3===X?15:7;X>1&&n<Z;)O=O<<6|63&x[n++],X--;X>1?o[V++]=65533:O<65536?o[V++]=O:(O-=65536,o[V++]=55296|O>>10&1023,o[V++]=56320|1023&O)}}return((x,Q)=>{if(Q<65534&&x.subarray&&O)return String.fromCharCode.apply(null,x.length===Q?x:x.subarray(0,Q));let X="";for(let O=0;O<Q;O++)X+=String.fromCharCode(x[O]);return X})(o,V)},x.exports.utf8border=(x,O)=>{(O=O||x.length)>x.length&&(O=x.length);let X=O-1;for(;X>=0&&128===(192&x[X]);)X--;return X<0||0===X?O:X+Q[x[X]]>O?X:O}},12114:x=>{"use strict";x.exports=(x,O,Q,X)=>{let Z=65535&x,n=x>>>16&65535,V=0;for(;0!==Q;){V=Q>2e3?2e3:Q,Q-=V;do{Z=Z+O[X++]|0,n=n+Z|0}while(--V);Z%=65521,n%=65521}return Z|n<<16}},12130:x=>{"use strict";x.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12117:x=>{"use strict";const O=new Uint32Array((()=>{let x,O=[];for(var Q=0;Q<256;Q++){x=Q;for(var X=0;X<8;X++)x=1&x?3988292384^x>>>1:x>>>1;O[Q]=x}return O})());x.exports=(x,Q,X,Z)=>{const n=O,V=Z+X;x^=-1;for(let O=Z;O<V;O++)x=x>>>8^n[255&(x^Q[O])];return~x}},12101:(x,O,Q)=>{"use strict";const{_tr_init:X,_tr_stored_block:Z,_tr_flush_block:n,_tr_tally:V,_tr_align:o}=Q(12107),l=Q(12114),C=Q(12117),U=Q(12124),{Z_NO_FLUSH:L,Z_PARTIAL_FLUSH:h,Z_FULL_FLUSH:N,Z_FINISH:a,Z_BLOCK:K,Z_OK:M,Z_STREAM_END:Y,Z_STREAM_ERROR:g,Z_DATA_ERROR:v,Z_BUF_ERROR:R,Z_DEFAULT_COMPRESSION:s,Z_FILTERED:q,Z_HUFFMAN_ONLY:G,Z_RLE:k,Z_FIXED:J,Z_DEFAULT_STRATEGY:t,Z_UNKNOWN:c,Z_DEFLATED:d}=Q(12130),u=258,A=262,f=103,E=113,z=666,F=(x,O)=>(x.aO=U[O],O),b=x=>(x<<1)-(x>4?9:0),D=x=>{let O=x.length;for(;--O>=0;)x[O]=0};let W=(x,O,Q)=>(O<<x.hash_shift^Q)&x.hash_mask;const y=x=>{const O=x.state;let Q=O.pending;Q>x.avail_out&&(Q=x.avail_out),0!==Q&&(x.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+Q),x.next_out),x.next_out+=Q,O.pending_out+=Q,x.total_out+=Q,x.avail_out-=Q,O.pending-=Q,0===O.pending&&(O.pending_out=0))},I=(x,O)=>{n(x,x.block_start>=0?x.block_start:-1,x.strstart-x.block_start,O),x.block_start=x.strstart,y(x.strm)},r=(x,O)=>{x.pending_buf[x.pending++]=O},j=(x,O)=>{x.pending_buf[x.pending++]=O>>>8&255,x.pending_buf[x.pending++]=255&O},T=(x,O,Q,X)=>{let Z=x.avail_in;return Z>X&&(Z=X),0===Z?0:(x.avail_in-=Z,O.set(x.input.subarray(x.next_in,x.next_in+Z),Q),1===x.state.wrap?x.adler=l(x.adler,O,Z,Q):2===x.state.wrap&&(x.adler=C(x.adler,O,Z,Q)),x.next_in+=Z,x.total_in+=Z,Z)},e=(x,O)=>{let Q,X,Z=x.max_chain_length,n=x.strstart,V=x.prev_length,o=x.nice_match;const l=x.strstart>x.w_size-A?x.strstart-(x.w_size-A):0,C=x.window,U=x.w_mask,L=x.prev,h=x.strstart+u;let N=C[n+V-1],a=C[n+V];x.prev_length>=x.good_match&&(Z>>=2),o>x.lookahead&&(o=x.lookahead);do{if(Q=O,C[Q+V]===a&&C[Q+V-1]===N&&C[Q]===C[n]&&C[++Q]===C[n+1]){n+=2,Q++;do{}while(C[++n]===C[++Q]&&C[++n]===C[++Q]&&C[++n]===C[++Q]&&C[++n]===C[++Q]&&C[++n]===C[++Q]&&C[++n]===C[++Q]&&C[++n]===C[++Q]&&C[++n]===C[++Q]&&n<h);if(X=u-(h-n),n=h-u,X>V){if(x.match_start=O,V=X,X>=o)break;N=C[n+V-1],a=C[n+V]}}}while((O=L[O&U])>l&&0!==--Z);return V<=x.lookahead?V:x.lookahead},B=x=>{const O=x.w_size;let Q,X,Z,n,V;do{if(n=x.window_size-x.lookahead-x.strstart,x.strstart>=O+(O-A)){x.window.set(x.window.subarray(O,O+O),0),x.match_start-=O,x.strstart-=O,x.block_start-=O,X=x.hash_size,Q=X;do{Z=x.head[--Q],x.head[Q]=Z>=O?Z-O:0}while(--X);X=O,Q=X;do{Z=x.prev[--Q],x.prev[Q]=Z>=O?Z-O:0}while(--X);n+=O}if(0===x.strm.avail_in)break;if(X=T(x.strm,x.window,x.strstart+x.lookahead,n),x.lookahead+=X,x.lookahead+x.insert>=3)for(V=x.strstart-x.insert,x.ins_h=x.window[V],x.ins_h=W(x,x.ins_h,x.window[V+1]);x.insert&&(x.ins_h=W(x,x.ins_h,x.window[V+3-1]),x.prev[V&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=V,V++,x.insert--,!(x.lookahead+x.insert<3)););}while(x.lookahead<A&&0!==x.strm.avail_in)},i=(x,O)=>{let Q,X;for(;;){if(x.lookahead<A){if(B(x),x.lookahead<A&&O===L)return 1;if(0===x.lookahead)break}if(Q=0,x.lookahead>=3&&(x.ins_h=W(x,x.ins_h,x.window[x.strstart+3-1]),Q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),0!==Q&&x.strstart-Q<=x.w_size-A&&(x.match_length=e(x,Q)),x.match_length>=3)if(X=V(x,x.strstart-x.match_start,x.match_length-3),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=3){x.match_length--;do{x.strstart++,x.ins_h=W(x,x.ins_h,x.window[x.strstart+3-1]),Q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart}while(0!==--x.match_length);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=W(x,x.ins_h,x.window[x.strstart+1]);else X=V(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(X&&(I(x,!1),0===x.strm.avail_out))return 1}return x.insert=x.strstart<2?x.strstart:2,O===a?(I(x,!0),0===x.strm.avail_out?3:4):x.last_lit&&(I(x,!1),0===x.strm.avail_out)?1:2},H=(x,O)=>{let Q,X,Z;for(;;){if(x.lookahead<A){if(B(x),x.lookahead<A&&O===L)return 1;if(0===x.lookahead)break}if(Q=0,x.lookahead>=3&&(x.ins_h=W(x,x.ins_h,x.window[x.strstart+3-1]),Q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=2,0!==Q&&x.prev_length<x.max_lazy_match&&x.strstart-Q<=x.w_size-A&&(x.match_length=e(x,Q),x.match_length<=5&&(x.strategy===q||3===x.match_length&&x.strstart-x.match_start>4096)&&(x.match_length=2)),x.prev_length>=3&&x.match_length<=x.prev_length){Z=x.strstart+x.lookahead-3,X=V(x,x.strstart-1-x.prev_match,x.prev_length-3),x.lookahead-=x.prev_length-1,x.prev_length-=2;do{++x.strstart<=Z&&(x.ins_h=W(x,x.ins_h,x.window[x.strstart+3-1]),Q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart)}while(0!==--x.prev_length);if(x.match_available=0,x.match_length=2,x.strstart++,X&&(I(x,!1),0===x.strm.avail_out))return 1}else if(x.match_available){if(X=V(x,0,x.window[x.strstart-1]),X&&I(x,!1),x.strstart++,x.lookahead--,0===x.strm.avail_out)return 1}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(X=V(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<2?x.strstart:2,O===a?(I(x,!0),0===x.strm.avail_out?3:4):x.last_lit&&(I(x,!1),0===x.strm.avail_out)?1:2};function S(x,O,Q,X,Z){this.good_length=x,this.max_lazy=O,this.nice_length=Q,this.max_chain=X,this.func=Z}const p=[new S(0,0,0,0,((x,O)=>{let Q=65535;for(Q>x.pending_buf_size-5&&(Q=x.pending_buf_size-5);;){if(x.lookahead<=1){if(B(x),0===x.lookahead&&O===L)return 1;if(0===x.lookahead)break}x.strstart+=x.lookahead,x.lookahead=0;const X=x.block_start+Q;if((0===x.strstart||x.strstart>=X)&&(x.lookahead=x.strstart-X,x.strstart=X,I(x,!1),0===x.strm.avail_out))return 1;if(x.strstart-x.block_start>=x.w_size-A&&(I(x,!1),0===x.strm.avail_out))return 1}return x.insert=0,O===a?(I(x,!0),0===x.strm.avail_out?3:4):(x.strstart>x.block_start&&(I(x,!1),x.strm.avail_out),1)})),new S(4,4,8,4,i),new S(4,5,16,8,i),new S(4,6,32,32,i),new S(4,4,16,16,H),new S(8,16,32,32,H),new S(8,16,128,128,H),new S(8,32,128,256,H),new S(32,128,258,1024,H),new S(32,258,258,4096,H)];function P(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const m=x=>{if(!x||!x.state)return F(x,g);x.total_in=x.total_out=0,x.data_type=c;const O=x.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:E,x.adler=2===O.wrap?0:1,O.last_flush=L,X(O),M},w=x=>{const O=m(x);var Q;return O===M&&((Q=x.state).window_size=2*Q.w_size,D(Q.head),Q.max_lazy_match=p[Q.level].max_lazy,Q.good_match=p[Q.level].good_length,Q.nice_match=p[Q.level].nice_length,Q.max_chain_length=p[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=2,Q.match_available=0,Q.ins_h=0),O},xx=(x,O,Q,X,Z,n)=>{if(!x)return g;let V=1;if(O===s&&(O=6),X<0?(V=0,X=-X):X>15&&(V=2,X-=16),Z<1||Z>9||Q!==d||X<8||X>15||O<0||O>9||n<0||n>J)return F(x,g);8===X&&(X=9);const o=new P;return x.state=o,o.strm=x,o.wrap=V,o.gzhead=null,o.w_bits=X,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=Z+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<Z+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=O,o.strategy=n,o.method=Q,w(x)};x.exports.deflateInit=(x,O)=>xx(x,O,d,15,8,t),x.exports.deflateInit2=xx,x.exports.deflateReset=w,x.exports.deflateResetKeep=m,x.exports.deflateSetHeader=(x,O)=>x&&x.state?2!==x.state.wrap?g:(x.state.gzhead=O,M):g,x.exports.deflate=(x,O)=>{let Q,X;if(!x||!x.state||O>K||O<0)return x?F(x,g):g;const n=x.state;if(!x.output||!x.input&&0!==x.avail_in||n.status===z&&O!==a)return F(x,0===x.avail_out?R:g);n.strm=x;const l=n.last_flush;if(n.last_flush=O,42===n.status)if(2===n.wrap)x.adler=0,r(n,31),r(n,139),r(n,8),n.gzhead?(r(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),r(n,255&n.gzhead.time),r(n,n.gzhead.time>>8&255),r(n,n.gzhead.time>>16&255),r(n,n.gzhead.time>>24&255),r(n,9===n.level?2:n.strategy>=G||n.level<2?4:0),r(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(r(n,255&n.gzhead.extra.length),r(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(x.adler=C(x.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(r(n,0),r(n,0),r(n,0),r(n,0),r(n,0),r(n,9===n.level?2:n.strategy>=G||n.level<2?4:0),r(n,3),n.status=E);else{let O=d+(n.w_bits-8<<4)<<8,Q=-1;Q=n.strategy>=G||n.level<2?0:n.level<6?1:6===n.level?2:3,O|=Q<<6,0!==n.strstart&&(O|=32),O+=31-O%31,n.status=E,j(n,O),0!==n.strstart&&(j(n,x.adler>>>16),j(n,65535&x.adler)),x.adler=1}if(69===n.status)if(n.gzhead.extra){for(Q=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>Q&&(x.adler=C(x.adler,n.pending_buf,n.pending-Q,Q)),y(x),Q=n.pending,n.pending!==n.pending_buf_size));)r(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>Q&&(x.adler=C(x.adler,n.pending_buf,n.pending-Q,Q)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){Q=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>Q&&(x.adler=C(x.adler,n.pending_buf,n.pending-Q,Q)),y(x),Q=n.pending,n.pending===n.pending_buf_size)){X=1;break}X=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,r(n,X)}while(0!==X);n.gzhead.hcrc&&n.pending>Q&&(x.adler=C(x.adler,n.pending_buf,n.pending-Q,Q)),0===X&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){Q=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>Q&&(x.adler=C(x.adler,n.pending_buf,n.pending-Q,Q)),y(x),Q=n.pending,n.pending===n.pending_buf_size)){X=1;break}X=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,r(n,X)}while(0!==X);n.gzhead.hcrc&&n.pending>Q&&(x.adler=C(x.adler,n.pending_buf,n.pending-Q,Q)),0===X&&(n.status=f)}else n.status=f;if(n.status===f&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&y(x),n.pending+2<=n.pending_buf_size&&(r(n,255&x.adler),r(n,x.adler>>8&255),x.adler=0,n.status=E)):n.status=E),0!==n.pending){if(y(x),0===x.avail_out)return n.last_flush=-1,M}else if(0===x.avail_in&&b(O)<=b(l)&&O!==a)return F(x,R);if(n.status===z&&0!==x.avail_in)return F(x,R);if(0!==x.avail_in||0!==n.lookahead||O!==L&&n.status!==z){let Q=n.strategy===G?((x,O)=>{let Q;for(;;){if(0===x.lookahead&&(B(x),0===x.lookahead)){if(O===L)return 1;break}if(x.match_length=0,Q=V(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++,Q&&(I(x,!1),0===x.strm.avail_out))return 1}return x.insert=0,O===a?(I(x,!0),0===x.strm.avail_out?3:4):x.last_lit&&(I(x,!1),0===x.strm.avail_out)?1:2})(n,O):n.strategy===k?((x,O)=>{let Q,X,Z,n;const o=x.window;for(;;){if(x.lookahead<=u){if(B(x),x.lookahead<=u&&O===L)return 1;if(0===x.lookahead)break}if(x.match_length=0,x.lookahead>=3&&x.strstart>0&&(Z=x.strstart-1,X=o[Z],X===o[++Z]&&X===o[++Z]&&X===o[++Z])){n=x.strstart+u;do{}while(X===o[++Z]&&X===o[++Z]&&X===o[++Z]&&X===o[++Z]&&X===o[++Z]&&X===o[++Z]&&X===o[++Z]&&X===o[++Z]&&Z<n);x.match_length=u-(n-Z),x.match_length>x.lookahead&&(x.match_length=x.lookahead)}if(x.match_length>=3?(Q=V(x,1,x.match_length-3),x.lookahead-=x.match_length,x.strstart+=x.match_length,x.match_length=0):(Q=V(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++),Q&&(I(x,!1),0===x.strm.avail_out))return 1}return x.insert=0,O===a?(I(x,!0),0===x.strm.avail_out?3:4):x.last_lit&&(I(x,!1),0===x.strm.avail_out)?1:2})(n,O):p[n.level].func(n,O);if(3!==Q&&4!==Q||(n.status=z),1===Q||3===Q)return 0===x.avail_out&&(n.last_flush=-1),M;if(2===Q&&(O===h?o(n):O!==K&&(Z(n,0,0,!1),O===N&&(D(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),y(x),0===x.avail_out))return n.last_flush=-1,M}return O!==a?M:n.wrap<=0?Y:(2===n.wrap?(r(n,255&x.adler),r(n,x.adler>>8&255),r(n,x.adler>>16&255),r(n,x.adler>>24&255),r(n,255&x.total_in),r(n,x.total_in>>8&255),r(n,x.total_in>>16&255),r(n,x.total_in>>24&255)):(j(n,x.adler>>>16),j(n,65535&x.adler)),y(x),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?M:Y)},x.exports.deflateEnd=x=>{if(!x||!x.state)return g;const O=x.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==f&&O!==E&&O!==z?F(x,g):(x.state=null,O===E?F(x,v):M)},x.exports.deflateSetDictionary=(x,O)=>{let Q=O.length;if(!x||!x.state)return g;const X=x.state,Z=X.wrap;if(2===Z||1===Z&&42!==X.status||X.lookahead)return g;if(1===Z&&(x.adler=l(x.adler,O,Q,0)),X.wrap=0,Q>=X.w_size){0===Z&&(D(X.head),X.strstart=0,X.block_start=0,X.insert=0);let x=new Uint8Array(X.w_size);x.set(O.subarray(Q-X.w_size,Q),0),O=x,Q=X.w_size}const n=x.avail_in,V=x.next_in,o=x.input;for(x.avail_in=Q,x.next_in=0,x.input=O,B(X);X.lookahead>=3;){let x=X.strstart,O=X.lookahead-2;do{X.ins_h=W(X,X.ins_h,X.window[x+3-1]),X.prev[x&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=x,x++}while(--O);X.strstart=x,X.lookahead=2,B(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=2,X.match_available=0,x.next_in=V,x.input=o,x.avail_in=n,X.wrap=Z,M},x.exports.deflateInfo="pako deflate (from Nodeca project)"},12184:x=>{"use strict";x.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12174:x=>{"use strict";x.exports=function(x,O){let Q,X,Z,n,V,o,l,C,U,L,h,N,a,K,M,Y,g,v,R,s,q,G,k,J;const t=x.state;Q=x.next_in,k=x.input,X=Q+(x.avail_in-5),Z=x.next_out,J=x.output,n=Z-(O-x.avail_out),V=Z+(x.avail_out-257),o=t.dmax,l=t.wsize,C=t.whave,U=t.wnext,L=t.window,h=t.hold,N=t.bits,a=t.lencode,K=t.distcode,M=(1<<t.lenbits)-1,Y=(1<<t.distbits)-1;x:do{N<15&&(h+=k[Q++]<<N,N+=8,h+=k[Q++]<<N,N+=8),g=a[h&M];O:for(;;){if(v=g>>>24,h>>>=v,N-=v,v=g>>>16&255,0===v)J[Z++]=65535&g;else{if(!(16&v)){if(0===(64&v)){g=a[(65535&g)+(h&(1<<v)-1)];continue O}if(32&v){t.mode=12;break x}x.aO="invalid literal/length code",t.mode=30;break x}R=65535&g,v&=15,v&&(N<v&&(h+=k[Q++]<<N,N+=8),R+=h&(1<<v)-1,h>>>=v,N-=v),N<15&&(h+=k[Q++]<<N,N+=8,h+=k[Q++]<<N,N+=8),g=K[h&Y];Q:for(;;){if(v=g>>>24,h>>>=v,N-=v,v=g>>>16&255,!(16&v)){if(0===(64&v)){g=K[(65535&g)+(h&(1<<v)-1)];continue Q}x.aO="invalid distance code",t.mode=30;break x}if(s=65535&g,v&=15,N<v&&(h+=k[Q++]<<N,N+=8,N<v&&(h+=k[Q++]<<N,N+=8)),s+=h&(1<<v)-1,s>o){x.aO="invalid distance too far back",t.mode=30;break x}if(h>>>=v,N-=v,v=Z-n,s>v){if(v=s-v,v>C&&t.sane){x.aO="invalid distance too far back",t.mode=30;break x}if(q=0,G=L,0===U){if(q+=l-v,v<R){R-=v;do{J[Z++]=L[q++]}while(--v);q=Z-s,G=J}}else if(U<v){if(q+=l+U-v,v-=U,v<R){R-=v;do{J[Z++]=L[q++]}while(--v);if(q=0,U<R){v=U,R-=v;do{J[Z++]=L[q++]}while(--v);q=Z-s,G=J}}}else if(q+=U-v,v<R){R-=v;do{J[Z++]=L[q++]}while(--v);q=Z-s,G=J}for(;R>2;)J[Z++]=G[q++],J[Z++]=G[q++],J[Z++]=G[q++],R-=3;R&&(J[Z++]=G[q++],R>1&&(J[Z++]=G[q++]))}else{q=Z-s;do{J[Z++]=J[q++],J[Z++]=J[q++],J[Z++]=J[q++],R-=3}while(R>2);R&&(J[Z++]=J[q++],R>1&&(J[Z++]=J[q++]))}break}}break}}while(Q<X&&Z<V);R=N>>3,Q-=R,N-=R<<3,h&=(1<<N)-1,x.next_in=Q,x.next_out=Z,x.avail_in=Q<X?X-Q+5:5-(Q-X),x.avail_out=Z<V?V-Z+257:257-(Z-V),t.hold=h,t.bits=N}},12166:(x,O,Q)=>{"use strict";const X=Q(12114),Z=Q(12117),n=Q(12174),V=Q(12178),{Z_FINISH:o,Z_BLOCK:l,Z_TREES:C,Z_OK:U,Z_STREAM_END:L,Z_NEED_DICT:h,Z_STREAM_ERROR:N,Z_DATA_ERROR:a,Z_MEM_ERROR:K,Z_BUF_ERROR:M,Z_DEFLATED:Y}=Q(12130),g=12,v=30,R=x=>(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24);function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q=x=>{if(!x||!x.state)return N;const O=x.state;return x.total_in=x.total_out=O.total=0,x.aO="",O.wrap&&(x.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,U},G=x=>{if(!x||!x.state)return N;const O=x.state;return O.wsize=0,O.whave=0,O.wnext=0,q(x)},k=(x,O)=>{let Q;if(!x||!x.state)return N;const X=x.state;return O<0?(Q=0,O=-O):(Q=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?N:(null!==X.window&&X.wbits!==O&&(X.window=null),X.wrap=Q,X.wbits=O,G(x))},J=(x,O)=>{if(!x)return N;const Q=new s;x.state=Q,Q.window=null;const X=k(x,O);return X!==U&&(x.state=null),X};let t,c,d=!0;const u=x=>{if(d){t=new Int32Array(512),c=new Int32Array(32);let O=0;for(;O<144;)x.lens[O++]=8;for(;O<256;)x.lens[O++]=9;for(;O<280;)x.lens[O++]=7;for(;O<288;)x.lens[O++]=8;for(V(1,x.lens,0,288,t,0,x.work,{bits:9}),O=0;O<32;)x.lens[O++]=5;V(2,x.lens,0,32,c,0,x.work,{bits:5}),d=!1}x.lencode=t,x.lenbits=9,x.distcode=c,x.distbits=5},A=(x,O,Q,X)=>{let Z;const n=x.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),X>=n.wsize?(n.window.set(O.subarray(Q-n.wsize,Q),0),n.wnext=0,n.whave=n.wsize):(Z=n.wsize-n.wnext,Z>X&&(Z=X),n.window.set(O.subarray(Q-X,Q-X+Z),n.wnext),(X-=Z)?(n.window.set(O.subarray(Q-X,Q),0),n.wnext=X,n.whave=n.wsize):(n.wnext+=Z,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=Z))),0};x.exports.inflateReset=G,x.exports.inflateReset2=k,x.exports.inflateResetKeep=q,x.exports.inflateInit=x=>J(x,15),x.exports.inflateInit2=J,x.exports.inflate=(x,O)=>{let Q,s,q,G,k,J,t,c,d,f,E,z,F,b,D,W,y,I,r,j,T,e,B=0;const i=new Uint8Array(4);let H,S;const p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!x||!x.state||!x.output||!x.input&&0!==x.avail_in)return N;Q=x.state,Q.mode===g&&(Q.mode=13),k=x.next_out,q=x.output,t=x.avail_out,G=x.next_in,s=x.input,J=x.avail_in,c=Q.hold,d=Q.bits,f=J,E=t,e=U;x:for(;;)switch(Q.mode){case 1:if(0===Q.wrap){Q.mode=13;break}for(;d<16;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(2&Q.wrap&&35615===c){Q.check=0,i[0]=255&c,i[1]=c>>>8&255,Q.check=Z(Q.check,i,2,0),c=0,d=0,Q.mode=2;break}if(Q.flags=0,Q.head&&(Q.head.done=!1),!(1&Q.wrap)||(((255&c)<<8)+(c>>8))%31){x.aO="incorrect header check",Q.mode=v;break}if((15&c)!==Y){x.aO="unknown compression method",Q.mode=v;break}if(c>>>=4,d-=4,T=8+(15&c),0===Q.wbits)Q.wbits=T;else if(T>Q.wbits){x.aO="invalid window size",Q.mode=v;break}Q.dmax=1<<Q.wbits,x.adler=Q.check=1,Q.mode=512&c?10:g,c=0,d=0;break;case 2:for(;d<16;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(Q.flags=c,(255&Q.flags)!==Y){x.aO="unknown compression method",Q.mode=v;break}if(57344&Q.flags){x.aO="unknown header flags set",Q.mode=v;break}Q.head&&(Q.head.text=c>>8&1),512&Q.flags&&(i[0]=255&c,i[1]=c>>>8&255,Q.check=Z(Q.check,i,2,0)),c=0,d=0,Q.mode=3;case 3:for(;d<32;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}Q.head&&(Q.head.time=c),512&Q.flags&&(i[0]=255&c,i[1]=c>>>8&255,i[2]=c>>>16&255,i[3]=c>>>24&255,Q.check=Z(Q.check,i,4,0)),c=0,d=0,Q.mode=4;case 4:for(;d<16;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}Q.head&&(Q.head.xflags=255&c,Q.head.os=c>>8),512&Q.flags&&(i[0]=255&c,i[1]=c>>>8&255,Q.check=Z(Q.check,i,2,0)),c=0,d=0,Q.mode=5;case 5:if(1024&Q.flags){for(;d<16;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}Q.length=c,Q.head&&(Q.head.extra_len=c),512&Q.flags&&(i[0]=255&c,i[1]=c>>>8&255,Q.check=Z(Q.check,i,2,0)),c=0,d=0}else Q.head&&(Q.head.extra=null);Q.mode=6;case 6:if(1024&Q.flags&&(z=Q.length,z>J&&(z=J),z&&(Q.head&&(T=Q.head.extra_len-Q.length,Q.head.extra||(Q.head.extra=new Uint8Array(Q.head.extra_len)),Q.head.extra.set(s.subarray(G,G+z),T)),512&Q.flags&&(Q.check=Z(Q.check,s,z,G)),J-=z,G+=z,Q.length-=z),Q.length))break x;Q.length=0,Q.mode=7;case 7:if(2048&Q.flags){if(0===J)break x;z=0;do{T=s[G+z++],Q.head&&T&&Q.length<65536&&(Q.head.name+=String.fromCharCode(T))}while(T&&z<J);if(512&Q.flags&&(Q.check=Z(Q.check,s,z,G)),J-=z,G+=z,T)break x}else Q.head&&(Q.head.name=null);Q.length=0,Q.mode=8;case 8:if(4096&Q.flags){if(0===J)break x;z=0;do{T=s[G+z++],Q.head&&T&&Q.length<65536&&(Q.head.comment+=String.fromCharCode(T))}while(T&&z<J);if(512&Q.flags&&(Q.check=Z(Q.check,s,z,G)),J-=z,G+=z,T)break x}else Q.head&&(Q.head.comment=null);Q.mode=9;case 9:if(512&Q.flags){for(;d<16;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(c!==(65535&Q.check)){x.aO="header crc mismatch",Q.mode=v;break}c=0,d=0}Q.head&&(Q.head.hcrc=Q.flags>>9&1,Q.head.done=!0),x.adler=Q.check=0,Q.mode=g;break;case 10:for(;d<32;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}x.adler=Q.check=R(c),c=0,d=0,Q.mode=11;case 11:if(0===Q.havedict)return x.next_out=k,x.avail_out=t,x.next_in=G,x.avail_in=J,Q.hold=c,Q.bits=d,h;x.adler=Q.check=1,Q.mode=g;case g:if(O===l||O===C)break x;case 13:if(Q.last){c>>>=7&d,d-=7&d,Q.mode=27;break}for(;d<3;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}switch(Q.last=1&c,c>>>=1,d-=1,3&c){case 0:Q.mode=14;break;case 1:if(u(Q),Q.mode=20,O===C){c>>>=2,d-=2;break x}break;case 2:Q.mode=17;break;case 3:x.aO="invalid block type",Q.mode=v}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if((65535&c)!==(c>>>16^65535)){x.aO="invalid stored block lengths",Q.mode=v;break}if(Q.length=65535&c,c=0,d=0,Q.mode=15,O===C)break x;case 15:Q.mode=16;case 16:if(z=Q.length,z){if(z>J&&(z=J),z>t&&(z=t),0===z)break x;q.set(s.subarray(G,G+z),k),J-=z,G+=z,t-=z,k+=z,Q.length-=z;break}Q.mode=g;break;case 17:for(;d<14;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(Q.nlen=257+(31&c),c>>>=5,d-=5,Q.ndist=1+(31&c),c>>>=5,d-=5,Q.ncode=4+(15&c),c>>>=4,d-=4,Q.nlen>286||Q.ndist>30){x.aO="too many length or distance symbols",Q.mode=v;break}Q.have=0,Q.mode=18;case 18:for(;Q.have<Q.ncode;){for(;d<3;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}Q.lens[p[Q.have++]]=7&c,c>>>=3,d-=3}for(;Q.have<19;)Q.lens[p[Q.have++]]=0;if(Q.lencode=Q.lendyn,Q.lenbits=7,H={bits:Q.lenbits},e=V(0,Q.lens,0,19,Q.lencode,0,Q.work,H),Q.lenbits=H.bits,e){x.aO="invalid code lengths set",Q.mode=v;break}Q.have=0,Q.mode=19;case 19:for(;Q.have<Q.nlen+Q.ndist;){for(;B=Q.lencode[c&(1<<Q.lenbits)-1],D=B>>>24,W=B>>>16&255,y=65535&B,!(D<=d);){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(y<16)c>>>=D,d-=D,Q.lens[Q.have++]=y;else{if(16===y){for(S=D+2;d<S;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(c>>>=D,d-=D,0===Q.have){x.aO="invalid bit length repeat",Q.mode=v;break}T=Q.lens[Q.have-1],z=3+(3&c),c>>>=2,d-=2}else if(17===y){for(S=D+3;d<S;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}c>>>=D,d-=D,T=0,z=3+(7&c),c>>>=3,d-=3}else{for(S=D+7;d<S;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}c>>>=D,d-=D,T=0,z=11+(127&c),c>>>=7,d-=7}if(Q.have+z>Q.nlen+Q.ndist){x.aO="invalid bit length repeat",Q.mode=v;break}for(;z--;)Q.lens[Q.have++]=T}}if(Q.mode===v)break;if(0===Q.lens[256]){x.aO="invalid code -- missing end-of-block",Q.mode=v;break}if(Q.lenbits=9,H={bits:Q.lenbits},e=V(1,Q.lens,0,Q.nlen,Q.lencode,0,Q.work,H),Q.lenbits=H.bits,e){x.aO="invalid literal/lengths set",Q.mode=v;break}if(Q.distbits=6,Q.distcode=Q.distdyn,H={bits:Q.distbits},e=V(2,Q.lens,Q.nlen,Q.ndist,Q.distcode,0,Q.work,H),Q.distbits=H.bits,e){x.aO="invalid distances set",Q.mode=v;break}if(Q.mode=20,O===C)break x;case 20:Q.mode=21;case 21:if(J>=6&&t>=258){x.next_out=k,x.avail_out=t,x.next_in=G,x.avail_in=J,Q.hold=c,Q.bits=d,n(x,E),k=x.next_out,q=x.output,t=x.avail_out,G=x.next_in,s=x.input,J=x.avail_in,c=Q.hold,d=Q.bits,Q.mode===g&&(Q.back=-1);break}for(Q.back=0;B=Q.lencode[c&(1<<Q.lenbits)-1],D=B>>>24,W=B>>>16&255,y=65535&B,!(D<=d);){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(W&&0===(240&W)){for(I=D,r=W,j=y;B=Q.lencode[j+((c&(1<<I+r)-1)>>I)],D=B>>>24,W=B>>>16&255,y=65535&B,!(I+D<=d);){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}c>>>=I,d-=I,Q.back+=I}if(c>>>=D,d-=D,Q.back+=D,Q.length=y,0===W){Q.mode=26;break}if(32&W){Q.back=-1,Q.mode=g;break}if(64&W){x.aO="invalid literal/length code",Q.mode=v;break}Q.extra=15&W,Q.mode=22;case 22:if(Q.extra){for(S=Q.extra;d<S;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}Q.length+=c&(1<<Q.extra)-1,c>>>=Q.extra,d-=Q.extra,Q.back+=Q.extra}Q.was=Q.length,Q.mode=23;case 23:for(;B=Q.distcode[c&(1<<Q.distbits)-1],D=B>>>24,W=B>>>16&255,y=65535&B,!(D<=d);){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(0===(240&W)){for(I=D,r=W,j=y;B=Q.distcode[j+((c&(1<<I+r)-1)>>I)],D=B>>>24,W=B>>>16&255,y=65535&B,!(I+D<=d);){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}c>>>=I,d-=I,Q.back+=I}if(c>>>=D,d-=D,Q.back+=D,64&W){x.aO="invalid distance code",Q.mode=v;break}Q.offset=y,Q.extra=15&W,Q.mode=24;case 24:if(Q.extra){for(S=Q.extra;d<S;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}Q.offset+=c&(1<<Q.extra)-1,c>>>=Q.extra,d-=Q.extra,Q.back+=Q.extra}if(Q.offset>Q.dmax){x.aO="invalid distance too far back",Q.mode=v;break}Q.mode=25;case 25:if(0===t)break x;if(z=E-t,Q.offset>z){if(z=Q.offset-z,z>Q.whave&&Q.sane){x.aO="invalid distance too far back",Q.mode=v;break}z>Q.wnext?(z-=Q.wnext,F=Q.wsize-z):F=Q.wnext-z,z>Q.length&&(z=Q.length),b=Q.window}else b=q,F=k-Q.offset,z=Q.length;z>t&&(z=t),t-=z,Q.length-=z;do{q[k++]=b[F++]}while(--z);0===Q.length&&(Q.mode=21);break;case 26:if(0===t)break x;q[k++]=Q.length,t--,Q.mode=21;break;case 27:if(Q.wrap){for(;d<32;){if(0===J)break x;J--,c|=s[G++]<<d,d+=8}if(E-=t,x.total_out+=E,Q.total+=E,E&&(x.adler=Q.check=Q.flags?Z(Q.check,q,E,k-E):X(Q.check,q,E,k-E)),E=t,(Q.flags?c:R(c))!==Q.check){x.aO="incorrect data check",Q.mode=v;break}c=0,d=0}Q.mode=28;case 28:if(Q.wrap&&Q.flags){for(;d<32;){if(0===J)break x;J--,c+=s[G++]<<d,d+=8}if(c!==(4294967295&Q.total)){x.aO="incorrect length check",Q.mode=v;break}c=0,d=0}Q.mode=29;case 29:e=L;break x;case v:e=a;break x;case 31:return K;default:return N}return x.next_out=k,x.avail_out=t,x.next_in=G,x.avail_in=J,Q.hold=c,Q.bits=d,(Q.wsize||E!==x.avail_out&&Q.mode<v&&(Q.mode<27||O!==o))&&A(x,x.output,x.next_out,E-x.avail_out)?(Q.mode=31,K):(f-=x.avail_in,E-=x.avail_out,x.total_in+=f,x.total_out+=E,Q.total+=E,Q.wrap&&E&&(x.adler=Q.check=Q.flags?Z(Q.check,q,E,x.next_out-E):X(Q.check,q,E,x.next_out-E)),x.data_type=Q.bits+(Q.last?64:0)+(Q.mode===g?128:0)+(20===Q.mode||15===Q.mode?256:0),(0===f&&0===E||O===o)&&e===U&&(e=M),e)},x.exports.inflateEnd=x=>{if(!x||!x.state)return N;let O=x.state;return O.window&&(O.window=null),x.state=null,U},x.exports.inflateGetHeader=(x,O)=>{if(!x||!x.state)return N;const Q=x.state;return 0===(2&Q.wrap)?N:(Q.head=O,O.done=!1,U)},x.exports.inflateSetDictionary=(x,O)=>{const Q=O.length;let Z,n,V;return x&&x.state?(Z=x.state,0!==Z.wrap&&11!==Z.mode?N:11===Z.mode&&(n=1,n=X(n,O,Q,0),n!==Z.check)?a:(V=A(x,O,Q,Q),V?(Z.mode=31,K):(Z.havedict=1,U))):N},x.exports.inflateInfo="pako inflate (from Nodeca project)"},12178:x=>{"use strict";const O=15,Q=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),X=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Z=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);x.exports=(x,V,o,l,C,U,L,h)=>{const N=h.bits;let a,K,M,Y,g,v,R=0,s=0,q=0,G=0,k=0,J=0,t=0,c=0,d=0,u=0,A=null,f=0;const E=new Uint16Array(16),z=new Uint16Array(16);let F,b,D,W=null,y=0;for(R=0;R<=O;R++)E[R]=0;for(s=0;s<l;s++)E[V[o+s]]++;for(k=N,G=O;G>=1&&0===E[G];G--);if(k>G&&(k=G),0===G)return C[U++]=20971520,C[U++]=20971520,h.bits=1,0;for(q=1;q<G&&0===E[q];q++);for(k<q&&(k=q),c=1,R=1;R<=O;R++)if(c<<=1,c-=E[R],c<0)return-1;if(c>0&&(0===x||1!==G))return-1;for(z[1]=0,R=1;R<O;R++)z[R+1]=z[R]+E[R];for(s=0;s<l;s++)0!==V[o+s]&&(L[z[V[o+s]]++]=s);if(0===x?(A=W=L,v=19):1===x?(A=Q,f-=257,W=X,y-=257,v=256):(A=Z,W=n,v=-1),u=0,s=0,R=q,g=U,J=k,t=0,M=-1,d=1<<k,Y=d-1,1===x&&d>852||2===x&&d>592)return 1;for(;;){F=R-t,L[s]<v?(b=0,D=L[s]):L[s]>v?(b=W[y+L[s]],D=A[f+L[s]]):(b=96,D=0),a=1<<R-t,K=1<<J,q=K;do{K-=a,C[g+(u>>t)+K]=F<<24|b<<16|D}while(0!==K);for(a=1<<R-1;u&a;)a>>=1;if(0!==a?(u&=a-1,u+=a):u=0,s++,0===--E[R]){if(R===G)break;R=V[o+L[s]]}if(R>k&&(u&Y)!==M){for(0===t&&(t=k),g+=q,J=R-t,c=1<<J;J+t<G&&(c-=E[J+t],!(c<=0));)J++,c<<=1;if(d+=1<<J,1===x&&d>852||2===x&&d>592)return 1;M=u&Y,C[M]=k<<24|J<<16|g-U}}return 0!==u&&(C[g+u]=R-t<<24|64<<16),h.bits=k,0}},12124:x=>{"use strict";x.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12107:x=>{"use strict";function O(x){let O=x.length;for(;--O>=0;)x[O]=0}const Q=256,X=286,Z=30,n=15,V=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),U=new Array(576);O(U);const L=new Array(60);O(L);const h=new Array(512);O(h);const N=new Array(256);O(N);const a=new Array(29);O(a);const K=new Array(Z);function M(x,O,Q,X,Z){this.static_tree=x,this.extra_bits=O,this.extra_base=Q,this.elems=X,this.max_length=Z,this.has_stree=x&&x.length}let Y,g,v;function R(x,O){this.dyn_tree=x,this.max_code=0,this.stat_desc=O}O(K);const s=x=>x<256?h[x]:h[256+(x>>>7)],q=(x,O)=>{x.pending_buf[x.pending++]=255&O,x.pending_buf[x.pending++]=O>>>8&255},G=(x,O,Q)=>{x.bi_valid>16-Q?(x.bi_buf|=O<<x.bi_valid&65535,q(x,x.bi_buf),x.bi_buf=O>>16-x.bi_valid,x.bi_valid+=Q-16):(x.bi_buf|=O<<x.bi_valid&65535,x.bi_valid+=Q)},k=(x,O,Q)=>{G(x,Q[2*O],Q[2*O+1])},J=(x,O)=>{let Q=0;do{Q|=1&x,x>>>=1,Q<<=1}while(--O>0);return Q>>>1},t=(x,O,Q)=>{const X=new Array(16);let Z,V,o=0;for(Z=1;Z<=n;Z++)X[Z]=o=o+Q[Z-1]<<1;for(V=0;V<=O;V++){let O=x[2*V+1];0!==O&&(x[2*V]=J(X[O]++,O))}},c=x=>{let O;for(O=0;O<X;O++)x.dyn_ltree[2*O]=0;for(O=0;O<Z;O++)x.dyn_dtree[2*O]=0;for(O=0;O<19;O++)x.bl_tree[2*O]=0;x.dyn_ltree[512]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0},d=x=>{x.bi_valid>8?q(x,x.bi_buf):x.bi_valid>0&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0},u=(x,O,Q,X)=>{const Z=2*O,n=2*Q;return x[Z]<x[n]||x[Z]===x[n]&&X[O]<=X[Q]},A=(x,O,Q)=>{const X=x.heap[Q];let Z=Q<<1;for(;Z<=x.heap_len&&(Z<x.heap_len&&u(O,x.heap[Z+1],x.heap[Z],x.depth)&&Z++,!u(O,X,x.heap[Z],x.depth));)x.heap[Q]=x.heap[Z],Q=Z,Z<<=1;x.heap[Q]=X},f=(x,O,X)=>{let Z,n,l,C,U=0;if(0!==x.last_lit)do{Z=x.pending_buf[x.d_buf+2*U]<<8|x.pending_buf[x.d_buf+2*U+1],n=x.pending_buf[x.l_buf+U],U++,0===Z?k(x,n,O):(l=N[n],k(x,l+Q+1,O),C=V[l],0!==C&&(n-=a[l],G(x,n,C)),Z--,l=s(Z),k(x,l,X),C=o[l],0!==C&&(Z-=K[l],G(x,Z,C)))}while(U<x.last_lit);k(x,256,O)},E=(x,O)=>{const Q=O.dyn_tree,X=O.stat_desc.static_tree,Z=O.stat_desc.has_stree,V=O.stat_desc.elems;let o,l,C,U=-1;for(x.heap_len=0,x.heap_max=573,o=0;o<V;o++)0!==Q[2*o]?(x.heap[++x.heap_len]=U=o,x.depth[o]=0):Q[2*o+1]=0;for(;x.heap_len<2;)C=x.heap[++x.heap_len]=U<2?++U:0,Q[2*C]=1,x.depth[C]=0,x.opt_len--,Z&&(x.static_len-=X[2*C+1]);for(O.max_code=U,o=x.heap_len>>1;o>=1;o--)A(x,Q,o);C=V;do{o=x.heap[1],x.heap[1]=x.heap[x.heap_len--],A(x,Q,1),l=x.heap[1],x.heap[--x.heap_max]=o,x.heap[--x.heap_max]=l,Q[2*C]=Q[2*o]+Q[2*l],x.depth[C]=(x.depth[o]>=x.depth[l]?x.depth[o]:x.depth[l])+1,Q[2*o+1]=Q[2*l+1]=C,x.heap[1]=C++,A(x,Q,1)}while(x.heap_len>=2);x.heap[--x.heap_max]=x.heap[1],((x,O)=>{const Q=O.dyn_tree,X=O.max_code,Z=O.stat_desc.static_tree,V=O.stat_desc.has_stree,o=O.stat_desc.extra_bits,l=O.stat_desc.extra_base,C=O.stat_desc.max_length;let U,L,h,N,a,K,M=0;for(N=0;N<=n;N++)x.bl_count[N]=0;for(Q[2*x.heap[x.heap_max]+1]=0,U=x.heap_max+1;U<573;U++)L=x.heap[U],N=Q[2*Q[2*L+1]+1]+1,N>C&&(N=C,M++),Q[2*L+1]=N,L>X||(x.bl_count[N]++,a=0,L>=l&&(a=o[L-l]),K=Q[2*L],x.opt_len+=K*(N+a),V&&(x.static_len+=K*(Z[2*L+1]+a)));if(0!==M){do{for(N=C-1;0===x.bl_count[N];)N--;x.bl_count[N]--,x.bl_count[N+1]+=2,x.bl_count[C]--,M-=2}while(M>0);for(N=C;0!==N;N--)for(L=x.bl_count[N];0!==L;)h=x.heap[--U],h>X||(Q[2*h+1]!==N&&(x.opt_len+=(N-Q[2*h+1])*Q[2*h],Q[2*h+1]=N),L--)}})(x,O),t(Q,U,x.bl_count)},z=(x,O,Q)=>{let X,Z,n=-1,V=O[1],o=0,l=7,C=4;for(0===V&&(l=138,C=3),O[2*(Q+1)+1]=65535,X=0;X<=Q;X++)Z=V,V=O[2*(X+1)+1],++o<l&&Z===V||(o<C?x.bl_tree[2*Z]+=o:0!==Z?(Z!==n&&x.bl_tree[2*Z]++,x.bl_tree[32]++):o<=10?x.bl_tree[34]++:x.bl_tree[36]++,o=0,n=Z,0===V?(l=138,C=3):Z===V?(l=6,C=3):(l=7,C=4))},F=(x,O,Q)=>{let X,Z,n=-1,V=O[1],o=0,l=7,C=4;for(0===V&&(l=138,C=3),X=0;X<=Q;X++)if(Z=V,V=O[2*(X+1)+1],!(++o<l&&Z===V)){if(o<C)do{k(x,Z,x.bl_tree)}while(0!==--o);else 0!==Z?(Z!==n&&(k(x,Z,x.bl_tree),o--),k(x,16,x.bl_tree),G(x,o-3,2)):o<=10?(k(x,17,x.bl_tree),G(x,o-3,3)):(k(x,18,x.bl_tree),G(x,o-11,7));o=0,n=Z,0===V?(l=138,C=3):Z===V?(l=6,C=3):(l=7,C=4)}};let b=!1;const D=(x,O,Q,X)=>{G(x,0+(X?1:0),3),((x,O,Q,X)=>{d(x),X&&(q(x,Q),q(x,~Q)),x.pending_buf.set(x.window.subarray(O,O+Q),x.pending),x.pending+=Q})(x,O,Q,!0)};x.exports._tr_init=x=>{b||((()=>{let x,O,Q,C,R;const s=new Array(16);for(Q=0,C=0;C<28;C++)for(a[C]=Q,x=0;x<1<<V[C];x++)N[Q++]=C;for(N[Q-1]=C,R=0,C=0;C<16;C++)for(K[C]=R,x=0;x<1<<o[C];x++)h[R++]=C;for(R>>=7;C<Z;C++)for(K[C]=R<<7,x=0;x<1<<o[C]-7;x++)h[256+R++]=C;for(O=0;O<=n;O++)s[O]=0;for(x=0;x<=143;)U[2*x+1]=8,x++,s[8]++;for(;x<=255;)U[2*x+1]=9,x++,s[9]++;for(;x<=279;)U[2*x+1]=7,x++,s[7]++;for(;x<=287;)U[2*x+1]=8,x++,s[8]++;for(t(U,287,s),x=0;x<Z;x++)L[2*x+1]=5,L[2*x]=J(x,5);Y=new M(U,V,257,X,n),g=new M(L,o,0,Z,n),v=new M(new Array(0),l,0,19,7)})(),b=!0),x.l_desc=new R(x.dyn_ltree,Y),x.d_desc=new R(x.dyn_dtree,g),x.bl_desc=new R(x.bl_tree,v),x.bi_buf=0,x.bi_valid=0,c(x)},x.exports._tr_stored_block=D,x.exports._tr_flush_block=(x,O,X,Z)=>{let n,V,o=0;x.level>0?(2===x.strm.data_type&&(x.strm.data_type=(x=>{let O,X=4093624447;for(O=0;O<=31;O++,X>>>=1)if(1&X&&0!==x.dyn_ltree[2*O])return 0;if(0!==x.dyn_ltree[18]||0!==x.dyn_ltree[20]||0!==x.dyn_ltree[26])return 1;for(O=32;O<Q;O++)if(0!==x.dyn_ltree[2*O])return 1;return 0})(x)),E(x,x.l_desc),E(x,x.d_desc),o=(x=>{let O;for(z(x,x.dyn_ltree,x.l_desc.max_code),z(x,x.dyn_dtree,x.d_desc.max_code),E(x,x.bl_desc),O=18;O>=3&&0===x.bl_tree[2*C[O]+1];O--);return x.opt_len+=3*(O+1)+5+5+4,O})(x),n=x.opt_len+3+7>>>3,V=x.static_len+3+7>>>3,V<=n&&(n=V)):n=V=X+5,X+4<=n&&-1!==O?D(x,O,X,Z):4===x.strategy||V===n?(G(x,2+(Z?1:0),3),f(x,U,L)):(G(x,4+(Z?1:0),3),((x,O,Q,X)=>{let Z;for(G(x,O-257,5),G(x,Q-1,5),G(x,X-4,4),Z=0;Z<X;Z++)G(x,x.bl_tree[2*C[Z]+1],3);F(x,x.dyn_ltree,O-1),F(x,x.dyn_dtree,Q-1)})(x,x.l_desc.max_code+1,x.d_desc.max_code+1,o+1),f(x,x.dyn_ltree,x.dyn_dtree)),c(x),Z&&d(x)},x.exports._tr_tally=(x,O,X)=>(x.pending_buf[x.d_buf+2*x.last_lit]=O>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&O,x.pending_buf[x.l_buf+x.last_lit]=255&X,x.last_lit++,0===O?x.dyn_ltree[2*X]++:(x.matches++,O--,x.dyn_ltree[2*(N[X]+Q+1)]++,x.dyn_dtree[2*s(O)]++),x.last_lit===x.lit_bufsize-1),x.exports._tr_align=x=>{G(x,2,3),k(x,256,U),(x=>{16===x.bi_valid?(q(x,x.bi_buf),x.bi_buf=0,x.bi_valid=0):x.bi_valid>=8&&(x.pending_buf[x.pending++]=255&x.bi_buf,x.bi_buf>>=8,x.bi_valid-=8)})(x)}},12148:x=>{"use strict";x.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.aO="",this.state=null,this.data_type=2,this.adler=0}},11799:x=>{function O(x,O,Q){for(var X=x.length,Z=-1/0,n=1/0,V=0;V<X;V++){var o=(Q[0][V]-x[V])/O[V],l=(Q[1][V]-x[V])/O[V];if(o>l){var C=o;o=l,l=C}if(l<Z||o>n)return 1/0;o>Z&&(Z=o),l<n&&(n=l)}return Z>n?1/0:Z}x.exports=function(x,Q,X,Z){var n=O(Q,X,Z);if(n===1/0)x=null;else{x=x||[];for(var V=0;V<Q.length;V++)x[V]=Q[V]+X[V]*n}return x},x.exports.distance=O},13190:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>V});var X=Q(23);const Z=X.useLayoutEffect;const n=function(x){var O=(0,X.useRef)(x);return Z((function(){O.current=x})),O};var V=function(x){var O=n(x);(0,X.LO)((function(){var x=function(x){var Q;if(null!=O.current&&(Q=O.current(x)),x.defaultPrevented&&(x.returnValue=""),"string"===typeof Q)return x.returnValue=Q,Q};return window.addEventListener("beforeunload",x),function(){window.removeEventListener("beforeunload",x)}}),[])}},13137:(x,O,Q)=>{"use strict";var X=Q(13141),Z=Array.prototype.concat,n=Array.prototype.slice,V=x.exports=function(x){for(var O=[],Q=0,V=x.length;Q<V;Q++){var o=x[Q];X(o)?O=Z.call(O,n.call(o)):O.push(o)}return O};V.wrap=function(x){return function(){return x(V(arguments))}}},13141:x=>{x.exports=function(x){return!(!x||"string"===typeof x)&&(x instanceof Array||Array.isArray(x)||x.length>=0&&(x.splice instanceof Function||Object.getOwnPropertyDescriptor(x,x.length-1)&&"String"!==x.constructor.name))}},12049:(x,O,Q)=>{var X=Q(12058);function Z(x){for(var O,Q,Z=0,n=x.length,V=0;V<x.length;){for(O=x[V],Q=0;V<n&&x[V]===O;)++V,++Q;Z+=X.log2(Q)/7|0,Z+=X.log2(O>>>0)/7|0,Z+=2}return Z}O.size=Z,O.encode=function(x,O){O||(O=new Uint8Array(Z(x)));for(var Q,X,n=0,V=O.length,o=0;o<x.length;){for(Q=x[o],X=0;o<x.length&&x[o]===Q;)++o,++X;for(;n<V&&X>=128;)O[n++]=128+(127&X),X>>>=7;if(n>=V)throw new Error("RLE buffer overflow");for(O[n++]=X,Q>>>=0;n<V&&Q>=128;)O[n++]=128+(127&Q),Q>>>=7;if(n>=V)throw new Error("RLE buffer overflow");O[n++]=Q}return O},O.decode=function(x,O){for(var Q,X,Z,n,V=O.length,o=x.length,l=0,C=0;C<o;){for(Q=0,X=0;C<o&&x[C]>=128;)Q+=(127&x[C++])<<X,X+=7;if(Q+=x[C++]<<X,C>=o)throw new Error("RLE buffer underrun");if(l+Q>V)throw new Error("Chunk buffer overflow");for(Z=0,X=0;C<o&&x[C]>=128;)Z+=(127&x[C++])<<X,X+=7;if(C>=o)throw new Error("RLE buffer underrun");for(Z+=x[C++]<<X,n=0;n<Q;++n)O[l++]=Z}return O}},12058:(x,O)=>{"use strict";function Q(x){var O=32;return(x&=-x)&&O--,65535&x&&(O-=16),16711935&x&&(O-=8),252645135&x&&(O-=4),858993459&x&&(O-=2),1431655765&x&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(x){return(x>0)-(x<0)},O.abs=function(x){var O=x>>31;return(x^O)-O},O.min=function(x,O){return O^(x^O)&-(x<O)},O.max=function(x,O){return x^(x^O)&-(x<O)},O.isPow2=function(x){return!(x&x-1)&&!!x},O.log2=function(x){var O,Q;return O=(x>65535)<<4,O|=Q=((x>>>=O)>255)<<3,O|=Q=((x>>>=Q)>15)<<2,(O|=Q=((x>>>=Q)>3)<<1)|(x>>>=Q)>>1},O.log10=function(x){return x>=1e9?9:x>=1e8?8:x>=1e7?7:x>=1e6?6:x>=1e5?5:x>=1e4?4:x>=1e3?3:x>=100?2:x>=10?1:0},O.popCount=function(x){return 16843009*((x=(858993459&(x-=x>>>1&1431655765))+(x>>>2&858993459))+(x>>>4)&252645135)>>>24},O.countTrailingZeros=Q,O.nextPow2=function(x){return x+=0===x,--x,x|=x>>>1,x|=x>>>2,x|=x>>>4,x|=x>>>8,(x|=x>>>16)+1},O.prevPow2=function(x){return x|=x>>>1,x|=x>>>2,x|=x>>>4,x|=x>>>8,(x|=x>>>16)-(x>>>1)},O.parity=function(x){return x^=x>>>16,x^=x>>>8,x^=x>>>4,27030>>>(x&=15)&1};var X=new Array(256);!function(x){for(var O=0;O<256;++O){var Q=O,X=O,Z=7;for(Q>>>=1;Q;Q>>>=1)X<<=1,X|=1&Q,--Z;x[O]=X<<Z&255}}(X),O.reverse=function(x){return X[255&x]<<24|X[x>>>8&255]<<16|X[x>>>16&255]<<8|X[x>>>24&255]},O.interleave2=function(x,O){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(x,O){return(x=65535&((x=16711935&((x=252645135&((x=858993459&((x=x>>>O&1431655765)|x>>>1))|x>>>2))|x>>>4))|x>>>16))<<16>>16},O.interleave3=function(x,O,Q){return x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2),(x|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},O.deinterleave3=function(x,O){return(x=1023&((x=4278190335&((x=251719695&((x=3272356035&((x=x>>>O&1227133513)|x>>>2))|x>>>4))|x>>>8))|x>>>16))<<22>>22},O.nextCombination=function(x){var O=x|x-1;return O+1|(~O&-~O)-1>>>Q(x)+1}},12086:x=>{"use strict";x.exports=function(x,O,Q,X){var Z=self||window;try{try{var n;try{n=new Z.Blob([x])}catch(C){(n=new(Z.BlobBuilder||Z.WebKitBlobBuilder||Z.MozBlobBuilder||Z.MSBlobBuilder)).append(x),n=n.getBlob()}var V=Z.URL||Z.webkitURL,o=V.createObjectURL(n),l=new Z[O](o,Q);return V.revokeObjectURL(o),l}catch(C){return new Z[O]("data:application/javascript,".concat(encodeURIComponent(x)),Q)}}catch(C){if(!X)throw Error("Inline worker is not supported");return new Z[O](X,Q)}}},11782:(x,O,Q)=>{"use strict";function X(x,O,Q,X,Z){var n={};return Object.keys(X).forEach((function(x){n[x]=X[x]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=Q.slice().reverse().reduce((function(Q,X){return X(x,O,Q)||Q}),n),Z&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(Z):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(x,O,n),n=null),n}Q.d(O,{b:()=>X})},11774:(x,O,Q)=>{"use strict";function X(x,O,Q,X){Q&&Object.defineProperty(x,O,{enumerable:Q.enumerable,configurable:Q.configurable,writable:Q.writable,value:Q.initializer?Q.initializer.call(X):void 0})}Q.d(O,{e:()=>X})},13174:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>V,e:()=>L,g:()=>o,i:()=>n,l:()=>l,p:()=>Z,t:()=>C,v:()=>U});var X=Q(11315);class Z{constructor(){this._easingMode=Z.EASINGMODE_EASEIN}setEasingMode(x){const O=Math.min(Math.max(x,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(x){throw new Error("You must implement this method")}ease(x){switch(this._easingMode){case Z.EASINGMODE_EASEIN:return this.easeInCore(x);case Z.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-x)}return x>=.5?.5*(1-this.easeInCore(2*(1-x)))+.5:.5*this.easeInCore(2*x)}}Z.EASINGMODE_EASEIN=0,Z.EASINGMODE_EASEOUT=1,Z.EASINGMODE_EASEINOUT=2;class n extends Z{easeInCore(x){return x=Math.max(0,Math.min(1,x)),1-Math.sqrt(1-x*x)}}class V extends Z{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=x}easeInCore(x){const O=Math.max(0,this.amplitude);return Math.pow(x,3)-x*O*Math.sin(3.141592653589793*x)}}class o extends Z{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=x,this.bounciness=O}easeInCore(x){const O=Math.max(0,this.bounces);let Q=this.bounciness;Q<=1&&(Q=1.001);const X=Math.pow(Q,O),Z=1-Q,n=(1-X)/Z+.5*X,V=x*n,o=Math.log(-V*(1-Q)+1)/Math.log(Q),l=Math.floor(o),C=l+1,U=(1-Math.pow(Q,l))/(Z*n),L=.5*(U+(1-Math.pow(Q,C))/(Z*n)),h=x-L,N=L-U;return-Math.pow(1/Q,O-l)/(N*N)*(h-N)*(h+N)}}class l extends Z{easeInCore(x){return x*x*x}}class C extends Z{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=x,this.springiness=O}easeInCore(x){let O;const Q=Math.max(0,this.oscillations),X=Math.max(0,this.springiness);return O=0==X?x:(Math.exp(X*x)-1)/(Math.exp(X)-1),O*Math.sin((6.283185307179586*Q+1.5707963267948966)*x)}}class U extends Z{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=x}easeInCore(x){return this.exponent<=0?x:(Math.exp(this.exponent*x)-1)/(Math.exp(this.exponent)-1)}}class L extends Z{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=x,this.y1=O,this.x2=Q,this.y2=X}easeInCore(x){return X.c.Interpolate(x,this.x1,this.y1,this.x2,this.y2)}}},12622:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>V});var X=Q(10849),Z=Q(10861),n=Q(11165);class V extends n.c{get _matrix(){return this._compose(),this.Qh}set _matrix(x){(x.updateFlag!==this.Qh.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Qh.V(x),this._markAsDirtyAndDecompose())}constructor(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(x,O.kx(),!1),this.name=x,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.Qh=(null===Z||void 0===Z?void 0:Z.clone())??X.c.Identity(),this._restMatrix=n??this.Qh.clone(),this._bindMatrix=V??this.Qh.clone(),this._index=o,this._absoluteMatrix=new X.c,this._absoluteBindMatrix=new X.c,this._absoluteInverseBindMatrix=new X.c,this._finalMatrix=new X.c,O.bones.push(this),this.setParent(Q,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(x){this.setParent(x)}setParent(x){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==x){if(this.parent){const x=this.parent.children.indexOf(this);-1!==x&&this.parent.children.splice(x,1)}this._parentNode=x,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.qC()}}getLocalMatrix(){return this._compose(),this.Qh}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(x){this._restMatrix.V(x)}setRestPose(x){this.setRestMatrix(x)}getBindPose(){return this.getBindMatrix()}setBindMatrix(x){this.Vo(x)}setBindPose(x){this.setBindMatrix(x)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const x=X.j.Oo[0],O=X.j.Quaternion[0],Q=X.j.Oo[1];this.getRestMatrix().decompose(x,O,Q),this._linkedTransformNode.position.V(Q),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??X.g.Identity(),this._linkedTransformNode.rotationQuaternion.V(O),this._linkedTransformNode.Qo.V(x)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(x){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=x,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.yo}set position(x){this._decompose(),this.yo.V(x),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(x){this.setRotation(x)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(x){this.setRotationQuaternion(x)}get Qo(){return this.getScale()}set Qo(x){this.setScale(x)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=X.n.Zero(),this._localRotation=X.g.Zero(),this.yo=X.n.Zero()),this.Qh.decompose(this._localScaling,this._localRotation,this.yo))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,X.c.ComposeToRef(this._localScaling,this._localRotation,this.yo,this.Qh)):this._needToCompose=!1)}Vo(x){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.V(x),O&&this._updateAbsoluteBindMatrices(),Q?this._matrix=x:this.qC()}_updateAbsoluteBindMatrices(x){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(x||(x=this._bindMatrix),this.parent?x.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.V(x),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let Q=0;Q<this.children.length;Q++)this.children[Q]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}qC(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.qC(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.qC(),this._needToDecompose=!0}_updatePosition(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=this.getLocalMatrix();if(0==O)Z?(n.addAtIndex(12,x.x),n.addAtIndex(13,x.y),n.addAtIndex(14,x.z)):n.setTranslationFromFloats(x.x,x.y,x.z);else{let O=null;Q&&(O=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const o=V._TmpMats[0],l=V._TmpVecs[0];this.parent?Q&&O?(o.V(this.parent.getAbsoluteMatrix()),o.multiplyToRef(O,o)):o.V(this.parent.getAbsoluteMatrix()):X.c.IdentityToRef(o),Z&&o.setTranslationFromFloats(0,0,0),o.invert(),X.n.TransformCoordinatesToRef(x,o,l),Z?(n.addAtIndex(12,l.x),n.addAtIndex(13,l.y),n.addAtIndex(14,l.z)):n.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()}translate(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(x,O,Q,!0)}setPosition(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(x,O,Q,!1)}setAbsolutePosition(x,O){this.setPosition(x,1,O)}scale(x,O,Q){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=this.getLocalMatrix(),o=V._TmpMats[0];X.c.ScalingToRef(x,O,Q,o),o.multiplyToRef(n,n),o.invert();for(const X of this.children){const Z=X.getLocalMatrix();Z.multiplyToRef(o,Z),Z.multiplyAtIndex(12,x),Z.multiplyAtIndex(13,O),Z.multiplyAtIndex(14,Q),X._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Z)for(const X of this.children)X.scale(x,O,Q,Z)}setScale(x){this._decompose(),this._localScaling.V(x),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(x){this._decompose(),x.V(this._localScaling)}setYawPitchRoll(x,O,Q){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;if(0===Z){const o=V._TmpQuat;return X.g.RotationYawPitchRollToRef(x,O,Q,o),void this.setRotationQuaternion(o,Z,n)}const o=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,n))return;const l=V._TmpMats[1];X.c.RotationYawPitchRollToRef(x,O,Q,l),o.multiplyToRef(l,l),this._rotateWithMatrix(l,Z,n)}rotate(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3?arguments[3]:void 0;const n=V._TmpMats[0];n.setTranslationFromFloats(0,0,0),X.c.RotationAxisToRef(x,O,n),this._rotateWithMatrix(n,Q,Z)}setAxisAngle(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3?arguments[3]:void 0;if(0===Q){const n=V._TmpQuat;return X.g.RotationAxisToRef(x,O,n),void this.setRotationQuaternion(n,Q,Z)}const n=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,Z))return;const o=V._TmpMats[1];X.c.RotationAxisToRef(x,O,o),n.multiplyToRef(o,o),this._rotateWithMatrix(o,Q,Z)}setRotation(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(x.y,x.x,x.z,O,Q)}setRotationQuaternion(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.V(x),void this._markAsDirtyAndCompose();const Z=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,Q))return;const n=V._TmpMats[1];X.c.FromQuaternionToRef(x,n),Z.multiplyToRef(n,n),this._rotateWithMatrix(n,O,Q)}setRotationMatrix(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===O){const Z=V._TmpQuat;return X.g.FromRotationMatrixToRef(x,Z),void this.setRotationQuaternion(Z,O,Q)}const Z=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,Q))return;const n=V._TmpMats[1];n.V(x),Z.multiplyToRef(x,n),this._rotateWithMatrix(n,O,Q)}_rotateWithMatrix(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const X=this.getLocalMatrix(),Z=X.m[12],n=X.m[13],o=X.m[14],l=this.getParent(),C=V._TmpMats[3],U=V._TmpMats[4];l&&1==O?(Q?(C.V(Q.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(C,C)):C.V(l.getAbsoluteMatrix()),U.V(C),U.invert(),X.multiplyToRef(C,X),X.multiplyToRef(x,X),X.multiplyToRef(U,X)):1==O&&Q?(C.V(Q.getWorldMatrix()),U.V(C),U.invert(),X.multiplyToRef(C,X),X.multiplyToRef(x,X),X.multiplyToRef(U,X)):X.multiplyToRef(x,X),X.setTranslationFromFloats(Z,n,o),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(x,O){const Q=V._TmpMats[2];return x.V(this.getAbsoluteMatrix()),O?(x.multiplyToRef(O.getWorldMatrix(),x),X.c.ScalingToRef(O.Qo.x,O.Qo.y,O.Qo.z,Q)):X.c.IdentityToRef(Q),x.invert(),!isNaN(x.m[0])&&(Q.multiplyAtIndex(0,this._scalingDeterminant),x.multiplyToRef(Q,x),!0)}en(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=X.n.Zero();return this.getPositionToRef(x,O,Q),Q}getPositionToRef(){let x=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const x=this.getLocalMatrix();O.x=x.m[12],O.y=x.m[13],O.z=x.m[14]}else{let Q=null;x&&(Q=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let X=V._TmpMats[0];x&&Q?(X.V(this.getAbsoluteMatrix()),X.multiplyToRef(Q,X)):X=this.getAbsoluteMatrix(),O.x=X.m[12],O.y=X.m[13],O.z=X.m[14]}}getAbsolutePosition(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=X.n.Zero();return this.getPositionToRef(1,x,O),O}getAbsolutePositionToRef(x,O){this.getPositionToRef(1,x,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Qh.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.V(this.Qh);const x=this._skeleton.getPoseMatrix();x&&this._absoluteMatrix.multiplyToRef(x,this._absoluteMatrix)}const x=this.children,O=x.length;for(let Q=0;Q<O;Q++)x[Q].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Nl(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=X.n.Zero();return this.getDirectionToRef(x,O,Q),Q}getDirectionToRef(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,Z=null;O&&(Z=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=V._TmpMats[0];n.V(this.getAbsoluteMatrix()),O&&Z&&n.multiplyToRef(Z,n),X.n.TransformNormalToRef(x,n,Q),Q.normalize()}getRotation(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=X.n.Zero();return this.getRotationToRef(x,O,Q),Q}getRotationToRef(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;const X=V._TmpQuat;this.getRotationQuaternionToRef(x,O,X),X.toEulerAnglesToRef(Q)}getRotationQuaternion(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=X.g.Identity();return this.getRotationQuaternionToRef(x,O,Q),Q}getRotationQuaternionToRef(){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.V(this._localRotation);else{const Q=V._TmpMats[0],X=this.getAbsoluteMatrix();x?X.multiplyToRef(x.getWorldMatrix(),Q):Q.V(X),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.decompose(void 0,O,void 0)}}getRotationMatrix(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const Q=X.c.Identity();return this.getRotationMatrixToRef(x,O,Q),Q}getRotationMatrixToRef(){let x=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const Q=V._TmpMats[0],X=this.getAbsoluteMatrix();x?X.multiplyToRef(x.getWorldMatrix(),Q):Q.V(X),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=X.n.Zero();return this.getAbsolutePositionFromLocalToRef(x,O,Q),Q}getAbsolutePositionFromLocalToRef(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,Z=null;O&&(Z=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=V._TmpMats[0];n.V(this.getAbsoluteMatrix()),O&&Z&&n.multiplyToRef(Z,n),X.n.TransformCoordinatesToRef(x,n,Q)}getLocalPositionFromAbsolute(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=X.n.Zero();return this.getLocalPositionFromAbsoluteToRef(x,O,Q),Q}getLocalPositionFromAbsoluteToRef(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,Z=null;O&&(Z=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=V._TmpMats[0];n.V(this.getAbsoluteMatrix()),O&&Z&&n.multiplyToRef(Z,n),n.invert(),X.n.TransformCoordinatesToRef(x,n,Q)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const x=this._skeleton.bones.indexOf(this);if(-1!==x&&this._skeleton.bones.splice(x,1),this._parentNode&&this._parentNode.children){const x=this._parentNode.children,O=x.indexOf(this);-1!==O&&x.splice(O,1)}super.dispose()}}V._TmpVecs=(0,Z.e)(2,X.n.Zero),V._TmpQuat=X.g.Identity(),V._TmpMats=(0,Z.e)(5,X.c.Identity)},13168:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>E});var X=Q(11039),Z=Q(11042),n=Q(10882),V=Q(10849),o=Q(10889),l=Q(11165),C=Q(11201),U=Q(11436),L=Q(10917),h=Q(10853);class N{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(x){this._zoomStopsAnimation=x}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(x){this._idleRotationSpeed=x}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(x){this._idleRotationWaitTime=x}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(x){this._idleRotationSpinupTime=x}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(x){this._attachedCamera=x;const O=this._attachedCamera.kx();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((x=>{x.type!==U.e.POINTERDOWN?x.type===U.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=x.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const x=L.c.Now;let O=0;null!=this._lastFrameTime&&(O=x-this._lastFrameTime),this._lastFrameTime=x,this._applyUserInteraction();const Q=x-this._lastInteractionTime-this._idleRotationWaitTime,X=Math.max(Math.min(Q/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*X,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const x=this._attachedCamera.kx();this._onPrePointerObservableObserver&&x.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(x){this._lastInteractionTime=x??L.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<h.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let x=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(x=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?x:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=L.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var a=Q(13174),K=Q(11538);class M{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(x){if(this._autoTransitionRange===x)return;this._autoTransitionRange=x;const O=this._attachedCamera;O&&(x?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((x=>{if(x&&(x.HV(!0),x.getBoundingInfo)){const O=x.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(x){this._attachedCamera=x,this._onAfterCheckInputsObserver=x.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(x){return!!this._attachedCamera&&(this._attachedCamera.radius===x&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(x){if(!this._attachedCamera)return;this._radiusBounceTransition||(M.EasingFunction.setEasingMode(M.EasingMode),this._radiusBounceTransition=K.b.CreateAnimation("radius",K.b.ANIMATIONTYPE_FLOAT,60,M.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=K.b.TransitionTo("radius",this._attachedCamera.radius+x,this._attachedCamera,this._attachedCamera.kx(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}M.EasingFunction=new a.c(.3),M.EasingMode=a.p.EASINGMODE_EASEOUT;class Y{constructor(){this.onTargetFramingAnimationEndObservable=new n.b,this._mode=Y.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(x){this._mode=x}get mode(){return this._mode}set radiusScale(x){this._radiusScale=x}get radiusScale(){return this._radiusScale}set positionScale(x){this._positionScale=x}get positionScale(){return this._positionScale}set defaultElevation(x){this._defaultElevation=x}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(x){this._elevationReturnTime=x}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(x){this._elevationReturnWaitTime=x}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(x){this._zoomStopsAnimation=x}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(x){this._framingTime=x}get framingTime(){return this._framingTime}init(){}attach(x){this._attachedCamera=x;const O=this._attachedCamera.kx();Y.EasingFunction.setEasingMode(Y.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((x=>{x.type!==U.e.POINTERDOWN?x.type===U.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=x.onMeshTargetChangedObservable.add((x=>{x&&x.getBoundingInfo&&this.zoomOnMesh(x,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=x.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const x=this._attachedCamera.kx();this._onPrePointerObservableObserver&&x.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x.HV(!0);const X=x.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(X.minimumWorld,X.maximumWorld,O,Q)}zoomOnMeshHierarchy(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x.HV(!0);const X=x.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(X.min,X.max,O,Q)}zoomOnMeshesHierarchy(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new V.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z=new V.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<x.length;n++){const O=x[n].getHierarchyBoundingVectors(!0);V.n.CheckExtends(O.min,X,Z),V.n.CheckExtends(O.max,X,Z)}this.zoomOnBoundingInfo(X,Z,O,Q)}zoomOnBoundingInfo(x,O){let Q,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const n=x.y,o=n+(O.y-n)*this._positionScale,l=O.hQ(x).scale(.5);if(!isFinite(o))return!1;if(X)Q=new V.n(0,o,0);else{const O=x.add(l);Q=new V.n(O.x,o,O.z)}this._vectorTransition||(this._vectorTransition=K.b.CreateAnimation("target",K.b.ANIMATIONTYPE_VECTOR3,60,Y.EasingFunction)),this._betaIsAnimating=!0;let C=K.b.TransitionTo("target",Q,this._attachedCamera,this._attachedCamera.kx(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let U=0;if(this._mode===Y.FitFrustumSidesMode){const Q=this._calculateLowerRadiusFromModelBoundingSphere(x,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.lo),U=Q}else this._mode===Y.IgnoreBoundsSizeMode&&(U=this._calculateLowerRadiusFromModelBoundingSphere(x,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.lo));if(this.autoCorrectCameraLimitsAndSensibility){const Q=O.hQ(x).length();this._attachedCamera.panningSensibility=5e3/Q,this._attachedCamera.wheelPrecision=100/U}return this._radiusTransition||(this._radiusTransition=K.b.CreateAnimation("radius",K.b.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction)),C=K.b.TransitionTo("radius",U,this._attachedCamera,this._attachedCamera.kx(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),Z&&Z(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(x,O){const Q=this._attachedCamera;if(!Q)return 0;let X=Q._calculateLowerRadiusFromModelBoundingSphere(x,O,this._radiusScale);return Q.lowerRadiusLimit&&this._mode===Y.IgnoreBoundsSizeMode&&(X=X<Q.lowerRadiusLimit?Q.lowerRadiusLimit:X),Q.upperRadiusLimit&&(X=X>Q.upperRadiusLimit?Q.upperRadiusLimit:X),X}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const x=L.c.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,Q=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Q&&x>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=K.b.CreateAnimation("beta",K.b.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction));const x=K.b.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.kx(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));x&&this._animatables.push(x)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=L.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Y.EasingFunction=new a.v,Y.EasingMode=a.p.EASINGMODE_EASEINOUT,Y.IgnoreBoundsSizeMode=0,Y.FitFrustumSidesMode=1;var g=Q(11206),v=Q(11396),R=Q(12615),s=Q(10894);class q{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(x){x=s.g.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),Q=O.getInputElement();let X=0,Z=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{var V,o;const l=n.event,C="touch"===l.pointerType;if(n.type!==U.e.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const L=l.target;if(this._altKey=l.altKey,this._ctrlKey=l.ctrlKey,this._metaKey=l.metaKey,this._shiftKey=l.shiftKey,this._buttonsPressed=l.buttons,O.isPointerLock){const x=l.movementX,O=l.movementY;this.onTouch(null,x,O),this._pointA=null,this._pointB=null}else{if(n.type!==U.e.POINTERDOWN&&n.type!==U.e.POINTERDOUBLETAP&&C&&(null===(V=this._pointA)||void 0===V?void 0:V.pointerId)!==l.pointerId&&(null===(o=this._pointB)||void 0===o?void 0:o.pointerId)!==l.pointerId)return;if(n.type!==U.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!C)if(n.type===U.e.POINTERDOUBLETAP)this.onDoubleTap(l.pointerType);else if(n.type!==U.e.POINTERUP||this._currentMousePointerIdDown!==l.pointerId&&!C){if(n.type===U.e.POINTERMOVE)if(x||l.preventDefault(),this._pointA&&null===this._pointB){const x=l.clientX-this._pointA.x,O=l.clientY-this._pointA.y;this._pointA.x=l.clientX,this._pointA.y=l.clientY,this.onTouch(this._pointA,x,O)}else if(this._pointA&&this._pointB){const x=this._pointA.pointerId===l.pointerId?this._pointA:this._pointB;x.x=l.clientX,x.y=l.clientY;const O=this._pointA.x-this._pointB.x,Q=this._pointA.y-this._pointB.y,V=O*O+Q*Q,o={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:l.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,X,V,Z,o),Z=o,X=V}}else{try{null===L||void 0===L||L.releasePointerCapture(l.pointerId)}catch(h){}C||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==l.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==l.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==X||Z)&&(this.onMultiTouch(this._pointA,this._pointB,X,0,Z,null),X=0,Z=null),this._currentMousePointerIdDown=-1,this.onButtonUp(l),x||l.preventDefault()}else{try{null===L||void 0===L||L.setPointerCapture(l.pointerId)}catch(h){}if(null===this._pointA)this._pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType};else{if(null!==this._pointB)return;this._pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}}-1!==this._currentMousePointerIdDown||C||(this._currentMousePointerIdDown=l.pointerId),this.onButtonDown(l),x||(l.preventDefault(),Q&&Q.focus())}}},this._observer=this.camera.kx()._inputManager._addCameraPointerObserver(this._pointerInput,U.e.POINTERDOWN|U.e.POINTERUP|U.e.POINTERMOVE|U.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,X=0,Z=null,this.onLostFocus()},this._contextMenuBind=x=>this.onContextMenu(x),Q&&Q.addEventListener("contextmenu",this._contextMenuBind,!1);const n=this.camera.kx().getEngine().getHostWindow();n&&s.g.RegisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}CL(){if(this._onLostFocus){const x=this.camera.kx().getEngine().getHostWindow();x&&s.g.UnregisterTopRootEvents(x,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.kx()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const x=this.camera.kx().getEngine().getInputElement();x&&x.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(x){}onTouch(x,O,Q){}onMultiTouch(x,O,Q,X,Z,n){}onContextMenu(x){x.preventDefault()}onButtonDown(x){}onButtonUp(x){}onLostFocus(){}}(0,X.b)([(0,Z.L)()],q.prototype,"buttons",void 0);class G extends q{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(x,O){if(0!==this.panningSensibility&&x&&O){const Q=O.x-x.x,X=O.y-x.y;this.camera.inertialPanningX+=-Q/this.panningSensibility,this.camera.inertialPanningY+=X/this.panningSensibility}}_computePinchZoom(x,O){const Q=this.camera.radius||G.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Q*Math.sqrt(x)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-x)*Q*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-x)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(x,O,Q){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=Q/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(x,O,Q,X,Z,n){0===Q&&null===Z||0===X&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(Q,X),this._computeMultiTouchPanning(Z,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(X)-Math.sqrt(Q))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Q,X),this._isPinching=!0):this._computeMultiTouchPanning(Z,n)):this.multiTouchPanning?this._computeMultiTouchPanning(Z,n):this.pinchZoom&&this._computePinchZoom(Q,X))}onButtonDown(x){this._isPanClick=x.button===this.camera._panningMouseButton}onButtonUp(x){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}G.MinimumRadiusForPinch=.001,(0,X.b)([(0,Z.L)()],G.prototype,"buttons",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"angularSensibilityX",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"angularSensibilityY",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"pinchPrecision",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"pinchDeltaPercentage",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"useNaturalPinchZoom",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"pinchZoom",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"panningSensibility",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"multiTouchPanning",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"multiTouchPanAndZoom",void 0),R.d.ArcRotateCameraPointersInput=G;var k=Q(11443);class J{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(x){x=s.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.kx(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const Q=O.event;if(!Q.metaKey)if(O.type===k.e.KEYDOWN){if(this._ctrlPressed=Q.ctrlKey,this._altPressed=Q.altKey,-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),Q.preventDefault&&(x||Q.preventDefault())}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){const O=this._keys.indexOf(Q.keyCode);O>=0&&this._keys.splice(O,1),Q.preventDefault&&(x||Q.preventDefault())}})))}CL(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const x=this.camera;for(let O=0;O<this._keys.length;O++){const Q=this._keys[O];-1!==this.keysLeft.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?x.inertialPanningX-=1/this.panningSensibility:x.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?x.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?x.inertialRadiusOffset+=1/this.zoomingSensibility:x.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?x.inertialPanningX+=1/this.panningSensibility:x.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?x.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?x.inertialRadiusOffset-=1/this.zoomingSensibility:x.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Q)&&x.useInputToRestoreState&&x.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,X.b)([(0,Z.L)()],J.prototype,"keysUp",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"keysDown",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"keysLeft",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"keysRight",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"keysReset",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"panningSensibility",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"zoomingSensibility",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"useAltToZoom",void 0),(0,X.b)([(0,Z.L)()],J.prototype,"angularSpeed",void 0),R.d.ArcRotateCameraKeyboardMoveInput=J;var t=Q(11116),c=Q(11448);class d{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new V.n(0,0,0),this._globalOffset=new V.n(0,0,0),this._inertialPanning=V.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(x,O){let Q=0;const X=.01*x*this.wheelDeltaPercentage*O;return Q=x>0?X/(1+this.wheelDeltaPercentage):X*(1+this.wheelDeltaPercentage),Q}attachControl(x){x=s.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==U.e.POINTERWHEEL)return;const Q=O.event;let X=0;const Z=Q.deltaMode===c.d.DOM_DELTA_LINE?40:1,n=-Q.deltaY*Z;if(this.customComputeDeltaFromMouseWheel)X=this.customComputeDeltaFromMouseWheel(n,this,Q);else if(this.wheelDeltaPercentage){if(X=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),X>0){let x=this.camera.radius,O=this.camera.inertialRadiusOffset+X;for(let Q=0;Q<20&&!(x<=O)&&!(Math.abs(O*this.camera.inertia)<.001);Q++)x-=O,O*=this.camera.inertia;x=(0,o.Clamp)(x,0,Number.MAX_VALUE),X=this._computeDeltaFromMouseWheelLegacyEvent(n,x)}}else X=n/(40*this.wheelPrecision);X&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(X)):this.camera.inertialRadiusOffset+=X),Q.preventDefault&&(x||Q.preventDefault())},this._observer=this.camera.kx()._inputManager._addCameraPointerObserver(this._wheel,U.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Zo(0)}CL(){this._observer&&(this.camera.kx()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const x=this.camera;0+x.inertialAlphaOffset+x.inertialBetaOffset+x.inertialRadiusOffset&&(this._updateHitPlane(),x.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(x.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const x=this.camera,O=x.target.hQ(x.position);this._hitPlane=t.b.FromPositionAndNormal(x.target,O)}_getPosition(){const x=this.camera,O=x.kx(),Q=O.createPickingRay(O.pointerX,O.pointerY,V.c.Identity(),x,!1);0===x.targetScreenOffset.x&&0===x.targetScreenOffset.y||(this._viewOffset.set(x.targetScreenOffset.x,x.targetScreenOffset.y,0),x.getViewMatrix().invertToRef(x._cameraTransformMatrix),this._globalOffset=V.n.TransformNormal(this._viewOffset,x._cameraTransformMatrix),Q.origin.addInPlace(this._globalOffset));let X=0;return this._hitPlane&&(X=Q.intersectsPlane(this._hitPlane)??0),Q.origin.addInPlace(Q.direction.scaleInPlace(X))}_zoomToMouse(x){const O=this.camera,Q=1-O.inertia;if(O.lowerRadiusLimit){const X=O.lowerRadiusLimit??0;O.radius-(O.inertialRadiusOffset+x)/Q<X&&(x=(O.radius-X)*Q-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const X=O.upperRadiusLimit??0;O.radius-(O.inertialRadiusOffset+x)/Q>X&&(x=(O.radius-X)*Q-O.inertialRadiusOffset)}const X=x/Q/O.radius,Z=this._getPosition(),n=V.j.Oo[6];Z.subtractToRef(O.target,n),n.scaleInPlace(X),n.scaleInPlace(Q),this._inertialPanning.addInPlace(n),O.inertialRadiusOffset+=x}_zeroIfClose(x){Math.abs(x.x)<h.e&&(x.x=0),Math.abs(x.y)<h.e&&(x.y=0),Math.abs(x.z)<h.e&&(x.z=0)}}(0,X.b)([(0,Z.L)()],d.prototype,"wheelPrecision",void 0),(0,X.b)([(0,Z.L)()],d.prototype,"zoomToMouseLocation",void 0),(0,X.b)([(0,Z.L)()],d.prototype,"wheelDeltaPercentage",void 0),R.d.ArcRotateCameraMouseWheelInput=d;class u extends R.g{constructor(x){super(x)}addMouseWheel(){return this.add(new d),this}addPointers(){return this.add(new G),this}addKeyboard(){return this.add(new J),this}}var A=Q(10866);function f(x,O){return isNaN(x)?O:x}l.c.AddNodeConstructor("ArcRotateCamera",((x,O)=>()=>new E(x,0,0,1,V.n.Zero(),O)));class E extends v.c{get target(){return this._target}set target(x){this.setTarget(x)}get targetHost(){return this._targetHost}set targetHost(x){x&&this.setTarget(x)}getTarget(){return this.target}get position(){return this._position}set position(x){this.setPosition(x)}set upVector(x){this._upToYMatrix||(this._yToUpMatrix=new V.c,this._upToYMatrix=new V.c,this._upVector=V.n.Zero()),x.normalize(),this._upVector.V(x),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){V.c.RotationAlignToRef(V.n.UpReadOnly,this._upVector,this._yToUpMatrix),V.c.RotationAlignToRef(this._upVector,V.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const x=this.inputs.attached.pointers;return x?x.angularSensibilityX:0}set angularSensibilityX(x){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=x)}get angularSensibilityY(){const x=this.inputs.attached.pointers;return x?x.angularSensibilityY:0}set angularSensibilityY(x){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=x)}get pinchPrecision(){const x=this.inputs.attached.pointers;return x?x.pinchPrecision:0}set pinchPrecision(x){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=x)}get pinchDeltaPercentage(){const x=this.inputs.attached.pointers;return x?x.pinchDeltaPercentage:0}set pinchDeltaPercentage(x){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=x)}get useNaturalPinchZoom(){const x=this.inputs.attached.pointers;return!!x&&x.useNaturalPinchZoom}set useNaturalPinchZoom(x){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=x)}get panningSensibility(){const x=this.inputs.attached.pointers;return x?x.panningSensibility:0}set panningSensibility(x){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=x)}get keysUp(){const x=this.inputs.attached.keyboard;return x?x.keysUp:[]}set keysUp(x){const O=this.inputs.attached.keyboard;O&&(O.keysUp=x)}get keysDown(){const x=this.inputs.attached.keyboard;return x?x.keysDown:[]}set keysDown(x){const O=this.inputs.attached.keyboard;O&&(O.keysDown=x)}get keysLeft(){const x=this.inputs.attached.keyboard;return x?x.keysLeft:[]}set keysLeft(x){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=x)}get keysRight(){const x=this.inputs.attached.keyboard;return x?x.keysRight:[]}set keysRight(x){const O=this.inputs.attached.keyboard;O&&(O.keysRight=x)}get wheelPrecision(){const x=this.inputs.attached.mousewheel;return x?x.wheelPrecision:0}set wheelPrecision(x){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=x)}get zoomToMouseLocation(){const x=this.inputs.attached.mousewheel;return!!x&&x.zoomToMouseLocation}set zoomToMouseLocation(x){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=x)}get wheelDeltaPercentage(){const x=this.inputs.attached.mousewheel;return x?x.wheelDeltaPercentage:0}set wheelDeltaPercentage(x){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=x)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(x){x!==this.useBouncingBehavior&&(x?(this._bouncingBehavior=new M,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(x){x!==this.useFramingBehavior&&(x?(this._framingBehavior=new Y,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(x){x!==this.useAutoRotationBehavior&&(x?(this._autoRotationBehavior=new N,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(x,O,Q,X,Z,o){var l;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(x,V.n.Zero(),o,C),l=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=V.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=V.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new V.c,this.panningAxis=new V.n(1,1,0),this._transformedDirection=new V.n,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new n.b,this.checkCollisions=!1,this.collisionRadius=new V.n(.5,.5,.5),this._previousPosition=V.n.Zero(),this._collisionVelocity=V.n.Zero(),this._newPosition=V.n.Zero(),this._computationVector=V.n.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new V.n(NaN,NaN,NaN),this._goalTargetScreenOffset=new V.l(NaN,NaN),this._onCollisionPositionChange=function(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q?(l.setPosition(O),l.lN&&l.lN(Q)):l._previousPosition.V(l._position);const X=Math.cos(l.alpha),Z=Math.sin(l.alpha),n=Math.cos(l.beta);let V=Math.sin(l.beta);0===V&&(V=1e-4);const o=l._getTargetPosition();l._computationVector.xo(l.radius*X*V,l.radius*n,l.radius*Z*V),o.addToRef(l._computationVector,l._newPosition),l._position.V(l._newPosition);let C=l.upVector;l.allowUpsideDown&&l.beta<0&&(C=C.clone(),C=C.negate()),l._computeViewMatrix(l._position,o,C),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},this._target=V.n.Zero(),Z&&this.setTarget(Z),this.alpha=O,this.beta=Q,this.radius=X,this.getViewMatrix(),this.inputs=new u(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new V.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=V.l.Zero()}_updateCache(x){x||super._updateCache(),this._cache._target.V(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.V(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const x=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?x.addToRef(this._targetBoundingCenter,this._target):this._target.V(x)}const x=this._getLockedTargetPosition();return x||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>h.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,n=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=n?this._currentInterpolationFactor=n:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=f(x,this._goalAlpha),this._goalBeta=f(O,this._goalBeta),this._goalRadius=f(Q,this._goalRadius),this._goalTarget.set(f(X.x,this._goalTarget.x),f(X.y,this._goalTarget.y),f(X.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(f(Z.x,this._goalTargetScreenOffset.x),f(Z.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,o.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,o.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,o.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,o.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(x,O){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const Z=arguments;O=s.g.BackCompatCameraNoPreventDefault(Z),this._useCtrlForPanning=Q,this._panningMouseButton=X,"boolean"===typeof Z[0]&&(Z.length>1&&(this._useCtrlForPanning=Z[1]),Z.length>2&&(this._panningMouseButton=Z[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}CL(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let x=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){x=!0;const O=this.invertRotation?-1:1,Q=this._calculateHandednessMultiplier();let X=this.inertialAlphaOffset*Q;this.beta<0&&(X*=-1),this.alpha+=X*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<h.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<h.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*h.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){x=!0;const O=new V.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),V.n.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const x=this.upVector,O=V.n.CrossToRef(this._transformedDirection,x,this._transformedDirection);V.n.CrossToRef(x,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);V.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.V(this._transformedDirection)}else{if(this.parent){const x=V.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(x),x.transposeToRef(x),V.n.TransformCoordinatesToRef(this._transformedDirection,x,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*h.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*h.e&&(this.inertialPanningY=0)}if(x)this.stopInterpolation();else if(this._isInterpolating){let x=!1;const O=this._scene.getEngine().getDeltaTime()/1e3,Q=1-Math.pow(2,-O/this._currentInterpolationFactor),X=f(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const O=V.j.Oo[0].set(f(this._goalTarget.x,this._target.x),f(this._goalTarget.y,this._target.y),f(this._goalTarget.z,this._target.z));V.n.LerpToRef(this.target,O,Q,this._target),10*V.n.Distance(this.target,O)/X<h.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.V(O),this.setTarget(this.target,!1,!0,!0)):x=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const O=V.g.RotationAlphaBetaGammaToRef(f(this._goalAlpha,this.alpha),f(this._goalBeta,this.beta),0,V.j.Quaternion[0]),X=V.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,V.j.Quaternion[1]),Z=V.g.SlerpToRef(X,O,Q,V.j.Quaternion[2]);Z.normalize();const n=Z.toAlphaBetaGammaToRef(V.j.Oo[0]);if(this.alpha=n.x,this.beta=n.y,Z.isApprox(O,h.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const x=O.toAlphaBetaGammaToRef(V.j.Oo[0]);this.alpha=x.x,this.beta=x.y}else x=!0}if(isNaN(this._goalRadius)||(this.radius+=(X-this.radius)*Q,Math.abs(X/this.radius-1)<h.e?(this._goalRadius=NaN,this.radius=X):x=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const O=V.j.Vector2[0].set(f(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),f(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));V.l.LerpToRef(this.targetScreenOffset,O,Q,this.targetScreenOffset),V.l.Distance(this.targetScreenOffset,O)<h.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.V(O)):x=!0}this._isInterpolating=x}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||V.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const x=this.alpha;var O,Q;this.alpha=function(x){let O=Math.PI/2;return 0===x.x&&0===x.z||(O=Math.acos(x.x/Math.sqrt(Math.pow(x.x,2)+Math.pow(x.z,2)))),x.z<0&&(O=2*Math.PI-O),O}(this._computationVector),this.beta=(O=this._computationVector.y,Q=this.radius,Math.acos(O/Q));const X=Math.round((x-this.alpha)/(2*Math.PI));this.alpha+=2*X*Math.PI,this._checkLimits()}setPosition(x){this._position.equals(x)||(this._position.V(x),this.rebuildAnglesAndRadius())}setTarget(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(X=this.overrideCloneAlphaBetaRadius??X,x.HV)O&&x.getBoundingInfo?this._targetBoundingCenter=x.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,x.HV(),this._targetHost=x,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=x,X=this._getTargetPosition();if(X&&!Q&&X.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}X||this.rebuildAnglesAndRadius()}_getViewMatrix(){const x=Math.cos(this.alpha),O=Math.sin(this.alpha),Q=Math.cos(this.beta);let X=Math.sin(this.beta);0===X&&(X=1e-4),0===this.radius&&(this.radius=1e-4);const Z=this._getTargetPosition();if(this._computationVector.xo(this.radius*x*X,this.radius*Q,this.radius*O*X),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||V.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),Z.addToRef(this._computationVector,this._newPosition),this.kx().collisionsEnabled&&this.checkCollisions){const x=this.kx().collisionCoordinator;this._collider||(this._collider=x.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,x.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.V(this._newPosition);let x=this.upVector;this.allowUpsideDown&&X<0&&(x=x.negate()),this._computeViewMatrix(this._position,Z,x),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.V(Z),this._viewMatrix}zoomOn(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x=x||this.kx().meshes;const Q=C.b.MinMax(x);let X=this._calculateLowerRadiusFromModelBoundingSphere(Q.min,Q.max);if(X=Math.max(Math.min(X,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=X*this.zoomOnFactor,this.mode===g.e.ORTHOGRAPHIC_CAMERA){const x=this.kx().getEngine().getAspectRatio(this),O=X*this.zoomOnFactor/2;this.orthoLeft=-O*x,this.orthoRight=O*x,this.orthoBottom=-O,this.orthoTop=O}this.focusOn({min:Q.min,max:Q.max,distance:X},O)}focusOn(x){let O,Q,X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===x.min){const X=x||this.kx().meshes;O=C.b.MinMax(X),Q=V.n.Distance(O.min,O.max)}else{O=x,Q=x.distance}this._target=C.b.Center(O),X||(this.maxZ=2*Q)}createRigCamera(x,O){let Q=0;switch(this.cameraRigMode){case g.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case g.e.RIG_MODE_VR:Q=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Q=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const X=new E(x,this.alpha+Q,this.beta,this.radius,this._target,this.kx());return X._cameraRigParams={},X.isRigCamera=!0,X.rigParent=this,X.upVector=this.upVector,X.mode=this.mode,X.orthoLeft=this.orthoLeft,X.orthoRight=this.orthoRight,X.orthoBottom=this.orthoBottom,X.orthoTop=this.orthoTop,X}_updateRigCameras(){const x=this._rigCameras[0],O=this._rigCameras[1];switch(x.beta=O.beta=this.beta,this.cameraRigMode){case g.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case g.e.RIG_MODE_VR:x.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:x.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const X=V.n.Distance(x,O),Z=this.kx().getEngine().getAspectRatio(this),n=Math.tan(this.fov/2),o=n*Z,l=.5*X*Q,C=l*Math.sqrt(1+1/(o*o)),U=l*Math.sqrt(1+1/(n*n));return Math.max(C,U)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,X.b)([(0,Z.L)()],E.prototype,"alpha",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"beta",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"radius",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,X.b)([(0,Z.K)("target")],E.prototype,"_target",void 0),(0,X.b)([(0,Z.C)("targetHost")],E.prototype,"_targetHost",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"inertialAlphaOffset",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"inertialBetaOffset",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"inertialRadiusOffset",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"lowerAlphaLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"upperAlphaLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"lowerBetaLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"upperBetaLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"lowerRadiusLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"upperRadiusLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"lowerTargetYLimit",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"inertialPanningX",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"inertialPanningY",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"pinchToPanMaxDistance",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"panningDistanceLimit",void 0),(0,X.b)([(0,Z.K)()],E.prototype,"panningOriginTarget",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"panningInertia",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"zoomToMouseLocation",null),(0,X.b)([(0,Z.L)()],E.prototype,"zoomOnFactor",void 0),(0,X.b)([(0,Z.H)()],E.prototype,"targetScreenOffset",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"allowUpsideDown",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"useInputToRestoreState",void 0),(0,X.b)([(0,Z.L)()],E.prototype,"restoreStateInterpolationFactor",void 0),(0,A.d)("BABYLON.ArcRotateCamera",E)},12615:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>V,g:()=>o});var X=Q(10905),Z=Q(11122),n=Q(11206),V={};class o{constructor(x){this.attachedToElement=!1,this.attached={},this.camera=x,this.checkInputs=()=>{}}add(x){const O=x.getSimpleName();this.attached[O]?X.e.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=x,x.camera=this.camera,x.checkInputs&&(this.checkInputs=this._addCheckInputs(x.checkInputs.bind(x))),this.attachedToElement&&x.attachControl(this.noPreventDefault))}remove(x){for(const O in this.attached){const Q=this.attached[O];if(Q===x)return Q.CL(),Q.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(x){for(const O in this.attached){const Q=this.attached[O];Q.getClassName()===x&&(Q.CL(),Q.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(x){const O=this.checkInputs;return()=>{O(),x()}}attachInput(x){this.attachedToElement&&x.attachControl(this.noPreventDefault)}attachElement(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){x=!n.e.ForceAttachControlToAlwaysPreventDefault&&x,this.attachedToElement=!0,this.noPreventDefault=x;for(const O in this.attached)this.attached[O].attachControl(x)}}detachElement(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].CL(),x&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const x in this.attached){const O=this.attached[x];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(x){const O={};for(const Q in this.attached){const x=this.attached[Q],X=Z.c.Serialize(x);O[x.getClassName()]=X}x.inputsmgr=O}parse(x){const O=x.inputsmgr;if(O){this.clear();for(const x in O){const Q=V[x];if(Q){const X=O[x],n=Z.c.Parse((()=>new Q),X,null);this.add(n)}}}else for(const Q in this.attached){const O=V[this.attached[Q].getClassName()];if(O){const X=Z.c.Parse((()=>new O),x,null);this.remove(this.attached[Q]),this.add(X)}}}}},12608:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>q});var X=Q(11039),Z=Q(11042),n=Q(10849),V=Q(11396),o=Q(12615),l=Q(11443),C=Q(10894);class U{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(x){x=C.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.kx(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const Q=O.event;if(!Q.metaKey)if(O.type===l.e.KEYDOWN){if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),x||Q.preventDefault()}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){const O=this._keys.indexOf(Q.keyCode);O>=0&&this._keys.splice(O,1),x||Q.preventDefault()}})))}CL(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const x=this.camera;for(let O=0;O<this._keys.length;O++){const Q=this._keys[O],X=x._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Q)?x._localDirection.xo(-X,0,0):-1!==this.keysUp.indexOf(Q)?x._localDirection.xo(0,0,X):-1!==this.keysRight.indexOf(Q)?x._localDirection.xo(X,0,0):-1!==this.keysDown.indexOf(Q)?x._localDirection.xo(0,0,-X):-1!==this.keysUpward.indexOf(Q)?x._localDirection.xo(0,X,0):-1!==this.keysDownward.indexOf(Q)?x._localDirection.xo(0,-X,0):-1!==this.keysRotateLeft.indexOf(Q)?(x._localDirection.xo(0,0,0),x.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Q)?(x._localDirection.xo(0,0,0),x.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Q)?(x._localDirection.xo(0,0,0),x.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Q)&&(x._localDirection.xo(0,0,0),x.cameraRotation.x+=this._getLocalRotation()),x.kx().useRightHandedSystem&&(x._localDirection.z*=-1),x.getViewMatrix().invertToRef(x._cameraTransformMatrix),n.n.TransformNormalToRef(x._localDirection,x._cameraTransformMatrix,x._transformedDirection),x.cameraDirection.addInPlace(x._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const x=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*x}}(0,X.b)([(0,Z.L)()],U.prototype,"keysUp",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysUpward",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysDown",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysDownward",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysLeft",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysRight",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"rotationSpeed",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysRotateLeft",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysRotateRight",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysRotateUp",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"keysRotateDown",void 0),o.d.FreeCameraKeyboardMoveInput=U;var L=Q(10882),h=Q(11436);class N{constructor(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=x,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new L.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(x){x=C.g.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),Q=O.getInputElement();this._pointerInput||(this._pointerInput=X=>{const Z=X.event,n="touch"===Z.pointerType;if(!this.touchEnabled&&n)return;if(X.type!==h.e.POINTERMOVE&&-1===this.buttons.indexOf(Z.button))return;const V=Z.target;if(X.type===h.e.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=Z.pointerId;try{null===V||void 0===V||V.setPointerCapture(Z.pointerId)}catch(o){}-1===this._currentActiveButton&&(this._currentActiveButton=Z.button),this._previousPosition={x:Z.clientX,y:Z.clientY},x||(Z.preventDefault(),Q&&Q.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(X.event)}else if(X.type===h.e.POINTERUP){if(n&&this._activePointerId!==Z.pointerId||!n&&this._currentActiveButton!==Z.button)return;try{null===V||void 0===V||V.releasePointerCapture(Z.pointerId)}catch(o){}this._currentActiveButton=-1,this._previousPosition=null,x||Z.preventDefault(),this._activePointerId=-1}else if(X.type===h.e.POINTERMOVE&&(this._activePointerId===Z.pointerId||!n))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(X.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),Q=(Z.clientX-this._previousPosition.x)*O,X=Z.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Q/this.angularSensibility,this.camera.cameraRotation.x+=X/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Q,offsetY:X}),this._previousPosition={x:Z.clientX,y:Z.clientY},x||Z.preventDefault()}}),this._onMouseMove=Q=>{if(!O.isPointerLock)return;const X=this.camera._calculateHandednessMultiplier(),Z=Q.movementX*X;this.camera.cameraRotation.y+=Z/this.angularSensibility;const n=Q.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,x||Q.preventDefault()},this._observer=this.camera.kx()._inputManager._addCameraPointerObserver(this._pointerInput,h.e.POINTERDOWN|h.e.POINTERUP|h.e.POINTERMOVE),Q&&(this._contextMenuBind=x=>this.onContextMenu(x),Q.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(x){x.preventDefault()}CL(){if(this._observer){if(this.camera.kx()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const x=this.camera.getEngine().getInputElement();x&&x.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,X.b)([(0,Z.L)()],N.prototype,"buttons",void 0),(0,X.b)([(0,Z.L)()],N.prototype,"angularSensibility",void 0),o.d.FreeCameraMouseInput=N;var a,K=Q(11448);class M{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new L.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(x){x=C.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==h.e.POINTERWHEEL)return;const Q=O.event,X=Q.deltaMode===K.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*X*Q.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*X*Q.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*X*Q.deltaZ/this._normalize,Q.preventDefault&&(x||Q.preventDefault())},this._observer=this.camera.kx()._inputManager._addCameraPointerObserver(this._wheel,h.e.POINTERWHEEL)}CL(){this._observer&&(this.camera.kx()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,X.b)([(0,Z.L)()],M.prototype,"wheelPrecisionX",void 0),(0,X.b)([(0,Z.L)()],M.prototype,"wheelPrecisionY",void 0),(0,X.b)([(0,Z.L)()],M.prototype,"wheelPrecisionZ",void 0),function(x){x[x.MoveRelative=0]="MoveRelative",x[x.RotateRelative=1]="RotateRelative",x[x.MoveScene=2]="MoveScene"}(a||(a={}));class Y extends M{constructor(){super(...arguments),this._moveRelative=n.n.Zero(),this._rotateRelative=n.n.Zero(),this._moveScene=n.n.Zero(),this._wheelXAction=a.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=a.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(x){null===x&&this._wheelXAction!==a.MoveRelative||(this._wheelXAction=a.MoveRelative,this._wheelXActionCoordinate=x)}get wheelXMoveRelative(){return this._wheelXAction!==a.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(x){null===x&&this._wheelYAction!==a.MoveRelative||(this._wheelYAction=a.MoveRelative,this._wheelYActionCoordinate=x)}get wheelYMoveRelative(){return this._wheelYAction!==a.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(x){null===x&&this._wheelZAction!==a.MoveRelative||(this._wheelZAction=a.MoveRelative,this._wheelZActionCoordinate=x)}get wheelZMoveRelative(){return this._wheelZAction!==a.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(x){null===x&&this._wheelXAction!==a.RotateRelative||(this._wheelXAction=a.RotateRelative,this._wheelXActionCoordinate=x)}get wheelXRotateRelative(){return this._wheelXAction!==a.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(x){null===x&&this._wheelYAction!==a.RotateRelative||(this._wheelYAction=a.RotateRelative,this._wheelYActionCoordinate=x)}get wheelYRotateRelative(){return this._wheelYAction!==a.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(x){null===x&&this._wheelZAction!==a.RotateRelative||(this._wheelZAction=a.RotateRelative,this._wheelZActionCoordinate=x)}get wheelZRotateRelative(){return this._wheelZAction!==a.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(x){null===x&&this._wheelXAction!==a.MoveScene||(this._wheelXAction=a.MoveScene,this._wheelXActionCoordinate=x)}get wheelXMoveScene(){return this._wheelXAction!==a.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(x){null===x&&this._wheelYAction!==a.MoveScene||(this._wheelYAction=a.MoveScene,this._wheelYActionCoordinate=x)}get wheelYMoveScene(){return this._wheelYAction!==a.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(x){null===x&&this._wheelZAction!==a.MoveScene||(this._wheelZAction=a.MoveScene,this._wheelZActionCoordinate=x)}get wheelZMoveScene(){return this._wheelZAction!==a.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Zo(0),this._rotateRelative.Zo(0),this._moveScene.Zo(0),this._updateCamera(),this.camera.kx().useRightHandedSystem&&(this._moveRelative.z*=-1);const x=n.c.Zero();this.camera.getViewMatrix().invertToRef(x);const O=n.n.Zero();n.n.TransformNormalToRef(this._moveRelative,x,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(x,O,Q){if(0===x)return;if(null===O||null===Q)return;let X=null;switch(O){case a.MoveRelative:X=this._moveRelative;break;case a.RotateRelative:X=this._rotateRelative;break;case a.MoveScene:X=this._moveScene}switch(Q){case 0:X.set(x,0,0);break;case 1:X.set(0,x,0);break;case 2:X.set(0,0,x)}}}(0,X.b)([(0,Z.L)()],Y.prototype,"wheelXMoveRelative",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelYMoveRelative",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelZMoveRelative",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelXRotateRelative",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelYRotateRelative",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelZRotateRelative",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelXMoveScene",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelYMoveScene",null),(0,X.b)([(0,Z.L)()],Y.prototype,"wheelZMoveScene",null),o.d.FreeCameraMouseWheelInput=Y;class g{constructor(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=x,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.g.IsSafari()}attachControl(x){x=C.g.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Q=>{const X=Q.event,Z="mouse"===X.pointerType||this._isSafari&&"undefined"===typeof X.pointerType;if(this.allowMouse||!Z)if(Q.type===h.e.POINTERDOWN){if(x||X.preventDefault(),this._pointerPressed.push(X.pointerId),1!==this._pointerPressed.length)return;O={x:X.clientX,y:X.clientY}}else if(Q.type===h.e.POINTERUP){x||X.preventDefault();const Q=this._pointerPressed.indexOf(X.pointerId);if(-1===Q)return;if(this._pointerPressed.splice(Q,1),0!=Q)return;O=null,this._offsetX=null,this._offsetY=null}else if(Q.type===h.e.POINTERMOVE){if(x||X.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(X.pointerId))return;this._offsetX=X.clientX-O.x,this._offsetY=-(X.clientY-O.y)}}),this._observer=this.camera.kx()._inputManager._addCameraPointerObserver(this._pointerInput,h.e.POINTERDOWN|h.e.POINTERUP|h.e.POINTERMOVE),this._onLostFocus){const x=this.camera.getEngine().getInputElement();x&&x.addEventListener("blur",this._onLostFocus)}}CL(){if(this._pointerInput){if(this._observer&&(this.camera.kx()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const x=this.camera.getEngine().getInputElement();x&&x.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const x=this.camera,O=x._calculateHandednessMultiplier();x.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)x.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=x._computeLocalCameraSpeed(),Q=new n.n(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);n.c.RotationYawPitchRollToRef(x.rotation.y,x.rotation.x,0,x._cameraRotationMatrix),x.cameraDirection.addInPlace(n.n.TransformCoordinates(Q,x._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,X.b)([(0,Z.L)()],g.prototype,"touchAngularSensibility",void 0),(0,X.b)([(0,Z.L)()],g.prototype,"touchMoveSensibility",void 0),o.d.FreeCameraTouchInput=g;class v extends o.g{constructor(x){super(x),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new U),this}addMouse(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new N(x),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new Y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new g),this}clear(){super.clear(),this._mouseInput=null}}var R=Q(10866),s=Q(10970);class q extends V.c{get angularSensibility(){const x=this.inputs.attached.mouse;return x?x.angularSensibility:0}set angularSensibility(x){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=x)}get keysUp(){const x=this.inputs.attached.keyboard;return x?x.keysUp:[]}set keysUp(x){const O=this.inputs.attached.keyboard;O&&(O.keysUp=x)}get keysUpward(){const x=this.inputs.attached.keyboard;return x?x.keysUpward:[]}set keysUpward(x){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=x)}get keysDown(){const x=this.inputs.attached.keyboard;return x?x.keysDown:[]}set keysDown(x){const O=this.inputs.attached.keyboard;O&&(O.keysDown=x)}get keysDownward(){const x=this.inputs.attached.keyboard;return x?x.keysDownward:[]}set keysDownward(x){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=x)}get keysLeft(){const x=this.inputs.attached.keyboard;return x?x.keysLeft:[]}set keysLeft(x){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=x)}get keysRight(){const x=this.inputs.attached.keyboard;return x?x.keysRight:[]}set keysRight(x){const O=this.inputs.attached.keyboard;O&&(O.keysRight=x)}get keysRotateLeft(){const x=this.inputs.attached.keyboard;return x?x.keysRotateLeft:[]}set keysRotateLeft(x){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=x)}get keysRotateRight(){const x=this.inputs.attached.keyboard;return x?x.keysRotateRight:[]}set keysRotateRight(x){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=x)}get keysRotateUp(){const x=this.inputs.attached.keyboard;return x?x.keysRotateUp:[]}set keysRotateUp(x){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=x)}get keysRotateDown(){const x=this.inputs.attached.keyboard;return x?x.keysRotateDown:[]}set keysRotateDown(x){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=x)}constructor(x,O,Q){var X;super(x,O,Q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),X=this,this.ellipsoid=new n.n(.5,1,.5),this.ellipsoidOffset=new n.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.n.Zero(),this._diffPosition=n.n.Zero(),this._newPosition=n.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X._newPosition.V(O),X._newPosition.subtractToRef(X._oldPosition,X._diffPosition),X._diffPosition.length()>s.c.CollisionsEpsilon&&(X.position.addToRef(X._diffPosition,X._deferredPositionUpdate),X._deferOnly?X._deferredUpdated=!0:X.position.V(X._deferredPositionUpdate),X.lN&&Q&&X.lN(Q))},this.inputs=new v(this),this.inputs.addKeyboard().addMouse()}attachControl(x,O){O=C.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}CL(){this.inputs.detachElement(),this.cameraDirection=new n.n(0,0,0),this.cameraRotation=new n.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(x){this._collisionMask=isNaN(x)?-1:x}_collideWithWorld(x){let O;O=this.parent?n.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Q=this.kx().collisionCoordinator;this._collider||(this._collider=Q.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let X=x;this.applyGravity&&(X=x.add(this.kx().gravity)),Q.getNewPosition(this._oldPosition,X,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.n.Zero(),this._transformedDirection=n.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(x){this._needMoveForGravity=x}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.kx().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fh"}}(0,X.b)([(0,Z.K)()],q.prototype,"ellipsoid",void 0),(0,X.b)([(0,Z.K)()],q.prototype,"ellipsoidOffset",void 0),(0,X.b)([(0,Z.L)()],q.prototype,"checkCollisions",void 0),(0,X.b)([(0,Z.L)()],q.prototype,"applyGravity",void 0),(0,R.d)("BABYLON.FreeCamera",q)},13226:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>n});var X=Q(11212),Z=Q(13235);class n{constructor(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Q,this.uU=[],this._maxBlockCapacity=O||64,this._selectionContent=new X.d(1024),this._creationFunc=x}update(x,O,Q){Z.b._CreateBlocks(x,O,Q,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}bC(x){for(let O=0;O<this.pC.length;O++){this.pC[O].addEntry(x)}}FC(x){for(let O=0;O<this.pC.length;O++){this.pC[O].removeEntry(x)}}select(x,O){this._selectionContent.reset();for(let Q=0;Q<this.pC.length;Q++){this.pC[Q].select(x,this._selectionContent,O)}return O?this._selectionContent.concat(this.uU):this._selectionContent.concatWithNoDuplicate(this.uU),this._selectionContent}intersects(x,O,Q){this._selectionContent.reset();for(let X=0;X<this.pC.length;X++){this.pC[X].intersects(x,O,this._selectionContent,Q)}return Q?this._selectionContent.concat(this.uU):this._selectionContent.concatWithNoDuplicate(this.uU),this._selectionContent}intersectsRay(x){this._selectionContent.reset();for(let O=0;O<this.pC.length;O++){this.pC[O].intersectsRay(x,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.uU),this._selectionContent}}n.CreationFuncForMeshes=(x,O)=>{const Q=x.getBoundingInfo();!x.isBlocked&&Q.boundingBox.intersectsMinMax(O.zU,O.FU)&&O.entries.push(x)},n.CreationFuncForSubMeshes=(x,O)=>{x.getBoundingInfo().boundingBox.intersectsMinMax(O.zU,O.FU)&&O.entries.push(x)}},13235:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>n});var X=Q(10849),Z=Q(11090);class n{constructor(x,O,Q,X,Z,n){this.entries=[],this.bU=new Array,this._capacity=Q,this._depth=X,this._maxDepth=Z,this._creationFunc=n,this._minPoint=x,this._maxPoint=O,this.bU.push(x.clone()),this.bU.push(O.clone()),this.bU.push(x.clone()),this.bU[2].x=O.x,this.bU.push(x.clone()),this.bU[3].y=O.y,this.bU.push(x.clone()),this.bU[4].z=O.z,this.bU.push(O.clone()),this.bU[5].z=x.z,this.bU.push(O.clone()),this.bU[6].x=x.x,this.bU.push(O.clone()),this.bU[7].y=x.y}get kV(){return this._capacity}get zU(){return this._minPoint}get FU(){return this._maxPoint}addEntry(x){if(this.pC)for(let O=0;O<this.pC.length;O++){this.pC[O].addEntry(x)}else this._creationFunc(x,this),this.entries.length>this.kV&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(x){if(this.pC){for(let O=0;O<this.pC.length;O++){this.pC[O].removeEntry(x)}return}const O=this.entries.indexOf(x);O>-1&&this.entries.splice(O,1)}addEntries(x){for(let O=0;O<x.length;O++){const Q=x[O];this.addEntry(Q)}}select(x,O,Q){if(Z.d.IsInFrustum(this.bU,x)){if(this.pC){for(let X=0;X<this.pC.length;X++){this.pC[X].select(x,O,Q)}return}Q?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(x,O,Q,X){if(Z.d.IntersectsSphere(this._minPoint,this._maxPoint,x,O)){if(this.pC){for(let Z=0;Z<this.pC.length;Z++){this.pC[Z].intersects(x,O,Q,X)}return}X?Q.concat(this.entries):Q.concatWithNoDuplicate(this.entries)}}intersectsRay(x,O){if(x.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.pC){for(let Q=0;Q<this.pC.length;Q++){this.pC[Q].intersectsRay(x,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){n._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(x,O,Q,Z,V,o,l,C){l.pC=new Array;const U=new X.n((O.x-x.x)/2,(O.y-x.y)/2,(O.z-x.z)/2);for(let X=0;X<2;X++)for(let O=0;O<2;O++)for(let L=0;L<2;L++){const h=x.add(U.multiplyByFloats(X,O,L)),N=x.add(U.multiplyByFloats(X+1,O+1,L+1)),a=new n(h,N,Z,V+1,o,C);a.addEntries(Q),l.pC.push(a)}}}},13243:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>U});var X=Q(11423),Z=Q(10849),n=Q(11172),V=Q(12359),o=Q(11237),l=Q(13226),C=Q(10877);X.d.prototype.createOrUpdateSelectionOctree=function(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Q=this._getComponent(o.e.NAME_OCTREE);Q||(Q=new U(this),this.o(Q)),this.cU||(this.cU=new l.b(l.b.CreationFuncForMeshes,x,O));const X=this.getWorldExtends();return this.cU.update(X.min,X.max,this.meshes),this.cU},Object.defineProperty(X.d.prototype,"selectionOctree",{get:function(){return this.cU},enumerable:!0,configurable:!0}),n.c.prototype.createOrUpdateSubmeshesOctree=function(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Q=this.kx();let X=Q._getComponent(o.e.NAME_OCTREE);X||(X=new U(Q),Q.o(X)),this._submeshesOctree||(this._submeshesOctree=new l.b(l.b.CreationFuncForSubMeshes,x,O)),this.HV(!0);const Z=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(Z.minimumWorld,Z.maximumWorld,this.Co),this._submeshesOctree};class U{constructor(x){this.name=o.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new V.d(Z.n.Zero(),new Z.n(1,1,1)),(x=x||C.c.LastCreatedScene)&&(this.RO=x,this.RO.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.RO.getActiveSubMeshCandidates=x=>this.getActiveSubMeshCandidates(x),this.RO.getCollidingSubMeshCandidates=(x,O)=>this.getCollidingSubMeshCandidates(x,O),this.RO.getIntersectingSubMeshCandidates=(x,O)=>this.getIntersectingSubMeshCandidates(x,O))}register(){this.RO.onMeshRemovedObservable.add((x=>{const O=this.RO.selectionOctree;if(void 0!==O&&null!==O){const Q=O.uU.indexOf(x);-1!==Q&&O.uU.splice(Q,1)}})),this.RO.onMeshImportedObservable.add((x=>{const O=this.RO.selectionOctree;void 0!==O&&null!==O&&O.bC(x)}))}getActiveMeshCandidates(){var x;return(null===(x=this.RO.cU)||void 0===x?void 0:x.select(this.RO.frustumPlanes))||this.RO._getDefaultMeshCandidates()}getActiveSubMeshCandidates(x){if(x._submeshesOctree&&x.useOctreeForRenderingSelection){return x._submeshesOctree.select(this.RO.frustumPlanes)}return this.RO._getDefaultSubMeshCandidates(x)}getIntersectingSubMeshCandidates(x,O){if(x._submeshesOctree&&x.useOctreeForPicking){V.d.TransformToRef(O,x.getWorldMatrix(),this._tempRay);return x._submeshesOctree.intersectsRay(this._tempRay)}return this.RO._getDefaultSubMeshCandidates(x)}getCollidingSubMeshCandidates(x,O){if(x._submeshesOctree&&x.useOctreeForCollisions){const Q=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return x._submeshesOctree.intersects(O._basePointWorld,Q)}return this.RO._getDefaultSubMeshCandidates(x)}rebuild(){}dispose(){}}},12359:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>N});var X=Q(11423),Z=Q(11206),n=Q(10853),V=Q(10849),o=Q(10861),l=Q(11082),C=Q(11186),U=Q(10877),L=Q(11454);const h={internalPickerForMesh:void 0};class N{constructor(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.e;this.origin=x,this.direction=O,this.length=Q,this.epsilon=X}clone(){return new N(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const X=N._TmpVector3[0].xo(x.x-Q,x.y-Q,x.z-Q),Z=N._TmpVector3[1].xo(O.x+Q,O.y+Q,O.z+Q);let n,V,o,l,C=0,U=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<X.x||this.origin.x>Z.x)return!1}else if(n=1/this.direction.x,V=(X.x-this.origin.x)*n,o=(Z.x-this.origin.x)*n,o===-1/0&&(o=1/0),V>o&&(l=V,V=o,o=l),C=Math.max(V,C),U=Math.min(o,U),C>U)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<X.y||this.origin.y>Z.y)return!1}else if(n=1/this.direction.y,V=(X.y-this.origin.y)*n,o=(Z.y-this.origin.y)*n,o===-1/0&&(o=1/0),V>o&&(l=V,V=o,o=l),C=Math.max(V,C),U=Math.min(o,U),C>U)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<X.z||this.origin.z>Z.z)return!1}else if(n=1/this.direction.z,V=(X.z-this.origin.z)*n,o=(Z.z-this.origin.z)*n,o===-1/0&&(o=1/0),V>o&&(l=V,V=o,o=l),C=Math.max(V,C),U=Math.min(o,U),C>U)return!1;return!0}intersectsBox(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(x.minimum,x.maximum,O)}intersectsSphere(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=x.center.x-this.origin.x,X=x.center.y-this.origin.y,Z=x.center.z-this.origin.z,n=Q*Q+X*X+Z*Z,V=x.radius+O,o=V*V;if(n<=o)return!0;const l=Q*this.direction.x+X*this.direction.y+Z*this.direction.z;if(l<0)return!1;return n-l*l<=o}intersectsTriangle(x,O,Q){const X=N._TmpVector3[0],Z=N._TmpVector3[1],n=N._TmpVector3[2],o=N._TmpVector3[3],C=N._TmpVector3[4];O.subtractToRef(x,X),Q.subtractToRef(x,Z),V.n.CrossToRef(this.direction,Z,n);const U=V.n.Dot(X,n);if(0===U)return null;const L=1/U;this.origin.subtractToRef(x,o);const h=V.n.Dot(o,n)*L;if(h<-this.epsilon||h>1+this.epsilon)return null;V.n.CrossToRef(o,X,C);const a=V.n.Dot(this.direction,C)*L;if(a<-this.epsilon||h+a>1+this.epsilon)return null;const K=V.n.Dot(Z,C)*L;return K>this.length?null:new l.e(1-h-a,h,K)}intersectsPlane(x){let O;const Q=V.n.Dot(x.QQ,this.direction);if(Math.abs(Q)<9.99999997475243e-7)return null;{const X=V.n.Dot(x.QQ,this.origin);return O=(-x.d-X)/Q,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(x){case"y":{const x=(this.origin.y-O)/this.direction.y;return x>0?null:new V.n(this.origin.x+this.direction.x*-x,O,this.origin.z+this.direction.z*-x)}case"x":{const x=(this.origin.x-O)/this.direction.x;return x>0?null:new V.n(O,this.origin.y+this.direction.y*-x,this.origin.z+this.direction.z*-x)}case"z":{const x=(this.origin.z-O)/this.direction.z;return x>0?null:new V.n(this.origin.x+this.direction.x*-x,this.origin.y+this.direction.y*-x,O)}default:return null}}intersectsMesh(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=V.j.Matrix[0];return x.getWorldMatrix().invertToRef(o),this._tmpRay?N.TransformToRef(this,o,this._tmpRay):this._tmpRay=N.Transform(this,o),x.intersects(this._tmpRay,O,Q,X,Z,n)}intersectsMeshes(x,O,Q){Q?Q.length=0:Q=[];for(let X=0;X<x.length;X++){const Z=this.intersectsMesh(x[X],O);Z.hit&&Q.push(Z)}return Q.sort(this._comparePickingInfo),Q}_comparePickingInfo(x,O){return x.distance<O.distance?-1:x.distance>O.distance?1:0}intersectionSegment(x,O,Q){const X=this.origin,Z=V.j.Oo[0],n=V.j.Oo[1],o=V.j.Oo[2],l=V.j.Oo[3];O.subtractToRef(x,Z),this.direction.scaleToRef(N._Rayl,o),X.addToRef(o,n),x.subtractToRef(X,l);const C=V.n.Dot(Z,Z),U=V.n.Dot(Z,o),L=V.n.Dot(o,o),h=V.n.Dot(Z,l),a=V.n.Dot(o,l),K=C*L-U*U;let M,Y,g=K,v=K;K<N._Smallnum?(M=0,g=1,Y=a,v=L):(M=U*a-L*h,Y=C*a-U*h,M<0?(M=0,Y=a,v=L):M>g&&(M=g,Y=a+U,v=L)),Y<0?(Y=0,-h<0?M=0:-h>C?M=g:(M=-h,g=C)):Y>v&&(Y=v,-h+U<0?M=0:-h+U>C?M=g:(M=-h+U,g=C));const R=Math.abs(M)<N._Smallnum?0:M/g,s=Math.abs(Y)<N._Smallnum?0:Y/v,q=V.j.Oo[4];o.scaleToRef(s,q);const G=V.j.Oo[5];Z.scaleToRef(R,G),G.addInPlace(l);const k=V.j.Oo[6];G.subtractToRef(q,k);return s>0&&s<=this.length&&k.lengthSquared()<Q*Q?G.length():-1}update(x,O,Q,X,Z,n,o){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){N._RayDistant||(N._RayDistant=N.Zero()),N._RayDistant.unprojectRayToRef(x,O,Q,X,V.c.IdentityReadOnly,n,o);const l=V.j.Matrix[0];Z.invertToRef(l),N.TransformToRef(N._RayDistant,l,this)}else this.unprojectRayToRef(x,O,Q,X,Z,n,o);return this}static Zero(){return new N(V.n.Zero(),V.n.Zero())}static CreateNew(x,O,Q,X,Z,n,V){return N.Zero().update(x,O,Q,X,Z,n,V)}static CreateNewFromTo(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.c.IdentityReadOnly;const X=new N(new V.n(0,0,0),new V.n(0,0,0));return N.CreateFromToToRef(x,O,X,Q)}static CreateFromToToRef(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.c.IdentityReadOnly;Q.origin.V(x);const Z=O.subtractToRef(x,Q.direction),n=Math.sqrt(Z.x*Z.x+Z.y*Z.y+Z.z*Z.z);return Q.length=n,Q.direction.normalize(),N.TransformToRef(Q,X,Q)}static Transform(x,O){const Q=new N(new V.n(0,0,0),new V.n(0,0,0));return N.TransformToRef(x,O,Q),Q}static TransformToRef(x,O,Q){V.n.TransformCoordinatesToRef(x.origin,O,Q.origin),V.n.TransformNormalToRef(x.direction,O,Q.direction),Q.length=x.length,Q.epsilon=x.epsilon;const X=Q.direction,Z=X.length();if(0!==Z&&1!==Z){const x=1/Z;X.x*=x,X.y*=x,X.z*=x,Q.length*=Z}return Q}unprojectRayToRef(x,O,Q,X,Z,n,o){const l=V.j.Matrix[0];Z.multiplyToRef(n,l),l.multiplyToRef(o,l),l.invert();const C=U.c.LastCreatedEngine,L=V.j.Oo[0];L.x=x/Q*2-1,L.y=-(O/X*2-1),L.z=null!==C&&void 0!==C&&C.useReverseDepthBuffer?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const h=V.j.Oo[1].xo(L.x,L.y,1-1e-8),N=V.j.Oo[2],a=V.j.Oo[3];V.n._UnprojectFromInvertedMatrixToRef(L,l,N),V.n._UnprojectFromInvertedMatrixToRef(h,l,a),this.origin.V(N),a.subtractToRef(N,this.direction),this.direction.normalize()}}function a(x,O,Q,X,Z){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=N.Zero();return K(x,O,Q,X,V,Z,n),V}function K(x,O,Q,X,Z,n){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=x.getEngine();if(!n&&!(n=x.activeCamera))return x;const U=n.viewport,L=C.getRenderHeight(),{x:h,y:N,width:a,height:K}=U.toGlobal(C.getRenderWidth(),L),M=1/C.getHardwareScalingLevel();return O=O*M-h,Q=Q*M-(L-N-K),Z.update(O,Q,a,K,X||V.c.IdentityReadOnly,o?V.c.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),l),x}function M(x,O,Q,X,Z){if(!C.c)return x;const n=x.getEngine();if(!Z&&!(Z=x.activeCamera))throw new Error("Active camera not set");const o=Z.viewport,l=n.getRenderHeight(),{x:U,y:L,width:h,height:N}=o.toGlobal(n.getRenderWidth(),l),a=V.c.Identity(),K=1/n.getHardwareScalingLevel();return O=O*K-U,Q=Q*K-(l-L-N),X.update(O,Q,h,N,a,a,Z.getProjectionMatrix()),x}function Y(x,O,Q,X,Z,n,V,o){const l=O(X,Q.enableDistantPicking),C=Q.intersects(l,Z,V,n,X,o);return C&&C.hit?!Z&&null!=x&&C.distance>=x.distance?null:C:null}function g(x,O,Q,X,Z,n){let o=null;const l=!!(x.activeCameras&&x.activeCameras.length>1&&x.cameraToUseForPointers!==x.activeCamera),U=x.cameraToUseForPointers||x.activeCamera,L=h.internalPickerForMesh||Y;for(let C=0;C<x.meshes.length;C++){const h=x.meshes[C];if(Q){if(!Q(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.ql)continue;const N=l&&h.isWorldMatrixCameraDependent(),a=h.HV(N,U);if(h.hasThinInstances&&h.thinInstanceEnablePicking){const x=L(o,O,h,a,!0,!0,n);if(x){if(Z)return x;const l=V.j.Matrix[1],C=h.thinInstanceGetWorldMatrices();for(let x=0;x<C.length;x++){if(Q&&!Q(h,x))continue;C[x].multiplyToRef(a,l);const V=L(o,O,h,l,X,Z,n,!0);if(V&&(o=V,o.thinInstanceIndex=x,X))return o}}}else{const x=L(o,O,h,a,X,Z,n);if(x&&(o=x,X))return o}}return o||new C.c}function v(x,O,Q,X){if(!C.c)return null;const Z=[],n=!!(x.activeCameras&&x.activeCameras.length>1&&x.cameraToUseForPointers!==x.activeCamera),o=x.cameraToUseForPointers||x.activeCamera,l=h.internalPickerForMesh||Y;for(let C=0;C<x.meshes.length;C++){const U=x.meshes[C];if(Q){if(!Q(U,-1))continue}else if(!U.isEnabled()||!U.isVisible||!U.ql)continue;const L=n&&U.isWorldMatrixCameraDependent(),h=U.HV(L,o);if(U.hasThinInstances&&U.thinInstanceEnablePicking){if(l(null,O,U,h,!0,!0,X)){const x=V.j.Matrix[1],n=U.thinInstanceGetWorldMatrices();for(let V=0;V<n.length;V++){if(Q&&!Q(U,V))continue;n[V].multiplyToRef(h,x);const o=l(null,O,U,x,!1,!1,X,!0);o&&(o.thinInstanceIndex=V,Z.push(o))}}}else{const x=l(null,O,U,h,!1,!1,X);x&&Z.push(x)}}return Z}function R(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,X=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0;X||(X=x.getWorldMatrix()),O.length=Q,Z?O.origin.V(Z):O.origin.V(x.position);const n=V.j.Oo[2];n.set(0,0,x._scene.useRightHandedSystem?-1:1);const o=V.j.Oo[3];return V.n.TransformNormalToRef(n,X,o),V.n.NormalizeToRef(o,O.direction),O}var s,q;N._TmpVector3=(0,o.e)(6,V.n.Zero),N._RayDistant=N.Zero(),N._Smallnum=1e-8,N._Rayl=1e9,s=X.d,(q=Z.e)&&(q.prototype.getForwardRay=function(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;return R(this,new N(V.n.Zero(),V.n.Zero(),x),x,O,Q)},q.prototype.getForwardRayToRef=function(x){return R(this,x,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),s&&(L.d._IsPickingAvailable=!0,s.prototype.createPickingRay=function(x,O,Q,X){return a(this,x,O,Q,X,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),X.d.prototype.createPickingRayToRef=function(x,O,Q,X,Z){return K(this,x,O,Q,X,Z,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},X.d.prototype.createPickingRayInCameraSpace=function(x,O,Q){return function(x,O,Q,X){const Z=N.Zero();return M(x,O,Q,Z,X),Z}(this,x,O,Q)},X.d.prototype.createPickingRayInCameraSpaceToRef=function(x,O,Q,X){return M(this,x,O,Q,X)},X.d.prototype.pickWithBoundingInfo=function(x,O,Q,X,Z){return function(x,O,Q,X,Z,n){if(!C.c)return null;const o=g(x,(X=>(x._tempPickingRay||(x._tempPickingRay=N.Zero()),K(x,O,Q,X,x._tempPickingRay,n||null),x._tempPickingRay)),X,Z,!0);return o&&(o.ray=a(x,O,Q,V.c.Identity(),n||null)),o}(this,x,O,Q,X,Z)},X.d.prototype.LQ=function(x,O,Q,X,Z,n){return function(x,O,Q,X,Z,n,o){const l=g(x,((X,Z)=>(x._tempPickingRay||(x._tempPickingRay=N.Zero()),K(x,O,Q,X,x._tempPickingRay,n||null,!1,Z),x._tempPickingRay)),X,Z,!1,o);return l&&(l.ray=a(x,O,Q,V.c.Identity(),n||null)),l}(this,x,O,Q,X,Z,n)},X.d.prototype.pickWithRay=function(x,O,Q,X){return function(x,O,Q,X,Z){const n=g(x,(Q=>(x._pickWithRayInverseMatrix||(x._pickWithRayInverseMatrix=V.c.Identity()),Q.invertToRef(x._pickWithRayInverseMatrix),x._cachedRayForTransform||(x._cachedRayForTransform=N.Zero()),N.TransformToRef(O,x._pickWithRayInverseMatrix,x._cachedRayForTransform),x._cachedRayForTransform)),Q,X,!1,Z);return n&&(n.ray=O),n}(this,x,O,Q,X)},X.d.prototype.multiPick=function(x,O,Q,X,Z){return function(x,O,Q,X,Z,n){return v(x,(X=>a(x,O,Q,X,Z||null)),X,n)}(this,x,O,Q,X,Z)},X.d.prototype.multiPickWithRay=function(x,O,Q){return function(x,O,Q,X){return v(x,(Q=>(x._pickWithRayInverseMatrix||(x._pickWithRayInverseMatrix=V.c.Identity()),Q.invertToRef(x._pickWithRayInverseMatrix),x._cachedRayForTransform||(x._cachedRayForTransform=N.Zero()),N.TransformToRef(O,x._pickWithRayInverseMatrix,x._cachedRayForTransform),x._cachedRayForTransform)),Q,X)}(this,x,O,Q)}},12677:(x,O,Q)=>{"use strict";var X=Q(10994),Z=Q(10905),n=Q(10934),V=Q(11015),o=Q(10970),l=Q(11005);o.c.prototype._partialLoadFile=function(x,O,Q,X){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(x,(x=>{Q[O]=x,Q._internalCount++,6===Q._internalCount&&X(Q)}),void 0,void 0,!0,((x,O)=>{Z&&x&&Z(x.status+" "+x.statusText,O)}))},o.c.prototype._cascadeLoadFiles=function(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Z=[];Z._internalCount=0;for(let n=0;n<6;n++)this._partialLoadFile(Q[n],n,Z,O,X)},o.c.prototype._cascadeLoadImgs=function(x,O,Q,X){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5?arguments[5]:void 0;const V=[];V._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(X[o],o,V,x,O,Q,Z,n)},o.c.prototype._partialLoadImg=function(x,O,Q,X,Z,o){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const U=(0,V.e)();(0,n.u)(x,(x=>{Q[O]=x,Q._internalCount++,X&&X.removePendingData(U),6===Q._internalCount&&o&&o(Z,Q)}),((x,O)=>{X&&X.removePendingData(U),l&&l(x,O)}),X?X.offlineProvider:null,C),X&&X.addPendingData(U)},o.c.prototype.createCubeTextureBase=function(x,O,Q,n){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]&&arguments[8],h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,M=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,Y=arguments.length>14&&void 0!==arguments[14]&&arguments[14],g=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=a||new X.e(this,7);v.isCube=!0,v.url=x,v.generateMipMaps=!n,v._lodGenerationScale=h,v._lodGenerationOffset=N,v._useSRGBBuffer=!!Y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),v!==a&&(v.label=x.substring(0,60)),this._doNotHandleContextLost||(v._extension=U,v._files=Q,v._buffer=g);const R=x;this._transformTextureUrl&&!a&&(x=this._transformTextureUrl(x));const s=U??function(x){const O=x.split("?")[0],Q=O.lastIndexOf(".");return Q>-1?O.substring(Q).toLowerCase():""}(x),q=(0,l.e)(s),G=(x,O)=>{v.dispose(),o?o(x,O):x&&Z.e.Warn(x)},k=(X,o)=>{x===R?X&&G(X.status+" "+X.statusText,o):(Z.e.Warn(`Failed to load ${x}, falling back to the ${R}`),this.createCubeTextureBase(R,O,Q,!!n,V,G,C,U,L,h,N,v,K,M,Y,g))};if(q)q.then((X=>{const Z=x=>{K&&K(v,x),X.loadCubeData(x,v,L,V,((x,O)=>{G(x,O)}))};g?Z(g):Q&&6===Q.length?X.supportCascades?this._cascadeLoadFiles(O,(x=>Z(x.map((x=>new Uint8Array(x))))),Q,G):G("Textures type does not support cascades."):this._loadFile(x,(x=>Z(new Uint8Array(x))),void 0,void 0,!0,k)}));else{if(!Q||0===Q.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,v,((x,O)=>{M&&M(x,O)}),Q,G)}return this._internalTexturesCache.push(v),v}},13251:(x,O,Q)=>{"use strict";Q(10905);var X=Q(11244);Q(10994),Q(11069),Q(10874),Q(11289),Q(11256);X.b},12703:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>Z});var X=Q(10866);class Z{constructor(x){this.value=this._toInt(x)}_toInt(x){return 0|x}add(x){return new Z(this.value+x.value)}hQ(x){return new Z(this.value-x.value)}multiply(x){return new Z(Math.imul(this.value,x.value))}divide(x){return new Z(this.value/x.value)}getClassName(){return Z.ClassName}equals(x){return this.value===x.value}static FromValue(x){return new Z(x)}toString(){return this.value.toString()}}Z.ClassName="FlowGraphInteger",(0,X.d)("FlowGraphInteger",Z)},12712:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>Z,h:()=>n});var X=Q(10849);class Z{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Oh=x}get m(){return this.Oh}transformVector(x){return this.transformVectorToRef(x,new X.l)}transformVectorToRef(x,O){return O.x=x.x*this.Oh[0]+x.y*this.Oh[1],O.y=x.x*this.Oh[2]+x.y*this.Oh[3],O}mV(){return this.toArray()}toArray(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<4;O++)x[O]=this.Oh[O];return x}NQ(x){for(let O=0;O<4;O++)this.Oh[O]=x[O];return this}multiplyToRef(x,O){const Q=x.Oh,X=this.Oh,Z=O.Oh;return Z[0]=Q[0]*X[0]+Q[1]*X[2],Z[1]=Q[0]*X[1]+Q[1]*X[3],Z[2]=Q[2]*X[0]+Q[3]*X[2],Z[3]=Q[2]*X[1]+Q[3]*X[3],O}multiply(x){return this.multiplyToRef(x,new Z)}divideToRef(x,O){const Q=this.Oh,X=x.Oh,Z=O.Oh;return Z[0]=Q[0]/X[0],Z[1]=Q[1]/X[1],Z[2]=Q[2]/X[2],Z[3]=Q[3]/X[3],O}divide(x){return this.divideToRef(x,new Z)}addToRef(x,O){const Q=this.Oh,X=x.m,Z=O.m;return Z[0]=Q[0]+X[0],Z[1]=Q[1]+X[1],Z[2]=Q[2]+X[2],Z[3]=Q[3]+X[3],O}add(x){return this.addToRef(x,new Z)}subtractToRef(x,O){const Q=this.Oh,X=x.m,Z=O.m;return Z[0]=Q[0]-X[0],Z[1]=Q[1]-X[1],Z[2]=Q[2]-X[2],Z[3]=Q[3]-X[3],O}hQ(x){return this.subtractToRef(x,new Z)}transpose(){const x=this.Oh;return new Z([x[0],x[2],x[1],x[3]])}determinant(){const x=this.Oh;return x[0]*x[3]-x[1]*x[2]}inverse(){const x=this.determinant();if(0===x)throw new Error("Matrix is not invertible");const O=this.Oh,Q=1/x;return new Z([O[3]*Q,-O[1]*Q,-O[2]*Q,O[0]*Q])}equals(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=this.Oh,X=x.m;return 0===O?Q[0]===X[0]&&Q[1]===X[1]&&Q[2]===X[2]&&Q[3]===X[3]:Math.abs(Q[0]-X[0])<O&&Math.abs(Q[1]-X[1])<O&&Math.abs(Q[2]-X[2])<O&&Math.abs(Q[3]-X[3])<O}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Oh.join(", ")})`}}class n{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Oh=x}get m(){return this.Oh}transformVector(x){return this.transformVectorToRef(x,new X.n)}transformVectorToRef(x,O){const Q=this.Oh;return O.x=x.x*Q[0]+x.y*Q[1]+x.z*Q[2],O.y=x.x*Q[3]+x.y*Q[4]+x.z*Q[5],O.z=x.x*Q[6]+x.y*Q[7]+x.z*Q[8],O}multiplyToRef(x,O){const Q=x.Oh,X=this.Oh,Z=O.m;return Z[0]=Q[0]*X[0]+Q[1]*X[3]+Q[2]*X[6],Z[1]=Q[0]*X[1]+Q[1]*X[4]+Q[2]*X[7],Z[2]=Q[0]*X[2]+Q[1]*X[5]+Q[2]*X[8],Z[3]=Q[3]*X[0]+Q[4]*X[3]+Q[5]*X[6],Z[4]=Q[3]*X[1]+Q[4]*X[4]+Q[5]*X[7],Z[5]=Q[3]*X[2]+Q[4]*X[5]+Q[5]*X[8],Z[6]=Q[6]*X[0]+Q[7]*X[3]+Q[8]*X[6],Z[7]=Q[6]*X[1]+Q[7]*X[4]+Q[8]*X[7],Z[8]=Q[6]*X[2]+Q[7]*X[5]+Q[8]*X[8],O}multiply(x){return this.multiplyToRef(x,new n)}divideToRef(x,O){const Q=this.Oh,X=x.m,Z=O.m;return Z[0]=Q[0]/X[0],Z[1]=Q[1]/X[1],Z[2]=Q[2]/X[2],Z[3]=Q[3]/X[3],Z[4]=Q[4]/X[4],Z[5]=Q[5]/X[5],Z[6]=Q[6]/X[6],Z[7]=Q[7]/X[7],Z[8]=Q[8]/X[8],O}divide(x){return this.divideToRef(x,new n)}addToRef(x,O){const Q=this.Oh,X=x.m,Z=O.m;return Z[0]=Q[0]+X[0],Z[1]=Q[1]+X[1],Z[2]=Q[2]+X[2],Z[3]=Q[3]+X[3],Z[4]=Q[4]+X[4],Z[5]=Q[5]+X[5],Z[6]=Q[6]+X[6],Z[7]=Q[7]+X[7],Z[8]=Q[8]+X[8],O}add(x){return this.addToRef(x,new n)}subtractToRef(x,O){const Q=this.Oh,X=x.m,Z=O.m;return Z[0]=Q[0]-X[0],Z[1]=Q[1]-X[1],Z[2]=Q[2]-X[2],Z[3]=Q[3]-X[3],Z[4]=Q[4]-X[4],Z[5]=Q[5]-X[5],Z[6]=Q[6]-X[6],Z[7]=Q[7]-X[7],Z[8]=Q[8]-X[8],O}hQ(x){return this.subtractToRef(x,new n)}toArray(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<9;O++)x[O]=this.Oh[O];return x}mV(){return this.toArray()}NQ(x){for(let O=0;O<9;O++)this.Oh[O]=x[O];return this}transpose(){const x=this.Oh;return new n([x[0],x[3],x[6],x[1],x[4],x[7],x[2],x[5],x[8]])}determinant(){const x=this.Oh;return x[0]*(x[4]*x[8]-x[5]*x[7])-x[1]*(x[3]*x[8]-x[5]*x[6])+x[2]*(x[3]*x[7]-x[4]*x[6])}inverse(){const x=this.determinant();if(0===x)throw new Error("Matrix is not invertible");const O=this.Oh,Q=1/x;return new n([(O[4]*O[8]-O[5]*O[7])*Q,(O[2]*O[7]-O[1]*O[8])*Q,(O[1]*O[5]-O[2]*O[4])*Q,(O[5]*O[6]-O[3]*O[8])*Q,(O[0]*O[8]-O[2]*O[6])*Q,(O[2]*O[3]-O[0]*O[5])*Q,(O[3]*O[7]-O[4]*O[6])*Q,(O[1]*O[6]-O[0]*O[7])*Q,(O[0]*O[4]-O[1]*O[3])*Q])}equals(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=this.Oh,X=x.m;return 0===O?Q[0]===X[0]&&Q[1]===X[1]&&Q[2]===X[2]&&Q[3]===X[3]&&Q[4]===X[4]&&Q[5]===X[5]&&Q[6]===X[6]&&Q[7]===X[7]&&Q[8]===X[8]:Math.abs(Q[0]-X[0])<O&&Math.abs(Q[1]-X[1])<O&&Math.abs(Q[2]-X[2])<O&&Math.abs(Q[3]-X[3])<O&&Math.abs(Q[4]-X[4])<O&&Math.abs(Q[5]-X[5])<O&&Math.abs(Q[6]-X[6])<O&&Math.abs(Q[7]-X[7])<O&&Math.abs(Q[8]-X[8])<O}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Oh.join(", ")})`}}},12714:(x,O,Q)=>{"use strict";var X;function Z(x,O,Q,X){switch(O){case"Animation":return X?x.animations.find((x=>x.uniqueId===Q))??null:x.animations[Q]??null;case"AnimationGroup":return X?x.animationGroups.find((x=>x.uniqueId===Q))??null:x.animationGroups[Q]??null;case"Mesh":return X?x.meshes.find((x=>x.uniqueId===Q))??null:x.meshes[Q]??null;case"Material":return X?x.materials.find((x=>x.uniqueId===Q))??null:x.materials[Q]??null;case"BC":return X?x.cameras.find((x=>x.uniqueId===Q))??null:x.cameras[Q]??null;case"Light":return X?x.lights.find((x=>x.uniqueId===Q))??null:x.lights[Q]??null;default:return null}}Q.d(O,{b:()=>Z}),function(x){x.Animation="Animation",x.AnimationGroup="AnimationGroup",x.Mesh="Mesh",x.Material="Material",x.BC="BC",x.Light="Light"}(X||(X={}))},12741:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>Z});var X=Q(12744);class Z extends X.d{constructor(x,O){if(super(x),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),O)for(const Q of O)this._eventsSignalOutputs[Q]=this._registerSignalOutput(Q+"Event")}_executeOnTick(x){}_startPendingTasks(x){x._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(x),this._resetAfterCanceled(x)),this._preparePendingTasks(x),x._addPendingBlock(this),this.out._activateSignal(x),x._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(x){x._deleteExecutionVariable(this,"_initialized"),x._removePendingBlock(this)}}},12726:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>C});var X=Q(11015),Z=Q(10866),n=Q(12728),V=Q(10882),o=Q(12700);class l extends n.d{constructor(x,O,Q,X){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:X.defaultValue,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(x,O,Q),this.richType=X,this._defaultValue=Z,this._optional=n,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new V.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(x){this._isDisabled!==x&&(this._isDisabled=x,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(x,O){O._getConnectionValue(this)!==x&&(O._setConnectionValue(this,x),this.onValueChangedObservable.notifyObservers(x))}resetToDefaultValue(x){x._setConnectionValue(this,this._defaultValue)}connectTo(x){this._isDisabled||super.connectTo(x)}_getValueOrDefault(x){const O=x._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(x){if(1===this.connectionType){x._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(x);const O=this._getValueOrDefault(x);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}const O=this.isConnected()?this._connectedPoint[0].getValue(x):this._getValueOrDefault(x);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(x),x.richType={},this.richType.serialize(x.richType),x.optional=this._optional,(0,o.e)("defaultValue",this._defaultValue,x)}}(0,Z.d)("FlowGraphDataConnection",l);class C{constructor(x){var O;this.config=x,this.uniqueId=(0,X.e)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(x){}registerDataInput(x,O,Q){const X=new l(x,0,this,O,Q);return this.dataInputs.push(X),X}registerDataOutput(x,O,Q){const X=new l(x,1,this,O,Q);return this.dataOutputs.push(X),X}getDataInput(x){return this.dataInputs.find((O=>O.name===x))}getDataOutput(x){return this.dataOutputs.find((O=>O.name===x))}serialize(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.e;if(x.uniqueId=this.uniqueId,x.config={},this.config){const Q=this.config,X=Object.keys(Q);for(const Z of X)O(Z,Q[Z],x.config)}x.dataInputs=[],x.dataOutputs=[],x.className=this.getClassName();for(const Q of this.dataInputs){const O={};Q.serialize(O),x.dataInputs.push(O)}for(const Q of this.dataOutputs){const O={};Q.serialize(O),x.dataOutputs.push(O)}}deserialize(x){}_log(x,O,Q){var X;null===(X=x.logger)||void 0===X||X.addLogItem({action:O,payload:Q,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12728:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>n});var X,Z=Q(11015);!function(x){x[x.Input=0]="Input",x[x.Output=1]="Output"}(X||(X={}));class n{constructor(x,O,Q){this._ownerBlock=Q,this._connectedPoint=[],this.uniqueId=(0,Z.e)(),this.connectedPointIds=[],this.name=x,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(x){if(this._connectionType===x._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||x._isSingularConnection()&&x._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(x),x._connectedPoint.push(this)}disconnectFrom(x){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=this._connectedPoint.indexOf(x),X=x._connectedPoint.indexOf(this);-1!==Q&&-1!==X&&(O&&this._connectedPoint.splice(Q,1),x._connectedPoint.splice(X,1))}disconnectFromAll(){for(const x of this._connectedPoint)this.disconnectFrom(x,!1);this._connectedPoint.length=0}dispose(){for(const x of this._connectedPoint)this.disconnectFrom(x)}serialize(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x.uniqueId=this.uniqueId,x.name=this.name,x._connectionType=this._connectionType,x.connectedPointIds=[],x.className=this.getClassName();for(const O of this._connectedPoint)x.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(x){this.uniqueId=x.uniqueId,this.name=x.name,this._connectionType=x._connectionType,this.connectedPointIds=x.connectedPointIds}}},12694:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>v});var X,Z=Q(10882),n=Q(11039),V=Q(11042),o=Q(11015),l=Q(12700),C=Q(12714),U=Q(10905);!function(x){x.ExecuteBlock="ExecuteBlock",x.ExecuteEvent="ExecuteEvent",x.TriggerConnection="TriggerConnection",x.ContextVariableSet="ContextVariableSet",x.GlobalVariableSet="GlobalVariableSet",x.GlobalVariableDelete="GlobalVariableDelete",x.GlobalVariableGet="GlobalVariableGet",x.AddConnection="AddConnection",x.GetConnectionValue="GetConnectionValue",x.SetConnectionValue="SetConnectionValue",x.ActivateSignal="ActivateSignal",x.ContextVariableGet="ContextVariableGet"}(X||(X={}));class L{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(x){if(x.time||(x.time=Date.now()),this.log.push(x),this.logToConsole){var O;const Q=null===(O=x.payload)||void 0===O?void 0:O.value;"object"===typeof Q&&Q.getClassName?U.e.Log(`[FGLog] ${x.className}:${x.uniqueId.split("-")[0]} ${x.action} - ${JSON.stringify(Q.getClassName())}: ${Q.toString()}`):U.e.Log(`[FGLog] ${x.className}:${x.uniqueId.split("-")[0]} ${x.action} - ${JSON.stringify(x.payload)}`)}}getItemsOfType(x){return this.log.filter((O=>O.action===x))}}class h{get enableLogging(){return this._enableLogging}set enableLogging(x){this._enableLogging!==x&&(this._enableLogging=x,this._enableLogging?(this.logger=new L,this.logger.logToConsole=!0):this.logger=null)}constructor(x){this.uniqueId=(0,o.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Z.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=x,this.assetsContext=x.assetsContext??x.RO}hasVariable(x){return x in this._userVariables}setVariable(x,O){var Q;this._userVariables[x]=O,null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:x,value:O}})}getAsset(x,O){return(0,C.b)(this.assetsContext,x,O)}getVariable(x){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:x,value:this._userVariables[x]}}),this._userVariables[x]}get userVariables(){return this._userVariables}kx(){return this._configuration.RO}_getUniqueIdPrefixedName(x,O){return`${x.uniqueId}_${O}`}_getGlobalContextVariable(x,O){var Q;return null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:x,defaultValue:O,possibleValue:this._globalContextVariables[x]}}),this._hasGlobalContextVariable(x)?this._globalContextVariables[x]:O}_setGlobalContextVariable(x,O){var Q;null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:x,value:O}}),this._globalContextVariables[x]=O}_deleteGlobalContextVariable(x){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:x}}),delete this._globalContextVariables[x]}_hasGlobalContextVariable(x){return x in this._globalContextVariables}_setExecutionVariable(x,O,Q){this._executionVariables[this._getUniqueIdPrefixedName(x,O)]=Q}_getExecutionVariable(x,O,Q){return this._hasExecutionVariable(x,O)?this._executionVariables[this._getUniqueIdPrefixedName(x,O)]:Q}_deleteExecutionVariable(x,O){delete this._executionVariables[this._getUniqueIdPrefixedName(x,O)]}_hasExecutionVariable(x,O){return this._getUniqueIdPrefixedName(x,O)in this._executionVariables}_hasConnectionValue(x){return x.uniqueId in this._connectionValues}_setConnectionValue(x,O){var Q;this._connectionValues[x.uniqueId]=O,null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:x.uniqueId,value:O}})}_setConnectionValueByKey(x,O){this._connectionValues[x]=O}_getConnectionValue(x){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:x.uniqueId,value:this._connectionValues[x.uniqueId]}}),this._connectionValues[x.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(x){this._pendingBlocks.includes(x)||(this._pendingBlocks.push(x),this._pendingBlocks.sort(((x,O)=>x.priority-O.priority)))}_removePendingBlock(x){const O=this._pendingBlocks.indexOf(x);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const x of this._pendingBlocks)x._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(x){var O;this.onNodeExecutedObservable.notifyObservers(x),null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:x.getClassName(),uniqueId:x.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(x){this._setGlobalContextVariable("timeSinceStart",x.timeSinceStart),this._setGlobalContextVariable("deltaTime",x.deltaTime);for(const Q of this._pendingBlocks){var O;null===(O=Q._executeOnTick)||void 0===O||O.call(Q,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.e;x.uniqueId=this.uniqueId,x._userVariables={};for(const X in this._userVariables)O(X,this._userVariables[X],x._userVariables);x._connectionValues={};for(const X in this._connectionValues)O(X,this._connectionValues[X],x._connectionValues);var Q;this.assetsContext!==this.kx()&&(x._assetsContext={meshes:this.assetsContext.meshes.map((x=>x.id)),materials:this.assetsContext.materials.map((x=>x.id)),textures:this.assetsContext.textures.map((x=>x.name)),animations:this.assetsContext.animations.map((x=>x.name)),lights:this.assetsContext.lights.map((x=>x.id)),cameras:this.assetsContext.cameras.map((x=>x.id)),Yh:null===(Q=this.assetsContext.Yh)||void 0===Q?void 0:Q.map((x=>x.name)),skeletons:this.assetsContext.skeletons.map((x=>x.id)),fL:this.assetsContext.fL.map((x=>x.name)),geometries:this.assetsContext.geometries.map((x=>x.id)),multiMaterials:this.assetsContext.multiMaterials.map((x=>x.id)),transformNodes:this.assetsContext.transformNodes.map((x=>x.id))})}getClassName(){return"FlowGraphContext"}}(0,n.b)([(0,V.L)()],h.prototype,"uniqueId",void 0);var N=Q(12722),a=Q(11436);class K{constructor(x){this.onEventTriggeredObservable=new Z.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=x,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.no.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const x=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:x}}),this._startingTime+=x})),this._meshPickedObserver=this._scene.onPointerObservable.add((x=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:x})}),a.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((x=>{const O=x.pointerId,Q=x.mesh,X=this._pointerUnderMeshState[O];!X&&Q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:O,mesh:Q}}):X&&!Q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:O,mesh:X}}):X&&Q&&X!==Q&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:O,mesh:X,over:Q}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:O,mesh:Q,out:X}})),this._pointerUnderMeshState[O]=Q}),a.e.POINTERMOVE)}dispose(){var x,O,Q,X,Z;null===(x=this._sceneDisposeObserver)||void 0===x||x.remove(),null===(O=this._sceneReadyObserver)||void 0===O||O.remove(),null===(Q=this._sceneOnBeforeRenderObserver)||void 0===Q||Q.remove(),null===(X=this._meshPickedObserver)||void 0===X||X.remove(),null===(Z=this._meshUnderPointerObserver)||void 0===Z||Z.remove(),this.onEventTriggeredObservable.clear()}}var M,Y=Q(12730);!function(x){x[x.Stopped=0]="Stopped",x[x.Started=1]="Started"}(M||(M={}));class g{get state(){return this._state}set state(x){this._state=x,this.onStateChangedObservable.notifyObservers(x)}constructor(x){this.onStateChangedObservable=new Z.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=x.RO,this._sceneEventCoordinator=new K(this._scene),this._coordinator=x.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((x=>{for(const O of this._executionContexts){const Q=this._getContextualOrder(x.type,O);for(const X of Q)if(!X._executeEvent(O,x.payload))break}switch(x.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const O of this._executionContexts)O._notifyOnTick(x.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const x=new h({RO:this._scene,coordinator:this._coordinator});return this._executionContexts.push(x),x}getContext(x){return this._executionContexts[x]}addEventBlock(x){if("PointerOver"!==x.type&&"PointerOut"!==x.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==x.type&&this._eventBlocks[x.type].push(x),1===this.state)for(const O of this._executionContexts)x._startPendingTasks(O);else this.onStateChangedObservable.addOnce((O=>{if(1===O)for(const Q of this._executionContexts)x._startPendingTasks(Q)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((x=>{1===x&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const x of this._executionContexts)for(const O in this._eventBlocks){const Q=this._getContextualOrder(O,x);for(const O of Q)O._startPendingTasks(x)}}_getContextualOrder(x,O){const Q=this._eventBlocks[x].sort(((x,O)=>O.initPriority-x.initPriority));if("MeshPick"===x){const x=[];for(const X of Q){const Z=X.asset.getValue(O);let n=0;for(;n<Q.length;n++){const x=Q[n].asset.getValue(O);if(Z&&x&&(0,Y.q)(Z,x))break}x.splice(n,0,X)}return x}return Q}dispose(){var x;if(0!==this.state){this.state=0;for(const x of this._executionContexts)x._clearPendingBlocks();this._executionContexts.length=0;for(const x in this._eventBlocks)this._eventBlocks[x].length=0;null===(x=this._eventObserver)||void 0===x||x.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(x){const O=[],Q=new Set;for(const X in this._eventBlocks)for(const x of this._eventBlocks[X])O.push(x),Q.add(x.uniqueId);for(;O.length>0;){const X=O.pop();x(X);for(const x of X.dataInputs)for(const X of x._connectedPoint)Q.has(X._ownerBlock.uniqueId)||(O.push(X._ownerBlock),Q.add(X._ownerBlock.uniqueId));if(X instanceof N.e)for(const x of X.signalOutputs)for(const X of x._connectedPoint)Q.has(X._ownerBlock.uniqueId)||(O.push(X._ownerBlock),Q.add(X._ownerBlock.uniqueId))}}serialize(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;x.allBlocks=[],this.visitAllBlocks((O=>{const Q={};O.serialize(Q),x.allBlocks.push(Q)})),x.executionContexts=[];for(const Q of this._executionContexts){const X={};Q.serialize(X,O),x.executionContexts.push(X)}}}class v{constructor(x){this.config=x,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.RO.no.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.RO.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const x=this._executeOnNextFrame.slice(0);if(x.length)for(const O of x){this.notifyCustomEvent(O.id,O.data,!1);const x=this._executeOnNextFrame.findIndex((x=>x.uniqueId===O.uniqueId));-1!==x&&this._executeOnNextFrame.splice(x,1)}}));(v.SceneCoordinators.get(this.config.RO)??[]).push(this)}createGraph(){const x=new g({RO:this.config.RO,coordinator:this});return this._flowGraphs.push(x),x}removeGraph(x){const O=this._flowGraphs.indexOf(x);-1!==O&&(x.dispose(),this._flowGraphs.splice(O,1))}start(){for(const x of this._flowGraphs)x.start()}dispose(){var x,O;for(const Z of this._flowGraphs)Z.dispose();this._flowGraphs.length=0,null===(x=this._disposeObserver)||void 0===x||x.remove(),null===(O=this._onBeforeRenderObserver)||void 0===O||O.remove();const Q=v.SceneCoordinators.get(this.config.RO)??[],X=Q.indexOf(this);-1!==X&&Q.splice(X,1)}serialize(x,O){x._flowGraphs=[];for(const Q of this._flowGraphs){const X={};Q.serialize(X,O),x._flowGraphs.push(X)}x.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(x){let O=this._customEventsMap.get(x);return O||(O=new Z.b,this._customEventsMap.set(x,O)),O}notifyCustomEvent(x,O){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:x,data:O,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(x)){const O=this._eventExecutionCounter.get(x);if(this._eventExecutionCounter.set(x,O+1),O>=v.MaxEventTypeExecutionPerFrame)return void(O===v.MaxEventTypeExecutionPerFrame&&U.e.Warn(`FlowGraphCoordinator: Too many executions of event "${x}".`))}else this._eventExecutionCounter.set(x,1);const Q=this._customEventsMap.get(x);Q&&Q.notifyObservers(O)}}v.MaxEventsPerType=30,v.MaxEventTypeExecutionPerFrame=30,v.SceneCoordinators=new Map},12739:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>Z});var X=Q(12741);class Z extends X.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(x){x._notifyExecuteNode(this),this.done._activateSignal(x)}}},12722:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>o});var X=Q(12726),Z=Q(12728),n=Q(10866);class V extends Z.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(x){super.connectTo(x),this._connectedPoint.sort(((x,O)=>O.priority-x.priority))}_activateSignal(x){var O;if(null===(O=x.logger)||void 0===O||O.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)x._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(x,this),x._increaseExecutionId();else for(const Q of this._connectedPoint)Q._activateSignal(x)}}(0,n.d)("FlowGraphSignalConnection",V);class o extends X.d{constructor(x){super(x),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(x){const O=new V(x,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(x){const O=new V(x,1,this);return this.signalOutputs.push(O),O}_unregisterSignalInput(x){const O=this.signalInputs.findIndex((O=>O.name===x));-1!==O&&(this.signalInputs[O].dispose(),this.signalInputs.splice(O,1))}_unregisterSignalOutput(x){const O=this.signalOutputs.findIndex((O=>O.name===x));-1!==O&&(this.signalOutputs[O].dispose(),this.signalOutputs.splice(O,1))}_reportError(x,O){this.error.payload="string"===typeof O?new Error(O):O,this.error._activateSignal(x)}getSignalInput(x){return this.signalInputs.find((O=>O.name===x))}getSignalOutput(x){return this.signalOutputs.find((O=>O.name===x))}serialize(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(x),x.signalInputs=[],x.signalOutputs=[];for(const O of this.signalInputs){const Q={};O.serialize(Q),x.signalInputs.push(Q)}for(const O of this.signalOutputs){const Q={};O.serialize(Q),x.signalOutputs.push(Q)}}deserialize(x){for(let O=0;O<x.signalInputs.length;O++){const Q=this.getSignalInput(x.signalInputs[O].name);if(!Q)throw new Error("Could not find signal input with name "+x.signalInputs[O].name+" in block "+x.className);Q.deserialize(x.signalInputs[O])}for(let O=0;O<x.signalOutputs.length;O++){const Q=this.getSignalOutput(x.signalOutputs[O].name);if(!Q)throw new Error("Could not find signal output with name "+x.signalOutputs[O].name+" in block "+x.className);Q.deserialize(x.signalOutputs[O])}}getClassName(){return"FlowGraphExecutionBlock"}}},12744:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>Z});var X=Q(12722);class Z extends X.e{constructor(x){super(x),this.out=this._registerSignalOutput("out")}}},12707:(x,O,Q)=>{"use strict";Q.d(O,{A:()=>a,C:()=>K,D:()=>J,E:()=>t,G:()=>k,I:()=>G,d:()=>C,g:()=>h,i:()=>q,j:()=>M,l:()=>Y,m:()=>g,q:()=>L,t:()=>s,v:()=>U,y:()=>N});var X,Z=Q(10849),n=Q(11133),V=Q(12703),o=Q(12712);!function(x){x.Any="any",x.String="string",x.Number="number",x.Boolean="boolean",x.Object="object",x.Integer="FlowGraphInteger",x.Vector2="Vector2",x.Oo="Oo",x.Vector4="Vector4",x.Quaternion="Quaternion",x.Matrix="Matrix",x.Matrix2D="Matrix2D",x.Matrix3D="Matrix3D",x.rl="rl",x.nh="nh"}(X||(X={}));class l{constructor(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=x,this.defaultValue=O,this.animationType=Q}serialize(x){x.typeName=this.typeName,x.defaultValue=this.defaultValue}}const C=new l("any",void 0),U=new l("string",""),L=new l("number",0,0),h=new l("boolean",!1),N=new l("Vector2",Z.l.Zero(),5),a=new l("Oo",Z.n.Zero(),1),K=new l("Vector4",Z.o.Zero()),M=new l("Matrix",Z.c.Identity(),3),Y=new l("Matrix2D",new o.e),g=new l("Matrix3D",new o.h),v=new l("rl",n.d.Black(),4),R=new l("nh",new n.h(0,0,0,0),7),s=new l("Quaternion",Z.g.Identity(),2);s.typeTransformer=x=>{if(x.getClassName){if("Vector4"===x.getClassName())return Z.g.Xo(x.mV());if("Oo"===x.getClassName())return Z.g.FromEulerVector(x);if("Matrix"===x.getClassName())return Z.g.FromRotationMatrix(x)}return x};const q=new l("FlowGraphInteger",new V.b(0),0);function G(x){const O=x;switch(typeof x){case"string":return U;case"number":return L;case"boolean":return h;case"object":if(O.getClassName)switch(O.getClassName()){case"Vector2":return N;case"Oo":return a;case"Vector4":return K;case"Matrix":return M;case"rl":return v;case"nh":return R;case"Quaternion":return s;case"FlowGraphInteger":return q;case"Matrix2D":return Y;case"Matrix3D":return g}return C;default:return C}}function k(x){switch(x){case"string":return U;case"number":return L;case"boolean":return h;case"Vector2":return N;case"Oo":return a;case"Vector4":return K;case"Matrix":return M;case"rl":return v;case"nh":return R;case"Quaternion":return s;case"FlowGraphInteger":return q;case"Matrix2D":return Y;case"Matrix3D":return g;default:return C}}function J(x){switch(x){case"number":default:return 0;case"Vector2":return 5;case"Oo":return 1;case"Matrix":return 3;case"rl":return 4;case"nh":return 7;case"Quaternion":return 2}}function t(x){switch(x){case 0:return L;case 5:return N;case 1:return a;case 3:return M;case 4:return v;case 7:return R;case 2:return s;default:return C}}},12700:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>U,e:()=>C,h:()=>L});var X=Q(11133),Z=Q(10849),n=Q(12703),V=Q(12707),o=Q(12712);function l(x){return"Vector2"===x||"Oo"===x||"Vector4"===x||"Quaternion"===x||"rl"===x||"nh"===x}function C(x,O,Q){var X;const Z=(null===O||void 0===O||null===(X=O.getClassName)||void 0===X?void 0:X.call(O))??"";if(l(Z)||function(x){return"Matrix"===x||"Matrix2D"===x||"Matrix3D"===x}(Z))Q[x]={value:O.mV(),className:Z};else if("FlowGraphInteger"===Z)Q[x]={value:O.value,className:Z};else if(Z&&(O.id||O.name))Q[x]={id:O.id,name:O.name,className:Z};else{if("object"===typeof O)throw new Error(`Could not serialize value ${O}`);Q[x]=O}}function U(x,O,Q,C){const L=O[x];let h;const N=(null===L||void 0===L?void 0:L.type)??(null===L||void 0===L?void 0:L.className);if(function(x){return"Mesh"===x||"AbstractMesh"===x||"GroundMesh"===x||"InstanceMesh"===x||"LinesMesh"===x||"GoldbergMesh"===x||"GreasedLineMesh"===x||"TrailMesh"===x}(N)){let x=C.meshes.filter((x=>L.id?x.id===L.id:x.name===L.name));0===x.length&&(x=C.transformNodes.filter((x=>L.id?x.id===L.id:x.name===L.name))),h=L.uniqueId?x.find((x=>x.uniqueId===L.uniqueId)):x[0]}else if(l(N))h=function(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===x)return Z.l.Xo(O);if("Oo"===x)return Q&&(O[2]*=-1),Z.n.Xo(O);if("Vector4"===x)return Z.o.Xo(O);if("Quaternion"===x)return Q&&(O[2]*=-1,O[3]*=-1),Z.g.Xo(O);if("rl"===x)return new X.d(O[0],O[1],O[2]);if("nh"===x)return new X.h(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${x}`)}(N,L.value);else if(function(x){return"AnimationGroup"===x}(N)){const x=C.animationGroups.filter((x=>x.name===L.name));h=1===x.length?x[0]:x.find((x=>x.uniqueId===L.uniqueId))}else h="Matrix"===N?Z.c.Xo(L.value):"Matrix2D"===N?new o.e(L.value):"Matrix3D"===N?new o.h(L.value):"FlowGraphInteger"===N?n.b.FromValue(L.value):"number"===N||"string"===N||"boolean"===N?L.value[0]:L&&void 0!==L.value?L.value:Array.isArray(L)?L.reduce(((x,O)=>O.eventData?(x[O.id]={type:(0,V.G)(O.type)},"undefined"!==typeof O.value&&(x[O.id].value=U("value",O,Q,C)),x):x),{}):L;return h}function L(x){return"FlowGraphJsonPointerParserBlock"===x}},12730:(x,O,Q)=>{"use strict";function X(x,O){return!(!x.parent||x.parent!==O&&!X(x.parent,O))}function Z(x){if(x.getClassName)return x.getClassName()}function n(x,O){return x===O&&("Vector2"===x||"Oo"===x||"Vector4"===x||"Quaternion"===x)}function V(x,O){return x===O&&("Matrix"===x||"Matrix2D"===x||"Matrix3D"===x)}function o(x,O){return"FlowGraphInteger"===x&&"FlowGraphInteger"===O}function l(x,O){const Q="number"===typeof x||"number"===typeof(null===x||void 0===x?void 0:x.value);return Q&&!O?!isNaN(C(x)):Q}function C(x){return"number"===typeof x?x:x.value}Q.d(O,{d:()=>o,g:()=>V,k:()=>n,o:()=>Z,q:()=>X,u:()=>C,v:()=>l})},12082:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{SceneInstrumentation:()=>n});var X=Q(10894),Z=Q(11327);class n{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(x){x!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=x,x?(this._onBeforeActiveMeshesEvaluationObserver=this.RO.onBeforeActiveMeshesEvaluationObservable.add((()=>{X.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.RO.onAfterActiveMeshesEvaluationObservable.add((()=>{X.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.RO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.RO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(x){x!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=x,x?(this._onBeforeRenderTargetsRenderObserver=this.RO.onBeforeRenderTargetsRenderObservable.add((()=>{X.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.RO.onAfterRenderTargetsRenderObservable.add((()=>{X.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.RO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.RO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(x){x!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=x,x?(this._onBeforeParticlesRenderingObserver=this.RO.onBeforeParticlesRenderingObservable.add((()=>{X.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.RO.onAfterParticlesRenderingObservable.add((()=>{X.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.RO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.RO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(x){x!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=x,this.RO.spriteManagers&&(x?(this._onBeforeSpritesRenderingObserver=this.RO.onBeforeSpritesRenderingObservable.add((()=>{X.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.RO.onAfterSpritesRenderingObservable.add((()=>{X.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.RO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.RO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(x){x!==this._capturePhysicsTime&&this.RO.onBeforePhysicsObservable&&(this._capturePhysicsTime=x,x?(this._onBeforePhysicsObserver=this.RO.onBeforePhysicsObservable.add((()=>{X.g.StartPerformanceCounter("bh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.RO.onAfterPhysicsObservable.add((()=>{X.g.EndPerformanceCounter("bh"),this._physicsTime.endMonitoring()}))):(this.RO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.RO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(x){x!==this._captureAnimationsTime&&(this._captureAnimationsTime=x,x?this._onAfterAnimationsObserver=this.RO.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.RO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(x){this._captureFrameTime=x}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(x){this._captureInterFrameTime=x}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(x){x!==this._captureRenderTime&&(this._captureRenderTime=x,x?(this._onBeforeDrawPhaseObserver=this.RO.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),X.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.RO.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),X.g.EndPerformanceCounter("Main render")}))):(this.RO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.RO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(x){x!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=x,x?(this._onBeforeCameraRenderObserver=this.RO.onBeforeCameraRenderObservable.add((x=>{this._cameraRenderTime.beginMonitoring(),X.g.StartPerformanceCounter(`Rendering camera ${x.name}`)})),this._onAfterCameraRenderObserver=this.RO.onAfterCameraRenderObservable.add((x=>{this._cameraRenderTime.endMonitoring(!1),X.g.EndPerformanceCounter(`Rendering camera ${x.name}`)}))):(this.RO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.RO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.RO.getEngine()._drawCalls}constructor(x){this.RO=x,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Z.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Z.d,this._captureFrameTime=!1,this._frameTime=new Z.d,this._captureRenderTime=!1,this._renderTime=new Z.d,this._captureInterFrameTime=!1,this._interFrameTime=new Z.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Z.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Z.d,this._capturePhysicsTime=!1,this._physicsTime=new Z.d,this._captureAnimationsTime=!1,this._animationsTime=new Z.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Z.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=x.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(X.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.RO.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=x.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(X.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qL(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qL(),this._captureParticlesRenderTime&&this._particlesRenderTime.qL(),this._captureSpritesRenderTime&&this._spritesRenderTime.qL(),this._captureRenderTime&&this._renderTime.qL(),this._captureCameraRenderTime&&this._cameraRenderTime.qL()}))}dispose(){this._disposed||(this.RO.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.RO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.RO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.RO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.RO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.RO.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.RO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.RO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.RO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.RO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.RO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.RO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.RO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.RO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.RO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.RO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.RO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.RO=null,this._disposed=!0)}}},12686:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>U});var X=Q(11039),Z=Q(11042),n=Q(10849),V=Q(11165),o=Q(11558),l=Q(11621),C=Q(10866);V.c.AddNodeConstructor("Light_Type_1",((x,O)=>()=>new U(x,n.n.Zero(),O)));class U extends l.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(x){this._shadowFrustumSize=x,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(x){this._shadowOrthoScale=x,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(x){this._orthoLeft=x}get orthoRight(){return this._orthoRight}set orthoRight(x){this._orthoRight=x}get orthoTop(){return this._orthoTop}set orthoTop(x){this._orthoTop=x}get orthoBottom(){return this._orthoBottom}set orthoBottom(x){this._orthoBottom=x}constructor(x,O,Q){super(x,Q),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"ih"}getTypeID(){return o.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(x,O,Q){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(x):this._setDefaultAutoExtendShadowProjectionMatrix(x,O,Q)}_setDefaultFixedFrustumShadowProjectionMatrix(x){const O=this.kx().activeCamera;O&&n.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.lo,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,x,this.kx().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(x,O,Q){const X=this.kx().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const x=n.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let X=Number.MAX_VALUE,Z=-Number.MAX_VALUE;for(let V=0;V<Q.length;V++){const o=Q[V];if(!o)continue;const l=o.getBoundingInfo().boundingBox;for(let Q=0;Q<l.vectorsWorld.length;Q++)n.n.TransformCoordinatesToRef(l.vectorsWorld[Q],O,x),x.x<this._orthoLeft&&(this._orthoLeft=x.x),x.y<this._orthoBottom&&(this._orthoBottom=x.y),x.x>this._orthoRight&&(this._orthoRight=x.x),x.y>this._orthoTop&&(this._orthoTop=x.y),this.autoCalcShadowZBounds&&(x.z<X&&(X=x.z),x.z>Z&&(Z=x.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=X,this._shadowMaxZ=Z)}const Z=this._orthoRight-this._orthoLeft,V=this._orthoTop-this._orthoBottom,o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===X||void 0===X?void 0:X.lo)||0,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===X||void 0===X?void 0:X.maxZ)||1e4,C=this.kx().getEngine().useReverseDepthBuffer;n.c.OrthoOffCenterLHToRef(this._orthoLeft-Z*this.shadowOrthoScale,this._orthoRight+Z*this.shadowOrthoScale,this._orthoBottom-V*this.shadowOrthoScale,this._orthoTop+V*this.shadowOrthoScale,C?l:o,C?o:l,x,this.kx().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(x,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(x,O){return this.computeTransformedInformation()?(x.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(x.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(x){const O=this._scene.getEngine();return!O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}getDepthMaxZ(x){const O=this._scene.getEngine();return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(x,O){x["DIRLIGHT"+O]=!0}}(0,X.b)([(0,Z.L)()],U.prototype,"shadowFrustumSize",null),(0,X.b)([(0,Z.L)()],U.prototype,"shadowOrthoScale",null),(0,X.b)([(0,Z.L)()],U.prototype,"autoUpdateExtends",void 0),(0,X.b)([(0,Z.L)()],U.prototype,"autoCalcShadowZBounds",void 0),(0,X.b)([(0,Z.L)("orthoLeft")],U.prototype,"_orthoLeft",void 0),(0,X.b)([(0,Z.L)("orthoRight")],U.prototype,"_orthoRight",void 0),(0,X.b)([(0,Z.L)("orthoTop")],U.prototype,"_orthoTop",void 0),(0,X.b)([(0,Z.L)("orthoBottom")],U.prototype,"_orthoBottom",void 0),(0,C.d)("BABYLON.DirectionalLight",U)},13182:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>U});var X=Q(11039),Z=Q(11042),n=Q(10849),V=Q(11133),o=Q(11165),l=Q(11558),C=Q(10866);o.c.AddNodeConstructor("Light_Type_3",((x,O)=>()=>new U(x,n.n.Zero(),O)));class U extends l.c{constructor(x,O,Q){super(x,Q),this.groundColor=new V.d(0,0,0),this.direction=O||n.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ph"}setDirectionToTarget(x){return this.direction=n.n.Normalize(x.hQ(n.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(x,O){const Q=n.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Q.x,Q.y,Q.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.ho),O),this}transferToNodeMaterialEffect(x,O){const Q=n.n.Normalize(this.direction);return x.setFloat3(O,Q.x,Q.y,Q.z),this}HV(){return this._worldMatrix||(this._worldMatrix=n.c.Identity()),this._worldMatrix}getTypeID(){return l.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(x,O){x["HEMILIGHT"+O]=!0}}(0,X.b)([(0,Z.n)()],U.prototype,"groundColor",void 0),(0,X.b)([(0,Z.K)()],U.prototype,"direction",void 0),(0,C.d)("BABYLON.HemisphericLight",U)},12648:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>L});var X=Q(11039),Z=Q(11042),n=Q(10849),V=Q(11165),o=Q(11558),l=Q(11621),C=Q(11335),U=Q(10866);V.c.AddNodeConstructor("Light_Type_2",((x,O)=>()=>new L(x,n.n.Zero(),n.n.Zero(),0,0,O)));class L extends l.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(x){this._iesProfileTexture!==x&&(this._iesProfileTexture=x,this._iesProfileTexture&&L._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(x){this._angle=x,this._cosHalfAngle=Math.cos(.5*x),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(x){this._innerAngle=x,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(x){this._shadowAngleScale=x,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(x){this._projectionTextureLightNear=x,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(x){this._projectionTextureLightFar=x,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(x){this._projectionTextureUpDirection=x,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(x){this._projectionTexture!==x&&(this._projectionTexture=x,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(L._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):L._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(x){return void 0!==x.onGeneratedObservable}static _IsTexture(x){return void 0!==x.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(x){this._projectionTextureProjectionLightMatrix=x,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(x,O,Q,X,Z,V){super(x,V),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=n.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=n.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=n.n.Zero(),this._projectionTextureViewLightMatrix=n.c.Zero(),this._projectionTextureProjectionLightMatrix=n.c.Zero(),this._projectionTextureScalingMatrix=n.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=Q,this.angle=X,this.exponent=Z}getClassName(){return"SpotLight"}getTypeID(){return o.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(x){super._setDirection(x),this._projectionTextureViewLightDirty=!0}_setPosition(x){super._setPosition(x),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(x,O,Q){const X=this.kx().activeCamera;if(!X)return;this._shadowAngleScale=this._shadowAngleScale||1;const Z=this._shadowAngleScale*this._angle,V=void 0!==this.shadowMinZ?this.shadowMinZ:X.lo,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,l=this.kx().getEngine().useReverseDepthBuffer;n.c.PerspectiveFovLHToRef(Z,1,l?o:V,l?V:o,x,!0,this._scene.getEngine().isNDCHalfZRange,void 0,l)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),n.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const x=this.projectionTextureLightFar,O=this.projectionTextureLightNear,Q=x/(x-O),X=-Q*O,Z=1/Math.tan(this._angle/2);n.c.FromValuesToRef(Z/1,0,0,0,0,Z,0,0,0,0,Q,1,0,0,X,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.b){const x=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;n.c.FromValuesToRef(x,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(x,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),x.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),x.setTexture("projectionLightTexture"+O,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&x.setTexture("iesLightTexture"+O,this._iesProfileTexture),this}transferToEffect(x,O){let Q;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),Q=n.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),Q=n.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Q.x,Q.y,Q.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(x,O){let Q;return Q=this.computeTransformedInformation()?n.n.Normalize(this.transformedDirection):n.n.Normalize(this.direction),this.kx().useRightHandedSystem?x.setFloat3(O,-Q.x,-Q.y,-Q.z):x.setFloat3(O,Q.x,Q.y,Q.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(x){const O=this._scene.getEngine(),Q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===x||void 0===x?void 0:x.lo)??0;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?Q:this._scene.getEngine().isNDCHalfZRange?0:Q}getDepthMaxZ(x){const O=this._scene.getEngine(),Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===x||void 0===x?void 0:x.maxZ)??1e4;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:Q}prepareLightSpecificDefines(x,O){x["SPOTLIGHT"+O]=!0,x["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady()),x["IESLIGHTTEXTURE"+O]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,X.b)([(0,Z.L)()],L.prototype,"angle",null),(0,X.b)([(0,Z.L)()],L.prototype,"innerAngle",null),(0,X.b)([(0,Z.L)()],L.prototype,"shadowAngleScale",null),(0,X.b)([(0,Z.L)()],L.prototype,"exponent",void 0),(0,X.b)([(0,Z.L)()],L.prototype,"projectionTextureLightNear",null),(0,X.b)([(0,Z.L)()],L.prototype,"projectionTextureLightFar",null),(0,X.b)([(0,Z.L)()],L.prototype,"projectionTextureUpDirection",null),(0,X.b)([(0,Z.G)("projectedLightTexture")],L.prototype,"_projectionTexture",void 0),(0,U.d)("BABYLON.SpotLight",L)},12354:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>V,f:()=>n,h:()=>o});const X={},Z={};function n(x,O){X[x]=O}function V(x,O){Z[x]=O}function o(x){return Z[x]?Z[x]:null}},12252:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>G,h:()=>F});var X,Z=Q(10894),n=Q(10882),V=Q(11423),o=Q(10877),l=Q(10905),C=Q(11225),U=Q(10934),L=Q(10936),h=Q(11015),N=Q(10970),a=Q(10925);!function(x){x[x.Clean=0]="Clean",x[x.Stop=1]="Stop",x[x.Sync=2]="Sync",x[x.NoSync=3]="NoSync"}(X||(X={}));const K=new n.b,M={};let Y=!1;function g(){return M[".babylon"]}function v(x,O){const Q=M[x];return Q||(l.e.Warn("Unable to find a plugin to load "+x+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),O?g():void 0)}function R(x,O,Q){let X="Unable to load from "+(x.rawData?"binary data":x.url);return O?X+=`: ${O}`:Q&&(X+=`: ${Q}`),X}async function s(x,O,Q,X,Z,n,V,o,l){var C;const L="data:"===(h=x.url).substring(0,5)?h.substring(5):null;var h;if(x.rawData&&!V)throw"When using ArrayBufferView to load data the file extension must be provided.";const Y=L||V?"":function(x){const O=x.indexOf("?");-1!==O&&(x=x.substring(0,O));const Q=x.lastIndexOf(".");return x.substring(Q,x.length).toLowerCase()}(x.url);let R=V?v(V,!0):L?function(x){for(const O in M){const Q=M[O].plugin;if(Q.canDirectLoad&&Q.canDirectLoad(x))return M[O]}return g()}(x.url):v(Y,!1);if(!R&&Y){if(x.url&&!x.url.startsWith("blob:")){const O=await async function(x,O){const Q=O.method||"GET";return await new Promise(((X,Z)=>{const n=new a.e;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const x={};if(O.responseHeaders)for(const Q of O.responseHeaders)x[Q]=n.getResponseHeader(Q)||"";X({response:n.response,headerValues:x})}else Z(`Unable to fetch data from ${x}. Error code: ${n.status}`)})),n.open(Q,x),n.send()}))}(x.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Q=O.headerValues?O.headerValues["Content-Type"]:"";Q&&(R=function(x){for(const O in M){const Q=M[O];if(Q.mimeType===x)return Q}}(Q))}R||(R=g())}if(!R)throw new Error(`No plugin or fallback for ${V??x.url}`);if(!1===(null===l||void 0===l||null===(C=l[R.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${R.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(x.rawData&&!R.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(x=>{if(R.plugin.createPlugin){const O=R.plugin.createPlugin(l??{});return O instanceof Promise?(O.then(x).catch((x=>{Z("Error instantiating plugin.",x)})),null):(x(O),O)}return x(R.plugin),R.plugin})((l=>{var C;if(!l)throw`The loader plugin corresponding to the '${V}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(K.notifyObservers(l),L&&(l.canDirectLoad&&l.canDirectLoad(x.url)||!(0,U.k)(x.url))){if(l.directLoad){const x=l.directLoad(O,L);x instanceof Promise?x.then((x=>{Q(l,x)})).catch((x=>{Z("Error in directLoad of _loadData: "+x,x)})):Q(l,x)}else Q(l,L);return}const h=R.isBinary,a=(x,X)=>{O.U?Z("Scene has been disposed"):Q(l,x,X)};let M=null,Y=!1;null===(C=l.no)||void 0===C||C.add((()=>{Y=!0,M&&(M.abort(),M=null),n()}));const g=()=>{if(Y)return;const Q=(x,O)=>{Z(null===x||void 0===x?void 0:x.statusText,O)};if(!l.loadFile&&x.rawData)throw"Plugin does not support loading ArrayBufferView.";M=l.loadFile?l.loadFile(O,x.rawData||x.file||x.url,x.rootUrl,a,X,h,Q,o):O._loadFile(x.file||x.url,a,X,!0,h,Q)},v=O.getEngine();let s=v.enableOfflineSupport;if(s){let Q=!1;for(const X of O.disableOfflineSupportExceptionRules)if(X.test(x.url)){Q=!0;break}s=!Q}s&&N.c.OfflineProviderFactory?O.offlineProvider=N.c.OfflineProviderFactory(x.url,g,v.disableManifestCheck):g()}))}function q(x,O){let Q,X,n=null,V=null;if(O)if(O.name)Q=`file:${O.name}`,X=O.name,n=O;else if(ArrayBuffer.isView(O))Q="",X=(0,h.e)(),V=O;else if(O.startsWith("data:"))Q=O,X="";else if(x){const n=O;if("/"===n.substring(0,1))return Z.g.Error("Wrong sceneFilename parameter"),null;Q=x+n,X=n}else Q=O,X=Z.g.GetFilename(O),x=Z.g.GetFolderPath(O);else Q=x,X=Z.g.GetFilename(x),x=Z.g.GetFolderPath(x);return{url:Q,rootUrl:x,name:X,file:n,rawData:V}}function G(x){if("string"===typeof x.extensions){const O=x.extensions;M[O.toLowerCase()]={plugin:x,isBinary:!1}}else{const O=x.extensions,Q=Object.keys(O);for(const X of Q)M[X.toLowerCase()]={plugin:x,isBinary:O[X].isBinary,mimeType:O[X].mimeType}}}async function k(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.c.LastCreatedScene,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!X)return l.e.Error("No scene available to import mesh to"),null;const N=q(O,Q);if(!N)return null;const a={};X.addPendingData(a);const K=()=>{X.removePendingData(a)},M=(x,O)=>{const Q=R(N,x,O);V?V(X,Q,new L.i(Q,L.g.SceneLoaderError,O)):l.e.Error(Q),K()},Y=n?x=>{try{n(x)}catch(O){M("Error in onProgress callback: "+O,O)}}:void 0,g=(x,O,Q,n,V,o,l,C)=>{if(X.importedMeshesFiles.push(N.url),Z)try{Z(x,O,Q,n,V,o,l,C)}catch(U){M("Error in onSuccess callback: "+U,U)}X.removePendingData(a)};return await s(N,X,((O,Q,Z)=>{if(O.rewriteRootURL&&(N.rootUrl=O.rewriteRootURL(N.rootUrl,Z)),O.importMesh){const Z=[],n=[],V=[];if(!O.importMesh(x,X,Q,N.rootUrl,Z,n,V,M))return;X.loadingPluginName=O.name,g(Z,n,V,[],[],[],[],[])}else{O.importMeshAsync(x,X,Q,N.rootUrl,Y,N.name).then((x=>{X.loadingPluginName=O.name,g(x.meshes,x.fL,x.skeletons,x.animationGroups,x.transformNodes,x.geometries,x.lights,x.spriteManagers)})).catch((x=>{M(x.message,x)}))}}),Y,M,K,C,U,h)}async function J(x,O,Q,X,Z,n,V,o){return await new Promise(((l,C)=>{try{k(x,O,Q,X,((x,O,Q,X,Z,n,V,o)=>{l({meshes:x,fL:O,skeletons:Q,animationGroups:X,transformNodes:Z,geometries:n,lights:V,spriteManagers:o})}),Z,((x,O,Q)=>{C(Q||new Error(O))}),n,V,o).catch(C)}catch(L){C(L)}}))}async function t(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.c.LastCreatedEngine,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Q?await d(x,O,new V.d(Q),X,n,l,C,U,L):Z.g.Error("No engine available")}async function c(x,O,Q,X,Z,n,V){return await new Promise(((o,l)=>{t(x,O,Q,(x=>{o(x)}),X,((x,O,Q)=>{l(Q||new Error(O))}),Z,n,V)}))}async function d(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.c.LastCreatedScene,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return l.e.Error("No scene available to append to"),null;const N=q(x,O);if(!N)return null;const a={};Q.addPendingData(a);const K=()=>{Q.removePendingData(a)};C.b.ShowLoadingScreen&&!Y&&(Y=!0,Q.getEngine().displayLoadingUI(),Q.executeWhenReady((()=>{Q.getEngine().hideLoadingUI(),Y=!1})));const M=(x,O)=>{const X=R(N,x,O);n?n(Q,X,new L.i(X,L.g.SceneLoaderError,O)):l.e.Error(X),K()},g=Z?x=>{try{Z(x)}catch(O){M("Error in onProgress callback",O)}}:void 0,v=()=>{if(X)try{X(Q)}catch(x){M("Error in onSuccess callback",x)}Q.removePendingData(a)};return await s(N,Q,((x,O)=>{if(x.load){if(!x.load(Q,O,N.rootUrl,M))return;Q.loadingPluginName=x.name,v()}else{x.loadAsync(Q,O,N.rootUrl,g,N.name).then((()=>{Q.loadingPluginName=x.name,v()})).catch((x=>{M(x.message,x)}))}}),g,M,K,V,U,h)}async function u(x,O,Q,X,Z,n,V){return await new Promise(((o,l)=>{try{d(x,O,Q,(x=>{o(x)}),X,((x,O,Q)=>{l(Q||new Error(O))}),Z,n,V).catch(l)}catch(L){l(L)}}))}async function A(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.c.LastCreatedScene,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return l.e.Error("No scene available to load asset container to"),null;const h=q(x,O);if(!h)return null;const N={};Q.addPendingData(N);const a=()=>{Q.removePendingData(N)},K=(x,O)=>{const X=R(h,x,O);n?n(Q,X,new L.i(X,L.g.SceneLoaderError,O)):l.e.Error(X),a()},M=Z?x=>{try{Z(x)}catch(O){K("Error in onProgress callback",O)}}:void 0,Y=x=>{if(X)try{X(x)}catch(O){K("Error in onSuccess callback",O)}Q.removePendingData(N)};return await s(h,Q,((x,O)=>{if(x.loadAssetContainer){const X=x.loadAssetContainer(Q,O,h.rootUrl,K);if(!X)return;X.populateRootNodes(),Q.loadingPluginName=x.name,Y(X)}else if(x.loadAssetContainerAsync){x.loadAssetContainerAsync(Q,O,h.rootUrl,M,h.name).then((O=>{O.populateRootNodes(),Q.loadingPluginName=x.name,Y(O)})).catch((x=>{K(x.message,x)}))}else K("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),M,K,a,V,C,U)}async function f(x,O,Q,X,Z,n,V){return await new Promise(((o,l)=>{try{A(x,O,Q,(x=>{o(x)}),X,((x,O,Q)=>{l(Q||new Error(O))}),Z,n,V).catch(l)}catch(L){l(L)}}))}async function E(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.c.LastCreatedScene,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Q)return void l.e.Error("No scene available to load animations to");if(X){for(const X of Q.animatables)X.reset();Q.stopAllAnimations();const x=Q.animationGroups.slice();for(const Q of x)Q.dispose();const O=Q.getNodes();for(const Q of O)Q.animations&&(Q.animations=[])}else switch(Z){case 0:const x=Q.animationGroups.slice();for(const O of x)O.dispose();break;case 1:for(const O of Q.animationGroups)O.stop();break;case 2:for(const O of Q.animationGroups)O.reset(),O.restart();break;case 3:break;default:return void l.e.Error("Unknown animation group loading mode value '"+Z+"'")}const a=Q.animatables.length;await A(x,O,Q,(x=>{x.mergeAnimationsTo(Q,Q.animatables.slice(a),n),x.dispose(),Q.onAnimationFileImportedObservable.notifyObservers(Q),V&&V(Q)}),C,U,L,h,N)}async function z(x,O,Q,X,Z,n,V,o,l,C){return await new Promise(((U,h)=>{try{E(x,O,Q,X,Z,n,(x=>{U(x)}),V,((x,O,Q)=>{h(Q||new Error(O))}),o,l,C).catch(h)}catch(L){h(L)}}))}class F{static get ForceFullSceneLoadingForIncremental(){return C.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(x){C.b.ForceFullSceneLoadingForIncremental=x}static get ShowLoadingScreen(){return C.b.ShowLoadingScreen}static set ShowLoadingScreen(x){C.b.ShowLoadingScreen=x}static get loggingLevel(){return C.b.loggingLevel}static set loggingLevel(x){C.b.loggingLevel=x}static get CleanBoneMatrixWeights(){return C.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(x){C.b.CleanBoneMatrixWeights=x}static GetDefaultPlugin(){return g()}static GetPluginForExtension(x){var O;return null===(O=v(x,!0))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(x){return function(x){return!!M[x]}(x)}static RegisterPlugin(x){G(x)}static ImportMesh(x,O,Q,X,Z,n,V,l,C){k(x,O,Q,X,Z,n,V,l,C).catch((x=>null===V||void 0===V?void 0:V(o.c.LastCreatedScene,null===x||void 0===x?void 0:x.message,x)))}static async ImportMeshAsync(x,O,Q,X,Z,n,V){return await J(x,O,Q,X,Z,n,V)}static Load(x,O,Q,X,Z,n,V,l){t(x,O,Q,X,Z,n,V,l).catch((x=>null===n||void 0===n?void 0:n(o.c.LastCreatedScene,null===x||void 0===x?void 0:x.message,x)))}static async LoadAsync(x,O,Q,X,Z,n){return await c(x,O,Q,X,Z,n)}static Append(x,O,Q,X,Z,n,V,l){d(x,O,Q,X,Z,n,V,l).catch((x=>null===n||void 0===n?void 0:n(Q??o.c.LastCreatedScene,null===x||void 0===x?void 0:x.message,x)))}static async AppendAsync(x,O,Q,X,Z,n){return await u(x,O,Q,X,Z,n)}static LoadAssetContainer(x,O,Q,X,Z,n,V,l){A(x,O,Q,X,Z,n,V,l).catch((x=>null===n||void 0===n?void 0:n(Q??o.c.LastCreatedScene,null===x||void 0===x?void 0:x.message,x)))}static async LoadAssetContainerAsync(x,O,Q,X,Z,n){return await f(x,O,Q,X,Z,n)}static ImportAnimations(x,O,Q,X,Z,n,V,l,C,U,L){E(x,O,Q,X,Z,n,V,l,C,U,L).catch((x=>null===C||void 0===C?void 0:C(Q??o.c.LastCreatedScene,null===x||void 0===x?void 0:x.message,x)))}static async ImportAnimationsAsync(x,O,Q,X,Z,n,V,o,l,C,U){return await z(x,O,Q,X,Z,n,o,C,U)}}F.NO_LOGGING=0,F.MINIMAL_LOGGING=1,F.SUMMARY_LOGGING=2,F.DETAILED_LOGGING=3,F.OnPluginActivatedObservable=K},12669:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>h});var X=Q(11039),Z=Q(11042),n=Q(10894),V=Q(10849),o=Q(11323),l=Q(11335),C=Q(10866),U=Q(10882),L=Q(11122);Q(12677);class h extends o.b{set boundingBoxSize(x){if(this._boundingBoxSize&&this._boundingBoxSize.equals(x))return;this._boundingBoxSize=x;const O=this.kx();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(x){this._rotationY=x,this.setReflectionTextureMatrix(V.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(x,O,Q){let X="";for(const Z of x)X+=Z;return new h(X,O,null,Q,x)}static CreateFromPrefilteredData(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const n=new h(x,O,null,!1,null,null,null,void 0,!0,Q,X);return O.useDelayedTextureLoading=Z,n}constructor(x,O){var Q;let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,Y=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new U.b,this.boundingBoxPosition=V.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new V.c,this._buffer=null,this.name=x,this.url=x,this._noMipmap=Z,this.wV=!1,this.isCube=!0,this._textureMatrix=V.c.Identity(),this.coordinatesMode=l.b.CUBIC_MODE;let v=null,R=null;null===X||Array.isArray(X)?(this._noMipmap=Z,this._format=L,this._createPolynomials=a,v=X,this._loaderOptions=Y,this._useSRGBBuffer=g,this._lodScale=K,this._lodOffset=M):(v=X.extensions??null,this._noMipmap=X.noMipmap??!1,n=X.files??null,R=X.buffer??null,this._format=X.format??5,h=X.prefiltered??!1,N=X.forcedExtension??null,this._createPolynomials=X.createPolynomials??!1,this._lodScale=X.lodScale??.8,this._lodOffset=X.lodOffset??0,this._loaderOptions=X.loaderOptions,this._useSRGBBuffer=X.useSRGBBuffer,o=X.p??null,C=X.onError??null),(x||n)&&this.updateURL(x,N,o,h,C,v,null===(Q=this.kx())||void 0===Q?void 0:Q.useDelayedTextureLoading,n,R)}getClassName(){return"CubeTexture"}updateURL(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=x),this.url=x,O&&(this._forcedExtension=O);const C=x.lastIndexOf("."),U=O||(C>-1?x.substring(C).toLowerCase():""),L=0===U.indexOf(".dds"),h=0===U.indexOf(".env"),N=0===U.indexOf(".basis");if(h?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=X,X&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(N||h||L||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,n){for(let O=0;O<n.length;O++)this._files.push(x+n[O]);this._extensions=n}this._buffer=l,V?(this.delayLoadState=4,this._delayedOnLoad=Q,this._delayedOnError=Z):this._loadTexture(Q,Z)}delayLoad(x){4===this.delayLoadState&&(x&&(this._forcedExtension=x),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(x){var O,Q;if(x.updateFlag===this._textureMatrix.updateFlag)return;x.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Q=this.kx())||void 0===Q||Q.markAllMaterialsAsDirty(1,(x=>-1!==x.getActiveTextures().indexOf(this))));if(this._textureMatrix=x,null===(O=this.kx())||void 0===O||!O.useRightHandedSystem)return;const X=V.j.Oo[0],Z=V.j.Quaternion[0],n=V.j.Oo[1];this._textureMatrix.decompose(X,Z,n),Z.z*=-1,Z.w*=-1,V.c.ComposeToRef(X,Z,n,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var x;return null!==(x=this.kx())&&void 0!==x&&x.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=this.kx(),X=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const Z=()=>{var O;(this.onLoadObservable.notifyObservers(this),X)&&(X.dispose(),null===(O=this.kx())||void 0===O||O.markAllMaterialsAsDirty(1));x&&x()},V=(x,Q)=>{this._loadingError=!0,this._errorObject={message:x,exception:Q},O&&O(x,Q),l.b.OnTextureLoadErrorObservable.notifyObservers(this)};var o;this._texture?this._texture.isReady?n.g.SetImmediate((()=>Z())):this._texture.onLoadedObservable.add((()=>Z())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Q,this._lodScale,this._lodOffset,x,V,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Q,this._files,this._noMipmap,x,V,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(o=this._texture)||void 0===o||o.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(x,O,Q){const X=L.c.Parse((()=>{let X=!1;return x.prefiltered&&(X=x.prefiltered),new h(Q+(x.url??x.name),O,x.extensions,!1,x.files||null,null,null,void 0,X,x.forcedExtension)}),x,O);if(x.boundingBoxPosition&&(X.boundingBoxPosition=V.n.Xo(x.boundingBoxPosition)),x.boundingBoxSize&&(X.boundingBoxSize=V.n.Xo(x.boundingBoxSize)),x.animations)for(let Z=0;Z<x.animations.length;Z++){const O=x.animations[Z],Q=(0,C.b)("BABYLON.Animation");Q&&X.animations.push(Q.Parse(O))}return X}clone(){let x=0;const O=L.c.Clone((()=>{const O=new h(this.url,this.kx()||this._getEngine(),this._extensions,this._noMipmap,this._files);return x=O.uniqueId,O}),this);return O.uniqueId=x,O}}(0,X.b)([(0,Z.L)()],h.prototype,"url",void 0),(0,X.b)([(0,Z.K)()],h.prototype,"boundingBoxPosition",void 0),(0,X.b)([(0,Z.K)()],h.prototype,"boundingBoxSize",null),(0,X.b)([(0,Z.L)("rotationY")],h.prototype,"rotationY",null),(0,X.b)([(0,Z.L)("files")],h.prototype,"_files",void 0),(0,X.b)([(0,Z.L)("forcedExtension")],h.prototype,"_forcedExtension",void 0),(0,X.b)([(0,Z.L)("extensions")],h.prototype,"_extensions",void 0),(0,X.b)([(0,Z.y)("textureMatrix")],h.prototype,"_textureMatrix",void 0),(0,X.b)([(0,Z.y)("textureMatrixRefraction")],h.prototype,"_textureMatrixRefraction",void 0),l.b._CubeTextureParser=h.Parse,(0,C.d)("BABYLON.CubeTexture",h)},13196:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>l});var X=Q(10905),Z=Q(11335),n=Q(11023),V=Q(11252),o=Q(10994);V.ThinEngine.prototype.createDynamicTexture=function(x,O,Q,X){const Z=new o.e(this,4);return Z.baseWidth=x,Z.baseHeight=O,Q&&(x=this.needPOTTextures?(0,n.d)(x,this._caps.maxTextureSize):x,O=this.needPOTTextures?(0,n.d)(O,this._caps.maxTextureSize):O),Z.width=x,Z.height=O,Z.isReady=!1,Z.generateMipMaps=Q,Z.samplingMode=X,this.updateTextureSamplingMode(X,Z),this._internalTexturesCache.push(Z),Z},V.ThinEngine.prototype.updateDynamicTexture=function(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!x)return;const V=this._gl,o=V.TEXTURE_2D,l=this._bindTextureDirectly(o,x,!0,n);this._unpackFlipY(void 0===Q?x.invertY:Q),X&&V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(x.type),U=this._getInternalFormat(Z||x.format),L=this._getRGBABufferInternalSizedFormat(x.type,U);V.texImage2D(o,0,L,U,C,O),x.generateMipMaps&&V.generateMipmap(o),l||this._bindTextureDirectly(o,null),X&&V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Z&&(x.format=Z),x._dynamicTextureSource=O,x._premulAlpha=X,x.invertY=Q||!1,x.isReady=!0};class l extends Z.b{constructor(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,o=arguments.length>6?arguments[6]:void 0;const l=!Q||Q._isScene;super(null,l?Q:null===Q||void 0===Q?void 0:Q.RO,l?!X:Q,o,n,void 0,void 0,void 0,void 0,V),this.name=x,this.wrapU=Z.b.CLAMP_ADDRESSMODE,this.wrapV=Z.b.CLAMP_ADDRESSMODE,this._generateMipMaps=X;const C=this._getEngine();if(!C)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,X,n);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const x=O;x.width||0===x.width?this._texture=C.createDynamicTexture(x.width,x.height,X,n):this._texture=C.createDynamicTexture(O,O,X,n)}const U=this.getSize();this._canvas.width!==U.width&&(this._canvas.width=U.width),this._canvas.height!==U.height&&(this._canvas.height=U.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(x){this._canvas.width=x.width,this._canvas.height=x.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(x.width,x.height,this._generateMipMaps,this.samplingMode)}scale(x){const O=this.getSize();O.width*=x,O.height*=x,this._recreate(O)}scaleTo(x,O){const Q=this.getSize();Q.width=x,Q.height=O,this._recreate(Q)}getContext(){return this._context}clear(x){const O=this.getSize();x&&(this._context.fillStyle=x),this._context.clearRect(0,0,O.width,O.height)}update(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===x||x,O,this._format||void 0,void 0,Q)}drawText(x,O,Q,X,Z,n,V){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,l.width,l.height)),this._context.font=X,null===O||void 0===O){const Q=this._context.measureText(x);O=(l.width-Q.width)/2}if(null===Q||void 0===Q){const x=parseInt(X.replace(/\D/g,""));Q=l.height/2+x/3.65}this._context.fillStyle=Z||"",this._context.fillText(x,O,Q),o&&this.update(V)}dispose(){var x,O;(super.dispose(),this._ownCanvas)&&(null===(x=this._canvas)||void 0===x||null===(O=x.remove)||void 0===O||O.call(x));this._canvas=null,this._context=null}clone(){const x=this.kx();if(!x)return this;const O=this.getSize(),Q=new l(this.name,O,x,this._generateMipMaps);return Q.wV=this.wV,Q.level=this.level,Q.wrapU=this.wrapU,Q.wrapV=this.wrapV,Q}serialize(){const x=this.kx();x&&!x.isReady()&&X.e.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return l._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(x){return void 0!==x.toDataURL}_rebuild(){this.update()}}},12567:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>Z});var X=Q(11335);class Z extends X.b{get depth(){return this._depth}constructor(x,O,Q,Z,n,V){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:X.b.TRILINEAR_SAMPLINGMODE,U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10?arguments[10]:void 0;super(null,V,!o,l),this.format=n,this._texture=V.getEngine().createRawTexture2DArray(x,O,Q,Z,n,o,l,C,null,U,L),this._depth=Z,this.is2DArray=!0}update(x){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,x,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(x,O,Q,X,n){return new Z(x,O,Q,X,5,n,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12365:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>o,h:()=>l,l:()=>n,o:()=>V});var X=Q(10889),Z=Q(10849);function n(x,O){return`{X: ${x.x.toFixed(O)} Y: ${x.y.toFixed(O)}}`}function V(x,O){return`{X: ${x._x.toFixed(O)} Y: ${x._y.toFixed(O)} Z: ${x._z.toFixed(O)}}`}function o(x,O){return 2*Math.acos((0,X.Clamp)(Z.g.Dot(x,O)))}function l(x,O){const Q=new Z.g;return function(x,O,Q){const n=Z.n.Cross(x,O),V=Math.acos((0,X.Clamp)(Z.n.Dot(x,O),-1,1));Z.g.RotationAxisToRef(n,V,Q)}(x,O,Q),Q}},12207:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>C});var X=Q(10849),Z=Q(11133),n=Q(11201),V=Q(11179),o=Q(11227);Q(12214);function l(x){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[];let l=[];const C=x.width||x.size||1,U=x.height||x.size||1,L=x.depth||x.size||1,h=x.wrap||!1;let N=void 0===x.topBaseAt?1:x.topBaseAt,a=void 0===x.bottomBaseAt?0:x.bottomBaseAt;N=(N+4)%4,a=(a+4)%4;let K=[2,0,3,1][N],M=[2,0,1,3][a],Y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let x=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Q=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const X=[17,18,19,16],Z=[22,23,20,21];for(;K>0;)x.unshift(x.pop()),X.unshift(X.pop()),K--;for(;M>0;)Q.unshift(Q.pop()),Z.unshift(Z.pop()),M--;x=x.flat(),Q=Q.flat(),Y=Y.concat(x).concat(Q),O.push(X[0],X[2],X[3],X[0],X[1],X[2]),O.push(Z[0],Z[2],Z[3],Z[0],Z[1],Z[2])}const g=[C/2,U/2,L/2];l=Y.reduce(((x,O,Q)=>x.concat(O*g[Q%3])),[]);const v=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,R=x.faceUV||new Array(6),s=x.faceColors,q=[];for(let V=0;V<6;V++)void 0===R[V]&&(R[V]=new X.o(0,0,1,1)),s&&void 0===s[V]&&(s[V]=new Z.h(1,1,1,1));for(let X=0;X<6;X++)if(n.push(R[X].z,o.e?1-R[X].w:R[X].w),n.push(R[X].x,o.e?1-R[X].w:R[X].w),n.push(R[X].x,o.e?1-R[X].y:R[X].y),n.push(R[X].z,o.e?1-R[X].y:R[X].y),s)for(let x=0;x<4;x++)q.push(s[X].r,s[X].g,s[X].b,s[X].a);V.d._ComputeSides(v,l,O,Q,n,x.frontUVs,x.backUVs);const G=new V.d;if(G.indices=O,G.tx=l,G.ux=Q,G.Ex=n,s){const x=v===V.d.DOUBLESIDE?q.concat(q):q;G.Ax=x}return G}function C(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new n.b(x,Q);O.sideOrientation=n.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return l(O).Fx(X,O.updatable),X}V.d.CreateBox=l,n.b.CreateBox=function(x,O){return C(x,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12357:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>o});var X=Q(11201),Z=Q(11179),n=Q(11227);function V(x){const O=[],Q=[],X=[],V=[],o=x.radius||.5,l=x.tessellation||64,C=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1,U=0===x.sideOrientation?0:x.sideOrientation||Z.d.DEFAULTSIDE;O.push(0,0,0),V.push(.5,.5);const L=2*Math.PI*C,h=1===C?L/l:L/(l-1);let N=0;for(let Z=0;Z<l;Z++){const x=Math.cos(N),Q=Math.sin(N),X=(x+1)/2,Z=(1-Q)/2;O.push(o*x,o*Q,0),V.push(X,n.e?1-Z:Z),N+=h}1===C&&(O.push(O[3],O[4],O[5]),V.push(V[2],n.e?1-V[3]:V[3]));const a=O.length/3;for(let Z=1;Z<a-1;Z++)Q.push(Z+1,0,Z);Z.d.ComputeNormals(O,Q,X),Z.d._ComputeSides(U,O,Q,X,V,x.frontUVs,x.backUVs);const K=new Z.d;return K.indices=Q,K.tx=O,K.ux=X,K.Ex=V,K}function o(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new X.b(x,Q);O.sideOrientation=X.b._GetDefaultSideOrientation(O.sideOrientation),Z._originalBuilderSideOrientation=O.sideOrientation;return V(O).Fx(Z,O.updatable),Z}Z.d.CreateDisc=V,X.b.CreateDisc=function(x,O,Q){return o(x,{radius:O,tessellation:Q,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12214:(x,O,Q)=>{"use strict";Q.d(O,{h:()=>M,d:()=>g,j:()=>Y});var X=Q(10849),Z=Q(11133),n=Q(11201),V=Q(11179),o=Q(11060);n.b._GroundMeshParser=(x,O)=>l.Parse(x,O);class l extends n.b{constructor(x,O){super(x,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=x,this._subdivisionsY=x,this.subdivide(x);const Q=this;Q.createOrUpdateSubmeshesOctree&&Q.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(x,O){const Q=this.getWorldMatrix(),Z=X.j.Matrix[5];Q.invertToRef(Z);const n=X.j.Oo[8];if(X.n.TransformCoordinatesFromFloatsToRef(x,0,O,Z,n),x=n.x,O=n.z,x<this._minX||x>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const V=this._getFacetAt(x,O),o=-(V.x*x+V.z*O+V.w)/V.y;return X.n.TransformCoordinatesFromFloatsToRef(0,o,0,Q,n),n.y}getNormalAtCoordinates(x,O){const Q=new X.n(0,1,0);return this.getNormalAtCoordinatesToRef(x,O,Q),Q}getNormalAtCoordinatesToRef(x,O,Q){const Z=this.getWorldMatrix(),n=X.j.Matrix[5];Z.invertToRef(n);const V=X.j.Oo[8];if(X.n.TransformCoordinatesFromFloatsToRef(x,0,O,n,V),x=V.x,O=V.z,x<this._minX||x>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(x,O);return X.n.TransformNormalFromFloatsToRef(o.x,o.y,o.z,Z,Q),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(x,O){const Q=Math.floor((x+this._maxX)*this._subdivisionsX/this._width),X=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),Z=this._heightQuads[X*this._subdivisionsX+Q];let n;return n=O<Z.slope.x*x+Z.slope.y?Z.facet1:Z.facet2,n}_initHeightQuads(){const x=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=[];for(let Q=0;Q<O;Q++)for(let O=0;O<x;O++){const Z={slope:X.l.Zero(),facet1:new X.o(0,0,0,0),facet2:new X.o(0,0,0,0)};this._heightQuads[Q*x+O]=Z}return this}_computeHeightQuads(){const x=this.getVerticesData(o.g.PositionKind);if(!x)return this;const O=X.j.Oo[3],Q=X.j.Oo[2],Z=X.j.Oo[1],n=X.j.Oo[0],V=X.j.Oo[4],l=X.j.Oo[5],C=X.j.Oo[6],U=X.j.Oo[7],L=X.j.Oo[8];let h=0,N=0,a=0,K=0,M=0,Y=0,g=0;const v=this._subdivisionsX,R=this._subdivisionsY;for(let o=0;o<R;o++)for(let R=0;R<v;R++){h=3*R,N=o*(v+1)*3,a=(o+1)*(v+1)*3,O.x=x[N+h],O.y=x[N+h+1],O.z=x[N+h+2],Q.x=x[N+h+3],Q.y=x[N+h+4],Q.z=x[N+h+5],Z.x=x[a+h],Z.y=x[a+h+1],Z.z=x[a+h+2],n.x=x[a+h+3],n.y=x[a+h+4],n.z=x[a+h+5],K=(n.z-O.z)/(n.x-O.x),M=O.z-K*O.x,Q.subtractToRef(O,V),Z.subtractToRef(O,l),n.subtractToRef(O,C),X.n.CrossToRef(C,l,U),X.n.CrossToRef(V,C,L),U.normalize(),L.normalize(),Y=-(U.x*O.x+U.y*O.y+U.z*O.z),g=-(L.x*Q.x+L.y*Q.y+L.z*Q.z);const s=this._heightQuads[o*v+R];s.slope.xo(K,M),s.facet1.xo(U.x,U.y,U.z,Y),s.facet2.xo(L.x,L.y,L.z,g)}return this}serialize(x){super.serialize(x),x.subdivisionsX=this._subdivisionsX,x.subdivisionsY=this._subdivisionsY,x.minX=this._minX,x.maxX=this._maxX,x.lo=this._minZ,x.maxZ=this._maxZ,x.width=this._width,x.height=this._height}static Parse(x,O){const Q=new l(x.name,O);return Q._subdivisionsX=x.subdivisionsX||1,Q._subdivisionsY=x.subdivisionsY||1,Q._minX=x.minX,Q._maxX=x.maxX,Q._minZ=x.lo,Q._maxZ=x.maxZ,Q._width=x.width,Q._height=x.height,Q}}var C=Q(10894),U=Q(10877),L=Q(10853),h=Q(11227);function N(x){const O=[],Q=[],Z=[],n=[];let o,l;const C=x.width||x.size||1,U=x.height||x.size||1,L=0|(x.subdivisionsX||x.subdivisions||1),N=0|(x.subdivisionsY||x.subdivisions||1);for(o=0;o<=N;o++)for(l=0;l<=L;l++){const x=new X.n(l*C/L-C/2,0,(N-o)*U/N-U/2),O=new X.n(0,1,0);Q.push(x.x,x.y,x.z),Z.push(O.x,O.y,O.z),n.push(l/L,h.e?o/N:1-o/N)}for(o=0;o<N;o++)for(l=0;l<L;l++)O.push(l+1+(o+1)*(L+1)),O.push(l+1+o*(L+1)),O.push(l+o*(L+1)),O.push(l+(o+1)*(L+1)),O.push(l+1+(o+1)*(L+1)),O.push(l+o*(L+1));const a=new V.d;return a.indices=O,a.tx=Q,a.ux=Z,a.Ex=n,a}function a(x){const O=void 0!==x.xmin&&null!==x.xmin?x.xmin:-1,Q=void 0!==x.zmin&&null!==x.zmin?x.zmin:-1,Z=void 0!==x.xmax&&null!==x.xmax?x.xmax:1,n=void 0!==x.zmax&&null!==x.zmax?x.zmax:1,o=x.subdivisions||{w:1,h:1},l=x.precision||{w:1,h:1},C=[],U=[],L=[],h=[];let N,a,K,M;o.h=o.h<1?1:o.h,o.w=o.w<1?1:o.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;const Y=(Z-O)/o.w,g=(n-Q)/o.h;function v(x,O,Q,Z){const n=U.length/3,V=l.w+1;for(N=0;N<l.h;N++)for(a=0;a<l.w;a++){const x=[n+a+N*V,n+(a+1)+N*V,n+(a+1)+(N+1)*V,n+a+(N+1)*V];C.push(x[1]),C.push(x[2]),C.push(x[3]),C.push(x[0]),C.push(x[1]),C.push(x[3])}const o=X.n.Zero(),K=new X.n(0,1,0);for(N=0;N<=l.h;N++)for(o.z=N*(Z-O)/l.h+O,a=0;a<=l.w;a++)o.x=a*(Q-x)/l.w+x,o.y=0,U.push(o.x,o.y,o.z),L.push(K.x,K.y,K.z),h.push(a/l.w,N/l.h)}for(K=0;K<o.h;K++)for(M=0;M<o.w;M++)v(O+M*Y,Q+K*g,O+(M+1)*Y,Q+(K+1)*g);const R=new V.d;return R.indices=C,R.tx=U,R.ux=L,R.Ex=h,R}function K(x){const O=[],Q=[],n=[],o=[];let l,C;const U=x.colorFilter||new Z.d(.3,.59,.11),h=x.alphaFilter||0;let N=!1;if(x.minHeight>x.maxHeight){N=!0;const O=x.maxHeight;x.maxHeight=x.minHeight,x.minHeight=O}for(l=0;l<=x.subdivisions;l++)for(C=0;C<=x.subdivisions;C++){const O=new X.n(C*x.width/x.subdivisions-x.width/2,0,(x.subdivisions-l)*x.height/x.subdivisions-x.height/2),Z=4*(((O.x+x.width/2)/x.width*(x.bufferWidth-1)|0)+((1-(O.z+x.height/2)/x.height)*(x.bufferHeight-1)|0)*x.bufferWidth);let V=x.buffer[Z]/255,a=x.buffer[Z+1]/255,K=x.buffer[Z+2]/255;const M=x.buffer[Z+3]/255;N&&(V=1-V,a=1-a,K=1-K);const Y=V*U.r+a*U.g+K*U.b;O.y=M>=h?x.minHeight+(x.maxHeight-x.minHeight)*Y:x.minHeight-L.e,x.heightBuffer&&(x.heightBuffer[l*(x.subdivisions+1)+C]=O.y),Q.push(O.x,O.y,O.z),n.push(0,0,0),o.push(C/x.subdivisions,1-l/x.subdivisions)}for(l=0;l<x.subdivisions;l++)for(C=0;C<x.subdivisions;C++){const X=C+1+(l+1)*(x.subdivisions+1),Z=C+1+l*(x.subdivisions+1),n=C+l*(x.subdivisions+1),V=C+(l+1)*(x.subdivisions+1),o=Q[3*X+1]>=x.minHeight,U=Q[3*Z+1]>=x.minHeight,L=Q[3*n+1]>=x.minHeight;o&&U&&L&&(O.push(X),O.push(Z),O.push(n));Q[3*V+1]>=x.minHeight&&o&&L&&(O.push(V),O.push(X),O.push(n))}V.d.ComputeNormals(Q,O,n);const a=new V.d;return a.indices=O,a.tx=Q,a.ux=n,a.Ex=o,a}function M(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=new l(x,arguments.length>2?arguments[2]:void 0);Q._setReady(!1),Q._subdivisionsX=O.subdivisionsX||O.subdivisions||1,Q._subdivisionsY=O.subdivisionsY||O.subdivisions||1,Q._width=O.width||1,Q._height=O.height||1,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ;return N(O).Fx(Q,O.updatable),Q._setReady(!0),Q}function Y(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new n.b(x,Q);return a(O).Fx(X,O.updatable),X}function g(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=Q.width||10,V=Q.height||10,o=Q.subdivisions||1,L=Q.minHeight||0,h=Q.maxHeight||1,N=Q.colorFilter||new Z.d(.3,.59,.11),a=Q.alphaFilter||0,M=Q.updatable,Y=Q.onReady;X=X||U.c.LastCreatedScene;const g=new l(x,X);let v;g._subdivisionsX=o,g._subdivisionsY=o,g._width=n,g._height=V,g._maxX=g._width/2,g._maxZ=g._height/2,g._minX=-g._maxX,g._minZ=-g._maxZ,g._setReady(!1),Q.passHeightBufferInCallback&&(v=new Float32Array((o+1)*(o+1)));const R=(x,O,Q)=>{K({width:n,height:V,subdivisions:o,minHeight:L,maxHeight:h,colorFilter:N,buffer:x,bufferWidth:O,bufferHeight:Q,alphaFilter:a,heightBuffer:v}).Fx(g,M),Y&&Y(g,v),g._setReady(!0)};if("string"===typeof O){const x=x=>{var O;const Q=x.width,Z=x.height;if(X.U)return;const n=null===(O=X)||void 0===O?void 0:O.getEngine().resizeImageBitmap(x,Q,Z);R(n,Q,Z)};C.g.LoadImage(O,x,Q.onError?Q.onError:()=>{},X.offlineProvider)}else R(O.data,O.width,O.height);return g}V.d.CreateGround=N,V.d.CreateTiledGround=a,V.d.CreateGroundFromHeightMap=K,n.b.CreateGround=(x,O,Q,X,Z,n)=>M(x,{width:O,height:Q,subdivisions:X,updatable:n},Z),n.b.CreateTiledGround=(x,O,Q,X,Z,n,V,o,l)=>Y(x,{xmin:O,zmin:Q,xmax:X,zmax:Z,subdivisions:n,precision:V,updatable:l},o),n.b.CreateGroundFromHeightMap=(x,O,Q,X,Z,n,V,o,l,C,U)=>g(x,O,{width:Q,height:X,subdivisions:Z,minHeight:n,maxHeight:V,updatable:l,onReady:C,alphaFilter:U},o)},12871:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>N,g:()=>L,k:()=>h});var X=Q(10849),Z=Q(11201),n=Q(11179),V=Q(11561),o=Q(11060),l=Q(10905);function C(x){const O=[],Q=[],X=x.lines,Z=x.Ax,V=[];let o=0;for(let n=0;n<X.length;n++){const x=X[n];for(let X=0;X<x.length;X++){const{x:l,y:C,z:U}=x[X];if(Q.push(l,C,U),Z){const x=Z[n],{r:O,g:Q,b:o,a:l}=x[X];V.push(O,Q,o,l)}X>0&&(O.push(o-1),O.push(o)),o++}}const l=new n.d;return l.indices=O,l.tx=Q,Z&&(l.Ax=V),l}function U(x){const O=x.dashSize||3,Q=x.gapSize||1,Z=x.dashNb||200,V=x.points,o=[],l=[],C=X.n.Zero();let U=0,L=0,h=0,N=0,a=0,K=0,M=0;for(M=0;M<V.length-1;M++)V[M+1].subtractToRef(V[M],C),U+=C.length();for(h=U/Z,N=O*h/(O+Q),M=0;M<V.length-1;M++){V[M+1].subtractToRef(V[M],C),L=Math.floor(C.length()/h),C.normalize();for(let x=0;x<L;x++)a=h*x,o.push(V[M].x+a*C.x,V[M].y+a*C.y,V[M].z+a*C.z),o.push(V[M].x+(a+N)*C.x,V[M].y+(a+N)*C.y,V[M].z+(a+N)*C.z),l.push(K,K+1),K+=2}const Y=new n.d;return Y.tx=o,Y.indices=l,Y}function L(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=O.instance,Z=O.lines,n=O.Ax;if(X){const x=X.getVerticesData(o.g.PositionKind);let O,Q;n&&(O=X.getVerticesData(o.g.ColorKind));let V=0,l=0;for(let X=0;X<Z.length;X++){const o=Z[X];for(let Z=0;Z<o.length;Z++)x[V]=o[Z].x,x[V+1]=o[Z].y,x[V+2]=o[Z].z,n&&O&&(Q=n[X],O[l]=Q[Z].r,O[l+1]=Q[Z].g,O[l+2]=Q[Z].b,O[l+3]=Q[Z].a,l+=4),V+=3}return X.updateVerticesData(o.g.PositionKind,x,!1,!1),n&&O&&X.updateVerticesData(o.g.ColorKind,O,!1,!1),X.refreshBoundingInfo(),X}const l=!!n,U=new V.e(x,Q,null,void 0,void 0,l,O.useVertexAlpha,O.material);return C(O).Fx(U,O.updatable),U}function h(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=O.Ax?[O.Ax]:null;return L(x,{lines:[O.points],updatable:O.updatable,instance:O.instance,Ax:X,useVertexAlpha:O.useVertexAlpha,material:O.material},Q)}function N(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=O.points,o=O.instance,C=O.gapSize||1,L=O.dashSize||3;if(o){const x=x=>{const O=X.n.Zero(),Q=x.length/6;let Z=0,V=0,l=0,C=0,U=0,L=0,h=0,N=0;for(h=0;h<n.length-1;h++)n[h+1].subtractToRef(n[h],O),Z+=O.length();l=Z/Q;const a=o._creationDataStorage.dashSize;for(C=a*l/(a+o._creationDataStorage.gapSize),h=0;h<n.length-1;h++)for(n[h+1].subtractToRef(n[h],O),V=Math.floor(O.length()/l),O.normalize(),N=0;N<V&&L<x.length;)U=l*N,x[L]=n[h].x+U*O.x,x[L+1]=n[h].y+U*O.y,x[L+2]=n[h].z+U*O.z,x[L+3]=n[h].x+(U+C)*O.x,x[L+4]=n[h].y+(U+C)*O.y,x[L+5]=n[h].z+(U+C)*O.z,L+=6,N++;for(;L<x.length;)x[L]=n[h].x,x[L+1]=n[h].y,x[L+2]=n[h].z,L+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&l.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),o.updateMeshPositions(x,!1),o}const h=new V.e(x,Q,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return U(O).Fx(h,O.updatable),h._creationDataStorage=new Z.f,h._creationDataStorage.dashSize=L,h._creationDataStorage.gapSize=C,h}n.d.CreateLineSystem=C,n.d.CreateDashedLines=U,Z.b.OC=function(x,O){return h(x,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Z.b.CreateDashedLines=function(x,O,Q,X,Z){return N(x,{points:O,dashSize:Q,gapSize:X,dashNb:Z,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12260:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>o,f:()=>l});var X=Q(11201),Z=Q(11179),n=Q(11227);function V(x){const O=[],Q=[],X=[],V=[],o=void 0!==x.width?x.width:void 0!==x.size?x.size:1,l=void 0!==x.height?x.height:void 0!==x.size?x.size:1,C=0===x.sideOrientation?0:x.sideOrientation||Z.d.DEFAULTSIDE,U=o/2,L=l/2;Q.push(-U,-L,0),X.push(0,0,-1),V.push(0,n.e?1:0),Q.push(U,-L,0),X.push(0,0,-1),V.push(1,n.e?1:0),Q.push(U,L,0),X.push(0,0,-1),V.push(1,n.e?0:1),Q.push(-U,L,0),X.push(0,0,-1),V.push(0,n.e?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),Z.d._ComputeSides(C,Q,O,X,V,x.frontUVs,x.backUVs);const h=new Z.d;return h.indices=O,h.tx=Q,h.ux=X,h.Ex=V,h}function o(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new X.b(x,Q);O.sideOrientation=X.b._GetDefaultSideOrientation(O.sideOrientation),Z._originalBuilderSideOrientation=O.sideOrientation;return V(O).Fx(Z,O.updatable),O.sourcePlane&&(Z.translate(O.sourcePlane.QQ,-O.sourcePlane.d),Z.setDirection(O.sourcePlane.QQ.scale(-1))),Z}const l={XC:o};Z.d.XC=V,X.b.XC=(x,O,Q,X,Z)=>o(x,{size:O,width:O,height:O,sideOrientation:Z,updatable:X},Q)},12352:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>l});var X=Q(10849),Z=Q(11201),n=Q(11179),V=Q(11227);function o(x){const O=0|(x.segments||32),Q=x.diameterX||x.diameter||1,Z=x.diameterY||x.diameter||1,o=x.diameterZ||x.diameter||1,l=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1,C=x.slice&&x.slice<=0?1:x.slice||1,U=0===x.sideOrientation?0:x.sideOrientation||n.d.DEFAULTSIDE,L=!!x.dedupTopBottomIndices,h=new X.n(Q/2,Z/2,o/2),N=2+O,a=2*N,K=[],M=[],Y=[],g=[];for(let n=0;n<=N;n++){const x=n/N,O=x*Math.PI*C;for(let Q=0;Q<=a;Q++){const Z=Q/a,n=Z*Math.PI*2*l,o=X.c.RotationZ(-O),C=X.c.RotationY(n),U=X.n.TransformCoordinates(X.n.Up(),o),L=X.n.TransformCoordinates(U,C),N=L.multiply(h),K=L.divide(h).normalize();M.push(N.x,N.y,N.z),Y.push(K.x,K.y,K.z),g.push(Z,V.e?1-x:x)}if(n>0){const x=M.length/3;for(let O=x-2*(a+1);O+a+2<x;O++)L?(n>1&&(K.push(O),K.push(O+1),K.push(O+a+1)),(n<N||C<1)&&(K.push(O+a+1),K.push(O+1),K.push(O+a+2))):(K.push(O),K.push(O+1),K.push(O+a+1),K.push(O+a+1),K.push(O+1),K.push(O+a+2))}}n.d._ComputeSides(U,M,K,Y,g,x.frontUVs,x.backUVs);const v=new n.d;return v.indices=K,v.tx=M,v.ux=Y,v.Ex=g,v}function l(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return o(O).Fx(X,O.updatable),X}n.d.CreateSphere=o,Z.b.CreateSphere=(x,O,Q,X,Z,n)=>l(x,{segments:O,diameterX:Q,diameterY:Q,diameterZ:Q,sideOrientation:n,updatable:Z},X)},13201:(x,O,Q)=>{"use strict";Q.d(O,{d:()=>o});var X=Q(11597),Z=Q(12682),n=Q(11614),V=Q(11179);class o{static get Configuration(){return{get decoder(){return Z.e.DefaultConfiguration},set decoder(x){Z.e.DefaultConfiguration=x}}}static set Configuration(x){Z.e.DefaultConfiguration=x.decoder}static get DecoderAvailable(){return(0,X.f)(Z.e.DefaultConfiguration)}static get Default(){return o._Default??(o._Default=new o),o._Default}static ResetDefault(x){o._Default&&(x||o._Default.dispose(),o._Default=null)}constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.DefaultNumWorkers;const O="number"===typeof x?{...Z.e.DefaultConfiguration,numWorkers:x}:{...Z.e.DefaultConfiguration,...x};this._decoder=new Z.e(O)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(x,O,Q){return this._decoder.decodeMeshToMeshDataAsync(x,O,Q)}async decodeMeshToGeometryAsync(x,O,Q,X){return await this._decoder.decodeMeshToGeometryAsync(x,O,Q,X)}async _decodeMeshToGeometryForGltfAsync(x,O,Q,X,Z,n){return await this._decoder._decodeMeshToGeometryForGltfAsync(x,O,Q,X,Z,n)}async decodeMeshAsync(x,O){const Q=await this._decoder.decodeMeshToMeshDataAsync(x,O),X=new V.d;Q.indices&&(X.indices=Q.indices);for(const Z of Q.attributes){const x=n.c.GetFloatData(Z.data,Z.size,n.c.GetDataType(Z.data),Z.byteOffset,Z.byteStride,Z.normalized,Q.totalVertices);X.set(x,Z.kind)}return X}}o.DefaultNumWorkers=(0,X.c)(),o._Default=null},12682:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>C});var X=Q(11597),Z=Q(10894),n=Q(11222),V=Q(11614),o=Q(10905),l=Q(11608);class C extends X.b{static get DefaultAvailable(){return(0,X.f)(C.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(x){C._Default&&(x||C._Default.dispose(),C._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(x,O){return{module:await(O||DracoDecoderModule)({wasmBinary:x})}}_getWorkerContent(){return`${l.c}(${l.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultConfiguration)}decodeMeshToMeshDataAsync(x,O,Q){const X=x instanceof ArrayBuffer?new Int8Array(x):new Int8Array(x.buffer,x.byteOffset,x.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async x=>await new Promise(((Z,n)=>{x.push(((x,V)=>{let l=null;const C=[],U=O=>{x.removeEventListener("error",U),x.removeEventListener("message",L),n(O),V()},L=O=>{const X=O.data;switch(X.id){case"indices":l=X.data;break;case"attribute":C.push({kind:X.kind,data:X.data,size:X.size,byteOffset:X.byteOffset,byteStride:X.byteStride,normalized:(n=X.kind,h=X.normalized,Q&&void 0!==Q[n]?(h!==Q[n]&&o.e.Warn(`Normalized flag from Draco data (${h}) does not match normalized flag from glTF accessor (${Q[n]}). Using flag from glTF accessor.`),Q[n]):h)});break;case"decodeMeshDone":x.removeEventListener("error",U),x.removeEventListener("message",L),Z({indices:l,attributes:C,totalVertices:X.totalVertices}),V()}var n,h};x.addEventListener("error",U),x.addEventListener("message",L);const h=X.slice();x.postMessage({id:"decodeMesh",dataView:h,attributes:O},[h.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((x=>{let Q=null;const Z=[],n=(0,l.c)(x.module,X,O,(x=>{Q=x}),((x,O,Q,X,n,V)=>{Z.push({kind:x,data:O,size:Q,byteOffset:X,byteStride:n,normalized:V})}));return{indices:Q,attributes:Z,totalVertices:n}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(x,O,Q,X){const Z=await this.decodeMeshToMeshDataAsync(Q,X),o=new n.d(x,O);Z.indices&&o.setIndices(Z.indices);for(const n of Z.attributes)o.setVerticesBuffer(new V.c(O.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),Z.totalVertices);return o}async _decodeMeshToGeometryForGltfAsync(x,O,Q,X,Z,o){const l=await this.decodeMeshToMeshDataAsync(Q,X,Z),C=new n.d(x,O);o&&(C._boundingInfo=o,C.useBoundingInfoFromGeometry=!0),l.indices&&C.setIndices(l.indices);for(const n of l.attributes)C.setVerticesBuffer(new V.c(O.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),l.totalVertices);return C}}C.DefaultConfiguration={wasmUrl:`${Z.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Z.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Z.g._DefaultCdnUrl}/draco_decoder_gltf.js`},C._Default=null},12864:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>ox});var X=Q(10849),Z=Q(11201),n=Q(11060),V=Q(11179),o=Q(11227);function l(x){let O=x.pathArray;const Q=x.closeArray||!1,X=x.closePath||!1,Z=x.invertUV||!1,l=Math.floor(O[0].length/2);let C=x.offset||l;C=C>l?l:Math.floor(C);const U=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,L=x.Ex,h=x.Ax,N=[],a=[],K=[],M=[],Y=[],g=[],v=[],R=[];let s;const q=[],G=[];let k,J,t;if(O.length<2){const x=[],Q=[];for(J=0;J<O[0].length-C;J++)x.push(O[0][J]),Q.push(O[0][J+C]);O=[x,Q]}let c=0;const d=X?1:0,u=Q?1:0;let A,f,E,z,F,b;for(s=O[0].length,k=0;k<O.length+u;k++){for(v[k]=0,Y[k]=[0],A=k===O.length?O[0]:O[k],f=A.length,s=s<f?s:f,t=0;t<f;)N.push(A[t].x,A[t].y,A[t].z),t>0&&(E=A[t].hQ(A[t-1]).length(),z=E+v[k],Y[k].push(z),v[k]=z),t++;X&&(t--,N.push(A[0].x,A[0].y,A[0].z),E=A[t].hQ(A[0]).length(),z=E+v[k],Y[k].push(z),v[k]=z),q[k]=f+d,G[k]=c,c+=f+d}let D,W,y=null,I=null;for(J=0;J<s+d;J++)for(R[J]=0,g[J]=[0],k=0;k<O.length-1+u;k++)F=O[k],b=k===O.length-1?O[0]:O[k+1],J===s?(y=F[0],I=b[0]):(y=F[J],I=b[J]),E=I.hQ(y).length(),z=E+R[J],g[J].push(z),R[J]=z;if(L)for(k=0;k<L.length;k++)M.push(L[k].x,o.e?1-L[k].y:L[k].y);else for(k=0;k<O.length+u;k++)for(J=0;J<s+d;J++)D=0!=v[k]?Y[k][J]/v[k]:0,W=0!=R[J]?g[J][k]/R[J]:0,Z?M.push(W,D):M.push(D,o.e?1-W:W);k=0;let r=0,j=q[k]-1,T=q[k+1]-1,e=j<T?j:T,B=G[1]-G[0];const i=q.length-1;for(;r<=e&&k<i;)a.push(r,r+B,r+1),a.push(r+B+1,r+1,r+B),r+=1,r===e&&(k++,B=G[k+1]-G[k],j=q[k]-1,T=q[k+1]-1,r=G[k],e=j<T?j+r:T+r);if(V.d.ComputeNormals(N,a,K),X){let x=0,Q=0;for(k=0;k<O.length;k++){x=3*G[k],Q=k+1<O.length?3*(G[k+1]-1):K.length-3,K[x]=.5*(K[x]+K[Q]),K[x+1]=.5*(K[x+1]+K[Q+1]),K[x+2]=.5*(K[x+2]+K[Q+2]);const X=Math.sqrt(K[x]*K[x]+K[x+1]*K[x+1]+K[x+2]*K[x+2]);K[x]/=X,K[x+1]/=X,K[x+2]/=X,K[Q]=K[x],K[Q+1]=K[x+1],K[Q+2]=K[x+2]}}if(Q){let x=3*G[0],Q=3*G[O.length];for(J=0;J<s+d;J++){K[x]=.5*(K[x]+K[Q]),K[x+1]=.5*(K[x+1]+K[Q+1]),K[x+2]=.5*(K[x+2]+K[Q+2]);const O=Math.sqrt(K[x]*K[x]+K[x+1]*K[x+1]+K[x+2]*K[x+2]);K[x]/=O,K[x+1]/=O,K[x+2]/=O,K[Q]=K[x],K[Q+1]=K[x+1],K[Q+2]=K[x+2],x+=3,Q+=3}}V.d._ComputeSides(U,N,a,K,M,x.frontUVs,x.backUVs);let H=null;if(h){H=new Float32Array(4*h.length);for(let x=0;x<h.length;x++)H[4*x]=h[x].r,H[4*x+1]=h[x].g,H[4*x+2]=h[x].b,H[4*x+3]=h[x].a}const S=new V.d,p=new Float32Array(N),P=new Float32Array(K),m=new Float32Array(M);return S.indices=a,S.tx=p,S.ux=P,S.Ex=m,H&&S.set(H,n.g.ColorKind),X&&(S._idx=G),S}function C(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=O.pathArray,U=O.closeArray,L=O.closePath,h=Z.b._GetDefaultSideOrientation(O.sideOrientation),N=O.instance,a=O.updatable;if(N){const x=X.j.Oo[0].Zo(Number.MAX_VALUE),Q=X.j.Oo[1].Zo(-Number.MAX_VALUE),l=O=>{let X=C[0].length;const n=N;let V=0;const o=n._originalBuilderSideOrientation===Z.b.DOUBLESIDE?2:1;for(let Z=1;Z<=o;++Z)for(let o=0;o<C.length;++o){const Z=C[o],l=Z.length;X=X<l?X:l;for(let n=0;n<X;++n){const X=Z[n];O[V]=X.x,O[V+1]=X.y,O[V+2]=X.z,x.minimizeInPlaceFromFloats(X.x,X.y,X.z),Q.maximizeInPlaceFromFloats(X.x,X.y,X.z),V+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const x=Z[0];O[V]=x.x,O[V+1]=x.y,O[V+2]=x.z,V+=3}}},U=N.getVerticesData(n.g.PositionKind);if(l(U),N.hasBoundingInfo?N.getBoundingInfo().reConstruct(x,Q,N._worldMatrix):N.buildBoundingInfo(x,Q,N._worldMatrix),N.updateVerticesData(n.g.PositionKind,U,!1,!1),O.Ax){const x=N.getVerticesData(n.g.ColorKind);for(let Q=0,X=0;Q<O.Ax.length;Q++,X+=4){const Z=O.Ax[Q];x[X]=Z.r,x[X+1]=Z.g,x[X+2]=Z.b,x[X+3]=Z.a}N.updateVerticesData(n.g.ColorKind,x,!1,!1)}if(O.Ex){const x=N.getVerticesData(n.g.UVKind);for(let Q=0;Q<O.Ex.length;Q++)x[2*Q]=O.Ex[Q].x,x[2*Q+1]=o.e?1-O.Ex[Q].y:O.Ex[Q].y;N.updateVerticesData(n.g.UVKind,x,!1,!1)}if(!N.areNormalsFrozen||N.isFacetDataEnabled){const x=N.pV(),O=N.getVerticesData(n.g.NormalKind),Q=N.isFacetDataEnabled?N.getFacetDataParameters():null;if(V.d.ComputeNormals(U,x,O,Q),N._creationDataStorage&&N._creationDataStorage.closePath){let x=0,Q=0;for(let X=0;X<C.length;X++)x=3*N._creationDataStorage.idx[X],Q=X+1<C.length?3*(N._creationDataStorage.idx[X+1]-1):O.length-3,O[x]=.5*(O[x]+O[Q]),O[x+1]=.5*(O[x+1]+O[Q+1]),O[x+2]=.5*(O[x+2]+O[Q+2]),O[Q]=O[x],O[Q+1]=O[x+1],O[Q+2]=O[x+2]}N.areNormalsFrozen||N.updateVerticesData(n.g.NormalKind,O,!1,!1)}return N}{const X=new Z.b(x,Q);X._originalBuilderSideOrientation=h,X._creationDataStorage=new Z.f;const n=l(O);return L&&(X._creationDataStorage.idx=n._idx),X._creationDataStorage.closePath=L,X._creationDataStorage.closeArray=U,n.Fx(X,a),X}}V.d.CreateRibbon=l,Z.b.CreateRibbon=function(x,O){return C(x,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var U=Q(12357),L=Q(12207),h=Q(11133);function N(x){const O=x.pattern||Z.b.NO_FLIP,Q=x.tileWidth||x.tileSize||1,X=x.tileHeight||x.tileSize||1,n=x.alignHorizontal||0,o=x.alignVertical||0,l=x.width||x.size||1,C=Math.floor(l/Q);let U=l-C*Q;const L=x.height||x.size||1,h=Math.floor(L/X);let N=L-h*X;const a=Q*C/2,K=X*h/2;let M=0,Y=0,g=0,v=0,R=0,s=0;if(U>0||N>0){switch(g=-a,v=-K,R=a,s=K,n){case Z.b.CENTER:U/=2,g-=U,R+=U;break;case Z.b.LEFT:R+=U,M=-U/2;break;case Z.b.RIGHT:g-=U,M=U/2}switch(o){case Z.b.CENTER:N/=2,v-=N,s+=N;break;case Z.b.BOTTOM:s+=N,Y=-N/2;break;case Z.b.TOP:v-=N,Y=N/2}}const q=[],G=[],k=[];k[0]=[0,0,1,0,1,1,0,1],k[1]=[0,0,1,0,1,1,0,1],O!==Z.b.ROTATE_TILE&&O!==Z.b.ROTATE_ROW||(k[1]=[1,1,0,1,0,0,1,0]),O!==Z.b.FLIP_TILE&&O!==Z.b.FLIP_ROW||(k[1]=[1,0,0,0,0,1,1,1]),O!==Z.b.FLIP_N_ROTATE_TILE&&O!==Z.b.FLIP_N_ROTATE_ROW||(k[1]=[0,1,1,1,1,0,0,0]);let J=[];const t=[],c=[];let d=0;for(let V=0;V<h;V++)for(let x=0;x<C;x++)q.push(x*Q-a+M,V*X-K+Y,0),q.push((x+1)*Q-a+M,V*X-K+Y,0),q.push((x+1)*Q-a+M,(V+1)*X-K+Y,0),q.push(x*Q-a+M,(V+1)*X-K+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),J=O===Z.b.FLIP_TILE||O===Z.b.ROTATE_TILE||O===Z.b.FLIP_N_ROTATE_TILE?J.concat(k[(x%2+V%2)%2]):O===Z.b.FLIP_ROW||O===Z.b.ROTATE_ROW||O===Z.b.FLIP_N_ROTATE_ROW?J.concat(k[V%2]):J.concat(k[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),d+=4;if(U>0||N>0){const x=N>0&&(o===Z.b.CENTER||o===Z.b.TOP),V=N>0&&(o===Z.b.CENTER||o===Z.b.BOTTOM),l=U>0&&(n===Z.b.CENTER||n===Z.b.RIGHT),L=U>0&&(n===Z.b.CENTER||n===Z.b.LEFT);let k,u,A,f,E=[];if(x&&l&&(q.push(g+M,v+Y,0),q.push(-a+M,v+Y,0),q.push(-a+M,v+N+Y,0),q.push(g+M,v+N+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,k=1-U/Q,u=1-N/X,A=1,f=1,E=[k,u,A,u,A,f,k,f],O===Z.b.ROTATE_ROW&&(E=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),O===Z.b.FLIP_ROW&&(E=[1-k,u,1-A,u,1-A,f,1-k,f]),O===Z.b.FLIP_N_ROTATE_ROW&&(E=[k,1-u,A,1-u,A,1-f,k,1-f]),J=J.concat(E),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x&&L&&(q.push(a+M,v+Y,0),q.push(R+M,v+Y,0),q.push(R+M,v+N+Y,0),q.push(a+M,v+N+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,k=0,u=1-N/X,A=U/Q,f=1,E=[k,u,A,u,A,f,k,f],(O===Z.b.ROTATE_ROW||O===Z.b.ROTATE_TILE&&C%2===0)&&(E=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),(O===Z.b.FLIP_ROW||O===Z.b.FLIP_TILE&&C%2===0)&&(E=[1-k,u,1-A,u,1-A,f,1-k,f]),(O===Z.b.FLIP_N_ROTATE_ROW||O===Z.b.FLIP_N_ROTATE_TILE&&C%2===0)&&(E=[k,1-u,A,1-u,A,1-f,k,1-f]),J=J.concat(E),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&l&&(q.push(g+M,K+Y,0),q.push(-a+M,K+Y,0),q.push(-a+M,s+Y,0),q.push(g+M,s+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,k=1-U/Q,u=0,A=1,f=N/X,E=[k,u,A,u,A,f,k,f],(O===Z.b.ROTATE_ROW&&h%2===1||O===Z.b.ROTATE_TILE&&h%1===0)&&(E=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),(O===Z.b.FLIP_ROW&&h%2===1||O===Z.b.FLIP_TILE&&h%2===0)&&(E=[1-k,u,1-A,u,1-A,f,1-k,f]),(O===Z.b.FLIP_N_ROTATE_ROW&&h%2===1||O===Z.b.FLIP_N_ROTATE_TILE&&h%2===0)&&(E=[k,1-u,A,1-u,A,1-f,k,1-f]),J=J.concat(E),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&L&&(q.push(a+M,K+Y,0),q.push(R+M,K+Y,0),q.push(R+M,s+Y,0),q.push(a+M,s+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,k=0,u=0,A=U/Q,f=N/X,E=[k,u,A,u,A,f,k,f],(O===Z.b.ROTATE_ROW&&h%2===1||O===Z.b.ROTATE_TILE&&(h+C)%2===1)&&(E=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),(O===Z.b.FLIP_ROW&&h%2===1||O===Z.b.FLIP_TILE&&(h+C)%2===1)&&(E=[1-k,u,1-A,u,1-A,f,1-k,f]),(O===Z.b.FLIP_N_ROTATE_ROW&&h%2===1||O===Z.b.FLIP_N_ROTATE_TILE&&(h+C)%2===1)&&(E=[k,1-u,A,1-u,A,1-f,k,1-f]),J=J.concat(E),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x){const x=[];k=0,u=1-N/X,A=1,f=1,x[0]=[k,u,A,u,A,f,k,f],x[1]=[k,u,A,u,A,f,k,f],O!==Z.b.ROTATE_TILE&&O!==Z.b.ROTATE_ROW||(x[1]=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),O!==Z.b.FLIP_TILE&&O!==Z.b.FLIP_ROW||(x[1]=[1-k,u,1-A,u,1-A,f,1-k,f]),O!==Z.b.FLIP_N_ROTATE_TILE&&O!==Z.b.FLIP_N_ROTATE_ROW||(x[1]=[k,1-u,A,1-u,A,1-f,k,1-f]);for(let X=0;X<C;X++)q.push(X*Q-a+M,v+Y,0),q.push((X+1)*Q-a+M,v+Y,0),q.push((X+1)*Q-a+M,v+N+Y,0),q.push(X*Q-a+M,v+N+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,J=O===Z.b.FLIP_TILE||O===Z.b.ROTATE_TILE||O===Z.b.FLIP_N_ROTATE_TILE?J.concat(x[(X+1)%2]):O===Z.b.FLIP_ROW||O===Z.b.ROTATE_ROW||O===Z.b.FLIP_N_ROTATE_ROW?J.concat(x[1]):J.concat(x[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(V){const x=[];k=0,u=0,A=1,f=N/X,x[0]=[k,u,A,u,A,f,k,f],x[1]=[k,u,A,u,A,f,k,f],O!==Z.b.ROTATE_TILE&&O!==Z.b.ROTATE_ROW||(x[1]=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),O!==Z.b.FLIP_TILE&&O!==Z.b.FLIP_ROW||(x[1]=[1-k,u,1-A,u,1-A,f,1-k,f]),O!==Z.b.FLIP_N_ROTATE_TILE&&O!==Z.b.FLIP_N_ROTATE_ROW||(x[1]=[k,1-u,A,1-u,A,1-f,k,1-f]);for(let X=0;X<C;X++)q.push(X*Q-a+M,s-N+Y,0),q.push((X+1)*Q-a+M,s-N+Y,0),q.push((X+1)*Q-a+M,s+Y,0),q.push(X*Q-a+M,s+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,J=O===Z.b.FLIP_TILE||O===Z.b.ROTATE_TILE||O===Z.b.FLIP_N_ROTATE_TILE?J.concat(x[(X+h)%2]):O===Z.b.FLIP_ROW||O===Z.b.ROTATE_ROW||O===Z.b.FLIP_N_ROTATE_ROW?J.concat(x[h%2]):J.concat(x[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const x=[];k=1-U/Q,u=0,A=1,f=1,x[0]=[k,u,A,u,A,f,k,f],x[1]=[k,u,A,u,A,f,k,f],O!==Z.b.ROTATE_TILE&&O!==Z.b.ROTATE_ROW||(x[1]=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),O!==Z.b.FLIP_TILE&&O!==Z.b.FLIP_ROW||(x[1]=[1-k,u,1-A,u,1-A,f,1-k,f]),O!==Z.b.FLIP_N_ROTATE_TILE&&O!==Z.b.FLIP_N_ROTATE_ROW||(x[1]=[k,1-u,A,1-u,A,1-f,k,1-f]);for(let Q=0;Q<h;Q++)q.push(g+M,Q*X-K+Y,0),q.push(g+U+M,Q*X-K+Y,0),q.push(g+U+M,(Q+1)*X-K+Y,0),q.push(g+M,(Q+1)*X-K+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,J=O===Z.b.FLIP_TILE||O===Z.b.ROTATE_TILE||O===Z.b.FLIP_N_ROTATE_TILE?J.concat(x[(Q+1)%2]):O===Z.b.FLIP_ROW||O===Z.b.ROTATE_ROW||O===Z.b.FLIP_N_ROTATE_ROW?J.concat(x[Q%2]):J.concat(x[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const x=[];k=0,u=0,A=U/X,f=1,x[0]=[k,u,A,u,A,f,k,f],x[1]=[k,u,A,u,A,f,k,f],O!==Z.b.ROTATE_TILE&&O!==Z.b.ROTATE_ROW||(x[1]=[1-k,1-u,1-A,1-u,1-A,1-f,1-k,1-f]),O!==Z.b.FLIP_TILE&&O!==Z.b.FLIP_ROW||(x[1]=[1-k,u,1-A,u,1-A,f,1-k,f]),O!==Z.b.FLIP_N_ROTATE_TILE&&O!==Z.b.FLIP_N_ROTATE_ROW||(x[1]=[k,1-u,A,1-u,A,1-f,k,1-f]);for(let Q=0;Q<h;Q++)q.push(R-U+M,Q*X-K+Y,0),q.push(R+M,Q*X-K+Y,0),q.push(R+M,(Q+1)*X-K+Y,0),q.push(R-U+M,(Q+1)*X-K+Y,0),c.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,J=O===Z.b.FLIP_TILE||O===Z.b.ROTATE_TILE||O===Z.b.FLIP_N_ROTATE_TILE?J.concat(x[(Q+C)%2]):O===Z.b.FLIP_ROW||O===Z.b.ROTATE_ROW||O===Z.b.FLIP_N_ROTATE_ROW?J.concat(x[Q%2]):J.concat(x[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const u=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE;V.d._ComputeSides(u,q,c,G,J,x.frontUVs,x.backUVs);const A=new V.d;A.indices=c,A.tx=q,A.ux=G,A.Ex=J;const f=u===V.d.DOUBLESIDE?t.concat(t):t;return A.Ax=f,A}function a(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return N(O).Fx(X,O.updatable),X}function K(x){const O=x.faceUV||new Array(6),Q=x.faceColors,n=x.pattern||Z.b.NO_FLIP,l=x.width||x.size||1,C=x.height||x.size||1,U=x.depth||x.size||1,L=x.tileWidth||x.tileSize||1,a=x.tileHeight||x.tileSize||1,K=x.alignHorizontal||0,M=x.alignVertical||0,Y=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE;for(let Z=0;Z<6;Z++)void 0===O[Z]&&(O[Z]=new X.o(0,0,1,1)),Q&&void 0===Q[Z]&&(Q[Z]=new h.h(1,1,1,1));const g=l/2,v=C/2,R=U/2,s=[];for(let X=0;X<2;X++)s[X]=N({pattern:n,tileWidth:L,tileHeight:a,width:l,height:C,alignVertical:M,alignHorizontal:K,sideOrientation:Y});for(let X=2;X<4;X++)s[X]=N({pattern:n,tileWidth:L,tileHeight:a,width:U,height:C,alignVertical:M,alignHorizontal:K,sideOrientation:Y});let q=M;M===Z.b.BOTTOM?q=Z.b.TOP:M===Z.b.TOP&&(q=Z.b.BOTTOM);for(let X=4;X<6;X++)s[X]=N({pattern:n,tileWidth:L,tileHeight:a,width:l,height:U,alignVertical:q,alignHorizontal:K,sideOrientation:Y});let G=[],k=[],J=[],t=[];const c=[],d=[],u=[],A=[];let f=0,E=0;for(let Z=0;Z<6;Z++){const x=s[Z].tx.length;d[Z]=[],u[Z]=[];for(let O=0;O<x/3;O++)d[Z].push(new X.n(s[Z].tx[3*O],s[Z].tx[3*O+1],s[Z].tx[3*O+2])),u[Z].push(new X.n(s[Z].ux[3*O],s[Z].ux[3*O+1],s[Z].ux[3*O+2]));f=s[Z].Ex.length,A[Z]=[];for(let Q=0;Q<f;Q+=2)A[Z][Q]=O[Z].x+(O[Z].z-O[Z].x)*s[Z].Ex[Q],A[Z][Q+1]=O[Z].y+(O[Z].w-O[Z].y)*s[Z].Ex[Q+1],o.e&&(A[Z][Q+1]=1-A[Z][Q+1]);if(J=J.concat(A[Z]),t=t.concat(s[Z].indices.map((x=>x+E))),E+=d[Z].length,Q)for(let O=0;O<4;O++)c.push(Q[Z].r,Q[Z].g,Q[Z].b,Q[Z].a)}const z=new X.n(0,0,R),F=X.c.RotationY(Math.PI);G=d[0].map((x=>X.n.TransformNormal(x,F).add(z))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[]),k=u[0].map((x=>X.n.TransformNormal(x,F))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[]),G=G.concat(d[1].map((x=>x.hQ(z))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[])),k=k.concat(u[1].map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[]));const b=new X.n(g,0,0),D=X.c.RotationY(-Math.PI/2);G=G.concat(d[2].map((x=>X.n.TransformNormal(x,D).add(b))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[])),k=k.concat(u[2].map((x=>X.n.TransformNormal(x,D))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[]));const W=X.c.RotationY(Math.PI/2);G=G.concat(d[3].map((x=>X.n.TransformNormal(x,W).hQ(b))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[])),k=k.concat(u[3].map((x=>X.n.TransformNormal(x,W))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[]));const y=new X.n(0,v,0),I=X.c.RotationX(Math.PI/2);G=G.concat(d[4].map((x=>X.n.TransformNormal(x,I).add(y))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[])),k=k.concat(u[4].map((x=>X.n.TransformNormal(x,I))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[]));const r=X.c.RotationX(-Math.PI/2);G=G.concat(d[5].map((x=>X.n.TransformNormal(x,r).hQ(y))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[])),k=k.concat(u[5].map((x=>X.n.TransformNormal(x,r))).map((x=>[x.x,x.y,x.z])).reduce(((x,O)=>x.concat(O)),[])),V.d._ComputeSides(Y,G,t,k,J);const j=new V.d;if(j.indices=t,j.tx=G,j.ux=k,j.Ex=J,Q){const x=Y===V.d.DOUBLESIDE?c.concat(c):c;j.Ax=x}return j}function M(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return K(O).Fx(X,O.updatable),X}V.d.CreateTiledPlane=N;V.d.CreateTiledBox=K;var Y=Q(12352),g=Q(11423),v=Q(11189);function R(x){const O=x.height||2;let Q=0===x.diameterTop?0:x.diameterTop||x.diameter||1,n=0===x.diameterBottom?0:x.diameterBottom||x.diameter||1;Q=Q||1e-5,n=n||1e-5;const l=0|(x.tessellation||24),C=0|(x.subdivisions||1),U=!!x.hasRings,L=!!x.enclose,N=0===x.cap?0:x.cap||Z.b.CAP_ALL,a=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1,K=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,M=x.faceUV||new Array(3),Y=x.faceColors,g=2+(1+(1!==a&&L?2:0))*(U?C:1);let R;for(R=0;R<g;R++)Y&&void 0===Y[R]&&(Y[R]=new h.h(1,1,1,1));for(R=0;R<g;R++)M&&void 0===M[R]&&(M[R]=new X.o(0,0,1,1));const s=[],q=[],G=[],k=[],J=[],t=2*Math.PI*a/l;let c,d,u;const A=(n-Q)/2/O,f=X.n.Zero(),E=X.n.Zero(),z=X.n.Zero(),F=X.n.Zero(),b=X.n.Zero(),D=v.b.Y;let W,y,I,r=1,j=1,T=0,e=0;for(W=0;W<=C;W++)for(d=W/C,u=(d*(Q-n)+n)/2,r=U&&0!==W&&W!==C?2:1,I=0;I<r;I++){for(U&&(j+=I),L&&(j+=2*I),y=0;y<=l;y++)c=y*t,f.x=Math.cos(-c)*u,f.y=-O/2+d*O,f.z=Math.sin(-c)*u,0===Q&&W===C?(E.x=G[G.length-3*(l+1)],E.y=G[G.length-3*(l+1)+1],E.z=G[G.length-3*(l+1)+2]):(E.x=f.x,E.z=f.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*A,E.normalize()),0===y&&(z.V(f),F.V(E)),q.push(f.x,f.y,f.z),G.push(E.x,E.y,E.z),e=U?T!==j?M[j].y:M[j].w:M[j].y+(M[j].w-M[j].y)*d,k.push(M[j].x+(M[j].z-M[j].x)*y/l,o.e?1-e:e),Y&&J.push(Y[j].r,Y[j].g,Y[j].b,Y[j].a);1!==a&&L&&(q.push(f.x,f.y,f.z),q.push(0,f.y,0),q.push(0,f.y,0),q.push(z.x,z.y,z.z),X.n.CrossToRef(D,E,b),b.normalize(),G.push(b.x,b.y,b.z,b.x,b.y,b.z),X.n.CrossToRef(F,D,b),b.normalize(),G.push(b.x,b.y,b.z,b.x,b.y,b.z),e=U?T!==j?M[j+1].y:M[j+1].w:M[j+1].y+(M[j+1].w-M[j+1].y)*d,k.push(M[j+1].x,o.e?1-e:e),k.push(M[j+1].z,o.e?1-e:e),e=U?T!==j?M[j+2].y:M[j+2].w:M[j+2].y+(M[j+2].w-M[j+2].y)*d,k.push(M[j+2].x,o.e?1-e:e),k.push(M[j+2].z,o.e?1-e:e),Y&&(J.push(Y[j+1].r,Y[j+1].g,Y[j+1].b,Y[j+1].a),J.push(Y[j+1].r,Y[j+1].g,Y[j+1].b,Y[j+1].a),J.push(Y[j+2].r,Y[j+2].g,Y[j+2].b,Y[j+2].a),J.push(Y[j+2].r,Y[j+2].g,Y[j+2].b,Y[j+2].a))),T!==j&&(T=j)}const B=1!==a&&L?l+4:l;for(W=0,j=0;j<C;j++){let x=0,O=0,Q=0,X=0;for(y=0;y<l;y++)x=W*(B+1)+y,O=(W+1)*(B+1)+y,Q=W*(B+1)+(y+1),X=(W+1)*(B+1)+(y+1),s.push(x,O,Q),s.push(X,Q,O);1!==a&&L&&(s.push(x+2,O+2,Q+2),s.push(X+2,Q+2,O+2),s.push(x+4,O+4,Q+4),s.push(X+4,Q+4,O+4)),W=U?W+2:W+1}const i=x=>{const Z=x?Q/2:n/2;if(0===Z)return;let V,C,U;const L=x?M[g-1]:M[0];let h=null;Y&&(h=x?Y[g-1]:Y[0]);const N=q.length/3,K=x?O/2:-O/2,v=new X.n(0,K,0);q.push(v.x,v.y,v.z),G.push(0,x?1:-1,0);const R=L.y+.5*(L.w-L.y);k.push(L.x+.5*(L.z-L.x),o.e?1-R:R),h&&J.push(h.r,h.g,h.b,h.a);const t=new X.l(.5,.5);for(U=0;U<=l;U++){V=2*Math.PI*U*a/l;const O=Math.cos(-V),Q=Math.sin(-V);C=new X.n(O*Z,K,Q*Z);const n=new X.l(O*t.x+.5,Q*t.y+.5);q.push(C.x,C.y,C.z),G.push(0,x?1:-1,0);const N=L.y+(L.w-L.y)*n.y;k.push(L.x+(L.z-L.x)*n.x,o.e?1-N:N),h&&J.push(h.r,h.g,h.b,h.a)}for(U=0;U<l;U++)x?(s.push(N),s.push(N+(U+2)),s.push(N+(U+1))):(s.push(N),s.push(N+(U+1)),s.push(N+(U+2)))};N!==Z.b.CAP_START&&N!==Z.b.CAP_ALL||i(!1),N!==Z.b.CAP_END&&N!==Z.b.CAP_ALL||i(!0),V.d._ComputeSides(K,q,s,G,k,x.frontUVs,x.backUVs);const H=new V.d;return H.indices=s,H.tx=q,H.ux=G,H.Ex=k,Y&&(H.Ax=J),H}function s(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return R(O).Fx(X,O.updatable),X}function q(x){const O=[],Q=[],Z=[],n=[],l=x.diameter||1,C=x.thickness||.5,U=0|(x.tessellation||16),L=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,h=U+1;for(let V=0;V<=U;V++){const x=V/U,L=V*Math.PI*2/U-Math.PI/2,N=X.c.Translation(l/2,0,0).multiply(X.c.RotationY(L));for(let l=0;l<=U;l++){const L=1-l/U,a=l*Math.PI*2/U+Math.PI,K=Math.cos(a),M=Math.sin(a);let Y=new X.n(K,M,0),g=Y.scale(C/2);const v=new X.l(x,L);g=X.n.TransformCoordinates(g,N),Y=X.n.TransformNormal(Y,N),Q.push(g.x,g.y,g.z),Z.push(Y.x,Y.y,Y.z),n.push(v.x,o.e?1-v.y:v.y);const R=(V+1)%h,s=(l+1)%h;O.push(V*h+l),O.push(V*h+s),O.push(R*h+l),O.push(V*h+s),O.push(R*h+s),O.push(R*h+l)}}V.d._ComputeSides(L,Q,O,Z,n,x.frontUVs,x.backUVs);const N=new V.d;return N.indices=O,N.tx=Q,N.ux=Z,N.Ex=n,N}function G(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return q(O).Fx(X,O.updatable),X}V.d.CreateCylinder=R,Z.b.CreateCylinder=(x,O,Q,X,n,V,o,l,C)=>{void 0!==o&&o instanceof g.d||(void 0!==o&&(C=l||Z.b.DEFAULTSIDE,l=o),o=V,V=1);return s(x,{height:O,diameterTop:Q,diameterBottom:X,tessellation:n,subdivisions:V,sideOrientation:C,updatable:l},o)};function k(x){const O=[],Q=[],Z=[],n=[],l=x.radius||2,C=x.tube||.5,U=x.radialSegments||32,L=x.tubularSegments||32,h=x.p||2,N=x.q||3,a=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,K=x=>{const O=Math.cos(x),Q=Math.sin(x),Z=N/h*x,n=Math.cos(Z),V=l*(2+n)*.5*O,o=l*(2+n)*Q*.5,C=l*Math.sin(Z)*.5;return new X.n(V,o,C)};let M,Y;for(M=0;M<=U;M++){const x=M%U/U*2*h*Math.PI,O=K(x),Z=K(x+.01),V=Z.hQ(O);let l=Z.add(O);const N=X.n.Cross(V,l);for(l=X.n.Cross(N,V),N.normalize(),l.normalize(),Y=0;Y<L;Y++){const x=Y%L/L*2*Math.PI,X=-C*Math.cos(x),Z=C*Math.sin(x);Q.push(O.x+X*l.x+Z*N.x),Q.push(O.y+X*l.y+Z*N.y),Q.push(O.z+X*l.z+Z*N.z),n.push(M/U),n.push(o.e?1-Y/L:Y/L)}}for(M=0;M<U;M++)for(Y=0;Y<L;Y++){const x=(Y+1)%L,Q=M*L+Y,X=(M+1)*L+Y,Z=(M+1)*L+x,n=M*L+x;O.push(n),O.push(X),O.push(Q),O.push(n),O.push(Z),O.push(X)}V.d.ComputeNormals(Q,O,Z),V.d._ComputeSides(a,Q,O,Z,n,x.frontUVs,x.backUVs);const g=new V.d;return g.indices=O,g.tx=Q,g.ux=Z,g.Ex=n,g}function J(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return k(O).Fx(X,O.updatable),X}V.d.CreateTorus=q,Z.b.CreateTorus=(x,O,Q,X,Z,n,V)=>G(x,{diameter:O,thickness:Q,tessellation:X,sideOrientation:V,updatable:n},Z);V.d.CreateTorusKnot=k,Z.b.CreateTorusKnot=(x,O,Q,X,Z,n,V,o,l,C)=>J(x,{radius:O,tube:Q,radialSegments:X,tubularSegments:Z,p:n,q:V,sideOrientation:C,updatable:l},o);var t=Q(12871),c=Q(11582),d=Q(11315);function u(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=O.path,n=O.shape,V=O.scale||1,o=O.rotation||0,l=0===O.cap?0:O.cap||Z.b.NO_CAP,C=O.updatable,U=Z.b._GetDefaultSideOrientation(O.sideOrientation),L=O.instance||null,h=O.invertUV||!1,N=O.closeShape||!1,a=O.closePath||!1,K=O.capFunction||null;return f(x,n,X,V,o,null,null,a,N,l,!1,Q,!!C,U,L,h,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame,K)}function A(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=O.path,n=O.shape,V=O.scaleFunction||(()=>1),o=O.rotationFunction||(()=>0),l=O.closePath||O.ribbonCloseArray||!1,C=O.closeShape||O.ribbonClosePath||!1,U=0===O.cap?0:O.cap||Z.b.NO_CAP,L=O.updatable,h=O.firstNormal||null,N=O.adjustFrame||!1,a=Z.b._GetDefaultSideOrientation(O.sideOrientation),K=O.instance,M=O.invertUV||!1,Y=O.capFunction||null;return f(x,n,X,null,null,V,o,l,C,U,!0,Q,!!L,a,K||null,M,O.frontUVs||null,O.backUVs||null,h,N,Y||null)}function f(x,O,Q,n,V,o,l,U,L,h,N,a,K,M,Y,g,v,R,s,q,G){const k=(x,O,Q,n,V,o,l,C,U,L,h)=>{const N=Q.getTangents(),a=Q.getNormals(),K=Q.getBinormals(),M=Q.getDistances();if(h)for(let Z=0;Z<N.length;Z++)if(0==N[Z].x&&0==N[Z].y&&0==N[Z].z&&N[Z].V(N[Z-1]),0==a[Z].x&&0==a[Z].y&&0==a[Z].z&&a[Z].V(a[Z-1]),0==K[Z].x&&0==K[Z].y&&0==K[Z].z&&K[Z].V(K[Z-1]),Z>0){let x=N[Z-1];X.n.Dot(x,N[Z])<0&&N[Z].scaleInPlace(-1),x=a[Z-1],X.n.Dot(x,a[Z])<0&&a[Z].scaleInPlace(-1),x=K[Z-1],X.n.Dot(x,K[Z])<0&&K[Z].scaleInPlace(-1)}let Y=0;const g=L&&C?C:()=>null!==o?o:0,v=L&&l?l:()=>null!==V?V:1;let R=U===Z.b.NO_CAP||U===Z.b.CAP_END?0:2;const s=X.j.Matrix[0];for(let Z=0;Z<O.length;Z++){const Q=[],V=g(Z,M[Z]),o=v(Z,M[Z]);X.c.RotationAxisToRef(N[Z],Y,s);for(let n=0;n<x.length;n++){const V=N[Z].scale(x[n].z).add(a[Z].scale(x[n].x)).add(K[Z].scale(x[n].y)),l=X.n.Zero();X.n.TransformCoordinatesToRef(V,s,l),l.scaleInPlace(o).addInPlace(O[Z]),Q[n]=l}n[R]=Q,Y+=V,R++}const q=G||(x=>{const O=Array(),Q=X.n.Zero();let Z;for(Z=0;Z<x.length;Z++)Q.addInPlace(x[Z]);for(Q.scaleInPlace(1/x.length),Z=0;Z<x.length;Z++)O.push(Q);return O});switch(U){case Z.b.NO_CAP:break;case Z.b.CAP_START:n[0]=q(n[2]),n[1]=n[2];break;case Z.b.CAP_END:n[R]=n[R-1],n[R+1]=q(n[R-1]);break;case Z.b.CAP_ALL:n[0]=q(n[2]),n[1]=n[2],n[R]=n[R-1],n[R+1]=q(n[R-1])}return n};let J,t;if(Y){const x=Y._creationDataStorage;return J=s?x.path3D.update(Q,s):x.path3D.update(Q),t=k(O,Q,x.path3D,x.pathArray,n,V,o,l,x.cap,N,q),Y=C("",{pathArray:t,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:Y},a||void 0)}J=s?new d.m(Q,s):new d.m(Q);t=k(O,Q,J,new Array,n,V,o,l,h=h<0||h>3?0:h,N,q);const c=C(x,{pathArray:t,closeArray:U,closePath:L,updatable:K,sideOrientation:M,invertUV:g,frontUVs:v||void 0,backUVs:R||void 0},a);return c._creationDataStorage.pathArray=t,c._creationDataStorage.path3D=J,c._creationDataStorage.cap=h,c}function E(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,V=void 0===O.closed||O.closed,o=O.shape,l=O.radius||1,U=O.tessellation||64,L=O.clip||0,h=O.updatable,N=Z.b._GetDefaultSideOrientation(O.sideOrientation),a=O.cap||Z.b.NO_CAP,K=2*Math.PI,M=[],Y=O.invertUV||!1;let g=0,v=0;const R=K/U*n;let s,q;for(g=0;g<=U-L;g++){for(q=[],a!=Z.b.CAP_START&&a!=Z.b.CAP_ALL||(q.push(new X.n(0,o[0].y,0)),q.push(new X.n(Math.cos(g*R)*o[0].x*l,o[0].y,Math.sin(g*R)*o[0].x*l))),v=0;v<o.length;v++)s=new X.n(Math.cos(g*R)*o[v].x*l,o[v].y,Math.sin(g*R)*o[v].x*l),q.push(s);a!=Z.b.CAP_END&&a!=Z.b.CAP_ALL||(q.push(new X.n(Math.cos(g*R)*o[o.length-1].x*l,o[o.length-1].y,Math.sin(g*R)*o[o.length-1].x*l)),q.push(new X.n(0,o[o.length-1].y,0))),M.push(q)}return C(x,{pathArray:M,closeArray:V,sideOrientation:N,updatable:h,invertUV:Y,frontUVs:O.frontUVs,backUVs:O.backUVs},Q)}Z.b.ExtrudeShape=function(x,O,Q,X,n,V){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,U=arguments.length>9?arguments[9]:void 0;return u(x,{shape:O,path:Q,scale:X,rotation:n,cap:0===V?0:V||Z.b.NO_CAP,sideOrientation:C,instance:U,updatable:l},o)},Z.b.ExtrudeShapeCustom=(x,O,Q,X,n,V,o,l,C,U,L,h)=>A(x,{shape:O,path:Q,scaleFunction:X,rotationFunction:n,ribbonCloseArray:V,ribbonClosePath:o,cap:0===l?0:l||Z.b.NO_CAP,sideOrientation:L,instance:h,updatable:U},C);Z.b.CreateLathe=(x,O,Q,X,Z,n,V)=>E(x,{shape:O,radius:Q,tessellation:X,sideOrientation:V,updatable:n},Z);var z=Q(12260),F=Q(12214);function b(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=O.path;let V=O.instance,o=1;void 0!==O.radius?o=O.radius:V&&(o=V._creationDataStorage.radius);const l=O.tessellation||64,U=O.radiusFunction||null;let L=O.cap||Z.b.NO_CAP;const h=O.invertUV||!1,N=O.updatable,a=Z.b._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const K=(x,O,Q,n,V,o,l,C)=>{const U=O.getTangents(),L=O.getNormals(),h=O.getDistances(),N=2*Math.PI/V*C,a=o||(()=>n);let K,M,Y,g;const v=X.j.Matrix[0];let R=l===Z.b.NO_CAP||l===Z.b.CAP_END?0:2;for(let Z=0;Z<x.length;Z++){M=a(Z,h[Z]),K=Array(),Y=L[Z];for(let O=0;O<V;O++)X.c.RotationAxisToRef(U[Z],N*O,v),g=K[O]?K[O]:X.n.Zero(),X.n.TransformCoordinatesToRef(Y,v,g),g.scaleInPlace(M).addInPlace(x[Z]),K[O]=g;Q[R]=K,R++}const s=(O,Q)=>{const X=Array();for(let Z=0;Z<O;Z++)X.push(x[Q]);return X};switch(l){case Z.b.NO_CAP:break;case Z.b.CAP_START:Q[0]=s(V,0),Q[1]=Q[2].slice(0);break;case Z.b.CAP_END:Q[R]=Q[R-1].slice(0),Q[R+1]=s(V,x.length-1);break;case Z.b.CAP_ALL:Q[0]=s(V,0),Q[1]=Q[2].slice(0),Q[R]=Q[R-1].slice(0),Q[R+1]=s(V,x.length-1)}return Q};let M,Y;if(V){const x=V._creationDataStorage,Q=O.arc||x.arc;return M=x.path3D.update(n),Y=K(n,M,x.pathArray,o,x.tessellation,U,x.cap,Q),V=C("",{pathArray:Y,instance:V}),x.path3D=M,x.pathArray=Y,x.arc=Q,x.radius=o,V}M=new d.m(n);L=L<0||L>3?0:L,Y=K(n,M,new Array,o,l,U,L,O.arc);const g=C(x,{pathArray:Y,closePath:!0,closeArray:!1,updatable:N,sideOrientation:a,invertUV:h,frontUVs:O.frontUVs,backUVs:O.backUVs},Q);return g._creationDataStorage.pathArray=Y,g._creationDataStorage.path3D=M,g._creationDataStorage.tessellation=l,g._creationDataStorage.cap=L,g._creationDataStorage.arc=O.arc,g._creationDataStorage.radius=o,g}function D(x){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Q=x.type&&(x.type<0||x.type>=O.length)?0:x.type||0,Z=x.size,n=x.sizeX||Z||1,l=x.sizeY||Z||1,C=x.sizeZ||Z||1,U=x.custom||O[Q],L=U.face.length,N=x.faceUV||new Array(L),a=x.faceColors,K=void 0===x.flat||x.flat,M=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,Y=[],g=[],v=[],R=[],s=[];let q=0,G=0;const k=[];let J,t,c,d,u,A,f=0,E=0;if(K)for(E=0;E<L;E++)a&&void 0===a[E]&&(a[E]=new h.h(1,1,1,1)),N&&void 0===N[E]&&(N[E]=new X.o(0,0,1,1));if(K)for(E=0;E<L;E++){const x=U.face[E].length;for(c=2*Math.PI/x,d=.5*Math.tan(c/2),u=.5,f=0;f<x;f++)Y.push(U.vertex[U.face[E][f]][0]*n,U.vertex[U.face[E][f]][1]*l,U.vertex[U.face[E][f]][2]*C),k.push(q),q++,J=N[E].x+(N[E].z-N[E].x)*(.5+d),t=N[E].y+(N[E].w-N[E].y)*(u-.5),R.push(J,o.e?1-t:t),A=d*Math.cos(c)-u*Math.sin(c),u=d*Math.sin(c)+u*Math.cos(c),d=A,a&&s.push(a[E].r,a[E].g,a[E].b,a[E].a);for(f=0;f<x-2;f++)g.push(k[0+G],k[f+2+G],k[f+1+G]);G+=x}else{for(f=0;f<U.vertex.length;f++)Y.push(U.vertex[f][0]*n,U.vertex[f][1]*l,U.vertex[f][2]*C),R.push(0,o.e?1:0);for(E=0;E<L;E++)for(f=0;f<U.face[E].length-2;f++)g.push(U.face[E][0],U.face[E][f+2],U.face[E][f+1])}V.d.ComputeNormals(Y,g,v),V.d._ComputeSides(M,Y,g,v,R,x.frontUVs,x.backUVs);const z=new V.d;return z.tx=Y,z.indices=g,z.ux=v,z.Ex=R,a&&K&&(z.Ax=s),z}function W(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return D(O).Fx(X,O.updatable),X}Z.b.CreateTube=(x,O,Q,X,Z,n,V,o,l,C)=>b(x,{path:O,radius:Q,tessellation:X,radiusFunction:Z,arc:1,cap:n,updatable:o,sideOrientation:l,instance:C},V);function y(x){const O=x.sideOrientation||V.d.DEFAULTSIDE,Q=x.radius||1,Z=void 0===x.flat||x.flat,n=0|(x.subdivisions||4),l=x.radiusX||Q,C=x.radiusY||Q,U=x.radiusZ||Q,L=(1+Math.sqrt(5))/2,h=[-1,L,-0,1,L,0,-1,-L,0,1,-L,0,0,-1,-L,0,1,-L,0,-1,L,0,1,L,L,0,1,L,0,-1,-L,0,1,-L,0,-1],N=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],a=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],K=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],M=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],Y=[],g=[],v=[],R=[];let s=0;const q=new Array(3),G=new Array(3);let k;for(k=0;k<3;k++)q[k]=X.n.Zero(),G[k]=X.l.Zero();for(let V=0;V<20;V++){for(k=0;k<3;k++){const x=N[3*V+k];q[k].xo(h[3*a[x]],h[3*a[x]+1],h[3*a[x]+2]),q[k].normalize(),G[k].xo(.134765625*K[2*x]+.05859375+-.0390625*M[V],.2333984375*K[2*x+1]+.025390625+.01953125*M[V])}const x=(x,O,Q,V)=>{const L=X.n.Lerp(q[0],q[2],O/n),h=X.n.Lerp(q[1],q[2],O/n),N=n===O?q[2]:X.n.Lerp(L,h,x/(n-O));let a;if(N.normalize(),Z){const x=X.n.Lerp(q[0],q[2],V/n),O=X.n.Lerp(q[1],q[2],V/n);a=X.n.Lerp(x,O,Q/(n-V))}else a=new X.n(N.x,N.y,N.z);a.x/=l,a.y/=C,a.z/=U,a.normalize();const K=X.l.Lerp(G[0],G[2],O/n),M=X.l.Lerp(G[1],G[2],O/n),k=n===O?G[2]:X.l.Lerp(K,M,x/(n-O));g.push(N.x*l,N.y*C,N.z*U),v.push(a.x,a.y,a.z),R.push(k.x,o.e?1-k.y:k.y),Y.push(s),s++};for(let O=0;O<n;O++)for(let Q=0;Q+O<n;Q++)x(Q,O,Q+1/3,O+1/3),x(Q+1,O,Q+1/3,O+1/3),x(Q,O+1,Q+1/3,O+1/3),Q+O+1<n&&(x(Q+1,O,Q+2/3,O+2/3),x(Q+1,O+1,Q+2/3,O+2/3),x(Q,O+1,Q+2/3,O+2/3))}V.d._ComputeSides(O,g,Y,v,R,x.frontUVs,x.backUVs);const J=new V.d;return J.indices=Y,J.tx=g,J.ux=v,J.Ex=R,J}function I(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new Z.b(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),X._originalBuilderSideOrientation=O.sideOrientation;return y(O).Fx(X,O.updatable),X}V.d.CreatePolyhedron=D,Z.b.CreatePolyhedron=(x,O,Q)=>W(x,O,Q);V.d.CreateIcoSphere=y,Z.b.CreateIcoSphere=(x,O,Q)=>I(x,O,Q);var r=Q(10889);const j=new X.n(1,0,0),T=new X.n(-1,0,0),e=new X.n(0,1,0),B=new X.n(0,-1,0),i=new X.n(0,0,1),H=new X.n(0,0,-1);class S{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.n.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.n.Up(),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.l.Zero(),Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=x,this.QQ=O,this.uv=Q,this.vertexIdx=Z,this.vertexIdxForBones=n,this.localPositionOverride=V,this.localNormalOverride=o,this.matrixIndicesOverride=l,this.matrixWeightsOverride=C}clone(){var x,O,Q,X;return new S(this.position.clone(),this.QQ.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(x=this.localPositionOverride)||void 0===x?void 0:x.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(Q=this.matrixIndicesOverride)||void 0===Q?void 0:Q.slice(),null===(X=this.matrixWeightsOverride)||void 0===X?void 0:X.slice())}}function p(x,O,Q){var l,C,U,L,h;const N=!!O.skeleton,a=!(null===(l=O.morphTargetManager)||void 0===l||!l.numTargets),K=Q.localMode||N,M=O.pV(),Y=N||a?O.do(!0,!0):O.getVerticesData(n.g.PositionKind),g=N||a?O.getNormalsData(!0,!0):O.getVerticesData(n.g.NormalKind),v=K?N?O.getVerticesData(n.g.PositionKind):Y:null,R=K?N?O.getVerticesData(n.g.NormalKind):g:null,s=O.getVerticesData(n.g.UVKind),q=N?O.getVerticesData(n.g.MatricesIndicesKind):null,G=N?O.getVerticesData(n.g.MatricesWeightsKind):null,k=N?O.getVerticesData(n.g.MatricesIndicesExtraKind):null,J=N?O.getVerticesData(n.g.MatricesWeightsExtraKind):null,t=Q.position||X.n.Zero();let c=Q.QQ||X.n.Up();const d=Q.size||X.n.One(),u=Q.angle||0;if(!c){const x=new X.n(0,0,1),Q=O.kx().activeCamera,Z=X.n.TransformCoordinates(x,Q.getWorldMatrix());c=Q.globalPosition.hQ(Z)}const A=-Math.atan2(c.z,c.x)-Math.PI/2,f=Math.sqrt(c.x*c.x+c.z*c.z),E=Math.atan2(c.y,f),z=new V.d;z.indices=[],z.tx=[],z.ux=[],z.Ex=[],z.matricesIndices=N?[]:null,z.matricesWeights=N?[]:null,z.matricesIndicesExtra=k?[]:null,z.matricesWeightsExtra=J?[]:null;let F=0;const b=(x,O)=>{const Z=new S;if(!M||!Y||!g)return Z;const n=M[x];if(Z.vertexIdx=3*n,Z.vertexIdxForBones=4*n,Z.position=new X.n(Y[3*n],Y[3*n+1],Y[3*n+2]),X.n.TransformCoordinatesToRef(Z.position,O,Z.position),Z.QQ=new X.n(g[3*n],g[3*n+1],g[3*n+2]),X.n.TransformNormalToRef(Z.QQ,O,Z.QQ),Q.captureUVS&&s){const x=s[2*n+1];Z.uv=new X.l(s[2*n],o.e?1-x:x)}return Z},D=[0,0,0,0],W=(x,O)=>{if(0===x.length)return x;const Q=.5*Math.abs(X.n.Dot(d,O)),Z=(x,O,Q,X)=>{for(let Z=0;Z<X;++Z)if(x[Q+Z]===O)return Q+Z;return-1},n=(x,n)=>{const V=X.n.GetClipFactor(x.position,n.position,O,Q);let o=D,l=D;if(q&&G){const O=x.matrixIndicesOverride?0:x.vertexIdxForBones,Q=x.matrixIndicesOverride??q,X=x.matrixWeightsOverride??G,C=n.matrixIndicesOverride?0:n.vertexIdxForBones,U=n.matrixIndicesOverride??q,L=n.matrixWeightsOverride??G;o=[0,0,0,0],l=[0,0,0,0];let h=0;for(let x=0;x<4;++x)if(X[O+x]>0){const n=Z(U,Q[O+x],C,4);o[h]=Q[O+x],l[h]=(0,r.Lerp)(X[O+x],n>=0?L[n]:0,V),h++}for(let x=0;x<4&&h<4;++x){const X=U[C+x];-1===Z(Q,X,O,4)&&(o[h]=X,l[h]=(0,r.Lerp)(0,L[C+x],V),h++)}const N=l[0]+l[1]+l[2]+l[3];l[0]/=N,l[1]/=N,l[2]/=N,l[3]/=N}const C=x.localPositionOverride?x.localPositionOverride[0]:(null===v||void 0===v?void 0:v[x.vertexIdx])??0,U=x.localPositionOverride?x.localPositionOverride[1]:(null===v||void 0===v?void 0:v[x.vertexIdx+1])??0,L=x.localPositionOverride?x.localPositionOverride[2]:(null===v||void 0===v?void 0:v[x.vertexIdx+2])??0,h=n.localPositionOverride?n.localPositionOverride[0]:(null===v||void 0===v?void 0:v[n.vertexIdx])??0,N=n.localPositionOverride?n.localPositionOverride[1]:(null===v||void 0===v?void 0:v[n.vertexIdx+1])??0,a=n.localPositionOverride?n.localPositionOverride[2]:(null===v||void 0===v?void 0:v[n.vertexIdx+2])??0,K=x.localNormalOverride?x.localNormalOverride[0]:(null===R||void 0===R?void 0:R[x.vertexIdx])??0,M=x.localNormalOverride?x.localNormalOverride[1]:(null===R||void 0===R?void 0:R[x.vertexIdx+1])??0,Y=x.localNormalOverride?x.localNormalOverride[2]:(null===R||void 0===R?void 0:R[x.vertexIdx+2])??0,g=K+((n.localNormalOverride?n.localNormalOverride[0]:(null===R||void 0===R?void 0:R[n.vertexIdx])??0)-K)*V,s=M+((n.localNormalOverride?n.localNormalOverride[1]:(null===R||void 0===R?void 0:R[n.vertexIdx+1])??0)-M)*V,k=Y+((n.localNormalOverride?n.localNormalOverride[2]:(null===R||void 0===R?void 0:R[n.vertexIdx+2])??0)-Y)*V,J=Math.sqrt(g*g+s*s+k*k);return new S(X.n.Lerp(x.position,n.position,V),X.n.Lerp(x.QQ,n.QQ,V).normalize(),X.l.Lerp(x.uv,n.uv,V),-1,-1,v?[C+(h-C)*V,U+(N-U)*V,L+(a-L)*V]:null,R?[g/J,s/J,k/J]:null,o,l)};let V=null;x.length>3&&(V=[]);for(let o=0;o<x.length;o+=3){let Z=0,l=null,C=null,U=null,L=null;const h=X.n.Dot(x[o].position,O)-Q>0,N=X.n.Dot(x[o+1].position,O)-Q>0,a=X.n.Dot(x[o+2].position,O)-Q>0;switch(Z=(h?1:0)+(N?1:0)+(a?1:0),Z){case 0:x.length>3?(V.push(x[o]),V.push(x[o+1]),V.push(x[o+2])):V=x;break;case 1:if(V=V??new Array,h&&(l=x[o+1],C=x[o+2],U=n(x[o],l),L=n(x[o],C)),N){l=x[o],C=x[o+2],U=n(x[o+1],l),L=n(x[o+1],C),V.push(U),V.push(C.clone()),V.push(l.clone()),V.push(C.clone()),V.push(U.clone()),V.push(L);break}a&&(l=x[o],C=x[o+1],U=n(x[o+2],l),L=n(x[o+2],C)),l&&C&&U&&L&&(V.push(l.clone()),V.push(C.clone()),V.push(U),V.push(L),V.push(U.clone()),V.push(C.clone()));break;case 2:V=V??new Array,h||(l=x[o].clone(),C=n(l,x[o+1]),U=n(l,x[o+2]),V.push(l),V.push(C),V.push(U)),N||(l=x[o+1].clone(),C=n(l,x[o+2]),U=n(l,x[o]),V.push(l),V.push(C),V.push(U)),a||(l=x[o+2].clone(),C=n(l,x[o]),U=n(l,x[o+1]),V.push(l),V.push(C),V.push(U))}}return V},y=O instanceof Z.b?O:null,I=null===y||void 0===y?void 0:y._thinInstanceDataStorage.matrixData,p=(null===y||void 0===y?void 0:y.Lo)||1,P=X.j.Matrix[0];P.V(X.c.IdentityReadOnly);for(let Z=0;Z<p;++Z){if(null!==y&&void 0!==y&&y.hasThinInstances&&I){const x=16*Z;P.setRowFromFloats(0,I[x+0],I[x+1],I[x+2],I[x+3]),P.setRowFromFloats(1,I[x+4],I[x+5],I[x+6],I[x+7]),P.setRowFromFloats(2,I[x+8],I[x+9],I[x+10],I[x+11]),P.setRowFromFloats(3,I[x+12],I[x+13],I[x+14],I[x+15])}const x=X.c.RotationYawPitchRoll(A,E,u).multiply(X.c.Translation(t.x,t.y,t.z)),n=X.c.Invert(x),V=O.getWorldMatrix(),l=P.multiply(V).multiply(n),C=new Array(3);for(let O=0;O<M.length;O+=3){let x=C;if(x[0]=b(O,l),x[1]=b(O+1,l),x[2]=b(O+2,l),!(Q.cullBackFaces&&-x[0].QQ.z<=0&&-x[1].QQ.z<=0&&-x[2].QQ.z<=0)&&(x=W(x,j),x&&(x=W(x,T),x&&(x=W(x,e),x&&(x=W(x,B),x&&(x=W(x,i),x&&(x=W(x,H),x)))))))for(let O=0;O<x.length;O++){const X=x[O];if(z.indices.push(F),K?(X.localPositionOverride?(z.tx[3*F]=X.localPositionOverride[0],z.tx[3*F+1]=X.localPositionOverride[1],z.tx[3*F+2]=X.localPositionOverride[2]):v&&(z.tx[3*F]=v[X.vertexIdx],z.tx[3*F+1]=v[X.vertexIdx+1],z.tx[3*F+2]=v[X.vertexIdx+2]),X.localNormalOverride?(z.ux[3*F]=X.localNormalOverride[0],z.ux[3*F+1]=X.localNormalOverride[1],z.ux[3*F+2]=X.localNormalOverride[2]):R&&(z.ux[3*F]=R[X.vertexIdx],z.ux[3*F+1]=R[X.vertexIdx+1],z.ux[3*F+2]=R[X.vertexIdx+2])):(X.position.toArray(z.tx,3*F),X.QQ.toArray(z.ux,3*F)),z.matricesIndices&&z.matricesWeights&&(X.matrixIndicesOverride?(z.matricesIndices[4*F]=X.matrixIndicesOverride[0],z.matricesIndices[4*F+1]=X.matrixIndicesOverride[1],z.matricesIndices[4*F+2]=X.matrixIndicesOverride[2],z.matricesIndices[4*F+3]=X.matrixIndicesOverride[3]):(q&&(z.matricesIndices[4*F]=q[X.vertexIdxForBones],z.matricesIndices[4*F+1]=q[X.vertexIdxForBones+1],z.matricesIndices[4*F+2]=q[X.vertexIdxForBones+2],z.matricesIndices[4*F+3]=q[X.vertexIdxForBones+3]),k&&z.matricesIndicesExtra&&(z.matricesIndicesExtra[4*F]=k[X.vertexIdxForBones],z.matricesIndicesExtra[4*F+1]=k[X.vertexIdxForBones+1],z.matricesIndicesExtra[4*F+2]=k[X.vertexIdxForBones+2],z.matricesIndicesExtra[4*F+3]=k[X.vertexIdxForBones+3])),X.matrixWeightsOverride?(z.matricesWeights[4*F]=X.matrixWeightsOverride[0],z.matricesWeights[4*F+1]=X.matrixWeightsOverride[1],z.matricesWeights[4*F+2]=X.matrixWeightsOverride[2],z.matricesWeights[4*F+3]=X.matrixWeightsOverride[3]):(G&&(z.matricesWeights[4*F]=G[X.vertexIdxForBones],z.matricesWeights[4*F+1]=G[X.vertexIdxForBones+1],z.matricesWeights[4*F+2]=G[X.vertexIdxForBones+2],z.matricesWeights[4*F+3]=G[X.vertexIdxForBones+3]),J&&z.matricesWeightsExtra&&(z.matricesWeightsExtra[4*F]=J[X.vertexIdxForBones],z.matricesWeightsExtra[4*F+1]=J[X.vertexIdxForBones+1],z.matricesWeightsExtra[4*F+2]=J[X.vertexIdxForBones+2],z.matricesWeightsExtra[4*F+3]=J[X.vertexIdxForBones+3]))),Q.captureUVS)X.uv.toArray(z.Ex,2*F);else{z.Ex.push(.5+X.position.x/d.x);const x=.5+X.position.y/d.y;z.Ex.push(o.e?1-x:x)}F++}}}0===z.indices.length&&(z.indices=null),0===z.tx.length&&(z.tx=null),0===z.ux.length&&(z.ux=null),0===z.Ex.length&&(z.Ex=null),0===(null===(C=z.matricesIndices)||void 0===C?void 0:C.length)&&(z.matricesIndices=null),0===(null===(U=z.matricesWeights)||void 0===U?void 0:U.length)&&(z.matricesWeights=null),0===(null===(L=z.matricesIndicesExtra)||void 0===L?void 0:L.length)&&(z.matricesIndicesExtra=null),0===(null===(h=z.matricesWeightsExtra)||void 0===h?void 0:h.length)&&(z.matricesWeightsExtra=null);const m=new Z.b(x,O.kx());return z.Fx(m),K?(m.skeleton=O.skeleton,m.parent=O):(m.position=t.clone(),m.rotation=new X.n(E,A,u)),m.HV(!0),m.refreshBoundingInfo(!0,!0),m}function P(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const O=0|Math.max(x.subdivisions?x.subdivisions:2,1),Q=0|Math.max(x.tessellation?x.tessellation:16,3),Z=Math.max(x.height?x.height:1,0),n=Math.max(x.radius?x.radius:.25,0),l=0|Math.max(x.capSubdivisions?x.capSubdivisions:6,1),C=Q,U=O,L=Math.max(x.radiusTop?x.radiusTop:n,0),h=Math.max(x.radiusBottom?x.radiusBottom:n,0),N=Z-(L+h),a=2*Math.PI,K=Math.max(x.topCapSubdivisions?x.topCapSubdivisions:l,1),M=Math.max(x.bottomCapSubdivisions?x.bottomCapSubdivisions:l,1),Y=Math.acos((h-L)/Z);let g=[];const v=[],R=[],s=[];let q=0;const G=[],k=.5*N,J=.5*Math.PI;let t,c;const d=X.n.Zero(),u=X.n.Zero(),A=Math.cos(Y),f=Math.sin(Y),E=new X.l(L*f,k+L*A).hQ(new X.l(h*f,h*A-k)).length(),z=L*Y+E+h*(J-Y);let F=0;for(c=0;c<=K;c++){const x=[],O=J-Y*(c/K);F+=L*Y/K;const Q=Math.cos(O),X=Math.sin(O),Z=Q*L;for(t=0;t<=C;t++){const O=t/C,n=O*a+0,V=Math.sin(n),l=Math.cos(n);u.x=Z*V,u.y=k+X*L,u.z=Z*l,v.push(u.x,u.y,u.z),d.set(Q*V,X,Q*l),R.push(d.x,d.y,d.z),s.push(O,o.e?F/z:1-F/z),x.push(q),q++}G.push(x)}const b=Z-L-h+A*L-A*h,D=f*(h-L)/b;for(c=1;c<=U;c++){const x=[];F+=E/U;const O=f*(c*(h-L)/U+L);for(t=0;t<=C;t++){const Q=t/C,X=Q*a+0,Z=Math.sin(X),n=Math.cos(X);u.x=O*Z,u.y=k+A*L-c*b/U,u.z=O*n,v.push(u.x,u.y,u.z),d.set(Z,D,n).normalize(),R.push(d.x,d.y,d.z),s.push(Q,o.e?F/z:1-F/z),x.push(q),q++}G.push(x)}for(c=1;c<=M;c++){const x=[],O=J-Y-(Math.PI-Y)*(c/M);F+=h*Y/M;const Q=Math.cos(O),X=Math.sin(O),Z=Q*h;for(t=0;t<=C;t++){const O=t/C,n=O*a+0,V=Math.sin(n),l=Math.cos(n);u.x=Z*V,u.y=X*h-k,u.z=Z*l,v.push(u.x,u.y,u.z),d.set(Q*V,X,Q*l),R.push(d.x,d.y,d.z),s.push(O,o.e?F/z:1-F/z),x.push(q),q++}G.push(x)}for(t=0;t<C;t++)for(c=0;c<K+U+M;c++){const x=G[c][t],O=G[c+1][t],Q=G[c+1][t+1],X=G[c][t+1];g.push(x),g.push(O),g.push(X),g.push(O),g.push(Q),g.push(X)}if(g=g.reverse(),x.orientation&&!x.orientation.equals(X.n.Up())){const O=new X.c;x.orientation.clone().scale(.5*Math.PI).cross(X.n.Up()).toQuaternion().toRotationMatrix(O);const Q=X.n.Zero();for(let x=0;x<v.length;x+=3)Q.set(v[x],v[x+1],v[x+2]),X.n.TransformCoordinatesToRef(Q.clone(),O,Q),v[x]=Q.x,v[x+1]=Q.y,v[x+2]=Q.z}const W=new V.d;return W.tx=v,W.ux=R,W.Ex=s,W.indices=g,W}function m(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:X.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Z.b(x,Q);return P(O).Fx(n,O.updatable),n}Z.b.CreateDecal=(x,O,Q,X,Z,n)=>p(x,O,{position:Q,QQ:X,size:Z,angle:n});Z.b.CreateCapsule=(x,O,Q)=>m(x,O,Q),V.d.CreateCapsule=P;var w=Q(10905),xx=Q(10853);class Ox{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=x,this.y=O,x!==Math.floor(x)&&(x=Math.floor(x),w.e.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),w.e.Warn("y is not an integer, floor(y) used"))}clone(){return new Ox(this.x,this.y)}rotate60About(x){const O=this.x;return this.x=x.x+x.y-this.y,this.y=O+this.y-x.x,this}rotateNeg60About(x){const O=this.x;return this.x=O+this.y-x.y,this.y=x.x+x.y-O,this}rotate120(x,O){x!==Math.floor(x)&&(x=Math.floor(x),w.e.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),w.e.Warn("n not an integer only floor(n) used"));const Q=this.x;return this.x=x-Q-this.y,this.y=O+Q,this}rotateNeg120(x,O){x!==Math.floor(x)&&(x=Math.floor(x),w.e.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),w.e.Warn("n is not an integer,   floor(n) used"));const Q=this.x;return this.x=this.y-O,this.y=x+O-Q-this.y,this}toCartesianOrigin(x,O){const Q=X.n.Zero();return Q.x=x.x+2*this.x*O+this.y*O,Q.y=x.y+Math.sqrt(3)*this.y*O,Q}static Zero(){return new Ox(0,0)}}class Qx{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Xx("icosahedron","Regular",[[0,xx.g,-1],[-xx.g,1,0],[-1,0,-xx.g],[1,0,-xx.g],[xx.g,1,0],[0,xx.g,1],[-1,0,xx.g],[-xx.g,-1,0],[0,-xx.g,-1],[xx.g,-1,0],[1,0,xx.g],[0,-xx.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let x=12;const O={},Q=this.m,X=this.n;let Z,n,V,o,l,C=Q,U=1,L=0;0!==X&&(C=(0,r.HighestCommonFactor)(Q,X)),U=Q/C,L=X/C;const h=Ox.Zero(),N=new Ox(Q,X),a=new Ox(-X,Q+X),K=Ox.Zero(),M=Ox.Zero(),Y=Ox.Zero();let g,v,R,s,q=[];const G=[],k=this.vertByDist,J=(Q,X,Z,n)=>{g=Q+"|"+Z,v=X+"|"+n,g in O||v in O?g in O&&!(v in O)?O[v]=O[g]:v in O&&!(g in O)&&(O[g]=O[v]):(O[g]=x,O[v]=x,x++),k[Z][0]>2?G[O[g]]=[-k[Z][0],k[Z][1],O[g]]:G[O[g]]=[q[k[Z][0]],k[Z][1],O[g]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let t=0;t<20;t++){if(q=this.IDATA.face[t],V=q[2],o=q[1],l=q[0],R=h.x+"|"+h.y,g=t+"|"+R,g in O||(O[g]=V,G[V]=[q[k[R][0]],k[R][1]]),R=N.x+"|"+N.y,g=t+"|"+R,g in O||(O[g]=o,G[o]=[q[k[R][0]],k[R][1]]),R=a.x+"|"+a.y,g=t+"|"+R,g in O||(O[g]=l,G[l]=[q[k[R][0]],k[R][1]]),Z=this.IDATA.edgematch[t][0],n=this.IDATA.edgematch[t][1],"B"===n)for(let x=1;x<C;x++)M.x=Q-x*(U+L),M.y=X+x*U,Y.x=-x*L,Y.y=x*(U+L),R=M.x+"|"+M.y,s=Y.x+"|"+Y.y,J(t,Z,R,s);if("O"===n)for(let x=1;x<C;x++)Y.x=-x*L,Y.y=x*(U+L),K.x=x*U,K.y=x*L,R=Y.x+"|"+Y.y,s=K.x+"|"+K.y,J(t,Z,R,s);if(Z=this.IDATA.edgematch[t][2],n=this.IDATA.edgematch[t][3],n&&"A"===n)for(let x=1;x<C;x++)K.x=x*U,K.y=x*L,M.x=Q-(C-x)*(U+L),M.y=X+(C-x)*U,R=K.x+"|"+K.y,s=M.x+"|"+M.y,J(t,Z,R,s);for(let Q=0;Q<this.vertices.length;Q++)R=this.vertices[Q].x+"|"+this.vertices[Q].y,g=t+"|"+R,g in O||(O[g]=x++,k[R][0]>2?G[O[g]]=[-k[R][0],k[R][1],O[g]]:G[O[g]]=[q[k[R][0]],k[R][1],O[g]])}this.closestTo=G,this.vecToidx=O}calcCoeffs(){const x=this.m,O=this.n,Q=Math.sqrt(3)/3,X=x*x+O*O+x*O;this.coau=(x+O)/X,this.cobu=-O/X,this.coav=-Q*(x-O)/X,this.cobv=Q*(2*x+O)/X}createInnerFacets(){const x=this.m,O=this.n;for(let Q=0;Q<O+x+1;Q++)for(let x=this.min[Q];x<this.max[Q]+1;x++)x<this.max[Q]&&x<this.max[Q+1]+1&&this.innerFacets.push(["|"+x+"|"+Q,"|"+x+"|"+(Q+1),"|"+(x+1)+"|"+Q]),Q>0&&x<this.max[Q-1]&&x+1<this.max[Q]+1&&this.innerFacets.push(["|"+x+"|"+Q,"|"+(x+1)+"|"+Q,"|"+(x+1)+"|"+(Q-1)])}edgeVecsABOB(){const x=this.m,O=this.n,Q=new Ox(-O,x+O);for(let X=1;X<x+O;X++){const x=new Ox(this.min[X],X),O=new Ox(this.min[X-1],X-1),Z=new Ox(this.min[X+1],X+1),n=x.clone(),V=O.clone(),o=Z.clone();n.rotate60About(Q),V.rotate60About(Q),o.rotate60About(Q);const l=new Ox(this.max[n.y],n.y),C=new Ox(this.max[n.y-1],n.y-1),U=new Ox(this.max[n.y-1]-1,n.y-1);n.x===l.x&&n.y===l.y||(n.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([x,C,U]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([x,U,l])):n.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([x,O,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([x,C,Z])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([x,O,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([x,C,l])))}}mapABOBtoOBOA(){const x=new Ox(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const Q=[];for(let X=0;X<3;X++)x.x=this.isoVecsABOB[O][X].x,x.y=this.isoVecsABOB[O][X].y,0===this.vertexTypes[O][X]&&x.rotateNeg120(this.m,this.n),Q.push(x.clone());this.isoVecsOBOA.push(Q)}}mapABOBtoBAOA(){const x=new Ox(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const Q=[];for(let X=0;X<3;X++)x.x=this.isoVecsABOB[O][X].x,x.y=this.isoVecsABOB[O][X].y,1===this.vertexTypes[O][X]&&x.rotate120(this.m,this.n),Q.push(x.clone());this.isoVecsBAOA.push(Q)}}MapToFace(x,O){const Q=this.IDATA.face[x],Z=Q[2],n=Q[1],V=Q[0],o=X.n.Xo(this.IDATA.vertex[Z]),l=X.n.Xo(this.IDATA.vertex[n]),C=X.n.Xo(this.IDATA.vertex[V]),U=l.hQ(o),L=C.hQ(o),h=U.scale(this.coau).add(L.scale(this.cobu)),N=U.scale(this.coav).add(L.scale(this.cobv)),a=[];let K,M=X.j.Oo[0];for(let X=0;X<this.cartesian.length;X++)M=h.scale(this.cartesian[X].x).add(N.scale(this.cartesian[X].y)).add(o),a[X]=[M.x,M.y,M.z],K=x+"|"+this.vertices[X].x+"|"+this.vertices[X].y,O.vertex[this.vecToidx[K]]=[M.x,M.y,M.z]}build(x,O){const Q=[],X=Ox.Zero(),Z=new Ox(x,O),n=new Ox(-O,x+O);Q.push(X,Z,n);for(let R=O;R<x+1;R++)for(let O=0;O<x+1-R;O++)Q.push(new Ox(O,R));if(O>0){const X=(0,r.HighestCommonFactor)(x,O),Z=x/X,n=O/X;for(let o=1;o<X;o++)Q.push(new Ox(o*Z,o*n)),Q.push(new Ox(-o*n,o*(Z+n))),Q.push(new Ox(x-o*(Z+n),O+o*Z));const V=x/O;for(let o=1;o<O;o++)for(let X=0;X<o*V;X++)Q.push(new Ox(X,o)),Q.push(new Ox(X,o).rotate120(x,O)),Q.push(new Ox(X,o).rotateNeg120(x,O))}Q.sort(((x,O)=>x.x-O.x)),Q.sort(((x,O)=>x.y-O.y));const V=new Array(x+O+1),o=new Array(x+O+1);for(let R=0;R<V.length;R++)V[R]=1/0,o[R]=-1/0;let l=0,C=0;const U=Q.length;for(let R=0;R<U;R++)C=Q[R].x,l=Q[R].y,V[l]=Math.min(C,V[l]),o[l]=Math.max(C,o[l]);const L=(Q,X)=>{const Z=Q.clone();return"A"===X&&Z.rotateNeg120(x,O),"B"===X&&Z.rotate120(x,O),Z.x<0?Z.y:Z.x+Z.y},h=[],N=[],a=[],K=[],M={},Y=[];let g=-1,v=-1;for(let R=0;R<U;R++)h[R]=Q[R].toCartesianOrigin(new Ox(0,0),.5),N[R]=L(Q[R],"O"),a[R]=L(Q[R],"A"),K[R]=L(Q[R],"B"),N[R]===a[R]&&a[R]===K[R]?(g=3,v=N[R]):N[R]===a[R]?(g=4,v=N[R]):a[R]===K[R]?(g=5,v=a[R]):K[R]===N[R]&&(g=6,v=N[R]),N[R]<a[R]&&N[R]<K[R]&&(g=2,v=N[R]),a[R]<N[R]&&a[R]<K[R]&&(g=1,v=a[R]),K[R]<a[R]&&K[R]<N[R]&&(g=0,v=K[R]),Y.push([g,v,Q[R].x,Q[R].y]);Y.sort(((x,O)=>x[2]-O[2])),Y.sort(((x,O)=>x[3]-O[3])),Y.sort(((x,O)=>x[1]-O[1])),Y.sort(((x,O)=>x[0]-O[0]));for(let R=0;R<Y.length;R++)M[Y[R][2]+"|"+Y[R][3]]=[Y[R][0],Y[R][1],R];return this.m=x,this.n=O,this.vertices=Q,this.vertByDist=M,this.cartesian=h,this.min=V,this.max=o,this}}class Xx{constructor(x,O,Q,X){this.name=x,this.category=O,this.vertex=Q,this.face=X}}class Zx extends Xx{innerToData(x,O){for(let Q=0;Q<O.innerFacets.length;Q++)this.face.push(O.innerFacets[Q].map((Q=>O.vecToidx[x+Q])))}mapABOBtoDATA(x,O){const Q=O.IDATA.edgematch[x][0];for(let X=0;X<O.isoVecsABOB.length;X++){const Z=[];for(let n=0;n<3;n++)0===O.vertexTypes[X][n]?Z.push(x+"|"+O.isoVecsABOB[X][n].x+"|"+O.isoVecsABOB[X][n].y):Z.push(Q+"|"+O.isoVecsABOB[X][n].x+"|"+O.isoVecsABOB[X][n].y);this.face.push([O.vecToidx[Z[0]],O.vecToidx[Z[1]],O.vecToidx[Z[2]]])}}mapOBOAtoDATA(x,O){const Q=O.IDATA.edgematch[x][0];for(let X=0;X<O.isoVecsOBOA.length;X++){const Z=[];for(let n=0;n<3;n++)1===O.vertexTypes[X][n]?Z.push(x+"|"+O.isoVecsOBOA[X][n].x+"|"+O.isoVecsOBOA[X][n].y):Z.push(Q+"|"+O.isoVecsOBOA[X][n].x+"|"+O.isoVecsOBOA[X][n].y);this.face.push([O.vecToidx[Z[0]],O.vecToidx[Z[1]],O.vecToidx[Z[2]]])}}mapBAOAtoDATA(x,O){const Q=O.IDATA.edgematch[x][2];for(let X=0;X<O.isoVecsBAOA.length;X++){const Z=[];for(let n=0;n<3;n++)1===O.vertexTypes[X][n]?Z.push(x+"|"+O.isoVecsBAOA[X][n].x+"|"+O.isoVecsBAOA[X][n].y):Z.push(Q+"|"+O.isoVecsBAOA[X][n].x+"|"+O.isoVecsBAOA[X][n].y);this.face.push([O.vecToidx[Z[0]],O.vecToidx[Z[1]],O.vecToidx[Z[2]]])}}orderData(x){const O=[];for(let n=0;n<13;n++)O[n]=[];const Q=x.closestTo;for(let n=0;n<Q.length;n++)Q[n][0]>-1?Q[n][1]>0&&O[Q[n][0]].push([n,Q[n][1]]):O[12].push([n,Q[n][0]]);const X=[];for(let n=0;n<12;n++)X[n]=n;let Z=12;for(let n=0;n<12;n++){O[n].sort(((x,O)=>x[1]-O[1]));for(let x=0;x<O[n].length;x++)X[O[n][x][0]]=Z++}for(let n=0;n<O[12].length;n++)X[O[12][n][0]]=Z++;for(let n=0;n<this.vertex.length;n++)this.vertex[n].push(X[n]);this.vertex.sort(((x,O)=>x[3]-O[3]));for(let n=0;n<this.vertex.length;n++)this.vertex[n].pop();for(let n=0;n<this.face.length;n++)for(let x=0;x<this.face[n].length;x++)this.face[n][x]=X[this.face[n][x]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(x,O){const Q=[],X=[];let Z=O.pop();X.push(Z);let n=this.face[Z].indexOf(x);n=(n+2)%3;let V=this.face[Z][n];Q.push(V);let o=0;for(;O.length>0;)Z=O[o],this.face[Z].indexOf(V)>-1?(n=(this.face[Z].indexOf(V)+1)%3,V=this.face[Z][n],Q.push(V),X.push(Z),O.splice(o,1),o=0):o++;return this.adjacentFaces.push(Q),X}toGoldbergPolyhedronData(){const x=new Xx("GeoDual","Goldberg",[],[]);x.name="GD dual";const O=this.vertex.length,Q=new Array(O);for(let l=0;l<O;l++)Q[l]=[];for(let l=0;l<this.face.length;l++)for(let x=0;x<3;x++)Q[this.face[l][x]].push(l);let X=0,Z=0,n=0,V=[],o=[];this.adjacentFaces=[];for(let l=0;l<Q.length;l++){x.face[l]=this.setOrder(l,Q[l].concat([]));for(const O of Q[l]){X=0,Z=0,n=0,V=this.face[O];for(let x=0;x<3;x++)o=this.vertex[V[x]],X+=o[0],Z+=o[1],n+=o[2];x.vertex[O]=[X/3,Z/3,n/3]}}return x}static BuildGeodesicData(x){const O=new Zx("Geodesic-m-n","Geodesic",[[0,xx.g,-1],[-xx.g,1,0],[-1,0,-xx.g],[1,0,-xx.g],[xx.g,1,0],[0,xx.g,1],[-1,0,xx.g],[-xx.g,-1,0],[0,-xx.g,-1],[xx.g,-1,0],[1,0,xx.g],[0,-xx.g,1]],[]);x.setIndices(),x.calcCoeffs(),x.createInnerFacets(),x.edgeVecsABOB(),x.mapABOBtoOBOA(),x.mapABOBtoBAOA();for(let Q=0;Q<x.IDATA.face.length;Q++)x.MapToFace(Q,O),O.innerToData(Q,x),"B"===x.IDATA.edgematch[Q][1]&&O.mapABOBtoDATA(Q,x),"O"===x.IDATA.edgematch[Q][1]&&O.mapOBOAtoDATA(Q,x),"A"===x.IDATA.edgematch[Q][3]&&O.mapBAOAtoDATA(Q,x);O.orderData(x);return O.vertex=O.vertex.map((function(x){const O=x[0],Q=x[1],X=x[2],Z=Math.sqrt(O*O+Q*Q+X*X);return x[0]*=1/Z,x[1]*=1/Z,x[2]*=1/Z,x})),O}}Z.b._GoldbergMeshParser=(x,O)=>nx.Parse(x,O);class nx extends Z.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(x,O){return void 0===O?(x>this.goldbergData.nbUnsharedFaces-1&&(w.e.Warn("Maximum number of unshared faces used"),x=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+x):(x>11&&(w.e.Warn("Last pole used"),x=11),O>this.goldbergData.nbFacesAtPole-1&&(w.e.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+x*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(x){for(let Q=0;Q<x.length;Q++){const O=x[Q][0],X=x[Q][1],Z=x[Q][2];for(let x=O;x<X+1;x++)this.goldbergData.faceColors[x]=Z}const O=[];for(let Q=0;Q<12;Q++)for(let x=0;x<5;x++)O.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);for(let Q=12;Q<this.goldbergData.faceColors.length;Q++)for(let x=0;x<6;x++)O.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);return O}setGoldbergFaceColors(x){const O=this._changeGoldbergFaceColors(x);this.yx(n.g.ColorKind,O)}updateGoldbergFaceColors(x){const O=this._changeGoldbergFaceColors(x);this.updateVerticesData(n.g.ColorKind,O)}_changeGoldbergFaceUVs(x){const O=this.getVerticesData(n.g.UVKind);for(let Q=0;Q<x.length;Q++){const X=x[Q][0],Z=x[Q][1],n=x[Q][2],V=x[Q][3],o=x[Q][4],l=[],C=[];let U,L;for(let x=0;x<5;x++)U=n.x+V*Math.cos(o+x*Math.PI/2.5),L=n.y+V*Math.sin(o+x*Math.PI/2.5),U<0&&(U=0),U>1&&(U=1),l.push(U,L);for(let x=0;x<6;x++)U=n.x+V*Math.cos(o+x*Math.PI/3),L=n.y+V*Math.sin(o+x*Math.PI/3),U<0&&(U=0),U>1&&(U=1),C.push(U,L);for(let x=X;x<Math.min(12,Z+1);x++)for(let Q=0;Q<5;Q++)O[10*x+2*Q]=l[2*Q],O[10*x+2*Q+1]=l[2*Q+1];for(let x=Math.max(12,X);x<Z+1;x++)for(let Q=0;Q<6;Q++)O[12*x-24+2*Q]=C[2*Q],O[12*x-23+2*Q]=C[2*Q+1]}return O}setGoldbergFaceUVs(x){const O=this._changeGoldbergFaceUVs(x);this.yx(n.g.UVKind,O)}updateGoldbergFaceUVs(x){const O=this._changeGoldbergFaceUVs(x);this.updateVerticesData(n.g.UVKind,O)}placeOnGoldbergFaceAt(x,O,Q){const Z=X.n.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);x.rotation=Z,x.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(Q.x)).add(this.goldbergData.faceYaxis[O].scale(Q.y)).add(this.goldbergData.faceZaxis[O].scale(Q.z))}serialize(x){super.serialize(x),x.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const x of this.goldbergData.faceColors)O.faceColors.push(x.mV())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const x of this.goldbergData.faceCenters)O.faceCenters.push(x.mV())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const x of this.goldbergData.faceZaxis)O.faceZaxis.push(x.mV())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const x of this.goldbergData.faceYaxis)O.faceYaxis.push(x.mV())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const x of this.goldbergData.faceXaxis)O.faceXaxis.push(x.mV())}x.goldbergData=O}static Parse(x,O){const Q=x.goldbergData;Q.faceColors=Q.faceColors.map((x=>h.h.Xo(x))),Q.faceCenters=Q.faceCenters.map((x=>X.n.Xo(x))),Q.faceZaxis=Q.faceZaxis.map((x=>X.n.Xo(x))),Q.faceXaxis=Q.faceXaxis.map((x=>X.n.Xo(x))),Q.faceYaxis=Q.faceYaxis.map((x=>X.n.Xo(x)));const Z=new nx(x.name,O);return Z.goldbergData=Q,Z}}var Vx=Q(11576);const ox={CreateBox:L.d,CreateTiledBox:M,CreateSphere:Y.b,CreateDisc:U.c,CreateIcoSphere:I,CreateRibbon:C,CreateCylinder:s,CreateTorus:G,CreateTorusKnot:J,CreateLineSystem:t.g,OC:t.k,CreateDashedLines:t.d,ExtrudeShape:u,ExtrudeShapeCustom:A,CreateLathe:E,CreateTiledPlane:a,XC:z.b,CreateGround:F.h,CreateTiledGround:F.j,CreateGroundFromHeightMap:F.d,CreatePolygon:c.d,ExtrudePolygon:c.h,CreateTube:b,CreatePolyhedron:W,CreateGeodesic:function(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=O.m||1;X!==Math.floor(X)&&(X=Math.floor(X),w.e.Warn("m not an integer only floor(m) used"));let Z=O.n||0;if(Z!==Math.floor(Z)&&(Z=Math.floor(Z),w.e.Warn("n not an integer only floor(n) used")),Z>X){const x=Z;Z=X,X=x,w.e.Warn("n > m therefore m and n swapped")}const n=new Qx;return n.build(X,Z),W(x,{custom:Zx.BuildGeodesicData(n),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},Q)},CreateGoldberg:function(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=O.size,l=O.sizeX||n||1,C=O.sizeY||n||1,U=O.sizeZ||n||1;let L=O.m||1;L!==Math.floor(L)&&(L=Math.floor(L),w.e.Warn("m not an integer only floor(m) used"));let N=O.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),w.e.Warn("n not an integer only floor(n) used")),N>L){const x=N;N=L,L=x,w.e.Warn("n > m therefore m and n swapped")}const a=new Qx;a.build(L,N);const K=Zx.BuildGeodesicData(a),M=K.toGoldbergPolyhedronData(),Y=new nx(x,Q);O.sideOrientation=Z.b._GetDefaultSideOrientation(O.sideOrientation),Y._originalBuilderSideOrientation=O.sideOrientation;(function(x,O){const Q=x.size,Z=x.sizeX||Q||1,n=x.sizeY||Q||1,l=x.sizeZ||Q||1,C=0===x.sideOrientation?0:x.sideOrientation||V.d.DEFAULTSIDE,U=[],L=[],h=[],N=[];let a=1/0,K=-1/0,M=1/0,Y=-1/0;for(let X=0;X<O.vertex.length;X++)a=Math.min(a,O.vertex[X][0]*Z),K=Math.max(K,O.vertex[X][0]*Z),M=Math.min(M,O.vertex[X][1]*n),Y=Math.max(Y,O.vertex[X][1]*n);let g=0;for(let V=0;V<O.face.length;V++){const x=O.face[V],Q=X.n.Xo(O.vertex[x[0]]),C=X.n.Xo(O.vertex[x[2]]),v=X.n.Xo(O.vertex[x[1]]),R=C.hQ(Q),s=v.hQ(Q),q=X.n.Cross(s,R).normalize();for(let X=0;X<x.length;X++){h.push(q.x,q.y,q.z);const Q=O.vertex[x[X]];U.push(Q[0]*Z,Q[1]*n,Q[2]*l);const V=(Q[1]*n-M)/(Y-M);N.push((Q[0]*Z-a)/(K-a),o.e?1-V:V)}for(let O=0;O<x.length-2;O++)L.push(g,g+O+2,g+O+1);g+=x.length}V.d._ComputeSides(C,U,L,h,N);const v=new V.d;return v.tx=U,v.indices=L,v.ux=h,v.Ex=N,v})(O,M).Fx(Y,O.updatable),Y.goldbergData.nbSharedFaces=K.sharedNodes,Y.goldbergData.nbUnsharedFaces=K.poleNodes,Y.goldbergData.adjacentFaces=K.adjacentFaces,Y.goldbergData.nbFaces=Y.goldbergData.nbSharedFaces+Y.goldbergData.nbUnsharedFaces,Y.goldbergData.nbFacesAtPole=(Y.goldbergData.nbUnsharedFaces-12)/12;for(let Z=0;Z<K.vertex.length;Z++)Y.goldbergData.faceCenters.push(X.n.Xo(K.vertex[Z])),Y.goldbergData.faceCenters[Z].x*=l,Y.goldbergData.faceCenters[Z].y*=C,Y.goldbergData.faceCenters[Z].z*=U,Y.goldbergData.faceColors.push(new h.h(1,1,1,1));for(let Z=0;Z<M.face.length;Z++){const x=M.face[Z],O=X.n.Xo(M.vertex[x[0]]),Q=X.n.Xo(M.vertex[x[2]]),n=X.n.Xo(M.vertex[x[1]]),V=Q.hQ(O),o=n.hQ(O),l=X.n.Cross(o,V).normalize(),C=X.n.Cross(o,l).normalize();Y.goldbergData.faceXaxis.push(o.normalize()),Y.goldbergData.faceYaxis.push(l),Y.goldbergData.faceZaxis.push(C)}return Y},CreateDecal:p,CreateCapsule:m,CreateText:Vx.e}},12269:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>oO});var X=Q(10849),Z=Q(11466);class n extends Z.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var V=Q(11133),o=(Q(11282),Q(10866));class l{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(x){this._targetStopDuration!==x&&(this._targetStopDuration=x)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(x){this._noiseTexture!==x&&(this._noiseTexture=x,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(x){this._animationSheetEnabled!==x&&(this._animationSheetEnabled=x)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(x){this._isAnimationSheetEnabled!=x&&(this._isAnimationSheetEnabled=x,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(x){this._useLogarithmicDepth=x&&this.kx().getEngine().getCaps().fragmentDepthSupported}kx(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(x){switch(x){case l.BLENDMODE_MULTIPLYADD:return;case l.BLENDMODE_ADD:x=1;break;case l.BLENDMODE_ONEONE:x=6;break;case l.BLENDMODE_STANDARD:x=2;break;case l.BLENDMODE_MULTIPLY:x=4;break;case l.BLENDMODE_SUBTRACT:x=3}this._engine.setAlphaMode(x)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:X.n.Zero()}set direction1(x){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=x)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:X.n.Zero()}set direction2(x){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=x)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:X.n.Zero()}set minEmitBox(x){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=x)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:X.n.Zero()}set maxEmitBox(x){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=x)}get billboardMode(){return this._billboardMode}set billboardMode(x){this._billboardMode!==x&&(this._billboardMode=x,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(x){this._isBillboardBased!==x&&(this._isBillboardBased=x,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(x){this._attachImageProcessingConfiguration(x)}_attachImageProcessingConfiguration(x){x!==this._imageProcessingConfiguration&&(!x&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=x)}_reset(){}_removeGradientAndTexture(x,O,Q){if(!O)return this;let X=0;for(const Z of O){if(Z.gradient===x){O.splice(X,1);break}X++}return Q&&Q.dispose(),this}constructor(x){this.animations=[],this.renderingGroupId=0,this.i=X.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new X.n(10,10,10),this.onAnimationEnd=null,this.blendMode=l.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new X.l(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ml=new X.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=X.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new V.h(1,1,1,1),this.color2=new V.h(1,1,1,1),this.colorDead=new V.h(0,0,0,1),this.textureMask=new V.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new n,this.id=x,this.name=x}createPointEmitter(x,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new X.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new X.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new X.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new X.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new X.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new X.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(x,O,Q,X){throw new Error("Method not implemented.")}}l.BLENDMODE_ONEONE=0,l.BLENDMODE_STANDARD=1,l.BLENDMODE_ADD=2,l.BLENDMODE_MULTIPLY=3,l.BLENDMODE_MULTIPLYADD=4,l.BLENDMODE_SUBTRACT=-1,(0,o.d)("BABYLON.BaseParticleSystem",l);var C=Q(10889),U=Q(10912);class L{constructor(){this.direction1=new X.n(0,1,0),this.direction2=new X.n(0,1,0),this.minEmitBox=new X.n(-.5,-.5,-.5),this.maxEmitBox=new X.n(.5,.5,.5)}startDirectionFunction(x,O,Q,Z){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),V=(0,C.RandomRange)(this.direction1.y,this.direction2.y),o=(0,C.RandomRange)(this.direction1.z,this.direction2.z);if(Z)return O.x=n,O.y=V,void(O.z=o);X.n.TransformNormalFromFloatsToRef(n,V,o,x,O)}startPositionFunction(x,O,Q,Z){const n=(0,C.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),V=(0,C.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),o=(0,C.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(Z)return O.x=n,O.y=V,void(O.z=o);X.n.TransformCoordinatesFromFloatsToRef(n,V,o,x,O)}clone(){const x=new L;return U.b.DeepCopy(this,x),x}applyToShader(x){x.setVector3("direction1",this.direction1),x.setVector3("direction2",this.direction2),x.setVector3("minEmitBox",this.minEmitBox),x.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(x){x.addUniform("direction1",3),x.addUniform("direction2",3),x.addUniform("minEmitBox",3),x.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.direction1=this.direction1.mV(),x.direction2=this.direction2.mV(),x.minEmitBox=this.minEmitBox.mV(),x.maxEmitBox=this.maxEmitBox.mV(),x}parse(x){X.n.FromArrayToRef(x.direction1,0,this.direction1),X.n.FromArrayToRef(x.direction2,0,this.direction2),X.n.FromArrayToRef(x.minEmitBox,0,this.minEmitBox),X.n.FromArrayToRef(x.maxEmitBox,0,this.maxEmitBox)}}class h{get radius(){return this._radius}set radius(x){this._radius=x,this._buildHeight()}get angle(){return this._angle}set angle(x){this._angle=x,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Q,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.radius=x}startDirectionFunction(x,O,Q,Z){Z?X.j.Oo[0].V(Q.yo).normalize():Q.position.subtractToRef(x.getTranslation(),X.j.Oo[0]).normalize();const n=(0,C.RandomRange)(0,this.directionRandomizer),V=(0,C.RandomRange)(0,this.directionRandomizer),o=(0,C.RandomRange)(0,this.directionRandomizer);O.x=X.j.Oo[0].x+n,O.y=X.j.Oo[0].y+V,O.z=X.j.Oo[0].z+o,O.normalize()}startPositionFunction(x,O,Q,Z){const n=(0,C.RandomRange)(0,2*Math.PI);let V;this.emitFromSpawnPointOnly?V=1e-4:(V=(0,C.RandomRange)(0,this.heightRange),V=1-V*V);let o=this._radius-(0,C.RandomRange)(0,this._radius*this.radiusRange);o*=V;const l=o*Math.sin(n),U=o*Math.cos(n),L=V*this._height;if(Z)return O.x=l,O.y=L,void(O.z=U);X.n.TransformCoordinatesFromFloatsToRef(l,L,U,x,O)}clone(){const x=new h(this._radius,this._angle,this.directionRandomizer);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat2("radius",this._radius,this.radiusRange),x.setFloat("coneAngle",this._angle),x.setFloat2("height",this._height,this.heightRange),x.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(x){x.addUniform("radius",2),x.addUniform("coneAngle",1),x.addUniform("height",2),x.addUniform("directionRandomizer",1)}getEffectDefines(){let x="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(x+="\n#define CONEEMITTERSPAWNPOINT"),x}getClassName(){return"ConeParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.radius=this._radius,x.angle=this._angle,x.directionRandomizer=this.directionRandomizer,x.radiusRange=this.radiusRange,x.heightRange=this.heightRange,x.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,x}parse(x){this.radius=x.radius,this.angle=x.angle,this.directionRandomizer=x.directionRandomizer,this.radiusRange=void 0!==x.radiusRange?x.radiusRange:1,this.heightRange=void 0!==x.radiusRange?x.heightRange:1,this.emitFromSpawnPointOnly=void 0!==x.emitFromSpawnPointOnly&&x.emitFromSpawnPointOnly}}class N extends h{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0);super(x,O),this.direction1=Q,this.direction2=Z}startDirectionFunction(x,O){const Q=(0,C.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,C.RandomRange)(this.direction1.y,this.direction2.y),n=(0,C.RandomRange)(this.direction1.z,this.direction2.z);X.n.TransformNormalFromFloatsToRef(Q,Z,n,x,O)}clone(){const x=new N(this.radius,this.angle,this.direction1,this.direction2);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat("radius",this.radius),x.setFloat("radiusRange",this.radiusRange),x.setVector3("direction1",this.direction1),x.setVector3("direction2",this.direction2)}buildUniformLayout(x){x.addUniform("radius",1),x.addUniform("radiusRange",1),x.addUniform("direction1",3),x.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const x=super.serialize();return x.direction1=this.direction1.mV(),x.direction2=this.direction2.mV(),x}parse(x){super.parse(x),this.direction1.V(x.direction1),this.direction2.V(x.direction2)}}class a{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=x,this.height=O,this.radiusRange=Q,this.directionRandomizer=Z,this._tempVector=X.n.Zero()}startDirectionFunction(x,O,Q,Z,n){Q.position.subtractToRef(x.getTranslation(),this._tempVector),this._tempVector.normalize(),X.n.TransformNormalToRef(this._tempVector,n,this._tempVector);const V=(0,C.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let o=Math.atan2(this._tempVector.x,this._tempVector.z);o+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=V,this._tempVector.x=Math.sin(o),this._tempVector.z=Math.cos(o),this._tempVector.normalize(),Z?O.V(this._tempVector):X.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,x,O)}startPositionFunction(x,O,Q,Z){const n=(0,C.RandomRange)(-this.height/2,this.height/2),V=(0,C.RandomRange)(0,2*Math.PI),o=(0,C.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),l=Math.sqrt(o)*this.radius,U=l*Math.cos(V),L=l*Math.sin(V);Z?O.xo(U,n,L):X.n.TransformCoordinatesFromFloatsToRef(U,n,L,x,O)}clone(){const x=new a(this.radius,this.directionRandomizer);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat("radius",this.radius),x.setFloat("height",this.height),x.setFloat("radiusRange",this.radiusRange),x.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(x){x.addUniform("radius",1),x.addUniform("height",1),x.addUniform("radiusRange",1),x.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.radius=this.radius,x.height=this.height,x.radiusRange=this.radiusRange,x.directionRandomizer=this.directionRandomizer,x}parse(x){this.radius=x.radius,this.height=x.height,this.radiusRange=x.radiusRange,this.directionRandomizer=x.directionRandomizer}}class K extends a{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0);super(x,O,Q),this.direction1=Z,this.direction2=n}startDirectionFunction(x,O,Q,Z){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),V=(0,C.RandomRange)(this.direction1.y,this.direction2.y),o=(0,C.RandomRange)(this.direction1.z,this.direction2.z);Z?O.xo(n,V,o):X.n.TransformNormalFromFloatsToRef(n,V,o,x,O)}clone(){const x=new K(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat("radius",this.radius),x.setFloat("height",this.height),x.setFloat("radiusRange",this.radiusRange),x.setVector3("direction1",this.direction1),x.setVector3("direction2",this.direction2)}buildUniformLayout(x){x.addUniform("radius",1),x.addUniform("height",1),x.addUniform("radiusRange",1),x.addUniform("direction1",3),x.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const x=super.serialize();return x.direction1=this.direction1.mV(),x.direction2=this.direction2.mV(),x}parse(x){super.parse(x),X.n.FromArrayToRef(x.direction1,0,this.direction1),X.n.FromArrayToRef(x.direction2,0,this.direction2)}}class M{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=x,this.radiusRange=O,this.directionRandomizer=Q}startDirectionFunction(x,O,Q,Z){const n=Q.position.hQ(x.getTranslation()).normalize(),V=(0,C.RandomRange)(0,this.directionRandomizer),o=(0,C.RandomRange)(0,this.directionRandomizer),l=(0,C.RandomRange)(0,this.directionRandomizer);n.x+=V,n.y+=o,n.z+=l,n.normalize(),Z?O.V(n):X.n.TransformNormalFromFloatsToRef(n.x,n.y,n.z,x,O)}startPositionFunction(x,O,Q,Z){const n=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),V=(0,C.RandomRange)(0,1),o=(0,C.RandomRange)(0,2*Math.PI),l=Math.acos(2*V-1),U=n*Math.cos(o)*Math.sin(l),L=n*Math.cos(l),h=n*Math.sin(o)*Math.sin(l);Z?O.xo(U,Math.abs(L),h):X.n.TransformCoordinatesFromFloatsToRef(U,Math.abs(L),h,x,O)}clone(){const x=new M(this.radius,this.directionRandomizer);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat("radius",this.radius),x.setFloat("radiusRange",this.radiusRange),x.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(x){x.addUniform("radius",1),x.addUniform("radiusRange",1),x.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.radius=this.radius,x.radiusRange=this.radiusRange,x.directionRandomizer=this.directionRandomizer,x}parse(x){this.radius=x.radius,this.radiusRange=x.radiusRange,this.directionRandomizer=x.directionRandomizer}}class Y{constructor(){this.direction1=new X.n(0,1,0),this.direction2=new X.n(0,1,0)}startDirectionFunction(x,O,Q,Z){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),V=(0,C.RandomRange)(this.direction1.y,this.direction2.y),o=(0,C.RandomRange)(this.direction1.z,this.direction2.z);Z?O.xo(n,V,o):X.n.TransformNormalFromFloatsToRef(n,V,o,x,O)}startPositionFunction(x,O,Q,Z){Z?O.xo(0,0,0):X.n.TransformCoordinatesFromFloatsToRef(0,0,0,x,O)}clone(){const x=new Y;return U.b.DeepCopy(this,x),x}applyToShader(x){x.setVector3("direction1",this.direction1),x.setVector3("direction2",this.direction2)}buildUniformLayout(x){x.addUniform("direction1",3),x.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.direction1=this.direction1.mV(),x.direction2=this.direction2.mV(),x}parse(x){X.n.FromArrayToRef(x.direction1,0,this.direction1),X.n.FromArrayToRef(x.direction2,0,this.direction2)}}class g{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=x,this.radiusRange=O,this.directionRandomizer=Q}startDirectionFunction(x,O,Q,Z){const n=Q.position.hQ(x.getTranslation()).normalize(),V=(0,C.RandomRange)(0,this.directionRandomizer),o=(0,C.RandomRange)(0,this.directionRandomizer),l=(0,C.RandomRange)(0,this.directionRandomizer);n.x+=V,n.y+=o,n.z+=l,n.normalize(),Z?O.V(n):X.n.TransformNormalFromFloatsToRef(n.x,n.y,n.z,x,O)}startPositionFunction(x,O,Q,Z){const n=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),V=(0,C.RandomRange)(0,1),o=(0,C.RandomRange)(0,2*Math.PI),l=Math.acos(2*V-1),U=n*Math.cos(o)*Math.sin(l),L=n*Math.cos(l),h=n*Math.sin(o)*Math.sin(l);Z?O.xo(U,L,h):X.n.TransformCoordinatesFromFloatsToRef(U,L,h,x,O)}clone(){const x=new g(this.radius,this.directionRandomizer);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat("radius",this.radius),x.setFloat("radiusRange",this.radiusRange),x.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(x){x.addUniform("radius",1),x.addUniform("radiusRange",1),x.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.radius=this.radius,x.radiusRange=this.radiusRange,x.directionRandomizer=this.directionRandomizer,x}parse(x){this.radius=x.radius,this.radiusRange=x.radiusRange,this.directionRandomizer=x.directionRandomizer}}class v extends g{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0);super(x),this.direction1=O,this.direction2=Q}startDirectionFunction(x,O){const Q=(0,C.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,C.RandomRange)(this.direction1.y,this.direction2.y),n=(0,C.RandomRange)(this.direction1.z,this.direction2.z);X.n.TransformNormalFromFloatsToRef(Q,Z,n,x,O)}clone(){const x=new v(this.radius,this.direction1,this.direction2);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setFloat("radius",this.radius),x.setFloat("radiusRange",this.radiusRange),x.setVector3("direction1",this.direction1),x.setVector3("direction2",this.direction2)}buildUniformLayout(x){x.addUniform("radius",1),x.addUniform("radiusRange",1),x.addUniform("direction1",3),x.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const x=super.serialize();return x.direction1=this.direction1.mV(),x.direction2=this.direction2.mV(),x}parse(x){super.parse(x),this.direction1.V(x.direction1),this.direction2.V(x.direction2)}}class R{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(x,O,Q,Z){const n=X.j.Oo[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Q,n);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Q,n);const x=X.j.Oo[1];n.subtractToRef(Q.position,x),x.scaleToRef(1/Q.lifeTime,n)}else n.set(0,0,0);Z?O.V(n):X.n.TransformNormalToRef(n,x,O)}startPositionFunction(x,O,Q,Z){const n=X.j.Oo[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Q,n):n.set(0,0,0),Z?O.V(n):X.n.TransformCoordinatesToRef(n,x,O)}clone(){const x=new R;return U.b.DeepCopy(this,x),x}applyToShader(x){}buildUniformLayout(x){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const x={};return x.type=this.getClassName(),x.particlePositionGenerator=this.particlePositionGenerator,x.particleDestinationGenerator=this.particleDestinationGenerator,x}parse(x){x.particlePositionGenerator&&(this.particlePositionGenerator=x.particlePositionGenerator),x.particleDestinationGenerator&&(this.particleDestinationGenerator=x.particleDestinationGenerator)}}var s=Q(11060);class q{get mesh(){return this._mesh}set mesh(x){this._mesh!==x&&(this._mesh=x,x?(this._indices=x.pV(),this._positions=x.getVerticesData(s.g.PositionKind),this._normals=x.getVerticesData(s.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=X.n.Zero(),this._mesh=null,this.direction1=new X.n(0,1,0),this.direction2=new X.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=x}startDirectionFunction(x,O,Q,Z){if(this.useMeshNormalsForDirection&&this._normals)return void X.n.TransformNormalToRef(this._storedNormal,x,O);const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),V=(0,C.RandomRange)(this.direction1.y,this.direction2.y),o=(0,C.RandomRange)(this.direction1.z,this.direction2.z);Z?O.xo(n,V,o):X.n.TransformNormalFromFloatsToRef(n,V,o,x,O)}startPositionFunction(x,O,Q,Z){if(!this._indices||!this._positions)return;const n=3*(Math.random()*(this._indices.length/3)|0),V=Math.random(),o=Math.random()*(1-V),l=1-V-o,C=this._indices[n],U=this._indices[n+1],L=this._indices[n+2],h=X.j.Oo[0],N=X.j.Oo[1],a=X.j.Oo[2],K=X.j.Oo[3];X.n.FromArrayToRef(this._positions,3*C,h),X.n.FromArrayToRef(this._positions,3*U,N),X.n.FromArrayToRef(this._positions,3*L,a),K.x=V*h.x+o*N.x+l*a.x,K.y=V*h.y+o*N.y+l*a.y,K.z=V*h.z+o*N.z+l*a.z,Z?O.xo(K.x,K.y,K.z):X.n.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,x,O),this.useMeshNormalsForDirection&&this._normals&&(X.n.FromArrayToRef(this._normals,3*C,h),X.n.FromArrayToRef(this._normals,3*U,N),X.n.FromArrayToRef(this._normals,3*L,a),this._storedNormal.x=V*h.x+o*N.x+l*a.x,this._storedNormal.y=V*h.y+o*N.y+l*a.y,this._storedNormal.z=V*h.z+o*N.z+l*a.z)}clone(){const x=new q(this.mesh);return U.b.DeepCopy(this,x),x}applyToShader(x){x.setVector3("direction1",this.direction1),x.setVector3("direction2",this.direction2)}buildUniformLayout(x){x.addUniform("direction1",3),x.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var x;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.mV(),O.direction2=this.direction2.mV(),O.meshId=null===(x=this.mesh)||void 0===x?void 0:x.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(x,O){X.n.FromArrayToRef(x.direction1,0,this.direction1),X.n.FromArrayToRef(x.direction2,0,this.direction2),x.meshId&&O&&(this.mesh=O.getLastMeshById(x.meshId)),this.useMeshNormalsForDirection=x.useMeshNormalsForDirection}}class G{_isUbo(x){return void 0!==x.addUniform}constructor(x){this._isUbo(x)?(this.setMatrix3x3=x.updateMatrix3x3.bind(x),this.setMatrix2x2=x.updateMatrix2x2.bind(x),this.setFloat=x.updateFloat.bind(x),this.setFloat2=x.updateFloat2.bind(x),this.setFloat3=x.updateFloat3.bind(x),this.setFloat4=x.updateFloat4.bind(x),this.setFloatArray=x.updateFloatArray.bind(x),this.setArray=x.updateArray.bind(x),this.setIntArray=x.updateIntArray.bind(x),this.setMatrix=x.Vo.bind(x),this.setMatrices=x.updateMatrices.bind(x),this.setVector3=x.updateVector3.bind(x),this.setVector4=x.updateVector4.bind(x),this.setColor3=x.updateColor3.bind(x),this.setColor4=x.updateColor4.bind(x),this.setDirectColor4=x.updateDirectColor4.bind(x),this.setInt=x.updateInt.bind(x),this.setInt2=x.updateInt2.bind(x),this.setInt3=x.updateInt3.bind(x),this.setInt4=x.updateInt4.bind(x)):(this.setMatrix3x3=x.setMatrix3x3.bind(x),this.setMatrix2x2=x.setMatrix2x2.bind(x),this.setFloat=x.setFloat.bind(x),this.setFloat2=x.setFloat2.bind(x),this.setFloat3=x.setFloat3.bind(x),this.setFloat4=x.setFloat4.bind(x),this.setFloatArray=x.setFloatArray.bind(x),this.setArray=x.setArray.bind(x),this.setIntArray=x.setIntArray.bind(x),this.setMatrix=x.setMatrix.bind(x),this.setMatrices=x.setMatrices.bind(x),this.setVector3=x.setVector3.bind(x),this.setVector4=x.setVector4.bind(x),this.setColor3=x.setColor3.bind(x),this.setColor4=x.setColor4.bind(x),this.setDirectColor4=x.setDirectColor4.bind(x),this.setInt=x.setInt.bind(x),this.setInt2=x.setInt2.bind(x),this.setInt3=x.setInt3.bind(x),this.setInt4=x.setInt4.bind(x))}}var k=Q(10983);const J="gpuUpdateParticlesPixelShader",t="#version 300 es\nvoid main() {discard;}\n";k.e.ShadersStore[J]||(k.e.ShadersStore[J]=t);const c="gpuUpdateParticlesVertexShader",d="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";k.e.ShadersStore[c]||(k.e.ShadersStore[c]=d);(0,o.d)("BABYLON.WebGL2ParticleSystem",class{constructor(x,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=x,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var x;return(null===(x=this._updateEffect)||void 0===x?void 0:x.isReady())??!1}createUpdateBuffer(x){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof R&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=x,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new G(this._updateEffect)}createVertexBuffers(x,O){this._updateVAO.push(this._createUpdateVAO(x)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(x){return x}bindDrawBuffers(x,O,Q){Q?this._engine.bindBuffers(this._renderVertexBuffers,Q,O):this._engine.bindVertexArrayObject(this._renderVAO[x],null)}preUpdateParticleBuffer(){const x=this._engine;if(this._engine.enableEffect(this._updateEffect),!x.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(x,O,Q){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[x],null);const X=this._engine;X.bindTransformFeedbackBuffer(O.getBuffer()),X.setRasterizerState(!1),X.beginTransformFeedback(!0),X.drawArraysType(3,0,Q),X.endTransformFeedback(),X.setRasterizerState(!0),X.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let x=0;x<this._updateVAO.length;x++)this._engine.releaseVertexArrayObject(this._updateVAO[x]);this._updateVAO.length=0;for(let x=0;x<this._renderVAO.length;x++)this._engine.releaseVertexArrayObject(this._renderVAO[x]);this._renderVAO.length=0}_createUpdateVAO(x){const O={};O.position=x.createVertexBuffer("position",0,3);let Q=3;O.age=x.createVertexBuffer("age",Q,1),Q+=1,O.size=x.createVertexBuffer("size",Q,3),Q+=3,O.life=x.createVertexBuffer("life",Q,1),Q+=1,O.seed=x.createVertexBuffer("seed",Q,4),Q+=4,O.direction=x.createVertexBuffer("direction",Q,3),Q+=3,this._parent.particleEmitterType instanceof R&&(O.initialPosition=x.createVertexBuffer("initialPosition",Q,3),Q+=3),this._parent._colorGradientsTexture||(O.color=x.createVertexBuffer("color",Q,4),Q+=4),this._parent._isBillboardBased||(O.initialDirection=x.createVertexBuffer("initialDirection",Q,3),Q+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=x.createVertexBuffer("noiseCoordinates1",Q,3),Q+=3,O.noiseCoordinates2=x.createVertexBuffer("noiseCoordinates2",Q,3),Q+=3),this._parent._angularSpeedGradientsTexture?(O.angle=x.createVertexBuffer("angle",Q,1),Q+=1):(O.angle=x.createVertexBuffer("angle",Q,2),Q+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=x.createVertexBuffer("cellIndex",Q,1),Q+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=x.createVertexBuffer("cellStartOffset",Q,1),Q+=1));const X=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),X}});class u{constructor(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,X=arguments.length>3?arguments[3]:void 0;this._engine=x,this._label=X,this._engine._storageBuffers.push(this),this._create(O,Q)}_create(x,O){this._bufferSize=x,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(x,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(x,O,Q){this._buffer&&this._engine.updateStorageBuffer(this._buffer,x,O,Q)}async read(x,O,Q,X){return await this._engine.readFromStorageBuffer(this._buffer,x,O,Q,X)}dispose(){const x=this._engine._storageBuffers,O=x.indexOf(this);-1!==O&&(x[O]=x[x.length-1],x.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var A=Q(11039),f=Q(11042),E=Q(11122),z=Q(11335),F=Q(11458),b=Q(10905),D=Q(10999),W=Q(11327);class y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new W.d}_addDuration(x,O){x<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==x?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=x):this.counter.addCount(O,!1))}}var I=Q(10962);class r{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=x,this._engine=O,this.uniqueId=F.e.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new y),this._engine.getCaps().supportComputeShaders?X.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=Q,this._options={bindingsMapping:{},defines:[],...X}):b.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):b.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(x,O){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=this._bindings[x];this._bindings[x]={type:Q?0:4,object:O,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!X||X.object!==O||X.type!==this._bindings[x].type)}setStorageTexture(x,O){const Q=this._bindings[x];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==O),this._bindings[x]={type:1,object:O,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setExternalTexture(x,O){const Q=this._bindings[x];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==O),this._bindings[x]={type:6,object:O,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setVideoTexture(x,O){return!!O.externalTexture&&(this.setExternalTexture(x,O.externalTexture),!0)}setUniformBuffer(x,O){const Q=this._bindings[x];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==O),this._bindings[x]={type:r._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setStorageBuffer(x,O){const Q=this._bindings[x];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==O),this._bindings[x]={type:r._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setTextureSampler(x,O){const Q=this._bindings[x];this._contextIsDirty||(this._contextIsDirty=!Q||!O.compareSampler(Q.object)),this._bindings[x]={type:5,object:O,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}isReady(){let x=this._effect;for(const Z in this._bindings){const x=this._bindings[Z],O=x.type,Q=x.object;switch(O){case 0:case 4:case 1:if(!Q.isReady())return!1;break;case 6:if(!Q.isReady())return!1;break}}const O=[],Q=this._shaderPath;if(this._options.defines)for(let Z=0;Z<this._options.defines.length;Z++)O.push(this._options.defines[Z]);const X=O.join("\n");return this._cachedDefines!==X&&(this._cachedDefines=X,x=this._engine.createComputeEffect(Q,{defines:X,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=x),!!x.isReady()}dispatch(x,O,Q){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,x,O,Q,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Q=r._BufferIsDataBuffer(x)?x:x.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Q,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const Q=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(Q.type){case 0:{const X=this._samplers[O],Z=Q.object;var x;if(!X||!Z._texture||!X.compareSampler(Z._texture))this._samplers[O]=(new D.e).setParameters(Z.wrapU,Z.wrapV,Z.wrapR,Z.anisotropicFilteringLevel,Z._texture.samplingMode,null===(x=Z._texture)||void 0===x?void 0:x._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const x=Q.object;x.getBuffer()!==Q.buffer&&(Q.buffer=x.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((Z=>{(0,I.g)((()=>this.dispatch(x,O,Q)),Z,void 0,X)}))}serialize(){const x=E.c.Serialize(this);x.options=this._options,x.shaderPath=this._shaderPath,x.yL={},x.textures={};for(const O in this._bindings){const Q=this._bindings[O],X=Q.object;switch(Q.type){case 0:case 4:case 1:{const Z=X.serialize();Z&&(x.textures[O]=Z,x.yL[O]={type:Q.type});break}}}return x}static Parse(x,O,Q){const X=E.c.Parse((()=>new r(x.name,O.getEngine(),x.shaderPath,x.options)),x,O,Q);for(const Z in x.textures){const n=x.yL[Z],V=z.b.Parse(x.textures[Z],O,Q);0===n.type?X.setTexture(Z,V):4===n.type?X.setTexture(Z,V,!1):X.setStorageTexture(Z,V)}return X}static _BufferIsDataBuffer(x){return void 0!==x.underlyingResource}}(0,A.b)([(0,f.L)()],r.prototype,"name",void 0),(0,A.b)([(0,f.L)()],r.prototype,"fastMode",void 0),(0,o.d)("BABYLON.ComputeShader",r);var j=Q(11108);const T="gpuUpdateParticlesComputeShader",e="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";k.e.ShadersStoreWGSL[T]||(k.e.ShadersStoreWGSL[T]=e);(0,o.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(x,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=x,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var x;return(null===(x=this._updateComputeShader)||void 0===x?void 0:x.isReady())??!1}createUpdateBuffer(x){var O;const Q={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Q.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Q.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Q.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Q.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Q.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Q.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Q.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new r("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Q,defines:x.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new j.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new G(this._simParamsComputeShader)}createVertexBuffers(x,O){this._renderVertexBuffers.push(O)}createParticleBuffer(x){const O=new u(this._engine,4*x.length,11,"ComputeShaderParticleSystemBuffer");return O.update(x),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(x,O,Q){this._engine.bindBuffers(this._renderVertexBuffers[x],Q,O)}preUpdateParticleBuffer(){}updateParticleBuffer(x,O,Q){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[x]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^x]),this._updateComputeShader.dispatch(Math.ceil(Q/64))}releaseBuffers(){var x;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(x=this._simParamsComputeShader)||void 0===x||x.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class B{constructor(x,O,Q){this.gradient=x,this.color1=O,this.color2=Q}getColorToRef(x){this.color2?V.h.LerpToRef(this.color1,this.color2,Math.random(),x):x.V(this.color1)}}class i{constructor(x,O){this.gradient=x,this.color=O}}class H{constructor(x,O,Q){this.gradient=x,this.factor1=O,this.factor2=Q}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class S{static GetCurrentGradient(x,O,Q){if(O[0].gradient>x)return void Q(O[0],O[0],1);for(let Z=0;Z<O.length-1;Z++){const X=O[Z],n=O[Z+1];if(x>=X.gradient&&x<=n.gradient){return void Q(X,n,(x-X.gradient)/(n.gradient-X.gradient))}}const X=O.length-1;Q(O[X],O[X],1)}}var p=Q(10882),P=Q(11378),m=Q(10877);class w{constructor(x){this.particleSystem=x,this.position=X.n.Zero(),this.direction=X.n.Zero(),this.color=new V.h(0,0,0,0),this.colorStep=new V.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new X.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new V.h(0,0,0,0),this._currentColor2=new V.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=w._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let x=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,x=this._randomCellOffset):x+=this._randomCellOffset);const Q=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let X;X=this._initialSpriteCellLoop?(0,C.Clamp)(x*O%this.lifeTime/this.lifeTime):(0,C.Clamp)(x*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+X*Q|0}_inheritParticleInfoToSubEmitter(x){if(x.particleSystem.i.position){const O=x.particleSystem.i;if(O.position.V(this.position),x.inheritDirection){const x=X.j.Oo[0];this.direction.normalizeToRef(x),O.setDirection(x,0,Math.PI/2)}}else{x.particleSystem.i.V(this.position)}this.direction.scaleToRef(x.inheritedVelocityAmount/2,X.j.Oo[0]),x.particleSystem._inheritedVelocityOffset.V(X.j.Oo[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const x of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(x)}_reset(){this.age=0,this.id=w._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(x){x.position.V(this.position),this._initialDirection?x._initialDirection?x._initialDirection.V(this._initialDirection):x._initialDirection=this._initialDirection.clone():x._initialDirection=null,x.direction.V(this.direction),this.yo&&(x.yo?x.yo.V(this.yo):x.yo=this.yo.clone()),x.color.V(this.color),x.colorStep.V(this.colorStep),x.lifeTime=this.lifeTime,x.age=this.age,x._randomCellOffset=this._randomCellOffset,x.size=this.size,x.scale.V(this.scale),x.angle=this.angle,x.angularSpeed=this.angularSpeed,x.particleSystem=this.particleSystem,x.cellIndex=this.cellIndex,x.id=this.id,x._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(x._currentColorGradient=this._currentColorGradient,x._currentColor1.V(this._currentColor1),x._currentColor2.V(this._currentColor2)),this._currentSizeGradient&&(x._currentSizeGradient=this._currentSizeGradient,x._currentSize1=this._currentSize1,x._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(x._currentAngularSpeedGradient=this._currentAngularSpeedGradient,x._currentAngularSpeed1=this._currentAngularSpeed1,x._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(x._currentVelocityGradient=this._currentVelocityGradient,x._currentVelocity1=this._currentVelocity1,x._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(x._currentLimitVelocityGradient=this._currentLimitVelocityGradient,x._currentLimitVelocity1=this._currentLimitVelocity1,x._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(x._currentDragGradient=this._currentDragGradient,x._currentDrag1=this._currentDrag1,x._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(x._initialStartSpriteCellId=this._initialStartSpriteCellId,x._initialEndSpriteCellId=this._initialEndSpriteCellId,x._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(x.remapData&&this.remapData?x.remapData.V(this.remapData):x.remapData=new X.o(0,0,0,0)),this._randomNoiseCoordinates1&&(x._randomNoiseCoordinates1?(x._randomNoiseCoordinates1.V(this._randomNoiseCoordinates1),x._randomNoiseCoordinates2.V(this._randomNoiseCoordinates2)):(x._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),x._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}w._Count=0;var xx=Q(11105),Ox=(Q(11278),Q(11151)),Qx=Q(11141),Xx=Q(11432);function Zx(x,O){const Q=(0,C.RandomRange)(0,1);V.h.LerpToRef(O.color1,O.color2,Q,x.color),O.colorDead.subtractToRef(x.color,O._colorDiff),O._colorDiff.scaleToRef(1/x.lifeTime,x.colorStep)}function nx(x,O){x._currentColorGradient=O._colorGradients[0],x._currentColorGradient.getColorToRef(x.color),x._currentColor1.V(x.color),O._colorGradients.length>1?O._colorGradients[1].getColorToRef(x._currentColor2):x._currentColor2.V(x.color)}function Vx(x,O){const Q=O._colorGradients;S.GetCurrentGradient(O._ratio,Q,((O,Q,X)=>{O!==x._currentColorGradient&&(x._currentColor1.V(x._currentColor2),Q.getColorToRef(x._currentColor2),x._currentColorGradient=O),V.h.LerpToRef(x._currentColor1,x._currentColor2,X,x.color)}))}function ox(x,O){x.colorStep.scaleToRef(O._scaledUpdateSpeed,O._scaledColorStep),x.color.addInPlace(O._scaledColorStep),x.color.a<0&&(x.color.a=0)}function lx(x,O){S.GetCurrentGradient(O._ratio,O._angularSpeedGradients,((O,Q,X)=>{O!==x._currentAngularSpeedGradient&&(x._currentAngularSpeed1=x._currentAngularSpeed2,x._currentAngularSpeed2=Q.getFactor(),x._currentAngularSpeedGradient=O),x.angularSpeed=(0,C.Lerp)(x._currentAngularSpeed1,x._currentAngularSpeed2,X)}))}function Cx(x,O){x.angle+=x.angularSpeed*O._scaledUpdateSpeed}function Ux(x,O){O.particleEmitterType.startDirectionFunction(O._emitterWorldMatrix,x.direction,x,O.isLocal,O._emitterInverseWorldMatrix)}function Lx(x,O){O.startDirectionFunction(O._emitterWorldMatrix,x.direction,x,O.isLocal)}function hx(x,O){x._currentVelocityGradient=O._velocityGradients[0],x._currentVelocity1=x._currentVelocityGradient.getFactor(),O._velocityGradients.length>1?x._currentVelocity2=O._velocityGradients[1].getFactor():x._currentVelocity2=x._currentVelocity1}function Nx(x,O){x._currentLimitVelocityGradient=O._limitVelocityGradients[0],x._currentLimitVelocity1=x._currentLimitVelocityGradient.getFactor(),O._limitVelocityGradients.length>1?x._currentLimitVelocity2=O._limitVelocityGradients[1].getFactor():x._currentLimitVelocity2=x._currentLimitVelocity1}function ax(x,O){S.GetCurrentGradient(O._ratio,O._velocityGradients,((Q,X,Z)=>{Q!==x._currentVelocityGradient&&(x._currentVelocity1=x._currentVelocity2,x._currentVelocity2=X.getFactor(),x._currentVelocityGradient=Q),O._directionScale*=(0,C.Lerp)(x._currentVelocity1,x._currentVelocity2,Z)}))}function Kx(x,O){S.GetCurrentGradient(O._ratio,O._limitVelocityGradients,((Q,X,Z)=>{Q!==x._currentLimitVelocityGradient&&(x._currentLimitVelocity1=x._currentLimitVelocity2,x._currentLimitVelocity2=X.getFactor(),x._currentLimitVelocityGradient=Q);const n=(0,C.Lerp)(x._currentLimitVelocity1,x._currentLimitVelocity2,Z);x.direction.length()>n&&x.direction.scaleInPlace(O.limitVelocityDamping)}))}function Mx(x,O){x.direction.scaleToRef(O._directionScale,O._scaledDirection)}function Yx(x,O){O.particleEmitterType.startPositionFunction(O._emitterWorldMatrix,x.position,x,O.isLocal)}function gx(x,O){O.startPositionFunction(O._emitterWorldMatrix,x.position,x,O.isLocal)}function vx(x,O){x.yo?x.yo.V(x.position):x.yo=x.position.clone(),X.n.TransformCoordinatesToRef(x.yo,O._emitterWorldMatrix,x.position)}function Rx(x,O){O.isLocal&&x.yo?(x.yo.addInPlace(O._scaledDirection),X.n.TransformCoordinatesToRef(x.yo,O._emitterWorldMatrix,x.position)):x.position.addInPlace(O._scaledDirection)}function sx(x,O){x._currentDragGradient=O._dragGradients[0],x._currentDrag1=x._currentDragGradient.getFactor(),O._dragGradients.length>1?x._currentDrag2=O._dragGradients[1].getFactor():x._currentDrag2=x._currentDrag1}function qx(x,O){S.GetCurrentGradient(O._ratio,O._dragGradients,((Q,X,Z)=>{Q!==x._currentDragGradient&&(x._currentDrag1=x._currentDrag2,x._currentDrag2=X.getFactor(),x._currentDragGradient=Q);const n=(0,C.Lerp)(x._currentDrag1,x._currentDrag2,Z);O._scaledDirection.scaleInPlace(1-n)}))}function Gx(x,O){x._randomNoiseCoordinates1?(x._randomNoiseCoordinates1.xo(Math.random(),Math.random(),Math.random()),x._randomNoiseCoordinates2.xo(Math.random(),Math.random(),Math.random())):(x._randomNoiseCoordinates1=new X.n(Math.random(),Math.random(),Math.random()),x._randomNoiseCoordinates2=new X.n(Math.random(),Math.random(),Math.random()))}function kx(x,O){const Q=O._noiseTextureData,Z=O._noiseTextureSize;if(Q&&Z&&x._randomNoiseCoordinates1){const n=O._fetchR(x._randomNoiseCoordinates1.x,x._randomNoiseCoordinates1.y,Z.width,Z.height,Q),V=O._fetchR(x._randomNoiseCoordinates1.z,x._randomNoiseCoordinates2.x,Z.width,Z.height,Q),o=O._fetchR(x._randomNoiseCoordinates2.y,x._randomNoiseCoordinates2.z,Z.width,Z.height,Q),l=X.j.Oo[0],C=X.j.Oo[1];l.xo((2*n-1)*O.noiseStrength.x,(2*V-1)*O.noiseStrength.y,(2*o-1)*O.noiseStrength.z),l.scaleToRef(O._tempScaledUpdateSpeed,C),x.direction.addInPlace(C)}}function Jx(x,O){O.gravity.scaleToRef(O._tempScaledUpdateSpeed,O._scaledGravity),x.direction.addInPlace(O._scaledGravity)}function tx(x,O){x.size=(0,C.RandomRange)(O.minSize,O.maxSize),x.scale.xo((0,C.RandomRange)(O.minScaleX,O.maxScaleX),(0,C.RandomRange)(O.minScaleY,O.maxScaleY))}function cx(x,O){x._currentSizeGradient=O._sizeGradients[0],x._currentSize1=x._currentSizeGradient.getFactor(),x.size=x._currentSize1,O._sizeGradients.length>1?x._currentSize2=O._sizeGradients[1].getFactor():x._currentSize2=x._currentSize1,x.scale.xo((0,C.RandomRange)(O.minScaleX,O.maxScaleX),(0,C.RandomRange)(O.minScaleY,O.maxScaleY))}function dx(x,O){const Q=O._actualFrame/O.targetStopDuration;S.GetCurrentGradient(Q,O._startSizeGradients,((Q,X,Z)=>{Q!==O._currentStartSizeGradient&&(O._currentStartSize1=O._currentStartSize2,O._currentStartSize2=X.getFactor(),O._currentStartSizeGradient=Q);const n=(0,C.Lerp)(O._currentStartSize1,O._currentStartSize2,Z);x.scale.scaleInPlace(n)}))}function ux(x,O){S.GetCurrentGradient(O._ratio,O._sizeGradients,((O,Q,X)=>{O!==x._currentSizeGradient&&(x._currentSize1=x._currentSize2,x._currentSize2=Q.getFactor(),x._currentSizeGradient=O),x.size=(0,C.Lerp)(x._currentSize1,x._currentSize2,X)}))}function Ax(x,O){x.remapData=new X.o(0,1,0,1)}function fx(x,O){O._colorRemapGradients&&O._colorRemapGradients.length>0&&S.GetCurrentGradient(O._ratio,O._colorRemapGradients,((O,Q,X)=>{const Z=(0,C.Lerp)(O.factor1,Q.factor1,X),n=(0,C.Lerp)(O.factor2,Q.factor2,X);x.remapData.x=Z,x.remapData.y=n-Z})),O._alphaRemapGradients&&O._alphaRemapGradients.length>0&&S.GetCurrentGradient(O._ratio,O._alphaRemapGradients,((O,Q,X)=>{const Z=(0,C.Lerp)(O.factor1,Q.factor1,X),n=(0,C.Lerp)(O.factor2,Q.factor2,X);x.remapData.z=Z,x.remapData.w=n-Z}))}function Ex(x,O){const Q=(0,C.Clamp)(O._actualFrame/O.targetStopDuration);S.GetCurrentGradient(Q,O._lifeTimeGradients,((O,X)=>{const Z=O,n=X,V=Z.getFactor(),o=n.getFactor(),l=(Q-Z.gradient)/(n.gradient-Z.gradient);x.lifeTime=(0,C.Lerp)(V,o,l)})),O._emitPower=(0,C.RandomRange)(O.minEmitPower,O.maxEmitPower)}function zx(x,O){x.lifeTime=(0,C.RandomRange)(O.minLifeTime,O.maxLifeTime),O._emitPower=(0,C.RandomRange)(O.minEmitPower,O.maxEmitPower)}function Fx(x,O){0===O._emitPower?(x._initialDirection?x._initialDirection.V(x.direction):x._initialDirection=x.direction.clone(),x.direction.set(0,0,0)):(x._initialDirection=null,x.direction.scaleInPlace(O._emitPower)),x.direction.addInPlace(O._inheritedVelocityOffset)}function bx(x,O){x.angularSpeed=(0,C.RandomRange)(O.minAngularSpeed,O.maxAngularSpeed),x.angle=(0,C.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function Dx(x,O){x._currentAngularSpeedGradient=O._angularSpeedGradients[0],x.angularSpeed=x._currentAngularSpeedGradient.getFactor(),x._currentAngularSpeed1=x.angularSpeed,O._angularSpeedGradients.length>1?x._currentAngularSpeed2=O._angularSpeedGradients[1].getFactor():x._currentAngularSpeed2=x._currentAngularSpeed1,x.angle=(0,C.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function Wx(x,O){x._initialStartSpriteCellId=O.startSpriteCellID,x._initialEndSpriteCellId=O.endSpriteCellID,x._initialSpriteCellLoop=O.spriteCellLoop}function yx(x,O){x.previousItem=O.previousItem,x.nextItem=O,O.previousItem&&(O.previousItem.nextItem=x),O.previousItem=x}function Ix(x,O){x.previousItem=O,x.nextItem=O.nextItem,O.nextItem&&(O.nextItem.previousItem=x),O.nextItem=x}function rx(x,O){let Q=O;for(;Q.nextItem;)Q=Q.nextItem;x.previousItem=Q,x.nextItem=Q.nextItem,Q.nextItem=x}function jx(x){x.previousItem&&(x.previousItem.nextItem=x.nextItem),x.nextItem&&(x.nextItem.previousItem=x.previousItem)}class Tx extends l{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(x){this._startDirectionFunction!==x&&(this._startDirectionFunction=x,this._directionProcessing.process=x?Lx:Ux)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(x){this._startPositionFunction!==x&&(this._startPositionFunction=x,this._positionCreation.process=x?gx:Yx)}set onDispose(x){this._onDisposeObserver&&this.no.remove(this._onDisposeObserver),this._onDisposeObserver=this.no.add(x)}get U(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(x){this._useRampGradients!==x&&(this._useRampGradients=x,this._resetEffect(),x?(this._rampCreation={process:Ax,previousItem:null,nextItem:null},Ix(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:fx,previousItem:null,nextItem:null},Ix(this._remapGradientProcessing,this._gravityProcessing)):(jx(this._rampCreation),jx(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(x){this._isLocal!==x&&(this._isLocal=x,x?(this._isLocalCreation={process:vx,previousItem:null,nextItem:null},Ix(this._isLocalCreation,this._positionCreation)):jx(this._isLocalCreation))}get particles(){return this.zL}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(x){this._animationSheetEnabled!==x&&(this._animationSheetEnabled=x,x?(this._sheetCreation={process:Wx,previousItem:null,nextItem:null},Ix(this._sheetCreation,this._colorCreation)):jx(this._sheetCreation),this._reset())}getActiveCount(){return this.zL.length}getClassName(){return"ah"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var x;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(x=this._customWrappers[O])||void 0===x?void 0:x.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[x]??this._customWrappers[0]}setCustomEffect(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new xx.c(this._engine),this._customWrappers[O].effect=x,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(x){if(this.noiseTexture!==x){if(this._noiseTexture=x,!x)return jx(this._noiseCreation),void jx(this._noiseProcessing);this._noiseCreation={process:Gx,previousItem:null,nextItem:null},Ix(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:kx,previousItem:null,nextItem:null},Ix(this._noiseProcessing,this._positionProcessing)}}constructor(x,O,Q){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(x),this._emitterInverseWorldMatrix=X.c.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new X.n,this.no=new p.b,this.onStoppedObservable=new p.b,this.onStartedObservable=new p.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.zL=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new V.h(0,0,0,0),this._colorDiff=new V.h(0,0,0,0),this._scaledDirection=X.n.Zero(),this._scaledGravity=X.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=x=>{},this.recycleParticle=x=>{const O=this.zL.pop();O!==x&&O.copyTo(x),this._stockParticles.push(O)},this._createParticle=()=>{let x;return 0!==this._stockParticles.length?(x=this._stockParticles.pop(),x._reset()):x=new w(this),this._prepareParticle(x),x},this.paused=!1,this._shadersLoaded=!1,this._capacity=O,this._epsilon=o,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=X.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||m.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fL.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:zx,previousItem:null,nextItem:null},this._positionCreation={process:Yx,previousItem:null,nextItem:null},Ix(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Ux,previousItem:null,nextItem:null},Ix(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Fx,previousItem:null,nextItem:null},Ix(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:tx,previousItem:null,nextItem:null},Ix(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:bx,previousItem:null,nextItem:null},Ix(this._angleCreation,this._sizeCreation),this._colorCreation={process:Zx,previousItem:null,nextItem:null},Ix(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,l||(this._colorProcessing={process:ox,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Cx,previousItem:null,nextItem:null},Ix(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Mx,previousItem:null,nextItem:null},Ix(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Rx,previousItem:null,nextItem:null},Ix(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Jx,previousItem:null,nextItem:null},Ix(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=n,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new xx.c(this._engine)},this._customWrappers[0].effect=Z,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new L,this.updateFunction=x=>{var O;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(O=this.noiseTexture.getContent())||void 0===O||O.then((x=>{this._noiseTextureData=x})));const Q=x===this.zL;for(let X=0;X<x.length;X++){const O=x[X];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const Z=O.age;if(O.age+=this._tempScaledUpdateSpeed,O.age>O.lifeTime){const x=O.age-Z,Q=O.lifeTime-Z;this._tempScaledUpdateSpeed=Q*this._tempScaledUpdateSpeed/x,O.age=O.lifeTime}this._ratio=O.age/O.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let n=this._updateQueueStart;for(;n;)n.process(O,this),n=n.nextItem;if(this._isAnimationSheetEnabled&&!l&&O.updateCellIndex(),O._inheritParticleInfoToSubEmitters(),O.age>=O.lifeTime){if(this._emitFromParticle(O),O._attachedSubEmitters){for(const x of O._attachedSubEmitters)x.particleSystem.disposeOnStop=!0,x.particleSystem.stop();O._attachedSubEmitters=null}this.recycleParticle(O),Q&&X--}else;}}}serialize(x){throw new Error("Method not implemented.")}clone(x,O){throw new Error("Method not implemented.")}_addFactorGradient(x,O,Q,X){const Z=new H(O,Q,X);x.push(Z),x.sort(((x,O)=>x.gradient<O.gradient?-1:x.gradient>O.gradient?1:0))}_removeFactorGradient(x,O){if(!x)return;let Q=0;for(const X of x){if(X.gradient===O){x.splice(Q,1);break}Q++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Ex:this._lifeTimeCreation.process=zx}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:dx,previousItem:null,nextItem:null},Ix(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(jx(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(x){this.targetStopDuration!==x&&(this._targetStopDuration=x,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(x,O,Q){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,x,O,Q),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(x){return this._removeFactorGradient(this._lifeTimeGradients,x),this._syncLifeTimeCreation(),this}addSizeGradient(x,O,Q){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=cx,this._sizeGradientProcessing={process:ux,previousItem:null,nextItem:null},yx(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,x,O,Q),this}removeSizeGradient(x){var O;return this._removeFactorGradient(this._sizeGradients,x),0===(null===(O=this._sizeGradients)||void 0===O?void 0:O.length)&&(jx(this._sizeGradientProcessing),this._sizeCreation.process=tx),this}addColorRemapGradient(x,O,Q){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,x,O,Q),this}removeColorRemapGradient(x){return this._removeFactorGradient(this._colorRemapGradients,x),this}addAlphaRemapGradient(x,O,Q){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,x,O,Q),this}removeAlphaRemapGradient(x){return this._removeFactorGradient(this._alphaRemapGradients,x),this}addAngularSpeedGradient(x,O,Q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Dx,this._angularSpeedGradientProcessing={process:lx,previousItem:null,nextItem:null},yx(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,x,O,Q),this}removeAngularSpeedGradient(x){var O;return this._removeFactorGradient(this._angularSpeedGradients,x),0===(null===(O=this._angularSpeedGradients)||void 0===O?void 0:O.length)&&(this._angleCreation.process=bx,jx(this._angularSpeedGradientProcessing)),this}addVelocityGradient(x,O,Q){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:hx,previousItem:null,nextItem:null},Ix(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:ax,previousItem:null,nextItem:null},yx(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,x,O,Q),this}removeVelocityGradient(x){var O;return this._removeFactorGradient(this._velocityGradients,x),0===(null===(O=this._velocityGradients)||void 0===O?void 0:O.length)&&(jx(this._velocityCreation),jx(this._velocityGradientProcessing)),this}addLimitVelocityGradient(x,O,Q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Nx,previousItem:null,nextItem:null},Ix(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Kx,previousItem:null,nextItem:null},Ix(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,x,O,Q),this}removeLimitVelocityGradient(x){var O;return this._removeFactorGradient(this._limitVelocityGradients,x),0===(null===(O=this._limitVelocityGradients)||void 0===O?void 0:O.length)&&(jx(this._limitVelocityCreation),jx(this._limitVelocityGradientProcessing)),this}addDragGradient(x,O,Q){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:sx,previousItem:null,nextItem:null},yx(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:qx,previousItem:null,nextItem:null},yx(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,x,O,Q),this}removeDragGradient(x){var O;return this._removeFactorGradient(this._dragGradients,x),0===(null===(O=this._dragGradients)||void 0===O?void 0:O.length)&&(jx(this._dragCreation),jx(this._dragGradientProcessing)),this}addEmitRateGradient(x,O,Q){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,x,O,Q),this}removeEmitRateGradient(x){return this._removeFactorGradient(this._emitRateGradients,x),this}addStartSizeGradient(x,O,Q){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,x,O,Q),this._syncStartSizeCreation(),this}removeStartSizeGradient(x){return this._removeFactorGradient(this._startSizeGradients,x),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const x=new Uint8Array(4*this._rawTextureWidth),O=V.i.rl[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const X=Q/this._rawTextureWidth;S.GetCurrentGradient(X,this._rampGradients,((X,Z,n)=>{V.d.LerpToRef(X.color,Z.color,n,O),x[4*Q]=255*O.r,x[4*Q+1]=255*O.g,x[4*Q+2]=255*O.b,x[4*Q+3]=255}))}this._rampGradientsTexture=P.b.CreateRGBATexture(x,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((x,O)=>x.gradient<O.gradient?-1:x.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(x,O){this._rampGradients||(this._rampGradients=[]);const Q=new i(x,O);return this._rampGradients.push(Q),this._syncRampGradientTexture(),this}removeRampGradient(x){return this._removeGradientAndTexture(x,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(x,O,Q){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=nx,this._colorProcessing.process=Vx);const X=new B(x,O,Q);return this._colorGradients.push(X),this._colorGradients.sort(((x,O)=>x.gradient<O.gradient?-1:x.gradient>O.gradient?1:0)),this}removeColorGradient(x){if(!this._colorGradients)return this;let O=0;for(const Q of this._colorGradients){if(Q.gradient===x){this._colorGradients.splice(O,1);break}O++}return 0===this._colorGradients.length&&(this._colorCreation.process=Zx,this._colorProcessing.process=ox),this}resetDrawCache(){if(this._drawWrappers){for(const x of this._drawWrappers)if(x)for(const O of x)null===O||void 0===O||O.dispose();this._drawWrappers=[]}}_fetchR(x,O,Q,X,Z){return Z[4*(((x=.5*Math.abs(x)+.5)*Q%Q|0)+((O=.5*Math.abs(O)+.5)*X%X|0)*Q)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const x=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new s.c(x,this._vertexData,!0,O);let Q=0;const X=this._vertexBuffer.createVertexBuffer(s.g.PositionKind,Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.g.PositionKind]=X,Q+=3;const Z=this._vertexBuffer.createVertexBuffer(s.g.ColorKind,Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.g.ColorKind]=Z,Q+=4;const n=this._vertexBuffer.createVertexBuffer("angle",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=n,Q+=1;const V=this._vertexBuffer.createVertexBuffer("size",Q,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=V,Q+=2,this._isAnimationSheetEnabled){const x=this._vertexBuffer.createVertexBuffer("cellIndex",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=x,Q+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const x=this._vertexBuffer.createVertexBuffer("direction",Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=x,Q+=3}if(this._useRampGradients){const x=this._vertexBuffer.createVertexBuffer("remapData",Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=x,Q+=4}let o;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new s.c(x,O,!1,2),o=this._spriteBuffer.createVertexBuffer("offset",0,2)}else o=this._vertexBuffer.createVertexBuffer("offset",Q,2,this._vertexBufferSize,this._useInstancing),Q+=2;this._vertexBuffers.offset=o,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const x=[],O=[];let Q=0;for(let X=0;X<this._capacity;X++)x.push(Q),x.push(Q+1),x.push(Q+2),x.push(Q),x.push(Q+2),x.push(Q+3),O.push(Q,Q+1,Q+1,Q+2,Q+2,Q+3,Q+3,Q,Q,Q+3),Q+=4;this._indexBuffer=this._engine.createIndexBuffer(x),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(x)setTimeout((()=>{this.start(0)}),x);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.i)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.i.HV(!0);const x=this.noiseTexture;if(x&&x.onGeneratedObservable)x.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),x.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(x))}_postStop(x){}reset(){this._stockParticles.length=0,this.zL.length=0}_appendParticleVertex(x,O,Q,Z){let n=x*this._vertexBufferSize;if(this._vertexData[n++]=O.position.x+this.ml.x,this._vertexData[n++]=O.position.y+this.ml.y,this._vertexData[n++]=O.position.z+this.ml.z,this._vertexData[n++]=O.color.r,this._vertexData[n++]=O.color.g,this._vertexData[n++]=O.color.b,this._vertexData[n++]=O.color.a,this._vertexData[n++]=O.angle,this._vertexData[n++]=O.scale.x*O.size,this._vertexData[n++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[n++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[n++]=O.direction.x,this._vertexData[n++]=O.direction.y,this._vertexData[n++]=O.direction.z);else if(O._initialDirection){let x=O._initialDirection;this.isLocal&&(X.n.TransformNormalToRef(x,this._emitterWorldMatrix,X.j.Oo[0]),x=X.j.Oo[0]),0===x.x&&0===x.z&&(x.x=.001),this._vertexData[n++]=x.x,this._vertexData[n++]=x.y,this._vertexData[n++]=x.z}else{let x=O.direction;this.isLocal&&(X.n.TransformNormalToRef(x,this._emitterWorldMatrix,X.j.Oo[0]),x=X.j.Oo[0]),0===x.x&&0===x.z&&(x.x=.001),this._vertexData[n++]=x.x,this._vertexData[n++]=x.y,this._vertexData[n++]=x.z}this._useRampGradients&&O.remapData&&(this._vertexData[n++]=O.remapData.x,this._vertexData[n++]=O.remapData.y,this._vertexData[n++]=O.remapData.z,this._vertexData[n++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon),0===Z?Z=this._epsilon:1===Z&&(Z=1-this._epsilon)),this._vertexData[n++]=Q,this._vertexData[n++]=Z)}_prepareParticle(x){}_createNewOnes(x){let O;for(let Q=0;Q<x&&this.zL.length!==this._capacity;Q++){O=this._createParticle(),this.zL.push(O);let x=this._createQueueStart;for(;x;)x.process(O,this),x=x.nextItem;O._inheritParticleInfoToSubEmitters()}}_update(x){if(this._alive=this.zL.length>0,this.i.position){const x=this.i;this._emitterWorldMatrix=x.getWorldMatrix()}else{const x=this.i;this._emitterWorldMatrix=X.c.Translation(x.x,x.y,x.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.zL),this._createNewOnes(x)}static _GetAttributeNamesOrOptions(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=[s.g.PositionKind,s.g.ColorKind,"angle","offset","size"];return x&&X.push("cellIndex"),O||X.push("direction"),Q&&X.push("remapData"),X}static _GetEffectCreationOptions(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Ox.d)(X),x&&X.push("particlesInfos"),O&&X.push("logarithmicDepthConstant"),Q&&(X.push("vFogInfos"),X.push("vFogColor")),X}fillDefines(x,O){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ox.i)(this,this._scene,x),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&x.push("#define FOG")),this._isAnimationSheetEnabled&&x.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&x.push("#define LOGARITHMICDEPTH"),O===l.BLENDMODE_MULTIPLY&&x.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&x.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(x.push("#define BILLBOARD"),this.billboardMode){case 2:x.push("#define BILLBOARDY");break;case 8:case 9:x.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&x.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:x.push("#define BILLBOARDMODE_ALL")}Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),x.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(x,O,Q){O.push(...Tx._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),x.push(...Tx._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Xx.d)(x,this._imageProcessingConfigurationDefines),(0,Xx.c)(Q,this._imageProcessingConfigurationDefines))}_getWrapper(x){const O=this._getCustomDrawWrapper(x);if(null!==O&&void 0!==O&&O.effect)return O;const Q=[];this.fillDefines(Q,x);const X=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let Z=this._drawWrappers[X];Z||(Z=this._drawWrappers[X]=[]);let n=Z[x];n||(n=new xx.c(this._engine),n.drawContext&&(n.drawContext.useInstancing=this._useInstancing),Z[x]=n);const V=Q.join("\n");if(n.defines!==V){const x=[],O=[],Q=[];this.fillUniformsAttributesAndSamplerNames(O,x,Q),n.setEffect(this._engine.createEffect("particles",x,O,Q,V,void 0,void 0,void 0,void 0,this._shaderLanguage),V)}return n}animate(){var x;let O,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Q&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Q?this.preWarmStepOffset:(null===(x=this._scene)||void 0===x?void 0:x.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let x=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;S.GetCurrentGradient(O,this._emitRateGradients,((O,Q,X)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Q.getFactor(),this._currentEmitRateGradient=O),x=(0,C.Lerp)(this._currentEmitRate1,this._currentEmitRate2,X)}))}O=x*this._scaledUpdateSpeed|0,this._newPartsExcess+=x*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Q){let x=0;for(let O=0;O<this.zL.length;O++){const Q=this.zL[O];this._appendParticleVertices(x,Q),x+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.zL.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(x,O){this._appendParticleVertex(x++,O,0,0),this._useInstancing||(this._appendParticleVertex(x++,O,1,0),this._appendParticleVertex(x++,O,1,1),this._appendParticleVertex(x++,O,0,1))}rebuild(){var x;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(x=this._spriteBuffer)||void 0===x||x._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Tx.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Q.bind(Q,12447)),Promise.resolve().then(Q.bind(Q,12393))])):await Promise.all([Promise.resolve().then(Q.bind(Q,12382)),Promise.resolve().then(Q.bind(Q,12370))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==l.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(l.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(l.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(x){const O=this._getWrapper(x),Q=O.effect,Z=this._engine;Z.enableEffect(O);const n=this.defaultViewMatrix??this._scene.getViewMatrix();if(Q.setTexture("diffuseSampler",this.particleTexture),Q.setMatrix("view",n),Q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const x=this.particleTexture.getBaseSize();Q.setFloat3("particlesInfos",this.spriteCellWidth/x.width,this.spriteCellHeight/x.height,this.spriteCellWidth/x.width)}if(Q.setVector2("translationPivot",this.translationPivot),Q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const x=this._scene.activeCamera;Q.setVector3("eyePosition",x.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Q.setTexture("rampSampler",this._rampGradientsTexture));const V=Q.defines;var o,l,C,U,L,h;(this._scene&&((0,Ox.f)(Q,this,this._scene),this.applyFog&&(0,Qx.i)(this._scene,void 0,Q)),V.indexOf("#define BILLBOARDMODE_ALL")>=0&&(n.invertToRef(X.j.Matrix[0]),Q.setMatrix("invView",X.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?Z.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?Z.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Q):Z.bindBuffers(this._vertexBuffers,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null,Q);(this.useLogarithmicDepth&&this._scene&&(0,Qx.o)(V,Q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Q),this._setEngineBasedOnBlendMode(x),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Q),this._useInstancing)?null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?Z.drawElementsType(6,0,10,this.zL.length):Z.drawArraysType(7,0,4,this.zL.length):null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?Z.drawElementsType(1,0,10*this.zL.length):Z.drawElementsType(0,0,6*this.zL.length);return this.zL.length}render(){if(!this.isReady()||!this.zL.length)return 0;const x=this._engine;x.setState&&(x.setState(!1),this.forceDepthWrite&&x.setDepthWrite(!0));let O=0;return O=this.blendMode===l.BLENDMODE_MULTIPLYADD?this._render(l.BLENDMODE_MULTIPLY)+this._render(l.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),x&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),x&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,Q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const x=this._scene.fL.indexOf(this);x>-1&&this._scene.fL.splice(x,1),this._scene._activeParticleSystems.dispose()}this.no.notifyObservers(this),this.no.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Tx.ForceGLSL=!1;var ex,Bx=Q(10919);!function(x){x[x.ATTACHED=0]="ATTACHED",x[x.END=1]="END"}(ex||(ex={}));class ix{constructor(x){if(this.particleSystem=x,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!x.i||!x.i.dispose){const O=(0,o.b)("BABYLON.AbstractMesh");x.i=new O("SubemitterSystemEmitter",x.kx()),x._disposeEmitterOnDispose=!0}}clone(){let x=this.particleSystem.i;if(x){if(x instanceof X.n)x=x.clone();else if(-1!==x.getClassName().indexOf("Mesh")){x=new((0,o.b)("BABYLON.Mesh"))("",x.kx()),x.isVisible=!1}}else x=new X.n;const O=new ix(this.particleSystem.clone(this.particleSystem.name,x));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(x),O}static _ParseParticleSystem(x,O,Q){throw(0,Bx.b)("ParseParticle")}static Parse(x,O,Q){const X=x.particleSystem,Z=new ix(ix._ParseParticleSystem(X,O,Q,!0));return Z.type=x.type,Z.inheritDirection=x.inheritDirection,Z.inheritedVelocityAmount=x.inheritedVelocityAmount,Z.particleSystem._isSubEmitter=!0,Z}dispose(){this.particleSystem.dispose()}}var Hx=Q(10970);function Sx(x,O){const Q=new Y;return Q.direction1=x,Q.direction2=O,Q}function px(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Px(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function mx(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0);return new v(x,O,Q)}function wx(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function xO(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0);return new K(x,O,Q,Z,n)}function OO(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new h(x,O)}function QO(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0);return new N(x,O,Q,Z)}const XO=X.n.Zero(),ZO=X.n.Zero(),nO=X.n.Zero();class VO{constructor(){this.strength=0,this.position=X.n.Zero()}_processParticle(x,O){this.position.subtractToRef(x.position,XO);const Q=XO.lengthSquared()+1;XO.normalize().scaleToRef(this.strength/Q,ZO),ZO.scaleToRef(O._tempScaledUpdateSpeed,nO),x.direction.addInPlace(nO)}serialize(){return{position:this.position.mV(),strength:this.strength}}}class oO extends Tx{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=x=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);for(const Q of this._subEmitters[O])if(1===Q.type){const O=Q.clone();x._inheritParticleInfoToSubEmitter(O),O.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(O.particleSystem),O.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(x,O){const Q=Sx(x,O);return this.particleEmitterType=Q,Q}get flowMap(){return this._flowMap}set flowMap(x){this._flowMap!==x&&(this._flowMap=x,this._flowMapUpdate&&(jx(this._flowMapUpdate),this._flowMapUpdate=null),x&&(this._flowMapUpdate={process:x=>{var O;const Q=null===(O=this.kx())||void 0===O?void 0:O.getTransformMatrix();this._flowMap._processParticle(x,this.flowMapStrength*this._tempScaledUpdateSpeed,Q)},previousItem:null,nextItem:null},Ix(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(x){this._attractors.push(x),1===this._attractors.length&&(this._attractorUpdate={process:x=>{for(const O of this._attractors)O._processParticle(x,this)},previousItem:null,nextItem:null},Ix(this._attractorUpdate,this._directionProcessing))}removeAttractor(x){const O=this._attractors.indexOf(x);-1!==O&&this._attractors.splice(O,1),0===this._attractors.length&&jx(this._attractorUpdate)}start(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(x)}createHemisphericEmitter(){const x=px(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=x,x}createSphereEmitter(){const x=Px(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=x,x}createDirectedSphereEmitter(){const x=mx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0));return this.particleEmitterType=x,x}createCylinderEmitter(){const x=wx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=x,x}createDirectedCylinderEmitter(){const x=xO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0));return this.particleEmitterType=x,x}createConeEmitter(){const x=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=x,x}createDirectedConeEmitter(){const x=QO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0));return this.particleEmitterType=x,x}createBoxEmitter(x,O,Q,X){const Z=new L;return this.particleEmitterType=Z,this.direction1=x,this.direction2=O,this.minEmitBox=Q,this.maxEmitBox=X,Z}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const x of this.subEmitters)x instanceof oO?this._subEmitters.push([new ix(x)]):x instanceof ix?this._subEmitters.push([x]):x instanceof Array&&this._subEmitters.push(x)}_stopSubEmitters(){if(this.activeSubSystems){for(const x of this.activeSubSystems)x.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const x=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==x&&this._rootParticleSystem.activeSubSystems.splice(x,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(x){x&&this._stopSubEmitters()}_prepareParticle(x){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];x._attachedSubEmitters=[];for(const Q of O)if(0===Q.type){const O=Q.clone();x._attachedSubEmitters.push(O),O.particleSystem.start()}}}_onDispose(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),x&&this.particles)for(const Q of this.particles)if(Q._attachedSubEmitters)for(let x=Q._attachedSubEmitters.length-1;x>=0;x-=1)Q._attachedSubEmitters[x].dispose();if(O&&this.activeSubSystems)for(let Q=this.activeSubSystems.length-1;Q>=0;Q-=1)this.activeSubSystems[Q].dispose();if(this._subEmitters&&this._subEmitters.length){for(let x=0;x<this._subEmitters.length;x++)for(const O of this._subEmitters[x])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.i&&this.i.dispose&&this.i.dispose(!0)}static _Parse(x,O,Q,Z){let n;n=Q instanceof Hx.c?null:Q;const l=(0,o.b)("BABYLON.Texture");if(l&&n&&(x.texture?O.particleTexture=l.Parse(x.texture,n,Z):x.textureName&&(O.particleTexture=new l(Z+x.textureName,n,!1,void 0===x.invertY||x.invertY),O.particleTexture.name=x.textureName)),x.emitterId||0===x.emitterId||void 0!==x.i?x.emitterId&&n?O.i=n.getLastMeshById(x.emitterId):O.i=X.n.Xo(x.i):O.i=X.n.Zero(),O.isLocal=!!x.isLocal,void 0!==x.renderingGroupId&&(O.renderingGroupId=x.renderingGroupId),void 0!==x.isBillboardBased&&(O.isBillboardBased=x.isBillboardBased),void 0!==x.billboardMode&&(O.billboardMode=x.billboardMode),void 0!==x.useLogarithmicDepth&&(O.useLogarithmicDepth=x.useLogarithmicDepth),x.animations){for(let Q=0;Q<x.animations.length;Q++){const X=x.animations[Q],Z=(0,o.b)("BABYLON.Animation");Z&&O.animations.push(Z.Parse(X))}O.beginAnimationOnStart=x.beginAnimationOnStart,O.beginAnimationFrom=x.beginAnimationFrom,O.beginAnimationTo=x.beginAnimationTo,O.beginAnimationLoop=x.beginAnimationLoop}if(x.autoAnimate&&n&&n.beginAnimation(O,x.autoAnimateFrom,x.autoAnimateTo,x.autoAnimateLoop,x.autoAnimateSpeed||1),O.startDelay=0|x.startDelay,O.minAngularSpeed=x.minAngularSpeed,O.maxAngularSpeed=x.maxAngularSpeed,O.minSize=x.minSize,O.maxSize=x.maxSize,x.minScaleX&&(O.minScaleX=x.minScaleX,O.maxScaleX=x.maxScaleX,O.minScaleY=x.minScaleY,O.maxScaleY=x.maxScaleY),void 0!==x.preWarmCycles&&(O.preWarmCycles=x.preWarmCycles,O.preWarmStepOffset=x.preWarmStepOffset),void 0!==x.minInitialRotation&&(O.minInitialRotation=x.minInitialRotation,O.maxInitialRotation=x.maxInitialRotation),O.minLifeTime=x.minLifeTime,O.maxLifeTime=x.maxLifeTime,O.minEmitPower=x.minEmitPower,O.maxEmitPower=x.maxEmitPower,O.emitRate=x.emitRate,O.gravity=X.n.Xo(x.gravity),x.noiseStrength&&(O.noiseStrength=X.n.Xo(x.noiseStrength)),O.color1=V.h.Xo(x.color1),O.color2=V.h.Xo(x.color2),O.colorDead=V.h.Xo(x.colorDead),O.updateSpeed=x.updateSpeed,O.targetStopDuration=x.targetStopDuration,O.blendMode=x.blendMode,x.colorGradients)for(const X of x.colorGradients)O.addColorGradient(X.gradient,V.h.Xo(X.color1),X.color2?V.h.Xo(X.color2):void 0);if(x.rampGradients){for(const Q of x.rampGradients)O.addRampGradient(Q.gradient,V.d.Xo(Q.color));O.useRampGradients=x.useRampGradients}if(x.colorRemapGradients)for(const X of x.colorRemapGradients)O.addColorRemapGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.alphaRemapGradients)for(const X of x.alphaRemapGradients)O.addAlphaRemapGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.sizeGradients)for(const X of x.sizeGradients)O.addSizeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.angularSpeedGradients)for(const X of x.angularSpeedGradients)O.addAngularSpeedGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.velocityGradients)for(const X of x.velocityGradients)O.addVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.dragGradients)for(const X of x.dragGradients)O.addDragGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.emitRateGradients)for(const X of x.emitRateGradients)O.addEmitRateGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.startSizeGradients)for(const X of x.startSizeGradients)O.addStartSizeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.lifeTimeGradients)for(const X of x.lifeTimeGradients)O.addLifeTimeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(x.limitVelocityGradients){for(const Q of x.limitVelocityGradients)O.addLimitVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);O.limitVelocityDamping=x.limitVelocityDamping}if(x.noiseTexture&&n){const Q=(0,o.b)("BABYLON.ProceduralTexture");O.noiseTexture=Q.Parse(x.noiseTexture,n,Z)}let C;if(x.particleEmitterType){switch(x.particleEmitterType.type){case"SphereParticleEmitter":C=new g;break;case"SphereDirectedParticleEmitter":C=new v;break;case"ConeEmitter":case"ConeParticleEmitter":C=new h;break;case"ConeDirectedParticleEmitter":C=new N;break;case"CylinderParticleEmitter":C=new a;break;case"CylinderDirectedParticleEmitter":C=new K;break;case"HemisphericParticleEmitter":C=new M;break;case"PointParticleEmitter":C=new Y;break;case"MeshParticleEmitter":C=new q;break;case"CustomParticleEmitter":C=new R;break;default:C=new L}C.parse(x.particleEmitterType,n)}else C=new L,C.parse(x,n);O.particleEmitterType=C,O.startSpriteCellID=x.startSpriteCellID,O.endSpriteCellID=x.endSpriteCellID,O.spriteCellLoop=x.spriteCellLoop??!0,O.spriteCellWidth=x.spriteCellWidth,O.spriteCellHeight=x.spriteCellHeight,O.spriteCellChangeSpeed=x.spriteCellChangeSpeed,O.spriteRandomStartCell=x.spriteRandomStartCell,O.disposeOnStop=x.disposeOnStop??!1,O.manualEmitCount=x.manualEmitCount??-1}static Parse(x,O,Q){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0;const o=x.name;let l,C,U=null,L=null;if(O instanceof Hx.c?l=O:(C=O,l=C.getEngine()),x.customShader&&l.createEffectForParticles){L=x.customShader;const O=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";U=l.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,O)}const h=new oO(o,n||x.kV,O,U,x.isAnimationSheetEnabled);if(h.customShader=L,h._rootUrl=Q,x.id&&(h.id=x.id),x.subEmitters){h.subEmitters=[];for(const X of x.subEmitters){const x=[];for(const Z of X)x.push(ix.Parse(Z,O,Q));h.subEmitters.push(x)}}if(x.attractors)for(const V of x.attractors){const x=new VO;x.position=X.n.Xo(V.position),x.strength=V.strength,h.addAttractor(x)}return oO._Parse(x,h,O,Q),x.textureMask&&(h.textureMask=V.h.Xo(x.textureMask)),x.ml&&(h.ml=X.n.Xo(x.ml)),x.preventAutoStart&&(h.preventAutoStart=x.preventAutoStart),Z||h.preventAutoStart||h.start(),h}serialize(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(oO._Serialize(O,this,x),O.textureMask=this.textureMask.mV(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.ml=this.ml.mV(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Q of this._subEmitters){const X=[];for(const O of Q)X.push(O.serialize(x));O.subEmitters.push(X)}}if(this._attractors&&this._attractors.length){O.attractors=[];for(const x of this._attractors)O.attractors.push(x.serialize())}return O}static _Serialize(x,O,Q){if(x.name=O.name,x.id=O.id,x.kV=O.getCapacity(),x.disposeOnStop=O.disposeOnStop,x.manualEmitCount=O.manualEmitCount,O.i.position){const Q=O.i;x.emitterId=Q.id}else{const Q=O.i;x.i=Q.mV()}O.particleEmitterType&&(x.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(Q?x.texture=O.particleTexture.serialize():(x.textureName=O.particleTexture.name,x.invertY=!!O.particleTexture._invertY)),x.isLocal=O.isLocal,E.c.AppendSerializedAnimations(O,x),x.beginAnimationOnStart=O.beginAnimationOnStart,x.beginAnimationFrom=O.beginAnimationFrom,x.beginAnimationTo=O.beginAnimationTo,x.beginAnimationLoop=O.beginAnimationLoop,x.startDelay=O.startDelay,x.renderingGroupId=O.renderingGroupId,x.isBillboardBased=O.isBillboardBased,x.billboardMode=O.billboardMode,x.minAngularSpeed=O.minAngularSpeed,x.maxAngularSpeed=O.maxAngularSpeed,x.minSize=O.minSize,x.maxSize=O.maxSize,x.minScaleX=O.minScaleX,x.maxScaleX=O.maxScaleX,x.minScaleY=O.minScaleY,x.maxScaleY=O.maxScaleY,x.minEmitPower=O.minEmitPower,x.maxEmitPower=O.maxEmitPower,x.minLifeTime=O.minLifeTime,x.maxLifeTime=O.maxLifeTime,x.emitRate=O.emitRate,x.gravity=O.gravity.mV(),x.noiseStrength=O.noiseStrength.mV(),x.color1=O.color1.mV(),x.color2=O.color2.mV(),x.colorDead=O.colorDead.mV(),x.updateSpeed=O.updateSpeed,x.targetStopDuration=O.targetStopDuration,x.blendMode=O.blendMode,x.preWarmCycles=O.preWarmCycles,x.preWarmStepOffset=O.preWarmStepOffset,x.minInitialRotation=O.minInitialRotation,x.maxInitialRotation=O.maxInitialRotation,x.startSpriteCellID=O.startSpriteCellID,x.spriteCellLoop=O.spriteCellLoop,x.endSpriteCellID=O.endSpriteCellID,x.spriteCellChangeSpeed=O.spriteCellChangeSpeed,x.spriteCellWidth=O.spriteCellWidth,x.spriteCellHeight=O.spriteCellHeight,x.spriteRandomStartCell=O.spriteRandomStartCell,x.isAnimationSheetEnabled=O.isAnimationSheetEnabled,x.useLogarithmicDepth=O.useLogarithmicDepth;const X=O.getColorGradients();if(X){x.colorGradients=[];for(const O of X){const Q={gradient:O.gradient,color1:O.color1.mV()};O.color2?Q.color2=O.color2.mV():Q.color2=O.color1.mV(),x.colorGradients.push(Q)}}const Z=O.getRampGradients();if(Z){x.rampGradients=[];for(const O of Z){const Q={gradient:O.gradient,color:O.color.mV()};x.rampGradients.push(Q)}x.useRampGradients=O.useRampGradients}const n=O.getColorRemapGradients();if(n){x.colorRemapGradients=[];for(const O of n){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.colorRemapGradients.push(Q)}}const V=O.getAlphaRemapGradients();if(V){x.alphaRemapGradients=[];for(const O of V){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.alphaRemapGradients.push(Q)}}const o=O.getSizeGradients();if(o){x.sizeGradients=[];for(const O of o){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.sizeGradients.push(Q)}}const l=O.getAngularSpeedGradients();if(l){x.angularSpeedGradients=[];for(const O of l){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.angularSpeedGradients.push(Q)}}const C=O.getVelocityGradients();if(C){x.velocityGradients=[];for(const O of C){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.velocityGradients.push(Q)}}const U=O.getDragGradients();if(U){x.dragGradients=[];for(const O of U){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.dragGradients.push(Q)}}const L=O.getEmitRateGradients();if(L){x.emitRateGradients=[];for(const O of L){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.emitRateGradients.push(Q)}}const h=O.getStartSizeGradients();if(h){x.startSizeGradients=[];for(const O of h){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.startSizeGradients.push(Q)}}const N=O.getLifeTimeGradients();if(N){x.lifeTimeGradients=[];for(const O of N){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.lifeTimeGradients.push(Q)}}const a=O.getLimitVelocityGradients();if(a){x.limitVelocityGradients=[];for(const O of a){const Q={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Q.factor2=O.factor2:Q.factor2=O.factor1,x.limitVelocityGradients.push(Q)}x.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(x.noiseTexture=O.noiseTexture.serialize())}clone(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X={...this._customWrappers};let Z=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){Z=this.customShader;const x=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"",O=n.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,x);X[0]?X[0].effect=O:this.setCustomEffect(O,0)}const V=this.serialize(Q),o=oO.Parse(V,this._scene||this._engine,this._rootUrl);return o.name=x,o.customShader=Z,o._customWrappers=X,void 0===O&&(O=this.i),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.i=O,this.preventAutoStart||o.start(),o}}oO.BILLBOARDMODE_Y=2,oO.BILLBOARDMODE_ALL=7,oO.BILLBOARDMODE_STRETCHED=8,oO.BILLBOARDMODE_STRETCHED_LOCAL=9,ix._ParseParticleSystem=oO.Parse;var lO=Q(11427),CO=Q(11423),UO=Q(11244);UO.b.prototype.createTransformFeedback=function(){const x=this._gl.createTransformFeedback();if(!x)throw new Error("Unable to create Transform Feedback");return x},UO.b.prototype.deleteTransformFeedback=function(x){this._gl.deleteTransformFeedback(x)},UO.b.prototype.bindTransformFeedback=function(x){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,x)},UO.b.prototype.beginTransformFeedback=function(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(x?this._gl.POINTS:this._gl.TRIANGLES)},UO.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},UO.b.prototype.setTranformFeedbackVaryings=function(x,O){this._gl.transformFeedbackVaryings(x,O,this._gl.INTERLEAVED_ATTRIBS)},UO.b.prototype.bindTransformFeedbackBuffer=function(x){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,x?x.underlyingResource:null)},UO.b.prototype.readTransformFeedbackBuffer=function(x){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,x)};const LO="clipPlaneFragmentDeclaration2",hO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";k.e.IncludesShadersStore[LO]||(k.e.IncludesShadersStore[LO]=hO);Q(12278),Q(12284),Q(12286),Q(12289),Q(12298),Q(12304),Q(12312),Q(12320);const NO="gpuRenderParticlesPixelShader",aO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";k.e.ShadersStore[NO]||(k.e.ShadersStore[NO]=aO);const KO="clipPlaneVertexDeclaration2",MO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";k.e.IncludesShadersStore[KO]||(k.e.IncludesShadersStore[KO]=MO);Q(12322),Q(12331),Q(12340),Q(12345);const YO="gpuRenderParticlesVertexShader",gO="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";k.e.ShadersStore[YO]||(k.e.ShadersStore[YO]=gO);class vO extends l{static get IsSupported(){if(!m.c.LastCreatedEngine)return!1;const x=m.c.LastCreatedEngine.getCaps();return x.supportTransformFeedbacks||x.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(x){this._maxActiveParticleCount=Math.min(x,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(x){this.maxActiveParticleCount=x}createPointEmitter(x,O){const Q=Sx(x,O);return this.particleEmitterType=Q,Q}createHemisphericEmitter(){const x=px(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=x,x}createSphereEmitter(){const x=Px(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=x,x}createDirectedSphereEmitter(){const x=mx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0));return this.particleEmitterType=x,x}createCylinderEmitter(){const x=wx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=x,x}createDirectedCylinderEmitter(){const x=xO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0));return this.particleEmitterType=x,x}createConeEmitter(){const x=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=x,x}createDirectedConeEmitter(){const x=QO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0));return this.particleEmitterType=x,x}createBoxEmitter(x,O,Q,X){const Z=new L;return this.particleEmitterType=Z,this.direction1=x,this.direction2=O,this.minEmitBox=Q,this.maxEmitBox=X,Z}get flowMap(){return this._flowMap}set flowMap(x){this._flowMap!==x&&(this._flowMap=x)}isReady(){if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==oO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(oO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(oO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";x?setTimeout((()=>{this.start(0)}),x):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var x;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(x=this._customWrappers[O])||void 0===x?void 0:x.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[x]??this._customWrappers[0]}setCustomEffect(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new xx.c(this._engine),this._customWrappers[O].effect=x}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(x,O,Q){return super._removeGradientAndTexture(x,O,Q),this._releaseBuffers(),this}addColorGradient(x,O){this._colorGradients||(this._colorGradients=[]);const Q=new B(x,O);return this._colorGradients.push(Q),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(x&&this._colorGradients.sort(((x,O)=>x.gradient<O.gradient?-1:x.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(x){return this._removeGradientAndTexture(x,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var x;null===(x=this._drawWrappers[O].drawContext)||void 0===x||x.reset()}}_addFactorGradient(x,O,Q){const X=new H(O,Q);x.push(X),this._releaseBuffers()}addSizeGradient(x,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,x,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(x){return this._removeGradientAndTexture(x,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(x,O){if(!x)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&x.sort(((x,O)=>x.gradient<O.gradient?-1:x.gradient>O.gradient?1:0));const Q=this;Q[O]&&(Q[O].dispose(),Q[O]=null)}addAngularSpeedGradient(x,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,x,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(x){return this._removeGradientAndTexture(x,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(x,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,x,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(x){return this._removeGradientAndTexture(x,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(x,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,x,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(x){return this._removeGradientAndTexture(x,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(x,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,x,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(x){return this._removeGradientAndTexture(x,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(x){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(x,O,Q){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(x),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.no=new p.b,this.onStoppedObservable=new p.b,this.onStartedObservable=new p.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=X.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||m.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fL.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,o.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,o.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,o.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,o.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new xx.c(this._engine)},this._customWrappers[0].effect=Z,this._drawWrappers={0:new xx.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const V={kV:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},l=O;isFinite(l)&&(V.kV=l),this._capacity=V.kV,this._maxActiveParticleCount=V.kV,this._currentActiveCount=0,this._isAnimationSheetEnabled=n,this.particleEmitterType=new L;const C=Math.min(this._engine.getCaps().maxTextureSize,V.randomTextureSize);let U=[];for(let X=0;X<C;++X)U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random());this._randomTexture=new P.b(new Float32Array(U),C,1,5,Q,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,U=[];for(let X=0;X<C;++X)U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random());this._randomTexture2=new P.b(new Float32Array(U),C,1,5,Q,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(x,O,Q){const X={};X.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let Z=3;X.age=O.createVertexBuffer("age",Z,1,this._attributesStrideSize,!0),Z+=1,X.size=O.createVertexBuffer("size",Z,3,this._attributesStrideSize,!0),Z+=3,X.life=O.createVertexBuffer("life",Z,1,this._attributesStrideSize,!0),Z+=1,Z+=4,this.billboardMode===oO.BILLBOARDMODE_STRETCHED&&(X.direction=O.createVertexBuffer("direction",Z,3,this._attributesStrideSize,!0)),Z+=3,this._platform.alignDataInBuffer&&(Z+=1),this.particleEmitterType instanceof R&&(Z+=3,this._platform.alignDataInBuffer&&(Z+=1)),this._colorGradientsTexture||(X.color=O.createVertexBuffer("color",Z,4,this._attributesStrideSize,!0),Z+=4),this._isBillboardBased||(X.initialDirection=O.createVertexBuffer("initialDirection",Z,3,this._attributesStrideSize,!0),Z+=3,this._platform.alignDataInBuffer&&(Z+=1)),this.noiseTexture&&(X.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",Z,3,this._attributesStrideSize,!0),Z+=3,this._platform.alignDataInBuffer&&(Z+=1),X.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",Z,3,this._attributesStrideSize,!0),Z+=3,this._platform.alignDataInBuffer&&(Z+=1)),X.angle=O.createVertexBuffer("angle",Z,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?Z++:Z+=2,this._isAnimationSheetEnabled&&(X.cellIndex=O.createVertexBuffer("cellIndex",Z,1,this._attributesStrideSize,!0),Z+=1,this.spriteRandomStartCell&&(X.cellStartOffset=O.createVertexBuffer("cellStartOffset",Z,1,this._attributesStrideSize,!0),Z+=1)),X.offset=Q.createVertexBuffer("offset",0,2),X.uv=Q.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(X),this._platform.createVertexBuffers(x,X),this.resetDrawCache()}_initialize(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!x)return;const O=this._engine,Q=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof R&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const Z=this.particleEmitterType instanceof R,n=X.j.Oo[0];let V=0;for(let X=0;X<this._capacity;X++)if(Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),Z?(this.particleEmitterType.particleDestinationGenerator(X,null,n),Q.push(n.x),Q.push(n.y),Q.push(n.z)):(Q.push(0),Q.push(0),Q.push(0)),this._platform.alignDataInBuffer&&Q.push(0),V+=16,Z&&(this.particleEmitterType.particlePositionGenerator(X,null,n),Q.push(n.x),Q.push(n.y),Q.push(n.z),this._platform.alignDataInBuffer&&Q.push(0),V+=4),this._colorGradientsTexture||(Q.push(0),Q.push(0),Q.push(0),Q.push(0),V+=4),this.isBillboardBased||(Q.push(0),Q.push(0),Q.push(0),this._platform.alignDataInBuffer&&Q.push(0),V+=4),this.noiseTexture&&(Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),V+=8),Q.push(0),V+=1,this._angularSpeedGradientsTexture||(Q.push(0),V+=1),this._isAnimationSheetEnabled&&(Q.push(0),V+=1,this.spriteRandomStartCell&&(Q.push(0),V+=1)),this._platform.alignDataInBuffer){let x=3-(V+3&3);for(V+=x;x-- >0;)Q.push(0)}const o=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),l=this._platform.createParticleBuffer(Q),C=this._platform.createParticleBuffer(Q);this._buffer0=new s.c(O,l,!1,this._attributesStrideSize),this._buffer1=new s.c(O,C,!1,this._attributesStrideSize),this._spriteBuffer=new s.c(O,o,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let x=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(x+="\n#define BILLBOARD"),this._colorGradientsTexture&&(x+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(x+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(x+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(x+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(x+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(x+="\n#define DRAGGRADIENTS"),this._flowMap&&(x+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(x+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(x+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(x+="\n#define NOISE"),this.isLocal&&(x+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===x||(this._cachedUpdateDefines=x,this._updateBuffer=this._platform.createUpdateBuffer(x)),this._platform.isUpdateBufferReady()}_getWrapper(x){const O=this._getCustomDrawWrapper(x);if(null!==O&&void 0!==O&&O.effect)return O;const Q=[];this.fillDefines(Q,x);let X=this._drawWrappers[x];X||(X=new xx.c(this._engine),X.drawContext&&(X.drawContext.useInstancing=!0),this._drawWrappers[x]=X);const Z=Q.join("\n");if(X.defines!==Z){const x=[],O=[],Q=[];this.fillUniformsAttributesAndSamplerNames(O,x,Q),X.setEffect(this._engine.createEffect("gpuRenderParticles",x,O,Q,Z),Z)}return X}static _GetAttributeNamesOrOptions(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Z=[s.g.PositionKind,"age","life","size","angle"];return x||Z.push(s.g.ColorKind),O&&Z.push("cellIndex"),Q||Z.push("initialDirection"),X&&Z.push("direction"),Z.push("offset",s.g.UVKind),Z}static _GetEffectCreationOptions(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=["emitterWM","ml","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Ox.d)(X),x&&X.push("sheetInfos"),O&&X.push("logarithmicDepthConstant"),Q&&(X.push("vFogInfos"),X.push("vFogColor")),X}fillDefines(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ox.i)(this,this._scene,x),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==CO.d.FOGMODE_NONE&&x.push("#define FOG")),O===oO.BLENDMODE_MULTIPLY&&x.push("#define BLENDMULTIPLYMODE"),this.isLocal&&x.push("#define LOCAL"),this.useLogarithmicDepth&&x.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(x.push("#define BILLBOARD"),this.billboardMode){case oO.BILLBOARDMODE_Y:x.push("#define BILLBOARDY");break;case oO.BILLBOARDMODE_STRETCHED:x.push("#define BILLBOARDSTRETCHED");break;case oO.BILLBOARDMODE_ALL:x.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&x.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&x.push("#define ANIMATESHEET"),Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),x.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(x,O,Q){O.push(...vO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===oO.BILLBOARDMODE_STRETCHED)),x.push(...vO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(lO.d.PrepareUniforms(x,this._imageProcessingConfigurationDefines),lO.d.PrepareSamplers(Q,this._imageProcessingConfigurationDefines))}animate(){var x;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(x=this._scene)||void 0===x?void 0:x.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(x,O){const Q=this[O];if(!x||!x.length||Q)return;const X=new Float32Array(this._rawTextureWidth);for(let Z=0;Z<this._rawTextureWidth;Z++){const O=Z/this._rawTextureWidth;S.GetCurrentGradient(O,x,((x,O,Q)=>{X[Z]=(0,C.Lerp)(x.factor1,O.factor1,Q)}))}this[O]=P.b.CreateRTexture(X,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const x=new Uint8Array(4*this._rawTextureWidth),O=V.i.nh[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const X=Q/this._rawTextureWidth;S.GetCurrentGradient(X,this._colorGradients,((X,Z,n)=>{V.h.LerpToRef(X.color1,Z.color1,n,O),x[4*Q]=255*O.r,x[4*Q+1]=255*O.g,x[4*Q+2]=255*O.b,x[4*Q+3]=255*O.a}))}this._colorGradientsTexture=P.b.CreateRGBATexture(x,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(x,O){var Q,Z,n,V;const o=this._getWrapper(x),l=o.effect;this._engine.enableEffect(o);const C=(null===(Q=this._scene)||void 0===Q?void 0:Q.getViewMatrix())||X.c.IdentityReadOnly;if(l.setMatrix("view",C),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),l.setTexture("diffuseSampler",this.particleTexture),l.setVector2("translationPivot",this.translationPivot),l.setVector3("ml",this.ml),this.isLocal&&l.setMatrix("emitterWM",O),this._colorGradientsTexture?l.setTexture("colorGradientSampler",this._colorGradientsTexture):l.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const x=this.particleTexture.getBaseSize();l.setFloat3("sheetInfos",this.spriteCellWidth/x.width,this.spriteCellHeight/x.height,x.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const x=this._scene.activeCamera;l.setVector3("eyePosition",x.globalPosition)}const U=l.defines;if(this._scene&&((0,Ox.f)(l,this,this._scene),this.applyFog&&(0,Qx.i)(this._scene,void 0,l)),U.indexOf("#define BILLBOARDMODE_ALL")>=0){const x=C.clone();x.invert(),l.setMatrix("invView",x)}return this.useLogarithmicDepth&&this._scene&&(0,Qx.o)(U,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),this._setEngineBasedOnBlendMode(x),this._platform.bindDrawBuffers(this._targetIndex,l,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(V=this._scene)&&void 0!==V&&V.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(x){if(!this.i||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!x)if(this.i.position){x=this.i.getWorldMatrix()}else{const O=this.i;x=X.j.Matrix[0],X.c.TranslationToRef(O.x,O.y,O.z,x)}const O=this._engine,Q=O.getDepthWrite();if(O.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const x=this.kx();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",x.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",x),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Z,O.setDepthWrite(Q)}render(){let x,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let x=0;x<this.preWarmCycles;x++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const x=0|this._accumulatedCount;this._accumulatedCount-=x,this._currentActiveCount+=x}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.i.position){x=this.i.getWorldMatrix()}else{const O=this.i;x=X.j.Matrix[0],X.c.TranslationToRef(O.x,O.y,O.z,x)}const Z=this._engine;this.updateInAnimate||this._update(x);let n=0;return O||Q||(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0),n=this.blendMode===oO.BLENDMODE_MULTIPLYADD?this._render(oO.BLENDMODE_MULTIPLY,x)+this._render(oO.BLENDMODE_ADD,x):this._render(this.blendMode,x),this._engine.setAlphaMode(0)),n}rebuild(){const x=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(x,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,x()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const x=this._scene.fL.indexOf(this);x>-1&&this._scene.fL.splice(x,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const x=this._renderVertexBuffers[O];for(const O in x)x[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),x&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),x&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.no.notifyObservers(this),this.no.clear()}clone(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X={...this._customWrappers};let Z=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){Z=this.customShader;const x=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"";X[0]=n.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,x,void 0,void 0,void 0,this)}const V=this.serialize(Q),o=vO.Parse(V,this._scene||this._engine,this._rootUrl);return o.name=x,o.customShader=Z,o._customWrappers=X,void 0===O&&(O=this.i),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.i=O,o}serialize(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return oO._Serialize(O,this,x),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0;const n=x.name;let V,o;O instanceof Hx.c?V=O:(o=O,V=o.getEngine());const l=new vO(n,{kV:Z||x.kV,randomTextureSize:x.randomTextureSize},O,null,x.isAnimationSheetEnabled);if(l._rootUrl=Q,x.customShader&&V.createEffectForParticles){const O=x.customShader,Q=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",X=V.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,Q,void 0,void 0,void 0,l);l.setCustomEffect(X,0),l.customShader=O}return x.id&&(l.id=x.id),x.activeParticleCount&&(l.activeParticleCount=x.activeParticleCount),oO._Parse(x,l,O,Q),x.preventAutoStart&&(l.preventAutoStart=x.preventAutoStart),X||l.preventAutoStart||l.start(),l}}var RO=Q(10894),sO=Q(12352),qO=Q(11530);class GO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(x){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.i=x;this._emitterNode=x}setEmitterAsSphere(x,O,Q){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:x,renderingGroupId:O};const X=(0,sO.b)("emitterSphere",{diameter:x.diameter,segments:x.segments},Q);X.renderingGroupId=O;const Z=new qO.d("emitterSphereMaterial",Q);Z.emissiveColor=x.color,X.material=Z;for(const n of this.systems)n.i=X;this._emitterNode=X}start(x){for(const O of this.systems)x&&(O.i=x),O.start()}dispose(){for(const x of this.systems)x.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const Q of this.systems)O.systems.push(Q.serialize(x));return this._emitterNode&&(O.i=this._emitterCreationOptions),O}static Parse(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;const Z=new GO,n=this.BaseAssetsUrl+"/textures/";O=O||m.c.LastCreatedScene;for(const V of x.systems)Z.systems.push(Q?vO.Parse(V,O,n,!0,X):oO.Parse(V,O,n,!0,X));if(x.i){const Q=x.i.options;if("Sphere"===x.i.kind)Z.setEmitterAsSphere({diameter:Q.diameter,segments:Q.segments,color:V.d.Xo(Q.color)},x.i.renderingGroupId,O)}return Z}}GO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var kO=Q(10925);class JO{static CreateDefault(x){let O,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,X=arguments.length>2?arguments[2]:void 0;O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new vO("default system",{kV:Q},X):new oO("default system",Q,X),O.i=x;const Z=RO.g.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return O.particleTexture=new z.b(Z,O.kx()),O.createConeEmitter(.1,Math.PI/4),O.color1=new V.h(1,1,1,1),O.color2=new V.h(1,1,1,1),O.colorDead=new V.h(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;O||(O=m.c.LastCreatedScene);const Z={};return O.addPendingData(Z),new Promise(((n,V)=>{if(Q&&!vO.IsSupported)return O.removePendingData(Z),V("Particle system with GPU is not supported.");RO.g.LoadFile(`${JO.BaseAssetsUrl}/systems/${x}.json`,(x=>{O.removePendingData(Z);const V=JSON.parse(x.toString());return n(GO.Parse(V,O,Q,X))}),void 0,void 0,void 0,(()=>(O.removePendingData(Z),V(`An error occurred with the creation of your particle system. Check if your type '${x}' exists.`))))}))}static ExportSet(x){const O=new GO;for(const Q of x)O.systems.push(Q);return O}static ParseFromFileAsync(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0;return new Promise(((V,o)=>{const l=new kO.e;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const O=JSON.parse(l.responseText);let o;o=X?vO.Parse(O,Q,Z,!1,n):oO.Parse(O,Q,Z,!1,n),x&&(o.name=x),V(o)}else o("Unable to load the particle system")})),l.open("GET",O),l.send()}))}static ParseFromSnippetAsync(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Z=arguments.length>4?arguments[4]:void 0;if("_BLANK"===x){const x=this.CreateDefault(null);return x.start(),Promise.resolve(x)}return new Promise(((n,V)=>{const o=new kO.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const V=JSON.parse(JSON.parse(o.responseText).jsonPayload),l=JSON.parse(V.particleSystem);let C;C=Q?vO.Parse(l,O,X,!1,Z):oO.Parse(l,O,X,!1,Z),C.snippetId=x,n(C)}else V("Unable to load the snippet "+x)})),o.open("GET",this.SnippetUrl+"/"+x.replace(/#/g,"/")),o.send()}))}}JO.BaseAssetsUrl=GO.BaseAssetsUrl,JO.SnippetUrl="https://snippet.babylonjs.com",JO.CreateFromSnippetAsync=JO.ParseFromSnippetAsync;var tO=Q(11201),cO=Q(11237),dO=Q(12354);(0,dO.f)(cO.e.NAME_PARTICLESYSTEM,((x,O,Q,X)=>{const Z=(0,dO.h)(cO.e.NAME_PARTICLESYSTEM);if(Z&&void 0!==x.fL&&null!==x.fL)for(let n=0,V=x.fL.length;n<V;n++){const V=x.fL[n];Q.fL.push(Z(V,O,X))}})),(0,dO.c)(cO.e.NAME_PARTICLESYSTEM,((x,O,Q)=>{if(x.activeParticleCount){return vO.Parse(x,O,Q)}return oO.Parse(x,O,Q)})),Hx.c.prototype.createEffectForParticles=function(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,U=arguments.length>9?arguments[9]:void 0,L=[],h=[];const N=[];return l?l.fillUniformsAttributesAndSamplerNames(h,L,N):(L=oO._GetAttributeNamesOrOptions(),h=oO._GetEffectCreationOptions()),-1===Z.indexOf(" BILLBOARD")&&(Z+="\n#define BILLBOARD\n"),null!==l&&void 0!==l&&l.isAnimationSheetEnabled&&-1===Z.indexOf(" ANIMATESHEET")&&(Z+="\n#define ANIMATESHEET\n"),-1===X.indexOf("diffuseSampler")&&X.push("diffuseSampler"),this.createEffect({vertex:U??(null===l||void 0===l?void 0:l.vertexShaderName)??"particles",fragmentElement:x},L,h.concat(O),N.concat(X),Z,n,V,o,void 0,C,(async()=>{0===C?await Promise.resolve().then(Q.bind(Q,12382)):await Promise.resolve().then(Q.bind(Q,12447))}))},tO.b.prototype.getEmittedParticleSystems=function(){const x=[];for(let O=0;O<this.kx().fL.length;O++){const Q=this.kx().fL[O];Q.i===this&&x.push(Q)}return x},tO.b.prototype.getHierarchyEmittedParticleSystems=function(){const x=[],O=this.getDescendants();O.push(this);for(let Q=0;Q<this.kx().fL.length;Q++){const X=this.kx().fL[Q],Z=X.i;Z.position&&-1!==O.indexOf(Z)&&x.push(X)}return x};Q(11088),Q(11094),Q(11172);Q(11179),Q(12357),Q(11189),Q(11053),Q(11235);Q(11306);var uO;Q(12359),Q(11323);!function(x){x[x.Color=2]="Color",x[x.UV=1]="UV",x[x.Random=0]="Random",x[x.Stated=3]="Stated"}(uO||(uO={}));var AO=Q(11332);const fO=new X.n(0,0,0),EO=new X.n(0,0,0),zO=new X.n(0,0,0);class FO{constructor(x,O,Q){this.width=x,this.height=O,this.data=Q}processFlowable(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2?arguments[2]:void 0;if(!Q)return;Q instanceof X.c?X.n.TransformCoordinatesToRef(x.position,Q,zO):(zO.x=Q.x,zO.y=Q.y,zO.z=Q.z);const Z=.5*zO.x+.5,n=1-(.5*zO.y+.5),V=Math.floor(Z*this.width),o=Math.floor(n*this.height);if(V<0||V>=this.width||o<0||o>=this.height)return;const l=4*(o*this.width+V),C=this.data[l]/255*2-1,U=this.data[l+1]/255*2-1,L=this.data[l+2]/255*2-1,h=this.data[l+3]/255;fO.set(C,U,L),fO.scaleToRef(O*h,EO),x.direction.addInPlace(EO)}_processParticle(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2?arguments[2]:void 0;this.processFlowable(x,O,Q)}static async FromUrlAsync(x){return await new Promise(((O,Q)=>{const X=document.createElement("canvas"),Z=X.getContext("2d");let n=null;const V=new Image;V.crossOrigin="anonymous",V.src=x,V.onerror=O=>{Q(new Error(`Failed to load image: ${x} : ${O}`))},V.onload=()=>{X.width=V.width,X.height=V.height,Z.drawImage(V,0,0),n=Z.getImageData(0,0,X.width,X.height),O(new FO(X.width,X.height,n.data))}}))}static async ExtractFromTextureAsync(x){return await new Promise(((O,Q)=>{if(!x.isReady())return void x.onLoadObservable.addOnce((async()=>{try{const Q=await this.ExtractFromTextureAsync(x);O(Q)}catch(X){Q(X)}}));const X=x.getSize();AO.k.GetTextureDataAsync(x,X.width,X.height).then((x=>{O(new FO(X.width,X.height,new Uint8ClampedArray(x)))})).catch(Q)}))}}var bO,DO,WO,yO,IO,rO,jO,TO,eO;!function(x){x[x.Int=1]="Int",x[x.Float=2]="Float",x[x.Vector2=4]="Vector2",x[x.Oo=8]="Oo",x[x.Matrix=16]="Matrix",x[x.Particle=32]="Particle",x[x.Texture=64]="Texture",x[x.nh=128]="nh",x[x.FloatGradient=256]="FloatGradient",x[x.Vector2Gradient=512]="Vector2Gradient",x[x.Vector3Gradient=1024]="Vector3Gradient",x[x.Color4Gradient=2048]="Color4Gradient",x[x.System=4096]="System",x[x.AutoDetect=8192]="AutoDetect",x[x.BasedOnInput=16384]="BasedOnInput",x[x.Undefined=32768]="Undefined",x[x.All=65535]="All"}(bO||(bO={})),function(x){x[x.Compatible=0]="Compatible",x[x.TypeIncompatible=1]="TypeIncompatible",x[x.HierarchyIssue=2]="HierarchyIssue"}(DO||(DO={})),function(x){x[x.Input=0]="Input",x[x.Output=1]="Output"}(WO||(WO={}));class BO{get direction(){return this._direction}get type(){if(this._type===bO.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===bO.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(x){this._type=x}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((x=>x.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(x,O,Q){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=bO.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new p.b,this.onDisconnectionObservable=new p.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=O,this.name=x,this._direction=Q}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(x){var O;return this.isConnected?null!==(O=this._connectedPoint)&&void 0!==O&&O._storedFunction?this._connectedPoint._storedFunction(x):this._connectedPoint._storedValue:this.value}canConnectTo(x){return 0===this.checkCompatibilityState(x)}checkCompatibilityState(x){const O=this._ownerBlock,Q=x.ownerBlock;if(this.type!==x.type&&x.innerType!==bO.AutoDetect)return x.acceptedConnectionPointTypes&&-1!==x.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(x.excludedConnectionPointTypes&&-1!==x.excludedConnectionPointTypes.indexOf(this.type))return 1;let X=Q,Z=O;return 0===this.direction&&(X=O,Z=Q),X.isAnAncestorOf(Z)?2:0}connectTo(x){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(x))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${x.ownerBlock.name}".${x.name}`;return this._endpoints.push(x),x._connectedPoint=this,this.onConnectionObservable.notifyObservers(x),x.onConnectionObservable.notifyObservers(this),this}disconnectFrom(x){const O=this._endpoints.indexOf(x);return-1===O||(this._endpoints.splice(O,1),x._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(x),x.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(x){let O=1;for(;O<bO.All;)x&O||this.excludedConnectionPointTypes.push(O),O<<=1}serialize(){let x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O={};return O.name=this.name,O.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.mV?(O.valueType="BABYLON."+this.value.getClassName(),O.value=this.value.mV()):(O.valueType="number",O.value=this.value)),x&&this.connectedPoint&&(O.inputName=this.name,O.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,O.targetConnectionName=this.connectedPoint.name,O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),O}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class iO{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(x){this._name=x}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(x){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new p.b,this.no=new p.b,this.onInputChangedObservable=new p.b,this.visibleOnFrame=!1,this._name=x,this.uniqueId=F.e.UniqueId}_inputRename(x){return x}_outputRename(x){return x}isAnAncestorOf(x){for(const O of this._outputs)if(O.hasEndpoints)for(const Q of O.endpoints){if(Q.ownerBlock===x)return!0;if(Q.ownerBlock.isAnAncestorOf(x))return!0}return!1}isAnAncestorOfType(x){if(this.getClassName()===x)return!0;for(const O of this._outputs)if(O.hasEndpoints)for(const Q of O.endpoints)if(Q.ownerBlock.isAnAncestorOfType(x))return!0;return!1}getInputByName(x){const O=this._inputs.filter((O=>O.name===x));return O.length?O[0]:null}_linkConnectionTypes(x,O){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[O]._acceptedConnectionPointType=this._inputs[x]:(this._inputs[x]._linkedConnectionSource=this._inputs[O],this._inputs[x]._isMainLinkSource=!0),this._inputs[O]._linkedConnectionSource=this._inputs[x]}registerInput(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;const V=new BO(x,this,0);return V.type=O,V.isOptional=Q,V.defaultValue=X,V.value=X,V.valueMin=Z,V.valueMax=n,this._inputs.push(V),this.onInputChangedObservable.notifyObservers(V),this}registerOutput(x,O,Q){return(Q=Q??new BO(x,this,1)).type=O,this._outputs.push(Q),this}_build(x){}_customBuildStep(x){}build(x){if(this._buildId===x.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((x=>x.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=x.buildId;for(const O of this._inputs){if(!O.connectedPoint){O.isOptional||x.notConnectedNonOptionalInputs.push(O);continue}const Q=O.connectedPoint.ownerBlock;Q&&Q!==this&&!Q.isSystem&&Q.build(x)}return this._customBuildStep(x),x.verbose&&b.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(x),this.onBuildObservable.notifyObservers(this),!1}serialize(){const x={};x.customType="BABYLON."+this.getClassName(),x.id=this.uniqueId,x.name=this.name,x.visibleOnFrame=this.visibleOnFrame,x.inputs=[],x.outputs=[];for(const O of this.inputs)x.inputs.push(O.serialize());for(const O of this.outputs)x.outputs.push(O.serialize(!1));return x}_deserialize(x){this._name=x.name,this.comments=x.comments,this.visibleOnFrame=!!x.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(x)}_deserializePortDisplayNamesAndExposedOnFrame(x){const O=x.inputs,Q=x.outputs;if(O)for(const X of O){const x=this.inputs.find((x=>x.name===X.name));if(!x)return;if(X.displayName&&(x.displayName=X.displayName),X.isExposedOnFrame&&(x.isExposedOnFrame=X.isExposedOnFrame,x.exposedPortPosition=X.exposedPortPosition),void 0!==X.value&&null!==X.value)if("number"===X.valueType)x.value=X.value;else{const O=(0,o.b)(X.valueType);O&&(x.value=O.Xo(X.value))}}if(Q)for(let X=0;X<Q.length;X++){const x=Q[X];x.displayName&&(this.outputs[X].displayName=x.displayName),x.isExposedOnFrame&&(this.outputs[X].isExposedOnFrame=x.isExposedOnFrame,this.outputs[X].exposedPortPosition=x.exposedPortPosition)}}clone(){const x=this.serialize(),O=(0,o.b)(x.customType);if(O){const Q=new O;return Q._deserialize(x),Q}return null}dispose(){this.no.notifyObservers(this),this.no.clear();for(const x of this.inputs)x.dispose();for(const x of this.outputs)x.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function HO(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",X=arguments.length>3?arguments[3]:void 0;return(Z,n)=>{let V=Z._propStore;V||(V=[],Z._propStore=V),V.push({propertyName:n,displayName:x,type:O,groupName:Q,options:X??{},className:Z.getClassName()})}}(0,A.b)([(0,f.L)("comment")],iO.prototype,"comments",void 0),function(x){x[x.Boolean=0]="Boolean",x[x.Float=1]="Float",x[x.Int=2]="Int",x[x.Vector2=3]="Vector2",x[x.List=4]="List",x[x.nh=5]="nh",x[x.SamplingMode=6]="SamplingMode",x[x.TextureFormat=7]="TextureFormat",x[x.TextureType=8]="TextureType"}(yO||(yO={})),function(x){x[x.None=0]="None",x[x.Position=1]="Position",x[x.Direction=2]="Direction",x[x.Age=3]="Age",x[x.Lifetime=4]="Lifetime",x[x.Color=5]="Color",x[x.ScaledDirection=6]="ScaledDirection",x[x.Scale=7]="Scale",x[x.AgeGradient=8]="AgeGradient",x[x.Angle=9]="Angle",x[x.SpriteCellIndex=16]="SpriteCellIndex",x[x.SpriteCellStart=17]="SpriteCellStart",x[x.SpriteCellEnd=18]="SpriteCellEnd"}(IO||(IO={})),function(x){x[x.None=0]="None",x[x.Time=1]="Time",x[x.Delta=2]="Delta",x[x.Emitter=3]="Emitter"}(rO||(rO={}));class SO{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let x="";for(const O of this.notConnectedNonOptionalInputs)x+=`input ${O.name} from block ${O.ownerBlock.name}[${O.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(x)throw"Build of Node Particle System Set failed:\n"+x}adapt(x,O){const Q=x.getConnectedValue(this)||0;if(x.type===O)return Q;switch(O){case bO.Vector2:return new X.l(Q,Q);case bO.Oo:return new X.n(Q,Q,Q);case bO.nh:return new V.h(Q,Q,Q,Q)}return null}getContextualValue(x){if(!this.particleContext||!this.systemContext)return null;switch(x){case IO.Position:return this.particleContext.position;case IO.Direction:return this.particleContext.direction;case IO.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case IO.Color:return this.particleContext.color;case IO.Age:return this.particleContext.age;case IO.Lifetime:return this.particleContext.lifeTime;case IO.Angle:return this.particleContext.angle;case IO.Scale:return this.particleContext.scale;case IO.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case IO.SpriteCellEnd:return this.systemContext.endSpriteCellID;case IO.SpriteCellIndex:return this.particleContext.cellIndex;case IO.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.i.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.i.absolutePosition:this.systemContext.i:null}getSystemValue(x){if(!this.particleContext||!this.systemContext)return null;switch(x){case rO.Time:return this.systemContext._actualFrame;case rO.Delta:return this.systemContext._scaledUpdateSpeed;case rO.Emitter:if(this.isEmitterTransformNode){return this.systemContext.i.absolutePosition}return this.systemContext.i}return null}}function pO(x,O,Q){const X=new SO;X.RO=O;const Z=x.createSystem(X);return Z.canStart=()=>!0,Z.i=Q.clone(),Z.disposeOnStop=!0,Z.start(),Z}class PO extends iO{constructor(x){super(x),this.blendMode=l.BLENDMODE_ONEONE,this.kV=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",bO.Particle),this.registerInput("texture",bO.Texture),this.registerInput("onStart",bO.System,!0),this.registerInput("onEnd",bO.System,!0),this.registerOutput("system",bO.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(x){x.kV=this.kV,x.buildId=this._buildId++,this.build(x);const O=this.particle.getConnectedValue(x);return O.particleTexture=this.texture.getConnectedValue(x),O.emitRate=this.emitRate,O.blendMode=this.blendMode,O.name=this.name,O._nodeGenerated=!0,O._targetStopDuration=this.targetStopDuration,O.startDelay=this.startDelay,this.system._storedValue=this,O.canStart=()=>!this.doNoStart,O.onStartedObservable.add((Q=>{const X=this.onStart.getConnectedValue(x);X&&Q.onStartedObservable.addOnce((()=>{x.systemContext=O;const Q=pO(X,x.RO,x.emitterPosition);this.no.addOnce((()=>{Q.dispose()}))}));const Z=this.onEnd.getConnectedValue(x);Z&&Q.onStoppedObservable.addOnce((()=>{x.systemContext=O;const Q=pO(Z,x.RO,x.emitterPosition);this.no.addOnce((()=>{Q.dispose()}))}))})),this.no.addOnce((()=>{O.dispose()})),O}serialize(){const x=super.serialize();return x.kV=this.kV,x.emitRate=this.emitRate,x.blendMode=this.blendMode,x.doNoStart=this.doNoStart,x.targetStopDuration=this.targetStopDuration,x.startDelay=this.startDelay,x}_deserialize(x){super._deserialize(x),this.kV=x.kV,this.emitRate=x.emitRate,this.doNoStart=!!x.doNoStart,void 0!==x.blendMode&&(this.blendMode=x.blendMode),void 0!==x.targetStopDuration&&(this.targetStopDuration=x.targetStopDuration),void 0!==x.startDelay&&(this.startDelay=x.startDelay)}}(0,A.b)([HO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:l.BLENDMODE_ONEONE},{label:"Standard",value:l.BLENDMODE_STANDARD},{label:"Add",value:l.BLENDMODE_ADD},{label:"Multiply",value:l.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:l.BLENDMODE_MULTIPLYADD}]})],PO.prototype,"blendMode",void 0),(0,A.b)([HO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],PO.prototype,"kV",void 0),(0,A.b)([HO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PO.prototype,"emitRate",void 0),(0,A.b)([HO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PO.prototype,"targetStopDuration",void 0),(0,A.b)([HO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PO.prototype,"startDelay",void 0),(0,A.b)([HO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],PO.prototype,"doNoStart",void 0),(0,o.d)("BABYLON.SystemBlock",PO);class mO extends iO{get type(){if(this._type===bO.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=bO.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=bO.Vector2,this._type;case"Oo":return this._type=bO.Oo,this._type;case"nh":return this._type=bO.nh,this._type;case"Matrix":return this._type=bO.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===IO.None&&this._systemSource!==rO.None}get systemSource(){return this._systemSource}set systemSource(x){if(this._systemSource=x,x!==rO.None){switch(this._contextualSource=IO.None,this._type=bO.Float,x){case rO.Time:case rO.Delta:this._type=bO.Float;break;case rO.Emitter:this._type=bO.Oo}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==IO.None}get contextualValue(){return this._contextualSource}set contextualValue(x){if(this._contextualSource=x,x!==IO.None){switch(this._systemSource=rO.None,x){case IO.Scale:this._type=bO.Vector2;break;case IO.Position:case IO.Direction:case IO.ScaledDirection:this._type=bO.Oo;break;case IO.Color:this._type=bO.nh;break;case IO.Age:case IO.Lifetime:case IO.Angle:case IO.AgeGradient:this._type=bO.Float;break;case IO.SpriteCellEnd:case IO.SpriteCellStart:case IO.SpriteCellIndex:this._type=bO.Int}this.output&&(this.output.type=this._type)}}constructor(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bO.AutoDetect;super(x),this._type=bO.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new p.b,this._systemSource=rO.None,this._contextualSource=IO.None,this._type=O,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",O)}get value(){return this._storedValue}set value(x){this.type===bO.Float&&this.min!==this.max&&(x=Math.max(this.min,x),x=Math.min(this.max,x)),this._storedValue=x,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(x){this._valueCallback=x}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case bO.Int:case bO.Float:this.value=0;break;case bO.Vector2:this.value=X.l.Zero();break;case bO.Oo:this.value=X.n.Zero();break;case bO.nh:this.value=new V.h(1,1,1,1);break;case bO.Matrix:this.value=X.c.Identity()}}_build(x){super._build(x),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=x=>x.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=x=>x.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const x=super.serialize();return x.type=this.type,x.contextualValue=this.contextualValue,x.systemSource=this.systemSource,x.min=this.min,x.max=this.max,x.groupInInspector=this.groupInInspector,x.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.mV?(x.valueType="BABYLON."+this._storedValue.getClassName(),x.value=this._storedValue.mV()):(x.valueType="number",x.value=this._storedValue)),x}_deserialize(x){if(super._deserialize(x),this._type=x.type,this.contextualValue=x.contextualValue,this.systemSource=x.systemSource||rO.None,this.min=x.min||0,this.max=x.max||0,this.groupInInspector=x.groupInInspector||"",void 0!==x.displayInInspector&&(this.displayInInspector=x.displayInInspector),x.valueType)if("number"===x.valueType)this._storedValue=x.value;else{const O=(0,o.b)(x.valueType);O&&(this._storedValue=O.Xo(x.value))}}}(0,o.d)("BABYLON.ParticleInputBlock",mO);class wO extends iO{get url(){return this._url}set url(x){this._url!==x&&(this._cachedData=null,this._url=x,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(x){this._textureDataUrl!==x&&(this._cachedData=null,this._textureDataUrl=x,this._url="",this._sourceTexture=null)}set sourceTexture(x){this._sourceTexture!==x&&(this._cachedData=null,this._sourceTexture=x,this._url="",this._textureDataUrl="")}constructor(x){super(x),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",bO.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const x=this.texture._storedValue;return await new Promise(((O,Q)=>{if(!x.isReady())return void x.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),O(this._cachedData)}catch(x){Q(x)}}));const X=x.getSize();AO.k.GetTextureDataAsync(x,X.width,X.height).then((Q=>{this._cachedData={width:X.width,height:X.height,data:new Uint8ClampedArray(Q)},x.dispose(),O(this._cachedData)})).catch(Q)}))}_build(x){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new z.b(this._textureDataUrl,x.RO):this.texture._storedValue=new z.b(this._url,x.RO):this.texture._storedValue=null}serialize(){const x=super.serialize();return x.url=this.url,x.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(x.textureDataUrl=this.textureDataUrl),x}_deserialize(x){super._deserialize(x),this.url=x.url,this.serializedCachedData=!!x.serializedCachedData,x.textureDataUrl&&(this.textureDataUrl=x.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,o.d)("BABYLON.ParticleTextureSourceBlock",wO);class xQ extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("position",bO.Oo),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(x){const O=this.particle.getConnectedValue(x);if(this.output._storedValue=O,!this.position.isConnected)return;const Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.position.V(this.position.getConnectedValue(x))},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q}}(0,o.d)("BABYLON.UpdatePositionBlock",xQ),function(x){x[x.Add=0]="Add",x[x.Subtract=1]="Subtract",x[x.Multiply=2]="Multiply",x[x.Divide=3]="Divide",x[x.Max=4]="Max",x[x.Min=5]="Min"}(jO||(jO={}));class OQ extends iO{constructor(x){super(x),this.operation=jO.Add,this.registerInput("left",bO.AutoDetect),this.registerInput("right",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this.output._typeConnectionSource=this.left;const O=[bO.Matrix,bO.Particle,bO.Texture,bO.System,bO.FloatGradient,bO.Color4Gradient,bO.Vector2Gradient,bO.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...O),this.right.excludedConnectionPointTypes.push(...O),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(x){let O;const Q=this.left,Z=this.right;if(!Q.isConnected||!Z.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const n=Q.type===bO.Float||Q.type===bO.Int,o=Z.type===bO.Float||Z.type===bO.Int,l=n&&o;switch(this.operation){case jO.Add:O=l?x=>Q.getConnectedValue(x)+Z.getConnectedValue(x):n?x=>x.adapt(Q,Z.type).add(Z.getConnectedValue(x)):x=>Q.getConnectedValue(x).add(x.adapt(Z,Q.type));break;case jO.Subtract:O=l?x=>Q.getConnectedValue(x)-Z.getConnectedValue(x):n?x=>x.adapt(Q,Z.type).hQ(Z.getConnectedValue(x)):x=>Q.getConnectedValue(x).hQ(x.adapt(Z,Q.type));break;case jO.Multiply:O=l?x=>Q.getConnectedValue(x)*Z.getConnectedValue(x):n?x=>x.adapt(Q,Z.type).multiply(Z.getConnectedValue(x)):x=>Q.getConnectedValue(x).multiply(x.adapt(Z,Q.type));break;case jO.Divide:O=l?x=>Q.getConnectedValue(x)/Z.getConnectedValue(x):n?x=>x.adapt(Q,Z.type).divide(Z.getConnectedValue(x)):x=>Q.getConnectedValue(x).divide(x.adapt(Z,Q.type));break;case jO.Min:if(l)O=x=>Math.min(Q.getConnectedValue(x),Z.getConnectedValue(x));else{const[x,o]=n?[Z,Q]:[Q,Z];switch(x.type){case bO.Vector2:O=O=>X.l.Minimize(x.getConnectedValue(O),O.adapt(o,x.type));break;case bO.Oo:O=O=>X.n.Minimize(x.getConnectedValue(O),O.adapt(o,x.type));break;case bO.nh:O=O=>{const Q=x.getConnectedValue(O),{r:X,g:Z,b:n,a:l}=O.adapt(o,x.type);return new V.h(Math.min(Q.r,X),Math.min(Q.g,Z),Math.min(Q.b,n),Math.min(Q.a,l))}}}break;case jO.Max:if(!l){const[x,o]=n?[Z,Q]:[Q,Z];switch(x.type){case bO.Vector2:O=O=>X.l.Maximize(x.getConnectedValue(O),O.adapt(o,x.type));break;case bO.Oo:O=O=>X.n.Maximize(x.getConnectedValue(O),O.adapt(o,x.type));break;case bO.nh:O=O=>{const Q=x.getConnectedValue(O),{r:X,g:Z,b:n,a:l}=O.adapt(o,x.type);return new V.h(Math.max(Q.r,X),Math.min(Q.g,Z),Math.min(Q.b,n),Math.min(Q.a,l))}}break}O=x=>Math.max(Q.getConnectedValue(x),Z.getConnectedValue(x))}this.output._storedFunction=x=>Q.type===bO.Int?0|O(x):O(x)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===bO.Int||this.left.type===bO.Float&&this.right.type!==bO.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[x,O]of[[this.left,this.right],[this.right,this.left]])x.acceptedConnectionPointTypes=[bO.Int,bO.Float],O.isConnected&&(x.acceptedConnectionPointTypes.push(O.type),O.type!==bO.Int&&O.type!==bO.Float||x.acceptedConnectionPointTypes.push(bO.Vector2,bO.Oo,bO.nh))}dispose(){super.dispose();for(const x of this._connectionObservers)x.remove();this._connectionObservers.length=0}serialize(){const x=super.serialize();return x.operation=this.operation,x}_deserialize(x){super._deserialize(x),this.operation=x.operation}}(0,A.b)([HO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:jO.Add},{label:"Subtract",value:jO.Subtract},{label:"Multiply",value:jO.Multiply},{label:"Divide",value:jO.Divide},{label:"Max",value:jO.Max},{label:"Min",value:jO.Min}]})],OQ.prototype,"operation",void 0),(0,o.d)("BABYLON.ParticleMathBlock",OQ);class QQ extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("direction1",bO.Oo,!0,new X.n(0,1,0)),this.registerInput("direction2",bO.Oo,!0,new X.n(0,1,0)),this.registerInput("minEmitBox",bO.Oo,!0,new X.n(-.5,-.5,-.5)),this.registerInput("maxEmitBox",bO.Oo,!0,new X.n(.5,.5,.5)),this.registerOutput("output",bO.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(x){const O=this.particle.getConnectedValue(x);O._directionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.direction1.getConnectedValue(x),n=this.direction2.getConnectedValue(x),V=(0,C.RandomRange)(Z.x,n.x),o=(0,C.RandomRange)(Z.y,n.y),l=(0,C.RandomRange)(Z.z,n.z);x.isEmitterTransformNode?X.n.TransformNormalFromFloatsToRef(V,o,l,x.emitterWorldMatrix,Q.direction):Q.direction.xo(V,o,l)},O._positionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.minEmitBox.getConnectedValue(x),n=this.maxEmitBox.getConnectedValue(x),V=(0,C.RandomRange)(Z.x,n.x),o=(0,C.RandomRange)(Z.y,n.y),l=(0,C.RandomRange)(Z.z,n.z);x.isEmitterTransformNode?X.n.TransformCoordinatesFromFloatsToRef(V,o,l,x.emitterWorldMatrix,Q.position):(Q.position.xo(V,o,l),Q.position.addInPlace(x.emitterPosition))},this.output._storedValue=O}}(0,o.d)("BABYLON.BoxShapeBlock",QQ);class XQ extends iO{constructor(x){super(x),this.registerInput("emitPower",bO.Float,!0,1),this.registerInput("lifeTime",bO.Float,!0,1),this.registerInput("color",bO.nh,!0,new V.h(1,1,1,1)),this.registerInput("scale",bO.Vector2,!0,new X.l(1,1)),this.registerInput("angle",bO.Float,!0,0),this.registerOutput("particle",bO.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(x){const O=new oO(this.name,x.kV,x.RO,null,!1,void 0,!0);O.particleEmitterType=new Y,O._lifeTimeCreation.process=(O,Q)=>{x.particleContext=O,O.lifeTime=this.lifeTime.getConnectedValue(x),Q._emitPower=this.emitPower.getConnectedValue(x)},O._colorCreation.process=O=>{x.particleContext=O,O.color.V(this.color.getConnectedValue(x))},O._sizeCreation.process=O=>{x.particleContext=O,O.size=1,O.scale.V(this.scale.getConnectedValue(x))},O._angleCreation.process=O=>{x.particleContext=O,O.angle=this.angle.getConnectedValue(x)},this.particle._storedValue=O}}(0,o.d)("BABYLON.CreateParticleBlock",XQ);class ZQ{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const x=[];for(const O of this.attachedBlocks)O.isInput&&x.push(O);return x}constructor(x){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new p.b,this.name=x}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(x){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(x)&&this.attachedBlocks.push(x);for(const Q of x.inputs){const X=Q.connectedPoint;if(X){const Q=X.ownerBlock;Q!==x&&this._initializeBlock(Q,O)}}}async buildAsync(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Q=>{const X=new GO;for(const x of this._systemBlocks)this._initializeBlock(x);for(const Z of this.systemBlocks){const Q=new SO;Q.buildId=this._buildId++,Q.RO=x,Q.verbose=O;const n=Z.createSystem(Q);Q.emitErrors(),X.systems.push(n)}this.onBuildObservable.notifyObservers(this),Q(X)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const x=new PO("Particle system"),O=new xQ("Update position");O.output.connectTo(x.particle);const Q=new mO("Position");Q.contextualValue=IO.Position;const X=new mO("Scaled direction");X.contextualValue=IO.ScaledDirection;const Z=new OQ("Add");Z.operation=jO.Add,Q.output.connectTo(Z.left),X.output.connectTo(Z.right),Z.output.connectTo(O.position);const n=new XQ("Create particle"),V=new QQ("Box shape");n.particle.connectTo(V.particle),V.output.connectTo(O.particle);const o=new wO("Texture");o.texture.connectTo(x.texture),o.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(x)}removeBlock(x){const O=this.attachedBlocks.indexOf(x);if(O>-1&&this.attachedBlocks.splice(O,1),x.isSystem){const O=this._systemBlocks.indexOf(x);O>-1&&this._systemBlocks.splice(O,1)}}parseSerializedObject(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O||this.clear();const Q={};for(const X of x.pC){const x=(0,o.b)(X.customType);if(x){const O=new x;O._deserialize(X),Q[X.id]=O,this.attachedBlocks.push(O),O.isSystem&&this._systemBlocks.push(O)}}for(const X of this.attachedBlocks)if(X.isTeleportOut){const x=X,O=x._tempEntryPointUniqueId;if(O){const X=Q[O];X&&X.attachToEndpoint(x)}}for(let X=0;X<x.pC.length;X++){const Z=x.pC[X],n=Q[Z.id];n&&(n.inputs.length&&Z.inputs.some((x=>x.targetConnectionName))&&!O||this._restoreConnections(n,x,Q))}if(x.locations||x.editorData&&x.editorData.locations){const X=x.locations||x.editorData.locations;for(const x of X)Q[x.BX]&&(x.BX=Q[x.BX].uniqueId);O&&this.editorData&&this.editorData.locations&&X.concat(this.editorData.locations),x.locations?this.editorData={locations:X}:(this.editorData=x.editorData,this.editorData.locations=X);const Z=[];for(const x in Q)Z[x]=Q[x].uniqueId;this.editorData.map=Z}this.comment=x.comment}_restoreConnections(x,O,Q){for(const X of x.outputs)for(const Z of O.pC){const n=Q[Z.id];if(n)for(const V of Z.inputs)if(Q[V.targetBlockId]!==x||V.targetConnectionName!==X.name);else{const x=n.getInputByName(V.inputName);if(!x||x.isConnected)continue;X.connectTo(x,!0),this._restoreConnections(n,O,Q)}}}serialize(x){const O=x?{}:E.c.Serialize(this);O.editorData=JSON.parse(JSON.stringify(this.editorData));let Q=[];x?Q=x:O.customType="BABYLON.NodeParticleSystemSet",O.pC=[];for(const X of Q)O.pC.push(X.serialize());if(!x)for(const X of this.attachedBlocks)-1===Q.indexOf(X)&&O.pC.push(X.serialize());return O}dispose(){for(const x of this.attachedBlocks)x.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(x){const O=new ZQ(x);return O.setToDefault(),O}static Parse(x){const O=E.c.Parse((()=>new ZQ(x.name)),x,null);return O.parseSerializedObject(x),O}static ParseFromSnippetAsync(x,O){return"_BLANK"===x?Promise.resolve(ZQ.CreateDefault("blank")):new Promise(((Q,X)=>{const Z=new kO.e;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const V=JSON.parse(JSON.parse(Z.responseText).jsonPayload),o=JSON.parse(V.nodeParticle);O||(O=E.c.Parse((()=>new ZQ(x)),o,null)),O.parseSerializedObject(o),O.snippetId=x;try{Q(O)}catch(n){X(n)}}else X("Unable to load the snippet "+x)})),Z.open("GET",this.SnippetUrl+"/"+x.replace(/#/g,"/")),Z.send()}))}}ZQ.EditorURL=`${RO.g._DefaultCdnUrl}/v${Hx.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,ZQ.SnippetUrl="https://snippet.babylonjs.com",(0,A.b)([(0,f.L)()],ZQ.prototype,"name",void 0),(0,A.b)([(0,f.L)("comment")],ZQ.prototype,"comment",void 0),function(x){x[x.None=0]="None",x[x.PerParticle=1]="PerParticle",x[x.PerSystem=2]="PerSystem"}(TO||(TO={}));class nQ extends iO{constructor(x){super(x),this._currentLockId=-2,this.lockMode=TO.PerParticle,this.registerInput("min",bO.AutoDetect,!0,0),this.registerInput("max",bO.AutoDetect,!0,1),this.registerOutput("output",bO.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bO.Float|bO.Int|bO.Vector2|bO.Oo|bO.nh),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bO.Float|bO.Int|bO.Vector2|bO.Oo|bO.nh),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=bO.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let x=null;switch(this._currentLockId=-2,this.min.type){case bO.AutoDetect:case bO.Int:case bO.Float:x=x=>{const O=this.min.getConnectedValue(x)||0,Q=this.max.getConnectedValue(x)||1;return O+Math.random()*(Q-O)};break;case bO.Vector2:x=x=>{const O=this.min.getConnectedValue(x)||X.l.Zero(),Q=this.max.getConnectedValue(x)||X.l.One();return new X.l(O.x+Math.random()*(Q.x-O.x),O.y+Math.random()*(Q.y-O.y))};break;case bO.Oo:x=x=>{const O=this.min.getConnectedValue(x)||X.n.Zero(),Q=this.max.getConnectedValue(x)||X.n.One();return new X.n(O.x+Math.random()*(Q.x-O.x),O.y+Math.random()*(Q.y-O.y),O.z+Math.random()*(Q.z-O.z))};break;case bO.nh:x=x=>{const O=this.min.getConnectedValue(x)||new V.h(0,0,0,0),Q=this.max.getConnectedValue(x)||new V.h(1,1,1,1);return new V.h(O.x+Math.random()*(Q.x-O.x),O.y+Math.random()*(Q.y-O.y),O.z+Math.random()*(Q.z-O.z),O.w+Math.random()*(Q.w-O.w))}}this.output._storedFunction=O=>{var Q;let X=0;switch(this.lockMode){case TO.PerParticle:X=(null===(Q=O.particleContext)||void 0===Q?void 0:Q.id)||-1;break;case TO.PerSystem:X=O.buildId||0}return this._currentLockId!==X&&(this.lockMode!==TO.None&&(this._currentLockId=X),this.output._storedValue=x(O)),this.output._storedValue}}serialize(){const x=super.serialize();return x.lockMode=this.lockMode,x}_deserialize(x){super._deserialize(x),this.lockMode=x.lockMode}}(0,A.b)([HO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:TO.None},{label:"Per particle",value:TO.PerParticle},{label:"Per system",value:TO.PerSystem}]})],nQ.prototype,"lockMode",void 0),(0,o.d)("BABYLON.ParticleRandomBlock",nQ);class VQ extends iO{constructor(x){super(x),this._currentLockId=-2,this.lockMode=TO.PerParticle,this.registerInput("min",bO.AutoDetect),this.registerInput("max",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const O=[bO.Matrix,bO.Particle,bO.Texture,bO.System,bO.FloatGradient,bO.Color4Gradient,bO.Vector2Gradient,bO.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...O),this.max.excludedConnectionPointTypes.push(...O)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let x=null;switch(this._currentLockId=-2,this.min.type){case bO.Float:case bO.Int:x=x=>{const O=this.min.getConnectedValue(x),Q=this.max.getConnectedValue(x);return Math.random()*(Q-O)+O};break;case bO.Vector2:x=x=>{const O=this.min.getConnectedValue(x),Q=this.max.getConnectedValue(x);return new X.l(Math.random()*(Q.x-O.x)+O.x,Math.random()*(Q.y-O.y)+O.y)};break;case bO.Oo:x=x=>{const O=this.min.getConnectedValue(x),Q=this.max.getConnectedValue(x);return new X.n(Math.random()*(Q.x-O.x)+O.x,Math.random()*(Q.y-O.y)+O.y,Math.random()*(Q.z-O.z)+O.z)};break;case bO.nh:x=x=>{const O=this.min.getConnectedValue(x),Q=this.max.getConnectedValue(x);return new V.h(Math.random()*(Q.r-O.r)+O.r,Math.random()*(Q.g-O.g)+O.g,Math.random()*(Q.b-O.b)+O.b,Math.random()*(Q.a-O.a)+O.a)}}this.output._storedFunction=O=>{var Q;let X=0;switch(this.lockMode){case TO.PerParticle:X=(null===(Q=O.particleContext)||void 0===Q?void 0:Q.id)||-1;break;case TO.PerSystem:X=O.buildId||0}return this._currentLockId!==X&&(this.lockMode!==TO.None&&(this._currentLockId=X),this.output._storedValue=x(O)),this.output._storedValue}}serialize(){const x=super.serialize();return x.lockMode=this.lockMode,x}_deserialize(x){super._deserialize(x),void 0!==x.lockMode&&(this.lockMode=x.lockMode)}}(0,A.b)([HO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:TO.None},{label:"Per particle",value:TO.PerParticle},{label:"Per system",value:TO.PerSystem}]})],VQ.prototype,"lockMode",void 0),(0,o.d)("BABYLON.RandomRangeBlock",VQ);(0,o.d)("BABYLON.ParticleLerpBlock",class extends iO{constructor(x){super(x),this.registerInput("left",bO.AutoDetect),this.registerInput("right",bO.AutoDetect),this.registerInput("gradient",bO.Float,!0,0,0,1),this.registerOutput("output",bO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bO.Float|bO.Int|bO.Vector2|bO.Oo|bO.nh)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const x=(x,O,Q)=>(1-x)*O+x*Q;this.output._storedFunction=O=>{const Q=this.left.getConnectedValue(O),Z=this.right.getConnectedValue(O),n=this.gradient.getConnectedValue(O);switch(this.left.type){case bO.Int:case bO.Float:return x(n,Q,Z);case bO.Vector2:return new X.l(x(n,Q.x,Z.x),x(n,Q.y,Z.y));case bO.Oo:return new X.n(x(n,Q.x,Z.x),x(n,Q.y,Z.y),x(n,Q.z,Z.z));case bO.nh:return new V.h(x(n,Q.r,Z.r),x(n,Q.g,Z.g),x(n,Q.b,Z.b),x(n,Q.a,Z.a))}return 0}}});(0,o.d)("BABYLON.UpdateDirectionBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("direction",bO.Oo),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(x){const O=this.particle.getConnectedValue(x);if(this.output._storedValue=O,!this.direction.isConnected)return;const Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.direction.V(this.direction.getConnectedValue(x))},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q}});(0,o.d)("BABYLON.UpdateColorBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("color",bO.nh),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(x){const O=this.particle.getConnectedValue(x);if(this.output._storedValue=O,!this.color.isConnected)return;const Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.color.V(this.color.getConnectedValue(x))},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q}});(0,o.d)("BABYLON.UpdateScaleBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("scale",bO.Vector2),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(x){const O=this.particle.getConnectedValue(x);if(this.output._storedValue=O,!this.scale.isConnected)return;const Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.scale.V(this.scale.getConnectedValue(x))},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q}});(0,o.d)("BABYLON.UpdateAngleBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("angle",bO.Float),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(x){const O=this.particle.getConnectedValue(x);if(this.output._storedValue=O,!this.angle.isConnected)return;const Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.angle=this.angle.getConnectedValue(x)},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q}});(0,o.d)("BABYLON.BasicPositionUpdateBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(x){const O=this.particle.getConnectedValue(x),Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.direction.scaleToRef(O._directionScale,O._scaledDirection),Q.position.addInPlace(O._scaledDirection)},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q,this.output._storedValue=O}});(0,o.d)("BABYLON.BasicSpriteUpdateBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(x){const O=this.particle.getConnectedValue(x),Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.updateCellIndex()},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q,this.output._storedValue=O}});(0,o.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("cellIndex",bO.Int),this.registerOutput("output",bO.Particle),this.cellIndex.acceptedConnectionPointTypes=[bO.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(x){const O=this.particle.getConnectedValue(x);if(this.output._storedValue=O,!this.cellIndex.isConnected)return;const Q={process:Q=>{x.particleContext=Q,x.systemContext=O,Q.cellIndex=Math.floor(this.cellIndex.getConnectedValue(x))},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q}});class oQ extends iO{constructor(x){super(x),this.strength=1,this.registerInput("particle",bO.Particle),this.registerInput("flowMap",bO.Texture),this.registerOutput("output",bO.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(x){var O;const Q=this.particle.getConnectedValue(x),X=x.RO;let Z;(null===(O=this.flowMap.connectedPoint)||void 0===O?void 0:O.ownerBlock).extractTextureContentAsync().then((x=>{x&&(Z=new FO(x.width,x.height,x.data))}));const n={process:x=>{const O=X.getTransformMatrix();Z&&Z._processParticle(x,this.strength*Q._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null};Q._updateQueueStart?rx(n,Q._updateQueueStart):Q._updateQueueStart=n,this.output._storedValue=Q}serialize(){const x=super.serialize();return x.strength=this.strength,x}_deserialize(x){super._deserialize(x),this.strength=x.strength}}(0,A.b)([HO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],oQ.prototype,"strength",void 0),(0,o.d)("BABYLON.UpdateFlowMapBlock",oQ);(0,o.d)("BABYLON.SphereShapeBlock",class extends iO{constructor(x){super(x),this.registerInput("input",bO.Particle),this.registerInput("radius",bO.Float,!0,1),this.registerInput("radiusRange",bO.Float,!0,1,0,1),this.registerInput("directionRandomizer",bO.Float,!0,0,0,1),this.registerOutput("output",bO.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(x){const O=this.input.getConnectedValue(x);O._directionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.directionRandomizer.getConnectedValue(x),n=Q.position.hQ(x.emitterPosition).normalize(),V=(0,C.RandomRange)(0,Z),o=(0,C.RandomRange)(0,Z),l=(0,C.RandomRange)(0,Z);n.x+=V,n.y+=o,n.z+=l,n.normalize(),x.isEmitterTransformNode?X.n.TransformNormalFromFloatsToRef(V,o,l,x.emitterWorldMatrix,Q.direction):Q.direction.xo(V,o,l)},O._positionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.radius.getConnectedValue(x),n=this.radiusRange.getConnectedValue(x),V=Z-(0,C.RandomRange)(0,Z*n),o=(0,C.RandomRange)(0,1),l=(0,C.RandomRange)(0,2*Math.PI),U=Math.acos(2*o-1),L=V*Math.cos(l)*Math.sin(U),h=V*Math.cos(U),N=V*Math.sin(l)*Math.sin(U);x.isEmitterTransformNode?X.n.TransformCoordinatesFromFloatsToRef(L,h,N,x.emitterWorldMatrix,Q.position):(Q.position.xo(L,h,N),Q.position.addInPlace(x.emitterPosition))},this.output._storedValue=O}});(0,o.d)("BABYLON.PointShapeBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("direction1",bO.Oo,!0,new X.n(0,1,0)),this.registerInput("direction2",bO.Oo,!0,new X.n(0,1,0)),this.registerOutput("output",bO.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(x){const O=this.particle.getConnectedValue(x);O._directionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.direction1.getConnectedValue(x),n=this.direction2.getConnectedValue(x),V=(0,C.RandomRange)(Z.x,n.x),o=(0,C.RandomRange)(Z.y,n.y),l=(0,C.RandomRange)(Z.z,n.z);x.isEmitterTransformNode?X.n.TransformNormalFromFloatsToRef(V,o,l,x.emitterWorldMatrix,Q.direction):Q.direction.xo(V,o,l)},O._positionCreation.process=Q=>{x.systemContext=O,x.isEmitterTransformNode?X.n.TransformCoordinatesFromFloatsToRef(0,0,0,x.emitterWorldMatrix,Q.position):Q.position.V(x.emitterPosition)},this.output._storedValue=O}});(0,o.d)("BABYLON.CustomShapeBlock",class extends iO{constructor(x){super(x),this.registerInput("particle",bO.Particle),this.registerInput("position",bO.Oo,!0,new X.n(0,0,0)),this.registerInput("direction",bO.Oo,!0,new X.n(0,1,0)),this.registerOutput("output",bO.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(x){const O=this.particle.getConnectedValue(x);O._directionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.direction.getConnectedValue(x);x.isEmitterTransformNode?X.n.TransformNormalToRef(Z,x.emitterWorldMatrix,Q.direction):Q.direction.V(Z)},O._positionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.position.getConnectedValue(x);x.isEmitterTransformNode?X.n.TransformCoordinatesToRef(Z,x.emitterWorldMatrix,Q.position):(Q.position.V(Z),Q.position.addInPlace(x.emitterPosition))},this.output._storedValue=O}});(0,o.d)("BABYLON.CylinderShapeBlock",class extends iO{constructor(x){super(x),this._tempVector=X.n.Zero(),this.registerInput("particle",bO.Particle),this.registerInput("radius",bO.Float,!0,1),this.registerInput("height",bO.Float,!0,1,0),this.registerInput("radiusRange",bO.Float,!0,1,0,1),this.registerInput("directionRandomizer",bO.Float,!0,0,0,1),this.registerOutput("output",bO.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(x){const O=this.particle.getConnectedValue(x);O._directionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.directionRandomizer.getConnectedValue(x);Q.position.subtractToRef(x.emitterPosition,this._tempVector),this._tempVector.normalize(),x.isEmitterTransformNode&&X.n.TransformNormalToRef(this._tempVector,x.emitterInverseWorldMatrix,this._tempVector);const n=(0,C.RandomRange)(-Z/2,Z/2);let V=Math.atan2(this._tempVector.x,this._tempVector.z);V+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*Z,this._tempVector.y=n,this._tempVector.x=Math.sin(V),this._tempVector.z=Math.cos(V),this._tempVector.normalize(),x.isEmitterTransformNode?X.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,x.emitterWorldMatrix,Q.direction):Q.direction.V(this._tempVector)},O._positionCreation.process=Q=>{x.particleContext=Q,x.systemContext=O;const Z=this.height.getConnectedValue(x),n=this.radiusRange.getConnectedValue(x),V=this.radius.getConnectedValue(x),o=(0,C.RandomRange)(-Z/2,Z/2),l=(0,C.RandomRange)(0,2*Math.PI),U=(0,C.RandomRange)((1-n)*(1-n),1),L=Math.sqrt(U)*V,h=L*Math.cos(l),N=L*Math.sin(l);x.isEmitterTransformNode?X.n.TransformCoordinatesFromFloatsToRef(h,o,N,x.emitterWorldMatrix,Q.position):(Q.position.xo(h,o,N),Q.position.addInPlace(x.emitterPosition))},this.output._storedValue=O}});class lQ extends iO{constructor(x){super(x),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",bO.Particle),this.registerOutput("output",bO.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(x){super._build(x);const O=this.particle.getConnectedValue(x);O._isAnimationSheetEnabled=!0,O.spriteCellWidth=this.width,O.spriteCellHeight=this.height,O.startSpriteCellID=this.start,O.endSpriteCellID=this.end,O.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=O}serialize(){const x=super.serialize();return x.width=this.width,x.height=this.height,x.start=this.start,x.end=this.end,x.randomStartCell=this.randomStartCell,x}_deserialize(x){super._deserialize(x),this.width=x.width,this.height=x.height,this.start=x.start,this.end=x.end,this.randomStartCell=x.randomStartCell}}(0,A.b)([HO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lQ.prototype,"start",void 0),(0,A.b)([HO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lQ.prototype,"end",void 0),(0,A.b)([HO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lQ.prototype,"width",void 0),(0,A.b)([HO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lQ.prototype,"height",void 0),(0,A.b)([HO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],lQ.prototype,"loop",void 0),(0,A.b)([HO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],lQ.prototype,"randomStartCell",void 0),(0,o.d)("BABYLON.SetupSpriteSheetBlock",lQ);class CQ extends iO{constructor(x){super(x),this.reference=0,this.registerInput("value",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=x=>{switch(x){case bO.Float:return bO.FloatGradient;case bO.Vector2:return bO.Vector2Gradient;case bO.Oo:return bO.Vector3Gradient;case bO.nh:return bO.Color4Gradient}return x},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bO.Float|bO.Vector2|bO.Oo|bO.nh)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=x=>null}serialize(){const x=super.serialize();return x.reference=this.reference,x}_deserialize(x){super._deserialize(x),this.reference=x.reference}}(0,A.b)([HO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],CQ.prototype,"reference",void 0),(0,o.d)("BABYLON.ParticleGradientValueBlock",CQ);(0,o.d)("BABYLON.ParticleGradientBlock",class extends iO{constructor(x){super(x),this._entryCount=1,this.registerInput("gradient",bO.Float,!0,1,0,1),this.registerInput("value0",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=x=>{switch(x){case bO.FloatGradient:return bO.Float;case bO.Vector2Gradient:return bO.Vector2;case bO.Vector3Gradient:return bO.Oo;case bO.Color4Gradient:return bO.nh}return x},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bO.FloatGradient|bO.Vector2Gradient|bO.Vector3Gradient|bO.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(x){this._inputs[x].onConnectionObservable.add((()=>{this._entryCount>x||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),bO.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const x=[];for(let Q=1;Q<this._inputs.length;Q++){var O;if(this._inputs[Q].isConnected)x.push(null===(O=this._inputs[Q].connectedPoint)||void 0===O?void 0:O.ownerBlock)}x.sort(((x,O)=>x.reference-O.reference)),this.output._storedFunction=O=>{const Q=this.gradient.getConnectedValue(O);if(1===x.length)return x[0].value.getConnectedValue(O);let Z=null;for(let n=x.length-1;n>=0;n--){const o=x[n];if(o.reference<=Q){const x=o.value.getConnectedValue(O);if(Z){const n=Z.value.getConnectedValue(O),l=Z.reference,U=o.reference,L=Math.max(0,Math.min(1,(Q-U)/(l-U)));switch(this.output.type){case bO.Float:return(0,C.Lerp)(x,n,L);case bO.Vector2:return X.l.Lerp(x,n,L);case bO.Oo:return X.n.Lerp(x,n,L);case bO.nh:return V.h.Lerp(x,n,L)}}return x}Z=o}return 0}}});(0,o.d)("BABYLON.ParticleConverterBlock",class extends iO{constructor(x){super(x),this.registerInput("color ",bO.nh,!0),this.registerInput("xyz ",bO.Oo,!0),this.registerInput("xy ",bO.Vector2,!0),this.registerInput("zw ",bO.Vector2,!0),this.registerInput("x ",bO.Float,!0),this.registerInput("y ",bO.Float,!0),this.registerInput("z ",bO.Float,!0),this.registerInput("w ",bO.Float,!0),this.registerOutput("color",bO.nh),this.registerOutput("xyz",bO.Oo),this.registerOutput("xy",bO.Vector2),this.registerOutput("zw",bO.Vector2),this.registerOutput("x",bO.Float),this.registerOutput("y",bO.Float),this.registerOutput("z",bO.Float),this.registerOutput("w",bO.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(x){return"color "===x?"colorIn":"xyz "===x?"xyzIn":"xy "===x?"xyIn":"zw "===x?"zwIn":"x "===x?"xIn":"y "===x?"yIn":"z "===x?"zIn":"w "===x?"wIn":x}_outputRename(x){switch(x){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return x}}_build(x){super._build(x);const O=this.xIn,Q=this.yIn,Z=this.zIn,n=this.wIn,o=this.xyIn,l=this.zwIn,C=this.xyzIn,U=this.colorIn,L=this.colorOut,h=this.xyzOut,N=this.xyOut,a=this.zwOut,K=this.xOut,M=this.yOut,Y=this.zOut,g=this.wOut,v=x=>{if(U.isConnected)return U.getConnectedValue(x);let X=0,L=0,h=0,N=0;if(O.isConnected&&(X=O.getConnectedValue(x)),Q.isConnected&&(L=Q.getConnectedValue(x)),Z.isConnected&&(h=Z.getConnectedValue(x)),n.isConnected&&(N=n.getConnectedValue(x)),o.isConnected){const O=o.getConnectedValue(x);O&&(X=O.x,L=O.y)}if(l.isConnected){const O=l.getConnectedValue(x);O&&(h=O.x,N=O.y)}if(C.isConnected){const O=C.getConnectedValue(x);O&&(X=O.x,L=O.y,h=O.z)}return new V.h(X,L,h,N)};L._storedFunction=x=>v(x),h._storedFunction=x=>{const O=v(x);return new X.n(O.r,O.g,O.b)},N._storedFunction=x=>{const O=v(x);return new X.l(O.r,O.g)},a._storedFunction=x=>{const O=v(x);return new X.l(O.b,O.a)},K._storedFunction=x=>v(x).r,M._storedFunction=x=>v(x).g,Y._storedFunction=x=>v(x).b,g._storedFunction=x=>v(x).a}}),function(x){x[x.Cos=0]="Cos",x[x.Sin=1]="Sin",x[x.Abs=2]="Abs",x[x.Exp=3]="Exp",x[x.Exp2=4]="Exp2",x[x.Round=5]="Round",x[x.Floor=6]="Floor",x[x.Ceiling=7]="Ceiling",x[x.Sqrt=8]="Sqrt",x[x.Log=9]="Log",x[x.Tan=10]="Tan",x[x.ArcTan=11]="ArcTan",x[x.ArcCos=12]="ArcCos",x[x.ArcSin=13]="ArcSin",x[x.Sign=14]="Sign",x[x.Negate=15]="Negate",x[x.OneMinus=16]="OneMinus",x[x.Reciprocal=17]="Reciprocal",x[x.ToDegrees=18]="ToDegrees",x[x.ToRadians=19]="ToRadians",x[x.Fract=20]="Fract"}(eO||(eO={}));class UQ extends iO{constructor(x){super(x),this.operation=eO.Cos,this.registerInput("input",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bO.Float|bO.Int|bO.Vector2|bO.Oo|bO.nh)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(x){super._build(x);let O=null;switch(this.operation){case eO.Cos:O=x=>Math.cos(x);break;case eO.Sin:O=x=>Math.sin(x);break;case eO.Abs:O=x=>Math.abs(x);break;case eO.Exp:O=x=>Math.exp(x);break;case eO.Exp2:O=x=>Math.pow(2,x);break;case eO.Round:O=x=>Math.round(x);break;case eO.Floor:O=x=>Math.floor(x);break;case eO.Ceiling:O=x=>Math.ceil(x);break;case eO.Sqrt:O=x=>Math.sqrt(x);break;case eO.Log:O=x=>Math.log(x);break;case eO.Tan:O=x=>Math.tan(x);break;case eO.ArcTan:O=x=>Math.atan(x);break;case eO.ArcCos:O=x=>Math.acos(x);break;case eO.ArcSin:O=x=>Math.asin(x);break;case eO.Sign:O=x=>Math.sign(x);break;case eO.Negate:O=x=>-x;break;case eO.OneMinus:O=x=>1-x;break;case eO.Reciprocal:O=x=>1/x;break;case eO.ToRadians:O=x=>x*Math.PI/180;break;case eO.ToDegrees:O=x=>180*x/Math.PI;break;case eO.Fract:O=x=>x>=0?x-Math.floor(x):x-Math.ceil(x)}if(!O)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case bO.Int:case bO.Float:this.output._storedFunction=x=>{const Q=this.input.getConnectedValue(x);return O(Q)};break;case bO.Vector2:this.output._storedFunction=x=>{const Q=this.input.getConnectedValue(x);return new X.l(O(Q.x),O(Q.y))};break;case bO.Oo:this.output._storedFunction=x=>{const Q=this.input.getConnectedValue(x);return new X.n(O(Q.x),O(Q.y),O(Q.z))};break;case bO.nh:this.output._storedFunction=x=>{const Q=this.input.getConnectedValue(x);return new V.h(O(Q.r),O(Q.g),O(Q.b),O(Q.a))}}return this}serialize(){const x=super.serialize();return x.operation=this.operation,x}_deserialize(x){super._deserialize(x),this.operation=x.operation}}(0,A.b)([HO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:eO.Cos},{label:"Sin",value:eO.Sin},{label:"Abs",value:eO.Abs},{label:"Exp",value:eO.Exp},{label:"Exp2",value:eO.Exp2},{label:"Round",value:eO.Round},{label:"Floor",value:eO.Floor},{label:"Ceiling",value:eO.Ceiling},{label:"Sqrt",value:eO.Sqrt},{label:"Log",value:eO.Log},{label:"Tan",value:eO.Tan},{label:"ArcTan",value:eO.ArcTan},{label:"ArcCos",value:eO.ArcCos},{label:"ArcSin",value:eO.ArcSin},{label:"Sign",value:eO.Sign},{label:"Negate",value:eO.Negate},{label:"OneMinus",value:eO.OneMinus},{label:"Reciprocal",value:eO.Reciprocal},{label:"ToDegrees",value:eO.ToDegrees},{label:"ToRadians",value:eO.ToRadians},{label:"Fract",value:eO.Fract}]})],UQ.prototype,"operation",void 0),(0,o.d)("BABYLON.ParticleTrigonometryBlock",UQ);var LQ,hQ=Q(12365);class NQ extends iO{constructor(x){super(x),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(bO.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(bO.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(bO.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(bO.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(bO.System),this._inputs[0].excludedConnectionPointTypes.push(bO.Particle),this._inputs[0].excludedConnectionPointTypes.push(bO.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(x){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const O=x=>{const O=this.input.getConnectedValue(x);if(this.log.length>=this.stackSize)return O;if(null===O||void 0===O)return this.log.push(["null",""]),O;switch(this.input.type){case bO.Vector2:this.log.push([(0,hQ.l)(O,4),O.toString()]);break;case bO.Oo:this.log.push([(0,hQ.o)(O,4),O.toString()]);break;case bO.nh:this.log.push([`{R: ${O.r.toFixed(4)} G: ${O.g.toFixed(4)} B: ${O.b.toFixed(4)} A: ${O.a.toFixed(4)}}`,O.toString()]);break;default:this.log.push([O.toString(),O.toString()])}return O};this.output.isConnected?this.output._storedFunction=O:this.output._storedValue=O(x)}serialize(){const x=super.serialize();return x.stackSize=this.stackSize,x}_deserialize(x){super._deserialize(x),this.stackSize=x.stackSize}}(0,A.b)([HO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],NQ.prototype,"stackSize",void 0),(0,o.d)("BABYLON.ParticleDebugBlock",NQ);(0,o.d)("BABYLON.ParticleElbowBlock",class extends iO{constructor(x){super(x),this.registerInput("input",bO.AutoDetect),this.registerOutput("output",bO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(x){super._build(x);const O=this._outputs[0],Q=this._inputs[0];O._storedFunction=x=>Q.getConnectedValue(x)}});(0,o.d)("BABYLON.ParticleTeleportInBlock",class extends iO{get endpoints(){return this._endpoints}constructor(x){super(x),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",bO.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(x){if(this.getClassName()===x)return!0;for(const O of this.endpoints)if(O.isAnAncestorOfType(x))return!0;return!1}isAnAncestorOf(x){for(const O of this.endpoints){if(O===x)return!0;if(O.isAnAncestorOf(x))return!0}return!1}attachToEndpoint(x){x.detach(),this._endpoints.push(x),x._entryPoint=this,x._outputs[0]._typeConnectionSource=this._inputs[0],x._tempEntryPointUniqueId=null,x.name="> "+this.name}detachFromEndpoint(x){const O=this._endpoints.indexOf(x);-1!==O&&(this._endpoints.splice(O,1),x._outputs[0]._typeConnectionSource=null,x._entryPoint=null)}_build(){for(const x of this._endpoints)x.output._storedFunction=x=>this.input.getConnectedValue(x)}});(0,o.d)("BABYLON.ParticleTeleportOutBlock",class extends iO{constructor(x){super(x),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",bO.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(x){this.entryPoint&&this.entryPoint.build(x)}clone(){const x=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(x),x}serialize(){var x;const O=super.serialize();return O.entryPoint=(null===(x=this.entryPoint)||void 0===x?void 0:x.uniqueId)??"",O}_deserialize(x){super._deserialize(x),this._tempEntryPointUniqueId=x.entryPoint}}),function(x){x[x.Equal=0]="Equal",x[x.NotEqual=1]="NotEqual",x[x.LessThan=2]="LessThan",x[x.GreaterThan=3]="GreaterThan",x[x.LessOrEqual=4]="LessOrEqual",x[x.GreaterOrEqual=5]="GreaterOrEqual",x[x.Xor=6]="Xor",x[x.Or=7]="Or",x[x.And=8]="And"}(LQ||(LQ={}));class aQ extends iO{constructor(x){super(x),this.test=LQ.Equal,this.epsilon=0,this.registerInput("left",bO.Float),this.registerInput("right",bO.Float,!0,0),this.registerInput("ifTrue",bO.AutoDetect,!0,1),this.registerInput("ifFalse",bO.AutoDetect,!0,0),this.registerOutput("output",bO.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=bO.Float,this._inputs[0].acceptedConnectionPointTypes.push(bO.Int),this._inputs[1].acceptedConnectionPointTypes.push(bO.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const x=x=>{const O=this.left.getConnectedValue(x),Q=this.right.getConnectedValue(x);let X=!1;switch(this.test){case LQ.Equal:X=(0,C.WithinEpsilon)(O,Q,this.epsilon);break;case LQ.NotEqual:X=!(0,C.WithinEpsilon)(O,Q,this.epsilon);break;case LQ.LessThan:X=O<Q+this.epsilon;break;case LQ.GreaterThan:X=O>Q-this.epsilon;break;case LQ.LessOrEqual:X=O<=Q+this.epsilon;break;case LQ.GreaterOrEqual:X=O>=Q-this.epsilon;break;case LQ.Xor:X=!!O&&!Q||!O&&!!Q;break;case LQ.Or:X=!!O||!!Q;break;case LQ.And:X=!!O&&!!Q}return X};this.output._storedFunction=O=>x(O)?this.ifTrue.getConnectedValue(O):this.ifFalse.getConnectedValue(O)}serialize(){const x=super.serialize();return x.test=this.test,x.epsilon=this.epsilon,x}_deserialize(x){super._deserialize(x),this.test=x.test,void 0!==x.epsilon&&(this.epsilon=x.epsilon)}}(0,A.b)([HO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:LQ.Equal},{label:"NotEqual",value:LQ.NotEqual},{label:"LessThan",value:LQ.LessThan},{label:"GreaterThan",value:LQ.GreaterThan},{label:"LessOrEqual",value:LQ.LessOrEqual},{label:"GreaterOrEqual",value:LQ.GreaterOrEqual},{label:"Xor",value:LQ.Xor},{label:"Or",value:LQ.Or},{label:"And",value:LQ.And}]})],aQ.prototype,"test",void 0),(0,A.b)([HO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aQ.prototype,"epsilon",void 0),(0,o.d)("BABYLON.ParticleConditionBlock",aQ);class KQ extends iO{constructor(x){super(x),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",bO.Particle),this.registerInput("condition",bO.Float,!0,0),this.registerInput("system",bO.System),this.registerOutput("output",bO.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(x){this._triggerCount=0;const O=this.input.getConnectedValue(x),Q={process:Q=>{if(x.particleContext=Q,x.systemContext=O,0!==this.condition.getConnectedValue(x)&&(0===this.limit||this._triggerCount<this.limit)){const X=(new Date).getTime();if(this._previousOne&&X-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=X;const Z=this.system.getConnectedValue(x);if(Z){const X=pO(Z,x.RO,Q.position);X.no.addOnce((()=>{this._triggerCount--})),O.no.addOnce((()=>{X.dispose()}))}}},previousItem:null,nextItem:null};O._updateQueueStart?rx(Q,O._updateQueueStart):O._updateQueueStart=Q,this.output._storedValue=O}serialize(){const x=super.serialize();return x.limit=this.limit,x.delay=this.delay,x}_deserialize(x){super._deserialize(x),void 0!==x.limit&&(this.limit=x.limit),void 0!==x.delay&&(this.delay=x.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,A.b)([HO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KQ.prototype,"limit",void 0),(0,A.b)([HO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KQ.prototype,"delay",void 0),(0,o.d)("BABYLON.ParticleTriggerBlock",KQ);Q(12370),Q(12382),Q(12393),Q(12447)},12425:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12396:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12472:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneVertex",n="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12454:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12440:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogFragment",n="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12418:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12475:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogVertex",n="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12463:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogVertexDeclaration",n="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12411:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="helperFunctions",n="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12400:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12416:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="imageProcessingFunctions",n="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12408:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12433:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12484:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";X.e.IncludesShadersStoreWGSL[Z]||(X.e.IncludesShadersStoreWGSL[Z]=n)},12393:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{particlesPixelShaderWGSL:()=>V});var X=Q(10983);Q(12396),Q(12400),Q(12408),Q(12411),Q(12416),Q(12418),Q(12425),Q(12433),Q(12440);const Z="particlesPixelShader",n="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";X.e.ShadersStoreWGSL[Z]||(X.e.ShadersStoreWGSL[Z]=n);const V={name:Z,shader:n}},12447:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{particlesVertexShaderWGSL:()=>V});var X=Q(10983);Q(12454),Q(12463),Q(12408),Q(12472),Q(12475),Q(12484);const Z="particlesVertexShader",n="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";X.e.ShadersStoreWGSL[Z]||(X.e.ShadersStoreWGSL[Z]=n);const V={name:Z,shader:n}},12304:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12377:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12331:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneVertex",n="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12388:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12320:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogFragment",n="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12298:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12340:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogVertex",n="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12322:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="fogVertexDeclaration",n="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12286:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="helperFunctions",n="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12278:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12289:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="imageProcessingFunctions",n="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12284:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12312:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12345:(x,O,Q)=>{"use strict";var X=Q(10983);const Z="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";X.e.IncludesShadersStore[Z]||(X.e.IncludesShadersStore[Z]=n)},12370:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{particlesPixelShader:()=>V});var X=Q(10983);Q(12377),Q(12278),Q(12284),Q(12286),Q(12289),Q(12298),Q(12304),Q(12312),Q(12320);const Z="particlesPixelShader",n="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";X.e.ShadersStore[Z]||(X.e.ShadersStore[Z]=n);const V={name:Z,shader:n}},12382:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{particlesVertexShader:()=>V});var X=Q(10983);Q(12388),Q(12322),Q(12284),Q(12331),Q(12340),Q(12345);const Z="particlesVertexShader",n="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";X.e.ShadersStore[Z]||(X.e.ShadersStore[Z]=n);const V={name:Z,shader:n}},12747:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{FlowGraphGLTFDataProvider:()=>n});var X=Q(12726),Z=Q(12707);class n extends X.d{constructor(x){var O,Q;super();const X=x.glTF,n=(null===(O=X.animations)||void 0===O?void 0:O.map((x=>x._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",Z.d,n);const V=(null===(Q=X.nodes)||void 0===Q?void 0:Q.map((x=>x._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",Z.d,V)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12644:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>M,i:()=>a,k:()=>N,l:()=>K});var X=Q(10849),Z=Q(11383),n=Q(11133),V=Q(12648);const o=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class l{constructor(x,O){this._gltf=x,this._infoTree=O}convert(x){let O,Q=this._gltf,X=this._infoTree;if(!x.startsWith("/"))throw new Error("Path must start with a /");const Z=x.split("/");if(Z.shift(),Z[Z.length-1].includes(".length")){const x=Z[Z.length-1].split(".");Z.pop(),Z.push(...x)}let n=!1;for(const l of Z){const Z="length"===l;if(Z&&!X.__array__)throw new Error(`Path ${x} is invalid`);if(X.__ignoreObjectTree__&&(n=!0),X.__array__&&!Z)X=X.__array__;else if(X=X[l],!X)throw new Error(`Path ${x} is invalid`);if(!n)if(void 0===Q){if(!o.find((O=>O.regex.test(x))))throw new Error(`Path ${x} is invalid`)}else if(!Z){var V;Q=null===(V=Q)||void 0===V?void 0:V[l]}(X.__target__||Z)&&(O=Q)}return{object:O,info:X}}}function C(x,O,Q,X){const Z=U(x,O);return X?Z[Q][X]:Z[Q]}function U(x,O,Q){var X,n;return null===(X=x._data)||void 0===X||null===(n=X[(null===Q||void 0===Q?void 0:Q.fillMode)??Z.d.MATERIAL_TriangleFillMode])||void 0===n?void 0:n.babylonMaterial}function L(x,O){return{offset:{componentsCount:2,type:"Vector2",get:(Q,Z,n)=>{const V=C(Q,n,x,O);return new X.l(null===V||void 0===V?void 0:V.uOffset,null===V||void 0===V?void 0:V.vOffset)},getTarget:U,set:(Q,X,Z,n)=>{const V=C(X,n,x,O);V.uOffset=Q.x,V.vOffset=Q.y},getPropertyName:[()=>`${x}${O?"."+O:""}.uOffset`,()=>`${x}${O?"."+O:""}.vOffset`]},rotation:{type:"number",get:(Q,X,Z)=>{var n;return null===(n=C(Q,Z,x,O))||void 0===n?void 0:n.wAng},getTarget:U,set:(Q,X,Z,n)=>C(X,n,x,O).wAng=Q,getPropertyName:[()=>`${x}${O?"."+O:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Q,Z,n)=>{const V=C(Q,n,x,O);return new X.l(null===V||void 0===V?void 0:V.uScale,null===V||void 0===V?void 0:V.vScale)},getTarget:U,set:(Q,X,Z,n)=>{const V=C(X,n,x,O);V.uScale=Q.x,V.vScale=Q.y},getPropertyName:[()=>`${x}${O?"."+O:""}.uScale`,()=>`${x}${O?"."+O:""}.vScale`]}}}const h={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:x=>{var O,Q;return new X.l((null===(O=x._babylonCamera)||void 0===O?void 0:O.orthoLeft)??0,(null===(Q=x._babylonCamera)||void 0===Q?void 0:Q.orthoRight)??0)},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.orthoLeft=x.x,O._babylonCamera.orthoRight=x.y)},getTarget:x=>x,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:x=>{var O,Q;return new X.l((null===(O=x._babylonCamera)||void 0===O?void 0:O.orthoBottom)??0,(null===(Q=x._babylonCamera)||void 0===Q?void 0:Q.orthoTop)??0)},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.orthoBottom=x.x,O._babylonCamera.orthoTop=x.y)},getTarget:x=>x,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:x=>{var O;return null===(O=x._babylonCamera)||void 0===O?void 0:O.maxZ},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=x)},getTarget:x=>x,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:x=>{var O;return null===(O=x._babylonCamera)||void 0===O?void 0:O.lo},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.lo=x)},getTarget:x=>x,getPropertyName:[()=>"lo"]}},perspective:{aspectRatio:{type:"number",get:x=>{var O;return null===(O=x._babylonCamera)||void 0===O?void 0:O.getEngine().getAspectRatio(x._babylonCamera)},getTarget:x=>x,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:x=>{var O;return null===(O=x._babylonCamera)||void 0===O?void 0:O.fov},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.fov=x)},getTarget:x=>x,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:x=>{var O;return null===(O=x._babylonCamera)||void 0===O?void 0:O.maxZ},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=x)},getTarget:x=>x,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:x=>{var O;return null===(O=x._babylonCamera)||void 0===O?void 0:O.lo},set:(x,O)=>{O._babylonCamera&&(O._babylonCamera.lo=x)},getTarget:x=>x,getPropertyName:[()=>"lo"]}}}},nodes:{length:{type:"number",get:x=>x.length,getTarget:x=>x.map((x=>x._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Oo",get:x=>{var O;return null===(O=x._babylonTransformNode)||void 0===O?void 0:O.position},set:(x,O)=>{var Q;return null===(Q=O._babylonTransformNode)||void 0===Q?void 0:Q.position.V(x)},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:x=>{var O;return null===(O=x._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion},set:(x,O)=>{var Q,X;return null===(Q=O._babylonTransformNode)||void 0===Q||null===(X=Q.rotationQuaternion)||void 0===X?void 0:X.V(x)},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Oo",get:x=>{var O;return null===(O=x._babylonTransformNode)||void 0===O?void 0:O.Qo},set:(x,O)=>{var Q;return null===(Q=O._babylonTransformNode)||void 0===Q?void 0:Q.Qo.V(x)},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"Qo"]},weights:{length:{type:"number",get:x=>x._numMorphTargets,getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(x,O)=>{var Q,X;return void 0!==O?null===(Q=x._primitiveBabylonMeshes)||void 0===Q||null===(X=Q[0].morphTargetManager)||void 0===X?void 0:X.getTarget(O).influence:void 0},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(x,O)=>[0],getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:x=>{var O,Q,Z;return X.c.Compose(null===(O=x._babylonTransformNode)||void 0===O?void 0:O.Qo,null===(Q=x._babylonTransformNode)||void 0===Q?void 0:Q.rotationQuaternion,null===(Z=x._babylonTransformNode)||void 0===Z?void 0:Z.position)},getTarget:x=>x._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:x=>{var O,Q,Z,n;const V=X.c.Identity();let o=x.parent;for(;o&&o.parent;)o=o.parent;const l=(null===(O=x._babylonTransformNode)||void 0===O?void 0:O.position._isDirty)||(null===(Q=x._babylonTransformNode)||void 0===Q||null===(Z=Q.rotationQuaternion)||void 0===Z?void 0:Z._isDirty)||(null===(n=x._babylonTransformNode)||void 0===n?void 0:n.Qo._isDirty);if(o){var C;const O=null===(C=o._babylonTransformNode)||void 0===C?void 0:C.HV(!0).invert();var U,L;if(O)null===(U=x._babylonTransformNode)||void 0===U||null===(L=U.HV(l))||void 0===L||L.multiplyToRef(O,V)}else x._babylonTransformNode&&V.V(x._babylonTransformNode.HV(l));return V},getTarget:x=>x._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:x=>{var O,Q;return null===(O=x._babylonTransformNode)||void 0===O||null===(Q=O.getChildren((x=>x instanceof V.c),!0)[0])||void 0===Q?void 0:Q.ho},getTarget:x=>{var O;return null===(O=x._babylonTransformNode)||void 0===O?void 0:O.getChildren((x=>x instanceof V.c),!0)[0]},set:(x,O)=>{if(O._babylonTransformNode){const Q=O._babylonTransformNode.getChildren((x=>x instanceof V.c),!0)[0];Q&&(Q.ho=x)}}},color:{type:"rl",get:x=>{var O,Q;return null===(O=x._babylonTransformNode)||void 0===O||null===(Q=O.getChildren((x=>x instanceof V.c),!0)[0])||void 0===Q?void 0:Q.No},getTarget:x=>{var O;return null===(O=x._babylonTransformNode)||void 0===O?void 0:O.getChildren((x=>x instanceof V.c),!0)[0]},set:(x,O)=>{if(O._babylonTransformNode){const Q=O._babylonTransformNode.getChildren((x=>x instanceof V.c),!0)[0];Q&&(Q.No=x)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"rl",get:(x,O,Q)=>U(x,O,Q).emissiveColor,set:(x,O,Q,X)=>U(O,Q,X).emissiveColor.V(x),getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:L("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(x,O,Q)=>{var X;return null===(X=C(x,Q,"bumpTexture"))||void 0===X?void 0:X.level},set:(x,O,Q,X)=>{const Z=C(O,X,"bumpTexture");Z&&(Z.level=x)},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:L("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(x,O,Q)=>U(x,O,Q).ambientTextureStrength,set:(x,O,Q,X)=>{const Z=U(O,Q,X);Z&&(Z.ambientTextureStrength=x)},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:L("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"nh",get:(x,O,Q)=>{const X=U(x,O,Q);return n.h.FromColor3(X.albedoColor,X.alpha)},set:(x,O,Q,X)=>{const Z=U(O,Q,X);Z.albedoColor.set(x.r,x.g,x.b),Z.alpha=x.a},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:L("albedoTexture")}},metallicFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).metallic,set:(x,O,Q,X)=>{const Z=U(O,Q,X);Z&&(Z.metallic=x)},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).roughness,set:(x,O,Q,X)=>{const Z=U(O,Q,X);Z&&(Z.roughness=x)},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:L("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(x,O,Q)=>U(x,O,Q).anisotropy.ho,set:(x,O,Q,X)=>{U(O,Q,X).anisotropy.ho=x},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(x,O,Q)=>U(x,O,Q).anisotropy.angle,set:(x,O,Q,X)=>{U(O,Q,X).anisotropy.angle=x},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:L("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).clearCoat.ho,set:(x,O,Q,X)=>{U(O,Q,X).clearCoat.ho=x},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).clearCoat.roughness,set:(x,O,Q,X)=>{U(O,Q,X).clearCoat.roughness=x},getTarget:(x,O,Q)=>U(x,O,Q),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:L("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(x,O,Q)=>{var X;return null===(X=U(x,O,Q).clearCoat.bumpTexture)||void 0===X?void 0:X.level},getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).clearCoat.bumpTexture.level=x},extensions:{KHR_texture_transform:L("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:L("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(x,O,Q)=>U(x,O,Q).subSurface.dispersion,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).subSurface.dispersion=x}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(x,O,Q)=>U(x,O,Q).emissiveIntensity,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).emissiveIntensity=x}},KHR_materials_ior:{ior:{type:"number",get:(x,O,Q)=>U(x,O,Q).indexOfRefraction,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).indexOfRefraction=x}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).iridescence.ho,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).iridescence.ho=x},iridescenceIor:{type:"number",get:(x,O,Q)=>U(x,O,Q).iridescence.indexOfRefraction,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).iridescence.indexOfRefraction=x},iridescenceTexture:{extensions:{KHR_texture_transform:L("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(x,O,Q)=>U(x,O,Q).iridescence.maximumThickness,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).iridescence.maximumThickness=x},iridescenceThicknessMinimum:{type:"number",get:(x,O,Q)=>U(x,O,Q).iridescence.minimumThickness,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).iridescence.minimumThickness=x},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:L("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"rl",get:(x,O,Q)=>U(x,O,Q).sheen.color,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).sheen.color.V(x)},sheenColorTexture:{extensions:{KHR_texture_transform:L("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).sheen.ho,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).sheen.ho=x},sheenRoughnessTexture:{extensions:{KHR_texture_transform:L("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).metallicF0Factor,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).metallicF0Factor=x,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"rl",get:(x,O,Q)=>U(x,O,Q).metallicReflectanceColor,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).metallicReflectanceColor.V(x),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:L("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:L("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).subSurface.refractionIntensity,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).subSurface.refractionIntensity=x,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:L("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).subSurface.translucencyIntensity,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).subSurface.translucencyIntensity=x},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:L("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"rl",get:(x,O,Q)=>U(x,O,Q).subSurface.translucencyColor,getTarget:U,set:(x,O,Q,X)=>{var Z;return x&&(null===(Z=U(O,Q,X).subSurface.translucencyColor)||void 0===Z?void 0:Z.V(x))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:L("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"rl",get:(x,O,Q)=>U(x,O,Q).subSurface.tintColor,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).subSurface.tintColor.V(x)},attenuationDistance:{type:"number",get:(x,O,Q)=>U(x,O,Q).subSurface.tintColorAtDistance,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).subSurface.tintColorAtDistance=x},thicknessFactor:{type:"number",get:(x,O,Q)=>U(x,O,Q).subSurface.maximumThickness,getTarget:U,set:(x,O,Q,X)=>U(O,Q,X).subSurface.maximumThickness=x},thicknessTexture:{extensions:{KHR_texture_transform:L("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:x=>x.length,getTarget:x=>x.map((x=>x._babylonLight)),getPropertyName:[x=>"length"]},__array__:{__target__:!0,color:{type:"rl",get:x=>{var O;return null===(O=x._babylonLight)||void 0===O?void 0:O.No},set:(x,O)=>{var Q;return null===(Q=O._babylonLight)||void 0===Q?void 0:Q.No.V(x)},getTarget:x=>x._babylonLight,getPropertyName:[x=>"diffuse"]},ho:{type:"number",get:x=>{var O;return null===(O=x._babylonLight)||void 0===O?void 0:O.ho},set:(x,O)=>O._babylonLight?O._babylonLight.ho=x:void 0,getTarget:x=>x._babylonLight,getPropertyName:[x=>"intensity"]},range:{type:"number",get:x=>{var O;return null===(O=x._babylonLight)||void 0===O?void 0:O.range},set:(x,O)=>O._babylonLight?O._babylonLight.range=x:void 0,getTarget:x=>x._babylonLight,getPropertyName:[x=>"range"]},spot:{innerConeAngle:{type:"number",get:x=>{var O;return null===(O=x._babylonLight)||void 0===O?void 0:O.innerAngle},set:(x,O)=>O._babylonLight?O._babylonLight.innerAngle=x:void 0,getTarget:x=>x._babylonLight,getPropertyName:[x=>"innerConeAngle"]},outerConeAngle:{type:"number",get:x=>{var O;return null===(O=x._babylonLight)||void 0===O?void 0:O.angle},set:(x,O)=>O._babylonLight?O._babylonLight.angle=x:void 0,getTarget:x=>x._babylonLight,getPropertyName:[x=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:x=>x.length,getTarget:x=>x.map((x=>x._babylonLight)),getPropertyName:[x=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:x=>x.length,getTarget:x=>x.map((x=>x._babylonTexture)),getPropertyName:[x=>"length"]},__array__:{__target__:!0,ho:{type:"number",get:x=>{var O;return null===(O=x._babylonTexture)||void 0===O?void 0:O.level},set:(x,O)=>{O._babylonTexture&&(O._babylonTexture.level=x)},getTarget:x=>x._babylonTexture},rotation:{type:"Quaternion",get:x=>{var O;return x._babylonTexture&&X.g.FromRotationMatrix(null===(O=x._babylonTexture)||void 0===O?void 0:O.getReflectionTextureMatrix())},set:(x,O)=>{var Q;O._babylonTexture&&(null!==(Q=O._babylonTexture.kx())&&void 0!==Q&&Q.useRightHandedSystem||(x=X.g.Inverse(x)),X.c.FromQuaternionToRef(x,O._babylonTexture.getReflectionTextureMatrix()))},getTarget:x=>x._babylonTexture}}}}},animations:{length:{type:"number",get:x=>x.length,getTarget:x=>x.map((x=>x._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:x=>x.length,getTarget:x=>x.map((x=>{var O;return null===(O=x.primitives[0]._instanceData)||void 0===O?void 0:O.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function N(x){return new l(x,h)}function a(x){const O=x.split("/").map((x=>x.replace(/{}/g,"__array__")));let Q=h;for(const X of O)X&&(Q=Q[X]);if(Q&&Q.type&&Q.get)return Q}function K(x,O){const Q=x.split("/").map((x=>x.replace(/{}/g,"__array__")));let X=h;for(const Z of Q)Z&&(X=X[Z]);X&&X.type&&X.get&&(X.interpolation=O)}function M(x,O){const Q=x.split("/").map((x=>x.replace(/{}/g,"__array__")));let X=h;for(const Z of Q)if(Z){if(!X[Z]){if("?"===Z){X.__ignoreObjectTree__=!0;continue}X[Z]={},"__array__"===Z&&(X[Z].__target__=!0)}X=X[Z]}Object.assign(X,O)}},12656:(x,O,Q)=>{"use strict";Q.r(O),Q.d(O,{AnimationPropertyInfo:()=>C,TransformNodeAnimationPropertyInfo:()=>U,WeightAnimationPropertyInfo:()=>L,getQuaternion:()=>o,getVector3:()=>V,getWeights:()=>l});var X=Q(11538),Z=Q(10849),n=Q(12644);function V(x,O,Q,X){return Z.n.Xo(O,Q).scaleInPlace(X)}function o(x,O,Q,X){return Z.g.Xo(O,Q).scaleInPlace(X)}function l(x,O,Q,X){const Z=new Array(x._numMorphTargets);for(let n=0;n<Z.length;n++)Z[n]=O[Q++]*X;return Z}class C{constructor(x,O,Q,X){this.type=x,this.name=O,this.getValue=Q,this.getStride=X}_buildAnimation(x,O,Q){const Z=new X.b(x,this.name,O,this.type);return Z.setKeys(Q),Z}}class U extends C{buildAnimations(x,O,Q,X){const Z=[];return Z.push({babylonAnimatable:x._babylonTransformNode,babylonAnimation:this._buildAnimation(O,Q,X)}),Z}}class L extends C{buildAnimations(x,O,Q,Z){const n=[];if(x._numMorphTargets)for(let V=0;V<x._numMorphTargets;V++){const o=new X.b(`${O}_${V}`,this.name,Q,this.type);if(o.setKeys(Z.map((x=>({frame:x.frame,inTangent:x.inTangent?x.inTangent[V]:void 0,value:x.value[V],outTangent:x.outTangent?x.outTangent[V]:void 0,interpolation:x.interpolation})))),x._primitiveBabylonMeshes)for(const O of x._primitiveBabylonMeshes)if(O.morphTargetManager){const x=O.morphTargetManager.getTarget(V),Q=o.clone();x.animations.push(Q),n.push({babylonAnimatable:x,babylonAnimation:Q})}}return n}}(0,n.l)("/nodes/{}/translation",[new U(X.b.ANIMATIONTYPE_VECTOR3,"position",V,(()=>3))]),(0,n.l)("/nodes/{}/rotation",[new U(X.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",o,(()=>4))]),(0,n.l)("/nodes/{}/scale",[new U(X.b.ANIMATIONTYPE_VECTOR3,"Qo",V,(()=>3))]),(0,n.l)("/nodes/{}/weights",[new L(X.b.ANIMATIONTYPE_FLOAT,"influence",l,(x=>x._numMorphTargets))])},12603:(x,O,Q)=>{"use strict";class X{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((x,O)=>{this._resolve=x,this._reject=O}))}}var Z=Q(10849),n=Q(11133),V=Q(10894),o=Q(11206),l=Q(12608),C=Q(12622),U=Q(10882),L=Q(11378),h=Q(11538),N=Q(11545),a=Q(10877),K=Q(10905),M=Q(10912);class Y{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(x){this._useTextureToStoreBoneMatrices=x,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(x){this._animationPropertiesOverride=x}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(x,O,Q){this.name=x,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Z.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new U.b,this.bones=[],this._scene=Q||a.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const X=this._scene.getEngine().getCaps();this._canUseTextureForBones=X.textureFloat&&X.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((x=>!x.getParent()))}getTransformMatrices(x){if(this.needInitialSkinMatrix){if(!x)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return x._bonesTransformMatrices||this.prepare(!0),x._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(x){return this.needInitialSkinMatrix&&x._transformMatrixTexture?x._transformMatrixTexture:this._transformMatrixTexture}kx(){return this._scene}toString(x){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,x){O+=", Ranges: {";let x=!0;for(const Q in this._ranges)x&&(O+=", ",x=!1),O+=Q;O+="}"}return O}getBoneIndexByName(x){for(let O=0,Q=this.bones.length;O<Q;O++)if(this.bones[O].name===x)return O;return-1}createAnimationRange(x,O,Q){if(!this._ranges[x]){this._ranges[x]=new N.e(x,O,Q);for(let X=0,Z=this.bones.length;X<Z;X++)this.bones[X].animations[0]&&this.bones[X].animations[0].createRange(x,O,Q)}}deleteAnimationRange(x){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Q=0,X=this.bones.length;Q<X;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].deleteRange(x,O);this._ranges[x]=null}getAnimationRange(x){return this._ranges[x]||null}getAnimationRanges(){const x=[];let O;for(O in this._ranges)x.push(this._ranges[O]);return x}copyAnimationRange(x,O){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!x.getAnimationRange(O))return!1;let X=!0;const Z=this._getHighestAnimationFrame()+1,n={},V=x.bones;let o,l;for(l=0,o=V.length;l<o;l++)n[V[l].name]=V[l];this.bones.length!==V.length&&(K.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${V.length}`),X=!1);const C=Q&&this.dimensionsAtRest&&x.dimensionsAtRest?this.dimensionsAtRest.divide(x.dimensionsAtRest):null;for(l=0,o=this.bones.length;l<o;l++){const x=this.bones[l].name,V=n[x];V?X=X&&this.bones[l].copyAnimationRange(V,O,Z,Q,C):(K.e.Warn("copyAnimationRange: not same rig, missing source bone "+x),X=!1)}const U=x.getAnimationRange(O);return U&&(this._ranges[O]=new N.e(O,U.from+Z,U.to+Z)),X}returnToRest(){for(const x of this.bones)-1!==x._index&&x.returnToRest()}_getHighestAnimationFrame(){let x=0;for(let O=0,Q=this.bones.length;O<Q;O++)if(this.bones[O].animations[0]){const Q=this.bones[O].animations[0].getHighestFrame();x<Q&&(x=Q)}return x}beginAnimation(x,O,Q,X){const Z=this.getAnimationRange(x);return Z?this._scene.beginAnimation(this,Z.from,Z.to,O,Q,X):null}static MakeAnimationAdditive(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const X=x.getAnimationRange(Q);if(!X)return null;const Z=x._scene.getAllAnimatablesByTarget(x);let n=null;for(let o=0;o<Z.length;o++){const x=Z[o];if(x.fromFrame===(null===X||void 0===X?void 0:X.from)&&x.toFrame===(null===X||void 0===X?void 0:X.to)){n=x;break}}const V=x.getAnimatables();for(let o=0;o<V.length;o++){const x=V[o].animations;if(x)for(let X=0;X<x.length;X++)h.b.MakeAnimationAdditive(x[X],O,Q)}return n&&(n.isAdditive=!0),x}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(x){this._meshesWithPoseMatrix.push(x)}_unregisterMeshWithPoseMatrix(x){const O=this._meshesWithPoseMatrix.indexOf(x);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(x,O){this.onBeforeComputeObservable.notifyObservers(this);for(let Q=0;Q<this.bones.length;Q++){const X=this.bones[Q];X._childUpdateId++;const Z=X.getParent();if(Z?X.getLocalMatrix().multiplyToRef(Z.getFinalMatrix(),X.getFinalMatrix()):O?X.getLocalMatrix().multiplyToRef(O,X.getFinalMatrix()):X.getFinalMatrix().V(X.getLocalMatrix()),-1!==X._index){const O=null===X._index?Q:X._index;X.getAbsoluteInverseBindMatrix().multiplyToArray(X.getFinalMatrix(),x,16*O)}}this._identity.copyToArray(x,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const x=this.kx().getRenderId();if(this._currentRenderId===x)return;this._currentRenderId=x}if(this._numBonesWithLinkedTransformNode>0)for(const x of this.bones)if(x._linkedTransformNode){const O=x._linkedTransformNode;x.position=O.position,O.rotationQuaternion?x.rotationQuaternion=O.rotationQuaternion:x.rotation=O.rotation,x.Qo=O.Qo}if(this.needInitialSkinMatrix)for(const x of this._meshesWithPoseMatrix){const O=x.getPoseMatrix();let Q=this._isDirty;if(x._bonesTransformMatrices&&x._bonesTransformMatrices.length===16*(this.bones.length+1)||(x._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Q=!0),Q){if(this._synchronizedWithMesh!==x){this._synchronizedWithMesh=x;for(const x of this.bones)if(!x.getParent()){x.getBindMatrix().multiplyToRef(O,Z.j.Matrix[1]),x._updateAbsoluteBindMatrices(Z.j.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);x._transformMatrixTexture&&x._transformMatrixTexture.getSize().width===O||(x._transformMatrixTexture&&x._transformMatrixTexture.dispose(),x._transformMatrixTexture=L.b.CreateRGBATexture(x._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(x._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&x._transformMatrixTexture&&x._transformMatrixTexture.update(x._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=L.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let x=0;x<this.bones.length;x++)this._animatables.push(this.bones[x])}return this._animatables}clone(x,O){const Q=new Y(x,O||x,this._scene);Q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let X=0;X<this.bones.length;X++){const x=this.bones[X];let O=null;const Z=x.getParent();if(Z){const x=this.bones.indexOf(Z);O=Q.bones[x]}const n=new C.c(x.name,Q,O,x.getBindMatrix().clone(),x.getRestMatrix().clone());n._index=x._index,x._linkedTransformNode&&n.linkTransformNode(x._linkedTransformNode),M.b.DeepCopy(x.animations,n.animations)}if(this._ranges){Q._ranges={};for(const x in this._ranges){const O=this._ranges[x];O&&(Q._ranges[x]=O.clone())}}return this._isDirty=!0,Q.prepare(!0),Q}enableBlending(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const O of this.bones)for(const Q of O.animations)Q.enableBlending=!0,Q.blendingSpeed=x}dispose(){if(this._meshesWithPoseMatrix.length=0,this.kx().stopAnimation(this),this.kx().removeSkeleton(this),this._parentContainer){const x=this._parentContainer.skeletons.indexOf(this);x>-1&&this._parentContainer.skeletons.splice(x,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const x={};x.name=this.name,x.id=this.id,this.dimensionsAtRest&&(x.dimensionsAtRest=this.dimensionsAtRest.mV()),x.bones=[],x.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){var O;const X=this.bones[Q],Z=X.getParent(),n={parentBoneIndex:Z?this.bones.indexOf(Z):-1,index:X.getIndex(),name:X.name,id:X.id,matrix:X.getBindMatrix().mV(),rest:X.getRestMatrix().mV(),linkedTransformNodeId:null===(O=X.getTransformNode())||void 0===O?void 0:O.id};x.bones.push(n),X.length&&(n.length=X.length),X.metadata&&(n.metadata=X.metadata),X.animations&&X.animations.length>0&&(n.animation=X.animations[0].serialize()),x.ranges=[];for(const O in this._ranges){const Q=this._ranges[O];if(!Q)continue;const X={};X.name=O,X.from=Q.from,X.to=Q.to,x.ranges.push(X)}}return x}static Parse(x,O){const Q=new Y(x.name,x.id,O);let X;for(x.dimensionsAtRest&&(Q.dimensionsAtRest=Z.n.Xo(x.dimensionsAtRest)),Q.needInitialSkinMatrix=x.needInitialSkinMatrix,X=0;X<x.bones.length;X++){const O=x.bones[X],n=x.bones[X].index;let V=null;O.parentBoneIndex>-1&&(V=Q.bones[O.parentBoneIndex]);const o=O.rest?Z.c.Xo(O.rest):null,l=new C.c(O.name,Q,V,Z.c.Xo(O.matrix),o,null,n);void 0!==O.id&&null!==O.id&&(l.id=O.id),O.length&&(l.length=O.length),O.metadata&&(l.metadata=O.metadata),O.animation&&l.animations.push(h.b.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(Q._hasWaitingData=!0,l._waitingTransformNodeId=O.linkedTransformNodeId)}if(x.ranges)for(X=0;X<x.ranges.length;X++){const O=x.ranges[X];Q.createAnimationRange(O.name,O.from,O.to)}return Q}computeAbsoluteMatrices(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||x)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(x)}getPoseMatrix(){let x=null;return this._meshesWithPoseMatrix.length>0&&(x=this._meshesWithPoseMatrix[0].getPoseMatrix()),x}sortBones(){const x=[],O=new Array(this.bones.length);for(let Q=0;Q<this.bones.length;Q++)this._sortBones(Q,x,O);this.bones=x}_sortBones(x,O,Q){if(Q[x])return;Q[x]=!0;const X=this.bones[x];if(!X)return;void 0===X._index&&(X._index=x);const Z=X.getParent();Z&&this._sortBones(this.bones.indexOf(Z),O,Q),O.push(X)}setCurrentPoseAsRest(){for(const x of this.bones)x.setCurrentPoseAsRest()}}var g=Q(11031),v=Q(11398),R=Q(11335),s=Q(11158),q=Q(11060),G=Q(11222),k=Q(11172),J=Q(11201),t=Q(11553),c=Q(11212),d=Q(12567);class u{set areUpdatesFrozen(x){x?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new c.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,x||(x=a.c.LastCreatedScene),this._scene=x,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const x=this._scene.getEngine().getCaps();this._canUseTextureForTargets=x.canUseGLVertexID&&x.textureFloat&&x.maxVertexTextureImageUnits>0&&x.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return u.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?u.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(x){this._numMaxInfluencers!==x&&(this._numMaxInfluencers=x,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(x){this._useTextureToStoreTargets!==x&&(this._useTextureToStoreTargets=x,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var x;return u.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(x=this._scene)&&void 0!==x&&x.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(x){return this._activeTargets.data[x]}getTarget(x){return this._targets[x]}getTargetByName(x){for(const O of this._targets)if(O.name===x)return O;return null}addTarget(x){this._targets.push(x),this._targetInfluenceChangedObservers.push(x.onInfluenceChanged.add((x=>{this.areUpdatesFrozen&&x&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(x)}))),this._targetDataLayoutChangedObservers.push(x._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(x){const O=this._targets.indexOf(x);O>=0&&(this._targets.splice(O,1),x.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),x._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(x)}_bind(x){x.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),x.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),x.setTexture("morphTargets",this._targetStoreTexture),x.setInt("morphTargetCount",this.numInfluencers)}clone(){const x=new u(this._scene);for(const O of this._targets)x.addTarget(O.clone());return x.enablePositionMorphing=this.enablePositionMorphing,x.enableNormalMorphing=this.enableNormalMorphing,x.enableTangentMorphing=this.enableTangentMorphing,x.enableUVMorphing=this.enableUVMorphing,x.enableUV2Morphing=this.enableUV2Morphing,x.enableColorMorphing=this.enableColorMorphing,x}serialize(){const x={};x.id=this.uniqueId,x.targets=[];for(const O of this._targets)x.targets.push(O.serialize());return x}_syncActiveTargets(){let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const O=!!this._targetStoreTexture,Q=this.isUsingTextureForTargets;(this._mustSynchronize||O!==Q)&&(this._mustSynchronize=!1,this.synchronize());let X=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Z=-1;for(const n of this._targets)if(Z++,0!==n.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=u.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(n),this._morphTargetTextureIndices[X]=Z,this._tempInfluences[X++]=n.influence}this._morphTargetTextureIndices.length!==X&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,X)),this._influences&&this._influences.length===X||(this._influences=new Float32Array(X));for(let n=0;n<X;n++)this._influences[n]=this._tempInfluences[n];if(x&&this._scene)for(const n of this._scene.meshes)n.morphTargetManager===this&&(Q?n._markSubMeshesAsAttributesDirty():n._syncGeometryWithMorphTargetManager())}synchronize(){var x;if(!this._scene||this.areUpdatesFrozen)return;const O=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(x=this._targetStoreTexture)||void 0===x||x.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>O.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Q of this._targets){this._supportsPositions=this._supportsPositions&&Q.hasPositions,this._supportsNormals=this._supportsNormals&&Q.hasNormals,this._supportsTangents=this._supportsTangents&&Q.hasTangents,this._supportsUVs=this._supportsUVs&&Q.hasUVs,this._supportsUV2s=this._supportsUV2s&&Q.hasUV2s,this._supportsColors=this._supportsColors&&Q.hasColors;const x=Q.vertexCount;if(0===this._vertexCount)this._vertexCount=x;else if(this._vertexCount!==x)return void K.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Q.name}": ${x}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const x=O.getCaps().maxTextureSize;this._textureWidth>x&&(this._textureHeight=Math.ceil(this._textureWidth/x),this._textureWidth=x);const Q=this._targets.length,X=new Float32Array(Q*this._textureWidth*this._textureHeight*4);let Z=0;for(let O=0;O<Q;O++){const x=this._targets[O],Q=x.getPositions(),n=x.getNormals(),V=x.getUVs(),o=x.getTangents(),l=x.getUV2s(),C=x.getColors();Z=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)this._supportsPositions&&Q&&(X[Z]=Q[3*O],X[Z+1]=Q[3*O+1],X[Z+2]=Q[3*O+2],Z+=4),this._supportsNormals&&n&&(X[Z]=n[3*O],X[Z+1]=n[3*O+1],X[Z+2]=n[3*O+2],Z+=4),this._supportsUVs&&V&&(X[Z]=V[2*O],X[Z+1]=V[2*O+1],Z+=4),this._supportsTangents&&o&&(X[Z]=o[3*O],X[Z+1]=o[3*O+1],X[Z+2]=o[3*O+2],Z+=4),this._supportsUV2s&&l&&(X[Z]=l[2*O],X[Z+1]=l[2*O+1],Z+=4),this._supportsColors&&C&&(X[Z]=C[4*O],X[Z+1]=C[4*O+1],X[Z+2]=C[4*O+2],X[Z+3]=C[4*O+3],Z+=4)}this._targetStoreTexture=d.c.CreateRGBATexture(X,this._textureWidth,this._textureHeight,Q,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Q of this._scene.meshes)Q.morphTargetManager===this&&Q._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const x=this._parentContainer.morphTargetManagers.indexOf(this);x>-1&&this._parentContainer.morphTargetManagers.splice(x,1),this._parentContainer=null}for(const x of this._targets)this._scene.stopAnimation(x)}}static Parse(x,O){const Q=new u(O);for(const X of x.targets)Q.addTarget(t.e.Parse(X,O));return Q}}u.EnableTextureStorage=!0,u.MaxActiveMorphTargetsInVertexAttributeMode=8,u.ConstantTargetCountForTextureMode=0;var A=Q(12629),f=Q(10934),E=Q(11088);const z=new Map,F=z;function b(x,O,Q){D(x)&&K.e.Warn(`Extension with the name '${x}' already exists`),z.set(x,{isGLTFExtension:O,factory:Q})}function D(x){return z.delete(x)}var W=Q(12644),y=Q(11618),I=Q(11077);class r{static Get(x,O,Q){if(!O||void 0==Q||!O[Q])throw new Error(`${x}: Failed to find index (${Q})`);return O[Q]}static TryGet(x,O){return x&&void 0!=O&&x[O]?x[O]:null}static Assign(x){if(x)for(let O=0;O<x.length;O++)x[O].index=O}}function j(x){if(x.min&&x.max){const O=x.min,Q=x.max,X=Z.j.Oo[0].xo(O[0],O[1],O[2]),n=Z.j.Oo[1].xo(Q[0],Q[1],Q[2]);if(x.normalized&&5126!==x.componentType){let O=1;switch(x.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}const Q=1/O;X.scaleInPlace(Q),n.scaleInPlace(Q)}return new E.c(X,n)}return null}class T{static RegisterExtension(x,O){b(x,!1,O)}static UnregisterExtension(x){return D(x)}get oo(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(x){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=x}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((x=>x.dispose&&x.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(x,O,Q,X,Z,n){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=O,this._assetContainer=Q,this._loadData(X);let n=null;if(x){const O={};if(this._gltf.nodes)for(const x of this._gltf.nodes)x.name&&(O[x.name]=x.index);n=(x instanceof Array?x:[x]).map((x=>{const Q=O[x];if(void 0===Q)throw new Error(`Failed to find node '${x}'`);return Q}))}return await this._loadAsync(Z,V,n,(()=>({meshes:this._getMeshes(),fL:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(x,O,Q,X){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=x,this._loadData(O),await this._loadAsync(Q,Z,null,(()=>{}))}async _loadAsync(x,O,Q,X){return await Promise.resolve().then((async()=>{this._rootUrl=x,this._uniqueRootUrl=!x.startsWith("file:")&&O?x:`${x}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const Z=`${A.l[A.l.LOADING]} => ${A.l[A.l.READY]}`,n=`${A.l[A.l.LOADING]} => ${A.l[A.l.COMPLETE]}`;this._parent._startPerformanceCounter(Z),this._parent._startPerformanceCounter(n),this._parent._setState(A.l.LOADING),this._extensionsOnLoading();const o=new Array;if(!this.parent.loadOnlyMaterials)if(Q)o.push(this.loadSceneAsync("/nodes",{nodes:Q,index:-1}));else if(void 0!=this._gltf.RO||this._gltf.scenes&&this._gltf.scenes[0]){const x=r.Get("/scene",this._gltf.scenes,this._gltf.RO||0);o.push(this.loadSceneAsync(`/scenes/${x.index}`,x))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let x=0;x<this._gltf.materials.length;++x){const O=this._gltf.materials[x],Q="/materials/"+x,X=g.e.TriangleFillMode;o.push(this._loadMaterialAsync(Q,O,null,X,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&o.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&o.push(this._compileShadowGeneratorsAsync());const l=Promise.all(o).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Jo(!0);for(const x of this._babylonScene.materials){const O=x;void 0!==O.maxSimultaneousLights&&(O.maxSimultaneousLights=Math.max(O.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(A.l.READY),this._skipStartAnimationStep||this._startAnimations(),X()}));return await l.then((x=>(this._parent._endPerformanceCounter(Z),V.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(n),this._parent._setState(A.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(x=>{this._parent.onErrorObservable.notifyObservers(x),this._parent.onErrorObservable.clear(),this.dispose()}))})),x)))})).catch((x=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(x),this._parent.onErrorObservable.clear(),this.dispose()),x}))}_loadData(x){if(this._gltf=x.json,this._setupData(),x.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const Q=O[0];(Q.byteLength<x.bin.byteLength-3||Q.byteLength>x.bin.byteLength)&&K.e.Warn(`Binary buffer length (${Q.byteLength}) from JSON does not match chunk length (${x.bin.byteLength})`),this._bin=x.bin}else K.e.Warn("Unexpected BIN chunk")}}_setupData(){if(r.Assign(this._gltf.accessors),r.Assign(this._gltf.animations),r.Assign(this._gltf.buffers),r.Assign(this._gltf.bufferViews),r.Assign(this._gltf.cameras),r.Assign(this._gltf.images),r.Assign(this._gltf.materials),r.Assign(this._gltf.meshes),r.Assign(this._gltf.nodes),r.Assign(this._gltf.samplers),r.Assign(this._gltf.scenes),r.Assign(this._gltf.skins),r.Assign(this._gltf.textures),this._gltf.nodes){const x={};for(const Q of this._gltf.nodes)if(Q.children)for(const O of Q.children)x[O]=Q.index;const O=this._createRootNode();for(const Q of this._gltf.nodes){const X=x[Q.index];Q.parent=void 0===X?O:this._gltf.nodes[X]}}}async _loadExtensionsAsync(){const x=[];if(F.forEach(((O,Q)=>{var X;!1===(null===(X=this.parent.extensionOptions[Q])||void 0===X?void 0:X.enabled)?O.isGLTFExtension&&this.isExtensionUsed(Q)&&K.e.Warn(`Extension ${Q} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(Q)||x.push((async()=>{const x=await O.factory(this);return x.name!==Q&&K.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${x.name} !== ${Q}`),this._parent.onExtensionLoadedObservable.notifyObservers(x),x})())})),this._extensions.push(...await Promise.all(x)),this._extensions.sort(((x,O)=>(x.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Q of this._gltf.extensionsRequired){if(!this._extensions.some((x=>x.name===Q&&x.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[Q])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${Q} is disabled`);throw new Error(`Required extension ${Q} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new J.b("__root__",this._babylonScene);this._rootBabylonMesh=x,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Jo(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.h.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],T._LoadTransform(O,this._rootBabylonMesh));break;case A.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(x),O}loadSceneAsync(x,O){const Q=this._extensionsLoadSceneAsync(x,O);if(Q)return Q;const X=new Array;if(this.logOpen(`${x} ${O.name||""}`),O.nodes)for(const Z of O.nodes){const O=r.Get(`${x}/nodes/${Z}`,this._gltf.nodes,Z);X.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(x=>{x.parent=this._rootBabylonMesh})))}for(const Z of this._postSceneLoadActions)Z();return X.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(X).then((()=>{}))}_forEachPrimitive(x,O){if(x._primitiveBabylonMeshes)for(const Q of x._primitiveBabylonMeshes)O(Q)}_getGeometries(){const x=[],O=this._gltf.nodes;if(O)for(const Q of O)this._forEachPrimitive(Q,(O=>{const Q=O.SV;Q&&-1===x.indexOf(Q)&&x.push(Q)}));return x}_getMeshes(){const x=[];this._rootBabylonMesh instanceof k.c&&x.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const Q of O)this._forEachPrimitive(Q,(O=>{x.push(O)}));return x}_getTransformNodes(){const x=[],O=this._gltf.nodes;if(O)for(const Q of O)Q._babylonTransformNode&&"oh"===Q._babylonTransformNode.getClassName()&&x.push(Q._babylonTransformNode),Q._babylonTransformNodeForSkin&&x.push(Q._babylonTransformNodeForSkin);return x}_getSkeletons(){const x=[],O=this._gltf.skins;if(O)for(const Q of O)Q._data&&x.push(Q._data.babylonSkeleton);return x}_getAnimationGroups(){const x=[],O=this._gltf.animations;if(O)for(const Q of O)Q._babylonAnimationGroup&&x.push(Q._babylonAnimationGroup);return x}_startAnimations(){switch(this._parent.animationStartMode){case A.f.NONE:break;case A.f.FIRST:{const x=this._getAnimationGroups();0!==x.length&&x[0].start(!0);break}case A.f.ALL:{const x=this._getAnimationGroups();for(const O of x)O.start(!0);break}default:return void K.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadNodeAsync(x,O,Q);if(X)return X;if(O._babylonTransformNode)throw new Error(`${x}: Invalid recursive node hierarchy`);const Z=new Array;this.logOpen(`${x} ${O.name||""}`);const n=X=>{if(T.AddPointerMetadata(X,x),T._LoadTransform(O,X),void 0!=O.camera){const Q=r.Get(`${x}/camera`,this._gltf.cameras,O.camera);Z.push(this.loadCameraAsync(`/cameras/${Q.index}`,Q,(x=>{x.parent=X,this._babylonScene.useRightHandedSystem||(X.Qo.x=-1)})))}if(O.children)for(const Q of O.children){const O=r.Get(`${x}/children/${Q}`,this._gltf.nodes,Q);Z.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(x=>{x.parent=X})))}Q(X)},V=void 0!=O.mesh,o=this._parent.loadSkins&&void 0!=O.skin;if(!V||o){const x=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new s.c(x,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=Q:O._babylonTransformNodeForSkin=Q,n(Q)}if(V)if(o){const Q=r.Get(`${x}/mesh`,this._gltf.meshes,O.mesh);Z.push(this._loadMeshAsync(`/meshes/${Q.index}`,O,Q,(Q=>{const X=O._babylonTransformNodeForSkin;Q.metadata=(0,y.d)(X.metadata,Q.metadata||{});const n=r.Get(`${x}/skin`,this._gltf.skins,O.skin);Z.push(this._loadSkinAsync(`/skins/${n.index}`,O,n,(x=>{this._forEachPrimitive(O,(O=>{O.skeleton=x})),this._postSceneLoadActions.push((()=>{if(void 0!=n.skeleton){const x=r.Get(`/skins/${n.index}/skeleton`,this._gltf.nodes,n.skeleton).parent;O.index===x.index?Q.parent=X.parent:Q.parent=x._babylonTransformNode}else Q.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:X,skinnedNode:Q})}))})))})))}else{const Q=r.Get(`${x}/mesh`,this._gltf.meshes,O.mesh);Z.push(this._loadMeshAsync(`/meshes/${Q.index}`,O,Q,n))}return this.logClose(),Promise.all(Z).then((()=>(this._forEachPrimitive(O,(x=>{const O=x;!O.isAnInstance&&O.SV&&O.SV.useBoundingInfoFromGeometry?x.Dx():x.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(x,O,Q,X){const Z=Q.primitives;if(!Z||!Z.length)throw new Error(`${x}: Primitives are missing`);void 0==Z[0].index&&r.Assign(Z);const n=new Array;this.logOpen(`${x} ${Q.name||""}`);const V=O.name||`node${O.index}`;if(1===Z.length){const X=Q.primitives[0];n.push(this._loadMeshPrimitiveAsync(`${x}/primitives/${X.index}`,V,O,Q,X,(x=>{O._babylonTransformNode=x,O._primitiveBabylonMeshes=[x]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new s.c(V,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const X of Z)n.push(this._loadMeshPrimitiveAsync(`${x}/primitives/${X.index}`,`${V}_primitive${X.index}`,O,Q,X,(x=>{x.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(x)})))}return X(O._babylonTransformNode),this.logClose(),Promise.all(n).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(x,O,Q,X,Z,n){const V=this._extensionsLoadMeshPrimitiveAsync(x,O,Q,X,Z,n);if(V)return V;this.logOpen(`${x}`);const o=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Q.skin&&!X.primitives[0].targets;let l,C;if(o&&Z._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=Z._instanceData.babylonSourceMesh.createInstance(O),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=Z._instanceData.promise;else{const n=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new J.b(O,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.sideOrientation=this._babylonScene.useRightHandedSystem?g.e.CounterClockWiseSideOrientation:g.e.ClockWiseSideOrientation,this._createMorphTargets(x,Q,X,Z,V),n.push(this._loadVertexDataAsync(x,Z,V).then((async O=>await this._loadMorphTargetsAsync(x,Z,V,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.Fx(V),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const U=T._GetDrawMode(x,Z.mode);if(void 0==Z.material){let x=this._defaultBabylonMaterialData[U];x||(x=this._createDefaultMaterial("__GLTFLoader._default",U),this._parent.onMaterialLoadedObservable.notifyObservers(x),this._defaultBabylonMaterialData[U]=x),V.material=x}else if(!this.parent.skipMaterials){const O=r.Get(`${x}/material`,this._gltf.materials,Z.material);n.push(this._loadMaterialAsync(`/materials/${O.index}`,O,V,U,(x=>{V.material=x})))}C=Promise.all(n),o&&(Z._instanceData={babylonSourceMesh:V,promise:C}),l=V}return T.AddPointerMetadata(l,x),this._parent.onMeshLoadedObservable.notifyObservers(l),n(l),this.logClose(),C.then((()=>l))}_loadVertexDataAsync(x,O,Q){const X=this._extensionsLoadVertexDataAsync(x,O,Q);if(X)return X;const Z=O.attributes;if(!Z)throw new Error(`${x}: Attributes are missing`);const n=new Array,V=new G.d(Q.name,this._babylonScene);if(void 0==O.indices)Q.isUnIndexed=!0;else{const Q=r.Get(`${x}/indices`,this._gltf.accessors,O.indices);n.push(this._loadIndicesAccessorAsync(`/accessors/${Q.index}`,Q).then((x=>{V.setIndices(x)})))}const o=(O,X,o)=>{if(void 0==Z[O])return;Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(X)&&Q._delayInfo.push(X);const l=r.Get(`${x}/attributes/${O}`,this._gltf.accessors,Z[O]);n.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,X).then((x=>{if(x.getKind()===q.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Q.skeleton){const x=j(l);x&&(V._boundingInfo=x,V.useBoundingInfoFromGeometry=!0)}V.setVerticesBuffer(x,l.count)}))),X==q.g.MatricesIndicesExtraKind&&(Q.numBoneInfluencers=8),o&&o(l)};return o("POSITION",q.g.PositionKind),o("NORMAL",q.g.NormalKind),o("TANGENT",q.g.TangentKind),o("TEXCOORD_0",q.g.UVKind),o("TEXCOORD_1",q.g.UV2Kind),o("TEXCOORD_2",q.g.UV3Kind),o("TEXCOORD_3",q.g.UV4Kind),o("TEXCOORD_4",q.g.UV5Kind),o("TEXCOORD_5",q.g.UV6Kind),o("JOINTS_0",q.g.MatricesIndicesKind),o("WEIGHTS_0",q.g.MatricesWeightsKind),o("JOINTS_1",q.g.MatricesIndicesExtraKind),o("WEIGHTS_1",q.g.MatricesWeightsExtraKind),o("COLOR_0",q.g.ColorKind,(x=>{"VEC4"===x.type&&(Q.hasVertexAlpha=!0)})),Promise.all(n).then((()=>V))}_createMorphTargets(x,O,Q,X,Z){if(!X.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=X.targets.length;else if(X.targets.length!==O._numMorphTargets)throw new Error(`${x}: Primitives do not have the same number of targets`);const n=Q.extras?Q.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,Z.morphTargetManager=new u(this._babylonScene),Z.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.morphTargetManager.areUpdatesFrozen=!0;for(let V=0;V<X.targets.length;V++){const x=O.weights?O.weights[V]:Q.weights?Q.weights[V]:0,X=n?n[V]:`morphTarget${V}`;Z.morphTargetManager.addTarget(new t.e(X,x,Z.kx()))}}_loadMorphTargetsAsync(x,O,Q,X){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const Z=new Array,n=Q.morphTargetManager;for(let V=0;V<n.numTargets;V++){const Q=n.getTarget(V);Z.push(this._loadMorphTargetVertexDataAsync(`${x}/targets/${V}`,X,O.targets[V],Q))}return Promise.all(Z).then((()=>{n.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(x,O,Q,X){const Z=new Array,n=(X,n,V)=>{if(void 0==Q[X])return;const o=O.getVertexBuffer(n);if(!o)return;const l=r.Get(`${x}/${X}`,this._gltf.accessors,Q[X]);Z.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((x=>{V(o,x)})))};return n("POSITION",q.g.PositionKind,((x,O)=>{const Q=new Float32Array(O.length);x.forEach(O.length,((x,X)=>{Q[X]=O[X]+x})),X.setPositions(Q)})),n("NORMAL",q.g.NormalKind,((x,O)=>{const Q=new Float32Array(O.length);x.forEach(Q.length,((x,X)=>{Q[X]=O[X]+x})),X.setNormals(Q)})),n("TANGENT",q.g.TangentKind,((x,O)=>{const Q=new Float32Array(O.length/3*4);let Z=0;x.forEach(O.length/3*4,((x,X)=>{(X+1)%4!==0&&(Q[Z]=O[Z]+x,Z++)})),X.setTangents(Q)})),n("TEXCOORD_0",q.g.UVKind,((x,O)=>{const Q=new Float32Array(O.length);x.forEach(O.length,((x,X)=>{Q[X]=O[X]+x})),X.setUVs(Q)})),n("TEXCOORD_1",q.g.UV2Kind,((x,O)=>{const Q=new Float32Array(O.length);x.forEach(O.length,((x,X)=>{Q[X]=O[X]+x})),X.setUV2s(Q)})),n("COLOR_0",q.g.ColorKind,((O,Q)=>{let Z=null;const n=O.getSize();if(3===n){Z=new Float32Array(Q.length/3*4),O.forEach(Q.length,((x,O)=>{const X=Math.floor(O/3),n=O%3;Z[4*X+n]=Q[3*X+n]+x}));for(let x=0;x<Q.length/3;++x)Z[4*x+3]=1}else{if(4!==n)throw new Error(`${x}: Invalid number of components (${n}) for COLOR_0 attribute`);Z=new Float32Array(Q.length),O.forEach(Q.length,((x,O)=>{Z[O]=Q[O]+x}))}X.setColors(Z)})),await Promise.all(Z).then((()=>{}))}static _LoadTransform(x,O){if(void 0!=x.skin)return;let Q=Z.n.Zero(),X=Z.g.Identity(),n=Z.n.One();if(x.matrix){Z.c.Xo(x.matrix).decompose(n,X,Q)}else x.translation&&(Q=Z.n.Xo(x.translation)),x.rotation&&(X=Z.g.Xo(x.rotation)),x.scale&&(n=Z.n.Xo(x.scale));O.position=Q,O.rotationQuaternion=X,O.Qo=n}_loadSkinAsync(x,O,Q,X){if(!this._parent.loadSkins)return Promise.resolve();const Z=this._extensionsLoadSkinAsync(x,O,Q);if(Z)return Z;if(Q._data)return X(Q._data.babylonSkeleton),Q._data.promise;const n=`skeleton${Q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new Y(Q.name||n,n,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(x,Q,V);const o=this._loadSkinInverseBindMatricesDataAsync(x,Q).then((x=>{this._updateBoneMatrices(V,x)}));return Q._data={babylonSkeleton:V,promise:o},X(V),o}_loadBones(x,O,Q){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Q=this._findSkeletonRootNode(`${x}/joints`,O.joints);if(Q)if(void 0===O.skeleton)O.skeleton=Q.index;else{const X=(x,O)=>{for(;O.parent;O=O.parent)if(O.parent===x)return!0;return!1},Z=r.Get(`${x}/skeleton`,this._gltf.nodes,O.skeleton);Z===Q||X(Z,Q)||(K.e.Warn(`${x}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=Q.index)}else K.e.Warn(`${x}: Failed to find common root`)}const X={};for(const Z of O.joints){const n=r.Get(`${x}/joints/${Z}`,this._gltf.nodes,Z);this._loadBone(n,O,Q,X)}}_findSkeletonRootNode(x,O){if(0===O.length)return null;const Q={};for(const Z of O){const O=[];let X=r.Get(`${x}/${Z}`,this._gltf.nodes,Z);for(;-1!==X.index;)O.unshift(X),X=X.parent;Q[Z]=O}let X=null;for(let Z=0;;++Z){let x=Q[O[0]];if(Z>=x.length)return X;const n=x[Z];for(let V=1;V<O.length;++V)if(x=Q[O[V]],Z>=x.length||n!==x[Z])return X;X=n}}_loadBone(x,O,Q,X){x._isJoint=!0;let Z=X[x.index];if(Z)return Z;let n=null;x.index!==O.skeleton&&(x.parent&&-1!==x.parent.index?n=this._loadBone(x.parent,O,Q,X):void 0!==O.skeleton&&K.e.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const V=O.joints.indexOf(x.index);return Z=new C.c(x.name||`joint${x.index}`,Q,n,this._getNodeMatrix(x),null,null,V),X[x.index]=Z,this._postSceneLoadActions.push((()=>{Z.linkTransformNode(x._babylonTransformNode)})),Z}_loadSkinInverseBindMatricesDataAsync(x,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const Q=r.Get(`${x}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)}_updateBoneMatrices(x,O){for(const Q of x.bones){const x=Z.c.Identity(),X=Q._index;O&&-1!==X&&(Z.c.FromArrayToRef(O,16*X,x),x.invertToRef(x));const n=Q.getParent();n&&x.multiplyToRef(n.getAbsoluteInverseBindMatrix(),x),Q.Vo(x,!1,!1),Q._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(x){return x.matrix?Z.c.Xo(x.matrix):Z.c.Compose(x.scale?Z.n.Xo(x.scale):Z.n.One(),x.rotation?Z.g.Xo(x.rotation):Z.g.Identity(),x.translation?Z.n.Xo(x.translation):Z.n.Zero())}loadCameraAsync(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadCameraAsync(x,O,Q);if(X)return X;const n=new Array;this.logOpen(`${x} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new l.b(O.name||`camera${O.index}`,Z.n.Zero(),this._babylonScene,!1);switch(V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonCamera=V,V.setTarget(new Z.n(0,0,-1)),O.type){case"perspective":{const Q=O.perspective;if(!Q)throw new Error(`${x}: Camera perspective properties are missing`);V.fov=Q.yfov,V.lo=Q.znear,V.maxZ=Q.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${x}: Camera orthographic properties are missing`);V.mode=o.e.ORTHOGRAPHIC_CAMERA,V.orthoLeft=-O.orthographic.xmag,V.orthoRight=O.orthographic.xmag,V.orthoBottom=-O.orthographic.ymag,V.orthoTop=O.orthographic.ymag,V.lo=O.orthographic.znear,V.maxZ=O.orthographic.zfar;break;default:throw new Error(`${x}: Invalid camera type (${O.type})`)}return T.AddPointerMetadata(V,x),this._parent.onCameraLoadedObservable.notifyObservers(V),Q(V),this.logClose(),Promise.all(n).then((()=>V))}_loadAnimationsAsync(){const x=this._gltf.animations;if(!x)return Promise.resolve();const O=new Array;for(let Q=0;Q<x.length;Q++){const X=x[Q];O.push(this.loadAnimationAsync(`/animations/${X.index}`,X).then((x=>{0===x.targetedAnimations.length&&x.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(x,O){const X=this._extensionsLoadAnimationAsync(x,O);return X||Q.e(58).then(Q.bind(Q,14144)).then((Q=>{let{AnimationGroup:X}=Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new X(O.name||`animation${O.index}`,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=Z;const n=new Array;r.Assign(O.channels),r.Assign(O.samplers);for(const V of O.channels)n.push(this._loadAnimationChannelAsync(`${x}/channels/${V.index}`,x,O,V,((x,O)=>{x.animations=x.animations||[],x.animations.push(O),Z.addTargetedAnimation(O,x)})));return Promise.all(n).then((()=>(Z.normalize(0),Z)))}))}async _loadAnimationChannelAsync(x,O,X,Z,n){const V=this._extensionsLoadAnimationChannelAsync(x,O,X,Z,n);if(V)return await V;if(void 0==Z.target.node)return await Promise.resolve();const o=r.Get(`${x}/target/node`,this._gltf.nodes,Z.target.node),l=Z.target.path,C="weights"===l;if(C&&!o._numMorphTargets||!C&&!o._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!o._isJoint)return await Promise.resolve();let U;switch(await Promise.resolve().then(Q.bind(Q,12656)),l){case"translation":var L;U=null===(L=(0,W.i)("/nodes/{}/translation"))||void 0===L?void 0:L.interpolation;break;case"rotation":var h;U=null===(h=(0,W.i)("/nodes/{}/rotation"))||void 0===h?void 0:h.interpolation;break;case"scale":var N;U=null===(N=(0,W.i)("/nodes/{}/scale"))||void 0===N?void 0:N.interpolation;break;case"weights":var a;U=null===(a=(0,W.i)("/nodes/{}/weights"))||void 0===a?void 0:a.interpolation;break;default:throw new Error(`${x}/target/path: Invalid value (${Z.target.path})`)}if(!U)throw new Error(`${x}/target/path: Could not find interpolation properties for target path (${Z.target.path})`);const K={object:o,info:U};return await this._loadAnimationChannelFromTargetInfoAsync(x,O,X,Z,K,n)}_loadAnimationChannelFromTargetInfoAsync(x,O,Q,X,Z,n){const V=this.parent.targetFps,o=1/V,l=r.Get(`${x}/sampler`,Q.samplers,X.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${X.sampler}`,l).then((x=>{let O=0;const l=Z.object,C=Z.info;for(const Z of C){const C=Z.getStride(l),U=x.input,L=x.output,h=new Array(U.length);let N=0;switch(x.interpolation){case"STEP":for(let x=0;x<U.length;x++){const O=Z.getValue(l,L,N,1);N+=C,h[x]={frame:U[x]*V,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let x=0;x<U.length;x++){const O=Z.getValue(l,L,N,o);N+=C;const Q=Z.getValue(l,L,N,1);N+=C;const X=Z.getValue(l,L,N,o);N+=C,h[x]={frame:U[x]*V,inTangent:O,value:Q,outTangent:X}}break;case"LINEAR":for(let x=0;x<U.length;x++){const O=Z.getValue(l,L,N,1);N+=C,h[x]={frame:U[x]*V,value:O}}}if(N>0){const x=`${Q.name||`animation${Q.index}`}_channel${X.index}_${O}`,o=Z.buildAnimations(l,x,V,h);for(const Q of o)O++,n(Q.babylonAnimatable,Q.babylonAnimation)}}}))}_loadAnimationSamplerAsync(x,O){if(O._data)return O._data;const Q=O.interpolation||"LINEAR";switch(Q){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${x}/interpolation: Invalid value (${O.interpolation})`)}const X=r.Get(`${x}/input`,this._gltf.accessors,O.input),Z=r.Get(`${x}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${X.index}`,X),this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z)]).then((x=>{let[O,X]=x;return{input:O,interpolation:Q,output:X}})),O._data}loadBufferAsync(x,O,Q,X){const Z=this._extensionsLoadBufferAsync(x,O,Q,X);if(Z)return Z;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${x}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${x}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+Q,X)}catch(Z){throw new Error(`${x}: ${Z.message}`)}}))}loadBufferViewAsync(x,O){const Q=this._extensionsLoadBufferViewAsync(x,O);if(Q)return Q;if(O._data)return O._data;const X=r.Get(`${x}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${X.index}`,X,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(x,O,Q){if(O._data)return O._data;const X=T._GetNumComponents(x,O.type),Z=X*q.g.GetTypeByteLength(O.componentType),n=X*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new Q(n));else{const V=r.Get(`${x}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((o=>{if(5126!==O.componentType||O.normalized||V.byteStride&&V.byteStride!==Z){const x=new Q(n);return q.g.ForEach(o,O.byteOffset||0,V.byteStride||Z,X,O.componentType,x.length,O.normalized||!1,((O,Q)=>{x[Q]=O})),x}return T._GetTypedArray(x,O.componentType,o,O.byteOffset,n)}))}if(O.sparse){const n=O.sparse;O._data=O._data.then((V=>{const o=V,l=r.Get(`${x}/sparse/indices/bufferView`,this._gltf.bufferViews,n.indices.bufferView),C=r.Get(`${x}/sparse/values/bufferView`,this._gltf.bufferViews,n.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${l.index}`,l),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((V=>{let[l,C]=V;const U=T._GetTypedArray(`${x}/sparse/indices`,n.indices.componentType,l,n.indices.byteOffset,n.count),L=X*n.count;let h;if(5126!==O.componentType||O.normalized){const V=T._GetTypedArray(`${x}/sparse/values`,O.componentType,C,n.values.byteOffset,L);h=new Q(L),q.g.ForEach(V,0,Z,X,O.componentType,h.length,O.normalized||!1,((x,O)=>{h[O]=x}))}else h=T._GetTypedArray(`${x}/sparse/values`,O.componentType,C,n.values.byteOffset,L);let N=0;for(let x=0;x<U.length;x++){let O=U[x]*X;for(let x=0;x<X;x++)o[O++]=h[N++]}return o}))}))}return O._data}_loadFloatAccessorAsync(x,O){return this._loadAccessorAsync(x,O,Float32Array)}_loadIndicesAccessorAsync(x,O){if("SCALAR"!==O.type)throw new Error(`${x}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${x}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const Q=T._GetTypedArrayConstructor(`${x}/componentType`,O.componentType);O._data=this._loadAccessorAsync(x,O,Q)}else{const Q=r.Get(`${x}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((Q=>T._GetTypedArray(x,O.componentType,Q,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(x){if(x._babylonBuffer)return x._babylonBuffer;const O=this._babylonScene.getEngine();return x._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((x=>new q.c(O,x,!1))),x._babylonBuffer}_loadVertexAccessorAsync(x,O,Q){var X;if(null!==(X=O._babylonVertexBuffer)&&void 0!==X&&X[Q])return O._babylonVertexBuffer[Q];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const Z=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[Q]=this._loadFloatAccessorAsync(x,O).then((x=>new q.g(Z,x,Q,!1)));else{const X=r.Get(`${x}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[Q]=this._loadVertexBufferViewAsync(X).then((n=>{const V=T._GetNumComponents(x,O.type);return new q.g(Z,n,Q,!1,void 0,X.byteStride,void 0,O.byteOffset,V,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[Q]}_loadMaterialMetallicRoughnessPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return O&&(O.baseColorFactor?(Q.albedoColor=n.d.Xo(O.baseColorFactor),Q.alpha=O.baseColorFactor[3]):Q.albedoColor=n.d.White(),Q.metallic=void 0==O.metallicFactor?1:O.metallicFactor,Q.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&X.push(this.loadTextureInfoAsync(`${x}/baseColorTexture`,O.baseColorTexture,(x=>{x.name=`${Q.name} (Base Color)`,Q.albedoTexture=x}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${x}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(x=>{x.name=`${Q.name} (Metallic Roughness)`,Q.metallicTexture=x}))),Q.useMetallnessFromMetallicTextureBlue=!0,Q.useRoughnessFromMetallicTextureGreen=!0,Q.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(X).then((()=>{}))}_loadMaterialAsync(x,O,Q,X){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const n=this._extensionsLoadMaterialAsync(x,O,Q,X,Z);if(n)return n;O._data=O._data||{};let V=O._data[X];if(!V){this.logOpen(`${x} ${O.name||""}`);const Q=this.createMaterial(x,O,X);V={babylonMaterial:Q,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(x,O,Q)},O._data[X]=V,T.AddPointerMetadata(Q,x),this._parent.onMaterialLoadedObservable.notifyObservers(Q),this.logClose()}return Q&&(V.babylonMeshes.push(Q),Q.no.addOnce((()=>{const x=V.babylonMeshes.indexOf(Q);-1!==x&&V.babylonMeshes.splice(x,1)}))),Z(V.babylonMaterial),V.promise.then((()=>V.babylonMaterial))}_createDefaultMaterial(x,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new v.d(x,this._babylonScene);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.fillMode=O,Q.enableSpecularAntiAliasing=!0,Q.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Q.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Q.transparencyMode=v.d.PBRMATERIAL_OPAQUE,Q.metallic=1,Q.roughness=1,Q}createMaterial(x,O,Q){const X=this._extensionsCreateMaterial(x,O,Q);if(X)return X;const Z=O.name||`material${O.index}`;return this._createDefaultMaterial(Z,Q)}loadMaterialPropertiesAsync(x,O,Q){const X=this._extensionsLoadMaterialPropertiesAsync(x,O,Q);if(X)return X;const Z=new Array;return Z.push(this.loadMaterialBasePropertiesAsync(x,O,Q)),O.pbrMetallicRoughness&&Z.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${x}/pbrMetallicRoughness`,O.pbrMetallicRoughness,Q)),this.loadMaterialAlphaProperties(x,O,Q),Promise.all(Z).then((()=>{}))}loadMaterialBasePropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return Q.emissiveColor=O.emissiveFactor?n.d.Xo(O.emissiveFactor):new n.d(0,0,0),O.doubleSided&&(Q.PV=!1,Q.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${x}/normalTexture`,O.normalTexture,(x=>{x.name=`${Q.name} (Normal)`,Q.bumpTexture=x}))),Q.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Q.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&Q.bumpTexture&&(Q.bumpTexture.level=O.normalTexture.scale),Q.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${x}/occlusionTexture`,O.occlusionTexture,(x=>{x.name=`${Q.name} (Occlusion)`,Q.ambientTexture=x}))),Q.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(Q.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&X.push(this.loadTextureInfoAsync(`${x}/emissiveTexture`,O.emissiveTexture,(x=>{x.name=`${Q.name} (Emissive)`,Q.emissiveTexture=x}))),Promise.all(X).then((()=>{}))}loadMaterialAlphaProperties(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":Q.transparencyMode=v.d.PBRMATERIAL_OPAQUE,Q.alpha=1;break;case"MASK":Q.transparencyMode=v.d.PBRMATERIAL_ALPHATEST,Q.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,Q.albedoTexture&&(Q.albedoTexture.wV=!0);break;case"BLEND":Q.transparencyMode=v.d.PBRMATERIAL_ALPHABLEND,Q.albedoTexture&&(Q.albedoTexture.wV=!0,Q.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${x}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadTextureInfoAsync(x,O,Q);if(X)return X;if(this.logOpen(`${x}`),O.texCoord>=6)throw new Error(`${x}/texCoord: Invalid value (${O.texCoord})`);const Z=r.Get(`${x}/index`,this._gltf.textures,O.index);Z._textureInfo=O;const n=this._loadTextureAsync(`/textures/${O.index}`,Z,(X=>{X.coordinatesIndex=O.texCoord||0,T.AddPointerMetadata(X,x),this._parent.onTextureLoadedObservable.notifyObservers(X),Q(X)}));return this.logClose(),n}_loadTextureAsync(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadTextureAsync(x,O,Q);if(X)return X;this.logOpen(`${x} ${O.name||""}`);const Z=void 0==O.sampler?T.DefaultSampler:r.Get(`${x}/sampler`,this._gltf.samplers,O.sampler),n=r.Get(`${x}/source`,this._gltf.images,O.source),V=this._createTextureAsync(x,Z,n,Q,void 0,!O._textureInfo.nonColorData);return this.logClose(),V}_createTextureAsync(x,O,Q){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},n=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0;const o=this._loadSampler(`/samplers/${O.index}`,O),l=new Array,C=new X;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U={noMipmap:o.noMipMaps,invertY:!1,samplingMode:o.samplingMode,p:()=>{this._disposed||C.resolve()},onError:(O,Q)=>{this._disposed||C.reject(new Error(`${x}: ${Q&&Q.message?Q.message:O||"Failed to load texture"}`))},mimeType:Q.mimeType??(0,f.i)(Q.uri??""),loaderOptions:n,useSRGBBuffer:!!V&&this._parent.useSRGBBuffers},L=new R.b(null,this._babylonScene,U);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(C.promise),l.push(this.loadImageAsync(`/images/${Q.index}`,Q).then((x=>{const O=Q.uri||`${this._fileName}#image${Q.index}`,X=`data:${this._uniqueRootUrl}${O}`;L.updateURL(X,x);const Z=L.getInternalTexture();Z&&(Z.label=Q.name)}))),L.wrapU=o.wrapU,L.wrapV=o.wrapV,Z(L),this._parent.useGltfTextureNames&&(L.name=Q.name||Q.uri||`image${Q.index}`),Promise.all(l).then((()=>L))}_loadSampler(x,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:T._GetTextureSamplingMode(x,O),wrapU:T._GetTextureWrapMode(`${x}/wrapS`,O.wrapS),wrapV:T._GetTextureWrapMode(`${x}/wrapT`,O.wrapT)}),O._data}loadImageAsync(x,O){if(!O._data){if(this.logOpen(`${x} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${x}/uri`,O,O.uri);else{const Q=r.Get(`${x}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}this.logClose()}return O._data}loadUriAsync(x,O,Q){const X=this._extensionsLoadUriAsync(x,O,Q);if(X)return X;if(!T._ValidateUri(Q))throw new Error(`${x}: '${Q}' is invalid`);if((0,f.k)(Q)){const O=new Uint8Array((0,f.c)(Q));return this.log(`${x}: Decoded ${Q.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${x}: Loading ${Q}`),this._parent.preprocessUrlAsync(this._rootUrl+Q).then((O=>new Promise(((X,Z)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${x}: Loaded ${Q} (${O.byteLength} bytes)`),X(new Uint8Array(O)))}),!0,(O=>{Z(new f.n(`${x}: Failed to load '${Q}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(x,O){x.metadata=x.metadata||{};const Q=x._internalMetadata=x._internalMetadata||{},X=Q.oo=Q.oo||{};(X.pointers=X.pointers||[]).push(O)}static _GetTextureWrapMode(x,O){switch(O=void 0==O?10497:O){case 33071:return R.b.CLAMP_ADDRESSMODE;case 33648:return R.b.MIRROR_ADDRESSMODE;case 10497:return R.b.WRAP_ADDRESSMODE;default:return K.e.Warn(`${x}: Invalid value (${O})`),R.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(x,O){const Q=void 0==O.magFilter?9729:O.magFilter,X=void 0==O.minFilter?9987:O.minFilter;if(9729===Q)switch(X){case 9728:return R.b.LINEAR_NEAREST;case 9729:return R.b.LINEAR_LINEAR;case 9984:return R.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return R.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return R.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return R.b.LINEAR_LINEAR_MIPLINEAR;default:return K.e.Warn(`${x}/minFilter: Invalid value (${X})`),R.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Q&&K.e.Warn(`${x}/magFilter: Invalid value (${Q})`),X){case 9728:return R.b.NEAREST_NEAREST;case 9729:return R.b.NEAREST_LINEAR;case 9984:return R.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return R.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return R.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return R.b.NEAREST_LINEAR_MIPLINEAR;default:return K.e.Warn(`${x}/minFilter: Invalid value (${X})`),R.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(x,O){try{return(0,I.t)(O)}catch(Q){throw new Error(`${x}: ${Q.message}`)}}static _GetTypedArray(x,O,Q,X,Z){const n=Q.buffer;X=Q.byteOffset+(X||0);const V=T._GetTypedArrayConstructor(`${x}/componentType`,O),o=q.g.GetTypeByteLength(O);return X%o!==0?(K.e.Warn(`${x}: Copying buffer as byte offset (${X}) is not a multiple of component type byte length (${o})`),new V(n.slice(X,X+Z*o),0)):new V(n,X,Z)}static _GetNumComponents(x,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${x}: Invalid type (${O})`)}static _ValidateUri(x){return V.g.IsBase64(x)||-1===x.indexOf("..")}static _GetDrawMode(x,O){switch(void 0==O&&(O=4),O){case 0:return g.e.PointListDrawMode;case 1:return g.e.LineListDrawMode;case 2:return g.e.LineLoopDrawMode;case 3:return g.e.LineStripDrawMode;case 4:return g.e.TriangleFillMode;case 5:return g.e.TriangleStripDrawMode;case 6:return g.e.TriangleFanDrawMode}throw new Error(`${x}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const x=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const Q in O._data){const X=O._data[Q];for(const O of X.babylonMeshes){O.HV(!0);const Q=X.babylonMaterial;x.push(Q.forceCompilationAsync(O)),x.push(Q.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(x.push(Q.forceCompilationAsync(O,{clipPlane:!0})),x.push(Q.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(x).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const x=new Array,O=this._babylonScene.lights;for(const Q of O){const O=Q.getShadowGenerator();O&&x.push(O.forceCompilationAsync())}return Promise.all(x).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(x){for(const O of this._extensions)O.enabled&&x(O)}_applyExtensions(x,O,Q){for(const X of this._extensions)if(X.enabled){const Z=`${X.name}.${O}`,n=x;n._activeLoaderExtensionFunctions=n._activeLoaderExtensionFunctions||{};const V=n._activeLoaderExtensionFunctions;if(!V[Z]){V[Z]=!0;try{const x=Q(X);if(x)return x}finally{delete V[Z]}}}return null}_extensionsOnLoading(){this._forEachExtensions((x=>x.onLoading&&x.onLoading()))}_extensionsOnReady(){this._forEachExtensions((x=>x.onReady&&x.onReady()))}_extensionsLoadSceneAsync(x,O){return this._applyExtensions(O,"loadScene",(Q=>Q.loadSceneAsync&&Q.loadSceneAsync(x,O)))}_extensionsLoadNodeAsync(x,O,Q){return this._applyExtensions(O,"loadNode",(X=>X.loadNodeAsync&&X.loadNodeAsync(x,O,Q)))}_extensionsLoadCameraAsync(x,O,Q){return this._applyExtensions(O,"loadCamera",(X=>X.loadCameraAsync&&X.loadCameraAsync(x,O,Q)))}_extensionsLoadVertexDataAsync(x,O,Q){return this._applyExtensions(O,"loadVertexData",(X=>X._loadVertexDataAsync&&X._loadVertexDataAsync(x,O,Q)))}_extensionsLoadMeshPrimitiveAsync(x,O,Q,X,Z,n){return this._applyExtensions(Z,"loadMeshPrimitive",(V=>V._loadMeshPrimitiveAsync&&V._loadMeshPrimitiveAsync(x,O,Q,X,Z,n)))}_extensionsLoadMaterialAsync(x,O,Q,X,Z){return this._applyExtensions(O,"loadMaterial",(n=>n._loadMaterialAsync&&n._loadMaterialAsync(x,O,Q,X,Z)))}_extensionsCreateMaterial(x,O,Q){return this._applyExtensions(O,"createMaterial",(X=>X.createMaterial&&X.createMaterial(x,O,Q)))}_extensionsLoadMaterialPropertiesAsync(x,O,Q){return this._applyExtensions(O,"loadMaterialProperties",(X=>X.loadMaterialPropertiesAsync&&X.loadMaterialPropertiesAsync(x,O,Q)))}_extensionsLoadTextureInfoAsync(x,O,Q){return this._applyExtensions(O,"loadTextureInfo",(X=>X.loadTextureInfoAsync&&X.loadTextureInfoAsync(x,O,Q)))}_extensionsLoadTextureAsync(x,O,Q){return this._applyExtensions(O,"loadTexture",(X=>X._loadTextureAsync&&X._loadTextureAsync(x,O,Q)))}_extensionsLoadAnimationAsync(x,O){return this._applyExtensions(O,"loadAnimation",(Q=>Q.loadAnimationAsync&&Q.loadAnimationAsync(x,O)))}_extensionsLoadAnimationChannelAsync(x,O,Q,X,Z){return this._applyExtensions(Q,"loadAnimationChannel",(n=>n._loadAnimationChannelAsync&&n._loadAnimationChannelAsync(x,O,Q,X,Z)))}_extensionsLoadSkinAsync(x,O,Q){return this._applyExtensions(Q,"loadSkin",(X=>X._loadSkinAsync&&X._loadSkinAsync(x,O,Q)))}_extensionsLoadUriAsync(x,O,Q){return this._applyExtensions(O,"loadUri",(X=>X._loadUriAsync&&X._loadUriAsync(x,O,Q)))}_extensionsLoadBufferViewAsync(x,O){return this._applyExtensions(O,"loadBufferView",(Q=>Q.loadBufferViewAsync&&Q.loadBufferViewAsync(x,O)))}_extensionsLoadBufferAsync(x,O,Q,X){return this._applyExtensions(O,"loadBuffer",(Z=>Z.loadBufferAsync&&Z.loadBufferAsync(x,O,Q,X)))}static LoadExtensionAsync(x,O,Q,X){if(!O.extensions)return null;const Z=O.extensions[Q];return Z?X(`${x}/extensions/${Q}`,Z):null}static LoadExtraAsync(x,O,Q,X){if(!O.extras)return null;const Z=O.extras[Q];return Z?X(`${x}/extras/${Q}`,Z):null}isExtensionUsed(x){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(x)}logOpen(x){this._parent._logOpen(x)}logClose(){this._parent._logClose()}log(x){this._parent._log(x)}startPerformanceCounter(x){this._parent._startPerformanceCounter(x)}endPerformanceCounter(x){this._parent._endPerformanceCounter(x)}}T.DefaultSampler={index:-1},A.b._CreateGLTF2Loader=x=>new T(x);var e=Q(12656),B=Q(11298),i=Q(11122),H=Q(12665),S=Q(12669);class p extends S.c{constructor(x,O,Q){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",x),this._texture=x.getEngine().createRawCubeTexture(O,Q,X,Z,n,V,o,l)}update(x,O,Q,X){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,x,O,Q,X,Z)}updateRGBDAsync(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,H.n)(this._texture,x,O,Q,X).then((()=>{}))}clone(){return i.c.Clone((()=>{const x=this.kx(),O=this._texture,Q=new p(x,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&Q.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),Q}),this)}}const P="EXT_lights_image_based";class m{constructor(x){this.name=P,this._loader=x,this.enabled=this._loader.isExtensionUsed(P)}dispose(){this._loader=null,delete this._lights}onLoading(){const x=this._loader.oo.extensions;if(x&&x[this.name]){const O=x[this.name];this._lights=O.lights}}loadSceneAsync(x,O){return T.LoadExtensionAsync(x,O,this.name,(async(Q,X)=>{this._loader._allMaterialsDirtyRequired=!0;const Z=new Array;Z.push(this._loader.loadSceneAsync(x,O)),this._loader.logOpen(`${Q}`);const n=r.Get(`${Q}/light`,this._lights,X.IV);return Z.push(this._loadLightAsync(`/extensions/${this.name}/lights/${X.IV}`,n).then((x=>{this._loader.babylonScene.environmentTexture=x}))),this._loader.logClose(),await Promise.all(Z).then((()=>{}))}))}_loadLightAsync(x,O){if(!O._loaded){const Q=new Array;this._loader.logOpen(`${x}`);const X=new Array(O.specularImages.length);for(let Z=0;Z<O.specularImages.length;Z++){const n=O.specularImages[Z];X[Z]=new Array(n.length);for(let O=0;O<n.length;O++){const V=`${x}/specularImages/${Z}/${O}`;this._loader.logOpen(`${V}`);const o=n[O],l=r.Get(V,this._loader.oo.images,o);Q.push(this._loader.loadImageAsync(`/images/${o}`,l).then((x=>{X[Z][O]=x}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(Q).then((async()=>{const Q=new p(this._loader.babylonScene,null,O.specularImageSize);if(Q.name=O.name||"environment",O._babylonTexture=Q,void 0!=O.ho&&(Q.level=O.ho),O.rotation){let x=Z.g.Xo(O.rotation);this._loader.babylonScene.useRightHandedSystem||(x=Z.g.Inverse(x)),Z.c.FromQuaternionToRef(x,Q.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${x}: Irradiance coefficients are missing`);const n=B.b.Xo(O.irradianceCoefficients);n.scaleInPlace(O.ho),n.convertIrradianceToLambertianRadiance();const V=B.d.FromHarmonics(n),o=(X.length-1)/Math.log2(O.specularImageSize);return await Q.updateRGBDAsync(X,V,o)}))}return O._loaded.then((()=>O._babylonTexture))}}D(P),b(P,!0,(x=>new m(x)));Q(11588);const w="EXT_mesh_gpu_instancing";class xx{constructor(x){this.name=w,this._loader=x,this.enabled=this._loader.isExtensionUsed(w)}dispose(){this._loader=null}loadNodeAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(x,X)=>{this._loader._disableInstancedMesh++;const n=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,Q);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return await n;const V=new Array;let o=0;const l=O=>{if(void 0==X.attributes[O])return void V.push(Promise.resolve(null));const Q=r.Get(`${x}/attributes/${O}`,this._loader.oo.accessors,X.attributes[O]);if(V.push(this._loader._loadFloatAccessorAsync(`/accessors/${Q.bufferView}`,Q)),0===o)o=Q.count;else if(o!==Q.count)throw new Error(`${x}/attributes: Instance buffer accessors do not have the same count.`)};return l("TRANSLATION"),l("ROTATION"),l("SCALE"),await n.then((async x=>{const[Q,X,n]=await Promise.all(V),l=new Float32Array(16*o);Z.j.Oo[0].xo(0,0,0),Z.j.Quaternion[0].xo(0,0,0,1),Z.j.Oo[1].xo(1,1,1);for(let O=0;O<o;++O)Q&&Z.n.FromArrayToRef(Q,3*O,Z.j.Oo[0]),X&&Z.g.FromArrayToRef(X,4*O,Z.j.Quaternion[0]),n&&Z.n.FromArrayToRef(n,3*O,Z.j.Oo[1]),Z.c.ComposeToRef(Z.j.Oo[1],Z.j.Quaternion[0],Z.j.Oo[0],Z.j.Matrix[0]),Z.j.Matrix[0].copyToArray(l,16*O);for(const Z of O._primitiveBabylonMeshes)Z.pU("matrix",l,16,!0);return x}))}))}}D(w),b(w,!0,(x=>new xx(x)));let Ox=0,Qx=null;class Xx{static get Default(){return Xx._Default||(Xx._Default=new Xx),Xx._Default}constructor(){const x=Xx.Configuration.decoder;this._decoderModulePromise=V.g.LoadBabylonScriptAsync(x.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(x,O,Q,X,Z){await this._decoderModulePromise,0===Ox&&(MeshoptDecoder.useWorkers(1),Ox=1);const n=await MeshoptDecoder.decodeGltfBufferAsync(O,Q,x,X,Z);return null!==Qx&&clearTimeout(Qx),Qx=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Ox=0,Qx=null}),1e3),n}}Xx.Configuration={decoder:{url:`${V.g._DefaultCdnUrl}/meshopt_decoder.js`}},Xx._Default=null;const Zx="EXT_meshopt_compression";class nx{constructor(x){this.name=Zx,this.enabled=x.isExtensionUsed(Zx),this._loader=x}dispose(){this._loader=null}loadBufferViewAsync(x,O){return T.LoadExtensionAsync(x,O,this.name,(async(Q,X)=>{const Z=O;if(Z._meshOptData)return await Z._meshOptData;const n=r.Get(`${x}/buffer`,this._loader.oo.buffers,X.buffer);return Z._meshOptData=this._loader.loadBufferAsync(`/buffers/${n.index}`,n,X.byteOffset||0,X.byteLength).then((async x=>await Xx.Default.decodeGltfBufferAsync(x,X.count,X.byteStride,X.mode,X.filter))),await Z._meshOptData}))}}D(Zx),b(Zx,!0,(x=>new nx(x)));const Vx="EXT_texture_webp";class ox{constructor(x){this.name=Vx,this._loader=x,this.enabled=x.isExtensionUsed(Vx)}dispose(){this._loader=null}_loadTextureAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=void 0==O.sampler?T.DefaultSampler:r.Get(`${x}/sampler`,this._loader.oo.samplers,O.sampler),V=r.Get(`${X}/source`,this._loader.oo.images,Z.source);return await this._loader._createTextureAsync(x,n,V,(x=>{Q(x)}),void 0,!O._textureInfo.nonColorData)}))}}D(Vx),b(Vx,!0,(x=>new ox(x)));const lx="EXT_texture_avif";class Cx{constructor(x){this.name=lx,this._loader=x,this.enabled=x.isExtensionUsed(lx)}dispose(){this._loader=null}_loadTextureAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=void 0==O.sampler?T.DefaultSampler:r.Get(`${x}/sampler`,this._loader.oo.samplers,O.sampler),V=r.Get(`${X}/source`,this._loader.oo.images,Z.source);return await this._loader._createTextureAsync(x,n,V,(x=>{Q(x)}),void 0,!O._textureInfo.nonColorData)}))}}D(lx),b(lx,!0,(x=>new Cx(x)));var Ux=Q(12648),Lx=Q(11558);const hx="EXT_lights_ies";class Nx{constructor(x){this.name=hx,this._loader=x,this.enabled=this._loader.isExtensionUsed(hx)}dispose(){this._loader=null,delete this._lights}onLoading(){const x=this._loader.oo.extensions;if(x&&x[this.name]){const O=x[this.name];this._lights=O.lights,r.Assign(this._lights)}}loadNodeAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,V)=>{let o,l;this._loader._allMaterialsDirtyRequired=!0;const C=await this._loader.loadNodeAsync(x,O,(x=>{l=r.Get(X,this._lights,V.IV);const O=l.name||x.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,o=new Ux.c(O,Z.n.Zero(),Z.n.Backward(),0,1,this._loader.babylonScene),o.angle=Math.PI/2,o.innerAngle=0,o._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,l._babylonLight=o,o.falloffType=Lx.c.FALLOFF_GLTF,o.No=V.color?n.d.Xo(V.color):n.d.White(),o.ho=V.multiplier||1,o.range=Number.MAX_VALUE,o.parent=x,this._loader._babylonLights.push(o),T.AddPointerMetadata(o,X),Q(x)}));let U;if(l.uri)U=await this._loader.loadUriAsync(x,l,l.uri);else{const O=r.Get(`${x}/bufferView`,this._loader.oo.bufferViews,l.bufferView);U=await this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return o.iesProfileTexture=new R.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,U,!0,void 0,void 0,void 0,void 0,".ies"),C}))}}D(hx),b(hx,!0,(x=>new Nx(x)));var ax=Q(12682);const Kx="KHR_draco_mesh_compression";class Mx{constructor(x){this.name=Kx,this.useNormalizedFlagFromAccessor=!0,this._loader=x,this.enabled=ax.e.DefaultAvailable&&this._loader.isExtensionUsed(Kx)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${x}: Unsupported mode ${O.mode}`);const n={},V={},o=(x,X)=>{const o=Z.attributes[x];if(void 0!=o&&(Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(X)&&Q._delayInfo.push(X),n[X]=o,this.useNormalizedFlagFromAccessor)){const Q=r.TryGet(this._loader.oo.accessors,O.attributes[x]);Q&&(V[X]=Q.normalized||!1)}};o("POSITION",q.g.PositionKind),o("NORMAL",q.g.NormalKind),o("TANGENT",q.g.TangentKind),o("TEXCOORD_0",q.g.UVKind),o("TEXCOORD_1",q.g.UV2Kind),o("TEXCOORD_2",q.g.UV3Kind),o("TEXCOORD_3",q.g.UV4Kind),o("TEXCOORD_4",q.g.UV5Kind),o("TEXCOORD_5",q.g.UV6Kind),o("JOINTS_0",q.g.MatricesIndicesKind),o("WEIGHTS_0",q.g.MatricesWeightsKind),o("COLOR_0",q.g.ColorKind);const l=r.Get(X,this._loader.oo.bufferViews,Z.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((async X=>{const Z=this.dracoDecoder||ax.e.Default,o=r.TryGet(this._loader.oo.accessors,O.attributes.POSITION),l=this._loader.parent.alwaysComputeBoundingBox||Q.skeleton||!o?null:j(o);return await Z._decodeMeshToGeometryForGltfAsync(Q.name,this._loader.babylonScene,X,n,V,l).catch((O=>{throw new Error(`${x}: ${O.message}`)}))}))),await l._dracoBabylonGeometry}))}}D(Kx),b(Kx,!0,(x=>new Mx(x)));var Yx=Q(12686),gx=Q(11039),vx=Q(11042),Rx=Q(11165),sx=Q(11621),qx=Q(10866);Rx.c.AddNodeConstructor("Light_Type_0",((x,O)=>()=>new Gx(x,Z.n.Zero(),O)));class Gx extends sx.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(x){this._shadowAngle=x,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(x){const O=this.needCube();if(this._direction=x,this.needCube()!==O&&this._shadowGenerators){const x=this._shadowGenerators.values();for(let O=x.next();!0!==O.done;O=x.next()){O.value.recreateShadowMap()}}}constructor(x,O,Q){super(x,Q),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return Lx.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(x){if(this.direction)return super.getShadowDirection(x);switch(x){case 0:return new Z.n(1,0,0);case 1:return new Z.n(-1,0,0);case 2:return new Z.n(0,-1,0);case 3:return new Z.n(0,1,0);case 4:return new Z.n(0,0,1);case 5:return new Z.n(0,0,-1)}return Z.n.Zero()}_setDefaultShadowProjectionMatrix(x,O,Q){const X=this.kx().activeCamera;if(!X)return;const n=void 0!==this.shadowMinZ?this.shadowMinZ:X.lo,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,o=this.kx().getEngine().useReverseDepthBuffer;Z.c.PerspectiveFovLHToRef(this.shadowAngle,1,o?V:n,o?n:V,x,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(x,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(x,O){return this.computeTransformedInformation()?x.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):x.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(x,O){x["POINTLIGHT"+O]=!0}}(0,gx.b)([(0,vx.L)()],Gx.prototype,"shadowAngle",null),(0,qx.d)("BABYLON.PointLight",Gx);const kx="KHR_lights_punctual";class Jx{constructor(x){this.name=kx,this._loader=x,this.enabled=this._loader.isExtensionUsed(kx)}dispose(){this._loader=null,delete this._lights}onLoading(){const x=this._loader.oo.extensions;if(x&&x[this.name]){const O=x[this.name];this._lights=O.lights,r.Assign(this._lights)}}loadNodeAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,V)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(x,O,(x=>{let O;const o=r.Get(X,this._lights,V.IV),l=o.name||x.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,o.type){case"directional":{const x=new Yx.e(l,Z.n.Backward(),this._loader.babylonScene);x.position.Zo(0),O=x;break}case"point":O=new Gx(l,Z.n.Zero(),this._loader.babylonScene);break;case"spot":{const x=new Ux.c(l,Z.n.Zero(),Z.n.Backward(),0,1,this._loader.babylonScene);x.angle=2*(o.spot&&o.spot.outerConeAngle||Math.PI/4),x.innerAngle=2*(o.spot&&o.spot.innerConeAngle||0),O=x;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${X}: Invalid light type (${o.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=O,O.falloffType=Lx.c.FALLOFF_GLTF,O.No=o.color?n.d.Xo(o.color):n.d.White(),O.ho=void 0==o.ho?1:o.ho,O.range=void 0==o.range?Number.MAX_VALUE:o.range,O.parent=x,this._loader._babylonLights.push(O),T.AddPointerMetadata(O,X),Q(x)})))))}}D(kx),b(kx,!0,(x=>new Jx(x)));const tx="KHR_materials_pbrSpecularGlossiness";class cx{constructor(x){this.name=tx,this.order=200,this._loader=x,this.enabled=this._loader.isExtensionUsed(tx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialBasePropertiesAsync(x,O,Q)),n.push(this._loadSpecularGlossinessPropertiesAsync(X,Z,Q)),this._loader.loadMaterialAlphaProperties(x,O,Q),await Promise.all(n).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return Q.metallic=null,Q.roughness=null,O.diffuseFactor?(Q.albedoColor=n.d.Xo(O.diffuseFactor),Q.alpha=O.diffuseFactor[3]):Q.albedoColor=n.d.White(),Q.reflectivityColor=O.specularFactor?n.d.Xo(O.specularFactor):n.d.White(),Q.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/diffuseTexture`,O.diffuseTexture,(x=>{x.name=`${Q.name} (Diffuse)`,Q.albedoTexture=x}))),O.specularGlossinessTexture&&(X.push(this._loader.loadTextureInfoAsync(`${x}/specularGlossinessTexture`,O.specularGlossinessTexture,(x=>{x.name=`${Q.name} (Specular Glossiness)`,Q.reflectivityTexture=x,Q.reflectivityTexture.wV=!0}))),Q.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(X).then((()=>{}))}}D(tx),b(tx,!0,(x=>new cx(x)));const dx="KHR_materials_unlit";class ux{constructor(x){this.name=dx,this.order=210,this._loader=x,this.enabled=this._loader.isExtensionUsed(dx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async()=>await this._loadUnlitPropertiesAsync(x,O,Q)))}_loadUnlitPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;Q.unlit=!0;const Z=O.pbrMetallicRoughness;return Z&&(Z.baseColorFactor?(Q.albedoColor=n.d.Xo(Z.baseColorFactor),Q.alpha=Z.baseColorFactor[3]):Q.albedoColor=n.d.White(),Z.baseColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/baseColorTexture`,Z.baseColorTexture,(x=>{x.name=`${Q.name} (Base Color)`,Q.albedoTexture=x})))),O.doubleSided&&(Q.PV=!1,Q.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(x,O,Q),Promise.all(X).then((()=>{}))}}D(dx),b(dx,!0,(x=>new ux(x)));const Ax="KHR_materials_clearcoat";class fx{constructor(x){this.name=Ax,this.order=190,this._loader=x,this.enabled=this._loader.isExtensionUsed(Ax)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadClearCoatPropertiesAsync(X,Z,Q)),await Promise.all(n)}))}_loadClearCoatPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return Q.clearCoat.isEnabled=!0,Q.clearCoat.useRoughnessFromMainTexture=!1,Q.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?Q.clearCoat.ho=O.clearcoatFactor:Q.clearCoat.ho=0,O.clearcoatTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/clearcoatTexture`,O.clearcoatTexture,(x=>{x.name=`${Q.name} (ClearCoat)`,Q.clearCoat.texture=x}))),void 0!=O.clearcoatRoughnessFactor?Q.clearCoat.roughness=O.clearcoatRoughnessFactor:Q.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${x}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(x=>{x.name=`${Q.name} (ClearCoat Roughness)`,Q.clearCoat.textureRoughness=x})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${x}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(x=>{x.name=`${Q.name} (ClearCoat Normal)`,Q.clearCoat.bumpTexture=x}))),Q.invertNormalMapX=!Q.kx().useRightHandedSystem,Q.invertNormalMapY=Q.kx().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(Q.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(X).then((()=>{}))}}D(Ax),b(Ax,!0,(x=>new fx(x)));const Ex="KHR_materials_iridescence";class zx{constructor(x){this.name=Ex,this.order=195,this._loader=x,this.enabled=this._loader.isExtensionUsed(Ex)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadIridescencePropertiesAsync(X,Z,Q)),await Promise.all(n).then((()=>{}))}))}_loadIridescencePropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return Q.iridescence.isEnabled=!0,Q.iridescence.ho=O.iridescenceFactor??0,Q.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,Q.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,Q.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/iridescenceTexture`,O.iridescenceTexture,(x=>{x.name=`${Q.name} (Iridescence)`,Q.iridescence.texture=x}))),O.iridescenceThicknessTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(x=>{x.name=`${Q.name} (Iridescence Thickness)`,Q.iridescence.thicknessTexture=x}))),Promise.all(X).then((()=>{}))}}D(Ex),b(Ex,!0,(x=>new zx(x)));const Fx="KHR_materials_anisotropy";class bx{constructor(x){this.name=Fx,this.order=195,this._loader=x,this.enabled=this._loader.isExtensionUsed(Fx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadIridescencePropertiesAsync(X,Z,Q)),await Promise.all(n)}))}async _loadIridescencePropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;Q.anisotropy.isEnabled=!0,Q.anisotropy.ho=O.anisotropyStrength??0,Q.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${x}/anisotropyTexture`,O.anisotropyTexture,(x=>{x.name=`${Q.name} (Anisotropy Intensity)`,Q.anisotropy.texture=x})))),await Promise.all(X)}}D(Fx),b(Fx,!0,(x=>new bx(x)));const Dx="KHR_materials_emissive_strength";class Wx{constructor(x){this.name=Dx,this.order=170,this._loader=x,this.enabled=this._loader.isExtensionUsed(Dx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>await this._loader.loadMaterialPropertiesAsync(x,O,Q).then((()=>{this._loadEmissiveProperties(X,Z,Q)}))))}_loadEmissiveProperties(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);void 0!==O.emissiveStrength&&(Q.emissiveIntensity=O.emissiveStrength)}}D(Dx),b(Dx,!0,(x=>new Wx(x)));const yx="KHR_materials_sheen";class Ix{constructor(x){this.name=yx,this.order=190,this._loader=x,this.enabled=this._loader.isExtensionUsed(yx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadSheenPropertiesAsync(X,Z,Q)),await Promise.all(n).then((()=>{}))}))}_loadSheenPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return Q.sheen.isEnabled=!0,Q.sheen.ho=1,void 0!=O.sheenColorFactor?Q.sheen.color=n.d.Xo(O.sheenColorFactor):Q.sheen.color=n.d.Black(),O.sheenColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/sheenColorTexture`,O.sheenColorTexture,(x=>{x.name=`${Q.name} (Sheen Color)`,Q.sheen.texture=x}))),void 0!==O.sheenRoughnessFactor?Q.sheen.roughness=O.sheenRoughnessFactor:Q.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${x}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(x=>{x.name=`${Q.name} (Sheen Roughness)`,Q.sheen.textureRoughness=x})))),Q.sheen.albedoScaling=!0,Q.sheen.useRoughnessFromMainTexture=!1,Promise.all(X).then((()=>{}))}}D(yx),b(yx,!0,(x=>new Ix(x)));var rx=Q(11383);const jx="KHR_materials_specular";class Tx{constructor(x){this.name=jx,this.order=190,this._loader=x,this.enabled=this._loader.isExtensionUsed(jx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;if(n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadSpecularPropertiesAsync(X,Z,Q)),Z.extensions&&Z.extensions.EXT_materials_specular_edge_color&&Q instanceof v.d){Z.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Q.brdf.dielectricSpecularModel=rx.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Q.brdf.conductorSpecularModel=rx.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(n).then((()=>{}))}))}_loadSpecularPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return void 0!==O.specularFactor&&(Q.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(Q.metallicReflectanceColor=n.d.Xo(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${x}/specularTexture`,O.specularTexture,(x=>{x.name=`${Q.name} (Specular)`,Q.metallicReflectanceTexture=x,Q.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/specularColorTexture`,O.specularColorTexture,(x=>{x.name=`${Q.name} (Specular Color)`,Q.reflectanceTexture=x}))),Promise.all(X).then((()=>{}))}}D(jx),b(jx,!0,(x=>new Tx(x)));const ex="KHR_materials_ior";class Bx{constructor(x){this.name=ex,this.order=180,this._loader=x,this.enabled=this._loader.isExtensionUsed(ex)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadIorPropertiesAsync(X,Z,Q)),await Promise.all(n).then((()=>{}))}))}_loadIorPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);return void 0!==O.ior?Q.indexOfRefraction=O.ior:Q.indexOfRefraction=Bx._DEFAULT_IOR,Promise.resolve()}}Bx._DEFAULT_IOR=1.5,D(ex),b(ex,!0,(x=>new Bx(x)));const ix="KHR_materials_variants";class Hx{constructor(x){this.name=ix,this._loader=x,this.enabled=this._loader.isExtensionUsed(ix)}dispose(){this._loader=null}static GetAvailableVariants(x){const O=this._GetExtensionMetadata(x);return O?Object.keys(O.variants):[]}getAvailableVariants(x){return Hx.GetAvailableVariants(x)}static SelectVariant(x,O){const Q=this._GetExtensionMetadata(x);if(!Q)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ix} extension`);const X=x=>{const O=Q.variants[x];if(O)for(const Q of O)Q.mesh.material=Q.material};if(O instanceof Array)for(const Z of O)X(Z);else X(O);Q.lastSelected=O}selectVariant(x,O){Hx.SelectVariant(x,O)}static Reset(x){const O=this._GetExtensionMetadata(x);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ix} extension`);for(const Q of O.original)Q.mesh.material=Q.material;O.lastSelected=null}reset(x){Hx.Reset(x)}static GetLastSelectedVariant(x){const O=this._GetExtensionMetadata(x);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ix} extension`);return O.lastSelected}getLastSelectedVariant(x){return Hx.GetLastSelectedVariant(x)}static _GetExtensionMetadata(x){var O,Q;return(null===x||void 0===x||null===(O=x._internalMetadata)||void 0===O||null===(Q=O.oo)||void 0===Q?void 0:Q[ix])||null}onLoading(){const x=this._loader.oo.extensions;if(x&&x[this.name]){const O=x[this.name];this._variants=O.variants}}onReady(){const x=this._loader.rootBabylonMesh;if(x){var O;const Q=this._loader.parent.extensionOptions[ix];null!==Q&&void 0!==Q&&Q.defaultVariant&&Hx.SelectVariant(x,Q.defaultVariant),null===Q||void 0===Q||null===(O=Q.onLoaded)||void 0===O||O.call(Q,{get variants(){return Hx.GetAvailableVariants(x)},get selectedVariant(){const O=Hx.GetLastSelectedVariant(x);return O?Array.isArray(O)?O[0]:O:Hx.GetAvailableVariants(x)[0]},set selectedVariant(O){Hx.SelectVariant(x,O)}})}}_loadMeshPrimitiveAsync(x,O,Q,X,Z,n){return T.LoadExtensionAsync(x,Z,this.name,(async(V,o)=>{const l=new Array;return l.push(this._loader._loadMeshPrimitiveAsync(x,O,Q,X,Z,(O=>{if(n(O),O instanceof J.b){const Q=T._GetDrawMode(x,Z.mode),X=this._loader.rootBabylonMesh,n=X?X._internalMetadata=X._internalMetadata||{}:{},C=n.oo=n.oo||{},U=C[ix]=C[ix]||{lastSelected:null,original:[],variants:{}};U.original.push({mesh:O,material:O.material});for(let x=0;x<o.mappings.length;++x){const Z=o.mappings[x],n=r.Get(`${V}/mappings/${x}/material`,this._loader.oo.materials,Z.material);l.push(this._loader._loadMaterialAsync(`#/materials/${Z.material}`,n,O,Q,(x=>{for(let Q=0;Q<Z.variants.length;++Q){const n=Z.variants[Q],V=r.Get(`/extensions/${ix}/variants/${n}`,this._variants,n);U.variants[V.name]=U.variants[V.name]||[],U.variants[V.name].push({mesh:O,material:x}),O.onClonedObservable.add((x=>{const Q=x;let Z=null,n=Q;do{if(n=n.parent,!n)return;Z=Hx._GetExtensionMetadata(n)}while(null===Z);if(X&&Z===Hx._GetExtensionMetadata(X)){n._internalMetadata={};for(const x in X._internalMetadata)n._internalMetadata[x]=X._internalMetadata[x];n._internalMetadata.oo=[];for(const x in X._internalMetadata.oo)n._internalMetadata.oo[x]=X._internalMetadata.oo[x];n._internalMetadata.oo[ix]={lastSelected:null,original:[],variants:{}};for(const x of Z.original)n._internalMetadata.oo[ix].original.push({mesh:x.mesh,material:x.material});for(const x in Z.variants)if(Object.prototype.hasOwnProperty.call(Z.variants,x)){n._internalMetadata.oo[ix].variants[x]=[];for(const O of Z.variants[x])n._internalMetadata.oo[ix].variants[x].push({mesh:O.mesh,material:O.material})}Z=n._internalMetadata.oo[ix]}for(const X of Z.original)X.mesh===O&&(X.mesh=Q);for(const X of Z.variants[V.name])X.mesh===O&&(X.mesh=Q)}))}})))}}}))),await Promise.all(l).then((x=>{let[O]=x;return O}))}))}}D(ix),b(ix,!0,(x=>new Hx(x)));var Sx=Q(11341);class px{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:rx.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(x,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...px._GetDefaultOptions(),...x},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new U.b,this._scene.no.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(x){if(!Object.keys(x).filter((O=>this._options[O]!==x[O])).length)return;const O={...this._options,...x},Q=this._options;this._options=O,O.renderSize===Q.renderSize&&O.renderTargetTextureType===Q.renderTargetTextureType&&O.generateMipmaps===Q.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(x){return!!x&&!!(x instanceof v.d&&x.subSurface.isRefractionEnabled)}_addMesh(x){this._materialObservers[x.uniqueId]=x.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),V.g.SetImmediate((()=>{this._shouldRenderAsTransmission(x.material)?(x.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(x)&&this._transparentMeshesCache.push(x)):-1===this._opaqueMeshesCache.indexOf(x)&&this._opaqueMeshesCache.push(x)}))}_removeMesh(x){x.onMaterialChangedObservable.remove(this._materialObservers[x.uniqueId]),delete this._materialObservers[x.uniqueId];let O=this._transparentMeshesCache.indexOf(x);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(x),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(x){const O=this._transparentMeshesCache.indexOf(x),Q=this._opaqueMeshesCache.indexOf(x);this._shouldRenderAsTransmission(x.material)?(x.material instanceof v.d&&(x.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Q?(this._opaqueMeshesCache.splice(Q,1),this._transparentMeshesCache.push(x)):-1===O&&this._transparentMeshesCache.push(x)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(x)):-1===Q&&this._opaqueMeshesCache.push(x)}_isRenderTargetValid(){var x;return null!==(null===(x=this._opaqueRenderTarget)||void 0===x?void 0:x.getInternalTexture())}_setupRenderTargets(){var x;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Sx.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(x=this._options.clearColor)||void 0===x?void 0:x.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((x=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?x.clearColor.V(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(x.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const Q of this._transparentMeshesCache)this._shouldRenderAsTransmission(Q.material)&&(Q.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Px="KHR_materials_transmission";class mx{constructor(x){this.name=Px,this.order=175,this._loader=x,this.enabled=this._loader.isExtensionUsed(Px),this.enabled&&(x.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadTransparentPropertiesAsync(X,O,Q,Z)),await Promise.all(n).then((()=>{}))}))}_loadTransparentPropertiesAsync(x,O,Q,X){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const Z=Q;if(Z.subSurface.isRefractionEnabled=!0,Z.subSurface.volumeIndexOfRefraction=1,Z.subSurface.useAlbedoToTintRefraction=!0,void 0===X.transmissionFactor)return Z.subSurface.refractionIntensity=0,Z.subSurface.isRefractionEnabled=!1,Promise.resolve();{var n;Z.subSurface.refractionIntensity=X.transmissionFactor;const x=Z.kx();if(Z.subSurface.refractionIntensity&&!x._transmissionHelper)new px({},Z.kx());else if(Z.subSurface.refractionIntensity&&(null===(n=x._transmissionHelper)||void 0===n||!n._isRenderTargetValid())){var V;null===(V=x._transmissionHelper)||void 0===V||V._setupRenderTargets()}}return Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=0,X.transmissionTexture?(X.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${x}/transmissionTexture`,X.transmissionTexture,void 0).then((x=>{x.name=`${Q.name} (Transmission)`,Z.subSurface.refractionIntensityTexture=x,Z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}D(Px),b(Px,!0,(x=>new mx(x)));const wx="KHR_materials_diffuse_transmission";class xO{constructor(x){this.name=wx,this.order=174,this._loader=x,this.enabled=this._loader.isExtensionUsed(wx),this.enabled&&(x.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadTranslucentPropertiesAsync(X,O,Q,Z)),await Promise.all(n).then((()=>{}))}))}_loadTranslucentPropertiesAsync(x,O,Q,X){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const Z=Q;if(Z.subSurface.isTranslucencyEnabled=!0,Z.subSurface.volumeIndexOfRefraction=1,Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=0,Z.subSurface.useAlbedoToTintTranslucency=!1,void 0===X.diffuseTransmissionFactor)return Z.subSurface.translucencyIntensity=0,Z.subSurface.isTranslucencyEnabled=!1,Promise.resolve();Z.subSurface.translucencyIntensity=X.diffuseTransmissionFactor;const V=new Array;return Z.subSurface.useGltfStyleTextures=!0,X.diffuseTransmissionTexture&&(X.diffuseTransmissionTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${x}/diffuseTransmissionTexture`,X.diffuseTransmissionTexture).then((x=>{x.name=`${Q.name} (Diffuse Transmission)`,Z.subSurface.translucencyIntensityTexture=x})))),void 0!==X.diffuseTransmissionColorFactor?Z.subSurface.translucencyColor=n.d.Xo(X.diffuseTransmissionColorFactor):Z.subSurface.translucencyColor=n.d.White(),X.diffuseTransmissionColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${x}/diffuseTransmissionColorTexture`,X.diffuseTransmissionColorTexture).then((x=>{x.name=`${Q.name} (Diffuse Transmission Color)`,Z.subSurface.translucencyColorTexture=x}))),Promise.all(V).then((()=>{}))}}D(wx),b(wx,!0,(x=>new xO(x)));const OO="KHR_materials_volume";class QO{constructor(x){this.name=OO,this.order=173,this._loader=x,this.enabled=this._loader.isExtensionUsed(OO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadVolumePropertiesAsync(X,O,Q,Z)),await Promise.all(n).then((()=>{}))}))}_loadVolumePropertiesAsync(x,O,Q,X){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);if(!Q.subSurface.isRefractionEnabled&&!Q.subSurface.isTranslucencyEnabled||!X.thicknessFactor)return Promise.resolve();Q.subSurface.volumeIndexOfRefraction=Q.indexOfRefraction;const Z=void 0!==X.attenuationDistance?X.attenuationDistance:Number.MAX_VALUE;return Q.subSurface.tintColorAtDistance=Z,void 0!==X.attenuationColor&&3==X.attenuationColor.length&&Q.subSurface.tintColor.xo(X.attenuationColor[0],X.attenuationColor[1],X.attenuationColor[2]),Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=X.thicknessFactor,Q.subSurface.useThicknessAsDepth=!0,X.thicknessTexture?(X.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${x}/thicknessTexture`,X.thicknessTexture).then((x=>{x.name=`${Q.name} (Thickness)`,Q.subSurface.thicknessTexture=x,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}D(OO),b(OO,!0,(x=>new QO(x)));const XO="KHR_materials_dispersion";class ZO{constructor(x){this.name=XO,this.order=174,this._loader=x,this.enabled=this._loader.isExtensionUsed(XO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadDispersionPropertiesAsync(X,O,Q,Z)),await Promise.all(n).then((()=>{}))}))}_loadDispersionPropertiesAsync(x,O,Q,X){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);return Q.subSurface.isRefractionEnabled&&X.dispersion?(Q.subSurface.isDispersionEnabled=!0,Q.subSurface.dispersion=X.dispersion,Promise.resolve()):Promise.resolve()}}D(XO),b(XO,!0,(x=>new ZO(x)));const nO="EXT_materials_diffuse_roughness";class VO{constructor(x){this.name=nO,this.order=190,this._loader=x,this.enabled=this._loader.isExtensionUsed(nO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(x,O,Q)),n.push(this._loadDiffuseRoughnessPropertiesAsync(X,Z,Q)),await Promise.all(n).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(x,O,Q){if(!(Q instanceof v.d))throw new Error(`${x}: Material type not supported`);const X=new Array;return Q.brdf.baseDiffuseModel=rx.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=O.diffuseRoughnessFactor?Q.baseDiffuseRoughness=O.diffuseRoughnessFactor:Q.baseDiffuseRoughness=0,O.diffuseRoughnessTexture&&X.push(this._loader.loadTextureInfoAsync(`${x}/diffuseRoughnessTexture`,O.diffuseRoughnessTexture,(x=>{x.name=`${Q.name} (Diffuse Roughness)`,Q.baseDiffuseRoughnessTexture=x}))),Promise.all(X).then((()=>{}))}}D(nO),b(nO,!0,(x=>new VO(x)));const oO="KHR_mesh_quantization";class lO{constructor(x){this.name=oO,this.enabled=x.isExtensionUsed(oO)}dispose(){}}D(oO),b(oO,!0,(x=>new lO(x)));const CO="KHR_texture_basisu";class UO{constructor(x){this.name=CO,this._loader=x,this.enabled=x.isExtensionUsed(CO)}dispose(){this._loader=null}_loadTextureAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>{const n=void 0==O.sampler?T.DefaultSampler:r.Get(`${x}/sampler`,this._loader.oo.samplers,O.sampler),V=r.Get(`${X}/source`,this._loader.oo.images,Z.source);return await this._loader._createTextureAsync(x,n,V,(x=>{Q(x)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}D(CO),b(CO,!0,(x=>new UO(x)));const LO="KHR_texture_transform";class hO{constructor(x){this.name=LO,this._loader=x,this.enabled=this._loader.isExtensionUsed(LO)}dispose(){this._loader=null}loadTextureInfoAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(X,Z)=>await this._loader.loadTextureInfoAsync(x,O,(x=>{if(!(x instanceof R.b))throw new Error(`${X}: Texture type not supported`);Z.offset&&(x.uOffset=Z.offset[0],x.vOffset=Z.offset[1]),x.uRotationCenter=0,x.vRotationCenter=0,Z.rotation&&(x.wAng=-Z.rotation),Z.scale&&(x.uScale=Z.scale[0],x.vScale=Z.scale[1]),void 0!=Z.texCoord&&(x.coordinatesIndex=Z.texCoord),Q(x)}))))}}D(LO),b(LO,!0,(x=>new hO(x)));const NO="KHR_xmp_json_ld";class aO{constructor(x){this.name=NO,this.order=100,this._loader=x,this.enabled=this._loader.isExtensionUsed(NO)}dispose(){this._loader=null}onLoading(){var x,O,Q;if(null===this._loader.rootBabylonMesh)return;const X=null===(x=this._loader.oo.extensions)||void 0===x?void 0:x.KHR_xmp_json_ld,Z=null===(O=this._loader.oo.asset)||void 0===O||null===(Q=O.extensions)||void 0===Q?void 0:Q.KHR_xmp_json_ld;if(X&&Z){const x=+Z.packet;X.packets&&x<X.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=X.packets[x])}}}function KO(x,O,Q,X){return n.d.Xo(O,Q).scale(X)}function MO(x,O,Q,X){return O[Q]*X}function YO(x,O,Q,X){return-O[Q]*X}function gO(x,O,Q,X){return O[Q+1]*X}function vO(x,O,Q,X){return O[Q]*X*2}function RO(x){return{scale:[new qO(h.b.ANIMATIONTYPE_FLOAT,`${x}.uScale`,MO,(()=>2)),new qO(h.b.ANIMATIONTYPE_FLOAT,`${x}.vScale`,gO,(()=>2))],offset:[new qO(h.b.ANIMATIONTYPE_FLOAT,`${x}.uOffset`,MO,(()=>2)),new qO(h.b.ANIMATIONTYPE_FLOAT,`${x}.vOffset`,gO,(()=>2))],rotation:[new qO(h.b.ANIMATIONTYPE_FLOAT,`${x}.wAng`,YO,(()=>1))]}}D(NO),b(NO,!0,(x=>new aO(x)));class sO extends e.AnimationPropertyInfo{buildAnimations(x,O,Q,X){return[{babylonAnimatable:x._babylonCamera,babylonAnimation:this._buildAnimation(O,Q,X)}]}}class qO extends e.AnimationPropertyInfo{buildAnimations(x,O,Q,X){const Z=[];for(const n in x._data)Z.push({babylonAnimatable:x._data[n].babylonMaterial,babylonAnimation:this._buildAnimation(O,Q,X)});return Z}}class GO extends e.AnimationPropertyInfo{buildAnimations(x,O,Q,X){return[{babylonAnimatable:x._babylonLight,babylonAnimation:this._buildAnimation(O,Q,X)}]}}(0,W.l)("/cameras/{}/orthographic/xmag",[new sO(h.b.ANIMATIONTYPE_FLOAT,"orthoLeft",YO,(()=>1)),new sO(h.b.ANIMATIONTYPE_FLOAT,"orthoRight",gO,(()=>1))]),(0,W.l)("/cameras/{}/orthographic/ymag",[new sO(h.b.ANIMATIONTYPE_FLOAT,"orthoBottom",YO,(()=>1)),new sO(h.b.ANIMATIONTYPE_FLOAT,"orthoTop",gO,(()=>1))]),(0,W.l)("/cameras/{}/orthographic/zfar",[new sO(h.b.ANIMATIONTYPE_FLOAT,"maxZ",MO,(()=>1))]),(0,W.l)("/cameras/{}/orthographic/znear",[new sO(h.b.ANIMATIONTYPE_FLOAT,"lo",MO,(()=>1))]),(0,W.l)("/cameras/{}/perspective/yfov",[new sO(h.b.ANIMATIONTYPE_FLOAT,"fov",MO,(()=>1))]),(0,W.l)("/cameras/{}/perspective/zfar",[new sO(h.b.ANIMATIONTYPE_FLOAT,"maxZ",MO,(()=>1))]),(0,W.l)("/cameras/{}/perspective/znear",[new sO(h.b.ANIMATIONTYPE_FLOAT,"lo",MO,(()=>1))]),(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new qO(h.b.ANIMATIONTYPE_COLOR3,"albedoColor",KO,(()=>4)),new qO(h.b.ANIMATIONTYPE_FLOAT,"alpha",(function(x,O,Q,X){return O[Q+3]*X}),(()=>4))]),(0,W.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"metallic",MO,(()=>1))]),(0,W.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"roughness",MO,(()=>1))]);const kO=RO("albedoTexture");(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",kO.scale),(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",kO.offset),(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",kO.rotation);const JO=RO("metallicTexture");(0,W.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",JO.scale),(0,W.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",JO.offset),(0,W.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",JO.rotation),(0,W.l)("/materials/{}/emissiveFactor",[new qO(h.b.ANIMATIONTYPE_COLOR3,"emissiveColor",KO,(()=>3))]);const tO=RO("bumpTexture");(0,W.l)("/materials/{}/normalTexture/scale",[new qO(h.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",MO,(()=>1))]),(0,W.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",tO.scale),(0,W.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",tO.offset),(0,W.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",tO.rotation),(0,W.l)("/materials/{}/occlusionTexture/strength",[new qO(h.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",MO,(()=>1))]);const cO=RO("ambientTexture");(0,W.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",cO.scale),(0,W.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",cO.offset),(0,W.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",cO.rotation);const dO=RO("emissiveTexture");(0,W.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",dO.scale),(0,W.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",dO.offset),(0,W.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",dO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new qO(h.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new qO(h.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",MO,(()=>1))]);const uO=RO("anisotropy.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",uO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",uO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",uO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",MO,(()=>1))]);const AO=RO("clearCoat.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",AO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",AO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",AO.rotation);const fO=RO("clearCoat.bumpTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new qO(h.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",fO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",fO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",fO.rotation);const EO=RO("clearCoat.textureRoughness");(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",EO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",EO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",EO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new qO(h.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new qO(h.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new qO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new qO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",MO,(()=>1))]);const zO=RO("iridescence.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",zO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",zO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",zO.rotation);const FO=RO("iridescence.thicknessTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",FO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",FO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",FO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new qO(h.b.ANIMATIONTYPE_COLOR3,"sheen.color",KO,(()=>3))]),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",MO,(()=>1))]);const bO=RO("sheen.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",bO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",bO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",bO.rotation);const DO=RO("sheen.textureRoughness");(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",DO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",DO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",DO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new qO(h.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",KO,(()=>3))]);const WO=RO("metallicReflectanceTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",WO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",WO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",WO.rotation);const yO=RO("reflectanceTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",yO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",yO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",yO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",MO,(()=>1))]);const IO=RO("subSurface.refractionIntensityTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",IO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",IO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",IO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new qO(h.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",KO,(()=>3))]),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new qO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",MO,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",MO,(()=>1))]);const rO=RO("subSurface.thicknessTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",rO.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",rO.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",rO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new qO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",MO,(()=>1))]);const jO=RO("subSurface.translucencyIntensityTexture");(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",jO.scale),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",jO.offset),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",jO.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new qO(h.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",KO,(()=>3))]);const TO=RO("subSurface.translucencyColorTexture");(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",TO.scale),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",TO.offset),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",TO.rotation),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new GO(h.b.ANIMATIONTYPE_COLOR3,"diffuse",KO,(()=>3))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new GO(h.b.ANIMATIONTYPE_FLOAT,"intensity",MO,(()=>1))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new GO(h.b.ANIMATIONTYPE_FLOAT,"range",MO,(()=>1))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new GO(h.b.ANIMATIONTYPE_FLOAT,"innerAngle",vO,(()=>1))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new GO(h.b.ANIMATIONTYPE_FLOAT,"angle",vO,(()=>1))]),(0,W.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new GO(h.b.ANIMATIONTYPE_COLOR3,"diffuse",KO,(()=>3))]),(0,W.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new GO(h.b.ANIMATIONTYPE_FLOAT,"intensity",MO,(()=>1))]);const eO="KHR_animation_pointer";class BO{constructor(x){this.name=eO,this._loader=x,this._pathToObjectConverter=(0,W.k)(this._loader.oo)}get enabled(){return this._loader.isExtensionUsed(eO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(x,O,Q,X,Z){var n;const V=null===(n=X.target.extensions)||void 0===n?void 0:n.KHR_animation_pointer;if(!V||!this._pathToObjectConverter)return null;"pointer"!==X.target.path&&K.e.Warn(`${x}/target/path: Value (${X.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=X.target.node&&K.e.Warn(`${x}/target/node: Value (${X.target.node}) must not be present when using the ${this.name} extension`);const o=`${x}/extensions/${this.name}`,l=V.pointer;if(!l)throw new Error(`${o}: Pointer is missing`);try{const n=this._pathToObjectConverter.convert(l);if(!n.info.interpolation)throw new Error(`${o}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(x,O,Q,X,{object:n.object,info:n.info.interpolation},Z)}catch(C){return K.e.Warn(`${o}/pointer: Invalid pointer (${l}) skipped`),null}}}D(eO),b(eO,!0,(x=>new BO(x)));class iO{constructor(x,O,Q){this.frame=x,this.action=O,this.onlyOnce=Q,this.isDone=!1}_clone(){return new iO(this.frame,this.action,this.onlyOnce)}}var HO=Q(10919),SO=Q(10970),pO=Q(10962);class PO{get loop(){return this._loop}set loop(x){x!==this._loop&&(this._loop=x,this.updateOptions({loop:x}))}get currentTime(){var x;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(x=SO.c.audioEngine)&&void 0!==x&&x.audioContext&&(this.isPlaying||this.isPaused)){const x=this.isPaused?0:SO.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+x}return 0}get spatialSound(){return this._spatialSound}set spatialSound(x){if(x==this._spatialSound)return;const O=this.isPlaying;this.pause(),x?(this._spatialSound=x,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(x,O,Q){var X;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new U.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Z.n.Zero(),this._localDirection=new Z.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=x,Q=Q||a.c.LastCreatedScene)if(this._scene=Q,PO._SceneComponentInitialization(Q),this._readyToPlayCallback=n,this._customAttenuationFunction=(x,O,Q,X,Z)=>O<Q?x*(1-O/Q):0,o&&(this.autoplay=o.autoplay||!1,this._loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this._spatialSound=o.spatialSound??!1,this.maxDistance=o.maxDistance??100,this.useCustomAttenuation=o.useCustomAttenuation??!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=o.streaming??!1,this._length=o.length,this._offset=o.offset),null!==(X=SO.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&SO.c.audioEngine.audioContext){this._soundGain=SO.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let x=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let Q=[],X=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=SO.c.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=SO.c.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(X=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":Q.push(O);case"Array":0===Q.length&&(Q=O);for(let x=0;x<Q.length;x++){const O=Q[x];if(X=o&&o.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&SO.c.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&SO.c.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),X){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,V.g.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(x=>{this._soundLoaded(x)}),void 0,!0,!0,(x=>{x&&K.e.Error("XHR "+x.status+" error on: "+O+"."),K.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:x=!1}x?X||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):K.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(l){K.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),SO.c.audioEngine&&!SO.c.audioEngine.WarnedWebAudioUnsupported&&(K.e.Error("Web Audio is not supported by your browser."),SO.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var x;null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(x){var O;null!==(O=SO.c.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=x,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(x){var O;null!==(O=SO.c.audioEngine)&&void 0!==O&&O.audioContext&&SO.c.audioEngine.audioContext.decodeAudioData(x,(x=>{this._audioBufferLoaded(x)}),(x=>{K.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+x)}))}setAudioBuffer(x){var O;null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=x,this._isReadyToPlay=!0)}updateOptions(x){x&&(this.loop=x.loop??this.loop,this.maxDistance=x.maxDistance??this.maxDistance,this.useCustomAttenuation=x.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=x.rolloffFactor??this.rolloffFactor,this.refDistance=x.refDistance??this.refDistance,this.distanceModel=x.distanceModel??this.distanceModel,this._playbackRate=x.playbackRate??this._playbackRate,this._length=x.length??void 0,this.spatialSound=x.spatialSound??this._spatialSound,this._setOffset(x.offset??void 0),this.setVolume(x.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var x;null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&SO.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??SO.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var x;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(x=this._soundPanner)||void 0===x||x.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var x;null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(x){var O;null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(x),this._isOutputConnected=!0)}setDirectionalCone(x,O,Q){O<x?K.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=x,this._coneOuterAngle=O,this._coneOuterGain=Q,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(x){if(x!=this._coneInnerAngle){var O;if(this._coneOuterAngle<x)return void K.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=x,null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(x){if(x!=this._coneOuterAngle){var O;if(x<this._coneInnerAngle)return void K.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=x,null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(x){var O;x.equals(this._position)||(this._position.V(x),null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(x){var O;this._localDirection=x,null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const x=this._connectedTransformNode.getWorldMatrix(),O=Z.n.TransformNormal(this._localDirection,x);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var x;if(null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const x=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.hQ(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,x,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(x){this._customAttenuationFunction=x}play(x,O,Q){var X;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(X=SO.c.audioEngine)&&void 0!==X&&X.audioContext)try{var Z,n;this._clearTimeoutsAndObservers();let X=x?(null===(Z=SO.c.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime)+x:null===(n=SO.c.audioEngine)||void 0===n?void 0:n.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=SO.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const x=()=>{var Q;if(null!==(Q=SO.c.audioEngine)&&void 0!==Q&&Q.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const Q=this._htmlAudioElement.play();void 0!==Q&&Q.catch((()=>{var O,Q;(null===(O=SO.c.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Q=SO.c.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{x()})))}))}else{var X;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(X=SO.c.audioEngine)||void 0===X?void 0:X.onAudioUnlockedObservable.addOnce((()=>{x()}))}};x()}}else{var V;const Z=()=>{var Z;if(null!==(Z=SO.c.audioEngine)&&void 0!==Z&&Z.audioContext){var n;if(Q=Q||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const x=this._soundSource;x.onended=()=>{x.disconnect()}}if(this._soundSource=null===(n=SO.c.audioEngine)||void 0===n?void 0:n.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var V;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==Q&&(this._soundSource.loopEnd=(0|O)+Q),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},X=x?(null===(V=SO.c.audioEngine)||void 0===V?void 0:V.audioContext.currentTime)+x:SO.c.audioEngine.audioContext.currentTime;const Z=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(X,Z,this.loop?void 0:Q)}}};"suspended"===(null===(V=SO.c.audioEngine)||void 0===V?void 0:V.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var x;"suspended"===(null===(x=SO.c.audioEngine)||void 0===x?void 0:x.audioContext.state)?(SO.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=SO.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{Z()})))):Z()}),500):Z()}this._startTime=X,this.isPlaying=!0,this.isPaused=!1}catch(o){K.e.Error("Error while trying to play audio: "+this.name+", "+o.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(x){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Q;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Q=this._streamingSource)||void 0===Q||Q.disconnect();this.isPlaying=!1}else if(null!==(O=SO.c.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=x?SO.c.audioEngine.audioContext.currentTime+x:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var x;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(x=SO.c.audioEngine)&&void 0!==x&&x.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=SO.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(x,O){var Q;null!==(Q=SO.c.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._soundGain&&(O&&SO.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(SO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,SO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(x,SO.c.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=x),this._volume=x}setPlaybackRate(x){this._playbackRate=x,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(x){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=x,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=x=>this._onRegisterAfterWorldMatrixUpdate(x),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(x){var O;if(x.getBoundingInfo){const O=x.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(x.absolutePosition);null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const x=()=>{(0,pO.g)((()=>this._isReadyToPlay),(()=>{Q._audioBuffer=this.getAudioBuffer(),Q._isReadyToPlay=!0,Q.autoplay&&Q.play(0,this._offset,this._length)}),void 0,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Q=new PO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&Q.setAttenuationFunction(this._customAttenuationFunction),Q.setPosition(this._position),Q.setPlaybackRate(this._playbackRate),x(),Q}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const x={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(x.connectedMeshId=this._connectedTransformNode.id),x.position=this._position.mV(),x.refDistance=this.refDistance,x.distanceModel=this.distanceModel,x.isDirectional=this._isDirectional,x.localDirectionToMesh=this._localDirection.mV(),x.coneInnerAngle=this._coneInnerAngle,x.coneOuterAngle=this._coneOuterAngle,x.coneOuterGain=this._coneOuterGain),x}static Parse(x,O,Q,X){const n=x.name;let V;V=x.url?Q+x.url:Q+n;const o={autoplay:x.autoplay,loop:x.loop,volume:x.volume,spatialSound:x.spatialSound,maxDistance:x.maxDistance,rolloffFactor:x.rolloffFactor,refDistance:x.refDistance,distanceModel:x.distanceModel,playbackRate:x.playbackRate};let l;if(X){const x=()=>{(0,pO.g)((()=>X._isReadyToPlay),(()=>{l._audioBuffer=X.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,l._offset,l._length)}),void 0,300)};l=new PO(n,new ArrayBuffer(0),O,null,o),x()}else l=new PO(n,V,O,(()=>{O.removePendingData(l)}),o),O.addPendingData(l);if(x.position){const O=Z.n.Xo(x.position);l.setPosition(O)}if(x.isDirectional&&(l.setDirectionalCone(x.coneInnerAngle||360,x.coneOuterAngle||360,x.coneOuterGain||0),x.localDirectionToMesh)){const O=Z.n.Xo(x.localDirectionToMesh);l.setLocalDirectionToMesh(O)}if(x.connectedMeshId){const Q=O.getMeshById(x.connectedMeshId);Q&&l.attachToMesh(Q)}return x.metadata&&(l.metadata=x.metadata),l}_setOffset(x){this._offset!==x&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=x)}_clearTimeoutsAndObservers(){var x;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(x=SO.c.audioEngine)||void 0===x||x.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}PO._SceneComponentInitialization=x=>{throw(0,HO.b)("AudioSceneComponent")},(0,qx.d)("BABYLON.Sound",PO);class mO{constructor(x,O,Q){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==Q.length)throw new Error("Sounds length does not equal weights length");this.loop=x,this._weights=Q;let X=0;for(const n of Q)X+=n;const Z=X>0?1/X:0;for(let n=0;n<this._weights.length;n++)this._weights[n]*=Z;this._sounds=O;for(const n of this._sounds)n.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(x){if(x!==this._coneInnerAngle){if(this._coneOuterAngle<x)return void K.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=x;for(const O of this._sounds)O.directionalConeInnerAngle=x}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(x){if(x!==this._coneOuterAngle){if(x<this._coneInnerAngle)return void K.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=x;for(const O of this._sounds)O.directionalConeOuterAngle=x}}get volume(){return this._volume}set volume(x){if(x!==this._volume)for(const O of this._sounds)O.setVolume(x)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(x){if(!this.isPaused){this.stop();const x=Math.random();let O=0;for(let Q=0;Q<this._weights.length;Q++)if(O+=this._weights[Q],x<=O){this._currentIndex=Q;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:x):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class wO{constructor(x){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(x=x||a.c.LastCreatedScene)&&(this._scene=x,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var x;null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&SO.c.audioEngine.audioContext&&(this._outputAudioNode=SO.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(SO.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(SO.c.audioEngine&&SO.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(x){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&x.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==x.soundTrackId&&(-1===x.soundTrackId?this._scene.mainSoundTrack.removeSound(x):this._scene.soundTracks&&this._scene.soundTracks[x.soundTrackId].removeSound(x)),this.soundCollection.push(x),x.soundTrackId=this.id}removeSound(x){const O=this.soundCollection.indexOf(x);-1!==O&&this.soundCollection.splice(O,1)}setVolume(x){var O;null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=x)}switchPanningModelToHRTF(){var x;if(null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var x;if(null!==(x=SO.c.audioEngine)&&void 0!==x&&x.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(x){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=x,null!==(O=SO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,SO.c.audioEngine.masterGain))}}var xQ=Q(11237),OQ=Q(11423),QQ=Q(10897);SO.c.AudioEngineFactory=(x,O,Q)=>new XQ(x,O,Q);class XQ{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new U.b,this.onAudioLockedObservable=new U.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,QQ.g)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const X=document.createElement("audio");this._hostElement=x,this._audioContext=O,this._audioDestination=Q;try{X&&X.canPlayType&&(X.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||X.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Z){}try{X&&X.canPlayType&&X.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Z){}}lock(){this._triggerSuspendedState()}unlock(){var x,O;if("running"===(null===(x=this._audioContext)||void 0===x?void 0:x.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{K.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var x;null===(x=this._audioContext)||void 0===x||x.addEventListener("statechange",(()=>{var x;this.unlocked&&"running"!==(null===(x=this._audioContext)||void 0===x?void 0:x.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var x;return null!==(x=this._audioContext)&&void 0!==x&&x.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(x){this.canUseWebAudio=!1,K.e.Error("Web Audio: "+x.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(x){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const x=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(x)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var x;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(x=this._audioContext)||void 0===x||x.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(x){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=x)}connectToAnalyser(x){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=x,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var ZQ=Q(10917);(0,Q(12354).f)(xQ.e.NAME_AUDIO,((x,O,Q,X)=>{let Z,n=[];if(Q.Yh=Q.Yh||[],void 0!==x.Yh&&null!==x.Yh)for(let o=0,l=x.Yh.length;o<l;o++){var V;const l=x.Yh[o];null!==(V=SO.c.audioEngine)&&void 0!==V&&V.canUseWebAudio?(l.url||(l.url=l.name),n[l.url]?Q.Yh.push(PO.Parse(l,O,X,n[l.url])):(Z=PO.Parse(l,O,X),n[l.url]=Z,Q.Yh.push(Z))):Q.Yh.push(new PO(l.name,null,O))}n=[]})),Object.defineProperty(OQ.d.prototype,"mainSoundTrack",{get:function(){let x=this._getComponent(xQ.e.NAME_AUDIO);return x||(x=new nQ(this),this.o(x)),this._mainSoundTrack||(this._mainSoundTrack=new wO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),OQ.d.prototype.getSoundByName=function(x){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===x)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let Q=0;Q<this.soundTracks.length;Q++)for(O=0;O<this.soundTracks[Q].soundCollection.length;O++)if(this.soundTracks[Q].soundCollection[O].name===x)return this.soundTracks[Q].soundCollection[O];return null},Object.defineProperty(OQ.d.prototype,"audioEnabled",{get:function(){let x=this._getComponent(xQ.e.NAME_AUDIO);return x||(x=new nQ(this),this.o(x)),x.audioEnabled},set:function(x){let O=this._getComponent(xQ.e.NAME_AUDIO);O||(O=new nQ(this),this.o(O)),x?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(OQ.d.prototype,"headphone",{get:function(){let x=this._getComponent(xQ.e.NAME_AUDIO);return x||(x=new nQ(this),this.o(x)),x.headphone},set:function(x){let O=this._getComponent(xQ.e.NAME_AUDIO);O||(O=new nQ(this),this.o(O)),x?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(OQ.d.prototype,"audioListenerPositionProvider",{get:function(){let x=this._getComponent(xQ.e.NAME_AUDIO);return x||(x=new nQ(this),this.o(x)),x.audioListenerPositionProvider},set:function(x){let O=this._getComponent(xQ.e.NAME_AUDIO);if(O||(O=new nQ(this),this.o(O)),x&&"function"!==typeof x)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=x},enumerable:!0,configurable:!0}),Object.defineProperty(OQ.d.prototype,"audioListenerRotationProvider",{get:function(){let x=this._getComponent(xQ.e.NAME_AUDIO);return x||(x=new nQ(this),this.o(x)),x.audioListenerRotationProvider},set:function(x){let O=this._getComponent(xQ.e.NAME_AUDIO);if(O||(O=new nQ(this),this.o(O)),x&&"function"!==typeof x)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=x},enumerable:!0,configurable:!0}),Object.defineProperty(OQ.d.prototype,"audioPositioningRefreshRate",{get:function(){let x=this._getComponent(xQ.e.NAME_AUDIO);return x||(x=new nQ(this),this.o(x)),x.audioPositioningRefreshRate},set:function(x){let O=this._getComponent(xQ.e.NAME_AUDIO);O||(O=new nQ(this),this.o(O)),O.audioPositioningRefreshRate=x},enumerable:!0,configurable:!0});class nQ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(x){this.name=xQ.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new Z.n,this._cachedCameraPosition=new Z.n,this._lastCheck=0,this._invertMatrixTemp=new Z.c,this._cameraDirectionTemp=new Z.n,(x=x||a.c.LastCreatedScene)&&(this.RO=x,x.soundTracks=[],x.Yh=[])}register(){this.RO._afterRenderStage.registerStep(xQ.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(x){if(x.Yh=[],this.RO.soundTracks)for(let O=0;O<this.RO.soundTracks.length;O++){const Q=this.RO.soundTracks[O];for(let O=0;O<Q.soundCollection.length;O++)x.Yh.push(Q.soundCollection[O].serialize())}}addFromContainer(x){if(x.Yh)for(const O of x.Yh)O.play(),O.autoplay=!0,this.RO.mainSoundTrack.addSound(O)}removeFromContainer(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(x.Yh)for(const Q of x.Yh)Q.stop(),Q.autoplay=!1,this.RO.mainSoundTrack.removeSound(Q),O&&Q.dispose()}dispose(){const x=this.RO;if(x._mainSoundTrack&&x.mainSoundTrack.dispose(),x.soundTracks)for(let O=0;O<x.soundTracks.length;O++)x.soundTracks[O].dispose()}disableAudio(){const x=this.RO;let O;for(this._audioEnabled=!1,SO.c.audioEngine&&SO.c.audioEngine.audioContext&&SO.c.audioEngine.audioContext.suspend(),O=0;O<x.mainSoundTrack.soundCollection.length;O++)x.mainSoundTrack.soundCollection[O].pause();if(x.soundTracks)for(O=0;O<x.soundTracks.length;O++)for(let Q=0;Q<x.soundTracks[O].soundCollection.length;Q++)x.soundTracks[O].soundCollection[Q].pause()}enableAudio(){const x=this.RO;let O;for(this._audioEnabled=!0,SO.c.audioEngine&&SO.c.audioEngine.audioContext&&SO.c.audioEngine.audioContext.resume(),O=0;O<x.mainSoundTrack.soundCollection.length;O++)x.mainSoundTrack.soundCollection[O].isPaused&&x.mainSoundTrack.soundCollection[O].play();if(x.soundTracks)for(O=0;O<x.soundTracks.length;O++)for(let Q=0;Q<x.soundTracks[O].soundCollection.length;Q++)x.soundTracks[O].soundCollection[Q].isPaused&&x.soundTracks[O].soundCollection[Q].play()}switchAudioModeForHeadphones(){const x=this.RO;if(this._headphone=!0,x.mainSoundTrack.switchPanningModelToHRTF(),x.soundTracks)for(let O=0;O<x.soundTracks.length;O++)x.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const x=this.RO;if(this._headphone=!1,x.mainSoundTrack.switchPanningModelToEqualPower(),x.soundTracks)for(let O=0;O<x.soundTracks.length;O++)x.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const x=ZQ.c.Now;if(this._lastCheck&&x-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=x;const O=this.RO;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const Q=SO.c.audioEngine;if(Q&&Q.audioContext){let x,X=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(X=O.activeCameras[0]),this.audioListenerPositionProvider){const x=this.audioListenerPositionProvider();Q.audioContext.listener.setPosition(x.x||0,x.y||0,x.z||0)}else X?this._cachedCameraPosition.equals(X.globalPosition)||(this._cachedCameraPosition.V(X.globalPosition),Q.audioContext.listener.setPosition(X.globalPosition.x,X.globalPosition.y,X.globalPosition.z)):Q.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const x=this.audioListenerRotationProvider();Q.audioContext.listener.setOrientation(x.x||0,x.y||0,x.z||0,0,1,0)}else X?(X.rigCameras&&X.rigCameras.length>0&&(X=X.rigCameras[0]),X.getViewMatrix().invertToRef(this._invertMatrixTemp),Z.n.TransformNormalToRef(nQ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.V(this._cameraDirectionTemp),Q.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Q.audioContext.listener.setOrientation(0,0,0,0,1,0);for(x=0;x<O.mainSoundTrack.soundCollection.length;x++){const Q=O.mainSoundTrack.soundCollection[x];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}if(O.soundTracks)for(x=0;x<O.soundTracks.length;x++)for(let Q=0;Q<O.soundTracks[x].soundCollection.length;Q++){const X=O.soundTracks[x].soundCollection[Q];X.useCustomAttenuation&&X.updateDistanceFromListener()}}}}nQ._CameraDirection=new Z.n(0,0,-1),PO._SceneComponentInitialization=x=>{let O=x._getComponent(xQ.e.NAME_AUDIO);O||(O=new nQ(x),x.o(O))};const VQ="MSFT_audio_emitter";class oQ{constructor(x){this.name=VQ,this._loader=x,this.enabled=this._loader.isExtensionUsed(VQ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const x=this._loader.oo.extensions;if(x&&x[this.name]){const O=x[this.name];this._clips=O.clips,this._emitters=O.emitters,r.Assign(this._clips),r.Assign(this._emitters)}}loadSceneAsync(x,O){return T.LoadExtensionAsync(x,O,this.name,(async(Q,X)=>{const Z=new Array;Z.push(this._loader.loadSceneAsync(x,O));for(const x of X.emitters){const O=r.Get(`${Q}/emitters`,this._emitters,x);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${Q}: Direction or Distance properties are not allowed on emitters attached to a scene`);Z.push(this._loadEmitterAsync(`${Q}/emitters/${O.index}`,O))}await Promise.all(Z)}))}loadNodeAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(x,X)=>{const n=new Array,o=await this._loader.loadNodeAsync(x,O,(O=>{for(const Q of X.emitters){const X=r.Get(`${x}/emitters`,this._emitters,Q);n.push(this._loadEmitterAsync(`${x}/emitters/${X.index}`,X).then((()=>{for(const x of X._babylonSounds)x.attachToMesh(O),void 0==X.innerAngle&&void 0==X.outerAngle||(x.setLocalDirectionToMesh(Z.n.Forward()),x.setDirectionalCone(2*V.g.ToDegrees(void 0==X.innerAngle?Math.PI:X.innerAngle),2*V.g.ToDegrees(void 0==X.outerAngle?Math.PI:X.outerAngle),0))})))}Q(O)}));return await Promise.all(n),o}))}loadAnimationAsync(x,O){return T.LoadExtensionAsync(x,O,this.name,(async(Q,X)=>{const Z=await this._loader.loadAnimationAsync(x,O),n=new Array;r.Assign(X.events);for(const V of X.events)n.push(this._loadAnimationEventAsync(`${Q}/events/${V.index}`,x,O,V,Z));return await Promise.all(n),Z}))}_loadClipAsync(x,O){if(O._objectURL)return O._objectURL;let Q;if(O.uri)Q=this._loader.loadUriAsync(x,O,O.uri);else{const X=r.Get(`${x}/bufferView`,this._loader.oo.bufferViews,O.bufferView);Q=this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return O._objectURL=Q.then((x=>URL.createObjectURL(new Blob([x],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(x,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const x=new Array,Q=O.name||`emitter${O.index}`,X={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let n=0;n<O.clips.length;n++){const Z=`/extensions/${this.name}/clips`,V=r.Get(Z,this._clips,O.clips[n].clip);x.push(this._loadClipAsync(`${Z}/${O.clips[n].clip}`,V).then((x=>{const Z=O._babylonSounds[n]=new PO(Q,x,this._loader.babylonScene,null,X);Z.refDistance=O.refDistance||1,Z.maxDistance=O.maxDistance||256,Z.rolloffFactor=O.rolloffFactor||1,Z.distanceModel=O.distanceModel||"exponential"})))}const Z=Promise.all(x).then((()=>{const x=O.clips.map((x=>x.weight||1)),Q=new mO(O.loop||!1,O._babylonSounds,x);O.innerAngle&&(Q.directionalConeInnerAngle=2*V.g.ToDegrees(O.innerAngle)),O.outerAngle&&(Q.directionalConeOuterAngle=2*V.g.ToDegrees(O.outerAngle)),O.volume&&(Q.volume=O.volume),O._babylonData.sound=Q}));O._babylonData={loaded:Z}}return O._babylonData.loaded}_getEventAction(x,O,Q,X,Z){switch(Q){case"play":return x=>{const Q=(Z||0)+(x-X);O.play(Q)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${x}: Unsupported action ${Q}`)}}_loadAnimationEventAsync(x,O,Q,X,Z){if(0==Z.targetedAnimations.length)return Promise.resolve();const n=Z.targetedAnimations[0],V=X.i,o=r.Get(`/extensions/${this.name}/emitters`,this._emitters,V);return this._loadEmitterAsync(x,o).then((()=>{const O=o._babylonData.sound;if(O){const Q=new iO(X.time,this._getEventAction(x,O,X.action,X.time,X.startOffset));n.animation.addEvent(Q),Z.onAnimationGroupEndObservable.add((()=>{O.stop()})),Z.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}D(VQ),b(VQ,!0,(x=>new oQ(x)));const lQ="MSFT_lod";class CQ{constructor(x){var O;this.name=lQ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new U.b,this.onMaterialLODsLoadedObservable=new U.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=x,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[lQ])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(lQ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let x=0;x<this._nodePromiseLODs.length;x++){const O=Promise.all(this._nodePromiseLODs[x]).then((()=>{0!==x&&(this._loader.endPerformanceCounter(`Node LOD ${x}`),this._loader.log(`Loaded node LOD ${x}`)),this.onNodeLODsLoadedObservable.notifyObservers(x),x!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${x+1}`),this._loadBufferLOD(this._nodeBufferLODs,x+1),this._nodeSignalLODs[x]&&this._nodeSignalLODs[x].resolve())}));this._loader._completePromises.push(O)}for(let x=0;x<this._materialPromiseLODs.length;x++){const O=Promise.all(this._materialPromiseLODs[x]).then((()=>{0!==x&&(this._loader.endPerformanceCounter(`Material LOD ${x}`),this._loader.log(`Loaded material LOD ${x}`)),this.onMaterialLODsLoadedObservable.notifyObservers(x),x!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${x+1}`),this._loadBufferLOD(this._materialBufferLODs,x+1),this._materialSignalLODs[x]&&this._materialSignalLODs[x].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(x,O){const Q=this._loader.loadSceneAsync(x,O);return this._loadBufferLOD(this._bufferLODs,0),Q}loadNodeAsync(x,O,Q){return T.LoadExtensionAsync(x,O,this.name,(async(x,Z)=>{let n;const V=this._getLODs(x,O,this._loader.oo.nodes,Z.ids);this._loader.logOpen(`${x}`);for(let O=0;O<V.length;O++){const x=V[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new X);const Z=x=>{Q(x),x.Jo(!1)},o=this._loader.loadNodeAsync(`/nodes/${x.index}`,x,Z).then((x=>{if(0!==O){const x=V[O-1];x._babylonTransformNode&&(this._disposeTransformNode(x._babylonTransformNode),delete x._babylonTransformNode)}return x.Jo(!0),x}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?n=o:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(o))}return this._loader.logClose(),await n}))}_loadMaterialAsync(x,O,Q,X,Z){return this._nodeIndexLOD?null:T.LoadExtensionAsync(x,O,this.name,(async(x,n)=>{let V;const o=this._getLODs(x,O,this._loader.oo.materials,n.ids);this._loader.logOpen(`${x}`);for(let O=0;O<o.length;O++){const x=o[O];0!==O&&(this._materialIndexLOD=O);const n=this._loader._loadMaterialAsync(`/materials/${x.index}`,x,Q,X,(x=>{0===O&&Z(x)})).then((x=>{if(0!==O){Z(x);const Q=o[O-1]._data;Q[X]&&(this._disposeMaterials([Q[X].babylonMaterial]),delete Q[X])}return x}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?V=n:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(n))}return this._loader.logClose(),await V}))}_loadUriAsync(x,O,Q){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const Z=this._nodeIndexLOD-1;return this._nodeSignalLODs[Z]=this._nodeSignalLODs[Z]||new X,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(x,O,Q)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const Z=this._materialIndexLOD-1;return this._materialSignalLODs[Z]=this._materialSignalLODs[Z]||new X,this._materialSignalLODs[Z].promise.then((async()=>await this._loader.loadUriAsync(x,O,Q)))}return null}loadBufferAsync(x,O,Q,Z){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${x}: Uri is missing or the binary glTF is missing its binary chunk`);const O=async(x,O)=>{const n=Q,V=n+Z-1;let o=x[O];return o?(o.start=Math.min(o.start,n),o.end=Math.max(o.end,V)):(o={start:n,end:V,loaded:new X},x[O]=o),await o.loaded.promise.then((x=>new Uint8Array(x.buffer,x.byteOffset+Q-o.start,Z)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(x,O){const Q=x[O];Q&&(this._loader.log(`Loading buffer range [${Q.start}-${Q.end}]`),this._loader.bin.readAsync(Q.start,Q.end-Q.start+1).then((x=>{Q.loaded.resolve(x)}),(x=>{Q.loaded.reject(x)})))}_getLODs(x,O,Q,X){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const Z=[];for(let n=X.length-1;n>=0;n--)if(Z.push(r.Get(`${x}/ids/${X[n]}`,Q,X[n])),Z.length===this.maxLODsToLoad)return Z;return Z.push(O),Z}_disposeTransformNode(x){const O=[],Q=x.material;Q&&O.push(Q);for(const Z of x.getChildMeshes())Z.material&&O.push(Z.material);x.dispose();const X=O.filter((x=>this._loader.babylonScene.meshes.every((O=>O.material!=x))));this._disposeMaterials(X)}_disposeMaterials(x){const O={};for(const Q of x){for(const x of Q.getActiveTextures())O[x.uniqueId]=x;Q.dispose()}for(const Q in O)for(const x of this._loader.babylonScene.materials)x.hasTexture(O[Q])&&delete O[Q];for(const Q in O)O[Q].dispose()}}D(lQ),b(lQ,!0,(x=>new CQ(x)));const UQ="MSFT_minecraftMesh";class LQ{constructor(x){this.name=UQ,this._loader=x,this.enabled=this._loader.isExtensionUsed(UQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtraAsync(x,O,this.name,(async(X,Z)=>{if(Z){if(!(Q instanceof v.d))throw new Error(`${X}: Material type not supported`);const Z=this._loader.loadMaterialPropertiesAsync(x,O,Q);return Q.needAlphaBlending()&&(Q.forceDepthWrite=!0,Q.separateCullingPass=!0),Q.PV=Q.forceDepthWrite,Q.twoSidedLighting=!0,await Z}}))}}D(UQ),b(UQ,!0,(x=>new LQ(x)));const hQ="MSFT_sRGBFactors";class NQ{constructor(x){this.name=hQ,this._loader=x,this.enabled=this._loader.isExtensionUsed(hQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(x,O,Q){return T.LoadExtraAsync(x,O,this.name,(async(X,Z)=>{if(Z){if(!(Q instanceof v.d))throw new Error(`${X}: Material type not supported`);const Z=this._loader.loadMaterialPropertiesAsync(x,O,Q),n=Q.kx().getEngine().useExactSrgbConversions;return Q.albedoTexture||Q.albedoColor.toLinearSpaceToRef(Q.albedoColor,n),Q.reflectivityTexture||Q.reflectivityColor.toLinearSpaceToRef(Q.reflectivityColor,n),await Z}}))}}D(hQ),b(hQ,!0,(x=>new NQ(x)));var aQ=Q(12694);const KQ={};var MQ=Q(12739),YQ=Q(12722),gQ=Q(12700),vQ=Q(12707);function RQ(x,O){for(const Q of x)for(const x of Q.dataOutputs)if(x.uniqueId===O)return x;throw new Error("Could not find data out connection with unique id "+O)}function sQ(x,O){for(const Q of x)if(Q instanceof YQ.e)for(const x of Q.signalInputs)if(x.uniqueId===O)return x;throw new Error("Could not find signal in connection with unique id "+O)}async function qQ(x,O){const X=await Promise.all(x.allBlocks.map((async x=>{const O=function(x){switch(x){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Q.e(58),Q.e(59)]).then(Q.bind(Q,14150))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Q.e(60).then(Q.bind(Q,14157))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Q.e(61).then(Q.bind(Q,14160))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Q.e(62).then(Q.bind(Q,14167))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Q.e(63).then(Q.bind(Q,14173))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Q.e(64).then(Q.bind(Q,14178))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Q.e(65).then(Q.bind(Q,14184))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Q.e(66).then(Q.bind(Q,14189))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Q.e(67).then(Q.bind(Q,14197))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Q.e(70).then(Q.bind(Q,14222))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Q.e(70).then(Q.bind(Q,14222))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Q.e(70).then(Q.bind(Q,14222))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Q.e(70).then(Q.bind(Q,14222))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Q.e(75).then(Q.bind(Q,14224))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Q.e(76).then(Q.bind(Q,14229))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Q.e(77).then(Q.bind(Q,14234))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Q.e(78).then(Q.bind(Q,14242))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Q.e(79).then(Q.bind(Q,14249))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Q.e(80).then(Q.bind(Q,14254))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Q.e(81).then(Q.bind(Q,14262))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Q.e(82).then(Q.bind(Q,14270))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Q.e(83).then(Q.bind(Q,14275))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Q.e(84).then(Q.bind(Q,14281))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Q.e(85).then(Q.bind(Q,14288))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Q.e(86).then(Q.bind(Q,14297))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Q.e(87).then(Q.bind(Q,14303))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14310))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14315))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Q.e(90).then(Q.bind(Q,14317))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Q.e(91).then(Q.bind(Q,14322))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Q.e(92).then(Q.bind(Q,14327))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Q.e(93).then(Q.bind(Q,14331))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14339))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Q.e(94).then(Q.bind(Q,14347))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Q.e(95).then(Q.bind(Q,14355))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Q.e(96).then(Q.bind(Q,14361))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14364))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14201))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Q.e(74).then(Q.bind(Q,14366))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14218))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Q.e(70).then(Q.bind(Q,14222))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Q.e(70).then(Q.bind(Q,14222))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Q.e(71).then(Q.bind(Q,14370))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Q.e(71).then(Q.bind(Q,14370))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Q.e(71).then(Q.bind(Q,14370))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Q.e(71).then(Q.bind(Q,14370))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Q.e(71).then(Q.bind(Q,14370))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Q.e(71).then(Q.bind(Q,14370))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Q.e(97).then(Q.bind(Q,14377))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Q.e(98).then(Q.bind(Q,14386))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Q.e(99).then(Q.bind(Q,14389))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Q.e(100).then(Q.bind(Q,14393))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Q.e(101).then(Q.bind(Q,14400))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Q.e(102).then(Q.bind(Q,14407))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Q.e(103).then(Q.bind(Q,14413))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Q.e(104).then(Q.bind(Q,14417))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Q.e(105).then(Q.bind(Q,14420))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Q.e(106).then(Q.bind(Q,14426))).FlowGraphDataSwitchBlock;default:if(KQ[x])return KQ[x];throw new Error(`Unknown block name ${x}`)}}(x.className);return await O()})));return function(x,O,Q){const X=O.coordinator.createGraph(),Z=[],n=O.valueParseFunction??gQ.b;for(let V=0;V<x.allBlocks.length;V++){const o=kQ(x.allBlocks[V],{RO:O.coordinator.config.RO,pathConverter:O.pathConverter,assetsContainer:O.coordinator.config.RO,valueParseFunction:n},Q[V]);Z.push(o),o instanceof MQ.e&&X.addEventBlock(o)}for(const V of Z){for(const x of V.dataInputs)for(const O of x.connectedPointIds){const Q=RQ(Z,O);x.connectTo(Q)}if(V instanceof YQ.e)for(const x of V.signalOutputs)for(const O of x.connectedPointIds){const Q=sQ(Z,O);x.connectTo(Q)}}for(const V of x.executionContexts)GQ(V,{graph:X,valueParseFunction:n},x.rightHanded);return X}(x,O,X)}function GQ(x,O,Q){const X=O.graph.createContext();x.enableLogging&&(X.enableLogging=!0),X.treatDataAsRightHanded=Q||!1;const Z=O.valueParseFunction??gQ.b;X.uniqueId=x.uniqueId;const n=X.kx();if(x._assetsContext){var V,o,l,C,U,L,h,N,a,K;const O=x._assetsContext,Q={meshes:null===(V=O.meshes)||void 0===V?void 0:V.map((x=>n.getMeshById(x))),lights:null===(o=O.lights)||void 0===o?void 0:o.map((x=>n.getLightByName(x))),cameras:null===(l=O.cameras)||void 0===l?void 0:l.map((x=>n.getCameraByName(x))),materials:null===(C=O.materials)||void 0===C?void 0:C.map((x=>n.getMaterialById(x))),textures:null===(U=O.textures)||void 0===U?void 0:U.map((x=>n.getTextureByName(x))),animations:null===(L=O.animations)||void 0===L?void 0:L.map((x=>n.animations.find((O=>O.name===x)))),skeletons:null===(h=O.skeletons)||void 0===h?void 0:h.map((x=>n.getSkeletonByName(x))),fL:null===(N=O.fL)||void 0===N?void 0:N.map((x=>n.getParticleSystemById(x))),animationGroups:null===(a=O.animationGroups)||void 0===a?void 0:a.map((x=>n.getAnimationGroupByName(x))),transformNodes:null===(K=O.transformNodes)||void 0===K?void 0:K.map((x=>n.getTransformNodeById(x))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Yh:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};X.assetsContext=Q}for(const M in x._userVariables){const O=Z(M,x._userVariables,X.assetsContext,n);X.userVariables[M]=O}for(const M in x._connectionValues){const O=Z(M,x._connectionValues,X.assetsContext,n);X._setConnectionValueByKey(M,O)}return X}function kQ(x,O,Q){const X={},Z=O.valueParseFunction??gQ.b;if(x.config)for(const V in x.config)X[V]=Z(V,x.config,O.assetsContainer||O.RO,O.RO);if((0,gQ.h)(x.className)){if(!O.pathConverter)throw new Error("Path converter is required for this block");X.pathConverter=O.pathConverter}const n=new Q(X);n.uniqueId=x.uniqueId;for(let V=0;V<x.dataInputs.length;V++){const O=n.getDataInput(x.dataInputs[V].name);if(!O)throw new Error("Could not find data input with name "+x.dataInputs[V].name+" in block "+x.className);O.deserialize(x.dataInputs[V])}for(let V=0;V<x.dataOutputs.length;V++){const O=n.getDataOutput(x.dataOutputs[V].name);if(!O)throw new Error("Could not find data output with name "+x.dataOutputs[V].name+" in block "+x.className);O.deserialize(x.dataOutputs[V])}return n.metadata=x.metadata,n.deserialize&&n.deserialize(x),n}function JQ(x){const[O,Q]=x.split(":");return tQ({op:O,extension:Q})}function tQ(x){var O;let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=x.extension?null===(O=dQ[x.extension])||void 0===O?void 0:O[x.op]:uQ[x.op];if(!X&&(K.e.Warn(`No mapping found for operation ${x.op} and extension ${x.extension||"KHR_interactivity"}`),Q)){const O={},Q={flows:{}};if(x.inputValueSockets){O.values={};for(const Q in x.inputValueSockets)O.values[Q]={name:Q}}return x.outputValueSockets&&(Q.values={},Object.keys(x.outputValueSockets).forEach((x=>{Q.values[x]={name:x}}))),{pC:[],inputs:O,outputs:Q}}return X}function cQ(x,O,Q){dQ[O]||(dQ[O]={}),dQ[O][x]=Q}const dQ={BABYLON:{"flow/log":{pC:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},uQ={"event/onStart":{pC:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{pC:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{pC:["FlowGraphSendCustomEventBlock"],extraProcessor(x,O,Q,X,Z){if("event/send"!==O.op||!x.configuration||1!==Object.keys(x.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=x.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const V=X.arrays.events[n],o=Z[0];return o.config||(o.config={}),o.config.eventId=V.eventId,o.config.eventData=V.eventData,Z}},"event/receive":{pC:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(x,O){var Q;if(!x.configuration)return K.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const X=x.configuration.event;if(!X)return K.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const Z=X.value[0];if("number"!==typeof Z)return K.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Q=O.events)||void 0===Q?void 0:Q[Z])?{valid:!0}:(K.e.Error(`Event with id ${Z} not found`),{valid:!1,error:`Event with id ${Z} not found`})},extraProcessor(x,O,Q,X,Z){if("event/receive"!==O.op||!x.configuration||1!==Object.keys(x.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=x.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const V=X.arrays.events[n],o=Z[0];return o.config||(o.config={}),o.config.eventId=V.eventId,o.config.eventData=V.eventData,Z}},"math/e":AQ("FlowGraphEBlock"),"math/pi":AQ("FlowGraphPIBlock"),"math/inf":AQ("FlowGraphInfBlock"),"math/nan":AQ("FlowGraphNaNBlock"),"math/abs":AQ("FlowGraphAbsBlock"),"math/sign":AQ("FlowGraphSignBlock"),"math/trunc":AQ("FlowGraphTruncBlock"),"math/floor":AQ("FlowGraphFloorBlock"),"math/ceil":AQ("FlowGraphCeilBlock"),"math/round":{pC:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z){var n;return(n=Z[0]).config||(n.config={}),Z[0].config.roundHalfAwayFromZero=!0,Z}},"math/fract":AQ("FlowGraphFractBlock"),"math/neg":AQ("FlowGraphNegationBlock"),"math/add":AQ("FlowGraphAddBlock",["a","b"],!0),"math/sub":AQ("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{pC:["FlowGraphMultiplyBlock"],extraProcessor(x,O,Q,X,Z){var n;(n=Z[0]).config||(n.config={}),Z[0].config.useMatrixPerComponent=!0,Z[0].config.preventIntegerFloatArithmetic=!0;let V=-1;return Object.keys(x.values||{}).find((O=>{var Q;return void 0!==(null===(Q=x.values)||void 0===Q?void 0:Q[O].type)&&(V=x.values[O].type,!0)})),-1!==V&&(Z[0].config.type=X.arrays.types[V].flowGraphType),Z},validation:x=>x.values?fQ(x):{valid:!0}},"math/div":AQ("FlowGraphDivideBlock",["a","b"],!0),"math/rem":AQ("FlowGraphModuloBlock",["a","b"]),"math/min":AQ("FlowGraphMinBlock",["a","b"]),"math/max":AQ("FlowGraphMaxBlock",["a","b"]),"math/clamp":AQ("FlowGraphClampBlock",["a","b","c"]),"math/saturate":AQ("FlowGraphSaturateBlock"),"math/mix":AQ("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":AQ("FlowGraphEqualityBlock",["a","b"]),"math/lt":AQ("FlowGraphLessThanBlock",["a","b"]),"math/le":AQ("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":AQ("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":AQ("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":AQ("FlowGraphIsNaNBlock"),"math/isinf":AQ("FlowGraphIsInfBlock"),"math/select":{pC:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{pC:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":AQ("FlowGraphSinBlock"),"math/cos":AQ("FlowGraphCosBlock"),"math/tan":AQ("FlowGraphTanBlock"),"math/asin":AQ("FlowGraphASinBlock"),"math/acos":AQ("FlowGraphACosBlock"),"math/atan":AQ("FlowGraphATanBlock"),"math/atan2":AQ("FlowGraphATan2Block",["a","b"]),"math/sinh":AQ("FlowGraphSinhBlock"),"math/cosh":AQ("FlowGraphCoshBlock"),"math/tanh":AQ("FlowGraphTanhBlock"),"math/asinh":AQ("FlowGraphASinhBlock"),"math/acosh":AQ("FlowGraphACoshBlock"),"math/atanh":AQ("FlowGraphATanhBlock"),"math/exp":AQ("FlowGraphExponentialBlock"),"math/log":AQ("FlowGraphLogBlock"),"math/log2":AQ("FlowGraphLog2Block"),"math/log10":AQ("FlowGraphLog10Block"),"math/sqrt":AQ("FlowGraphSquareRootBlock"),"math/cbrt":AQ("FlowGraphCubeRootBlock"),"math/pow":AQ("FlowGraphPowerBlock",["a","b"]),"math/length":AQ("FlowGraphLengthBlock"),"math/normalize":AQ("FlowGraphNormalizeBlock"),"math/dot":AQ("FlowGraphDotBlock",["a","b"]),"math/cross":AQ("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":AQ("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":AQ("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{pC:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{pC:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{pC:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{pC:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{pC:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{pC:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{pC:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":AQ("FlowGraphTransposeBlock"),"math/determinant":AQ("FlowGraphDeterminantBlock"),"math/inverse":AQ("FlowGraphInvertMatrixBlock"),"math/matmul":AQ("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{pC:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Qo",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z,n){const V=Z[0].dataInputs.find((x=>"rotationQuaternion"===x.name));if(!V)throw new Error("Rotation quaternion input not found");return n._connectionValues[V.uniqueId]&&(n._connectionValues[V.uniqueId].type="Quaternion"),Z}},"math/matDecompose":{pC:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Qo"}}}},"math/quatConjugate":AQ("FlowGraphConjugateBlock",["a"]),"math/quatMul":{pC:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z){var n;return(n=Z[0]).config||(n.config={}),Z[0].config.type="Quaternion",Z}},"math/quatAngleBetween":AQ("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{pC:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":AQ("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":AQ("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{pC:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z){var n;return(n=Z[0]).config||(n.config={}),Z[0].config.inputIsColumnMajor=!0,Z}},"math/extract2x2":{pC:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{pC:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z){var n;return(n=Z[0]).config||(n.config={}),Z[0].config.inputIsColumnMajor=!0,Z}},"math/extract3x3":{pC:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{pC:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z){var n;return(n=Z[0]).config||(n.config={}),Z[0].config.inputIsColumnMajor=!0,Z}},"math/extract4x4":{pC:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{pC:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z,n){var V,o;(o=Z[0]).config||(o.config={});const l=Z[0].dataInputs[0];return Z[0].config.valueType=(null===(V=n._connectionValues[l.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",Z}},"math/and":{pC:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z,n){var V,o,l;(l=Z[0]).config||(l.config={});const C=Z[0].dataInputs[0],U=Z[0].dataInputs[1];return Z[0].config.valueType=(null===(V=n._connectionValues[C.uniqueId])||void 0===V?void 0:V.type)??(null===(o=n._connectionValues[U.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",Z}},"math/or":{pC:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z,n){var V,o,l;(l=Z[0]).config||(l.config={});const C=Z[0].dataInputs[0],U=Z[0].dataInputs[1];return Z[0].config.valueType=(null===(V=n._connectionValues[C.uniqueId])||void 0===V?void 0:V.type)??(null===(o=n._connectionValues[U.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",Z}},"math/xor":{pC:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(x,O,Q,X,Z,n){var V,o,l;(l=Z[0]).config||(l.config={});const C=Z[0].dataInputs[0],U=Z[0].dataInputs[1];return Z[0].config.valueType=(null===(V=n._connectionValues[C.uniqueId])||void 0===V?void 0:V.type)??(null===(o=n._connectionValues[U.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",Z}},"math/asr":AQ("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":AQ("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":AQ("FlowGraphLeadingZerosBlock"),"math/ctz":AQ("FlowGraphTrailingZerosBlock"),"math/popcnt":AQ("FlowGraphOneBitsCounterBlock"),"math/rad":AQ("FlowGraphDegToRadBlock"),"math/deg":AQ("FlowGraphRadToDegBlock"),"type/boolToInt":AQ("FlowGraphBooleanToInt"),"type/boolToFloat":AQ("FlowGraphBooleanToFloat"),"type/intToBool":AQ("FlowGraphIntToBoolean"),"type/intToFloat":AQ("FlowGraphIntToFloat"),"type/floatToInt":AQ("FlowGraphFloatToInt"),"type/floatToBool":AQ("FlowGraphFloatToBoolean"),"flow/sequence":{pC:["FlowGraphSequenceBlock"],extraProcessor(x,O,Q,X,Z){const n=Z[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(x.flows||[]).length,n.signalOutputs.forEach(((x,O)=>{x.name="out_"+O})),Z}},"flow/branch":{pC:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{pC:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(x){if(x.configuration&&x.configuration.cases){const O=x.configuration.cases.value;if(!O.every((x=>"number"===typeof x&&/^-?\d+$/.test(x.toString()))))return K.e.Warn("Switch cases should be integers. Using empty array instead."),x.configuration.cases.value=[],{valid:!0};const Q=new Set(O);x.configuration.cases.value=Array.from(Q)}return{valid:!0}},extraProcessor(x,O,Q,X,Z){if("flow/switch"!==O.op||!x.flows||0===Object.keys(x.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return Z[0].signalOutputs.forEach((x=>{"default"!==x.name&&(x.name="out_"+x.name)})),Z}},"flow/while":{pC:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{pC:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(x,O,Q,X,Z){const n=Z[0];return n.config||(n.config={}),n.config.incrementIndexWhenLoopDone=!0,Z}},"flow/doN":{pC:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{pC:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(x,O,Q,X,Z){if("flow/multiGate"!==O.op||!x.flows||0===Object.keys(x.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const n=Z[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(x.flows).length,n.signalOutputs.forEach(((x,O)=>{x.name="out_"+O})),Z}},"flow/waitAll":{pC:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(x){var O,Q;return"number"!==typeof(null===(O=x.configuration)||void 0===O||null===(Q=O.inputFlows)||void 0===Q?void 0:Q.value[0])&&(x.configuration=x.configuration||{inputFlows:{value:[0]}},x.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{pC:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{pC:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{pC:["FlowGraphCancelDelayBlock"]},"variable/get":{pC:["FlowGraphGetVariableBlock"],validation(x){var O,Q;return null!==(O=x.configuration)&&void 0!==O&&null!==(Q=O.variable)&&void 0!==Q&&Q.value?{valid:!0}:(K.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(x,O)=>[O.getVariableName(x[0])]}}},"variable/set":{pC:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(x,O)=>[O.getVariableName(x[0])]}}},"variable/setMultiple":{pC:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(x,O)=>[x[0].map((x=>O.getVariableName(x)))]}},extraProcessor:(x,O,Q,X,Z)=>(Z[0].dataInputs.forEach((x=>{x.name=X.getVariableName(+x.name)})),Z)},"variable/interpolate":{pC:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(x,O)=>[O.getVariableName(x[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:x=>!0===x[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",qQ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",qQ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",qQ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",qQ:"FlowGraphPlayAnimationBlock"},out:{name:"out",qQ:"FlowGraphPlayAnimationBlock"},done:{name:"done",qQ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(x,O,Q,X,Z){var n,V,o;const l=Z[0],C=null===(n=x.configuration)||void 0===n?void 0:n.variable.value[0];if("number"!==typeof C)throw K.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const U=X.arrays.staticVariables[C];"undefined"===typeof l.config.animationType.value&&(X.arrays.staticVariables,l.config.animationType.value=(0,vQ.D)(U.type));const L=Z[4];return L.config||(L.config={}),(V=L.config).variable||(V.variable={}),L.config.variable.value=X.getVariableName(C),(o=Z[3]).config||(o.config={}),Z}},"pointer/get":{pC:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",qQ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",qQ:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(x,O,Q,X,Z)=>(Z.forEach((x=>{"FlowGraphJsonPointerParserBlock"===x.className&&(x.config||(x.config={}),x.config.outputValue=!0)})),Z)},"pointer/set":{pC:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",qQ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",qQ:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(x,O,Q,X,Z)=>(Z.forEach((x=>{"FlowGraphJsonPointerParserBlock"===x.className&&(x.config||(x.config={}),x.config.outputValue=!0)})),Z)},"pointer/interpolate":{pC:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",qQ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",qQ:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",qQ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",qQ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",qQ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",qQ:"FlowGraphPlayAnimationBlock"},out:{name:"out",qQ:"FlowGraphPlayAnimationBlock"},done:{name:"done",qQ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(x,O,Q,X,Z)=>(Z.forEach((O=>{"FlowGraphJsonPointerParserBlock"===O.className?(O.config||(O.config={}),O.config.outputValue=!0):"FlowGraphInterpolationBlock"===O.className&&(O.config||(O.config={}),Object.keys(x.values||[]).forEach((Q=>{var Z;const n=null===(Z=x.values)||void 0===Z?void 0:Z[Q];if("value"===Q&&n){const x=n.type;void 0!==x&&(O.config.animationType=X.arrays.types[x].flowGraphType)}})))})),Z)},"animation/start":{pC:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",qQ:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(x,O)=>[x[0]*O._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(x,O)=>[x[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(x,O,Q,X,Z,n,V){const o=Z[Z.length-1];return o.config||(o.config={}),o.config.glTF=V,Z}},"animation/stop":{pC:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",qQ:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(x,O,Q,X,Z,n,V){const o=Z[Z.length-1];return o.config||(o.config={}),o.config.glTF=V,Z}},"animation/stopAt":{pC:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",qQ:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(x,O)=>[x[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(x,O,Q,X,Z,n,V){const o=Z[Z.length-1];return o.config||(o.config={}),o.config.glTF=V,Z}},"math/switch":{pC:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(x){if(x.configuration&&x.configuration.cases){const O=x.configuration.cases.value;if(!O.every((x=>"number"===typeof x&&/^-?\d+$/.test(x.toString()))))return K.e.Warn("Switch cases should be integers. Using empty array instead."),x.configuration.cases.value=[],{valid:!0};const Q=new Set(O);x.configuration.cases.value=Array.from(Q)}return{valid:!0}},extraProcessor(x,O,Q,X,Z){const n=Z[0];return n.dataInputs.forEach((x=>{"default"!==x.name&&"case"!==x.name&&(x.name="in_"+x.name)})),n.config||(n.config={}),n.config.treatCasesAsIntegers=!0,Z}},"debug/log":{pC:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function AQ(x){let O=arguments.length>2?arguments[2]:void 0;return{pC:[x],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((x,O)=>(x[O]={name:O},x)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(x,Q,X,Z,n){var V;if(O){(V=n[0]).config||(V.config={}),n[0].config.preventIntegerFloatArithmetic=!0;let O=-1;Object.keys(x.values||{}).find((Q=>{var X;return void 0!==(null===(X=x.values)||void 0===X?void 0:X[Q].type)&&(O=x.values[Q].type,!0)})),-1!==O&&(n[0].config.type=Z.arrays.types[O].flowGraphType)}return n},validation:x=>O?fQ(x):{valid:!0}}}function fQ(x){if(x.values){const O=Object.keys(x.values).map((O=>x.values[O].type)).filter((x=>void 0!==x));if(!O.every((x=>x===O[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}uQ["math/compose"]=uQ["math/matCompose"],uQ["math/decompose"]=uQ["math/matDecompose"];var EQ=Q(11015);const zQ={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Oo",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class FQ{constructor(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=x,this._gltf=O,this._animationTargetFps=Q,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const x of this._interactivityGraph.types)this._types.push(zQ[x.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const x of this._interactivityGraph.declarations){const O=tQ(x);if(!O)throw K.e.Error(["No mapping found for declaration",x]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:O,fullOperationName:x.extension?x.op+":"+x.extension:x.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const x of this._interactivityGraph.variables){const O=this._parseVariable(x);this._staticVariables.push(O)}}_parseVariable(x,O){const Q=this._types[x.type];if(!Q)throw K.e.Error(["No type found for variable",x]),new Error("Error parsing variables");if(x.value&&x.value.length!==Q.length)throw K.e.Error(["Invalid value length for variable",x,Q]),new Error("Error parsing variables");const X=x.value||[];if(!X.length)switch(Q.flowGraphType){case"boolean":X.push(!1);break;case"FlowGraphInteger":X.push(0);break;case"number":X.push(NaN);break;case"Vector2":X.push(NaN,NaN);break;case"Oo":X.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":X.fill(NaN,0,4);break;case"Matrix":X.fill(NaN,0,16);break;case"Matrix3D":X.fill(NaN,0,9)}return"number"===Q.elementType&&"string"===typeof X[0]&&(X[0]=parseFloat(X[0])),{type:Q.flowGraphType,value:O?O(X,this):X}}_parseEvents(){if(this._interactivityGraph.events)for(const x of this._interactivityGraph.events){const O={eventId:x.id||"internalEvent_"+this._internalEventsCounter++};x.values&&(O.eventData=Object.keys(x.values).map((O=>{var Q;const X=null===(Q=x.values)||void 0===Q?void 0:Q[O];if(!X)throw K.e.Error(["No value found for event key",O]),new Error("Error parsing events");const Z=this._types[X.type];if(!Z)throw K.e.Error(["No type found for event value",X]),new Error("Error parsing events");const n="undefined"!==typeof X.value?this._parseVariable(X):void 0;return{id:O,type:Z.flowGraphType,eventData:!0,value:n}}))),this._events.push(O)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const O of this._interactivityGraph.nodes){if("number"!==typeof O.declaration)throw K.e.Error(["No declaration found for node",O]),new Error("Error parsing nodes");const Q=this._mappings[O.declaration];if(!Q)throw K.e.Error(["No mapping found for node",O]),new Error("Error parsing nodes");if(Q.flowGraphMapping.validation){const X=Q.flowGraphMapping.validation(O,this._interactivityGraph,this._gltf);var x;if(!X.valid)throw new Error(`Error validating interactivity node ${null===(x=this._interactivityGraph.declarations)||void 0===x?void 0:x[O.declaration].op} - ${X.error}`)}const X=[];for(const x of Q.flowGraphMapping.pC){const Z=this._getEmptyBlock(x,Q.fullOperationName);this._parseNodeConfiguration(O,Z,Q.flowGraphMapping,x),X.push(Z)}this._nodes.push({pC:X,fullOperationName:Q.fullOperationName})}}_getEmptyBlock(x,O){return{uniqueId:(0,EQ.e)(),className:x,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:O,metadata:{}}}_parseNodeConfiguration(x,O,Q,X){const Z=O.config;if(x.configuration){const O=Object.keys(x.configuration);for(const o of O){var n,V;const O=null===(n=x.configuration)||void 0===n?void 0:n[o];if(!O)throw K.e.Error(["No value found for node configuration",o]),new Error("Error parsing node configuration");const l=null===(V=Q.configuration)||void 0===V?void 0:V[o];if(l&&l.qQ?l.qQ===X:0===Q.pC.indexOf(X)){const x=(null===l||void 0===l?void 0:l.name)||o;O&&"undefined"!==typeof O.value||"undefined"===typeof(null===l||void 0===l?void 0:l.defaultValue)?O.value.length>=0?Z[x]={value:1===O.value.length?O.value[0]:O.value}:K.e.Warn(["Invalid value for node configuration",O]):Z[x]={value:l.defaultValue},l&&l.dataTransformer&&(Z[x].value=l.dataTransformer([Z[x].value],this)[0])}}}}_parseNodeConnections(x){for(let q=0;q<this._nodes.length;q++){var O;const G=null===(O=this._interactivityGraph.nodes)||void 0===O?void 0:O[q];if(!G)throw K.e.Error(["No node found for interactivity node",this._nodes[q]]),new Error("Error parsing node connections");const k=this._nodes[q],J=this._mappings[G.declaration];if(!J)throw K.e.Error(["No mapping found for node",G]),new Error("Error parsing node connections");const t=G.flows||{},c=Object.keys(t).sort();for(const x of c){var Q,X,Z,n;const O=t[x],C=null===(Q=J.flowGraphMapping.outputs)||void 0===Q||null===(X=Q.flows)||void 0===X?void 0:X[x],U=(null===C||void 0===C?void 0:C.name)||x,L=this._createNewSocketConnection(U,!0);(C&&C.qQ&&k.pC.find((x=>x.className===C.qQ))||k.pC[0]).signalOutputs.push(L);const h=O.node,N=this._nodes[h];if(!N)throw K.e.Error(["No node found for input node id",h]),new Error("Error parsing node connections");const a=JQ(N.fullOperationName);if(!a)throw K.e.Error(["No mapping found for input node",N]),new Error("Error parsing node connections");let M=null===(Z=a.inputs)||void 0===Z||null===(n=Z.flows)||void 0===n?void 0:n[O.socket||"in"],Y=!1;if(!M)for(const x in null===(V=a.inputs)||void 0===V?void 0:V.flows){var V,o,l;if(x.startsWith("[")&&x.endsWith("]"))Y=!0,M=null===(o=a.inputs)||void 0===o||null===(l=o.flows)||void 0===l?void 0:l[x]}const g=M?Y?M.name.replace("$1",O.socket||""):M.name:O.socket||"in",v=M&&M.qQ&&N.pC.find((x=>x.className===M.qQ))||N.pC[0];let R=v.signalInputs.find((x=>x.name===g));R||(R=this._createNewSocketConnection(g),v.signalInputs.push(R)),R.connectedPointIds.push(L.uniqueId),L.connectedPointIds.push(R.uniqueId)}const d=G.values||{},u=Object.keys(d);for(const O of u){var C,U;const Q=d[O];let X=null===(C=J.flowGraphMapping.inputs)||void 0===C||null===(U=C.values)||void 0===U?void 0:U[O],Z=!1;if(!X)for(const x in null===(L=J.flowGraphMapping.inputs)||void 0===L?void 0:L.values){var L,h,N;if(x.startsWith("[")&&x.endsWith("]"))Z=!0,X=null===(h=J.flowGraphMapping.inputs)||void 0===h||null===(N=h.values)||void 0===N?void 0:N[x]}const n=X?Z?X.name.replace("$1",O):X.name:O,V=this._createNewSocketConnection(n);if((X&&X.qQ&&k.pC.find((x=>x.className===X.qQ))||k.pC[0]).dataInputs.push(V),void 0!==Q.value){const O=this._parseVariable(Q,X&&X.dataTransformer);x._connectionValues[V.uniqueId]=O}else{if("undefined"===typeof Q.node)throw K.e.Error(["Invalid value for value connection",Q]),new Error("Error parsing node connections");{var a,M,Y;const x=Q.node,O=Q.socket||"value",X=this._nodes[x];if(!X)throw K.e.Error(["No node found for output socket reference",Q]),new Error("Error parsing node connections");const Z=JQ(X.fullOperationName);if(!Z)throw K.e.Error(["No mapping found for output socket reference",Q]),new Error("Error parsing node connections");let n=null===(a=Z.outputs)||void 0===a||null===(M=a.values)||void 0===M?void 0:M[O],o=!1;if(!n)for(const Q in null===(g=Z.outputs)||void 0===g?void 0:g.values){var g,v,R;if(Q.startsWith("[")&&Q.endsWith("]"))o=!0,n=null===(v=Z.outputs)||void 0===v||null===(R=v.values)||void 0===R?void 0:R[Q]}const l=n?o?n.name.replace("$1",O):null===(Y=n)||void 0===Y?void 0:Y.name:O,C=n&&n.qQ&&X.pC.find((x=>x.className===n.qQ))||X.pC[0];let U=C.dataOutputs.find((x=>x.name===l));U||(U=this._createNewSocketConnection(l,!0),C.dataOutputs.push(U)),V.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(V.uniqueId)}}}if(J.flowGraphMapping.interBlockConnectors)for(const x of J.flowGraphMapping.interBlockConnectors){const O=x.input,Q=x.output,X=x.isVariable;this._connectFlowGraphNodes(O,Q,k.pC[x.inputBlockIndex],k.pC[x.outputBlockIndex],X)}if(J.flowGraphMapping.extraProcessor){var s;const O=null===(s=this._interactivityGraph.declarations)||void 0===s?void 0:s[G.declaration];if(!O)throw K.e.Error(["No declaration found for extra processor",G]),new Error("Error parsing node connections");k.pC=J.flowGraphMapping.extraProcessor(G,O,J.flowGraphMapping,this,k.pC,x,this._gltf)}}}_createNewSocketConnection(x,O){return{uniqueId:(0,EQ.e)(),name:x,_connectionType:O?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(x,O,Q,X,Z){const n=Z?Q.dataInputs:Q.signalInputs,V=Z?X.dataOutputs:X.signalOutputs,o=n.find((O=>O.name===x))||this._createNewSocketConnection(x),l=V.find((x=>x.name===O))||this._createNewSocketConnection(O,!0);n.find((O=>O.name===x))||n.push(o),V.find((x=>x.name===O))||V.push(l),o.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(o.uniqueId)}getVariableName(x){return"staticVariable_"+x}serializeToFlowGraph(){const x={uniqueId:(0,EQ.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(x);for(let O=0;O<this._staticVariables.length;O++){const Q=this._staticVariables[O];x._userVariables[this.getVariableName(O)]=Q}return{rightHanded:!0,allBlocks:this._nodes.reduce(((x,O)=>x.concat(O.pC)),[]),executionContexts:[x]}}}const bQ="KHR_interactivity";class DQ{constructor(x){this._loader=x,this.name=bQ,this.enabled=this._loader.isExtensionUsed(bQ),this._pathConverter=(0,W.k)(this._loader.oo),x._skipStartAnimationStep=!0;const O=x.babylonScene;O&&function(x){(0,W.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!x.activeCamera)return new Z.g(NaN,NaN,NaN,NaN);const O=Z.g.FromRotationMatrix(x.activeCamera.getWorldMatrix()).normalize();return x.useRightHandedSystem||(O.w*=-1,O.x*=-1),O},type:"Quaternion",getTarget:()=>x.activeCamera}),(0,W.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!x.activeCamera)return new Z.n(NaN,NaN,NaN);const O=x.activeCamera.getWorldMatrix().getTranslation();return x.useRightHandedSystem||(O.x*=-1),O},type:"Oo",getTarget:()=>x.activeCamera}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:x=>{var O;return(null===(O=x._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)??!1},type:"boolean",getTarget:x=>x._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:x=>{var O;return((null===(O=x._babylonAnimationGroup)||void 0===O?void 0:O.from)??0)/60},type:"number",getTarget:x=>x._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:x=>{var O;return((null===(O=x._babylonAnimationGroup)||void 0===O?void 0:O.to)??0)/60},type:"number",getTarget:x=>x._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:x=>{var O;return((null===(O=x._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:x=>x._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:x=>{var O;return((null===(O=x._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:x=>x._babylonAnimationGroup})}(O)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var x;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,Q=null===(x=this._loader.oo.extensions)||void 0===x?void 0:x.KHR_interactivity;if(!Q)return;const X=new aQ.b({RO:O});X.dispatchEventsSynchronously=!1;const Z=Q.graphs.map((x=>new FQ(x,this._loader.oo,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(Z.map((async x=>await qQ(x,{coordinator:X,pathConverter:this._pathConverter})))),X.start()}}var WQ;WQ=async()=>(await Promise.resolve().then(Q.bind(Q,12747))).FlowGraphGLTFDataProvider,KQ[`${bQ}/${"FlowGraphGLTFDataProvider"}`]=WQ,D(bQ),b(bQ,!0,(x=>new DQ(x)));const yQ="KHR_node_visibility";(0,W.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:x=>{const O=x._babylonTransformNode;return!O||void 0===O.isVisible||O.isVisible},set:(x,O)=>{var Q,X;null===(Q=O._primitiveBabylonMeshes)||void 0===Q||Q.forEach((x=>{x.inheritVisibility=!0})),O._babylonTransformNode&&(O._babylonTransformNode.isVisible=x),null===(X=O._primitiveBabylonMeshes)||void 0===X||X.forEach((O=>{O.isVisible=x}))},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class IQ{constructor(x){this.name=yQ,this._loader=x,this.enabled=x.isExtensionUsed(yQ)}async onReady(){var x;null===(x=this._loader.oo.nodes)||void 0===x||x.forEach((x=>{var O,Q,X,Z;(null===(O=x._primitiveBabylonMeshes)||void 0===O||O.forEach((x=>{x.inheritVisibility=!0})),null!==(Q=x.extensions)&&void 0!==Q&&Q.KHR_node_visibility)&&(!1===(null===(X=x.extensions)||void 0===X?void 0:X.KHR_node_visibility.visible)&&(x._babylonTransformNode&&(x._babylonTransformNode.isVisible=!1),null===(Z=x._primitiveBabylonMeshes)||void 0===Z||Z.forEach((x=>{x.isVisible=!1}))))}))}dispose(){this._loader=null}}D(yQ),b(yQ,!0,(x=>new IQ(x)));const rQ="KHR_node_selectability";cQ("event/onSelect",rQ,{pC:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qQ:"FlowGraphGetVariableBlock",dataTransformer:x=>["pickedMesh_"+x[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",qQ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(x,O,Q,X,Z,n,V){var o,l,C,U,L,h;const N=Z[Z.length-1];N.config=N.config||{},N.config.glTF=V;const a=null===(o=x.configuration)||void 0===o||null===(l=o.nodeIndex)||void 0===l?void 0:l.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const K="pickedMesh_"+a;return Z[1].config.variable=K,n._userVariables[K]={className:"Mesh",id:null===V||void 0===V||null===(C=V.nodes)||void 0===C||null===(U=C[a]._babylonTransformNode)||void 0===U?void 0:U.id,uniqueId:null===V||void 0===V||null===(L=V.nodes)||void 0===L||null===(h=L[a]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},Z}}),(0,W.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:x=>{const O=x._babylonTransformNode;return!O||void 0===O.ql||O.ql},set:(x,O)=>{var Q;null===(Q=O._primitiveBabylonMeshes)||void 0===Q||Q.forEach((O=>{O.ql=x}))},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"ql"],type:"boolean"});class jQ{constructor(x){this.name=rQ,this._loader=x,this.enabled=x.isExtensionUsed(rQ)}async onReady(){var x;null===(x=this._loader.oo.nodes)||void 0===x||x.forEach((x=>{var O,Q,X;null!==(O=x.extensions)&&void 0!==O&&O.KHR_node_selectability&&!1===(null===(Q=x.extensions)||void 0===Q?void 0:Q.KHR_node_selectability.selectable)&&(null===(X=x._babylonTransformNode)||void 0===X||X.getChildMeshes().forEach((x=>{x.ql=!1})))}))}dispose(){this._loader=null}}D(rQ),b(rQ,!0,(x=>new jQ(x)));const TQ="KHR_node_hoverability",eQ="targetMeshPointerOver_";cQ("event/onHoverIn",TQ,{pC:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qQ:"FlowGraphGetVariableBlock",dataTransformer:x=>[eQ+x[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",qQ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(x,O,Q,X,Z,n,V){var o,l,C,U,L,h;const N=Z[Z.length-1];N.config=N.config||{},N.config.glTF=V;const a=null===(o=x.configuration)||void 0===o||null===(l=o.nodeIndex)||void 0===l?void 0:l.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const K=eQ+a;return Z[1].config.variable=K,n._userVariables[K]={className:"Mesh",id:null===V||void 0===V||null===(C=V.nodes)||void 0===C||null===(U=C[a]._babylonTransformNode)||void 0===U?void 0:U.id,uniqueId:null===V||void 0===V||null===(L=V.nodes)||void 0===L||null===(h=L[a]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},Z}});const BQ="targetMeshPointerOut_";cQ("event/onHoverOut",TQ,{pC:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qQ:"FlowGraphGetVariableBlock",dataTransformer:x=>[BQ+x[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",qQ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(x,O,Q,X,Z,n,V){var o,l,C,U,L,h;const N=Z[Z.length-1];N.config=N.config||{},N.config.glTF=V;const a=null===(o=x.configuration)||void 0===o||null===(l=o.nodeIndex)||void 0===l?void 0:l.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const K=BQ+a;return Z[1].config.variable=K,n._userVariables[K]={className:"Mesh",id:null===V||void 0===V||null===(C=V.nodes)||void 0===C||null===(U=C[a]._babylonTransformNode)||void 0===U?void 0:U.id,uniqueId:null===V||void 0===V||null===(L=V.nodes)||void 0===L||null===(h=L[a]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},Z}}),(0,W.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:x=>{const O=x._babylonTransformNode;return!O||void 0===O.pointerOverDisableMeshTesting||O.pointerOverDisableMeshTesting},set:(x,O)=>{var Q;null===(Q=O._primitiveBabylonMeshes)||void 0===Q||Q.forEach((O=>{O.pointerOverDisableMeshTesting=!x}))},getTarget:x=>x._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class iQ{constructor(x){this.name=TQ,this._loader=x,this.enabled=x.isExtensionUsed(TQ)}async onReady(){var x;null===(x=this._loader.oo.nodes)||void 0===x||x.forEach((x=>{var O,Q,X;null!==(O=x.extensions)&&void 0!==O&&O.KHR_node_hoverability&&!1===(null===(Q=x.extensions)||void 0===Q?void 0:Q.KHR_node_hoverability.hoverable)&&(null===(X=x._babylonTransformNode)||void 0===X||X.getChildMeshes().forEach((x=>{x.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}D(TQ),b(TQ,!0,(x=>new iQ(x)));const HQ="ExtrasAsMetadata";class SQ{_assignExtras(x,O){if(O.extras&&Object.keys(O.extras).length>0){const Q=x.metadata=x.metadata||{};(Q.oo=Q.oo||{}).extras=O.extras}}constructor(x){this.name=HQ,this.enabled=!0,this._loader=x}dispose(){this._loader=null}loadNodeAsync(x,O,Q){return this._loader.loadNodeAsync(x,O,(x=>{this._assignExtras(x,O),Q(x)}))}loadCameraAsync(x,O,Q){return this._loader.loadCameraAsync(x,O,(x=>{this._assignExtras(x,O),Q(x)}))}createMaterial(x,O,Q){const X=this._loader.createMaterial(x,O,Q);return this._assignExtras(X,O),X}}D(HQ),b(HQ,!1,(x=>new SQ(x)));Q(12747)},12629:(x,O,Q)=>{"use strict";Q.d(O,{b:()=>f,f:()=>J,h:()=>k,l:()=>t});var X=Q(10882),Z=Q(10894),n=Q(12252),V=Q(11201),o=Q(11158),l=Q(11172),C=Q(10905),U=Q(10877),L=Q(11196),h=Q(11558),N=Q(11206),a=Q(11127);class K{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fL=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Yh=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(x){this._environmentTexture=x}getNodes(){let x=[];x=x.concat(this.meshes),x=x.concat(this.lights),x=x.concat(this.cameras),x=x.concat(this.transformNodes);for(const O of this.skeletons)x=x.concat(O.bones);return x}}class M extends K{}class Y{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const x=this.rootNodes;for(const X of x)X.dispose();x.length=0;const O=this.skeletons;for(const X of O)X.dispose();O.length=0;const Q=this.animationGroups;for(const X of Q)X.dispose();Q.length=0}}class g extends K{constructor(x){super(),this._wasAddedToScene=!1,(x=x||U.c.LastCreatedScene)&&(this.RO=x,this.proceduralTextures=[],x.no.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=x.getEngine().onContextRestoredObservable.add((()=>{for(const x of this.geometries)x._rebuild();for(const x of this.meshes)x._rebuild();for(const x of this.fL)x.rebuild();for(const x of this.textures)x._rebuild()})))}_topologicalSort(x){const O=new Map;for(const V of x)O.set(V.uniqueId,V);const Q={dependsOn:new Map,dependedBy:new Map};for(const V of x){const x=V.uniqueId;Q.dependsOn.set(x,new Set),Q.dependedBy.set(x,new Set)}for(const V of x){const x=V.uniqueId,X=Q.dependsOn.get(x);if(V instanceof L.d){const Z=V.sourceMesh;O.has(Z.uniqueId)&&(X.add(Z.uniqueId),Q.dependedBy.get(Z.uniqueId).add(x))}const Z=Q.dependedBy.get(x);for(const n of V.getDescendants()){const X=n.uniqueId;if(O.has(X)){Z.add(X);Q.dependsOn.get(X).add(x)}}}const X=[],Z=[];for(const V of x){const x=V.uniqueId;0===Q.dependsOn.get(x).size&&(Z.push(V),O.delete(x))}const n=Z;for(;n.length>0;){const x=n.shift();X.push(x);const Z=Q.dependedBy.get(x.uniqueId);for(const X of Array.from(Z.values())){const Z=Q.dependsOn.get(X);Z.delete(x.uniqueId),0===Z.size&&O.get(X)&&(n.push(O.get(X)),O.delete(X))}}return O.size>0&&(C.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((x=>{C.e.Error(x.name)}))),X}_addNodeAndDescendantsToList(x,O,Q,X){if(Q&&(!X||X(Q))&&!O.has(Q.uniqueId)){x.push(Q),O.add(Q.uniqueId);for(const Z of Q.getDescendants(!0))this._addNodeAndDescendantsToList(x,O,Z,X)}}_isNodeInContainer(x){return x instanceof l.c&&-1!==this.meshes.indexOf(x)||(x instanceof o.c&&-1!==this.transformNodes.indexOf(x)||(x instanceof h.c&&-1!==this.lights.indexOf(x)||x instanceof N.e&&-1!==this.cameras.indexOf(x)))}_isValidHierarchy(){for(const x of this.meshes)if(x.parent&&!this._isNodeInContainer(x.parent))return C.e.Warn(`Node ${x.name} has a parent that is not in the container.`),!1;for(const x of this.transformNodes)if(x.parent&&!this._isNodeInContainer(x.parent))return C.e.Warn(`Node ${x.name} has a parent that is not in the container.`),!1;for(const x of this.lights)if(x.parent&&!this._isNodeInContainer(x.parent))return C.e.Warn(`Node ${x.name} has a parent that is not in the container.`),!1;for(const x of this.cameras)if(x.parent&&!this._isNodeInContainer(x.parent))return C.e.Warn(`Node ${x.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(x){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||Z.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const X={},n={},o=new Y,l=[],C=[],U={doNotInstantiate:!0,...Q},L=[],h=new Set;for(const Z of this.transformNodes)null===Z.parent&&this._addNodeAndDescendantsToList(L,h,Z,U.predicate);for(const Z of this.meshes)null===Z.parent&&this._addNodeAndDescendantsToList(L,h,Z,U.predicate);const N=this._topologicalSort(L),a=(Q,Z)=>{if(((O,Q)=>{if(X[O.uniqueId]=Q.uniqueId,n[Q.uniqueId]=Q,x&&(Q.name=x(O.name)),Q instanceof V.b){const x=Q;if(x.morphTargetManager){const Q=O.morphTargetManager;x.morphTargetManager=Q.clone();for(let O=0;O<Q.numTargets;O++){const Z=Q.getTarget(O),V=x.morphTargetManager.getTarget(O);X[Z.uniqueId]=V.uniqueId,n[V.uniqueId]=V}}}})(Q,Z),Q.parent){const x=X[Q.parent.uniqueId],O=n[x];Z.parent=O||Q.parent}if(Z.position&&Q.position&&Z.position.V(Q.position),Z.rotationQuaternion&&Q.rotationQuaternion&&Z.rotationQuaternion.V(Q.rotationQuaternion),Z.rotation&&Q.rotation&&Z.rotation.V(Q.rotation),Z.Qo&&Q.Qo&&Z.Qo.V(Q.Qo),Z.material){const V=Z;if(V.material)if(O){const O=Q.material;if(-1===C.indexOf(O)){let Q=O.clone(x?x(O.name):"Clone of "+O.name);if(C.push(O),X[O.uniqueId]=Q.uniqueId,n[Q.uniqueId]=Q,"MultiMaterial"===O.getClassName()){const Z=O;for(const O of Z.Uo)O&&(Q=O.clone(x?x(O.name):"Clone of "+O.name),C.push(O),X[O.uniqueId]=Q.uniqueId,n[Q.uniqueId]=Q);Z.Uo=Z.Uo.map((x=>x&&n[X[x.uniqueId]]))}}"InstancedMesh"!==V.getClassName()&&(V.material=n[X[O.uniqueId]])}else"MultiMaterial"===V.material.getClassName()?-1===this.RO.multiMaterials.indexOf(V.material)&&this.RO.addMultiMaterial(V.material):-1===this.RO.materials.indexOf(V.material)&&this.RO.addMaterial(V.material)}null===Z.parent&&o.rootNodes.push(Z)};for(const Z of N)if("InstancedMesh"===Z.getClassName()){const x=Z,O=x.sourceMesh,Q=X[O.uniqueId];a(x,("number"===typeof Q?n[Q]:O).createInstance(x.name))}else{let x=!0;"oh"===Z.getClassName()||"Node"===Z.getClassName()||Z.skeleton||!Z.getTotalVertices||0===Z.getTotalVertices()?x=!1:U.doNotInstantiate&&(x="function"===typeof U.doNotInstantiate?!U.doNotInstantiate(Z):!U.doNotInstantiate);const O=x?Z.createInstance(`instance of ${Z.name}`):Z.clone(`Clone of ${Z.name}`,null,!0);if(!O)throw new Error(`Could not clone or instantiate node on Asset Container ${Z.name}`);a(Z,O)}for(const Z of this.skeletons){if(U.predicate&&!U.predicate(Z))continue;const O=Z.clone(x?x(Z.name):"Clone of "+Z.name);for(const x of this.meshes)if(x.skeleton===Z&&!x.isAnInstance){const Q=n[X[x.uniqueId]];if(!Q||Q.isAnInstance)continue;if(Q.skeleton=O,-1!==l.indexOf(O))continue;l.push(O);for(const x of O.bones)x._linkedTransformNode&&(x._linkedTransformNode=n[X[x._linkedTransformNode.uniqueId]])}o.skeletons.push(O)}for(const Z of this.animationGroups){if(U.predicate&&!U.predicate(Z))continue;const O=Z.clone(x?x(Z.name):"Clone of "+Z.name,(x=>n[X[x.uniqueId]]||x));o.animationGroups.push(O)}return o}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Z.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.RO.environmentTexture=this.environmentTexture);for(const x of this.RO._serializableComponents)x.addFromContainer(this);this.RO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];for(const Q of this.cameras)x&&!x(Q)||(this.RO.addCamera(Q),O.push(Q));for(const Q of this.lights)x&&!x(Q)||(this.RO.addLight(Q),O.push(Q));for(const Q of this.meshes)x&&!x(Q)||(this.RO.bC(Q),O.push(Q));for(const Q of this.skeletons)x&&!x(Q)||this.RO.addSkeleton(Q);for(const Q of this.animations)x&&!x(Q)||this.RO.addAnimation(Q);for(const Q of this.animationGroups)x&&!x(Q)||this.RO.addAnimationGroup(Q);for(const Q of this.multiMaterials)x&&!x(Q)||this.RO.addMultiMaterial(Q);for(const Q of this.materials)x&&!x(Q)||this.RO.addMaterial(Q);for(const Q of this.morphTargetManagers)x&&!x(Q)||this.RO.addMorphTargetManager(Q);for(const Q of this.geometries)x&&!x(Q)||this.RO.addGeometry(Q);for(const Q of this.transformNodes)x&&!x(Q)||(this.RO.addTransformNode(Q),O.push(Q));for(const Q of this.actionManagers)x&&!x(Q)||this.RO.addActionManager(Q);for(const Q of this.textures)x&&!x(Q)||this.RO.addTexture(Q);for(const Q of this.reflectionProbes)x&&!x(Q)||this.RO.addReflectionProbe(Q);for(const Q of O)Q.parent&&-1===this.RO.getNodes().indexOf(Q.parent)&&(Q.setParent?Q.setParent(null):Q.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Z.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.RO.environmentTexture&&(this.RO.environmentTexture=null);for(const x of this.RO._serializableComponents)x.removeFromContainer(this)}removeFromScene(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const O of this.cameras)x&&!x(O)||this.RO.removeCamera(O);for(const O of this.lights)x&&!x(O)||this.RO.removeLight(O);for(const O of this.meshes)x&&!x(O)||this.RO.FC(O,!0);for(const O of this.skeletons)x&&!x(O)||this.RO.removeSkeleton(O);for(const O of this.animations)x&&!x(O)||this.RO.removeAnimation(O);for(const O of this.animationGroups)x&&!x(O)||this.RO.removeAnimationGroup(O);for(const O of this.multiMaterials)x&&!x(O)||this.RO.removeMultiMaterial(O);for(const O of this.materials)x&&!x(O)||this.RO.removeMaterial(O);for(const O of this.morphTargetManagers)x&&!x(O)||this.RO.removeMorphTargetManager(O);for(const O of this.geometries)x&&!x(O)||this.RO.removeGeometry(O);for(const O of this.transformNodes)x&&!x(O)||this.RO.removeTransformNode(O);for(const O of this.actionManagers)x&&!x(O)||this.RO.removeActionManager(O);for(const O of this.textures)x&&!x(O)||this.RO.removeTexture(O);for(const O of this.reflectionProbes)x&&!x(O)||this.RO.removeReflectionProbe(O)}dispose(){const x=this.cameras.slice(0);for(const N of x)N.dispose();this.cameras.length=0;const O=this.lights.slice(0);for(const N of O)N.dispose();this.lights.length=0;const Q=this.meshes.slice(0);for(const N of Q)N.dispose();this.meshes.length=0;const X=this.skeletons.slice(0);for(const N of X)N.dispose();this.skeletons.length=0;const Z=this.animationGroups.slice(0);for(const N of Z)N.dispose();this.animationGroups.length=0;const n=this.multiMaterials.slice(0);for(const N of n)N.dispose();this.multiMaterials.length=0;const V=this.materials.slice(0);for(const N of V)N.dispose();this.materials.length=0;const o=this.geometries.slice(0);for(const N of o)N.dispose();this.geometries.length=0;const l=this.transformNodes.slice(0);for(const N of l)N.dispose();this.transformNodes.length=0;const C=this.actionManagers.slice(0);for(const N of C)N.dispose();this.actionManagers.length=0;const U=this.textures.slice(0);for(const N of U)N.dispose();this.textures.length=0;const L=this.reflectionProbes.slice(0);for(const N of L)N.dispose();this.reflectionProbes.length=0;const h=this.morphTargetManagers.slice(0);for(const N of h)N.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.RO._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.RO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(x,O,Q){if(x&&O)for(const X of x){let x=!0;if(Q)for(const O of Q)if(X===O){x=!1;break}x&&(O.push(X),X._parentContainer=this)}}moveAllFromScene(x){this._wasAddedToScene=!1,void 0===x&&(x=new M);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.RO[O],this[O],x[O]));this.environmentTexture=this.RO.environmentTexture,this.removeAllFromScene()}createRootMesh(){const x=new V.b("assetContainerRootMesh",this.RO);for(const O of this.meshes)O.parent||x.addChild(O);return this.meshes.unshift(x),x}mergeAnimationsTo(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.c.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!x)return C.e.Error("No scene available to merge animations to"),[];const X=Q||(O=>{let Q=null;const X=O.animations.length?O.animations[0].targetProperty:"",Z=O.name.split(".").join("").split("_primitive")[0];switch(X){case"position":case"rotationQuaternion":Q=x.getTransformNodeByName(O.name)||x.getTransformNodeByName(Z);break;case"influence":Q=x.getMorphTargetByName(O.name)||x.getMorphTargetByName(Z);break;default:Q=x.getNodeByName(O.name)||x.getNodeByName(Z)}return Q}),Z=this.getNodes();for(const o of Z){const x=X(o);if(null!==x){for(const O of o.animations){const Q=x.animations.filter((x=>x.targetProperty===O.targetProperty));for(const O of Q){const Q=x.animations.indexOf(O,0);Q>-1&&x.animations.splice(Q,1)}}x.animations=x.animations.concat(o.animations)}}const n=[],V=this.animationGroups.slice();for(const o of V){n.push(o.clone(o.name,X));for(const x of o.animatables)x.stop()}for(const o of O){const O=X(o.target);O&&(x.beginAnimation(O,o.fromFrame,o.toFrame,o.loopAnimation,o.speedRatio,o.onAnimationEnd?o.onAnimationEnd:void 0,void 0,!0,void 0,o.onAnimationLoop?o.onAnimationLoop:void 0),x.stopAnimation(o.target))}return n}populateRootNodes(){this.rootNodes.length=0;for(const x of this.meshes)x.parent||-1!==this.rootNodes.indexOf(x)||this.rootNodes.push(x);for(const x of this.transformNodes)x.parent||-1!==this.rootNodes.indexOf(x)||this.rootNodes.push(x);for(const x of this.lights)x.parent||-1!==this.rootNodes.indexOf(x)||this.rootNodes.push(x);for(const x of this.cameras)x.parent||-1!==this.rootNodes.indexOf(x)||this.rootNodes.push(x)}addAllAssetsToContainer(x){if(!x)return;const O=[],Q=new Set;for(O.push(x);O.length>0;){const x=O.pop();if(x instanceof V.b?(x.SV&&-1===this.geometries.indexOf(x.SV)&&this.geometries.push(x.SV),this.meshes.push(x)):x instanceof L.d?this.meshes.push(x):x instanceof o.c?this.transformNodes.push(x):x instanceof h.c?this.lights.push(x):x instanceof N.e&&this.cameras.push(x),x instanceof l.c){if(x.material&&-1===this.materials.indexOf(x.material)){this.materials.push(x.material);for(const O of x.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}x.skeleton&&-1===this.skeletons.indexOf(x.skeleton)&&this.skeletons.push(x.skeleton),x.morphTargetManager&&-1===this.morphTargetManagers.indexOf(x.morphTargetManager)&&this.morphTargetManagers.push(x.morphTargetManager)}for(const X of x.getChildren())Q.has(X)||O.push(X);Q.add(x)}this.populateRootNodes()}_getByTags(x,O,Q){if(void 0===O)return x;const X=[];for(const Z in x){const n=x[Z];a.e&&a.e.MatchesQuery(n,O)&&(!Q||Q(n))&&X.push(n)}return X}getMeshesByTags(x,O){return this._getByTags(this.meshes,x,O)}getCamerasByTags(x,O){return this._getByTags(this.cameras,x,O)}getLightsByTags(x,O){return this._getByTags(this.lights,x,O)}getMaterialsByTags(x,O){return this._getByTags(this.materials,x,O).concat(this._getByTags(this.multiMaterials,x,O))}getTransformNodesByTags(x,O){return this._getByTags(this.transformNodes,x,O)}}var v=Q(10943);class R{constructor(x){this.byteOffset=0,this.buffer=x}async loadAsync(x){const O=await this.buffer.readAsync(this.byteOffset,x);this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}readUint32(){const x=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,x}readUint8Array(x){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,x);return this._dataByteOffset+=x,this.byteOffset+=x,O}readString(x){return(0,v.i)(this.readUint8Array(x))}skipBytes(x){this._dataByteOffset+=x,this.byteOffset+=x}}var s=Q(12635);const q="Z2xURg",G={name:"oo",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:x=>-1!==x.indexOf("asset")&&-1!==x.indexOf("version")||x.startsWith("data:base64,"+q)||x.startsWith("data:;base64,"+q)||x.startsWith("data:application/octet-stream;base64,"+q)||x.startsWith("data:model/gltf-binary;base64,"+q)};var k,J,t,c=Q(10934),d=Q(10936);function u(x,O,Q){try{return Promise.resolve(new Uint8Array(x,O,Q))}catch(X){return Promise.reject(X)}}!function(x){x[x.AUTO=0]="AUTO",x[x.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(k||(k={})),function(x){x[x.NONE=0]="NONE",x[x.FIRST=1]="FIRST",x[x.ALL=2]="ALL"}(J||(J={})),function(x){x[x.LOADING=0]="LOADING",x[x.READY=1]="READY",x[x.COMPLETE=2]="COMPLETE"}(t||(t={}));class A{constructor(){this.coordinateSystemMode=k.AUTO,this.animationStartMode=J.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=x=>Promise.resolve(x),this.extensionOptions={}}V(x){x&&(this.onParsed=x.onParsed,this.coordinateSystemMode=x.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=x.animationStartMode??this.animationStartMode,this.loadNodeAnimations=x.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=x.loadSkins??this.loadSkins,this.loadMorphTargets=x.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=x.compileMaterials??this.compileMaterials,this.useClipPlane=x.useClipPlane??this.useClipPlane,this.compileShadowGenerators=x.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=x.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=x.useRangeRequests??this.useRangeRequests,this.createInstances=x.createInstances??this.createInstances,this.alwaysComputeBoundingBox=x.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=x.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=x.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=x.skipMaterials??this.skipMaterials,this.useSRGBBuffers=x.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=x.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=x.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=x.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=x.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=x.customRootNode,this.onMeshLoaded=x.onMeshLoaded,this.onSkinLoaded=x.onSkinLoaded,this.onTextureLoaded=x.onTextureLoaded,this.onMaterialLoaded=x.onMaterialLoaded,this.onCameraLoaded=x.onCameraLoaded,this.extensionOptions=x.extensionOptions??this.extensionOptions)}}class f extends A{constructor(x){super(),this.onParsedObservable=new X.b,this.onMeshLoadedObservable=new X.b,this.onSkinLoadedObservable=new X.b,this.onTextureLoadedObservable=new X.b,this.onMaterialLoadedObservable=new X.b,this.onCameraLoadedObservable=new X.b,this.onCompleteObservable=new X.b,this.onErrorObservable=new X.b,this.no=new X.b,this.onExtensionLoadedObservable=new X.b,this.validate=!1,this.onValidatedObservable=new X.b,this._loader=null,this._state=null,this._requests=new Array,this.name=G.name,this.extensions=G.extensions,this.onLoaderStateChangedObservable=new X.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.V(x)}set onParsed(x){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),x&&(this._onParsedObserver=this.onParsedObservable.add(x))}set onMeshLoaded(x){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),x&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(x))}set onSkinLoaded(x){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),x&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>x(O.node,O.skinnedNode))))}set onTextureLoaded(x){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),x&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(x))}set onMaterialLoaded(x){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),x&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(x))}set onCameraLoaded(x){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),x&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(x))}set onComplete(x){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(x)}set onError(x){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(x)}set onDispose(x){this._onDisposeObserver&&this.no.remove(this._onDisposeObserver),this._onDisposeObserver=this.no.add(x)}set onExtensionLoaded(x){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(x)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(x){this._loggingEnabled!==x&&(this._loggingEnabled=x,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(x){this._capturePerformanceCounters!==x&&(this._capturePerformanceCounters=x,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(x){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(x)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const x of this._requests)x.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=x=>Promise.resolve(x),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.no.notifyObservers(void 0),this.no.clear()}loadFile(x,O,Q,n,V,o,l,U){if(ArrayBuffer.isView(O))return this._loadBinary(x,O,Q,n,l,U),null;this._progressCallback=V;const L=O.name||Z.g.GetFilename(O);if(o){if(this.useRangeRequests){this.validate&&C.e.Warn("glTF validation is not supported when range requests are enabled");const Q={abort:()=>{},onCompleteObservable:new X.b},Z={readAsync:(Q,X)=>new Promise(((Z,n)=>{this._loadFile(x,O,(x=>{Z(new Uint8Array(x))}),!0,(x=>{n(x)}),(x=>{x.setRequestHeader("Range",`bytes=${Q}-${Q+X-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new R(Z)).then((x=>{Q.onCompleteObservable.notifyObservers(Q),n(x)}),l?x=>l(void 0,x):void 0),Q}return this._loadFile(x,O,(O=>{this._validate(x,new Uint8Array(O,0,O.byteLength),Q,L),this._unpackBinaryAsync(new R({readAsync:(x,Q)=>u(O,x,Q),byteLength:O.byteLength})).then((x=>{n(x)}),l?x=>l(void 0,x):void 0)}),!0,l)}return this._loadFile(x,O,(O=>{try{this._validate(x,O,Q,L),n({json:this._parseJson(O)})}catch{l&&l()}}),!1,l)}_loadBinary(x,O,Q,X,Z,n){this._validate(x,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),Q,n),this._unpackBinaryAsync(new R({readAsync:(x,Q)=>function(x,O,Q){try{if(O<0||O>=x.byteLength)throw new RangeError("Offset is out of range.");if(O+Q>x.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(x.buffer,x.byteOffset+O,Q))}catch(X){return Promise.reject(X)}}(O,x,Q),byteLength:O.byteLength})).then((x=>{X(x)}),Z?x=>Z(void 0,x):void 0)}importMeshAsync(x,O,Q,X,Z,n){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(Q),this._loader.importMeshAsync(x,O,null,Q,X,Z,n))))}loadAsync(x,O,Q,X,Z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(x,O,Q,X,Z))))}loadAssetContainerAsync(x,O,Q,X,Z){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(O);const n=new g(x),V=[];this.onMaterialLoadedObservable.add((x=>{V.push(x)}));const o=[];this.onTextureLoadedObservable.add((x=>{o.push(x)}));const l=[];this.onCameraLoadedObservable.add((x=>{l.push(x)}));const C=[];return this.onMeshLoadedObservable.add((x=>{x.morphTargetManager&&C.push(x.morphTargetManager)})),this._loader.importMeshAsync(null,x,n,O,Q,X,Z).then((x=>(Array.prototype.push.apply(n.geometries,x.geometries),Array.prototype.push.apply(n.meshes,x.meshes),Array.prototype.push.apply(n.fL,x.fL),Array.prototype.push.apply(n.skeletons,x.skeletons),Array.prototype.push.apply(n.animationGroups,x.animationGroups),Array.prototype.push.apply(n.materials,V),Array.prototype.push.apply(n.textures,o),Array.prototype.push.apply(n.lights,x.lights),Array.prototype.push.apply(n.transformNodes,x.transformNodes),Array.prototype.push.apply(n.cameras,l),Array.prototype.push.apply(n.morphTargetManagers,C),n)))}))}canDirectLoad(x){return G.canDirectLoad(x)}directLoad(x,O){if(O.startsWith("base64,"+q)||O.startsWith(";base64,"+q)||O.startsWith("application/octet-stream;base64,"+q)||O.startsWith("model/gltf-binary;base64,"+q)){const Q=(0,c.c)(O);return this._validate(x,new Uint8Array(Q,0,Q.byteLength)),this._unpackBinaryAsync(new R({readAsync:(x,O)=>u(Q,x,O),byteLength:Q.byteLength}))}return this._validate(x,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(x){return new f(x[G.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((x,O)=>{this.onCompleteObservable.addOnce((()=>{x()})),this.onErrorObservable.addOnce((x=>{O(x)}))}))}_setState(x){this._state!==x&&(this._state=x,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(t[this._state]))}_loadFile(x,O,Q,X,Z,n){const V=x._loadFile(O,Q,(x=>{this._onProgress(x,V)}),!0,X,Z,n);return V.onCompleteObservable.add((()=>{V._lengthComputable=!0,V._total=V._loaded})),this._requests.push(V),V}_onProgress(x,O){if(!this._progressCallback)return;O._lengthComputable=x.lengthComputable,O._loaded=x.loaded,O._total=x.total;let Q=!0,X=0,Z=0;for(const n of this._requests){if(void 0===n._lengthComputable||void 0===n._loaded||void 0===n._total)return;Q=Q&&n._lengthComputable,X+=n._loaded,Z+=n._total}this._progressCallback({lengthComputable:Q,loaded:X,total:Q?Z:0})}_validate(x,O){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.c.ValidateAsync(O,Q,X,(O=>this.preprocessUrlAsync(Q+O).then((O=>x._loadFileAsync(O,void 0,!0,!0).then((x=>new Uint8Array(x,0,x.byteLength))))))).then((x=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(x),this.onValidatedObservable.clear()}),(x=>{this._endPerformanceCounter("Validate JSON"),Z.g.Warn(`Failed to validate: ${x.message}`),this.onValidatedObservable.clear()})))}_getLoader(x){const O=x.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const Q=f._parseVersion(O.version);if(!Q)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const x=f._parseVersion(O.minVersion);if(!x)throw new Error("Invalid minimum version: "+O.minVersion);if(f._compareVersion(x,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const X={1:f._CreateGLTF1Loader,2:f._CreateGLTF2Loader}[Q.major];if(!X)throw new Error("Unsupported version: "+O.version);return X(this)}_parseJson(x){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${x.length}`);const O=JSON.parse(x);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(x){return this._startPerformanceCounter("Unpack Binary"),x.loadAsync(20).then((()=>{const O=x.readUint32();if(1179937895!==O)throw new d.i("Unexpected magic: "+O,d.g.GLTFLoaderUnexpectedMagicError);const Q=x.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Q}`);const X=x.readUint32();let Z;switch(this.useRangeRequests||X===x.buffer.byteLength||C.e.Warn(`Length in header does not match actual data length: ${X} != ${x.buffer.byteLength}`),Q){case 1:Z=this._unpackBinaryV1Async(x,X);break;case 2:Z=this._unpackBinaryV2Async(x,X);break;default:throw new Error("Unsupported version: "+Q)}return this._endPerformanceCounter("Unpack Binary"),Z}))}_unpackBinaryV1Async(x,O){const Q=x.readUint32(),X=x.readUint32();if(0!==X)throw new Error(`Unexpected content format: ${X}`);const Z=O-x.byteOffset,n={json:this._parseJson(x.readString(Q)),bin:null};if(0!==Z){const O=x.byteOffset;n.bin={readAsync:(Q,X)=>x.buffer.readAsync(O+Q,X),byteLength:Z}}return Promise.resolve(n)}_unpackBinaryV2Async(x,O){const Q=1313821514,X=5130562,Z=x.readUint32();if(x.readUint32()!==Q)throw new Error("First chunk format is not JSON");return x.byteOffset+Z===O?x.loadAsync(Z).then((()=>({json:this._parseJson(x.readString(Z)),bin:null}))):x.loadAsync(Z+8).then((()=>{const n={json:this._parseJson(x.readString(Z)),bin:null},V=()=>{const Z=x.readUint32();switch(x.readUint32()){case Q:throw new Error("Unexpected JSON chunk");case X:{const O=x.byteOffset;n.bin={readAsync:(Q,X)=>x.buffer.readAsync(O+Q,X),byteLength:Z},x.skipBytes(Z);break}default:x.skipBytes(Z)}return x.byteOffset!==O?x.loadAsync(8).then(V):Promise.resolve(n)};return V()}))}static _parseVersion(x){if("1.0"===x||"1.0.1"===x)return{major:1,minor:0};const O=(x+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(x,O){return x.major>O.major?1:x.major<O.major?-1:x.minor>O.minor?1:x.minor<O.minor?-1:0}_logOpen(x){this._log(x),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(x){const O=f._logSpaces.substring(0,2*this._logIndentLevel);C.e.Log(`${O}${x}`)}_logDisabled(x){}_startPerformanceCounterEnabled(x){Z.g.StartPerformanceCounter(x)}_startPerformanceCounterDisabled(x){}_endPerformanceCounterEnabled(x){Z.g.EndPerformanceCounter(x)}_endPerformanceCounterDisabled(x){}}f.IncrementalLoading=!0,f.HomogeneousCoordinates=!1,f._logSpaces="                                ",(0,n.e)(new f)},12635:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>V});var X=Q(10894);function Z(x,O,Q,X){const Z={externalResourceFunction:X};return Q&&(Z.uri="file:"===O?Q:O+Q),ArrayBuffer.isView(x)?GLTFValidator.validateBytes(x,Z):GLTFValidator.validateString(x,Z)}function n(){const x=[];onmessage=O=>{const Q=O.data;switch(Q.id){case"init":importScripts(Q.url);break;case"validate":Z(Q.data,Q.rootUrl,Q.fileName,(O=>new Promise(((Q,X)=>{const Z=x.length;x.push({resolve:Q,reject:X}),postMessage({id:"getExternalResource",index:Z,uri:O})})))).then((x=>{postMessage({id:"validate.resolve",value:x})}),(x=>{postMessage({id:"validate.reject",reason:x})}));break;case"getExternalResource.resolve":x[Q.index].resolve(Q.value);break;case"getExternalResource.reject":x[Q.index].reject(Q.reason)}}}class V{static ValidateAsync(x,O,Q,V){return"function"===typeof Worker?new Promise(((o,l)=>{const C=`${Z}(${n})()`,U=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),L=new Worker(U),h=x=>{L.removeEventListener("error",h),L.removeEventListener("message",N),l(x)},N=x=>{const O=x.data;switch(O.id){case"getExternalResource":V(O.uri).then((x=>{L.postMessage({id:"getExternalResource.resolve",index:O.index,value:x},[x.buffer])}),(x=>{L.postMessage({id:"getExternalResource.reject",index:O.index,reason:x})}));break;case"validate.resolve":L.removeEventListener("error",h),L.removeEventListener("message",N),o(O.value),L.terminate();break;case"validate.reject":L.removeEventListener("error",h),L.removeEventListener("message",N),l(O.reason),L.terminate()}};if(L.addEventListener("error",h),L.addEventListener("message",N),L.postMessage({id:"init",url:X.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(x)){const X=x.slice();L.postMessage({id:"validate",data:X,rootUrl:O,fileName:Q},[X.buffer])}else L.postMessage({id:"validate",data:x,rootUrl:O,fileName:Q})})):(this._LoadScriptPromise||(this._LoadScriptPromise=X.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Z(x,O,Q,V))))}}V.Configuration={url:`${X.g._DefaultCdnUrl}/gltf_validator.js`}},13199:(x,O,Q)=>{"use strict";Q.d(O,{e:()=>G});var X=Q(11039),Z=Q(11042),n=Q(11122),V=Q(10849),o=Q(11466),l=Q(11485),C=Q(11060),U=Q(11423),L=Q(10866),h=Q(10983);Q(12377),Q(12284),Q(12298),Q(12286),Q(12304),Q(12312),Q(12320);const N="imageProcessingCompatibility",a="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";h.e.IncludesShadersStore[N]||(h.e.IncludesShadersStore[N]=a);const K="skyPixelShader",M="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";h.e.ShadersStore[K]||(h.e.ShadersStore[K]=M);Q(12388),Q(12322),Q(12331),Q(12345),Q(12340);const Y="skyVertexShader",g="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.e.ShadersStore[Y]||(h.e.ShadersStore[Y]=g);var v=Q(11512),R=Q(11151),s=Q(11141);class q extends o.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class G extends l.c{constructor(x,O){super(x,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new V.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=V.n.Zero(),this.up=V.n.Up(),this.dithering=!1,this._cameraPosition=V.n.Zero(),this._skyOrientation=new V.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(x,O){const Q=O._drawWrapper;if(this.isFrozen&&Q.effect&&Q._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new q);const X=O.materialDefines,Z=this.kx();if(this._isReadyForSubMesh(O))return!0;if((0,s.Z)(x,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,X),(0,s.O)(x,X,!0,!1),X.IMAGEPROCESSINGPOSTPROCESS!==Z.imageProcessingConfiguration.applyByPostProcess&&X.markAsMiscDirty(),X.DITHER!==this.dithering&&X.markAsMiscDirty(),X.isDirty){X.markAsProcessed(),Z.resetCachedMaterial();const x=new v.c;X.FOG&&x.addFallback(1,"FOG"),X.IMAGEPROCESSINGPOSTPROCESS=Z.imageProcessingConfiguration.applyByPostProcess,X.DITHER=this.dithering;const Q=[C.g.PositionKind];X.VERTEXCOLOR&&Q.push(C.g.ColorKind);const n="sky",V=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,R.d)(V);const o=X.toString();O.setEffect(Z.getEngine().createEffect(n,Q,V,[],o,x,this.onCompiled,this.onError),X,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(X._renderId=Z.getRenderId(),Q._wasPreviouslyReady=!0,!0)}bindForSubMesh(x,O,Q){const X=this.kx(),Z=Q.materialDefines;if(!Z)return;const n=Q.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(x),this._activeEffect.setMatrix("viewProjection",X.getTransformMatrix()),this._mustRebind(X,n,Q)&&((0,R.f)(n,this,X),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,s.o)(Z,n,X)),X.fogEnabled&&O.applyFog&&X.fogMode!==U.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",X.getViewMatrix()),(0,s.i)(X,O,this._activeEffect);const o=X.activeCamera;if(o){const x=o.getWorldMatrix();this._cameraPosition.x=x.m[12],this._cameraPosition.y=x.m[13],this._cameraPosition.z=x.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const x=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(x),this.sunPosition.y=this.distance*Math.sin(-x),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(x),V.g.FromUnitVectorsToRef(V.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,Q)}getAnimatables(){return[]}dispose(x){super.dispose(x)}clone(x){return n.c.Clone((()=>new G(x,this.kx())),this)}serialize(){const x=super.serialize();return x.customType="BABYLON.SkyMaterial",x}getClassName(){return"SkyMaterial"}static Parse(x,O,Q){return n.c.Parse((()=>new G(x.name,O)),x,O,Q)}}(0,X.b)([(0,Z.L)()],G.prototype,"luminance",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"turbidity",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"rayleigh",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"mieCoefficient",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"mieDirectionalG",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"distance",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"inclination",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"azimuth",void 0),(0,X.b)([(0,Z.K)()],G.prototype,"sunPosition",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"useSunPosition",void 0),(0,X.b)([(0,Z.K)()],G.prototype,"cameraOffset",void 0),(0,X.b)([(0,Z.K)()],G.prototype,"up",void 0),(0,X.b)([(0,Z.L)()],G.prototype,"dithering",void 0),(0,L.d)("BABYLON.SkyMaterial",G)},11649:(x,O,Q)=>{"use strict";function X(x,O){O.headers=x.headers||{},O.statusMessage=x.statusText,O.statusCode=x.status,O.data=x.response}function Z(x,O,Q){return new Promise((function(Z,n){Q=Q||{};var V,o,l,C=new XMLHttpRequest,U=Q.body,L=Q.headers||{};for(V in Q.timeout&&(C.timeout=Q.timeout),C.ontimeout=C.onerror=function(x){x.timeout="timeout"==x.type,n(x)},C.open(x,O.href||O),C.onload=function(){for(l=C.getAllResponseHeaders().trim().split(/[\r\n]+/),X(C,C);o=l.shift();)o=o.split(": "),C.headers[o.shift().toLowerCase()]=o.join(": ");if((o=C.headers["content-type"])&&~o.indexOf("application/json"))try{C.data=JSON.parse(C.data,Q.reviver)}catch(x){return X(C,x),n(x)}(C.status>=400?n:Z)(C)},typeof FormData<"u"&&U instanceof FormData||U&&"object"==typeof U&&(L["content-type"]="application/json",U=JSON.stringify(U)),C.withCredentials=!!Q.withCredentials,L)C.setRequestHeader(V,L[V]);C.send(U)}))}Q.r(O),Q.d(O,{del:()=>l,get:()=>n,patch:()=>o,post:()=>V,put:()=>C,send:()=>Z});var n=Z.bind(Z,"GET"),V=Z.bind(Z,"POST"),o=Z.bind(Z,"PATCH"),l=Z.bind(Z,"DELETE"),C=Z.bind(Z,"PUT")},13312:(x,O,Q)=>{"use strict";Q.d(O,{c:()=>L});const X=.5*(Math.sqrt(3)-1),Z=(3-Math.sqrt(3))/6,n=1/3,V=1/6,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),U=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const L=class{constructor(){let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof x?x:function(x){let O=0,Q=0,X=0,Z=1;const n=function(){let x=4022871197;return function(O){O=O.toString();for(let Q=0;Q<O.length;Q++){x+=O.charCodeAt(Q);let X=.02519603282416938*x;x=X>>>0,X-=x,X*=x,x=X>>>0,X-=x,x+=4294967296*X}return 2.3283064365386963e-10*(x>>>0)}}();O=n(" "),Q=n(" "),X=n(" "),O-=n(x),O<0&&(O+=1);Q-=n(x),Q<0&&(Q+=1);X-=n(x),X<0&&(X+=1);return function(){const x=2091639*O+2.3283064365386963e-10*Z;return O=Q,Q=X,X=x-(Z=0|x)}}(x);this.p=function(x){const O=new Uint8Array(256);for(let Q=0;Q<256;Q++)O[Q]=Q;for(let Q=0;Q<255;Q++){const X=Q+~~(x()*(256-Q)),Z=O[Q];O[Q]=O[X],O[X]=Z}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Q=0;Q<512;Q++)this.perm[Q]=this.p[255&Q],this.permMod12[Q]=this.perm[Q]%12}noise2D(x,O){const Q=this.permMod12,n=this.perm;let V=0,o=0,l=0;const U=(x+O)*X,L=Math.floor(x+U),h=Math.floor(O+U),N=(L+h)*Z,a=x-(L-N),K=O-(h-N);let M,Y;a>K?(M=1,Y=0):(M=0,Y=1);const g=a-M+Z,v=K-Y+Z,R=a-1+2*Z,s=K-1+2*Z,q=255&L,G=255&h;let k=.5-a*a-K*K;if(k>=0){const x=3*Q[q+n[G]];k*=k,V=k*k*(C[x]*a+C[x+1]*K)}let J=.5-g*g-v*v;if(J>=0){const x=3*Q[q+M+n[G+Y]];J*=J,o=J*J*(C[x]*g+C[x+1]*v)}let t=.5-R*R-s*s;if(t>=0){const x=3*Q[q+1+n[G+1]];t*=t,l=t*t*(C[x]*R+C[x+1]*s)}return 70*(V+o+l)}noise3D(x,O,Q){const X=this.permMod12,Z=this.perm;let o,l,U,L;const h=(x+O+Q)*n,N=Math.floor(x+h),a=Math.floor(O+h),K=Math.floor(Q+h),M=(N+a+K)*V,Y=x-(N-M),g=O-(a-M),v=Q-(K-M);let R,s,q,G,k,J;Y>=g?g>=v?(R=1,s=0,q=0,G=1,k=1,J=0):Y>=v?(R=1,s=0,q=0,G=1,k=0,J=1):(R=0,s=0,q=1,G=1,k=0,J=1):g<v?(R=0,s=0,q=1,G=0,k=1,J=1):Y<v?(R=0,s=1,q=0,G=0,k=1,J=1):(R=0,s=1,q=0,G=1,k=1,J=0);const t=Y-R+V,c=g-s+V,d=v-q+V,u=Y-G+2*V,A=g-k+2*V,f=v-J+2*V,E=Y-1+.5,z=g-1+.5,F=v-1+.5,b=255&N,D=255&a,W=255&K;let y=.6-Y*Y-g*g-v*v;if(y<0)o=0;else{const x=3*X[b+Z[D+Z[W]]];y*=y,o=y*y*(C[x]*Y+C[x+1]*g+C[x+2]*v)}let I=.6-t*t-c*c-d*d;if(I<0)l=0;else{const x=3*X[b+R+Z[D+s+Z[W+q]]];I*=I,l=I*I*(C[x]*t+C[x+1]*c+C[x+2]*d)}let r=.6-u*u-A*A-f*f;if(r<0)U=0;else{const x=3*X[b+G+Z[D+k+Z[W+J]]];r*=r,U=r*r*(C[x]*u+C[x+1]*A+C[x+2]*f)}let j=.6-E*E-z*z-F*F;if(j<0)L=0;else{const x=3*X[b+1+Z[D+1+Z[W+1]]];j*=j,L=j*j*(C[x]*E+C[x+1]*z+C[x+2]*F)}return 32*(o+l+U+L)}noise4D(x,O,Q,X){const Z=this.perm;let n,V,C,L,h;const N=(x+O+Q+X)*o,a=Math.floor(x+N),K=Math.floor(O+N),M=Math.floor(Q+N),Y=Math.floor(X+N),g=(a+K+M+Y)*l,v=x-(a-g),R=O-(K-g),s=Q-(M-g),q=X-(Y-g);let G=0,k=0,J=0,t=0;v>R?G++:k++,v>s?G++:J++,v>q?G++:t++,R>s?k++:J++,R>q?k++:t++,s>q?J++:t++;const c=G>=3?1:0,d=k>=3?1:0,u=J>=3?1:0,A=t>=3?1:0,f=G>=2?1:0,E=k>=2?1:0,z=J>=2?1:0,F=t>=2?1:0,b=G>=1?1:0,D=k>=1?1:0,W=J>=1?1:0,y=t>=1?1:0,I=v-c+l,r=R-d+l,j=s-u+l,T=q-A+l,e=v-f+2*l,B=R-E+2*l,i=s-z+2*l,H=q-F+2*l,S=v-b+3*l,p=R-D+3*l,P=s-W+3*l,m=q-y+3*l,w=v-1+4*l,xx=R-1+4*l,Ox=s-1+4*l,Qx=q-1+4*l,Xx=255&a,Zx=255&K,nx=255&M,Vx=255&Y;let ox=.6-v*v-R*R-s*s-q*q;if(ox<0)n=0;else{const x=Z[Xx+Z[Zx+Z[nx+Z[Vx]]]]%32*4;ox*=ox,n=ox*ox*(U[x]*v+U[x+1]*R+U[x+2]*s+U[x+3]*q)}let lx=.6-I*I-r*r-j*j-T*T;if(lx<0)V=0;else{const x=Z[Xx+c+Z[Zx+d+Z[nx+u+Z[Vx+A]]]]%32*4;lx*=lx,V=lx*lx*(U[x]*I+U[x+1]*r+U[x+2]*j+U[x+3]*T)}let Cx=.6-e*e-B*B-i*i-H*H;if(Cx<0)C=0;else{const x=Z[Xx+f+Z[Zx+E+Z[nx+z+Z[Vx+F]]]]%32*4;Cx*=Cx,C=Cx*Cx*(U[x]*e+U[x+1]*B+U[x+2]*i+U[x+3]*H)}let Ux=.6-S*S-p*p-P*P-m*m;if(Ux<0)L=0;else{const x=Z[Xx+b+Z[Zx+D+Z[nx+W+Z[Vx+y]]]]%32*4;Ux*=Ux,L=Ux*Ux*(U[x]*S+U[x+1]*p+U[x+2]*P+U[x+3]*m)}let Lx=.6-w*w-xx*xx-Ox*Ox-Qx*Qx;if(Lx<0)h=0;else{const x=Z[Xx+1+Z[Zx+1+Z[nx+1+Z[Vx+1]]]]%32*4;Lx*=Lx,h=Lx*Lx*(U[x]*w+U[x+1]*xx+U[x+2]*Ox+U[x+3]*Qx)}return 27*(n+V+C+L+h)}}}}]);