/*! For license information please see nfmzpf.11.a6520da6.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{12959:(q,f,j)=>{"use strict";var d=j(12966),g=j(12973),h=j(12976);j.g.__TYPEDARRAY_POOL||(j.g.__TYPEDARRAY_POOL={UINT8:g([32,0]),UINT16:g([32,0]),UINT32:g([32,0]),INT8:g([32,0]),INT16:g([32,0]),INT32:g([32,0]),FLOAT:g([32,0]),DOUBLE:g([32,0]),DATA:g([32,0]),UINT8C:g([32,0]),BUFFER:g([32,0])});var L="undefined"!==typeof Uint8ClampedArray,Q=j.g.__TYPEDARRAY_POOL;Q.UINT8C||(Q.UINT8C=g([32,0])),Q.BUFFER||(Q.BUFFER=g([32,0]));var H=Q.DATA,r=Q.BUFFER;function u(q){if(q){var f=q.length||q.byteLength,j=d.log2(f);H[j].push(q)}}function X(q){q=d.nextPow2(q);var f=d.log2(q),j=H[f];return j.length>0?j.pop():new ArrayBuffer(q)}function z(q){return new Uint8Array(X(q),0,q)}function B(q){return new Uint16Array(X(2*q),0,q)}function D(q){return new Uint32Array(X(4*q),0,q)}function i(q){return new Int8Array(X(q),0,q)}function t(q){return new Int16Array(X(2*q),0,q)}function O(q){return new Int32Array(X(4*q),0,q)}function N(q){return new Float32Array(X(4*q),0,q)}function w(q){return new Float64Array(X(8*q),0,q)}function E(q){return L?new Uint8ClampedArray(X(q),0,q):z(q)}function s(q){return new DataView(X(q),0,q)}f.free=function(q){if(h(q))r[d.log2(q.length)].push(q);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(q)&&(q=q.buffer),!q)return;var f=q.length||q.byteLength,j=0|d.log2(f);H[j].push(q)}},f.freeUint8=f.freeUint16=f.freeUint32=f.freeInt8=f.freeInt16=f.freeInt32=f.freeFloat32=f.freeFloat=f.freeFloat64=f.freeDouble=f.freeUint8Clamped=f.freeDataView=function(q){u(q.buffer)},f.freeArrayBuffer=u,f.freeBuffer=function(q){r[d.log2(q.length)].push(q)},f.malloc=function(q,f){if(void 0===f||"arraybuffer"===f)return X(q);switch(f){case"uint8":return z(q);case"uint16":return B(q);case"uint32":return D(q);case"int8":return i(q);case"int16":return t(q);case"int32":return O(q);case"float":case"float32":return N(q);case"double":case"float64":return w(q);case"uint8_clamped":return E(q);case"buffer":throw"Buffer not supported";case"data":case"dataview":return s(q);default:return null}return null},f.mallocArrayBuffer=X,f.mallocUint8=z,f.mallocUint16=B,f.mallocUint32=D,f.mallocInt8=i,f.mallocInt16=t,f.mallocInt32=O,f.mallocFloat32=f.mallocFloat=N,f.mallocFloat64=f.mallocDouble=w,f.mallocUint8Clamped=E,f.mallocDataView=s,f.clearCache=function(){for(var q=0;q<32;++q)Q.UINT8[q].length=0,Q.UINT16[q].length=0,Q.UINT32[q].length=0,Q.INT8[q].length=0,Q.INT16[q].length=0,Q.INT32[q].length=0,Q.FLOAT[q].length=0,Q.DOUBLE[q].length=0,Q.UINT8C[q].length=0,H[q].length=0,r[q].length=0}},13049:(q,f,j)=>{q.exports=g;var d=j(11875);function g(q,f){if(!(this instanceof g))return new g(q,f);var j=d.create();d.add(j,q,f),this.base=d.min(d.create(),q,j),this.Eu=d.clone(f),this.max=d.max(d.create(),q,j),this.mag=d.length(this.Eu)}var h=g.prototype;h.width=function(){return this.Eu[0]},h.height=function(){return this.Eu[1]},h.depth=function(){return this.Eu[2]},h.x0=function(){return this.base[0]},h.y0=function(){return this.base[1]},h.z0=function(){return this.base[2]},h.x1=function(){return this.max[0]},h.y1=function(){return this.max[1]},h.z1=function(){return this.max[2]},h.translate=function(q){return d.add(this.max,this.max,q),d.add(this.base,this.base,q),this},h.setPosition=function(q){return d.add(this.max,q,this.Eu),d.i(this.base,q),this},h.expand=function(q){var f=d.create(),j=d.create();return d.max(f,q.max,this.max),d.min(j,q.base,this.base),d.ej(f,f,j),new g(j,f)},h.intersects=function(q){return!(q.base[0]>this.max[0])&&(!(q.base[1]>this.max[1])&&(!(q.base[2]>this.max[2])&&(!(q.max[0]<this.base[0])&&(!(q.max[1]<this.base[1])&&!(q.max[2]<this.base[2])))))},h.touches=function(q){var f=this.union(q);return null!==f&&(0==f.width()||0==f.height()||0==f.depth())},h.union=function(q){if(!this.intersects(q))return null;var f=Math.max(q.base[0],this.base[0]),j=Math.max(q.base[1],this.base[1]),d=Math.max(q.base[2],this.base[2]);return new g([f,j,d],[Math.min(q.max[0],this.max[0])-f,Math.min(q.max[1],this.max[1])-j,Math.min(q.max[2],this.max[2])-d])}},12966:(q,f)=>{"use strict";function j(q){var f=32;return(q&=-q)&&f--,65535&q&&(f-=16),16711935&q&&(f-=8),252645135&q&&(f-=4),858993459&q&&(f-=2),1431655765&q&&(f-=1),f}f.INT_BITS=32,f.INT_MAX=2147483647,f.INT_MIN=-1<<31,f.sign=function(q){return(q>0)-(q<0)},f.abs=function(q){var f=q>>31;return(q^f)-f},f.min=function(q,f){return f^(q^f)&-(q<f)},f.max=function(q,f){return q^(q^f)&-(q<f)},f.isPow2=function(q){return!(q&q-1)&&!!q},f.log2=function(q){var f,j;return f=(q>65535)<<4,f|=j=((q>>>=f)>255)<<3,f|=j=((q>>>=j)>15)<<2,(f|=j=((q>>>=j)>3)<<1)|(q>>>=j)>>1},f.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},f.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},f.countTrailingZeros=j,f.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},f.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},f.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var d=new Array(256);!function(q){for(var f=0;f<256;++f){var j=f,d=f,g=7;for(j>>>=1;j;j>>>=1)d<<=1,d|=1&j,--g;q[f]=d<<g&255}}(d),f.reverse=function(q){return d[255&q]<<24|d[q>>>8&255]<<16|d[q>>>16&255]<<8|d[q>>>24&255]},f.interleave2=function(q,f){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))<<1},f.deinterleave2=function(q,f){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>f&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},f.interleave3=function(q,f,j){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},f.deinterleave3=function(q,f){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>f&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},f.nextCombination=function(q){var f=q|q-1;return f+1|(~f&-~f)-1>>>j(q)+1}},12951:(q,f,j)=>{"use strict";q.exports=function(q,f,j){switch(arguments.length){case 1:return d=[],r(g=q,g,u,!0),d;case 2:return"function"===typeof f?r(q,q,f,!0):function(q,f){return d=[],r(q,f,u,!1),d}(q,f);case 3:return r(q,f,j,!1);default:throw new Error("box-intersect: Invalid arguments")}var g};var d,g=j(12959),h=j(12985),L=j(12998);function Q(q,f){for(var j=0;j<q;++j)if(!(f[j]<=f[j+q]))return!0;return!1}function H(q,f,j,d){for(var g=0,h=0,L=0,H=q.length;L<H;++L){var r=q[L];if(!Q(f,r)){for(var u=0;u<2*f;++u)j[g++]=r[u];d[h++]=L}}return h}function r(q,f,j,d){var Q=q.length,r=f.length;if(!(Q<=0||r<=0)){var u=q[0].length>>>1;if(!(u<=0)){var X,z=g.mallocDouble(2*u*Q),B=g.mallocInt32(Q);if((Q=H(q,u,z,B))>0){if(1===u&&d)h.init(Q),X=h.sweepComplete(u,j,0,Q,z,B,0,Q,z,B);else{var D=g.mallocDouble(2*u*r),i=g.mallocInt32(r);(r=H(f,u,D,i))>0&&(h.init(Q+r),X=1===u?h.sweepBipartite(u,j,0,Q,z,B,0,r,D,i):L(u,j,d,Q,z,B,r,D,i),g.free(D),g.free(i))}g.free(z),g.free(B)}return X}}}function u(q,f){d.push([q,f])}},13003:(q,f)=>{"use strict";var j="d",d="ax",g="fp",h="es",L="rs",Q="re",H="rb",r="bs",u="be",X="bb",z=[j,d,"vv",L,Q,H,"ri",r,u,X,"bi"];function B(q){var f="bruteForce"+(q?"Full":"Partial"),d=[],L=z.slice();q||L.splice(3,0,g);var Q=["function "+f+"("+L.join()+"){"];function H(f,g){var L=function(q,f,d){var g="bruteForce"+(q?"Red":"Blue")+(f?"Flip":"")+(d?"Full":""),L=["function ",g,"(",z.join(),"){","var ",h,"=2*",j,";"],Q="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",H="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(d?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return q?L.push(Q,"Q",":",H):L.push(H,"Q",":",Q),d?L.push("if(y1<x0||x1<y0)continue;"):f?L.push("if(y0<=x0||x1<y0)continue;"):L.push("if(y0<x0||x1<y0)continue;"),L.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),f?L.push("yi,xi"):L.push("xi,yi"),L.push(");if(rv!==void 0)return rv;}}}"),{name:g,code:L.join("")}}(f,g,q);d.push(L.code),Q.push("return "+L.name+"("+z.join()+");")}Q.push("if(re-rs>be-bs){"),q?(H(!0,!1),Q.push("}else{"),H(!1,!1)):(Q.push("if(fp){"),H(!0,!0),Q.push("}else{"),H(!0,!1),Q.push("}}else{if(fp){"),H(!1,!0),Q.push("}else{"),H(!1,!1),Q.push("}")),Q.push("}}return "+f);var r=d.join("")+Q.join("");return new Function(r)()}f.partial=B(!1),f.full=B(!0)},12998:(q,f,j)=>{"use strict";q.exports=function(q,f,j,h,u,W,n,U,Y){!function(q,f){var j=8*g.log2(f+1)*(q+1)|0,h=g.nextPow2(E*j);S.length<h&&(d.free(S),S=d.mallocInt32(h));var L=g.nextPow2(s*j);e.length<L&&(d.free(e),e=d.mallocDouble(L))}(q,h+n);var v,F=0,M=2*q;Z(F++,0,0,h,0,n,j?16:0,-1/0,1/0),j||Z(F++,0,0,n,0,h,1,-1/0,1/0);for(;F>0;){var o=(F-=1)*E,b=S[o],x=S[o+1],R=S[o+2],A=S[o+3],k=S[o+4],y=S[o+5],p=F*s,l=e[p],V=e[p+1],a=1&y,P=!!(16&y),C=u,c=W,G=U,m=Y;if(a&&(C=U,c=Y,G=u,m=W),!(2&y&&x>=(R=t(q,b,x,R,C,c,V)))&&!(4&y&&(x=O(q,b,x,R,C,c,l))>=R)){var K=R-x,J=k-A;if(P){if(q*K*(K+J)<B){if(void 0!==(v=H.scanComplete(q,b,f,x,R,C,c,A,k,G,m)))return v;continue}}else{if(q*Math.min(K,J)<X){if(void 0!==(v=L(q,b,f,a,x,R,C,c,A,k,G,m)))return v;continue}if(q*K*J<z){if(void 0!==(v=H.scanBipartite(q,b,f,a,x,R,C,c,A,k,G,m)))return v;continue}}var qq=D(q,b,x,R,C,c,l,V);if(x<qq)if(q*(qq-x)<X){if(void 0!==(v=Q(q,b+1,f,x,qq,C,c,A,k,G,m)))return v}else if(b===q-2){if(void 0!==(v=a?H.sweepBipartite(q,f,A,k,G,m,x,qq,C,c):H.sweepBipartite(q,f,x,qq,C,c,A,k,G,m)))return v}else Z(F++,b+1,x,qq,A,k,a,-1/0,1/0),Z(F++,b+1,A,k,x,qq,1^a,-1/0,1/0);if(qq<R){var fq=r(q,b,A,k,G,m),jq=G[M*fq+b],dq=i(q,b,fq,k,G,m,jq);if(dq<k&&Z(F++,b,qq,R,dq,k,(4|a)+(P?16:0),jq,V),A<fq&&Z(F++,b,qq,R,A,fq,(2|a)+(P?16:0),l,jq),fq+1===dq){if(void 0!==(v=P?T(q,b,f,qq,R,C,c,fq,G,m[fq]):I(q,b,f,a,qq,R,C,c,fq,G,m[fq])))return v}else if(fq<dq){var gq;if(P){if(qq<(gq=N(q,b,qq,R,C,c,jq))){var hq=i(q,b,qq,gq,C,c,jq);if(b===q-2){if(qq<hq&&void 0!==(v=H.sweepComplete(q,f,qq,hq,C,c,fq,dq,G,m)))return v;if(hq<gq&&void 0!==(v=H.sweepBipartite(q,f,hq,gq,C,c,fq,dq,G,m)))return v}else qq<hq&&Z(F++,b+1,qq,hq,fq,dq,16,-1/0,1/0),hq<gq&&(Z(F++,b+1,hq,gq,fq,dq,0,-1/0,1/0),Z(F++,b+1,fq,dq,hq,gq,1,-1/0,1/0))}}else qq<(gq=a?w(q,b,qq,R,C,c,jq):N(q,b,qq,R,C,c,jq))&&(b===q-2?v=a?H.sweepBipartite(q,f,fq,dq,G,m,qq,gq,C,c):H.sweepBipartite(q,f,qq,gq,C,c,fq,dq,G,m):(Z(F++,b+1,qq,gq,fq,dq,a,-1/0,1/0),Z(F++,b+1,fq,dq,qq,gq,1^a,-1/0,1/0)))}}}}};var d=j(12959),g=j(12966),h=j(13003),L=h.partial,Q=h.full,H=j(12985),r=j(13009),u=j(13015),X=128,z=1<<22,B=1<<22,D=u("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),i=u("lo===p0",["p0"]),t=u("lo<p0",["p0"]),O=u("hi<=p0",["p0"]),N=u("lo<=p0&&p0<=hi",["p0"]),w=u("lo<p0&&p0<=hi",["p0"]),E=6,s=2,S=d.mallocInt32(1024),e=d.mallocDouble(1024);function Z(q,f,j,d,g,h,L,Q,H){var r=E*q;S[r]=f,S[r+1]=j,S[r+2]=d,S[r+3]=g,S[r+4]=h,S[r+5]=L;var u=s*q;e[u]=Q,e[u+1]=H}function I(q,f,j,d,g,h,L,Q,H,r,u){var X=2*q,z=H*X,B=r[z+f];q:for(var D=g,i=g*X;D<h;++D,i+=X){var t=L[i+f],O=L[i+f+q];if(!(B<t||O<B)&&(!d||B!==t)){for(var N,w=Q[D],E=f+1;E<q;++E){t=L[i+E],O=L[i+E+q];var s=r[z+E],S=r[z+E+q];if(O<s||S<t)continue q}if(void 0!==(N=d?j(u,w):j(w,u)))return N}}}function T(q,f,j,d,g,h,L,Q,H,r){var u=2*q,X=Q*u,z=H[X+f];q:for(var B=d,D=d*u;B<g;++B,D+=u){var i=L[B];if(i!==r){var t=h[D+f],O=h[D+f+q];if(!(z<t||O<z)){for(var N=f+1;N<q;++N){t=h[D+N],O=h[D+N+q];var w=H[X+N],E=H[X+N+q];if(O<w||E<t)continue q}var s=j(i,r);if(void 0!==s)return s}}}}},13009:(q,f,j)=>{"use strict";q.exports=function(q,f,j,L,Q,H){if(L<=j+1)return j;var r=j,u=L,X=L+j>>>1,z=2*q,B=X,D=Q[z*X+f];for(;r<u;){if(u-r<g){h(q,f,r,u,Q,H),D=Q[z*X+f];break}var i=u-r,t=Math.random()*i+r|0,O=Q[z*t+f],N=Math.random()*i+r|0,w=Q[z*N+f],E=Math.random()*i+r|0,s=Q[z*E+f];O<=w?s>=w?(B=N,D=w):O>=s?(B=t,D=O):(B=E,D=s):w>=s?(B=N,D=w):s>=O?(B=t,D=O):(B=E,D=s);for(var S=z*(u-1),e=z*B,Z=0;Z<z;++Z,++S,++e){var I=Q[S];Q[S]=Q[e],Q[e]=I}var T=H[u-1];H[u-1]=H[B],H[B]=T;for(S=z*(u-1),e=z*(B=d(q,f,r,u-1,Q,H,D)),Z=0;Z<z;++Z,++S,++e){I=Q[S];Q[S]=Q[e],Q[e]=I}T=H[u-1];if(H[u-1]=H[B],H[B]=T,X<B){for(u=B-1;r<u&&Q[z*(u-1)+f]===D;)u-=1;u+=1}else{if(!(B<X))break;for(r=B+1;r<u&&Q[z*r+f]===D;)r+=1}}return d(q,f,j,X,Q,H,Q[z*X+f])};var d=j(13015)("lo<p0",["p0"]),g=8;function h(q,f,j,d,g,h){for(var L=2*q,Q=L*(j+1)+f,H=j+1;H<d;++H,Q+=L)for(var r=g[Q],u=H,X=L*(H-1);u>j&&g[X+f]>r;--u,X-=L){for(var z=X,B=X+L,D=0;D<L;++D,++z,++B){var i=g[z];g[z]=g[B],g[B]=i}var t=h[u];h[u]=h[u-1],h[u-1]=t}}},13015:q=>{"use strict";q.exports=function(q,j){var d="abcdef".split("").concat(j),g=[];q.indexOf("lo")>=0&&g.push("lo=e[k+n]");q.indexOf("hi")>=0&&g.push("hi=e[k+o]");return d.push(f.replace("_",g.join()).replace("$",q)),Function.apply(void 0,d)};var f="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12993:q=>{"use strict";q.exports=function(q,d){d<=4*f?j(0,d-1,q):r(0,d-1,q)};var f=32;function j(q,f,j){for(var d=2*(q+1),g=q+1;g<=f;++g){for(var h=j[d++],L=j[d++],Q=g,H=d-2;Q-- >q;){var r=j[H-2],u=j[H-1];if(r<h)break;if(r===h&&u<L)break;j[H]=r,j[H+1]=u,H-=2}j[H]=h,j[H+1]=L}}function d(q,f,j){f*=2;var d=j[q*=2],g=j[q+1];j[q]=j[f],j[q+1]=j[f+1],j[f]=d,j[f+1]=g}function g(q,f,j){f*=2,j[q*=2]=j[f],j[q+1]=j[f+1]}function h(q,f,j,d){f*=2,j*=2;var g=d[q*=2],h=d[q+1];d[q]=d[f],d[q+1]=d[f+1],d[f]=d[j],d[f+1]=d[j+1],d[j]=g,d[j+1]=h}function L(q,f,j,d,g){f*=2,g[q*=2]=g[f],g[f]=j,g[q+1]=g[f+1],g[f+1]=d}function Q(q,f,j){f*=2;var d=j[q*=2],g=j[f];return!(d<g)&&(d!==g||j[q+1]>j[f+1])}function H(q,f,j,d){var g=d[q*=2];return g<f||g===f&&d[q+1]<j}function r(q,u,X){var z=(u-q+1)/6|0,B=q+z,D=u-z,i=q+u>>1,t=i-z,O=i+z,N=B,w=t,E=i,s=O,S=D,e=q+1,Z=u-1,I=0;Q(N,w,X)&&(I=N,N=w,w=I),Q(s,S,X)&&(I=s,s=S,S=I),Q(N,E,X)&&(I=N,N=E,E=I),Q(w,E,X)&&(I=w,w=E,E=I),Q(N,s,X)&&(I=N,N=s,s=I),Q(E,s,X)&&(I=E,E=s,s=I),Q(w,S,X)&&(I=w,w=S,S=I),Q(w,E,X)&&(I=w,w=E,E=I),Q(s,S,X)&&(I=s,s=S,S=I);for(var T=X[2*w],W=X[2*w+1],n=X[2*s],U=X[2*s+1],Y=2*N,v=2*E,F=2*S,M=2*B,o=2*i,b=2*D,x=0;x<2;++x){var R=X[Y+x],A=X[v+x],k=X[F+x];X[M+x]=R,X[o+x]=A,X[b+x]=k}g(t,q,X),g(O,u,X);for(var y=e;y<=Z;++y)if(H(y,T,W,X))y!==e&&d(y,e,X),++e;else if(!H(y,n,U,X))for(;;){if(H(Z,n,U,X)){H(Z,T,W,X)?(h(y,e,Z,X),++e,--Z):(d(y,Z,X),--Z);break}if(--Z<y)break}L(q,e-1,T,W,X),L(u,Z+1,n,U,X),e-2-q<=f?j(q,e-2,X):r(q,e-2,X),u-(Z+2)<=f?j(Z+2,u,X):r(Z+2,u,X),Z-e<=f?j(e,Z,X):r(e,Z,X)}},12985:(q,f,j)=>{"use strict";q.exports={init:function(q){var f=g.nextPow2(q);H.length<f&&(d.free(H),H=d.mallocInt32(f));r.length<f&&(d.free(r),r=d.mallocInt32(f));u.length<f&&(d.free(u),u=d.mallocInt32(f));X.length<f&&(d.free(X),X=d.mallocInt32(f));z.length<f&&(d.free(z),z=d.mallocInt32(f));B.length<f&&(d.free(B),B=d.mallocInt32(f));var j=8*f;D.length<j&&(d.free(D),D=d.mallocDouble(j))},sweepBipartite:function(q,f,j,d,g,Q,z,B,O,N){for(var w=0,E=2*q,s=q-1,S=E-1,e=j;e<d;++e){var Z=Q[e],I=E*e;D[w++]=g[I+s],D[w++]=-(Z+1),D[w++]=g[I+S],D[w++]=Z}for(e=z;e<B;++e){Z=N[e]+L;var T=E*e;D[w++]=O[T+s],D[w++]=-Z,D[w++]=O[T+S],D[w++]=Z}var W=w>>>1;h(D,W);var n=0,U=0;for(e=0;e<W;++e){var Y=0|D[2*e+1];if(Y>=L)i(u,X,U--,Y=Y-L|0);else if(Y>=0)i(H,r,n--,Y);else if(Y<=-L){Y=-Y-L|0;for(var v=0;v<n;++v){if(void 0!==(F=f(H[v],Y)))return F}t(u,X,U++,Y)}else{Y=-Y-1|0;for(v=0;v<U;++v){var F;if(void 0!==(F=f(Y,u[v])))return F}t(H,r,n++,Y)}}},sweepComplete:function(q,f,j,d,g,L,Q,O,N,w){for(var E=0,s=2*q,S=q-1,e=s-1,Z=j;Z<d;++Z){var I=L[Z]+1<<1,T=s*Z;D[E++]=g[T+S],D[E++]=-I,D[E++]=g[T+e],D[E++]=I}for(Z=Q;Z<O;++Z){I=w[Z]+1<<1;var W=s*Z;D[E++]=N[W+S],D[E++]=1|-I,D[E++]=N[W+e],D[E++]=1|I}var n=E>>>1;h(D,n);var U=0,Y=0,v=0;for(Z=0;Z<n;++Z){var F=0|D[2*Z+1],M=1&F;if(Z<n-1&&F>>1===D[2*Z+3]>>1&&(M=2,Z+=1),F<0){for(var o=-(F>>1)-1,b=0;b<v;++b){if(void 0!==(x=f(z[b],o)))return x}if(0!==M)for(b=0;b<U;++b){if(void 0!==(x=f(H[b],o)))return x}if(1!==M)for(b=0;b<Y;++b){var x;if(void 0!==(x=f(u[b],o)))return x}0===M?t(H,r,U++,o):1===M?t(u,X,Y++,o):2===M&&t(z,B,v++,o)}else{o=(F>>1)-1;0===M?i(H,r,U--,o):1===M?i(u,X,Y--,o):2===M&&i(z,B,v--,o)}}},scanBipartite:function(q,f,j,d,g,Q,u,X,z,B,O,N){var w=0,E=2*q,s=f,S=f+q,e=1,Z=1;d?Z=L:e=L;for(var I=g;I<Q;++I){var T=I+e,W=E*I;D[w++]=u[W+s],D[w++]=-T,D[w++]=u[W+S],D[w++]=T}for(I=z;I<B;++I){T=I+Z;var n=E*I;D[w++]=O[n+s],D[w++]=-T}var U=w>>>1;h(D,U);var Y=0;for(I=0;I<U;++I){var v=0|D[2*I+1];if(v<0){var F=!1;if((T=-v)>=L?(F=!d,T-=L):(F=!!d,T-=1),F)t(H,r,Y++,T);else{var M=N[T],o=E*T,b=O[o+f+1],x=O[o+f+1+q];q:for(var R=0;R<Y;++R){var A=H[R],k=E*A;if(!(x<u[k+f+1]||u[k+f+1+q]<b)){for(var y=f+2;y<q;++y)if(O[o+y+q]<u[k+y]||u[k+y+q]<O[o+y])continue q;var p,l=X[A];if(void 0!==(p=d?j(M,l):j(l,M)))return p}}}}else i(H,r,Y--,v-e)}},scanComplete:function(q,f,j,d,g,Q,r,u,X,z,B){for(var i=0,t=2*q,O=f,N=f+q,w=d;w<g;++w){var E=w+L,s=t*w;D[i++]=Q[s+O],D[i++]=-E,D[i++]=Q[s+N],D[i++]=E}for(w=u;w<X;++w){E=w+1;var S=t*w;D[i++]=z[S+O],D[i++]=-E}var e=i>>>1;h(D,e);var Z=0;for(w=0;w<e;++w){var I=0|D[2*w+1];if(I<0){if((E=-I)>=L)H[Z++]=E-L;else{var T=B[E-=1],W=t*E,n=z[W+f+1],U=z[W+f+1+q];q:for(var Y=0;Y<Z;++Y){var v=H[Y],F=r[v];if(F===T)break;var M=t*v;if(!(U<Q[M+f+1]||Q[M+f+1+q]<n)){for(var o=f+2;o<q;++o)if(z[W+o+q]<Q[M+o]||Q[M+o+q]<z[W+o])continue q;var b=j(F,T);if(void 0!==b)return b}}}}else{for(E=I-L,Y=Z-1;Y>=0;--Y)if(H[Y]===E){for(o=Y+1;o<Z;++o)H[o-1]=H[o];break}--Z}}}};var d=j(12959),g=j(12966),h=j(12993),L=1<<28,Q=1024,H=d.mallocInt32(Q),r=d.mallocInt32(Q),u=d.mallocInt32(Q),X=d.mallocInt32(Q),z=d.mallocInt32(Q),B=d.mallocInt32(Q),D=d.mallocDouble(8192);function i(q,f,j,d){var g=f[d],h=q[j-1];q[g]=h,f[h]=g}function t(q,f,j,d){q[j]=d,f[d]=j}},12973:q=>{"use strict";function f(q,j,d){var g=0|q[d];if(g<=0)return[];var h,L=new Array(g);if(d===q.length-1)for(h=0;h<g;++h)L[h]=j;else for(h=0;h<g;++h)L[h]=f(q,j,d+1);return L}q.exports=function(q,j){switch("undefined"===typeof j&&(j=0),typeof q){case"number":if(q>0)return function(q,f){var j,d;for(j=new Array(q),d=0;d<q;++d)j[d]=f;return j}(0|q,j);break;case"object":if("number"===typeof q.length)return f(q,j,0)}return[]}},12926:(q,f,j)=>{q.exports=function(){var q=this;this.components={},this.comps=this.components;var f=this.components,j=1,g={},h=[],L=[],Q={timeout:!1,removals:[],multiComps:[]};function H(q,j){var d=f[j],h=g[j],L=h.hash[q];L&&(h.remove(q),d.Lf&&(d.multi?(L.forEach((f=>{f&&d.Lf(q,f)})),L.length=0):d.Lf(q,L)),Q.removals.push(h),r())}function r(){Q.timeout||(Q.timeout=!0,setTimeout(u,1))}function u(){Q.timeout=!1,X()}function X(){Q.multiComps.length&&function(q){for(var f=0;f<q.length;f++){var{entID:j,data:d}=q[f],g=d.hash[j];if(g){for(var h=0;h<g.length;h++)g[h]||(g.splice(h,1),h--);0===g.length&&(d.remove(j),Q.removals.push(d))}}q.length=0}(Q.multiComps),Q.removals.length&&function(q){for(var f=0;f<q.length;f++){q[f].flush()}q.length=0}(Q.removals)}this.bX=g,this._systems=h,this._renderSystems=L,this.eu=function(f){var d=j++;return Array.isArray(f)&&f.forEach((f=>q.rr(d,f))),d},this.deleteEntity=function(f){return Object.keys(g).forEach((q=>{g[q].hash[f]&&H(f,q)})),q},this.ku=function(q){if(!q)throw new Error("Missing component definition");var j=q.name;if(!j)throw new Error("Component definition must have a name property.");if("string"!==typeof j)throw new Error("Component name must be a string.");if(""===j)throw new Error("Component name must be a non-empty string.");if(g[j])throw new Error(`Component ${j} already exists.`);var Q={};return Q.name=j,Q.multi=!!q.multi,Q.order=isNaN(q.order)?99:q.order,Q.stateConstructor=q.stateConstructor||null,Q.state=q.state||{},Q.XL=q.XL||null,Q.Lf=q.Lf||null,Q.system=q.system||null,Q.EH=q.EH||null,f[j]=Q,g[j]=new d,g[j]._pendingMultiCleanup=!1,g[j]._multiCleanupIDs=Q.multi?[]:null,Q.system&&(h.push(j),h.sort(((q,j)=>f[q].order-f[j].order))),Q.EH&&(L.push(j),L.sort(((q,j)=>f[q].order-f[j].order))),j},this.overwriteComponent=function(q,j){var d=f[q];if(!d)throw new Error(`Unknown component: ${q}`);if(!j)throw new Error("Missing component definition");if(d.name!==j.name)throw new Error("Overwriting component must use the same name property.");var Q={};Q.name=q,Q.multi=!!j.multi,Q.order=isNaN(j.order)?99:j.order,Q.state=j.state||{},Q.XL=j.XL||null,Q.Lf=j.Lf||null,Q.system=j.system||null,Q.EH=j.EH||null,f[q]=Q,g[q]._pendingMultiCleanup=!1,g[q]._multiCleanupIDs=Q.multi?[]:null;var H=h.indexOf(q);Q.system&&H<0&&h.push(q),!Q.system&&H>=0&&h.splice(H,1),h.sort(((q,j)=>f[q].order-f[j].order));var r=L.indexOf(q);Q.EH&&r<0&&L.push(q),!Q.EH&&r>=0&&L.splice(r,1),L.sort(((q,j)=>f[q].order-f[j].order));var u=Q.state;return this.Qu(q).forEach((q=>{for(var f in u)f in q||(q[f]=u[f]);Q.XL&&Q.XL(q.NH,q)})),q},this.deleteComponent=function(j){var d=g[j];if(!d)throw new Error(`Unknown component: ${j}`);d.flush(),d.list.forEach((q=>{q&&H(q.NH||q[0].NH,j)}));var Q=h.indexOf(j),r=L.indexOf(j);return Q>-1&&h.splice(Q,1),r>-1&&L.splice(r,1),g[j].dispose(),delete g[j],delete f[j],q},this.rr=function(q,j,d){var h,L=f[j],Q=g[j];if(!Q)throw new Error(`Unknown component: ${j}.`);if(Q.hash[q]&&!L.multi)throw new Error(`Entity ${q} already has component: ${j}.`);if(L.stateConstructor){if(!(h=new L.stateConstructor).hasOwnProperty("NH"))throw new Error(`Component ${L.name} stateConstructor type does not have property __id`)}else h=Object.assign({},{NH:q},L.state,d);if(h.NH=q,L.multi){var H=Q.hash[q];H||(H=[],Q.add(q,H)),H.push(h)}else Q.add(q,h);return L.XL&&L.XL(q,h),this},this.wr=function(q,f){var j=g[f];if(!j)throw new Error(`Unknown component: ${f}.`);return!!j.hash[q]},this.Br=function(f,j){if(!g[j])throw new Error(`Unknown component: ${j}.`);return H(f,j),q},this.getState=function(q,f){var j=g[f];if(!j)throw new Error(`Unknown component: ${f}.`);return j.hash[q]},this.Qu=function(q){var f=g[q];if(!f)throw new Error(`Unknown component: ${q}.`);return X(),f.list},this.YB=function(q){if(!g[q])throw new Error(`Unknown component: ${q}.`);var f=g[q].hash;return q=>f[q]},this.MB=function(q){if(!g[q])throw new Error(`Unknown component: ${q}.`);var f=g[q].hash;return q=>!!f[q]},this.BH=function(j){X();for(var d=0;d<h.length;d++){var L=h[d],Q=f[L],H=g[L];Q.system(j,H.list),X()}return q},this.render=function(j){X();for(var d=0;d<L.length;d++){var h=L[d],Q=f[h],H=g[h];Q.EH(j,H.list),X()}return q},this.removeMultiComponent=function(j,d,h){var L=f[d],H=g[d];if(!H)throw new Error(`Unknown component: ${d}.`);if(!L.multi)throw new Error("removeMultiComponent called on non-multi component");return function(q,f,j,d){var g=j.hash[q];if(g){var h=g[d];h&&(g[d]=null,f.Lf&&f.Lf(q,h),Q.multiComps.push({entID:q,data:j}),r())}}(j,L,H,h),q}};var d=j(12928)},12928:q=>{function f(q,f){var j=q._map[f];if(delete q.hash[f],delete q._map[f],j===q.list.length-1)q.list.pop();else{var d=q.list.pop();if(q.list[j]=d,null===d||null===d[0]){var g=q.list.length;for(var h in q._map)if(q._map[h]===g)return void(q._map[h]=j)}else{var L=d.NH||d[0].NH;q._map[L]=j}}}q.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(q,f){if("number"===typeof this._map[q]){var j=this._map[q];this.hash[q]=f,this.list[j]=f}else this._map[q]=this.list.length,this.hash[q]=f,this.list.push(f)}remove(q){var f=this._map[q];this.hash[q]=null,this.list[f]=null,this._pendingRemovals.push(q)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var q=0;q<this._pendingRemovals.length;q++){var j=this._pendingRemovals[q];null===this.hash[j]&&f(this,j)}this._pendingRemovals.length=0}}},12893:q=>{"use strict";var f,j="object"===typeof Reflect?Reflect:null,d=function(q,f,j){return Function.prototype.apply.call(q,f,j)};f=j&&"function"===typeof j.ownKeys?j.ownKeys:Object.getOwnPropertySymbols?function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:function(q){return Object.getOwnPropertyNames(q)};var g=Number.isNaN||function(q){return q!==q};function h(){h.init.call(this)}q.exports=h,q.exports.once=function(q,f){return new Promise((function(j,d){function g(j){q.removeListener(f,h),d(j)}function h(){"function"===typeof q.removeListener&&q.removeListener("error",g),j([].slice.call(arguments))}i(q,f,h,{once:!0}),"error"!==f&&function(q,f,j){"function"===typeof q.on&&i(q,"error",f,j)}(q,g,{once:!0})}))},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var L=10;function Q(q){if("function"!==typeof q)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}function H(q){return void 0===q._maxListeners?h.defaultMaxListeners:q._maxListeners}function r(q,f,j,d){var g,h,L,r;if(Q(j),void 0===(h=q._events)?(h=q._events=Object.create(null),q._eventsCount=0):(void 0!==h.newListener&&(q.emit("newListener",f,j.listener?j.listener:j),h=q._events),L=h[f]),void 0===L)L=h[f]=j,++q._eventsCount;else if("function"===typeof L?L=h[f]=d?[j,L]:[L,j]:d?L.unshift(j):L.push(j),(g=H(q))>0&&L.length>g&&!L.warned){L.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(f)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.k=q,u.type=f,u.count=L.length,r=u,console&&console.warn&&console.warn(r)}return q}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function X(q,f,j){var d={fired:!1,wrapFn:void 0,target:q,type:f,listener:j},g=u.bind(d);return g.listener=j,d.wrapFn=g,g}function z(q,f,j){var d=q._events;if(void 0===d)return[];var g=d[f];return void 0===g?[]:"function"===typeof g?j?[g.listener||g]:[g]:j?function(q){for(var f=new Array(q.length),j=0;j<f.length;++j)f[j]=q[j].listener||q[j];return f}(g):D(g,g.length)}function B(q){var f=this._events;if(void 0!==f){var j=f[q];if("function"===typeof j)return 1;if(void 0!==j)return j.length}return 0}function D(q,f){for(var j=new Array(f),d=0;d<f;++d)j[d]=q[d];return j}function i(q,f,j,d){if("function"===typeof q.on)d.once?q.once(f,j):q.on(f,j);else{if("function"!==typeof q.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q);q.addEventListener(f,(function g(h){d.once&&q.removeEventListener(f,g),j(h)}))}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return L},set:function(q){if("number"!==typeof q||q<0||g(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");L=q}}),h.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(q){if("number"!==typeof q||q<0||g(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this},h.prototype.getMaxListeners=function(){return H(this)},h.prototype.emit=function(q){for(var f=[],j=1;j<arguments.length;j++)f.push(arguments[j]);var g="error"===q,h=this._events;if(void 0!==h)g=g&&void 0===h.error;else if(!g)return!1;if(g){var L;if(f.length>0&&(L=f[0]),L instanceof Error)throw L;var Q=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw Q.context=L,Q}var H=h[q];if(void 0===H)return!1;if("function"===typeof H)d(H,this,f);else{var r=H.length,u=D(H,r);for(j=0;j<r;++j)d(u[j],this,f)}return!0},h.prototype.addListener=function(q,f){return r(this,q,f,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(q,f){return r(this,q,f,!0)},h.prototype.once=function(q,f){return Q(f),this.on(q,X(this,q,f)),this},h.prototype.prependOnceListener=function(q,f){return Q(f),this.prependListener(q,X(this,q,f)),this},h.prototype.removeListener=function(q,f){var j,d,g,h,L;if(Q(f),void 0===(d=this._events))return this;if(void 0===(j=d[q]))return this;if(j===f||j.listener===f)0===--this._eventsCount?this._events=Object.create(null):(delete d[q],d.removeListener&&this.emit("removeListener",q,j.listener||f));else if("function"!==typeof j){for(g=-1,h=j.length-1;h>=0;h--)if(j[h]===f||j[h].listener===f){L=j[h].listener,g=h;break}if(g<0)return this;0===g?j.shift():function(q,f){for(;f+1<q.length;f++)q[f]=q[f+1];q.pop()}(j,g),1===j.length&&(d[q]=j[0]),void 0!==d.removeListener&&this.emit("removeListener",q,L||f)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(q){var f,j,d;if(void 0===(j=this._events))return this;if(void 0===j.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==j[q]&&(0===--this._eventsCount?this._events=Object.create(null):delete j[q]),this;if(0===arguments.length){var g,h=Object.keys(j);for(d=0;d<h.length;++d)"removeListener"!==(g=h[d])&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(f=j[q]))this.removeListener(q,f);else if(void 0!==f)for(d=f.length-1;d>=0;d--)this.removeListener(q,f[d]);return this},h.prototype.listeners=function(q){return z(this,q,!0)},h.prototype.rawListeners=function(q){return z(this,q,!1)},h.listenerCount=function(q,f){return"function"===typeof q.listenerCount?q.listenerCount(f):B.call(q,f)},h.prototype.listenerCount=B,h.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]}},13188:q=>{"use strict";q.exports=function(q,f,j,d,g,h){var L=+f[0],Q=+f[1],H=+f[2],r=+j[0],u=+j[1],X=+j[2],z=Math.sqrt(r*r+u*u+X*X);if(0===z)throw new Error("Can't raycast along a zero vector");return function(q,f,j,d,g,h,L,Q,H,r){for(var u=0,X=Math.floor,z=0|X(f),B=0|X(j),D=0|X(d),i=g>0?1:-1,t=h>0?1:-1,O=L>0?1:-1,N=Math.abs(1/g),w=Math.abs(1/h),E=Math.abs(1/L),s=N<1/0?N*(i>0?z+1-f:f-z):1/0,S=w<1/0?w*(t>0?B+1-j:j-B):1/0,e=E<1/0?E*(O>0?D+1-d:d-D):1/0,Z=-1;u<=Q;){var I=q(z,B,D);if(I)return H&&(H[0]=f+u*g,H[1]=j+u*h,H[2]=d+u*L),r&&(r[0]=r[1]=r[2]=0,0===Z&&(r[0]=-i),1===Z&&(r[1]=-t),2===Z&&(r[2]=-O)),I;s<S?s<e?(z+=i,u=s,s+=N,Z=0):(D+=O,u=e,e+=E,Z=2):S<e?(B+=t,u=S,S+=w,Z=1):(D+=O,u=e,e+=E,Z=2)}return H&&(H[0]=f+u*g,H[1]=j+u*h,H[2]=d+u*L),r&&(r[0]=r[1]=r[2]=0),0}(q,L,Q,H,r/=z,u/=z,X/=z,d="undefined"===typeof d?64:+d,g,h)}},13226:(q,f,j)=>{"use strict";j.d(f,{d:()=>h});var d=j(12893);function g(){this.Uz=!1,this.stopPropagation=!1,this.Yz=!1,this.disabled=!1}class h{constructor(q,f){this.version="0.7.0";var j=Object.assign({},new g,f||{});this.element=q||document,this.Uz=!!j.Uz,this.stopPropagation=!!j.stopPropagation,this.Yz=!!j.Yz,this.disabled=!!j.disabled,this.filterEvents=(q,f)=>!0,this.down=new d.EventEmitter,this.up=new d.EventEmitter,this.state={},this.fu={dx:0,dy:0,sB:0,qu:0,SB:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Q(this):document.addEventListener("DOMContentLoaded",(q=>{Q(this)}),{once:!0})}bind(q){for(var f=arguments.length,j=new Array(f>1?f-1:0),d=1;d<f;d++)j[d-1]=arguments[d];j.forEach((f=>{var j=this._keyBindmap[f]||[];j.includes(q)||(j.push(q),this._keyBindmap[f]=j)})),this.state[q]=!!this.state[q],this.pressCount[q]=this.pressCount[q]||0,this.releaseCount[q]=this.releaseCount[q]||0}unbind(q){for(var f in this._keyBindmap){var j=this._keyBindmap[f],d=j.indexOf(q);d>-1&&j.splice(d,1)}}getBindings(){var q={};for(var f in this._keyBindmap){this._keyBindmap[f].forEach((j=>{q[j]=q[j]||[],q[j].push(f)}))}return q}BH(){L(this.fu),L(this.pressCount),L(this.releaseCount)}}function L(q){for(var f in q)q[f]=0}function Q(q){window.addEventListener("keydown",D.bind(null,q,!0),!1),window.addEventListener("keyup",D.bind(null,q,!1),!1);var f={passive:!0};q.element.addEventListener("touchstart",X.bind(void 0,q),{passive:!1}),q.element.addEventListener("touchend",B.bind(void 0,q),f),q.element.addEventListener("mousedown",i.bind(null,q,!0),f),window.document.addEventListener("mouseup",i.bind(null,q,!1),f),q.element.addEventListener("touchmove",t.bind(null,q),f),q.element.addEventListener("mousemove",t.bind(null,q),f),window.PointerEvent,q.element.addEventListener("wheel",O.bind(null,q),f),q.element.addEventListener("contextmenu",N.bind(null,q),!1),window.addEventListener("blur",w.bind(null,q),!1)}var H=0,r=0,u=null;function X(q,f){f.preventDefault(),z(f)}function z(q){let f=!1;for(let j=0;j<q.touches.length;++j)if(q.touches[j].identifier===u){f=!0;break}if(!f){const f=q.changedTouches[0];H=f.clientX,r=f.clientY,u=f.identifier}}function B(q,f){for(var j=f.changedTouches,d=0;d<j.length;++d)j[d].identifier===u&&(u=null)}function D(q,f,j){E(j.code,f,q,j)}function i(q,f,j){if("pointerId"in j)if(f){if(null!==q._touches.currID)return;q._touches.currID=j.pointerId}else{if(q._touches.currID!==j.pointerId)return;q._touches.currID=null}return E("Mouse"+("button"in j?j.button+1:1),f,q,j),!1}function t(q,f){var j=f.movementX||f.mozMovementX||0,d=f.movementY||f.mozMovementY||0;if(f.touches&&0===(j|d)){var g=function(q){z(q);for(let f=0;f<q.changedTouches.length;++f)if(q.changedTouches[f].identifier==u){const j=q.changedTouches[f],d=[j.clientX-H,j.clientY-r];return H=j.clientX,r=j.clientY,d}return console.error(`Did not find touch id ${u}`),[0,0]}(f);j=g[0],d=g[1]}q.fu.dx+=j,q.fu.dy+=d}function O(q,f){var j=1;switch(f.deltaMode){case 0:j=1;break;case 1:j=12;break;case 2:j=q.element.clientHeight||window.innerHeight}q.fu.sB+=(f.deltaX||0)*j,q.fu.qu+=(f.deltaY||0)*j,q.fu.SB+=(f.deltaZ||0)*j}function N(q,f){if(!q.Yz)return f.preventDefault(),!1}function w(q){for(var f in q._keyStates)q._keyStates[f]&&(/^Mouse\d/.test(f)||E(f,!1,q,{code:f,note:"o6egatuxfke",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(q,f,j,d){var g=j._keyBindmap[q];g&&(s(j._keyStates[q],f)&&(j._keyStates[q]=f,g.forEach((q=>{(!j.filterEvents||j.filterEvents(d,q))&&function(q,f,j,d){var g=f?j.pressCount:j.releaseCount;g[q]=(g[q]||0)+1;var h=j._bindPressCount[q]||0;(h+=f?1:-1)<0&&(h=0);j._bindPressCount[q]=h;var L=j.state[q];if(s(L,h)){j.state[q]=h>0;var Q=f?j.down:j.up;j.disabled||Q.emit(q,d)}}(q,f,j,d)}))),"button"in d||(j.Uz&&!d.defaultPrevented&&d.preventDefault(),j.stopPropagation&&d.stopPropagation()))}function s(q,f){return q?!f:f}},11931:q=>{q.exports=function(q,f,j){return q[0]=f[0]+j[0],q[1]=f[1]+j[1],q[2]=f[2]+j[2],q}},11892:(q,f,j)=>{q.exports=function(q,f){var j=d(q[0],q[1],q[2]),L=d(f[0],f[1],f[2]);g(j,j),g(L,L);var Q=h(j,L);return Q>1?0:Math.acos(Q)};var d=j(11898),g=j(11900),h=j(11902)},11987:q=>{q.exports=function(q,f){return q[0]=Math.ceil(f[0]),q[1]=Math.ceil(f[1]),q[2]=Math.ceil(f[2]),q}},11889:q=>{q.exports=function(q){var f=new Float32Array(3);return f[0]=q[0],f[1]=q[1],f[2]=q[2],f}},11907:q=>{q.exports=function(q,f){return q[0]=f[0],q[1]=f[1],q[2]=f[2],q}},11885:q=>{q.exports=function(){var q=new Float32Array(3);return q[0]=0,q[1]=0,q[2]=0,q}},12070:q=>{q.exports=function(q,f,j){var d=f[0],g=f[1],h=f[2],L=j[0],Q=j[1],H=j[2];return q[0]=g*H-h*Q,q[1]=h*L-d*H,q[2]=d*Q-g*L,q}},12010:(q,f,j)=>{q.exports=j(12007)},12007:q=>{q.exports=function(q,f){var j=f[0]-q[0],d=f[1]-q[1],g=f[2]-q[2];return Math.sqrt(j*j+d*d+g*g)}},11965:(q,f,j)=>{q.exports=j(11960)},11960:q=>{q.exports=function(q,f,j){return q[0]=f[0]/j[0],q[1]=f[1]/j[1],q[2]=f[2]/j[2],q}},11902:q=>{q.exports=function(q,f){return q[0]*f[0]+q[1]*f[1]+q[2]*f[2]}},11881:q=>{q.exports=1e-6},11918:(q,f,j)=>{q.exports=function(q,f){var j=q[0],g=q[1],h=q[2],L=f[0],Q=f[1],H=f[2];return Math.abs(j-L)<=d*Math.max(1,Math.abs(j),Math.abs(L))&&Math.abs(g-Q)<=d*Math.max(1,Math.abs(g),Math.abs(Q))&&Math.abs(h-H)<=d*Math.max(1,Math.abs(h),Math.abs(H))};var d=j(11881)},11924:q=>{q.exports=function(q,f){return q[0]===f[0]&&q[1]===f[1]&&q[2]===f[2]}},11982:q=>{q.exports=function(q,f){return q[0]=Math.floor(f[0]),q[1]=Math.floor(f[1]),q[2]=Math.floor(f[2]),q}},12103:(q,f,j)=>{q.exports=function(q,f,j,g,h,L){var Q,H;f||(f=3);j||(j=0);H=g?Math.min(g*f+j,q.length):q.length;for(Q=j;Q<H;Q+=f)d[0]=q[Q],d[1]=q[Q+1],d[2]=q[Q+2],h(d,d,L),q[Q]=d[0],q[Q+1]=d[1],q[Q+2]=d[2];return q};var d=j(11885)()},11898:q=>{q.exports=function(q,f,j){var d=new Float32Array(3);return d[0]=q,d[1]=f,d[2]=j,d}},11875:(q,f,j)=>{q.exports={EPSILON:j(11881),create:j(11885),clone:j(11889),angle:j(11892),hH:j(11898),i:j(11907),set:j(11912),equals:j(11918),exactEquals:j(11924),add:j(11931),ej:j(11934),sub:j(11938),multiply:j(11945),mul:j(11951),divide:j(11960),div:j(11965),min:j(11970),max:j(11973),floor:j(11982),ceil:j(11987),round:j(11994),scale:j(11999),LH:j(12004),distance:j(12007),j:j(12010),squaredDistance:j(12017),sqrDist:j(12024),length:j(12030),len:j(12037),squaredLength:j(12043),QH:j(12046),negate:j(12052),inverse:j(12061),normalize:j(11900),dot:j(11902),cross:j(12070),fH:j(12072),random:j(12075),transformMat4:j(12079),transformMat3:j(12081),transformQuat:j(12089),HH:j(12091),rH:j(12093),uH:j(12096),forEach:j(12103)}},12061:q=>{q.exports=function(q,f){return q[0]=1/f[0],q[1]=1/f[1],q[2]=1/f[2],q}},12037:(q,f,j)=>{q.exports=j(12030)},12030:q=>{q.exports=function(q){var f=q[0],j=q[1],d=q[2];return Math.sqrt(f*f+j*j+d*d)}},12072:q=>{q.exports=function(q,f,j,d){var g=f[0],h=f[1],L=f[2];return q[0]=g+d*(j[0]-g),q[1]=h+d*(j[1]-h),q[2]=L+d*(j[2]-L),q}},11973:q=>{q.exports=function(q,f,j){return q[0]=Math.max(f[0],j[0]),q[1]=Math.max(f[1],j[1]),q[2]=Math.max(f[2],j[2]),q}},11970:q=>{q.exports=function(q,f,j){return q[0]=Math.min(f[0],j[0]),q[1]=Math.min(f[1],j[1]),q[2]=Math.min(f[2],j[2]),q}},11951:(q,f,j)=>{q.exports=j(11945)},11945:q=>{q.exports=function(q,f,j){return q[0]=f[0]*j[0],q[1]=f[1]*j[1],q[2]=f[2]*j[2],q}},12052:q=>{q.exports=function(q,f){return q[0]=-f[0],q[1]=-f[1],q[2]=-f[2],q}},11900:q=>{q.exports=function(q,f){var j=f[0],d=f[1],g=f[2],h=j*j+d*d+g*g;h>0&&(h=1/Math.sqrt(h),q[0]=f[0]*h,q[1]=f[1]*h,q[2]=f[2]*h);return q}},12075:q=>{q.exports=function(q,f){f=f||1;var j=2*Math.random()*Math.PI,d=2*Math.random()-1,g=Math.sqrt(1-d*d)*f;return q[0]=Math.cos(j)*g,q[1]=Math.sin(j)*g,q[2]=d*f,q}},12091:q=>{q.exports=function(q,f,j,d){var g=j[1],h=j[2],L=f[1]-g,Q=f[2]-h,H=Math.sin(d),r=Math.cos(d);return q[0]=f[0],q[1]=g+L*r-Q*H,q[2]=h+L*H+Q*r,q}},12093:q=>{q.exports=function(q,f,j,d){var g=j[0],h=j[2],L=f[0]-g,Q=f[2]-h,H=Math.sin(d),r=Math.cos(d);return q[0]=g+Q*H+L*r,q[1]=f[1],q[2]=h+Q*r-L*H,q}},12096:q=>{q.exports=function(q,f,j,d){var g=j[0],h=j[1],L=f[0]-g,Q=f[1]-h,H=Math.sin(d),r=Math.cos(d);return q[0]=g+L*r-Q*H,q[1]=h+L*H+Q*r,q[2]=f[2],q}},11994:q=>{q.exports=function(q,f){return q[0]=Math.round(f[0]),q[1]=Math.round(f[1]),q[2]=Math.round(f[2]),q}},11999:q=>{q.exports=function(q,f,j){return q[0]=f[0]*j,q[1]=f[1]*j,q[2]=f[2]*j,q}},12004:q=>{q.exports=function(q,f,j,d){return q[0]=f[0]+j[0]*d,q[1]=f[1]+j[1]*d,q[2]=f[2]+j[2]*d,q}},11912:q=>{q.exports=function(q,f,j,d){return q[0]=f,q[1]=j,q[2]=d,q}},12024:(q,f,j)=>{q.exports=j(12017)},12046:(q,f,j)=>{q.exports=j(12043)},12017:q=>{q.exports=function(q,f){var j=f[0]-q[0],d=f[1]-q[1],g=f[2]-q[2];return j*j+d*d+g*g}},12043:q=>{q.exports=function(q){var f=q[0],j=q[1],d=q[2];return f*f+j*j+d*d}},11938:(q,f,j)=>{q.exports=j(11934)},11934:q=>{q.exports=function(q,f,j){return q[0]=f[0]-j[0],q[1]=f[1]-j[1],q[2]=f[2]-j[2],q}},12081:q=>{q.exports=function(q,f,j){var d=f[0],g=f[1],h=f[2];return q[0]=d*j[0]+g*j[3]+h*j[6],q[1]=d*j[1]+g*j[4]+h*j[7],q[2]=d*j[2]+g*j[5]+h*j[8],q}},12079:q=>{q.exports=function(q,f,j){var d=f[0],g=f[1],h=f[2],L=j[3]*d+j[7]*g+j[11]*h+j[15];return L=L||1,q[0]=(j[0]*d+j[4]*g+j[8]*h+j[12])/L,q[1]=(j[1]*d+j[5]*g+j[9]*h+j[13])/L,q[2]=(j[2]*d+j[6]*g+j[10]*h+j[14])/L,q}},12089:q=>{q.exports=function(q,f,j){var d=f[0],g=f[1],h=f[2],L=j[0],Q=j[1],H=j[2],r=j[3],u=r*d+Q*h-H*g,X=r*g+H*d-L*h,z=r*h+L*g-Q*d,B=-L*d-Q*g-H*h;return q[0]=u*r+B*-L+X*-H-z*-Q,q[1]=X*r+B*-Q+z*-L-u*-H,q[2]=z*r+B*-H+u*-Q-X*-L,q}},12913:q=>{"use strict";q.exports=function(q){for(var f=new Array(q),j=0;j<q;++j)f[j]=j;return f}},12976:q=>{q.exports=function(q){return null!=q&&null!=q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}},13197:(q,f,j)=>{"use strict";j.d(f,{b:()=>d});class d{constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.HX=!1,this.rX=!1,this.LX=30,this.QX=0,this.OX=!1,this.fullscreen=!1,this.XX=function(q){},this.zX=function(){},this.iX=function(){},this.Hf=function(){},this.BX=function(q){},this.onFullscreenChanged=function(q){},r((()=>{!function(q,f){q._nowObject=performance||Date,q._lastTick=0,q._renderAccum=0,q._rt=0,q._frameCB=Q.bind(null,q),requestAnimationFrame(q._frameCB),f>0&&(q._intervalCB=L.bind(null,q),q._interval=setInterval(q._intervalCB,Math.max(f,1e3/q.LX/2)))}(this,f),function(q,f){if(!f)return;var j=!1,d=!1;document.addEventListener("pointerlockchange",(d=>{j=document.pointerLockElement===f,q.BX(j)})),document.addEventListener("fullscreenchange",(j=>{d=document.fullscreenElement===f,q.onFullscreenChanged(d)})),Object.defineProperty(q,"OX",{get:()=>j,set:q=>{q&&!j?H(f):j&&!q&&function(q){q.exitPointerLock&&q.exitPointerLock()}(document)}}),Object.defineProperty(q,"fullscreen",{get:()=>d,set:q=>{q&&!d?f.requestFullscreen():d&&!q&&document.exitFullscreen()}}),f.addEventListener("click",(g=>{q.HX&&!j&&H(f),q.rX&&!d&&f.requestFullscreen()}));var g=()=>q.Hf();if(window.ResizeObserver){new ResizeObserver(g).observe(f)}else window.addEventListener("resize",g)}(this,q),this.iX()}))}}var g=3,h=20;function L(q){for(var f=1e3/q.LX,j=q._nowObject.now()+h,d=0;q._nowObject.now()>=q._lastTick+f&&q._nowObject.now()<j&&++d<=g;)q.XX(f),q._lastTick+=f;var L=5*(f+5),Q=q._nowObject.now();if(Q-q._lastTick>L)for(;Q>=q._lastTick+f;)q._lastTick+=f}function Q(q){requestAnimationFrame(q._frameCB),L(q);var f=q._nowObject.now(),j=f-q._rt;if(q._rt=f,q.QX>0){q._renderAccum+=j;var d=1e3/q.QX;if(q._renderAccum<d)return;q._renderAccum=Math.min(q._renderAccum-d,d)}var g=1e3/q.LX,h=(f-q._lastTick)/g;q.zX(j,h,g)}function H(q){q.requestPointerLock&&q.requestPointerLock()}var r=q=>{if("loading"===document.readyState){var f=()=>{document.removeEventListener("readystatechange",f),q()};document.addEventListener("readystatechange",f)}else setTimeout(q,1)}},12909:(q,f,j)=>{var d=j(12913),g=j(12922),h="undefined"!==typeof Float64Array;function L(q,f){return q[0]-f[0]}function Q(){var q,f=this.stride,j=new Array(f.length);for(q=0;q<j.length;++q)j[q]=[Math.abs(f[q]),q];j.sort(L);var d=new Array(j.length);for(q=0;q<d.length;++q)d[q]=j[q][1];return d}function H(q,f){var j=["View",f,"d",q].join("");f<0&&(j="View_Nil"+q);var g="generic"===q;if(-1===f){var h="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(h)()}if(0===f){h="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",h)(r[q][0])}h=["'use strict'"];var L=d(f),H=L.map((function(q){return"i"+q})),u="this.offset+"+L.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),X=L.map((function(q){return"b"+q})).join(","),z=L.map((function(q){return"c"+q})).join(",");h.push("function "+j+"(a,"+X+","+z+",d){this.data=a","this.shape=["+X+"]","this.stride=["+z+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+q+"'","proto.dimension="+f),h.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+L.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===f?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),f<4?(h.push("function "+j+"_order(){"),2===f?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===f&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+j+"_set("+H.join(",")+",v){"),g?h.push("return this.data.set("+u+",v)}"):h.push("return this.data["+u+"]=v}"),h.push("proto.get=function "+j+"_get("+H.join(",")+"){"),g?h.push("return this.data.get("+u+")}"):h.push("return this.data["+u+"]}"),h.push("proto.index=function "+j+"_index(",H.join(),"){return "+u+"}"),h.push("proto.hi=function "+j+"_hi("+H.join(",")+"){return new "+j+"(this.data,"+L.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+L.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var B=L.map((function(q){return"a"+q+"=this.shape["+q+"]"})),D=L.map((function(q){return"c"+q+"=this.stride["+q+"]"}));h.push("proto.lo=function "+j+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+B.join(",")+","+D.join(","));for(var i=0;i<f;++i)h.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");h.push("return new "+j+"(this.data,"+L.map((function(q){return"a"+q})).join(",")+","+L.map((function(q){return"c"+q})).join(",")+",b)}"),h.push("proto.step=function "+j+"_step("+H.join(",")+"){var "+L.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+L.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(i=0;i<f;++i)h.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");h.push("return new "+j+"(this.data,"+L.map((function(q){return"a"+q})).join(",")+","+L.map((function(q){return"b"+q})).join(",")+",c)}");var t=new Array(f),O=new Array(f);for(i=0;i<f;++i)t[i]="a[i"+i+"]",O[i]="b[i"+i+"]";h.push("proto.transpose=function "+j+"_transpose("+H+"){"+H.map((function(q,f){return q+"=("+q+"===undefined?"+f+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+t.join(",")+","+O.join(",")+",this.offset)}"),h.push("proto.pick=function "+j+"_pick("+H+"){var a=[],b=[],c=this.offset");for(i=0;i<f;++i)h.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+L.map((function(q){return"shape["+q+"]"})).join(",")+","+L.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(r[q],Q)}var r={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,f,j,d){if(void 0===q)return(0,r.array[0])([]);"number"===typeof q&&(q=[q]),void 0===f&&(f=[q.length]);var L=f.length;if(void 0===j){j=new Array(L);for(var Q=L-1,u=1;Q>=0;--Q)j[Q]=u,u*=f[Q]}if(void 0===d){d=0;for(Q=0;Q<L;++Q)j[Q]<0&&(d-=(f[Q]-1)*j[Q])}for(var X=function(q){if(g(q))return"buffer";if(h)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),z=r[X];z.length<=L+1;)z.push(H(X,z.length-1));return(0,z[L+1])(q,f,j,d)}},12922:q=>{function f(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(f(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&f(q.slice(0,0))}(q)||!!q._isBuffer)}},13055:q=>{"use strict";var f=[],j=[],d=[],g=[],h=[],L=[],Q=[],H=[],r=[],u=[],X=[],z=[];q.exports=function(q,B,D,i,t,O){for(var N=Q,w=r,E=u,s=z,S=0;S<3;S++)N[S]=+D[S],E[S]=+B.max[S],w[S]=+B.base[S];O||(O=1e-10);var e=function(q,Q,r,u,z,B){var D=f,i=j,t=d,O=g,N=h,w=L,E=H,s=Math.floor,S=0,e=0,Z=0,I=0,T=0;if(W(),0===Z)return 0;for(I=Y();e<=Z;){if(n(I)&&U())return S;I=Y()}for(S+=Z,T=0;T<3;T++)u[T]+=r[T],z[T]+=r[T];return S;function W(){if(e=0,0!==(Z=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])))for(var q=0;q<3;q++){var f=r[q]>=0;O[q]=f?1:-1;var j=f?z[q]:u[q];D[q]=f?u[q]:z[q],i[q]=v(j,O[q]),t[q]=F(D[q],O[q]),E[q]=r[q]/Z,N[q]=Math.abs(1/E[q]);var d=f?i[q]+1-j:j-i[q];w[q]=N[q]<1/0?N[q]*d:1/0}}function n(f){for(var j=O[0],d=0===f?i[0]:t[0],g=i[0]+j,h=O[1],L=1===f?i[1]:t[1],Q=i[1]+h,H=O[2],r=2===f?i[2]:t[2],u=i[2]+H,X=d;X!=g;X+=j)for(var z=L;z!=Q;z+=h)for(var B=r;B!=u;B+=H)if(q(X,z,B))return!0;return!1}function U(){S+=e;var q=O[I],f=e/Z,j=X;for(T=0;T<3;T++){var d=r[T]*f;u[T]+=d,z[T]+=d,j[T]=r[T]-d}if(q>0?z[I]=Math.round(z[I]):u[I]=Math.round(u[I]),Q(S,I,q,j))return!0;for(T=0;T<3;T++)r[T]=j[T];return W(),0===Z}function Y(){var q=w[0]<w[1]?w[0]<w[2]?0:2:w[1]<w[2]?1:2,f=w[q]-e;for(e=w[q],i[q]+=O[q],w[q]+=N[q],T=0;T<3;T++)D[T]+=f*E[T],t[T]=F(D[T],O[T]);return q}function v(q,f){return s(q-f*B)}function F(q,f){return s(q+f*B)}}(q,i,N,w,E,O);if(!t){for(S=0;S<3;S++)s[S]=D[S]>0?E[S]-B.max[S]:w[S]-B.base[S];B.translate(s)}return e}},13234:(q,f,j)=>{"use strict";j.d(f,{d:()=>X});var d=j(13049),g=j(11875);class h{constructor(q,f,j,h,L,Q,H){this.Lu=new d(q.base,q.Eu),this.Wg=f,this.friction=j,this.restitution=h,this.CQ=L,this.pB=Q,this.cQ=!!H,this.wu=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.nD=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.br=g.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=g.create(),this._impulses=g.create(),this._sleepFrameCount=10}loadFromCopy(q){g.i(this.Lu.base,q.Lu.base),g.i(this.Lu.Eu,q.Lu.Eu),g.i(this.Lu.max,q.Lu.max),this.Lu.mag=q.Lu.mag,this.Wg=q.Wg,this.friction=q.friction,this.restitution=q.restitution,this.CQ=q.CQ,this.pB=q.pB,this.cQ=q.cQ,this.wu=q.wu,this.fluidDrag=q.fluidDrag,this.nD=q.nD,this.preventFallOffEdge=q.preventFallOffEdge,this.rolledBackLastTick=q.rolledBackLastTick,g.i(this.br,q.br),g.i(this.resting,q.resting),this.inFluid=q.inFluid,this._ratioInFluid=q._ratioInFluid,g.i(this._forces,q._forces),g.i(this._impulses,q._impulses),this._sleepFrameCount=q._sleepFrameCount}setPosition(q){L(q),g.ej(q,q,this.Lu.base),this.Lu.translate(q),this.kr()}zf(){return g.clone(this.Lu.base)}applyForce(q){L(q),g.add(this._forces,this._forces,q),this.kr()}applyImpulse(q){L(q),g.add(this._impulses,this._impulses,q),this.kr()}kr(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var L=q=>{};var Q=j(13049),H=j(11875),r=j(13055);function u(){this.wu=.1,this.fluidDrag=.4,this.qH=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function X(q,f,j){q=Object.assign(new u,q),this.gravity=q.gravity||[0,-10,0],this.wu=q.wu||.1,this.qH=q.qH||2,this.fluidDrag=q.fluidDrag||.4,this.minBounceImpulse=q.minBounceImpulse,this.bodies=[],this.XB=q.XB,this.testSolid=f,this.testFluid=j}X.prototype.GB=function(q,f,j,d,g,L){q=q||new Q([0,0,0],[1,1,1]),"undefined"==typeof f&&(f=1),"undefined"==typeof j&&(j=1),"undefined"==typeof d&&(d=0),"undefined"==typeof g&&(g=1);var H=new h(q,f,j,d,g,L);return this.bodies.push(H),H},X.prototype.mB=function(q){var f=this.bodies.indexOf(q);f<0||(this.bodies.splice(f,1),q.Lu=q.pB=null)};var z=H.create(),B=H.create(),D=H.create(),i=H.create(),t=H.create(),O=H.create(),N=H.create(),w=new Q([0,0,0],[1,1,1]),E=new h(w,1,1,0,1,(()=>{}),!1);function s(q,f,j){return f=j,f*=1-(1-q.ratioInFluid)**2}X.prototype.BH=function(q){q/=1e3;var f=R(0,H.squaredLength(this.gravity));this.bodies.forEach((j=>function(q,f,j,d){H.i(t,f.resting),q.XB&&E.loadFromCopy(f);if(f.Wg<=0)return H.set(f.br,0,0,0),H.set(f._forces,0,0,0),void H.set(f._impulses,0,0,0);var g=d||0===f.CQ;if(function(q,f,j,d){if(f._sleepFrameCount>0)return!1;if(d)return!0;var g=!1,h=.5*j*j*f.CQ;return H.scale(x,q.gravity,h),r(q.testSolid,f.Lu,x,(function(){return g=!0,!0}),!0),g}(q,f,j,g))return;f._sleepFrameCount--,function(q,f){var j=f.Lu,d=Math.floor(j.base[0]),g=Math.floor(j.base[2]),h=Math.floor(j.base[1]),L=Math.floor(j.max[1]);if(!q.testFluid(d,h,g))return f.inFluid=!1,void(f.ratioInFluid=0);var Q=1,r=h+1;for(;r<=L&&q.testFluid(d,r,g);)Q++,r++;var u=(h+Q-j.base[1])/j.Eu[1];u>1&&(u=1);var X=j.Eu[0]*j.Eu[1]*j.Eu[2]*u,z=e;H.scale(z,q.gravity,-q.qH*X*f.CQ),f.applyForce(z),f.inFluid=!0,f.ratioInFluid=u}(q,f),k(f._forces),k(f._impulses),k(f.br),k(f.resting),H.scale(z,f._forces,1/f.Wg),H.LH(z,z,q.gravity,f.CQ),H.scale(B,f._impulses,1/f.Wg),H.LH(B,B,z,j),H.add(f.br,f.br,B),f.friction&&(Z(q,0,f,B,j),Z(q,1,f,B,j),Z(q,2,f,B,j));var h=f.fluidDrag>=0?f.fluidDrag:q.fluidDrag,L=f.wu>=0?f.wu:q.wu,Q=L,u=L;f.inFluid&&(Q=s(f,Q,f.fluidDragHoriz>=0?f.fluidDragHoriz:h),u=s(f,u,f.fluidDragVert>=0?f.fluidDragVert:h));Q=Math.max(1-Q*j/f.Wg,0),u=Math.max(1-u*j/f.Wg,0),H.set(S,Q,u,Q),H.multiply(f.br,f.br,S),H.scale(D,f.br,j),H.set(f._forces,0,0,0),H.set(f._impulses,0,0,0),f.cQ&&A(W,f.Lu);H.i(O,D),H.set(N,0,0,0),f.preventFallOffEdge&&function(q,f,j,d){if(!f.resting[1]||j[1]>0)return;var g=M;A(g,f.Lu);for(var h=0;h<3;h+=2){H.set(F,0,0,0),F[h]=j[h];var L=!0;(L=(L=(L=(L=L&&!b(q,g.base[0]+F[0]+1e-5,g.base[1],g.base[2]+F[2]+1e-5))&&!b(q,g.max[0]+F[0]-1e-5,g.base[1],g.base[2]+F[2]+1e-5))&&!b(q,g.base[0]+F[0]+1e-5,g.base[1],g.max[2]+F[2]-1e-5))&&!b(q,g.max[0]+F[0]-1e-5,g.base[1],g.max[2]+F[2]-1e-5))?(d[h]=j[h]>0?1:-1,j[h]=0):0===h&&(H.set(o,j[0],0,0),T(q,g,o,d,f.slideOnCollision))}}(q,f,D,N);T(q,f.Lu,D,f.resting,f.slideOnCollision),f.cQ&&function(q,f,j,d){if(f.resting[1]>=0&&!f.inFluid)return;var g=0!==f.resting[0],h=0!==f.resting[2];if(!g&&!h)return;var L=Math.abs(d[0]/d[2]),Q=4;if(!g&&L>Q)return;if(!h&&L<1/Q)return;H.add(U,j.base,d);var u=q.testSolid;r(u,j,d,(function(q,f,j,d){if(1!==f)return!0;d[f]=0}));var X=j.base[1],z=f.inFluid?1.951:1.001,B=Math.floor(X+z)-X;H.set(Y,0,B,0);var D=!1;if(r(u,j,Y,(function(q,f,j,d){return D=!0,!0})),D)return;H.ej(v,U,j.base),v[1]=0,T(q,j,v,n,!0);var i=R(j.base[0],U[0]),t=R(j.base[2],U[2]);if(g&&!i&&(!t||!h))return;if(h&&(!i||!g)&&!t)return;var O=!0;if(O=O&&!b(q,j.base[0]+1e-5,j.base[1],j.base[2]+1e-5),O=O&&!b(q,j.max[0]-1e-5,j.base[1],j.base[2]+1e-5),O=O&&!b(q,j.base[0]+1e-5,j.base[1],j.max[2]-1e-5),O=O&&!b(q,j.max[0]-1e-5,j.base[1],j.max[2]-1e-5),O)return;A(f.Lu,j),f.resting[0]=n[0],f.resting[2]=n[2],f.nD&&f.nD()}(q,f,W,O);for(var X=0;X<3;++X)f.resting[X]=f.resting[X]||N[X],i[X]=0,f.resting[X]&&(t[X]||(i[X]=-f.br[X]),f.br[X]=0);var w=H.length(i);w>.001&&(H.scale(i,i,f.Wg),f.pB&&f.pB(i),f.restitution>0&&w>q.minBounceImpulse&&(H.scale(i,i,f.restitution),f.applyImpulse(i)));var I=H.squaredLength(f.br);I>1e-5&&f.kr();q.XB&&q.XB(f)?(f.loadFromCopy(E),f.rolledBackLastTick=!0):f.rolledBackLastTick=!1}(this,j,q,f)))};var S=H.create([0,0,0]);var e=H.create();function Z(q,f,j,d,g){var h=j.resting[f],L=d[f];if(!j.alwaysApplyHorizFriction||1!==f){if(0===h)return;if(h*L<=0)return}H.i(I,j.br),I[f]=0;var Q=H.length(I);if(!R(Q,0)){var r=Math.abs(j.friction*q.gravity[f]*g),u=Q>r?(Q-r)/Q:0;j.br[(f+1)%3]*=u,j.br[(f+2)%3]*=u}}var I=H.create();function T(q,f,j,d,g){return H.set(d,0,0,0),r(q.testSolid,f,j,(function(q,f,j,h){d[f]=j,h[f]=0,g||(h[0]=0,h[1]=0,h[2]=0)}))}var W=new Q([],[]),n=H.create(),U=H.create(),Y=H.create(),v=H.create();var F=H.create(),M=new Q([],[]),o=H.create();function b(q,f,j,d){return q.testSolid(Math.floor(f),Math.floor(j-1),Math.floor(d))}var x=H.create();function R(q,f){return Math.abs(q-f)<1e-5}function A(q,f){for(var j=0;j<3;j++)q.base[j]=f.base[j],q.max[j]=f.max[j],q.Eu[j]=f.Eu[j]}var k=function(q){}},11779:function(q,f){!function(q){"use strict";var f=function(q,j){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,f){q.__proto__=f}||function(q,f){for(var j in f)Object.prototype.hasOwnProperty.call(f,j)&&(q[j]=f[j])},f(q,j)};function j(q,j){if("function"!==typeof j&&null!==j)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function d(){this.constructor=q}f(q,j),q.prototype=null===j?Object.create(j):(d.prototype=j.prototype,new d)}function d(q,f,j,d){var g,h=arguments.length,L=h<3?f:null===d?d=Object.getOwnPropertyDescriptor(f,j):d;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)L=Reflect.decorate(q,f,j,d);else for(var Q=q.length-1;Q>=0;Q--)(g=q[Q])&&(L=(h<3?g(L):h>3?g(f,j,L):g(f,j))||L);return h>3&&L&&Object.defineProperty(f,j,L),L}function g(q,f,j){if(j||2===arguments.length)for(var d,g=0,h=f.length;g<h;g++)!d&&g in f||(d||(d=Array.prototype.slice.call(f,0,g)),d[g]=f[g]);return q.concat(d||Array.prototype.slice.call(f))}var h,L=255,Q=213;q.OPERATION=void 0,(h=q.OPERATION||(q.OPERATION={}))[h.ADD=128]="ADD",h[h.REPLACE=0]="REPLACE",h[h.DELETE=64]="DELETE",h[h.DELETE_AND_ADD=192]="DELETE_AND_ADD",h[h.TOUCH=1]="TOUCH",h[h.CLEAR=10]="CLEAR";var H=function(){function f(q,f,j){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=q,this.setParent(f,j)}return f.prototype.setParent=function(q,f,j){var d=this;if(this.indexes||(this.indexes=this.ref instanceof vq?this.ref._definition.indexes:{}),this.parent=q,this.parentIndex=j,f)if(this.root=f,this.ref instanceof vq){var g=this.ref._definition;for(var h in g.schema){var L=this.ref[h];if(L&&L.$changes){var Q=g.indexes[h];L.$changes.setParent(this.ref,f,Q)}}}else"object"===typeof this.ref&&this.ref.forEach((function(q,f){if(q instanceof vq){var j=q.$changes,g=d.ref.$changes.indexes[f];j.setParent(d.ref,d.root,g)}}))},f.prototype.operation=function(q){this.changes.set(--this.currentCustomOperation,q)},f.prototype.change=function(f,j){void 0===j&&(j=q.OPERATION.ADD);var d="number"===typeof f?f:this.indexes[f];this.assertValidIndex(d,f);var g=this.changes.get(d);g&&g.op!==q.OPERATION.DELETE&&g.op!==q.OPERATION.TOUCH||this.changes.set(d,{op:g&&g.op===q.OPERATION.DELETE?q.OPERATION.DELETE_AND_ADD:j,index:d}),this.allChanges.add(d),this.changed=!0,this.touchParents()},f.prototype.touch=function(f){var j="number"===typeof f?f:this.indexes[f];this.assertValidIndex(j,f),this.changes.has(j)||this.changes.set(j,{op:q.OPERATION.TOUCH,index:j}),this.allChanges.add(j),this.touchParents()},f.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},f.prototype.getType=function(q){if(this.ref._definition)return(f=this.ref._definition).schema[f.fieldsByIndex[q]];var f,j=(f=this.parent._definition).schema[f.fieldsByIndex[this.parentIndex]];return Object.values(j)[0]},f.prototype.getChildrenFilter=function(){var q=this.parent._definition.childFilters;return q&&q[this.parentIndex]},f.prototype.getValue=function(q){return this.ref.getByIndex(q)},f.prototype.delete=function(f){var j="number"===typeof f?f:this.indexes[f];if(void 0!==j){var d=this.getValue(j);this.changes.set(j,{op:q.OPERATION.DELETE,index:j}),this.allChanges.delete(j),delete this.caches[j],d&&d.$changes&&(d.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(f," (").concat(j,")"))},f.prototype.discard=function(f,j){var d=this;void 0===f&&(f=!1),void 0===j&&(j=!1),this.ref instanceof vq||this.changes.forEach((function(f){if(f.op===q.OPERATION.DELETE){var j=d.ref.getIndex(f.index);delete d.indexes[j]}})),this.changes.clear(),this.changed=f,j&&this.allChanges.clear(),this.currentCustomOperation=0},f.prototype.discardAll=function(){var q=this;this.changes.forEach((function(f){var j=q.getValue(f.index);j&&j.$changes&&j.$changes.discardAll()})),this.discard()},f.prototype.cache=function(q,f){this.caches[q]=f},f.prototype.clone=function(){return new f(this.ref,this.parent,this.root)},f.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},f.prototype.assertValidIndex=function(q,f){if(void 0===q)throw new Error('ChangeTree: missing index for field "'.concat(f,'"'))},f}();function r(q,f,j,d){return q[f]||(q[f]=[]),q[f].push(j),null===d||void 0===d||d.forEach((function(q,f){return j(q,f)})),function(){return X(q[f],q[f].indexOf(j))}}function u(f){var j=this,d="string"!==typeof this.$changes.getType();this.$items.forEach((function(g,h){f.push({refId:j.$changes.refId,op:q.OPERATION.DELETE,field:h,value:void 0,previousValue:g}),d&&j.$changes.root.removeRef(g.$changes.refId)}))}function X(q,f){if(-1===f||f>=q.length)return!1;for(var j=q.length-1,d=f;d<j;d++)q[d]=q[d+1];return q.length=j,!0}var z=function(q,f){var j=q.toString(),d=f.toString();return j<d?-1:j>d?1:0};function B(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,f){return"symbol"===typeof f||isNaN(f)?q[f]:q.at(f)},set:function(q,f,j){if("symbol"===typeof f||isNaN(f))q[f]=j;else{var d=Array.from(q.$items.keys()),g=parseInt(d[f]||f);void 0===j||null===j?q.deleteAt(g):q.setAt(g,j)}return!0},deleteProperty:function(q,f){return"number"===typeof f?q.deleteAt(f):delete q[f],!0}})}var D=function(){function f(){for(var q=[],f=0;f<arguments.length;f++)q[f]=arguments[f];this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,q)}return f.prototype.XL=function(f,j){return void 0===j&&(j=!0),r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,f,j?this.$items:void 0)},f.prototype.Lf=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,f)},f.is=function(q){return Array.isArray(q)||void 0!==q.array},Object.defineProperty(f.prototype,"length",{get:function(){return this.$items.size},set:function(q){0===q?this.clear():this.splice(q,this.length-q)},enumerable:!1,configurable:!0}),f.prototype.push=function(){for(var q,f=this,j=[],d=0;d<arguments.length;d++)j[d]=arguments[d];return j.forEach((function(j){q=f.$refId++,f.setAt(q,j)})),q},f.prototype.pop=function(){var q=Array.from(this.$indexes.values()).pop();if(void 0!==q){this.$changes.delete(q),this.$indexes.delete(q);var f=this.$items.get(q);return this.$items.delete(q),f}},f.prototype.at=function(q){var f=Array.from(this.$items.keys())[q];return this.$items.get(f)},f.prototype.setAt=function(f,j){var d,g;if(void 0!==j&&null!==j){if(this.$items.get(f)!==j){void 0!==j.$changes&&j.$changes.setParent(this,this.$changes.root,f);var h=null!==(g=null===(d=this.$changes.indexes[f])||void 0===d?void 0:d.op)&&void 0!==g?g:q.OPERATION.ADD;this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,j),this.$changes.change(f,h)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},f.prototype.deleteAt=function(q){var f=Array.from(this.$items.keys())[q];return void 0!==f&&this.$deleteAt(f)},f.prototype.$deleteAt=function(q){return this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q)},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&u.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.concat=function(){for(var q,j=[],d=0;d<arguments.length;d++)j[d]=arguments[d];return new(f.bind.apply(f,g([void 0],(q=Array.from(this.$items.values())).concat.apply(q,j),!1)))},f.prototype.join=function(q){return Array.from(this.$items.values()).join(q)},f.prototype.reverse=function(){var q=this,f=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(j,d){q.setAt(f[d],j)})),this},f.prototype.shift=function(){var q=Array.from(this.$items.keys()).shift();if(void 0!==q){var f=this.$items.get(q);return this.$deleteAt(q),f}},f.prototype.slice=function(q,j){var d=new f;return d.push.apply(d,Array.from(this.$items.values()).slice(q,j)),d},f.prototype.sort=function(q){var f=this;void 0===q&&(q=z);var j=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(q).forEach((function(q,d){f.setAt(j[d],q)})),this},f.prototype.splice=function(q,f){void 0===f&&(f=this.length-q);for(var j=Array.from(this.$items.keys()),d=[],g=q;g<q+f;g++)d.push(this.$items.get(j[g])),this.$deleteAt(j[g]);return d},f.prototype.unshift=function(){for(var q=this,f=[],j=0;j<arguments.length;j++)f[j]=arguments[j];var d=this.length,g=f.length,h=Array.from(this.$items.values());return f.forEach((function(f,j){q.setAt(j,f)})),h.forEach((function(f,j){q.setAt(g+j,f)})),d+g},f.prototype.indexOf=function(q,f){return Array.from(this.$items.values()).indexOf(q,f)},f.prototype.lastIndexOf=function(q,f){return void 0===f&&(f=this.length-1),Array.from(this.$items.values()).lastIndexOf(q,f)},f.prototype.every=function(q,f){return Array.from(this.$items.values()).every(q,f)},f.prototype.some=function(q,f){return Array.from(this.$items.values()).some(q,f)},f.prototype.forEach=function(q,f){Array.from(this.$items.values()).forEach(q,f)},f.prototype.map=function(q,f){return Array.from(this.$items.values()).map(q,f)},f.prototype.filter=function(q,f){return Array.from(this.$items.values()).filter(q,f)},f.prototype.reduce=function(q,f){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},f.prototype.reduceRight=function(q,f){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},f.prototype.find=function(q,f){return Array.from(this.$items.values()).find(q,f)},f.prototype.findIndex=function(q,f){return Array.from(this.$items.values()).findIndex(q,f)},f.prototype.fill=function(q,f,j){throw new Error("ArraySchema#fill() not implemented")},f.prototype.copyWithin=function(q,f,j){throw new Error("ArraySchema#copyWithin() not implemented")},f.prototype.toString=function(){return this.$items.toString()},f.prototype.toLocaleString=function(){return this.$items.toLocaleString()},f.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(f,Symbol.species,{get:function(){return f},enumerable:!1,configurable:!0}),f.prototype.entries=function(){return this.$items.entries()},f.prototype.keys=function(){return this.$items.keys()},f.prototype.values=function(){return this.$items.values()},f.prototype.includes=function(q,f){return Array.from(this.$items.values()).includes(q,f)},f.prototype.flatMap=function(q,f){throw new Error("ArraySchema#flatMap() is not supported.")},f.prototype.flat=function(q){throw new Error("ArraySchema#flat() is not supported.")},f.prototype.findLast=function(){var q=Array.from(this.$items.values());return q.findLast.apply(q,arguments)},f.prototype.findLastIndex=function(){var q=Array.from(this.$items.values());return q.findLastIndex.apply(q,arguments)},f.prototype.setIndex=function(q,f){this.$indexes.set(q,f)},f.prototype.getIndex=function(q){return this.$indexes.get(q)},f.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},f.prototype.deleteByIndex=function(q){var f=this.$indexes.get(q);this.$items.delete(f),this.$indexes.delete(q)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){return this.toArray().map((function(q){return"function"===typeof q.toJSON?q.toJSON():q}))},f.prototype.clone=function(q){return q?new(f.bind.apply(f,g([void 0],Array.from(this.$items.values()),!1))):new(f.bind.apply(f,g([void 0],this.map((function(q){return q.$changes?q.clone():q})),!1)))},f}();function i(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,f){return"symbol"!==typeof f&&"undefined"===typeof q[f]?q.get(f):q[f]},set:function(q,f,j){return"symbol"!==typeof f&&-1===f.indexOf("$")&&"XL"!==f&&"Lf"!==f&&"onChange"!==f?q.set(f,j):q[f]=j,!0},deleteProperty:function(q,f){return q.delete(f),!0}})}var t=function(){function f(q){var j=this;if(this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q)if(q instanceof Map||q instanceof f)q.forEach((function(q,f){return j.set(f,q)}));else for(var d in q)this.set(d,q[d])}return f.prototype.XL=function(f,j){return void 0===j&&(j=!0),r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,f,j?this.$items:void 0)},f.prototype.Lf=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,f)},f.is=function(q){return void 0!==q.map},f.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(f.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(f,Symbol.species,{get:function(){return f},enumerable:!1,configurable:!0}),f.prototype.set=function(f,j){if(void 0===j||null===j)throw new Error("MapSchema#set('".concat(f,"', ").concat(j,"): trying to set ").concat(j," value on '").concat(f,"'."));f=f.toString();var d="undefined"!==typeof this.$changes.indexes[f],g=d?this.$changes.indexes[f]:this.$refId++,h=d?q.OPERATION.REPLACE:q.OPERATION.ADD,L=void 0!==j.$changes;if(L&&j.$changes.setParent(this,this.$changes.root,g),d){if(!L&&this.$items.get(f)===j)return;L&&this.$items.get(f)!==j&&(h=q.OPERATION.ADD)}else this.$changes.indexes[f]=g,this.$indexes.set(g,f);return this.$items.set(f,j),this.$changes.change(f,h),this},f.prototype.get=function(q){return this.$items.get(q)},f.prototype.delete=function(q){return this.$changes.delete(q),this.$items.delete(q)},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&u.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(q){return this.$items.has(q)},f.prototype.forEach=function(q){this.$items.forEach(q)},f.prototype.entries=function(){return this.$items.entries()},f.prototype.keys=function(){return this.$items.keys()},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(q,f){this.$indexes.set(q,f)},f.prototype.getIndex=function(q){return this.$indexes.get(q)},f.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},f.prototype.deleteByIndex=function(q){var f=this.$indexes.get(q);this.$items.delete(f),this.$indexes.delete(q)},f.prototype.toJSON=function(){var q={};return this.forEach((function(f,j){q[j]="function"===typeof f.toJSON?f.toJSON():f})),q},f.prototype.clone=function(q){var j;return q?j=Object.assign(new f,this):(j=new f,this.forEach((function(q,f){q.$changes?j.set(f,q.clone()):j.set(f,q)}))),j},f}(),O={};function N(q,f){O[q]=f}function w(q){return O[q]}var E=function(){function q(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return q.create=function(f){var j=new q;return j.schema=Object.assign({},f&&f.schema||{}),j.indexes=Object.assign({},f&&f.indexes||{}),j.fieldsByIndex=Object.assign({},f&&f.fieldsByIndex||{}),j.descriptors=Object.assign({},f&&f.descriptors||{}),j.deprecated=Object.assign({},f&&f.deprecated||{}),j},q.prototype.addField=function(q,f){var j=this.getNextFieldIndex();this.fieldsByIndex[j]=q,this.indexes[q]=j,this.schema[q]=Array.isArray(f)?{array:f[0]}:f},q.prototype.hasField=function(q){return void 0!==this.indexes[q]},q.prototype.addFilter=function(q,f){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[q]]=f,this.indexesWithFilters.push(this.indexes[q]),!0},q.prototype.addChildrenFilter=function(q,f){var j=this.indexes[q],d=this.schema[q];if(w(Object.keys(d)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[j]=f,!0;console.warn("@filterChildren: field '".concat(q,"' can't have children. Ignoring filter."))},q.prototype.getChildrenFilter=function(q){return this.childFilters&&this.childFilters[this.indexes[q]]},q.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},q}();function s(q){return q._context&&q._context.useFilters}var S=function(){function q(){this.types={},this.schemas=new Map,this.useFilters=!1}return q.prototype.has=function(q){return this.schemas.has(q)},q.prototype.get=function(q){return this.types[q]},q.prototype.add=function(q,f){void 0===f&&(f=this.schemas.size),q._definition=E.create(q._definition),q._typeid=f,this.types[f]=q,this.schemas.set(q,f)},q.create=function(f){return void 0===f&&(f={}),function(j){return f.context||(f.context=new q),Z(j,f)}},q}(),e=new S;function Z(q,f){return void 0===f&&(f={}),function(j,d){var h=f.context||e,L=j.constructor;if(L._context=h,!q)throw new Error("".concat(L.name,': @type() reference provided for "').concat(d,"\" is undefined. Make sure you don't have any circular dependencies."));h.has(L)||h.add(L);var Q=L._definition;if(Q.addField(d,q),Q.descriptors[d]){if(Q.deprecated[d])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(d,"' definition on '").concat(L.name,"'.\nCheck @type() annotation"))}catch(O){var H=O.stack.split("\n")[4].trim();throw new Error("".concat(O.message," ").concat(H))}}var r=D.is(q),u=!r&&t.is(q);if("string"!==typeof q&&!vq.is(q)){var X=Object.values(q)[0];"string"===typeof X||h.has(X)||h.add(X)}if(f.manual)Q.descriptors[d]={enumerable:!0,configurable:!0,writable:!0};else{var z="_".concat(d);Q.descriptors[z]={enumerable:!1,configurable:!1,writable:!0},Q.descriptors[d]={get:function(){return this[z]},set:function(q){q!==this[z]&&(void 0!==q&&null!==q?(!r||q instanceof D||(q=new(D.bind.apply(D,g([void 0],q,!1)))),!u||q instanceof t||(q=new t(q)),void 0===q.$proxy&&(u?q=i(q):r&&(q=B(q))),this.$changes.change(d),q.$changes&&q.$changes.setParent(this,this.$changes.root,this._definition.indexes[d])):this[z]&&this.$changes.delete(d),this[z]=q)},enumerable:!0,configurable:!0}}}}function I(q){return function(f,j){var d=f.constructor;d._definition.addFilter(j,q)&&(d._context.useFilters=!0)}}function T(q){return function(f,j){var d=f.constructor;d._definition.addChildrenFilter(j,q)&&(d._context.useFilters=!0)}}function W(q){return void 0===q&&(q=!0),function(f,j){var d=f.constructor._definition;d.deprecated[j]=!0,q&&(d.descriptors[j]={get:function(){throw new Error("".concat(j," is deprecated."))},set:function(q){},enumerable:!1,configurable:!0})}}function n(q,f,j){for(var d in void 0===j&&(j={}),j.context||(j.context=q._context||j.context||e),f)Z(f[d],j)(q.prototype,d);return q}function U(q){for(var f=0,j=0,d=0,g=q.length;d<g;d++)(f=q.charCodeAt(d))<128?j+=1:f<2048?j+=2:f<55296||f>=57344?j+=3:(d++,j+=4);return j}function Y(q,f,j){for(var d=0,g=0,h=j.length;g<h;g++)(d=j.charCodeAt(g))<128?q[f++]=d:d<2048?(q[f++]=192|d>>6,q[f++]=128|63&d):d<55296||d>=57344?(q[f++]=224|d>>12,q[f++]=128|d>>6&63,q[f++]=128|63&d):(g++,d=65536+((1023&d)<<10|1023&j.charCodeAt(g)),q[f++]=240|d>>18,q[f++]=128|d>>12&63,q[f++]=128|d>>6&63,q[f++]=128|63&d)}function v(q,f){q.push(255&f)}function F(q,f){q.push(255&f)}function M(q,f){q.push(255&f),q.push(f>>8&255)}function o(q,f){q.push(255&f),q.push(f>>8&255)}function b(q,f){q.push(255&f),q.push(f>>8&255),q.push(f>>16&255),q.push(f>>24&255)}function x(q,f){var j=f>>24,d=f>>16,g=f>>8,h=f;q.push(255&h),q.push(255&g),q.push(255&d),q.push(255&j)}function R(q,f){var j=Math.floor(f/Math.pow(2,32));x(q,f>>>0),x(q,j)}function A(q,f){var j=f/Math.pow(2,32)|0;x(q,f>>>0),x(q,j)}function k(q,f){a(q,f)}function y(q,f){P(q,f)}var p=new Int32Array(2),l=new Float32Array(p.buffer),V=new Float64Array(p.buffer);function a(q,f){l[0]=f,b(q,p[0])}function P(q,f){V[0]=f,b(q,p[0]),b(q,p[1])}function C(q,f){return F(q,f?1:0)}function c(q,f){f||(f="");var j=U(f),d=0;if(j<32)q.push(160|j),d=1;else if(j<256)q.push(217),F(q,j),d=2;else if(j<65536)q.push(218),o(q,j),d=3;else{if(!(j<4294967296))throw new Error("String too long");q.push(219),x(q,j),d=5}return Y(q,q.length,f),d+j}function G(q,f){return isNaN(f)?G(q,0):isFinite(f)?f!==(0|f)?(q.push(203),P(q,f),9):f>=0?f<128?(F(q,f),1):f<256?(q.push(204),F(q,f),2):f<65536?(q.push(205),o(q,f),3):f<4294967296?(q.push(206),x(q,f),5):(q.push(207),A(q,f),9):f>=-32?(q.push(224|f+32),1):f>=-128?(q.push(208),v(q,f),2):f>=-32768?(q.push(209),M(q,f),3):f>=-2147483648?(q.push(210),b(q,f),5):(q.push(211),R(q,f),9):G(q,f>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var m=Object.freeze({__proto__:null,utf8Write:Y,int8:v,uint8:F,int16:M,uint16:o,int32:b,uint32:x,int64:R,uint64:A,float32:k,float64:y,writeFloat32:a,writeFloat64:P,boolean:C,string:c,number:G});function K(q,f,j){for(var d="",g=0,h=f,L=f+j;h<L;h++){var Q=q[h];0!==(128&Q)?192!==(224&Q)?224!==(240&Q)?240!==(248&Q)?console.error("Invalid byte "+Q.toString(16)):(g=(7&Q)<<18|(63&q[++h])<<12|(63&q[++h])<<6|63&q[++h])>=65536?(g-=65536,d+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):d+=String.fromCharCode(g):d+=String.fromCharCode((15&Q)<<12|(63&q[++h])<<6|63&q[++h]):d+=String.fromCharCode((31&Q)<<6|63&q[++h]):d+=String.fromCharCode(Q)}return d}function J(q,f){return qq(q,f)<<24>>24}function qq(q,f){return q[f.offset++]}function fq(q,f){return jq(q,f)<<16>>16}function jq(q,f){return q[f.offset++]|q[f.offset++]<<8}function dq(q,f){return q[f.offset++]|q[f.offset++]<<8|q[f.offset++]<<16|q[f.offset++]<<24}function gq(q,f){return dq(q,f)>>>0}function hq(q,f){return zq(q,f)}function Lq(q,f){return Bq(q,f)}function Qq(q,f){var j=gq(q,f);return dq(q,f)*Math.pow(2,32)+j}function Hq(q,f){var j=gq(q,f);return gq(q,f)*Math.pow(2,32)+j}var rq=new Int32Array(2),uq=new Float32Array(rq.buffer),Xq=new Float64Array(rq.buffer);function zq(q,f){return rq[0]=dq(q,f),uq[0]}function Bq(q,f){return rq[0]=dq(q,f),rq[1]=dq(q,f),Xq[0]}function Dq(q,f){return qq(q,f)>0}function iq(q,f){var j,d=q[f.offset++];d<192?j=31&d:217===d?j=qq(q,f):218===d?j=jq(q,f):219===d&&(j=gq(q,f));var g=K(q,f.offset,j);return f.offset+=j,g}function tq(q,f){var j=q[f.offset];return j<192&&j>160||217===j||218===j||219===j}function Oq(q,f){var j=q[f.offset++];return j<128?j:202===j?zq(q,f):203===j?Bq(q,f):204===j?qq(q,f):205===j?jq(q,f):206===j?gq(q,f):207===j?Hq(q,f):208===j?J(q,f):209===j?fq(q,f):210===j?dq(q,f):211===j?Qq(q,f):j>223?-1*(255-j+1):void 0}function Nq(q,f){var j=q[f.offset];return j<128||j>=202&&j<=211}function wq(q,f){return q[f.offset]<160}function Eq(q,f){return q[f.offset-1]===L&&(q[f.offset]<128||q[f.offset]>=202&&q[f.offset]<=211)}var sq=Object.freeze({__proto__:null,int8:J,uint8:qq,int16:fq,uint16:jq,int32:dq,uint32:gq,float32:hq,float64:Lq,int64:Qq,uint64:Hq,readFloat32:zq,readFloat64:Bq,boolean:Dq,string:iq,stringCheck:tq,number:Oq,numberCheck:Nq,arrayCheck:wq,switchStructureCheck:Eq}),Sq=function(){function f(q){var f=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return f.add(q)}))}return f.prototype.XL=function(f,j){return void 0===j&&(j=!0),r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,f,j?this.$items:void 0)},f.prototype.Lf=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,f)},f.is=function(q){return void 0!==q.collection},f.prototype.add=function(q){var f=this.$refId++;return void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,f),this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,q),this.$changes.change(f),f},f.prototype.at=function(q){var f=Array.from(this.$items.keys())[q];return this.$items.get(f)},f.prototype.entries=function(){return this.$items.entries()},f.prototype.delete=function(q){for(var f,j,d=this.$items.entries();(j=d.next())&&!j.done;)if(q===j.value[1]){f=j.value[0];break}return void 0!==f&&(this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f))},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&u.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(q){return Array.from(this.$items.values()).some((function(f){return f===q}))},f.prototype.forEach=function(q){var f=this;this.$items.forEach((function(j,d,g){return q(j,d,f)}))},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(q,f){this.$indexes.set(q,f)},f.prototype.getIndex=function(q){return this.$indexes.get(q)},f.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},f.prototype.deleteByIndex=function(q){var f=this.$indexes.get(q);this.$items.delete(f),this.$indexes.delete(q)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){var q=[];return this.forEach((function(f,j){q.push("function"===typeof f.toJSON?f.toJSON():f)})),q},f.prototype.clone=function(q){var j;return q?j=Object.assign(new f,this):(j=new f,this.forEach((function(q){q.$changes?j.add(q.clone()):j.add(q)}))),j},f}(),eq=function(){function f(q){var f=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return f.add(q)}))}return f.prototype.XL=function(f,j){return void 0===j&&(j=!0),r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,f,j?this.$items:void 0)},f.prototype.Lf=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,f)},f.is=function(q){return void 0!==q.set},f.prototype.add=function(f){var j,d;if(this.has(f))return!1;var g=this.$refId++;void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,g);var h=null!==(d=null===(j=this.$changes.indexes[g])||void 0===j?void 0:j.op)&&void 0!==d?d:q.OPERATION.ADD;return this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,f),this.$changes.change(g,h),g},f.prototype.entries=function(){return this.$items.entries()},f.prototype.delete=function(q){for(var f,j,d=this.$items.entries();(j=d.next())&&!j.done;)if(q===j.value[1]){f=j.value[0];break}return void 0!==f&&(this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f))},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&u.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(q){for(var f,j=this.$items.values(),d=!1;(f=j.next())&&!f.done;)if(q===f.value){d=!0;break}return d},f.prototype.forEach=function(q){var f=this;this.$items.forEach((function(j,d,g){return q(j,d,f)}))},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(q,f){this.$indexes.set(q,f)},f.prototype.getIndex=function(q){return this.$indexes.get(q)},f.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},f.prototype.deleteByIndex=function(q){var f=this.$indexes.get(q);this.$items.delete(f),this.$indexes.delete(q)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){var q=[];return this.forEach((function(f,j){q.push("function"===typeof f.toJSON?f.toJSON():f)})),q},f.prototype.clone=function(q){var j;return q?j=Object.assign(new f,this):(j=new f,this.forEach((function(q){q.$changes?j.add(q.clone()):j.add(q)}))),j},f}(),Zq=function(){function q(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return q.prototype.addRefId=function(q){this.refIds.has(q)||(this.refIds.add(q),this.containerIndexes.set(q,new Set))},q.get=function(f){return void 0===f.$filterState&&(f.$filterState=new q),f.$filterState},q}(),Iq=function(){function q(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return q.prototype.getNextUniqueId=function(){return this.nextUniqueId++},q.prototype.addRef=function(q,f,j){void 0===j&&(j=!0),this.refs.set(q,f),j&&(this.refCounts[q]=(this.refCounts[q]||0)+1)},q.prototype.removeRef=function(q){this.refCounts[q]=this.refCounts[q]-1,this.deletedRefs.add(q)},q.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},q.prototype.garbageCollectDeletedRefs=function(){var q=this;this.deletedRefs.forEach((function(f){if(!(q.refCounts[f]>0)){var j=q.refs.get(f);if(j instanceof vq)for(var d in j._definition.schema)"string"!==typeof j._definition.schema[d]&&j[d]&&j[d].$changes&&q.removeRef(j[d].$changes.refId);else{var g=j.$changes.parent._definition,h=g.schema[g.fieldsByIndex[j.$changes.parentIndex]];"function"===typeof Object.values(h)[0]&&Array.from(j.values()).forEach((function(f){return q.removeRef(f.$changes.refId)}))}q.refs.delete(f),delete q.refCounts[f]}})),this.deletedRefs.clear()},q}(),Tq=function(q){function f(){return null!==q&&q.apply(this,arguments)||this}return j(f,q),f}(Error);function Wq(q,f,j,d){var g,h=!1;switch(f){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":g="number",isNaN(q)&&console.log('trying to encode "NaN" in '.concat(j.constructor.name,"#").concat(d));break;case"string":g="string",h=!0;break;case"boolean":return}if(typeof q!==g&&(!h||h&&null!==q)){var L="'".concat(JSON.stringify(q),"'").concat(q&&q.constructor&&" (".concat(q.constructor.name,")")||"");throw new Tq("a '".concat(g,"' was expected, but ").concat(L," was provided in ").concat(j.constructor.name,"#").concat(d))}}function nq(q,f,j,d){if(!(q instanceof f))throw new Tq("a '".concat(f.name,"' was expected, but '").concat(q.constructor.name,"' was provided in ").concat(j.constructor.name,"#").concat(d))}function Uq(q,f,j,d,g){Wq(j,q,d,g);var h=m[q];if(!h)throw new Tq("a '".concat(q,"' was expected, but ").concat(j," was provided in ").concat(d.constructor.name,"#").concat(g));h(f,j)}function Yq(q,f,j){return sq[q](f,j)}var vq=function(){function f(){for(var q=[],f=0;f<arguments.length;f++)q[f]=arguments[f];Object.defineProperties(this,{$changes:{value:new H(this,void 0,new Iq),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var j=this._definition.descriptors;j&&Object.defineProperties(this,j),q[0]&&this.assign(q[0])}return f.onError=function(q){console.error(q)},f.is=function(q){return q._definition&&void 0!==q._definition.schema},f.prototype.onChange=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,f)},f.prototype.Lf=function(f){return r(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,f)},f.prototype.assign=function(q){return Object.assign(this,q),this},Object.defineProperty(f.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),f.prototype.setDirty=function(q,f){this.$changes.change(q,f)},f.prototype.listen=function(q,f,j){var d=this;return void 0===j&&(j=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[q]||(this.$callbacks[q]=[]),this.$callbacks[q].push(f),j&&void 0!==this[q]&&f(this[q],void 0),function(){return X(d.$callbacks[q],d.$callbacks[q].indexOf(f))}},f.prototype.decode=function(j,d,g){var h;void 0===d&&(d={offset:0}),void 0===g&&(g=this);var Q=[],H=this.$changes.root,r=j.length,u=0;for(H.refs.set(u,this);d.offset<r;){var X=j[d.offset++];if(X!=L){var z=g.$changes,B=void 0!==g._definition,i=B?X>>6<<6:X;if(i!==q.OPERATION.CLEAR){var O=B?X%(i||255):Oq(j,d),N=B?g._definition.fieldsByIndex[O]:"",E=z.getType(O),s=void 0,S=void 0,e=void 0;if(B?S=g["_".concat(N)]:(S=g.getByIndex(O),(i&q.OPERATION.ADD)===q.OPERATION.ADD?(e=g instanceof t?iq(j,d):O,g.setIndex(O,e)):e=g.getIndex(O)),(i&q.OPERATION.DELETE)===q.OPERATION.DELETE&&(i!==q.OPERATION.DELETE_AND_ADD&&g.deleteByIndex(O),S&&S.$changes&&H.removeRef(S.$changes.refId),s=null),void 0!==N){if(i===q.OPERATION.DELETE);else if(f.is(E)){var Z=Oq(j,d);if(s=H.refs.get(Z),i!==q.OPERATION.REPLACE){var I=this.getSchemaType(j,d,E);s||((s=this.createTypeInstance(I)).$changes.refId=Z,S&&(s.$callbacks=S.$callbacks,S.$changes.refId&&Z!==S.$changes.refId&&H.removeRef(S.$changes.refId))),H.addRef(Z,s,s!==S)}}else if("string"===typeof E)s=Yq(E,j,d);else{var T=w(Object.keys(E)[0]),W=Oq(j,d),n=H.refs.has(W)?S||H.refs.get(W):new T.constructor;if((s=n.clone(!0)).$changes.refId=W,S&&(s.$callbacks=S.$callbacks,S.$changes.refId&&W!==S.$changes.refId)){H.removeRef(S.$changes.refId);for(var U=S.entries(),Y=void 0;(Y=U.next())&&!Y.done;){var v=(h=Y.value)[0],F=h[1];Q.push({refId:W,op:q.OPERATION.DELETE,field:v,value:void 0,previousValue:F})}}H.addRef(W,s,n!==S)}if(null!==s&&void 0!==s)if(s.$changes&&s.$changes.setParent(z.ref,z.root,O),g instanceof f)g[N]=s;else if(g instanceof t)v=e,g.$items.set(v,s),g.$changes.allChanges.add(O);else if(g instanceof D)g.setAt(O,s);else if(g instanceof Sq){var M=g.add(s);g.setIndex(O,M)}else g instanceof eq&&!1!==(M=g.add(s))&&g.setIndex(O,M);S!==s&&Q.push({refId:u,op:i,field:N,dynamicIndex:e,value:s,previousValue:S})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:d.offset};d.offset<r&&(!Eq(j,d)||(o.offset=d.offset+1,!H.refs.has(Oq(j,o))));)d.offset++}}else g.clear(Q)}else{u=Oq(j,d);var b=H.refs.get(u);if(!b)throw new Error('"refId" not found: '.concat(u));g=b}}return this._triggerChanges(Q),H.garbageCollectDeletedRefs(),Q},f.prototype.encode=function(j,d,g){void 0===j&&(j=!1),void 0===d&&(d=[]),void 0===g&&(g=!1);for(var h=this.$changes,Q=new WeakSet,H=[h],r=1,u=0;u<r;u++){var X=H[u],z=X.ref,B=z instanceof f;X.ensureRefId(),Q.add(X),X!==h&&(X.changed||j)&&(F(d,L),G(d,X.refId));for(var D=j?Array.from(X.allChanges):Array.from(X.changes.values()),i=0,O=D.length;i<O;i++){var N=j?{op:q.OPERATION.ADD,index:D[i]}:D[i],E=N.index,s=B?z._definition.fieldsByIndex&&z._definition.fieldsByIndex[E]:E,S=d.length;if(N.op!==q.OPERATION.TOUCH)if(B)F(d,E|N.op);else{if(F(d,N.op),N.op===q.OPERATION.CLEAR)continue;G(d,E)}if(B||(N.op&q.OPERATION.ADD)!=q.OPERATION.ADD||z instanceof t&&c(d,X.ref.$indexes.get(E)),N.op!==q.OPERATION.DELETE){var e=X.getType(E),Z=X.getValue(E);if(Z&&Z.$changes&&!Q.has(Z.$changes)&&(H.push(Z.$changes),Z.$changes.ensureRefId(),r++),N.op!==q.OPERATION.TOUCH){if(f.is(e))nq(Z,e,z,s),G(d,Z.$changes.refId),(N.op&q.OPERATION.ADD)===q.OPERATION.ADD&&this.tryEncodeTypeId(d,e,Z.constructor);else if("string"===typeof e)Uq(e,d,Z,z,s);else{var I=w(Object.keys(e)[0]);nq(z["_".concat(s)],I.constructor,z,s),G(d,Z.$changes.refId)}g&&X.cache(E,d.slice(S))}}}j||g||X.discard()}return d},f.prototype.encodeAll=function(q){return this.encode(!0,[],q)},f.prototype.applyFilters=function(j,d){var g,h;void 0===d&&(d=!1);for(var Q=this,H=new Set,r=Zq.get(j),u=[this.$changes],X=1,z=[],B=function(B){var D=u[B];if(H.has(D.refId))return"continue";var i=D.ref,O=i instanceof f;F(z,L),G(z,D.refId);var N=r.refIds.has(D),w=d||!N;r.addRefId(D);var E=r.containerIndexes.get(D),s=w?Array.from(D.allChanges):Array.from(D.changes.values());!d&&O&&i._definition.indexesWithFilters&&i._definition.indexesWithFilters.forEach((function(f){!E.has(f)&&D.allChanges.has(f)&&(w?s.push(f):s.push({op:q.OPERATION.ADD,index:f}))}));for(var S=0,e=s.length;S<e;S++){var Z=w?{op:q.OPERATION.ADD,index:s[S]}:s[S];if(Z.op!==q.OPERATION.CLEAR){var I=Z.index;if(Z.op!==q.OPERATION.DELETE){var T=D.getValue(I),W=D.getType(I);if(O){if((n=i._definition.filters&&i._definition.filters[I])&&!n.call(i,j,T,Q)){T&&T.$changes&&H.add(T.$changes.refId);continue}}else{var n,U=D.parent;if((n=D.getChildrenFilter())&&!n.call(U,j,i.$indexes.get(I),T,Q)){T&&T.$changes&&H.add(T.$changes.refId);continue}}if(T.$changes&&(u.push(T.$changes),X++),Z.op!==q.OPERATION.TOUCH)if(Z.op===q.OPERATION.ADD||O)z.push.apply(z,null!==(g=D.caches[I])&&void 0!==g?g:[]),E.add(I);else if(E.has(I))z.push.apply(z,null!==(h=D.caches[I])&&void 0!==h?h:[]);else{if(E.add(I),F(z,q.OPERATION.ADD),G(z,I),i instanceof t){var Y=D.ref.$indexes.get(I);c(z,Y)}T.$changes?G(z,T.$changes.refId):m[W](z,T)}else T.$changes&&!O&&(F(z,q.OPERATION.ADD),G(z,I),i instanceof t&&(Y=D.ref.$indexes.get(I),c(z,Y)),G(z,T.$changes.refId))}else O?F(z,Z.op|I):(F(z,Z.op),G(z,I))}else F(z,Z.op)}},D=0;D<X;D++)B(D);return z},f.prototype.clone=function(){var q,f=new this.constructor,j=this._definition.schema;for(var d in j)"object"===typeof this[d]&&"function"===typeof(null===(q=this[d])||void 0===q?void 0:q.clone)?f[d]=this[d].clone():f[d]=this[d];return f},f.prototype.toJSON=function(){var q=this._definition.schema,f=this._definition.deprecated,j={};for(var d in q)f[d]||null===this[d]||"undefined"===typeof this[d]||(j[d]="function"===typeof this[d].toJSON?this[d].toJSON():this["_".concat(d)]);return j},f.prototype.discardAllChanges=function(){this.$changes.discardAll()},f.prototype.getByIndex=function(q){return this[this._definition.fieldsByIndex[q]]},f.prototype.deleteByIndex=function(q){this[this._definition.fieldsByIndex[q]]=void 0},f.prototype.tryEncodeTypeId=function(q,f,j){f._typeid!==j._typeid&&(F(q,Q),G(q,j._typeid))},f.prototype.getSchemaType=function(q,f,j){var d;return q[f.offset]===Q&&(f.offset++,d=this.constructor._context.get(Oq(q,f))),d||j},f.prototype.createTypeInstance=function(q){var f=new q;return f.$changes.root=this.$changes.root,f},f.prototype._triggerChanges=function(j){for(var d,g,h,L,Q,H,r,u,X,z=new Set,B=this.$changes.root.refs,D=function(D){var i=j[D],t=i.refId,O=B.get(t),N=O.$callbacks;if((i.op&q.OPERATION.DELETE)===q.OPERATION.DELETE&&i.previousValue instanceof f&&(null===(g=null===(d=i.previousValue.$callbacks)||void 0===d?void 0:d[q.OPERATION.DELETE])||void 0===g||g.forEach((function(q){return q()}))),!N)return"continue";if(O instanceof f){if(!z.has(t))try{null===(h=null===N||void 0===N?void 0:N[q.OPERATION.REPLACE])||void 0===h||h.forEach((function(q){return q()}))}catch(w){f.onError(w)}try{N.hasOwnProperty(i.field)&&(null===(L=N[i.field])||void 0===L||L.forEach((function(q){return q(i.value,i.previousValue)})))}catch(w){f.onError(w)}}else i.op===q.OPERATION.ADD&&void 0===i.previousValue?null===(Q=N[q.OPERATION.ADD])||void 0===Q||Q.forEach((function(q){var f;return q(i.value,null!==(f=i.dynamicIndex)&&void 0!==f?f:i.field)})):i.op===q.OPERATION.DELETE?void 0!==i.previousValue&&(null===(H=N[q.OPERATION.DELETE])||void 0===H||H.forEach((function(q){var f;return q(i.previousValue,null!==(f=i.dynamicIndex)&&void 0!==f?f:i.field)}))):i.op===q.OPERATION.DELETE_AND_ADD&&(void 0!==i.previousValue&&(null===(r=N[q.OPERATION.DELETE])||void 0===r||r.forEach((function(q){var f;return q(i.previousValue,null!==(f=i.dynamicIndex)&&void 0!==f?f:i.field)}))),null===(u=N[q.OPERATION.ADD])||void 0===u||u.forEach((function(q){var f;return q(i.value,null!==(f=i.dynamicIndex)&&void 0!==f?f:i.field)}))),i.value!==i.previousValue&&(null===(X=N[q.OPERATION.REPLACE])||void 0===X||X.forEach((function(q){var f;return q(i.value,null!==(f=i.dynamicIndex)&&void 0!==f?f:i.field)})));z.add(t)},i=0;i<j.length;i++)D(i)},f._definition=E.create(),f}();function Fq(q){for(var f=[q.$changes],j=1,d={},g=d,h=function(q){var j=f[q];j.changes.forEach((function(q){var f=j.ref,d=q.index,h=f._definition?f._definition.fieldsByIndex[d]:f.$indexes.get(d);g[h]=j.getValue(d)}))},L=0;L<j;L++)h(L);return d}var Mq={context:new S},oq=function(q){function f(){return null!==q&&q.apply(this,arguments)||this}return j(f,q),d([Z("string",Mq)],f.prototype,"name",void 0),d([Z("string",Mq)],f.prototype,"type",void 0),d([Z("number",Mq)],f.prototype,"referencedType",void 0),f}(vq),bq=function(q){function f(){var f=null!==q&&q.apply(this,arguments)||this;return f.fields=new D,f}return j(f,q),d([Z("number",Mq)],f.prototype,"id",void 0),d([Z([oq],Mq)],f.prototype,"fields",void 0),f}(vq),xq=function(q){function f(){var f=null!==q&&q.apply(this,arguments)||this;return f.types=new D,f}return j(f,q),f.encode=function(q){var j=q.constructor,d=new f;d.rootType=j._typeid;var g=function(q,f){for(var j in f){var g=new oq;g.name=j;var h=void 0;if("string"===typeof f[j])h=f[j];else{var L=f[j],Q=void 0;vq.is(L)?(h="ref",Q=f[j]):"string"===typeof L[h=Object.keys(L)[0]]?h+=":"+L[h]:Q=L[h],g.referencedType=Q?Q._typeid:-1}g.type=h,q.fields.push(g)}d.types.push(q)},h=j._context.types;for(var L in h){var Q=new bq;Q.id=Number(L),g(Q,h[L]._definition.schema)}return d.encodeAll()},f.decode=function(q,d){var g=new S,h=new f;h.decode(q,d);var L=h.types.reduce((function(q,f){var d=function(q){function f(){return null!==q&&q.apply(this,arguments)||this}return j(f,q),f}(vq),h=f.id;return q[h]=d,g.add(d,h),q}),{});h.types.forEach((function(q){var f=L[q.id];q.fields.forEach((function(q){var j;if(void 0!==q.referencedType){var d=q.type,h=L[q.referencedType];if(!h){var Q=q.type.split(":");d=Q[0],h=Q[1]}"ref"===d?Z(h,{context:g})(f.prototype,q.name):Z(((j={})[d]=h,j),{context:g})(f.prototype,q.name)}else Z(q.type,{context:g})(f.prototype,q.name)}))}));var Q=L[h.rootType],H=new Q;for(var r in Q._definition.schema){var u=Q._definition.schema[r];"string"!==typeof u&&(H[r]="function"===typeof u?new u:new(w(Object.keys(u)[0]).constructor))}return H},d([Z([bq],Mq)],f.prototype,"types",void 0),d([Z("number",Mq)],f.prototype,"rootType",void 0),f}(vq);N("map",{constructor:t}),N("array",{constructor:D}),N("set",{constructor:eq}),N("collection",{constructor:Sq}),q.ArraySchema=D,q.CollectionSchema=Sq,q.Context=S,q.MapSchema=t,q.Reflection=xq,q.ReflectionField=oq,q.ReflectionType=bq,q.Schema=vq,q.SchemaDefinition=E,q.SetSchema=eq,q.decode=sq,q.defineTypes=n,q.deprecated=W,q.dumpChanges=Fq,q.encode=m,q.filter=I,q.filterChildren=T,q.hasFilter=s,q.registerType=N,q.type=Z,Object.defineProperty(q,"__esModule",{value:!0})}(f)},13095:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13086:(q,f,j)=>{var d=j(13095),g=j(13104),h=Object.hasOwnProperty,L=Object.create(null);for(var Q in d)h.call(d,Q)&&(L[d[Q]]=Q);var H=q.exports={to:{},get:{}};function r(q,f,j){return Math.min(Math.max(f,q),j)}function u(q){var f=Math.round(q).toString(16).toUpperCase();return f.length<2?"0"+f:f}H.get=function(q){var f,j;switch(q.substring(0,3).toLowerCase()){case"hsl":f=H.get.hsl(q),j="hsl";break;case"hwb":f=H.get.hwb(q),j="hwb";break;default:f=H.get.rgb(q),j="rgb"}return f?{model:j,value:f}:null},H.get.rgb=function(q){if(!q)return null;var f,j,g,L=[0,0,0,1];if(f=q.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(g=f[2],f=f[1],j=0;j<3;j++){var Q=2*j;L[j]=parseInt(f.slice(Q,Q+2),16)}g&&(L[3]=parseInt(g,16)/255)}else if(f=q.match(/^#([a-f0-9]{3,4})$/i)){for(g=(f=f[1])[3],j=0;j<3;j++)L[j]=parseInt(f[j]+f[j],16);g&&(L[3]=parseInt(g+g,16)/255)}else if(f=q.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(j=0;j<3;j++)L[j]=parseInt(f[j+1],0);f[4]&&(f[5]?L[3]=.01*parseFloat(f[4]):L[3]=parseFloat(f[4]))}else{if(!(f=q.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(f=q.match(/^(\w+)$/))?"transparent"===f[1]?[0,0,0,0]:h.call(d,f[1])?((L=d[f[1]])[3]=1,L):null:null;for(j=0;j<3;j++)L[j]=Math.round(2.55*parseFloat(f[j+1]));f[4]&&(f[5]?L[3]=.01*parseFloat(f[4]):L[3]=parseFloat(f[4]))}for(j=0;j<3;j++)L[j]=r(L[j],0,255);return L[3]=r(L[3],0,1),L},H.get.hsl=function(q){if(!q)return null;var f=q.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(f){var j=parseFloat(f[4]);return[(parseFloat(f[1])%360+360)%360,r(parseFloat(f[2]),0,100),r(parseFloat(f[3]),0,100),r(isNaN(j)?1:j,0,1)]}return null},H.get.hwb=function(q){if(!q)return null;var f=q.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(f){var j=parseFloat(f[4]);return[(parseFloat(f[1])%360+360)%360,r(parseFloat(f[2]),0,100),r(parseFloat(f[3]),0,100),r(isNaN(j)?1:j,0,1)]}return null},H.to.hex=function(){var q=g(arguments);return"#"+u(q[0])+u(q[1])+u(q[2])+(q[3]<1?u(Math.round(255*q[3])):"")},H.to.rgb=function(){var q=g(arguments);return q.length<4||1===q[3]?"rgb("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+")":"rgba("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+", "+q[3]+")"},H.to.rgb.percent=function(){var q=g(arguments),f=Math.round(q[0]/255*100),j=Math.round(q[1]/255*100),d=Math.round(q[2]/255*100);return q.length<4||1===q[3]?"rgb("+f+"%, "+j+"%, "+d+"%)":"rgba("+f+"%, "+j+"%, "+d+"%, "+q[3]+")"},H.to.hsl=function(){var q=g(arguments);return q.length<4||1===q[3]?"hsl("+q[0]+", "+q[1]+"%, "+q[2]+"%)":"hsla("+q[0]+", "+q[1]+"%, "+q[2]+"%, "+q[3]+")"},H.to.hwb=function(){var q=g(arguments),f="";return q.length>=4&&1!==q[3]&&(f=", "+q[3]),"hwb("+q[0]+", "+q[1]+"%, "+q[2]+"%"+f+")"},H.to.keyword=function(q){return L[q.slice(0,3)]}},13080:(q,f,j)=>{const d=j(13086),g=j(13112),h=["keyword","gray","hex"],L={};for(const B of Object.keys(g))L[[...g[B].labels].sort().join("")]=B;const Q={};function H(q,f){if(!(this instanceof H))return new H(q,f);if(f&&f in h&&(f=null),f&&!(f in g))throw new Error("Unknown model: "+f);let j,r;if(null==q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(q instanceof H)this.model=q.model,this.color=[...q.color],this.valpha=q.valpha;else if("string"===typeof q){const f=d.get(q);if(null===f)throw new Error("Unable to parse color from string: "+q);this.model=f.model,r=g[this.model].channels,this.color=f.value.slice(0,r),this.valpha="number"===typeof f.value[r]?f.value[r]:1}else if(q.length>0){this.model=f||"rgb",r=g[this.model].channels;const j=Array.prototype.slice.call(q,0,r);this.color=z(j,r),this.valpha="number"===typeof q[r]?q[r]:1}else if("number"===typeof q)this.model="rgb",this.color=[q>>16&255,q>>8&255,255&q],this.valpha=1;else{this.valpha=1;const f=Object.keys(q);"alpha"in q&&(f.splice(f.indexOf("alpha"),1),this.valpha="number"===typeof q.alpha?q.alpha:0);const d=f.sort().join("");if(!(d in L))throw new Error("Unable to parse color from object: "+JSON.stringify(q));this.model=L[d];const{labels:h}=g[this.model],Q=[];for(j=0;j<h.length;j++)Q.push(q[h[j]]);this.color=z(Q)}if(Q[this.model])for(r=g[this.model].channels,j=0;j<r;j++){const q=Q[this.model][j];q&&(this.color[j]=q(this.color[j]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}H.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(q){let f=this.model in d.to?this:this.rgb();f=f.round("number"===typeof q?q:1);const j=1===f.valpha?f.color:[...f.color,this.valpha];return d.to[f.model](j)},percentString(q){const f=this.rgb().round("number"===typeof q?q:1),j=1===f.valpha?f.color:[...f.color,this.valpha];return d.to.rgb.percent(j)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const q={},{channels:f}=g[this.model],{labels:j}=g[this.model];for(let d=0;d<f;d++)q[j[d]]=this.color[d];return 1!==this.valpha&&(q.alpha=this.valpha),q},unitArray(){const q=this.rgb().color;return q[0]/=255,q[1]/=255,q[2]/=255,1!==this.valpha&&q.push(this.valpha),q},unitObject(){const q=this.rgb().object();return q.r/=255,q.g/=255,q.b/=255,1!==this.valpha&&(q.alpha=this.valpha),q},round(q){return q=Math.max(q||0,0),new H([...this.color.map(r(q)),this.valpha],this.model)},alpha(q){return void 0!==q?new H([...this.color,Math.max(0,Math.min(1,q))],this.model):this.valpha},red:u("rgb",0,X(255)),green:u("rgb",1,X(255)),blue:u("rgb",2,X(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(q=>(q%360+360)%360)),saturationl:u("hsl",1,X(100)),lightness:u("hsl",2,X(100)),saturationv:u("hsv",1,X(100)),value:u("hsv",2,X(100)),chroma:u("hcg",1,X(100)),gray:u("hcg",2,X(100)),white:u("hwb",1,X(100)),wblack:u("hwb",2,X(100)),cyan:u("cmyk",0,X(100)),magenta:u("cmyk",1,X(100)),yellow:u("cmyk",2,X(100)),black:u("cmyk",3,X(100)),x:u("xyz",0,X(95.047)),y:u("xyz",1,X(100)),z:u("xyz",2,X(108.833)),l:u("lab",0,X(100)),a:u("lab",1),b:u("lab",2),keyword(q){return void 0!==q?new H(q):g[this.model].keyword(this.color)},hex(q){return void 0!==q?new H(q):d.to.hex(this.rgb().round().color)},hexa(q){if(void 0!==q)return new H(q);const f=this.rgb().round().color;let j=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===j.length&&(j="0"+j),d.to.hex(f)+j},rgbNumber(){const q=this.rgb().color;return(255&q[0])<<16|(255&q[1])<<8|255&q[2]},luminosity(){const q=this.rgb().color,f=[];for(const[j,d]of q.entries()){const q=d/255;f[j]=q<=.04045?q/12.92:((q+.055)/1.055)**2.4}return.2126*f[0]+.7152*f[1]+.0722*f[2]},contrast(q){const f=this.luminosity(),j=q.luminosity();return f>j?(f+.05)/(j+.05):(j+.05)/(f+.05)},level(q){const f=this.contrast(q);return f>=7?"AAA":f>=4.5?"AA":""},isDark(){const q=this.rgb().color;return(2126*q[0]+7152*q[1]+722*q[2])/1e4<128},isLight(){return!this.isDark()},negate(){const q=this.rgb();for(let f=0;f<3;f++)q.color[f]=255-q.color[f];return q},lighten(q){const f=this.hsl();return f.color[2]+=f.color[2]*q,f},darken(q){const f=this.hsl();return f.color[2]-=f.color[2]*q,f},saturate(q){const f=this.hsl();return f.color[1]+=f.color[1]*q,f},desaturate(q){const f=this.hsl();return f.color[1]-=f.color[1]*q,f},whiten(q){const f=this.hwb();return f.color[1]+=f.color[1]*q,f},blacken(q){const f=this.hwb();return f.color[2]+=f.color[2]*q,f},grayscale(){const q=this.rgb().color,f=.3*q[0]+.59*q[1]+.11*q[2];return H.rgb(f,f,f)},fade(q){return this.alpha(this.valpha-this.valpha*q)},opaquer(q){return this.alpha(this.valpha+this.valpha*q)},rotate(q){const f=this.hsl();let j=f.color[0];return j=(j+q)%360,j=j<0?360+j:j,f.color[0]=j,f},mix(q,f){if(!q||!q.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof q);const j=q.rgb(),d=this.rgb(),g=void 0===f?.5:f,h=2*g-1,L=j.alpha()-d.alpha(),Q=((h*L===-1?h:(h+L)/(1+h*L))+1)/2,r=1-Q;return H.rgb(Q*j.red()+r*d.red(),Q*j.green()+r*d.green(),Q*j.blue()+r*d.blue(),j.alpha()*g+d.alpha()*(1-g))}};for(const B of Object.keys(g)){if(h.includes(B))continue;const{channels:q}=g[B];H.prototype[B]=function(){if(this.model===B)return new H(this);for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];return f.length>0?new H(f,B):new H([...(d=g[this.model][B].raw(this.color),Array.isArray(d)?d:[d]),this.valpha],B);var d},H[B]=function(){for(var f=arguments.length,j=new Array(f),d=0;d<f;d++)j[d]=arguments[d];let g=j[0];return"number"===typeof g&&(g=z(j,q)),new H(g,B)}}function r(q){return function(f){return function(q,f){return Number(q.toFixed(f))}(f,q)}}function u(q,f,j){q=Array.isArray(q)?q:[q];for(const d of q)(Q[d]||(Q[d]=[]))[f]=j;return q=q[0],function(d){let g;return void 0!==d?(j&&(d=j(d)),g=this[q](),g.color[f]=d,g):(g=this[q]().color[f],j&&(g=j(g)),g)}}function X(q){return function(f){return Math.max(0,Math.min(q,f))}}function z(q,f){for(let j=0;j<f;j++)"number"!==typeof q[j]&&(q[j]=0);return q}q.exports=H},13116:(q,f,j)=>{const d=j(13120),g={};for(const L of Object.keys(d))g[d[L]]=L;const h={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};q.exports=h;for(const L of Object.keys(h)){if(!("channels"in h[L]))throw new Error("missing channels property: "+L);if(!("labels"in h[L]))throw new Error("missing channel labels property: "+L);if(h[L].labels.length!==h[L].channels)throw new Error("channel and label counts mismatch: "+L);const{channels:q,labels:f}=h[L];delete h[L].channels,delete h[L].labels,Object.defineProperty(h[L],"channels",{value:q}),Object.defineProperty(h[L],"labels",{value:f})}h.rgb.hsl=function(q){const f=q[0]/255,j=q[1]/255,d=q[2]/255,g=Math.min(f,j,d),h=Math.max(f,j,d),L=h-g;let Q,H;h===g?Q=0:f===h?Q=(j-d)/L:j===h?Q=2+(d-f)/L:d===h&&(Q=4+(f-j)/L),Q=Math.min(60*Q,360),Q<0&&(Q+=360);const r=(g+h)/2;return H=h===g?0:r<=.5?L/(h+g):L/(2-h-g),[Q,100*H,100*r]},h.rgb.hsv=function(q){let f,j,d,g,h;const L=q[0]/255,Q=q[1]/255,H=q[2]/255,r=Math.max(L,Q,H),u=r-Math.min(L,Q,H),X=function(q){return(r-q)/6/u+.5};return 0===u?(g=0,h=0):(h=u/r,f=X(L),j=X(Q),d=X(H),L===r?g=d-j:Q===r?g=1/3+f-d:H===r&&(g=2/3+j-f),g<0?g+=1:g>1&&(g-=1)),[360*g,100*h,100*r]},h.rgb.hwb=function(q){const f=q[0],j=q[1];let d=q[2];const g=h.rgb.hsl(q)[0],L=1/255*Math.min(f,Math.min(j,d));return d=1-1/255*Math.max(f,Math.max(j,d)),[g,100*L,100*d]},h.rgb.cmyk=function(q){const f=q[0]/255,j=q[1]/255,d=q[2]/255,g=Math.min(1-f,1-j,1-d);return[100*((1-f-g)/(1-g)||0),100*((1-j-g)/(1-g)||0),100*((1-d-g)/(1-g)||0),100*g]},h.rgb.keyword=function(q){const f=g[q];if(f)return f;let j,h=1/0;for(const g of Object.keys(d)){const f=d[g],H=(Q=f,((L=q)[0]-Q[0])**2+(L[1]-Q[1])**2+(L[2]-Q[2])**2);H<h&&(h=H,j=g)}var L,Q;return j},h.keyword.rgb=function(q){return d[q]},h.rgb.xyz=function(q){let f=q[0]/255,j=q[1]/255,d=q[2]/255;f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92,d=d>.04045?((d+.055)/1.055)**2.4:d/12.92;return[100*(.4124*f+.3576*j+.1805*d),100*(.2126*f+.7152*j+.0722*d),100*(.0193*f+.1192*j+.9505*d)]},h.rgb.lab=function(q){const f=h.rgb.xyz(q);let j=f[0],d=f[1],g=f[2];j/=95.047,d/=100,g/=108.883,j=j>.008856?j**(1/3):7.787*j+16/116,d=d>.008856?d**(1/3):7.787*d+16/116,g=g>.008856?g**(1/3):7.787*g+16/116;return[116*d-16,500*(j-d),200*(d-g)]},h.hsl.rgb=function(q){const f=q[0]/360,j=q[1]/100,d=q[2]/100;let g,h,L;if(0===j)return L=255*d,[L,L,L];g=d<.5?d*(1+j):d+j-d*j;const Q=2*d-g,H=[0,0,0];for(let r=0;r<3;r++)h=f+1/3*-(r-1),h<0&&h++,h>1&&h--,L=6*h<1?Q+6*(g-Q)*h:2*h<1?g:3*h<2?Q+(g-Q)*(2/3-h)*6:Q,H[r]=255*L;return H},h.hsl.hsv=function(q){const f=q[0];let j=q[1]/100,d=q[2]/100,g=j;const h=Math.max(d,.01);d*=2,j*=d<=1?d:2-d,g*=h<=1?h:2-h;return[f,100*(0===d?2*g/(h+g):2*j/(d+j)),100*((d+j)/2)]},h.hsv.rgb=function(q){const f=q[0]/60,j=q[1]/100;let d=q[2]/100;const g=Math.floor(f)%6,h=f-Math.floor(f),L=255*d*(1-j),Q=255*d*(1-j*h),H=255*d*(1-j*(1-h));switch(d*=255,g){case 0:return[d,H,L];case 1:return[Q,d,L];case 2:return[L,d,H];case 3:return[L,Q,d];case 4:return[H,L,d];case 5:return[d,L,Q]}},h.hsv.hsl=function(q){const f=q[0],j=q[1]/100,d=q[2]/100,g=Math.max(d,.01);let h,L;L=(2-j)*d;const Q=(2-j)*g;return h=j*g,h/=Q<=1?Q:2-Q,h=h||0,L/=2,[f,100*h,100*L]},h.hwb.rgb=function(q){const f=q[0]/360;let j=q[1]/100,d=q[2]/100;const g=j+d;let h;g>1&&(j/=g,d/=g);const L=Math.floor(6*f),Q=1-d;h=6*f-L,0!==(1&L)&&(h=1-h);const H=j+h*(Q-j);let r,u,X;switch(L){default:case 6:case 0:r=Q,u=H,X=j;break;case 1:r=H,u=Q,X=j;break;case 2:r=j,u=Q,X=H;break;case 3:r=j,u=H,X=Q;break;case 4:r=H,u=j,X=Q;break;case 5:r=Q,u=j,X=H}return[255*r,255*u,255*X]},h.cmyk.rgb=function(q){const f=q[0]/100,j=q[1]/100,d=q[2]/100,g=q[3]/100;return[255*(1-Math.min(1,f*(1-g)+g)),255*(1-Math.min(1,j*(1-g)+g)),255*(1-Math.min(1,d*(1-g)+g))]},h.xyz.rgb=function(q){const f=q[0]/100,j=q[1]/100,d=q[2]/100;let g,h,L;return g=3.2406*f+-1.5372*j+-.4986*d,h=-.9689*f+1.8758*j+.0415*d,L=.0557*f+-.204*j+1.057*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,g=Math.min(Math.max(0,g),1),h=Math.min(Math.max(0,h),1),L=Math.min(Math.max(0,L),1),[255*g,255*h,255*L]},h.xyz.lab=function(q){let f=q[0],j=q[1],d=q[2];f/=95.047,j/=100,d/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,d=d>.008856?d**(1/3):7.787*d+16/116;return[116*j-16,500*(f-j),200*(j-d)]},h.lab.xyz=function(q){let f,j,d;j=(q[0]+16)/116,f=q[1]/500+j,d=j-q[2]/200;const g=j**3,h=f**3,L=d**3;return j=g>.008856?g:(j-16/116)/7.787,f=h>.008856?h:(f-16/116)/7.787,d=L>.008856?L:(d-16/116)/7.787,f*=95.047,j*=100,d*=108.883,[f,j,d]},h.lab.lch=function(q){const f=q[0],j=q[1],d=q[2];let g;g=360*Math.atan2(d,j)/2/Math.PI,g<0&&(g+=360);return[f,Math.sqrt(j*j+d*d),g]},h.lch.lab=function(q){const f=q[0],j=q[1],d=q[2]/360*2*Math.PI;return[f,j*Math.cos(d),j*Math.sin(d)]},h.rgb.ansi16=function(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[j,d,g]=q;let L=null===f?h.rgb.hsv(q)[2]:f;if(L=Math.round(L/50),0===L)return 30;let Q=30+(Math.round(g/255)<<2|Math.round(d/255)<<1|Math.round(j/255));return 2===L&&(Q+=60),Q},h.hsv.ansi16=function(q){return h.rgb.ansi16(h.hsv.rgb(q),q[2])},h.rgb.ansi256=function(q){const f=q[0],j=q[1],d=q[2];if(f===j&&j===d)return f<8?16:f>248?231:Math.round((f-8)/247*24)+232;return 16+36*Math.round(f/255*5)+6*Math.round(j/255*5)+Math.round(d/255*5)},h.ansi16.rgb=function(q){let f=q%10;if(0===f||7===f)return q>50&&(f+=3.5),f=f/10.5*255,[f,f,f];const j=.5*(1+~~(q>50));return[(1&f)*j*255,(f>>1&1)*j*255,(f>>2&1)*j*255]},h.ansi256.rgb=function(q){if(q>=232){const f=10*(q-232)+8;return[f,f,f]}let f;q-=16;return[Math.floor(q/36)/5*255,Math.floor((f=q%36)/6)/5*255,f%6/5*255]},h.rgb.hex=function(q){const f=(((255&Math.round(q[0]))<<16)+((255&Math.round(q[1]))<<8)+(255&Math.round(q[2]))).toString(16).toUpperCase();return"000000".substring(f.length)+f},h.hex.rgb=function(q){const f=q.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!f)return[0,0,0];let j=f[0];3===f[0].length&&(j=j.split("").map((q=>q+q)).join(""));const d=parseInt(j,16);return[d>>16&255,d>>8&255,255&d]},h.rgb.hcg=function(q){const f=q[0]/255,j=q[1]/255,d=q[2]/255,g=Math.max(Math.max(f,j),d),h=Math.min(Math.min(f,j),d),L=g-h;let Q,H;return Q=L<1?h/(1-L):0,H=L<=0?0:g===f?(j-d)/L%6:g===j?2+(d-f)/L:4+(f-j)/L,H/=6,H%=1,[360*H,100*L,100*Q]},h.hsl.hcg=function(q){const f=q[1]/100,j=q[2]/100,d=j<.5?2*f*j:2*f*(1-j);let g=0;return d<1&&(g=(j-.5*d)/(1-d)),[q[0],100*d,100*g]},h.hsv.hcg=function(q){const f=q[1]/100,j=q[2]/100,d=f*j;let g=0;return d<1&&(g=(j-d)/(1-d)),[q[0],100*d,100*g]},h.hcg.rgb=function(q){const f=q[0]/360,j=q[1]/100,d=q[2]/100;if(0===j)return[255*d,255*d,255*d];const g=[0,0,0],h=f%1*6,L=h%1,Q=1-L;let H=0;switch(Math.floor(h)){case 0:g[0]=1,g[1]=L,g[2]=0;break;case 1:g[0]=Q,g[1]=1,g[2]=0;break;case 2:g[0]=0,g[1]=1,g[2]=L;break;case 3:g[0]=0,g[1]=Q,g[2]=1;break;case 4:g[0]=L,g[1]=0,g[2]=1;break;default:g[0]=1,g[1]=0,g[2]=Q}return H=(1-j)*d,[255*(j*g[0]+H),255*(j*g[1]+H),255*(j*g[2]+H)]},h.hcg.hsv=function(q){const f=q[1]/100,j=f+q[2]/100*(1-f);let d=0;return j>0&&(d=f/j),[q[0],100*d,100*j]},h.hcg.hsl=function(q){const f=q[1]/100,j=q[2]/100*(1-f)+.5*f;let d=0;return j>0&&j<.5?d=f/(2*j):j>=.5&&j<1&&(d=f/(2*(1-j))),[q[0],100*d,100*j]},h.hcg.hwb=function(q){const f=q[1]/100,j=f+q[2]/100*(1-f);return[q[0],100*(j-f),100*(1-j)]},h.hwb.hcg=function(q){const f=q[1]/100,j=1-q[2]/100,d=j-f;let g=0;return d<1&&(g=(j-d)/(1-d)),[q[0],100*d,100*g]},h.apple.rgb=function(q){return[q[0]/65535*255,q[1]/65535*255,q[2]/65535*255]},h.rgb.apple=function(q){return[q[0]/255*65535,q[1]/255*65535,q[2]/255*65535]},h.gray.rgb=function(q){return[q[0]/100*255,q[0]/100*255,q[0]/100*255]},h.gray.hsl=function(q){return[0,0,q[0]]},h.gray.hsv=h.gray.hsl,h.gray.hwb=function(q){return[0,100,q[0]]},h.gray.cmyk=function(q){return[0,0,0,q[0]]},h.gray.lab=function(q){return[q[0],0,0]},h.gray.hex=function(q){const f=255&Math.round(q[0]/100*255),j=((f<<16)+(f<<8)+f).toString(16).toUpperCase();return"000000".substring(j.length)+j},h.rgb.gray=function(q){return[(q[0]+q[1]+q[2])/3/255*100]}},13112:(q,f,j)=>{const d=j(13116),g=j(13124),h={};Object.keys(d).forEach((q=>{h[q]={},Object.defineProperty(h[q],"channels",{value:d[q].channels}),Object.defineProperty(h[q],"labels",{value:d[q].labels});const f=g(q);Object.keys(f).forEach((j=>{const d=f[j];h[q][j]=function(q){const f=function(){for(var f=arguments.length,j=new Array(f),d=0;d<f;d++)j[d]=arguments[d];const g=j[0];if(void 0===g||null===g)return g;g.length>1&&(j=g);const h=q(j);if("object"===typeof h)for(let q=h.length,L=0;L<q;L++)h[L]=Math.round(h[L]);return h};return"conversion"in q&&(f.conversion=q.conversion),f}(d),h[q][j].raw=function(q){const f=function(){for(var f=arguments.length,j=new Array(f),d=0;d<f;d++)j[d]=arguments[d];const g=j[0];return void 0===g||null===g?g:(g.length>1&&(j=g),q(j))};return"conversion"in q&&(f.conversion=q.conversion),f}(d)}))})),q.exports=h},13124:(q,f,j)=>{const d=j(13116);function g(q){const f=function(){const q={},f=Object.keys(d);for(let j=f.length,d=0;d<j;d++)q[f[d]]={distance:-1,parent:null};return q}(),j=[q];for(f[q].distance=0;j.length;){const q=j.pop(),g=Object.keys(d[q]);for(let d=g.length,h=0;h<d;h++){const d=g[h],L=f[d];-1===L.distance&&(L.distance=f[q].distance+1,L.parent=q,j.unshift(d))}}return f}function h(q,f){return function(j){return f(q(j))}}function L(q,f){const j=[f[q].parent,q];let g=d[f[q].parent][q],L=f[q].parent;for(;f[L].parent;)j.unshift(f[L].parent),g=h(d[f[L].parent][L],g),L=f[L].parent;return g.conversion=j,g}q.exports=function(q){const f=g(q),j={},d=Object.keys(f);for(let g=d.length,h=0;h<g;h++){const q=d[h];null!==f[q].parent&&(j[q]=L(q,f))}return j}},13120:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11783:function(q,f,j){"use strict";var d=this&&this.__createBinding||(Object.create?function(q,f,j,d){void 0===d&&(d=j);var g=Object.getOwnPropertyDescriptor(f,j);g&&!("get"in g?!f.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return f[j]}}),Object.defineProperty(q,d,g)}:function(q,f,j,d){void 0===d&&(d=j),q[d]=f[j]}),g=this&&this.__setModuleDefault||(Object.create?function(q,f){Object.defineProperty(q,"default",{enumerable:!0,value:f})}:function(q,f){q.default=f}),h=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var f={};if(null!=q)for(var j in q)"default"!==j&&Object.prototype.hasOwnProperty.call(q,j)&&d(f,q,j);return g(f,q),f},L=this&&this.__awaiter||function(q,f,j,d){return new(j||(j=Promise))((function(g,h){function L(q){try{H(d.next(q))}catch(f){h(f)}}function Q(q){try{H(d.throw(q))}catch(f){h(f)}}function H(q){var f;q.done?g(q.value):(f=q.value,f instanceof j?f:new j((function(q){q(f)}))).then(L,Q)}H((d=d.apply(q,f||[])).next())}))};Object.defineProperty(f,"__esModule",{value:!0}),f.Auth=f.Platform=void 0;const Q=h(j(11722)),H=j(11791),r="colyseus-auth-token";!function(q){q.ios="ios",q.android="android"}(f.Platform||(f.Platform={}));f.Auth=class{constructor(q){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=q.replace("ws","http"),(0,H.getItem)(r,(q=>this.token=q))}get hasToken(){return!!this.token}login(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return L(this,void 0,void 0,(function*(){const f=Object.assign({},q);this.hasToken&&(f.token=this.token);const j=yield this.request("post","/auth",f);this.token=j.token,(0,H.setItem)(r,this.token);for(let q in j)this.hasOwnProperty(q)&&(this[q]=j[q]);return this.registerPingService(),this}))}save(){return L(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(q){return L(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:q})}))}acceptFriendRequest(q){return L(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:q})}))}declineFriendRequest(q){return L(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:q})}))}blockUser(q){return L(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:q})}))}unblockUser(q){return L(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:q})}))}request(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return L(this,void 0,void 0,(function*(){g.Accept="application/json",this.hasToken&&(g.Authorization="Bearer "+this.token);const h=[];for(const q in j)h.push(`${q}=${j[q]}`);const L=h.length>0?`?${h.join("&")}`:"",H={headers:g};return d&&(H.body=d),(yield Q[q](`${this.endpoint}${f}${L}`,H)).data}))}logout(){this.token=void 0,(0,H.removeItem)(r),this.unregisterPingService()}registerPingService(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),q)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11719:function(q,f,j){"use strict";var d,g=this&&this.__awaiter||function(q,f,j,d){return new(j||(j=Promise))((function(g,h){function L(q){try{H(d.next(q))}catch(f){h(f)}}function Q(q){try{H(d.throw(q))}catch(f){h(f)}}function H(q){var f;q.done?g(q.value):(f=q.value,f instanceof j?f:new j((function(q){q(f)}))).then(L,Q)}H((d=d.apply(q,f||[])).next())}))};Object.defineProperty(f,"__esModule",{value:!0}),f.Client=f.MatchMakeError=void 0;const h=j(11722),L=j(11726),Q=j(11732);class H extends Error{constructor(q,f){super(q),this.code=f,Object.setPrototypeOf(this,H.prototype)}}f.MatchMakeError=H;const r="undefined"!==typeof window&&"undefined"!==typeof(null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";f.Client=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if("string"===typeof q){const f=new URL(q),j="https:"===f.protocol||"wss:"===f.protocol,d=Number(f.port||(j?443:80));this.settings={hostname:f.hostname,pathname:"/"!==f.pathname?f.pathname:"",port:d,secure:j}}else void 0===q.port&&(q.port=q.secure?443:80),void 0===q.pathname&&(q.pathname=""),this.settings=q}joinOrCreate(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",q,f,j)}))}create(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",q,f,j)}))}join(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",q,f,j)}))}joinById(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",q,f,j)}))}reconnect(q,f){return g(this,void 0,void 0,(function*(){if("string"===typeof q&&"string"===typeof f)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[j,d]=q.split(":");return yield this.createMatchMakeRequest("reconnect",j,{reconnectionToken:d},f)}))}getAvailableRooms(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g(this,void 0,void 0,(function*(){return(yield(0,h.get)(this.getHttpEndpoint(`${q}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(q,f,j){return g(this,void 0,void 0,(function*(){const d=this.createRoom(q.room.name,f);d.roomId=q.room.roomId,d.sessionId=q.sessionId;const h={sessionId:d.sessionId};q.reconnectionToken&&(h.reconnectionToken=q.reconnectionToken);const Q=j||d;return d.connect(this.buildEndpoint(q.room,h),q.devMode&&(()=>g(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${d.roomId}'...`);let j=0;const h=()=>g(this,void 0,void 0,(function*(){j++;try{yield this.consumeSeatReservation(q,f,Q),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${d.roomId}'`)}catch(g){j<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${j} out of 8)`),setTimeout(h,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(h,2e3)}))),Q),new Promise(((q,f)=>{const j=(q,j)=>f(new L.ServerError(q,j));Q.onError.once(j),Q.onJoin.once((()=>{Q.onError.remove(j),q(Q)}))}))}))}createMatchMakeRequest(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;return g(this,void 0,void 0,(function*(){const g=(yield(0,h.post)(this.getHttpEndpoint(`${q}/${f}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(j)})).data;if(g.error)throw new H(g.error,g.code);return"reconnect"===q&&(g.reconnectionToken=j.reconnectionToken),yield this.consumeSeatReservation(g,d,L)}))}createRoom(q,f){return new Q.Room(q,f)}buildEndpoint(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const j=[];for(const g in f)f.hasOwnProperty(g)&&j.push(`${g}=${f[g]}`);let d=this.settings.secure?"wss://":"ws://";return q.publicAddress?d+=`${q.publicAddress}`:d+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${d}/${q.processId}/${q.roomId}?${j.join("&")}`}getHttpEndpoint(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${q}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11743:(q,f,j)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.Connection=void 0;const d=j(11749);f.Connection=class{constructor(){this.events={},this.transport=new d.WebSocketTransport(this.events)}send(q){this.transport.send(q)}connect(q){this.transport.connect(q)}close(q,f){this.transport.close(q,f)}get isOpen(){return this.transport.isOpen}}},11760:(q,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.utf8Length=f.utf8Read=f.ErrorCode=f.Protocol=void 0,function(q){q[q.HANDSHAKE=9]="HANDSHAKE",q[q.JOIN_ROOM=10]="JOIN_ROOM",q[q.ERROR=11]="ERROR",q[q.LEAVE_ROOM=12]="LEAVE_ROOM",q[q.ROOM_DATA=13]="ROOM_DATA",q[q.ROOM_STATE=14]="ROOM_STATE",q[q.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",q[q.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",q[q.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(f.Protocol||(f.Protocol={})),function(q){q[q.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",q[q.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",q[q.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",q[q.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",q[q.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",q[q.AUTH_FAILED=4215]="AUTH_FAILED",q[q.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(f.ErrorCode||(f.ErrorCode={})),f.utf8Read=function(q,f){const j=q[f++];for(var d="",g=0,h=f,L=f+j;h<L;h++){var Q=q[h];if(0!==(128&Q))if(192!==(224&Q))if(224!==(240&Q)){if(240!==(248&Q))throw new Error("Invalid byte "+Q.toString(16));(g=(7&Q)<<18|(63&q[++h])<<12|(63&q[++h])<<6|63&q[++h])>=65536?(g-=65536,d+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):d+=String.fromCharCode(g)}else d+=String.fromCharCode((15&Q)<<12|(63&q[++h])<<6|63&q[++h]);else d+=String.fromCharCode((31&Q)<<6|63&q[++h]);else d+=String.fromCharCode(Q)}return d},f.utf8Length=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",f=0,j=0;for(let d=0,g=q.length;d<g;d++)f=q.charCodeAt(d),f<128?j+=1:f<2048?j+=2:f<55296||f>=57344?j+=3:(d++,j+=4);return j+1}},11732:function(q,f,j){"use strict";var d=this&&this.__createBinding||(Object.create?function(q,f,j,d){void 0===d&&(d=j);var g=Object.getOwnPropertyDescriptor(f,j);g&&!("get"in g?!f.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return f[j]}}),Object.defineProperty(q,d,g)}:function(q,f,j,d){void 0===d&&(d=j),q[d]=f[j]}),g=this&&this.__setModuleDefault||(Object.create?function(q,f){Object.defineProperty(q,"default",{enumerable:!0,value:f})}:function(q,f){q.default=f}),h=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var f={};if(null!=q)for(var j in q)"default"!==j&&Object.prototype.hasOwnProperty.call(q,j)&&d(f,q,j);return g(f,q),f};Object.defineProperty(f,"__esModule",{value:!0}),f.Room=void 0;const L=h(j(11734)),Q=j(11743),H=j(11760),r=j(11766),u=j(11770),X=j(11777),z=j(11779),B=j(11726);class D{constructor(q,f){this.onStateChange=(0,X.createSignal)(),this.onError=(0,X.createSignal)(),this.onLeave=(0,X.createSignal)(),this.onJoin=(0,X.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,u.createNanoEvents)(),this.roomId=null,this.name=q,f&&(this.serializer=new((0,r.getSerializer)("schema")),this.rootSchema=f,this.serializer.state=new f),this.onError(((q,f)=>{var j;return null===(j=console.warn)||void 0===j?void 0:j.call(console,`colyseus.js - onError => (${q}) ${f}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const d=new Q.Connection;j.connection=d,d.events.onmessage=D.prototype.onMessageCallback.bind(j),d.events.onclose=function(q){var d;if(!j.hasJoined)return null===(d=console.warn)||void 0===d||d.call(console,`Room connection was closed unexpectedly (${q.code}): ${q.reason}`),void j.onError.invoke(q.code,q.reason);q.code===B.CloseCode.DEVMODE_RESTART&&f?f():(j.onLeave.invoke(q.code),j.destroy())},d.events.onerror=function(q){var f;null===(f=console.warn)||void 0===f||f.call(console,`Room, onError (${q.code}): ${q.reason}`),j.onError.invoke(q.code,q.reason)},d.connect(q)}leave(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((f=>{this.onLeave((q=>f(q))),this.connection?q?this.connection.send([H.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(B.CloseCode.CONSENTED)}))}onMessage(q,f){return this.onMessageHandlers.on(this.getMessageHandlerKey(q),f)}send(q,f){const j=[H.Protocol.ROOM_DATA];let d;if("string"===typeof q?z.encode.string(j,q):z.encode.number(j,q),void 0!==f){const q=L.encode(f);d=new Uint8Array(j.length+q.byteLength),d.set(new Uint8Array(j),0),d.set(new Uint8Array(q),j.length)}else d=new Uint8Array(j);this.connection.send(d.buffer)}sendBytes(q,f){const j=[H.Protocol.ROOM_DATA_BYTES];let d;"string"===typeof q?z.encode.string(j,q):z.encode.number(j,q),d=new Uint8Array(j.length+(f.byteLength||f.length)),d.set(new Uint8Array(j),0),d.set(new Uint8Array(f),j.length),this.connection.send(d.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(q){const f=Array.from(new Uint8Array(q.data)),j=f[0];if(j===H.Protocol.JOIN_ROOM){let q=1;const j=(0,H.utf8Read)(f,q);if(q+=(0,H.utf8Length)(j),this.serializerId=(0,H.utf8Read)(f,q),q+=(0,H.utf8Length)(this.serializerId),!this.serializer){const q=(0,r.getSerializer)(this.serializerId);this.serializer=new q}f.length>q&&this.serializer.handshake&&this.serializer.handshake(f,{offset:q}),this.reconnectionToken=`${this.roomId}:${j}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([H.Protocol.JOIN_ROOM])}else if(j===H.Protocol.ERROR){const q={offset:1},j=z.decode.number(f,q),d=z.decode.string(f,q);this.onError.invoke(j,d)}else if(j===H.Protocol.LEAVE_ROOM)this.leave();else if(j===H.Protocol.ROOM_DATA_SCHEMA){const q={offset:1},j=this.serializer.getState().constructor._context.get(z.decode.number(f,q)),d=new j;d.decode(f,q),this.dispatchMessage(j,d)}else if(j===H.Protocol.ROOM_STATE)f.shift(),this.setState(f);else if(j===H.Protocol.ROOM_STATE_PATCH)f.shift(),this.patch(f);else if(j===H.Protocol.ROOM_DATA){const j={offset:1},d=z.decode.stringCheck(f,j)?z.decode.string(f,j):z.decode.number(f,j),g=f.length>j.offset?L.decode(q.data,j.offset):void 0;this.dispatchMessage(d,g)}else if(j===H.Protocol.ROOM_DATA_BYTES){const q={offset:1},j=z.decode.stringCheck(f,q)?z.decode.string(f,q):z.decode.number(f,q);this.dispatchMessage(j,new Uint8Array(f.slice(q.offset)))}}setState(q){this.serializer.setState(q),this.onStateChange.invoke(this.serializer.getState())}patch(q){this.serializer.patch(q),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(q,f){var j;const d=this.getMessageHandlerKey(q);this.onMessageHandlers.events[d]?this.onMessageHandlers.emit(d,f):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",q,f):null===(j=console.warn)||void 0===j||j.call(console,`colyseus.js: onMessage() not registered for type '${q}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(q){switch(typeof q){case"function":return`$${q._typeid}`;case"string":return q;case"number":return`i${q}`;default:throw new Error("invalid message type.")}}}f.Room=D},11791:(q,f)=>{"use strict";let j;function d(){return j||(j="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(q,f){this.cache[q]=f},getItem:function(q){this.cache[q]},removeItem:function(q){delete this.cache[q]}}),j}Object.defineProperty(f,"__esModule",{value:!0}),f.getItem=f.removeItem=f.setItem=void 0,f.setItem=function(q,f){d().setItem(q,f)},f.removeItem=function(q){d().removeItem(q)},f.getItem=function(q,f){const j=d().getItem(q);"undefined"!==typeof Promise&&j instanceof Promise?j.then((q=>f(q))):f(j)}},11770:(q,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.createNanoEvents=void 0;f.createNanoEvents=()=>({emit(q){let f=this.events[q]||[];for(var j=arguments.length,d=new Array(j>1?j-1:0),g=1;g<j;g++)d[g-1]=arguments[g];for(let h=0,L=f.length;h<L;h++)f[h](...d)},events:{},on(q,f){var j;return(null===(j=this.events[q])||void 0===j?void 0:j.push(f))||(this.events[q]=[f]),()=>{var j;this.events[q]=null===(j=this.events[q])||void 0===j?void 0:j.filter((q=>f!==q))}}})},11777:(q,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.createSignal=f.EventEmitter=void 0;class j{constructor(){this.handlers=[]}register(q){return this.handlers.push(q),this}invoke(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];this.handlers.forEach((q=>q.apply(this,f)))}invokeAsync(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];return Promise.all(this.handlers.map((q=>q.apply(this,f))))}remove(q){const f=this.handlers.indexOf(q);this.handlers[f]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}f.EventEmitter=j,f.createSignal=function(){const q=new j;function f(f){return q.register(f,null===this)}return f.once=f=>{const j=function(){for(var d=arguments.length,g=new Array(d),h=0;h<d;h++)g[h]=arguments[h];f.apply(this,g),q.remove(j)};q.register(j)},f.remove=f=>q.remove(f),f.invoke=function(){return q.invoke(...arguments)},f.invokeAsync=function(){return q.invokeAsync(...arguments)},f.clear=()=>q.clear(),f}},11726:(q,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.ServerError=f.CloseCode=void 0,function(q){q[q.CONSENTED=4e3]="CONSENTED",q[q.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(f.CloseCode||(f.CloseCode={}));class j extends Error{constructor(q,f){super(f),this.name="ServerError",this.code=q}}f.ServerError=j},11710:(q,f,j)=>{"use strict";f.e=void 0,j(11717);var d=j(11719);Object.defineProperty(f,"e",{enumerable:!0,get:function(){return d.Client}});var g=j(11760);var h=j(11732);var L=j(11783);const Q=j(11797);const H=j(11802),r=j(11766);(0,r.registerSerializer)("schema",Q.SchemaSerializer),(0,r.registerSerializer)("none",H.NoneSerializer)},11717:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=q=>null!==q&&"object"===typeof q&&q.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11734:(q,f)=>{"use strict";function j(q,f){if(this._offset=f,q instanceof ArrayBuffer)this._buffer=q,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(q))throw new Error("Invalid argument");this._buffer=q.buffer,this._view=new DataView(this._buffer,q.byteOffset,q.byteLength)}}Object.defineProperty(f,"__esModule",{value:!0}),f.decode=f.encode=void 0,j.prototype._array=function(q){for(var f=new Array(q),j=0;j<q;j++)f[j]=this._parse();return f},j.prototype._map=function(q){for(var f={},j=0;j<q;j++)f[this._parse()]=this._parse();return f},j.prototype._str=function(q){var f=function(q,f,j){for(var d="",g=0,h=f,L=f+j;h<L;h++){var Q=q.getUint8(h);if(0!==(128&Q))if(192!==(224&Q))if(224!==(240&Q)){if(240!==(248&Q))throw new Error("Invalid byte "+Q.toString(16));(g=(7&Q)<<18|(63&q.getUint8(++h))<<12|(63&q.getUint8(++h))<<6|63&q.getUint8(++h))>=65536?(g-=65536,d+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):d+=String.fromCharCode(g)}else d+=String.fromCharCode((15&Q)<<12|(63&q.getUint8(++h))<<6|63&q.getUint8(++h));else d+=String.fromCharCode((31&Q)<<6|63&q.getUint8(++h));else d+=String.fromCharCode(Q)}return d}(this._view,this._offset,q);return this._offset+=q,f},j.prototype._bin=function(q){var f=this._buffer.slice(this._offset,this._offset+q);return this._offset+=q,f},j.prototype._parse=function(){var q,f=this._view.getUint8(this._offset++),j=0,d=0,g=0,h=0;if(f<192)return f<128?f:f<144?this._map(15&f):f<160?this._array(15&f):this._str(31&f);if(f>223)return-1*(255-f+1);switch(f){case 192:return null;case 194:return!1;case 195:return!0;case 196:return j=this._view.getUint8(this._offset),this._offset+=1,this._bin(j);case 197:return j=this._view.getUint16(this._offset),this._offset+=2,this._bin(j);case 198:return j=this._view.getUint32(this._offset),this._offset+=4,this._bin(j);case 199:if(j=this._view.getUint8(this._offset),d=this._view.getInt8(this._offset+1),this._offset+=2,-1===d){var L=this._view.getUint32(this._offset);return g=this._view.getInt32(this._offset+4),h=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*g+h)+L/1e6)}return[d,this._bin(j)];case 200:return j=this._view.getUint16(this._offset),d=this._view.getInt8(this._offset+2),this._offset+=3,[d,this._bin(j)];case 201:return j=this._view.getUint32(this._offset),d=this._view.getInt8(this._offset+4),this._offset+=5,[d,this._bin(j)];case 202:return q=this._view.getFloat32(this._offset),this._offset+=4,q;case 203:return q=this._view.getFloat64(this._offset),this._offset+=8,q;case 204:return q=this._view.getUint8(this._offset),this._offset+=1,q;case 205:return q=this._view.getUint16(this._offset),this._offset+=2,q;case 206:return q=this._view.getUint32(this._offset),this._offset+=4,q;case 207:return g=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,g+h;case 208:return q=this._view.getInt8(this._offset),this._offset+=1,q;case 209:return q=this._view.getInt16(this._offset),this._offset+=2,q;case 210:return q=this._view.getInt32(this._offset),this._offset+=4,q;case 211:return g=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,g+h;case 212:return d=this._view.getInt8(this._offset),this._offset+=1,0===d?void(this._offset+=1):[d,this._bin(1)];case 213:return d=this._view.getInt8(this._offset),this._offset+=1,[d,this._bin(2)];case 214:return d=this._view.getInt8(this._offset),this._offset+=1,-1===d?(q=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*q)):[d,this._bin(4)];case 215:return d=this._view.getInt8(this._offset),this._offset+=1,0===d?(g=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(g+h)):-1===d?(g=this._view.getUint32(this._offset),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&g)+h)+(g>>>2)/1e6)):[d,this._bin(8)];case 216:return d=this._view.getInt8(this._offset),this._offset+=1,[d,this._bin(16)];case 217:return j=this._view.getUint8(this._offset),this._offset+=1,this._str(j);case 218:return j=this._view.getUint16(this._offset),this._offset+=2,this._str(j);case 219:return j=this._view.getUint32(this._offset),this._offset+=4,this._str(j);case 220:return j=this._view.getUint16(this._offset),this._offset+=2,this._array(j);case 221:return j=this._view.getUint32(this._offset),this._offset+=4,this._array(j);case 222:return j=this._view.getUint16(this._offset),this._offset+=2,this._map(j);case 223:return j=this._view.getUint32(this._offset),this._offset+=4,this._map(j)}throw new Error("Could not parse")},f.decode=function(q){var f=new j(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),d=f._parse();if(f._offset!==q.byteLength)throw new Error(q.byteLength-f._offset+" trailing bytes");return d};function d(q,f,j){for(var d=0,g=0,h=j.length;g<h;g++)(d=j.charCodeAt(g))<128?q.setUint8(f++,d):d<2048?(q.setUint8(f++,192|d>>6),q.setUint8(f++,128|63&d)):d<55296||d>=57344?(q.setUint8(f++,224|d>>12),q.setUint8(f++,128|d>>6&63),q.setUint8(f++,128|63&d)):(g++,d=65536+((1023&d)<<10|1023&j.charCodeAt(g)),q.setUint8(f++,240|d>>18),q.setUint8(f++,128|d>>12&63),q.setUint8(f++,128|d>>6&63),q.setUint8(f++,128|63&d))}function g(q,f,j){var d=typeof j,h=0,L=0,Q=0,H=0,r=0,u=0;if("string"===d){if(r=function(q){for(var f=0,j=0,d=0,g=q.length;d<g;d++)(f=q.charCodeAt(d))<128?j+=1:f<2048?j+=2:f<55296||f>=57344?j+=3:(d++,j+=4);return j}(j),r<32)q.push(160|r),u=1;else if(r<256)q.push(217,r),u=2;else if(r<65536)q.push(218,r>>8,r),u=3;else{if(!(r<4294967296))throw new Error("String too long");q.push(219,r>>24,r>>16,r>>8,r),u=5}return f.push({_str:j,_length:r,_offset:q.length}),u+r}if("number"===d)return Math.floor(j)===j&&isFinite(j)?j>=0?j<128?(q.push(j),1):j<256?(q.push(204,j),2):j<65536?(q.push(205,j>>8,j),3):j<4294967296?(q.push(206,j>>24,j>>16,j>>8,j),5):(Q=j/Math.pow(2,32)|0,H=j>>>0,q.push(207,Q>>24,Q>>16,Q>>8,Q,H>>24,H>>16,H>>8,H),9):j>=-32?(q.push(j),1):j>=-128?(q.push(208,j),2):j>=-32768?(q.push(209,j>>8,j),3):j>=-2147483648?(q.push(210,j>>24,j>>16,j>>8,j),5):(Q=Math.floor(j/Math.pow(2,32)),H=j>>>0,q.push(211,Q>>24,Q>>16,Q>>8,Q,H>>24,H>>16,H>>8,H),9):(q.push(203),f.push({_float:j,_length:8,_offset:q.length}),9);if("object"===d){if(null===j)return q.push(192),1;if(Array.isArray(j)){if((r=j.length)<16)q.push(144|r),u=1;else if(r<65536)q.push(220,r>>8,r),u=3;else{if(!(r<4294967296))throw new Error("Array too large");q.push(221,r>>24,r>>16,r>>8,r),u=5}for(h=0;h<r;h++)u+=g(q,f,j[h]);return u}if(j instanceof Date){var X=j.getTime(),z=Math.floor(X/1e3),B=1e6*(X-1e3*z);return z>=0&&B>=0&&z<=17179869183?0===B&&z<=4294967295?(q.push(214,255,z>>24,z>>16,z>>8,z),6):(Q=z/4294967296,H=4294967295&z,q.push(215,255,B>>22,B>>14,B>>6,Q,H>>24,H>>16,H>>8,H),10):(Q=Math.floor(z/4294967296),H=z>>>0,q.push(199,12,255,B>>24,B>>16,B>>8,B,Q>>24,Q>>16,Q>>8,Q,H>>24,H>>16,H>>8,H),15)}if(j instanceof ArrayBuffer){if((r=j.byteLength)<256)q.push(196,r),u=2;else if(r<65536)q.push(197,r>>8,r),u=3;else{if(!(r<4294967296))throw new Error("Buffer too large");q.push(198,r>>24,r>>16,r>>8,r),u=5}return f.push({_bin:j,_length:r,_offset:q.length}),u+r}if("function"===typeof j.toJSON)return g(q,f,j.toJSON());var D=[],i="",t=Object.keys(j);for(h=0,L=t.length;h<L;h++)void 0!==j[i=t[h]]&&"function"!==typeof j[i]&&D.push(i);if((r=D.length)<16)q.push(128|r),u=1;else if(r<65536)q.push(222,r>>8,r),u=3;else{if(!(r<4294967296))throw new Error("Object too large");q.push(223,r>>24,r>>16,r>>8,r),u=5}for(h=0;h<r;h++)u+=g(q,f,i=D[h]),u+=g(q,f,j[i]);return u}if("boolean"===d)return q.push(j?195:194),1;if("undefined"===d)return q.push(192),1;if("function"===typeof j.toJSON)return g(q,f,j.toJSON());throw new Error("Could not encode")}f.encode=function(q){var f=[],j=[],h=g(f,j,q),L=new ArrayBuffer(h),Q=new DataView(L),H=0,r=0,u=-1;j.length>0&&(u=j[0]._offset);for(var X,z=0,B=0,D=0,i=f.length;D<i;D++)if(Q.setUint8(r+D,f[D]),D+1===u){if(z=(X=j[H])._length,B=r+u,X._bin)for(var t=new Uint8Array(X._bin),O=0;O<z;O++)Q.setUint8(B+O,t[O]);else X._str?d(Q,B,X._str):void 0!==X._float&&Q.setFloat64(B,X._float);r+=z,j[++H]&&(u=j[H]._offset)}return L}},11802:(q,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.NoneSerializer=void 0;f.NoneSerializer=class{setState(q){}getState(){return null}patch(q){}teardown(){}handshake(q){}}},11797:(q,f,j)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.SchemaSerializer=void 0;const d=j(11779);f.SchemaSerializer=class{setState(q){return this.state.decode(q)}getState(){return this.state}patch(q){return this.state.decode(q)}teardown(){var q,f;null===(f=null===(q=this.state)||void 0===q?void 0:q.$changes)||void 0===f||f.root.clearRefs()}handshake(q,f){if(this.state){(new d.Reflection).decode(q,f)}else this.state=d.Reflection.decode(q,f)}}},11766:(q,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.getSerializer=f.registerSerializer=void 0;const j={};f.registerSerializer=function(q,f){j[q]=f},f.getSerializer=function(q){const f=j[q];if(!f)throw new Error("missing serializer: "+q);return f}},11749:function(q,f,j){"use strict";var d=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(f,"__esModule",{value:!0}),f.WebSocketTransport=void 0;const g=d(j(11752)),h=globalThis.WebSocket||g.default;f.WebSocketTransport=class{constructor(q){this.events=q}send(q){q instanceof ArrayBuffer?this.ws.send(q):Array.isArray(q)&&this.ws.send(new Uint8Array(q).buffer)}connect(q){this.ws=new h(q,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(q,f){this.ws.close(q,f)}get isOpen(){return this.ws.readyState===h.OPEN}}},11752:q=>{"use strict";q.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12131:q=>{"use strict";q.exports=function(q){for(var f=new Array(q),j=0;j<q;++j)f[j]=j;return f}},12134:q=>{function f(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(f(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&f(q.slice(0,0))}(q)||!!q._isBuffer)}},12128:(q,f,j)=>{var d=j(12131),g=j(12134),h="undefined"!==typeof Float64Array;function L(q,f){return q[0]-f[0]}function Q(){var q,f=this.stride,j=new Array(f.length);for(q=0;q<j.length;++q)j[q]=[Math.abs(f[q]),q];j.sort(L);var d=new Array(j.length);for(q=0;q<d.length;++q)d[q]=j[q][1];return d}function H(q,f){var j=["View",f,"d",q].join("");f<0&&(j="View_Nil"+q);var g="generic"===q;if(-1===f){var h="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(h)()}if(0===f){h="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",h)(r[q][0])}h=["'use strict'"];var L=d(f),H=L.map((function(q){return"i"+q})),u="this.offset+"+L.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),X=L.map((function(q){return"b"+q})).join(","),z=L.map((function(q){return"c"+q})).join(",");h.push("function "+j+"(a,"+X+","+z+",d){this.data=a","this.shape=["+X+"]","this.stride=["+z+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+q+"'","proto.dimension="+f),h.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+L.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===f?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),f<4?(h.push("function "+j+"_order(){"),2===f?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===f&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+j+"_set("+H.join(",")+",v){"),g?h.push("return this.data.set("+u+",v)}"):h.push("return this.data["+u+"]=v}"),h.push("proto.get=function "+j+"_get("+H.join(",")+"){"),g?h.push("return this.data.get("+u+")}"):h.push("return this.data["+u+"]}"),h.push("proto.index=function "+j+"_index(",H.join(),"){return "+u+"}"),h.push("proto.hi=function "+j+"_hi("+H.join(",")+"){return new "+j+"(this.data,"+L.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+L.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var B=L.map((function(q){return"a"+q+"=this.shape["+q+"]"})),D=L.map((function(q){return"c"+q+"=this.stride["+q+"]"}));h.push("proto.lo=function "+j+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+B.join(",")+","+D.join(","));for(var i=0;i<f;++i)h.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");h.push("return new "+j+"(this.data,"+L.map((function(q){return"a"+q})).join(",")+","+L.map((function(q){return"c"+q})).join(",")+",b)}"),h.push("proto.step=function "+j+"_step("+H.join(",")+"){var "+L.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+L.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(i=0;i<f;++i)h.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");h.push("return new "+j+"(this.data,"+L.map((function(q){return"a"+q})).join(",")+","+L.map((function(q){return"b"+q})).join(",")+",c)}");var t=new Array(f),O=new Array(f);for(i=0;i<f;++i)t[i]="a[i"+i+"]",O[i]="b[i"+i+"]";h.push("proto.transpose=function "+j+"_transpose("+H+"){"+H.map((function(q,f){return q+"=("+q+"===undefined?"+f+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+t.join(",")+","+O.join(",")+",this.offset)}"),h.push("proto.pick=function "+j+"_pick("+H+"){var a=[],b=[],c=this.offset");for(i=0;i<f;++i)h.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+L.map((function(q){return"shape["+q+"]"})).join(",")+","+L.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(r[q],Q)}var r={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,f,j,d){if(void 0===q)return(0,r.array[0])([]);"number"===typeof q&&(q=[q]),void 0===f&&(f=[q.length]);var L=f.length;if(void 0===j){j=new Array(L);for(var Q=L-1,u=1;Q>=0;--Q)j[Q]=u,u*=f[Q]}if(void 0===d){d=0;for(Q=0;Q<L;++Q)j[Q]<0&&(d-=(f[Q]-1)*j[Q])}for(var X=function(q){if(g(q))return"buffer";if(h)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),z=r[X];z.length<=L+1;)z.push(H(X,z.length-1));return(0,z[L+1])(q,f,j,d)}},13062:q=>{var f;self,f=()=>(()=>{"use strict";var q={d:(f,j)=>{for(var d in j)q.o(j,d)&&!q.o(f,d)&&Object.defineProperty(f,d,{enumerable:!0,get:j[d]})},o:(q,f)=>Object.prototype.hasOwnProperty.call(q,f)},f={};q.d(f,{default:()=>F});var j,d=function(q,f){var j=f.x-q.x,d=f.y-q.y;return Math.sqrt(j*j+d*d)},g=function(q){return q*(Math.PI/180)},h=new Map,L=function(q){h.has(q)&&clearTimeout(h.get(q)),h.set(q,setTimeout(q,100))},Q=function(q,f,j){for(var d,g=f.split(/[ ,]+/g),h=0;h<g.length;h+=1)d=g[h],q.addEventListener?q.addEventListener(d,j,!1):q.attachEvent&&q.attachEvent(d,j)},H=function(q,f,j){for(var d,g=f.split(/[ ,]+/g),h=0;h<g.length;h+=1)d=g[h],q.removeEventListener?q.removeEventListener(d,j):q.detachEvent&&q.detachEvent(d,j)},r=function(q){return q.preventDefault(),q.type.match(/^touch/)?q.changedTouches:q},u=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},X=function(q,f){f.top||f.right||f.bottom||f.left?(q.style.top=f.top,q.style.right=f.right,q.style.bottom=f.bottom,q.style.left=f.left):(q.style.left=f.x+"px",q.style.top=f.y+"px")},z=function(q,f,j){var d=B(q);for(var g in d)if(d.hasOwnProperty(g))if("string"==typeof f)d[g]=f+" "+j;else{for(var h="",L=0,Q=f.length;L<Q;L+=1)h+=f[L]+" "+j+", ";d[g]=h.slice(0,-2)}return d},B=function(q){var f={};return f[q]="",["webkit","Moz","o"].forEach((function(j){f[j+q.charAt(0).toUpperCase()+q.slice(1)]=""})),f},D=function(q,f){for(var j in f)f.hasOwnProperty(j)&&(q[j]=f[j]);return q},i=function(q,f){if(q.length)for(var j=0,d=q.length;j<d;j+=1)f(q[j]);else f(q)},t="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,O=window.matchMedia("(any-hover: none)").matches,N=!!("ontouchstart"in window),w=!!window.PointerEvent,E=!!window.MSPointerEvent,s={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},S={start:"mousedown",move:"mousemove",end:"mouseup"},e={};function Z(){}t&&!O?j=s:w?j={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?j={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:N?(j=s,e=S):j=S,Z.prototype.on=function(q,f){var j,d=this,g=q.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var h=0;h<g.length;h+=1)j=g[h],d._handlers_[j]=d._handlers_[j]||[],d._handlers_[j].push(f);return d},Z.prototype.off=function(q,f){var j=this;return j._handlers_=j._handlers_||{},void 0===q?j._handlers_={}:void 0===f?j._handlers_[q]=null:j._handlers_[q]&&j._handlers_[q].indexOf(f)>=0&&j._handlers_[q].splice(j._handlers_[q].indexOf(f),1),j},Z.prototype.trigger=function(q,f){var j,d=this,g=q.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var h=0;h<g.length;h+=1)j=g[h],d._handlers_[j]&&d._handlers_[j].length&&d._handlers_[j].forEach((function(q){q.call(d,{type:j,target:d},f)}))},Z.prototype.config=function(q){var f=this;f.options=f.defaults||{},q&&(f.options=function(q,f){var j={};for(var d in q)q.hasOwnProperty(d)&&f.hasOwnProperty(d)?j[d]=f[d]:q.hasOwnProperty(d)&&(j[d]=q[d]);return j}(f.options,q))},Z.prototype.bindEvt=function(q,f){var d=this;return d._domHandlers_=d._domHandlers_||{},d._domHandlers_[f]=function(){"function"==typeof d["on"+f]?d["on"+f].apply(d,arguments):console.warn('[WARNING] : Missing "on'+f+'" handler.')},Q(q,j[f],d._domHandlers_[f]),e[f]&&Q(q,e[f],d._domHandlers_[f]),d},Z.prototype.unbindEvt=function(q,f){var d=this;return d._domHandlers_=d._domHandlers_||{},H(q,j[f],d._domHandlers_[f]),e[f]&&H(q,e[f],d._domHandlers_[f]),delete d._domHandlers_[f],this};const I=Z;function T(q,f){return this.identifier=f.identifier,this.position=f.position,this.frontPosition=f.frontPosition,this.collection=q,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(f),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=T.id,T.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}T.prototype=new I,T.constructor=T,T.id=0,T.prototype.buildEl=function(q){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},T.prototype.stylize=function(){if(this.options.dataOnly)return this;var q=this.options.fadeTime+"ms",f=function(){var q=B("borderRadius");for(var f in q)q.hasOwnProperty(f)&&(q[f]="50%");return q}(),j=z("transition","opacity",q),d={};return d.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},d.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},d.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},D(d.el,j),"circle"===this.options.shape&&D(d.back,f),D(d.front,f),this.applyStyles(d),this},T.prototype.applyStyles=function(q){for(var f in this.ui)if(this.ui.hasOwnProperty(f))for(var j in q[f])this.ui[f].style[j]=q[f][j];return this},T.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},T.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},T.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},T.prototype.show=function(q){var f=this;return f.options.dataOnly||(clearTimeout(f.removeTimeout),clearTimeout(f.showTimeout),clearTimeout(f.restTimeout),f.addToDom(),f.restCallback(),setTimeout((function(){f.ui.el.style.opacity=1}),0),f.showTimeout=setTimeout((function(){f.trigger("shown",f.instance),"function"==typeof q&&q.call(this)}),f.options.fadeTime)),f},T.prototype.hide=function(q){var f=this;if(f.options.dataOnly)return f;if(f.ui.el.style.opacity=f.options.restOpacity,clearTimeout(f.removeTimeout),clearTimeout(f.showTimeout),clearTimeout(f.restTimeout),f.removeTimeout=setTimeout((function(){var j="dynamic"===f.options.mode?"none":"block";f.ui.el.style.display=j,"function"==typeof q&&q.call(f),f.trigger("hidden",f.instance)}),f.options.fadeTime),f.options.restJoystick){var j=f.options.restJoystick,d={};d.x=!0===j||!1!==j.x?0:f.instance.frontPosition.x,d.y=!0===j||!1!==j.y?0:f.instance.frontPosition.y,f.setPosition(q,d)}return f},T.prototype.setPosition=function(q,f){var j=this;j.frontPosition={x:f.x,y:f.y};var d=j.options.fadeTime+"ms",g={};g.front=z("transition",["transform"],d);var h={front:{}};h.front={transform:"translate("+j.frontPosition.x+"px,"+j.frontPosition.y+"px)"},j.applyStyles(g),j.applyStyles(h),j.restTimeout=setTimeout((function(){"function"==typeof q&&q.call(j),j.restCallback()}),j.options.fadeTime)},T.prototype.restCallback=function(){var q=this,f={};f.front=z("transition","none",""),q.applyStyles(f),q.trigger("rested",q.instance)},T.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},T.prototype.computeDirection=function(q){var f,j,d,g=q.angle.radian,h=Math.PI/4,L=Math.PI/2;if(g>h&&g<3*h&&!q.lockX?f="up":g>-h&&g<=h&&!q.lockY?f="left":g>3*-h&&g<=-h&&!q.lockX?f="down":q.lockY||(f="right"),q.lockY||(j=g>-L&&g<L?"left":"right"),q.lockX||(d=g>0?"up":"down"),q.force>this.options.threshold){var Q,H={};for(Q in this.direction)this.direction.hasOwnProperty(Q)&&(H[Q]=this.direction[Q]);var r={};for(Q in this.direction={x:j,y:d,angle:f},q.direction=this.direction,H)H[Q]===this.direction[Q]&&(r[Q]=!0);if(r.x&&r.y&&r.angle)return q;r.x&&r.y||this.trigger("plain",q),r.x||this.trigger("plain:"+j,q),r.y||this.trigger("plain:"+d,q),r.angle||this.trigger("dir dir:"+f,q)}else this.resetDirection();return q};const W=T;function n(q,f){var j=this;j.nipples=[],j.idles=[],j.actives=[],j.ids=[],j.pressureIntervals={},j.manager=q,j.id=n.id,n.id+=1,j.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},j.config(f),"static"!==j.options.mode&&"semi"!==j.options.mode||(j.options.multitouch=!1),j.options.multitouch||(j.options.maxNumberOfNipples=1);var d=getComputedStyle(j.options.zone.parentElement);return d&&"flex"===d.display&&(j.parentIsFlex=!0),j.updateBox(),j.prepareNipples(),j.vz(),j.begin(),j.nipples}n.prototype=new I,n.constructor=n,n.id=0,n.prototype.prepareNipples=function(){var q=this,f=q.nipples;f.on=q.on.bind(q),f.off=q.off.bind(q),f.options=q.options,f.destroy=q.destroy.bind(q),f.ids=q.ids,f.id=q.id,f.processOnMove=q.processOnMove.bind(q),f.processOnEnd=q.processOnEnd.bind(q),f.get=function(q){if(void 0===q)return f[0];for(var j=0,d=f.length;j<d;j+=1)if(f[j].identifier===q)return f[j];return!1}},n.prototype.vz=function(){var q=this;q.bindEvt(q.options.zone,"start"),q.options.zone.style.touchAction="none",q.options.zone.style.msTouchAction="none"},n.prototype.begin=function(){var q=this,f=q.options;if("static"===f.mode){var j=q.createNipple(f.position,q.manager.getIdentifier());j.add(),q.idles.push(j)}},n.prototype.createNipple=function(q,f){var j=this,d=j.manager.scroll,g={},h=j.options,L=j.parentIsFlex?d.x:d.x+j.box.left,Q=j.parentIsFlex?d.y:d.y+j.box.top;if(q.x&&q.y)g={x:q.x-L,y:q.y-Q};else if(q.top||q.right||q.bottom||q.left){var H=document.createElement("DIV");H.style.display="hidden",H.style.top=q.top,H.style.right=q.right,H.style.bottom=q.bottom,H.style.left=q.left,H.style.position="absolute",h.zone.appendChild(H);var r=H.getBoundingClientRect();h.zone.removeChild(H),g=q,q={x:r.left+d.x,y:r.top+d.y}}var u=new W(j,{color:h.color,size:h.size,threshold:h.threshold,fadeTime:h.fadeTime,dataOnly:h.dataOnly,restJoystick:h.restJoystick,restOpacity:h.restOpacity,mode:h.mode,identifier:f,position:q,zone:h.zone,frontPosition:{x:0,y:0},shape:h.shape});return h.dataOnly||(X(u.ui.el,g),X(u.ui.front,u.frontPosition)),j.nipples.push(u),j.trigger("added "+u.identifier+":added",u),j.manager.trigger("added "+u.identifier+":added",u),j.bindNipple(u),u},n.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},n.prototype.bindNipple=function(q){var f,j=this,d=function(q,d){f=q.type+" "+d.id+":"+q.type,j.trigger(f,d)};q.on("destroyed",j.onDestroyed.bind(j)),q.on("shown hidden rested dir plain",d),q.on("dir:up dir:right dir:down dir:left",d),q.on("plain:up plain:right plain:down plain:left",d)},n.prototype.pressureFn=function(q,f,j){var d=this,g=0;clearInterval(d.pressureIntervals[j]),d.pressureIntervals[j]=setInterval(function(){var j=q.force||q.pressure||q.webkitForce||0;j!==g&&(f.trigger("pressure",j),d.trigger("pressure "+f.identifier+":pressure",j),g=j)}.bind(d),100)},n.prototype.onstart=function(q){var f=this,j=f.options,d=q;return q=r(q),f.updateBox(),i(q,(function(g){f.actives.length<j.maxNumberOfNipples?f.processOnStart(g):d.type.match(/^touch/)&&(Object.keys(f.manager.ids).forEach((function(j){if(Object.values(d.touches).findIndex((function(q){return q.identifier===j}))<0){var g=[q[0]];g.identifier=j,f.processOnEnd(g)}})),f.actives.length<j.maxNumberOfNipples&&f.processOnStart(g))})),f.manager.bindDocument(),!1},n.prototype.processOnStart=function(q){var f,j=this,g=j.options,h=j.manager.getIdentifier(q),L=q.force||q.pressure||q.webkitForce||0,Q={x:q.pageX,y:q.pageY},H=j.getOrCreate(h,Q);H.identifier!==h&&j.manager.removeIdentifier(H.identifier),H.identifier=h;var r=function(f){f.trigger("start",f),j.trigger("start "+f.id+":start",f),f.show(),L>0&&j.pressureFn(q,f,f.identifier),j.processOnMove(q)};if((f=j.idles.indexOf(H))>=0&&j.idles.splice(f,1),j.actives.push(H),j.ids.push(H.identifier),"semi"!==g.mode)r(H);else{if(!(d(Q,H.position)<=g.catchDistance))return H.destroy(),void j.processOnStart(q);r(H)}return H},n.prototype.getOrCreate=function(q,f){var j,d=this,g=d.options;return/(semi|static)/.test(g.mode)?(j=d.idles[0])?(d.idles.splice(0,1),j):"semi"===g.mode?d.createNipple(f,q):(console.warn("Coudln't find the needed nipple."),!1):j=d.createNipple(f,q)},n.prototype.processOnMove=function(q){var f=this,j=f.options,h=f.manager.getIdentifier(q),L=f.nipples.get(h),Q=f.manager.scroll;if(function(q){return isNaN(q.buttons)?0!==q.pressure:0!==q.buttons}(q)){if(!L)return console.error("Found zombie joystick with ID "+h),void f.manager.removeIdentifier(h);if(j.dynamicPage){var H=L.el.getBoundingClientRect();L.position={x:Q.x+H.left,y:Q.y+H.top}}L.identifier=h;var r=L.options.size/2,u={x:q.pageX,y:q.pageY};j.lockX&&(u.y=L.position.y),j.lockY&&(u.x=L.position.x);var X,z,B,D,i,t,O,N,w,E,s=d(u,L.position),S=(X=u,B=(z=L.position).x-X.x,D=z.y-X.y,function(q){return q*(180/Math.PI)}(Math.atan2(D,B))),e=g(S),Z=s/r,I={distance:s,position:u};if("circle"===L.options.shape?(i=Math.min(s,r),O=L.position,N=i,E={x:0,y:0},w=g(w=S),E.x=O.x-N*Math.cos(w),E.y=O.y-N*Math.sin(w),t=E):(t=function(q,f,j){return{x:Math.min(Math.max(q.x,f.x-j),f.x+j),y:Math.min(Math.max(q.y,f.y-j),f.y+j)}}(u,L.position,r),i=d(t,L.position)),j.follow){if(s>r){var T=u.x-t.x,W=u.y-t.y;L.position.x+=T,L.position.y+=W,L.el.style.top=L.position.y-(f.box.top+Q.y)+"px",L.el.style.left=L.position.x-(f.box.left+Q.x)+"px",s=d(u,L.position)}}else u=t,s=i;var n=u.x-L.position.x,U=u.y-L.position.y;L.frontPosition={x:n,y:U},j.dataOnly||(L.ui.front.style.transform="translate("+n+"px,"+U+"px)");var Y={identifier:L.identifier,position:u,force:Z,pressure:q.force||q.pressure||q.webkitForce||0,distance:s,angle:{radian:e,degree:S},vector:{x:n/r,y:-U/r},raw:I,instance:L,lockX:j.lockX,lockY:j.lockY};(Y=L.computeDirection(Y)).angle={radian:g(180-S),degree:180-S},L.trigger("move",Y),f.trigger("move "+L.id+":move",Y)}else this.processOnEnd(q)},n.prototype.processOnEnd=function(q){var f=this,j=f.options,d=f.manager.getIdentifier(q),g=f.nipples.get(d),h=f.manager.removeIdentifier(g.identifier);g&&(j.dataOnly||g.hide((function(){"dynamic"===j.mode&&(g.trigger("removed",g),f.trigger("removed "+g.id+":removed",g),f.manager.trigger("removed "+g.id+":removed",g),g.destroy())})),clearInterval(f.pressureIntervals[g.identifier]),g.resetDirection(),g.trigger("end",g),f.trigger("end "+g.id+":end",g),f.ids.indexOf(g.identifier)>=0&&f.ids.splice(f.ids.indexOf(g.identifier),1),f.actives.indexOf(g)>=0&&f.actives.splice(f.actives.indexOf(g),1),/(semi|static)/.test(j.mode)?f.idles.push(g):f.nipples.indexOf(g)>=0&&f.nipples.splice(f.nipples.indexOf(g),1),f.manager.unbindDocument(),/(semi|static)/.test(j.mode)&&(f.manager.ids[h.id]=h.identifier))},n.prototype.onDestroyed=function(q,f){var j=this;j.nipples.indexOf(f)>=0&&j.nipples.splice(j.nipples.indexOf(f),1),j.actives.indexOf(f)>=0&&j.actives.splice(j.actives.indexOf(f),1),j.idles.indexOf(f)>=0&&j.idles.splice(j.idles.indexOf(f),1),j.ids.indexOf(f.identifier)>=0&&j.ids.splice(j.ids.indexOf(f.identifier),1),j.manager.removeIdentifier(f.identifier),j.manager.unbindDocument()},n.prototype.destroy=function(){var q=this;for(var f in q.unbindEvt(q.options.zone,"start"),q.nipples.forEach((function(q){q.destroy()})),q.pressureIntervals)q.pressureIntervals.hasOwnProperty(f)&&clearInterval(q.pressureIntervals[f]);q.trigger("destroyed",q.nipples),q.manager.unbindDocument(),q.off()};const U=n;function Y(q){var f=this;f.ids={},f.index=0,f.collections=[],f.scroll=u(),f.config(q),f.prepareCollections();var j=function(){var q;f.collections.forEach((function(j){j.forEach((function(j){q=j.el.getBoundingClientRect(),j.position={x:f.scroll.x+q.left,y:f.scroll.y+q.top}}))}))};Q(window,"resize",(function(){L(j)}));var d=function(){f.scroll=u()};return Q(window,"scroll",(function(){L(d)})),f.collections}Y.prototype=new I,Y.constructor=Y,Y.prototype.prepareCollections=function(){var q=this;q.collections.create=q.create.bind(q),q.collections.on=q.on.bind(q),q.collections.off=q.off.bind(q),q.collections.destroy=q.destroy.bind(q),q.collections.get=function(f){var j;return q.collections.every((function(q){return!(j=q.get(f))})),j}},Y.prototype.create=function(q){return this.createCollection(q)},Y.prototype.createCollection=function(q){var f=this,j=new U(f,q);return f.bindCollection(j),f.collections.push(j),j},Y.prototype.bindCollection=function(q){var f,j=this,d=function(q,d){f=q.type+" "+d.id+":"+q.type,j.trigger(f,d)};q.on("destroyed",j.onDestroyed.bind(j)),q.on("shown hidden rested dir plain",d),q.on("dir:up dir:right dir:down dir:left",d),q.on("plain:up plain:right plain:down plain:left",d)},Y.prototype.bindDocument=function(){var q=this;q.binded||(q.bindEvt(document,"move").bindEvt(document,"end"),q.binded=!0)},Y.prototype.unbindDocument=function(q){var f=this;Object.keys(f.ids).length&&!0!==q||(f.unbindEvt(document,"move").unbindEvt(document,"end"),f.binded=!1)},Y.prototype.getIdentifier=function(q){var f;return q?void 0===(f=void 0===q.identifier?q.pointerId:q.identifier)&&(f=this.latest||0):f=this.index,void 0===this.ids[f]&&(this.ids[f]=this.index,this.index+=1),this.latest=f,this.ids[f]},Y.prototype.removeIdentifier=function(q){var f={};for(var j in this.ids)if(this.ids[j]===q){f.id=j,f.identifier=this.ids[j],delete this.ids[j];break}return f},Y.prototype.onmove=function(q){return this.onAny("move",q),!1},Y.prototype.onend=function(q){return this.onAny("end",q),!1},Y.prototype.oncancel=function(q){return this.onAny("end",q),!1},Y.prototype.onAny=function(q,f){var j,d=this,g="processOn"+q.charAt(0).toUpperCase()+q.slice(1);f=r(f);var h=function(q,f,j){j.ids.indexOf(f)>=0&&(j[g](q),q._found_=!0)};return i(f,(function(q){j=d.getIdentifier(q),i(d.collections,h.bind(null,q,j)),q._found_||d.removeIdentifier(j)})),!1},Y.prototype.destroy=function(){var q=this;q.unbindDocument(!0),q.ids={},q.index=0,q.collections.forEach((function(q){q.destroy()})),q.off()},Y.prototype.onDestroyed=function(q,f){var j=this;if(j.collections.indexOf(f)<0)return!1;j.collections.splice(j.collections.indexOf(f),1)};var v=new Y;const F={create:function(q){return v.create(q)},factory:v};return f.default})(),q.exports=f()},12150:(q,f,j)=>{"use strict";const{Deflate:d,deflate:g,deflateRaw:h,gzip:L}=j(12153),{Inflate:Q,inflate:H,inflateRaw:r,ungzip:u}=j(12210),X=j(12192);q.exports.Deflate=d,q.exports.deflate=g,q.exports.deflateRaw=h,q.exports.gzip=L,q.exports.Inflate=Q,q.exports.inflate=H,q.exports.inflateRaw=r,q.exports.ungzip=u,q.exports.constants=X},12153:(q,f,j)=>{"use strict";const d=j(12155),g=j(12197),h=j(12202),L=j(12183),Q=j(12208),H=Object.prototype.toString,{Z_NO_FLUSH:r,Z_SYNC_FLUSH:u,Z_FULL_FLUSH:X,Z_FINISH:z,Z_OK:B,Z_STREAM_END:D,Z_DEFAULT_COMPRESSION:i,Z_DEFAULT_STRATEGY:t,Z_DEFLATED:O}=j(12192);function N(q){this.options=g.assign({level:i,method:O,Rq:16384,windowBits:15,memLevel:8,strategy:t},q||{});let f=this.options;f.raw&&f.windowBits>0?f.windowBits=-f.windowBits:f.gzip&&f.windowBits>0&&f.windowBits<16&&(f.windowBits+=16),this.err=0,this.uf="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let j=d.deflateInit2(this.strm,f.level,f.method,f.windowBits,f.memLevel,f.strategy);if(j!==B)throw new Error(L[j]);if(f.header&&d.deflateSetHeader(this.strm,f.header),f.dictionary){let q;if(q="string"===typeof f.dictionary?h.string2buf(f.dictionary):"[object ArrayBuffer]"===H.call(f.dictionary)?new Uint8Array(f.dictionary):f.dictionary,j=d.deflateSetDictionary(this.strm,q),j!==B)throw new Error(L[j]);this._dict_set=!0}}function w(q,f){const j=new N(f);if(j.push(q,!0),j.err)throw j.uf||L[j.err];return j.result}N.prototype.push=function(q,f){const j=this.strm,g=this.options.Rq;let L,Q;if(this.ended)return!1;for(Q=f===~~f?f:!0===f?z:r,"string"===typeof q?j.input=h.string2buf(q):"[object ArrayBuffer]"===H.call(q)?j.input=new Uint8Array(q):j.input=q,j.next_in=0,j.avail_in=j.input.length;;)if(0===j.avail_out&&(j.output=new Uint8Array(g),j.next_out=0,j.avail_out=g),(Q===u||Q===X)&&j.avail_out<=6)this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;else{if(L=d.deflate(j,Q),L===D)return j.next_out>0&&this.onData(j.output.subarray(0,j.next_out)),L=d.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===B;if(0!==j.avail_out){if(Q>0&&j.next_out>0)this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;else if(0===j.avail_in)break}else this.onData(j.output)}return!0},N.prototype.onData=function(q){this.chunks.push(q)},N.prototype.onEnd=function(q){q===B&&(this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.uf=this.strm.uf},q.exports.Deflate=N,q.exports.deflate=w,q.exports.deflateRaw=function(q,f){return(f=f||{}).raw=!0,w(q,f)},q.exports.gzip=function(q,f){return(f=f||{}).gzip=!0,w(q,f)},q.exports.constants=j(12192)},12210:(q,f,j)=>{"use strict";const d=j(12214),g=j(12197),h=j(12202),L=j(12183),Q=j(12208),H=j(12236),r=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:X,Z_OK:z,Z_STREAM_END:B,Z_NEED_DICT:D,Z_STREAM_ERROR:i,Z_DATA_ERROR:t,Z_MEM_ERROR:O}=j(12192);function N(q){this.options=g.assign({Rq:65536,windowBits:15,to:""},q||{});const f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,0===f.windowBits&&(f.windowBits=-15)),!(f.windowBits>=0&&f.windowBits<16)||q&&q.windowBits||(f.windowBits+=32),f.windowBits>15&&f.windowBits<48&&0===(15&f.windowBits)&&(f.windowBits|=15),this.err=0,this.uf="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let j=d.inflateInit2(this.strm,f.windowBits);if(j!==z)throw new Error(L[j]);if(this.header=new H,d.inflateGetHeader(this.strm,this.header),f.dictionary&&("string"===typeof f.dictionary?f.dictionary=h.string2buf(f.dictionary):"[object ArrayBuffer]"===r.call(f.dictionary)&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw&&(j=d.inflateSetDictionary(this.strm,f.dictionary),j!==z)))throw new Error(L[j])}function w(q,f){const j=new N(f);if(j.push(q),j.err)throw j.uf||L[j.err];return j.result}N.prototype.push=function(q,f){const j=this.strm,g=this.options.Rq,L=this.options.dictionary;let Q,H,N;if(this.ended)return!1;for(H=f===~~f?f:!0===f?X:u,"[object ArrayBuffer]"===r.call(q)?j.input=new Uint8Array(q):j.input=q,j.next_in=0,j.avail_in=j.input.length;;){for(0===j.avail_out&&(j.output=new Uint8Array(g),j.next_out=0,j.avail_out=g),Q=d.inflate(j,H),Q===D&&L&&(Q=d.inflateSetDictionary(j,L),Q===z?Q=d.inflate(j,H):Q===t&&(Q=D));j.avail_in>0&&Q===B&&j.state.wrap>0&&0!==q[j.next_in];)d.inflateReset(j),Q=d.inflate(j,H);switch(Q){case i:case t:case D:case O:return this.onEnd(Q),this.ended=!0,!1}if(N=j.avail_out,j.next_out&&(0===j.avail_out||Q===B))if("string"===this.options.to){let q=h.utf8border(j.output,j.next_out),f=j.next_out-q,d=h.buf2string(j.output,q);j.next_out=f,j.avail_out=g-f,f&&j.output.set(j.output.subarray(q,q+f),0),this.onData(d)}else this.onData(j.output.length===j.next_out?j.output:j.output.subarray(0,j.next_out));if(Q!==z||0!==N){if(Q===B)return Q=d.inflateEnd(this.strm),this.onEnd(Q),this.ended=!0,!0;if(0===j.avail_in)break}}return!0},N.prototype.onData=function(q){this.chunks.push(q)},N.prototype.onEnd=function(q){q===z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.uf=this.strm.uf},q.exports.Inflate=N,q.exports.inflate=w,q.exports.inflateRaw=function(q,f){return(f=f||{}).raw=!0,w(q,f)},q.exports.ungzip=w,q.exports.constants=j(12192)},12197:q=>{"use strict";const f=(q,f)=>Object.prototype.hasOwnProperty.call(q,f);q.exports.assign=function(q){const j=Array.prototype.slice.call(arguments,1);for(;j.length;){const d=j.shift();if(d){if("object"!==typeof d)throw new TypeError(d+"must be non-object");for(const j in d)f(d,j)&&(q[j]=d[j])}}return q},q.exports.flattenChunks=q=>{let f=0;for(let d=0,g=q.length;d<g;d++)f+=q[d].length;const j=new Uint8Array(f);for(let d=0,g=0,h=q.length;d<h;d++){let f=q[d];j.set(f,g),g+=f.length}return j}},12202:q=>{"use strict";let f=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(d){f=!1}const j=new Uint8Array(256);for(let g=0;g<256;g++)j[g]=g>=252?6:g>=248?5:g>=240?4:g>=224?3:g>=192?2:1;j[254]=j[254]=1,q.exports.string2buf=q=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(q);let f,j,d,g,h,L=q.length,Q=0;for(g=0;g<L;g++)j=q.charCodeAt(g),55296===(64512&j)&&g+1<L&&(d=q.charCodeAt(g+1),56320===(64512&d)&&(j=65536+(j-55296<<10)+(d-56320),g++)),Q+=j<128?1:j<2048?2:j<65536?3:4;for(f=new Uint8Array(Q),h=0,g=0;h<Q;g++)j=q.charCodeAt(g),55296===(64512&j)&&g+1<L&&(d=q.charCodeAt(g+1),56320===(64512&d)&&(j=65536+(j-55296<<10)+(d-56320),g++)),j<128?f[h++]=j:j<2048?(f[h++]=192|j>>>6,f[h++]=128|63&j):j<65536?(f[h++]=224|j>>>12,f[h++]=128|j>>>6&63,f[h++]=128|63&j):(f[h++]=240|j>>>18,f[h++]=128|j>>>12&63,f[h++]=128|j>>>6&63,f[h++]=128|63&j);return f};q.exports.buf2string=(q,d)=>{const g=d||q.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(q.subarray(0,d));let h,L;const Q=new Array(2*g);for(L=0,h=0;h<g;){let f=q[h++];if(f<128){Q[L++]=f;continue}let d=j[f];if(d>4)Q[L++]=65533,h+=d-1;else{for(f&=2===d?31:3===d?15:7;d>1&&h<g;)f=f<<6|63&q[h++],d--;d>1?Q[L++]=65533:f<65536?Q[L++]=f:(f-=65536,Q[L++]=55296|f>>10&1023,Q[L++]=56320|1023&f)}}return((q,j)=>{if(j<65534&&q.subarray&&f)return String.fromCharCode.apply(null,q.length===j?q:q.subarray(0,j));let d="";for(let f=0;f<j;f++)d+=String.fromCharCode(q[f]);return d})(Q,L)},q.exports.utf8border=(q,f)=>{(f=f||q.length)>q.length&&(f=q.length);let d=f-1;for(;d>=0&&128===(192&q[d]);)d--;return d<0||0===d?f:d+j[q[d]]>f?d:f}},12171:q=>{"use strict";q.exports=(q,f,j,d)=>{let g=65535&q,h=q>>>16&65535,L=0;for(;0!==j;){L=j>2e3?2e3:j,j-=L;do{g=g+f[d++]|0,h=h+g|0}while(--L);g%=65521,h%=65521}return g|h<<16}},12192:q=>{"use strict";q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12180:q=>{"use strict";const f=new Uint32Array((()=>{let q,f=[];for(var j=0;j<256;j++){q=j;for(var d=0;d<8;d++)q=1&q?3988292384^q>>>1:q>>>1;f[j]=q}return f})());q.exports=(q,j,d,g)=>{const h=f,L=g+d;q^=-1;for(let f=g;f<L;f++)q=q>>>8^h[255&(q^j[f])];return~q}},12155:(q,f,j)=>{"use strict";const{_tr_init:d,_tr_stored_block:g,_tr_flush_block:h,_tr_tally:L,_tr_align:Q}=j(12162),H=j(12171),r=j(12180),u=j(12183),{Z_NO_FLUSH:X,Z_PARTIAL_FLUSH:z,Z_FULL_FLUSH:B,Z_FINISH:D,Z_BLOCK:i,Z_OK:t,Z_STREAM_END:O,Z_STREAM_ERROR:N,Z_DATA_ERROR:w,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:s,Z_FILTERED:S,Z_HUFFMAN_ONLY:e,Z_RLE:Z,Z_FIXED:I,Z_DEFAULT_STRATEGY:T,Z_UNKNOWN:W,Z_DEFLATED:n}=j(12192),U=258,Y=262,v=103,F=113,M=666,o=(q,f)=>(q.uf=u[f],f),b=q=>(q<<1)-(q>4?9:0),x=q=>{let f=q.length;for(;--f>=0;)q[f]=0};let R=(q,f,j)=>(f<<q.hash_shift^j)&q.hash_mask;const A=q=>{const f=q.state;let j=f.pending;j>q.avail_out&&(j=q.avail_out),0!==j&&(q.output.set(f.pending_buf.subarray(f.pending_out,f.pending_out+j),q.next_out),q.next_out+=j,f.pending_out+=j,q.total_out+=j,q.avail_out-=j,f.pending-=j,0===f.pending&&(f.pending_out=0))},k=(q,f)=>{h(q,q.block_start>=0?q.block_start:-1,q.strstart-q.block_start,f),q.block_start=q.strstart,A(q.strm)},y=(q,f)=>{q.pending_buf[q.pending++]=f},p=(q,f)=>{q.pending_buf[q.pending++]=f>>>8&255,q.pending_buf[q.pending++]=255&f},l=(q,f,j,d)=>{let g=q.avail_in;return g>d&&(g=d),0===g?0:(q.avail_in-=g,f.set(q.input.subarray(q.next_in,q.next_in+g),j),1===q.state.wrap?q.adler=H(q.adler,f,g,j):2===q.state.wrap&&(q.adler=r(q.adler,f,g,j)),q.next_in+=g,q.total_in+=g,g)},V=(q,f)=>{let j,d,g=q.max_chain_length,h=q.strstart,L=q.prev_length,Q=q.nice_match;const H=q.strstart>q.w_size-Y?q.strstart-(q.w_size-Y):0,r=q.window,u=q.w_mask,X=q.prev,z=q.strstart+U;let B=r[h+L-1],D=r[h+L];q.prev_length>=q.good_match&&(g>>=2),Q>q.lookahead&&(Q=q.lookahead);do{if(j=f,r[j+L]===D&&r[j+L-1]===B&&r[j]===r[h]&&r[++j]===r[h+1]){h+=2,j++;do{}while(r[++h]===r[++j]&&r[++h]===r[++j]&&r[++h]===r[++j]&&r[++h]===r[++j]&&r[++h]===r[++j]&&r[++h]===r[++j]&&r[++h]===r[++j]&&r[++h]===r[++j]&&h<z);if(d=U-(z-h),h=z-U,d>L){if(q.match_start=f,L=d,d>=Q)break;B=r[h+L-1],D=r[h+L]}}}while((f=X[f&u])>H&&0!==--g);return L<=q.lookahead?L:q.lookahead},a=q=>{const f=q.w_size;let j,d,g,h,L;do{if(h=q.window_size-q.lookahead-q.strstart,q.strstart>=f+(f-Y)){q.window.set(q.window.subarray(f,f+f),0),q.match_start-=f,q.strstart-=f,q.block_start-=f,d=q.hash_size,j=d;do{g=q.head[--j],q.head[j]=g>=f?g-f:0}while(--d);d=f,j=d;do{g=q.prev[--j],q.prev[j]=g>=f?g-f:0}while(--d);h+=f}if(0===q.strm.avail_in)break;if(d=l(q.strm,q.window,q.strstart+q.lookahead,h),q.lookahead+=d,q.lookahead+q.insert>=3)for(L=q.strstart-q.insert,q.ins_h=q.window[L],q.ins_h=R(q,q.ins_h,q.window[L+1]);q.insert&&(q.ins_h=R(q,q.ins_h,q.window[L+3-1]),q.prev[L&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=L,L++,q.insert--,!(q.lookahead+q.insert<3)););}while(q.lookahead<Y&&0!==q.strm.avail_in)},P=(q,f)=>{let j,d;for(;;){if(q.lookahead<Y){if(a(q),q.lookahead<Y&&f===X)return 1;if(0===q.lookahead)break}if(j=0,q.lookahead>=3&&(q.ins_h=R(q,q.ins_h,q.window[q.strstart+3-1]),j=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),0!==j&&q.strstart-j<=q.w_size-Y&&(q.match_length=V(q,j)),q.match_length>=3)if(d=L(q,q.strstart-q.match_start,q.match_length-3),q.lookahead-=q.match_length,q.match_length<=q.max_lazy_match&&q.lookahead>=3){q.match_length--;do{q.strstart++,q.ins_h=R(q,q.ins_h,q.window[q.strstart+3-1]),j=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart}while(0!==--q.match_length);q.strstart++}else q.strstart+=q.match_length,q.match_length=0,q.ins_h=q.window[q.strstart],q.ins_h=R(q,q.ins_h,q.window[q.strstart+1]);else d=L(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++;if(d&&(k(q,!1),0===q.strm.avail_out))return 1}return q.insert=q.strstart<2?q.strstart:2,f===D?(k(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(k(q,!1),0===q.strm.avail_out)?1:2},C=(q,f)=>{let j,d,g;for(;;){if(q.lookahead<Y){if(a(q),q.lookahead<Y&&f===X)return 1;if(0===q.lookahead)break}if(j=0,q.lookahead>=3&&(q.ins_h=R(q,q.ins_h,q.window[q.strstart+3-1]),j=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),q.prev_length=q.match_length,q.prev_match=q.match_start,q.match_length=2,0!==j&&q.prev_length<q.max_lazy_match&&q.strstart-j<=q.w_size-Y&&(q.match_length=V(q,j),q.match_length<=5&&(q.strategy===S||3===q.match_length&&q.strstart-q.match_start>4096)&&(q.match_length=2)),q.prev_length>=3&&q.match_length<=q.prev_length){g=q.strstart+q.lookahead-3,d=L(q,q.strstart-1-q.prev_match,q.prev_length-3),q.lookahead-=q.prev_length-1,q.prev_length-=2;do{++q.strstart<=g&&(q.ins_h=R(q,q.ins_h,q.window[q.strstart+3-1]),j=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart)}while(0!==--q.prev_length);if(q.match_available=0,q.match_length=2,q.strstart++,d&&(k(q,!1),0===q.strm.avail_out))return 1}else if(q.match_available){if(d=L(q,0,q.window[q.strstart-1]),d&&k(q,!1),q.strstart++,q.lookahead--,0===q.strm.avail_out)return 1}else q.match_available=1,q.strstart++,q.lookahead--}return q.match_available&&(d=L(q,0,q.window[q.strstart-1]),q.match_available=0),q.insert=q.strstart<2?q.strstart:2,f===D?(k(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(k(q,!1),0===q.strm.avail_out)?1:2};function c(q,f,j,d,g){this.good_length=q,this.max_lazy=f,this.nice_length=j,this.max_chain=d,this.func=g}const G=[new c(0,0,0,0,((q,f)=>{let j=65535;for(j>q.pending_buf_size-5&&(j=q.pending_buf_size-5);;){if(q.lookahead<=1){if(a(q),0===q.lookahead&&f===X)return 1;if(0===q.lookahead)break}q.strstart+=q.lookahead,q.lookahead=0;const d=q.block_start+j;if((0===q.strstart||q.strstart>=d)&&(q.lookahead=q.strstart-d,q.strstart=d,k(q,!1),0===q.strm.avail_out))return 1;if(q.strstart-q.block_start>=q.w_size-Y&&(k(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,f===D?(k(q,!0),0===q.strm.avail_out?3:4):(q.strstart>q.block_start&&(k(q,!1),q.strm.avail_out),1)})),new c(4,4,8,4,P),new c(4,5,16,8,P),new c(4,6,32,32,P),new c(4,4,16,16,C),new c(8,16,32,32,C),new c(8,16,128,128,C),new c(8,32,128,256,C),new c(32,128,258,1024,C),new c(32,258,258,4096,C)];function m(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=n,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const K=q=>{if(!q||!q.state)return o(q,N);q.total_in=q.total_out=0,q.data_type=W;const f=q.state;return f.pending=0,f.pending_out=0,f.wrap<0&&(f.wrap=-f.wrap),f.status=f.wrap?42:F,q.adler=2===f.wrap?0:1,f.last_flush=X,d(f),t},J=q=>{const f=K(q);var j;return f===t&&((j=q.state).window_size=2*j.w_size,x(j.head),j.max_lazy_match=G[j.level].max_lazy,j.good_match=G[j.level].good_length,j.nice_match=G[j.level].nice_length,j.max_chain_length=G[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=2,j.match_available=0,j.ins_h=0),f},qq=(q,f,j,d,g,h)=>{if(!q)return N;let L=1;if(f===s&&(f=6),d<0?(L=0,d=-d):d>15&&(L=2,d-=16),g<1||g>9||j!==n||d<8||d>15||f<0||f>9||h<0||h>I)return o(q,N);8===d&&(d=9);const Q=new m;return q.state=Q,Q.strm=q,Q.wrap=L,Q.gzhead=null,Q.w_bits=d,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=g+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+3-1)/3),Q.window=new Uint8Array(2*Q.w_size),Q.head=new Uint16Array(Q.hash_size),Q.prev=new Uint16Array(Q.w_size),Q.lit_bufsize=1<<g+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new Uint8Array(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=f,Q.strategy=h,Q.method=j,J(q)};q.exports.deflateInit=(q,f)=>qq(q,f,n,15,8,T),q.exports.deflateInit2=qq,q.exports.deflateReset=J,q.exports.deflateResetKeep=K,q.exports.deflateSetHeader=(q,f)=>q&&q.state?2!==q.state.wrap?N:(q.state.gzhead=f,t):N,q.exports.deflate=(q,f)=>{let j,d;if(!q||!q.state||f>i||f<0)return q?o(q,N):N;const h=q.state;if(!q.output||!q.input&&0!==q.avail_in||h.status===M&&f!==D)return o(q,0===q.avail_out?E:N);h.strm=q;const H=h.last_flush;if(h.last_flush=f,42===h.status)if(2===h.wrap)q.adler=0,y(h,31),y(h,139),y(h,8),h.gzhead?(y(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),y(h,255&h.gzhead.time),y(h,h.gzhead.time>>8&255),y(h,h.gzhead.time>>16&255),y(h,h.gzhead.time>>24&255),y(h,9===h.level?2:h.strategy>=e||h.level<2?4:0),y(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(y(h,255&h.gzhead.extra.length),y(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(q.adler=r(q.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=69):(y(h,0),y(h,0),y(h,0),y(h,0),y(h,0),y(h,9===h.level?2:h.strategy>=e||h.level<2?4:0),y(h,3),h.status=F);else{let f=n+(h.w_bits-8<<4)<<8,j=-1;j=h.strategy>=e||h.level<2?0:h.level<6?1:6===h.level?2:3,f|=j<<6,0!==h.strstart&&(f|=32),f+=31-f%31,h.status=F,p(h,f),0!==h.strstart&&(p(h,q.adler>>>16),p(h,65535&q.adler)),q.adler=1}if(69===h.status)if(h.gzhead.extra){for(j=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>j&&(q.adler=r(q.adler,h.pending_buf,h.pending-j,j)),A(q),j=h.pending,h.pending!==h.pending_buf_size));)y(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>j&&(q.adler=r(q.adler,h.pending_buf,h.pending-j,j)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=73)}else h.status=73;if(73===h.status)if(h.gzhead.name){j=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>j&&(q.adler=r(q.adler,h.pending_buf,h.pending-j,j)),A(q),j=h.pending,h.pending===h.pending_buf_size)){d=1;break}d=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,y(h,d)}while(0!==d);h.gzhead.hcrc&&h.pending>j&&(q.adler=r(q.adler,h.pending_buf,h.pending-j,j)),0===d&&(h.gzindex=0,h.status=91)}else h.status=91;if(91===h.status)if(h.gzhead.comment){j=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>j&&(q.adler=r(q.adler,h.pending_buf,h.pending-j,j)),A(q),j=h.pending,h.pending===h.pending_buf_size)){d=1;break}d=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,y(h,d)}while(0!==d);h.gzhead.hcrc&&h.pending>j&&(q.adler=r(q.adler,h.pending_buf,h.pending-j,j)),0===d&&(h.status=v)}else h.status=v;if(h.status===v&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&A(q),h.pending+2<=h.pending_buf_size&&(y(h,255&q.adler),y(h,q.adler>>8&255),q.adler=0,h.status=F)):h.status=F),0!==h.pending){if(A(q),0===q.avail_out)return h.last_flush=-1,t}else if(0===q.avail_in&&b(f)<=b(H)&&f!==D)return o(q,E);if(h.status===M&&0!==q.avail_in)return o(q,E);if(0!==q.avail_in||0!==h.lookahead||f!==X&&h.status!==M){let j=h.strategy===e?((q,f)=>{let j;for(;;){if(0===q.lookahead&&(a(q),0===q.lookahead)){if(f===X)return 1;break}if(q.match_length=0,j=L(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,j&&(k(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,f===D?(k(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(k(q,!1),0===q.strm.avail_out)?1:2})(h,f):h.strategy===Z?((q,f)=>{let j,d,g,h;const Q=q.window;for(;;){if(q.lookahead<=U){if(a(q),q.lookahead<=U&&f===X)return 1;if(0===q.lookahead)break}if(q.match_length=0,q.lookahead>=3&&q.strstart>0&&(g=q.strstart-1,d=Q[g],d===Q[++g]&&d===Q[++g]&&d===Q[++g])){h=q.strstart+U;do{}while(d===Q[++g]&&d===Q[++g]&&d===Q[++g]&&d===Q[++g]&&d===Q[++g]&&d===Q[++g]&&d===Q[++g]&&d===Q[++g]&&g<h);q.match_length=U-(h-g),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=3?(j=L(q,1,q.match_length-3),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(j=L(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),j&&(k(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,f===D?(k(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(k(q,!1),0===q.strm.avail_out)?1:2})(h,f):G[h.level].func(h,f);if(3!==j&&4!==j||(h.status=M),1===j||3===j)return 0===q.avail_out&&(h.last_flush=-1),t;if(2===j&&(f===z?Q(h):f!==i&&(g(h,0,0,!1),f===B&&(x(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),A(q),0===q.avail_out))return h.last_flush=-1,t}return f!==D?t:h.wrap<=0?O:(2===h.wrap?(y(h,255&q.adler),y(h,q.adler>>8&255),y(h,q.adler>>16&255),y(h,q.adler>>24&255),y(h,255&q.total_in),y(h,q.total_in>>8&255),y(h,q.total_in>>16&255),y(h,q.total_in>>24&255)):(p(h,q.adler>>>16),p(h,65535&q.adler)),A(q),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?t:O)},q.exports.deflateEnd=q=>{if(!q||!q.state)return N;const f=q.state.status;return 42!==f&&69!==f&&73!==f&&91!==f&&f!==v&&f!==F&&f!==M?o(q,N):(q.state=null,f===F?o(q,w):t)},q.exports.deflateSetDictionary=(q,f)=>{let j=f.length;if(!q||!q.state)return N;const d=q.state,g=d.wrap;if(2===g||1===g&&42!==d.status||d.lookahead)return N;if(1===g&&(q.adler=H(q.adler,f,j,0)),d.wrap=0,j>=d.w_size){0===g&&(x(d.head),d.strstart=0,d.block_start=0,d.insert=0);let q=new Uint8Array(d.w_size);q.set(f.subarray(j-d.w_size,j),0),f=q,j=d.w_size}const h=q.avail_in,L=q.next_in,Q=q.input;for(q.avail_in=j,q.next_in=0,q.input=f,a(d);d.lookahead>=3;){let q=d.strstart,f=d.lookahead-2;do{d.ins_h=R(d,d.ins_h,d.window[q+3-1]),d.prev[q&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=q,q++}while(--f);d.strstart=q,d.lookahead=2,a(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,q.next_in=L,q.input=Q,q.avail_in=h,d.wrap=g,t},q.exports.deflateInfo="pako deflate (from Nodeca project)"},12236:q=>{"use strict";q.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12221:q=>{"use strict";q.exports=function(q,f){let j,d,g,h,L,Q,H,r,u,X,z,B,D,i,t,O,N,w,E,s,S,e,Z,I;const T=q.state;j=q.next_in,Z=q.input,d=j+(q.avail_in-5),g=q.next_out,I=q.output,h=g-(f-q.avail_out),L=g+(q.avail_out-257),Q=T.dmax,H=T.wsize,r=T.whave,u=T.wnext,X=T.window,z=T.hold,B=T.bits,D=T.lencode,i=T.distcode,t=(1<<T.lenbits)-1,O=(1<<T.distbits)-1;q:do{B<15&&(z+=Z[j++]<<B,B+=8,z+=Z[j++]<<B,B+=8),N=D[z&t];f:for(;;){if(w=N>>>24,z>>>=w,B-=w,w=N>>>16&255,0===w)I[g++]=65535&N;else{if(!(16&w)){if(0===(64&w)){N=D[(65535&N)+(z&(1<<w)-1)];continue f}if(32&w){T.mode=12;break q}q.uf="invalid literal/length code",T.mode=30;break q}E=65535&N,w&=15,w&&(B<w&&(z+=Z[j++]<<B,B+=8),E+=z&(1<<w)-1,z>>>=w,B-=w),B<15&&(z+=Z[j++]<<B,B+=8,z+=Z[j++]<<B,B+=8),N=i[z&O];j:for(;;){if(w=N>>>24,z>>>=w,B-=w,w=N>>>16&255,!(16&w)){if(0===(64&w)){N=i[(65535&N)+(z&(1<<w)-1)];continue j}q.uf="invalid distance code",T.mode=30;break q}if(s=65535&N,w&=15,B<w&&(z+=Z[j++]<<B,B+=8,B<w&&(z+=Z[j++]<<B,B+=8)),s+=z&(1<<w)-1,s>Q){q.uf="invalid distance too far back",T.mode=30;break q}if(z>>>=w,B-=w,w=g-h,s>w){if(w=s-w,w>r&&T.sane){q.uf="invalid distance too far back",T.mode=30;break q}if(S=0,e=X,0===u){if(S+=H-w,w<E){E-=w;do{I[g++]=X[S++]}while(--w);S=g-s,e=I}}else if(u<w){if(S+=H+u-w,w-=u,w<E){E-=w;do{I[g++]=X[S++]}while(--w);if(S=0,u<E){w=u,E-=w;do{I[g++]=X[S++]}while(--w);S=g-s,e=I}}}else if(S+=u-w,w<E){E-=w;do{I[g++]=X[S++]}while(--w);S=g-s,e=I}for(;E>2;)I[g++]=e[S++],I[g++]=e[S++],I[g++]=e[S++],E-=3;E&&(I[g++]=e[S++],E>1&&(I[g++]=e[S++]))}else{S=g-s;do{I[g++]=I[S++],I[g++]=I[S++],I[g++]=I[S++],E-=3}while(E>2);E&&(I[g++]=I[S++],E>1&&(I[g++]=I[S++]))}break}}break}}while(j<d&&g<L);E=B>>3,j-=E,B-=E<<3,z&=(1<<B)-1,q.next_in=j,q.next_out=g,q.avail_in=j<d?d-j+5:5-(j-d),q.avail_out=g<L?L-g+257:257-(g-L),T.hold=z,T.bits=B}},12214:(q,f,j)=>{"use strict";const d=j(12171),g=j(12180),h=j(12221),L=j(12228),{Z_FINISH:Q,Z_BLOCK:H,Z_TREES:r,Z_OK:u,Z_STREAM_END:X,Z_NEED_DICT:z,Z_STREAM_ERROR:B,Z_DATA_ERROR:D,Z_MEM_ERROR:i,Z_BUF_ERROR:t,Z_DEFLATED:O}=j(12192),N=12,w=30,E=q=>(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24);function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const S=q=>{if(!q||!q.state)return B;const f=q.state;return q.total_in=q.total_out=f.total=0,q.uf="",f.wrap&&(q.adler=1&f.wrap),f.mode=1,f.last=0,f.havedict=0,f.dmax=32768,f.head=null,f.hold=0,f.bits=0,f.lencode=f.lendyn=new Int32Array(852),f.distcode=f.distdyn=new Int32Array(592),f.sane=1,f.back=-1,u},e=q=>{if(!q||!q.state)return B;const f=q.state;return f.wsize=0,f.whave=0,f.wnext=0,S(q)},Z=(q,f)=>{let j;if(!q||!q.state)return B;const d=q.state;return f<0?(j=0,f=-f):(j=1+(f>>4),f<48&&(f&=15)),f&&(f<8||f>15)?B:(null!==d.window&&d.wbits!==f&&(d.window=null),d.wrap=j,d.wbits=f,e(q))},I=(q,f)=>{if(!q)return B;const j=new s;q.state=j,j.window=null;const d=Z(q,f);return d!==u&&(q.state=null),d};let T,W,n=!0;const U=q=>{if(n){T=new Int32Array(512),W=new Int32Array(32);let f=0;for(;f<144;)q.lens[f++]=8;for(;f<256;)q.lens[f++]=9;for(;f<280;)q.lens[f++]=7;for(;f<288;)q.lens[f++]=8;for(L(1,q.lens,0,288,T,0,q.work,{bits:9}),f=0;f<32;)q.lens[f++]=5;L(2,q.lens,0,32,W,0,q.work,{bits:5}),n=!1}q.lencode=T,q.lenbits=9,q.distcode=W,q.distbits=5},Y=(q,f,j,d)=>{let g;const h=q.state;return null===h.window&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),d>=h.wsize?(h.window.set(f.subarray(j-h.wsize,j),0),h.wnext=0,h.whave=h.wsize):(g=h.wsize-h.wnext,g>d&&(g=d),h.window.set(f.subarray(j-d,j-d+g),h.wnext),(d-=g)?(h.window.set(f.subarray(j-d,j),0),h.wnext=d,h.whave=h.wsize):(h.wnext+=g,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=g))),0};q.exports.inflateReset=e,q.exports.inflateReset2=Z,q.exports.inflateResetKeep=S,q.exports.inflateInit=q=>I(q,15),q.exports.inflateInit2=I,q.exports.inflate=(q,f)=>{let j,s,S,e,Z,I,T,W,n,v,F,M,o,b,x,R,A,k,y,p,l,V,a=0;const P=new Uint8Array(4);let C,c;const G=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!q||!q.state||!q.output||!q.input&&0!==q.avail_in)return B;j=q.state,j.mode===N&&(j.mode=13),Z=q.next_out,S=q.output,T=q.avail_out,e=q.next_in,s=q.input,I=q.avail_in,W=j.hold,n=j.bits,v=I,F=T,V=u;q:for(;;)switch(j.mode){case 1:if(0===j.wrap){j.mode=13;break}for(;n<16;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(2&j.wrap&&35615===W){j.check=0,P[0]=255&W,P[1]=W>>>8&255,j.check=g(j.check,P,2,0),W=0,n=0,j.mode=2;break}if(j.flags=0,j.head&&(j.head.done=!1),!(1&j.wrap)||(((255&W)<<8)+(W>>8))%31){q.uf="incorrect header check",j.mode=w;break}if((15&W)!==O){q.uf="unknown compression method",j.mode=w;break}if(W>>>=4,n-=4,l=8+(15&W),0===j.wbits)j.wbits=l;else if(l>j.wbits){q.uf="invalid window size",j.mode=w;break}j.dmax=1<<j.wbits,q.adler=j.check=1,j.mode=512&W?10:N,W=0,n=0;break;case 2:for(;n<16;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(j.flags=W,(255&j.flags)!==O){q.uf="unknown compression method",j.mode=w;break}if(57344&j.flags){q.uf="unknown header flags set",j.mode=w;break}j.head&&(j.head.text=W>>8&1),512&j.flags&&(P[0]=255&W,P[1]=W>>>8&255,j.check=g(j.check,P,2,0)),W=0,n=0,j.mode=3;case 3:for(;n<32;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}j.head&&(j.head.time=W),512&j.flags&&(P[0]=255&W,P[1]=W>>>8&255,P[2]=W>>>16&255,P[3]=W>>>24&255,j.check=g(j.check,P,4,0)),W=0,n=0,j.mode=4;case 4:for(;n<16;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}j.head&&(j.head.xflags=255&W,j.head.os=W>>8),512&j.flags&&(P[0]=255&W,P[1]=W>>>8&255,j.check=g(j.check,P,2,0)),W=0,n=0,j.mode=5;case 5:if(1024&j.flags){for(;n<16;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}j.length=W,j.head&&(j.head.extra_len=W),512&j.flags&&(P[0]=255&W,P[1]=W>>>8&255,j.check=g(j.check,P,2,0)),W=0,n=0}else j.head&&(j.head.extra=null);j.mode=6;case 6:if(1024&j.flags&&(M=j.length,M>I&&(M=I),M&&(j.head&&(l=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Uint8Array(j.head.extra_len)),j.head.extra.set(s.subarray(e,e+M),l)),512&j.flags&&(j.check=g(j.check,s,M,e)),I-=M,e+=M,j.length-=M),j.length))break q;j.length=0,j.mode=7;case 7:if(2048&j.flags){if(0===I)break q;M=0;do{l=s[e+M++],j.head&&l&&j.length<65536&&(j.head.name+=String.fromCharCode(l))}while(l&&M<I);if(512&j.flags&&(j.check=g(j.check,s,M,e)),I-=M,e+=M,l)break q}else j.head&&(j.head.name=null);j.length=0,j.mode=8;case 8:if(4096&j.flags){if(0===I)break q;M=0;do{l=s[e+M++],j.head&&l&&j.length<65536&&(j.head.comment+=String.fromCharCode(l))}while(l&&M<I);if(512&j.flags&&(j.check=g(j.check,s,M,e)),I-=M,e+=M,l)break q}else j.head&&(j.head.comment=null);j.mode=9;case 9:if(512&j.flags){for(;n<16;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(W!==(65535&j.check)){q.uf="header crc mismatch",j.mode=w;break}W=0,n=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),q.adler=j.check=0,j.mode=N;break;case 10:for(;n<32;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}q.adler=j.check=E(W),W=0,n=0,j.mode=11;case 11:if(0===j.havedict)return q.next_out=Z,q.avail_out=T,q.next_in=e,q.avail_in=I,j.hold=W,j.bits=n,z;q.adler=j.check=1,j.mode=N;case N:if(f===H||f===r)break q;case 13:if(j.last){W>>>=7&n,n-=7&n,j.mode=27;break}for(;n<3;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}switch(j.last=1&W,W>>>=1,n-=1,3&W){case 0:j.mode=14;break;case 1:if(U(j),j.mode=20,f===r){W>>>=2,n-=2;break q}break;case 2:j.mode=17;break;case 3:q.uf="invalid block type",j.mode=w}W>>>=2,n-=2;break;case 14:for(W>>>=7&n,n-=7&n;n<32;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if((65535&W)!==(W>>>16^65535)){q.uf="invalid stored block lengths",j.mode=w;break}if(j.length=65535&W,W=0,n=0,j.mode=15,f===r)break q;case 15:j.mode=16;case 16:if(M=j.length,M){if(M>I&&(M=I),M>T&&(M=T),0===M)break q;S.set(s.subarray(e,e+M),Z),I-=M,e+=M,T-=M,Z+=M,j.length-=M;break}j.mode=N;break;case 17:for(;n<14;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(j.nlen=257+(31&W),W>>>=5,n-=5,j.ndist=1+(31&W),W>>>=5,n-=5,j.ncode=4+(15&W),W>>>=4,n-=4,j.nlen>286||j.ndist>30){q.uf="too many length or distance symbols",j.mode=w;break}j.have=0,j.mode=18;case 18:for(;j.have<j.ncode;){for(;n<3;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}j.lens[G[j.have++]]=7&W,W>>>=3,n-=3}for(;j.have<19;)j.lens[G[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,C={bits:j.lenbits},V=L(0,j.lens,0,19,j.lencode,0,j.work,C),j.lenbits=C.bits,V){q.uf="invalid code lengths set",j.mode=w;break}j.have=0,j.mode=19;case 19:for(;j.have<j.nlen+j.ndist;){for(;a=j.lencode[W&(1<<j.lenbits)-1],x=a>>>24,R=a>>>16&255,A=65535&a,!(x<=n);){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(A<16)W>>>=x,n-=x,j.lens[j.have++]=A;else{if(16===A){for(c=x+2;n<c;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(W>>>=x,n-=x,0===j.have){q.uf="invalid bit length repeat",j.mode=w;break}l=j.lens[j.have-1],M=3+(3&W),W>>>=2,n-=2}else if(17===A){for(c=x+3;n<c;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}W>>>=x,n-=x,l=0,M=3+(7&W),W>>>=3,n-=3}else{for(c=x+7;n<c;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}W>>>=x,n-=x,l=0,M=11+(127&W),W>>>=7,n-=7}if(j.have+M>j.nlen+j.ndist){q.uf="invalid bit length repeat",j.mode=w;break}for(;M--;)j.lens[j.have++]=l}}if(j.mode===w)break;if(0===j.lens[256]){q.uf="invalid code -- missing end-of-block",j.mode=w;break}if(j.lenbits=9,C={bits:j.lenbits},V=L(1,j.lens,0,j.nlen,j.lencode,0,j.work,C),j.lenbits=C.bits,V){q.uf="invalid literal/lengths set",j.mode=w;break}if(j.distbits=6,j.distcode=j.distdyn,C={bits:j.distbits},V=L(2,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,C),j.distbits=C.bits,V){q.uf="invalid distances set",j.mode=w;break}if(j.mode=20,f===r)break q;case 20:j.mode=21;case 21:if(I>=6&&T>=258){q.next_out=Z,q.avail_out=T,q.next_in=e,q.avail_in=I,j.hold=W,j.bits=n,h(q,F),Z=q.next_out,S=q.output,T=q.avail_out,e=q.next_in,s=q.input,I=q.avail_in,W=j.hold,n=j.bits,j.mode===N&&(j.back=-1);break}for(j.back=0;a=j.lencode[W&(1<<j.lenbits)-1],x=a>>>24,R=a>>>16&255,A=65535&a,!(x<=n);){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(R&&0===(240&R)){for(k=x,y=R,p=A;a=j.lencode[p+((W&(1<<k+y)-1)>>k)],x=a>>>24,R=a>>>16&255,A=65535&a,!(k+x<=n);){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}W>>>=k,n-=k,j.back+=k}if(W>>>=x,n-=x,j.back+=x,j.length=A,0===R){j.mode=26;break}if(32&R){j.back=-1,j.mode=N;break}if(64&R){q.uf="invalid literal/length code",j.mode=w;break}j.extra=15&R,j.mode=22;case 22:if(j.extra){for(c=j.extra;n<c;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}j.length+=W&(1<<j.extra)-1,W>>>=j.extra,n-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=23;case 23:for(;a=j.distcode[W&(1<<j.distbits)-1],x=a>>>24,R=a>>>16&255,A=65535&a,!(x<=n);){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(0===(240&R)){for(k=x,y=R,p=A;a=j.distcode[p+((W&(1<<k+y)-1)>>k)],x=a>>>24,R=a>>>16&255,A=65535&a,!(k+x<=n);){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}W>>>=k,n-=k,j.back+=k}if(W>>>=x,n-=x,j.back+=x,64&R){q.uf="invalid distance code",j.mode=w;break}j.offset=A,j.extra=15&R,j.mode=24;case 24:if(j.extra){for(c=j.extra;n<c;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}j.offset+=W&(1<<j.extra)-1,W>>>=j.extra,n-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){q.uf="invalid distance too far back",j.mode=w;break}j.mode=25;case 25:if(0===T)break q;if(M=F-T,j.offset>M){if(M=j.offset-M,M>j.whave&&j.sane){q.uf="invalid distance too far back",j.mode=w;break}M>j.wnext?(M-=j.wnext,o=j.wsize-M):o=j.wnext-M,M>j.length&&(M=j.length),b=j.window}else b=S,o=Z-j.offset,M=j.length;M>T&&(M=T),T-=M,j.length-=M;do{S[Z++]=b[o++]}while(--M);0===j.length&&(j.mode=21);break;case 26:if(0===T)break q;S[Z++]=j.length,T--,j.mode=21;break;case 27:if(j.wrap){for(;n<32;){if(0===I)break q;I--,W|=s[e++]<<n,n+=8}if(F-=T,q.total_out+=F,j.total+=F,F&&(q.adler=j.check=j.flags?g(j.check,S,F,Z-F):d(j.check,S,F,Z-F)),F=T,(j.flags?W:E(W))!==j.check){q.uf="incorrect data check",j.mode=w;break}W=0,n=0}j.mode=28;case 28:if(j.wrap&&j.flags){for(;n<32;){if(0===I)break q;I--,W+=s[e++]<<n,n+=8}if(W!==(4294967295&j.total)){q.uf="incorrect length check",j.mode=w;break}W=0,n=0}j.mode=29;case 29:V=X;break q;case w:V=D;break q;case 31:return i;default:return B}return q.next_out=Z,q.avail_out=T,q.next_in=e,q.avail_in=I,j.hold=W,j.bits=n,(j.wsize||F!==q.avail_out&&j.mode<w&&(j.mode<27||f!==Q))&&Y(q,q.output,q.next_out,F-q.avail_out)?(j.mode=31,i):(v-=q.avail_in,F-=q.avail_out,q.total_in+=v,q.total_out+=F,j.total+=F,j.wrap&&F&&(q.adler=j.check=j.flags?g(j.check,S,F,q.next_out-F):d(j.check,S,F,q.next_out-F)),q.data_type=j.bits+(j.last?64:0)+(j.mode===N?128:0)+(20===j.mode||15===j.mode?256:0),(0===v&&0===F||f===Q)&&V===u&&(V=t),V)},q.exports.inflateEnd=q=>{if(!q||!q.state)return B;let f=q.state;return f.window&&(f.window=null),q.state=null,u},q.exports.inflateGetHeader=(q,f)=>{if(!q||!q.state)return B;const j=q.state;return 0===(2&j.wrap)?B:(j.head=f,f.done=!1,u)},q.exports.inflateSetDictionary=(q,f)=>{const j=f.length;let g,h,L;return q&&q.state?(g=q.state,0!==g.wrap&&11!==g.mode?B:11===g.mode&&(h=1,h=d(h,f,j,0),h!==g.check)?D:(L=Y(q,f,j,j),L?(g.mode=31,i):(g.havedict=1,u))):B},q.exports.inflateInfo="pako inflate (from Nodeca project)"},12228:q=>{"use strict";const f=15,j=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),d=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),h=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);q.exports=(q,L,Q,H,r,u,X,z)=>{const B=z.bits;let D,i,t,O,N,w,E=0,s=0,S=0,e=0,Z=0,I=0,T=0,W=0,n=0,U=0,Y=null,v=0;const F=new Uint16Array(16),M=new Uint16Array(16);let o,b,x,R=null,A=0;for(E=0;E<=f;E++)F[E]=0;for(s=0;s<H;s++)F[L[Q+s]]++;for(Z=B,e=f;e>=1&&0===F[e];e--);if(Z>e&&(Z=e),0===e)return r[u++]=20971520,r[u++]=20971520,z.bits=1,0;for(S=1;S<e&&0===F[S];S++);for(Z<S&&(Z=S),W=1,E=1;E<=f;E++)if(W<<=1,W-=F[E],W<0)return-1;if(W>0&&(0===q||1!==e))return-1;for(M[1]=0,E=1;E<f;E++)M[E+1]=M[E]+F[E];for(s=0;s<H;s++)0!==L[Q+s]&&(X[M[L[Q+s]]++]=s);if(0===q?(Y=R=X,w=19):1===q?(Y=j,v-=257,R=d,A-=257,w=256):(Y=g,R=h,w=-1),U=0,s=0,E=S,N=u,I=Z,T=0,t=-1,n=1<<Z,O=n-1,1===q&&n>852||2===q&&n>592)return 1;for(;;){o=E-T,X[s]<w?(b=0,x=X[s]):X[s]>w?(b=R[A+X[s]],x=Y[v+X[s]]):(b=96,x=0),D=1<<E-T,i=1<<I,S=i;do{i-=D,r[N+(U>>T)+i]=o<<24|b<<16|x}while(0!==i);for(D=1<<E-1;U&D;)D>>=1;if(0!==D?(U&=D-1,U+=D):U=0,s++,0===--F[E]){if(E===e)break;E=L[Q+X[s]]}if(E>Z&&(U&O)!==t){for(0===T&&(T=Z),N+=S,I=E-T,W=1<<I;I+T<e&&(W-=F[I+T],!(W<=0));)I++,W<<=1;if(n+=1<<I,1===q&&n>852||2===q&&n>592)return 1;t=U&O,r[t]=Z<<24|I<<16|N-u}}return 0!==U&&(r[N+U]=E-T<<24|64<<16),z.bits=Z,0}},12183:q=>{"use strict";q.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12162:q=>{"use strict";function f(q){let f=q.length;for(;--f>=0;)q[f]=0}const j=256,d=286,g=30,h=15,L=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Q=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),H=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new Array(576);f(u);const X=new Array(60);f(X);const z=new Array(512);f(z);const B=new Array(256);f(B);const D=new Array(29);f(D);const i=new Array(g);function t(q,f,j,d,g){this.static_tree=q,this.extra_bits=f,this.extra_base=j,this.elems=d,this.max_length=g,this.has_stree=q&&q.length}let O,N,w;function E(q,f){this.dyn_tree=q,this.max_code=0,this.stat_desc=f}f(i);const s=q=>q<256?z[q]:z[256+(q>>>7)],S=(q,f)=>{q.pending_buf[q.pending++]=255&f,q.pending_buf[q.pending++]=f>>>8&255},e=(q,f,j)=>{q.bi_valid>16-j?(q.bi_buf|=f<<q.bi_valid&65535,S(q,q.bi_buf),q.bi_buf=f>>16-q.bi_valid,q.bi_valid+=j-16):(q.bi_buf|=f<<q.bi_valid&65535,q.bi_valid+=j)},Z=(q,f,j)=>{e(q,j[2*f],j[2*f+1])},I=(q,f)=>{let j=0;do{j|=1&q,q>>>=1,j<<=1}while(--f>0);return j>>>1},T=(q,f,j)=>{const d=new Array(16);let g,L,Q=0;for(g=1;g<=h;g++)d[g]=Q=Q+j[g-1]<<1;for(L=0;L<=f;L++){let f=q[2*L+1];0!==f&&(q[2*L]=I(d[f]++,f))}},W=q=>{let f;for(f=0;f<d;f++)q.dyn_ltree[2*f]=0;for(f=0;f<g;f++)q.dyn_dtree[2*f]=0;for(f=0;f<19;f++)q.bl_tree[2*f]=0;q.dyn_ltree[512]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0},n=q=>{q.bi_valid>8?S(q,q.bi_buf):q.bi_valid>0&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0},U=(q,f,j,d)=>{const g=2*f,h=2*j;return q[g]<q[h]||q[g]===q[h]&&d[f]<=d[j]},Y=(q,f,j)=>{const d=q.heap[j];let g=j<<1;for(;g<=q.heap_len&&(g<q.heap_len&&U(f,q.heap[g+1],q.heap[g],q.depth)&&g++,!U(f,d,q.heap[g],q.depth));)q.heap[j]=q.heap[g],j=g,g<<=1;q.heap[j]=d},v=(q,f,d)=>{let g,h,H,r,u=0;if(0!==q.last_lit)do{g=q.pending_buf[q.d_buf+2*u]<<8|q.pending_buf[q.d_buf+2*u+1],h=q.pending_buf[q.l_buf+u],u++,0===g?Z(q,h,f):(H=B[h],Z(q,H+j+1,f),r=L[H],0!==r&&(h-=D[H],e(q,h,r)),g--,H=s(g),Z(q,H,d),r=Q[H],0!==r&&(g-=i[H],e(q,g,r)))}while(u<q.last_lit);Z(q,256,f)},F=(q,f)=>{const j=f.dyn_tree,d=f.stat_desc.static_tree,g=f.stat_desc.has_stree,L=f.stat_desc.elems;let Q,H,r,u=-1;for(q.heap_len=0,q.heap_max=573,Q=0;Q<L;Q++)0!==j[2*Q]?(q.heap[++q.heap_len]=u=Q,q.depth[Q]=0):j[2*Q+1]=0;for(;q.heap_len<2;)r=q.heap[++q.heap_len]=u<2?++u:0,j[2*r]=1,q.depth[r]=0,q.opt_len--,g&&(q.static_len-=d[2*r+1]);for(f.max_code=u,Q=q.heap_len>>1;Q>=1;Q--)Y(q,j,Q);r=L;do{Q=q.heap[1],q.heap[1]=q.heap[q.heap_len--],Y(q,j,1),H=q.heap[1],q.heap[--q.heap_max]=Q,q.heap[--q.heap_max]=H,j[2*r]=j[2*Q]+j[2*H],q.depth[r]=(q.depth[Q]>=q.depth[H]?q.depth[Q]:q.depth[H])+1,j[2*Q+1]=j[2*H+1]=r,q.heap[1]=r++,Y(q,j,1)}while(q.heap_len>=2);q.heap[--q.heap_max]=q.heap[1],((q,f)=>{const j=f.dyn_tree,d=f.max_code,g=f.stat_desc.static_tree,L=f.stat_desc.has_stree,Q=f.stat_desc.extra_bits,H=f.stat_desc.extra_base,r=f.stat_desc.max_length;let u,X,z,B,D,i,t=0;for(B=0;B<=h;B++)q.bl_count[B]=0;for(j[2*q.heap[q.heap_max]+1]=0,u=q.heap_max+1;u<573;u++)X=q.heap[u],B=j[2*j[2*X+1]+1]+1,B>r&&(B=r,t++),j[2*X+1]=B,X>d||(q.bl_count[B]++,D=0,X>=H&&(D=Q[X-H]),i=j[2*X],q.opt_len+=i*(B+D),L&&(q.static_len+=i*(g[2*X+1]+D)));if(0!==t){do{for(B=r-1;0===q.bl_count[B];)B--;q.bl_count[B]--,q.bl_count[B+1]+=2,q.bl_count[r]--,t-=2}while(t>0);for(B=r;0!==B;B--)for(X=q.bl_count[B];0!==X;)z=q.heap[--u],z>d||(j[2*z+1]!==B&&(q.opt_len+=(B-j[2*z+1])*j[2*z],j[2*z+1]=B),X--)}})(q,f),T(j,u,q.bl_count)},M=(q,f,j)=>{let d,g,h=-1,L=f[1],Q=0,H=7,r=4;for(0===L&&(H=138,r=3),f[2*(j+1)+1]=65535,d=0;d<=j;d++)g=L,L=f[2*(d+1)+1],++Q<H&&g===L||(Q<r?q.bl_tree[2*g]+=Q:0!==g?(g!==h&&q.bl_tree[2*g]++,q.bl_tree[32]++):Q<=10?q.bl_tree[34]++:q.bl_tree[36]++,Q=0,h=g,0===L?(H=138,r=3):g===L?(H=6,r=3):(H=7,r=4))},o=(q,f,j)=>{let d,g,h=-1,L=f[1],Q=0,H=7,r=4;for(0===L&&(H=138,r=3),d=0;d<=j;d++)if(g=L,L=f[2*(d+1)+1],!(++Q<H&&g===L)){if(Q<r)do{Z(q,g,q.bl_tree)}while(0!==--Q);else 0!==g?(g!==h&&(Z(q,g,q.bl_tree),Q--),Z(q,16,q.bl_tree),e(q,Q-3,2)):Q<=10?(Z(q,17,q.bl_tree),e(q,Q-3,3)):(Z(q,18,q.bl_tree),e(q,Q-11,7));Q=0,h=g,0===L?(H=138,r=3):g===L?(H=6,r=3):(H=7,r=4)}};let b=!1;const x=(q,f,j,d)=>{e(q,0+(d?1:0),3),((q,f,j,d)=>{n(q),d&&(S(q,j),S(q,~j)),q.pending_buf.set(q.window.subarray(f,f+j),q.pending),q.pending+=j})(q,f,j,!0)};q.exports._tr_init=q=>{b||((()=>{let q,f,j,r,E;const s=new Array(16);for(j=0,r=0;r<28;r++)for(D[r]=j,q=0;q<1<<L[r];q++)B[j++]=r;for(B[j-1]=r,E=0,r=0;r<16;r++)for(i[r]=E,q=0;q<1<<Q[r];q++)z[E++]=r;for(E>>=7;r<g;r++)for(i[r]=E<<7,q=0;q<1<<Q[r]-7;q++)z[256+E++]=r;for(f=0;f<=h;f++)s[f]=0;for(q=0;q<=143;)u[2*q+1]=8,q++,s[8]++;for(;q<=255;)u[2*q+1]=9,q++,s[9]++;for(;q<=279;)u[2*q+1]=7,q++,s[7]++;for(;q<=287;)u[2*q+1]=8,q++,s[8]++;for(T(u,287,s),q=0;q<g;q++)X[2*q+1]=5,X[2*q]=I(q,5);O=new t(u,L,257,d,h),N=new t(X,Q,0,g,h),w=new t(new Array(0),H,0,19,7)})(),b=!0),q.l_desc=new E(q.dyn_ltree,O),q.d_desc=new E(q.dyn_dtree,N),q.bl_desc=new E(q.bl_tree,w),q.bi_buf=0,q.bi_valid=0,W(q)},q.exports._tr_stored_block=x,q.exports._tr_flush_block=(q,f,d,g)=>{let h,L,Q=0;q.level>0?(2===q.strm.data_type&&(q.strm.data_type=(q=>{let f,d=4093624447;for(f=0;f<=31;f++,d>>>=1)if(1&d&&0!==q.dyn_ltree[2*f])return 0;if(0!==q.dyn_ltree[18]||0!==q.dyn_ltree[20]||0!==q.dyn_ltree[26])return 1;for(f=32;f<j;f++)if(0!==q.dyn_ltree[2*f])return 1;return 0})(q)),F(q,q.l_desc),F(q,q.d_desc),Q=(q=>{let f;for(M(q,q.dyn_ltree,q.l_desc.max_code),M(q,q.dyn_dtree,q.d_desc.max_code),F(q,q.bl_desc),f=18;f>=3&&0===q.bl_tree[2*r[f]+1];f--);return q.opt_len+=3*(f+1)+5+5+4,f})(q),h=q.opt_len+3+7>>>3,L=q.static_len+3+7>>>3,L<=h&&(h=L)):h=L=d+5,d+4<=h&&-1!==f?x(q,f,d,g):4===q.strategy||L===h?(e(q,2+(g?1:0),3),v(q,u,X)):(e(q,4+(g?1:0),3),((q,f,j,d)=>{let g;for(e(q,f-257,5),e(q,j-1,5),e(q,d-4,4),g=0;g<d;g++)e(q,q.bl_tree[2*r[g]+1],3);o(q,q.dyn_ltree,f-1),o(q,q.dyn_dtree,j-1)})(q,q.l_desc.max_code+1,q.d_desc.max_code+1,Q+1),v(q,q.dyn_ltree,q.dyn_dtree)),W(q),g&&n(q)},q.exports._tr_tally=(q,f,d)=>(q.pending_buf[q.d_buf+2*q.last_lit]=f>>>8&255,q.pending_buf[q.d_buf+2*q.last_lit+1]=255&f,q.pending_buf[q.l_buf+q.last_lit]=255&d,q.last_lit++,0===f?q.dyn_ltree[2*d]++:(q.matches++,f--,q.dyn_ltree[2*(B[d]+j+1)]++,q.dyn_dtree[2*s(f)]++),q.last_lit===q.lit_bufsize-1),q.exports._tr_align=q=>{e(q,2,3),Z(q,256,u),(q=>{16===q.bi_valid?(S(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):q.bi_valid>=8&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)})(q)}},12208:q=>{"use strict";q.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.uf="",this.state=null,this.data_type=2,this.adler=0}},11865:q=>{function f(q,f,j){for(var d=q.length,g=-1/0,h=1/0,L=0;L<d;L++){var Q=(j[0][L]-q[L])/f[L],H=(j[1][L]-q[L])/f[L];if(Q>H){var r=Q;Q=H,H=r}if(H<g||Q>h)return 1/0;Q>g&&(g=Q),H<h&&(h=H)}return g>h?1/0:g}q.exports=function(q,j,d,g){var h=f(j,d,g);if(h===1/0)q=null;else{q=q||[];for(var L=0;L<j.length;L++)q[L]=j[L]+d[L]*h}return q},q.exports.distance=f},13144:(q,f,j)=>{"use strict";j.d(f,{c:()=>L});var d=j(30);const g=d.useLayoutEffect;const h=function(q){var f=(0,d.useRef)(q);return g((function(){f.current=q})),f};var L=function(q){var f=h(q);(0,d.hf)((function(){var q=function(q){var j;if(null!=f.current&&(j=f.current(q)),q.defaultPrevented&&(q.returnValue=""),"string"===typeof j)return q.returnValue=j,j};return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[])}},13104:(q,f,j)=>{"use strict";var d=j(13108),g=Array.prototype.concat,h=Array.prototype.slice,L=q.exports=function(q){for(var f=[],j=0,L=q.length;j<L;j++){var Q=q[j];d(Q)?f=g.call(f,h.call(Q)):f.push(Q)}return f};L.wrap=function(q){return function(){return q(L(arguments))}}},13108:q=>{q.exports=function(q){return!(!q||"string"===typeof q)&&(q instanceof Array||Array.isArray(q)||q.length>=0&&(q.splice instanceof Function||Object.getOwnPropertyDescriptor(q,q.length-1)&&"String"!==q.constructor.name))}},12119:(q,f,j)=>{var d=j(12124);function g(q){for(var f,j,g=0,h=q.length,L=0;L<q.length;){for(f=q[L],j=0;L<h&&q[L]===f;)++L,++j;g+=d.log2(j)/7|0,g+=d.log2(f>>>0)/7|0,g+=2}return g}f.size=g,f.encode=function(q,f){f||(f=new Uint8Array(g(q)));for(var j,d,h=0,L=f.length,Q=0;Q<q.length;){for(j=q[Q],d=0;Q<q.length&&q[Q]===j;)++Q,++d;for(;h<L&&d>=128;)f[h++]=128+(127&d),d>>>=7;if(h>=L)throw new Error("RLE buffer overflow");for(f[h++]=d,j>>>=0;h<L&&j>=128;)f[h++]=128+(127&j),j>>>=7;if(h>=L)throw new Error("RLE buffer overflow");f[h++]=j}return f},f.decode=function(q,f){for(var j,d,g,h,L=f.length,Q=q.length,H=0,r=0;r<Q;){for(j=0,d=0;r<Q&&q[r]>=128;)j+=(127&q[r++])<<d,d+=7;if(j+=q[r++]<<d,r>=Q)throw new Error("RLE buffer underrun");if(H+j>L)throw new Error("Chunk buffer overflow");for(g=0,d=0;r<Q&&q[r]>=128;)g+=(127&q[r++])<<d,d+=7;if(r>=Q)throw new Error("RLE buffer underrun");for(g+=q[r++]<<d,h=0;h<j;++h)f[H++]=g}return f}},12124:(q,f)=>{"use strict";function j(q){var f=32;return(q&=-q)&&f--,65535&q&&(f-=16),16711935&q&&(f-=8),252645135&q&&(f-=4),858993459&q&&(f-=2),1431655765&q&&(f-=1),f}f.INT_BITS=32,f.INT_MAX=2147483647,f.INT_MIN=-1<<31,f.sign=function(q){return(q>0)-(q<0)},f.abs=function(q){var f=q>>31;return(q^f)-f},f.min=function(q,f){return f^(q^f)&-(q<f)},f.max=function(q,f){return q^(q^f)&-(q<f)},f.isPow2=function(q){return!(q&q-1)&&!!q},f.log2=function(q){var f,j;return f=(q>65535)<<4,f|=j=((q>>>=f)>255)<<3,f|=j=((q>>>=j)>15)<<2,(f|=j=((q>>>=j)>3)<<1)|(q>>>=j)>>1},f.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},f.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},f.countTrailingZeros=j,f.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},f.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},f.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var d=new Array(256);!function(q){for(var f=0;f<256;++f){var j=f,d=f,g=7;for(j>>>=1;j;j>>>=1)d<<=1,d|=1&j,--g;q[f]=d<<g&255}}(d),f.reverse=function(q){return d[255&q]<<24|d[q>>>8&255]<<16|d[q>>>16&255]<<8|d[q>>>24&255]},f.interleave2=function(q,f){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))<<1},f.deinterleave2=function(q,f){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>f&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},f.interleave3=function(q,f,j){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},f.deinterleave3=function(q,f){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>f&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},f.nextCombination=function(q){var f=q|q-1;return f+1|(~f&-~f)-1>>>j(q)+1}},12145:q=>{"use strict";q.exports=function(q,f,j,d){var g=self||window;try{try{var h;try{h=new g.Blob([q])}catch(r){(h=new(g.BlobBuilder||g.WebKitBlobBuilder||g.MozBlobBuilder||g.MSBlobBuilder)).append(q),h=h.getBlob()}var L=g.URL||g.webkitURL,Q=L.createObjectURL(h),H=new g[f](Q,j);return L.revokeObjectURL(Q),H}catch(r){return new g[f]("data:application/javascript,".concat(encodeURIComponent(q)),j)}}catch(r){if(!d)throw Error("Inline worker is not supported");return new g[f](d,j)}}},11851:(q,f,j)=>{"use strict";function d(q,f,j,d,g){var h={};return Object.keys(d).forEach((function(q){h[q]=d[q]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=j.slice().reverse().reduce((function(j,d){return d(q,f,j)||j}),h),g&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(g):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(q,f,h),h=null),h}j.d(f,{d:()=>d})},11847:(q,f,j)=>{"use strict";function d(q,f,j,d){j&&Object.defineProperty(q,f,{enumerable:j.enumerable,configurable:j.configurable,writable:j.writable,value:j.initializer?j.initializer.call(d):void 0})}j.d(f,{b:()=>d})},13131:(q,f,j)=>{"use strict";j.d(f,{b:()=>L,e:()=>X,g:()=>Q,j:()=>h,m:()=>H,n:()=>g,r:()=>r,t:()=>u});var d=j(11402);class g{constructor(){this._easingMode=g.EASINGMODE_EASEIN}setEasingMode(q){const f=Math.min(Math.max(q,0),2);this._easingMode=f}getEasingMode(){return this._easingMode}easeInCore(q){throw new Error("You must implement this method")}ease(q){switch(this._easingMode){case g.EASINGMODE_EASEIN:return this.easeInCore(q);case g.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-q)}return q>=.5?.5*(1-this.easeInCore(2*(1-q)))+.5:.5*this.easeInCore(2*q)}}g.EASINGMODE_EASEIN=0,g.EASINGMODE_EASEOUT=1,g.EASINGMODE_EASEINOUT=2;class h extends g{easeInCore(q){return q=Math.max(0,Math.min(1,q)),1-Math.sqrt(1-q*q)}}class L extends g{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=q}easeInCore(q){const f=Math.max(0,this.amplitude);return Math.pow(q,3)-q*f*Math.sin(3.141592653589793*q)}}class Q extends g{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=q,this.bounciness=f}easeInCore(q){const f=Math.max(0,this.bounces);let j=this.bounciness;j<=1&&(j=1.001);const d=Math.pow(j,f),g=1-j,h=(1-d)/g+.5*d,L=q*h,Q=Math.log(-L*(1-j)+1)/Math.log(j),H=Math.floor(Q),r=H+1,u=(1-Math.pow(j,H))/(g*h),X=.5*(u+(1-Math.pow(j,r))/(g*h)),z=q-X,B=X-u;return-Math.pow(1/j,f-H)/(B*B)*(z-B)*(z+B)}}class H extends g{easeInCore(q){return q*q*q}}class r extends g{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=q,this.springiness=f}easeInCore(q){let f;const j=Math.max(0,this.oscillations),d=Math.max(0,this.springiness);return f=0==d?q:(Math.exp(d*q)-1)/(Math.exp(d)-1),f*Math.sin((6.283185307179586*j+1.5707963267948966)*q)}}class u extends g{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=q}easeInCore(q){return this.exponent<=0?q:(Math.exp(this.exponent*q)-1)/(Math.exp(this.exponent)-1)}}class X extends g{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=q,this.y1=f,this.x2=j,this.y2=d}easeInCore(q){return d.d.Interpolate(q,this.x1,this.y1,this.x2,this.y2)}}},12628:(q,f,j)=>{"use strict";j.d(f,{e:()=>L});var d=j(10941),g=j(10958),h=j(11247);class L extends h.d{get _matrix(){return this._compose(),this.Gz}set _matrix(q){(q.updateFlag!==this.Gz.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Gz.H(q),this._markAsDirtyAndDecompose())}constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(q,f.eq(),!1),this.name=q,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=f,this.Gz=(null===g||void 0===g?void 0:g.clone())??d.b.Identity(),this._restMatrix=h??this.Gz.clone(),this._bindMatrix=L??this.Gz.clone(),this._index=Q,this._absoluteMatrix=new d.b,this._absoluteBindMatrix=new d.b,this._absoluteInverseBindMatrix=new d.b,this._finalMatrix=new d.b,f.bones.push(this),this.setParent(j,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(q){this.setParent(q)}setParent(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==q){if(this.parent){const q=this.parent.children.indexOf(this);-1!==q&&this.parent.children.splice(q,1)}this._parentNode=q,this.parent&&this.parent.children.push(this),f&&this._updateAbsoluteBindMatrices(),this.zu()}}getLocalMatrix(){return this._compose(),this.Gz}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(q){this._restMatrix.H(q)}setRestPose(q){this.setRestMatrix(q)}getBindPose(){return this.getBindMatrix()}setBindMatrix(q){this.jd(q)}setBindPose(q){this.setBindMatrix(q)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const q=d.f.kf[0],f=d.f.Quaternion[0],j=d.f.kf[1];this.getRestMatrix().decompose(q,f,j),this._linkedTransformNode.position.H(j),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??d.e.Identity(),this._linkedTransformNode.rotationQuaternion.H(f),this._linkedTransformNode.Vf.H(q)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(q){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=q,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.TH}set position(q){this._decompose(),this.TH.H(q),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(q){this.setRotation(q)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(q){this.setRotationQuaternion(q)}get Vf(){return this.getScale()}set Vf(q){this.setScale(q)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=d.j.Zero(),this._localRotation=d.e.Zero(),this.TH=d.j.Zero()),this.Gz.decompose(this._localScaling,this._localRotation,this.TH))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,d.b.ComposeToRef(this._localScaling,this._localRotation,this.TH,this.Gz)):this._needToCompose=!1)}jd(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.H(q),f&&this._updateAbsoluteBindMatrices(),j?this._matrix=q:this.zu()}_updateAbsoluteBindMatrices(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q||(q=this._bindMatrix),this.parent?q.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.H(q),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),f)for(let j=0;j<this.children.length;j++)this.children[j]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}zu(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.zu(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.zu(),this._needToDecompose=!0}_updatePosition(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=this.getLocalMatrix();if(0==f)g?(h.addAtIndex(12,q.x),h.addAtIndex(13,q.y),h.addAtIndex(14,q.z)):h.setTranslationFromFloats(q.x,q.y,q.z);else{let f=null;j&&(f=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=L._TmpMats[0],H=L._TmpVecs[0];this.parent?j&&f?(Q.H(this.parent.getAbsoluteMatrix()),Q.multiplyToRef(f,Q)):Q.H(this.parent.getAbsoluteMatrix()):d.b.IdentityToRef(Q),g&&Q.setTranslationFromFloats(0,0,0),Q.invert(),d.j.TransformCoordinatesToRef(q,Q,H),g?(h.addAtIndex(12,H.x),h.addAtIndex(13,H.y),h.addAtIndex(14,H.z)):h.setTranslationFromFloats(H.x,H.y,H.z)}this._markAsDirtyAndDecompose()}translate(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,f,j,!0)}setPosition(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,f,j,!1)}setAbsolutePosition(q,f){this.setPosition(q,1,f)}scale(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=this.getLocalMatrix(),Q=L._TmpMats[0];d.b.ScalingToRef(q,f,j,Q),Q.multiplyToRef(h,h),Q.invert();for(const d of this.children){const g=d.getLocalMatrix();g.multiplyToRef(Q,g),g.multiplyAtIndex(12,q),g.multiplyAtIndex(13,f),g.multiplyAtIndex(14,j),d._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),g)for(const d of this.children)d.scale(q,f,j,g)}setScale(q){this._decompose(),this._localScaling.H(q),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(q){this._decompose(),q.H(this._localScaling)}setYawPitchRoll(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4?arguments[4]:void 0;if(0===g){const Q=L._TmpQuat;return d.e.RotationYawPitchRollToRef(q,f,j,Q),void this.setRotationQuaternion(Q,g,h)}const Q=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,h))return;const H=L._TmpMats[1];d.b.RotationYawPitchRollToRef(q,f,j,H),Q.multiplyToRef(H,H),this._rotateWithMatrix(H,g,h)}rotate(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3?arguments[3]:void 0;const h=L._TmpMats[0];h.setTranslationFromFloats(0,0,0),d.b.RotationAxisToRef(q,f,h),this._rotateWithMatrix(h,j,g)}setAxisAngle(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3?arguments[3]:void 0;if(0===j){const h=L._TmpQuat;return d.e.RotationAxisToRef(q,f,h),void this.setRotationQuaternion(h,j,g)}const h=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,g))return;const Q=L._TmpMats[1];d.b.RotationAxisToRef(q,f,Q),h.multiplyToRef(Q,Q),this._rotateWithMatrix(Q,j,g)}setRotation(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(q.y,q.x,q.z,f,j)}setRotationQuaternion(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;if(0===f)return this._decompose(),this._localRotation.H(q),void this._markAsDirtyAndCompose();const g=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,j))return;const h=L._TmpMats[1];d.b.FromQuaternionToRef(q,h),g.multiplyToRef(h,h),this._rotateWithMatrix(h,f,j)}setRotationMatrix(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;if(0===f){const g=L._TmpQuat;return d.e.FromRotationMatrixToRef(q,g),void this.setRotationQuaternion(g,f,j)}const g=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,j))return;const h=L._TmpMats[1];h.H(q),g.multiplyToRef(q,h),this._rotateWithMatrix(h,f,j)}_rotateWithMatrix(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;const d=this.getLocalMatrix(),g=d.m[12],h=d.m[13],Q=d.m[14],H=this.getParent(),r=L._TmpMats[3],u=L._TmpMats[4];H&&1==f?(j?(r.H(j.getWorldMatrix()),H.getAbsoluteMatrix().multiplyToRef(r,r)):r.H(H.getAbsoluteMatrix()),u.H(r),u.invert(),d.multiplyToRef(r,d),d.multiplyToRef(q,d),d.multiplyToRef(u,d)):1==f&&j?(r.H(j.getWorldMatrix()),u.H(r),u.invert(),d.multiplyToRef(r,d),d.multiplyToRef(q,d),d.multiplyToRef(u,d)):d.multiplyToRef(q,d),d.setTranslationFromFloats(g,h,Q),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(q,f){const j=L._TmpMats[2];return q.H(this.getAbsoluteMatrix()),f?(q.multiplyToRef(f.getWorldMatrix(),q),d.b.ScalingToRef(f.Vf.x,f.Vf.y,f.Vf.z,j)):d.b.IdentityToRef(j),q.invert(),!isNaN(q.m[0])&&(j.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyToRef(j,q),!0)}zf(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=d.j.Zero();return this.getPositionToRef(q,f,j),j}getPositionToRef(){let q=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const q=this.getLocalMatrix();f.x=q.m[12],f.y=q.m[13],f.z=q.m[14]}else{let j=null;q&&(j=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let d=L._TmpMats[0];q&&j?(d.H(this.getAbsoluteMatrix()),d.multiplyToRef(j,d)):d=this.getAbsoluteMatrix(),f.x=d.m[12],f.y=d.m[13],f.z=d.m[14]}}getAbsolutePosition(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const f=d.j.Zero();return this.getPositionToRef(1,q,f),f}getAbsolutePositionToRef(q,f){this.getPositionToRef(1,q,f)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Gz.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.H(this.Gz);const q=this._skeleton.getPoseMatrix();q&&this._absoluteMatrix.multiplyToRef(q,this._absoluteMatrix)}const q=this.children,f=q.length;for(let j=0;j<f;j++)q[j].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}jr(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=d.j.Zero();return this.getDirectionToRef(q,f,j),j}getDirectionToRef(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,g=null;f&&(g=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=L._TmpMats[0];h.H(this.getAbsoluteMatrix()),f&&g&&h.multiplyToRef(g,h),d.j.TransformNormalToRef(q,h,j),j.normalize()}getRotation(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=d.j.Zero();return this.getRotationToRef(q,f,j),j}getRotationToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;const d=L._TmpQuat;this.getRotationQuaternionToRef(q,f,d),d.toEulerAnglesToRef(j)}getRotationQuaternion(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=d.e.Identity();return this.getRotationQuaternionToRef(q,f,j),j}getRotationQuaternionToRef(){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),f.H(this._localRotation);else{const j=L._TmpMats[0],d=this.getAbsoluteMatrix();q?d.multiplyToRef(q.getWorldMatrix(),j):j.H(d),j.multiplyAtIndex(0,this._scalingDeterminant),j.multiplyAtIndex(1,this._scalingDeterminant),j.multiplyAtIndex(2,this._scalingDeterminant),j.decompose(void 0,f,void 0)}}getRotationMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0;const j=d.b.Identity();return this.getRotationMatrixToRef(q,f,j),j}getRotationMatrixToRef(){let q=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(f);else{const j=L._TmpMats[0],d=this.getAbsoluteMatrix();q?d.multiplyToRef(q.getWorldMatrix(),j):j.H(d),j.multiplyAtIndex(0,this._scalingDeterminant),j.multiplyAtIndex(1,this._scalingDeterminant),j.multiplyAtIndex(2,this._scalingDeterminant),j.getRotationMatrixToRef(f)}}getAbsolutePositionFromLocal(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=d.j.Zero();return this.getAbsolutePositionFromLocalToRef(q,f,j),j}getAbsolutePositionFromLocalToRef(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,g=null;f&&(g=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=L._TmpMats[0];h.H(this.getAbsoluteMatrix()),f&&g&&h.multiplyToRef(g,h),d.j.TransformCoordinatesToRef(q,h,j)}getLocalPositionFromAbsolute(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=d.j.Zero();return this.getLocalPositionFromAbsoluteToRef(q,f,j),j}getLocalPositionFromAbsoluteToRef(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,g=null;f&&(g=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=L._TmpMats[0];h.H(this.getAbsoluteMatrix()),f&&g&&h.multiplyToRef(g,h),h.invert(),d.j.TransformCoordinatesToRef(q,h,j)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const q=this._skeleton.bones.indexOf(this);if(-1!==q&&this._skeleton.bones.splice(q,1),this._parentNode&&this._parentNode.children){const q=this._parentNode.children,f=q.indexOf(this);-1!==f&&q.splice(f,1)}super.dispose()}}L._TmpVecs=(0,g.e)(2,d.j.Zero),L._TmpQuat=d.e.Identity(),L._TmpMats=(0,g.e)(5,d.b.Identity)},13128:(q,f,j)=>{"use strict";j.d(f,{c:()=>F});var d=j(11125),g=j(11130),h=j(10982),L=j(10941),Q=j(10985),H=j(11247),r=j(11289),u=j(11524),X=j(11013),z=j(10950);class B{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(q){this._idleRotationSpeed=q}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(q){this._idleRotationWaitTime=q}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(q){this._idleRotationSpinupTime=q}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(q){this._attachedCamera=q;const f=this._attachedCamera.eq();this._onPrePointerObservableObserver=f.onPrePointerObservable.add((q=>{q.type!==u.b.POINTERDOWN?q.type===u.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const q=X.c.Now;let f=0;null!=this._lastFrameTime&&(f=q-this._lastFrameTime),this._lastFrameTime=q,this._applyUserInteraction();const j=q-this._lastInteractionTime-this._idleRotationWaitTime,d=Math.max(Math.min(j/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*d,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(f/1e3))}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.eq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(q){this._lastInteractionTime=q??X.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<z.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let q=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(q=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?q:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=X.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var D=j(13131),i=j(11609);class t{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(q){if(this._autoTransitionRange===q)return;this._autoTransitionRange=q;const f=this._attachedCamera;f&&(q?this._onMeshTargetChangedObserver=f.onMeshTargetChangedObservable.add((q=>{if(q&&(q.Nf(!0),q.getBoundingInfo)){const f=q.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*f,this.upperRadiusTransitionRange=.05*f}})):this._onMeshTargetChangedObserver&&f.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(q){this._attachedCamera=q,this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(q){return!!this._attachedCamera&&(this._attachedCamera.radius===q&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(q){if(!this._attachedCamera)return;this._radiusBounceTransition||(t.EasingFunction.setEasingMode(t.EasingMode),this._radiusBounceTransition=i.e.CreateAnimation("radius",i.e.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const f=i.e.TransitionTo("radius",this._attachedCamera.radius+q,this._attachedCamera,this._attachedCamera.eq(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));f&&this._animatables.push(f)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}t.EasingFunction=new D.b(.3),t.EasingMode=D.n.EASINGMODE_EASEOUT;class O{constructor(){this.onTargetFramingAnimationEndObservable=new h.d,this._mode=O.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(q){this._mode=q}get mode(){return this._mode}set radiusScale(q){this._radiusScale=q}get radiusScale(){return this._radiusScale}set positionScale(q){this._positionScale=q}get positionScale(){return this._positionScale}set defaultElevation(q){this._defaultElevation=q}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(q){this._elevationReturnTime=q}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(q){this._elevationReturnWaitTime=q}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(q){this._framingTime=q}get framingTime(){return this._framingTime}init(){}attach(q){this._attachedCamera=q;const f=this._attachedCamera.eq();O.EasingFunction.setEasingMode(O.EasingMode),this._onPrePointerObservableObserver=f.onPrePointerObservable.add((q=>{q.type!==u.b.POINTERDOWN?q.type===u.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((q=>{q&&q.getBoundingInfo&&this.zoomOnMesh(q,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.eq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.Nf(!0);const d=q.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(d.minimumWorld,d.maximumWorld,f,j)}zoomOnMeshHierarchy(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.Nf(!0);const d=q.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(d.min,d.max,f,j)}zoomOnMeshesHierarchy(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new L.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),g=new L.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let h=0;h<q.length;h++){const f=q[h].getHierarchyBoundingVectors(!0);L.j.CheckExtends(f.min,d,g),L.j.CheckExtends(f.max,d,g)}this.zoomOnBoundingInfo(d,g,f,j)}zoomOnBoundingInfo(q,f){let j,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const h=q.y,Q=h+(f.y-h)*this._positionScale,H=f.ej(q).scale(.5);if(!isFinite(Q))return!1;if(d)j=new L.j(0,Q,0);else{const f=q.add(H);j=new L.j(f.x,Q,f.z)}this._vectorTransition||(this._vectorTransition=i.e.CreateAnimation("target",i.e.ANIMATIONTYPE_VECTOR3,60,O.EasingFunction)),this._betaIsAnimating=!0;let r=i.e.TransitionTo("target",j,this._attachedCamera,this._attachedCamera.eq(),60,this._vectorTransition,this._framingTime);r&&this._animatables.push(r);let u=0;if(this._mode===O.FitFrustumSidesMode){const j=this._calculateLowerRadiusFromModelBoundingSphere(q,f);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=H.length()+this._attachedCamera.gd),u=j}else this._mode===O.IgnoreBoundsSizeMode&&(u=this._calculateLowerRadiusFromModelBoundingSphere(q,f),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.gd));if(this.autoCorrectCameraLimitsAndSensibility){const j=f.ej(q).length();this._attachedCamera.panningSensibility=5e3/j,this._attachedCamera.wheelPrecision=100/u}return this._radiusTransition||(this._radiusTransition=i.e.CreateAnimation("radius",i.e.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),r=i.e.TransitionTo("radius",u,this._attachedCamera,this._attachedCamera.eq(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),g&&g(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),r&&this._animatables.push(r),!0}_calculateLowerRadiusFromModelBoundingSphere(q,f){const j=this._attachedCamera;if(!j)return 0;let d=j._calculateLowerRadiusFromModelBoundingSphere(q,f,this._radiusScale);return j.lowerRadiusLimit&&this._mode===O.IgnoreBoundsSizeMode&&(d=d<j.lowerRadiusLimit?j.lowerRadiusLimit:d),j.upperRadiusLimit&&(d=d>j.upperRadiusLimit?j.upperRadiusLimit:d),d}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const q=X.c.Now-this._lastInteractionTime,f=.5*Math.PI-this._defaultElevation,j=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>j&&q>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=i.e.CreateAnimation("beta",i.e.ANIMATIONTYPE_FLOAT,60,O.EasingFunction));const q=i.e.TransitionTo("beta",f,this._attachedCamera,this._attachedCamera.eq(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));q&&this._animatables.push(q)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=X.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}O.EasingFunction=new D.t,O.EasingMode=D.n.EASINGMODE_EASEINOUT,O.IgnoreBoundsSizeMode=0,O.FitFrustumSidesMode=1;var N=j(11293),w=j(11481),E=j(12621),s=j(10992);class S{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(q){q=s.h.BackCompatCameraNoPreventDefault(arguments);const f=this.camera.getEngine(),j=f.getInputElement();let d=0,g=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=h=>{var L,Q;const H=h.event,r="touch"===H.pointerType;if(h.type!==u.b.POINTERMOVE&&-1===this.buttons.indexOf(H.button))return;const X=H.target;if(this._altKey=H.altKey,this._ctrlKey=H.ctrlKey,this._metaKey=H.metaKey,this._shiftKey=H.shiftKey,this._buttonsPressed=H.buttons,f.isPointerLock){const q=H.movementX,f=H.movementY;this.onTouch(null,q,f),this._pointA=null,this._pointB=null}else{if(h.type!==u.b.POINTERDOWN&&h.type!==u.b.POINTERDOUBLETAP&&r&&(null===(L=this._pointA)||void 0===L?void 0:L.pointerId)!==H.pointerId&&(null===(Q=this._pointB)||void 0===Q?void 0:Q.pointerId)!==H.pointerId)return;if(h.type!==u.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!r)if(h.type===u.b.POINTERDOUBLETAP)this.onDoubleTap(H.pointerType);else if(h.type!==u.b.POINTERUP||this._currentMousePointerIdDown!==H.pointerId&&!r){if(h.type===u.b.POINTERMOVE)if(q||H.preventDefault(),this._pointA&&null===this._pointB){const q=H.clientX-this._pointA.x,f=H.clientY-this._pointA.y;this._pointA.x=H.clientX,this._pointA.y=H.clientY,this.onTouch(this._pointA,q,f)}else if(this._pointA&&this._pointB){const q=this._pointA.pointerId===H.pointerId?this._pointA:this._pointB;q.x=H.clientX,q.y=H.clientY;const f=this._pointA.x-this._pointB.x,j=this._pointA.y-this._pointB.y,L=f*f+j*j,Q={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:H.pointerId,type:h.type};this.onMultiTouch(this._pointA,this._pointB,d,L,g,Q),g=Q,d=L}}else{try{null===X||void 0===X||X.releasePointerCapture(H.pointerId)}catch(z){}r||(this._pointB=null),f._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==H.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==H.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==d||g)&&(this.onMultiTouch(this._pointA,this._pointB,d,0,g,null),d=0,g=null),this._currentMousePointerIdDown=-1,this.onButtonUp(H),q||H.preventDefault()}else{try{null===X||void 0===X||X.setPointerCapture(H.pointerId)}catch(z){}if(null===this._pointA)this._pointA={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType};else{if(null!==this._pointB)return;this._pointB={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType}}-1!==this._currentMousePointerIdDown||r||(this._currentMousePointerIdDown=H.pointerId),this.onButtonDown(H),q||(H.preventDefault(),j&&j.focus())}}},this._observer=this.camera.eq()._inputManager._addCameraPointerObserver(this._pointerInput,u.b.POINTERDOWN|u.b.POINTERUP|u.b.POINTERMOVE|u.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,d=0,g=null,this.onLostFocus()},this._contextMenuBind=q=>this.onContextMenu(q),j&&j.addEventListener("contextmenu",this._contextMenuBind,!1);const h=this.camera.eq().getEngine().getHostWindow();h&&s.h.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}qz(){if(this._onLostFocus){const q=this.camera.eq().getEngine().getHostWindow();q&&s.h.UnregisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.eq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const q=this.camera.eq().getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(q){}onTouch(q,f,j){}onMultiTouch(q,f,j,d,g,h){}onContextMenu(q){q.preventDefault()}onButtonDown(q){}onButtonUp(q){}onLostFocus(){}}(0,d.b)([(0,g.O)()],S.prototype,"buttons",void 0);class e extends S{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(q,f){if(0!==this.panningSensibility&&q&&f){const j=f.x-q.x,d=f.y-q.y;this.camera.inertialPanningX+=-j/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility}}_computePinchZoom(q,f){const j=this.camera.radius||e.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=j*Math.sqrt(q)/Math.sqrt(f):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-q)*j*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-q)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(q,f,j){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-f/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility):(this.camera.inertialAlphaOffset-=f/this.angularSensibilityX,this.camera.inertialBetaOffset-=j/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(q,f,j,d,g,h){0===j&&null===g||0===d&&null===h||(this.multiTouchPanAndZoom?(this._computePinchZoom(j,d),this._computeMultiTouchPanning(g,h)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(d)-Math.sqrt(j))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(j,d),this._isPinching=!0):this._computeMultiTouchPanning(g,h)):this.multiTouchPanning?this._computeMultiTouchPanning(g,h):this.pinchZoom&&this._computePinchZoom(j,d))}onButtonDown(q){this._isPanClick=q.button===this.camera._panningMouseButton}onButtonUp(q){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}e.MinimumRadiusForPinch=.001,(0,d.b)([(0,g.O)()],e.prototype,"buttons",void 0),(0,d.b)([(0,g.O)()],e.prototype,"angularSensibilityX",void 0),(0,d.b)([(0,g.O)()],e.prototype,"angularSensibilityY",void 0),(0,d.b)([(0,g.O)()],e.prototype,"pinchPrecision",void 0),(0,d.b)([(0,g.O)()],e.prototype,"pinchDeltaPercentage",void 0),(0,d.b)([(0,g.O)()],e.prototype,"useNaturalPinchZoom",void 0),(0,d.b)([(0,g.O)()],e.prototype,"pinchZoom",void 0),(0,d.b)([(0,g.O)()],e.prototype,"panningSensibility",void 0),(0,d.b)([(0,g.O)()],e.prototype,"multiTouchPanning",void 0),(0,d.b)([(0,g.O)()],e.prototype,"multiTouchPanAndZoom",void 0),E.c.ArcRotateCameraPointersInput=e;var Z=j(11526);class I{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(q){q=s.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.eq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((f=>{const j=f.event;if(!j.metaKey)if(f.type===Z.c.KEYDOWN){if(this._ctrlPressed=j.ctrlKey,this._altPressed=j.altKey,-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysReset.indexOf(j.keyCode)){-1===this._keys.indexOf(j.keyCode)&&this._keys.push(j.keyCode),j.preventDefault&&(q||j.preventDefault())}}else if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysReset.indexOf(j.keyCode)){const f=this._keys.indexOf(j.keyCode);f>=0&&this._keys.splice(f,1),j.preventDefault&&(q||j.preventDefault())}})))}qz(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let f=0;f<this._keys.length;f++){const j=this._keys[f];-1!==this.keysLeft.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX-=1/this.panningSensibility:q.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset+=1/this.zoomingSensibility:q.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX+=1/this.panningSensibility:q.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset-=1/this.zoomingSensibility:q.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(j)&&q.useInputToRestoreState&&q.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,d.b)([(0,g.O)()],I.prototype,"keysUp",void 0),(0,d.b)([(0,g.O)()],I.prototype,"keysDown",void 0),(0,d.b)([(0,g.O)()],I.prototype,"keysLeft",void 0),(0,d.b)([(0,g.O)()],I.prototype,"keysRight",void 0),(0,d.b)([(0,g.O)()],I.prototype,"keysReset",void 0),(0,d.b)([(0,g.O)()],I.prototype,"panningSensibility",void 0),(0,d.b)([(0,g.O)()],I.prototype,"zoomingSensibility",void 0),(0,d.b)([(0,g.O)()],I.prototype,"useAltToZoom",void 0),(0,d.b)([(0,g.O)()],I.prototype,"angularSpeed",void 0),E.c.ArcRotateCameraKeyboardMoveInput=I;var T=j(11193),W=j(11529);class n{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new L.j(0,0,0),this._globalOffset=new L.j(0,0,0),this._inertialPanning=L.j.Zero()}_computeDeltaFromMouseWheelLegacyEvent(q,f){let j=0;const d=.01*q*this.wheelDeltaPercentage*f;return j=q>0?d/(1+this.wheelDeltaPercentage):d*(1+this.wheelDeltaPercentage),j}attachControl(q){q=s.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=f=>{if(f.type!==u.b.POINTERWHEEL)return;const j=f.event;let d=0;const g=j.deltaMode===W.c.DOM_DELTA_LINE?40:1,h=-j.deltaY*g;if(this.customComputeDeltaFromMouseWheel)d=this.customComputeDeltaFromMouseWheel(h,this,j);else if(this.wheelDeltaPercentage){if(d=this._computeDeltaFromMouseWheelLegacyEvent(h,this.camera.radius),d>0){let q=this.camera.radius,f=this.camera.inertialRadiusOffset+d;for(let j=0;j<20&&!(q<=f)&&!(Math.abs(f*this.camera.inertia)<.001);j++)q-=f,f*=this.camera.inertia;q=(0,Q.Clamp)(q,0,Number.MAX_VALUE),d=this._computeDeltaFromMouseWheelLegacyEvent(h,q)}}else d=h/(40*this.wheelPrecision);d&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(d)):this.camera.inertialRadiusOffset+=d),j.preventDefault&&(q||j.preventDefault())},this._observer=this.camera.eq()._inputManager._addCameraPointerObserver(this._wheel,u.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.cf(0)}qz(){this._observer&&(this.camera.eq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const q=this.camera;0+q.inertialAlphaOffset+q.inertialBetaOffset+q.inertialRadiusOffset&&(this._updateHitPlane(),q.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(q.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const q=this.camera,f=q.target.ej(q.position);this._hitPlane=T.e.FromPositionAndNormal(q.target,f)}_getPosition(){const q=this.camera,f=q.eq(),j=f.createPickingRay(f.pointerX,f.pointerY,L.b.Identity(),q,!1);0===q.targetScreenOffset.x&&0===q.targetScreenOffset.y||(this._viewOffset.set(q.targetScreenOffset.x,q.targetScreenOffset.y,0),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),this._globalOffset=L.j.TransformNormal(this._viewOffset,q._cameraTransformMatrix),j.origin.addInPlace(this._globalOffset));let d=0;return this._hitPlane&&(d=j.intersectsPlane(this._hitPlane)??0),j.origin.addInPlace(j.direction.scaleInPlace(d))}_zoomToMouse(q){const f=this.camera,j=1-f.inertia;if(f.lowerRadiusLimit){const d=f.lowerRadiusLimit??0;f.radius-(f.inertialRadiusOffset+q)/j<d&&(q=(f.radius-d)*j-f.inertialRadiusOffset)}if(f.upperRadiusLimit){const d=f.upperRadiusLimit??0;f.radius-(f.inertialRadiusOffset+q)/j>d&&(q=(f.radius-d)*j-f.inertialRadiusOffset)}const d=q/j/f.radius,g=this._getPosition(),h=L.f.kf[6];g.subtractToRef(f.target,h),h.scaleInPlace(d),h.scaleInPlace(j),this._inertialPanning.addInPlace(h),f.inertialRadiusOffset+=q}_zeroIfClose(q){Math.abs(q.x)<z.d&&(q.x=0),Math.abs(q.y)<z.d&&(q.y=0),Math.abs(q.z)<z.d&&(q.z=0)}}(0,d.b)([(0,g.O)()],n.prototype,"wheelPrecision",void 0),(0,d.b)([(0,g.O)()],n.prototype,"zoomToMouseLocation",void 0),(0,d.b)([(0,g.O)()],n.prototype,"wheelDeltaPercentage",void 0),E.c.ArcRotateCameraMouseWheelInput=n;class U extends E.d{constructor(q){super(q)}addMouseWheel(){return this.add(new n),this}addPointers(){return this.add(new e),this}addKeyboard(){return this.add(new I),this}}var Y=j(10965);function v(q,f){return isNaN(q)?f:q}H.d.AddNodeConstructor("ArcRotateCamera",((q,f)=>()=>new F(q,0,0,1,L.j.Zero(),f)));class F extends w.b{get target(){return this._target}set target(q){this.setTarget(q)}get targetHost(){return this._targetHost}set targetHost(q){q&&this.setTarget(q)}getTarget(){return this.target}get position(){return this._position}set position(q){this.setPosition(q)}set upVector(q){this._upToYMatrix||(this._yToUpMatrix=new L.b,this._upToYMatrix=new L.b,this._upVector=L.j.Zero()),q.normalize(),this._upVector.H(q),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){L.b.RotationAlignToRef(L.j.UpReadOnly,this._upVector,this._yToUpMatrix),L.b.RotationAlignToRef(this._upVector,L.j.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityX:0}set angularSensibilityX(q){const f=this.inputs.attached.pointers;f&&(f.angularSensibilityX=q)}get angularSensibilityY(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityY:0}set angularSensibilityY(q){const f=this.inputs.attached.pointers;f&&(f.angularSensibilityY=q)}get pinchPrecision(){const q=this.inputs.attached.pointers;return q?q.pinchPrecision:0}set pinchPrecision(q){const f=this.inputs.attached.pointers;f&&(f.pinchPrecision=q)}get pinchDeltaPercentage(){const q=this.inputs.attached.pointers;return q?q.pinchDeltaPercentage:0}set pinchDeltaPercentage(q){const f=this.inputs.attached.pointers;f&&(f.pinchDeltaPercentage=q)}get useNaturalPinchZoom(){const q=this.inputs.attached.pointers;return!!q&&q.useNaturalPinchZoom}set useNaturalPinchZoom(q){const f=this.inputs.attached.pointers;f&&(f.useNaturalPinchZoom=q)}get panningSensibility(){const q=this.inputs.attached.pointers;return q?q.panningSensibility:0}set panningSensibility(q){const f=this.inputs.attached.pointers;f&&(f.panningSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const f=this.inputs.attached.keyboard;f&&(f.keysUp=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const f=this.inputs.attached.keyboard;f&&(f.keysDown=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const f=this.inputs.attached.keyboard;f&&(f.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const f=this.inputs.attached.keyboard;f&&(f.keysRight=q)}get wheelPrecision(){const q=this.inputs.attached.mousewheel;return q?q.wheelPrecision:0}set wheelPrecision(q){const f=this.inputs.attached.mousewheel;f&&(f.wheelPrecision=q)}get zoomToMouseLocation(){const q=this.inputs.attached.mousewheel;return!!q&&q.zoomToMouseLocation}set zoomToMouseLocation(q){const f=this.inputs.attached.mousewheel;f&&(f.zoomToMouseLocation=q)}get wheelDeltaPercentage(){const q=this.inputs.attached.mousewheel;return q?q.wheelDeltaPercentage:0}set wheelDeltaPercentage(q){const f=this.inputs.attached.mousewheel;f&&(f.wheelDeltaPercentage=q)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(q){q!==this.useBouncingBehavior&&(q?(this._bouncingBehavior=new t,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(q){q!==this.useFramingBehavior&&(q?(this._framingBehavior=new O,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(q){q!==this.useAutoRotationBehavior&&(q?(this._autoRotationBehavior=new B,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(q,f,j,d,g,Q){var H;let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(q,L.j.Zero(),Q,r),H=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=L.j.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=L.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new L.b,this.panningAxis=new L.j(1,1,0),this._transformedDirection=new L.j,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new h.d,this.checkCollisions=!1,this.collisionRadius=new L.j(.5,.5,.5),this._previousPosition=L.j.Zero(),this._collisionVelocity=L.j.Zero(),this._newPosition=L.j.Zero(),this._computationVector=L.j.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new L.j(NaN,NaN,NaN),this._goalTargetScreenOffset=new L.i(NaN,NaN),this._onCollisionPositionChange=function(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j?(H.setPosition(f),H.pB&&H.pB(j)):H._previousPosition.H(H._position);const d=Math.cos(H.alpha),g=Math.sin(H.alpha),h=Math.cos(H.beta);let L=Math.sin(H.beta);0===L&&(L=1e-4);const Q=H._getTargetPosition();H._computationVector.Af(H.radius*d*L,H.radius*h,H.radius*g*L),Q.addToRef(H._computationVector,H._newPosition),H._position.H(H._newPosition);let r=H.upVector;H.allowUpsideDown&&H.beta<0&&(r=r.clone(),r=r.negate()),H._computeViewMatrix(H._position,Q,r),H._viewMatrix.addAtIndex(12,H.targetScreenOffset.x),H._viewMatrix.addAtIndex(13,H.targetScreenOffset.y),H._collisionTriggered=!1},this._target=L.j.Zero(),g&&this.setTarget(g),this.alpha=f,this.beta=j,this.radius=d,this.getViewMatrix(),this.inputs=new U(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new L.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=L.i.Zero()}_updateCache(q){q||super._updateCache(),this._cache._target.H(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.H(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const q=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?q.addToRef(this._targetBoundingCenter,this._target):this._target.H(q)}const q=this._getLockedTargetPosition();return q||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>z.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,h=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=h?this._currentInterpolationFactor=h:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=v(q,this._goalAlpha),this._goalBeta=v(f,this._goalBeta),this._goalRadius=v(j,this._goalRadius),this._goalTarget.set(v(d.x,this._goalTarget.x),v(d.y,this._goalTarget.y),v(d.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(v(g.x,this._goalTargetScreenOffset.x),v(g.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,Q.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,Q.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,Q.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,Q.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const g=arguments;f=s.h.BackCompatCameraNoPreventDefault(g),this._useCtrlForPanning=j,this._panningMouseButton=d,"boolean"===typeof g[0]&&(g.length>1&&(this._useCtrlForPanning=g[1]),g.length>2&&(this._panningMouseButton=g[2])),this.inputs.attachElement(f),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}qz(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let q=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){q=!0;const f=this.invertRotation?-1:1,j=this._calculateHandednessMultiplier();let d=this.inertialAlphaOffset*j;this.beta<0&&(d*=-1),this.alpha+=d*f,this.beta+=this.inertialBetaOffset*f,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<z.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<z.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*z.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){q=!0;const f=new L.j(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),f.multiplyInPlace(this.panningAxis),L.j.TransformNormalToRef(f,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const q=this.upVector,f=L.j.CrossToRef(this._transformedDirection,q,this._transformedDirection);L.j.CrossToRef(q,f,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);L.j.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.H(this._transformedDirection)}else{if(this.parent){const q=L.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.transposeToRef(q),L.j.TransformCoordinatesToRef(this._transformedDirection,q,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*z.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*z.d&&(this.inertialPanningY=0)}if(q)this.stopInterpolation();else if(this._isInterpolating){let q=!1;const f=this._scene.getEngine().getDeltaTime()/1e3,j=1-Math.pow(2,-f/this._currentInterpolationFactor),d=v(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const f=L.f.kf[0].set(v(this._goalTarget.x,this._target.x),v(this._goalTarget.y,this._target.y),v(this._goalTarget.z,this._target.z));L.j.LerpToRef(this.target,f,j,this._target),10*L.j.Distance(this.target,f)/d<z.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.H(f),this.setTarget(this.target,!1,!0,!0)):q=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const f=L.e.RotationAlphaBetaGammaToRef(v(this._goalAlpha,this.alpha),v(this._goalBeta,this.beta),0,L.f.Quaternion[0]),d=L.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,L.f.Quaternion[1]),g=L.e.SlerpToRef(d,f,j,L.f.Quaternion[2]);g.normalize();const h=g.toAlphaBetaGammaToRef(L.f.kf[0]);if(this.alpha=h.x,this.beta=h.y,g.isApprox(f,z.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const q=f.toAlphaBetaGammaToRef(L.f.kf[0]);this.alpha=q.x,this.beta=q.y}else q=!0}if(isNaN(this._goalRadius)||(this.radius+=(d-this.radius)*j,Math.abs(d/this.radius-1)<z.d?(this._goalRadius=NaN,this.radius=d):q=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const f=L.f.Vector2[0].set(v(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),v(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));L.i.LerpToRef(this.targetScreenOffset,f,j,this.targetScreenOffset),L.i.Distance(this.targetScreenOffset,f)<z.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.H(f)):q=!0}this._isInterpolating=q}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||L.j.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const q=this.alpha;var f,j;this.alpha=function(q){let f=Math.PI/2;return 0===q.x&&0===q.z||(f=Math.acos(q.x/Math.sqrt(Math.pow(q.x,2)+Math.pow(q.z,2)))),q.z<0&&(f=2*Math.PI-f),f}(this._computationVector),this.beta=(f=this._computationVector.y,j=this.radius,Math.acos(f/j));const d=Math.round((q-this.alpha)/(2*Math.PI));this.alpha+=2*d*Math.PI,this._checkLimits()}setPosition(q){this._position.equals(q)||(this._position.H(q),this.rebuildAnglesAndRadius())}setTarget(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(d=this.overrideCloneAlphaBetaRadius??d,q.Nf)f&&q.getBoundingInfo?this._targetBoundingCenter=q.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,q.Nf(),this._targetHost=q,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const f=q,d=this._getTargetPosition();if(d&&!j&&d.equals(f))return;this._targetHost=null,this._target=f,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}d||this.rebuildAnglesAndRadius()}_getViewMatrix(){const q=Math.cos(this.alpha),f=Math.sin(this.alpha),j=Math.cos(this.beta);let d=Math.sin(this.beta);0===d&&(d=1e-4),0===this.radius&&(this.radius=1e-4);const g=this._getTargetPosition();if(this._computationVector.Af(this.radius*q*d,this.radius*j,this.radius*f*d),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||L.j.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),g.addToRef(this._computationVector,this._newPosition),this.eq().collisionsEnabled&&this.checkCollisions){const q=this.eq().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.H(this._newPosition);let q=this.upVector;this.allowUpsideDown&&d<0&&(q=q.negate()),this._computeViewMatrix(this._position,g,q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.H(g),this._viewMatrix}zoomOn(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q||this.eq().meshes;const j=r.e.MinMax(q);let d=this._calculateLowerRadiusFromModelBoundingSphere(j.min,j.max);if(d=Math.max(Math.min(d,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=d*this.zoomOnFactor,this.mode===N.d.ORTHOGRAPHIC_CAMERA){const q=this.eq().getEngine().getAspectRatio(this),f=d*this.zoomOnFactor/2;this.orthoLeft=-f*q,this.orthoRight=f*q,this.orthoBottom=-f,this.orthoTop=f}this.focusOn({min:j.min,max:j.max,distance:d},f)}focusOn(q){let f,j,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===q.min){const d=q||this.eq().meshes;f=r.e.MinMax(d),j=L.j.Distance(f.min,f.max)}else{f=q,j=q.distance}this._target=r.e.Center(f),d||(this.maxZ=2*j)}createRigCamera(q,f){let j=0;switch(this.cameraRigMode){case N.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.d.RIG_MODE_VR:j=this._cameraRigParams.stereoHalfAngle*(0===f?1:-1);break;case N.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:j=this._cameraRigParams.stereoHalfAngle*(0===f?-1:1)}const d=new F(q,this.alpha+j,this.beta,this.radius,this._target,this.eq());return d._cameraRigParams={},d.isRigCamera=!0,d.rigParent=this,d.upVector=this.upVector,d.mode=this.mode,d.orthoLeft=this.orthoLeft,d.orthoRight=this.orthoRight,d.orthoBottom=this.orthoBottom,d.orthoTop=this.orthoTop,d}_updateRigCameras(){const q=this._rigCameras[0],f=this._rigCameras[1];switch(q.beta=f.beta=this.beta,this.cameraRigMode){case N.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.d.RIG_MODE_VR:q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case N.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const d=L.j.Distance(q,f),g=this.eq().getEngine().getAspectRatio(this),h=Math.tan(this.fov/2),Q=h*g,H=.5*d*j,r=H*Math.sqrt(1+1/(Q*Q)),u=H*Math.sqrt(1+1/(h*h));return Math.max(r,u)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,d.b)([(0,g.O)()],F.prototype,"alpha",void 0),(0,d.b)([(0,g.O)()],F.prototype,"beta",void 0),(0,d.b)([(0,g.O)()],F.prototype,"radius",void 0),(0,d.b)([(0,g.O)()],F.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,d.b)([(0,g.M)("target")],F.prototype,"_target",void 0),(0,d.b)([(0,g.x)("targetHost")],F.prototype,"_targetHost",void 0),(0,d.b)([(0,g.O)()],F.prototype,"inertialAlphaOffset",void 0),(0,d.b)([(0,g.O)()],F.prototype,"inertialBetaOffset",void 0),(0,d.b)([(0,g.O)()],F.prototype,"inertialRadiusOffset",void 0),(0,d.b)([(0,g.O)()],F.prototype,"lowerAlphaLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"upperAlphaLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"lowerBetaLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"upperBetaLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"lowerRadiusLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"upperRadiusLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"lowerTargetYLimit",void 0),(0,d.b)([(0,g.O)()],F.prototype,"inertialPanningX",void 0),(0,d.b)([(0,g.O)()],F.prototype,"inertialPanningY",void 0),(0,d.b)([(0,g.O)()],F.prototype,"pinchToPanMaxDistance",void 0),(0,d.b)([(0,g.O)()],F.prototype,"panningDistanceLimit",void 0),(0,d.b)([(0,g.M)()],F.prototype,"panningOriginTarget",void 0),(0,d.b)([(0,g.O)()],F.prototype,"panningInertia",void 0),(0,d.b)([(0,g.O)()],F.prototype,"zoomToMouseLocation",null),(0,d.b)([(0,g.O)()],F.prototype,"zoomOnFactor",void 0),(0,d.b)([(0,g.I)()],F.prototype,"targetScreenOffset",void 0),(0,d.b)([(0,g.O)()],F.prototype,"allowUpsideDown",void 0),(0,d.b)([(0,g.O)()],F.prototype,"useInputToRestoreState",void 0),(0,d.b)([(0,g.O)()],F.prototype,"restoreStateInterpolationFactor",void 0),(0,Y.f)("BABYLON.ArcRotateCamera",F)},12621:(q,f,j)=>{"use strict";j.d(f,{c:()=>L,d:()=>Q});var d=j(11005),g=j(11199),h=j(11293),L={};class Q{constructor(q){this.attachedToElement=!1,this.attached={},this.camera=q,this.checkInputs=()=>{}}add(q){const f=q.getSimpleName();this.attached[f]?d.e.Warn("camera input of type "+f+" already exists on camera"):(this.attached[f]=q,q.camera=this.camera,q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q))),this.attachedToElement&&q.attachControl(this.noPreventDefault))}remove(q){for(const f in this.attached){const j=this.attached[f];if(j===q)return j.qz(),j.camera=null,delete this.attached[f],void this.rebuildInputCheck()}}removeByType(q){for(const f in this.attached){const j=this.attached[f];j.getClassName()===q&&(j.qz(),j.camera=null,delete this.attached[f],this.rebuildInputCheck())}}_addCheckInputs(q){const f=this.checkInputs;return()=>{f(),q()}}attachInput(q){this.attachedToElement&&q.attachControl(this.noPreventDefault)}attachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){q=!h.d.ForceAttachControlToAlwaysPreventDefault&&q,this.attachedToElement=!0,this.noPreventDefault=q;for(const f in this.attached)this.attached[f].attachControl(q)}}detachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const f in this.attached)this.attached[f].qz(),q&&(this.attached[f].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const q in this.attached){const f=this.attached[q];f.checkInputs&&(this.checkInputs=this._addCheckInputs(f.checkInputs.bind(f)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(q){const f={};for(const j in this.attached){const q=this.attached[j],d=g.d.Serialize(q);f[q.getClassName()]=d}q.inputsmgr=f}parse(q){const f=q.inputsmgr;if(f){this.clear();for(const q in f){const j=L[q];if(j){const d=f[q],h=g.d.Parse((()=>new j),d,null);this.add(h)}}}else for(const j in this.attached){const f=L[this.attached[j].getClassName()];if(f){const d=g.d.Parse((()=>new f),q,null);this.remove(this.attached[j]),this.add(d)}}}}},12618:(q,f,j)=>{"use strict";j.d(f,{c:()=>S});var d=j(11125),g=j(11130),h=j(10941),L=j(11481),Q=j(12621),H=j(11526),r=j(10992);class u{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(q){q=r.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.eq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((f=>{const j=f.event;if(!j.metaKey)if(f.type===H.c.KEYDOWN){if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysUpward.indexOf(j.keyCode)||-1!==this.keysDownward.indexOf(j.keyCode)||-1!==this.keysRotateLeft.indexOf(j.keyCode)||-1!==this.keysRotateRight.indexOf(j.keyCode)||-1!==this.keysRotateUp.indexOf(j.keyCode)||-1!==this.keysRotateDown.indexOf(j.keyCode)){-1===this._keys.indexOf(j.keyCode)&&this._keys.push(j.keyCode),q||j.preventDefault()}}else if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysUpward.indexOf(j.keyCode)||-1!==this.keysDownward.indexOf(j.keyCode)||-1!==this.keysRotateLeft.indexOf(j.keyCode)||-1!==this.keysRotateRight.indexOf(j.keyCode)||-1!==this.keysRotateUp.indexOf(j.keyCode)||-1!==this.keysRotateDown.indexOf(j.keyCode)){const f=this._keys.indexOf(j.keyCode);f>=0&&this._keys.splice(f,1),q||j.preventDefault()}})))}qz(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let f=0;f<this._keys.length;f++){const j=this._keys[f],d=q._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(j)?q._localDirection.Af(-d,0,0):-1!==this.keysUp.indexOf(j)?q._localDirection.Af(0,0,d):-1!==this.keysRight.indexOf(j)?q._localDirection.Af(d,0,0):-1!==this.keysDown.indexOf(j)?q._localDirection.Af(0,0,-d):-1!==this.keysUpward.indexOf(j)?q._localDirection.Af(0,d,0):-1!==this.keysDownward.indexOf(j)?q._localDirection.Af(0,-d,0):-1!==this.keysRotateLeft.indexOf(j)?(q._localDirection.Af(0,0,0),q.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(j)?(q._localDirection.Af(0,0,0),q.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(j)?(q._localDirection.Af(0,0,0),q.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(j)&&(q._localDirection.Af(0,0,0),q.cameraRotation.x+=this._getLocalRotation()),q.eq().useRightHandedSystem&&(q._localDirection.z*=-1),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),h.j.TransformNormalToRef(q._localDirection,q._cameraTransformMatrix,q._transformedDirection),q.cameraDirection.addInPlace(q._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const q=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*q}}(0,d.b)([(0,g.O)()],u.prototype,"keysUp",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysUpward",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysDown",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysDownward",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysLeft",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysRight",void 0),(0,d.b)([(0,g.O)()],u.prototype,"rotationSpeed",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysRotateLeft",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysRotateRight",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysRotateUp",void 0),(0,d.b)([(0,g.O)()],u.prototype,"keysRotateDown",void 0),Q.c.FreeCameraKeyboardMoveInput=u;var X=j(10982),z=j(11524);class B{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=q,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new X.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(q){q=r.h.BackCompatCameraNoPreventDefault(arguments);const f=this.camera.getEngine(),j=f.getInputElement();this._pointerInput||(this._pointerInput=d=>{const g=d.event,h="touch"===g.pointerType;if(!this.touchEnabled&&h)return;if(d.type!==z.b.POINTERMOVE&&-1===this.buttons.indexOf(g.button))return;const L=g.target;if(d.type===z.b.POINTERDOWN){if(h&&-1!==this._activePointerId||!h&&-1!==this._currentActiveButton)return;this._activePointerId=g.pointerId;try{null===L||void 0===L||L.setPointerCapture(g.pointerId)}catch(Q){}-1===this._currentActiveButton&&(this._currentActiveButton=g.button),this._previousPosition={x:g.clientX,y:g.clientY},q||(g.preventDefault(),j&&j.focus()),f.isPointerLock&&this._onMouseMove&&this._onMouseMove(d.event)}else if(d.type===z.b.POINTERUP){if(h&&this._activePointerId!==g.pointerId||!h&&this._currentActiveButton!==g.button)return;try{null===L||void 0===L||L.releasePointerCapture(g.pointerId)}catch(Q){}this._currentActiveButton=-1,this._previousPosition=null,q||g.preventDefault(),this._activePointerId=-1}else if(d.type===z.b.POINTERMOVE&&(this._activePointerId===g.pointerId||!h))if(f.isPointerLock&&this._onMouseMove)this._onMouseMove(d.event);else if(this._previousPosition){const f=this.camera._calculateHandednessMultiplier(),j=(g.clientX-this._previousPosition.x)*f,d=g.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=j/this.angularSensibility,this.camera.cameraRotation.x+=d/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:j,offsetY:d}),this._previousPosition={x:g.clientX,y:g.clientY},q||g.preventDefault()}}),this._onMouseMove=j=>{if(!f.isPointerLock)return;const d=this.camera._calculateHandednessMultiplier(),g=j.movementX*d;this.camera.cameraRotation.y+=g/this.angularSensibility;const h=j.movementY;this.camera.cameraRotation.x+=h/this.angularSensibility,this._previousPosition=null,q||j.preventDefault()},this._observer=this.camera.eq()._inputManager._addCameraPointerObserver(this._pointerInput,z.b.POINTERDOWN|z.b.POINTERUP|z.b.POINTERMOVE),j&&(this._contextMenuBind=q=>this.onContextMenu(q),j.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(q){q.preventDefault()}qz(){if(this._observer){if(this.camera.eq()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,d.b)([(0,g.O)()],B.prototype,"buttons",void 0),(0,d.b)([(0,g.O)()],B.prototype,"angularSensibility",void 0),Q.c.FreeCameraMouseInput=B;var D,i=j(11529);class t{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new X.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(q){q=r.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=f=>{if(f.type!==z.b.POINTERWHEEL)return;const j=f.event,d=j.deltaMode===i.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*d*j.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*d*j.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*d*j.deltaZ/this._normalize,j.preventDefault&&(q||j.preventDefault())},this._observer=this.camera.eq()._inputManager._addCameraPointerObserver(this._wheel,z.b.POINTERWHEEL)}qz(){this._observer&&(this.camera.eq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,d.b)([(0,g.O)()],t.prototype,"wheelPrecisionX",void 0),(0,d.b)([(0,g.O)()],t.prototype,"wheelPrecisionY",void 0),(0,d.b)([(0,g.O)()],t.prototype,"wheelPrecisionZ",void 0),function(q){q[q.MoveRelative=0]="MoveRelative",q[q.RotateRelative=1]="RotateRelative",q[q.MoveScene=2]="MoveScene"}(D||(D={}));class O extends t{constructor(){super(...arguments),this._moveRelative=h.j.Zero(),this._rotateRelative=h.j.Zero(),this._moveScene=h.j.Zero(),this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(q){null===q&&this._wheelXAction!==D.MoveRelative||(this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=q)}get wheelXMoveRelative(){return this._wheelXAction!==D.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(q){null===q&&this._wheelYAction!==D.MoveRelative||(this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=q)}get wheelYMoveRelative(){return this._wheelYAction!==D.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(q){null===q&&this._wheelZAction!==D.MoveRelative||(this._wheelZAction=D.MoveRelative,this._wheelZActionCoordinate=q)}get wheelZMoveRelative(){return this._wheelZAction!==D.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(q){null===q&&this._wheelXAction!==D.RotateRelative||(this._wheelXAction=D.RotateRelative,this._wheelXActionCoordinate=q)}get wheelXRotateRelative(){return this._wheelXAction!==D.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(q){null===q&&this._wheelYAction!==D.RotateRelative||(this._wheelYAction=D.RotateRelative,this._wheelYActionCoordinate=q)}get wheelYRotateRelative(){return this._wheelYAction!==D.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(q){null===q&&this._wheelZAction!==D.RotateRelative||(this._wheelZAction=D.RotateRelative,this._wheelZActionCoordinate=q)}get wheelZRotateRelative(){return this._wheelZAction!==D.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(q){null===q&&this._wheelXAction!==D.MoveScene||(this._wheelXAction=D.MoveScene,this._wheelXActionCoordinate=q)}get wheelXMoveScene(){return this._wheelXAction!==D.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(q){null===q&&this._wheelYAction!==D.MoveScene||(this._wheelYAction=D.MoveScene,this._wheelYActionCoordinate=q)}get wheelYMoveScene(){return this._wheelYAction!==D.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(q){null===q&&this._wheelZAction!==D.MoveScene||(this._wheelZAction=D.MoveScene,this._wheelZActionCoordinate=q)}get wheelZMoveScene(){return this._wheelZAction!==D.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.cf(0),this._rotateRelative.cf(0),this._moveScene.cf(0),this._updateCamera(),this.camera.eq().useRightHandedSystem&&(this._moveRelative.z*=-1);const q=h.b.Zero();this.camera.getViewMatrix().invertToRef(q);const f=h.j.Zero();h.j.TransformNormalToRef(this._moveRelative,q,f),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(f),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(q,f,j){if(0===q)return;if(null===f||null===j)return;let d=null;switch(f){case D.MoveRelative:d=this._moveRelative;break;case D.RotateRelative:d=this._rotateRelative;break;case D.MoveScene:d=this._moveScene}switch(j){case 0:d.set(q,0,0);break;case 1:d.set(0,q,0);break;case 2:d.set(0,0,q)}}}(0,d.b)([(0,g.O)()],O.prototype,"wheelXMoveRelative",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelYMoveRelative",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelZMoveRelative",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelXRotateRelative",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelYRotateRelative",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelZRotateRelative",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelXMoveScene",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelYMoveScene",null),(0,d.b)([(0,g.O)()],O.prototype,"wheelZMoveScene",null),Q.c.FreeCameraMouseWheelInput=O;class N{constructor(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=q,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=r.h.IsSafari()}attachControl(q){q=r.h.BackCompatCameraNoPreventDefault(arguments);let f=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=j=>{const d=j.event,g="mouse"===d.pointerType||this._isSafari&&"undefined"===typeof d.pointerType;if(this.allowMouse||!g)if(j.type===z.b.POINTERDOWN){if(q||d.preventDefault(),this._pointerPressed.push(d.pointerId),1!==this._pointerPressed.length)return;f={x:d.clientX,y:d.clientY}}else if(j.type===z.b.POINTERUP){q||d.preventDefault();const j=this._pointerPressed.indexOf(d.pointerId);if(-1===j)return;if(this._pointerPressed.splice(j,1),0!=j)return;f=null,this._offsetX=null,this._offsetY=null}else if(j.type===z.b.POINTERMOVE){if(q||d.preventDefault(),!f)return;if(0!=this._pointerPressed.indexOf(d.pointerId))return;this._offsetX=d.clientX-f.x,this._offsetY=-(d.clientY-f.y)}}),this._observer=this.camera.eq()._inputManager._addCameraPointerObserver(this._pointerInput,z.b.POINTERDOWN|z.b.POINTERUP|z.b.POINTERMOVE),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.addEventListener("blur",this._onLostFocus)}}qz(){if(this._pointerInput){if(this._observer&&(this.camera.eq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const q=this.camera,f=q._calculateHandednessMultiplier();q.cameraRotation.y=f*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)q.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const f=q._computeLocalCameraSpeed(),j=new h.j(0,0,0!==this.touchMoveSensibility?f*this._offsetY/this.touchMoveSensibility:0);h.b.RotationYawPitchRollToRef(q.rotation.y,q.rotation.x,0,q._cameraRotationMatrix),q.cameraDirection.addInPlace(h.j.TransformCoordinates(j,q._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,d.b)([(0,g.O)()],N.prototype,"touchAngularSensibility",void 0),(0,d.b)([(0,g.O)()],N.prototype,"touchMoveSensibility",void 0),Q.c.FreeCameraTouchInput=N;class w extends Q.d{constructor(q){super(q),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new u),this}addMouse(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new B(q),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new O,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new N),this}clear(){super.clear(),this._mouseInput=null}}var E=j(10965),s=j(11065);class S extends L.b{get angularSensibility(){const q=this.inputs.attached.mouse;return q?q.angularSensibility:0}set angularSensibility(q){const f=this.inputs.attached.mouse;f&&(f.angularSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const f=this.inputs.attached.keyboard;f&&(f.keysUp=q)}get keysUpward(){const q=this.inputs.attached.keyboard;return q?q.keysUpward:[]}set keysUpward(q){const f=this.inputs.attached.keyboard;f&&(f.keysUpward=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const f=this.inputs.attached.keyboard;f&&(f.keysDown=q)}get keysDownward(){const q=this.inputs.attached.keyboard;return q?q.keysDownward:[]}set keysDownward(q){const f=this.inputs.attached.keyboard;f&&(f.keysDownward=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const f=this.inputs.attached.keyboard;f&&(f.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const f=this.inputs.attached.keyboard;f&&(f.keysRight=q)}get keysRotateLeft(){const q=this.inputs.attached.keyboard;return q?q.keysRotateLeft:[]}set keysRotateLeft(q){const f=this.inputs.attached.keyboard;f&&(f.keysRotateLeft=q)}get keysRotateRight(){const q=this.inputs.attached.keyboard;return q?q.keysRotateRight:[]}set keysRotateRight(q){const f=this.inputs.attached.keyboard;f&&(f.keysRotateRight=q)}get keysRotateUp(){const q=this.inputs.attached.keyboard;return q?q.keysRotateUp:[]}set keysRotateUp(q){const f=this.inputs.attached.keyboard;f&&(f.keysRotateUp=q)}get keysRotateDown(){const q=this.inputs.attached.keyboard;return q?q.keysRotateDown:[]}set keysRotateDown(q){const f=this.inputs.attached.keyboard;f&&(f.keysRotateDown=q)}constructor(q,f,j){var d;super(q,f,j,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),d=this,this.ellipsoid=new h.j(.5,1,.5),this.ellipsoidOffset=new h.j(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=h.j.Zero(),this._diffPosition=h.j.Zero(),this._newPosition=h.j.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d._newPosition.H(f),d._newPosition.subtractToRef(d._oldPosition,d._diffPosition),d._diffPosition.length()>s.b.CollisionsEpsilon&&(d.position.addToRef(d._diffPosition,d._deferredPositionUpdate),d._deferOnly?d._deferredUpdated=!0:d.position.H(d._deferredPositionUpdate),d.pB&&j&&d.pB(j))},this.inputs=new w(this),this.inputs.addKeyboard().addMouse()}attachControl(q,f){f=r.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(f)}qz(){this.inputs.detachElement(),this.cameraDirection=new h.j(0,0,0),this.cameraRotation=new h.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(q){this._collisionMask=isNaN(q)?-1:q}_collideWithWorld(q){let f;f=this.parent?h.j.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,f.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const j=this.eq().collisionCoordinator;this._collider||(this._collider=j.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let d=q;this.applyGravity&&(d=q.add(this.eq().gravity)),j.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=h.j.Zero(),this._transformedDirection=h.j.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(q){this._needMoveForGravity=q}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.eq().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Yd"}}(0,d.b)([(0,g.M)()],S.prototype,"ellipsoid",void 0),(0,d.b)([(0,g.M)()],S.prototype,"ellipsoidOffset",void 0),(0,d.b)([(0,g.O)()],S.prototype,"checkCollisions",void 0),(0,d.b)([(0,g.O)()],S.prototype,"applyGravity",void 0),(0,E.f)("BABYLON.FreeCamera",S)},13202:(q,f,j)=>{"use strict";j.d(f,{b:()=>h});var d=j(11298),g=j(13210);class h{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=j,this.EX=[],this._maxBlockCapacity=f||64,this._selectionContent=new d.c(1024),this._creationFunc=q}update(q,f,j){g.b._CreateBlocks(q,f,j,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Iu(q){for(let f=0;f<this.Au.length;f++){this.Au[f].addEntry(q)}}Zu(q){for(let f=0;f<this.Au.length;f++){this.Au[f].removeEntry(q)}}select(q,f){this._selectionContent.reset();for(let j=0;j<this.Au.length;j++){this.Au[j].select(q,this._selectionContent,f)}return f?this._selectionContent.concat(this.EX):this._selectionContent.concatWithNoDuplicate(this.EX),this._selectionContent}intersects(q,f,j){this._selectionContent.reset();for(let d=0;d<this.Au.length;d++){this.Au[d].intersects(q,f,this._selectionContent,j)}return j?this._selectionContent.concat(this.EX):this._selectionContent.concatWithNoDuplicate(this.EX),this._selectionContent}intersectsRay(q){this._selectionContent.reset();for(let f=0;f<this.Au.length;f++){this.Au[f].intersectsRay(q,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.EX),this._selectionContent}}h.CreationFuncForMeshes=(q,f)=>{const j=q.getBoundingInfo();!q.isBlocked&&j.boundingBox.intersectsMinMax(f.ZX,f.IX)&&f.entries.push(q)},h.CreationFuncForSubMeshes=(q,f)=>{q.getBoundingInfo().boundingBox.intersectsMinMax(f.ZX,f.IX)&&f.entries.push(q)}},13210:(q,f,j)=>{"use strict";j.d(f,{b:()=>h});var d=j(10941),g=j(11166);class h{constructor(q,f,j,d,g,h){this.entries=[],this.TX=new Array,this._capacity=j,this._depth=d,this._maxDepth=g,this._creationFunc=h,this._minPoint=q,this._maxPoint=f,this.TX.push(q.clone()),this.TX.push(f.clone()),this.TX.push(q.clone()),this.TX[2].x=f.x,this.TX.push(q.clone()),this.TX[3].y=f.y,this.TX.push(q.clone()),this.TX[4].z=f.z,this.TX.push(f.clone()),this.TX[5].z=q.z,this.TX.push(f.clone()),this.TX[6].x=q.x,this.TX.push(f.clone()),this.TX[7].y=q.y}get Zf(){return this._capacity}get ZX(){return this._minPoint}get IX(){return this._maxPoint}addEntry(q){if(this.Au)for(let f=0;f<this.Au.length;f++){this.Au[f].addEntry(q)}else this._creationFunc(q,this),this.entries.length>this.Zf&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(q){if(this.Au){for(let f=0;f<this.Au.length;f++){this.Au[f].removeEntry(q)}return}const f=this.entries.indexOf(q);f>-1&&this.entries.splice(f,1)}addEntries(q){for(let f=0;f<q.length;f++){const j=q[f];this.addEntry(j)}}select(q,f,j){if(g.e.IsInFrustum(this.TX,q)){if(this.Au){for(let d=0;d<this.Au.length;d++){this.Au[d].select(q,f,j)}return}j?f.concat(this.entries):f.concatWithNoDuplicate(this.entries)}}intersects(q,f,j,d){if(g.e.IntersectsSphere(this._minPoint,this._maxPoint,q,f)){if(this.Au){for(let g=0;g<this.Au.length;g++){this.Au[g].intersects(q,f,j,d)}return}d?j.concat(this.entries):j.concatWithNoDuplicate(this.entries)}}intersectsRay(q,f){if(q.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Au){for(let j=0;j<this.Au.length;j++){this.Au[j].intersectsRay(q,f)}return}f.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){h._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(q,f,j,g,L,Q,H,r){H.Au=new Array;const u=new d.j((f.x-q.x)/2,(f.y-q.y)/2,(f.z-q.z)/2);for(let d=0;d<2;d++)for(let f=0;f<2;f++)for(let X=0;X<2;X++){const z=q.add(u.multiplyByFloats(d,f,X)),B=q.add(u.multiplyByFloats(d+1,f+1,X+1)),D=new h(z,B,g,L+1,Q,r);D.addEntries(j),H.Au.push(D)}}}},13217:(q,f,j)=>{"use strict";j.d(f,{b:()=>u});var d=j(11506),g=j(10941),h=j(11249),L=j(12402),Q=j(11327),H=j(13202),r=j(10980);d.b.prototype.createOrUpdateSelectionOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,j=this._getComponent(Q.b.NAME_OCTREE);j||(j=new u(this),this.if(j)),this.NX||(this.NX=new H.b(H.b.CreationFuncForMeshes,q,f));const d=this.getWorldExtends();return this.NX.update(d.min,d.max,this.meshes),this.NX},Object.defineProperty(d.b.prototype,"selectionOctree",{get:function(){return this.NX},enumerable:!0,configurable:!0}),h.e.prototype.createOrUpdateSubmeshesOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const j=this.eq();let d=j._getComponent(Q.b.NAME_OCTREE);d||(d=new u(j),j.if(d)),this._submeshesOctree||(this._submeshesOctree=new H.b(H.b.CreationFuncForSubMeshes,q,f)),this.Nf(!0);const g=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(g.minimumWorld,g.maximumWorld,this.Qd),this._submeshesOctree};class u{constructor(q){this.name=Q.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new L.b(g.j.Zero(),new g.j(1,1,1)),(q=q||r.d.LastCreatedScene)&&(this.Sf=q,this.Sf.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Sf.getActiveSubMeshCandidates=q=>this.getActiveSubMeshCandidates(q),this.Sf.getCollidingSubMeshCandidates=(q,f)=>this.getCollidingSubMeshCandidates(q,f),this.Sf.getIntersectingSubMeshCandidates=(q,f)=>this.getIntersectingSubMeshCandidates(q,f))}register(){this.Sf.onMeshRemovedObservable.add((q=>{const f=this.Sf.selectionOctree;if(void 0!==f&&null!==f){const j=f.EX.indexOf(q);-1!==j&&f.EX.splice(j,1)}})),this.Sf.onMeshImportedObservable.add((q=>{const f=this.Sf.selectionOctree;void 0!==f&&null!==f&&f.Iu(q)}))}getActiveMeshCandidates(){var q;return(null===(q=this.Sf.NX)||void 0===q?void 0:q.select(this.Sf.frustumPlanes))||this.Sf._getDefaultMeshCandidates()}getActiveSubMeshCandidates(q){if(q._submeshesOctree&&q.useOctreeForRenderingSelection){return q._submeshesOctree.select(this.Sf.frustumPlanes)}return this.Sf._getDefaultSubMeshCandidates(q)}getIntersectingSubMeshCandidates(q,f){if(q._submeshesOctree&&q.useOctreeForPicking){L.b.TransformToRef(f,q.getWorldMatrix(),this._tempRay);return q._submeshesOctree.intersectsRay(this._tempRay)}return this.Sf._getDefaultSubMeshCandidates(q)}getCollidingSubMeshCandidates(q,f){if(q._submeshesOctree&&q.useOctreeForCollisions){const j=f._velocityWorldLength+Math.max(f._radius.x,f._radius.y,f._radius.z);return q._submeshesOctree.intersects(f._basePointWorld,j)}return this.Sf._getDefaultSubMeshCandidates(q)}rebuild(){}dispose(){}}},12402:(q,f,j)=>{"use strict";j.d(f,{b:()=>B});var d=j(11506),g=j(11293),h=j(10950),L=j(10941),Q=j(10958),H=j(11161),r=j(11268),u=j(10980),X=j(11534);const z={internalPickerForMesh:void 0};class B{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.d;this.origin=q,this.direction=f,this.length=j,this.epsilon=d}clone(){return new B(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=B._TmpVector3[0].Af(q.x-j,q.y-j,q.z-j),g=B._TmpVector3[1].Af(f.x+j,f.y+j,f.z+j);let h,L,Q,H,r=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<d.x||this.origin.x>g.x)return!1}else if(h=1/this.direction.x,L=(d.x-this.origin.x)*h,Q=(g.x-this.origin.x)*h,Q===-1/0&&(Q=1/0),L>Q&&(H=L,L=Q,Q=H),r=Math.max(L,r),u=Math.min(Q,u),r>u)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<d.y||this.origin.y>g.y)return!1}else if(h=1/this.direction.y,L=(d.y-this.origin.y)*h,Q=(g.y-this.origin.y)*h,Q===-1/0&&(Q=1/0),L>Q&&(H=L,L=Q,Q=H),r=Math.max(L,r),u=Math.min(Q,u),r>u)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<d.z||this.origin.z>g.z)return!1}else if(h=1/this.direction.z,L=(d.z-this.origin.z)*h,Q=(g.z-this.origin.z)*h,Q===-1/0&&(Q=1/0),L>Q&&(H=L,L=Q,Q=H),r=Math.max(L,r),u=Math.min(Q,u),r>u)return!1;return!0}intersectsBox(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(q.minimum,q.maximum,f)}intersectsSphere(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=q.center.x-this.origin.x,d=q.center.y-this.origin.y,g=q.center.z-this.origin.z,h=j*j+d*d+g*g,L=q.radius+f,Q=L*L;if(h<=Q)return!0;const H=j*this.direction.x+d*this.direction.y+g*this.direction.z;if(H<0)return!1;return h-H*H<=Q}intersectsTriangle(q,f,j){const d=B._TmpVector3[0],g=B._TmpVector3[1],h=B._TmpVector3[2],Q=B._TmpVector3[3],r=B._TmpVector3[4];f.subtractToRef(q,d),j.subtractToRef(q,g),L.j.CrossToRef(this.direction,g,h);const u=L.j.Dot(d,h);if(0===u)return null;const X=1/u;this.origin.subtractToRef(q,Q);const z=L.j.Dot(Q,h)*X;if(z<-this.epsilon||z>1+this.epsilon)return null;L.j.CrossToRef(Q,d,r);const D=L.j.Dot(this.direction,r)*X;if(D<-this.epsilon||z+D>1+this.epsilon)return null;const i=L.j.Dot(g,r)*X;return i>this.length?null:new H.d(1-z-D,z,i)}intersectsPlane(q){let f;const j=L.j.Dot(q.df,this.direction);if(Math.abs(j)<9.99999997475243e-7)return null;{const d=L.j.Dot(q.df,this.origin);return f=(-q.d-d)/j,f<0?f<-9.99999997475243e-7?null:0:f}}intersectsAxis(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(q){case"y":{const q=(this.origin.y-f)/this.direction.y;return q>0?null:new L.j(this.origin.x+this.direction.x*-q,f,this.origin.z+this.direction.z*-q)}case"x":{const q=(this.origin.x-f)/this.direction.x;return q>0?null:new L.j(f,this.origin.y+this.direction.y*-q,this.origin.z+this.direction.z*-q)}case"z":{const q=(this.origin.z-f)/this.direction.z;return q>0?null:new L.j(this.origin.x+this.direction.x*-q,this.origin.y+this.direction.y*-q,f)}default:return null}}intersectsMesh(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=L.f.Matrix[0];return q.getWorldMatrix().invertToRef(Q),this._tmpRay?B.TransformToRef(this,Q,this._tmpRay):this._tmpRay=B.Transform(this,Q),q.intersects(this._tmpRay,f,j,d,g,h)}intersectsMeshes(q,f,j){j?j.length=0:j=[];for(let d=0;d<q.length;d++){const g=this.intersectsMesh(q[d],f);g.hit&&j.push(g)}return j.sort(this._comparePickingInfo),j}_comparePickingInfo(q,f){return q.distance<f.distance?-1:q.distance>f.distance?1:0}intersectionSegment(q,f,j){const d=this.origin,g=L.f.kf[0],h=L.f.kf[1],Q=L.f.kf[2],H=L.f.kf[3];f.subtractToRef(q,g),this.direction.scaleToRef(B._Rayl,Q),d.addToRef(Q,h),q.subtractToRef(d,H);const r=L.j.Dot(g,g),u=L.j.Dot(g,Q),X=L.j.Dot(Q,Q),z=L.j.Dot(g,H),D=L.j.Dot(Q,H),i=r*X-u*u;let t,O,N=i,w=i;i<B._Smallnum?(t=0,N=1,O=D,w=X):(t=u*D-X*z,O=r*D-u*z,t<0?(t=0,O=D,w=X):t>N&&(t=N,O=D+u,w=X)),O<0?(O=0,-z<0?t=0:-z>r?t=N:(t=-z,N=r)):O>w&&(O=w,-z+u<0?t=0:-z+u>r?t=N:(t=-z+u,N=r));const E=Math.abs(t)<B._Smallnum?0:t/N,s=Math.abs(O)<B._Smallnum?0:O/w,S=L.f.kf[4];Q.scaleToRef(s,S);const e=L.f.kf[5];g.scaleToRef(E,e),e.addInPlace(H);const Z=L.f.kf[6];e.subtractToRef(S,Z);return s>0&&s<=this.length&&Z.lengthSquared()<j*j?e.length():-1}update(q,f,j,d,g,h,Q){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){B._RayDistant||(B._RayDistant=B.Zero()),B._RayDistant.unprojectRayToRef(q,f,j,d,L.b.IdentityReadOnly,h,Q);const H=L.f.Matrix[0];g.invertToRef(H),B.TransformToRef(B._RayDistant,H,this)}else this.unprojectRayToRef(q,f,j,d,g,h,Q);return this}static Zero(){return new B(L.j.Zero(),L.j.Zero())}static CreateNew(q,f,j,d,g,h,L){return B.Zero().update(q,f,j,d,g,h,L)}static CreateNewFromTo(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.b.IdentityReadOnly;const d=new B(new L.j(0,0,0),new L.j(0,0,0));return B.CreateFromToToRef(q,f,d,j)}static CreateFromToToRef(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.b.IdentityReadOnly;j.origin.H(q);const g=f.subtractToRef(q,j.direction),h=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);return j.length=h,j.direction.normalize(),B.TransformToRef(j,d,j)}static Transform(q,f){const j=new B(new L.j(0,0,0),new L.j(0,0,0));return B.TransformToRef(q,f,j),j}static TransformToRef(q,f,j){L.j.TransformCoordinatesToRef(q.origin,f,j.origin),L.j.TransformNormalToRef(q.direction,f,j.direction),j.length=q.length,j.epsilon=q.epsilon;const d=j.direction,g=d.length();if(0!==g&&1!==g){const q=1/g;d.x*=q,d.y*=q,d.z*=q,j.length*=g}return j}unprojectRayToRef(q,f,j,d,g,h,Q){const H=L.f.Matrix[0];g.multiplyToRef(h,H),H.multiplyToRef(Q,H),H.invert();const r=u.d.LastCreatedEngine,X=L.f.kf[0];X.x=q/j*2-1,X.y=-(f/d*2-1),X.z=null!==r&&void 0!==r&&r.useReverseDepthBuffer?1:null!==r&&void 0!==r&&r.isNDCHalfZRange?0:-1;const z=L.f.kf[1].Af(X.x,X.y,1-1e-8),B=L.f.kf[2],D=L.f.kf[3];L.j._UnprojectFromInvertedMatrixToRef(X,H,B),L.j._UnprojectFromInvertedMatrixToRef(z,H,D),this.origin.H(B),D.subtractToRef(B,this.direction),this.direction.normalize()}}function D(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const L=B.Zero();return i(q,f,j,d,L,g,h),L}function i(q,f,j,d,g,h){let Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const r=q.getEngine();if(!h&&!(h=q.activeCamera))return q;const u=h.viewport,X=r.getRenderHeight(),{x:z,y:B,width:D,height:i}=u.toGlobal(r.getRenderWidth(),X),t=1/r.getHardwareScalingLevel();return f=f*t-z,j=j*t-(X-B-i),g.update(f,j,D,i,d||L.b.IdentityReadOnly,Q?L.b.IdentityReadOnly:h.getViewMatrix(),h.getProjectionMatrix(),H),q}function t(q,f,j,d,g){if(!r.d)return q;const h=q.getEngine();if(!g&&!(g=q.activeCamera))throw new Error("Active camera not set");const Q=g.viewport,H=h.getRenderHeight(),{x:u,y:X,width:z,height:B}=Q.toGlobal(h.getRenderWidth(),H),D=L.b.Identity(),i=1/h.getHardwareScalingLevel();return f=f*i-u,j=j*i-(H-X-B),d.update(f,j,z,B,D,D,g.getProjectionMatrix()),q}function O(q,f,j,d,g,h,L,Q){const H=f(d,j.enableDistantPicking),r=j.intersects(H,g,L,h,d,Q);return r&&r.hit?!g&&null!=q&&r.distance>=q.distance?null:r:null}function N(q,f,j,d,g,h){let Q=null;const H=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),u=q.cameraToUseForPointers||q.activeCamera,X=z.internalPickerForMesh||O;for(let r=0;r<q.meshes.length;r++){const z=q.meshes[r];if(j){if(!j(z,-1))continue}else if(!z.isEnabled()||!z.isVisible||!z.Xr)continue;const B=H&&z.isWorldMatrixCameraDependent(),D=z.Nf(B,u);if(z.hasThinInstances&&z.thinInstanceEnablePicking){const q=X(Q,f,z,D,!0,!0,h);if(q){if(g)return q;const H=L.f.Matrix[1],r=z.thinInstanceGetWorldMatrices();for(let q=0;q<r.length;q++){if(j&&!j(z,q))continue;r[q].multiplyToRef(D,H);const L=X(Q,f,z,H,d,g,h,!0);if(L&&(Q=L,Q.thinInstanceIndex=q,d))return Q}}}else{const q=X(Q,f,z,D,d,g,h);if(q&&(Q=q,d))return Q}}return Q||new r.d}function w(q,f,j,d){if(!r.d)return null;const g=[],h=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),Q=q.cameraToUseForPointers||q.activeCamera,H=z.internalPickerForMesh||O;for(let r=0;r<q.meshes.length;r++){const u=q.meshes[r];if(j){if(!j(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.Xr)continue;const X=h&&u.isWorldMatrixCameraDependent(),z=u.Nf(X,Q);if(u.hasThinInstances&&u.thinInstanceEnablePicking){if(H(null,f,u,z,!0,!0,d)){const q=L.f.Matrix[1],h=u.thinInstanceGetWorldMatrices();for(let L=0;L<h.length;L++){if(j&&!j(u,L))continue;h[L].multiplyToRef(z,q);const Q=H(null,f,u,q,!1,!1,d,!0);Q&&(Q.thinInstanceIndex=L,g.push(Q))}}}else{const q=H(null,f,u,z,!1,!1,d);q&&g.push(q)}}return g}function E(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;d||(d=q.getWorldMatrix()),f.length=j,g?f.origin.H(g):f.origin.H(q.position);const h=L.f.kf[2];h.set(0,0,q._scene.useRightHandedSystem?-1:1);const Q=L.f.kf[3];return L.j.TransformNormalToRef(h,d,Q),L.j.NormalizeToRef(Q,f.direction),f}var s,S;B._TmpVector3=(0,Q.e)(6,L.j.Zero),B._RayDistant=B.Zero(),B._Smallnum=1e-8,B._Rayl=1e9,s=d.b,(S=g.d)&&(S.prototype.getForwardRay=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;return E(this,new B(L.j.Zero(),L.j.Zero(),q),q,f,j)},S.prototype.getForwardRayToRef=function(q){return E(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),s&&(X.d._IsPickingAvailable=!0,s.prototype.createPickingRay=function(q,f,j,d){return D(this,q,f,j,d,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),d.b.prototype.createPickingRayToRef=function(q,f,j,d,g){return i(this,q,f,j,d,g,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},d.b.prototype.createPickingRayInCameraSpace=function(q,f,j){return function(q,f,j,d){const g=B.Zero();return t(q,f,j,g,d),g}(this,q,f,j)},d.b.prototype.createPickingRayInCameraSpaceToRef=function(q,f,j,d){return t(this,q,f,j,d)},d.b.prototype.pickWithBoundingInfo=function(q,f,j,d,g){return function(q,f,j,d,g,h){if(!r.d)return null;const Q=N(q,(d=>(q._tempPickingRay||(q._tempPickingRay=B.Zero()),i(q,f,j,d,q._tempPickingRay,h||null),q._tempPickingRay)),d,g,!0);return Q&&(Q.ray=D(q,f,j,L.b.Identity(),h||null)),Q}(this,q,f,j,d,g)},d.b.prototype.Sj=function(q,f,j,d,g,h){return function(q,f,j,d,g,h,Q){const H=N(q,((d,g)=>(q._tempPickingRay||(q._tempPickingRay=B.Zero()),i(q,f,j,d,q._tempPickingRay,h||null,!1,g),q._tempPickingRay)),d,g,!1,Q);return H&&(H.ray=D(q,f,j,L.b.Identity(),h||null)),H}(this,q,f,j,d,g,h)},d.b.prototype.pickWithRay=function(q,f,j,d){return function(q,f,j,d,g){const h=N(q,(j=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=L.b.Identity()),j.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=B.Zero()),B.TransformToRef(f,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),j,d,!1,g);return h&&(h.ray=f),h}(this,q,f,j,d)},d.b.prototype.multiPick=function(q,f,j,d,g){return function(q,f,j,d,g,h){return w(q,(d=>D(q,f,j,d,g||null)),d,h)}(this,q,f,j,d,g)},d.b.prototype.multiPickWithRay=function(q,f,j){return function(q,f,j,d){return w(q,(j=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=L.b.Identity()),j.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=B.Zero()),B.TransformToRef(f,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),j,d)}(this,q,f,j)}},12676:(q,f,j)=>{"use strict";var d=j(11090),g=j(11005),h=j(11030),L=j(11105),Q=j(11065),H=j(11096);Q.b.prototype._partialLoadFile=function(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(q,(q=>{j[f]=q,j._internalCount++,6===j._internalCount&&d(j)}),void 0,void 0,!0,((q,f)=>{g&&q&&g(q.status+" "+q.statusText,f)}))},Q.b.prototype._cascadeLoadFiles=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const g=[];g._internalCount=0;for(let h=0;h<6;h++)this._partialLoadFile(j[h],h,g,f,d)},Q.b.prototype._cascadeLoadImgs=function(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5?arguments[5]:void 0;const L=[];L._internalCount=0;for(let Q=0;Q<6;Q++)this._partialLoadImg(d[Q],Q,L,q,f,j,g,h)},Q.b.prototype._partialLoadImg=function(q,f,j,d,g,Q){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0;const u=(0,L.d)();(0,h.p)(q,(q=>{j[f]=q,j._internalCount++,d&&d.removePendingData(u),6===j._internalCount&&Q&&Q(g,j)}),((q,f)=>{d&&d.removePendingData(u),H&&H(q,f)}),d?d.offlineProvider:null,r),d&&d.addPendingData(u)},Q.b.prototype.createCubeTextureBase=function(q,f,j,h){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,i=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,t=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,O=arguments.length>14&&void 0!==arguments[14]&&arguments[14],N=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const w=D||new d.c(this,7);w.isCube=!0,w.url=q,w.generateMipMaps=!h,w._lodGenerationScale=z,w._lodGenerationOffset=B,w._useSRGBBuffer=!!O&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!h),w!==D&&(w.label=q.substring(0,60)),this._doNotHandleContextLost||(w._extension=u,w._files=j,w._buffer=N);const E=q;this._transformTextureUrl&&!D&&(q=this._transformTextureUrl(q));const s=u??function(q){const f=q.split("?")[0],j=f.lastIndexOf(".");return j>-1?f.substring(j).toLowerCase():""}(q),S=(0,H.e)(s),e=(q,f)=>{w.dispose(),Q?Q(q,f):q&&g.e.Warn(q)},Z=(d,Q)=>{q===E?d&&e(d.status+" "+d.statusText,Q):(g.e.Warn(`Failed to load ${q}, falling back to the ${E}`),this.createCubeTextureBase(E,f,j,!!h,L,e,r,u,X,z,B,w,i,t,O,N))};if(S)S.then((d=>{const g=q=>{i&&i(w,q),d.loadCubeData(q,w,X,L,((q,f)=>{e(q,f)}))};N?g(N):j&&6===j.length?d.supportCascades?this._cascadeLoadFiles(f,(q=>g(q.map((q=>new Uint8Array(q))))),j,e):e("Textures type does not support cascades."):this._loadFile(q,(q=>g(new Uint8Array(q))),void 0,void 0,!0,Z)}));else{if(!j||0===j.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(f,w,((q,f)=>{t&&t(q,f)}),j,e)}return this._internalTexturesCache.push(w),w}},13222:(q,f,j)=>{"use strict";j(11005);var d=j(11331);j(11090),j(11153),j(10974),j(11378),j(11345);d.d},12704:(q,f,j)=>{"use strict";j.d(f,{c:()=>g});var d=j(10965);class g{constructor(q){this.value=this._toInt(q)}_toInt(q){return 0|q}add(q){return new g(this.value+q.value)}ej(q){return new g(this.value-q.value)}multiply(q){return new g(Math.imul(this.value,q.value))}divide(q){return new g(this.value/q.value)}getClassName(){return g.ClassName}equals(q){return this.value===q.value}static FromValue(q){return new g(q)}toString(){return this.value.toString()}}g.ClassName="FlowGraphInteger",(0,d.f)("FlowGraphInteger",g)},12712:(q,f,j)=>{"use strict";j.d(f,{d:()=>g,g:()=>h});var d=j(10941);class g{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.cz=q}get m(){return this.cz}transformVector(q){return this.transformVectorToRef(q,new d.i)}transformVectorToRef(q,f){return f.x=q.x*this.cz[0]+q.y*this.cz[1],f.y=q.x*this.cz[2]+q.y*this.cz[3],f}Yf(){return this.toArray()}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let f=0;f<4;f++)q[f]=this.cz[f];return q}Zj(q){for(let f=0;f<4;f++)this.cz[f]=q[f];return this}multiplyToRef(q,f){const j=q.cz,d=this.cz,g=f.cz;return g[0]=j[0]*d[0]+j[1]*d[2],g[1]=j[0]*d[1]+j[1]*d[3],g[2]=j[2]*d[0]+j[3]*d[2],g[3]=j[2]*d[1]+j[3]*d[3],f}multiply(q){return this.multiplyToRef(q,new g)}divideToRef(q,f){const j=this.cz,d=q.cz,g=f.cz;return g[0]=j[0]/d[0],g[1]=j[1]/d[1],g[2]=j[2]/d[2],g[3]=j[3]/d[3],f}divide(q){return this.divideToRef(q,new g)}addToRef(q,f){const j=this.cz,d=q.m,g=f.m;return g[0]=j[0]+d[0],g[1]=j[1]+d[1],g[2]=j[2]+d[2],g[3]=j[3]+d[3],f}add(q){return this.addToRef(q,new g)}subtractToRef(q,f){const j=this.cz,d=q.m,g=f.m;return g[0]=j[0]-d[0],g[1]=j[1]-d[1],g[2]=j[2]-d[2],g[3]=j[3]-d[3],f}ej(q){return this.subtractToRef(q,new g)}transpose(){const q=this.cz;return new g([q[0],q[2],q[1],q[3]])}determinant(){const q=this.cz;return q[0]*q[3]-q[1]*q[2]}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const f=this.cz,j=1/q;return new g([f[3]*j,-f[1]*j,-f[2]*j,f[0]*j])}equals(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.cz,d=q.m;return 0===f?j[0]===d[0]&&j[1]===d[1]&&j[2]===d[2]&&j[3]===d[3]:Math.abs(j[0]-d[0])<f&&Math.abs(j[1]-d[1])<f&&Math.abs(j[2]-d[2])<f&&Math.abs(j[3]-d[3])<f}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.cz.join(", ")})`}}class h{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.cz=q}get m(){return this.cz}transformVector(q){return this.transformVectorToRef(q,new d.j)}transformVectorToRef(q,f){const j=this.cz;return f.x=q.x*j[0]+q.y*j[1]+q.z*j[2],f.y=q.x*j[3]+q.y*j[4]+q.z*j[5],f.z=q.x*j[6]+q.y*j[7]+q.z*j[8],f}multiplyToRef(q,f){const j=q.cz,d=this.cz,g=f.m;return g[0]=j[0]*d[0]+j[1]*d[3]+j[2]*d[6],g[1]=j[0]*d[1]+j[1]*d[4]+j[2]*d[7],g[2]=j[0]*d[2]+j[1]*d[5]+j[2]*d[8],g[3]=j[3]*d[0]+j[4]*d[3]+j[5]*d[6],g[4]=j[3]*d[1]+j[4]*d[4]+j[5]*d[7],g[5]=j[3]*d[2]+j[4]*d[5]+j[5]*d[8],g[6]=j[6]*d[0]+j[7]*d[3]+j[8]*d[6],g[7]=j[6]*d[1]+j[7]*d[4]+j[8]*d[7],g[8]=j[6]*d[2]+j[7]*d[5]+j[8]*d[8],f}multiply(q){return this.multiplyToRef(q,new h)}divideToRef(q,f){const j=this.cz,d=q.m,g=f.m;return g[0]=j[0]/d[0],g[1]=j[1]/d[1],g[2]=j[2]/d[2],g[3]=j[3]/d[3],g[4]=j[4]/d[4],g[5]=j[5]/d[5],g[6]=j[6]/d[6],g[7]=j[7]/d[7],g[8]=j[8]/d[8],f}divide(q){return this.divideToRef(q,new h)}addToRef(q,f){const j=this.cz,d=q.m,g=f.m;return g[0]=j[0]+d[0],g[1]=j[1]+d[1],g[2]=j[2]+d[2],g[3]=j[3]+d[3],g[4]=j[4]+d[4],g[5]=j[5]+d[5],g[6]=j[6]+d[6],g[7]=j[7]+d[7],g[8]=j[8]+d[8],f}add(q){return this.addToRef(q,new h)}subtractToRef(q,f){const j=this.cz,d=q.m,g=f.m;return g[0]=j[0]-d[0],g[1]=j[1]-d[1],g[2]=j[2]-d[2],g[3]=j[3]-d[3],g[4]=j[4]-d[4],g[5]=j[5]-d[5],g[6]=j[6]-d[6],g[7]=j[7]-d[7],g[8]=j[8]-d[8],f}ej(q){return this.subtractToRef(q,new h)}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let f=0;f<9;f++)q[f]=this.cz[f];return q}Yf(){return this.toArray()}Zj(q){for(let f=0;f<9;f++)this.cz[f]=q[f];return this}transpose(){const q=this.cz;return new h([q[0],q[3],q[6],q[1],q[4],q[7],q[2],q[5],q[8]])}determinant(){const q=this.cz;return q[0]*(q[4]*q[8]-q[5]*q[7])-q[1]*(q[3]*q[8]-q[5]*q[6])+q[2]*(q[3]*q[7]-q[4]*q[6])}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const f=this.cz,j=1/q;return new h([(f[4]*f[8]-f[5]*f[7])*j,(f[2]*f[7]-f[1]*f[8])*j,(f[1]*f[5]-f[2]*f[4])*j,(f[5]*f[6]-f[3]*f[8])*j,(f[0]*f[8]-f[2]*f[6])*j,(f[2]*f[3]-f[0]*f[5])*j,(f[3]*f[7]-f[4]*f[6])*j,(f[1]*f[6]-f[0]*f[7])*j,(f[0]*f[4]-f[1]*f[3])*j])}equals(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.cz,d=q.m;return 0===f?j[0]===d[0]&&j[1]===d[1]&&j[2]===d[2]&&j[3]===d[3]&&j[4]===d[4]&&j[5]===d[5]&&j[6]===d[6]&&j[7]===d[7]&&j[8]===d[8]:Math.abs(j[0]-d[0])<f&&Math.abs(j[1]-d[1])<f&&Math.abs(j[2]-d[2])<f&&Math.abs(j[3]-d[3])<f&&Math.abs(j[4]-d[4])<f&&Math.abs(j[5]-d[5])<f&&Math.abs(j[6]-d[6])<f&&Math.abs(j[7]-d[7])<f&&Math.abs(j[8]-d[8])<f}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.cz.join(", ")})`}}},12717:(q,f,j)=>{"use strict";var d;function g(q,f,j,d){switch(f){case"Animation":return d?q.animations.find((q=>q.uniqueId===j))??null:q.animations[j]??null;case"AnimationGroup":return d?q.animationGroups.find((q=>q.uniqueId===j))??null:q.animationGroups[j]??null;case"Mesh":return d?q.meshes.find((q=>q.uniqueId===j))??null:q.meshes[j]??null;case"Material":return d?q.materials.find((q=>q.uniqueId===j))??null:q.materials[j]??null;case"ou":return d?q.cameras.find((q=>q.uniqueId===j))??null:q.cameras[j]??null;case"Light":return d?q.lights.find((q=>q.uniqueId===j))??null:q.lights[j]??null;default:return null}}j.d(f,{d:()=>g}),function(q){q.Animation="Animation",q.AnimationGroup="AnimationGroup",q.Mesh="Mesh",q.Material="Material",q.ou="ou",q.Light="Light"}(d||(d={}))},12749:(q,f,j)=>{"use strict";j.d(f,{d:()=>g});var d=j(12752);class g extends d.c{constructor(q,f){if(super(q),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),f)for(const j of f)this._eventsSignalOutputs[j]=this._registerSignalOutput(j+"Event")}_executeOnTick(q){}_startPendingTasks(q){q._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(q),this._resetAfterCanceled(q)),this._preparePendingTasks(q),q._addPendingBlock(this),this.out._activateSignal(q),q._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(q){q._deleteExecutionVariable(this,"_initialized"),q._removePendingBlock(this)}}},12726:(q,f,j)=>{"use strict";j.d(f,{e:()=>r});var d=j(11105),g=j(10965),h=j(12732),L=j(10982),Q=j(12699);class H extends h.e{constructor(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:d.defaultValue,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(q,f,j),this.richType=d,this._defaultValue=g,this._optional=h,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new L.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(q){this._isDisabled!==q&&(this._isDisabled=q,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(q,f){f._getConnectionValue(this)!==q&&(f._setConnectionValue(this,q),this.onValueChangedObservable.notifyObservers(q))}resetToDefaultValue(q){q._setConnectionValue(this,this._defaultValue)}connectTo(q){this._isDisabled||super.connectTo(q)}_getValueOrDefault(q){const f=q._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(f):f}getValue(q){if(1===this.connectionType){q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(q);const f=this._getValueOrDefault(q);return this._lastValue=f,this.richType.typeTransformer?this.richType.typeTransformer(f):f}const f=this.isConnected()?this._connectedPoint[0].getValue(q):this._getValueOrDefault(q);return this._lastValue=f,this.richType.typeTransformer?this.richType.typeTransformer(f):f}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.richType={},this.richType.serialize(q.richType),q.optional=this._optional,(0,Q.e)("defaultValue",this._defaultValue,q)}}(0,g.f)("FlowGraphDataConnection",H);class r{constructor(q){var f;this.config=q,this.uniqueId=(0,d.d)(),this.name=(null===(f=this.config)||void 0===f?void 0:f.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(q){}registerDataInput(q,f,j){const d=new H(q,0,this,f,j);return this.dataInputs.push(d),d}registerDataOutput(q,f,j){const d=new H(q,1,this,f,j);return this.dataOutputs.push(d),d}getDataInput(q){return this.dataInputs.find((f=>f.name===q))}getDataOutput(q){return this.dataOutputs.find((f=>f.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q.e;if(q.uniqueId=this.uniqueId,q.config={},this.config){const j=this.config,d=Object.keys(j);for(const g of d)f(g,j[g],q.config)}q.dataInputs=[],q.dataOutputs=[],q.className=this.getClassName();for(const j of this.dataInputs){const f={};j.serialize(f),q.dataInputs.push(f)}for(const j of this.dataOutputs){const f={};j.serialize(f),q.dataOutputs.push(f)}}deserialize(q){}_log(q,f,j){var d;null===(d=q.logger)||void 0===d||d.addLogItem({action:f,payload:j,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12732:(q,f,j)=>{"use strict";j.d(f,{e:()=>h});var d,g=j(11105);!function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(d||(d={}));class h{constructor(q,f,j){this._ownerBlock=j,this._connectedPoint=[],this.uniqueId=(0,g.d)(),this.connectedPointIds=[],this.name=q,this._connectionType=f}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(q){if(this._connectionType===q._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||q._isSingularConnection()&&q._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(q),q._connectedPoint.push(this)}disconnectFrom(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=this._connectedPoint.indexOf(q),d=q._connectedPoint.indexOf(this);-1!==j&&-1!==d&&(f&&this._connectedPoint.splice(j,1),q._connectedPoint.splice(d,1))}disconnectFromAll(){for(const q of this._connectedPoint)this.disconnectFrom(q,!1);this._connectedPoint.length=0}dispose(){for(const q of this._connectedPoint)this.disconnectFrom(q)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.uniqueId=this.uniqueId,q.name=this.name,q._connectionType=this._connectionType,q.connectedPointIds=[],q.className=this.getClassName();for(const f of this._connectedPoint)q.connectedPointIds.push(f.uniqueId)}getClassName(){return"FGConnection"}deserialize(q){this.uniqueId=q.uniqueId,this.name=q.name,this._connectionType=q._connectionType,this.connectedPointIds=q.connectedPointIds}}},12691:(q,f,j)=>{"use strict";j.d(f,{e:()=>w});var d,g=j(10982),h=j(11125),L=j(11130),Q=j(11105),H=j(12699),r=j(12717),u=j(11005);!function(q){q.ExecuteBlock="ExecuteBlock",q.ExecuteEvent="ExecuteEvent",q.TriggerConnection="TriggerConnection",q.ContextVariableSet="ContextVariableSet",q.GlobalVariableSet="GlobalVariableSet",q.GlobalVariableDelete="GlobalVariableDelete",q.GlobalVariableGet="GlobalVariableGet",q.AddConnection="AddConnection",q.GetConnectionValue="GetConnectionValue",q.SetConnectionValue="SetConnectionValue",q.ActivateSignal="ActivateSignal",q.ContextVariableGet="ContextVariableGet"}(d||(d={}));class X{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(q){if(q.time||(q.time=Date.now()),this.log.push(q),this.logToConsole){var f;const j=null===(f=q.payload)||void 0===f?void 0:f.value;"object"===typeof j&&j.getClassName?u.e.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(j.getClassName())}: ${j.toString()}`):u.e.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(q.payload)}`)}}getItemsOfType(q){return this.log.filter((f=>f.action===q))}}class z{get enableLogging(){return this._enableLogging}set enableLogging(q){this._enableLogging!==q&&(this._enableLogging=q,this._enableLogging?(this.logger=new X,this.logger.logToConsole=!0):this.logger=null)}constructor(q){this.uniqueId=(0,Q.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new g.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=q,this.assetsContext=q.assetsContext??q.Sf}hasVariable(q){return q in this._userVariables}setVariable(q,f){var j;this._userVariables[q]=f,null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:q,value:f}})}getAsset(q,f){return(0,r.d)(this.assetsContext,q,f)}getVariable(q){var f;return null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:q,value:this._userVariables[q]}}),this._userVariables[q]}get userVariables(){return this._userVariables}eq(){return this._configuration.Sf}_getUniqueIdPrefixedName(q,f){return`${q.uniqueId}_${f}`}_getGlobalContextVariable(q,f){var j;return null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:q,defaultValue:f,possibleValue:this._globalContextVariables[q]}}),this._hasGlobalContextVariable(q)?this._globalContextVariables[q]:f}_setGlobalContextVariable(q,f){var j;null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:q,value:f}}),this._globalContextVariables[q]=f}_deleteGlobalContextVariable(q){var f;null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:q}}),delete this._globalContextVariables[q]}_hasGlobalContextVariable(q){return q in this._globalContextVariables}_setExecutionVariable(q,f,j){this._executionVariables[this._getUniqueIdPrefixedName(q,f)]=j}_getExecutionVariable(q,f,j){return this._hasExecutionVariable(q,f)?this._executionVariables[this._getUniqueIdPrefixedName(q,f)]:j}_deleteExecutionVariable(q,f){delete this._executionVariables[this._getUniqueIdPrefixedName(q,f)]}_hasExecutionVariable(q,f){return this._getUniqueIdPrefixedName(q,f)in this._executionVariables}_hasConnectionValue(q){return q.uniqueId in this._connectionValues}_setConnectionValue(q,f){var j;this._connectionValues[q.uniqueId]=f,null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:q.uniqueId,value:f}})}_setConnectionValueByKey(q,f){this._connectionValues[q]=f}_getConnectionValue(q){var f;return null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:q.uniqueId,value:this._connectionValues[q.uniqueId]}}),this._connectionValues[q.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(q){this._pendingBlocks.includes(q)||(this._pendingBlocks.push(q),this._pendingBlocks.sort(((q,f)=>q.priority-f.priority)))}_removePendingBlock(q){const f=this._pendingBlocks.indexOf(q);-1!==f&&this._pendingBlocks.splice(f,1)}_clearPendingBlocks(){for(const q of this._pendingBlocks)q._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(q){var f;this.onNodeExecutedObservable.notifyObservers(q),null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:q.getClassName(),uniqueId:q.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(q){this._setGlobalContextVariable("timeSinceStart",q.timeSinceStart),this._setGlobalContextVariable("deltaTime",q.deltaTime);for(const j of this._pendingBlocks){var f;null===(f=j._executeOnTick)||void 0===f||f.call(j,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;q.uniqueId=this.uniqueId,q._userVariables={};for(const d in this._userVariables)f(d,this._userVariables[d],q._userVariables);q._connectionValues={};for(const d in this._connectionValues)f(d,this._connectionValues[d],q._connectionValues);var j;this.assetsContext!==this.eq()&&(q._assetsContext={meshes:this.assetsContext.meshes.map((q=>q.id)),materials:this.assetsContext.materials.map((q=>q.id)),textures:this.assetsContext.textures.map((q=>q.name)),animations:this.assetsContext.animations.map((q=>q.name)),lights:this.assetsContext.lights.map((q=>q.id)),cameras:this.assetsContext.cameras.map((q=>q.id)),QB:null===(j=this.assetsContext.QB)||void 0===j?void 0:j.map((q=>q.name)),skeletons:this.assetsContext.skeletons.map((q=>q.id)),ez:this.assetsContext.ez.map((q=>q.name)),geometries:this.assetsContext.geometries.map((q=>q.id)),multiMaterials:this.assetsContext.multiMaterials.map((q=>q.id)),transformNodes:this.assetsContext.transformNodes.map((q=>q.id))})}getClassName(){return"FlowGraphContext"}}(0,h.b)([(0,L.O)()],z.prototype,"uniqueId",void 0);var B=j(12721),D=j(11524);class i{constructor(q){this.onEventTriggeredObservable=new g.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=q,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.qd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const q=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:q}}),this._startingTime+=q})),this._meshPickedObserver=this._scene.onPointerObservable.add((q=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:q})}),D.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((q=>{const f=q.pointerId,j=q.mesh,d=this._pointerUnderMeshState[f];!d&&j?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:f,mesh:j}}):d&&!j?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:f,mesh:d}}):d&&j&&d!==j&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:f,mesh:d,over:j}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:f,mesh:j,out:d}})),this._pointerUnderMeshState[f]=j}),D.b.POINTERMOVE)}dispose(){var q,f,j,d,g;null===(q=this._sceneDisposeObserver)||void 0===q||q.remove(),null===(f=this._sceneReadyObserver)||void 0===f||f.remove(),null===(j=this._sceneOnBeforeRenderObserver)||void 0===j||j.remove(),null===(d=this._meshPickedObserver)||void 0===d||d.remove(),null===(g=this._meshUnderPointerObserver)||void 0===g||g.remove(),this.onEventTriggeredObservable.clear()}}var t,O=j(12740);!function(q){q[q.Stopped=0]="Stopped",q[q.Started=1]="Started"}(t||(t={}));class N{get state(){return this._state}set state(q){this._state=q,this.onStateChangedObservable.notifyObservers(q)}constructor(q){this.onStateChangedObservable=new g.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=q.Sf,this._sceneEventCoordinator=new i(this._scene),this._coordinator=q.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((q=>{for(const f of this._executionContexts){const j=this._getContextualOrder(q.type,f);for(const d of j)if(!d._executeEvent(f,q.payload))break}switch(q.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const f of this._executionContexts)f._notifyOnTick(q.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const q=new z({Sf:this._scene,coordinator:this._coordinator});return this._executionContexts.push(q),q}getContext(q){return this._executionContexts[q]}addEventBlock(q){if("PointerOver"!==q.type&&"PointerOut"!==q.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==q.type&&this._eventBlocks[q.type].push(q),1===this.state)for(const f of this._executionContexts)q._startPendingTasks(f);else this.onStateChangedObservable.addOnce((f=>{if(1===f)for(const j of this._executionContexts)q._startPendingTasks(j)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((q=>{1===q&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const q of this._executionContexts)for(const f in this._eventBlocks){const j=this._getContextualOrder(f,q);for(const f of j)f._startPendingTasks(q)}}_getContextualOrder(q,f){const j=this._eventBlocks[q].sort(((q,f)=>f.initPriority-q.initPriority));if("MeshPick"===q){const q=[];for(const d of j){const g=d.asset.getValue(f);let h=0;for(;h<j.length;h++){const q=j[h].asset.getValue(f);if(g&&q&&(0,O.k)(g,q))break}q.splice(h,0,d)}return q}return j}dispose(){var q;if(0!==this.state){this.state=0;for(const q of this._executionContexts)q._clearPendingBlocks();this._executionContexts.length=0;for(const q in this._eventBlocks)this._eventBlocks[q].length=0;null===(q=this._eventObserver)||void 0===q||q.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(q){const f=[],j=new Set;for(const d in this._eventBlocks)for(const q of this._eventBlocks[d])f.push(q),j.add(q.uniqueId);for(;f.length>0;){const d=f.pop();q(d);for(const q of d.dataInputs)for(const d of q._connectedPoint)j.has(d._ownerBlock.uniqueId)||(f.push(d._ownerBlock),j.add(d._ownerBlock.uniqueId));if(d instanceof B.b)for(const q of d.signalOutputs)for(const d of q._connectedPoint)j.has(d._ownerBlock.uniqueId)||(f.push(d._ownerBlock),j.add(d._ownerBlock.uniqueId))}}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;q.allBlocks=[],this.visitAllBlocks((f=>{const j={};f.serialize(j),q.allBlocks.push(j)})),q.executionContexts=[];for(const j of this._executionContexts){const d={};j.serialize(d,f),q.executionContexts.push(d)}}}class w{constructor(q){this.config=q,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Sf.qd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Sf.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const q=this._executeOnNextFrame.slice(0);if(q.length)for(const f of q){this.notifyCustomEvent(f.id,f.data,!1);const q=this._executeOnNextFrame.findIndex((q=>q.uniqueId===f.uniqueId));-1!==q&&this._executeOnNextFrame.splice(q,1)}}));(w.SceneCoordinators.get(this.config.Sf)??[]).push(this)}createGraph(){const q=new N({Sf:this.config.Sf,coordinator:this});return this._flowGraphs.push(q),q}removeGraph(q){const f=this._flowGraphs.indexOf(q);-1!==f&&(q.dispose(),this._flowGraphs.splice(f,1))}start(){for(const q of this._flowGraphs)q.start()}dispose(){var q,f;for(const g of this._flowGraphs)g.dispose();this._flowGraphs.length=0,null===(q=this._disposeObserver)||void 0===q||q.remove(),null===(f=this._onBeforeRenderObserver)||void 0===f||f.remove();const j=w.SceneCoordinators.get(this.config.Sf)??[],d=j.indexOf(this);-1!==d&&j.splice(d,1)}serialize(q,f){q._flowGraphs=[];for(const j of this._flowGraphs){const d={};j.serialize(d,f),q._flowGraphs.push(d)}q.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(q){let f=this._customEventsMap.get(q);return f||(f=new g.d,this._customEventsMap.set(q,f)),f}notifyCustomEvent(q,f){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:q,data:f,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(q)){const f=this._eventExecutionCounter.get(q);if(this._eventExecutionCounter.set(q,f+1),f>=w.MaxEventTypeExecutionPerFrame)return void(f===w.MaxEventTypeExecutionPerFrame&&u.e.Warn(`FlowGraphCoordinator: Too many executions of event "${q}".`))}else this._eventExecutionCounter.set(q,1);const j=this._customEventsMap.get(q);j&&j.notifyObservers(f)}}w.MaxEventsPerType=30,w.MaxEventTypeExecutionPerFrame=30,w.SceneCoordinators=new Map},12742:(q,f,j)=>{"use strict";j.d(f,{e:()=>g});var d=j(12749);class g extends d.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(q){q._notifyExecuteNode(this),this.done._activateSignal(q)}}},12721:(q,f,j)=>{"use strict";j.d(f,{b:()=>Q});var d=j(12726),g=j(12732),h=j(10965);class L extends g.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(q){super.connectTo(q),this._connectedPoint.sort(((q,f)=>f.priority-q.priority))}_activateSignal(q){var f;if(null===(f=q.logger)||void 0===f||f.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(q,this),q._increaseExecutionId();else for(const j of this._connectedPoint)j._activateSignal(q)}}(0,h.f)("FlowGraphSignalConnection",L);class Q extends d.e{constructor(q){super(q),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(q){const f=new L(q,0,this);return this.signalInputs.push(f),f}_registerSignalOutput(q){const f=new L(q,1,this);return this.signalOutputs.push(f),f}_unregisterSignalInput(q){const f=this.signalInputs.findIndex((f=>f.name===q));-1!==f&&(this.signalInputs[f].dispose(),this.signalInputs.splice(f,1))}_unregisterSignalOutput(q){const f=this.signalOutputs.findIndex((f=>f.name===q));-1!==f&&(this.signalOutputs[f].dispose(),this.signalOutputs.splice(f,1))}_reportError(q,f){this.error.payload="string"===typeof f?new Error(f):f,this.error._activateSignal(q)}getSignalInput(q){return this.signalInputs.find((f=>f.name===q))}getSignalOutput(q){return this.signalOutputs.find((f=>f.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.signalInputs=[],q.signalOutputs=[];for(const f of this.signalInputs){const j={};f.serialize(j),q.signalInputs.push(j)}for(const f of this.signalOutputs){const j={};f.serialize(j),q.signalOutputs.push(j)}}deserialize(q){for(let f=0;f<q.signalInputs.length;f++){const j=this.getSignalInput(q.signalInputs[f].name);if(!j)throw new Error("Could not find signal input with name "+q.signalInputs[f].name+" in block "+q.className);j.deserialize(q.signalInputs[f])}for(let f=0;f<q.signalOutputs.length;f++){const j=this.getSignalOutput(q.signalOutputs[f].name);if(!j)throw new Error("Could not find signal output with name "+q.signalOutputs[f].name+" in block "+q.className);j.deserialize(q.signalOutputs[f])}}getClassName(){return"FlowGraphExecutionBlock"}}},12752:(q,f,j)=>{"use strict";j.d(f,{c:()=>g});var d=j(12721);class g extends d.b{constructor(q){super(q),this.out=this._registerSignalOutput("out")}}},12709:(q,f,j)=>{"use strict";j.d(f,{C:()=>T,D:()=>Z,G:()=>e,c:()=>r,d:()=>z,e:()=>S,g:()=>t,j:()=>O,n:()=>N,o:()=>X,p:()=>s,r:()=>u,t:()=>B,u:()=>D,v:()=>i,y:()=>I});var d,g=j(10941),h=j(11210),L=j(12704),Q=j(12712);!function(q){q.Any="any",q.String="string",q.Number="number",q.Boolean="boolean",q.Object="object",q.Integer="FlowGraphInteger",q.Vector2="Vector2",q.kf="kf",q.Vector4="Vector4",q.Quaternion="Quaternion",q.Matrix="Matrix",q.Matrix2D="Matrix2D",q.Matrix3D="Matrix3D",q.o="o",q.wd="wd"}(d||(d={}));class H{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=q,this.defaultValue=f,this.animationType=j}serialize(q){q.typeName=this.typeName,q.defaultValue=this.defaultValue}}const r=new H("any",void 0),u=new H("string",""),X=new H("number",0,0),z=new H("boolean",!1),B=new H("Vector2",g.i.Zero(),5),D=new H("kf",g.j.Zero(),1),i=new H("Vector4",g.m.Zero()),t=new H("Matrix",g.b.Identity(),3),O=new H("Matrix2D",new Q.d),N=new H("Matrix3D",new Q.g),w=new H("o",h.c.Black(),4),E=new H("wd",new h.e(0,0,0,0),7),s=new H("Quaternion",g.e.Identity(),2);s.typeTransformer=q=>{if(q.getClassName){if("Vector4"===q.getClassName())return g.e.Pf(q.Yf());if("kf"===q.getClassName())return g.e.FromEulerVector(q);if("Matrix"===q.getClassName())return g.e.FromRotationMatrix(q)}return q};const S=new H("FlowGraphInteger",new L.c(0),0);function e(q){const f=q;switch(typeof q){case"string":return u;case"number":return X;case"boolean":return z;case"object":if(f.getClassName)switch(f.getClassName()){case"Vector2":return B;case"kf":return D;case"Vector4":return i;case"Matrix":return t;case"o":return w;case"wd":return E;case"Quaternion":return s;case"FlowGraphInteger":return S;case"Matrix2D":return O;case"Matrix3D":return N}return r;default:return r}}function Z(q){switch(q){case"string":return u;case"number":return X;case"boolean":return z;case"Vector2":return B;case"kf":return D;case"Vector4":return i;case"Matrix":return t;case"o":return w;case"wd":return E;case"Quaternion":return s;case"FlowGraphInteger":return S;case"Matrix2D":return O;case"Matrix3D":return N;default:return r}}function I(q){switch(q){case"number":default:return 0;case"Vector2":return 5;case"kf":return 1;case"Matrix":return 3;case"o":return 4;case"wd":return 7;case"Quaternion":return 2}}function T(q){switch(q){case 0:return X;case 5:return B;case 1:return D;case 3:return t;case 4:return w;case 7:return E;case 2:return s;default:return r}}},12699:(q,f,j)=>{"use strict";j.d(f,{d:()=>u,e:()=>r,g:()=>X});var d=j(11210),g=j(10941),h=j(12704),L=j(12709),Q=j(12712);function H(q){return"Vector2"===q||"kf"===q||"Vector4"===q||"Quaternion"===q||"o"===q||"wd"===q}function r(q,f,j){var d;const g=(null===f||void 0===f||null===(d=f.getClassName)||void 0===d?void 0:d.call(f))??"";if(H(g)||function(q){return"Matrix"===q||"Matrix2D"===q||"Matrix3D"===q}(g))j[q]={value:f.Yf(),className:g};else if("FlowGraphInteger"===g)j[q]={value:f.value,className:g};else if(g&&(f.id||f.name))j[q]={id:f.id,name:f.name,className:g};else{if("object"===typeof f)throw new Error(`Could not serialize value ${f}`);j[q]=f}}function u(q,f,j,r){const X=f[q];let z;const B=(null===X||void 0===X?void 0:X.type)??(null===X||void 0===X?void 0:X.className);if(function(q){return"Mesh"===q||"AbstractMesh"===q||"GroundMesh"===q||"InstanceMesh"===q||"LinesMesh"===q||"GoldbergMesh"===q||"GreasedLineMesh"===q||"TrailMesh"===q}(B)){let q=r.meshes.filter((q=>X.id?q.id===X.id:q.name===X.name));0===q.length&&(q=r.transformNodes.filter((q=>X.id?q.id===X.id:q.name===X.name))),z=X.uniqueId?q.find((q=>q.uniqueId===X.uniqueId)):q[0]}else if(H(B))z=function(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===q)return g.i.Pf(f);if("kf"===q)return j&&(f[2]*=-1),g.j.Pf(f);if("Vector4"===q)return g.m.Pf(f);if("Quaternion"===q)return j&&(f[2]*=-1,f[3]*=-1),g.e.Pf(f);if("o"===q)return new d.c(f[0],f[1],f[2]);if("wd"===q)return new d.e(f[0],f[1],f[2],f[3]);throw new Error(`Unknown vector class name ${q}`)}(B,X.value);else if(function(q){return"AnimationGroup"===q}(B)){const q=r.animationGroups.filter((q=>q.name===X.name));z=1===q.length?q[0]:q.find((q=>q.uniqueId===X.uniqueId))}else z="Matrix"===B?g.b.Pf(X.value):"Matrix2D"===B?new Q.d(X.value):"Matrix3D"===B?new Q.g(X.value):"FlowGraphInteger"===B?h.c.FromValue(X.value):"number"===B||"string"===B||"boolean"===B?X.value[0]:X&&void 0!==X.value?X.value:Array.isArray(X)?X.reduce(((q,f)=>f.eventData?(q[f.id]={type:(0,L.D)(f.type)},"undefined"!==typeof f.value&&(q[f.id].value=u("value",f,j,r)),q):q),{}):X;return z}function X(q){return"FlowGraphJsonPointerParserBlock"===q}},12740:(q,f,j)=>{"use strict";function d(q,f){return!(!q.parent||q.parent!==f&&!d(q.parent,f))}function g(q){if(q.getClassName)return q.getClassName()}function h(q,f){return q===f&&("Vector2"===q||"kf"===q||"Vector4"===q||"Quaternion"===q)}function L(q,f){return q===f&&("Matrix"===q||"Matrix2D"===q||"Matrix3D"===q)}function Q(q,f){return"FlowGraphInteger"===q&&"FlowGraphInteger"===f}function H(q,f){const j="number"===typeof q||"number"===typeof(null===q||void 0===q?void 0:q.value);return j&&!f?!isNaN(r(q)):j}function r(q){return"number"===typeof q?q:q.value}j.d(f,{d:()=>Q,f:()=>L,g:()=>h,h:()=>g,k:()=>d,m:()=>r,q:()=>H})},12143:(q,f,j)=>{"use strict";j.r(f),j.d(f,{SceneInstrumentation:()=>h});var d=j(10992),g=j(11425);class h{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(q){q!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=q,q?(this._onBeforeActiveMeshesEvaluationObserver=this.Sf.onBeforeActiveMeshesEvaluationObservable.add((()=>{d.h.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Sf.onAfterActiveMeshesEvaluationObservable.add((()=>{d.h.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Sf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Sf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(q){q!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=q,q?(this._onBeforeRenderTargetsRenderObserver=this.Sf.onBeforeRenderTargetsRenderObservable.add((()=>{d.h.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Sf.onAfterRenderTargetsRenderObservable.add((()=>{d.h.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Sf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Sf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(q){q!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=q,q?(this._onBeforeParticlesRenderingObserver=this.Sf.onBeforeParticlesRenderingObservable.add((()=>{d.h.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Sf.onAfterParticlesRenderingObservable.add((()=>{d.h.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Sf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Sf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(q){q!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=q,this.Sf.spriteManagers&&(q?(this._onBeforeSpritesRenderingObserver=this.Sf.onBeforeSpritesRenderingObservable.add((()=>{d.h.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Sf.onAfterSpritesRenderingObservable.add((()=>{d.h.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Sf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Sf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(q){q!==this._capturePhysicsTime&&this.Sf.onBeforePhysicsObservable&&(this._capturePhysicsTime=q,q?(this._onBeforePhysicsObserver=this.Sf.onBeforePhysicsObservable.add((()=>{d.h.StartPerformanceCounter("yd"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Sf.onAfterPhysicsObservable.add((()=>{d.h.EndPerformanceCounter("yd"),this._physicsTime.endMonitoring()}))):(this.Sf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Sf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(q){q!==this._captureAnimationsTime&&(this._captureAnimationsTime=q,q?this._onAfterAnimationsObserver=this.Sf.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Sf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(q){this._captureFrameTime=q}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(q){this._captureInterFrameTime=q}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(q){q!==this._captureRenderTime&&(this._captureRenderTime=q,q?(this._onBeforeDrawPhaseObserver=this.Sf.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),d.h.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Sf.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),d.h.EndPerformanceCounter("Main render")}))):(this.Sf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Sf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(q){q!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=q,q?(this._onBeforeCameraRenderObserver=this.Sf.onBeforeCameraRenderObservable.add((q=>{this._cameraRenderTime.beginMonitoring(),d.h.StartPerformanceCounter(`Rendering camera ${q.name}`)})),this._onAfterCameraRenderObserver=this.Sf.onAfterCameraRenderObservable.add((q=>{this._cameraRenderTime.endMonitoring(!1),d.h.EndPerformanceCounter(`Rendering camera ${q.name}`)}))):(this.Sf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Sf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Sf.getEngine()._drawCalls}constructor(q){this.Sf=q,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new g.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new g.b,this._captureFrameTime=!1,this._frameTime=new g.b,this._captureRenderTime=!1,this._renderTime=new g.b,this._captureInterFrameTime=!1,this._interFrameTime=new g.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new g.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new g.b,this._capturePhysicsTime=!1,this._physicsTime=new g.b,this._captureAnimationsTime=!1,this._animationsTime=new g.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new g.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=q.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(d.h.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Sf.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=q.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(d.h.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Dz(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Dz(),this._captureParticlesRenderTime&&this._particlesRenderTime.Dz(),this._captureSpritesRenderTime&&this._spritesRenderTime.Dz(),this._captureRenderTime&&this._renderTime.Dz(),this._captureCameraRenderTime&&this._cameraRenderTime.Dz()}))}dispose(){this._disposed||(this.Sf.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Sf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Sf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Sf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Sf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Sf.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Sf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Sf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Sf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Sf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Sf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Sf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Sf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Sf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Sf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Sf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Sf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Sf=null,this._disposed=!0)}}},12687:(q,f,j)=>{"use strict";j.d(f,{c:()=>u});var d=j(11125),g=j(11130),h=j(10941),L=j(11247),Q=j(11632),H=j(11698),r=j(10965);L.d.AddNodeConstructor("Light_Type_1",((q,f)=>()=>new u(q,h.j.Zero(),f)));class u extends H.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(q){this._shadowFrustumSize=q,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(q){this._shadowOrthoScale=q,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(q){this._orthoLeft=q}get orthoRight(){return this._orthoRight}set orthoRight(q){this._orthoRight=q}get orthoTop(){return this._orthoTop}set orthoTop(q){this._orthoTop=q}get orthoBottom(){return this._orthoBottom}set orthoBottom(q){this._orthoBottom=q}constructor(q,f,j){super(q,j),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=f.scale(-1),this.direction=f}getClassName(){return"ld"}getTypeID(){return Q.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(q,f,j){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(q):this._setDefaultAutoExtendShadowProjectionMatrix(q,f,j)}_setDefaultFixedFrustumShadowProjectionMatrix(q){const f=this.eq().activeCamera;f&&h.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:f.gd,void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,q,this.eq().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(q,f,j){const d=this.eq().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const q=h.j.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let L=0;L<j.length;L++){const Q=j[L];if(!Q)continue;const H=Q.getBoundingInfo().boundingBox;for(let j=0;j<H.vectorsWorld.length;j++)h.j.TransformCoordinatesToRef(H.vectorsWorld[j],f,q),q.x<this._orthoLeft&&(this._orthoLeft=q.x),q.y<this._orthoBottom&&(this._orthoBottom=q.y),q.x>this._orthoRight&&(this._orthoRight=q.x),q.y>this._orthoTop&&(this._orthoTop=q.y),this.autoCalcShadowZBounds&&(q.z<d&&(d=q.z),q.z>g&&(g=q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=d,this._shadowMaxZ=g)}const g=this._orthoRight-this._orthoLeft,L=this._orthoTop-this._orthoBottom,Q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===d||void 0===d?void 0:d.gd)||0,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===d||void 0===d?void 0:d.maxZ)||1e4,r=this.eq().getEngine().useReverseDepthBuffer;h.b.OrthoOffCenterLHToRef(this._orthoLeft-g*this.shadowOrthoScale,this._orthoRight+g*this.shadowOrthoScale,this._orthoBottom-L*this.shadowOrthoScale,this._orthoTop+L*this.shadowOrthoScale,r?H:Q,r?Q:H,q,this.eq().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,f){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,f),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,f),this)}transferToNodeMaterialEffect(q,f){return this.computeTransformedInformation()?(q.setFloat3(f,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(q.setFloat3(f,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(q){const f=this._scene.getEngine();return!f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:1}getDepthMaxZ(q){const f=this._scene.getEngine();return f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:1}prepareLightSpecificDefines(q,f){q["DIRLIGHT"+f]=!0}}(0,d.b)([(0,g.O)()],u.prototype,"shadowFrustumSize",null),(0,d.b)([(0,g.O)()],u.prototype,"shadowOrthoScale",null),(0,d.b)([(0,g.O)()],u.prototype,"autoUpdateExtends",void 0),(0,d.b)([(0,g.O)()],u.prototype,"autoCalcShadowZBounds",void 0),(0,d.b)([(0,g.O)("orthoLeft")],u.prototype,"_orthoLeft",void 0),(0,d.b)([(0,g.O)("orthoRight")],u.prototype,"_orthoRight",void 0),(0,d.b)([(0,g.O)("orthoTop")],u.prototype,"_orthoTop",void 0),(0,d.b)([(0,g.O)("orthoBottom")],u.prototype,"_orthoBottom",void 0),(0,r.f)("BABYLON.DirectionalLight",u)},13136:(q,f,j)=>{"use strict";j.d(f,{e:()=>u});var d=j(11125),g=j(11130),h=j(10941),L=j(11210),Q=j(11247),H=j(11632),r=j(10965);Q.d.AddNodeConstructor("Light_Type_3",((q,f)=>()=>new u(q,h.j.Zero(),f)));class u extends H.e{constructor(q,f,j){super(q,j),this.groundColor=new L.c(0,0,0),this.direction=f||h.j.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ad"}setDirectionToTarget(q){return this.direction=h.j.Normalize(q.ej(h.j.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(q,f){const j=h.j.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",j.x,j.y,j.z,0,f),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Xd),f),this}transferToNodeMaterialEffect(q,f){const j=h.j.Normalize(this.direction);return q.setFloat3(f,j.x,j.y,j.z),this}Nf(){return this._worldMatrix||(this._worldMatrix=h.b.Identity()),this._worldMatrix}getTypeID(){return H.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(q,f){q["HEMILIGHT"+f]=!0}}(0,d.b)([(0,g.i)()],u.prototype,"groundColor",void 0),(0,d.b)([(0,g.M)()],u.prototype,"direction",void 0),(0,r.f)("BABYLON.HemisphericLight",u)},12657:(q,f,j)=>{"use strict";j.d(f,{b:()=>X});var d=j(11125),g=j(11130),h=j(10941),L=j(11247),Q=j(11632),H=j(11698),r=j(11438),u=j(10965);L.d.AddNodeConstructor("Light_Type_2",((q,f)=>()=>new X(q,h.j.Zero(),h.j.Zero(),0,0,f)));class X extends H.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(q){this._iesProfileTexture!==q&&(this._iesProfileTexture=q,this._iesProfileTexture&&X._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(q){this._angle=q,this._cosHalfAngle=Math.cos(.5*q),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(q){this._innerAngle=q,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(q){this._shadowAngleScale=q,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(q){this._projectionTextureLightNear=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(q){this._projectionTextureLightFar=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(q){this._projectionTextureUpDirection=q,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(q){this._projectionTexture!==q&&(this._projectionTexture=q,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(X._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):X._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(q){return void 0!==q.onGeneratedObservable}static _IsTexture(q){return void 0!==q.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(q){this._projectionTextureProjectionLightMatrix=q,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(q,f,j,d,g,L){super(q,L),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=h.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=h.j.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=h.j.Zero(),this._projectionTextureViewLightMatrix=h.b.Zero(),this._projectionTextureProjectionLightMatrix=h.b.Zero(),this._projectionTextureScalingMatrix=h.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=f,this.direction=j,this.angle=d,this.exponent=g}getClassName(){return"SpotLight"}getTypeID(){return Q.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(q){super._setDirection(q),this._projectionTextureViewLightDirty=!0}_setPosition(q){super._setPosition(q),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(q,f,j){const d=this.eq().activeCamera;if(!d)return;this._shadowAngleScale=this._shadowAngleScale||1;const g=this._shadowAngleScale*this._angle,L=void 0!==this.shadowMinZ?this.shadowMinZ:d.gd,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,H=this.eq().getEngine().useReverseDepthBuffer;h.b.PerspectiveFovLHToRef(g,1,H?Q:L,H?L:Q,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,H)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),h.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const q=this.projectionTextureLightFar,f=this.projectionTextureLightNear,j=q/(q-f),d=-j*f,g=1/Math.tan(this._angle/2);h.b.FromValuesToRef(g/1,0,0,0,0,g,0,0,0,0,j,1,0,0,d,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof r.e){const q=this._projectionTexture.uScale/2,f=this._projectionTexture.vScale/2;h.b.FromValuesToRef(q,0,0,0,0,f,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(q,f){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),q.setMatrix("textureProjectionMatrix"+f,this._projectionTextureMatrix),q.setTexture("projectionLightTexture"+f,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&q.setTexture("iesLightTexture"+f,this._iesProfileTexture),this}transferToEffect(q,f){let j;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,f),j=h.j.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,f),j=h.j.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",j.x,j.y,j.z,this._cosHalfAngle,f),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,f),this}transferToNodeMaterialEffect(q,f){let j;return j=this.computeTransformedInformation()?h.j.Normalize(this.transformedDirection):h.j.Normalize(this.direction),this.eq().useRightHandedSystem?q.setFloat3(f,-j.x,-j.y,-j.z):q.setFloat3(f,j.x,j.y,j.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(q){const f=this._scene.getEngine(),j=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.gd)??0;return f.useReverseDepthBuffer&&f.isNDCHalfZRange?j:this._scene.getEngine().isNDCHalfZRange?0:j}getDepthMaxZ(q){const f=this._scene.getEngine(),j=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)??1e4;return f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:j}prepareLightSpecificDefines(q,f){q["SPOTLIGHT"+f]=!0,q["PROJECTEDLIGHTTEXTURE"+f]=!(!this.projectionTexture||!this.projectionTexture.isReady()),q["IESLIGHTTEXTURE"+f]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,d.b)([(0,g.O)()],X.prototype,"angle",null),(0,d.b)([(0,g.O)()],X.prototype,"innerAngle",null),(0,d.b)([(0,g.O)()],X.prototype,"shadowAngleScale",null),(0,d.b)([(0,g.O)()],X.prototype,"exponent",void 0),(0,d.b)([(0,g.O)()],X.prototype,"projectionTextureLightNear",null),(0,d.b)([(0,g.O)()],X.prototype,"projectionTextureLightFar",null),(0,d.b)([(0,g.O)()],X.prototype,"projectionTextureUpDirection",null),(0,d.b)([(0,g.F)("projectedLightTexture")],X.prototype,"_projectionTexture",void 0),(0,u.f)("BABYLON.SpotLight",X)},12390:(q,f,j)=>{"use strict";j.d(f,{d:()=>L,h:()=>h,k:()=>Q});const d={},g={};function h(q,f){d[q]=f}function L(q,f){g[q]=f}function Q(q){return g[q]?g[q]:null}},12317:(q,f,j)=>{"use strict";j.d(f,{e:()=>e,f:()=>o});var d,g=j(10992),h=j(10982),L=j(11506),Q=j(10980),H=j(11005),r=j(11310),u=j(11030),X=j(11035),z=j(11105),B=j(11065),D=j(11021);!function(q){q[q.Clean=0]="Clean",q[q.Stop=1]="Stop",q[q.Sync=2]="Sync",q[q.NoSync=3]="NoSync"}(d||(d={}));const i=new h.d,t={};let O=!1;function N(){return t[".babylon"]}function w(q,f){const j=t[q];return j||(H.e.Warn("Unable to find a plugin to load "+q+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),f?N():void 0)}function E(q,f,j){let d="Unable to load from "+(q.rawData?"binary data":q.url);return f?d+=`: ${f}`:j&&(d+=`: ${j}`),d}async function s(q,f,j,d,g,h,L,Q,H){var r;const X="data:"===(z=q.url).substring(0,5)?z.substring(5):null;var z;if(q.rawData&&!L)throw"When using ArrayBufferView to load data the file extension must be provided.";const O=X||L?"":function(q){const f=q.indexOf("?");-1!==f&&(q=q.substring(0,f));const j=q.lastIndexOf(".");return q.substring(j,q.length).toLowerCase()}(q.url);let E=L?w(L,!0):X?function(q){for(const f in t){const j=t[f].plugin;if(j.canDirectLoad&&j.canDirectLoad(q))return t[f]}return N()}(q.url):w(O,!1);if(!E&&O){if(q.url&&!q.url.startsWith("blob:")){const f=await async function(q,f){const j=f.method||"GET";return await new Promise(((d,g)=>{const h=new D.c;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const q={};if(f.responseHeaders)for(const j of f.responseHeaders)q[j]=h.getResponseHeader(j)||"";d({response:h.response,headerValues:q})}else g(`Unable to fetch data from ${q}. Error code: ${h.status}`)})),h.open(j,q),h.send()}))}(q.url,{method:"HEAD",responseHeaders:["Content-Type"]}),j=f.headerValues?f.headerValues["Content-Type"]:"";j&&(E=function(q){for(const f in t){const j=t[f];if(j.mimeType===q)return j}}(j))}E||(E=N())}if(!E)throw new Error(`No plugin or fallback for ${L??q.url}`);if(!1===(null===H||void 0===H||null===(r=H[E.plugin.name])||void 0===r?void 0:r.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(q.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(q=>{if(E.plugin.createPlugin){const f=E.plugin.createPlugin(H??{});return f instanceof Promise?(f.then(q).catch((q=>{g("Error instantiating plugin.",q)})),null):(q(f),f)}return q(E.plugin),E.plugin})((H=>{var r;if(!H)throw`The loader plugin corresponding to the '${L}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(i.notifyObservers(H),X&&(H.canDirectLoad&&H.canDirectLoad(q.url)||!(0,u.h)(q.url))){if(H.directLoad){const q=H.directLoad(f,X);q instanceof Promise?q.then((q=>{j(H,q)})).catch((q=>{g("Error in directLoad of _loadData: "+q,q)})):j(H,q)}else j(H,X);return}const z=E.isBinary,D=(q,d)=>{f.B?g("Scene has been disposed"):j(H,q,d)};let t=null,O=!1;null===(r=H.qd)||void 0===r||r.add((()=>{O=!0,t&&(t.abort(),t=null),h()}));const N=()=>{if(O)return;const j=(q,f)=>{g(null===q||void 0===q?void 0:q.statusText,f)};if(!H.loadFile&&q.rawData)throw"Plugin does not support loading ArrayBufferView.";t=H.loadFile?H.loadFile(f,q.rawData||q.file||q.url,q.rootUrl,D,d,z,j,Q):f._loadFile(q.file||q.url,D,d,!0,z,j)},w=f.getEngine();let s=w.enableOfflineSupport;if(s){let j=!1;for(const d of f.disableOfflineSupportExceptionRules)if(d.test(q.url)){j=!0;break}s=!j}s&&B.b.OfflineProviderFactory?f.offlineProvider=B.b.OfflineProviderFactory(q.url,N,w.disableManifestCheck):N()}))}function S(q,f){let j,d,h=null,L=null;if(f)if(f.name)j=`file:${f.name}`,d=f.name,h=f;else if(ArrayBuffer.isView(f))j="",d=(0,z.d)(),L=f;else if(f.startsWith("data:"))j=f,d="";else if(q){const h=f;if("/"===h.substring(0,1))return g.h.Error("Wrong sceneFilename parameter"),null;j=q+h,d=h}else j=f,d=g.h.GetFilename(f),q=g.h.GetFolderPath(f);else j=q,d=g.h.GetFilename(q),q=g.h.GetFolderPath(q);return{url:j,rootUrl:q,name:d,file:h,rawData:L}}function e(q){if("string"===typeof q.extensions){const f=q.extensions;t[f.toLowerCase()]={plugin:q,isBinary:!1}}else{const f=q.extensions,j=Object.keys(f);for(const d of j)t[d.toLowerCase()]={plugin:q,isBinary:f[d].isBinary,mimeType:f[d].mimeType}}}async function Z(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.d.LastCreatedScene,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!d)return H.e.Error("No scene available to import mesh to"),null;const B=S(f,j);if(!B)return null;const D={};d.addPendingData(D);const i=()=>{d.removePendingData(D)},t=(q,f)=>{const j=E(B,q,f);L?L(d,j,new X.i(j,X.g.SceneLoaderError,f)):H.e.Error(j),i()},O=h?q=>{try{h(q)}catch(f){t("Error in onProgress callback: "+f,f)}}:void 0,N=(q,f,j,h,L,Q,H,r)=>{if(d.importedMeshesFiles.push(B.url),g)try{g(q,f,j,h,L,Q,H,r)}catch(u){t("Error in onSuccess callback: "+u,u)}d.removePendingData(D)};return await s(B,d,((f,j,g)=>{if(f.rewriteRootURL&&(B.rootUrl=f.rewriteRootURL(B.rootUrl,g)),f.importMesh){const g=[],h=[],L=[];if(!f.importMesh(q,d,j,B.rootUrl,g,h,L,t))return;d.loadingPluginName=f.name,N(g,h,L,[],[],[],[],[])}else{f.importMeshAsync(q,d,j,B.rootUrl,O,B.name).then((q=>{d.loadingPluginName=f.name,N(q.meshes,q.ez,q.skeletons,q.animationGroups,q.transformNodes,q.geometries,q.lights,q.spriteManagers)})).catch((q=>{t(q.message,q)}))}}),O,t,i,r,u,z)}async function I(q,f,j,d,g,h,L,Q){return await new Promise(((H,r)=>{try{Z(q,f,j,d,((q,f,j,d,g,h,L,Q)=>{H({meshes:q,ez:f,skeletons:j,animationGroups:d,transformNodes:g,geometries:h,lights:L,spriteManagers:Q})}),g,((q,f,j)=>{r(j||new Error(f))}),h,L,Q).catch(r)}catch(X){r(X)}}))}async function T(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.d.LastCreatedEngine,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};j?await n(q,f,new L.b(j),d,h,H,r,u,X):g.h.Error("No engine available")}async function W(q,f,j,d,g,h,L){return await new Promise(((Q,H)=>{T(q,f,j,(q=>{Q(q)}),d,((q,f,j)=>{H(j||new Error(f))}),g,h,L)}))}async function n(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.d.LastCreatedScene,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!j)return H.e.Error("No scene available to append to"),null;const B=S(q,f);if(!B)return null;const D={};j.addPendingData(D);const i=()=>{j.removePendingData(D)};r.c.ShowLoadingScreen&&!O&&(O=!0,j.getEngine().displayLoadingUI(),j.executeWhenReady((()=>{j.getEngine().hideLoadingUI(),O=!1})));const t=(q,f)=>{const d=E(B,q,f);h?h(j,d,new X.i(d,X.g.SceneLoaderError,f)):H.e.Error(d),i()},N=g?q=>{try{g(q)}catch(f){t("Error in onProgress callback",f)}}:void 0,w=()=>{if(d)try{d(j)}catch(q){t("Error in onSuccess callback",q)}j.removePendingData(D)};return await s(B,j,((q,f)=>{if(q.load){if(!q.load(j,f,B.rootUrl,t))return;j.loadingPluginName=q.name,w()}else{q.loadAsync(j,f,B.rootUrl,N,B.name).then((()=>{j.loadingPluginName=q.name,w()})).catch((q=>{t(q.message,q)}))}}),N,t,i,L,u,z)}async function U(q,f,j,d,g,h,L){return await new Promise(((Q,H)=>{try{n(q,f,j,(q=>{Q(q)}),d,((q,f,j)=>{H(j||new Error(f))}),g,h,L).catch(H)}catch(X){H(X)}}))}async function Y(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.d.LastCreatedScene,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!j)return H.e.Error("No scene available to load asset container to"),null;const z=S(q,f);if(!z)return null;const B={};j.addPendingData(B);const D=()=>{j.removePendingData(B)},i=(q,f)=>{const d=E(z,q,f);h?h(j,d,new X.i(d,X.g.SceneLoaderError,f)):H.e.Error(d),D()},t=g?q=>{try{g(q)}catch(f){i("Error in onProgress callback",f)}}:void 0,O=q=>{if(d)try{d(q)}catch(f){i("Error in onSuccess callback",f)}j.removePendingData(B)};return await s(z,j,((q,f)=>{if(q.loadAssetContainer){const d=q.loadAssetContainer(j,f,z.rootUrl,i);if(!d)return;d.populateRootNodes(),j.loadingPluginName=q.name,O(d)}else if(q.loadAssetContainerAsync){q.loadAssetContainerAsync(j,f,z.rootUrl,t,z.name).then((f=>{f.populateRootNodes(),j.loadingPluginName=q.name,O(f)})).catch((q=>{i(q.message,q)}))}else i("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),t,i,D,L,r,u)}async function v(q,f,j,d,g,h,L){return await new Promise(((Q,H)=>{try{Y(q,f,j,(q=>{Q(q)}),d,((q,f,j)=>{H(j||new Error(f))}),g,h,L).catch(H)}catch(X){H(X)}}))}async function F(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.d.LastCreatedScene,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!j)return void H.e.Error("No scene available to load animations to");if(d){for(const d of j.animatables)d.reset();j.stopAllAnimations();const q=j.animationGroups.slice();for(const j of q)j.dispose();const f=j.getNodes();for(const j of f)j.animations&&(j.animations=[])}else switch(g){case 0:const q=j.animationGroups.slice();for(const f of q)f.dispose();break;case 1:for(const f of j.animationGroups)f.stop();break;case 2:for(const f of j.animationGroups)f.reset(),f.restart();break;case 3:break;default:return void H.e.Error("Unknown animation group loading mode value '"+g+"'")}const D=j.animatables.length;await Y(q,f,j,(q=>{q.mergeAnimationsTo(j,j.animatables.slice(D),h),q.dispose(),j.onAnimationFileImportedObservable.notifyObservers(j),L&&L(j)}),r,u,X,z,B)}async function M(q,f,j,d,g,h,L,Q,H,r){return await new Promise(((u,z)=>{try{F(q,f,j,d,g,h,(q=>{u(q)}),L,((q,f,j)=>{z(j||new Error(f))}),Q,H,r).catch(z)}catch(X){z(X)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return r.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){r.c.ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return r.c.ShowLoadingScreen}static set ShowLoadingScreen(q){r.c.ShowLoadingScreen=q}static get loggingLevel(){return r.c.loggingLevel}static set loggingLevel(q){r.c.loggingLevel=q}static get CleanBoneMatrixWeights(){return r.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){r.c.CleanBoneMatrixWeights=q}static GetDefaultPlugin(){return N()}static GetPluginForExtension(q){var f;return null===(f=w(q,!0))||void 0===f?void 0:f.plugin}static IsPluginForExtensionAvailable(q){return function(q){return!!t[q]}(q)}static RegisterPlugin(q){e(q)}static ImportMesh(q,f,j,d,g,h,L,H,r){Z(q,f,j,d,g,h,L,H,r).catch((q=>null===L||void 0===L?void 0:L(Q.d.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportMeshAsync(q,f,j,d,g,h,L){return await I(q,f,j,d,g,h,L)}static Load(q,f,j,d,g,h,L,H){T(q,f,j,d,g,h,L,H).catch((q=>null===h||void 0===h?void 0:h(Q.d.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAsync(q,f,j,d,g,h){return await W(q,f,j,d,g,h)}static Append(q,f,j,d,g,h,L,H){n(q,f,j,d,g,h,L,H).catch((q=>null===h||void 0===h?void 0:h(j??Q.d.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async AppendAsync(q,f,j,d,g,h){return await U(q,f,j,d,g,h)}static LoadAssetContainer(q,f,j,d,g,h,L,H){Y(q,f,j,d,g,h,L,H).catch((q=>null===h||void 0===h?void 0:h(j??Q.d.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAssetContainerAsync(q,f,j,d,g,h){return await v(q,f,j,d,g,h)}static ImportAnimations(q,f,j,d,g,h,L,H,r,u,X){F(q,f,j,d,g,h,L,H,r,u,X).catch((q=>null===r||void 0===r?void 0:r(j??Q.d.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportAnimationsAsync(q,f,j,d,g,h,L,Q,H,r,u){return await M(q,f,j,d,g,h,Q,r,u)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=i},12668:(q,f,j)=>{"use strict";j.d(f,{e:()=>z});var d=j(11125),g=j(11130),h=j(10992),L=j(10941),Q=j(11417),H=j(11438),r=j(10965),u=j(10982),X=j(11199);j(12676);class z extends Q.b{set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const f=this.eq();f&&f.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(q){this._rotationY=q,this.setReflectionTextureMatrix(L.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(q,f,j){let d="";for(const g of q)d+=g;return new z(d,f,null,j,q)}static CreateFromPrefilteredData(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=f.useDelayedTextureLoading;f.useDelayedTextureLoading=!1;const h=new z(q,f,null,!1,null,null,null,void 0,!0,j,d);return f.useDelayedTextureLoading=g,h}constructor(q,f){var j;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10],i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,O=arguments.length>13?arguments[13]:void 0,N=arguments.length>14?arguments[14]:void 0;super(f),this.onLoadObservable=new u.d,this.boundingBoxPosition=L.j.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new L.b,this._buffer=null,this.name=q,this.url=q,this._noMipmap=g,this.Rf=!1,this.isCube=!0,this._textureMatrix=L.b.Identity(),this.coordinatesMode=H.e.CUBIC_MODE;let w=null,E=null;null===d||Array.isArray(d)?(this._noMipmap=g,this._format=X,this._createPolynomials=D,w=d,this._loaderOptions=O,this._useSRGBBuffer=N,this._lodScale=i,this._lodOffset=t):(w=d.extensions??null,this._noMipmap=d.noMipmap??!1,h=d.files??null,E=d.buffer??null,this._format=d.format??5,z=d.prefiltered??!1,B=d.forcedExtension??null,this._createPolynomials=d.createPolynomials??!1,this._lodScale=d.lodScale??.8,this._lodOffset=d.lodOffset??0,this._loaderOptions=d.loaderOptions,this._useSRGBBuffer=d.useSRGBBuffer,Q=d.m??null,r=d.onError??null),(q||h)&&this.updateURL(q,B,Q,z,r,w,null===(j=this.eq())||void 0===j?void 0:j.useDelayedTextureLoading,h,E)}getClassName(){return"CubeTexture"}updateURL(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,f&&(this._forcedExtension=f);const r=q.lastIndexOf("."),u=f||(r>-1?q.substring(r).toLowerCase():""),X=0===u.indexOf(".dds"),z=0===u.indexOf(".env"),B=0===u.indexOf(".basis");if(z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=d,d&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Q)this._files=Q;else if(B||z||X||h||(h=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,h){for(let f=0;f<h.length;f++)this._files.push(q+h[f]);this._extensions=h}this._buffer=H,L?(this.delayLoadState=4,this._delayedOnLoad=j,this._delayedOnError=g):this._loadTexture(j,g)}delayLoad(q){4===this.delayLoadState&&(q&&(this._forcedExtension=q),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(q){var f,j;if(q.updateFlag===this._textureMatrix.updateFlag)return;q.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(j=this.eq())||void 0===j||j.markAllMaterialsAsDirty(1,(q=>-1!==q.getActiveTextures().indexOf(this))));if(this._textureMatrix=q,null===(f=this.eq())||void 0===f||!f.useRightHandedSystem)return;const d=L.f.kf[0],g=L.f.Quaternion[0],h=L.f.kf[1];this._textureMatrix.decompose(d,g,h),g.z*=-1,g.w*=-1,L.b.ComposeToRef(d,g,h,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var q;return null!==(q=this.eq())&&void 0!==q&&q.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this.eq(),d=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const g=()=>{var f;(this.onLoadObservable.notifyObservers(this),d)&&(d.dispose(),null===(f=this.eq())||void 0===f||f.markAllMaterialsAsDirty(1));q&&q()},L=(q,j)=>{this._loadingError=!0,this._errorObject={message:q,exception:j},f&&f(q,j),H.e.OnTextureLoadErrorObservable.notifyObservers(this)};var Q;this._texture?this._texture.isReady?h.h.SetImmediate((()=>g())):this._texture.onLoadedObservable.add((()=>g())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,j,this._lodScale,this._lodOffset,q,L,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,j,this._files,this._noMipmap,q,L,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(Q=this._texture)||void 0===Q||Q.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(q,f,j){const d=X.d.Parse((()=>{let d=!1;return q.prefiltered&&(d=q.prefiltered),new z(j+(q.url??q.name),f,q.extensions,!1,q.files||null,null,null,void 0,d,q.forcedExtension)}),q,f);if(q.boundingBoxPosition&&(d.boundingBoxPosition=L.j.Pf(q.boundingBoxPosition)),q.boundingBoxSize&&(d.boundingBoxSize=L.j.Pf(q.boundingBoxSize)),q.animations)for(let g=0;g<q.animations.length;g++){const f=q.animations[g],j=(0,r.c)("BABYLON.Animation");j&&d.animations.push(j.Parse(f))}return d}clone(){let q=0;const f=X.d.Clone((()=>{const f=new z(this.url,this.eq()||this._getEngine(),this._extensions,this._noMipmap,this._files);return q=f.uniqueId,f}),this);return f.uniqueId=q,f}}(0,d.b)([(0,g.O)()],z.prototype,"url",void 0),(0,d.b)([(0,g.M)()],z.prototype,"boundingBoxPosition",void 0),(0,d.b)([(0,g.M)()],z.prototype,"boundingBoxSize",null),(0,d.b)([(0,g.O)("rotationY")],z.prototype,"rotationY",null),(0,d.b)([(0,g.O)("files")],z.prototype,"_files",void 0),(0,d.b)([(0,g.O)("forcedExtension")],z.prototype,"_forcedExtension",void 0),(0,d.b)([(0,g.O)("extensions")],z.prototype,"_extensions",void 0),(0,d.b)([(0,g.v)("textureMatrix")],z.prototype,"_textureMatrix",void 0),(0,d.b)([(0,g.v)("textureMatrixRefraction")],z.prototype,"_textureMatrixRefraction",void 0),H.e._CubeTextureParser=z.Parse,(0,r.f)("BABYLON.CubeTexture",z)},13152:(q,f,j)=>{"use strict";j.d(f,{c:()=>H});var d=j(11005),g=j(11438),h=j(11114),L=j(11337),Q=j(11090);L.ThinEngine.prototype.createDynamicTexture=function(q,f,j,d){const g=new Q.c(this,4);return g.baseWidth=q,g.baseHeight=f,j&&(q=this.needPOTTextures?(0,h.g)(q,this._caps.maxTextureSize):q,f=this.needPOTTextures?(0,h.g)(f,this._caps.maxTextureSize):f),g.width=q,g.height=f,g.isReady=!1,g.generateMipMaps=j,g.samplingMode=d,this.updateTextureSamplingMode(d,g),this._internalTexturesCache.push(g),g},L.ThinEngine.prototype.updateDynamicTexture=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!q)return;const L=this._gl,Q=L.TEXTURE_2D,H=this._bindTextureDirectly(Q,q,!0,h);this._unpackFlipY(void 0===j?q.invertY:j),d&&L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const r=this._getWebGLTextureType(q.type),u=this._getInternalFormat(g||q.format),X=this._getRGBABufferInternalSizedFormat(q.type,u);L.texImage2D(Q,0,X,u,r,f),q.generateMipMaps&&L.generateMipmap(Q),H||this._bindTextureDirectly(Q,null),d&&L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g&&(q.format=g),q._dynamicTextureSource=f,q._premulAlpha=d,q.invertY=j||!1,q.isReady=!0};class H extends g.e{constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,Q=arguments.length>6?arguments[6]:void 0;const H=!j||j._isScene;super(null,H?j:null===j||void 0===j?void 0:j.Sf,H?!d:j,Q,h,void 0,void 0,void 0,void 0,L),this.name=q,this.wrapU=g.e.CLAMP_ADDRESSMODE,this.wrapV=g.e.CLAMP_ADDRESSMODE,this._generateMipMaps=d;const r=this._getEngine();if(!r)return;if(f.getContext)this._canvas=f,this._ownCanvas=!1,this._texture=r.createDynamicTexture(this._canvas.width,this._canvas.height,d,h);else{this._canvas=r.createCanvas(1,1),this._ownCanvas=!0;const q=f;q.width||0===q.width?this._texture=r.createDynamicTexture(q.width,q.height,d,h):this._texture=r.createDynamicTexture(f,f,d,h)}const u=this.getSize();this._canvas.width!==u.width&&(this._canvas.width=u.width),this._canvas.height!==u.height&&(this._canvas.height=u.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(q){this._canvas.width=q.width,this._canvas.height=q.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(q.width,q.height,this._generateMipMaps,this.samplingMode)}scale(q){const f=this.getSize();f.width*=q,f.height*=q,this._recreate(f)}scaleTo(q,f){const j=this.getSize();j.width=q,j.height=f,this._recreate(j)}getContext(){return this._context}clear(q){const f=this.getSize();q&&(this._context.fillStyle=q),this._context.clearRect(0,0,f.width,f.height)}update(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===q||q,f,this._format||void 0,void 0,j)}drawText(q,f,j,d,g,h,L){let Q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const H=this.getSize();if(h&&(this._context.fillStyle=h,this._context.fillRect(0,0,H.width,H.height)),this._context.font=d,null===f||void 0===f){const j=this._context.measureText(q);f=(H.width-j.width)/2}if(null===j||void 0===j){const q=parseInt(d.replace(/\D/g,""));j=H.height/2+q/3.65}this._context.fillStyle=g||"",this._context.fillText(q,f,j),Q&&this.update(L)}dispose(){var q,f;(super.dispose(),this._ownCanvas)&&(null===(q=this._canvas)||void 0===q||null===(f=q.remove)||void 0===f||f.call(q));this._canvas=null,this._context=null}clone(){const q=this.eq();if(!q)return this;const f=this.getSize(),j=new H(this.name,f,q,this._generateMipMaps);return j.Rf=this.Rf,j.level=this.level,j.wrapU=this.wrapU,j.wrapV=this.wrapV,j}serialize(){const q=this.eq();q&&!q.isReady()&&d.e.Warn("The scene must be ready before serializing the dynamic texture");const f=super.serialize();return H._IsCanvasElement(this._canvas)&&(f.base64String=this._canvas.toDataURL()),f.invertY=this._invertY,f.samplingMode=this.samplingMode,f}static _IsCanvasElement(q){return void 0!==q.toDataURL}_rebuild(){this.update()}}},12585:(q,f,j)=>{"use strict";j.d(f,{b:()=>g});var d=j(11438);class g extends d.e{get depth(){return this._depth}constructor(q,f,j,g,h,L){let Q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:d.e.TRILINEAR_SAMPLINGMODE,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;super(null,L,!Q,H),this.format=h,this._texture=L.getEngine().createRawTexture2DArray(q,f,j,g,h,Q,H,r,null,u,X),this._depth=g,this.is2DArray=!0}update(q){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(q,f,j,d,h){return new g(q,f,j,d,5,h,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12406:(q,f,j)=>{"use strict";j.d(f,{c:()=>Q,g:()=>H,h:()=>h,i:()=>L});var d=j(10985),g=j(10941);function h(q,f){return`{X: ${q.x.toFixed(f)} Y: ${q.y.toFixed(f)}}`}function L(q,f){return`{X: ${q._x.toFixed(f)} Y: ${q._y.toFixed(f)} Z: ${q._z.toFixed(f)}}`}function Q(q,f){return 2*Math.acos((0,d.Clamp)(g.e.Dot(q,f)))}function H(q,f){const j=new g.e;return function(q,f,j){const h=g.j.Cross(q,f),L=Math.acos((0,d.Clamp)(g.j.Dot(q,f),-1,1));g.e.RotationAxisToRef(h,L,j)}(q,f,j),j}},12265:(q,f,j)=>{"use strict";j.d(f,{c:()=>r});var d=j(10941),g=j(11210),h=j(11289),L=j(11257),Q=j(11316);j(12269);function H(q){let f=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const j=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],h=[];let H=[];const r=q.width||q.size||1,u=q.height||q.size||1,X=q.depth||q.size||1,z=q.wrap||!1;let B=void 0===q.topBaseAt?1:q.topBaseAt,D=void 0===q.bottomBaseAt?0:q.bottomBaseAt;B=(B+4)%4,D=(D+4)%4;let i=[2,0,3,1][B],t=[2,0,1,3][D],O=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(z){f=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],O=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let q=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],j=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const d=[17,18,19,16],g=[22,23,20,21];for(;i>0;)q.unshift(q.pop()),d.unshift(d.pop()),i--;for(;t>0;)j.unshift(j.pop()),g.unshift(g.pop()),t--;q=q.flat(),j=j.flat(),O=O.concat(q).concat(j),f.push(d[0],d[2],d[3],d[0],d[1],d[2]),f.push(g[0],g[2],g[3],g[0],g[1],g[2])}const N=[r/2,u/2,X/2];H=O.reduce(((q,f,j)=>q.concat(f*N[j%3])),[]);const w=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,E=q.faceUV||new Array(6),s=q.faceColors,S=[];for(let L=0;L<6;L++)void 0===E[L]&&(E[L]=new d.m(0,0,1,1)),s&&void 0===s[L]&&(s[L]=new g.e(1,1,1,1));for(let d=0;d<6;d++)if(h.push(E[d].z,Q.b?1-E[d].w:E[d].w),h.push(E[d].x,Q.b?1-E[d].w:E[d].w),h.push(E[d].x,Q.b?1-E[d].y:E[d].y),h.push(E[d].z,Q.b?1-E[d].y:E[d].y),s)for(let q=0;q<4;q++)S.push(s[d].r,s[d].g,s[d].b,s[d].a);L.e._ComputeSides(w,H,f,j,h,q.frontUVs,q.backUVs);const e=new L.e;if(e.indices=f,e.Iq=H,e.Tq=j,e.nq=h,s){const q=w===L.e.DOUBLESIDE?S.concat(S):S;e.Wq=q}return e}function r(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new h.e(q,j);f.sideOrientation=h.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return H(f).Yq(d,f.updatable),d}L.e.CreateBox=H,h.e.CreateBox=function(q,f){return r(q,{size:f,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12394:(q,f,j)=>{"use strict";j.d(f,{e:()=>Q});var d=j(11289),g=j(11257),h=j(11316);function L(q){const f=[],j=[],d=[],L=[],Q=q.radius||.5,H=q.tessellation||64,r=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,u=0===q.sideOrientation?0:q.sideOrientation||g.e.DEFAULTSIDE;f.push(0,0,0),L.push(.5,.5);const X=2*Math.PI*r,z=1===r?X/H:X/(H-1);let B=0;for(let g=0;g<H;g++){const q=Math.cos(B),j=Math.sin(B),d=(q+1)/2,g=(1-j)/2;f.push(Q*q,Q*j,0),L.push(d,h.b?1-g:g),B+=z}1===r&&(f.push(f[3],f[4],f[5]),L.push(L[2],h.b?1-L[3]:L[3]));const D=f.length/3;for(let g=1;g<D-1;g++)j.push(g+1,0,g);g.e.ComputeNormals(f,j,d),g.e._ComputeSides(u,f,j,d,L,q.frontUVs,q.backUVs);const i=new g.e;return i.indices=j,i.Iq=f,i.Tq=d,i.nq=L,i}function Q(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new d.e(q,j);f.sideOrientation=d.e._GetDefaultSideOrientation(f.sideOrientation),g._originalBuilderSideOrientation=f.sideOrientation;return L(f).Yq(g,f.updatable),g}g.e.CreateDisc=L,d.e.CreateDisc=function(q,f,j){return Q(q,{radius:f,tessellation:j,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12269:(q,f,j)=>{"use strict";j.d(f,{i:()=>t,e:()=>N,l:()=>O});var d=j(10941),g=j(11210),h=j(11289),L=j(11257),Q=j(11151);h.e._GroundMeshParser=(q,f)=>H.Parse(q,f);class H extends h.e{constructor(q,f){super(q,f),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=q,this._subdivisionsY=q,this.subdivide(q);const j=this;j.createOrUpdateSubmeshesOctree&&j.createOrUpdateSubmeshesOctree(f)}getHeightAtCoordinates(q,f){const j=this.getWorldMatrix(),g=d.f.Matrix[5];j.invertToRef(g);const h=d.f.kf[8];if(d.j.TransformCoordinatesFromFloatsToRef(q,0,f,g,h),q=h.x,f=h.z,q<this._minX||q>=this._maxX||f<=this._minZ||f>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const L=this._getFacetAt(q,f),Q=-(L.x*q+L.z*f+L.w)/L.y;return d.j.TransformCoordinatesFromFloatsToRef(0,Q,0,j,h),h.y}getNormalAtCoordinates(q,f){const j=new d.j(0,1,0);return this.getNormalAtCoordinatesToRef(q,f,j),j}getNormalAtCoordinatesToRef(q,f,j){const g=this.getWorldMatrix(),h=d.f.Matrix[5];g.invertToRef(h);const L=d.f.kf[8];if(d.j.TransformCoordinatesFromFloatsToRef(q,0,f,h,L),q=L.x,f=L.z,q<this._minX||q>this._maxX||f<this._minZ||f>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Q=this._getFacetAt(q,f);return d.j.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,g,j),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(q,f){const j=Math.floor((q+this._maxX)*this._subdivisionsX/this._width),d=Math.floor(-(f+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),g=this._heightQuads[d*this._subdivisionsX+j];let h;return h=f<g.slope.x*q+g.slope.y?g.facet1:g.facet2,h}_initHeightQuads(){const q=this._subdivisionsX,f=this._subdivisionsY;this._heightQuads=[];for(let j=0;j<f;j++)for(let f=0;f<q;f++){const g={slope:d.i.Zero(),facet1:new d.m(0,0,0,0),facet2:new d.m(0,0,0,0)};this._heightQuads[j*q+f]=g}return this}_computeHeightQuads(){const q=this.getVerticesData(Q.i.PositionKind);if(!q)return this;const f=d.f.kf[3],j=d.f.kf[2],g=d.f.kf[1],h=d.f.kf[0],L=d.f.kf[4],H=d.f.kf[5],r=d.f.kf[6],u=d.f.kf[7],X=d.f.kf[8];let z=0,B=0,D=0,i=0,t=0,O=0,N=0;const w=this._subdivisionsX,E=this._subdivisionsY;for(let Q=0;Q<E;Q++)for(let E=0;E<w;E++){z=3*E,B=Q*(w+1)*3,D=(Q+1)*(w+1)*3,f.x=q[B+z],f.y=q[B+z+1],f.z=q[B+z+2],j.x=q[B+z+3],j.y=q[B+z+4],j.z=q[B+z+5],g.x=q[D+z],g.y=q[D+z+1],g.z=q[D+z+2],h.x=q[D+z+3],h.y=q[D+z+4],h.z=q[D+z+5],i=(h.z-f.z)/(h.x-f.x),t=f.z-i*f.x,j.subtractToRef(f,L),g.subtractToRef(f,H),h.subtractToRef(f,r),d.j.CrossToRef(r,H,u),d.j.CrossToRef(L,r,X),u.normalize(),X.normalize(),O=-(u.x*f.x+u.y*f.y+u.z*f.z),N=-(X.x*j.x+X.y*j.y+X.z*j.z);const s=this._heightQuads[Q*w+E];s.slope.Af(i,t),s.facet1.Af(u.x,u.y,u.z,O),s.facet2.Af(X.x,X.y,X.z,N)}return this}serialize(q){super.serialize(q),q.subdivisionsX=this._subdivisionsX,q.subdivisionsY=this._subdivisionsY,q.minX=this._minX,q.maxX=this._maxX,q.gd=this._minZ,q.maxZ=this._maxZ,q.width=this._width,q.height=this._height}static Parse(q,f){const j=new H(q.name,f);return j._subdivisionsX=q.subdivisionsX||1,j._subdivisionsY=q.subdivisionsY||1,j._minX=q.minX,j._maxX=q.maxX,j._minZ=q.gd,j._maxZ=q.maxZ,j._width=q.width,j._height=q.height,j}}var r=j(10992),u=j(10980),X=j(10950),z=j(11316);function B(q){const f=[],j=[],g=[],h=[];let Q,H;const r=q.width||q.size||1,u=q.height||q.size||1,X=0|(q.subdivisionsX||q.subdivisions||1),B=0|(q.subdivisionsY||q.subdivisions||1);for(Q=0;Q<=B;Q++)for(H=0;H<=X;H++){const q=new d.j(H*r/X-r/2,0,(B-Q)*u/B-u/2),f=new d.j(0,1,0);j.push(q.x,q.y,q.z),g.push(f.x,f.y,f.z),h.push(H/X,z.b?Q/B:1-Q/B)}for(Q=0;Q<B;Q++)for(H=0;H<X;H++)f.push(H+1+(Q+1)*(X+1)),f.push(H+1+Q*(X+1)),f.push(H+Q*(X+1)),f.push(H+(Q+1)*(X+1)),f.push(H+1+(Q+1)*(X+1)),f.push(H+Q*(X+1));const D=new L.e;return D.indices=f,D.Iq=j,D.Tq=g,D.nq=h,D}function D(q){const f=void 0!==q.xmin&&null!==q.xmin?q.xmin:-1,j=void 0!==q.zmin&&null!==q.zmin?q.zmin:-1,g=void 0!==q.xmax&&null!==q.xmax?q.xmax:1,h=void 0!==q.zmax&&null!==q.zmax?q.zmax:1,Q=q.subdivisions||{w:1,h:1},H=q.precision||{w:1,h:1},r=[],u=[],X=[],z=[];let B,D,i,t;Q.h=Q.h<1?1:Q.h,Q.w=Q.w<1?1:Q.w,H.w=H.w<1?1:H.w,H.h=H.h<1?1:H.h;const O=(g-f)/Q.w,N=(h-j)/Q.h;function w(q,f,j,g){const h=u.length/3,L=H.w+1;for(B=0;B<H.h;B++)for(D=0;D<H.w;D++){const q=[h+D+B*L,h+(D+1)+B*L,h+(D+1)+(B+1)*L,h+D+(B+1)*L];r.push(q[1]),r.push(q[2]),r.push(q[3]),r.push(q[0]),r.push(q[1]),r.push(q[3])}const Q=d.j.Zero(),i=new d.j(0,1,0);for(B=0;B<=H.h;B++)for(Q.z=B*(g-f)/H.h+f,D=0;D<=H.w;D++)Q.x=D*(j-q)/H.w+q,Q.y=0,u.push(Q.x,Q.y,Q.z),X.push(i.x,i.y,i.z),z.push(D/H.w,B/H.h)}for(i=0;i<Q.h;i++)for(t=0;t<Q.w;t++)w(f+t*O,j+i*N,f+(t+1)*O,j+(i+1)*N);const E=new L.e;return E.indices=r,E.Iq=u,E.Tq=X,E.nq=z,E}function i(q){const f=[],j=[],h=[],Q=[];let H,r;const u=q.colorFilter||new g.c(.3,.59,.11),z=q.alphaFilter||0;let B=!1;if(q.minHeight>q.maxHeight){B=!0;const f=q.maxHeight;q.maxHeight=q.minHeight,q.minHeight=f}for(H=0;H<=q.subdivisions;H++)for(r=0;r<=q.subdivisions;r++){const f=new d.j(r*q.width/q.subdivisions-q.width/2,0,(q.subdivisions-H)*q.height/q.subdivisions-q.height/2),g=4*(((f.x+q.width/2)/q.width*(q.bufferWidth-1)|0)+((1-(f.z+q.height/2)/q.height)*(q.bufferHeight-1)|0)*q.bufferWidth);let L=q.buffer[g]/255,D=q.buffer[g+1]/255,i=q.buffer[g+2]/255;const t=q.buffer[g+3]/255;B&&(L=1-L,D=1-D,i=1-i);const O=L*u.r+D*u.g+i*u.b;f.y=t>=z?q.minHeight+(q.maxHeight-q.minHeight)*O:q.minHeight-X.d,q.heightBuffer&&(q.heightBuffer[H*(q.subdivisions+1)+r]=f.y),j.push(f.x,f.y,f.z),h.push(0,0,0),Q.push(r/q.subdivisions,1-H/q.subdivisions)}for(H=0;H<q.subdivisions;H++)for(r=0;r<q.subdivisions;r++){const d=r+1+(H+1)*(q.subdivisions+1),g=r+1+H*(q.subdivisions+1),h=r+H*(q.subdivisions+1),L=r+(H+1)*(q.subdivisions+1),Q=j[3*d+1]>=q.minHeight,u=j[3*g+1]>=q.minHeight,X=j[3*h+1]>=q.minHeight;Q&&u&&X&&(f.push(d),f.push(g),f.push(h));j[3*L+1]>=q.minHeight&&Q&&X&&(f.push(L),f.push(d),f.push(h))}L.e.ComputeNormals(j,f,h);const D=new L.e;return D.indices=f,D.Iq=j,D.Tq=h,D.nq=Q,D}function t(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const j=new H(q,arguments.length>2?arguments[2]:void 0);j._setReady(!1),j._subdivisionsX=f.subdivisionsX||f.subdivisions||1,j._subdivisionsY=f.subdivisionsY||f.subdivisions||1,j._width=f.width||1,j._height=f.height||1,j._maxX=j._width/2,j._maxZ=j._height/2,j._minX=-j._maxX,j._minZ=-j._maxZ;return B(f).Yq(j,f.updatable),j._setReady(!0),j}function O(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new h.e(q,j);return D(f).Yq(d,f.updatable),d}function N(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=j.width||10,L=j.height||10,Q=j.subdivisions||1,X=j.minHeight||0,z=j.maxHeight||1,B=j.colorFilter||new g.c(.3,.59,.11),D=j.alphaFilter||0,t=j.updatable,O=j.onReady;d=d||u.d.LastCreatedScene;const N=new H(q,d);let w;N._subdivisionsX=Q,N._subdivisionsY=Q,N._width=h,N._height=L,N._maxX=N._width/2,N._maxZ=N._height/2,N._minX=-N._maxX,N._minZ=-N._maxZ,N._setReady(!1),j.passHeightBufferInCallback&&(w=new Float32Array((Q+1)*(Q+1)));const E=(q,f,j)=>{i({width:h,height:L,subdivisions:Q,minHeight:X,maxHeight:z,colorFilter:B,buffer:q,bufferWidth:f,bufferHeight:j,alphaFilter:D,heightBuffer:w}).Yq(N,t),O&&O(N,w),N._setReady(!0)};if("string"===typeof f){const q=q=>{var f;const j=q.width,g=q.height;if(d.B)return;const h=null===(f=d)||void 0===f?void 0:f.getEngine().resizeImageBitmap(q,j,g);E(h,j,g)};r.h.LoadImage(f,q,j.onError?j.onError:()=>{},d.offlineProvider)}else E(f.data,f.width,f.height);return N}L.e.CreateGround=B,L.e.CreateTiledGround=D,L.e.CreateGroundFromHeightMap=i,h.e.CreateGround=(q,f,j,d,g,h)=>t(q,{width:f,height:j,subdivisions:d,updatable:h},g),h.e.CreateTiledGround=(q,f,j,d,g,h,L,Q,H)=>O(q,{xmin:f,zmin:j,xmax:d,zmax:g,subdivisions:h,precision:L,updatable:H},Q),h.e.CreateGroundFromHeightMap=(q,f,j,d,g,h,L,Q,H,r,u)=>N(q,f,{width:j,height:d,subdivisions:g,minHeight:h,maxHeight:L,updatable:H,onReady:r,alphaFilter:u},Q)},12874:(q,f,j)=>{"use strict";j.d(f,{d:()=>B,g:()=>X,k:()=>z});var d=j(10941),g=j(11289),h=j(11257),L=j(11634),Q=j(11151),H=j(11005);function r(q){const f=[],j=[],d=q.lines,g=q.Wq,L=[];let Q=0;for(let h=0;h<d.length;h++){const q=d[h];for(let d=0;d<q.length;d++){const{x:H,y:r,z:u}=q[d];if(j.push(H,r,u),g){const q=g[h],{r:f,g:j,b:Q,a:H}=q[d];L.push(f,j,Q,H)}d>0&&(f.push(Q-1),f.push(Q)),Q++}}const H=new h.e;return H.indices=f,H.Iq=j,g&&(H.Wq=L),H}function u(q){const f=q.dashSize||3,j=q.gapSize||1,g=q.dashNb||200,L=q.points,Q=[],H=[],r=d.j.Zero();let u=0,X=0,z=0,B=0,D=0,i=0,t=0;for(t=0;t<L.length-1;t++)L[t+1].subtractToRef(L[t],r),u+=r.length();for(z=u/g,B=f*z/(f+j),t=0;t<L.length-1;t++){L[t+1].subtractToRef(L[t],r),X=Math.floor(r.length()/z),r.normalize();for(let q=0;q<X;q++)D=z*q,Q.push(L[t].x+D*r.x,L[t].y+D*r.y,L[t].z+D*r.z),Q.push(L[t].x+(D+B)*r.x,L[t].y+(D+B)*r.y,L[t].z+(D+B)*r.z),H.push(i,i+1),i+=2}const O=new h.e;return O.Iq=Q,O.indices=H,O}function X(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=f.instance,g=f.lines,h=f.Wq;if(d){const q=d.getVerticesData(Q.i.PositionKind);let f,j;h&&(f=d.getVerticesData(Q.i.ColorKind));let L=0,H=0;for(let d=0;d<g.length;d++){const Q=g[d];for(let g=0;g<Q.length;g++)q[L]=Q[g].x,q[L+1]=Q[g].y,q[L+2]=Q[g].z,h&&f&&(j=h[d],f[H]=j[g].r,f[H+1]=j[g].g,f[H+2]=j[g].b,f[H+3]=j[g].a,H+=4),L+=3}return d.updateVerticesData(Q.i.PositionKind,q,!1,!1),h&&f&&d.updateVerticesData(Q.i.ColorKind,f,!1,!1),d.refreshBoundingInfo(),d}const H=!!h,u=new L.c(q,j,null,void 0,void 0,H,f.useVertexAlpha,f.material);return r(f).Yq(u,f.updatable),u}function z(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=f.Wq?[f.Wq]:null;return X(q,{lines:[f.points],updatable:f.updatable,instance:f.instance,Wq:d,useVertexAlpha:f.useVertexAlpha,material:f.material},j)}function B(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=f.points,Q=f.instance,r=f.gapSize||1,X=f.dashSize||3;if(Q){const q=q=>{const f=d.j.Zero(),j=q.length/6;let g=0,L=0,H=0,r=0,u=0,X=0,z=0,B=0;for(z=0;z<h.length-1;z++)h[z+1].subtractToRef(h[z],f),g+=f.length();H=g/j;const D=Q._creationDataStorage.dashSize;for(r=D*H/(D+Q._creationDataStorage.gapSize),z=0;z<h.length-1;z++)for(h[z+1].subtractToRef(h[z],f),L=Math.floor(f.length()/H),f.normalize(),B=0;B<L&&X<q.length;)u=H*B,q[X]=h[z].x+u*f.x,q[X+1]=h[z].y+u*f.y,q[X+2]=h[z].z+u*f.z,q[X+3]=h[z].x+(u+r)*f.x,q[X+4]=h[z].y+(u+r)*f.y,q[X+5]=h[z].z+(u+r)*f.z,X+=6,B++;for(;X<q.length;)q[X]=h[z].x,q[X+1]=h[z].y,q[X+2]=h[z].z,X+=3};return(f.dashNb||f.dashSize||f.gapSize||f.useVertexAlpha||f.material)&&H.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),Q.updateMeshPositions(q,!1),Q}const z=new L.c(q,j,null,void 0,void 0,void 0,f.useVertexAlpha,f.material);return u(f).Yq(z,f.updatable),z._creationDataStorage=new g.f,z._creationDataStorage.dashSize=X,z._creationDataStorage.gapSize=r,z}h.e.CreateLineSystem=r,h.e.CreateDashedLines=u,g.e.Vr=function(q,f){return z(q,{points:f,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},g.e.CreateDashedLines=function(q,f,j,d,g){return B(q,{points:f,dashSize:j,gapSize:d,dashNb:g,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12319:(q,f,j)=>{"use strict";j.d(f,{c:()=>Q,e:()=>H});var d=j(11289),g=j(11257),h=j(11316);function L(q){const f=[],j=[],d=[],L=[],Q=void 0!==q.width?q.width:void 0!==q.size?q.size:1,H=void 0!==q.height?q.height:void 0!==q.size?q.size:1,r=0===q.sideOrientation?0:q.sideOrientation||g.e.DEFAULTSIDE,u=Q/2,X=H/2;j.push(-u,-X,0),d.push(0,0,-1),L.push(0,h.b?1:0),j.push(u,-X,0),d.push(0,0,-1),L.push(1,h.b?1:0),j.push(u,X,0),d.push(0,0,-1),L.push(1,h.b?0:1),j.push(-u,X,0),d.push(0,0,-1),L.push(0,h.b?0:1),f.push(0),f.push(1),f.push(2),f.push(0),f.push(2),f.push(3),g.e._ComputeSides(r,j,f,d,L,q.frontUVs,q.backUVs);const z=new g.e;return z.indices=f,z.Iq=j,z.Tq=d,z.nq=L,z}function Q(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new d.e(q,j);f.sideOrientation=d.e._GetDefaultSideOrientation(f.sideOrientation),g._originalBuilderSideOrientation=f.sideOrientation;return L(f).Yq(g,f.updatable),f.sourcePlane&&(g.translate(f.sourcePlane.df,-f.sourcePlane.d),g.setDirection(f.sourcePlane.df.scale(-1))),g}const H={Pr:Q};g.e.Pr=L,d.e.Pr=(q,f,j,d,g)=>Q(q,{size:f,width:f,height:f,sideOrientation:g,updatable:d},j)},12385:(q,f,j)=>{"use strict";j.d(f,{d:()=>H});var d=j(10941),g=j(11289),h=j(11257),L=j(11316);function Q(q){const f=0|(q.segments||32),j=q.diameterX||q.diameter||1,g=q.diameterY||q.diameter||1,Q=q.diameterZ||q.diameter||1,H=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,r=q.slice&&q.slice<=0?1:q.slice||1,u=0===q.sideOrientation?0:q.sideOrientation||h.e.DEFAULTSIDE,X=!!q.dedupTopBottomIndices,z=new d.j(j/2,g/2,Q/2),B=2+f,D=2*B,i=[],t=[],O=[],N=[];for(let h=0;h<=B;h++){const q=h/B,f=q*Math.PI*r;for(let j=0;j<=D;j++){const g=j/D,h=g*Math.PI*2*H,Q=d.b.RotationZ(-f),r=d.b.RotationY(h),u=d.j.TransformCoordinates(d.j.Up(),Q),X=d.j.TransformCoordinates(u,r),B=X.multiply(z),i=X.divide(z).normalize();t.push(B.x,B.y,B.z),O.push(i.x,i.y,i.z),N.push(g,L.b?1-q:q)}if(h>0){const q=t.length/3;for(let f=q-2*(D+1);f+D+2<q;f++)X?(h>1&&(i.push(f),i.push(f+1),i.push(f+D+1)),(h<B||r<1)&&(i.push(f+D+1),i.push(f+1),i.push(f+D+2))):(i.push(f),i.push(f+1),i.push(f+D+1),i.push(f+D+1),i.push(f+1),i.push(f+D+2))}}h.e._ComputeSides(u,t,i,O,N,q.frontUVs,q.backUVs);const w=new h.e;return w.indices=i,w.Iq=t,w.Tq=O,w.nq=N,w}function H(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return Q(f).Yq(d,f.updatable),d}h.e.CreateSphere=Q,g.e.CreateSphere=(q,f,j,d,g,h)=>H(q,{segments:f,diameterX:j,diameterY:j,diameterZ:j,sideOrientation:h,updatable:g},d)},13166:(q,f,j)=>{"use strict";j.d(f,{c:()=>Q});var d=j(11669),g=j(12682),h=j(11690),L=j(11257);class Q{static get Configuration(){return{get decoder(){return g.c.DefaultConfiguration},set decoder(q){g.c.DefaultConfiguration=q}}}static set Configuration(q){g.c.DefaultConfiguration=q.decoder}static get DecoderAvailable(){return(0,d.d)(g.c.DefaultConfiguration)}static get Default(){return Q._Default??(Q._Default=new Q),Q._Default}static ResetDefault(q){Q._Default&&(q||Q._Default.dispose(),Q._Default=null)}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.DefaultNumWorkers;const f="number"===typeof q?{...g.c.DefaultConfiguration,numWorkers:q}:{...g.c.DefaultConfiguration,...q};this._decoder=new g.c(f)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(q,f,j){return this._decoder.decodeMeshToMeshDataAsync(q,f,j)}async decodeMeshToGeometryAsync(q,f,j,d){return await this._decoder.decodeMeshToGeometryAsync(q,f,j,d)}async _decodeMeshToGeometryForGltfAsync(q,f,j,d,g,h){return await this._decoder._decodeMeshToGeometryForGltfAsync(q,f,j,d,g,h)}async decodeMeshAsync(q,f){const j=await this._decoder.decodeMeshToMeshDataAsync(q,f),d=new L.e;j.indices&&(d.indices=j.indices);for(const g of j.attributes){const q=h.c.GetFloatData(g.data,g.size,h.c.GetDataType(g.data),g.byteOffset,g.byteStride,g.normalized,j.totalVertices);d.set(q,g.kind)}return d}}Q.DefaultNumWorkers=(0,d.c)(),Q._Default=null},12682:(q,f,j)=>{"use strict";j.d(f,{c:()=>r});var d=j(11669),g=j(10992),h=j(11308),L=j(11690),Q=j(11005),H=j(11684);class r extends d.b{static get DefaultAvailable(){return(0,d.d)(r.DefaultConfiguration)}static get Default(){return r._Default??(r._Default=new r),r._Default}static ResetDefault(q){r._Default&&(q||r._Default.dispose(),r._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(q,f){return{module:await(f||DracoDecoderModule)({wasmBinary:q})}}_getWorkerContent(){return`${H.d}(${H.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.DefaultConfiguration)}decodeMeshToMeshDataAsync(q,f,j){const d=q instanceof ArrayBuffer?new Int8Array(q):new Int8Array(q.buffer,q.byteOffset,q.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async q=>await new Promise(((g,h)=>{q.push(((q,L)=>{let H=null;const r=[],u=f=>{q.removeEventListener("error",u),q.removeEventListener("message",X),h(f),L()},X=f=>{const d=f.data;switch(d.id){case"indices":H=d.data;break;case"attribute":r.push({kind:d.kind,data:d.data,size:d.size,byteOffset:d.byteOffset,byteStride:d.byteStride,normalized:(h=d.kind,z=d.normalized,j&&void 0!==j[h]?(z!==j[h]&&Q.e.Warn(`Normalized flag from Draco data (${z}) does not match normalized flag from glTF accessor (${j[h]}). Using flag from glTF accessor.`),j[h]):z)});break;case"decodeMeshDone":q.removeEventListener("error",u),q.removeEventListener("message",X),g({indices:H,attributes:r,totalVertices:d.totalVertices}),L()}var h,z};q.addEventListener("error",u),q.addEventListener("message",X);const z=d.slice();q.postMessage({id:"decodeMesh",dataView:z,attributes:f},[z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((q=>{let j=null;const g=[],h=(0,H.d)(q.module,d,f,(q=>{j=q}),((q,f,j,d,h,L)=>{g.push({kind:q,data:f,size:j,byteOffset:d,byteStride:h,normalized:L})}));return{indices:j,attributes:g,totalVertices:h}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(q,f,j,d){const g=await this.decodeMeshToMeshDataAsync(j,d),Q=new h.e(q,f);g.indices&&Q.setIndices(g.indices);for(const h of g.attributes)Q.setVerticesBuffer(new L.c(f.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),g.totalVertices);return Q}async _decodeMeshToGeometryForGltfAsync(q,f,j,d,g,Q){const H=await this.decodeMeshToMeshDataAsync(j,d,g),r=new h.e(q,f);Q&&(r._boundingInfo=Q,r.useBoundingInfoFromGeometry=!0),H.indices&&r.setIndices(H.indices);for(const h of H.attributes)r.setVerticesBuffer(new L.c(f.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),H.totalVertices);return r}}r.DefaultConfiguration={wasmUrl:`${g.h._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${g.h._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${g.h._DefaultCdnUrl}/draco_decoder_gltf.js`},r._Default=null},12866:(q,f,j)=>{"use strict";j.d(f,{b:()=>Qq});var d=j(10941),g=j(11289),h=j(11151),L=j(11257),Q=j(11316);function H(q){let f=q.pathArray;const j=q.closeArray||!1,d=q.closePath||!1,g=q.invertUV||!1,H=Math.floor(f[0].length/2);let r=q.offset||H;r=r>H?H:Math.floor(r);const u=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,X=q.nq,z=q.Wq,B=[],D=[],i=[],t=[],O=[],N=[],w=[],E=[];let s;const S=[],e=[];let Z,I,T;if(f.length<2){const q=[],j=[];for(I=0;I<f[0].length-r;I++)q.push(f[0][I]),j.push(f[0][I+r]);f=[q,j]}let W=0;const n=d?1:0,U=j?1:0;let Y,v,F,M,o,b;for(s=f[0].length,Z=0;Z<f.length+U;Z++){for(w[Z]=0,O[Z]=[0],Y=Z===f.length?f[0]:f[Z],v=Y.length,s=s<v?s:v,T=0;T<v;)B.push(Y[T].x,Y[T].y,Y[T].z),T>0&&(F=Y[T].ej(Y[T-1]).length(),M=F+w[Z],O[Z].push(M),w[Z]=M),T++;d&&(T--,B.push(Y[0].x,Y[0].y,Y[0].z),F=Y[T].ej(Y[0]).length(),M=F+w[Z],O[Z].push(M),w[Z]=M),S[Z]=v+n,e[Z]=W,W+=v+n}let x,R,A=null,k=null;for(I=0;I<s+n;I++)for(E[I]=0,N[I]=[0],Z=0;Z<f.length-1+U;Z++)o=f[Z],b=Z===f.length-1?f[0]:f[Z+1],I===s?(A=o[0],k=b[0]):(A=o[I],k=b[I]),F=k.ej(A).length(),M=F+E[I],N[I].push(M),E[I]=M;if(X)for(Z=0;Z<X.length;Z++)t.push(X[Z].x,Q.b?1-X[Z].y:X[Z].y);else for(Z=0;Z<f.length+U;Z++)for(I=0;I<s+n;I++)x=0!=w[Z]?O[Z][I]/w[Z]:0,R=0!=E[I]?N[I][Z]/E[I]:0,g?t.push(R,x):t.push(x,Q.b?1-R:R);Z=0;let y=0,p=S[Z]-1,l=S[Z+1]-1,V=p<l?p:l,a=e[1]-e[0];const P=S.length-1;for(;y<=V&&Z<P;)D.push(y,y+a,y+1),D.push(y+a+1,y+1,y+a),y+=1,y===V&&(Z++,a=e[Z+1]-e[Z],p=S[Z]-1,l=S[Z+1]-1,y=e[Z],V=p<l?p+y:l+y);if(L.e.ComputeNormals(B,D,i),d){let q=0,j=0;for(Z=0;Z<f.length;Z++){q=3*e[Z],j=Z+1<f.length?3*(e[Z+1]-1):i.length-3,i[q]=.5*(i[q]+i[j]),i[q+1]=.5*(i[q+1]+i[j+1]),i[q+2]=.5*(i[q+2]+i[j+2]);const d=Math.sqrt(i[q]*i[q]+i[q+1]*i[q+1]+i[q+2]*i[q+2]);i[q]/=d,i[q+1]/=d,i[q+2]/=d,i[j]=i[q],i[j+1]=i[q+1],i[j+2]=i[q+2]}}if(j){let q=3*e[0],j=3*e[f.length];for(I=0;I<s+n;I++){i[q]=.5*(i[q]+i[j]),i[q+1]=.5*(i[q+1]+i[j+1]),i[q+2]=.5*(i[q+2]+i[j+2]);const f=Math.sqrt(i[q]*i[q]+i[q+1]*i[q+1]+i[q+2]*i[q+2]);i[q]/=f,i[q+1]/=f,i[q+2]/=f,i[j]=i[q],i[j+1]=i[q+1],i[j+2]=i[q+2],q+=3,j+=3}}L.e._ComputeSides(u,B,D,i,t,q.frontUVs,q.backUVs);let C=null;if(z){C=new Float32Array(4*z.length);for(let q=0;q<z.length;q++)C[4*q]=z[q].r,C[4*q+1]=z[q].g,C[4*q+2]=z[q].b,C[4*q+3]=z[q].a}const c=new L.e,G=new Float32Array(B),m=new Float32Array(i),K=new Float32Array(t);return c.indices=D,c.Iq=G,c.Tq=m,c.nq=K,C&&c.set(C,h.i.ColorKind),d&&(c._idx=e),c}function r(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=f.pathArray,u=f.closeArray,X=f.closePath,z=g.e._GetDefaultSideOrientation(f.sideOrientation),B=f.instance,D=f.updatable;if(B){const q=d.f.kf[0].cf(Number.MAX_VALUE),j=d.f.kf[1].cf(-Number.MAX_VALUE),H=f=>{let d=r[0].length;const h=B;let L=0;const Q=h._originalBuilderSideOrientation===g.e.DOUBLESIDE?2:1;for(let g=1;g<=Q;++g)for(let Q=0;Q<r.length;++Q){const g=r[Q],H=g.length;d=d<H?d:H;for(let h=0;h<d;++h){const d=g[h];f[L]=d.x,f[L+1]=d.y,f[L+2]=d.z,q.minimizeInPlaceFromFloats(d.x,d.y,d.z),j.maximizeInPlaceFromFloats(d.x,d.y,d.z),L+=3}if(h._creationDataStorage&&h._creationDataStorage.closePath){const q=g[0];f[L]=q.x,f[L+1]=q.y,f[L+2]=q.z,L+=3}}},u=B.getVerticesData(h.i.PositionKind);if(H(u),B.hasBoundingInfo?B.getBoundingInfo().reConstruct(q,j,B._worldMatrix):B.buildBoundingInfo(q,j,B._worldMatrix),B.updateVerticesData(h.i.PositionKind,u,!1,!1),f.Wq){const q=B.getVerticesData(h.i.ColorKind);for(let j=0,d=0;j<f.Wq.length;j++,d+=4){const g=f.Wq[j];q[d]=g.r,q[d+1]=g.g,q[d+2]=g.b,q[d+3]=g.a}B.updateVerticesData(h.i.ColorKind,q,!1,!1)}if(f.nq){const q=B.getVerticesData(h.i.UVKind);for(let j=0;j<f.nq.length;j++)q[2*j]=f.nq[j].x,q[2*j+1]=Q.b?1-f.nq[j].y:f.nq[j].y;B.updateVerticesData(h.i.UVKind,q,!1,!1)}if(!B.areNormalsFrozen||B.isFacetDataEnabled){const q=B.sf(),f=B.getVerticesData(h.i.NormalKind),j=B.isFacetDataEnabled?B.getFacetDataParameters():null;if(L.e.ComputeNormals(u,q,f,j),B._creationDataStorage&&B._creationDataStorage.closePath){let q=0,j=0;for(let d=0;d<r.length;d++)q=3*B._creationDataStorage.idx[d],j=d+1<r.length?3*(B._creationDataStorage.idx[d+1]-1):f.length-3,f[q]=.5*(f[q]+f[j]),f[q+1]=.5*(f[q+1]+f[j+1]),f[q+2]=.5*(f[q+2]+f[j+2]),f[j]=f[q],f[j+1]=f[q+1],f[j+2]=f[q+2]}B.areNormalsFrozen||B.updateVerticesData(h.i.NormalKind,f,!1,!1)}return B}{const d=new g.e(q,j);d._originalBuilderSideOrientation=z,d._creationDataStorage=new g.f;const h=H(f);return X&&(d._creationDataStorage.idx=h._idx),d._creationDataStorage.closePath=X,d._creationDataStorage.closeArray=u,h.Yq(d,D),d}}L.e.CreateRibbon=H,g.e.CreateRibbon=function(q,f){return r(q,{pathArray:f,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var u=j(12394),X=j(12265),z=j(11210);function B(q){const f=q.pattern||g.e.NO_FLIP,j=q.tileWidth||q.tileSize||1,d=q.tileHeight||q.tileSize||1,h=q.alignHorizontal||0,Q=q.alignVertical||0,H=q.width||q.size||1,r=Math.floor(H/j);let u=H-r*j;const X=q.height||q.size||1,z=Math.floor(X/d);let B=X-z*d;const D=j*r/2,i=d*z/2;let t=0,O=0,N=0,w=0,E=0,s=0;if(u>0||B>0){switch(N=-D,w=-i,E=D,s=i,h){case g.e.CENTER:u/=2,N-=u,E+=u;break;case g.e.LEFT:E+=u,t=-u/2;break;case g.e.RIGHT:N-=u,t=u/2}switch(Q){case g.e.CENTER:B/=2,w-=B,s+=B;break;case g.e.BOTTOM:s+=B,O=-B/2;break;case g.e.TOP:w-=B,O=B/2}}const S=[],e=[],Z=[];Z[0]=[0,0,1,0,1,1,0,1],Z[1]=[0,0,1,0,1,1,0,1],f!==g.e.ROTATE_TILE&&f!==g.e.ROTATE_ROW||(Z[1]=[1,1,0,1,0,0,1,0]),f!==g.e.FLIP_TILE&&f!==g.e.FLIP_ROW||(Z[1]=[1,0,0,0,0,1,1,1]),f!==g.e.FLIP_N_ROTATE_TILE&&f!==g.e.FLIP_N_ROTATE_ROW||(Z[1]=[0,1,1,1,1,0,0,0]);let I=[];const T=[],W=[];let n=0;for(let L=0;L<z;L++)for(let q=0;q<r;q++)S.push(q*j-D+t,L*d-i+O,0),S.push((q+1)*j-D+t,L*d-i+O,0),S.push((q+1)*j-D+t,(L+1)*d-i+O,0),S.push(q*j-D+t,(L+1)*d-i+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),I=f===g.e.FLIP_TILE||f===g.e.ROTATE_TILE||f===g.e.FLIP_N_ROTATE_TILE?I.concat(Z[(q%2+L%2)%2]):f===g.e.FLIP_ROW||f===g.e.ROTATE_ROW||f===g.e.FLIP_N_ROTATE_ROW?I.concat(Z[L%2]):I.concat(Z[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),n+=4;if(u>0||B>0){const q=B>0&&(Q===g.e.CENTER||Q===g.e.TOP),L=B>0&&(Q===g.e.CENTER||Q===g.e.BOTTOM),H=u>0&&(h===g.e.CENTER||h===g.e.RIGHT),X=u>0&&(h===g.e.CENTER||h===g.e.LEFT);let Z,U,Y,v,F=[];if(q&&H&&(S.push(N+t,w+O,0),S.push(-D+t,w+O,0),S.push(-D+t,w+B+O,0),S.push(N+t,w+B+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,Z=1-u/j,U=1-B/d,Y=1,v=1,F=[Z,U,Y,U,Y,v,Z,v],f===g.e.ROTATE_ROW&&(F=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),f===g.e.FLIP_ROW&&(F=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),f===g.e.FLIP_N_ROTATE_ROW&&(F=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]),I=I.concat(F),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&X&&(S.push(D+t,w+O,0),S.push(E+t,w+O,0),S.push(E+t,w+B+O,0),S.push(D+t,w+B+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,Z=0,U=1-B/d,Y=u/j,v=1,F=[Z,U,Y,U,Y,v,Z,v],(f===g.e.ROTATE_ROW||f===g.e.ROTATE_TILE&&r%2===0)&&(F=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),(f===g.e.FLIP_ROW||f===g.e.FLIP_TILE&&r%2===0)&&(F=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),(f===g.e.FLIP_N_ROTATE_ROW||f===g.e.FLIP_N_ROTATE_TILE&&r%2===0)&&(F=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]),I=I.concat(F),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&H&&(S.push(N+t,i+O,0),S.push(-D+t,i+O,0),S.push(-D+t,s+O,0),S.push(N+t,s+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,Z=1-u/j,U=0,Y=1,v=B/d,F=[Z,U,Y,U,Y,v,Z,v],(f===g.e.ROTATE_ROW&&z%2===1||f===g.e.ROTATE_TILE&&z%1===0)&&(F=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),(f===g.e.FLIP_ROW&&z%2===1||f===g.e.FLIP_TILE&&z%2===0)&&(F=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),(f===g.e.FLIP_N_ROTATE_ROW&&z%2===1||f===g.e.FLIP_N_ROTATE_TILE&&z%2===0)&&(F=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]),I=I.concat(F),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&X&&(S.push(D+t,i+O,0),S.push(E+t,i+O,0),S.push(E+t,s+O,0),S.push(D+t,s+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,Z=0,U=0,Y=u/j,v=B/d,F=[Z,U,Y,U,Y,v,Z,v],(f===g.e.ROTATE_ROW&&z%2===1||f===g.e.ROTATE_TILE&&(z+r)%2===1)&&(F=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),(f===g.e.FLIP_ROW&&z%2===1||f===g.e.FLIP_TILE&&(z+r)%2===1)&&(F=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),(f===g.e.FLIP_N_ROTATE_ROW&&z%2===1||f===g.e.FLIP_N_ROTATE_TILE&&(z+r)%2===1)&&(F=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]),I=I.concat(F),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q){const q=[];Z=0,U=1-B/d,Y=1,v=1,q[0]=[Z,U,Y,U,Y,v,Z,v],q[1]=[Z,U,Y,U,Y,v,Z,v],f!==g.e.ROTATE_TILE&&f!==g.e.ROTATE_ROW||(q[1]=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),f!==g.e.FLIP_TILE&&f!==g.e.FLIP_ROW||(q[1]=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),f!==g.e.FLIP_N_ROTATE_TILE&&f!==g.e.FLIP_N_ROTATE_ROW||(q[1]=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]);for(let d=0;d<r;d++)S.push(d*j-D+t,w+O,0),S.push((d+1)*j-D+t,w+O,0),S.push((d+1)*j-D+t,w+B+O,0),S.push(d*j-D+t,w+B+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,I=f===g.e.FLIP_TILE||f===g.e.ROTATE_TILE||f===g.e.FLIP_N_ROTATE_TILE?I.concat(q[(d+1)%2]):f===g.e.FLIP_ROW||f===g.e.ROTATE_ROW||f===g.e.FLIP_N_ROTATE_ROW?I.concat(q[1]):I.concat(q[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const q=[];Z=0,U=0,Y=1,v=B/d,q[0]=[Z,U,Y,U,Y,v,Z,v],q[1]=[Z,U,Y,U,Y,v,Z,v],f!==g.e.ROTATE_TILE&&f!==g.e.ROTATE_ROW||(q[1]=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),f!==g.e.FLIP_TILE&&f!==g.e.FLIP_ROW||(q[1]=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),f!==g.e.FLIP_N_ROTATE_TILE&&f!==g.e.FLIP_N_ROTATE_ROW||(q[1]=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]);for(let d=0;d<r;d++)S.push(d*j-D+t,s-B+O,0),S.push((d+1)*j-D+t,s-B+O,0),S.push((d+1)*j-D+t,s+O,0),S.push(d*j-D+t,s+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,I=f===g.e.FLIP_TILE||f===g.e.ROTATE_TILE||f===g.e.FLIP_N_ROTATE_TILE?I.concat(q[(d+z)%2]):f===g.e.FLIP_ROW||f===g.e.ROTATE_ROW||f===g.e.FLIP_N_ROTATE_ROW?I.concat(q[z%2]):I.concat(q[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const q=[];Z=1-u/j,U=0,Y=1,v=1,q[0]=[Z,U,Y,U,Y,v,Z,v],q[1]=[Z,U,Y,U,Y,v,Z,v],f!==g.e.ROTATE_TILE&&f!==g.e.ROTATE_ROW||(q[1]=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),f!==g.e.FLIP_TILE&&f!==g.e.FLIP_ROW||(q[1]=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),f!==g.e.FLIP_N_ROTATE_TILE&&f!==g.e.FLIP_N_ROTATE_ROW||(q[1]=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]);for(let j=0;j<z;j++)S.push(N+t,j*d-i+O,0),S.push(N+u+t,j*d-i+O,0),S.push(N+u+t,(j+1)*d-i+O,0),S.push(N+t,(j+1)*d-i+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,I=f===g.e.FLIP_TILE||f===g.e.ROTATE_TILE||f===g.e.FLIP_N_ROTATE_TILE?I.concat(q[(j+1)%2]):f===g.e.FLIP_ROW||f===g.e.ROTATE_ROW||f===g.e.FLIP_N_ROTATE_ROW?I.concat(q[j%2]):I.concat(q[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const q=[];Z=0,U=0,Y=u/d,v=1,q[0]=[Z,U,Y,U,Y,v,Z,v],q[1]=[Z,U,Y,U,Y,v,Z,v],f!==g.e.ROTATE_TILE&&f!==g.e.ROTATE_ROW||(q[1]=[1-Z,1-U,1-Y,1-U,1-Y,1-v,1-Z,1-v]),f!==g.e.FLIP_TILE&&f!==g.e.FLIP_ROW||(q[1]=[1-Z,U,1-Y,U,1-Y,v,1-Z,v]),f!==g.e.FLIP_N_ROTATE_TILE&&f!==g.e.FLIP_N_ROTATE_ROW||(q[1]=[Z,1-U,Y,1-U,Y,1-v,Z,1-v]);for(let j=0;j<z;j++)S.push(E-u+t,j*d-i+O,0),S.push(E+t,j*d-i+O,0),S.push(E+t,(j+1)*d-i+O,0),S.push(E-u+t,(j+1)*d-i+O,0),W.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,I=f===g.e.FLIP_TILE||f===g.e.ROTATE_TILE||f===g.e.FLIP_N_ROTATE_TILE?I.concat(q[(j+r)%2]):f===g.e.FLIP_ROW||f===g.e.ROTATE_ROW||f===g.e.FLIP_N_ROTATE_ROW?I.concat(q[j%2]):I.concat(q[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const U=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE;L.e._ComputeSides(U,S,W,e,I,q.frontUVs,q.backUVs);const Y=new L.e;Y.indices=W,Y.Iq=S,Y.Tq=e,Y.nq=I;const v=U===L.e.DOUBLESIDE?T.concat(T):T;return Y.Wq=v,Y}function D(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return B(f).Yq(d,f.updatable),d}function i(q){const f=q.faceUV||new Array(6),j=q.faceColors,h=q.pattern||g.e.NO_FLIP,H=q.width||q.size||1,r=q.height||q.size||1,u=q.depth||q.size||1,X=q.tileWidth||q.tileSize||1,D=q.tileHeight||q.tileSize||1,i=q.alignHorizontal||0,t=q.alignVertical||0,O=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE;for(let g=0;g<6;g++)void 0===f[g]&&(f[g]=new d.m(0,0,1,1)),j&&void 0===j[g]&&(j[g]=new z.e(1,1,1,1));const N=H/2,w=r/2,E=u/2,s=[];for(let d=0;d<2;d++)s[d]=B({pattern:h,tileWidth:X,tileHeight:D,width:H,height:r,alignVertical:t,alignHorizontal:i,sideOrientation:O});for(let d=2;d<4;d++)s[d]=B({pattern:h,tileWidth:X,tileHeight:D,width:u,height:r,alignVertical:t,alignHorizontal:i,sideOrientation:O});let S=t;t===g.e.BOTTOM?S=g.e.TOP:t===g.e.TOP&&(S=g.e.BOTTOM);for(let d=4;d<6;d++)s[d]=B({pattern:h,tileWidth:X,tileHeight:D,width:H,height:u,alignVertical:S,alignHorizontal:i,sideOrientation:O});let e=[],Z=[],I=[],T=[];const W=[],n=[],U=[],Y=[];let v=0,F=0;for(let g=0;g<6;g++){const q=s[g].Iq.length;n[g]=[],U[g]=[];for(let f=0;f<q/3;f++)n[g].push(new d.j(s[g].Iq[3*f],s[g].Iq[3*f+1],s[g].Iq[3*f+2])),U[g].push(new d.j(s[g].Tq[3*f],s[g].Tq[3*f+1],s[g].Tq[3*f+2]));v=s[g].nq.length,Y[g]=[];for(let j=0;j<v;j+=2)Y[g][j]=f[g].x+(f[g].z-f[g].x)*s[g].nq[j],Y[g][j+1]=f[g].y+(f[g].w-f[g].y)*s[g].nq[j+1],Q.b&&(Y[g][j+1]=1-Y[g][j+1]);if(I=I.concat(Y[g]),T=T.concat(s[g].indices.map((q=>q+F))),F+=n[g].length,j)for(let f=0;f<4;f++)W.push(j[g].r,j[g].g,j[g].b,j[g].a)}const M=new d.j(0,0,E),o=d.b.RotationY(Math.PI);e=n[0].map((q=>d.j.TransformNormal(q,o).add(M))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[]),Z=U[0].map((q=>d.j.TransformNormal(q,o))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[]),e=e.concat(n[1].map((q=>q.ej(M))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[])),Z=Z.concat(U[1].map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[]));const b=new d.j(N,0,0),x=d.b.RotationY(-Math.PI/2);e=e.concat(n[2].map((q=>d.j.TransformNormal(q,x).add(b))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[])),Z=Z.concat(U[2].map((q=>d.j.TransformNormal(q,x))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[]));const R=d.b.RotationY(Math.PI/2);e=e.concat(n[3].map((q=>d.j.TransformNormal(q,R).ej(b))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[])),Z=Z.concat(U[3].map((q=>d.j.TransformNormal(q,R))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[]));const A=new d.j(0,w,0),k=d.b.RotationX(Math.PI/2);e=e.concat(n[4].map((q=>d.j.TransformNormal(q,k).add(A))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[])),Z=Z.concat(U[4].map((q=>d.j.TransformNormal(q,k))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[]));const y=d.b.RotationX(-Math.PI/2);e=e.concat(n[5].map((q=>d.j.TransformNormal(q,y).ej(A))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[])),Z=Z.concat(U[5].map((q=>d.j.TransformNormal(q,y))).map((q=>[q.x,q.y,q.z])).reduce(((q,f)=>q.concat(f)),[])),L.e._ComputeSides(O,e,T,Z,I);const p=new L.e;if(p.indices=T,p.Iq=e,p.Tq=Z,p.nq=I,j){const q=O===L.e.DOUBLESIDE?W.concat(W):W;p.Wq=q}return p}function t(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return i(f).Yq(d,f.updatable),d}L.e.CreateTiledPlane=B;L.e.CreateTiledBox=i;var O=j(12385),N=j(11506),w=j(11276);function E(q){const f=q.height||2;let j=0===q.diameterTop?0:q.diameterTop||q.diameter||1,h=0===q.diameterBottom?0:q.diameterBottom||q.diameter||1;j=j||1e-5,h=h||1e-5;const H=0|(q.tessellation||24),r=0|(q.subdivisions||1),u=!!q.hasRings,X=!!q.enclose,B=0===q.cap?0:q.cap||g.e.CAP_ALL,D=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,i=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,t=q.faceUV||new Array(3),O=q.faceColors,N=2+(1+(1!==D&&X?2:0))*(u?r:1);let E;for(E=0;E<N;E++)O&&void 0===O[E]&&(O[E]=new z.e(1,1,1,1));for(E=0;E<N;E++)t&&void 0===t[E]&&(t[E]=new d.m(0,0,1,1));const s=[],S=[],e=[],Z=[],I=[],T=2*Math.PI*D/H;let W,n,U;const Y=(h-j)/2/f,v=d.j.Zero(),F=d.j.Zero(),M=d.j.Zero(),o=d.j.Zero(),b=d.j.Zero(),x=w.e.Y;let R,A,k,y=1,p=1,l=0,V=0;for(R=0;R<=r;R++)for(n=R/r,U=(n*(j-h)+h)/2,y=u&&0!==R&&R!==r?2:1,k=0;k<y;k++){for(u&&(p+=k),X&&(p+=2*k),A=0;A<=H;A++)W=A*T,v.x=Math.cos(-W)*U,v.y=-f/2+n*f,v.z=Math.sin(-W)*U,0===j&&R===r?(F.x=e[e.length-3*(H+1)],F.y=e[e.length-3*(H+1)+1],F.z=e[e.length-3*(H+1)+2]):(F.x=v.x,F.z=v.z,F.y=Math.sqrt(F.x*F.x+F.z*F.z)*Y,F.normalize()),0===A&&(M.H(v),o.H(F)),S.push(v.x,v.y,v.z),e.push(F.x,F.y,F.z),V=u?l!==p?t[p].y:t[p].w:t[p].y+(t[p].w-t[p].y)*n,Z.push(t[p].x+(t[p].z-t[p].x)*A/H,Q.b?1-V:V),O&&I.push(O[p].r,O[p].g,O[p].b,O[p].a);1!==D&&X&&(S.push(v.x,v.y,v.z),S.push(0,v.y,0),S.push(0,v.y,0),S.push(M.x,M.y,M.z),d.j.CrossToRef(x,F,b),b.normalize(),e.push(b.x,b.y,b.z,b.x,b.y,b.z),d.j.CrossToRef(o,x,b),b.normalize(),e.push(b.x,b.y,b.z,b.x,b.y,b.z),V=u?l!==p?t[p+1].y:t[p+1].w:t[p+1].y+(t[p+1].w-t[p+1].y)*n,Z.push(t[p+1].x,Q.b?1-V:V),Z.push(t[p+1].z,Q.b?1-V:V),V=u?l!==p?t[p+2].y:t[p+2].w:t[p+2].y+(t[p+2].w-t[p+2].y)*n,Z.push(t[p+2].x,Q.b?1-V:V),Z.push(t[p+2].z,Q.b?1-V:V),O&&(I.push(O[p+1].r,O[p+1].g,O[p+1].b,O[p+1].a),I.push(O[p+1].r,O[p+1].g,O[p+1].b,O[p+1].a),I.push(O[p+2].r,O[p+2].g,O[p+2].b,O[p+2].a),I.push(O[p+2].r,O[p+2].g,O[p+2].b,O[p+2].a))),l!==p&&(l=p)}const a=1!==D&&X?H+4:H;for(R=0,p=0;p<r;p++){let q=0,f=0,j=0,d=0;for(A=0;A<H;A++)q=R*(a+1)+A,f=(R+1)*(a+1)+A,j=R*(a+1)+(A+1),d=(R+1)*(a+1)+(A+1),s.push(q,f,j),s.push(d,j,f);1!==D&&X&&(s.push(q+2,f+2,j+2),s.push(d+2,j+2,f+2),s.push(q+4,f+4,j+4),s.push(d+4,j+4,f+4)),R=u?R+2:R+1}const P=q=>{const g=q?j/2:h/2;if(0===g)return;let L,r,u;const X=q?t[N-1]:t[0];let z=null;O&&(z=q?O[N-1]:O[0]);const B=S.length/3,i=q?f/2:-f/2,w=new d.j(0,i,0);S.push(w.x,w.y,w.z),e.push(0,q?1:-1,0);const E=X.y+.5*(X.w-X.y);Z.push(X.x+.5*(X.z-X.x),Q.b?1-E:E),z&&I.push(z.r,z.g,z.b,z.a);const T=new d.i(.5,.5);for(u=0;u<=H;u++){L=2*Math.PI*u*D/H;const f=Math.cos(-L),j=Math.sin(-L);r=new d.j(f*g,i,j*g);const h=new d.i(f*T.x+.5,j*T.y+.5);S.push(r.x,r.y,r.z),e.push(0,q?1:-1,0);const B=X.y+(X.w-X.y)*h.y;Z.push(X.x+(X.z-X.x)*h.x,Q.b?1-B:B),z&&I.push(z.r,z.g,z.b,z.a)}for(u=0;u<H;u++)q?(s.push(B),s.push(B+(u+2)),s.push(B+(u+1))):(s.push(B),s.push(B+(u+1)),s.push(B+(u+2)))};B!==g.e.CAP_START&&B!==g.e.CAP_ALL||P(!1),B!==g.e.CAP_END&&B!==g.e.CAP_ALL||P(!0),L.e._ComputeSides(i,S,s,e,Z,q.frontUVs,q.backUVs);const C=new L.e;return C.indices=s,C.Iq=S,C.Tq=e,C.nq=Z,O&&(C.Wq=I),C}function s(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return E(f).Yq(d,f.updatable),d}function S(q){const f=[],j=[],g=[],h=[],H=q.diameter||1,r=q.thickness||.5,u=0|(q.tessellation||16),X=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,z=u+1;for(let L=0;L<=u;L++){const q=L/u,X=L*Math.PI*2/u-Math.PI/2,B=d.b.Translation(H/2,0,0).multiply(d.b.RotationY(X));for(let H=0;H<=u;H++){const X=1-H/u,D=H*Math.PI*2/u+Math.PI,i=Math.cos(D),t=Math.sin(D);let O=new d.j(i,t,0),N=O.scale(r/2);const w=new d.i(q,X);N=d.j.TransformCoordinates(N,B),O=d.j.TransformNormal(O,B),j.push(N.x,N.y,N.z),g.push(O.x,O.y,O.z),h.push(w.x,Q.b?1-w.y:w.y);const E=(L+1)%z,s=(H+1)%z;f.push(L*z+H),f.push(L*z+s),f.push(E*z+H),f.push(L*z+s),f.push(E*z+s),f.push(E*z+H)}}L.e._ComputeSides(X,j,f,g,h,q.frontUVs,q.backUVs);const B=new L.e;return B.indices=f,B.Iq=j,B.Tq=g,B.nq=h,B}function e(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return S(f).Yq(d,f.updatable),d}L.e.CreateCylinder=E,g.e.CreateCylinder=(q,f,j,d,h,L,Q,H,r)=>{void 0!==Q&&Q instanceof N.b||(void 0!==Q&&(r=H||g.e.DEFAULTSIDE,H=Q),Q=L,L=1);return s(q,{height:f,diameterTop:j,diameterBottom:d,tessellation:h,subdivisions:L,sideOrientation:r,updatable:H},Q)};function Z(q){const f=[],j=[],g=[],h=[],H=q.radius||2,r=q.tube||.5,u=q.radialSegments||32,X=q.tubularSegments||32,z=q.p||2,B=q.q||3,D=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,i=q=>{const f=Math.cos(q),j=Math.sin(q),g=B/z*q,h=Math.cos(g),L=H*(2+h)*.5*f,Q=H*(2+h)*j*.5,r=H*Math.sin(g)*.5;return new d.j(L,Q,r)};let t,O;for(t=0;t<=u;t++){const q=t%u/u*2*z*Math.PI,f=i(q),g=i(q+.01),L=g.ej(f);let H=g.add(f);const B=d.j.Cross(L,H);for(H=d.j.Cross(B,L),B.normalize(),H.normalize(),O=0;O<X;O++){const q=O%X/X*2*Math.PI,d=-r*Math.cos(q),g=r*Math.sin(q);j.push(f.x+d*H.x+g*B.x),j.push(f.y+d*H.y+g*B.y),j.push(f.z+d*H.z+g*B.z),h.push(t/u),h.push(Q.b?1-O/X:O/X)}}for(t=0;t<u;t++)for(O=0;O<X;O++){const q=(O+1)%X,j=t*X+O,d=(t+1)*X+O,g=(t+1)*X+q,h=t*X+q;f.push(h),f.push(d),f.push(j),f.push(h),f.push(g),f.push(d)}L.e.ComputeNormals(j,f,g),L.e._ComputeSides(D,j,f,g,h,q.frontUVs,q.backUVs);const N=new L.e;return N.indices=f,N.Iq=j,N.Tq=g,N.nq=h,N}function I(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return Z(f).Yq(d,f.updatable),d}L.e.CreateTorus=S,g.e.CreateTorus=(q,f,j,d,g,h,L)=>e(q,{diameter:f,thickness:j,tessellation:d,sideOrientation:L,updatable:h},g);L.e.CreateTorusKnot=Z,g.e.CreateTorusKnot=(q,f,j,d,g,h,L,Q,H,r)=>I(q,{radius:f,tube:j,radialSegments:d,tubularSegments:g,p:h,q:L,sideOrientation:r,updatable:H},Q);var T=j(12874),W=j(11657),n=j(11402);function U(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=f.path,h=f.shape,L=f.scale||1,Q=f.rotation||0,H=0===f.cap?0:f.cap||g.e.NO_CAP,r=f.updatable,u=g.e._GetDefaultSideOrientation(f.sideOrientation),X=f.instance||null,z=f.invertUV||!1,B=f.closeShape||!1,D=f.closePath||!1,i=f.capFunction||null;return v(q,h,d,L,Q,null,null,D,B,H,!1,j,!!r,u,X,z,f.frontUVs||null,f.backUVs||null,f.firstNormal||null,!!f.adjustFrame,i)}function Y(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=f.path,h=f.shape,L=f.scaleFunction||(()=>1),Q=f.rotationFunction||(()=>0),H=f.closePath||f.ribbonCloseArray||!1,r=f.closeShape||f.ribbonClosePath||!1,u=0===f.cap?0:f.cap||g.e.NO_CAP,X=f.updatable,z=f.firstNormal||null,B=f.adjustFrame||!1,D=g.e._GetDefaultSideOrientation(f.sideOrientation),i=f.instance,t=f.invertUV||!1,O=f.capFunction||null;return v(q,h,d,null,null,L,Q,H,r,u,!0,j,!!X,D,i||null,t,f.frontUVs||null,f.backUVs||null,z,B,O||null)}function v(q,f,j,h,L,Q,H,u,X,z,B,D,i,t,O,N,w,E,s,S,e){const Z=(q,f,j,h,L,Q,H,r,u,X,z)=>{const B=j.getTangents(),D=j.getNormals(),i=j.getBinormals(),t=j.getDistances();if(z)for(let g=0;g<B.length;g++)if(0==B[g].x&&0==B[g].y&&0==B[g].z&&B[g].H(B[g-1]),0==D[g].x&&0==D[g].y&&0==D[g].z&&D[g].H(D[g-1]),0==i[g].x&&0==i[g].y&&0==i[g].z&&i[g].H(i[g-1]),g>0){let q=B[g-1];d.j.Dot(q,B[g])<0&&B[g].scaleInPlace(-1),q=D[g-1],d.j.Dot(q,D[g])<0&&D[g].scaleInPlace(-1),q=i[g-1],d.j.Dot(q,i[g])<0&&i[g].scaleInPlace(-1)}let O=0;const N=X&&r?r:()=>null!==Q?Q:0,w=X&&H?H:()=>null!==L?L:1;let E=u===g.e.NO_CAP||u===g.e.CAP_END?0:2;const s=d.f.Matrix[0];for(let g=0;g<f.length;g++){const j=[],L=N(g,t[g]),Q=w(g,t[g]);d.b.RotationAxisToRef(B[g],O,s);for(let h=0;h<q.length;h++){const L=B[g].scale(q[h].z).add(D[g].scale(q[h].x)).add(i[g].scale(q[h].y)),H=d.j.Zero();d.j.TransformCoordinatesToRef(L,s,H),H.scaleInPlace(Q).addInPlace(f[g]),j[h]=H}h[E]=j,O+=L,E++}const S=e||(q=>{const f=Array(),j=d.j.Zero();let g;for(g=0;g<q.length;g++)j.addInPlace(q[g]);for(j.scaleInPlace(1/q.length),g=0;g<q.length;g++)f.push(j);return f});switch(u){case g.e.NO_CAP:break;case g.e.CAP_START:h[0]=S(h[2]),h[1]=h[2];break;case g.e.CAP_END:h[E]=h[E-1],h[E+1]=S(h[E-1]);break;case g.e.CAP_ALL:h[0]=S(h[2]),h[1]=h[2],h[E]=h[E-1],h[E+1]=S(h[E-1])}return h};let I,T;if(O){const q=O._creationDataStorage;return I=s?q.path3D.update(j,s):q.path3D.update(j),T=Z(f,j,q.path3D,q.pathArray,h,L,Q,H,q.cap,B,S),O=r("",{pathArray:T,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:O},D||void 0)}I=s?new n.m(j,s):new n.m(j);T=Z(f,j,I,new Array,h,L,Q,H,z=z<0||z>3?0:z,B,S);const W=r(q,{pathArray:T,closeArray:u,closePath:X,updatable:i,sideOrientation:t,invertUV:N,frontUVs:w||void 0,backUVs:E||void 0},D);return W._creationDataStorage.pathArray=T,W._creationDataStorage.path3D=I,W._creationDataStorage.cap=z,W}function F(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=f.arc?f.arc<=0||f.arc>1?1:f.arc:1,L=void 0===f.closed||f.closed,Q=f.shape,H=f.radius||1,u=f.tessellation||64,X=f.clip||0,z=f.updatable,B=g.e._GetDefaultSideOrientation(f.sideOrientation),D=f.cap||g.e.NO_CAP,i=2*Math.PI,t=[],O=f.invertUV||!1;let N=0,w=0;const E=i/u*h;let s,S;for(N=0;N<=u-X;N++){for(S=[],D!=g.e.CAP_START&&D!=g.e.CAP_ALL||(S.push(new d.j(0,Q[0].y,0)),S.push(new d.j(Math.cos(N*E)*Q[0].x*H,Q[0].y,Math.sin(N*E)*Q[0].x*H))),w=0;w<Q.length;w++)s=new d.j(Math.cos(N*E)*Q[w].x*H,Q[w].y,Math.sin(N*E)*Q[w].x*H),S.push(s);D!=g.e.CAP_END&&D!=g.e.CAP_ALL||(S.push(new d.j(Math.cos(N*E)*Q[Q.length-1].x*H,Q[Q.length-1].y,Math.sin(N*E)*Q[Q.length-1].x*H)),S.push(new d.j(0,Q[Q.length-1].y,0))),t.push(S)}return r(q,{pathArray:t,closeArray:L,sideOrientation:B,updatable:z,invertUV:O,frontUVs:f.frontUVs,backUVs:f.backUVs},j)}g.e.ExtrudeShape=function(q,f,j,d,h,L){let Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0;return U(q,{shape:f,path:j,scale:d,rotation:h,cap:0===L?0:L||g.e.NO_CAP,sideOrientation:r,instance:u,updatable:H},Q)},g.e.ExtrudeShapeCustom=(q,f,j,d,h,L,Q,H,r,u,X,z)=>Y(q,{shape:f,path:j,scaleFunction:d,rotationFunction:h,ribbonCloseArray:L,ribbonClosePath:Q,cap:0===H?0:H||g.e.NO_CAP,sideOrientation:X,instance:z,updatable:u},r);g.e.CreateLathe=(q,f,j,d,g,h,L)=>F(q,{shape:f,radius:j,tessellation:d,sideOrientation:L,updatable:h},g);var M=j(12319),o=j(12269);function b(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=f.path;let L=f.instance,Q=1;void 0!==f.radius?Q=f.radius:L&&(Q=L._creationDataStorage.radius);const H=f.tessellation||64,u=f.radiusFunction||null;let X=f.cap||g.e.NO_CAP;const z=f.invertUV||!1,B=f.updatable,D=g.e._GetDefaultSideOrientation(f.sideOrientation);f.arc=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1;const i=(q,f,j,h,L,Q,H,r)=>{const u=f.getTangents(),X=f.getNormals(),z=f.getDistances(),B=2*Math.PI/L*r,D=Q||(()=>h);let i,t,O,N;const w=d.f.Matrix[0];let E=H===g.e.NO_CAP||H===g.e.CAP_END?0:2;for(let g=0;g<q.length;g++){t=D(g,z[g]),i=Array(),O=X[g];for(let f=0;f<L;f++)d.b.RotationAxisToRef(u[g],B*f,w),N=i[f]?i[f]:d.j.Zero(),d.j.TransformCoordinatesToRef(O,w,N),N.scaleInPlace(t).addInPlace(q[g]),i[f]=N;j[E]=i,E++}const s=(f,j)=>{const d=Array();for(let g=0;g<f;g++)d.push(q[j]);return d};switch(H){case g.e.NO_CAP:break;case g.e.CAP_START:j[0]=s(L,0),j[1]=j[2].slice(0);break;case g.e.CAP_END:j[E]=j[E-1].slice(0),j[E+1]=s(L,q.length-1);break;case g.e.CAP_ALL:j[0]=s(L,0),j[1]=j[2].slice(0),j[E]=j[E-1].slice(0),j[E+1]=s(L,q.length-1)}return j};let t,O;if(L){const q=L._creationDataStorage,j=f.arc||q.arc;return t=q.path3D.update(h),O=i(h,t,q.pathArray,Q,q.tessellation,u,q.cap,j),L=r("",{pathArray:O,instance:L}),q.path3D=t,q.pathArray=O,q.arc=j,q.radius=Q,L}t=new n.m(h);X=X<0||X>3?0:X,O=i(h,t,new Array,Q,H,u,X,f.arc);const N=r(q,{pathArray:O,closePath:!0,closeArray:!1,updatable:B,sideOrientation:D,invertUV:z,frontUVs:f.frontUVs,backUVs:f.backUVs},j);return N._creationDataStorage.pathArray=O,N._creationDataStorage.path3D=t,N._creationDataStorage.tessellation=H,N._creationDataStorage.cap=X,N._creationDataStorage.arc=f.arc,N._creationDataStorage.radius=Q,N}function x(q){const f=[];f[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},f[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},f[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},f[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},f[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},f[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},f[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},f[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},f[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},f[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},f[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},f[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},f[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},f[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},f[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const j=q.type&&(q.type<0||q.type>=f.length)?0:q.type||0,g=q.size,h=q.sizeX||g||1,H=q.sizeY||g||1,r=q.sizeZ||g||1,u=q.custom||f[j],X=u.face.length,B=q.faceUV||new Array(X),D=q.faceColors,i=void 0===q.flat||q.flat,t=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,O=[],N=[],w=[],E=[],s=[];let S=0,e=0;const Z=[];let I,T,W,n,U,Y,v=0,F=0;if(i)for(F=0;F<X;F++)D&&void 0===D[F]&&(D[F]=new z.e(1,1,1,1)),B&&void 0===B[F]&&(B[F]=new d.m(0,0,1,1));if(i)for(F=0;F<X;F++){const q=u.face[F].length;for(W=2*Math.PI/q,n=.5*Math.tan(W/2),U=.5,v=0;v<q;v++)O.push(u.vertex[u.face[F][v]][0]*h,u.vertex[u.face[F][v]][1]*H,u.vertex[u.face[F][v]][2]*r),Z.push(S),S++,I=B[F].x+(B[F].z-B[F].x)*(.5+n),T=B[F].y+(B[F].w-B[F].y)*(U-.5),E.push(I,Q.b?1-T:T),Y=n*Math.cos(W)-U*Math.sin(W),U=n*Math.sin(W)+U*Math.cos(W),n=Y,D&&s.push(D[F].r,D[F].g,D[F].b,D[F].a);for(v=0;v<q-2;v++)N.push(Z[0+e],Z[v+2+e],Z[v+1+e]);e+=q}else{for(v=0;v<u.vertex.length;v++)O.push(u.vertex[v][0]*h,u.vertex[v][1]*H,u.vertex[v][2]*r),E.push(0,Q.b?1:0);for(F=0;F<X;F++)for(v=0;v<u.face[F].length-2;v++)N.push(u.face[F][0],u.face[F][v+2],u.face[F][v+1])}L.e.ComputeNormals(O,N,w),L.e._ComputeSides(t,O,N,w,E,q.frontUVs,q.backUVs);const M=new L.e;return M.Iq=O,M.indices=N,M.Tq=w,M.nq=E,D&&i&&(M.Wq=s),M}function R(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return x(f).Yq(d,f.updatable),d}g.e.CreateTube=(q,f,j,d,g,h,L,Q,H,r)=>b(q,{path:f,radius:j,tessellation:d,radiusFunction:g,arc:1,cap:h,updatable:Q,sideOrientation:H,instance:r},L);function A(q){const f=q.sideOrientation||L.e.DEFAULTSIDE,j=q.radius||1,g=void 0===q.flat||q.flat,h=0|(q.subdivisions||4),H=q.radiusX||j,r=q.radiusY||j,u=q.radiusZ||j,X=(1+Math.sqrt(5))/2,z=[-1,X,-0,1,X,0,-1,-X,0,1,-X,0,0,-1,-X,0,1,-X,0,-1,X,0,1,X,X,0,1,X,0,-1,-X,0,1,-X,0,-1],B=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],D=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],i=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],t=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],O=[],N=[],w=[],E=[];let s=0;const S=new Array(3),e=new Array(3);let Z;for(Z=0;Z<3;Z++)S[Z]=d.j.Zero(),e[Z]=d.i.Zero();for(let L=0;L<20;L++){for(Z=0;Z<3;Z++){const q=B[3*L+Z];S[Z].Af(z[3*D[q]],z[3*D[q]+1],z[3*D[q]+2]),S[Z].normalize(),e[Z].Af(.134765625*i[2*q]+.05859375+-.0390625*t[L],.2333984375*i[2*q+1]+.025390625+.01953125*t[L])}const q=(q,f,j,L)=>{const X=d.j.Lerp(S[0],S[2],f/h),z=d.j.Lerp(S[1],S[2],f/h),B=h===f?S[2]:d.j.Lerp(X,z,q/(h-f));let D;if(B.normalize(),g){const q=d.j.Lerp(S[0],S[2],L/h),f=d.j.Lerp(S[1],S[2],L/h);D=d.j.Lerp(q,f,j/(h-L))}else D=new d.j(B.x,B.y,B.z);D.x/=H,D.y/=r,D.z/=u,D.normalize();const i=d.i.Lerp(e[0],e[2],f/h),t=d.i.Lerp(e[1],e[2],f/h),Z=h===f?e[2]:d.i.Lerp(i,t,q/(h-f));N.push(B.x*H,B.y*r,B.z*u),w.push(D.x,D.y,D.z),E.push(Z.x,Q.b?1-Z.y:Z.y),O.push(s),s++};for(let f=0;f<h;f++)for(let j=0;j+f<h;j++)q(j,f,j+1/3,f+1/3),q(j+1,f,j+1/3,f+1/3),q(j,f+1,j+1/3,f+1/3),j+f+1<h&&(q(j+1,f,j+2/3,f+2/3),q(j+1,f+1,j+2/3,f+2/3),q(j,f+1,j+2/3,f+2/3))}L.e._ComputeSides(f,N,O,w,E,q.frontUVs,q.backUVs);const I=new L.e;return I.indices=O,I.Iq=N,I.Tq=w,I.nq=E,I}function k(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new g.e(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),d._originalBuilderSideOrientation=f.sideOrientation;return A(f).Yq(d,f.updatable),d}L.e.CreatePolyhedron=x,g.e.CreatePolyhedron=(q,f,j)=>R(q,f,j);L.e.CreateIcoSphere=A,g.e.CreateIcoSphere=(q,f,j)=>k(q,f,j);var y=j(10985);const p=new d.j(1,0,0),l=new d.j(-1,0,0),V=new d.j(0,1,0),a=new d.j(0,-1,0),P=new d.j(0,0,1),C=new d.j(0,0,-1);class c{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.j.Zero(),f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.j.Up(),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.i.Zero(),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=q,this.df=f,this.uv=j,this.vertexIdx=g,this.vertexIdxForBones=h,this.localPositionOverride=L,this.localNormalOverride=Q,this.matrixIndicesOverride=H,this.matrixWeightsOverride=r}clone(){var q,f,j,d;return new c(this.position.clone(),this.df.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(q=this.localPositionOverride)||void 0===q?void 0:q.slice(),null===(f=this.localNormalOverride)||void 0===f?void 0:f.slice(),null===(j=this.matrixIndicesOverride)||void 0===j?void 0:j.slice(),null===(d=this.matrixWeightsOverride)||void 0===d?void 0:d.slice())}}function G(q,f,j){var H,r,u,X,z;const B=!!f.skeleton,D=!(null===(H=f.morphTargetManager)||void 0===H||!H.numTargets),i=j.localMode||B,t=f.sf(),O=B||D?f.tH(!0,!0):f.getVerticesData(h.i.PositionKind),N=B||D?f.getNormalsData(!0,!0):f.getVerticesData(h.i.NormalKind),w=i?B?f.getVerticesData(h.i.PositionKind):O:null,E=i?B?f.getVerticesData(h.i.NormalKind):N:null,s=f.getVerticesData(h.i.UVKind),S=B?f.getVerticesData(h.i.MatricesIndicesKind):null,e=B?f.getVerticesData(h.i.MatricesWeightsKind):null,Z=B?f.getVerticesData(h.i.MatricesIndicesExtraKind):null,I=B?f.getVerticesData(h.i.MatricesWeightsExtraKind):null,T=j.position||d.j.Zero();let W=j.df||d.j.Up();const n=j.size||d.j.One(),U=j.angle||0;if(!W){const q=new d.j(0,0,1),j=f.eq().activeCamera,g=d.j.TransformCoordinates(q,j.getWorldMatrix());W=j.globalPosition.ej(g)}const Y=-Math.atan2(W.z,W.x)-Math.PI/2,v=Math.sqrt(W.x*W.x+W.z*W.z),F=Math.atan2(W.y,v),M=new L.e;M.indices=[],M.Iq=[],M.Tq=[],M.nq=[],M.matricesIndices=B?[]:null,M.matricesWeights=B?[]:null,M.matricesIndicesExtra=Z?[]:null,M.matricesWeightsExtra=I?[]:null;let o=0;const b=(q,f)=>{const g=new c;if(!t||!O||!N)return g;const h=t[q];if(g.vertexIdx=3*h,g.vertexIdxForBones=4*h,g.position=new d.j(O[3*h],O[3*h+1],O[3*h+2]),d.j.TransformCoordinatesToRef(g.position,f,g.position),g.df=new d.j(N[3*h],N[3*h+1],N[3*h+2]),d.j.TransformNormalToRef(g.df,f,g.df),j.captureUVS&&s){const q=s[2*h+1];g.uv=new d.i(s[2*h],Q.b?1-q:q)}return g},x=[0,0,0,0],R=(q,f)=>{if(0===q.length)return q;const j=.5*Math.abs(d.j.Dot(n,f)),g=(q,f,j,d)=>{for(let g=0;g<d;++g)if(q[j+g]===f)return j+g;return-1},h=(q,h)=>{const L=d.j.GetClipFactor(q.position,h.position,f,j);let Q=x,H=x;if(S&&e){const f=q.matrixIndicesOverride?0:q.vertexIdxForBones,j=q.matrixIndicesOverride??S,d=q.matrixWeightsOverride??e,r=h.matrixIndicesOverride?0:h.vertexIdxForBones,u=h.matrixIndicesOverride??S,X=h.matrixWeightsOverride??e;Q=[0,0,0,0],H=[0,0,0,0];let z=0;for(let q=0;q<4;++q)if(d[f+q]>0){const h=g(u,j[f+q],r,4);Q[z]=j[f+q],H[z]=(0,y.Lerp)(d[f+q],h>=0?X[h]:0,L),z++}for(let q=0;q<4&&z<4;++q){const d=u[r+q];-1===g(j,d,f,4)&&(Q[z]=d,H[z]=(0,y.Lerp)(0,X[r+q],L),z++)}const B=H[0]+H[1]+H[2]+H[3];H[0]/=B,H[1]/=B,H[2]/=B,H[3]/=B}const r=q.localPositionOverride?q.localPositionOverride[0]:(null===w||void 0===w?void 0:w[q.vertexIdx])??0,u=q.localPositionOverride?q.localPositionOverride[1]:(null===w||void 0===w?void 0:w[q.vertexIdx+1])??0,X=q.localPositionOverride?q.localPositionOverride[2]:(null===w||void 0===w?void 0:w[q.vertexIdx+2])??0,z=h.localPositionOverride?h.localPositionOverride[0]:(null===w||void 0===w?void 0:w[h.vertexIdx])??0,B=h.localPositionOverride?h.localPositionOverride[1]:(null===w||void 0===w?void 0:w[h.vertexIdx+1])??0,D=h.localPositionOverride?h.localPositionOverride[2]:(null===w||void 0===w?void 0:w[h.vertexIdx+2])??0,i=q.localNormalOverride?q.localNormalOverride[0]:(null===E||void 0===E?void 0:E[q.vertexIdx])??0,t=q.localNormalOverride?q.localNormalOverride[1]:(null===E||void 0===E?void 0:E[q.vertexIdx+1])??0,O=q.localNormalOverride?q.localNormalOverride[2]:(null===E||void 0===E?void 0:E[q.vertexIdx+2])??0,N=i+((h.localNormalOverride?h.localNormalOverride[0]:(null===E||void 0===E?void 0:E[h.vertexIdx])??0)-i)*L,s=t+((h.localNormalOverride?h.localNormalOverride[1]:(null===E||void 0===E?void 0:E[h.vertexIdx+1])??0)-t)*L,Z=O+((h.localNormalOverride?h.localNormalOverride[2]:(null===E||void 0===E?void 0:E[h.vertexIdx+2])??0)-O)*L,I=Math.sqrt(N*N+s*s+Z*Z);return new c(d.j.Lerp(q.position,h.position,L),d.j.Lerp(q.df,h.df,L).normalize(),d.i.Lerp(q.uv,h.uv,L),-1,-1,w?[r+(z-r)*L,u+(B-u)*L,X+(D-X)*L]:null,E?[N/I,s/I,Z/I]:null,Q,H)};let L=null;q.length>3&&(L=[]);for(let Q=0;Q<q.length;Q+=3){let g=0,H=null,r=null,u=null,X=null;const z=d.j.Dot(q[Q].position,f)-j>0,B=d.j.Dot(q[Q+1].position,f)-j>0,D=d.j.Dot(q[Q+2].position,f)-j>0;switch(g=(z?1:0)+(B?1:0)+(D?1:0),g){case 0:q.length>3?(L.push(q[Q]),L.push(q[Q+1]),L.push(q[Q+2])):L=q;break;case 1:if(L=L??new Array,z&&(H=q[Q+1],r=q[Q+2],u=h(q[Q],H),X=h(q[Q],r)),B){H=q[Q],r=q[Q+2],u=h(q[Q+1],H),X=h(q[Q+1],r),L.push(u),L.push(r.clone()),L.push(H.clone()),L.push(r.clone()),L.push(u.clone()),L.push(X);break}D&&(H=q[Q],r=q[Q+1],u=h(q[Q+2],H),X=h(q[Q+2],r)),H&&r&&u&&X&&(L.push(H.clone()),L.push(r.clone()),L.push(u),L.push(X),L.push(u.clone()),L.push(r.clone()));break;case 2:L=L??new Array,z||(H=q[Q].clone(),r=h(H,q[Q+1]),u=h(H,q[Q+2]),L.push(H),L.push(r),L.push(u)),B||(H=q[Q+1].clone(),r=h(H,q[Q+2]),u=h(H,q[Q]),L.push(H),L.push(r),L.push(u)),D||(H=q[Q+2].clone(),r=h(H,q[Q]),u=h(H,q[Q+1]),L.push(H),L.push(r),L.push(u))}}return L},A=f instanceof g.e?f:null,k=null===A||void 0===A?void 0:A._thinInstanceDataStorage.matrixData,G=(null===A||void 0===A?void 0:A.ud)||1,m=d.f.Matrix[0];m.H(d.b.IdentityReadOnly);for(let g=0;g<G;++g){if(null!==A&&void 0!==A&&A.hasThinInstances&&k){const q=16*g;m.setRowFromFloats(0,k[q+0],k[q+1],k[q+2],k[q+3]),m.setRowFromFloats(1,k[q+4],k[q+5],k[q+6],k[q+7]),m.setRowFromFloats(2,k[q+8],k[q+9],k[q+10],k[q+11]),m.setRowFromFloats(3,k[q+12],k[q+13],k[q+14],k[q+15])}const q=d.b.RotationYawPitchRoll(Y,F,U).multiply(d.b.Translation(T.x,T.y,T.z)),h=d.b.Invert(q),L=f.getWorldMatrix(),H=m.multiply(L).multiply(h),r=new Array(3);for(let f=0;f<t.length;f+=3){let q=r;if(q[0]=b(f,H),q[1]=b(f+1,H),q[2]=b(f+2,H),!(j.cullBackFaces&&-q[0].df.z<=0&&-q[1].df.z<=0&&-q[2].df.z<=0)&&(q=R(q,p),q&&(q=R(q,l),q&&(q=R(q,V),q&&(q=R(q,a),q&&(q=R(q,P),q&&(q=R(q,C),q)))))))for(let f=0;f<q.length;f++){const d=q[f];if(M.indices.push(o),i?(d.localPositionOverride?(M.Iq[3*o]=d.localPositionOverride[0],M.Iq[3*o+1]=d.localPositionOverride[1],M.Iq[3*o+2]=d.localPositionOverride[2]):w&&(M.Iq[3*o]=w[d.vertexIdx],M.Iq[3*o+1]=w[d.vertexIdx+1],M.Iq[3*o+2]=w[d.vertexIdx+2]),d.localNormalOverride?(M.Tq[3*o]=d.localNormalOverride[0],M.Tq[3*o+1]=d.localNormalOverride[1],M.Tq[3*o+2]=d.localNormalOverride[2]):E&&(M.Tq[3*o]=E[d.vertexIdx],M.Tq[3*o+1]=E[d.vertexIdx+1],M.Tq[3*o+2]=E[d.vertexIdx+2])):(d.position.toArray(M.Iq,3*o),d.df.toArray(M.Tq,3*o)),M.matricesIndices&&M.matricesWeights&&(d.matrixIndicesOverride?(M.matricesIndices[4*o]=d.matrixIndicesOverride[0],M.matricesIndices[4*o+1]=d.matrixIndicesOverride[1],M.matricesIndices[4*o+2]=d.matrixIndicesOverride[2],M.matricesIndices[4*o+3]=d.matrixIndicesOverride[3]):(S&&(M.matricesIndices[4*o]=S[d.vertexIdxForBones],M.matricesIndices[4*o+1]=S[d.vertexIdxForBones+1],M.matricesIndices[4*o+2]=S[d.vertexIdxForBones+2],M.matricesIndices[4*o+3]=S[d.vertexIdxForBones+3]),Z&&M.matricesIndicesExtra&&(M.matricesIndicesExtra[4*o]=Z[d.vertexIdxForBones],M.matricesIndicesExtra[4*o+1]=Z[d.vertexIdxForBones+1],M.matricesIndicesExtra[4*o+2]=Z[d.vertexIdxForBones+2],M.matricesIndicesExtra[4*o+3]=Z[d.vertexIdxForBones+3])),d.matrixWeightsOverride?(M.matricesWeights[4*o]=d.matrixWeightsOverride[0],M.matricesWeights[4*o+1]=d.matrixWeightsOverride[1],M.matricesWeights[4*o+2]=d.matrixWeightsOverride[2],M.matricesWeights[4*o+3]=d.matrixWeightsOverride[3]):(e&&(M.matricesWeights[4*o]=e[d.vertexIdxForBones],M.matricesWeights[4*o+1]=e[d.vertexIdxForBones+1],M.matricesWeights[4*o+2]=e[d.vertexIdxForBones+2],M.matricesWeights[4*o+3]=e[d.vertexIdxForBones+3]),I&&M.matricesWeightsExtra&&(M.matricesWeightsExtra[4*o]=I[d.vertexIdxForBones],M.matricesWeightsExtra[4*o+1]=I[d.vertexIdxForBones+1],M.matricesWeightsExtra[4*o+2]=I[d.vertexIdxForBones+2],M.matricesWeightsExtra[4*o+3]=I[d.vertexIdxForBones+3]))),j.captureUVS)d.uv.toArray(M.nq,2*o);else{M.nq.push(.5+d.position.x/n.x);const q=.5+d.position.y/n.y;M.nq.push(Q.b?1-q:q)}o++}}}0===M.indices.length&&(M.indices=null),0===M.Iq.length&&(M.Iq=null),0===M.Tq.length&&(M.Tq=null),0===M.nq.length&&(M.nq=null),0===(null===(r=M.matricesIndices)||void 0===r?void 0:r.length)&&(M.matricesIndices=null),0===(null===(u=M.matricesWeights)||void 0===u?void 0:u.length)&&(M.matricesWeights=null),0===(null===(X=M.matricesIndicesExtra)||void 0===X?void 0:X.length)&&(M.matricesIndicesExtra=null),0===(null===(z=M.matricesWeightsExtra)||void 0===z?void 0:z.length)&&(M.matricesWeightsExtra=null);const K=new g.e(q,f.eq());return M.Yq(K),i?(K.skeleton=f.skeleton,K.parent=f):(K.position=T.clone(),K.rotation=new d.j(F,Y,U)),K.Nf(!0),K.refreshBoundingInfo(!0,!0),K}function m(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const f=0|Math.max(q.subdivisions?q.subdivisions:2,1),j=0|Math.max(q.tessellation?q.tessellation:16,3),g=Math.max(q.height?q.height:1,0),h=Math.max(q.radius?q.radius:.25,0),H=0|Math.max(q.capSubdivisions?q.capSubdivisions:6,1),r=j,u=f,X=Math.max(q.radiusTop?q.radiusTop:h,0),z=Math.max(q.radiusBottom?q.radiusBottom:h,0),B=g-(X+z),D=2*Math.PI,i=Math.max(q.topCapSubdivisions?q.topCapSubdivisions:H,1),t=Math.max(q.bottomCapSubdivisions?q.bottomCapSubdivisions:H,1),O=Math.acos((z-X)/g);let N=[];const w=[],E=[],s=[];let S=0;const e=[],Z=.5*B,I=.5*Math.PI;let T,W;const n=d.j.Zero(),U=d.j.Zero(),Y=Math.cos(O),v=Math.sin(O),F=new d.i(X*v,Z+X*Y).ej(new d.i(z*v,z*Y-Z)).length(),M=X*O+F+z*(I-O);let o=0;for(W=0;W<=i;W++){const q=[],f=I-O*(W/i);o+=X*O/i;const j=Math.cos(f),d=Math.sin(f),g=j*X;for(T=0;T<=r;T++){const f=T/r,h=f*D+0,L=Math.sin(h),H=Math.cos(h);U.x=g*L,U.y=Z+d*X,U.z=g*H,w.push(U.x,U.y,U.z),n.set(j*L,d,j*H),E.push(n.x,n.y,n.z),s.push(f,Q.b?o/M:1-o/M),q.push(S),S++}e.push(q)}const b=g-X-z+Y*X-Y*z,x=v*(z-X)/b;for(W=1;W<=u;W++){const q=[];o+=F/u;const f=v*(W*(z-X)/u+X);for(T=0;T<=r;T++){const j=T/r,d=j*D+0,g=Math.sin(d),h=Math.cos(d);U.x=f*g,U.y=Z+Y*X-W*b/u,U.z=f*h,w.push(U.x,U.y,U.z),n.set(g,x,h).normalize(),E.push(n.x,n.y,n.z),s.push(j,Q.b?o/M:1-o/M),q.push(S),S++}e.push(q)}for(W=1;W<=t;W++){const q=[],f=I-O-(Math.PI-O)*(W/t);o+=z*O/t;const j=Math.cos(f),d=Math.sin(f),g=j*z;for(T=0;T<=r;T++){const f=T/r,h=f*D+0,L=Math.sin(h),H=Math.cos(h);U.x=g*L,U.y=d*z-Z,U.z=g*H,w.push(U.x,U.y,U.z),n.set(j*L,d,j*H),E.push(n.x,n.y,n.z),s.push(f,Q.b?o/M:1-o/M),q.push(S),S++}e.push(q)}for(T=0;T<r;T++)for(W=0;W<i+u+t;W++){const q=e[W][T],f=e[W+1][T],j=e[W+1][T+1],d=e[W][T+1];N.push(q),N.push(f),N.push(d),N.push(f),N.push(j),N.push(d)}if(N=N.reverse(),q.orientation&&!q.orientation.equals(d.j.Up())){const f=new d.b;q.orientation.clone().scale(.5*Math.PI).cross(d.j.Up()).toQuaternion().toRotationMatrix(f);const j=d.j.Zero();for(let q=0;q<w.length;q+=3)j.set(w[q],w[q+1],w[q+2]),d.j.TransformCoordinatesToRef(j.clone(),f,j),w[q]=j.x,w[q+1]=j.y,w[q+2]=j.z}const R=new L.e;return R.Iq=w,R.Tq=E,R.nq=s,R.indices=N,R}function K(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:d.j.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new g.e(q,j);return m(f).Yq(h,f.updatable),h}g.e.CreateDecal=(q,f,j,d,g,h)=>G(q,f,{position:j,df:d,size:g,angle:h});g.e.CreateCapsule=(q,f,j)=>K(q,f,j),L.e.CreateCapsule=m;var J=j(11005),qq=j(10950);class fq{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=f,q!==Math.floor(q)&&(q=Math.floor(q),J.e.Warn("x is not an integer, floor(x) used")),f!==Math.floor(f)&&(f=Math.floor(f),J.e.Warn("y is not an integer, floor(y) used"))}clone(){return new fq(this.x,this.y)}rotate60About(q){const f=this.x;return this.x=q.x+q.y-this.y,this.y=f+this.y-q.x,this}rotateNeg60About(q){const f=this.x;return this.x=f+this.y-q.y,this.y=q.x+q.y-f,this}rotate120(q,f){q!==Math.floor(q)&&(q=Math.floor(q),J.e.Warn("m not an integer only floor(m) used")),f!==Math.floor(f)&&(f=Math.floor(f),J.e.Warn("n not an integer only floor(n) used"));const j=this.x;return this.x=q-j-this.y,this.y=f+j,this}rotateNeg120(q,f){q!==Math.floor(q)&&(q=Math.floor(q),J.e.Warn("m is not an integer, floor(m) used")),f!==Math.floor(f)&&(f=Math.floor(f),J.e.Warn("n is not an integer,   floor(n) used"));const j=this.x;return this.x=this.y-f,this.y=q+f-j-this.y,this}toCartesianOrigin(q,f){const j=d.j.Zero();return j.x=q.x+2*this.x*f+this.y*f,j.y=q.y+Math.sqrt(3)*this.y*f,j}static Zero(){return new fq(0,0)}}class jq{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new dq("icosahedron","Regular",[[0,qq.h,-1],[-qq.h,1,0],[-1,0,-qq.h],[1,0,-qq.h],[qq.h,1,0],[0,qq.h,1],[-1,0,qq.h],[-qq.h,-1,0],[0,-qq.h,-1],[qq.h,-1,0],[1,0,qq.h],[0,-qq.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let q=12;const f={},j=this.m,d=this.n;let g,h,L,Q,H,r=j,u=1,X=0;0!==d&&(r=(0,y.HighestCommonFactor)(j,d)),u=j/r,X=d/r;const z=fq.Zero(),B=new fq(j,d),D=new fq(-d,j+d),i=fq.Zero(),t=fq.Zero(),O=fq.Zero();let N,w,E,s,S=[];const e=[],Z=this.vertByDist,I=(j,d,g,h)=>{N=j+"|"+g,w=d+"|"+h,N in f||w in f?N in f&&!(w in f)?f[w]=f[N]:w in f&&!(N in f)&&(f[N]=f[w]):(f[N]=q,f[w]=q,q++),Z[g][0]>2?e[f[N]]=[-Z[g][0],Z[g][1],f[N]]:e[f[N]]=[S[Z[g][0]],Z[g][1],f[N]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let T=0;T<20;T++){if(S=this.IDATA.face[T],L=S[2],Q=S[1],H=S[0],E=z.x+"|"+z.y,N=T+"|"+E,N in f||(f[N]=L,e[L]=[S[Z[E][0]],Z[E][1]]),E=B.x+"|"+B.y,N=T+"|"+E,N in f||(f[N]=Q,e[Q]=[S[Z[E][0]],Z[E][1]]),E=D.x+"|"+D.y,N=T+"|"+E,N in f||(f[N]=H,e[H]=[S[Z[E][0]],Z[E][1]]),g=this.IDATA.edgematch[T][0],h=this.IDATA.edgematch[T][1],"B"===h)for(let q=1;q<r;q++)t.x=j-q*(u+X),t.y=d+q*u,O.x=-q*X,O.y=q*(u+X),E=t.x+"|"+t.y,s=O.x+"|"+O.y,I(T,g,E,s);if("O"===h)for(let q=1;q<r;q++)O.x=-q*X,O.y=q*(u+X),i.x=q*u,i.y=q*X,E=O.x+"|"+O.y,s=i.x+"|"+i.y,I(T,g,E,s);if(g=this.IDATA.edgematch[T][2],h=this.IDATA.edgematch[T][3],h&&"A"===h)for(let q=1;q<r;q++)i.x=q*u,i.y=q*X,t.x=j-(r-q)*(u+X),t.y=d+(r-q)*u,E=i.x+"|"+i.y,s=t.x+"|"+t.y,I(T,g,E,s);for(let j=0;j<this.vertices.length;j++)E=this.vertices[j].x+"|"+this.vertices[j].y,N=T+"|"+E,N in f||(f[N]=q++,Z[E][0]>2?e[f[N]]=[-Z[E][0],Z[E][1],f[N]]:e[f[N]]=[S[Z[E][0]],Z[E][1],f[N]])}this.closestTo=e,this.vecToidx=f}calcCoeffs(){const q=this.m,f=this.n,j=Math.sqrt(3)/3,d=q*q+f*f+q*f;this.coau=(q+f)/d,this.cobu=-f/d,this.coav=-j*(q-f)/d,this.cobv=j*(2*q+f)/d}createInnerFacets(){const q=this.m,f=this.n;for(let j=0;j<f+q+1;j++)for(let q=this.min[j];q<this.max[j]+1;q++)q<this.max[j]&&q<this.max[j+1]+1&&this.innerFacets.push(["|"+q+"|"+j,"|"+q+"|"+(j+1),"|"+(q+1)+"|"+j]),j>0&&q<this.max[j-1]&&q+1<this.max[j]+1&&this.innerFacets.push(["|"+q+"|"+j,"|"+(q+1)+"|"+j,"|"+(q+1)+"|"+(j-1)])}edgeVecsABOB(){const q=this.m,f=this.n,j=new fq(-f,q+f);for(let d=1;d<q+f;d++){const q=new fq(this.min[d],d),f=new fq(this.min[d-1],d-1),g=new fq(this.min[d+1],d+1),h=q.clone(),L=f.clone(),Q=g.clone();h.rotate60About(j),L.rotate60About(j),Q.rotate60About(j);const H=new fq(this.max[h.y],h.y),r=new fq(this.max[h.y-1],h.y-1),u=new fq(this.max[h.y-1]-1,h.y-1);h.x===H.x&&h.y===H.y||(h.x!==r.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,r,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,u,H])):h.y===Q.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,f,r]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([q,r,g])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,f,r]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,r,H])))}}mapABOBtoOBOA(){const q=new fq(0,0);for(let f=0;f<this.isoVecsABOB.length;f++){const j=[];for(let d=0;d<3;d++)q.x=this.isoVecsABOB[f][d].x,q.y=this.isoVecsABOB[f][d].y,0===this.vertexTypes[f][d]&&q.rotateNeg120(this.m,this.n),j.push(q.clone());this.isoVecsOBOA.push(j)}}mapABOBtoBAOA(){const q=new fq(0,0);for(let f=0;f<this.isoVecsABOB.length;f++){const j=[];for(let d=0;d<3;d++)q.x=this.isoVecsABOB[f][d].x,q.y=this.isoVecsABOB[f][d].y,1===this.vertexTypes[f][d]&&q.rotate120(this.m,this.n),j.push(q.clone());this.isoVecsBAOA.push(j)}}MapToFace(q,f){const j=this.IDATA.face[q],g=j[2],h=j[1],L=j[0],Q=d.j.Pf(this.IDATA.vertex[g]),H=d.j.Pf(this.IDATA.vertex[h]),r=d.j.Pf(this.IDATA.vertex[L]),u=H.ej(Q),X=r.ej(Q),z=u.scale(this.coau).add(X.scale(this.cobu)),B=u.scale(this.coav).add(X.scale(this.cobv)),D=[];let i,t=d.f.kf[0];for(let d=0;d<this.cartesian.length;d++)t=z.scale(this.cartesian[d].x).add(B.scale(this.cartesian[d].y)).add(Q),D[d]=[t.x,t.y,t.z],i=q+"|"+this.vertices[d].x+"|"+this.vertices[d].y,f.vertex[this.vecToidx[i]]=[t.x,t.y,t.z]}build(q,f){const j=[],d=fq.Zero(),g=new fq(q,f),h=new fq(-f,q+f);j.push(d,g,h);for(let E=f;E<q+1;E++)for(let f=0;f<q+1-E;f++)j.push(new fq(f,E));if(f>0){const d=(0,y.HighestCommonFactor)(q,f),g=q/d,h=f/d;for(let Q=1;Q<d;Q++)j.push(new fq(Q*g,Q*h)),j.push(new fq(-Q*h,Q*(g+h))),j.push(new fq(q-Q*(g+h),f+Q*g));const L=q/f;for(let Q=1;Q<f;Q++)for(let d=0;d<Q*L;d++)j.push(new fq(d,Q)),j.push(new fq(d,Q).rotate120(q,f)),j.push(new fq(d,Q).rotateNeg120(q,f))}j.sort(((q,f)=>q.x-f.x)),j.sort(((q,f)=>q.y-f.y));const L=new Array(q+f+1),Q=new Array(q+f+1);for(let E=0;E<L.length;E++)L[E]=1/0,Q[E]=-1/0;let H=0,r=0;const u=j.length;for(let E=0;E<u;E++)r=j[E].x,H=j[E].y,L[H]=Math.min(r,L[H]),Q[H]=Math.max(r,Q[H]);const X=(j,d)=>{const g=j.clone();return"A"===d&&g.rotateNeg120(q,f),"B"===d&&g.rotate120(q,f),g.x<0?g.y:g.x+g.y},z=[],B=[],D=[],i=[],t={},O=[];let N=-1,w=-1;for(let E=0;E<u;E++)z[E]=j[E].toCartesianOrigin(new fq(0,0),.5),B[E]=X(j[E],"O"),D[E]=X(j[E],"A"),i[E]=X(j[E],"B"),B[E]===D[E]&&D[E]===i[E]?(N=3,w=B[E]):B[E]===D[E]?(N=4,w=B[E]):D[E]===i[E]?(N=5,w=D[E]):i[E]===B[E]&&(N=6,w=B[E]),B[E]<D[E]&&B[E]<i[E]&&(N=2,w=B[E]),D[E]<B[E]&&D[E]<i[E]&&(N=1,w=D[E]),i[E]<D[E]&&i[E]<B[E]&&(N=0,w=i[E]),O.push([N,w,j[E].x,j[E].y]);O.sort(((q,f)=>q[2]-f[2])),O.sort(((q,f)=>q[3]-f[3])),O.sort(((q,f)=>q[1]-f[1])),O.sort(((q,f)=>q[0]-f[0]));for(let E=0;E<O.length;E++)t[O[E][2]+"|"+O[E][3]]=[O[E][0],O[E][1],E];return this.m=q,this.n=f,this.vertices=j,this.vertByDist=t,this.cartesian=z,this.min=L,this.max=Q,this}}class dq{constructor(q,f,j,d){this.name=q,this.category=f,this.vertex=j,this.face=d}}class gq extends dq{innerToData(q,f){for(let j=0;j<f.innerFacets.length;j++)this.face.push(f.innerFacets[j].map((j=>f.vecToidx[q+j])))}mapABOBtoDATA(q,f){const j=f.IDATA.edgematch[q][0];for(let d=0;d<f.isoVecsABOB.length;d++){const g=[];for(let h=0;h<3;h++)0===f.vertexTypes[d][h]?g.push(q+"|"+f.isoVecsABOB[d][h].x+"|"+f.isoVecsABOB[d][h].y):g.push(j+"|"+f.isoVecsABOB[d][h].x+"|"+f.isoVecsABOB[d][h].y);this.face.push([f.vecToidx[g[0]],f.vecToidx[g[1]],f.vecToidx[g[2]]])}}mapOBOAtoDATA(q,f){const j=f.IDATA.edgematch[q][0];for(let d=0;d<f.isoVecsOBOA.length;d++){const g=[];for(let h=0;h<3;h++)1===f.vertexTypes[d][h]?g.push(q+"|"+f.isoVecsOBOA[d][h].x+"|"+f.isoVecsOBOA[d][h].y):g.push(j+"|"+f.isoVecsOBOA[d][h].x+"|"+f.isoVecsOBOA[d][h].y);this.face.push([f.vecToidx[g[0]],f.vecToidx[g[1]],f.vecToidx[g[2]]])}}mapBAOAtoDATA(q,f){const j=f.IDATA.edgematch[q][2];for(let d=0;d<f.isoVecsBAOA.length;d++){const g=[];for(let h=0;h<3;h++)1===f.vertexTypes[d][h]?g.push(q+"|"+f.isoVecsBAOA[d][h].x+"|"+f.isoVecsBAOA[d][h].y):g.push(j+"|"+f.isoVecsBAOA[d][h].x+"|"+f.isoVecsBAOA[d][h].y);this.face.push([f.vecToidx[g[0]],f.vecToidx[g[1]],f.vecToidx[g[2]]])}}orderData(q){const f=[];for(let h=0;h<13;h++)f[h]=[];const j=q.closestTo;for(let h=0;h<j.length;h++)j[h][0]>-1?j[h][1]>0&&f[j[h][0]].push([h,j[h][1]]):f[12].push([h,j[h][0]]);const d=[];for(let h=0;h<12;h++)d[h]=h;let g=12;for(let h=0;h<12;h++){f[h].sort(((q,f)=>q[1]-f[1]));for(let q=0;q<f[h].length;q++)d[f[h][q][0]]=g++}for(let h=0;h<f[12].length;h++)d[f[12][h][0]]=g++;for(let h=0;h<this.vertex.length;h++)this.vertex[h].push(d[h]);this.vertex.sort(((q,f)=>q[3]-f[3]));for(let h=0;h<this.vertex.length;h++)this.vertex[h].pop();for(let h=0;h<this.face.length;h++)for(let q=0;q<this.face[h].length;q++)this.face[h][q]=d[this.face[h][q]];this.sharedNodes=f[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(q,f){const j=[],d=[];let g=f.pop();d.push(g);let h=this.face[g].indexOf(q);h=(h+2)%3;let L=this.face[g][h];j.push(L);let Q=0;for(;f.length>0;)g=f[Q],this.face[g].indexOf(L)>-1?(h=(this.face[g].indexOf(L)+1)%3,L=this.face[g][h],j.push(L),d.push(g),f.splice(Q,1),Q=0):Q++;return this.adjacentFaces.push(j),d}toGoldbergPolyhedronData(){const q=new dq("GeoDual","Goldberg",[],[]);q.name="GD dual";const f=this.vertex.length,j=new Array(f);for(let H=0;H<f;H++)j[H]=[];for(let H=0;H<this.face.length;H++)for(let q=0;q<3;q++)j[this.face[H][q]].push(H);let d=0,g=0,h=0,L=[],Q=[];this.adjacentFaces=[];for(let H=0;H<j.length;H++){q.face[H]=this.setOrder(H,j[H].concat([]));for(const f of j[H]){d=0,g=0,h=0,L=this.face[f];for(let q=0;q<3;q++)Q=this.vertex[L[q]],d+=Q[0],g+=Q[1],h+=Q[2];q.vertex[f]=[d/3,g/3,h/3]}}return q}static BuildGeodesicData(q){const f=new gq("Geodesic-m-n","Geodesic",[[0,qq.h,-1],[-qq.h,1,0],[-1,0,-qq.h],[1,0,-qq.h],[qq.h,1,0],[0,qq.h,1],[-1,0,qq.h],[-qq.h,-1,0],[0,-qq.h,-1],[qq.h,-1,0],[1,0,qq.h],[0,-qq.h,1]],[]);q.setIndices(),q.calcCoeffs(),q.createInnerFacets(),q.edgeVecsABOB(),q.mapABOBtoOBOA(),q.mapABOBtoBAOA();for(let j=0;j<q.IDATA.face.length;j++)q.MapToFace(j,f),f.innerToData(j,q),"B"===q.IDATA.edgematch[j][1]&&f.mapABOBtoDATA(j,q),"O"===q.IDATA.edgematch[j][1]&&f.mapOBOAtoDATA(j,q),"A"===q.IDATA.edgematch[j][3]&&f.mapBAOAtoDATA(j,q);f.orderData(q);return f.vertex=f.vertex.map((function(q){const f=q[0],j=q[1],d=q[2],g=Math.sqrt(f*f+j*j+d*d);return q[0]*=1/g,q[1]*=1/g,q[2]*=1/g,q})),f}}g.e._GoldbergMeshParser=(q,f)=>hq.Parse(q,f);class hq extends g.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(q,f){return void 0===f?(q>this.goldbergData.nbUnsharedFaces-1&&(J.e.Warn("Maximum number of unshared faces used"),q=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+q):(q>11&&(J.e.Warn("Last pole used"),q=11),f>this.goldbergData.nbFacesAtPole-1&&(J.e.Warn("Maximum number of faces at a pole used"),f=this.goldbergData.nbFacesAtPole-1),12+q*this.goldbergData.nbFacesAtPole+f)}_changeGoldbergFaceColors(q){for(let j=0;j<q.length;j++){const f=q[j][0],d=q[j][1],g=q[j][2];for(let q=f;q<d+1;q++)this.goldbergData.faceColors[q]=g}const f=[];for(let j=0;j<12;j++)for(let q=0;q<5;q++)f.push(this.goldbergData.faceColors[j].r,this.goldbergData.faceColors[j].g,this.goldbergData.faceColors[j].b,this.goldbergData.faceColors[j].a);for(let j=12;j<this.goldbergData.faceColors.length;j++)for(let q=0;q<6;q++)f.push(this.goldbergData.faceColors[j].r,this.goldbergData.faceColors[j].g,this.goldbergData.faceColors[j].b,this.goldbergData.faceColors[j].a);return f}setGoldbergFaceColors(q){const f=this._changeGoldbergFaceColors(q);this.oq(h.i.ColorKind,f)}updateGoldbergFaceColors(q){const f=this._changeGoldbergFaceColors(q);this.updateVerticesData(h.i.ColorKind,f)}_changeGoldbergFaceUVs(q){const f=this.getVerticesData(h.i.UVKind);for(let j=0;j<q.length;j++){const d=q[j][0],g=q[j][1],h=q[j][2],L=q[j][3],Q=q[j][4],H=[],r=[];let u,X;for(let q=0;q<5;q++)u=h.x+L*Math.cos(Q+q*Math.PI/2.5),X=h.y+L*Math.sin(Q+q*Math.PI/2.5),u<0&&(u=0),u>1&&(u=1),H.push(u,X);for(let q=0;q<6;q++)u=h.x+L*Math.cos(Q+q*Math.PI/3),X=h.y+L*Math.sin(Q+q*Math.PI/3),u<0&&(u=0),u>1&&(u=1),r.push(u,X);for(let q=d;q<Math.min(12,g+1);q++)for(let j=0;j<5;j++)f[10*q+2*j]=H[2*j],f[10*q+2*j+1]=H[2*j+1];for(let q=Math.max(12,d);q<g+1;q++)for(let j=0;j<6;j++)f[12*q-24+2*j]=r[2*j],f[12*q-23+2*j]=r[2*j+1]}return f}setGoldbergFaceUVs(q){const f=this._changeGoldbergFaceUVs(q);this.oq(h.i.UVKind,f)}updateGoldbergFaceUVs(q){const f=this._changeGoldbergFaceUVs(q);this.updateVerticesData(h.i.UVKind,f)}placeOnGoldbergFaceAt(q,f,j){const g=d.j.RotationFromAxis(this.goldbergData.faceXaxis[f],this.goldbergData.faceYaxis[f],this.goldbergData.faceZaxis[f]);q.rotation=g,q.position=this.goldbergData.faceCenters[f].add(this.goldbergData.faceXaxis[f].scale(j.x)).add(this.goldbergData.faceYaxis[f].scale(j.y)).add(this.goldbergData.faceZaxis[f].scale(j.z))}serialize(q){super.serialize(q),q.type="GoldbergMesh";const f={};if(f.adjacentFaces=this.goldbergData.adjacentFaces,f.nbSharedFaces=this.goldbergData.nbSharedFaces,f.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,f.nbFaces=this.goldbergData.nbFaces,f.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){f.faceColors=[];for(const q of this.goldbergData.faceColors)f.faceColors.push(q.Yf())}if(this.goldbergData.faceCenters){f.faceCenters=[];for(const q of this.goldbergData.faceCenters)f.faceCenters.push(q.Yf())}if(this.goldbergData.faceZaxis){f.faceZaxis=[];for(const q of this.goldbergData.faceZaxis)f.faceZaxis.push(q.Yf())}if(this.goldbergData.faceYaxis){f.faceYaxis=[];for(const q of this.goldbergData.faceYaxis)f.faceYaxis.push(q.Yf())}if(this.goldbergData.faceXaxis){f.faceXaxis=[];for(const q of this.goldbergData.faceXaxis)f.faceXaxis.push(q.Yf())}q.goldbergData=f}static Parse(q,f){const j=q.goldbergData;j.faceColors=j.faceColors.map((q=>z.e.Pf(q))),j.faceCenters=j.faceCenters.map((q=>d.j.Pf(q))),j.faceZaxis=j.faceZaxis.map((q=>d.j.Pf(q))),j.faceXaxis=j.faceXaxis.map((q=>d.j.Pf(q))),j.faceYaxis=j.faceYaxis.map((q=>d.j.Pf(q)));const g=new hq(q.name,f);return g.goldbergData=j,g}}var Lq=j(11649);const Qq={CreateBox:X.c,CreateTiledBox:t,CreateSphere:O.d,CreateDisc:u.e,CreateIcoSphere:k,CreateRibbon:r,CreateCylinder:s,CreateTorus:e,CreateTorusKnot:I,CreateLineSystem:T.g,Vr:T.k,CreateDashedLines:T.d,ExtrudeShape:U,ExtrudeShapeCustom:Y,CreateLathe:F,CreateTiledPlane:D,Pr:M.c,CreateGround:o.i,CreateTiledGround:o.l,CreateGroundFromHeightMap:o.e,CreatePolygon:W.c,ExtrudePolygon:W.e,CreateTube:b,CreatePolyhedron:R,CreateGeodesic:function(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=f.m||1;d!==Math.floor(d)&&(d=Math.floor(d),J.e.Warn("m not an integer only floor(m) used"));let g=f.n||0;if(g!==Math.floor(g)&&(g=Math.floor(g),J.e.Warn("n not an integer only floor(n) used")),g>d){const q=g;g=d,d=q,J.e.Warn("n > m therefore m and n swapped")}const h=new jq;return h.build(d,g),R(q,{custom:gq.BuildGeodesicData(h),size:f.size,sizeX:f.sizeX,sizeY:f.sizeY,sizeZ:f.sizeZ,faceUV:f.faceUV,faceColors:f.faceColors,flat:f.flat,updatable:f.updatable,sideOrientation:f.sideOrientation,frontUVs:f.frontUVs,backUVs:f.backUVs},j)},CreateGoldberg:function(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=f.size,H=f.sizeX||h||1,r=f.sizeY||h||1,u=f.sizeZ||h||1;let X=f.m||1;X!==Math.floor(X)&&(X=Math.floor(X),J.e.Warn("m not an integer only floor(m) used"));let B=f.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),J.e.Warn("n not an integer only floor(n) used")),B>X){const q=B;B=X,X=q,J.e.Warn("n > m therefore m and n swapped")}const D=new jq;D.build(X,B);const i=gq.BuildGeodesicData(D),t=i.toGoldbergPolyhedronData(),O=new hq(q,j);f.sideOrientation=g.e._GetDefaultSideOrientation(f.sideOrientation),O._originalBuilderSideOrientation=f.sideOrientation;(function(q,f){const j=q.size,g=q.sizeX||j||1,h=q.sizeY||j||1,H=q.sizeZ||j||1,r=0===q.sideOrientation?0:q.sideOrientation||L.e.DEFAULTSIDE,u=[],X=[],z=[],B=[];let D=1/0,i=-1/0,t=1/0,O=-1/0;for(let d=0;d<f.vertex.length;d++)D=Math.min(D,f.vertex[d][0]*g),i=Math.max(i,f.vertex[d][0]*g),t=Math.min(t,f.vertex[d][1]*h),O=Math.max(O,f.vertex[d][1]*h);let N=0;for(let L=0;L<f.face.length;L++){const q=f.face[L],j=d.j.Pf(f.vertex[q[0]]),r=d.j.Pf(f.vertex[q[2]]),w=d.j.Pf(f.vertex[q[1]]),E=r.ej(j),s=w.ej(j),S=d.j.Cross(s,E).normalize();for(let d=0;d<q.length;d++){z.push(S.x,S.y,S.z);const j=f.vertex[q[d]];u.push(j[0]*g,j[1]*h,j[2]*H);const L=(j[1]*h-t)/(O-t);B.push((j[0]*g-D)/(i-D),Q.b?1-L:L)}for(let f=0;f<q.length-2;f++)X.push(N,N+f+2,N+f+1);N+=q.length}L.e._ComputeSides(r,u,X,z,B);const w=new L.e;return w.Iq=u,w.indices=X,w.Tq=z,w.nq=B,w})(f,t).Yq(O,f.updatable),O.goldbergData.nbSharedFaces=i.sharedNodes,O.goldbergData.nbUnsharedFaces=i.poleNodes,O.goldbergData.adjacentFaces=i.adjacentFaces,O.goldbergData.nbFaces=O.goldbergData.nbSharedFaces+O.goldbergData.nbUnsharedFaces,O.goldbergData.nbFacesAtPole=(O.goldbergData.nbUnsharedFaces-12)/12;for(let g=0;g<i.vertex.length;g++)O.goldbergData.faceCenters.push(d.j.Pf(i.vertex[g])),O.goldbergData.faceCenters[g].x*=H,O.goldbergData.faceCenters[g].y*=r,O.goldbergData.faceCenters[g].z*=u,O.goldbergData.faceColors.push(new z.e(1,1,1,1));for(let g=0;g<t.face.length;g++){const q=t.face[g],f=d.j.Pf(t.vertex[q[0]]),j=d.j.Pf(t.vertex[q[2]]),h=d.j.Pf(t.vertex[q[1]]),L=j.ej(f),Q=h.ej(f),H=d.j.Cross(Q,L).normalize(),r=d.j.Cross(Q,H).normalize();O.goldbergData.faceXaxis.push(Q.normalize()),O.goldbergData.faceYaxis.push(H),O.goldbergData.faceZaxis.push(r)}return O},CreateDecal:G,CreateCapsule:K,CreateText:Lq.c}},12329:(q,f,j)=>{"use strict";j.d(f,{b:()=>Qf});var d=j(10941),g=j(11549);class h extends g.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var L=j(11210),Q=(j(11371),j(10965));class H{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this._targetStopDuration!==q&&(this._targetStopDuration=q)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){this._noiseTexture!==q&&(this._noiseTexture=q,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(q){this._isAnimationSheetEnabled!=q&&(this._isAnimationSheetEnabled=q,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){this._useLogarithmicDepth=q&&this.eq().getEngine().getCaps().fragmentDepthSupported}eq(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(q){switch(q){case H.BLENDMODE_MULTIPLYADD:return;case H.BLENDMODE_ADD:q=1;break;case H.BLENDMODE_ONEONE:q=6;break;case H.BLENDMODE_STANDARD:q=2;break;case H.BLENDMODE_MULTIPLY:q=4;break;case H.BLENDMODE_SUBTRACT:q=3}this._engine.setAlphaMode(q)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:d.j.Zero()}set direction1(q){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=q)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:d.j.Zero()}set direction2(q){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=q)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:d.j.Zero()}set minEmitBox(q){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=q)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:d.j.Zero()}set maxEmitBox(q){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=q)}get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(q){this._isBillboardBased!==q&&(this._isBillboardBased=q,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q)}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(!q&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=q)}_reset(){}_removeGradientAndTexture(q,f,j){if(!f)return this;let d=0;for(const g of f){if(g.gradient===q){f.splice(d,1);break}d++}return j&&j.dispose(),this}constructor(q){this.animations=[],this.renderingGroupId=0,this.k=d.j.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new d.j(10,10,10),this.onAnimationEnd=null,this.blendMode=H.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new d.i(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.yr=new d.j(0,0,0),this._useLogarithmicDepth=!1,this.gravity=d.j.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new L.e(1,1,1,1),this.color2=new L.e(1,1,1,1),this.colorDead=new L.e(0,0,0,1),this.textureMask=new L.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new h,this.id=q,this.name=q}createPointEmitter(q,f){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new d.j(0,1,0),arguments.length>2&&void 0!==arguments[2]||new d.j(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new d.j(0,1,0),arguments.length>4&&void 0!==arguments[4]||new d.j(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new d.j(0,1,0),arguments.length>3&&void 0!==arguments[3]||new d.j(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(q,f,j,d){throw new Error("Method not implemented.")}}H.BLENDMODE_ONEONE=0,H.BLENDMODE_STANDARD=1,H.BLENDMODE_ADD=2,H.BLENDMODE_MULTIPLY=3,H.BLENDMODE_MULTIPLYADD=4,H.BLENDMODE_SUBTRACT=-1,(0,Q.f)("BABYLON.BaseParticleSystem",H);var r=j(10985),u=j(11011);class X{constructor(){this.direction1=new d.j(0,1,0),this.direction2=new d.j(0,1,0),this.minEmitBox=new d.j(-.5,-.5,-.5),this.maxEmitBox=new d.j(.5,.5,.5)}startDirectionFunction(q,f,j,g){const h=(0,r.RandomRange)(this.direction1.x,this.direction2.x),L=(0,r.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,r.RandomRange)(this.direction1.z,this.direction2.z);if(g)return f.x=h,f.y=L,void(f.z=Q);d.j.TransformNormalFromFloatsToRef(h,L,Q,q,f)}startPositionFunction(q,f,j,g){const h=(0,r.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),L=(0,r.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),Q=(0,r.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(g)return f.x=h,f.y=L,void(f.z=Q);d.j.TransformCoordinatesFromFloatsToRef(h,L,Q,q,f)}clone(){const q=new X;return u.e.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2),q.setVector3("minEmitBox",this.minEmitBox),q.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3),q.addUniform("minEmitBox",3),q.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Yf(),q.direction2=this.direction2.Yf(),q.minEmitBox=this.minEmitBox.Yf(),q.maxEmitBox=this.maxEmitBox.Yf(),q}parse(q){d.j.FromArrayToRef(q.direction1,0,this.direction1),d.j.FromArrayToRef(q.direction2,0,this.direction2),d.j.FromArrayToRef(q.minEmitBox,0,this.minEmitBox),d.j.FromArrayToRef(q.maxEmitBox,0,this.maxEmitBox)}}class z{get radius(){return this._radius}set radius(q){this._radius=q,this._buildHeight()}get angle(){return this._angle}set angle(q){this._angle=q,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=j,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=f,this.radius=q}startDirectionFunction(q,f,j,g){g?d.f.kf[0].H(j.TH).normalize():j.position.subtractToRef(q.getTranslation(),d.f.kf[0]).normalize();const h=(0,r.RandomRange)(0,this.directionRandomizer),L=(0,r.RandomRange)(0,this.directionRandomizer),Q=(0,r.RandomRange)(0,this.directionRandomizer);f.x=d.f.kf[0].x+h,f.y=d.f.kf[0].y+L,f.z=d.f.kf[0].z+Q,f.normalize()}startPositionFunction(q,f,j,g){const h=(0,r.RandomRange)(0,2*Math.PI);let L;this.emitFromSpawnPointOnly?L=1e-4:(L=(0,r.RandomRange)(0,this.heightRange),L=1-L*L);let Q=this._radius-(0,r.RandomRange)(0,this._radius*this.radiusRange);Q*=L;const H=Q*Math.sin(h),u=Q*Math.cos(h),X=L*this._height;if(g)return f.x=H,f.y=X,void(f.z=u);d.j.TransformCoordinatesFromFloatsToRef(H,X,u,q,f)}clone(){const q=new z(this._radius,this._angle,this.directionRandomizer);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat2("radius",this._radius,this.radiusRange),q.setFloat("coneAngle",this._angle),q.setFloat2("height",this._height,this.heightRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",2),q.addUniform("coneAngle",1),q.addUniform("height",2),q.addUniform("directionRandomizer",1)}getEffectDefines(){let q="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(q+="\n#define CONEEMITTERSPAWNPOINT"),q}getClassName(){return"ConeParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this._radius,q.angle=this._angle,q.directionRandomizer=this.directionRandomizer,q.radiusRange=this.radiusRange,q.heightRange=this.heightRange,q.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,q}parse(q){this.radius=q.radius,this.angle=q.angle,this.directionRandomizer=q.directionRandomizer,this.radiusRange=void 0!==q.radiusRange?q.radiusRange:1,this.heightRange=void 0!==q.radiusRange?q.heightRange:1,this.emitFromSpawnPointOnly=void 0!==q.emitFromSpawnPointOnly&&q.emitFromSpawnPointOnly}}class B extends z{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0);super(q,f),this.direction1=j,this.direction2=g}startDirectionFunction(q,f){const j=(0,r.RandomRange)(this.direction1.x,this.direction2.x),g=(0,r.RandomRange)(this.direction1.y,this.direction2.y),h=(0,r.RandomRange)(this.direction1.z,this.direction2.z);d.j.TransformNormalFromFloatsToRef(j,g,h,q,f)}clone(){const q=new B(this.radius,this.angle,this.direction1,this.direction2);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Yf(),q.direction2=this.direction2.Yf(),q}parse(q){super.parse(q),this.direction1.H(q.direction1),this.direction2.H(q.direction2)}}class D{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=q,this.height=f,this.radiusRange=j,this.directionRandomizer=g,this._tempVector=d.j.Zero()}startDirectionFunction(q,f,j,g,h){j.position.subtractToRef(q.getTranslation(),this._tempVector),this._tempVector.normalize(),d.j.TransformNormalToRef(this._tempVector,h,this._tempVector);const L=(0,r.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let Q=Math.atan2(this._tempVector.x,this._tempVector.z);Q+=(0,r.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=L,this._tempVector.x=Math.sin(Q),this._tempVector.z=Math.cos(Q),this._tempVector.normalize(),g?f.H(this._tempVector):d.j.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q,f)}startPositionFunction(q,f,j,g){const h=(0,r.RandomRange)(-this.height/2,this.height/2),L=(0,r.RandomRange)(0,2*Math.PI),Q=(0,r.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),H=Math.sqrt(Q)*this.radius,u=H*Math.cos(L),X=H*Math.sin(L);g?f.Af(u,h,X):d.j.TransformCoordinatesFromFloatsToRef(u,h,X,q,f)}clone(){const q=new D(this.radius,this.directionRandomizer);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.height=this.height,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.height=q.height,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class i extends D{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.j(0,1,0);super(q,f,j),this.direction1=g,this.direction2=h}startDirectionFunction(q,f,j,g){const h=(0,r.RandomRange)(this.direction1.x,this.direction2.x),L=(0,r.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,r.RandomRange)(this.direction1.z,this.direction2.z);g?f.Af(h,L,Q):d.j.TransformNormalFromFloatsToRef(h,L,Q,q,f)}clone(){const q=new i(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Yf(),q.direction2=this.direction2.Yf(),q}parse(q){super.parse(q),d.j.FromArrayToRef(q.direction1,0,this.direction1),d.j.FromArrayToRef(q.direction2,0,this.direction2)}}class t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=f,this.directionRandomizer=j}startDirectionFunction(q,f,j,g){const h=j.position.ej(q.getTranslation()).normalize(),L=(0,r.RandomRange)(0,this.directionRandomizer),Q=(0,r.RandomRange)(0,this.directionRandomizer),H=(0,r.RandomRange)(0,this.directionRandomizer);h.x+=L,h.y+=Q,h.z+=H,h.normalize(),g?f.H(h):d.j.TransformNormalFromFloatsToRef(h.x,h.y,h.z,q,f)}startPositionFunction(q,f,j,g){const h=this.radius-(0,r.RandomRange)(0,this.radius*this.radiusRange),L=(0,r.RandomRange)(0,1),Q=(0,r.RandomRange)(0,2*Math.PI),H=Math.acos(2*L-1),u=h*Math.cos(Q)*Math.sin(H),X=h*Math.cos(H),z=h*Math.sin(Q)*Math.sin(H);g?f.Af(u,Math.abs(X),z):d.j.TransformCoordinatesFromFloatsToRef(u,Math.abs(X),z,q,f)}clone(){const q=new t(this.radius,this.directionRandomizer);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class O{constructor(){this.direction1=new d.j(0,1,0),this.direction2=new d.j(0,1,0)}startDirectionFunction(q,f,j,g){const h=(0,r.RandomRange)(this.direction1.x,this.direction2.x),L=(0,r.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,r.RandomRange)(this.direction1.z,this.direction2.z);g?f.Af(h,L,Q):d.j.TransformNormalFromFloatsToRef(h,L,Q,q,f)}startPositionFunction(q,f,j,g){g?f.Af(0,0,0):d.j.TransformCoordinatesFromFloatsToRef(0,0,0,q,f)}clone(){const q=new O;return u.e.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Yf(),q.direction2=this.direction2.Yf(),q}parse(q){d.j.FromArrayToRef(q.direction1,0,this.direction1),d.j.FromArrayToRef(q.direction2,0,this.direction2)}}class N{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=f,this.directionRandomizer=j}startDirectionFunction(q,f,j,g){const h=j.position.ej(q.getTranslation()).normalize(),L=(0,r.RandomRange)(0,this.directionRandomizer),Q=(0,r.RandomRange)(0,this.directionRandomizer),H=(0,r.RandomRange)(0,this.directionRandomizer);h.x+=L,h.y+=Q,h.z+=H,h.normalize(),g?f.H(h):d.j.TransformNormalFromFloatsToRef(h.x,h.y,h.z,q,f)}startPositionFunction(q,f,j,g){const h=this.radius-(0,r.RandomRange)(0,this.radius*this.radiusRange),L=(0,r.RandomRange)(0,1),Q=(0,r.RandomRange)(0,2*Math.PI),H=Math.acos(2*L-1),u=h*Math.cos(Q)*Math.sin(H),X=h*Math.cos(H),z=h*Math.sin(Q)*Math.sin(H);g?f.Af(u,X,z):d.j.TransformCoordinatesFromFloatsToRef(u,X,z,q,f)}clone(){const q=new N(this.radius,this.directionRandomizer);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class w extends N{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.j(0,1,0),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0);super(q),this.direction1=f,this.direction2=j}startDirectionFunction(q,f){const j=(0,r.RandomRange)(this.direction1.x,this.direction2.x),g=(0,r.RandomRange)(this.direction1.y,this.direction2.y),h=(0,r.RandomRange)(this.direction1.z,this.direction2.z);d.j.TransformNormalFromFloatsToRef(j,g,h,q,f)}clone(){const q=new w(this.radius,this.direction1,this.direction2);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Yf(),q.direction2=this.direction2.Yf(),q}parse(q){super.parse(q),this.direction1.H(q.direction1),this.direction2.H(q.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(q,f,j,g){const h=d.f.kf[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,j,h);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,j,h);const q=d.f.kf[1];h.subtractToRef(j.position,q),q.scaleToRef(1/j.lifeTime,h)}else h.set(0,0,0);g?f.H(h):d.j.TransformNormalToRef(h,q,f)}startPositionFunction(q,f,j,g){const h=d.f.kf[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,j,h):h.set(0,0,0),g?f.H(h):d.j.TransformCoordinatesToRef(h,q,f)}clone(){const q=new E;return u.e.DeepCopy(this,q),q}applyToShader(q){}buildUniformLayout(q){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.particlePositionGenerator=this.particlePositionGenerator,q.particleDestinationGenerator=this.particleDestinationGenerator,q}parse(q){q.particlePositionGenerator&&(this.particlePositionGenerator=q.particlePositionGenerator),q.particleDestinationGenerator&&(this.particleDestinationGenerator=q.particleDestinationGenerator)}}var s=j(11151);class S{get mesh(){return this._mesh}set mesh(q){this._mesh!==q&&(this._mesh=q,q?(this._indices=q.sf(),this._positions=q.getVerticesData(s.i.PositionKind),this._normals=q.getVerticesData(s.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=d.j.Zero(),this._mesh=null,this.direction1=new d.j(0,1,0),this.direction2=new d.j(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=q}startDirectionFunction(q,f,j,g){if(this.useMeshNormalsForDirection&&this._normals)return void d.j.TransformNormalToRef(this._storedNormal,q,f);const h=(0,r.RandomRange)(this.direction1.x,this.direction2.x),L=(0,r.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,r.RandomRange)(this.direction1.z,this.direction2.z);g?f.Af(h,L,Q):d.j.TransformNormalFromFloatsToRef(h,L,Q,q,f)}startPositionFunction(q,f,j,g){if(!this._indices||!this._positions)return;const h=3*(Math.random()*(this._indices.length/3)|0),L=Math.random(),Q=Math.random()*(1-L),H=1-L-Q,r=this._indices[h],u=this._indices[h+1],X=this._indices[h+2],z=d.f.kf[0],B=d.f.kf[1],D=d.f.kf[2],i=d.f.kf[3];d.j.FromArrayToRef(this._positions,3*r,z),d.j.FromArrayToRef(this._positions,3*u,B),d.j.FromArrayToRef(this._positions,3*X,D),i.x=L*z.x+Q*B.x+H*D.x,i.y=L*z.y+Q*B.y+H*D.y,i.z=L*z.z+Q*B.z+H*D.z,g?f.Af(i.x,i.y,i.z):d.j.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,q,f),this.useMeshNormalsForDirection&&this._normals&&(d.j.FromArrayToRef(this._normals,3*r,z),d.j.FromArrayToRef(this._normals,3*u,B),d.j.FromArrayToRef(this._normals,3*X,D),this._storedNormal.x=L*z.x+Q*B.x+H*D.x,this._storedNormal.y=L*z.y+Q*B.y+H*D.y,this._storedNormal.z=L*z.z+Q*B.z+H*D.z)}clone(){const q=new S(this.mesh);return u.e.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var q;const f={};return f.type=this.getClassName(),f.direction1=this.direction1.Yf(),f.direction2=this.direction2.Yf(),f.meshId=null===(q=this.mesh)||void 0===q?void 0:q.id,f.useMeshNormalsForDirection=this.useMeshNormalsForDirection,f}parse(q,f){d.j.FromArrayToRef(q.direction1,0,this.direction1),d.j.FromArrayToRef(q.direction2,0,this.direction2),q.meshId&&f&&(this.mesh=f.getLastMeshById(q.meshId)),this.useMeshNormalsForDirection=q.useMeshNormalsForDirection}}class e{_isUbo(q){return void 0!==q.addUniform}constructor(q){this._isUbo(q)?(this.setMatrix3x3=q.updateMatrix3x3.bind(q),this.setMatrix2x2=q.updateMatrix2x2.bind(q),this.setFloat=q.updateFloat.bind(q),this.setFloat2=q.updateFloat2.bind(q),this.setFloat3=q.updateFloat3.bind(q),this.setFloat4=q.updateFloat4.bind(q),this.setFloatArray=q.updateFloatArray.bind(q),this.setArray=q.updateArray.bind(q),this.setIntArray=q.updateIntArray.bind(q),this.setMatrix=q.jd.bind(q),this.setMatrices=q.updateMatrices.bind(q),this.setVector3=q.updateVector3.bind(q),this.setVector4=q.updateVector4.bind(q),this.setColor3=q.updateColor3.bind(q),this.setColor4=q.updateColor4.bind(q),this.setDirectColor4=q.updateDirectColor4.bind(q),this.setInt=q.updateInt.bind(q),this.setInt2=q.updateInt2.bind(q),this.setInt3=q.updateInt3.bind(q),this.setInt4=q.updateInt4.bind(q)):(this.setMatrix3x3=q.setMatrix3x3.bind(q),this.setMatrix2x2=q.setMatrix2x2.bind(q),this.setFloat=q.setFloat.bind(q),this.setFloat2=q.setFloat2.bind(q),this.setFloat3=q.setFloat3.bind(q),this.setFloat4=q.setFloat4.bind(q),this.setFloatArray=q.setFloatArray.bind(q),this.setArray=q.setArray.bind(q),this.setIntArray=q.setIntArray.bind(q),this.setMatrix=q.setMatrix.bind(q),this.setMatrices=q.setMatrices.bind(q),this.setVector3=q.setVector3.bind(q),this.setVector4=q.setVector4.bind(q),this.setColor3=q.setColor3.bind(q),this.setColor4=q.setColor4.bind(q),this.setDirectColor4=q.setDirectColor4.bind(q),this.setInt=q.setInt.bind(q),this.setInt2=q.setInt2.bind(q),this.setInt3=q.setInt3.bind(q),this.setInt4=q.setInt4.bind(q))}}var Z=j(11075);const I="gpuUpdateParticlesPixelShader",T="#version 300 es\nvoid main() {discard;}\n";Z.b.ShadersStore[I]||(Z.b.ShadersStore[I]=T);const W="gpuUpdateParticlesVertexShader",n="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Z.b.ShadersStore[W]||(Z.b.ShadersStore[W]=n);(0,Q.f)("BABYLON.WebGL2ParticleSystem",class{constructor(q,f){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=q,this._engine=f,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var q;return(null===(q=this._updateEffect)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=q,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new e(this._updateEffect)}createVertexBuffers(q,f){this._updateVAO.push(this._createUpdateVAO(q)),this._renderVAO.push(this._engine.recordVertexArrayObject(f,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=f}createParticleBuffer(q){return q}bindDrawBuffers(q,f,j){j?this._engine.bindBuffers(this._renderVertexBuffers,j,f):this._engine.bindVertexArrayObject(this._renderVAO[q],null)}preUpdateParticleBuffer(){const q=this._engine;if(this._engine.enableEffect(this._updateEffect),!q.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(q,f,j){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[q],null);const d=this._engine;d.bindTransformFeedbackBuffer(f.getBuffer()),d.setRasterizerState(!1),d.beginTransformFeedback(!0),d.drawArraysType(3,0,j),d.endTransformFeedback(),d.setRasterizerState(!0),d.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let q=0;q<this._updateVAO.length;q++)this._engine.releaseVertexArrayObject(this._updateVAO[q]);this._updateVAO.length=0;for(let q=0;q<this._renderVAO.length;q++)this._engine.releaseVertexArrayObject(this._renderVAO[q]);this._renderVAO.length=0}_createUpdateVAO(q){const f={};f.position=q.createVertexBuffer("position",0,3);let j=3;f.age=q.createVertexBuffer("age",j,1),j+=1,f.size=q.createVertexBuffer("size",j,3),j+=3,f.life=q.createVertexBuffer("life",j,1),j+=1,f.seed=q.createVertexBuffer("seed",j,4),j+=4,f.direction=q.createVertexBuffer("direction",j,3),j+=3,this._parent.particleEmitterType instanceof E&&(f.initialPosition=q.createVertexBuffer("initialPosition",j,3),j+=3),this._parent._colorGradientsTexture||(f.color=q.createVertexBuffer("color",j,4),j+=4),this._parent._isBillboardBased||(f.initialDirection=q.createVertexBuffer("initialDirection",j,3),j+=3),this._parent.noiseTexture&&(f.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",j,3),j+=3,f.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",j,3),j+=3),this._parent._angularSpeedGradientsTexture?(f.angle=q.createVertexBuffer("angle",j,1),j+=1):(f.angle=q.createVertexBuffer("angle",j,2),j+=2),this._parent._isAnimationSheetEnabled&&(f.cellIndex=q.createVertexBuffer("cellIndex",j,1),j+=1,this._parent.spriteRandomStartCell&&(f.cellStartOffset=q.createVertexBuffer("cellStartOffset",j,1),j+=1));const d=this._engine.recordVertexArrayObject(f,null,this._updateEffect);return this._engine.bindArrayBuffer(null),d}});class U{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,d=arguments.length>3?arguments[3]:void 0;this._engine=q,this._label=d,this._engine._storageBuffers.push(this),this._create(f,j)}_create(q,f){this._bufferSize=q,this._creationFlags=f,this._buffer=this._engine.createStorageBuffer(q,f,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(q,f,j){this._buffer&&this._engine.updateStorageBuffer(this._buffer,q,f,j)}async read(q,f,j,d){return await this._engine.readFromStorageBuffer(this._buffer,q,f,j,d)}dispose(){const q=this._engine._storageBuffers,f=q.indexOf(this);-1!==f&&(q[f]=q[q.length-1],q.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Y=j(11125),v=j(11130),F=j(11199),M=j(11438),o=j(11540),b=j(11005),x=j(11093),R=j(11425);class A{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.b}_addDuration(q,f){q<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==q?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(f,!1),this._gpuTimeInFrameId=q):this.counter.addCount(f,!1))}}var k=j(11059);class y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=q,this._engine=f,this.uniqueId=o.d.UniqueId,f.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new A),this._engine.getCaps().supportComputeShaders?d.bindingsMapping?(this._context=f.createComputeContext(),this._shaderPath=j,this._options={bindingsMapping:{},defines:[],...d}):b.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):b.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=this._bindings[q];this._bindings[q]={type:j?0:4,object:f,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!d||d.object!==f||d.type!==this._bindings[q].type)}setStorageTexture(q,f){const j=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==f),this._bindings[q]={type:1,object:f,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setExternalTexture(q,f){const j=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==f),this._bindings[q]={type:6,object:f,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setVideoTexture(q,f){return!!f.externalTexture&&(this.setExternalTexture(q,f.externalTexture),!0)}setUniformBuffer(q,f){const j=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==f),this._bindings[q]={type:y._BufferIsDataBuffer(f)?7:2,object:f,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setStorageBuffer(q,f){const j=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==f),this._bindings[q]={type:y._BufferIsDataBuffer(f)?7:3,object:f,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setTextureSampler(q,f){const j=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!j||!f.compareSampler(j.object)),this._bindings[q]={type:5,object:f,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}isReady(){let q=this._effect;for(const g in this._bindings){const q=this._bindings[g],f=q.type,j=q.object;switch(f){case 0:case 4:case 1:if(!j.isReady())return!1;break;case 6:if(!j.isReady())return!1;break}}const f=[],j=this._shaderPath;if(this._options.defines)for(let g=0;g<this._options.defines.length;g++)f.push(this._options.defines[g]);const d=f.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,q=this._engine.createComputeEffect(j,{defines:d,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=q),!!q.isReady()}dispatch(q,f,j){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,q,f,j,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const j=y._BufferIsDataBuffer(q)?q:q.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,j,f,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const f in this._bindings){const j=this._bindings[f];if(!this._options.bindingsMapping[f])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+f+"'");switch(j.type){case 0:{const d=this._samplers[f],g=j.object;var q;if(!d||!g._texture||!d.compareSampler(g._texture))this._samplers[f]=(new x.b).setParameters(g.wrapU,g.wrapV,g.wrapR,g.anisotropicFilteringLevel,g._texture.samplingMode,null===(q=g._texture)||void 0===q?void 0:q._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const q=j.object;q.getBuffer()!==j.buffer&&(j.buffer=q.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((g=>{(0,k.d)((()=>this.dispatch(q,f,j)),g,void 0,d)}))}serialize(){const q=F.d.Serialize(this);q.options=this._options,q.shaderPath=this._shaderPath,q.vz={},q.textures={};for(const f in this._bindings){const j=this._bindings[f],d=j.object;switch(j.type){case 0:case 4:case 1:{const g=d.serialize();g&&(q.textures[f]=g,q.vz[f]={type:j.type});break}}}return q}static Parse(q,f,j){const d=F.d.Parse((()=>new y(q.name,f.getEngine(),q.shaderPath,q.options)),q,f,j);for(const g in q.textures){const h=q.vz[g],L=M.e.Parse(q.textures[g],f,j);0===h.type?d.setTexture(g,L):4===h.type?d.setTexture(g,L,!1):d.setStorageTexture(g,L)}return d}static _BufferIsDataBuffer(q){return void 0!==q.underlyingResource}}(0,Y.b)([(0,v.O)()],y.prototype,"name",void 0),(0,Y.b)([(0,v.O)()],y.prototype,"fastMode",void 0),(0,Q.f)("BABYLON.ComputeShader",y);var p=j(11190);const l="gpuUpdateParticlesComputeShader",V="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Z.b.ShadersStoreWGSL[l]||(Z.b.ShadersStoreWGSL[l]=V);(0,Q.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(q,f){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=q,this._engine=f}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var q;return(null===(q=this._updateComputeShader)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){var f;const j={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(j.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(j.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(j.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(j.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(j.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(j.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(j.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:j,defines:q.split("\n")}),null===(f=this._simParamsComputeShader)||void 0===f||f.dispose(),this._simParamsComputeShader=new p.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new e(this._simParamsComputeShader)}createVertexBuffers(q,f){this._renderVertexBuffers.push(f)}createParticleBuffer(q){const f=new U(this._engine,4*q.length,11,"ComputeShaderParticleSystemBuffer");return f.update(q),this._bufferComputeShader.push(f),f.getBuffer()}bindDrawBuffers(q,f,j){this._engine.bindBuffers(this._renderVertexBuffers[q],j,f)}preUpdateParticleBuffer(){}updateParticleBuffer(q,f,j){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[q]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^q]),this._updateComputeShader.dispatch(Math.ceil(j/64))}releaseBuffers(){var q;for(let f=0;f<this._bufferComputeShader.length;++f)this._bufferComputeShader[f].dispose();this._bufferComputeShader.length=0,null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class a{constructor(q,f,j){this.gradient=q,this.color1=f,this.color2=j}getColorToRef(q){this.color2?L.e.LerpToRef(this.color1,this.color2,Math.random(),q):q.H(this.color1)}}class P{constructor(q,f){this.gradient=q,this.color=f}}class C{constructor(q,f,j){this.gradient=q,this.factor1=f,this.factor2=j}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class c{static GetCurrentGradient(q,f,j){if(f[0].gradient>q)return void j(f[0],f[0],1);for(let g=0;g<f.length-1;g++){const d=f[g],h=f[g+1];if(q>=d.gradient&&q<=h.gradient){return void j(d,h,(q-d.gradient)/(h.gradient-d.gradient))}}const d=f.length-1;j(f[d],f[d],1)}}var G=j(10982),m=j(11468),K=j(10980);class J{constructor(q){this.particleSystem=q,this.position=d.j.Zero(),this.direction=d.j.Zero(),this.color=new L.e(0,0,0,0),this.colorStep=new L.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new d.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new L.e(0,0,0,0),this._currentColor2=new L.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=J._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let q=this.age,f=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===f?(f=1,q=this._randomCellOffset):q+=this._randomCellOffset);const j=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let d;d=this._initialSpriteCellLoop?(0,r.Clamp)(q*f%this.lifeTime/this.lifeTime):(0,r.Clamp)(q*f/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+d*j|0}_inheritParticleInfoToSubEmitter(q){if(q.particleSystem.k.position){const f=q.particleSystem.k;if(f.position.H(this.position),q.inheritDirection){const q=d.f.kf[0];this.direction.normalizeToRef(q),f.setDirection(q,0,Math.PI/2)}}else{q.particleSystem.k.H(this.position)}this.direction.scaleToRef(q.inheritedVelocityAmount/2,d.f.kf[0]),q.particleSystem._inheritedVelocityOffset.H(d.f.kf[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const q of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(q)}_reset(){this.age=0,this.id=J._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(q){q.position.H(this.position),this._initialDirection?q._initialDirection?q._initialDirection.H(this._initialDirection):q._initialDirection=this._initialDirection.clone():q._initialDirection=null,q.direction.H(this.direction),this.TH&&(q.TH?q.TH.H(this.TH):q.TH=this.TH.clone()),q.color.H(this.color),q.colorStep.H(this.colorStep),q.lifeTime=this.lifeTime,q.age=this.age,q._randomCellOffset=this._randomCellOffset,q.size=this.size,q.scale.H(this.scale),q.angle=this.angle,q.angularSpeed=this.angularSpeed,q.particleSystem=this.particleSystem,q.cellIndex=this.cellIndex,q.id=this.id,q._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(q._currentColorGradient=this._currentColorGradient,q._currentColor1.H(this._currentColor1),q._currentColor2.H(this._currentColor2)),this._currentSizeGradient&&(q._currentSizeGradient=this._currentSizeGradient,q._currentSize1=this._currentSize1,q._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(q._currentAngularSpeedGradient=this._currentAngularSpeedGradient,q._currentAngularSpeed1=this._currentAngularSpeed1,q._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(q._currentVelocityGradient=this._currentVelocityGradient,q._currentVelocity1=this._currentVelocity1,q._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(q._currentLimitVelocityGradient=this._currentLimitVelocityGradient,q._currentLimitVelocity1=this._currentLimitVelocity1,q._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(q._currentDragGradient=this._currentDragGradient,q._currentDrag1=this._currentDrag1,q._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(q._initialStartSpriteCellId=this._initialStartSpriteCellId,q._initialEndSpriteCellId=this._initialEndSpriteCellId,q._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(q.remapData&&this.remapData?q.remapData.H(this.remapData):q.remapData=new d.m(0,0,0,0)),this._randomNoiseCoordinates1&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.H(this._randomNoiseCoordinates1),q._randomNoiseCoordinates2.H(this._randomNoiseCoordinates2)):(q._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),q._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}J._Count=0;var qq=j(11186),fq=(j(11369),j(11236)),jq=j(11219),dq=j(11521);function gq(q,f){const j=(0,r.RandomRange)(0,1);L.e.LerpToRef(f.color1,f.color2,j,q.color),f.colorDead.subtractToRef(q.color,f._colorDiff),f._colorDiff.scaleToRef(1/q.lifeTime,q.colorStep)}function hq(q,f){q._currentColorGradient=f._colorGradients[0],q._currentColorGradient.getColorToRef(q.color),q._currentColor1.H(q.color),f._colorGradients.length>1?f._colorGradients[1].getColorToRef(q._currentColor2):q._currentColor2.H(q.color)}function Lq(q,f){const j=f._colorGradients;c.GetCurrentGradient(f._ratio,j,((f,j,d)=>{f!==q._currentColorGradient&&(q._currentColor1.H(q._currentColor2),j.getColorToRef(q._currentColor2),q._currentColorGradient=f),L.e.LerpToRef(q._currentColor1,q._currentColor2,d,q.color)}))}function Qq(q,f){q.colorStep.scaleToRef(f._scaledUpdateSpeed,f._scaledColorStep),q.color.addInPlace(f._scaledColorStep),q.color.a<0&&(q.color.a=0)}function Hq(q,f){c.GetCurrentGradient(f._ratio,f._angularSpeedGradients,((f,j,d)=>{f!==q._currentAngularSpeedGradient&&(q._currentAngularSpeed1=q._currentAngularSpeed2,q._currentAngularSpeed2=j.getFactor(),q._currentAngularSpeedGradient=f),q.angularSpeed=(0,r.Lerp)(q._currentAngularSpeed1,q._currentAngularSpeed2,d)}))}function rq(q,f){q.angle+=q.angularSpeed*f._scaledUpdateSpeed}function uq(q,f){f.particleEmitterType.startDirectionFunction(f._emitterWorldMatrix,q.direction,q,f.isLocal,f._emitterInverseWorldMatrix)}function Xq(q,f){f.startDirectionFunction(f._emitterWorldMatrix,q.direction,q,f.isLocal)}function zq(q,f){q._currentVelocityGradient=f._velocityGradients[0],q._currentVelocity1=q._currentVelocityGradient.getFactor(),f._velocityGradients.length>1?q._currentVelocity2=f._velocityGradients[1].getFactor():q._currentVelocity2=q._currentVelocity1}function Bq(q,f){q._currentLimitVelocityGradient=f._limitVelocityGradients[0],q._currentLimitVelocity1=q._currentLimitVelocityGradient.getFactor(),f._limitVelocityGradients.length>1?q._currentLimitVelocity2=f._limitVelocityGradients[1].getFactor():q._currentLimitVelocity2=q._currentLimitVelocity1}function Dq(q,f){c.GetCurrentGradient(f._ratio,f._velocityGradients,((j,d,g)=>{j!==q._currentVelocityGradient&&(q._currentVelocity1=q._currentVelocity2,q._currentVelocity2=d.getFactor(),q._currentVelocityGradient=j),f._directionScale*=(0,r.Lerp)(q._currentVelocity1,q._currentVelocity2,g)}))}function iq(q,f){c.GetCurrentGradient(f._ratio,f._limitVelocityGradients,((j,d,g)=>{j!==q._currentLimitVelocityGradient&&(q._currentLimitVelocity1=q._currentLimitVelocity2,q._currentLimitVelocity2=d.getFactor(),q._currentLimitVelocityGradient=j);const h=(0,r.Lerp)(q._currentLimitVelocity1,q._currentLimitVelocity2,g);q.direction.length()>h&&q.direction.scaleInPlace(f.limitVelocityDamping)}))}function tq(q,f){q.direction.scaleToRef(f._directionScale,f._scaledDirection)}function Oq(q,f){f.particleEmitterType.startPositionFunction(f._emitterWorldMatrix,q.position,q,f.isLocal)}function Nq(q,f){f.startPositionFunction(f._emitterWorldMatrix,q.position,q,f.isLocal)}function wq(q,f){q.TH?q.TH.H(q.position):q.TH=q.position.clone(),d.j.TransformCoordinatesToRef(q.TH,f._emitterWorldMatrix,q.position)}function Eq(q,f){f.isLocal&&q.TH?(q.TH.addInPlace(f._scaledDirection),d.j.TransformCoordinatesToRef(q.TH,f._emitterWorldMatrix,q.position)):q.position.addInPlace(f._scaledDirection)}function sq(q,f){q._currentDragGradient=f._dragGradients[0],q._currentDrag1=q._currentDragGradient.getFactor(),f._dragGradients.length>1?q._currentDrag2=f._dragGradients[1].getFactor():q._currentDrag2=q._currentDrag1}function Sq(q,f){c.GetCurrentGradient(f._ratio,f._dragGradients,((j,d,g)=>{j!==q._currentDragGradient&&(q._currentDrag1=q._currentDrag2,q._currentDrag2=d.getFactor(),q._currentDragGradient=j);const h=(0,r.Lerp)(q._currentDrag1,q._currentDrag2,g);f._scaledDirection.scaleInPlace(1-h)}))}function eq(q,f){q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.Af(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2.Af(Math.random(),Math.random(),Math.random())):(q._randomNoiseCoordinates1=new d.j(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2=new d.j(Math.random(),Math.random(),Math.random()))}function Zq(q,f){const j=f._noiseTextureData,g=f._noiseTextureSize;if(j&&g&&q._randomNoiseCoordinates1){const h=f._fetchR(q._randomNoiseCoordinates1.x,q._randomNoiseCoordinates1.y,g.width,g.height,j),L=f._fetchR(q._randomNoiseCoordinates1.z,q._randomNoiseCoordinates2.x,g.width,g.height,j),Q=f._fetchR(q._randomNoiseCoordinates2.y,q._randomNoiseCoordinates2.z,g.width,g.height,j),H=d.f.kf[0],r=d.f.kf[1];H.Af((2*h-1)*f.noiseStrength.x,(2*L-1)*f.noiseStrength.y,(2*Q-1)*f.noiseStrength.z),H.scaleToRef(f._tempScaledUpdateSpeed,r),q.direction.addInPlace(r)}}function Iq(q,f){f.gravity.scaleToRef(f._tempScaledUpdateSpeed,f._scaledGravity),q.direction.addInPlace(f._scaledGravity)}function Tq(q,f){q.size=(0,r.RandomRange)(f.minSize,f.maxSize),q.scale.Af((0,r.RandomRange)(f.minScaleX,f.maxScaleX),(0,r.RandomRange)(f.minScaleY,f.maxScaleY))}function Wq(q,f){q._currentSizeGradient=f._sizeGradients[0],q._currentSize1=q._currentSizeGradient.getFactor(),q.size=q._currentSize1,f._sizeGradients.length>1?q._currentSize2=f._sizeGradients[1].getFactor():q._currentSize2=q._currentSize1,q.scale.Af((0,r.RandomRange)(f.minScaleX,f.maxScaleX),(0,r.RandomRange)(f.minScaleY,f.maxScaleY))}function nq(q,f){const j=f._actualFrame/f.targetStopDuration;c.GetCurrentGradient(j,f._startSizeGradients,((j,d,g)=>{j!==f._currentStartSizeGradient&&(f._currentStartSize1=f._currentStartSize2,f._currentStartSize2=d.getFactor(),f._currentStartSizeGradient=j);const h=(0,r.Lerp)(f._currentStartSize1,f._currentStartSize2,g);q.scale.scaleInPlace(h)}))}function Uq(q,f){c.GetCurrentGradient(f._ratio,f._sizeGradients,((f,j,d)=>{f!==q._currentSizeGradient&&(q._currentSize1=q._currentSize2,q._currentSize2=j.getFactor(),q._currentSizeGradient=f),q.size=(0,r.Lerp)(q._currentSize1,q._currentSize2,d)}))}function Yq(q,f){q.remapData=new d.m(0,1,0,1)}function vq(q,f){f._colorRemapGradients&&f._colorRemapGradients.length>0&&c.GetCurrentGradient(f._ratio,f._colorRemapGradients,((f,j,d)=>{const g=(0,r.Lerp)(f.factor1,j.factor1,d),h=(0,r.Lerp)(f.factor2,j.factor2,d);q.remapData.x=g,q.remapData.y=h-g})),f._alphaRemapGradients&&f._alphaRemapGradients.length>0&&c.GetCurrentGradient(f._ratio,f._alphaRemapGradients,((f,j,d)=>{const g=(0,r.Lerp)(f.factor1,j.factor1,d),h=(0,r.Lerp)(f.factor2,j.factor2,d);q.remapData.z=g,q.remapData.w=h-g}))}function Fq(q,f){const j=(0,r.Clamp)(f._actualFrame/f.targetStopDuration);c.GetCurrentGradient(j,f._lifeTimeGradients,((f,d)=>{const g=f,h=d,L=g.getFactor(),Q=h.getFactor(),H=(j-g.gradient)/(h.gradient-g.gradient);q.lifeTime=(0,r.Lerp)(L,Q,H)})),f._emitPower=(0,r.RandomRange)(f.minEmitPower,f.maxEmitPower)}function Mq(q,f){q.lifeTime=(0,r.RandomRange)(f.minLifeTime,f.maxLifeTime),f._emitPower=(0,r.RandomRange)(f.minEmitPower,f.maxEmitPower)}function oq(q,f){0===f._emitPower?(q._initialDirection?q._initialDirection.H(q.direction):q._initialDirection=q.direction.clone(),q.direction.set(0,0,0)):(q._initialDirection=null,q.direction.scaleInPlace(f._emitPower)),q.direction.addInPlace(f._inheritedVelocityOffset)}function bq(q,f){q.angularSpeed=(0,r.RandomRange)(f.minAngularSpeed,f.maxAngularSpeed),q.angle=(0,r.RandomRange)(f.minInitialRotation,f.maxInitialRotation)}function xq(q,f){q._currentAngularSpeedGradient=f._angularSpeedGradients[0],q.angularSpeed=q._currentAngularSpeedGradient.getFactor(),q._currentAngularSpeed1=q.angularSpeed,f._angularSpeedGradients.length>1?q._currentAngularSpeed2=f._angularSpeedGradients[1].getFactor():q._currentAngularSpeed2=q._currentAngularSpeed1,q.angle=(0,r.RandomRange)(f.minInitialRotation,f.maxInitialRotation)}function Rq(q,f){q._initialStartSpriteCellId=f.startSpriteCellID,q._initialEndSpriteCellId=f.endSpriteCellID,q._initialSpriteCellLoop=f.spriteCellLoop}function Aq(q,f){q.previousItem=f.previousItem,q.nextItem=f,f.previousItem&&(f.previousItem.nextItem=q),f.previousItem=q}function kq(q,f){q.previousItem=f,q.nextItem=f.nextItem,f.nextItem&&(f.nextItem.previousItem=q),f.nextItem=q}function yq(q,f){let j=f;for(;j.nextItem;)j=j.nextItem;q.previousItem=j,q.nextItem=j.nextItem,j.nextItem=q}function pq(q){q.previousItem&&(q.previousItem.nextItem=q.nextItem),q.nextItem&&(q.nextItem.previousItem=q.previousItem)}class lq extends H{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(q){this._startDirectionFunction!==q&&(this._startDirectionFunction=q,this._directionProcessing.process=q?Xq:uq)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(q){this._startPositionFunction!==q&&(this._startPositionFunction=q,this._positionCreation.process=q?Nq:Oq)}set onDispose(q){this._onDisposeObserver&&this.qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.qd.add(q)}get B(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(q){this._useRampGradients!==q&&(this._useRampGradients=q,this._resetEffect(),q?(this._rampCreation={process:Yq,previousItem:null,nextItem:null},kq(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:vq,previousItem:null,nextItem:null},kq(this._remapGradientProcessing,this._gravityProcessing)):(pq(this._rampCreation),pq(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(q){this._isLocal!==q&&(this._isLocal=q,q?(this._isLocalCreation={process:wq,previousItem:null,nextItem:null},kq(this._isLocalCreation,this._positionCreation)):pq(this._isLocalCreation))}get particles(){return this.Iz}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q,q?(this._sheetCreation={process:Rq,previousItem:null,nextItem:null},kq(this._sheetCreation,this._colorCreation)):pq(this._sheetCreation),this._reset())}getActiveCount(){return this.Iz.length}getClassName(){return"Id"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var q;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[f])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[f]=new qq.e(this._engine),this._customWrappers[f].effect=q,this._customWrappers[f].drawContext&&(this._customWrappers[f].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new G.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){if(this.noiseTexture!==q){if(this._noiseTexture=q,!q)return pq(this._noiseCreation),void pq(this._noiseProcessing);this._noiseCreation={process:eq,previousItem:null,nextItem:null},kq(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Zq,previousItem:null,nextItem:null},kq(this._noiseProcessing,this._positionProcessing)}}constructor(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(q),this._emitterInverseWorldMatrix=d.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new d.j,this.qd=new G.d,this.onStoppedObservable=new G.d,this.onStartedObservable=new G.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Iz=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new L.e(0,0,0,0),this._colorDiff=new L.e(0,0,0,0),this._scaledDirection=d.j.Zero(),this._scaledGravity=d.j.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=q=>{},this.recycleParticle=q=>{const f=this.Iz.pop();f!==q&&f.copyTo(q),this._stockParticles.push(f)},this._createParticle=()=>{let q;return 0!==this._stockParticles.length?(q=this._stockParticles.pop(),q._reset()):q=new J(this),this._prepareParticle(q),q},this.paused=!1,this._shadersLoaded=!1,this._capacity=f,this._epsilon=Q,j&&"Scene"!==j.getClassName()?(this._engine=j,this.defaultProjectionMatrix=d.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=j||K.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ez.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Mq,previousItem:null,nextItem:null},this._positionCreation={process:Oq,previousItem:null,nextItem:null},kq(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:uq,previousItem:null,nextItem:null},kq(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:oq,previousItem:null,nextItem:null},kq(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Tq,previousItem:null,nextItem:null},kq(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:bq,previousItem:null,nextItem:null},kq(this._angleCreation,this._sizeCreation),this._colorCreation={process:gq,previousItem:null,nextItem:null},kq(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,H||(this._colorProcessing={process:Qq,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:rq,previousItem:null,nextItem:null},kq(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:tq,previousItem:null,nextItem:null},kq(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Eq,previousItem:null,nextItem:null},kq(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Iq,previousItem:null,nextItem:null},kq(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=h,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new qq.e(this._engine)},this._customWrappers[0].effect=g,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new X,this.updateFunction=q=>{var f;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(f=this.noiseTexture.getContent())||void 0===f||f.then((q=>{this._noiseTextureData=q})));const j=q===this.Iz;for(let d=0;d<q.length;d++){const f=q[d];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const g=f.age;if(f.age+=this._tempScaledUpdateSpeed,f.age>f.lifeTime){const q=f.age-g,j=f.lifeTime-g;this._tempScaledUpdateSpeed=j*this._tempScaledUpdateSpeed/q,f.age=f.lifeTime}this._ratio=f.age/f.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let h=this._updateQueueStart;for(;h;)h.process(f,this),h=h.nextItem;if(this._isAnimationSheetEnabled&&!H&&f.updateCellIndex(),f._inheritParticleInfoToSubEmitters(),f.age>=f.lifeTime){if(this._emitFromParticle(f),f._attachedSubEmitters){for(const q of f._attachedSubEmitters)q.particleSystem.disposeOnStop=!0,q.particleSystem.stop();f._attachedSubEmitters=null}this.recycleParticle(f),j&&d--}else;}}}serialize(q){throw new Error("Method not implemented.")}clone(q,f){throw new Error("Method not implemented.")}_addFactorGradient(q,f,j,d){const g=new C(f,j,d);q.push(g),q.sort(((q,f)=>q.gradient<f.gradient?-1:q.gradient>f.gradient?1:0))}_removeFactorGradient(q,f){if(!q)return;let j=0;for(const d of q){if(d.gradient===f){q.splice(j,1);break}j++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Fq:this._lifeTimeCreation.process=Mq}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:nq,previousItem:null,nextItem:null},kq(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(pq(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this.targetStopDuration!==q&&(this._targetStopDuration=q,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(q,f,j){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,q,f,j),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(q){return this._removeFactorGradient(this._lifeTimeGradients,q),this._syncLifeTimeCreation(),this}addSizeGradient(q,f,j){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Wq,this._sizeGradientProcessing={process:Uq,previousItem:null,nextItem:null},Aq(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,q,f,j),this}removeSizeGradient(q){var f;return this._removeFactorGradient(this._sizeGradients,q),0===(null===(f=this._sizeGradients)||void 0===f?void 0:f.length)&&(pq(this._sizeGradientProcessing),this._sizeCreation.process=Tq),this}addColorRemapGradient(q,f,j){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,q,f,j),this}removeColorRemapGradient(q){return this._removeFactorGradient(this._colorRemapGradients,q),this}addAlphaRemapGradient(q,f,j){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,q,f,j),this}removeAlphaRemapGradient(q){return this._removeFactorGradient(this._alphaRemapGradients,q),this}addAngularSpeedGradient(q,f,j){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=xq,this._angularSpeedGradientProcessing={process:Hq,previousItem:null,nextItem:null},Aq(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,q,f,j),this}removeAngularSpeedGradient(q){var f;return this._removeFactorGradient(this._angularSpeedGradients,q),0===(null===(f=this._angularSpeedGradients)||void 0===f?void 0:f.length)&&(this._angleCreation.process=bq,pq(this._angularSpeedGradientProcessing)),this}addVelocityGradient(q,f,j){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:zq,previousItem:null,nextItem:null},kq(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Dq,previousItem:null,nextItem:null},Aq(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,q,f,j),this}removeVelocityGradient(q){var f;return this._removeFactorGradient(this._velocityGradients,q),0===(null===(f=this._velocityGradients)||void 0===f?void 0:f.length)&&(pq(this._velocityCreation),pq(this._velocityGradientProcessing)),this}addLimitVelocityGradient(q,f,j){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Bq,previousItem:null,nextItem:null},kq(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:iq,previousItem:null,nextItem:null},kq(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,q,f,j),this}removeLimitVelocityGradient(q){var f;return this._removeFactorGradient(this._limitVelocityGradients,q),0===(null===(f=this._limitVelocityGradients)||void 0===f?void 0:f.length)&&(pq(this._limitVelocityCreation),pq(this._limitVelocityGradientProcessing)),this}addDragGradient(q,f,j){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:sq,previousItem:null,nextItem:null},Aq(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Sq,previousItem:null,nextItem:null},Aq(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,q,f,j),this}removeDragGradient(q){var f;return this._removeFactorGradient(this._dragGradients,q),0===(null===(f=this._dragGradients)||void 0===f?void 0:f.length)&&(pq(this._dragCreation),pq(this._dragGradientProcessing)),this}addEmitRateGradient(q,f,j){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,q,f,j),this}removeEmitRateGradient(q){return this._removeFactorGradient(this._emitRateGradients,q),this}addStartSizeGradient(q,f,j){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,q,f,j),this._syncStartSizeCreation(),this}removeStartSizeGradient(q){return this._removeFactorGradient(this._startSizeGradients,q),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const q=new Uint8Array(4*this._rawTextureWidth),f=L.i.o[0];for(let j=0;j<this._rawTextureWidth;j++){const d=j/this._rawTextureWidth;c.GetCurrentGradient(d,this._rampGradients,((d,g,h)=>{L.c.LerpToRef(d.color,g.color,h,f),q[4*j]=255*f.r,q[4*j+1]=255*f.g,q[4*j+2]=255*f.b,q[4*j+3]=255}))}this._rampGradientsTexture=m.c.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((q,f)=>q.gradient<f.gradient?-1:q.gradient>f.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(q,f){this._rampGradients||(this._rampGradients=[]);const j=new P(q,f);return this._rampGradients.push(j),this._syncRampGradientTexture(),this}removeRampGradient(q){return this._removeGradientAndTexture(q,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(q,f,j){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=hq,this._colorProcessing.process=Lq);const d=new a(q,f,j);return this._colorGradients.push(d),this._colorGradients.sort(((q,f)=>q.gradient<f.gradient?-1:q.gradient>f.gradient?1:0)),this}removeColorGradient(q){if(!this._colorGradients)return this;let f=0;for(const j of this._colorGradients){if(j.gradient===q){this._colorGradients.splice(f,1);break}f++}return 0===this._colorGradients.length&&(this._colorCreation.process=gq,this._colorProcessing.process=Qq),this}resetDrawCache(){if(this._drawWrappers){for(const q of this._drawWrappers)if(q)for(const f of q)null===f||void 0===f||f.dispose();this._drawWrappers=[]}}_fetchR(q,f,j,d,g){return g[4*(((q=.5*Math.abs(q)+.5)*j%j|0)+((f=.5*Math.abs(f)+.5)*d%d|0)*j)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const q=this._engine,f=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*f),this._vertexBuffer=new s.e(q,this._vertexData,!0,f);let j=0;const d=this._vertexBuffer.createVertexBuffer(s.i.PositionKind,j,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.i.PositionKind]=d,j+=3;const g=this._vertexBuffer.createVertexBuffer(s.i.ColorKind,j,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.i.ColorKind]=g,j+=4;const h=this._vertexBuffer.createVertexBuffer("angle",j,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=h,j+=1;const L=this._vertexBuffer.createVertexBuffer("size",j,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=L,j+=2,this._isAnimationSheetEnabled){const q=this._vertexBuffer.createVertexBuffer("cellIndex",j,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=q,j+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const q=this._vertexBuffer.createVertexBuffer("direction",j,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=q,j+=3}if(this._useRampGradients){const q=this._vertexBuffer.createVertexBuffer("remapData",j,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=q,j+=4}let Q;if(this._useInstancing){const f=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new s.e(q,f,!1,2),Q=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Q=this._vertexBuffer.createVertexBuffer("offset",j,2,this._vertexBufferSize,this._useInstancing),j+=2;this._vertexBuffers.offset=Q,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const q=[],f=[];let j=0;for(let d=0;d<this._capacity;d++)q.push(j),q.push(j+1),q.push(j+2),q.push(j),q.push(j+2),q.push(j+3),f.push(j,j+1,j+1,j+2,j+2,j+3,j+3,j,j,j+3),j+=4;this._indexBuffer=this._engine.createIndexBuffer(q),this._linesIndexBuffer=this._engine.createIndexBuffer(f)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(q)setTimeout((()=>{this.start(0)}),q);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var f;-1!==(null===(f=this.k)||void 0===f?void 0:f.getClassName().indexOf("Mesh"))&&this.k.Nf(!0);const q=this.noiseTexture;if(q&&q.onGeneratedObservable)q.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let f=0;f<this.preWarmCycles;f++)this.animate(!0),q.render()}))}));else for(let f=0;f<this.preWarmCycles;f++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(q))}_postStop(q){}reset(){this._stockParticles.length=0,this.Iz.length=0}_appendParticleVertex(q,f,j,g){let h=q*this._vertexBufferSize;if(this._vertexData[h++]=f.position.x+this.yr.x,this._vertexData[h++]=f.position.y+this.yr.y,this._vertexData[h++]=f.position.z+this.yr.z,this._vertexData[h++]=f.color.r,this._vertexData[h++]=f.color.g,this._vertexData[h++]=f.color.b,this._vertexData[h++]=f.color.a,this._vertexData[h++]=f.angle,this._vertexData[h++]=f.scale.x*f.size,this._vertexData[h++]=f.scale.y*f.size,this._isAnimationSheetEnabled&&(this._vertexData[h++]=f.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[h++]=f.direction.x,this._vertexData[h++]=f.direction.y,this._vertexData[h++]=f.direction.z);else if(f._initialDirection){let q=f._initialDirection;this.isLocal&&(d.j.TransformNormalToRef(q,this._emitterWorldMatrix,d.f.kf[0]),q=d.f.kf[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[h++]=q.x,this._vertexData[h++]=q.y,this._vertexData[h++]=q.z}else{let q=f.direction;this.isLocal&&(d.j.TransformNormalToRef(q,this._emitterWorldMatrix,d.f.kf[0]),q=d.f.kf[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[h++]=q.x,this._vertexData[h++]=q.y,this._vertexData[h++]=q.z}this._useRampGradients&&f.remapData&&(this._vertexData[h++]=f.remapData.x,this._vertexData[h++]=f.remapData.y,this._vertexData[h++]=f.remapData.z,this._vertexData[h++]=f.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===j?j=this._epsilon:1===j&&(j=1-this._epsilon),0===g?g=this._epsilon:1===g&&(g=1-this._epsilon)),this._vertexData[h++]=j,this._vertexData[h++]=g)}_prepareParticle(q){}_createNewOnes(q){let f;for(let j=0;j<q&&this.Iz.length!==this._capacity;j++){f=this._createParticle(),this.Iz.push(f);let q=this._createQueueStart;for(;q;)q.process(f,this),q=q.nextItem;f._inheritParticleInfoToSubEmitters()}}_update(q){if(this._alive=this.Iz.length>0,this.k.position){const q=this.k;this._emitterWorldMatrix=q.getWorldMatrix()}else{const q=this.k;this._emitterWorldMatrix=d.b.Translation(q.x,q.y,q.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Iz),this._createNewOnes(q)}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=[s.i.PositionKind,s.i.ColorKind,"angle","offset","size"];return q&&d.push("cellIndex"),f||d.push("direction"),j&&d.push("remapData"),d}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,fq.c)(d),q&&d.push("particlesInfos"),f&&d.push("logarithmicDepthConstant"),j&&(d.push("vFogInfos"),d.push("vFogColor")),d}fillDefines(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,fq.k)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&q.push("#define FOG")),this._isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),f===H.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&q.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case 2:q.push("#define BILLBOARDY");break;case 8:case 9:q.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&q.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:q.push("#define BILLBOARDMODE_ALL")}j&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,f,j){f.push(...lq._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),q.push(...lq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),j.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,dq.f)(q,this._imageProcessingConfigurationDefines),(0,dq.c)(j,this._imageProcessingConfigurationDefines))}_getWrapper(q){const f=this._getCustomDrawWrapper(q);if(null!==f&&void 0!==f&&f.effect)return f;const j=[];this.fillDefines(j,q);const d=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let g=this._drawWrappers[d];g||(g=this._drawWrappers[d]=[]);let h=g[q];h||(h=new qq.e(this._engine),h.drawContext&&(h.drawContext.useInstancing=this._useInstancing),g[q]=h);const L=j.join("\n");if(h.defines!==L){const q=[],f=[],j=[];this.fillUniformsAttributesAndSamplerNames(f,q,j),h.setEffect(this._engine.createEffect("particles",q,f,j,L,void 0,void 0,void 0,void 0,this._shaderLanguage),L)}return h}animate(){var q;let f,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!j&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(j?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this.manualEmitCount>-1)f=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let q=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const f=this._actualFrame/this.targetStopDuration;c.GetCurrentGradient(f,this._emitRateGradients,((f,j,d)=>{f!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=j.getFactor(),this._currentEmitRateGradient=f),q=(0,r.Lerp)(this._currentEmitRate1,this._currentEmitRate2,d)}))}f=q*this._scaledUpdateSpeed|0,this._newPartsExcess+=q*this._scaledUpdateSpeed-f}if(this._newPartsExcess>1&&(f+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?f=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(f),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!j){let q=0;for(let f=0;f<this.Iz.length;f++){const j=this.Iz[f];this._appendParticleVertices(q,j),q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Iz.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(q,f){this._appendParticleVertex(q++,f,0,0),this._useInstancing||(this._appendParticleVertex(q++,f,1,0),this._appendParticleVertex(q++,f,1,1),this._appendParticleVertex(q++,f,0,1))}rebuild(){var q;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(q=this._spriteBuffer)||void 0===q||q._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!lq.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(j.bind(j,12481)),Promise.resolve().then(j.bind(j,12432))])):await Promise.all([Promise.resolve().then(j.bind(j,12420)),Promise.resolve().then(j.bind(j,12413))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==H.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(H.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(H.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(q){const f=this._getWrapper(q),j=f.effect,g=this._engine;g.enableEffect(f);const h=this.defaultViewMatrix??this._scene.getViewMatrix();if(j.setTexture("diffuseSampler",this.particleTexture),j.setMatrix("view",h),j.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();j.setFloat3("particlesInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,this.spriteCellWidth/q.width)}if(j.setVector2("translationPivot",this.translationPivot),j.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;j.setVector3("eyePosition",q.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),j.setTexture("rampSampler",this._rampGradientsTexture));const L=j.defines;var Q,H,r,u,X,z;(this._scene&&((0,fq.f)(j,this,this._scene),this.applyFog&&(0,jq.d)(this._scene,void 0,j)),L.indexOf("#define BILLBOARDMODE_ALL")>=0&&(h.invertToRef(d.f.Matrix[0]),j.setMatrix("invView",d.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?g.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,j):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,j)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?g.bindBuffers(this._vertexBuffers,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBuffer:this._indexBuffer,j):g.bindBuffers(this._vertexBuffers,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null,j);(this.useLogarithmicDepth&&this._scene&&(0,jq.i)(L,j,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(j),this._setEngineBasedOnBlendMode(q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(j),this._useInstancing)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?g.drawElementsType(6,0,10,this.Iz.length):g.drawArraysType(7,0,4,this.Iz.length):null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?g.drawElementsType(1,0,10*this.Iz.length):g.drawElementsType(0,0,6*this.Iz.length);return this.Iz.length}render(){if(!this.isReady()||!this.Iz.length)return 0;const q=this._engine;q.setState&&(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0));let f=0;return f=this.blendMode===H.BLENDMODE_MULTIPLYADD?this._render(H.BLENDMODE_MULTIPLY)+this._render(H.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),f}_onDispose(){}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(f,j),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const q=this._scene.ez.indexOf(this);q>-1&&this._scene.ez.splice(q,1),this._scene._activeParticleSystems.dispose()}this.qd.notifyObservers(this),this.qd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}lq.ForceGLSL=!1;var Vq,aq=j(11016);!function(q){q[q.ATTACHED=0]="ATTACHED",q[q.END=1]="END"}(Vq||(Vq={}));class Pq{constructor(q){if(this.particleSystem=q,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!q.k||!q.k.dispose){const f=(0,Q.c)("BABYLON.AbstractMesh");q.k=new f("SubemitterSystemEmitter",q.eq()),q._disposeEmitterOnDispose=!0}}clone(){let q=this.particleSystem.k;if(q){if(q instanceof d.j)q=q.clone();else if(-1!==q.getClassName().indexOf("Mesh")){q=new((0,Q.c)("BABYLON.Mesh"))("",q.eq()),q.isVisible=!1}}else q=new d.j;const f=new Pq(this.particleSystem.clone(this.particleSystem.name,q));return f.particleSystem.name+="Clone",f.type=this.type,f.inheritDirection=this.inheritDirection,f.inheritedVelocityAmount=this.inheritedVelocityAmount,f.particleSystem._disposeEmitterOnDispose=!0,f.particleSystem.disposeOnStop=!0,f}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};return f.type=this.type,f.inheritDirection=this.inheritDirection,f.inheritedVelocityAmount=this.inheritedVelocityAmount,f.particleSystem=this.particleSystem.serialize(q),f}static _ParseParticleSystem(q,f,j){throw(0,aq.c)("ParseParticle")}static Parse(q,f,j){const d=q.particleSystem,g=new Pq(Pq._ParseParticleSystem(d,f,j,!0));return g.type=q.type,g.inheritDirection=q.inheritDirection,g.inheritedVelocityAmount=q.inheritedVelocityAmount,g.particleSystem._isSubEmitter=!0,g}dispose(){this.particleSystem.dispose()}}var Cq=j(11065);function cq(q,f){const j=new O;return j.direction1=q,j.direction2=f,j}function Gq(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function mq(){return new N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Kq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.j(0,1,0),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0);return new w(q,f,j)}function Jq(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function qf(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.j(0,1,0);return new i(q,f,j,g,h)}function ff(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new z(q,f)}function jf(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0);return new B(q,f,j,g)}const df=d.j.Zero(),gf=d.j.Zero(),hf=d.j.Zero();class Lf{constructor(){this.strength=0,this.position=d.j.Zero()}_processParticle(q,f){this.position.subtractToRef(q.position,df);const j=df.lengthSquared()+1;df.normalize().scaleToRef(this.strength/j,gf),gf.scaleToRef(f._tempScaledUpdateSpeed,hf),q.direction.addInPlace(hf)}serialize(){return{position:this.position.Yf(),strength:this.strength}}}class Qf extends lq{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=q=>{if(!this._subEmitters||0===this._subEmitters.length)return;const f=Math.floor(Math.random()*this._subEmitters.length);for(const j of this._subEmitters[f])if(1===j.type){const f=j.clone();q._inheritParticleInfoToSubEmitter(f),f.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(f.particleSystem),f.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(q,f){const j=cq(q,f);return this.particleEmitterType=j,j}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q,this._flowMapUpdate&&(pq(this._flowMapUpdate),this._flowMapUpdate=null),q&&(this._flowMapUpdate={process:q=>{var f;const j=null===(f=this.eq())||void 0===f?void 0:f.getTransformMatrix();this._flowMap._processParticle(q,this.flowMapStrength*this._tempScaledUpdateSpeed,j)},previousItem:null,nextItem:null},kq(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(q){this._attractors.push(q),1===this._attractors.length&&(this._attractorUpdate={process:q=>{for(const f of this._attractors)f._processParticle(q,this)},previousItem:null,nextItem:null},kq(this._attractorUpdate,this._directionProcessing))}removeAttractor(q){const f=this._attractors.indexOf(q);-1!==f&&this._attractors.splice(f,1),0===this._attractors.length&&pq(this._attractorUpdate)}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(q)}createHemisphericEmitter(){const q=Gq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=mq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Kq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=Jq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.j(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=ff(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=jf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,f,j,d){const g=new X;return this.particleEmitterType=g,this.direction1=q,this.direction2=f,this.minEmitBox=j,this.maxEmitBox=d,g}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const q of this.subEmitters)q instanceof Qf?this._subEmitters.push([new Pq(q)]):q instanceof Pq?this._subEmitters.push([q]):q instanceof Array&&this._subEmitters.push(q)}_stopSubEmitters(){if(this.activeSubSystems){for(const q of this.activeSubSystems)q.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const q=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==q&&this._rootParticleSystem.activeSubSystems.splice(q,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(q){q&&this._stopSubEmitters()}_prepareParticle(q){if(this._subEmitters&&this._subEmitters.length>0){const f=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];q._attachedSubEmitters=[];for(const j of f)if(0===j.type){const f=j.clone();q._attachedSubEmitters.push(f),f.particleSystem.start()}}}_onDispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),q&&this.particles)for(const j of this.particles)if(j._attachedSubEmitters)for(let q=j._attachedSubEmitters.length-1;q>=0;q-=1)j._attachedSubEmitters[q].dispose();if(f&&this.activeSubSystems)for(let j=this.activeSubSystems.length-1;j>=0;j-=1)this.activeSubSystems[j].dispose();if(this._subEmitters&&this._subEmitters.length){for(let q=0;q<this._subEmitters.length;q++)for(const f of this._subEmitters[q])f.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(q,f,j,g){let h;h=j instanceof Cq.b?null:j;const H=(0,Q.c)("BABYLON.Texture");if(H&&h&&(q.texture?f.particleTexture=H.Parse(q.texture,h,g):q.textureName&&(f.particleTexture=new H(g+q.textureName,h,!1,void 0===q.invertY||q.invertY),f.particleTexture.name=q.textureName)),q.emitterId||0===q.emitterId||void 0!==q.k?q.emitterId&&h?f.k=h.getLastMeshById(q.emitterId):f.k=d.j.Pf(q.k):f.k=d.j.Zero(),f.isLocal=!!q.isLocal,void 0!==q.renderingGroupId&&(f.renderingGroupId=q.renderingGroupId),void 0!==q.isBillboardBased&&(f.isBillboardBased=q.isBillboardBased),void 0!==q.billboardMode&&(f.billboardMode=q.billboardMode),void 0!==q.useLogarithmicDepth&&(f.useLogarithmicDepth=q.useLogarithmicDepth),q.animations){for(let j=0;j<q.animations.length;j++){const d=q.animations[j],g=(0,Q.c)("BABYLON.Animation");g&&f.animations.push(g.Parse(d))}f.beginAnimationOnStart=q.beginAnimationOnStart,f.beginAnimationFrom=q.beginAnimationFrom,f.beginAnimationTo=q.beginAnimationTo,f.beginAnimationLoop=q.beginAnimationLoop}if(q.autoAnimate&&h&&h.beginAnimation(f,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),f.startDelay=0|q.startDelay,f.minAngularSpeed=q.minAngularSpeed,f.maxAngularSpeed=q.maxAngularSpeed,f.minSize=q.minSize,f.maxSize=q.maxSize,q.minScaleX&&(f.minScaleX=q.minScaleX,f.maxScaleX=q.maxScaleX,f.minScaleY=q.minScaleY,f.maxScaleY=q.maxScaleY),void 0!==q.preWarmCycles&&(f.preWarmCycles=q.preWarmCycles,f.preWarmStepOffset=q.preWarmStepOffset),void 0!==q.minInitialRotation&&(f.minInitialRotation=q.minInitialRotation,f.maxInitialRotation=q.maxInitialRotation),f.minLifeTime=q.minLifeTime,f.maxLifeTime=q.maxLifeTime,f.minEmitPower=q.minEmitPower,f.maxEmitPower=q.maxEmitPower,f.emitRate=q.emitRate,f.gravity=d.j.Pf(q.gravity),q.noiseStrength&&(f.noiseStrength=d.j.Pf(q.noiseStrength)),f.color1=L.e.Pf(q.color1),f.color2=L.e.Pf(q.color2),f.colorDead=L.e.Pf(q.colorDead),f.updateSpeed=q.updateSpeed,f.targetStopDuration=q.targetStopDuration,f.blendMode=q.blendMode,q.colorGradients)for(const d of q.colorGradients)f.addColorGradient(d.gradient,L.e.Pf(d.color1),d.color2?L.e.Pf(d.color2):void 0);if(q.rampGradients){for(const j of q.rampGradients)f.addRampGradient(j.gradient,L.c.Pf(j.color));f.useRampGradients=q.useRampGradients}if(q.colorRemapGradients)for(const d of q.colorRemapGradients)f.addColorRemapGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.alphaRemapGradients)for(const d of q.alphaRemapGradients)f.addAlphaRemapGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.sizeGradients)for(const d of q.sizeGradients)f.addSizeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.angularSpeedGradients)for(const d of q.angularSpeedGradients)f.addAngularSpeedGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.velocityGradients)for(const d of q.velocityGradients)f.addVelocityGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.dragGradients)for(const d of q.dragGradients)f.addDragGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.emitRateGradients)for(const d of q.emitRateGradients)f.addEmitRateGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.startSizeGradients)for(const d of q.startSizeGradients)f.addStartSizeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.lifeTimeGradients)for(const d of q.lifeTimeGradients)f.addLifeTimeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(q.limitVelocityGradients){for(const j of q.limitVelocityGradients)f.addLimitVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);f.limitVelocityDamping=q.limitVelocityDamping}if(q.noiseTexture&&h){const j=(0,Q.c)("BABYLON.ProceduralTexture");f.noiseTexture=j.Parse(q.noiseTexture,h,g)}let r;if(q.particleEmitterType){switch(q.particleEmitterType.type){case"SphereParticleEmitter":r=new N;break;case"SphereDirectedParticleEmitter":r=new w;break;case"ConeEmitter":case"ConeParticleEmitter":r=new z;break;case"ConeDirectedParticleEmitter":r=new B;break;case"CylinderParticleEmitter":r=new D;break;case"CylinderDirectedParticleEmitter":r=new i;break;case"HemisphericParticleEmitter":r=new t;break;case"PointParticleEmitter":r=new O;break;case"MeshParticleEmitter":r=new S;break;case"CustomParticleEmitter":r=new E;break;default:r=new X}r.parse(q.particleEmitterType,h)}else r=new X,r.parse(q,h);f.particleEmitterType=r,f.startSpriteCellID=q.startSpriteCellID,f.endSpriteCellID=q.endSpriteCellID,f.spriteCellLoop=q.spriteCellLoop??!0,f.spriteCellWidth=q.spriteCellWidth,f.spriteCellHeight=q.spriteCellHeight,f.spriteCellChangeSpeed=q.spriteCellChangeSpeed,f.spriteRandomStartCell=q.spriteRandomStartCell,f.disposeOnStop=q.disposeOnStop??!1,f.manualEmitCount=q.manualEmitCount??-1}static Parse(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const Q=q.name;let H,r,u=null,X=null;if(f instanceof Cq.b?H=f:(r=f,H=r.getEngine()),q.customShader&&H.createEffectForParticles){X=q.customShader;const f=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";u=H.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,f)}const z=new Qf(Q,h||q.Zf,f,u,q.isAnimationSheetEnabled);if(z.customShader=X,z._rootUrl=j,q.id&&(z.id=q.id),q.subEmitters){z.subEmitters=[];for(const d of q.subEmitters){const q=[];for(const g of d)q.push(Pq.Parse(g,f,j));z.subEmitters.push(q)}}if(q.attractors)for(const L of q.attractors){const q=new Lf;q.position=d.j.Pf(L.position),q.strength=L.strength,z.addAttractor(q)}return Qf._Parse(q,z,f,j),q.textureMask&&(z.textureMask=L.e.Pf(q.textureMask)),q.yr&&(z.yr=d.j.Pf(q.yr)),q.preventAutoStart&&(z.preventAutoStart=q.preventAutoStart),g||z.preventAutoStart||z.start(),z}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};if(Qf._Serialize(f,this,q),f.textureMask=this.textureMask.Yf(),f.customShader=this.customShader,f.preventAutoStart=this.preventAutoStart,f.yr=this.yr.Yf(),this.subEmitters){f.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const j of this._subEmitters){const d=[];for(const f of j)d.push(f.serialize(q));f.subEmitters.push(d)}}if(this._attractors&&this._attractors.length){f.attractors=[];for(const q of this._attractors)f.attractors.push(q.serialize())}return f}static _Serialize(q,f,j){if(q.name=f.name,q.id=f.id,q.Zf=f.getCapacity(),q.disposeOnStop=f.disposeOnStop,q.manualEmitCount=f.manualEmitCount,f.k.position){const j=f.k;q.emitterId=j.id}else{const j=f.k;q.k=j.Yf()}f.particleEmitterType&&(q.particleEmitterType=f.particleEmitterType.serialize()),f.particleTexture&&(j?q.texture=f.particleTexture.serialize():(q.textureName=f.particleTexture.name,q.invertY=!!f.particleTexture._invertY)),q.isLocal=f.isLocal,F.d.AppendSerializedAnimations(f,q),q.beginAnimationOnStart=f.beginAnimationOnStart,q.beginAnimationFrom=f.beginAnimationFrom,q.beginAnimationTo=f.beginAnimationTo,q.beginAnimationLoop=f.beginAnimationLoop,q.startDelay=f.startDelay,q.renderingGroupId=f.renderingGroupId,q.isBillboardBased=f.isBillboardBased,q.billboardMode=f.billboardMode,q.minAngularSpeed=f.minAngularSpeed,q.maxAngularSpeed=f.maxAngularSpeed,q.minSize=f.minSize,q.maxSize=f.maxSize,q.minScaleX=f.minScaleX,q.maxScaleX=f.maxScaleX,q.minScaleY=f.minScaleY,q.maxScaleY=f.maxScaleY,q.minEmitPower=f.minEmitPower,q.maxEmitPower=f.maxEmitPower,q.minLifeTime=f.minLifeTime,q.maxLifeTime=f.maxLifeTime,q.emitRate=f.emitRate,q.gravity=f.gravity.Yf(),q.noiseStrength=f.noiseStrength.Yf(),q.color1=f.color1.Yf(),q.color2=f.color2.Yf(),q.colorDead=f.colorDead.Yf(),q.updateSpeed=f.updateSpeed,q.targetStopDuration=f.targetStopDuration,q.blendMode=f.blendMode,q.preWarmCycles=f.preWarmCycles,q.preWarmStepOffset=f.preWarmStepOffset,q.minInitialRotation=f.minInitialRotation,q.maxInitialRotation=f.maxInitialRotation,q.startSpriteCellID=f.startSpriteCellID,q.spriteCellLoop=f.spriteCellLoop,q.endSpriteCellID=f.endSpriteCellID,q.spriteCellChangeSpeed=f.spriteCellChangeSpeed,q.spriteCellWidth=f.spriteCellWidth,q.spriteCellHeight=f.spriteCellHeight,q.spriteRandomStartCell=f.spriteRandomStartCell,q.isAnimationSheetEnabled=f.isAnimationSheetEnabled,q.useLogarithmicDepth=f.useLogarithmicDepth;const d=f.getColorGradients();if(d){q.colorGradients=[];for(const f of d){const j={gradient:f.gradient,color1:f.color1.Yf()};f.color2?j.color2=f.color2.Yf():j.color2=f.color1.Yf(),q.colorGradients.push(j)}}const g=f.getRampGradients();if(g){q.rampGradients=[];for(const f of g){const j={gradient:f.gradient,color:f.color.Yf()};q.rampGradients.push(j)}q.useRampGradients=f.useRampGradients}const h=f.getColorRemapGradients();if(h){q.colorRemapGradients=[];for(const f of h){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.colorRemapGradients.push(j)}}const L=f.getAlphaRemapGradients();if(L){q.alphaRemapGradients=[];for(const f of L){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.alphaRemapGradients.push(j)}}const Q=f.getSizeGradients();if(Q){q.sizeGradients=[];for(const f of Q){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.sizeGradients.push(j)}}const H=f.getAngularSpeedGradients();if(H){q.angularSpeedGradients=[];for(const f of H){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.angularSpeedGradients.push(j)}}const r=f.getVelocityGradients();if(r){q.velocityGradients=[];for(const f of r){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.velocityGradients.push(j)}}const u=f.getDragGradients();if(u){q.dragGradients=[];for(const f of u){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.dragGradients.push(j)}}const X=f.getEmitRateGradients();if(X){q.emitRateGradients=[];for(const f of X){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.emitRateGradients.push(j)}}const z=f.getStartSizeGradients();if(z){q.startSizeGradients=[];for(const f of z){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.startSizeGradients.push(j)}}const B=f.getLifeTimeGradients();if(B){q.lifeTimeGradients=[];for(const f of B){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.lifeTimeGradients.push(j)}}const D=f.getLimitVelocityGradients();if(D){q.limitVelocityGradients=[];for(const f of D){const j={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?j.factor2=f.factor2:j.factor2=f.factor1,q.limitVelocityGradients.push(j)}q.limitVelocityDamping=f.limitVelocityDamping}f.noiseTexture&&(q.noiseTexture=f.noiseTexture.serialize())}clone(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d={...this._customWrappers};let g=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){g=this.customShader;const q=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"",f=h.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,q);d[0]?d[0].effect=f:this.setCustomEffect(f,0)}const L=this.serialize(j),Q=Qf.Parse(L,this._scene||this._engine,this._rootUrl);return Q.name=q,Q.customShader=g,Q._customWrappers=d,void 0===f&&(f=this.k),this.noiseTexture&&(Q.noiseTexture=this.noiseTexture.clone()),Q.k=f,this.preventAutoStart||Q.start(),Q}}Qf.BILLBOARDMODE_Y=2,Qf.BILLBOARDMODE_ALL=7,Qf.BILLBOARDMODE_STRETCHED=8,Qf.BILLBOARDMODE_STRETCHED_LOCAL=9,Pq._ParseParticleSystem=Qf.Parse;var Hf=j(11515),rf=j(11506),uf=j(11331);uf.d.prototype.createTransformFeedback=function(){const q=this._gl.createTransformFeedback();if(!q)throw new Error("Unable to create Transform Feedback");return q},uf.d.prototype.deleteTransformFeedback=function(q){this._gl.deleteTransformFeedback(q)},uf.d.prototype.bindTransformFeedback=function(q){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,q)},uf.d.prototype.beginTransformFeedback=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(q?this._gl.POINTS:this._gl.TRIANGLES)},uf.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},uf.d.prototype.setTranformFeedbackVaryings=function(q,f){this._gl.transformFeedbackVaryings(q,f,this._gl.INTERLEAVED_ATTRIBS)},uf.d.prototype.bindTransformFeedbackBuffer=function(q){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q?q.underlyingResource:null)},uf.d.prototype.readTransformFeedbackBuffer=function(q){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q)};const Xf="clipPlaneFragmentDeclaration2",zf="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Z.b.IncludesShadersStore[Xf]||(Z.b.IncludesShadersStore[Xf]=zf);j(12336),j(12340),j(12346),j(12348),j(12356),j(12358),j(12361),j(12363);const Bf="gpuRenderParticlesPixelShader",Df="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Z.b.ShadersStore[Bf]||(Z.b.ShadersStore[Bf]=Df);const tf="clipPlaneVertexDeclaration2",Of="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Z.b.IncludesShadersStore[tf]||(Z.b.IncludesShadersStore[tf]=Of);j(12371),j(12373),j(12376),j(12378);const Nf="gpuRenderParticlesVertexShader",wf="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Z.b.ShadersStore[Nf]||(Z.b.ShadersStore[Nf]=wf);class Ef extends H{static get IsSupported(){if(!K.d.LastCreatedEngine)return!1;const q=K.d.LastCreatedEngine.getCaps();return q.supportTransformFeedbacks||q.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(q){this._maxActiveParticleCount=Math.min(q,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(q){this.maxActiveParticleCount=q}createPointEmitter(q,f){const j=cq(q,f);return this.particleEmitterType=j,j}createHemisphericEmitter(){const q=Gq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=mq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Kq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=Jq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.j(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=ff(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=jf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.j(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,f,j,d){const g=new X;return this.particleEmitterType=g,this.direction1=q,this.direction2=f,this.minEmitBox=j,this.maxEmitBox=d,g}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Qf.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Qf.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Qf.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";q?setTimeout((()=>{this.start(0)}),q):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var q;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[f])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[f]=new qq.e(this._engine),this._customWrappers[f].effect=q}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new G.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(q,f,j){return super._removeGradientAndTexture(q,f,j),this._releaseBuffers(),this}addColorGradient(q,f){this._colorGradients||(this._colorGradients=[]);const j=new a(q,f);return this._colorGradients.push(j),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(q&&this._colorGradients.sort(((q,f)=>q.gradient<f.gradient?-1:q.gradient>f.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(q){return this._removeGradientAndTexture(q,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const f in this._drawWrappers){var q;null===(q=this._drawWrappers[f].drawContext)||void 0===q||q.reset()}}_addFactorGradient(q,f,j){const d=new C(f,j);q.push(d),this._releaseBuffers()}addSizeGradient(q,f){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,q,f),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(q){return this._removeGradientAndTexture(q,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(q,f){if(!q)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&q.sort(((q,f)=>q.gradient<f.gradient?-1:q.gradient>f.gradient?1:0));const j=this;j[f]&&(j[f].dispose(),j[f]=null)}addAngularSpeedGradient(q,f){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,q,f),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(q){return this._removeGradientAndTexture(q,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(q,f){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,q,f),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(q){return this._removeGradientAndTexture(q,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(q,f){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,q,f),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(q){return this._removeGradientAndTexture(q,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(q,f){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,q,f),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(q){return this._removeGradientAndTexture(q,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(q){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(q),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.qd=new G.d,this.onStoppedObservable=new G.d,this.onStartedObservable=new G.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,j&&"Scene"!==j.getClassName()?(this._engine=j,this.defaultProjectionMatrix=d.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=j||K.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ez.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,Q.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Q.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,Q.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Q.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new qq.e(this._engine)},this._customWrappers[0].effect=g,this._drawWrappers={0:new qq.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(f=f??{}).randomTextureSize||delete f.randomTextureSize;const L={Zf:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...f},H=f;isFinite(H)&&(L.Zf=H),this._capacity=L.Zf,this._maxActiveParticleCount=L.Zf,this._currentActiveCount=0,this._isAnimationSheetEnabled=h,this.particleEmitterType=new X;const r=Math.min(this._engine.getCaps().maxTextureSize,L.randomTextureSize);let u=[];for(let d=0;d<r;++d)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture=new m.c(new Float32Array(u),r,1,5,j,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,u=[];for(let d=0;d<r;++d)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture2=new m.c(new Float32Array(u),r,1,5,j,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=r}_reset(){this._releaseBuffers()}_createVertexBuffers(q,f,j){const d={};d.position=f.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let g=3;d.age=f.createVertexBuffer("age",g,1,this._attributesStrideSize,!0),g+=1,d.size=f.createVertexBuffer("size",g,3,this._attributesStrideSize,!0),g+=3,d.life=f.createVertexBuffer("life",g,1,this._attributesStrideSize,!0),g+=1,g+=4,this.billboardMode===Qf.BILLBOARDMODE_STRETCHED&&(d.direction=f.createVertexBuffer("direction",g,3,this._attributesStrideSize,!0)),g+=3,this._platform.alignDataInBuffer&&(g+=1),this.particleEmitterType instanceof E&&(g+=3,this._platform.alignDataInBuffer&&(g+=1)),this._colorGradientsTexture||(d.color=f.createVertexBuffer("color",g,4,this._attributesStrideSize,!0),g+=4),this._isBillboardBased||(d.initialDirection=f.createVertexBuffer("initialDirection",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1)),this.noiseTexture&&(d.noiseCoordinates1=f.createVertexBuffer("noiseCoordinates1",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1),d.noiseCoordinates2=f.createVertexBuffer("noiseCoordinates2",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1)),d.angle=f.createVertexBuffer("angle",g,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?g++:g+=2,this._isAnimationSheetEnabled&&(d.cellIndex=f.createVertexBuffer("cellIndex",g,1,this._attributesStrideSize,!0),g+=1,this.spriteRandomStartCell&&(d.cellStartOffset=f.createVertexBuffer("cellStartOffset",g,1,this._attributesStrideSize,!0),g+=1)),d.offset=j.createVertexBuffer("offset",0,2),d.uv=j.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(d),this._platform.createVertexBuffers(q,d),this.resetDrawCache()}_initialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!q)return;const f=this._engine,j=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const g=this.particleEmitterType instanceof E,h=d.f.kf[0];let L=0;for(let d=0;d<this._capacity;d++)if(j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),g?(this.particleEmitterType.particleDestinationGenerator(d,null,h),j.push(h.x),j.push(h.y),j.push(h.z)):(j.push(0),j.push(0),j.push(0)),this._platform.alignDataInBuffer&&j.push(0),L+=16,g&&(this.particleEmitterType.particlePositionGenerator(d,null,h),j.push(h.x),j.push(h.y),j.push(h.z),this._platform.alignDataInBuffer&&j.push(0),L+=4),this._colorGradientsTexture||(j.push(0),j.push(0),j.push(0),j.push(0),L+=4),this.isBillboardBased||(j.push(0),j.push(0),j.push(0),this._platform.alignDataInBuffer&&j.push(0),L+=4),this.noiseTexture&&(j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),L+=8),j.push(0),L+=1,this._angularSpeedGradientsTexture||(j.push(0),L+=1),this._isAnimationSheetEnabled&&(j.push(0),L+=1,this.spriteRandomStartCell&&(j.push(0),L+=1)),this._platform.alignDataInBuffer){let q=3-(L+3&3);for(L+=q;q-- >0;)j.push(0)}const Q=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),H=this._platform.createParticleBuffer(j),r=this._platform.createParticleBuffer(j);this._buffer0=new s.e(f,H,!1,this._attributesStrideSize),this._buffer1=new s.e(f,r,!1,this._attributesStrideSize),this._spriteBuffer=new s.e(f,Q,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let q=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(q+="\n#define BILLBOARD"),this._colorGradientsTexture&&(q+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(q+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(q+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(q+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(q+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(q+="\n#define DRAGGRADIENTS"),this._flowMap&&(q+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(q+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(q+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(q+="\n#define NOISE"),this.isLocal&&(q+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===q||(this._cachedUpdateDefines=q,this._updateBuffer=this._platform.createUpdateBuffer(q)),this._platform.isUpdateBufferReady()}_getWrapper(q){const f=this._getCustomDrawWrapper(q);if(null!==f&&void 0!==f&&f.effect)return f;const j=[];this.fillDefines(j,q);let d=this._drawWrappers[q];d||(d=new qq.e(this._engine),d.drawContext&&(d.drawContext.useInstancing=!0),this._drawWrappers[q]=d);const g=j.join("\n");if(d.defines!==g){const q=[],f=[],j=[];this.fillUniformsAttributesAndSamplerNames(f,q,j),d.setEffect(this._engine.createEffect("gpuRenderParticles",q,f,j,g),g)}return d}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=[s.i.PositionKind,"age","life","size","angle"];return q||g.push(s.i.ColorKind),f&&g.push("cellIndex"),j||g.push("initialDirection"),d&&g.push("direction"),g.push("offset",s.i.UVKind),g}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=["emitterWM","yr","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,fq.c)(d),q&&d.push("sheetInfos"),f&&d.push("logarithmicDepthConstant"),j&&(d.push("vFogInfos"),d.push("vFogColor")),d}fillDefines(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,fq.k)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==rf.b.FOGMODE_NONE&&q.push("#define FOG")),f===Qf.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this.isLocal&&q.push("#define LOCAL"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case Qf.BILLBOARDMODE_Y:q.push("#define BILLBOARDY");break;case Qf.BILLBOARDMODE_STRETCHED:q.push("#define BILLBOARDSTRETCHED");break;case Qf.BILLBOARDMODE_ALL:q.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&q.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),j&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,f,j){f.push(...Ef._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Qf.BILLBOARDMODE_STRETCHED)),q.push(...Ef._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),j.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Hf.c.PrepareUniforms(q,this._imageProcessingConfigurationDefines),Hf.c.PrepareSamplers(j,this._imageProcessingConfigurationDefines))}animate(){var q;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(f?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(q,f){const j=this[f];if(!q||!q.length||j)return;const d=new Float32Array(this._rawTextureWidth);for(let g=0;g<this._rawTextureWidth;g++){const f=g/this._rawTextureWidth;c.GetCurrentGradient(f,q,((q,f,j)=>{d[g]=(0,r.Lerp)(q.factor1,f.factor1,j)}))}this[f]=m.c.CreateRTexture(d,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[f].name=f.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const q=new Uint8Array(4*this._rawTextureWidth),f=L.i.wd[0];for(let j=0;j<this._rawTextureWidth;j++){const d=j/this._rawTextureWidth;c.GetCurrentGradient(d,this._colorGradients,((d,g,h)=>{L.e.LerpToRef(d.color1,g.color1,h,f),q[4*j]=255*f.r,q[4*j+1]=255*f.g,q[4*j+2]=255*f.b,q[4*j+3]=255*f.a}))}this._colorGradientsTexture=m.c.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(q,f){var j,g,h,L;const Q=this._getWrapper(q),H=Q.effect;this._engine.enableEffect(Q);const r=(null===(j=this._scene)||void 0===j?void 0:j.getViewMatrix())||d.b.IdentityReadOnly;if(H.setMatrix("view",r),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),H.setTexture("diffuseSampler",this.particleTexture),H.setVector2("translationPivot",this.translationPivot),H.setVector3("yr",this.yr),this.isLocal&&H.setMatrix("emitterWM",f),this._colorGradientsTexture?H.setTexture("colorGradientSampler",this._colorGradientsTexture):H.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();H.setFloat3("sheetInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,q.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;H.setVector3("eyePosition",q.globalPosition)}const u=H.defines;if(this._scene&&((0,fq.f)(H,this,this._scene),this.applyFog&&(0,jq.d)(this._scene,void 0,H)),u.indexOf("#define BILLBOARDMODE_ALL")>=0){const q=r.clone();q.invert(),H.setMatrix("invView",q)}return this.useLogarithmicDepth&&this._scene&&(0,jq.i)(u,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(q),this._platform.bindDrawBuffers(this._targetIndex,H,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(q){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!q)if(this.k.position){q=this.k.getWorldMatrix()}else{const f=this.k;q=d.f.Matrix[0],d.b.TranslationToRef(f.x,f.y,f.z,q)}const f=this._engine,j=f.getDepthWrite();if(f.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const q=this.eq();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",q.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const g=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=g,f.setDepthWrite(j)}render(){let q,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!f&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const q=0|this._accumulatedCount;this._accumulatedCount-=q,this._currentActiveCount+=q}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){q=this.k.getWorldMatrix()}else{const f=this.k;q=d.f.Matrix[0],d.b.TranslationToRef(f.x,f.y,f.z,q)}const g=this._engine;this.updateInAnimate||this._update(q);let h=0;return f||j||(g.setState(!1),this.forceDepthWrite&&g.setDepthWrite(!0),h=this.blendMode===Qf.BLENDMODE_MULTIPLYADD?this._render(Qf.BLENDMODE_MULTIPLY,q)+this._render(Qf.BLENDMODE_ADD,q):this._render(this.blendMode,q),this._engine.setAlphaMode(0)),h}rebuild(){const q=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(q,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,q()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const f in this._drawWrappers){this._drawWrappers[f].dispose()}if(this._drawWrappers={},this._scene){const q=this._scene.ez.indexOf(this);q>-1&&this._scene.ez.splice(q,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let f=0;f<this._renderVertexBuffers.length;++f){const q=this._renderVertexBuffers[f];for(const f in q)q[f].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.qd.notifyObservers(this),this.qd.clear()}clone(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d={...this._customWrappers};let g=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){g=this.customShader;const q=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"";d[0]=h.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,q,void 0,void 0,void 0,this)}const L=this.serialize(j),Q=Ef.Parse(L,this._scene||this._engine,this._rootUrl);return Q.name=q,Q.customShader=g,Q._customWrappers=d,void 0===f&&(f=this.k),this.noiseTexture&&(Q.noiseTexture=this.noiseTexture.clone()),Q.k=f,Q}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};return Qf._Serialize(f,this,q),f.activeParticleCount=this.activeParticleCount,f.randomTextureSize=this._randomTextureSize,f.customShader=this.customShader,f}static Parse(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0;const h=q.name;let L,Q;f instanceof Cq.b?L=f:(Q=f,L=Q.getEngine());const H=new Ef(h,{Zf:g||q.Zf,randomTextureSize:q.randomTextureSize},f,null,q.isAnimationSheetEnabled);if(H._rootUrl=j,q.customShader&&L.createEffectForParticles){const f=q.customShader,j=f.shaderOptions.defines.length>0?f.shaderOptions.defines.join("\n"):"",d=L.createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,j,void 0,void 0,void 0,H);H.setCustomEffect(d,0),H.customShader=f}return q.id&&(H.id=q.id),q.activeParticleCount&&(H.activeParticleCount=q.activeParticleCount),Qf._Parse(q,H,f,j),q.preventAutoStart&&(H.preventAutoStart=q.preventAutoStart),d||H.preventAutoStart||H.start(),H}}var sf=j(10992),Sf=j(12385),ef=j(11603);class Zf{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(q){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const f of this.systems)f.k=q;this._emitterNode=q}setEmitterAsSphere(q,f,j){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:q,renderingGroupId:f};const d=(0,Sf.d)("emitterSphere",{diameter:q.diameter,segments:q.segments},j);d.renderingGroupId=f;const g=new ef.b("emitterSphereMaterial",j);g.emissiveColor=q.color,d.material=g;for(const h of this.systems)h.k=d;this._emitterNode=d}start(q){for(const f of this.systems)q&&(f.k=q),f.start()}dispose(){for(const q of this.systems)q.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={systems:[]};for(const j of this.systems)f.systems.push(j.serialize(q));return this._emitterNode&&(f.k=this._emitterCreationOptions),f}static Parse(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;const g=new Zf,h=this.BaseAssetsUrl+"/textures/";f=f||K.d.LastCreatedScene;for(const L of q.systems)g.systems.push(j?Ef.Parse(L,f,h,!0,d):Qf.Parse(L,f,h,!0,d));if(q.k){const j=q.k.options;if("Sphere"===q.k.kind)g.setEmitterAsSphere({diameter:j.diameter,segments:j.segments,color:L.c.Pf(j.color)},q.k.renderingGroupId,f)}return g}}Zf.BaseAssetsUrl="https://assets.babylonjs.com/particles";var If=j(11021);class Tf{static CreateDefault(q){let f,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,d=arguments.length>2?arguments[2]:void 0;f=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Ef("default system",{Zf:j},d):new Qf("default system",j,d),f.k=q;const g=sf.h.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return f.particleTexture=new M.e(g,f.eq()),f.createConeEmitter(.1,Math.PI/4),f.color1=new L.e(1,1,1,1),f.color2=new L.e(1,1,1,1),f.colorDead=new L.e(1,1,1,0),f.minSize=.1,f.maxSize=.1,f.minEmitPower=2,f.maxEmitPower=2,f.updateSpeed=1/60,f.emitRate=30,f}static CreateAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;f||(f=K.d.LastCreatedScene);const g={};return f.addPendingData(g),new Promise(((h,L)=>{if(j&&!Ef.IsSupported)return f.removePendingData(g),L("Particle system with GPU is not supported.");sf.h.LoadFile(`${Tf.BaseAssetsUrl}/systems/${q}.json`,(q=>{f.removePendingData(g);const L=JSON.parse(q.toString());return h(Zf.Parse(L,f,j,d))}),void 0,void 0,void 0,(()=>(f.removePendingData(g),L(`An error occurred with the creation of your particle system. Check if your type '${q}' exists.`))))}))}static ExportSet(q){const f=new Zf;for(const j of q)f.systems.push(j);return f}static ParseFromFileAsync(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",h=arguments.length>5?arguments[5]:void 0;return new Promise(((L,Q)=>{const H=new If.c;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const f=JSON.parse(H.responseText);let Q;Q=d?Ef.Parse(f,j,g,!1,h):Qf.Parse(f,j,g,!1,h),q&&(Q.name=q),L(Q)}else Q("Unable to load the particle system")})),H.open("GET",f),H.send()}))}static ParseFromSnippetAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",g=arguments.length>4?arguments[4]:void 0;if("_BLANK"===q){const q=this.CreateDefault(null);return q.start(),Promise.resolve(q)}return new Promise(((h,L)=>{const Q=new If.c;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const L=JSON.parse(JSON.parse(Q.responseText).jsonPayload),H=JSON.parse(L.particleSystem);let r;r=j?Ef.Parse(H,f,d,!1,g):Qf.Parse(H,f,d,!1,g),r.snippetId=q,h(r)}else L("Unable to load the snippet "+q)})),Q.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),Q.send()}))}}Tf.BaseAssetsUrl=Zf.BaseAssetsUrl,Tf.SnippetUrl="https://snippet.babylonjs.com",Tf.CreateFromSnippetAsync=Tf.ParseFromSnippetAsync;var Wf=j(11289),nf=j(11327),Uf=j(12390);(0,Uf.h)(nf.b.NAME_PARTICLESYSTEM,((q,f,j,d)=>{const g=(0,Uf.k)(nf.b.NAME_PARTICLESYSTEM);if(g&&void 0!==q.ez&&null!==q.ez)for(let h=0,L=q.ez.length;h<L;h++){const L=q.ez[h];j.ez.push(g(L,f,d))}})),(0,Uf.d)(nf.b.NAME_PARTICLESYSTEM,((q,f,j)=>{if(q.activeParticleCount){return Ef.Parse(q,f,j)}return Qf.Parse(q,f,j)})),Cq.b.prototype.createEffectForParticles=function(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9?arguments[9]:void 0,X=[],z=[];const B=[];return H?H.fillUniformsAttributesAndSamplerNames(z,X,B):(X=Qf._GetAttributeNamesOrOptions(),z=Qf._GetEffectCreationOptions()),-1===g.indexOf(" BILLBOARD")&&(g+="\n#define BILLBOARD\n"),null!==H&&void 0!==H&&H.isAnimationSheetEnabled&&-1===g.indexOf(" ANIMATESHEET")&&(g+="\n#define ANIMATESHEET\n"),-1===d.indexOf("diffuseSampler")&&d.push("diffuseSampler"),this.createEffect({vertex:u??(null===H||void 0===H?void 0:H.vertexShaderName)??"particles",fragmentElement:q},X,z.concat(f),B.concat(d),g,h,L,Q,void 0,r,(async()=>{0===r?await Promise.resolve().then(j.bind(j,12420)):await Promise.resolve().then(j.bind(j,12481))}))},Wf.e.prototype.getEmittedParticleSystems=function(){const q=[];for(let f=0;f<this.eq().ez.length;f++){const j=this.eq().ez[f];j.k===this&&q.push(j)}return q},Wf.e.prototype.getHierarchyEmittedParticleSystems=function(){const q=[],f=this.getDescendants();f.push(this);for(let j=0;j<this.eq().ez.length;j++){const d=this.eq().ez[j],g=d.k;g.position&&-1!==f.indexOf(g)&&q.push(d)}return q};j(11164),j(11172),j(11249);j(11257),j(12394),j(11276),j(11142),j(11320);j(11396);var Yf;j(12402),j(11417);!function(q){q[q.Color=2]="Color",q[q.UV=1]="UV",q[q.Random=0]="Random",q[q.Stated=3]="Stated"}(Yf||(Yf={}));var vf=j(11433);const Ff=new d.j(0,0,0),Mf=new d.j(0,0,0),of=new d.j(0,0,0);class bf{constructor(q,f,j){this.width=q,this.height=f,this.data=j}processFlowable(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;if(!j)return;j instanceof d.b?d.j.TransformCoordinatesToRef(q.position,j,of):(of.x=j.x,of.y=j.y,of.z=j.z);const g=.5*of.x+.5,h=1-(.5*of.y+.5),L=Math.floor(g*this.width),Q=Math.floor(h*this.height);if(L<0||L>=this.width||Q<0||Q>=this.height)return;const H=4*(Q*this.width+L),r=this.data[H]/255*2-1,u=this.data[H+1]/255*2-1,X=this.data[H+2]/255*2-1,z=this.data[H+3]/255;Ff.set(r,u,X),Ff.scaleToRef(f*z,Mf),q.direction.addInPlace(Mf)}_processParticle(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;this.processFlowable(q,f,j)}static async FromUrlAsync(q){return await new Promise(((f,j)=>{const d=document.createElement("canvas"),g=d.getContext("2d");let h=null;const L=new Image;L.crossOrigin="anonymous",L.src=q,L.onerror=f=>{j(new Error(`Failed to load image: ${q} : ${f}`))},L.onload=()=>{d.width=L.width,d.height=L.height,g.drawImage(L,0,0),h=g.getImageData(0,0,d.width,d.height),f(new bf(d.width,d.height,h.data))}}))}static async ExtractFromTextureAsync(q){return await new Promise(((f,j)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{const j=await this.ExtractFromTextureAsync(q);f(j)}catch(d){j(d)}}));const d=q.getSize();vf.m.GetTextureDataAsync(q,d.width,d.height).then((q=>{f(new bf(d.width,d.height,new Uint8ClampedArray(q)))})).catch(j)}))}}var xf,Rf,Af,kf,yf,pf,lf,Vf,af;!function(q){q[q.Int=1]="Int",q[q.Float=2]="Float",q[q.Vector2=4]="Vector2",q[q.kf=8]="kf",q[q.Matrix=16]="Matrix",q[q.Particle=32]="Particle",q[q.Texture=64]="Texture",q[q.wd=128]="wd",q[q.FloatGradient=256]="FloatGradient",q[q.Vector2Gradient=512]="Vector2Gradient",q[q.Vector3Gradient=1024]="Vector3Gradient",q[q.Color4Gradient=2048]="Color4Gradient",q[q.System=4096]="System",q[q.AutoDetect=8192]="AutoDetect",q[q.BasedOnInput=16384]="BasedOnInput",q[q.Undefined=32768]="Undefined",q[q.All=65535]="All"}(xf||(xf={})),function(q){q[q.Compatible=0]="Compatible",q[q.TypeIncompatible=1]="TypeIncompatible",q[q.HierarchyIssue=2]="HierarchyIssue"}(Rf||(Rf={})),function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(Af||(Af={}));class Pf{get direction(){return this._direction}get type(){if(this._type===xf.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===xf.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(q){this._type=q}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((q=>q.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(q,f,j){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=xf.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new G.d,this.onDisconnectionObservable=new G.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=f,this.name=q,this._direction=j}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(q){var f;return this.isConnected?null!==(f=this._connectedPoint)&&void 0!==f&&f._storedFunction?this._connectedPoint._storedFunction(q):this._connectedPoint._storedValue:this.value}canConnectTo(q){return 0===this.checkCompatibilityState(q)}checkCompatibilityState(q){const f=this._ownerBlock,j=q.ownerBlock;if(this.type!==q.type&&q.innerType!==xf.AutoDetect)return q.acceptedConnectionPointTypes&&-1!==q.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(q.excludedConnectionPointTypes&&-1!==q.excludedConnectionPointTypes.indexOf(this.type))return 1;let d=j,g=f;return 0===this.direction&&(d=f,g=j),d.isAnAncestorOf(g)?2:0}connectTo(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(q))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${q.ownerBlock.name}".${q.name}`;return this._endpoints.push(q),q._connectedPoint=this,this.onConnectionObservable.notifyObservers(q),q.onConnectionObservable.notifyObservers(this),this}disconnectFrom(q){const f=this._endpoints.indexOf(q);return-1===f||(this._endpoints.splice(f,1),q._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(q),q.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(q){let f=1;for(;f<xf.All;)q&f||this.excludedConnectionPointTypes.push(f),f<<=1}serialize(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const f={};return f.name=this.name,f.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Yf?(f.valueType="BABYLON."+this.value.getClassName(),f.value=this.value.Yf()):(f.valueType="number",f.value=this.value)),q&&this.connectedPoint&&(f.inputName=this.name,f.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,f.targetConnectionName=this.connectedPoint.name,f.isExposedOnFrame=!0,f.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(f.isExposedOnFrame=!0,f.exposedPortPosition=this.exposedPortPosition),f}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Cf{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(q){this._name=q}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(q){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new G.d,this.qd=new G.d,this.onInputChangedObservable=new G.d,this.visibleOnFrame=!1,this._name=q,this.uniqueId=o.d.UniqueId}_inputRename(q){return q}_outputRename(q){return q}isAnAncestorOf(q){for(const f of this._outputs)if(f.hasEndpoints)for(const j of f.endpoints){if(j.ownerBlock===q)return!0;if(j.ownerBlock.isAnAncestorOf(q))return!0}return!1}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const f of this._outputs)if(f.hasEndpoints)for(const j of f.endpoints)if(j.ownerBlock.isAnAncestorOfType(q))return!0;return!1}getInputByName(q){const f=this._inputs.filter((f=>f.name===q));return f.length?f[0]:null}_linkConnectionTypes(q,f){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[f]._acceptedConnectionPointType=this._inputs[q]:(this._inputs[q]._linkedConnectionSource=this._inputs[f],this._inputs[q]._isMainLinkSource=!0),this._inputs[f]._linkedConnectionSource=this._inputs[q]}registerInput(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;const L=new Pf(q,this,0);return L.type=f,L.isOptional=j,L.defaultValue=d,L.value=d,L.valueMin=g,L.valueMax=h,this._inputs.push(L),this.onInputChangedObservable.notifyObservers(L),this}registerOutput(q,f,j){return(j=j??new Pf(q,this,1)).type=f,this._outputs.push(j),this}_build(q){}_customBuildStep(q){}build(q){if(this._buildId===q.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((q=>q.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=q.buildId;for(const f of this._inputs){if(!f.connectedPoint){f.isOptional||q.notConnectedNonOptionalInputs.push(f);continue}const j=f.connectedPoint.ownerBlock;j&&j!==this&&!j.isSystem&&j.build(q)}return this._customBuildStep(q),q.verbose&&b.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(q),this.onBuildObservable.notifyObservers(this),!1}serialize(){const q={};q.customType="BABYLON."+this.getClassName(),q.id=this.uniqueId,q.name=this.name,q.visibleOnFrame=this.visibleOnFrame,q.inputs=[],q.outputs=[];for(const f of this.inputs)q.inputs.push(f.serialize());for(const f of this.outputs)q.outputs.push(f.serialize(!1));return q}_deserialize(q){this._name=q.name,this.comments=q.comments,this.visibleOnFrame=!!q.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(q)}_deserializePortDisplayNamesAndExposedOnFrame(q){const f=q.inputs,j=q.outputs;if(f)for(const d of f){const q=this.inputs.find((q=>q.name===d.name));if(!q)return;if(d.displayName&&(q.displayName=d.displayName),d.isExposedOnFrame&&(q.isExposedOnFrame=d.isExposedOnFrame,q.exposedPortPosition=d.exposedPortPosition),void 0!==d.value&&null!==d.value)if("number"===d.valueType)q.value=d.value;else{const f=(0,Q.c)(d.valueType);f&&(q.value=f.Pf(d.value))}}if(j)for(let d=0;d<j.length;d++){const q=j[d];q.displayName&&(this.outputs[d].displayName=q.displayName),q.isExposedOnFrame&&(this.outputs[d].isExposedOnFrame=q.isExposedOnFrame,this.outputs[d].exposedPortPosition=q.exposedPortPosition)}}clone(){const q=this.serialize(),f=(0,Q.c)(q.customType);if(f){const j=new f;return j._deserialize(q),j}return null}dispose(){this.qd.notifyObservers(this),this.qd.clear();for(const q of this.inputs)q.dispose();for(const q of this.outputs)q.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function cf(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",d=arguments.length>3?arguments[3]:void 0;return(g,h)=>{let L=g._propStore;L||(L=[],g._propStore=L),L.push({propertyName:h,displayName:q,type:f,groupName:j,options:d??{},className:g.getClassName()})}}(0,Y.b)([(0,v.O)("comment")],Cf.prototype,"comments",void 0),function(q){q[q.Boolean=0]="Boolean",q[q.Float=1]="Float",q[q.Int=2]="Int",q[q.Vector2=3]="Vector2",q[q.List=4]="List",q[q.wd=5]="wd",q[q.SamplingMode=6]="SamplingMode",q[q.TextureFormat=7]="TextureFormat",q[q.TextureType=8]="TextureType"}(kf||(kf={})),function(q){q[q.None=0]="None",q[q.Position=1]="Position",q[q.Direction=2]="Direction",q[q.Age=3]="Age",q[q.Lifetime=4]="Lifetime",q[q.Color=5]="Color",q[q.ScaledDirection=6]="ScaledDirection",q[q.Scale=7]="Scale",q[q.AgeGradient=8]="AgeGradient",q[q.Angle=9]="Angle",q[q.SpriteCellIndex=16]="SpriteCellIndex",q[q.SpriteCellStart=17]="SpriteCellStart",q[q.SpriteCellEnd=18]="SpriteCellEnd"}(yf||(yf={})),function(q){q[q.None=0]="None",q[q.Time=1]="Time",q[q.Delta=2]="Delta",q[q.Emitter=3]="Emitter"}(pf||(pf={}));class Gf{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let q="";for(const f of this.notConnectedNonOptionalInputs)q+=`input ${f.name} from block ${f.ownerBlock.name}[${f.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(q)throw"Build of Node Particle System Set failed:\n"+q}adapt(q,f){const j=q.getConnectedValue(this)||0;if(q.type===f)return j;switch(f){case xf.Vector2:return new d.i(j,j);case xf.kf:return new d.j(j,j,j);case xf.wd:return new L.e(j,j,j,j)}return null}getContextualValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case yf.Position:return this.particleContext.position;case yf.Direction:return this.particleContext.direction;case yf.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case yf.Color:return this.particleContext.color;case yf.Age:return this.particleContext.age;case yf.Lifetime:return this.particleContext.lifeTime;case yf.Angle:return this.particleContext.angle;case yf.Scale:return this.particleContext.scale;case yf.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case yf.SpriteCellEnd:return this.systemContext.endSpriteCellID;case yf.SpriteCellIndex:return this.particleContext.cellIndex;case yf.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case pf.Time:return this.systemContext._actualFrame;case pf.Delta:return this.systemContext._scaledUpdateSpeed;case pf.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function mf(q,f,j){const d=new Gf;d.Sf=f;const g=q.createSystem(d);return g.canStart=()=>!0,g.k=j.clone(),g.disposeOnStop=!0,g.start(),g}class Kf extends Cf{constructor(q){super(q),this.blendMode=H.BLENDMODE_ONEONE,this.Zf=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",xf.Particle),this.registerInput("texture",xf.Texture),this.registerInput("onStart",xf.System,!0),this.registerInput("onEnd",xf.System,!0),this.registerOutput("system",xf.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(q){q.Zf=this.Zf,q.buildId=this._buildId++,this.build(q);const f=this.particle.getConnectedValue(q);return f.particleTexture=this.texture.getConnectedValue(q),f.emitRate=this.emitRate,f.blendMode=this.blendMode,f.name=this.name,f._nodeGenerated=!0,f._targetStopDuration=this.targetStopDuration,f.startDelay=this.startDelay,this.system._storedValue=this,f.canStart=()=>!this.doNoStart,f.onStartedObservable.add((j=>{const d=this.onStart.getConnectedValue(q);d&&j.onStartedObservable.addOnce((()=>{q.systemContext=f;const j=mf(d,q.Sf,q.emitterPosition);this.qd.addOnce((()=>{j.dispose()}))}));const g=this.onEnd.getConnectedValue(q);g&&j.onStoppedObservable.addOnce((()=>{q.systemContext=f;const j=mf(g,q.Sf,q.emitterPosition);this.qd.addOnce((()=>{j.dispose()}))}))})),this.qd.addOnce((()=>{f.dispose()})),f}serialize(){const q=super.serialize();return q.Zf=this.Zf,q.emitRate=this.emitRate,q.blendMode=this.blendMode,q.doNoStart=this.doNoStart,q.targetStopDuration=this.targetStopDuration,q.startDelay=this.startDelay,q}_deserialize(q){super._deserialize(q),this.Zf=q.Zf,this.emitRate=q.emitRate,this.doNoStart=!!q.doNoStart,void 0!==q.blendMode&&(this.blendMode=q.blendMode),void 0!==q.targetStopDuration&&(this.targetStopDuration=q.targetStopDuration),void 0!==q.startDelay&&(this.startDelay=q.startDelay)}}(0,Y.b)([cf("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:H.BLENDMODE_ONEONE},{label:"Standard",value:H.BLENDMODE_STANDARD},{label:"Add",value:H.BLENDMODE_ADD},{label:"Multiply",value:H.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:H.BLENDMODE_MULTIPLYADD}]})],Kf.prototype,"blendMode",void 0),(0,Y.b)([cf("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Kf.prototype,"Zf",void 0),(0,Y.b)([cf("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kf.prototype,"emitRate",void 0),(0,Y.b)([cf("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kf.prototype,"targetStopDuration",void 0),(0,Y.b)([cf("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kf.prototype,"startDelay",void 0),(0,Y.b)([cf("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Kf.prototype,"doNoStart",void 0),(0,Q.f)("BABYLON.SystemBlock",Kf);class Jf extends Cf{get type(){if(this._type===xf.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=xf.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=xf.Vector2,this._type;case"kf":return this._type=xf.kf,this._type;case"wd":return this._type=xf.wd,this._type;case"Matrix":return this._type=xf.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===yf.None&&this._systemSource!==pf.None}get systemSource(){return this._systemSource}set systemSource(q){if(this._systemSource=q,q!==pf.None){switch(this._contextualSource=yf.None,this._type=xf.Float,q){case pf.Time:case pf.Delta:this._type=xf.Float;break;case pf.Emitter:this._type=xf.kf}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==yf.None}get contextualValue(){return this._contextualSource}set contextualValue(q){if(this._contextualSource=q,q!==yf.None){switch(this._systemSource=pf.None,q){case yf.Scale:this._type=xf.Vector2;break;case yf.Position:case yf.Direction:case yf.ScaledDirection:this._type=xf.kf;break;case yf.Color:this._type=xf.wd;break;case yf.Age:case yf.Lifetime:case yf.Angle:case yf.AgeGradient:this._type=xf.Float;break;case yf.SpriteCellEnd:case yf.SpriteCellStart:case yf.SpriteCellIndex:this._type=xf.Int}this.output&&(this.output.type=this._type)}}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xf.AutoDetect;super(q),this._type=xf.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new G.d,this._systemSource=pf.None,this._contextualSource=yf.None,this._type=f,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",f)}get value(){return this._storedValue}set value(q){this.type===xf.Float&&this.min!==this.max&&(q=Math.max(this.min,q),q=Math.min(this.max,q)),this._storedValue=q,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(q){this._valueCallback=q}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case xf.Int:case xf.Float:this.value=0;break;case xf.Vector2:this.value=d.i.Zero();break;case xf.kf:this.value=d.j.Zero();break;case xf.wd:this.value=new L.e(1,1,1,1);break;case xf.Matrix:this.value=d.b.Identity()}}_build(q){super._build(q),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=q=>q.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=q=>q.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const q=super.serialize();return q.type=this.type,q.contextualValue=this.contextualValue,q.systemSource=this.systemSource,q.min=this.min,q.max=this.max,q.groupInInspector=this.groupInInspector,q.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Yf?(q.valueType="BABYLON."+this._storedValue.getClassName(),q.value=this._storedValue.Yf()):(q.valueType="number",q.value=this._storedValue)),q}_deserialize(q){if(super._deserialize(q),this._type=q.type,this.contextualValue=q.contextualValue,this.systemSource=q.systemSource||pf.None,this.min=q.min||0,this.max=q.max||0,this.groupInInspector=q.groupInInspector||"",void 0!==q.displayInInspector&&(this.displayInInspector=q.displayInInspector),q.valueType)if("number"===q.valueType)this._storedValue=q.value;else{const f=(0,Q.c)(q.valueType);f&&(this._storedValue=f.Pf(q.value))}}}(0,Q.f)("BABYLON.ParticleInputBlock",Jf);class qj extends Cf{get url(){return this._url}set url(q){this._url!==q&&(this._cachedData=null,this._url=q,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(q){this._textureDataUrl!==q&&(this._cachedData=null,this._textureDataUrl=q,this._url="",this._sourceTexture=null)}set sourceTexture(q){this._sourceTexture!==q&&(this._cachedData=null,this._sourceTexture=q,this._url="",this._textureDataUrl="")}constructor(q){super(q),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",xf.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const q=this.texture._storedValue;return await new Promise(((f,j)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),f(this._cachedData)}catch(q){j(q)}}));const d=q.getSize();vf.m.GetTextureDataAsync(q,d.width,d.height).then((j=>{this._cachedData={width:d.width,height:d.height,data:new Uint8ClampedArray(j)},q.dispose(),f(this._cachedData)})).catch(j)}))}_build(q){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new M.e(this._textureDataUrl,q.Sf):this.texture._storedValue=new M.e(this._url,q.Sf):this.texture._storedValue=null}serialize(){const q=super.serialize();return q.url=this.url,q.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(q.textureDataUrl=this.textureDataUrl),q}_deserialize(q){super._deserialize(q),this.url=q.url,this.serializedCachedData=!!q.serializedCachedData,q.textureDataUrl&&(this.textureDataUrl=q.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,Q.f)("BABYLON.ParticleTextureSourceBlock",qj);class fj extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("position",xf.kf),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(q){const f=this.particle.getConnectedValue(q);if(this.output._storedValue=f,!this.position.isConnected)return;const j={process:j=>{q.particleContext=j,q.systemContext=f,j.position.H(this.position.getConnectedValue(q))},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j}}(0,Q.f)("BABYLON.UpdatePositionBlock",fj),function(q){q[q.Add=0]="Add",q[q.Subtract=1]="Subtract",q[q.Multiply=2]="Multiply",q[q.Divide=3]="Divide",q[q.Max=4]="Max",q[q.Min=5]="Min"}(lf||(lf={}));class jj extends Cf{constructor(q){super(q),this.operation=lf.Add,this.registerInput("left",xf.AutoDetect),this.registerInput("right",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this.output._typeConnectionSource=this.left;const f=[xf.Matrix,xf.Particle,xf.Texture,xf.System,xf.FloatGradient,xf.Color4Gradient,xf.Vector2Gradient,xf.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...f),this.right.excludedConnectionPointTypes.push(...f),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(q){let f;const j=this.left,g=this.right;if(!j.isConnected||!g.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=j.type===xf.Float||j.type===xf.Int,Q=g.type===xf.Float||g.type===xf.Int,H=h&&Q;switch(this.operation){case lf.Add:f=H?q=>j.getConnectedValue(q)+g.getConnectedValue(q):h?q=>q.adapt(j,g.type).add(g.getConnectedValue(q)):q=>j.getConnectedValue(q).add(q.adapt(g,j.type));break;case lf.Subtract:f=H?q=>j.getConnectedValue(q)-g.getConnectedValue(q):h?q=>q.adapt(j,g.type).ej(g.getConnectedValue(q)):q=>j.getConnectedValue(q).ej(q.adapt(g,j.type));break;case lf.Multiply:f=H?q=>j.getConnectedValue(q)*g.getConnectedValue(q):h?q=>q.adapt(j,g.type).multiply(g.getConnectedValue(q)):q=>j.getConnectedValue(q).multiply(q.adapt(g,j.type));break;case lf.Divide:f=H?q=>j.getConnectedValue(q)/g.getConnectedValue(q):h?q=>q.adapt(j,g.type).divide(g.getConnectedValue(q)):q=>j.getConnectedValue(q).divide(q.adapt(g,j.type));break;case lf.Min:if(H)f=q=>Math.min(j.getConnectedValue(q),g.getConnectedValue(q));else{const[q,Q]=h?[g,j]:[j,g];switch(q.type){case xf.Vector2:f=f=>d.i.Minimize(q.getConnectedValue(f),f.adapt(Q,q.type));break;case xf.kf:f=f=>d.j.Minimize(q.getConnectedValue(f),f.adapt(Q,q.type));break;case xf.wd:f=f=>{const j=q.getConnectedValue(f),{r:d,g:g,b:h,a:H}=f.adapt(Q,q.type);return new L.e(Math.min(j.r,d),Math.min(j.g,g),Math.min(j.b,h),Math.min(j.a,H))}}}break;case lf.Max:if(!H){const[q,Q]=h?[g,j]:[j,g];switch(q.type){case xf.Vector2:f=f=>d.i.Maximize(q.getConnectedValue(f),f.adapt(Q,q.type));break;case xf.kf:f=f=>d.j.Maximize(q.getConnectedValue(f),f.adapt(Q,q.type));break;case xf.wd:f=f=>{const j=q.getConnectedValue(f),{r:d,g:g,b:h,a:H}=f.adapt(Q,q.type);return new L.e(Math.max(j.r,d),Math.min(j.g,g),Math.min(j.b,h),Math.min(j.a,H))}}break}f=q=>Math.max(j.getConnectedValue(q),g.getConnectedValue(q))}this.output._storedFunction=q=>j.type===xf.Int?0|f(q):f(q)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===xf.Int||this.left.type===xf.Float&&this.right.type!==xf.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[q,f]of[[this.left,this.right],[this.right,this.left]])q.acceptedConnectionPointTypes=[xf.Int,xf.Float],f.isConnected&&(q.acceptedConnectionPointTypes.push(f.type),f.type!==xf.Int&&f.type!==xf.Float||q.acceptedConnectionPointTypes.push(xf.Vector2,xf.kf,xf.wd))}dispose(){super.dispose();for(const q of this._connectionObservers)q.remove();this._connectionObservers.length=0}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,Y.b)([cf("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:lf.Add},{label:"Subtract",value:lf.Subtract},{label:"Multiply",value:lf.Multiply},{label:"Divide",value:lf.Divide},{label:"Max",value:lf.Max},{label:"Min",value:lf.Min}]})],jj.prototype,"operation",void 0),(0,Q.f)("BABYLON.ParticleMathBlock",jj);class dj extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("direction1",xf.kf,!0,new d.j(0,1,0)),this.registerInput("direction2",xf.kf,!0,new d.j(0,1,0)),this.registerInput("minEmitBox",xf.kf,!0,new d.j(-.5,-.5,-.5)),this.registerInput("maxEmitBox",xf.kf,!0,new d.j(.5,.5,.5)),this.registerOutput("output",xf.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const f=this.particle.getConnectedValue(q);f._directionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.direction1.getConnectedValue(q),h=this.direction2.getConnectedValue(q),L=(0,r.RandomRange)(g.x,h.x),Q=(0,r.RandomRange)(g.y,h.y),H=(0,r.RandomRange)(g.z,h.z);q.isEmitterTransformNode?d.j.TransformNormalFromFloatsToRef(L,Q,H,q.emitterWorldMatrix,j.direction):j.direction.Af(L,Q,H)},f._positionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.minEmitBox.getConnectedValue(q),h=this.maxEmitBox.getConnectedValue(q),L=(0,r.RandomRange)(g.x,h.x),Q=(0,r.RandomRange)(g.y,h.y),H=(0,r.RandomRange)(g.z,h.z);q.isEmitterTransformNode?d.j.TransformCoordinatesFromFloatsToRef(L,Q,H,q.emitterWorldMatrix,j.position):(j.position.Af(L,Q,H),j.position.addInPlace(q.emitterPosition))},this.output._storedValue=f}}(0,Q.f)("BABYLON.BoxShapeBlock",dj);class gj extends Cf{constructor(q){super(q),this.registerInput("emitPower",xf.Float,!0,1),this.registerInput("lifeTime",xf.Float,!0,1),this.registerInput("color",xf.wd,!0,new L.e(1,1,1,1)),this.registerInput("scale",xf.Vector2,!0,new d.i(1,1)),this.registerInput("angle",xf.Float,!0,0),this.registerOutput("particle",xf.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(q){const f=new Qf(this.name,q.Zf,q.Sf,null,!1,void 0,!0);f.particleEmitterType=new O,f._lifeTimeCreation.process=(f,j)=>{q.particleContext=f,f.lifeTime=this.lifeTime.getConnectedValue(q),j._emitPower=this.emitPower.getConnectedValue(q)},f._colorCreation.process=f=>{q.particleContext=f,f.color.H(this.color.getConnectedValue(q))},f._sizeCreation.process=f=>{q.particleContext=f,f.size=1,f.scale.H(this.scale.getConnectedValue(q))},f._angleCreation.process=f=>{q.particleContext=f,f.angle=this.angle.getConnectedValue(q)},this.particle._storedValue=f}}(0,Q.f)("BABYLON.CreateParticleBlock",gj);class hj{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const q=[];for(const f of this.attachedBlocks)f.isInput&&q.push(f);return q}constructor(q){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new G.d,this.name=q}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(q)&&this.attachedBlocks.push(q);for(const j of q.inputs){const d=j.connectedPoint;if(d){const j=d.ownerBlock;j!==q&&this._initializeBlock(j,f)}}}async buildAsync(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((j=>{const d=new Zf;for(const q of this._systemBlocks)this._initializeBlock(q);for(const g of this.systemBlocks){const j=new Gf;j.buildId=this._buildId++,j.Sf=q,j.verbose=f;const h=g.createSystem(j);j.emitErrors(),d.systems.push(h)}this.onBuildObservable.notifyObservers(this),j(d)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const q=new Kf("Particle system"),f=new fj("Update position");f.output.connectTo(q.particle);const j=new Jf("Position");j.contextualValue=yf.Position;const d=new Jf("Scaled direction");d.contextualValue=yf.ScaledDirection;const g=new jj("Add");g.operation=lf.Add,j.output.connectTo(g.left),d.output.connectTo(g.right),g.output.connectTo(f.position);const h=new gj("Create particle"),L=new dj("Box shape");h.particle.connectTo(L.particle),L.output.connectTo(f.particle);const Q=new qj("Texture");Q.texture.connectTo(q.texture),Q.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(q)}removeBlock(q){const f=this.attachedBlocks.indexOf(q);if(f>-1&&this.attachedBlocks.splice(f,1),q.isSystem){const f=this._systemBlocks.indexOf(q);f>-1&&this._systemBlocks.splice(f,1)}}parseSerializedObject(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f||this.clear();const j={};for(const d of q.Au){const q=(0,Q.c)(d.customType);if(q){const f=new q;f._deserialize(d),j[d.id]=f,this.attachedBlocks.push(f),f.isSystem&&this._systemBlocks.push(f)}}for(const d of this.attachedBlocks)if(d.isTeleportOut){const q=d,f=q._tempEntryPointUniqueId;if(f){const d=j[f];d&&d.attachToEndpoint(q)}}for(let d=0;d<q.Au.length;d++){const g=q.Au[d],h=j[g.id];h&&(h.inputs.length&&g.inputs.some((q=>q.targetConnectionName))&&!f||this._restoreConnections(h,q,j))}if(q.locations||q.editorData&&q.editorData.locations){const d=q.locations||q.editorData.locations;for(const q of d)j[q.Dg]&&(q.Dg=j[q.Dg].uniqueId);f&&this.editorData&&this.editorData.locations&&d.concat(this.editorData.locations),q.locations?this.editorData={locations:d}:(this.editorData=q.editorData,this.editorData.locations=d);const g=[];for(const q in j)g[q]=j[q].uniqueId;this.editorData.map=g}this.comment=q.comment}_restoreConnections(q,f,j){for(const d of q.outputs)for(const g of f.Au){const h=j[g.id];if(h)for(const L of g.inputs)if(j[L.targetBlockId]!==q||L.targetConnectionName!==d.name);else{const q=h.getInputByName(L.inputName);if(!q||q.isConnected)continue;d.connectTo(q,!0),this._restoreConnections(h,f,j)}}}serialize(q){const f=q?{}:F.d.Serialize(this);f.editorData=JSON.parse(JSON.stringify(this.editorData));let j=[];q?j=q:f.customType="BABYLON.NodeParticleSystemSet",f.Au=[];for(const d of j)f.Au.push(d.serialize());if(!q)for(const d of this.attachedBlocks)-1===j.indexOf(d)&&f.Au.push(d.serialize());return f}dispose(){for(const q of this.attachedBlocks)q.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(q){const f=new hj(q);return f.setToDefault(),f}static Parse(q){const f=F.d.Parse((()=>new hj(q.name)),q,null);return f.parseSerializedObject(q),f}static ParseFromSnippetAsync(q,f){return"_BLANK"===q?Promise.resolve(hj.CreateDefault("blank")):new Promise(((j,d)=>{const g=new If.c;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const L=JSON.parse(JSON.parse(g.responseText).jsonPayload),Q=JSON.parse(L.nodeParticle);f||(f=F.d.Parse((()=>new hj(q)),Q,null)),f.parseSerializedObject(Q),f.snippetId=q;try{j(f)}catch(h){d(h)}}else d("Unable to load the snippet "+q)})),g.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),g.send()}))}}hj.EditorURL=`${sf.h._DefaultCdnUrl}/v${Cq.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,hj.SnippetUrl="https://snippet.babylonjs.com",(0,Y.b)([(0,v.O)()],hj.prototype,"name",void 0),(0,Y.b)([(0,v.O)("comment")],hj.prototype,"comment",void 0),function(q){q[q.None=0]="None",q[q.PerParticle=1]="PerParticle",q[q.PerSystem=2]="PerSystem"}(Vf||(Vf={}));class Lj extends Cf{constructor(q){super(q),this._currentLockId=-2,this.lockMode=Vf.PerParticle,this.registerInput("min",xf.AutoDetect,!0,0),this.registerInput("max",xf.AutoDetect,!0,1),this.registerOutput("output",xf.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xf.Float|xf.Int|xf.Vector2|xf.kf|xf.wd),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(xf.Float|xf.Int|xf.Vector2|xf.kf|xf.wd),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=xf.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case xf.AutoDetect:case xf.Int:case xf.Float:q=q=>{const f=this.min.getConnectedValue(q)||0,j=this.max.getConnectedValue(q)||1;return f+Math.random()*(j-f)};break;case xf.Vector2:q=q=>{const f=this.min.getConnectedValue(q)||d.i.Zero(),j=this.max.getConnectedValue(q)||d.i.One();return new d.i(f.x+Math.random()*(j.x-f.x),f.y+Math.random()*(j.y-f.y))};break;case xf.kf:q=q=>{const f=this.min.getConnectedValue(q)||d.j.Zero(),j=this.max.getConnectedValue(q)||d.j.One();return new d.j(f.x+Math.random()*(j.x-f.x),f.y+Math.random()*(j.y-f.y),f.z+Math.random()*(j.z-f.z))};break;case xf.wd:q=q=>{const f=this.min.getConnectedValue(q)||new L.e(0,0,0,0),j=this.max.getConnectedValue(q)||new L.e(1,1,1,1);return new L.e(f.x+Math.random()*(j.x-f.x),f.y+Math.random()*(j.y-f.y),f.z+Math.random()*(j.z-f.z),f.w+Math.random()*(j.w-f.w))}}this.output._storedFunction=f=>{var j;let d=0;switch(this.lockMode){case Vf.PerParticle:d=(null===(j=f.particleContext)||void 0===j?void 0:j.id)||-1;break;case Vf.PerSystem:d=f.buildId||0}return this._currentLockId!==d&&(this.lockMode!==Vf.None&&(this._currentLockId=d),this.output._storedValue=q(f)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),this.lockMode=q.lockMode}}(0,Y.b)([cf("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Vf.None},{label:"Per particle",value:Vf.PerParticle},{label:"Per system",value:Vf.PerSystem}]})],Lj.prototype,"lockMode",void 0),(0,Q.f)("BABYLON.ParticleRandomBlock",Lj);class Qj extends Cf{constructor(q){super(q),this._currentLockId=-2,this.lockMode=Vf.PerParticle,this.registerInput("min",xf.AutoDetect),this.registerInput("max",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const f=[xf.Matrix,xf.Particle,xf.Texture,xf.System,xf.FloatGradient,xf.Color4Gradient,xf.Vector2Gradient,xf.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...f),this.max.excludedConnectionPointTypes.push(...f)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case xf.Float:case xf.Int:q=q=>{const f=this.min.getConnectedValue(q),j=this.max.getConnectedValue(q);return Math.random()*(j-f)+f};break;case xf.Vector2:q=q=>{const f=this.min.getConnectedValue(q),j=this.max.getConnectedValue(q);return new d.i(Math.random()*(j.x-f.x)+f.x,Math.random()*(j.y-f.y)+f.y)};break;case xf.kf:q=q=>{const f=this.min.getConnectedValue(q),j=this.max.getConnectedValue(q);return new d.j(Math.random()*(j.x-f.x)+f.x,Math.random()*(j.y-f.y)+f.y,Math.random()*(j.z-f.z)+f.z)};break;case xf.wd:q=q=>{const f=this.min.getConnectedValue(q),j=this.max.getConnectedValue(q);return new L.e(Math.random()*(j.r-f.r)+f.r,Math.random()*(j.g-f.g)+f.g,Math.random()*(j.b-f.b)+f.b,Math.random()*(j.a-f.a)+f.a)}}this.output._storedFunction=f=>{var j;let d=0;switch(this.lockMode){case Vf.PerParticle:d=(null===(j=f.particleContext)||void 0===j?void 0:j.id)||-1;break;case Vf.PerSystem:d=f.buildId||0}return this._currentLockId!==d&&(this.lockMode!==Vf.None&&(this._currentLockId=d),this.output._storedValue=q(f)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),void 0!==q.lockMode&&(this.lockMode=q.lockMode)}}(0,Y.b)([cf("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Vf.None},{label:"Per particle",value:Vf.PerParticle},{label:"Per system",value:Vf.PerSystem}]})],Qj.prototype,"lockMode",void 0),(0,Q.f)("BABYLON.RandomRangeBlock",Qj);(0,Q.f)("BABYLON.ParticleLerpBlock",class extends Cf{constructor(q){super(q),this.registerInput("left",xf.AutoDetect),this.registerInput("right",xf.AutoDetect),this.registerInput("gradient",xf.Float,!0,0,0,1),this.registerOutput("output",xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xf.Float|xf.Int|xf.Vector2|xf.kf|xf.wd)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=(q,f,j)=>(1-q)*f+q*j;this.output._storedFunction=f=>{const j=this.left.getConnectedValue(f),g=this.right.getConnectedValue(f),h=this.gradient.getConnectedValue(f);switch(this.left.type){case xf.Int:case xf.Float:return q(h,j,g);case xf.Vector2:return new d.i(q(h,j.x,g.x),q(h,j.y,g.y));case xf.kf:return new d.j(q(h,j.x,g.x),q(h,j.y,g.y),q(h,j.z,g.z));case xf.wd:return new L.e(q(h,j.r,g.r),q(h,j.g,g.g),q(h,j.b,g.b),q(h,j.a,g.a))}return 0}}});(0,Q.f)("BABYLON.UpdateDirectionBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("direction",xf.kf),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(q){const f=this.particle.getConnectedValue(q);if(this.output._storedValue=f,!this.direction.isConnected)return;const j={process:j=>{q.particleContext=j,q.systemContext=f,j.direction.H(this.direction.getConnectedValue(q))},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j}});(0,Q.f)("BABYLON.UpdateColorBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("color",xf.wd),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(q){const f=this.particle.getConnectedValue(q);if(this.output._storedValue=f,!this.color.isConnected)return;const j={process:j=>{q.particleContext=j,q.systemContext=f,j.color.H(this.color.getConnectedValue(q))},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j}});(0,Q.f)("BABYLON.UpdateScaleBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("scale",xf.Vector2),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(q){const f=this.particle.getConnectedValue(q);if(this.output._storedValue=f,!this.scale.isConnected)return;const j={process:j=>{q.particleContext=j,q.systemContext=f,j.scale.H(this.scale.getConnectedValue(q))},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j}});(0,Q.f)("BABYLON.UpdateAngleBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("angle",xf.Float),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(q){const f=this.particle.getConnectedValue(q);if(this.output._storedValue=f,!this.angle.isConnected)return;const j={process:j=>{q.particleContext=j,q.systemContext=f,j.angle=this.angle.getConnectedValue(q)},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j}});(0,Q.f)("BABYLON.BasicPositionUpdateBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(q){const f=this.particle.getConnectedValue(q),j={process:j=>{q.particleContext=j,q.systemContext=f,j.direction.scaleToRef(f._directionScale,f._scaledDirection),j.position.addInPlace(f._scaledDirection)},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j,this.output._storedValue=f}});(0,Q.f)("BABYLON.BasicSpriteUpdateBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(q){const f=this.particle.getConnectedValue(q),j={process:j=>{q.particleContext=j,q.systemContext=f,j.updateCellIndex()},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j,this.output._storedValue=f}});(0,Q.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("cellIndex",xf.Int),this.registerOutput("output",xf.Particle),this.cellIndex.acceptedConnectionPointTypes=[xf.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(q){const f=this.particle.getConnectedValue(q);if(this.output._storedValue=f,!this.cellIndex.isConnected)return;const j={process:j=>{q.particleContext=j,q.systemContext=f,j.cellIndex=Math.floor(this.cellIndex.getConnectedValue(q))},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j}});class Hj extends Cf{constructor(q){super(q),this.strength=1,this.registerInput("particle",xf.Particle),this.registerInput("flowMap",xf.Texture),this.registerOutput("output",xf.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(q){var f;const j=this.particle.getConnectedValue(q),d=q.Sf;let g;(null===(f=this.flowMap.connectedPoint)||void 0===f?void 0:f.ownerBlock).extractTextureContentAsync().then((q=>{q&&(g=new bf(q.width,q.height,q.data))}));const h={process:q=>{const f=d.getTransformMatrix();g&&g._processParticle(q,this.strength*j._tempScaledUpdateSpeed,f)},previousItem:null,nextItem:null};j._updateQueueStart?yq(h,j._updateQueueStart):j._updateQueueStart=h,this.output._storedValue=j}serialize(){const q=super.serialize();return q.strength=this.strength,q}_deserialize(q){super._deserialize(q),this.strength=q.strength}}(0,Y.b)([cf("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hj.prototype,"strength",void 0),(0,Q.f)("BABYLON.UpdateFlowMapBlock",Hj);(0,Q.f)("BABYLON.SphereShapeBlock",class extends Cf{constructor(q){super(q),this.registerInput("input",xf.Particle),this.registerInput("radius",xf.Float,!0,1),this.registerInput("radiusRange",xf.Float,!0,1,0,1),this.registerInput("directionRandomizer",xf.Float,!0,0,0,1),this.registerOutput("output",xf.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(q){const f=this.input.getConnectedValue(q);f._directionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.directionRandomizer.getConnectedValue(q),h=j.position.ej(q.emitterPosition).normalize(),L=(0,r.RandomRange)(0,g),Q=(0,r.RandomRange)(0,g),H=(0,r.RandomRange)(0,g);h.x+=L,h.y+=Q,h.z+=H,h.normalize(),q.isEmitterTransformNode?d.j.TransformNormalFromFloatsToRef(L,Q,H,q.emitterWorldMatrix,j.direction):j.direction.Af(L,Q,H)},f._positionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.radius.getConnectedValue(q),h=this.radiusRange.getConnectedValue(q),L=g-(0,r.RandomRange)(0,g*h),Q=(0,r.RandomRange)(0,1),H=(0,r.RandomRange)(0,2*Math.PI),u=Math.acos(2*Q-1),X=L*Math.cos(H)*Math.sin(u),z=L*Math.cos(u),B=L*Math.sin(H)*Math.sin(u);q.isEmitterTransformNode?d.j.TransformCoordinatesFromFloatsToRef(X,z,B,q.emitterWorldMatrix,j.position):(j.position.Af(X,z,B),j.position.addInPlace(q.emitterPosition))},this.output._storedValue=f}});(0,Q.f)("BABYLON.PointShapeBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("direction1",xf.kf,!0,new d.j(0,1,0)),this.registerInput("direction2",xf.kf,!0,new d.j(0,1,0)),this.registerOutput("output",xf.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const f=this.particle.getConnectedValue(q);f._directionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.direction1.getConnectedValue(q),h=this.direction2.getConnectedValue(q),L=(0,r.RandomRange)(g.x,h.x),Q=(0,r.RandomRange)(g.y,h.y),H=(0,r.RandomRange)(g.z,h.z);q.isEmitterTransformNode?d.j.TransformNormalFromFloatsToRef(L,Q,H,q.emitterWorldMatrix,j.direction):j.direction.Af(L,Q,H)},f._positionCreation.process=j=>{q.systemContext=f,q.isEmitterTransformNode?d.j.TransformCoordinatesFromFloatsToRef(0,0,0,q.emitterWorldMatrix,j.position):j.position.H(q.emitterPosition)},this.output._storedValue=f}});(0,Q.f)("BABYLON.CustomShapeBlock",class extends Cf{constructor(q){super(q),this.registerInput("particle",xf.Particle),this.registerInput("position",xf.kf,!0,new d.j(0,0,0)),this.registerInput("direction",xf.kf,!0,new d.j(0,1,0)),this.registerOutput("output",xf.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const f=this.particle.getConnectedValue(q);f._directionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.direction.getConnectedValue(q);q.isEmitterTransformNode?d.j.TransformNormalToRef(g,q.emitterWorldMatrix,j.direction):j.direction.H(g)},f._positionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.position.getConnectedValue(q);q.isEmitterTransformNode?d.j.TransformCoordinatesToRef(g,q.emitterWorldMatrix,j.position):(j.position.H(g),j.position.addInPlace(q.emitterPosition))},this.output._storedValue=f}});(0,Q.f)("BABYLON.CylinderShapeBlock",class extends Cf{constructor(q){super(q),this._tempVector=d.j.Zero(),this.registerInput("particle",xf.Particle),this.registerInput("radius",xf.Float,!0,1),this.registerInput("height",xf.Float,!0,1,0),this.registerInput("radiusRange",xf.Float,!0,1,0,1),this.registerInput("directionRandomizer",xf.Float,!0,0,0,1),this.registerOutput("output",xf.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const f=this.particle.getConnectedValue(q);f._directionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.directionRandomizer.getConnectedValue(q);j.position.subtractToRef(q.emitterPosition,this._tempVector),this._tempVector.normalize(),q.isEmitterTransformNode&&d.j.TransformNormalToRef(this._tempVector,q.emitterInverseWorldMatrix,this._tempVector);const h=(0,r.RandomRange)(-g/2,g/2);let L=Math.atan2(this._tempVector.x,this._tempVector.z);L+=(0,r.RandomRange)(-Math.PI/2,Math.PI/2)*g,this._tempVector.y=h,this._tempVector.x=Math.sin(L),this._tempVector.z=Math.cos(L),this._tempVector.normalize(),q.isEmitterTransformNode?d.j.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q.emitterWorldMatrix,j.direction):j.direction.H(this._tempVector)},f._positionCreation.process=j=>{q.particleContext=j,q.systemContext=f;const g=this.height.getConnectedValue(q),h=this.radiusRange.getConnectedValue(q),L=this.radius.getConnectedValue(q),Q=(0,r.RandomRange)(-g/2,g/2),H=(0,r.RandomRange)(0,2*Math.PI),u=(0,r.RandomRange)((1-h)*(1-h),1),X=Math.sqrt(u)*L,z=X*Math.cos(H),B=X*Math.sin(H);q.isEmitterTransformNode?d.j.TransformCoordinatesFromFloatsToRef(z,Q,B,q.emitterWorldMatrix,j.position):(j.position.Af(z,Q,B),j.position.addInPlace(q.emitterPosition))},this.output._storedValue=f}});class rj extends Cf{constructor(q){super(q),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",xf.Particle),this.registerOutput("output",xf.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const f=this.particle.getConnectedValue(q);f._isAnimationSheetEnabled=!0,f.spriteCellWidth=this.width,f.spriteCellHeight=this.height,f.startSpriteCellID=this.start,f.endSpriteCellID=this.end,f.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=f}serialize(){const q=super.serialize();return q.width=this.width,q.height=this.height,q.start=this.start,q.end=this.end,q.randomStartCell=this.randomStartCell,q}_deserialize(q){super._deserialize(q),this.width=q.width,this.height=q.height,this.start=q.start,this.end=q.end,this.randomStartCell=q.randomStartCell}}(0,Y.b)([cf("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rj.prototype,"start",void 0),(0,Y.b)([cf("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rj.prototype,"end",void 0),(0,Y.b)([cf("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rj.prototype,"width",void 0),(0,Y.b)([cf("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rj.prototype,"height",void 0),(0,Y.b)([cf("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rj.prototype,"loop",void 0),(0,Y.b)([cf("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rj.prototype,"randomStartCell",void 0),(0,Q.f)("BABYLON.SetupSpriteSheetBlock",rj);class uj extends Cf{constructor(q){super(q),this.reference=0,this.registerInput("value",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case xf.Float:return xf.FloatGradient;case xf.Vector2:return xf.Vector2Gradient;case xf.kf:return xf.Vector3Gradient;case xf.wd:return xf.Color4Gradient}return q},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xf.Float|xf.Vector2|xf.kf|xf.wd)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=q=>null}serialize(){const q=super.serialize();return q.reference=this.reference,q}_deserialize(q){super._deserialize(q),this.reference=q.reference}}(0,Y.b)([cf("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],uj.prototype,"reference",void 0),(0,Q.f)("BABYLON.ParticleGradientValueBlock",uj);(0,Q.f)("BABYLON.ParticleGradientBlock",class extends Cf{constructor(q){super(q),this._entryCount=1,this.registerInput("gradient",xf.Float,!0,1,0,1),this.registerInput("value0",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case xf.FloatGradient:return xf.Float;case xf.Vector2Gradient:return xf.Vector2;case xf.Vector3Gradient:return xf.kf;case xf.Color4Gradient:return xf.wd}return q},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(xf.FloatGradient|xf.Vector2Gradient|xf.Vector3Gradient|xf.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(q){this._inputs[q].onConnectionObservable.add((()=>{this._entryCount>q||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),xf.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const q=[];for(let j=1;j<this._inputs.length;j++){var f;if(this._inputs[j].isConnected)q.push(null===(f=this._inputs[j].connectedPoint)||void 0===f?void 0:f.ownerBlock)}q.sort(((q,f)=>q.reference-f.reference)),this.output._storedFunction=f=>{const j=this.gradient.getConnectedValue(f);if(1===q.length)return q[0].value.getConnectedValue(f);let g=null;for(let h=q.length-1;h>=0;h--){const Q=q[h];if(Q.reference<=j){const q=Q.value.getConnectedValue(f);if(g){const h=g.value.getConnectedValue(f),H=g.reference,u=Q.reference,X=Math.max(0,Math.min(1,(j-u)/(H-u)));switch(this.output.type){case xf.Float:return(0,r.Lerp)(q,h,X);case xf.Vector2:return d.i.Lerp(q,h,X);case xf.kf:return d.j.Lerp(q,h,X);case xf.wd:return L.e.Lerp(q,h,X)}}return q}g=Q}return 0}}});(0,Q.f)("BABYLON.ParticleConverterBlock",class extends Cf{constructor(q){super(q),this.registerInput("color ",xf.wd,!0),this.registerInput("xyz ",xf.kf,!0),this.registerInput("xy ",xf.Vector2,!0),this.registerInput("zw ",xf.Vector2,!0),this.registerInput("x ",xf.Float,!0),this.registerInput("y ",xf.Float,!0),this.registerInput("z ",xf.Float,!0),this.registerInput("w ",xf.Float,!0),this.registerOutput("color",xf.wd),this.registerOutput("xyz",xf.kf),this.registerOutput("xy",xf.Vector2),this.registerOutput("zw",xf.Vector2),this.registerOutput("x",xf.Float),this.registerOutput("y",xf.Float),this.registerOutput("z",xf.Float),this.registerOutput("w",xf.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(q){return"color "===q?"colorIn":"xyz "===q?"xyzIn":"xy "===q?"xyIn":"zw "===q?"zwIn":"x "===q?"xIn":"y "===q?"yIn":"z "===q?"zIn":"w "===q?"wIn":q}_outputRename(q){switch(q){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return q}}_build(q){super._build(q);const f=this.xIn,j=this.yIn,g=this.zIn,h=this.wIn,Q=this.xyIn,H=this.zwIn,r=this.xyzIn,u=this.colorIn,X=this.colorOut,z=this.xyzOut,B=this.xyOut,D=this.zwOut,i=this.xOut,t=this.yOut,O=this.zOut,N=this.wOut,w=q=>{if(u.isConnected)return u.getConnectedValue(q);let d=0,X=0,z=0,B=0;if(f.isConnected&&(d=f.getConnectedValue(q)),j.isConnected&&(X=j.getConnectedValue(q)),g.isConnected&&(z=g.getConnectedValue(q)),h.isConnected&&(B=h.getConnectedValue(q)),Q.isConnected){const f=Q.getConnectedValue(q);f&&(d=f.x,X=f.y)}if(H.isConnected){const f=H.getConnectedValue(q);f&&(z=f.x,B=f.y)}if(r.isConnected){const f=r.getConnectedValue(q);f&&(d=f.x,X=f.y,z=f.z)}return new L.e(d,X,z,B)};X._storedFunction=q=>w(q),z._storedFunction=q=>{const f=w(q);return new d.j(f.r,f.g,f.b)},B._storedFunction=q=>{const f=w(q);return new d.i(f.r,f.g)},D._storedFunction=q=>{const f=w(q);return new d.i(f.b,f.a)},i._storedFunction=q=>w(q).r,t._storedFunction=q=>w(q).g,O._storedFunction=q=>w(q).b,N._storedFunction=q=>w(q).a}}),function(q){q[q.Cos=0]="Cos",q[q.Sin=1]="Sin",q[q.Abs=2]="Abs",q[q.Exp=3]="Exp",q[q.Exp2=4]="Exp2",q[q.Round=5]="Round",q[q.Floor=6]="Floor",q[q.Ceiling=7]="Ceiling",q[q.Sqrt=8]="Sqrt",q[q.Log=9]="Log",q[q.Tan=10]="Tan",q[q.ArcTan=11]="ArcTan",q[q.ArcCos=12]="ArcCos",q[q.ArcSin=13]="ArcSin",q[q.Sign=14]="Sign",q[q.Negate=15]="Negate",q[q.OneMinus=16]="OneMinus",q[q.Reciprocal=17]="Reciprocal",q[q.ToDegrees=18]="ToDegrees",q[q.ToRadians=19]="ToRadians",q[q.Fract=20]="Fract"}(af||(af={}));class Xj extends Cf{constructor(q){super(q),this.operation=af.Cos,this.registerInput("input",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xf.Float|xf.Int|xf.Vector2|xf.kf|xf.wd)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);let f=null;switch(this.operation){case af.Cos:f=q=>Math.cos(q);break;case af.Sin:f=q=>Math.sin(q);break;case af.Abs:f=q=>Math.abs(q);break;case af.Exp:f=q=>Math.exp(q);break;case af.Exp2:f=q=>Math.pow(2,q);break;case af.Round:f=q=>Math.round(q);break;case af.Floor:f=q=>Math.floor(q);break;case af.Ceiling:f=q=>Math.ceil(q);break;case af.Sqrt:f=q=>Math.sqrt(q);break;case af.Log:f=q=>Math.log(q);break;case af.Tan:f=q=>Math.tan(q);break;case af.ArcTan:f=q=>Math.atan(q);break;case af.ArcCos:f=q=>Math.acos(q);break;case af.ArcSin:f=q=>Math.asin(q);break;case af.Sign:f=q=>Math.sign(q);break;case af.Negate:f=q=>-q;break;case af.OneMinus:f=q=>1-q;break;case af.Reciprocal:f=q=>1/q;break;case af.ToRadians:f=q=>q*Math.PI/180;break;case af.ToDegrees:f=q=>180*q/Math.PI;break;case af.Fract:f=q=>q>=0?q-Math.floor(q):q-Math.ceil(q)}if(!f)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case xf.Int:case xf.Float:this.output._storedFunction=q=>{const j=this.input.getConnectedValue(q);return f(j)};break;case xf.Vector2:this.output._storedFunction=q=>{const j=this.input.getConnectedValue(q);return new d.i(f(j.x),f(j.y))};break;case xf.kf:this.output._storedFunction=q=>{const j=this.input.getConnectedValue(q);return new d.j(f(j.x),f(j.y),f(j.z))};break;case xf.wd:this.output._storedFunction=q=>{const j=this.input.getConnectedValue(q);return new L.e(f(j.r),f(j.g),f(j.b),f(j.a))}}return this}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,Y.b)([cf("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:af.Cos},{label:"Sin",value:af.Sin},{label:"Abs",value:af.Abs},{label:"Exp",value:af.Exp},{label:"Exp2",value:af.Exp2},{label:"Round",value:af.Round},{label:"Floor",value:af.Floor},{label:"Ceiling",value:af.Ceiling},{label:"Sqrt",value:af.Sqrt},{label:"Log",value:af.Log},{label:"Tan",value:af.Tan},{label:"ArcTan",value:af.ArcTan},{label:"ArcCos",value:af.ArcCos},{label:"ArcSin",value:af.ArcSin},{label:"Sign",value:af.Sign},{label:"Negate",value:af.Negate},{label:"OneMinus",value:af.OneMinus},{label:"Reciprocal",value:af.Reciprocal},{label:"ToDegrees",value:af.ToDegrees},{label:"ToRadians",value:af.ToRadians},{label:"Fract",value:af.Fract}]})],Xj.prototype,"operation",void 0),(0,Q.f)("BABYLON.ParticleTrigonometryBlock",Xj);var zj,Bj=j(12406);class Dj extends Cf{constructor(q){super(q),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(xf.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(xf.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(xf.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(xf.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(xf.System),this._inputs[0].excludedConnectionPointTypes.push(xf.Particle),this._inputs[0].excludedConnectionPointTypes.push(xf.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const f=q=>{const f=this.input.getConnectedValue(q);if(this.log.length>=this.stackSize)return f;if(null===f||void 0===f)return this.log.push(["null",""]),f;switch(this.input.type){case xf.Vector2:this.log.push([(0,Bj.h)(f,4),f.toString()]);break;case xf.kf:this.log.push([(0,Bj.i)(f,4),f.toString()]);break;case xf.wd:this.log.push([`{R: ${f.r.toFixed(4)} G: ${f.g.toFixed(4)} B: ${f.b.toFixed(4)} A: ${f.a.toFixed(4)}}`,f.toString()]);break;default:this.log.push([f.toString(),f.toString()])}return f};this.output.isConnected?this.output._storedFunction=f:this.output._storedValue=f(q)}serialize(){const q=super.serialize();return q.stackSize=this.stackSize,q}_deserialize(q){super._deserialize(q),this.stackSize=q.stackSize}}(0,Y.b)([cf("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Dj.prototype,"stackSize",void 0),(0,Q.f)("BABYLON.ParticleDebugBlock",Dj);(0,Q.f)("BABYLON.ParticleElbowBlock",class extends Cf{constructor(q){super(q),this.registerInput("input",xf.AutoDetect),this.registerOutput("output",xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const f=this._outputs[0],j=this._inputs[0];f._storedFunction=q=>j.getConnectedValue(q)}});(0,Q.f)("BABYLON.ParticleTeleportInBlock",class extends Cf{get endpoints(){return this._endpoints}constructor(q){super(q),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",xf.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const f of this.endpoints)if(f.isAnAncestorOfType(q))return!0;return!1}isAnAncestorOf(q){for(const f of this.endpoints){if(f===q)return!0;if(f.isAnAncestorOf(q))return!0}return!1}attachToEndpoint(q){q.detach(),this._endpoints.push(q),q._entryPoint=this,q._outputs[0]._typeConnectionSource=this._inputs[0],q._tempEntryPointUniqueId=null,q.name="> "+this.name}detachFromEndpoint(q){const f=this._endpoints.indexOf(q);-1!==f&&(this._endpoints.splice(f,1),q._outputs[0]._typeConnectionSource=null,q._entryPoint=null)}_build(){for(const q of this._endpoints)q.output._storedFunction=q=>this.input.getConnectedValue(q)}});(0,Q.f)("BABYLON.ParticleTeleportOutBlock",class extends Cf{constructor(q){super(q),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",xf.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(q){this.entryPoint&&this.entryPoint.build(q)}clone(){const q=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(q),q}serialize(){var q;const f=super.serialize();return f.entryPoint=(null===(q=this.entryPoint)||void 0===q?void 0:q.uniqueId)??"",f}_deserialize(q){super._deserialize(q),this._tempEntryPointUniqueId=q.entryPoint}}),function(q){q[q.Equal=0]="Equal",q[q.NotEqual=1]="NotEqual",q[q.LessThan=2]="LessThan",q[q.GreaterThan=3]="GreaterThan",q[q.LessOrEqual=4]="LessOrEqual",q[q.GreaterOrEqual=5]="GreaterOrEqual",q[q.Xor=6]="Xor",q[q.Or=7]="Or",q[q.And=8]="And"}(zj||(zj={}));class ij extends Cf{constructor(q){super(q),this.test=zj.Equal,this.epsilon=0,this.registerInput("left",xf.Float),this.registerInput("right",xf.Float,!0,0),this.registerInput("ifTrue",xf.AutoDetect,!0,1),this.registerInput("ifFalse",xf.AutoDetect,!0,0),this.registerOutput("output",xf.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=xf.Float,this._inputs[0].acceptedConnectionPointTypes.push(xf.Int),this._inputs[1].acceptedConnectionPointTypes.push(xf.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const q=q=>{const f=this.left.getConnectedValue(q),j=this.right.getConnectedValue(q);let d=!1;switch(this.test){case zj.Equal:d=(0,r.WithinEpsilon)(f,j,this.epsilon);break;case zj.NotEqual:d=!(0,r.WithinEpsilon)(f,j,this.epsilon);break;case zj.LessThan:d=f<j+this.epsilon;break;case zj.GreaterThan:d=f>j-this.epsilon;break;case zj.LessOrEqual:d=f<=j+this.epsilon;break;case zj.GreaterOrEqual:d=f>=j-this.epsilon;break;case zj.Xor:d=!!f&&!j||!f&&!!j;break;case zj.Or:d=!!f||!!j;break;case zj.And:d=!!f&&!!j}return d};this.output._storedFunction=f=>q(f)?this.ifTrue.getConnectedValue(f):this.ifFalse.getConnectedValue(f)}serialize(){const q=super.serialize();return q.test=this.test,q.epsilon=this.epsilon,q}_deserialize(q){super._deserialize(q),this.test=q.test,void 0!==q.epsilon&&(this.epsilon=q.epsilon)}}(0,Y.b)([cf("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:zj.Equal},{label:"NotEqual",value:zj.NotEqual},{label:"LessThan",value:zj.LessThan},{label:"GreaterThan",value:zj.GreaterThan},{label:"LessOrEqual",value:zj.LessOrEqual},{label:"GreaterOrEqual",value:zj.GreaterOrEqual},{label:"Xor",value:zj.Xor},{label:"Or",value:zj.Or},{label:"And",value:zj.And}]})],ij.prototype,"test",void 0),(0,Y.b)([cf("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ij.prototype,"epsilon",void 0),(0,Q.f)("BABYLON.ParticleConditionBlock",ij);class tj extends Cf{constructor(q){super(q),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",xf.Particle),this.registerInput("condition",xf.Float,!0,0),this.registerInput("system",xf.System),this.registerOutput("output",xf.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){this._triggerCount=0;const f=this.input.getConnectedValue(q),j={process:j=>{if(q.particleContext=j,q.systemContext=f,0!==this.condition.getConnectedValue(q)&&(0===this.limit||this._triggerCount<this.limit)){const d=(new Date).getTime();if(this._previousOne&&d-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=d;const g=this.system.getConnectedValue(q);if(g){const d=mf(g,q.Sf,j.position);d.qd.addOnce((()=>{this._triggerCount--})),f.qd.addOnce((()=>{d.dispose()}))}}},previousItem:null,nextItem:null};f._updateQueueStart?yq(j,f._updateQueueStart):f._updateQueueStart=j,this.output._storedValue=f}serialize(){const q=super.serialize();return q.limit=this.limit,q.delay=this.delay,q}_deserialize(q){super._deserialize(q),void 0!==q.limit&&(this.limit=q.limit),void 0!==q.delay&&(this.delay=q.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,Y.b)([cf("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tj.prototype,"limit",void 0),(0,Y.b)([cf("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tj.prototype,"delay",void 0),(0,Q.f)("BABYLON.ParticleTriggerBlock",tj);j(12413),j(12420),j(12432),j(12481)},12461:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneFragment",h="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12437:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneFragmentDeclaration",h="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12499:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneVertex",h="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12484:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneVertexDeclaration",h="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12476:(q,f,j)=>{"use strict";var d=j(11075);const g="fogFragment",h="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12459:(q,f,j)=>{"use strict";var d=j(11075);const g="fogFragmentDeclaration",h="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12507:(q,f,j)=>{"use strict";var d=j(11075);const g="fogVertex",h="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12490:(q,f,j)=>{"use strict";var d=j(11075);const g="fogVertexDeclaration",h="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12448:(q,f,j)=>{"use strict";var d=j(11075);const g="helperFunctions",h="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12443:(q,f,j)=>{"use strict";var d=j(11075);const g="imageProcessingDeclaration",h="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12450:(q,f,j)=>{"use strict";var d=j(11075);const g="imageProcessingFunctions",h="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12446:(q,f,j)=>{"use strict";var d=j(11075);const g="logDepthDeclaration",h="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12468:(q,f,j)=>{"use strict";var d=j(11075);const g="logDepthFragment",h="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12511:(q,f,j)=>{"use strict";var d=j(11075);const g="logDepthVertex",h="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";d.b.IncludesShadersStoreWGSL[g]||(d.b.IncludesShadersStoreWGSL[g]=h)},12432:(q,f,j)=>{"use strict";j.r(f),j.d(f,{particlesPixelShaderWGSL:()=>L});var d=j(11075);j(12437),j(12443),j(12446),j(12448),j(12450),j(12459),j(12461),j(12468),j(12476);const g="particlesPixelShader",h="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";d.b.ShadersStoreWGSL[g]||(d.b.ShadersStoreWGSL[g]=h);const L={name:g,shader:h}},12481:(q,f,j)=>{"use strict";j.r(f),j.d(f,{particlesVertexShaderWGSL:()=>L});var d=j(11075);j(12484),j(12490),j(12446),j(12499),j(12507),j(12511);const g="particlesVertexShader",h="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.b.ShadersStoreWGSL[g]||(d.b.ShadersStoreWGSL[g]=h);const L={name:g,shader:h}},12358:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneFragment",h="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12417:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneFragmentDeclaration",h="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12373:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneVertex",h="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12425:(q,f,j)=>{"use strict";var d=j(11075);const g="clipPlaneVertexDeclaration",h="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12363:(q,f,j)=>{"use strict";var d=j(11075);const g="fogFragment",h="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12356:(q,f,j)=>{"use strict";var d=j(11075);const g="fogFragmentDeclaration",h="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12376:(q,f,j)=>{"use strict";var d=j(11075);const g="fogVertex",h="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12371:(q,f,j)=>{"use strict";var d=j(11075);const g="fogVertexDeclaration",h="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12346:(q,f,j)=>{"use strict";var d=j(11075);const g="helperFunctions",h="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12336:(q,f,j)=>{"use strict";var d=j(11075);const g="imageProcessingDeclaration",h="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12348:(q,f,j)=>{"use strict";var d=j(11075);const g="imageProcessingFunctions",h="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12340:(q,f,j)=>{"use strict";var d=j(11075);const g="logDepthDeclaration",h="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12361:(q,f,j)=>{"use strict";var d=j(11075);const g="logDepthFragment",h="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12378:(q,f,j)=>{"use strict";var d=j(11075);const g="logDepthVertex",h="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";d.b.IncludesShadersStore[g]||(d.b.IncludesShadersStore[g]=h)},12413:(q,f,j)=>{"use strict";j.r(f),j.d(f,{particlesPixelShader:()=>L});var d=j(11075);j(12417),j(12336),j(12340),j(12346),j(12348),j(12356),j(12358),j(12361),j(12363);const g="particlesPixelShader",h="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";d.b.ShadersStore[g]||(d.b.ShadersStore[g]=h);const L={name:g,shader:h}},12420:(q,f,j)=>{"use strict";j.r(f),j.d(f,{particlesVertexShader:()=>L});var d=j(11075);j(12425),j(12371),j(12340),j(12373),j(12376),j(12378);const g="particlesVertexShader",h="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.b.ShadersStore[g]||(d.b.ShadersStore[g]=h);const L={name:g,shader:h}},12758:(q,f,j)=>{"use strict";j.r(f),j.d(f,{FlowGraphGLTFDataProvider:()=>h});var d=j(12726),g=j(12709);class h extends d.e{constructor(q){var f,j;super();const d=q.glTF,h=(null===(f=d.animations)||void 0===f?void 0:f.map((q=>q._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",g.c,h);const L=(null===(j=d.nodes)||void 0===j?void 0:j.map((q=>q._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",g.c,L)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12653:(q,f,j)=>{"use strict";j.d(f,{e:()=>t,i:()=>D,m:()=>B,p:()=>i});var d=j(10941),g=j(11472),h=j(11210),L=j(12657);const Q=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class H{constructor(q,f){this._gltf=q,this._infoTree=f}convert(q){let f,j=this._gltf,d=this._infoTree;if(!q.startsWith("/"))throw new Error("Path must start with a /");const g=q.split("/");if(g.shift(),g[g.length-1].includes(".length")){const q=g[g.length-1].split(".");g.pop(),g.push(...q)}let h=!1;for(const H of g){const g="length"===H;if(g&&!d.__array__)throw new Error(`Path ${q} is invalid`);if(d.__ignoreObjectTree__&&(h=!0),d.__array__&&!g)d=d.__array__;else if(d=d[H],!d)throw new Error(`Path ${q} is invalid`);if(!h)if(void 0===j){if(!Q.find((f=>f.regex.test(q))))throw new Error(`Path ${q} is invalid`)}else if(!g){var L;j=null===(L=j)||void 0===L?void 0:L[H]}(d.__target__||g)&&(f=j)}return{object:f,info:d}}}function r(q,f,j,d){const g=u(q,f);return d?g[j][d]:g[j]}function u(q,f,j){var d,h;return null===(d=q._data)||void 0===d||null===(h=d[(null===j||void 0===j?void 0:j.fillMode)??g.b.MATERIAL_TriangleFillMode])||void 0===h?void 0:h.babylonMaterial}function X(q,f){return{offset:{componentsCount:2,type:"Vector2",get:(j,g,h)=>{const L=r(j,h,q,f);return new d.i(null===L||void 0===L?void 0:L.uOffset,null===L||void 0===L?void 0:L.vOffset)},getTarget:u,set:(j,d,g,h)=>{const L=r(d,h,q,f);L.uOffset=j.x,L.vOffset=j.y},getPropertyName:[()=>`${q}${f?"."+f:""}.uOffset`,()=>`${q}${f?"."+f:""}.vOffset`]},rotation:{type:"number",get:(j,d,g)=>{var h;return null===(h=r(j,g,q,f))||void 0===h?void 0:h.wAng},getTarget:u,set:(j,d,g,h)=>r(d,h,q,f).wAng=j,getPropertyName:[()=>`${q}${f?"."+f:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(j,g,h)=>{const L=r(j,h,q,f);return new d.i(null===L||void 0===L?void 0:L.uScale,null===L||void 0===L?void 0:L.vScale)},getTarget:u,set:(j,d,g,h)=>{const L=r(d,h,q,f);L.uScale=j.x,L.vScale=j.y},getPropertyName:[()=>`${q}${f?"."+f:""}.uScale`,()=>`${q}${f?"."+f:""}.vScale`]}}}const z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:q=>{var f,j;return new d.i((null===(f=q._babylonCamera)||void 0===f?void 0:f.orthoLeft)??0,(null===(j=q._babylonCamera)||void 0===j?void 0:j.orthoRight)??0)},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.orthoLeft=q.x,f._babylonCamera.orthoRight=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:q=>{var f,j;return new d.i((null===(f=q._babylonCamera)||void 0===f?void 0:f.orthoBottom)??0,(null===(j=q._babylonCamera)||void 0===j?void 0:j.orthoTop)??0)},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.orthoBottom=q.x,f._babylonCamera.orthoTop=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:q=>{var f;return null===(f=q._babylonCamera)||void 0===f?void 0:f.maxZ},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var f;return null===(f=q._babylonCamera)||void 0===f?void 0:f.gd},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.gd=q)},getTarget:q=>q,getPropertyName:[()=>"gd"]}},perspective:{aspectRatio:{type:"number",get:q=>{var f;return null===(f=q._babylonCamera)||void 0===f?void 0:f.getEngine().getAspectRatio(q._babylonCamera)},getTarget:q=>q,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:q=>{var f;return null===(f=q._babylonCamera)||void 0===f?void 0:f.fov},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.fov=q)},getTarget:q=>q,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:q=>{var f;return null===(f=q._babylonCamera)||void 0===f?void 0:f.maxZ},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var f;return null===(f=q._babylonCamera)||void 0===f?void 0:f.gd},set:(q,f)=>{f._babylonCamera&&(f._babylonCamera.gd=q)},getTarget:q=>q,getPropertyName:[()=>"gd"]}}}},nodes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"kf",get:q=>{var f;return null===(f=q._babylonTransformNode)||void 0===f?void 0:f.position},set:(q,f)=>{var j;return null===(j=f._babylonTransformNode)||void 0===j?void 0:j.position.H(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:q=>{var f;return null===(f=q._babylonTransformNode)||void 0===f?void 0:f.rotationQuaternion},set:(q,f)=>{var j,d;return null===(j=f._babylonTransformNode)||void 0===j||null===(d=j.rotationQuaternion)||void 0===d?void 0:d.H(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"kf",get:q=>{var f;return null===(f=q._babylonTransformNode)||void 0===f?void 0:f.Vf},set:(q,f)=>{var j;return null===(j=f._babylonTransformNode)||void 0===j?void 0:j.Vf.H(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"Vf"]},weights:{length:{type:"number",get:q=>q._numMorphTargets,getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(q,f)=>{var j,d;return void 0!==f?null===(j=q._primitiveBabylonMeshes)||void 0===j||null===(d=j[0].morphTargetManager)||void 0===d?void 0:d.getTarget(f).influence:void 0},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(q,f)=>[0],getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:q=>{var f,j,g;return d.b.Compose(null===(f=q._babylonTransformNode)||void 0===f?void 0:f.Vf,null===(j=q._babylonTransformNode)||void 0===j?void 0:j.rotationQuaternion,null===(g=q._babylonTransformNode)||void 0===g?void 0:g.position)},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:q=>{var f,j,g,h;const L=d.b.Identity();let Q=q.parent;for(;Q&&Q.parent;)Q=Q.parent;const H=(null===(f=q._babylonTransformNode)||void 0===f?void 0:f.position._isDirty)||(null===(j=q._babylonTransformNode)||void 0===j||null===(g=j.rotationQuaternion)||void 0===g?void 0:g._isDirty)||(null===(h=q._babylonTransformNode)||void 0===h?void 0:h.Vf._isDirty);if(Q){var r;const f=null===(r=Q._babylonTransformNode)||void 0===r?void 0:r.Nf(!0).invert();var u,X;if(f)null===(u=q._babylonTransformNode)||void 0===u||null===(X=u.Nf(H))||void 0===X||X.multiplyToRef(f,L)}else q._babylonTransformNode&&L.H(q._babylonTransformNode.Nf(H));return L},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:q=>{var f,j;return null===(f=q._babylonTransformNode)||void 0===f||null===(j=f.getChildren((q=>q instanceof L.b),!0)[0])||void 0===j?void 0:j.Xd},getTarget:q=>{var f;return null===(f=q._babylonTransformNode)||void 0===f?void 0:f.getChildren((q=>q instanceof L.b),!0)[0]},set:(q,f)=>{if(f._babylonTransformNode){const j=f._babylonTransformNode.getChildren((q=>q instanceof L.b),!0)[0];j&&(j.Xd=q)}}},color:{type:"o",get:q=>{var f,j;return null===(f=q._babylonTransformNode)||void 0===f||null===(j=f.getChildren((q=>q instanceof L.b),!0)[0])||void 0===j?void 0:j.zd},getTarget:q=>{var f;return null===(f=q._babylonTransformNode)||void 0===f?void 0:f.getChildren((q=>q instanceof L.b),!0)[0]},set:(q,f)=>{if(f._babylonTransformNode){const j=f._babylonTransformNode.getChildren((q=>q instanceof L.b),!0)[0];j&&(j.zd=q)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"o",get:(q,f,j)=>u(q,f,j).emissiveColor,set:(q,f,j,d)=>u(f,j,d).emissiveColor.H(q),getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:X("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(q,f,j)=>{var d;return null===(d=r(q,j,"bumpTexture"))||void 0===d?void 0:d.level},set:(q,f,j,d)=>{const g=r(f,d,"bumpTexture");g&&(g.level=q)},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:X("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(q,f,j)=>u(q,f,j).ambientTextureStrength,set:(q,f,j,d)=>{const g=u(f,j,d);g&&(g.ambientTextureStrength=q)},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:X("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"wd",get:(q,f,j)=>{const d=u(q,f,j);return h.e.FromColor3(d.albedoColor,d.alpha)},set:(q,f,j,d)=>{const g=u(f,j,d);g.albedoColor.set(q.r,q.g,q.b),g.alpha=q.a},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:X("albedoTexture")}},metallicFactor:{type:"number",get:(q,f,j)=>u(q,f,j).metallic,set:(q,f,j,d)=>{const g=u(f,j,d);g&&(g.metallic=q)},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(q,f,j)=>u(q,f,j).roughness,set:(q,f,j,d)=>{const g=u(f,j,d);g&&(g.roughness=q)},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:X("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(q,f,j)=>u(q,f,j).anisotropy.Xd,set:(q,f,j,d)=>{u(f,j,d).anisotropy.Xd=q},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(q,f,j)=>u(q,f,j).anisotropy.angle,set:(q,f,j,d)=>{u(f,j,d).anisotropy.angle=q},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:X("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(q,f,j)=>u(q,f,j).clearCoat.Xd,set:(q,f,j,d)=>{u(f,j,d).clearCoat.Xd=q},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(q,f,j)=>u(q,f,j).clearCoat.roughness,set:(q,f,j,d)=>{u(f,j,d).clearCoat.roughness=q},getTarget:(q,f,j)=>u(q,f,j),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:X("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(q,f,j)=>{var d;return null===(d=u(q,f,j).clearCoat.bumpTexture)||void 0===d?void 0:d.level},getTarget:u,set:(q,f,j,d)=>u(f,j,d).clearCoat.bumpTexture.level=q},extensions:{KHR_texture_transform:X("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:X("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(q,f,j)=>u(q,f,j).subSurface.dispersion,getTarget:u,set:(q,f,j,d)=>u(f,j,d).subSurface.dispersion=q}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(q,f,j)=>u(q,f,j).emissiveIntensity,getTarget:u,set:(q,f,j,d)=>u(f,j,d).emissiveIntensity=q}},KHR_materials_ior:{ior:{type:"number",get:(q,f,j)=>u(q,f,j).indexOfRefraction,getTarget:u,set:(q,f,j,d)=>u(f,j,d).indexOfRefraction=q}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(q,f,j)=>u(q,f,j).iridescence.Xd,getTarget:u,set:(q,f,j,d)=>u(f,j,d).iridescence.Xd=q},iridescenceIor:{type:"number",get:(q,f,j)=>u(q,f,j).iridescence.indexOfRefraction,getTarget:u,set:(q,f,j,d)=>u(f,j,d).iridescence.indexOfRefraction=q},iridescenceTexture:{extensions:{KHR_texture_transform:X("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(q,f,j)=>u(q,f,j).iridescence.maximumThickness,getTarget:u,set:(q,f,j,d)=>u(f,j,d).iridescence.maximumThickness=q},iridescenceThicknessMinimum:{type:"number",get:(q,f,j)=>u(q,f,j).iridescence.minimumThickness,getTarget:u,set:(q,f,j,d)=>u(f,j,d).iridescence.minimumThickness=q},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:X("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"o",get:(q,f,j)=>u(q,f,j).sheen.color,getTarget:u,set:(q,f,j,d)=>u(f,j,d).sheen.color.H(q)},sheenColorTexture:{extensions:{KHR_texture_transform:X("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(q,f,j)=>u(q,f,j).sheen.Xd,getTarget:u,set:(q,f,j,d)=>u(f,j,d).sheen.Xd=q},sheenRoughnessTexture:{extensions:{KHR_texture_transform:X("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(q,f,j)=>u(q,f,j).metallicF0Factor,getTarget:u,set:(q,f,j,d)=>u(f,j,d).metallicF0Factor=q,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"o",get:(q,f,j)=>u(q,f,j).metallicReflectanceColor,getTarget:u,set:(q,f,j,d)=>u(f,j,d).metallicReflectanceColor.H(q),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:X("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:X("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(q,f,j)=>u(q,f,j).subSurface.refractionIntensity,getTarget:u,set:(q,f,j,d)=>u(f,j,d).subSurface.refractionIntensity=q,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:X("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(q,f,j)=>u(q,f,j).subSurface.translucencyIntensity,getTarget:u,set:(q,f,j,d)=>u(f,j,d).subSurface.translucencyIntensity=q},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:X("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"o",get:(q,f,j)=>u(q,f,j).subSurface.translucencyColor,getTarget:u,set:(q,f,j,d)=>{var g;return q&&(null===(g=u(f,j,d).subSurface.translucencyColor)||void 0===g?void 0:g.H(q))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:X("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"o",get:(q,f,j)=>u(q,f,j).subSurface.tintColor,getTarget:u,set:(q,f,j,d)=>u(f,j,d).subSurface.tintColor.H(q)},attenuationDistance:{type:"number",get:(q,f,j)=>u(q,f,j).subSurface.tintColorAtDistance,getTarget:u,set:(q,f,j,d)=>u(f,j,d).subSurface.tintColorAtDistance=q},thicknessFactor:{type:"number",get:(q,f,j)=>u(q,f,j).subSurface.maximumThickness,getTarget:u,set:(q,f,j,d)=>u(f,j,d).subSurface.maximumThickness=q},thicknessTexture:{extensions:{KHR_texture_transform:X("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,color:{type:"o",get:q=>{var f;return null===(f=q._babylonLight)||void 0===f?void 0:f.zd},set:(q,f)=>{var j;return null===(j=f._babylonLight)||void 0===j?void 0:j.zd.H(q)},getTarget:q=>q._babylonLight,getPropertyName:[q=>"diffuse"]},Xd:{type:"number",get:q=>{var f;return null===(f=q._babylonLight)||void 0===f?void 0:f.Xd},set:(q,f)=>f._babylonLight?f._babylonLight.Xd=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"intensity"]},range:{type:"number",get:q=>{var f;return null===(f=q._babylonLight)||void 0===f?void 0:f.range},set:(q,f)=>f._babylonLight?f._babylonLight.range=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"range"]},spot:{innerConeAngle:{type:"number",get:q=>{var f;return null===(f=q._babylonLight)||void 0===f?void 0:f.innerAngle},set:(q,f)=>f._babylonLight?f._babylonLight.innerAngle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"innerConeAngle"]},outerConeAngle:{type:"number",get:q=>{var f;return null===(f=q._babylonLight)||void 0===f?void 0:f.angle},set:(q,f)=>f._babylonLight?f._babylonLight.angle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTexture)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,Xd:{type:"number",get:q=>{var f;return null===(f=q._babylonTexture)||void 0===f?void 0:f.level},set:(q,f)=>{f._babylonTexture&&(f._babylonTexture.level=q)},getTarget:q=>q._babylonTexture},rotation:{type:"Quaternion",get:q=>{var f;return q._babylonTexture&&d.e.FromRotationMatrix(null===(f=q._babylonTexture)||void 0===f?void 0:f.getReflectionTextureMatrix())},set:(q,f)=>{var j;f._babylonTexture&&(null!==(j=f._babylonTexture.eq())&&void 0!==j&&j.useRightHandedSystem||(q=d.e.Inverse(q)),d.b.FromQuaternionToRef(q,f._babylonTexture.getReflectionTextureMatrix()))},getTarget:q=>q._babylonTexture}}}}},animations:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>{var f;return null===(f=q.primitives[0]._instanceData)||void 0===f?void 0:f.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function B(q){return new H(q,z)}function D(q){const f=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let j=z;for(const d of f)d&&(j=j[d]);if(j&&j.type&&j.get)return j}function i(q,f){const j=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let d=z;for(const g of j)g&&(d=d[g]);d&&d.type&&d.get&&(d.interpolation=f)}function t(q,f){const j=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let d=z;for(const g of j)if(g){if(!d[g]){if("?"===g){d.__ignoreObjectTree__=!0;continue}d[g]={},"__array__"===g&&(d[g].__target__=!0)}d=d[g]}Object.assign(d,f)}},12659:(q,f,j)=>{"use strict";j.r(f),j.d(f,{AnimationPropertyInfo:()=>r,TransformNodeAnimationPropertyInfo:()=>u,WeightAnimationPropertyInfo:()=>X,getQuaternion:()=>Q,getVector3:()=>L,getWeights:()=>H});var d=j(11609),g=j(10941),h=j(12653);function L(q,f,j,d){return g.j.Pf(f,j).scaleInPlace(d)}function Q(q,f,j,d){return g.e.Pf(f,j).scaleInPlace(d)}function H(q,f,j,d){const g=new Array(q._numMorphTargets);for(let h=0;h<g.length;h++)g[h]=f[j++]*d;return g}class r{constructor(q,f,j,d){this.type=q,this.name=f,this.getValue=j,this.getStride=d}_buildAnimation(q,f,j){const g=new d.e(q,this.name,f,this.type);return g.setKeys(j),g}}class u extends r{buildAnimations(q,f,j,d){const g=[];return g.push({babylonAnimatable:q._babylonTransformNode,babylonAnimation:this._buildAnimation(f,j,d)}),g}}class X extends r{buildAnimations(q,f,j,g){const h=[];if(q._numMorphTargets)for(let L=0;L<q._numMorphTargets;L++){const Q=new d.e(`${f}_${L}`,this.name,j,this.type);if(Q.setKeys(g.map((q=>({frame:q.frame,inTangent:q.inTangent?q.inTangent[L]:void 0,value:q.value[L],outTangent:q.outTangent?q.outTangent[L]:void 0,interpolation:q.interpolation})))),q._primitiveBabylonMeshes)for(const f of q._primitiveBabylonMeshes)if(f.morphTargetManager){const q=f.morphTargetManager.getTarget(L),j=Q.clone();q.animations.push(j),h.push({babylonAnimatable:q,babylonAnimation:j})}}return h}}(0,h.p)("/nodes/{}/translation",[new u(d.e.ANIMATIONTYPE_VECTOR3,"position",L,(()=>3))]),(0,h.p)("/nodes/{}/rotation",[new u(d.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",Q,(()=>4))]),(0,h.p)("/nodes/{}/scale",[new u(d.e.ANIMATIONTYPE_VECTOR3,"Vf",L,(()=>3))]),(0,h.p)("/nodes/{}/weights",[new X(d.e.ANIMATIONTYPE_FLOAT,"influence",H,(q=>q._numMorphTargets))])},12615:(q,f,j)=>{"use strict";class d{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((q,f)=>{this._resolve=q,this._reject=f}))}}var g=j(10941),h=j(11210),L=j(10992),Q=j(11293),H=j(12618),r=j(12628),u=j(10982),X=j(11468),z=j(11609),B=j(11616),D=j(10980),i=j(11005),t=j(11011);class O{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(q){this._useTextureToStoreBoneMatrices=q,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(q,f,j){this.name=q,this.id=f,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=g.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new u.d,this.bones=[],this._scene=j||D.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const d=this._scene.getEngine().getCaps();this._canUseTextureForBones=d.textureFloat&&d.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((q=>!q.getParent()))}getTransformMatrices(q){if(this.needInitialSkinMatrix){if(!q)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return q._bonesTransformMatrices||this.prepare(!0),q._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(q){return this.needInitialSkinMatrix&&q._transformMatrixTexture?q._transformMatrixTexture:this._transformMatrixTexture}eq(){return this._scene}toString(q){let f=`Name: ${this.name}, nBones: ${this.bones.length}`;if(f+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,q){f+=", Ranges: {";let q=!0;for(const j in this._ranges)q&&(f+=", ",q=!1),f+=j;f+="}"}return f}getBoneIndexByName(q){for(let f=0,j=this.bones.length;f<j;f++)if(this.bones[f].name===q)return f;return-1}createAnimationRange(q,f,j){if(!this._ranges[q]){this._ranges[q]=new B.b(q,f,j);for(let d=0,g=this.bones.length;d<g;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].createRange(q,f,j)}}deleteAnimationRange(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let j=0,d=this.bones.length;j<d;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].deleteRange(q,f);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}getAnimationRanges(){const q=[];let f;for(f in this._ranges)q.push(this._ranges[f]);return q}copyAnimationRange(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[f]||!q.getAnimationRange(f))return!1;let d=!0;const g=this._getHighestAnimationFrame()+1,h={},L=q.bones;let Q,H;for(H=0,Q=L.length;H<Q;H++)h[L[H].name]=L[H];this.bones.length!==L.length&&(i.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${L.length}`),d=!1);const r=j&&this.dimensionsAtRest&&q.dimensionsAtRest?this.dimensionsAtRest.divide(q.dimensionsAtRest):null;for(H=0,Q=this.bones.length;H<Q;H++){const q=this.bones[H].name,L=h[q];L?d=d&&this.bones[H].copyAnimationRange(L,f,g,j,r):(i.e.Warn("copyAnimationRange: not same rig, missing source bone "+q),d=!1)}const u=q.getAnimationRange(f);return u&&(this._ranges[f]=new B.b(f,u.from+g,u.to+g)),d}returnToRest(){for(const q of this.bones)-1!==q._index&&q.returnToRest()}_getHighestAnimationFrame(){let q=0;for(let f=0,j=this.bones.length;f<j;f++)if(this.bones[f].animations[0]){const j=this.bones[f].animations[0].getHighestFrame();q<j&&(q=j)}return q}beginAnimation(q,f,j,d){const g=this.getAnimationRange(q);return g?this._scene.beginAnimation(this,g.from,g.to,f,j,d):null}static MakeAnimationAdditive(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;const d=q.getAnimationRange(j);if(!d)return null;const g=q._scene.getAllAnimatablesByTarget(q);let h=null;for(let Q=0;Q<g.length;Q++){const q=g[Q];if(q.fromFrame===(null===d||void 0===d?void 0:d.from)&&q.toFrame===(null===d||void 0===d?void 0:d.to)){h=q;break}}const L=q.getAnimatables();for(let Q=0;Q<L.length;Q++){const q=L[Q].animations;if(q)for(let d=0;d<q.length;d++)z.e.MakeAnimationAdditive(q[d],f,j)}return h&&(h.isAdditive=!0),q}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(q){this._meshesWithPoseMatrix.push(q)}_unregisterMeshWithPoseMatrix(q){const f=this._meshesWithPoseMatrix.indexOf(q);f>-1&&this._meshesWithPoseMatrix.splice(f,1)}_computeTransformMatrices(q,f){this.onBeforeComputeObservable.notifyObservers(this);for(let j=0;j<this.bones.length;j++){const d=this.bones[j];d._childUpdateId++;const g=d.getParent();if(g?d.getLocalMatrix().multiplyToRef(g.getFinalMatrix(),d.getFinalMatrix()):f?d.getLocalMatrix().multiplyToRef(f,d.getFinalMatrix()):d.getFinalMatrix().H(d.getLocalMatrix()),-1!==d._index){const f=null===d._index?j:d._index;d.getAbsoluteInverseBindMatrix().multiplyToArray(d.getFinalMatrix(),q,16*f)}}this._identity.copyToArray(q,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const q=this.eq().getRenderId();if(this._currentRenderId===q)return;this._currentRenderId=q}if(this._numBonesWithLinkedTransformNode>0)for(const q of this.bones)if(q._linkedTransformNode){const f=q._linkedTransformNode;q.position=f.position,f.rotationQuaternion?q.rotationQuaternion=f.rotationQuaternion:q.rotation=f.rotation,q.Vf=f.Vf}if(this.needInitialSkinMatrix)for(const q of this._meshesWithPoseMatrix){const f=q.getPoseMatrix();let j=this._isDirty;if(q._bonesTransformMatrices&&q._bonesTransformMatrices.length===16*(this.bones.length+1)||(q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),j=!0),j){if(this._synchronizedWithMesh!==q){this._synchronizedWithMesh=q;for(const q of this.bones)if(!q.getParent()){q.getBindMatrix().multiplyToRef(f,g.f.Matrix[1]),q._updateAbsoluteBindMatrices(g.f.Matrix[1])}if(this.isUsingTextureForMatrices){const f=4*(this.bones.length+1);q._transformMatrixTexture&&q._transformMatrixTexture.getSize().width===f||(q._transformMatrixTexture&&q._transformMatrixTexture.dispose(),q._transformMatrixTexture=X.c.CreateRGBATexture(q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(q._bonesTransformMatrices,f),this.isUsingTextureForMatrices&&q._transformMatrixTexture&&q._transformMatrixTexture.update(q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=X.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let q=0;q<this.bones.length;q++)this._animatables.push(this.bones[q])}return this._animatables}clone(q,f){const j=new O(q,f||q,this._scene);j.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let d=0;d<this.bones.length;d++){const q=this.bones[d];let f=null;const g=q.getParent();if(g){const q=this.bones.indexOf(g);f=j.bones[q]}const h=new r.e(q.name,j,f,q.getBindMatrix().clone(),q.getRestMatrix().clone());h._index=q._index,q._linkedTransformNode&&h.linkTransformNode(q._linkedTransformNode),t.e.DeepCopy(q.animations,h.animations)}if(this._ranges){j._ranges={};for(const q in this._ranges){const f=this._ranges[q];f&&(j._ranges[q]=f.clone())}}return this._isDirty=!0,j.prepare(!0),j}enableBlending(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const f of this.bones)for(const j of f.animations)j.enableBlending=!0,j.blendingSpeed=q}dispose(){if(this._meshesWithPoseMatrix.length=0,this.eq().stopAnimation(this),this.eq().removeSkeleton(this),this._parentContainer){const q=this._parentContainer.skeletons.indexOf(this);q>-1&&this._parentContainer.skeletons.splice(q,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const q={};q.name=this.name,q.id=this.id,this.dimensionsAtRest&&(q.dimensionsAtRest=this.dimensionsAtRest.Yf()),q.bones=[],q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){var f;const d=this.bones[j],g=d.getParent(),h={parentBoneIndex:g?this.bones.indexOf(g):-1,index:d.getIndex(),name:d.name,id:d.id,matrix:d.getBindMatrix().Yf(),rest:d.getRestMatrix().Yf(),linkedTransformNodeId:null===(f=d.getTransformNode())||void 0===f?void 0:f.id};q.bones.push(h),d.length&&(h.length=d.length),d.metadata&&(h.metadata=d.metadata),d.animations&&d.animations.length>0&&(h.animation=d.animations[0].serialize()),q.ranges=[];for(const f in this._ranges){const j=this._ranges[f];if(!j)continue;const d={};d.name=f,d.from=j.from,d.to=j.to,q.ranges.push(d)}}return q}static Parse(q,f){const j=new O(q.name,q.id,f);let d;for(q.dimensionsAtRest&&(j.dimensionsAtRest=g.j.Pf(q.dimensionsAtRest)),j.needInitialSkinMatrix=q.needInitialSkinMatrix,d=0;d<q.bones.length;d++){const f=q.bones[d],h=q.bones[d].index;let L=null;f.parentBoneIndex>-1&&(L=j.bones[f.parentBoneIndex]);const Q=f.rest?g.b.Pf(f.rest):null,H=new r.e(f.name,j,L,g.b.Pf(f.matrix),Q,null,h);void 0!==f.id&&null!==f.id&&(H.id=f.id),f.length&&(H.length=f.length),f.metadata&&(H.metadata=f.metadata),f.animation&&H.animations.push(z.e.Parse(f.animation)),void 0!==f.linkedTransformNodeId&&null!==f.linkedTransformNodeId&&(j._hasWaitingData=!0,H._waitingTransformNodeId=f.linkedTransformNodeId)}if(q.ranges)for(d=0;d<q.ranges.length;d++){const f=q.ranges[d];j.createAnimationRange(f.name,f.from,f.to)}return j}computeAbsoluteMatrices(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||q)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(q)}getPoseMatrix(){let q=null;return this._meshesWithPoseMatrix.length>0&&(q=this._meshesWithPoseMatrix[0].getPoseMatrix()),q}sortBones(){const q=[],f=new Array(this.bones.length);for(let j=0;j<this.bones.length;j++)this._sortBones(j,q,f);this.bones=q}_sortBones(q,f,j){if(j[q])return;j[q]=!0;const d=this.bones[q];if(!d)return;void 0===d._index&&(d._index=q);const g=d.getParent();g&&this._sortBones(this.bones.indexOf(g),f,j),f.push(d)}setCurrentPoseAsRest(){for(const q of this.bones)q.setCurrentPoseAsRest()}}var N=j(11118),w=j(11483),E=j(11438),s=j(11245),S=j(11151),e=j(11308),Z=j(11249),I=j(11289),T=j(11623),W=j(11298),n=j(12585);class U{set areUpdatesFrozen(q){q?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new W.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,q||(q=D.d.LastCreatedScene),this._scene=q,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const q=this._scene.getEngine().getCaps();this._canUseTextureForTargets=q.canUseGLVertexID&&q.textureFloat&&q.maxVertexTextureImageUnits>0&&q.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return U.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?U.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(q){this._numMaxInfluencers!==q&&(this._numMaxInfluencers=q,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(q){this._useTextureToStoreTargets!==q&&(this._useTextureToStoreTargets=q,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var q;return U.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(q=this._scene)&&void 0!==q&&q.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(q){return this._activeTargets.data[q]}getTarget(q){return this._targets[q]}getTargetByName(q){for(const f of this._targets)if(f.name===q)return f;return null}addTarget(q){this._targets.push(q),this._targetInfluenceChangedObservers.push(q.onInfluenceChanged.add((q=>{this.areUpdatesFrozen&&q&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(q)}))),this._targetDataLayoutChangedObservers.push(q._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(q){const f=this._targets.indexOf(q);f>=0&&(this._targets.splice(f,1),q.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(f,1)[0]),q._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(f,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(q)}_bind(q){q.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),q.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),q.setTexture("morphTargets",this._targetStoreTexture),q.setInt("morphTargetCount",this.numInfluencers)}clone(){const q=new U(this._scene);for(const f of this._targets)q.addTarget(f.clone());return q.enablePositionMorphing=this.enablePositionMorphing,q.enableNormalMorphing=this.enableNormalMorphing,q.enableTangentMorphing=this.enableTangentMorphing,q.enableUVMorphing=this.enableUVMorphing,q.enableUV2Morphing=this.enableUV2Morphing,q.enableColorMorphing=this.enableColorMorphing,q}serialize(){const q={};q.id=this.uniqueId,q.targets=[];for(const f of this._targets)q.targets.push(f.serialize());return q}_syncActiveTargets(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const f=!!this._targetStoreTexture,j=this.isUsingTextureForTargets;(this._mustSynchronize||f!==j)&&(this._mustSynchronize=!1,this.synchronize());let d=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let g=-1;for(const h of this._targets)if(g++,0!==h.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=U.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(h),this._morphTargetTextureIndices[d]=g,this._tempInfluences[d++]=h.influence}this._morphTargetTextureIndices.length!==d&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,d)),this._influences&&this._influences.length===d||(this._influences=new Float32Array(d));for(let h=0;h<d;h++)this._influences[h]=this._tempInfluences[h];if(q&&this._scene)for(const h of this._scene.meshes)h.morphTargetManager===this&&(j?h._markSubMeshesAsAttributesDirty():h._syncGeometryWithMorphTargetManager())}synchronize(){var q;if(!this._scene||this.areUpdatesFrozen)return;const f=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(q=this._targetStoreTexture)||void 0===q||q.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>f.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const j of this._targets){this._supportsPositions=this._supportsPositions&&j.hasPositions,this._supportsNormals=this._supportsNormals&&j.hasNormals,this._supportsTangents=this._supportsTangents&&j.hasTangents,this._supportsUVs=this._supportsUVs&&j.hasUVs,this._supportsUV2s=this._supportsUV2s&&j.hasUV2s,this._supportsColors=this._supportsColors&&j.hasColors;const q=j.vertexCount;if(0===this._vertexCount)this._vertexCount=q;else if(this._vertexCount!==q)return void i.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${j.name}": ${q}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const q=f.getCaps().maxTextureSize;this._textureWidth>q&&(this._textureHeight=Math.ceil(this._textureWidth/q),this._textureWidth=q);const j=this._targets.length,d=new Float32Array(j*this._textureWidth*this._textureHeight*4);let g=0;for(let f=0;f<j;f++){const q=this._targets[f],j=q.getPositions(),h=q.getNormals(),L=q.getUVs(),Q=q.getTangents(),H=q.getUV2s(),r=q.getColors();g=f*this._textureWidth*this._textureHeight*4;for(let f=0;f<this._vertexCount;f++)this._supportsPositions&&j&&(d[g]=j[3*f],d[g+1]=j[3*f+1],d[g+2]=j[3*f+2],g+=4),this._supportsNormals&&h&&(d[g]=h[3*f],d[g+1]=h[3*f+1],d[g+2]=h[3*f+2],g+=4),this._supportsUVs&&L&&(d[g]=L[2*f],d[g+1]=L[2*f+1],g+=4),this._supportsTangents&&Q&&(d[g]=Q[3*f],d[g+1]=Q[3*f+1],d[g+2]=Q[3*f+2],g+=4),this._supportsUV2s&&H&&(d[g]=H[2*f],d[g+1]=H[2*f+1],g+=4),this._supportsColors&&r&&(d[g]=r[4*f],d[g+1]=r[4*f+1],d[g+2]=r[4*f+2],d[g+3]=r[4*f+3],g+=4)}this._targetStoreTexture=n.b.CreateRGBATexture(d,this._textureWidth,this._textureHeight,j,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const j of this._scene.meshes)j.morphTargetManager===this&&j._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const q=this._parentContainer.morphTargetManagers.indexOf(this);q>-1&&this._parentContainer.morphTargetManagers.splice(q,1),this._parentContainer=null}for(const q of this._targets)this._scene.stopAnimation(q)}}static Parse(q,f){const j=new U(f);for(const d of q.targets)j.addTarget(T.d.Parse(d,f));return j}}U.EnableTextureStorage=!0,U.MaxActiveMorphTargetsInVertexAttributeMode=8,U.ConstantTargetCountForTextureMode=0;var Y=j(12636),v=j(11030),F=j(11164);const M=new Map,o=M;function b(q,f,j){x(q)&&i.e.Warn(`Extension with the name '${q}' already exists`),M.set(q,{isGLTFExtension:f,factory:j})}function x(q){return M.delete(q)}var R=j(12653),A=j(11693),k=j(11155);class y{static Get(q,f,j){if(!f||void 0==j||!f[j])throw new Error(`${q}: Failed to find index (${j})`);return f[j]}static TryGet(q,f){return q&&void 0!=f&&q[f]?q[f]:null}static Assign(q){if(q)for(let f=0;f<q.length;f++)q[f].index=f}}function p(q){if(q.min&&q.max){const f=q.min,j=q.max,d=g.f.kf[0].Af(f[0],f[1],f[2]),h=g.f.kf[1].Af(j[0],j[1],j[2]);if(q.normalized&&5126!==q.componentType){let f=1;switch(q.componentType){case 5120:f=127;break;case 5121:f=255;break;case 5122:f=32767;break;case 5123:f=65535}const j=1/f;d.scaleInPlace(j),h.scaleInPlace(j)}return new F.b(d,h)}return null}class l{static RegisterExtension(q,f){b(q,!1,f)}static UnregisterExtension(q){return x(q)}get dd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(q){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=q}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((q=>q.dispose&&q.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(q,f,j,d,g,h){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=f,this._assetContainer=j,this._loadData(d);let h=null;if(q){const f={};if(this._gltf.nodes)for(const q of this._gltf.nodes)q.name&&(f[q.name]=q.index);h=(q instanceof Array?q:[q]).map((q=>{const j=f[q];if(void 0===j)throw new Error(`Failed to find node '${q}'`);return j}))}return await this._loadAsync(g,L,h,(()=>({meshes:this._getMeshes(),ez:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=q,this._loadData(f),await this._loadAsync(j,g,null,(()=>{}))}async _loadAsync(q,f,j,d){return await Promise.resolve().then((async()=>{this._rootUrl=q,this._uniqueRootUrl=!q.startsWith("file:")&&f?q:`${q}${Date.now()}/`,this._fileName=f,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const g=`${Y.i[Y.i.LOADING]} => ${Y.i[Y.i.READY]}`,h=`${Y.i[Y.i.LOADING]} => ${Y.i[Y.i.COMPLETE]}`;this._parent._startPerformanceCounter(g),this._parent._startPerformanceCounter(h),this._parent._setState(Y.i.LOADING),this._extensionsOnLoading();const Q=new Array;if(!this.parent.loadOnlyMaterials)if(j)Q.push(this.loadSceneAsync("/nodes",{nodes:j,index:-1}));else if(void 0!=this._gltf.Sf||this._gltf.scenes&&this._gltf.scenes[0]){const q=y.Get("/scene",this._gltf.scenes,this._gltf.Sf||0);Q.push(this.loadSceneAsync(`/scenes/${q.index}`,q))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let q=0;q<this._gltf.materials.length;++q){const f=this._gltf.materials[q],j="/materials/"+q,d=N.b.TriangleFillMode;Q.push(this._loadMaterialAsync(j,f,null,d,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&Q.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&Q.push(this._compileShadowGeneratorsAsync());const H=Promise.all(Q).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.DH(!0);for(const q of this._babylonScene.materials){const f=q;void 0!==f.maxSimultaneousLights&&(f.maxSimultaneousLights=Math.max(f.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(Y.i.READY),this._skipStartAnimationStep||this._startAnimations(),d()}));return await H.then((q=>(this._parent._endPerformanceCounter(g),L.h.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(h),this._parent._setState(Y.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(q=>{this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()}))})),q)))})).catch((q=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()),q}))}_loadData(q){if(this._gltf=q.json,this._setupData(),q.bin){const f=this._gltf.buffers;if(f&&f[0]&&!f[0].uri){const j=f[0];(j.byteLength<q.bin.byteLength-3||j.byteLength>q.bin.byteLength)&&i.e.Warn(`Binary buffer length (${j.byteLength}) from JSON does not match chunk length (${q.bin.byteLength})`),this._bin=q.bin}else i.e.Warn("Unexpected BIN chunk")}}_setupData(){if(y.Assign(this._gltf.accessors),y.Assign(this._gltf.animations),y.Assign(this._gltf.buffers),y.Assign(this._gltf.bufferViews),y.Assign(this._gltf.cameras),y.Assign(this._gltf.images),y.Assign(this._gltf.materials),y.Assign(this._gltf.meshes),y.Assign(this._gltf.nodes),y.Assign(this._gltf.samplers),y.Assign(this._gltf.scenes),y.Assign(this._gltf.skins),y.Assign(this._gltf.textures),this._gltf.nodes){const q={};for(const j of this._gltf.nodes)if(j.children)for(const f of j.children)q[f]=j.index;const f=this._createRootNode();for(const j of this._gltf.nodes){const d=q[j.index];j.parent=void 0===d?f:this._gltf.nodes[d]}}}async _loadExtensionsAsync(){const q=[];if(o.forEach(((f,j)=>{var d;!1===(null===(d=this.parent.extensionOptions[j])||void 0===d?void 0:d.enabled)?f.isGLTFExtension&&this.isExtensionUsed(j)&&i.e.Warn(`Extension ${j} is used but has been explicitly disabled.`):f.isGLTFExtension&&!this.isExtensionUsed(j)||q.push((async()=>{const q=await f.factory(this);return q.name!==j&&i.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${q.name} !== ${j}`),this._parent.onExtensionLoadedObservable.notifyObservers(q),q})())})),this._extensions.push(...await Promise.all(q)),this._extensions.sort(((q,f)=>(q.order||Number.MAX_VALUE)-(f.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const j of this._gltf.extensionsRequired){if(!this._extensions.some((q=>q.name===j&&q.enabled))){var f;if(!1===(null===(f=this.parent.extensionOptions[j])||void 0===f?void 0:f.enabled))throw new Error(`Required extension ${j} is disabled`);throw new Error(`Required extension ${j} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new I.e("__root__",this._babylonScene);this._rootBabylonMesh=q,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.DH(!1);const f={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Y.f.AUTO:this._babylonScene.useRightHandedSystem||(f.rotation=[0,1,0,0],f.scale=[1,1,-1],l._LoadTransform(f,this._rootBabylonMesh));break;case Y.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(q),f}loadSceneAsync(q,f){const j=this._extensionsLoadSceneAsync(q,f);if(j)return j;const d=new Array;if(this.logOpen(`${q} ${f.name||""}`),f.nodes)for(const g of f.nodes){const f=y.Get(`${q}/nodes/${g}`,this._gltf.nodes,g);d.push(this.loadNodeAsync(`/nodes/${f.index}`,f,(q=>{q.parent=this._rootBabylonMesh})))}for(const g of this._postSceneLoadActions)g();return d.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(d).then((()=>{}))}_forEachPrimitive(q,f){if(q._primitiveBabylonMeshes)for(const j of q._primitiveBabylonMeshes)f(j)}_getGeometries(){const q=[],f=this._gltf.nodes;if(f)for(const j of f)this._forEachPrimitive(j,(f=>{const j=f.wf;j&&-1===q.indexOf(j)&&q.push(j)}));return q}_getMeshes(){const q=[];this._rootBabylonMesh instanceof Z.e&&q.push(this._rootBabylonMesh);const f=this._gltf.nodes;if(f)for(const j of f)this._forEachPrimitive(j,(f=>{q.push(f)}));return q}_getTransformNodes(){const q=[],f=this._gltf.nodes;if(f)for(const j of f)j._babylonTransformNode&&"Ed"===j._babylonTransformNode.getClassName()&&q.push(j._babylonTransformNode),j._babylonTransformNodeForSkin&&q.push(j._babylonTransformNodeForSkin);return q}_getSkeletons(){const q=[],f=this._gltf.skins;if(f)for(const j of f)j._data&&q.push(j._data.babylonSkeleton);return q}_getAnimationGroups(){const q=[],f=this._gltf.animations;if(f)for(const j of f)j._babylonAnimationGroup&&q.push(j._babylonAnimationGroup);return q}_startAnimations(){switch(this._parent.animationStartMode){case Y.d.NONE:break;case Y.d.FIRST:{const q=this._getAnimationGroups();0!==q.length&&q[0].start(!0);break}case Y.d.ALL:{const q=this._getAnimationGroups();for(const f of q)f.start(!0);break}default:return void i.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadNodeAsync(q,f,j);if(d)return d;if(f._babylonTransformNode)throw new Error(`${q}: Invalid recursive node hierarchy`);const g=new Array;this.logOpen(`${q} ${f.name||""}`);const h=d=>{if(l.AddPointerMetadata(d,q),l._LoadTransform(f,d),void 0!=f.camera){const j=y.Get(`${q}/camera`,this._gltf.cameras,f.camera);g.push(this.loadCameraAsync(`/cameras/${j.index}`,j,(q=>{q.parent=d,this._babylonScene.useRightHandedSystem||(d.Vf.x=-1)})))}if(f.children)for(const j of f.children){const f=y.Get(`${q}/children/${j}`,this._gltf.nodes,j);g.push(this.loadNodeAsync(`/nodes/${f.index}`,f,(q=>{q.parent=d})))}j(d)},L=void 0!=f.mesh,Q=this._parent.loadSkins&&void 0!=f.skin;if(!L||Q){const q=f.name||`node${f.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new s.b(q,this._babylonScene);j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==f.mesh?f._babylonTransformNode=j:f._babylonTransformNodeForSkin=j,h(j)}if(L)if(Q){const j=y.Get(`${q}/mesh`,this._gltf.meshes,f.mesh);g.push(this._loadMeshAsync(`/meshes/${j.index}`,f,j,(j=>{const d=f._babylonTransformNodeForSkin;j.metadata=(0,A.b)(d.metadata,j.metadata||{});const h=y.Get(`${q}/skin`,this._gltf.skins,f.skin);g.push(this._loadSkinAsync(`/skins/${h.index}`,f,h,(q=>{this._forEachPrimitive(f,(f=>{f.skeleton=q})),this._postSceneLoadActions.push((()=>{if(void 0!=h.skeleton){const q=y.Get(`/skins/${h.index}/skeleton`,this._gltf.nodes,h.skeleton).parent;f.index===q.index?j.parent=d.parent:j.parent=q._babylonTransformNode}else j.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:d,skinnedNode:j})}))})))})))}else{const j=y.Get(`${q}/mesh`,this._gltf.meshes,f.mesh);g.push(this._loadMeshAsync(`/meshes/${j.index}`,f,j,h))}return this.logClose(),Promise.all(g).then((()=>(this._forEachPrimitive(f,(q=>{const f=q;!f.isAnInstance&&f.wf&&f.wf.useBoundingInfoFromGeometry?q.Fq():q.refreshBoundingInfo(!0,!0)})),f._babylonTransformNode)))}_loadMeshAsync(q,f,j,d){const g=j.primitives;if(!g||!g.length)throw new Error(`${q}: Primitives are missing`);void 0==g[0].index&&y.Assign(g);const h=new Array;this.logOpen(`${q} ${j.name||""}`);const L=f.name||`node${f.index}`;if(1===g.length){const d=j.primitives[0];h.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${d.index}`,L,f,j,d,(q=>{f._babylonTransformNode=q,f._primitiveBabylonMeshes=[q]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,f._babylonTransformNode=new s.b(L,this._babylonScene),f._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._primitiveBabylonMeshes=[];for(const d of g)h.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${d.index}`,`${L}_primitive${d.index}`,f,j,d,(q=>{q.parent=f._babylonTransformNode,f._primitiveBabylonMeshes.push(q)})))}return d(f._babylonTransformNode),this.logClose(),Promise.all(h).then((()=>f._babylonTransformNode))}_loadMeshPrimitiveAsync(q,f,j,d,g,h){const L=this._extensionsLoadMeshPrimitiveAsync(q,f,j,d,g,h);if(L)return L;this.logOpen(`${q}`);const Q=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==j.skin&&!d.primitives[0].targets;let H,r;if(Q&&g._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,H=g._instanceData.babylonSourceMesh.createInstance(f),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r=g._instanceData.promise;else{const h=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new I.e(f,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.sideOrientation=this._babylonScene.useRightHandedSystem?N.b.CounterClockWiseSideOrientation:N.b.ClockWiseSideOrientation,this._createMorphTargets(q,j,d,g,L),h.push(this._loadVertexDataAsync(q,g,L).then((async f=>await this._loadMorphTargetsAsync(q,g,L,f).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,f.Yq(L),f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const u=l._GetDrawMode(q,g.mode);if(void 0==g.material){let q=this._defaultBabylonMaterialData[u];q||(q=this._createDefaultMaterial("__GLTFLoader._default",u),this._parent.onMaterialLoadedObservable.notifyObservers(q),this._defaultBabylonMaterialData[u]=q),L.material=q}else if(!this.parent.skipMaterials){const f=y.Get(`${q}/material`,this._gltf.materials,g.material);h.push(this._loadMaterialAsync(`/materials/${f.index}`,f,L,u,(q=>{L.material=q})))}r=Promise.all(h),Q&&(g._instanceData={babylonSourceMesh:L,promise:r}),H=L}return l.AddPointerMetadata(H,q),this._parent.onMeshLoadedObservable.notifyObservers(H),h(H),this.logClose(),r.then((()=>H))}_loadVertexDataAsync(q,f,j){const d=this._extensionsLoadVertexDataAsync(q,f,j);if(d)return d;const g=f.attributes;if(!g)throw new Error(`${q}: Attributes are missing`);const h=new Array,L=new e.e(j.name,this._babylonScene);if(void 0==f.indices)j.isUnIndexed=!0;else{const j=y.Get(`${q}/indices`,this._gltf.accessors,f.indices);h.push(this._loadIndicesAccessorAsync(`/accessors/${j.index}`,j).then((q=>{L.setIndices(q)})))}const Q=(f,d,Q)=>{if(void 0==g[f])return;j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(d)&&j._delayInfo.push(d);const H=y.Get(`${q}/attributes/${f}`,this._gltf.accessors,g[f]);h.push(this._loadVertexAccessorAsync(`/accessors/${H.index}`,H,d).then((q=>{if(q.getKind()===S.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!j.skeleton){const q=p(H);q&&(L._boundingInfo=q,L.useBoundingInfoFromGeometry=!0)}L.setVerticesBuffer(q,H.count)}))),d==S.i.MatricesIndicesExtraKind&&(j.numBoneInfluencers=8),Q&&Q(H)};return Q("POSITION",S.i.PositionKind),Q("NORMAL",S.i.NormalKind),Q("TANGENT",S.i.TangentKind),Q("TEXCOORD_0",S.i.UVKind),Q("TEXCOORD_1",S.i.UV2Kind),Q("TEXCOORD_2",S.i.UV3Kind),Q("TEXCOORD_3",S.i.UV4Kind),Q("TEXCOORD_4",S.i.UV5Kind),Q("TEXCOORD_5",S.i.UV6Kind),Q("JOINTS_0",S.i.MatricesIndicesKind),Q("WEIGHTS_0",S.i.MatricesWeightsKind),Q("JOINTS_1",S.i.MatricesIndicesExtraKind),Q("WEIGHTS_1",S.i.MatricesWeightsExtraKind),Q("COLOR_0",S.i.ColorKind,(q=>{"VEC4"===q.type&&(j.hasVertexAlpha=!0)})),Promise.all(h).then((()=>L))}_createMorphTargets(q,f,j,d,g){if(!d.targets||!this._parent.loadMorphTargets)return;if(void 0==f._numMorphTargets)f._numMorphTargets=d.targets.length;else if(d.targets.length!==f._numMorphTargets)throw new Error(`${q}: Primitives do not have the same number of targets`);const h=j.extras?j.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,g.morphTargetManager=new U(this._babylonScene),g.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.morphTargetManager.areUpdatesFrozen=!0;for(let L=0;L<d.targets.length;L++){const q=f.weights?f.weights[L]:j.weights?j.weights[L]:0,d=h?h[L]:`morphTarget${L}`;g.morphTargetManager.addTarget(new T.d(d,q,g.eq()))}}_loadMorphTargetsAsync(q,f,j,d){if(!f.targets||!this._parent.loadMorphTargets)return Promise.resolve();const g=new Array,h=j.morphTargetManager;for(let L=0;L<h.numTargets;L++){const j=h.getTarget(L);g.push(this._loadMorphTargetVertexDataAsync(`${q}/targets/${L}`,d,f.targets[L],j))}return Promise.all(g).then((()=>{h.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(q,f,j,d){const g=new Array,h=(d,h,L)=>{if(void 0==j[d])return;const Q=f.getVertexBuffer(h);if(!Q)return;const H=y.Get(`${q}/${d}`,this._gltf.accessors,j[d]);g.push(this._loadFloatAccessorAsync(`/accessors/${H.index}`,H).then((q=>{L(Q,q)})))};return h("POSITION",S.i.PositionKind,((q,f)=>{const j=new Float32Array(f.length);q.forEach(f.length,((q,d)=>{j[d]=f[d]+q})),d.setPositions(j)})),h("NORMAL",S.i.NormalKind,((q,f)=>{const j=new Float32Array(f.length);q.forEach(j.length,((q,d)=>{j[d]=f[d]+q})),d.setNormals(j)})),h("TANGENT",S.i.TangentKind,((q,f)=>{const j=new Float32Array(f.length/3*4);let g=0;q.forEach(f.length/3*4,((q,d)=>{(d+1)%4!==0&&(j[g]=f[g]+q,g++)})),d.setTangents(j)})),h("TEXCOORD_0",S.i.UVKind,((q,f)=>{const j=new Float32Array(f.length);q.forEach(f.length,((q,d)=>{j[d]=f[d]+q})),d.setUVs(j)})),h("TEXCOORD_1",S.i.UV2Kind,((q,f)=>{const j=new Float32Array(f.length);q.forEach(f.length,((q,d)=>{j[d]=f[d]+q})),d.setUV2s(j)})),h("COLOR_0",S.i.ColorKind,((f,j)=>{let g=null;const h=f.getSize();if(3===h){g=new Float32Array(j.length/3*4),f.forEach(j.length,((q,f)=>{const d=Math.floor(f/3),h=f%3;g[4*d+h]=j[3*d+h]+q}));for(let q=0;q<j.length/3;++q)g[4*q+3]=1}else{if(4!==h)throw new Error(`${q}: Invalid number of components (${h}) for COLOR_0 attribute`);g=new Float32Array(j.length),f.forEach(j.length,((q,f)=>{g[f]=j[f]+q}))}d.setColors(g)})),await Promise.all(g).then((()=>{}))}static _LoadTransform(q,f){if(void 0!=q.skin)return;let j=g.j.Zero(),d=g.e.Identity(),h=g.j.One();if(q.matrix){g.b.Pf(q.matrix).decompose(h,d,j)}else q.translation&&(j=g.j.Pf(q.translation)),q.rotation&&(d=g.e.Pf(q.rotation)),q.scale&&(h=g.j.Pf(q.scale));f.position=j,f.rotationQuaternion=d,f.Vf=h}_loadSkinAsync(q,f,j,d){if(!this._parent.loadSkins)return Promise.resolve();const g=this._extensionsLoadSkinAsync(q,f,j);if(g)return g;if(j._data)return d(j._data.babylonSkeleton),j._data.promise;const h=`skeleton${j.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new O(j.name||h,h,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(q,j,L);const Q=this._loadSkinInverseBindMatricesDataAsync(q,j).then((q=>{this._updateBoneMatrices(L,q)}));return j._data={babylonSkeleton:L,promise:Q},d(L),Q}_loadBones(q,f,j){if(void 0==f.skeleton||this._parent.alwaysComputeSkeletonRootNode){const j=this._findSkeletonRootNode(`${q}/joints`,f.joints);if(j)if(void 0===f.skeleton)f.skeleton=j.index;else{const d=(q,f)=>{for(;f.parent;f=f.parent)if(f.parent===q)return!0;return!1},g=y.Get(`${q}/skeleton`,this._gltf.nodes,f.skeleton);g===j||d(g,j)||(i.e.Warn(`${q}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),f.skeleton=j.index)}else i.e.Warn(`${q}: Failed to find common root`)}const d={};for(const g of f.joints){const h=y.Get(`${q}/joints/${g}`,this._gltf.nodes,g);this._loadBone(h,f,j,d)}}_findSkeletonRootNode(q,f){if(0===f.length)return null;const j={};for(const g of f){const f=[];let d=y.Get(`${q}/${g}`,this._gltf.nodes,g);for(;-1!==d.index;)f.unshift(d),d=d.parent;j[g]=f}let d=null;for(let g=0;;++g){let q=j[f[0]];if(g>=q.length)return d;const h=q[g];for(let L=1;L<f.length;++L)if(q=j[f[L]],g>=q.length||h!==q[g])return d;d=h}}_loadBone(q,f,j,d){q._isJoint=!0;let g=d[q.index];if(g)return g;let h=null;q.index!==f.skeleton&&(q.parent&&-1!==q.parent.index?h=this._loadBone(q.parent,f,j,d):void 0!==f.skeleton&&i.e.Warn(`/skins/${f.index}/skeleton: Skeleton node is not a common root`));const L=f.joints.indexOf(q.index);return g=new r.e(q.name||`joint${q.index}`,j,h,this._getNodeMatrix(q),null,null,L),d[q.index]=g,this._postSceneLoadActions.push((()=>{g.linkTransformNode(q._babylonTransformNode)})),g}_loadSkinInverseBindMatricesDataAsync(q,f){if(void 0==f.inverseBindMatrices)return Promise.resolve(null);const j=y.Get(`${q}/inverseBindMatrices`,this._gltf.accessors,f.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${j.index}`,j)}_updateBoneMatrices(q,f){for(const j of q.bones){const q=g.b.Identity(),d=j._index;f&&-1!==d&&(g.b.FromArrayToRef(f,16*d,q),q.invertToRef(q));const h=j.getParent();h&&q.multiplyToRef(h.getAbsoluteInverseBindMatrix(),q),j.jd(q,!1,!1),j._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(q){return q.matrix?g.b.Pf(q.matrix):g.b.Compose(q.scale?g.j.Pf(q.scale):g.j.One(),q.rotation?g.e.Pf(q.rotation):g.e.Identity(),q.translation?g.j.Pf(q.translation):g.j.Zero())}loadCameraAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadCameraAsync(q,f,j);if(d)return d;const h=new Array;this.logOpen(`${q} ${f.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new H.c(f.name||`camera${f.index}`,g.j.Zero(),this._babylonScene,!1);switch(L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._babylonCamera=L,L.setTarget(new g.j(0,0,-1)),f.type){case"perspective":{const j=f.perspective;if(!j)throw new Error(`${q}: Camera perspective properties are missing`);L.fov=j.yfov,L.gd=j.znear,L.maxZ=j.zfar||0;break}case"orthographic":if(!f.orthographic)throw new Error(`${q}: Camera orthographic properties are missing`);L.mode=Q.d.ORTHOGRAPHIC_CAMERA,L.orthoLeft=-f.orthographic.xmag,L.orthoRight=f.orthographic.xmag,L.orthoBottom=-f.orthographic.ymag,L.orthoTop=f.orthographic.ymag,L.gd=f.orthographic.znear,L.maxZ=f.orthographic.zfar;break;default:throw new Error(`${q}: Invalid camera type (${f.type})`)}return l.AddPointerMetadata(L,q),this._parent.onCameraLoadedObservable.notifyObservers(L),j(L),this.logClose(),Promise.all(h).then((()=>L))}_loadAnimationsAsync(){const q=this._gltf.animations;if(!q)return Promise.resolve();const f=new Array;for(let j=0;j<q.length;j++){const d=q[j];f.push(this.loadAnimationAsync(`/animations/${d.index}`,d).then((q=>{0===q.targetedAnimations.length&&q.dispose()})))}return Promise.all(f).then((()=>{}))}loadAnimationAsync(q,f){const d=this._extensionsLoadAnimationAsync(q,f);return d||j.e(58).then(j.bind(j,14109)).then((j=>{let{AnimationGroup:d}=j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new d(f.name||`animation${f.index}`,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._babylonAnimationGroup=g;const h=new Array;y.Assign(f.channels),y.Assign(f.samplers);for(const L of f.channels)h.push(this._loadAnimationChannelAsync(`${q}/channels/${L.index}`,q,f,L,((q,f)=>{q.animations=q.animations||[],q.animations.push(f),g.addTargetedAnimation(f,q)})));return Promise.all(h).then((()=>(g.normalize(0),g)))}))}async _loadAnimationChannelAsync(q,f,d,g,h){const L=this._extensionsLoadAnimationChannelAsync(q,f,d,g,h);if(L)return await L;if(void 0==g.target.node)return await Promise.resolve();const Q=y.Get(`${q}/target/node`,this._gltf.nodes,g.target.node),H=g.target.path,r="weights"===H;if(r&&!Q._numMorphTargets||!r&&!Q._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!r&&!Q._isJoint)return await Promise.resolve();let u;switch(await Promise.resolve().then(j.bind(j,12659)),H){case"translation":var X;u=null===(X=(0,R.i)("/nodes/{}/translation"))||void 0===X?void 0:X.interpolation;break;case"rotation":var z;u=null===(z=(0,R.i)("/nodes/{}/rotation"))||void 0===z?void 0:z.interpolation;break;case"scale":var B;u=null===(B=(0,R.i)("/nodes/{}/scale"))||void 0===B?void 0:B.interpolation;break;case"weights":var D;u=null===(D=(0,R.i)("/nodes/{}/weights"))||void 0===D?void 0:D.interpolation;break;default:throw new Error(`${q}/target/path: Invalid value (${g.target.path})`)}if(!u)throw new Error(`${q}/target/path: Could not find interpolation properties for target path (${g.target.path})`);const i={object:Q,info:u};return await this._loadAnimationChannelFromTargetInfoAsync(q,f,d,g,i,h)}_loadAnimationChannelFromTargetInfoAsync(q,f,j,d,g,h){const L=this.parent.targetFps,Q=1/L,H=y.Get(`${q}/sampler`,j.samplers,d.sampler);return this._loadAnimationSamplerAsync(`${f}/samplers/${d.sampler}`,H).then((q=>{let f=0;const H=g.object,r=g.info;for(const g of r){const r=g.getStride(H),u=q.input,X=q.output,z=new Array(u.length);let B=0;switch(q.interpolation){case"STEP":for(let q=0;q<u.length;q++){const f=g.getValue(H,X,B,1);B+=r,z[q]={frame:u[q]*L,value:f,interpolation:1}}break;case"CUBICSPLINE":for(let q=0;q<u.length;q++){const f=g.getValue(H,X,B,Q);B+=r;const j=g.getValue(H,X,B,1);B+=r;const d=g.getValue(H,X,B,Q);B+=r,z[q]={frame:u[q]*L,inTangent:f,value:j,outTangent:d}}break;case"LINEAR":for(let q=0;q<u.length;q++){const f=g.getValue(H,X,B,1);B+=r,z[q]={frame:u[q]*L,value:f}}}if(B>0){const q=`${j.name||`animation${j.index}`}_channel${d.index}_${f}`,Q=g.buildAnimations(H,q,L,z);for(const j of Q)f++,h(j.babylonAnimatable,j.babylonAnimation)}}}))}_loadAnimationSamplerAsync(q,f){if(f._data)return f._data;const j=f.interpolation||"LINEAR";switch(j){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${q}/interpolation: Invalid value (${f.interpolation})`)}const d=y.Get(`${q}/input`,this._gltf.accessors,f.input),g=y.Get(`${q}/output`,this._gltf.accessors,f.output);return f._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${d.index}`,d),this._loadFloatAccessorAsync(`/accessors/${g.index}`,g)]).then((q=>{let[f,d]=q;return{input:f,interpolation:j,output:d}})),f._data}loadBufferAsync(q,f,j,d){const g=this._extensionsLoadBufferAsync(q,f,j,d);if(g)return g;if(!f._data)if(f.uri)f._data=this.loadUriAsync(`${q}/uri`,f,f.uri);else{if(!this._bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);f._data=this._bin.readAsync(0,f.byteLength)}return f._data.then((f=>{try{return new Uint8Array(f.buffer,f.byteOffset+j,d)}catch(g){throw new Error(`${q}: ${g.message}`)}}))}loadBufferViewAsync(q,f){const j=this._extensionsLoadBufferViewAsync(q,f);if(j)return j;if(f._data)return f._data;const d=y.Get(`${q}/buffer`,this._gltf.buffers,f.buffer);return f._data=this.loadBufferAsync(`/buffers/${d.index}`,d,f.byteOffset||0,f.byteLength),f._data}_loadAccessorAsync(q,f,j){if(f._data)return f._data;const d=l._GetNumComponents(q,f.type),g=d*S.i.GetTypeByteLength(f.componentType),h=d*f.count;if(void 0==f.bufferView)f._data=Promise.resolve(new j(h));else{const L=y.Get(`${q}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((Q=>{if(5126!==f.componentType||f.normalized||L.byteStride&&L.byteStride!==g){const q=new j(h);return S.i.ForEach(Q,f.byteOffset||0,L.byteStride||g,d,f.componentType,q.length,f.normalized||!1,((f,j)=>{q[j]=f})),q}return l._GetTypedArray(q,f.componentType,Q,f.byteOffset,h)}))}if(f.sparse){const h=f.sparse;f._data=f._data.then((L=>{const Q=L,H=y.Get(`${q}/sparse/indices/bufferView`,this._gltf.bufferViews,h.indices.bufferView),r=y.Get(`${q}/sparse/values/bufferView`,this._gltf.bufferViews,h.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${H.index}`,H),this.loadBufferViewAsync(`/bufferViews/${r.index}`,r)]).then((L=>{let[H,r]=L;const u=l._GetTypedArray(`${q}/sparse/indices`,h.indices.componentType,H,h.indices.byteOffset,h.count),X=d*h.count;let z;if(5126!==f.componentType||f.normalized){const L=l._GetTypedArray(`${q}/sparse/values`,f.componentType,r,h.values.byteOffset,X);z=new j(X),S.i.ForEach(L,0,g,d,f.componentType,z.length,f.normalized||!1,((q,f)=>{z[f]=q}))}else z=l._GetTypedArray(`${q}/sparse/values`,f.componentType,r,h.values.byteOffset,X);let B=0;for(let q=0;q<u.length;q++){let f=u[q]*d;for(let q=0;q<d;q++)Q[f++]=z[B++]}return Q}))}))}return f._data}_loadFloatAccessorAsync(q,f){return this._loadAccessorAsync(q,f,Float32Array)}_loadIndicesAccessorAsync(q,f){if("SCALAR"!==f.type)throw new Error(`${q}/type: Invalid value ${f.type}`);if(5121!==f.componentType&&5123!==f.componentType&&5125!==f.componentType)throw new Error(`${q}/componentType: Invalid value ${f.componentType}`);if(f._data)return f._data;if(f.sparse){const j=l._GetTypedArrayConstructor(`${q}/componentType`,f.componentType);f._data=this._loadAccessorAsync(q,f,j)}else{const j=y.Get(`${q}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j).then((j=>l._GetTypedArray(q,f.componentType,j,f.byteOffset,f.count)))}return f._data}_loadVertexBufferViewAsync(q){if(q._babylonBuffer)return q._babylonBuffer;const f=this._babylonScene.getEngine();return q._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>new S.e(f,q,!1))),q._babylonBuffer}_loadVertexAccessorAsync(q,f,j){var d;if(null!==(d=f._babylonVertexBuffer)&&void 0!==d&&d[j])return f._babylonVertexBuffer[j];f._babylonVertexBuffer||(f._babylonVertexBuffer={});const g=this._babylonScene.getEngine();if(f.sparse||void 0==f.bufferView)f._babylonVertexBuffer[j]=this._loadFloatAccessorAsync(q,f).then((q=>new S.i(g,q,j,!1)));else{const d=y.Get(`${q}/bufferView`,this._gltf.bufferViews,f.bufferView);f._babylonVertexBuffer[j]=this._loadVertexBufferViewAsync(d).then((h=>{const L=l._GetNumComponents(q,f.type);return new S.i(g,h,j,!1,void 0,d.byteStride,void 0,f.byteOffset,L,f.componentType,f.normalized,!0,void 0,!0)}))}return f._babylonVertexBuffer[j]}_loadMaterialMetallicRoughnessPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return f&&(f.baseColorFactor?(j.albedoColor=h.c.Pf(f.baseColorFactor),j.alpha=f.baseColorFactor[3]):j.albedoColor=h.c.White(),j.metallic=void 0==f.metallicFactor?1:f.metallicFactor,j.roughness=void 0==f.roughnessFactor?1:f.roughnessFactor,f.baseColorTexture&&d.push(this.loadTextureInfoAsync(`${q}/baseColorTexture`,f.baseColorTexture,(q=>{q.name=`${j.name} (Base Color)`,j.albedoTexture=q}))),f.metallicRoughnessTexture&&(f.metallicRoughnessTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${q}/metallicRoughnessTexture`,f.metallicRoughnessTexture,(q=>{q.name=`${j.name} (Metallic Roughness)`,j.metallicTexture=q}))),j.useMetallnessFromMetallicTextureBlue=!0,j.useRoughnessFromMetallicTextureGreen=!0,j.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(d).then((()=>{}))}_loadMaterialAsync(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const h=this._extensionsLoadMaterialAsync(q,f,j,d,g);if(h)return h;f._data=f._data||{};let L=f._data[d];if(!L){this.logOpen(`${q} ${f.name||""}`);const j=this.createMaterial(q,f,d);L={babylonMaterial:j,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(q,f,j)},f._data[d]=L,l.AddPointerMetadata(j,q),this._parent.onMaterialLoadedObservable.notifyObservers(j),this.logClose()}return j&&(L.babylonMeshes.push(j),j.qd.addOnce((()=>{const q=L.babylonMeshes.indexOf(j);-1!==q&&L.babylonMeshes.splice(q,1)}))),g(L.babylonMaterial),L.promise.then((()=>L.babylonMaterial))}_createDefaultMaterial(q,f){this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new w.d(q,this._babylonScene);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.fillMode=f,j.enableSpecularAntiAliasing=!0,j.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,j.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,j.transparencyMode=w.d.PBRMATERIAL_OPAQUE,j.metallic=1,j.roughness=1,j}createMaterial(q,f,j){const d=this._extensionsCreateMaterial(q,f,j);if(d)return d;const g=f.name||`material${f.index}`;return this._createDefaultMaterial(g,j)}loadMaterialPropertiesAsync(q,f,j){const d=this._extensionsLoadMaterialPropertiesAsync(q,f,j);if(d)return d;const g=new Array;return g.push(this.loadMaterialBasePropertiesAsync(q,f,j)),f.pbrMetallicRoughness&&g.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${q}/pbrMetallicRoughness`,f.pbrMetallicRoughness,j)),this.loadMaterialAlphaProperties(q,f,j),Promise.all(g).then((()=>{}))}loadMaterialBasePropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return j.emissiveColor=f.emissiveFactor?h.c.Pf(f.emissiveFactor):new h.c(0,0,0),f.doubleSided&&(j.ef=!1,j.twoSidedLighting=!0),f.normalTexture&&(f.normalTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${q}/normalTexture`,f.normalTexture,(q=>{q.name=`${j.name} (Normal)`,j.bumpTexture=q}))),j.invertNormalMapX=!this._babylonScene.useRightHandedSystem,j.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=f.normalTexture.scale&&j.bumpTexture&&(j.bumpTexture.level=f.normalTexture.scale),j.forceIrradianceInFragment=!0),f.occlusionTexture&&(f.occlusionTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${q}/occlusionTexture`,f.occlusionTexture,(q=>{q.name=`${j.name} (Occlusion)`,j.ambientTexture=q}))),j.useAmbientInGrayScale=!0,void 0!=f.occlusionTexture.strength&&(j.ambientTextureStrength=f.occlusionTexture.strength)),f.emissiveTexture&&d.push(this.loadTextureInfoAsync(`${q}/emissiveTexture`,f.emissiveTexture,(q=>{q.name=`${j.name} (Emissive)`,j.emissiveTexture=q}))),Promise.all(d).then((()=>{}))}loadMaterialAlphaProperties(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);switch(f.alphaMode||"OPAQUE"){case"OPAQUE":j.transparencyMode=w.d.PBRMATERIAL_OPAQUE,j.alpha=1;break;case"MASK":j.transparencyMode=w.d.PBRMATERIAL_ALPHATEST,j.alphaCutOff=void 0==f.alphaCutoff?.5:f.alphaCutoff,j.albedoTexture&&(j.albedoTexture.Rf=!0);break;case"BLEND":j.transparencyMode=w.d.PBRMATERIAL_ALPHABLEND,j.albedoTexture&&(j.albedoTexture.Rf=!0,j.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${q}/alphaMode: Invalid value (${f.alphaMode})`)}}loadTextureInfoAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadTextureInfoAsync(q,f,j);if(d)return d;if(this.logOpen(`${q}`),f.texCoord>=6)throw new Error(`${q}/texCoord: Invalid value (${f.texCoord})`);const g=y.Get(`${q}/index`,this._gltf.textures,f.index);g._textureInfo=f;const h=this._loadTextureAsync(`/textures/${f.index}`,g,(d=>{d.coordinatesIndex=f.texCoord||0,l.AddPointerMetadata(d,q),this._parent.onTextureLoadedObservable.notifyObservers(d),j(d)}));return this.logClose(),h}_loadTextureAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadTextureAsync(q,f,j);if(d)return d;this.logOpen(`${q} ${f.name||""}`);const g=void 0==f.sampler?l.DefaultSampler:y.Get(`${q}/sampler`,this._gltf.samplers,f.sampler),h=y.Get(`${q}/source`,this._gltf.images,f.source),L=this._createTextureAsync(q,g,h,j,void 0,!f._textureInfo.nonColorData);return this.logClose(),L}_createTextureAsync(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},h=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const Q=this._loadSampler(`/samplers/${f.index}`,f),H=new Array,r=new d;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u={noMipmap:Q.noMipMaps,invertY:!1,samplingMode:Q.samplingMode,m:()=>{this._disposed||r.resolve()},onError:(f,j)=>{this._disposed||r.reject(new Error(`${q}: ${j&&j.message?j.message:f||"Failed to load texture"}`))},mimeType:j.mimeType??(0,v.f)(j.uri??""),loaderOptions:h,useSRGBBuffer:!!L&&this._parent.useSRGBBuffers},X=new E.e(null,this._babylonScene,u);return X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.push(r.promise),H.push(this.loadImageAsync(`/images/${j.index}`,j).then((q=>{const f=j.uri||`${this._fileName}#image${j.index}`,d=`data:${this._uniqueRootUrl}${f}`;X.updateURL(d,q);const g=X.getInternalTexture();g&&(g.label=j.name)}))),X.wrapU=Q.wrapU,X.wrapV=Q.wrapV,g(X),this._parent.useGltfTextureNames&&(X.name=j.name||j.uri||`image${j.index}`),Promise.all(H).then((()=>X))}_loadSampler(q,f){return f._data||(f._data={noMipMaps:9728===f.minFilter||9729===f.minFilter,samplingMode:l._GetTextureSamplingMode(q,f),wrapU:l._GetTextureWrapMode(`${q}/wrapS`,f.wrapS),wrapV:l._GetTextureWrapMode(`${q}/wrapT`,f.wrapT)}),f._data}loadImageAsync(q,f){if(!f._data){if(this.logOpen(`${q} ${f.name||""}`),f.uri)f._data=this.loadUriAsync(`${q}/uri`,f,f.uri);else{const j=y.Get(`${q}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}this.logClose()}return f._data}loadUriAsync(q,f,j){const d=this._extensionsLoadUriAsync(q,f,j);if(d)return d;if(!l._ValidateUri(j))throw new Error(`${q}: '${j}' is invalid`);if((0,v.h)(j)){const f=new Uint8Array((0,v.c)(j));return this.log(`${q}: Decoded ${j.substring(0,64)}... (${f.length} bytes)`),Promise.resolve(f)}return this.log(`${q}: Loading ${j}`),this._parent.preprocessUrlAsync(this._rootUrl+j).then((f=>new Promise(((d,g)=>{this._parent._loadFile(this._babylonScene,f,(f=>{this._disposed||(this.log(`${q}: Loaded ${j} (${f.byteLength} bytes)`),d(new Uint8Array(f)))}),!0,(f=>{g(new v.i(`${q}: Failed to load '${j}'${f?": "+f.status+" "+f.statusText:""}`,f))}))}))))}static AddPointerMetadata(q,f){q.metadata=q.metadata||{};const j=q._internalMetadata=q._internalMetadata||{},d=j.dd=j.dd||{};(d.pointers=d.pointers||[]).push(f)}static _GetTextureWrapMode(q,f){switch(f=void 0==f?10497:f){case 33071:return E.e.CLAMP_ADDRESSMODE;case 33648:return E.e.MIRROR_ADDRESSMODE;case 10497:return E.e.WRAP_ADDRESSMODE;default:return i.e.Warn(`${q}: Invalid value (${f})`),E.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(q,f){const j=void 0==f.magFilter?9729:f.magFilter,d=void 0==f.minFilter?9987:f.minFilter;if(9729===j)switch(d){case 9728:return E.e.LINEAR_NEAREST;case 9729:return E.e.LINEAR_LINEAR;case 9984:return E.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return E.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return E.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return E.e.LINEAR_LINEAR_MIPLINEAR;default:return i.e.Warn(`${q}/minFilter: Invalid value (${d})`),E.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==j&&i.e.Warn(`${q}/magFilter: Invalid value (${j})`),d){case 9728:return E.e.NEAREST_NEAREST;case 9729:return E.e.NEAREST_LINEAR;case 9984:return E.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return E.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return E.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return E.e.NEAREST_LINEAR_MIPLINEAR;default:return i.e.Warn(`${q}/minFilter: Invalid value (${d})`),E.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(q,f){try{return(0,k.q)(f)}catch(j){throw new Error(`${q}: ${j.message}`)}}static _GetTypedArray(q,f,j,d,g){const h=j.buffer;d=j.byteOffset+(d||0);const L=l._GetTypedArrayConstructor(`${q}/componentType`,f),Q=S.i.GetTypeByteLength(f);return d%Q!==0?(i.e.Warn(`${q}: Copying buffer as byte offset (${d}) is not a multiple of component type byte length (${Q})`),new L(h.slice(d,d+g*Q),0)):new L(h,d,g)}static _GetNumComponents(q,f){switch(f){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${q}: Invalid type (${f})`)}static _ValidateUri(q){return L.h.IsBase64(q)||-1===q.indexOf("..")}static _GetDrawMode(q,f){switch(void 0==f&&(f=4),f){case 0:return N.b.PointListDrawMode;case 1:return N.b.LineListDrawMode;case 2:return N.b.LineLoopDrawMode;case 3:return N.b.LineStripDrawMode;case 4:return N.b.TriangleFillMode;case 5:return N.b.TriangleStripDrawMode;case 6:return N.b.TriangleFanDrawMode}throw new Error(`${q}: Invalid mesh primitive mode (${f})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const q=new Array;if(this._gltf.materials)for(const f of this._gltf.materials)if(f._data)for(const j in f._data){const d=f._data[j];for(const f of d.babylonMeshes){f.Nf(!0);const j=d.babylonMaterial;q.push(j.forceCompilationAsync(f)),q.push(j.forceCompilationAsync(f,{useInstances:!0})),this._parent.useClipPlane&&(q.push(j.forceCompilationAsync(f,{clipPlane:!0})),q.push(j.forceCompilationAsync(f,{clipPlane:!0,useInstances:!0})))}}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const q=new Array,f=this._babylonScene.lights;for(const j of f){const f=j.getShadowGenerator();f&&q.push(f.forceCompilationAsync())}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(q){for(const f of this._extensions)f.enabled&&q(f)}_applyExtensions(q,f,j){for(const d of this._extensions)if(d.enabled){const g=`${d.name}.${f}`,h=q;h._activeLoaderExtensionFunctions=h._activeLoaderExtensionFunctions||{};const L=h._activeLoaderExtensionFunctions;if(!L[g]){L[g]=!0;try{const q=j(d);if(q)return q}finally{delete L[g]}}}return null}_extensionsOnLoading(){this._forEachExtensions((q=>q.onLoading&&q.onLoading()))}_extensionsOnReady(){this._forEachExtensions((q=>q.onReady&&q.onReady()))}_extensionsLoadSceneAsync(q,f){return this._applyExtensions(f,"loadScene",(j=>j.loadSceneAsync&&j.loadSceneAsync(q,f)))}_extensionsLoadNodeAsync(q,f,j){return this._applyExtensions(f,"loadNode",(d=>d.loadNodeAsync&&d.loadNodeAsync(q,f,j)))}_extensionsLoadCameraAsync(q,f,j){return this._applyExtensions(f,"loadCamera",(d=>d.loadCameraAsync&&d.loadCameraAsync(q,f,j)))}_extensionsLoadVertexDataAsync(q,f,j){return this._applyExtensions(f,"loadVertexData",(d=>d._loadVertexDataAsync&&d._loadVertexDataAsync(q,f,j)))}_extensionsLoadMeshPrimitiveAsync(q,f,j,d,g,h){return this._applyExtensions(g,"loadMeshPrimitive",(L=>L._loadMeshPrimitiveAsync&&L._loadMeshPrimitiveAsync(q,f,j,d,g,h)))}_extensionsLoadMaterialAsync(q,f,j,d,g){return this._applyExtensions(f,"loadMaterial",(h=>h._loadMaterialAsync&&h._loadMaterialAsync(q,f,j,d,g)))}_extensionsCreateMaterial(q,f,j){return this._applyExtensions(f,"createMaterial",(d=>d.createMaterial&&d.createMaterial(q,f,j)))}_extensionsLoadMaterialPropertiesAsync(q,f,j){return this._applyExtensions(f,"loadMaterialProperties",(d=>d.loadMaterialPropertiesAsync&&d.loadMaterialPropertiesAsync(q,f,j)))}_extensionsLoadTextureInfoAsync(q,f,j){return this._applyExtensions(f,"loadTextureInfo",(d=>d.loadTextureInfoAsync&&d.loadTextureInfoAsync(q,f,j)))}_extensionsLoadTextureAsync(q,f,j){return this._applyExtensions(f,"loadTexture",(d=>d._loadTextureAsync&&d._loadTextureAsync(q,f,j)))}_extensionsLoadAnimationAsync(q,f){return this._applyExtensions(f,"loadAnimation",(j=>j.loadAnimationAsync&&j.loadAnimationAsync(q,f)))}_extensionsLoadAnimationChannelAsync(q,f,j,d,g){return this._applyExtensions(j,"loadAnimationChannel",(h=>h._loadAnimationChannelAsync&&h._loadAnimationChannelAsync(q,f,j,d,g)))}_extensionsLoadSkinAsync(q,f,j){return this._applyExtensions(j,"loadSkin",(d=>d._loadSkinAsync&&d._loadSkinAsync(q,f,j)))}_extensionsLoadUriAsync(q,f,j){return this._applyExtensions(f,"loadUri",(d=>d._loadUriAsync&&d._loadUriAsync(q,f,j)))}_extensionsLoadBufferViewAsync(q,f){return this._applyExtensions(f,"loadBufferView",(j=>j.loadBufferViewAsync&&j.loadBufferViewAsync(q,f)))}_extensionsLoadBufferAsync(q,f,j,d){return this._applyExtensions(f,"loadBuffer",(g=>g.loadBufferAsync&&g.loadBufferAsync(q,f,j,d)))}static LoadExtensionAsync(q,f,j,d){if(!f.extensions)return null;const g=f.extensions[j];return g?d(`${q}/extensions/${j}`,g):null}static LoadExtraAsync(q,f,j,d){if(!f.extras)return null;const g=f.extras[j];return g?d(`${q}/extras/${j}`,g):null}isExtensionUsed(q){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(q)}logOpen(q){this._parent._logOpen(q)}logClose(){this._parent._logClose()}log(q){this._parent._log(q)}startPerformanceCounter(q){this._parent._startPerformanceCounter(q)}endPerformanceCounter(q){this._parent._endPerformanceCounter(q)}}l.DefaultSampler={index:-1},Y.c._CreateGLTF2Loader=q=>new l(q);var V=j(12659),a=j(11389),P=j(11199),C=j(12663),c=j(12668);class G extends c.e{constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",q),this._texture=q.getEngine().createRawCubeTexture(f,j,d,g,h,L,Q,H)}update(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,q,f,j,d,g)}updateRGBDAsync(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,C.h)(this._texture,q,f,j,d).then((()=>{}))}clone(){return P.d.Clone((()=>{const q=this.eq(),f=this._texture,j=new G(q,f._bufferViewArray,f.width,f.format,f.type,f.generateMipMaps,f.invertY,f.samplingMode,f._compression);return 13===f.source&&j.updateRGBDAsync(f._bufferViewArrayArray,f._sphericalPolynomial,f._lodGenerationScale,f._lodGenerationOffset),j}),this)}}const m="EXT_lights_image_based";class K{constructor(q){this.name=m,this._loader=q,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.dd.extensions;if(q&&q[this.name]){const f=q[this.name];this._lights=f.lights}}loadSceneAsync(q,f){return l.LoadExtensionAsync(q,f,this.name,(async(j,d)=>{this._loader._allMaterialsDirtyRequired=!0;const g=new Array;g.push(this._loader.loadSceneAsync(q,f)),this._loader.logOpen(`${j}`);const h=y.Get(`${j}/light`,this._lights,d.Df);return g.push(this._loadLightAsync(`/extensions/${this.name}/lights/${d.Df}`,h).then((q=>{this._loader.babylonScene.environmentTexture=q}))),this._loader.logClose(),await Promise.all(g).then((()=>{}))}))}_loadLightAsync(q,f){if(!f._loaded){const j=new Array;this._loader.logOpen(`${q}`);const d=new Array(f.specularImages.length);for(let g=0;g<f.specularImages.length;g++){const h=f.specularImages[g];d[g]=new Array(h.length);for(let f=0;f<h.length;f++){const L=`${q}/specularImages/${g}/${f}`;this._loader.logOpen(`${L}`);const Q=h[f],H=y.Get(L,this._loader.dd.images,Q);j.push(this._loader.loadImageAsync(`/images/${Q}`,H).then((q=>{d[g][f]=q}))),this._loader.logClose()}}this._loader.logClose(),f._loaded=Promise.all(j).then((async()=>{const j=new G(this._loader.babylonScene,null,f.specularImageSize);if(j.name=f.name||"environment",f._babylonTexture=j,void 0!=f.Xd&&(j.level=f.Xd),f.rotation){let q=g.e.Pf(f.rotation);this._loader.babylonScene.useRightHandedSystem||(q=g.e.Inverse(q)),g.b.FromQuaternionToRef(q,j.getReflectionTextureMatrix())}if(!f.irradianceCoefficients)throw new Error(`${q}: Irradiance coefficients are missing`);const h=a.b.Pf(f.irradianceCoefficients);h.scaleInPlace(f.Xd),h.convertIrradianceToLambertianRadiance();const L=a.f.FromHarmonics(h),Q=(d.length-1)/Math.log2(f.specularImageSize);return await j.updateRGBDAsync(d,L,Q)}))}return f._loaded.then((()=>f._babylonTexture))}}x(m),b(m,!0,(q=>new K(q)));j(11660);const J="EXT_mesh_gpu_instancing";class qq{constructor(q){this.name=J,this._loader=q,this.enabled=this._loader.isExtensionUsed(J)}dispose(){this._loader=null}loadNodeAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(q,d)=>{this._loader._disableInstancedMesh++;const h=this._loader.loadNodeAsync(`/nodes/${f.index}`,f,j);if(this._loader._disableInstancedMesh--,!f._primitiveBabylonMeshes)return await h;const L=new Array;let Q=0;const H=f=>{if(void 0==d.attributes[f])return void L.push(Promise.resolve(null));const j=y.Get(`${q}/attributes/${f}`,this._loader.dd.accessors,d.attributes[f]);if(L.push(this._loader._loadFloatAccessorAsync(`/accessors/${j.bufferView}`,j)),0===Q)Q=j.count;else if(Q!==j.count)throw new Error(`${q}/attributes: Instance buffer accessors do not have the same count.`)};return H("TRANSLATION"),H("ROTATION"),H("SCALE"),await h.then((async q=>{const[j,d,h]=await Promise.all(L),H=new Float32Array(16*Q);g.f.kf[0].Af(0,0,0),g.f.Quaternion[0].Af(0,0,0,1),g.f.kf[1].Af(1,1,1);for(let f=0;f<Q;++f)j&&g.j.FromArrayToRef(j,3*f,g.f.kf[0]),d&&g.e.FromArrayToRef(d,4*f,g.f.Quaternion[0]),h&&g.j.FromArrayToRef(h,3*f,g.f.kf[1]),g.b.ComposeToRef(g.f.kf[1],g.f.Quaternion[0],g.f.kf[0],g.f.Matrix[0]),g.f.Matrix[0].copyToArray(H,16*f);for(const g of f._primitiveBabylonMeshes)g.kX("matrix",H,16,!0);return q}))}))}}x(J),b(J,!0,(q=>new qq(q)));let fq=0,jq=null;class dq{static get Default(){return dq._Default||(dq._Default=new dq),dq._Default}constructor(){const q=dq.Configuration.decoder;this._decoderModulePromise=L.h.LoadBabylonScriptAsync(q.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(q,f,j,d,g){await this._decoderModulePromise,0===fq&&(MeshoptDecoder.useWorkers(1),fq=1);const h=await MeshoptDecoder.decodeGltfBufferAsync(f,j,q,d,g);return null!==jq&&clearTimeout(jq),jq=setTimeout((()=>{MeshoptDecoder.useWorkers(0),fq=0,jq=null}),1e3),h}}dq.Configuration={decoder:{url:`${L.h._DefaultCdnUrl}/meshopt_decoder.js`}},dq._Default=null;const gq="EXT_meshopt_compression";class hq{constructor(q){this.name=gq,this.enabled=q.isExtensionUsed(gq),this._loader=q}dispose(){this._loader=null}loadBufferViewAsync(q,f){return l.LoadExtensionAsync(q,f,this.name,(async(j,d)=>{const g=f;if(g._meshOptData)return await g._meshOptData;const h=y.Get(`${q}/buffer`,this._loader.dd.buffers,d.buffer);return g._meshOptData=this._loader.loadBufferAsync(`/buffers/${h.index}`,h,d.byteOffset||0,d.byteLength).then((async q=>await dq.Default.decodeGltfBufferAsync(q,d.count,d.byteStride,d.mode,d.filter))),await g._meshOptData}))}}x(gq),b(gq,!0,(q=>new hq(q)));const Lq="EXT_texture_webp";class Qq{constructor(q){this.name=Lq,this._loader=q,this.enabled=q.isExtensionUsed(Lq)}dispose(){this._loader=null}_loadTextureAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=void 0==f.sampler?l.DefaultSampler:y.Get(`${q}/sampler`,this._loader.dd.samplers,f.sampler),L=y.Get(`${d}/source`,this._loader.dd.images,g.source);return await this._loader._createTextureAsync(q,h,L,(q=>{j(q)}),void 0,!f._textureInfo.nonColorData)}))}}x(Lq),b(Lq,!0,(q=>new Qq(q)));const Hq="EXT_texture_avif";class rq{constructor(q){this.name=Hq,this._loader=q,this.enabled=q.isExtensionUsed(Hq)}dispose(){this._loader=null}_loadTextureAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=void 0==f.sampler?l.DefaultSampler:y.Get(`${q}/sampler`,this._loader.dd.samplers,f.sampler),L=y.Get(`${d}/source`,this._loader.dd.images,g.source);return await this._loader._createTextureAsync(q,h,L,(q=>{j(q)}),void 0,!f._textureInfo.nonColorData)}))}}x(Hq),b(Hq,!0,(q=>new rq(q)));var uq=j(12657),Xq=j(11632);const zq="EXT_lights_ies";class Bq{constructor(q){this.name=zq,this._loader=q,this.enabled=this._loader.isExtensionUsed(zq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.dd.extensions;if(q&&q[this.name]){const f=q[this.name];this._lights=f.lights,y.Assign(this._lights)}}loadNodeAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,L)=>{let Q,H;this._loader._allMaterialsDirtyRequired=!0;const r=await this._loader.loadNodeAsync(q,f,(q=>{H=y.Get(d,this._lights,L.Df);const f=H.name||q.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Q=new uq.b(f,g.j.Zero(),g.j.Backward(),0,1,this._loader.babylonScene),Q.angle=Math.PI/2,Q.innerAngle=0,Q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,H._babylonLight=Q,Q.falloffType=Xq.e.FALLOFF_GLTF,Q.zd=L.color?h.c.Pf(L.color):h.c.White(),Q.Xd=L.multiplier||1,Q.range=Number.MAX_VALUE,Q.parent=q,this._loader._babylonLights.push(Q),l.AddPointerMetadata(Q,d),j(q)}));let u;if(H.uri)u=await this._loader.loadUriAsync(q,H,H.uri);else{const f=y.Get(`${q}/bufferView`,this._loader.dd.bufferViews,H.bufferView);u=await this._loader.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}return Q.iesProfileTexture=new E.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,u,!0,void 0,void 0,void 0,void 0,".ies"),r}))}}x(zq),b(zq,!0,(q=>new Bq(q)));var Dq=j(12682);const iq="KHR_draco_mesh_compression";class tq{constructor(q){this.name=iq,this.useNormalizedFlagFromAccessor=!0,this._loader=q,this.enabled=Dq.c.DefaultAvailable&&this._loader.isExtensionUsed(iq)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{if(void 0!=f.mode&&4!==f.mode&&5!==f.mode)throw new Error(`${q}: Unsupported mode ${f.mode}`);const h={},L={},Q=(q,d)=>{const Q=g.attributes[q];if(void 0!=Q&&(j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(d)&&j._delayInfo.push(d),h[d]=Q,this.useNormalizedFlagFromAccessor)){const j=y.TryGet(this._loader.dd.accessors,f.attributes[q]);j&&(L[d]=j.normalized||!1)}};Q("POSITION",S.i.PositionKind),Q("NORMAL",S.i.NormalKind),Q("TANGENT",S.i.TangentKind),Q("TEXCOORD_0",S.i.UVKind),Q("TEXCOORD_1",S.i.UV2Kind),Q("TEXCOORD_2",S.i.UV3Kind),Q("TEXCOORD_3",S.i.UV4Kind),Q("TEXCOORD_4",S.i.UV5Kind),Q("TEXCOORD_5",S.i.UV6Kind),Q("JOINTS_0",S.i.MatricesIndicesKind),Q("WEIGHTS_0",S.i.MatricesWeightsKind),Q("COLOR_0",S.i.ColorKind);const H=y.Get(d,this._loader.dd.bufferViews,g.bufferView);return H._dracoBabylonGeometry||(H._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((async d=>{const g=this.dracoDecoder||Dq.c.Default,Q=y.TryGet(this._loader.dd.accessors,f.attributes.POSITION),H=this._loader.parent.alwaysComputeBoundingBox||j.skeleton||!Q?null:p(Q);return await g._decodeMeshToGeometryForGltfAsync(j.name,this._loader.babylonScene,d,h,L,H).catch((f=>{throw new Error(`${q}: ${f.message}`)}))}))),await H._dracoBabylonGeometry}))}}x(iq),b(iq,!0,(q=>new tq(q)));var Oq=j(12687),Nq=j(11125),wq=j(11130),Eq=j(11247),sq=j(11698),Sq=j(10965);Eq.d.AddNodeConstructor("Light_Type_0",((q,f)=>()=>new eq(q,g.j.Zero(),f)));class eq extends sq.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(q){this._shadowAngle=q,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(q){const f=this.needCube();if(this._direction=q,this.needCube()!==f&&this._shadowGenerators){const q=this._shadowGenerators.values();for(let f=q.next();!0!==f.done;f=q.next()){f.value.recreateShadowMap()}}}constructor(q,f,j){super(q,j),this._shadowAngle=Math.PI/2,this.position=f}getClassName(){return"PointLight"}getTypeID(){return Xq.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(q){if(this.direction)return super.getShadowDirection(q);switch(q){case 0:return new g.j(1,0,0);case 1:return new g.j(-1,0,0);case 2:return new g.j(0,-1,0);case 3:return new g.j(0,1,0);case 4:return new g.j(0,0,1);case 5:return new g.j(0,0,-1)}return g.j.Zero()}_setDefaultShadowProjectionMatrix(q,f,j){const d=this.eq().activeCamera;if(!d)return;const h=void 0!==this.shadowMinZ?this.shadowMinZ:d.gd,L=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,Q=this.eq().getEngine().useReverseDepthBuffer;g.b.PerspectiveFovLHToRef(this.shadowAngle,1,Q?L:h,Q?h:L,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Q)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,f){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,f):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,f),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,f),this}transferToNodeMaterialEffect(q,f){return this.computeTransformedInformation()?q.setFloat3(f,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):q.setFloat3(f,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(q,f){q["POINTLIGHT"+f]=!0}}(0,Nq.b)([(0,wq.O)()],eq.prototype,"shadowAngle",null),(0,Sq.f)("BABYLON.PointLight",eq);const Zq="KHR_lights_punctual";class Iq{constructor(q){this.name=Zq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Zq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.dd.extensions;if(q&&q[this.name]){const f=q[this.name];this._lights=f.lights,y.Assign(this._lights)}}loadNodeAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,L)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(q,f,(q=>{let f;const Q=y.Get(d,this._lights,L.Df),H=Q.name||q.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Q.type){case"directional":{const q=new Oq.c(H,g.j.Backward(),this._loader.babylonScene);q.position.cf(0),f=q;break}case"point":f=new eq(H,g.j.Zero(),this._loader.babylonScene);break;case"spot":{const q=new uq.b(H,g.j.Zero(),g.j.Backward(),0,1,this._loader.babylonScene);q.angle=2*(Q.spot&&Q.spot.outerConeAngle||Math.PI/4),q.innerAngle=2*(Q.spot&&Q.spot.innerConeAngle||0),f=q;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${d}: Invalid light type (${Q.type})`)}f._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Q._babylonLight=f,f.falloffType=Xq.e.FALLOFF_GLTF,f.zd=Q.color?h.c.Pf(Q.color):h.c.White(),f.Xd=void 0==Q.Xd?1:Q.Xd,f.range=void 0==Q.range?Number.MAX_VALUE:Q.range,f.parent=q,this._loader._babylonLights.push(f),l.AddPointerMetadata(f,d),j(q)})))))}}x(Zq),b(Zq,!0,(q=>new Iq(q)));const Tq="KHR_materials_pbrSpecularGlossiness";class Wq{constructor(q){this.name=Tq,this.order=200,this._loader=q,this.enabled=this._loader.isExtensionUsed(Tq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialBasePropertiesAsync(q,f,j)),h.push(this._loadSpecularGlossinessPropertiesAsync(d,g,j)),this._loader.loadMaterialAlphaProperties(q,f,j),await Promise.all(h).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return j.metallic=null,j.roughness=null,f.diffuseFactor?(j.albedoColor=h.c.Pf(f.diffuseFactor),j.alpha=f.diffuseFactor[3]):j.albedoColor=h.c.White(),j.reflectivityColor=f.specularFactor?h.c.Pf(f.specularFactor):h.c.White(),j.microSurface=void 0==f.glossinessFactor?1:f.glossinessFactor,f.diffuseTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTexture`,f.diffuseTexture,(q=>{q.name=`${j.name} (Diffuse)`,j.albedoTexture=q}))),f.specularGlossinessTexture&&(d.push(this._loader.loadTextureInfoAsync(`${q}/specularGlossinessTexture`,f.specularGlossinessTexture,(q=>{q.name=`${j.name} (Specular Glossiness)`,j.reflectivityTexture=q,j.reflectivityTexture.Rf=!0}))),j.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(d).then((()=>{}))}}x(Tq),b(Tq,!0,(q=>new Wq(q)));const nq="KHR_materials_unlit";class Uq{constructor(q){this.name=nq,this.order=210,this._loader=q,this.enabled=this._loader.isExtensionUsed(nq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async()=>await this._loadUnlitPropertiesAsync(q,f,j)))}_loadUnlitPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;j.unlit=!0;const g=f.pbrMetallicRoughness;return g&&(g.baseColorFactor?(j.albedoColor=h.c.Pf(g.baseColorFactor),j.alpha=g.baseColorFactor[3]):j.albedoColor=h.c.White(),g.baseColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/baseColorTexture`,g.baseColorTexture,(q=>{q.name=`${j.name} (Base Color)`,j.albedoTexture=q})))),f.doubleSided&&(j.ef=!1,j.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(q,f,j),Promise.all(d).then((()=>{}))}}x(nq),b(nq,!0,(q=>new Uq(q)));const Yq="KHR_materials_clearcoat";class vq{constructor(q){this.name=Yq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(Yq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadClearCoatPropertiesAsync(d,g,j)),await Promise.all(h)}))}_loadClearCoatPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return j.clearCoat.isEnabled=!0,j.clearCoat.useRoughnessFromMainTexture=!1,j.clearCoat.remapF0OnInterfaceChange=!1,void 0!=f.clearcoatFactor?j.clearCoat.Xd=f.clearcoatFactor:j.clearCoat.Xd=0,f.clearcoatTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatTexture`,f.clearcoatTexture,(q=>{q.name=`${j.name} (ClearCoat)`,j.clearCoat.texture=q}))),void 0!=f.clearcoatRoughnessFactor?j.clearCoat.roughness=f.clearcoatRoughnessFactor:j.clearCoat.roughness=0,f.clearcoatRoughnessTexture&&(f.clearcoatRoughnessTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatRoughnessTexture`,f.clearcoatRoughnessTexture,(q=>{q.name=`${j.name} (ClearCoat Roughness)`,j.clearCoat.textureRoughness=q})))),f.clearcoatNormalTexture&&(f.clearcoatNormalTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatNormalTexture`,f.clearcoatNormalTexture,(q=>{q.name=`${j.name} (ClearCoat Normal)`,j.clearCoat.bumpTexture=q}))),j.invertNormalMapX=!j.eq().useRightHandedSystem,j.invertNormalMapY=j.eq().useRightHandedSystem,void 0!=f.clearcoatNormalTexture.scale&&(j.clearCoat.bumpTexture.level=f.clearcoatNormalTexture.scale)),Promise.all(d).then((()=>{}))}}x(Yq),b(Yq,!0,(q=>new vq(q)));const Fq="KHR_materials_iridescence";class Mq{constructor(q){this.name=Fq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(Fq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadIridescencePropertiesAsync(d,g,j)),await Promise.all(h).then((()=>{}))}))}_loadIridescencePropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return j.iridescence.isEnabled=!0,j.iridescence.Xd=f.iridescenceFactor??0,j.iridescence.indexOfRefraction=f.iridescenceIor??f.iridescenceIOR??1.3,j.iridescence.minimumThickness=f.iridescenceThicknessMinimum??100,j.iridescence.maximumThickness=f.iridescenceThicknessMaximum??400,f.iridescenceTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceTexture`,f.iridescenceTexture,(q=>{q.name=`${j.name} (Iridescence)`,j.iridescence.texture=q}))),f.iridescenceThicknessTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceThicknessTexture`,f.iridescenceThicknessTexture,(q=>{q.name=`${j.name} (Iridescence Thickness)`,j.iridescence.thicknessTexture=q}))),Promise.all(d).then((()=>{}))}}x(Fq),b(Fq,!0,(q=>new Mq(q)));const oq="KHR_materials_anisotropy";class bq{constructor(q){this.name=oq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(oq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadIridescencePropertiesAsync(d,g,j)),await Promise.all(h)}))}async _loadIridescencePropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;j.anisotropy.isEnabled=!0,j.anisotropy.Xd=f.anisotropyStrength??0,j.anisotropy.angle=f.anisotropyRotation??0,f.anisotropyTexture&&(f.anisotropyTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${q}/anisotropyTexture`,f.anisotropyTexture,(q=>{q.name=`${j.name} (Anisotropy Intensity)`,j.anisotropy.texture=q})))),await Promise.all(d)}}x(oq),b(oq,!0,(q=>new bq(q)));const xq="KHR_materials_emissive_strength";class Rq{constructor(q){this.name=xq,this.order=170,this._loader=q,this.enabled=this._loader.isExtensionUsed(xq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>await this._loader.loadMaterialPropertiesAsync(q,f,j).then((()=>{this._loadEmissiveProperties(d,g,j)}))))}_loadEmissiveProperties(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);void 0!==f.emissiveStrength&&(j.emissiveIntensity=f.emissiveStrength)}}x(xq),b(xq,!0,(q=>new Rq(q)));const Aq="KHR_materials_sheen";class kq{constructor(q){this.name=Aq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(Aq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadSheenPropertiesAsync(d,g,j)),await Promise.all(h).then((()=>{}))}))}_loadSheenPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return j.sheen.isEnabled=!0,j.sheen.Xd=1,void 0!=f.sheenColorFactor?j.sheen.color=h.c.Pf(f.sheenColorFactor):j.sheen.color=h.c.Black(),f.sheenColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/sheenColorTexture`,f.sheenColorTexture,(q=>{q.name=`${j.name} (Sheen Color)`,j.sheen.texture=q}))),void 0!==f.sheenRoughnessFactor?j.sheen.roughness=f.sheenRoughnessFactor:j.sheen.roughness=0,f.sheenRoughnessTexture&&(f.sheenRoughnessTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${q}/sheenRoughnessTexture`,f.sheenRoughnessTexture,(q=>{q.name=`${j.name} (Sheen Roughness)`,j.sheen.textureRoughness=q})))),j.sheen.albedoScaling=!0,j.sheen.useRoughnessFromMainTexture=!1,Promise.all(d).then((()=>{}))}}x(Aq),b(Aq,!0,(q=>new kq(q)));var yq=j(11472);const pq="KHR_materials_specular";class lq{constructor(q){this.name=pq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(pq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;if(h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadSpecularPropertiesAsync(d,g,j)),g.extensions&&g.extensions.EXT_materials_specular_edge_color&&j instanceof w.d){g.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(j.brdf.dielectricSpecularModel=yq.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,j.brdf.conductorSpecularModel=yq.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(h).then((()=>{}))}))}_loadSpecularPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return void 0!==f.specularFactor&&(j.metallicF0Factor=f.specularFactor),void 0!==f.specularColorFactor&&(j.metallicReflectanceColor=h.c.Pf(f.specularColorFactor)),f.specularTexture&&(f.specularTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${q}/specularTexture`,f.specularTexture,(q=>{q.name=`${j.name} (Specular)`,j.metallicReflectanceTexture=q,j.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),f.specularColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/specularColorTexture`,f.specularColorTexture,(q=>{q.name=`${j.name} (Specular Color)`,j.reflectanceTexture=q}))),Promise.all(d).then((()=>{}))}}x(pq),b(pq,!0,(q=>new lq(q)));const Vq="KHR_materials_ior";class aq{constructor(q){this.name=Vq,this.order=180,this._loader=q,this.enabled=this._loader.isExtensionUsed(Vq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadIorPropertiesAsync(d,g,j)),await Promise.all(h).then((()=>{}))}))}_loadIorPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);return void 0!==f.ior?j.indexOfRefraction=f.ior:j.indexOfRefraction=aq._DEFAULT_IOR,Promise.resolve()}}aq._DEFAULT_IOR=1.5,x(Vq),b(Vq,!0,(q=>new aq(q)));const Pq="KHR_materials_variants";class Cq{constructor(q){this.name=Pq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Pq)}dispose(){this._loader=null}static GetAvailableVariants(q){const f=this._GetExtensionMetadata(q);return f?Object.keys(f.variants):[]}getAvailableVariants(q){return Cq.GetAvailableVariants(q)}static SelectVariant(q,f){const j=this._GetExtensionMetadata(q);if(!j)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Pq} extension`);const d=q=>{const f=j.variants[q];if(f)for(const j of f)j.mesh.material=j.material};if(f instanceof Array)for(const g of f)d(g);else d(f);j.lastSelected=f}selectVariant(q,f){Cq.SelectVariant(q,f)}static Reset(q){const f=this._GetExtensionMetadata(q);if(!f)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Pq} extension`);for(const j of f.original)j.mesh.material=j.material;f.lastSelected=null}reset(q){Cq.Reset(q)}static GetLastSelectedVariant(q){const f=this._GetExtensionMetadata(q);if(!f)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Pq} extension`);return f.lastSelected}getLastSelectedVariant(q){return Cq.GetLastSelectedVariant(q)}static _GetExtensionMetadata(q){var f,j;return(null===q||void 0===q||null===(f=q._internalMetadata)||void 0===f||null===(j=f.dd)||void 0===j?void 0:j[Pq])||null}onLoading(){const q=this._loader.dd.extensions;if(q&&q[this.name]){const f=q[this.name];this._variants=f.variants}}onReady(){const q=this._loader.rootBabylonMesh;if(q){var f;const j=this._loader.parent.extensionOptions[Pq];null!==j&&void 0!==j&&j.defaultVariant&&Cq.SelectVariant(q,j.defaultVariant),null===j||void 0===j||null===(f=j.onLoaded)||void 0===f||f.call(j,{get variants(){return Cq.GetAvailableVariants(q)},get selectedVariant(){const f=Cq.GetLastSelectedVariant(q);return f?Array.isArray(f)?f[0]:f:Cq.GetAvailableVariants(q)[0]},set selectedVariant(f){Cq.SelectVariant(q,f)}})}}_loadMeshPrimitiveAsync(q,f,j,d,g,h){return l.LoadExtensionAsync(q,g,this.name,(async(L,Q)=>{const H=new Array;return H.push(this._loader._loadMeshPrimitiveAsync(q,f,j,d,g,(f=>{if(h(f),f instanceof I.e){const j=l._GetDrawMode(q,g.mode),d=this._loader.rootBabylonMesh,h=d?d._internalMetadata=d._internalMetadata||{}:{},r=h.dd=h.dd||{},u=r[Pq]=r[Pq]||{lastSelected:null,original:[],variants:{}};u.original.push({mesh:f,material:f.material});for(let q=0;q<Q.mappings.length;++q){const g=Q.mappings[q],h=y.Get(`${L}/mappings/${q}/material`,this._loader.dd.materials,g.material);H.push(this._loader._loadMaterialAsync(`#/materials/${g.material}`,h,f,j,(q=>{for(let j=0;j<g.variants.length;++j){const h=g.variants[j],L=y.Get(`/extensions/${Pq}/variants/${h}`,this._variants,h);u.variants[L.name]=u.variants[L.name]||[],u.variants[L.name].push({mesh:f,material:q}),f.onClonedObservable.add((q=>{const j=q;let g=null,h=j;do{if(h=h.parent,!h)return;g=Cq._GetExtensionMetadata(h)}while(null===g);if(d&&g===Cq._GetExtensionMetadata(d)){h._internalMetadata={};for(const q in d._internalMetadata)h._internalMetadata[q]=d._internalMetadata[q];h._internalMetadata.dd=[];for(const q in d._internalMetadata.dd)h._internalMetadata.dd[q]=d._internalMetadata.dd[q];h._internalMetadata.dd[Pq]={lastSelected:null,original:[],variants:{}};for(const q of g.original)h._internalMetadata.dd[Pq].original.push({mesh:q.mesh,material:q.material});for(const q in g.variants)if(Object.prototype.hasOwnProperty.call(g.variants,q)){h._internalMetadata.dd[Pq].variants[q]=[];for(const f of g.variants[q])h._internalMetadata.dd[Pq].variants[q].push({mesh:f.mesh,material:f.material})}g=h._internalMetadata.dd[Pq]}for(const d of g.original)d.mesh===f&&(d.mesh=j);for(const d of g.variants[L.name])d.mesh===f&&(d.mesh=j)}))}})))}}}))),await Promise.all(H).then((q=>{let[f]=q;return f}))}))}}x(Pq),b(Pq,!0,(q=>new Cq(q)));var cq=j(11440);class Gq{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:yq.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(q,f){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Gq._GetDefaultOptions(),...q},this._scene=f,this._scene._transmissionHelper=this,this.onErrorObservable=new u.d,this._scene.qd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(q){if(!Object.keys(q).filter((f=>this._options[f]!==q[f])).length)return;const f={...this._options,...q},j=this._options;this._options=f,f.renderSize===j.renderSize&&f.renderTargetTextureType===j.renderTargetTextureType&&f.generateMipmaps===j.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=f.samples,this._opaqueRenderTarget.lodGenerationScale=f.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=f.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(q){return!!q&&!!(q instanceof w.d&&q.subSurface.isRefractionEnabled)}_addMesh(q){this._materialObservers[q.uniqueId]=q.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),L.h.SetImmediate((()=>{this._shouldRenderAsTransmission(q.material)?(q.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(q)&&this._transparentMeshesCache.push(q)):-1===this._opaqueMeshesCache.indexOf(q)&&this._opaqueMeshesCache.push(q)}))}_removeMesh(q){q.onMaterialChangedObservable.remove(this._materialObservers[q.uniqueId]),delete this._materialObservers[q.uniqueId];let f=this._transparentMeshesCache.indexOf(q);-1!==f&&this._transparentMeshesCache.splice(f,1),f=this._opaqueMeshesCache.indexOf(q),-1!==f&&this._opaqueMeshesCache.splice(f,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(q){const f=this._transparentMeshesCache.indexOf(q),j=this._opaqueMeshesCache.indexOf(q);this._shouldRenderAsTransmission(q.material)?(q.material instanceof w.d&&(q.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==j?(this._opaqueMeshesCache.splice(j,1),this._transparentMeshesCache.push(q)):-1===f&&this._transparentMeshesCache.push(q)):-1!==f?(this._transparentMeshesCache.splice(f,1),this._opaqueMeshesCache.push(q)):-1===j&&this._opaqueMeshesCache.push(q)}_isRenderTargetValid(){var q;return null!==(null===(q=this._opaqueRenderTarget)||void 0===q?void 0:q.getInternalTexture())}_setupRenderTargets(){var q;let f;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new cq.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(q=this._options.clearColor)||void 0===q?void 0:q.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((q=>{f=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?q.clearColor.H(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(q.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=f}));for(const j of this._transparentMeshesCache)this._shouldRenderAsTransmission(j.material)&&(j.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const mq="KHR_materials_transmission";class Kq{constructor(q){this.name=mq,this.order=175,this._loader=q,this.enabled=this._loader.isExtensionUsed(mq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadTransparentPropertiesAsync(d,f,j,g)),await Promise.all(h).then((()=>{}))}))}_loadTransparentPropertiesAsync(q,f,j,d){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const g=j;if(g.subSurface.isRefractionEnabled=!0,g.subSurface.volumeIndexOfRefraction=1,g.subSurface.useAlbedoToTintRefraction=!0,void 0===d.transmissionFactor)return g.subSurface.refractionIntensity=0,g.subSurface.isRefractionEnabled=!1,Promise.resolve();{var h;g.subSurface.refractionIntensity=d.transmissionFactor;const q=g.eq();if(g.subSurface.refractionIntensity&&!q._transmissionHelper)new Gq({},g.eq());else if(g.subSurface.refractionIntensity&&(null===(h=q._transmissionHelper)||void 0===h||!h._isRenderTargetValid())){var L;null===(L=q._transmissionHelper)||void 0===L||L._setupRenderTargets()}}return g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=0,d.transmissionTexture?(d.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/transmissionTexture`,d.transmissionTexture,void 0).then((q=>{q.name=`${j.name} (Transmission)`,g.subSurface.refractionIntensityTexture=q,g.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(mq),b(mq,!0,(q=>new Kq(q)));const Jq="KHR_materials_diffuse_transmission";class qf{constructor(q){this.name=Jq,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(Jq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadTranslucentPropertiesAsync(d,f,j,g)),await Promise.all(h).then((()=>{}))}))}_loadTranslucentPropertiesAsync(q,f,j,d){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const g=j;if(g.subSurface.isTranslucencyEnabled=!0,g.subSurface.volumeIndexOfRefraction=1,g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=0,g.subSurface.useAlbedoToTintTranslucency=!1,void 0===d.diffuseTransmissionFactor)return g.subSurface.translucencyIntensity=0,g.subSurface.isTranslucencyEnabled=!1,Promise.resolve();g.subSurface.translucencyIntensity=d.diffuseTransmissionFactor;const L=new Array;return g.subSurface.useGltfStyleTextures=!0,d.diffuseTransmissionTexture&&(d.diffuseTransmissionTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionTexture`,d.diffuseTransmissionTexture).then((q=>{q.name=`${j.name} (Diffuse Transmission)`,g.subSurface.translucencyIntensityTexture=q})))),void 0!==d.diffuseTransmissionColorFactor?g.subSurface.translucencyColor=h.c.Pf(d.diffuseTransmissionColorFactor):g.subSurface.translucencyColor=h.c.White(),d.diffuseTransmissionColorTexture&&L.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionColorTexture`,d.diffuseTransmissionColorTexture).then((q=>{q.name=`${j.name} (Diffuse Transmission Color)`,g.subSurface.translucencyColorTexture=q}))),Promise.all(L).then((()=>{}))}}x(Jq),b(Jq,!0,(q=>new qf(q)));const ff="KHR_materials_volume";class jf{constructor(q){this.name=ff,this.order=173,this._loader=q,this.enabled=this._loader.isExtensionUsed(ff),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadVolumePropertiesAsync(d,f,j,g)),await Promise.all(h).then((()=>{}))}))}_loadVolumePropertiesAsync(q,f,j,d){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);if(!j.subSurface.isRefractionEnabled&&!j.subSurface.isTranslucencyEnabled||!d.thicknessFactor)return Promise.resolve();j.subSurface.volumeIndexOfRefraction=j.indexOfRefraction;const g=void 0!==d.attenuationDistance?d.attenuationDistance:Number.MAX_VALUE;return j.subSurface.tintColorAtDistance=g,void 0!==d.attenuationColor&&3==d.attenuationColor.length&&j.subSurface.tintColor.Af(d.attenuationColor[0],d.attenuationColor[1],d.attenuationColor[2]),j.subSurface.minimumThickness=0,j.subSurface.maximumThickness=d.thicknessFactor,j.subSurface.useThicknessAsDepth=!0,d.thicknessTexture?(d.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/thicknessTexture`,d.thicknessTexture).then((q=>{q.name=`${j.name} (Thickness)`,j.subSurface.thicknessTexture=q,j.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(ff),b(ff,!0,(q=>new jf(q)));const df="KHR_materials_dispersion";class gf{constructor(q){this.name=df,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(df)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadDispersionPropertiesAsync(d,f,j,g)),await Promise.all(h).then((()=>{}))}))}_loadDispersionPropertiesAsync(q,f,j,d){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);return j.subSurface.isRefractionEnabled&&d.dispersion?(j.subSurface.isDispersionEnabled=!0,j.subSurface.dispersion=d.dispersion,Promise.resolve()):Promise.resolve()}}x(df),b(df,!0,(q=>new gf(q)));const hf="EXT_materials_diffuse_roughness";class Lf{constructor(q){this.name=hf,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(hf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(q,f,j)),h.push(this._loadDiffuseRoughnessPropertiesAsync(d,g,j)),await Promise.all(h).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(q,f,j){if(!(j instanceof w.d))throw new Error(`${q}: Material type not supported`);const d=new Array;return j.brdf.baseDiffuseModel=yq.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=f.diffuseRoughnessFactor?j.baseDiffuseRoughness=f.diffuseRoughnessFactor:j.baseDiffuseRoughness=0,f.diffuseRoughnessTexture&&d.push(this._loader.loadTextureInfoAsync(`${q}/diffuseRoughnessTexture`,f.diffuseRoughnessTexture,(q=>{q.name=`${j.name} (Diffuse Roughness)`,j.baseDiffuseRoughnessTexture=q}))),Promise.all(d).then((()=>{}))}}x(hf),b(hf,!0,(q=>new Lf(q)));const Qf="KHR_mesh_quantization";class Hf{constructor(q){this.name=Qf,this.enabled=q.isExtensionUsed(Qf)}dispose(){}}x(Qf),b(Qf,!0,(q=>new Hf(q)));const rf="KHR_texture_basisu";class uf{constructor(q){this.name=rf,this._loader=q,this.enabled=q.isExtensionUsed(rf)}dispose(){this._loader=null}_loadTextureAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>{const h=void 0==f.sampler?l.DefaultSampler:y.Get(`${q}/sampler`,this._loader.dd.samplers,f.sampler),L=y.Get(`${d}/source`,this._loader.dd.images,g.source);return await this._loader._createTextureAsync(q,h,L,(q=>{j(q)}),f._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!f._textureInfo.nonColorData)}))}}x(rf),b(rf,!0,(q=>new uf(q)));const Xf="KHR_texture_transform";class zf{constructor(q){this.name=Xf,this._loader=q,this.enabled=this._loader.isExtensionUsed(Xf)}dispose(){this._loader=null}loadTextureInfoAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(d,g)=>await this._loader.loadTextureInfoAsync(q,f,(q=>{if(!(q instanceof E.e))throw new Error(`${d}: Texture type not supported`);g.offset&&(q.uOffset=g.offset[0],q.vOffset=g.offset[1]),q.uRotationCenter=0,q.vRotationCenter=0,g.rotation&&(q.wAng=-g.rotation),g.scale&&(q.uScale=g.scale[0],q.vScale=g.scale[1]),void 0!=g.texCoord&&(q.coordinatesIndex=g.texCoord),j(q)}))))}}x(Xf),b(Xf,!0,(q=>new zf(q)));const Bf="KHR_xmp_json_ld";class Df{constructor(q){this.name=Bf,this.order=100,this._loader=q,this.enabled=this._loader.isExtensionUsed(Bf)}dispose(){this._loader=null}onLoading(){var q,f,j;if(null===this._loader.rootBabylonMesh)return;const d=null===(q=this._loader.dd.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld,g=null===(f=this._loader.dd.asset)||void 0===f||null===(j=f.extensions)||void 0===j?void 0:j.KHR_xmp_json_ld;if(d&&g){const q=+g.packet;d.packets&&q<d.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=d.packets[q])}}}function tf(q,f,j,d){return h.c.Pf(f,j).scale(d)}function Of(q,f,j,d){return f[j]*d}function Nf(q,f,j,d){return-f[j]*d}function wf(q,f,j,d){return f[j+1]*d}function Ef(q,f,j,d){return f[j]*d*2}function sf(q){return{scale:[new ef(z.e.ANIMATIONTYPE_FLOAT,`${q}.uScale`,Of,(()=>2)),new ef(z.e.ANIMATIONTYPE_FLOAT,`${q}.vScale`,wf,(()=>2))],offset:[new ef(z.e.ANIMATIONTYPE_FLOAT,`${q}.uOffset`,Of,(()=>2)),new ef(z.e.ANIMATIONTYPE_FLOAT,`${q}.vOffset`,wf,(()=>2))],rotation:[new ef(z.e.ANIMATIONTYPE_FLOAT,`${q}.wAng`,Nf,(()=>1))]}}x(Bf),b(Bf,!0,(q=>new Df(q)));class Sf extends V.AnimationPropertyInfo{buildAnimations(q,f,j,d){return[{babylonAnimatable:q._babylonCamera,babylonAnimation:this._buildAnimation(f,j,d)}]}}class ef extends V.AnimationPropertyInfo{buildAnimations(q,f,j,d){const g=[];for(const h in q._data)g.push({babylonAnimatable:q._data[h].babylonMaterial,babylonAnimation:this._buildAnimation(f,j,d)});return g}}class Zf extends V.AnimationPropertyInfo{buildAnimations(q,f,j,d){return[{babylonAnimatable:q._babylonLight,babylonAnimation:this._buildAnimation(f,j,d)}]}}(0,R.p)("/cameras/{}/orthographic/xmag",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"orthoLeft",Nf,(()=>1)),new Sf(z.e.ANIMATIONTYPE_FLOAT,"orthoRight",wf,(()=>1))]),(0,R.p)("/cameras/{}/orthographic/ymag",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"orthoBottom",Nf,(()=>1)),new Sf(z.e.ANIMATIONTYPE_FLOAT,"orthoTop",wf,(()=>1))]),(0,R.p)("/cameras/{}/orthographic/zfar",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"maxZ",Of,(()=>1))]),(0,R.p)("/cameras/{}/orthographic/znear",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"gd",Of,(()=>1))]),(0,R.p)("/cameras/{}/perspective/yfov",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"fov",Of,(()=>1))]),(0,R.p)("/cameras/{}/perspective/zfar",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"maxZ",Of,(()=>1))]),(0,R.p)("/cameras/{}/perspective/znear",[new Sf(z.e.ANIMATIONTYPE_FLOAT,"gd",Of,(()=>1))]),(0,R.p)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new ef(z.e.ANIMATIONTYPE_COLOR3,"albedoColor",tf,(()=>4)),new ef(z.e.ANIMATIONTYPE_FLOAT,"alpha",(function(q,f,j,d){return f[j+3]*d}),(()=>4))]),(0,R.p)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"metallic",Of,(()=>1))]),(0,R.p)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"roughness",Of,(()=>1))]);const If=sf("albedoTexture");(0,R.p)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",If.scale),(0,R.p)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",If.offset),(0,R.p)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",If.rotation);const Tf=sf("metallicTexture");(0,R.p)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Tf.scale),(0,R.p)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Tf.offset),(0,R.p)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Tf.rotation),(0,R.p)("/materials/{}/emissiveFactor",[new ef(z.e.ANIMATIONTYPE_COLOR3,"emissiveColor",tf,(()=>3))]);const Wf=sf("bumpTexture");(0,R.p)("/materials/{}/normalTexture/scale",[new ef(z.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Of,(()=>1))]),(0,R.p)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Wf.scale),(0,R.p)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Wf.offset),(0,R.p)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Wf.rotation),(0,R.p)("/materials/{}/occlusionTexture/strength",[new ef(z.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Of,(()=>1))]);const nf=sf("ambientTexture");(0,R.p)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",nf.scale),(0,R.p)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",nf.offset),(0,R.p)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",nf.rotation);const Uf=sf("emissiveTexture");(0,R.p)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Uf.scale),(0,R.p)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Uf.offset),(0,R.p)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Uf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new ef(z.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new ef(z.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Of,(()=>1))]);const Yf=sf("anisotropy.texture");(0,R.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Yf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Yf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Yf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Of,(()=>1))]);const vf=sf("clearCoat.texture");(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",vf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",vf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",vf.rotation);const Ff=sf("clearCoat.bumpTexture");(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new ef(z.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ff.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ff.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ff.rotation);const Mf=sf("clearCoat.textureRoughness");(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Mf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Mf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Mf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new ef(z.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_ior/ior",[new ef(z.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new ef(z.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new ef(z.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Of,(()=>1))]);const of=sf("iridescence.texture");(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",of.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",of.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",of.rotation);const bf=sf("iridescence.thicknessTexture");(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",bf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",bf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",bf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new ef(z.e.ANIMATIONTYPE_COLOR3,"sheen.color",tf,(()=>3))]),(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Of,(()=>1))]);const xf=sf("sheen.texture");(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",xf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",xf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",xf.rotation);const Rf=sf("sheen.textureRoughness");(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Rf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Rf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Rf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new ef(z.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",tf,(()=>3))]);const Af=sf("metallicReflectanceTexture");(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Af.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Af.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Af.rotation);const kf=sf("reflectanceTexture");(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",kf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",kf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",kf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Of,(()=>1))]);const yf=sf("subSurface.refractionIntensityTexture");(0,R.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",yf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",yf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",yf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new ef(z.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",tf,(()=>3))]),(0,R.p)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new ef(z.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Of,(()=>1))]),(0,R.p)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Of,(()=>1))]);const pf=sf("subSurface.thicknessTexture");(0,R.p)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",pf.scale),(0,R.p)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",pf.offset),(0,R.p)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",pf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new ef(z.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Of,(()=>1))]);const lf=sf("subSurface.translucencyIntensityTexture");(0,R.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",lf.scale),(0,R.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",lf.offset),(0,R.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",lf.rotation),(0,R.p)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new ef(z.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",tf,(()=>3))]);const Vf=sf("subSurface.translucencyColorTexture");(0,R.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Vf.scale),(0,R.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Vf.offset),(0,R.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Vf.rotation),(0,R.p)("/extensions/KHR_lights_punctual/lights/{}/color",[new Zf(z.e.ANIMATIONTYPE_COLOR3,"diffuse",tf,(()=>3))]),(0,R.p)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Zf(z.e.ANIMATIONTYPE_FLOAT,"intensity",Of,(()=>1))]),(0,R.p)("/extensions/KHR_lights_punctual/lights/{}/range",[new Zf(z.e.ANIMATIONTYPE_FLOAT,"range",Of,(()=>1))]),(0,R.p)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Zf(z.e.ANIMATIONTYPE_FLOAT,"innerAngle",Ef,(()=>1))]),(0,R.p)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Zf(z.e.ANIMATIONTYPE_FLOAT,"angle",Ef,(()=>1))]),(0,R.p)("/nodes/{}/extensions/EXT_lights_ies/color",[new Zf(z.e.ANIMATIONTYPE_COLOR3,"diffuse",tf,(()=>3))]),(0,R.p)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Zf(z.e.ANIMATIONTYPE_FLOAT,"intensity",Of,(()=>1))]);const af="KHR_animation_pointer";class Pf{constructor(q){this.name=af,this._loader=q,this._pathToObjectConverter=(0,R.m)(this._loader.dd)}get enabled(){return this._loader.isExtensionUsed(af)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(q,f,j,d,g){var h;const L=null===(h=d.target.extensions)||void 0===h?void 0:h.KHR_animation_pointer;if(!L||!this._pathToObjectConverter)return null;"pointer"!==d.target.path&&i.e.Warn(`${q}/target/path: Value (${d.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=d.target.node&&i.e.Warn(`${q}/target/node: Value (${d.target.node}) must not be present when using the ${this.name} extension`);const Q=`${q}/extensions/${this.name}`,H=L.pointer;if(!H)throw new Error(`${Q}: Pointer is missing`);try{const h=this._pathToObjectConverter.convert(H);if(!h.info.interpolation)throw new Error(`${Q}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(q,f,j,d,{object:h.object,info:h.info.interpolation},g)}catch(r){return i.e.Warn(`${Q}/pointer: Invalid pointer (${H}) skipped`),null}}}x(af),b(af,!0,(q=>new Pf(q)));class Cf{constructor(q,f,j){this.frame=q,this.action=f,this.onlyOnce=j,this.isDone=!1}_clone(){return new Cf(this.frame,this.action,this.onlyOnce)}}var cf=j(11016),Gf=j(11065),mf=j(11059);class Kf{get loop(){return this._loop}set loop(q){q!==this._loop&&(this._loop=q,this.updateOptions({loop:q}))}get currentTime(){var q;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.audioContext&&(this.isPlaying||this.isPaused)){const q=this.isPaused?0:Gf.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+q}return 0}get spatialSound(){return this._spatialSound}set spatialSound(q){if(q==this._spatialSound)return;const f=this.isPlaying;this.pause(),q?(this._spatialSound=q,this._updateSpatialParameters()):this._disableSpatialSound(),f&&this.play()}constructor(q,f,j){var d;let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new u.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=g.j.Zero(),this._localDirection=new g.j(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=q,j=j||D.d.LastCreatedScene)if(this._scene=j,Kf._SceneComponentInitialization(j),this._readyToPlayCallback=h,this._customAttenuationFunction=(q,f,j,d,g)=>f<j?q*(1-f/j):0,Q&&(this.autoplay=Q.autoplay||!1,this._loop=Q.loop||!1,void 0!==Q.volume&&(this._volume=Q.volume),this._spatialSound=Q.spatialSound??!1,this.maxDistance=Q.maxDistance??100,this.useCustomAttenuation=Q.useCustomAttenuation??!1,this.rolloffFactor=Q.rolloffFactor||1,this.refDistance=Q.refDistance||1,this.distanceModel=Q.distanceModel||"linear",this._playbackRate=Q.playbackRate||1,this._streaming=Q.streaming??!1,this._length=Q.length,this._offset=Q.offset),null!==(d=Gf.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&Gf.b.audioEngine.audioContext){this._soundGain=Gf.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let q=!0;if(f)try{"string"===typeof f?(this._urlType="String",this._url=f):f instanceof ArrayBuffer?this._urlType="ArrayBuffer":f instanceof HTMLMediaElement?this._urlType="MediaElement":f instanceof MediaStream?this._urlType="MediaStream":f instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(f)&&(this._urlType="Array");let j=[],d=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gf.b.audioEngine.audioContext.createMediaElementSource(f),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gf.b.audioEngine.audioContext.createMediaStreamSource(f),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":f.byteLength>0&&(d=!0,this._soundLoaded(f));break;case"AudioBuffer":this._audioBufferLoaded(f);break;case"String":j.push(f);case"Array":0===j.length&&(j=f);for(let q=0;q<j.length;q++){const f=j[q];if(d=Q&&Q.skipCodecCheck||-1!==f.indexOf(".mp3",f.length-4)&&Gf.b.audioEngine.isMP3supported||-1!==f.indexOf(".ogg",f.length-4)&&Gf.b.audioEngine.isOGGsupported||-1!==f.indexOf(".wav",f.length-4)||-1!==f.indexOf(".m4a",f.length-4)||-1!==f.indexOf(".mp4",f.length-4)||-1!==f.indexOf("blob:"),d){this._streaming?(this._htmlAudioElement=new Audio(f),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,L.h.SetCorsBehavior(f,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(f,(q=>{this._soundLoaded(q)}),void 0,!0,!0,(q=>{q&&i.e.Error("XHR "+q.status+" error on: "+f+"."),i.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:q=!1}q?d||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):i.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(H){i.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Gf.b.audioEngine&&!Gf.b.audioEngine.WarnedWebAudioUnsupported&&(i.e.Error("Web Audio is not supported by your browser."),Gf.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var q;null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(q){var f;null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.audioContext&&(this._audioBuffer=q,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(q){var f;null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.audioContext&&Gf.b.audioEngine.audioContext.decodeAudioData(q,(q=>{this._audioBufferLoaded(q)}),(q=>{i.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+q)}))}setAudioBuffer(q){var f;null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&(this._audioBuffer=q,this._isReadyToPlay=!0)}updateOptions(q){q&&(this.loop=q.loop??this.loop,this.maxDistance=q.maxDistance??this.maxDistance,this.useCustomAttenuation=q.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=q.rolloffFactor??this.rolloffFactor,this.refDistance=q.refDistance??this.refDistance,this.distanceModel=q.distanceModel??this.distanceModel,this._playbackRate=q.playbackRate??this._playbackRate,this._length=q.length??void 0,this.spatialSound=q.spatialSound??this._spatialSound,this._setOffset(q.offset??void 0),this.setVolume(q.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var q;null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&Gf.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Gf.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var q;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(q=this._soundPanner)||void 0===q||q.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var q;null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(q){var f;null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(q),this._isOutputConnected=!0)}setDirectionalCone(q,f,j){f<q?i.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=q,this._coneOuterAngle=f,this._coneOuterGain=j,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!=this._coneInnerAngle){var f;if(this._coneOuterAngle<q)return void i.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q,null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!=this._coneOuterAngle){var f;if(q<this._coneInnerAngle)return void i.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q,null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(q){var f;q.equals(this._position)||(this._position.H(q),null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(q){var f;this._localDirection=q,null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const q=this._connectedTransformNode.getWorldMatrix(),f=g.j.TransformNormal(this._localDirection,q);f.normalize(),this._soundPanner.orientationX.value=f.x,this._soundPanner.orientationY.value=f.y,this._soundPanner.orientationZ.value=f.z}updateDistanceFromListener(){var q;if(null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const q=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ej(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,q,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(q){this._customAttenuationFunction=q}play(q,f,j){var d;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(d=Gf.b.audioEngine)&&void 0!==d&&d.audioContext)try{var g,h;this._clearTimeoutsAndObservers();let d=q?(null===(g=Gf.b.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+q:null===(h=Gf.b.audioEngine)||void 0===h?void 0:h.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Gf.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const q=()=>{var j;if(null!==(j=Gf.b.audioEngine)&&void 0!==j&&j.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=f??0;const j=this._htmlAudioElement.play();void 0!==j&&j.catch((()=>{var f,j;(null===(f=Gf.b.audioEngine)||void 0===f||f.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(j=Gf.b.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{q()})))}))}else{var d;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(d=Gf.b.audioEngine)||void 0===d?void 0:d.onAudioUnlockedObservable.addOnce((()=>{q()}))}};q()}}else{var L;const g=()=>{var g;if(null!==(g=Gf.b.audioEngine)&&void 0!==g&&g.audioContext){var h;if(j=j||this._length,void 0!==f&&this._setOffset(f),this._soundSource){const q=this._soundSource;q.onended=()=>{q.disconnect()}}if(this._soundSource=null===(h=Gf.b.audioEngine)||void 0===h?void 0:h.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var L;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==f&&(this._soundSource.loopStart=f),void 0!==j&&(this._soundSource.loopEnd=(0|f)+j),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},d=q?(null===(L=Gf.b.audioEngine)||void 0===L?void 0:L.audioContext.currentTime)+q:Gf.b.audioEngine.audioContext.currentTime;const g=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(d,g,this.loop?void 0:j)}}};"suspended"===(null===(L=Gf.b.audioEngine)||void 0===L?void 0:L.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var q;"suspended"===(null===(q=Gf.b.audioEngine)||void 0===q?void 0:q.audioContext.state)?(Gf.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Gf.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{g()})))):g()}),500):g()}this._startTime=d,this.isPlaying=!0,this.isPaused=!1}catch(Q){i.e.Error("Error while trying to play audio: "+this.name+", "+Q.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(q){var f;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var j;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(j=this._streamingSource)||void 0===j||j.disconnect();this.isPlaying=!1}else if(null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.audioContext&&this._soundSource){const f=q?Gf.b.audioEngine.audioContext.currentTime+q:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(f)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var f;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(f=this._streamingSource)||void 0===f||f.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Gf.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(q,f){var j;null!==(j=Gf.b.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._soundGain&&(f&&Gf.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Gf.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Gf.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(q,Gf.b.audioEngine.audioContext.currentTime+f)):this._soundGain.gain.value=q),this._volume=q}setPlaybackRate(q){this._playbackRate=q,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(q){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=q,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=q=>this._onRegisterAfterWorldMatrixUpdate(q),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(q){var f;if(q.getBoundingInfo){const f=q.getBoundingInfo();this.setPosition(f.boundingSphere.centerWorld)}else this.setPosition(q.absolutePosition);null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const q=()=>{(0,mf.d)((()=>this._isReadyToPlay),(()=>{j._audioBuffer=this.getAudioBuffer(),j._isReadyToPlay=!0,j.autoplay&&j.play(0,this._offset,this._length)}),void 0,300)},f={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},j=new Kf(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,f);return this.useCustomAttenuation&&j.setAttenuationFunction(this._customAttenuationFunction),j.setPosition(this._position),j.setPlaybackRate(this._playbackRate),q(),j}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const q={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(q.connectedMeshId=this._connectedTransformNode.id),q.position=this._position.Yf(),q.refDistance=this.refDistance,q.distanceModel=this.distanceModel,q.isDirectional=this._isDirectional,q.localDirectionToMesh=this._localDirection.Yf(),q.coneInnerAngle=this._coneInnerAngle,q.coneOuterAngle=this._coneOuterAngle,q.coneOuterGain=this._coneOuterGain),q}static Parse(q,f,j,d){const h=q.name;let L;L=q.url?j+q.url:j+h;const Q={autoplay:q.autoplay,loop:q.loop,volume:q.volume,spatialSound:q.spatialSound,maxDistance:q.maxDistance,rolloffFactor:q.rolloffFactor,refDistance:q.refDistance,distanceModel:q.distanceModel,playbackRate:q.playbackRate};let H;if(d){const q=()=>{(0,mf.d)((()=>d._isReadyToPlay),(()=>{H._audioBuffer=d.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,H._offset,H._length)}),void 0,300)};H=new Kf(h,new ArrayBuffer(0),f,null,Q),q()}else H=new Kf(h,L,f,(()=>{f.removePendingData(H)}),Q),f.addPendingData(H);if(q.position){const f=g.j.Pf(q.position);H.setPosition(f)}if(q.isDirectional&&(H.setDirectionalCone(q.coneInnerAngle||360,q.coneOuterAngle||360,q.coneOuterGain||0),q.localDirectionToMesh)){const f=g.j.Pf(q.localDirectionToMesh);H.setLocalDirectionToMesh(f)}if(q.connectedMeshId){const j=f.getMeshById(q.connectedMeshId);j&&H.attachToMesh(j)}return q.metadata&&(H.metadata=q.metadata),H}_setOffset(q){this._offset!==q&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=q)}_clearTimeoutsAndObservers(){var q;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(q=Gf.b.audioEngine)||void 0===q||q.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Kf._SceneComponentInitialization=q=>{throw(0,cf.c)("AudioSceneComponent")},(0,Sq.f)("BABYLON.Sound",Kf);class Jf{constructor(q,f,j){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],f.length!==j.length)throw new Error("Sounds length does not equal weights length");this.loop=q,this._weights=j;let d=0;for(const h of j)d+=h;const g=d>0?1/d:0;for(let h=0;h<this._weights.length;h++)this._weights[h]*=g;this._sounds=f;for(const h of this._sounds)h.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!==this._coneInnerAngle){if(this._coneOuterAngle<q)return void i.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q;for(const f of this._sounds)f.directionalConeInnerAngle=q}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!==this._coneOuterAngle){if(q<this._coneInnerAngle)return void i.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q;for(const f of this._sounds)f.directionalConeOuterAngle=q}}get volume(){return this._volume}set volume(q){if(q!==this._volume)for(const f of this._sounds)f.setVolume(q)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(q){if(!this.isPaused){this.stop();const q=Math.random();let f=0;for(let j=0;j<this._weights.length;j++)if(f+=this._weights[j],q<=f){this._currentIndex=j;break}}const f=this._sounds[this._currentIndex??0];f.isReady()?f.play(0,this.isPaused?void 0:q):f.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class qj{constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(q=q||D.d.LastCreatedScene)&&(this._scene=q,this.soundCollection=[],this._options=f,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var q;null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&Gf.b.audioEngine.audioContext&&(this._outputAudioNode=Gf.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Gf.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Gf.b.audioEngine&&Gf.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(q){var f;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&q.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==q.soundTrackId&&(-1===q.soundTrackId?this._scene.mainSoundTrack.removeSound(q):this._scene.soundTracks&&this._scene.soundTracks[q.soundTrackId].removeSound(q)),this.soundCollection.push(q),q.soundTrackId=this.id}removeSound(q){const f=this.soundCollection.indexOf(q);-1!==f&&this.soundCollection.splice(f,1)}setVolume(q){var f;null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=q)}switchPanningModelToHRTF(){var q;if(null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let f=0;f<this.soundCollection.length;f++)this.soundCollection[f].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var q;if(null!==(q=Gf.b.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let f=0;f<this.soundCollection.length;f++)this.soundCollection[f].switchPanningModelToEqualPower()}connectToAnalyser(q){var f;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=q,null!==(f=Gf.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Gf.b.audioEngine.masterGain))}}var fj=j(11327),jj=j(11506),dj=j(10997);Gf.b.AudioEngineFactory=(q,f,j)=>new gj(q,f,j);class gj{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new u.d,this.onAudioLockedObservable=new u.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,dj.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const d=document.createElement("audio");this._hostElement=q,this._audioContext=f,this._audioDestination=j;try{d&&d.canPlayType&&(d.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||d.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(g){}try{d&&d.canPlayType&&d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(g){}}lock(){this._triggerSuspendedState()}unlock(){var q,f;if("running"===(null===(q=this._audioContext)||void 0===q?void 0:q.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(f=this._audioContext)||void 0===f||f.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{i.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var q;null===(q=this._audioContext)||void 0===q||q.addEventListener("statechange",(()=>{var q;this.unlocked&&"running"!==(null===(q=this._audioContext)||void 0===q?void 0:q.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var q;return null!==(q=this._audioContext)&&void 0!==q&&q.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(q){this.canUseWebAudio=!1,i.e.Error("Web Audio: "+q.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(q){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const q=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",f=document.createElement("style");f.appendChild(document.createTextNode(q)),document.getElementsByTagName("head")[0].appendChild(f),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var q;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(q=this._audioContext)||void 0===q||q.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(q){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=q)}connectToAnalyser(q){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=q,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var hj=j(11013);(0,j(12390).h)(fj.b.NAME_AUDIO,((q,f,j,d)=>{let g,h=[];if(j.QB=j.QB||[],void 0!==q.QB&&null!==q.QB)for(let Q=0,H=q.QB.length;Q<H;Q++){var L;const H=q.QB[Q];null!==(L=Gf.b.audioEngine)&&void 0!==L&&L.canUseWebAudio?(H.url||(H.url=H.name),h[H.url]?j.QB.push(Kf.Parse(H,f,d,h[H.url])):(g=Kf.Parse(H,f,d),h[H.url]=g,j.QB.push(g))):j.QB.push(new Kf(H.name,null,f))}h=[]})),Object.defineProperty(jj.b.prototype,"mainSoundTrack",{get:function(){let q=this._getComponent(fj.b.NAME_AUDIO);return q||(q=new Lj(this),this.if(q)),this._mainSoundTrack||(this._mainSoundTrack=new qj(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),jj.b.prototype.getSoundByName=function(q){let f;for(f=0;f<this.mainSoundTrack.soundCollection.length;f++)if(this.mainSoundTrack.soundCollection[f].name===q)return this.mainSoundTrack.soundCollection[f];if(this.soundTracks)for(let j=0;j<this.soundTracks.length;j++)for(f=0;f<this.soundTracks[j].soundCollection.length;f++)if(this.soundTracks[j].soundCollection[f].name===q)return this.soundTracks[j].soundCollection[f];return null},Object.defineProperty(jj.b.prototype,"audioEnabled",{get:function(){let q=this._getComponent(fj.b.NAME_AUDIO);return q||(q=new Lj(this),this.if(q)),q.audioEnabled},set:function(q){let f=this._getComponent(fj.b.NAME_AUDIO);f||(f=new Lj(this),this.if(f)),q?f.enableAudio():f.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(jj.b.prototype,"headphone",{get:function(){let q=this._getComponent(fj.b.NAME_AUDIO);return q||(q=new Lj(this),this.if(q)),q.headphone},set:function(q){let f=this._getComponent(fj.b.NAME_AUDIO);f||(f=new Lj(this),this.if(f)),q?f.switchAudioModeForHeadphones():f.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(jj.b.prototype,"audioListenerPositionProvider",{get:function(){let q=this._getComponent(fj.b.NAME_AUDIO);return q||(q=new Lj(this),this.if(q)),q.audioListenerPositionProvider},set:function(q){let f=this._getComponent(fj.b.NAME_AUDIO);if(f||(f=new Lj(this),this.if(f)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");f.audioListenerPositionProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(jj.b.prototype,"audioListenerRotationProvider",{get:function(){let q=this._getComponent(fj.b.NAME_AUDIO);return q||(q=new Lj(this),this.if(q)),q.audioListenerRotationProvider},set:function(q){let f=this._getComponent(fj.b.NAME_AUDIO);if(f||(f=new Lj(this),this.if(f)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");f.audioListenerRotationProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(jj.b.prototype,"audioPositioningRefreshRate",{get:function(){let q=this._getComponent(fj.b.NAME_AUDIO);return q||(q=new Lj(this),this.if(q)),q.audioPositioningRefreshRate},set:function(q){let f=this._getComponent(fj.b.NAME_AUDIO);f||(f=new Lj(this),this.if(f)),f.audioPositioningRefreshRate=q},enumerable:!0,configurable:!0});class Lj{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(q){this.name=fj.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new g.j,this._cachedCameraPosition=new g.j,this._lastCheck=0,this._invertMatrixTemp=new g.b,this._cameraDirectionTemp=new g.j,(q=q||D.d.LastCreatedScene)&&(this.Sf=q,q.soundTracks=[],q.QB=[])}register(){this.Sf._afterRenderStage.registerStep(fj.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(q){if(q.QB=[],this.Sf.soundTracks)for(let f=0;f<this.Sf.soundTracks.length;f++){const j=this.Sf.soundTracks[f];for(let f=0;f<j.soundCollection.length;f++)q.QB.push(j.soundCollection[f].serialize())}}addFromContainer(q){if(q.QB)for(const f of q.QB)f.play(),f.autoplay=!0,this.Sf.mainSoundTrack.addSound(f)}removeFromContainer(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q.QB)for(const j of q.QB)j.stop(),j.autoplay=!1,this.Sf.mainSoundTrack.removeSound(j),f&&j.dispose()}dispose(){const q=this.Sf;if(q._mainSoundTrack&&q.mainSoundTrack.dispose(),q.soundTracks)for(let f=0;f<q.soundTracks.length;f++)q.soundTracks[f].dispose()}disableAudio(){const q=this.Sf;let f;for(this._audioEnabled=!1,Gf.b.audioEngine&&Gf.b.audioEngine.audioContext&&Gf.b.audioEngine.audioContext.suspend(),f=0;f<q.mainSoundTrack.soundCollection.length;f++)q.mainSoundTrack.soundCollection[f].pause();if(q.soundTracks)for(f=0;f<q.soundTracks.length;f++)for(let j=0;j<q.soundTracks[f].soundCollection.length;j++)q.soundTracks[f].soundCollection[j].pause()}enableAudio(){const q=this.Sf;let f;for(this._audioEnabled=!0,Gf.b.audioEngine&&Gf.b.audioEngine.audioContext&&Gf.b.audioEngine.audioContext.resume(),f=0;f<q.mainSoundTrack.soundCollection.length;f++)q.mainSoundTrack.soundCollection[f].isPaused&&q.mainSoundTrack.soundCollection[f].play();if(q.soundTracks)for(f=0;f<q.soundTracks.length;f++)for(let j=0;j<q.soundTracks[f].soundCollection.length;j++)q.soundTracks[f].soundCollection[j].isPaused&&q.soundTracks[f].soundCollection[j].play()}switchAudioModeForHeadphones(){const q=this.Sf;if(this._headphone=!0,q.mainSoundTrack.switchPanningModelToHRTF(),q.soundTracks)for(let f=0;f<q.soundTracks.length;f++)q.soundTracks[f].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const q=this.Sf;if(this._headphone=!1,q.mainSoundTrack.switchPanningModelToEqualPower(),q.soundTracks)for(let f=0;f<q.soundTracks.length;f++)q.soundTracks[f].switchPanningModelToEqualPower()}_afterRender(){const q=hj.c.Now;if(this._lastCheck&&q-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=q;const f=this.Sf;if(!this._audioEnabled||!f._mainSoundTrack||!f.soundTracks||0===f._mainSoundTrack.soundCollection.length&&1===f.soundTracks.length)return;const j=Gf.b.audioEngine;if(j&&j.audioContext){let q,d=f.activeCamera;if(f.activeCameras&&f.activeCameras.length>0&&(d=f.activeCameras[0]),this.audioListenerPositionProvider){const q=this.audioListenerPositionProvider();j.audioContext.listener.setPosition(q.x||0,q.y||0,q.z||0)}else d?this._cachedCameraPosition.equals(d.globalPosition)||(this._cachedCameraPosition.H(d.globalPosition),j.audioContext.listener.setPosition(d.globalPosition.x,d.globalPosition.y,d.globalPosition.z)):j.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const q=this.audioListenerRotationProvider();j.audioContext.listener.setOrientation(q.x||0,q.y||0,q.z||0,0,1,0)}else d?(d.rigCameras&&d.rigCameras.length>0&&(d=d.rigCameras[0]),d.getViewMatrix().invertToRef(this._invertMatrixTemp),g.j.TransformNormalToRef(Lj._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.H(this._cameraDirectionTemp),j.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):j.audioContext.listener.setOrientation(0,0,0,0,1,0);for(q=0;q<f.mainSoundTrack.soundCollection.length;q++){const j=f.mainSoundTrack.soundCollection[q];j.useCustomAttenuation&&j.updateDistanceFromListener()}if(f.soundTracks)for(q=0;q<f.soundTracks.length;q++)for(let j=0;j<f.soundTracks[q].soundCollection.length;j++){const d=f.soundTracks[q].soundCollection[j];d.useCustomAttenuation&&d.updateDistanceFromListener()}}}}Lj._CameraDirection=new g.j(0,0,-1),Kf._SceneComponentInitialization=q=>{let f=q._getComponent(fj.b.NAME_AUDIO);f||(f=new Lj(q),q.if(f))};const Qj="MSFT_audio_emitter";class Hj{constructor(q){this.name=Qj,this._loader=q,this.enabled=this._loader.isExtensionUsed(Qj)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const q=this._loader.dd.extensions;if(q&&q[this.name]){const f=q[this.name];this._clips=f.clips,this._emitters=f.emitters,y.Assign(this._clips),y.Assign(this._emitters)}}loadSceneAsync(q,f){return l.LoadExtensionAsync(q,f,this.name,(async(j,d)=>{const g=new Array;g.push(this._loader.loadSceneAsync(q,f));for(const q of d.emitters){const f=y.Get(`${j}/emitters`,this._emitters,q);if(void 0!=f.refDistance||void 0!=f.maxDistance||void 0!=f.rolloffFactor||void 0!=f.distanceModel||void 0!=f.innerAngle||void 0!=f.outerAngle)throw new Error(`${j}: Direction or Distance properties are not allowed on emitters attached to a scene`);g.push(this._loadEmitterAsync(`${j}/emitters/${f.index}`,f))}await Promise.all(g)}))}loadNodeAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(q,d)=>{const h=new Array,Q=await this._loader.loadNodeAsync(q,f,(f=>{for(const j of d.emitters){const d=y.Get(`${q}/emitters`,this._emitters,j);h.push(this._loadEmitterAsync(`${q}/emitters/${d.index}`,d).then((()=>{for(const q of d._babylonSounds)q.attachToMesh(f),void 0==d.innerAngle&&void 0==d.outerAngle||(q.setLocalDirectionToMesh(g.j.Forward()),q.setDirectionalCone(2*L.h.ToDegrees(void 0==d.innerAngle?Math.PI:d.innerAngle),2*L.h.ToDegrees(void 0==d.outerAngle?Math.PI:d.outerAngle),0))})))}j(f)}));return await Promise.all(h),Q}))}loadAnimationAsync(q,f){return l.LoadExtensionAsync(q,f,this.name,(async(j,d)=>{const g=await this._loader.loadAnimationAsync(q,f),h=new Array;y.Assign(d.events);for(const L of d.events)h.push(this._loadAnimationEventAsync(`${j}/events/${L.index}`,q,f,L,g));return await Promise.all(h),g}))}_loadClipAsync(q,f){if(f._objectURL)return f._objectURL;let j;if(f.uri)j=this._loader.loadUriAsync(q,f,f.uri);else{const d=y.Get(`${q}/bufferView`,this._loader.dd.bufferViews,f.bufferView);j=this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return f._objectURL=j.then((q=>URL.createObjectURL(new Blob([q],{type:f.mimeType})))),f._objectURL}_loadEmitterAsync(q,f){if(f._babylonSounds=f._babylonSounds||[],!f._babylonData){const q=new Array,j=f.name||`emitter${f.index}`,d={loop:!1,autoplay:!1,volume:void 0==f.volume?1:f.volume};for(let h=0;h<f.clips.length;h++){const g=`/extensions/${this.name}/clips`,L=y.Get(g,this._clips,f.clips[h].clip);q.push(this._loadClipAsync(`${g}/${f.clips[h].clip}`,L).then((q=>{const g=f._babylonSounds[h]=new Kf(j,q,this._loader.babylonScene,null,d);g.refDistance=f.refDistance||1,g.maxDistance=f.maxDistance||256,g.rolloffFactor=f.rolloffFactor||1,g.distanceModel=f.distanceModel||"exponential"})))}const g=Promise.all(q).then((()=>{const q=f.clips.map((q=>q.weight||1)),j=new Jf(f.loop||!1,f._babylonSounds,q);f.innerAngle&&(j.directionalConeInnerAngle=2*L.h.ToDegrees(f.innerAngle)),f.outerAngle&&(j.directionalConeOuterAngle=2*L.h.ToDegrees(f.outerAngle)),f.volume&&(j.volume=f.volume),f._babylonData.sound=j}));f._babylonData={loaded:g}}return f._babylonData.loaded}_getEventAction(q,f,j,d,g){switch(j){case"play":return q=>{const j=(g||0)+(q-d);f.play(j)};case"stop":return()=>{f.stop()};case"pause":return()=>{f.pause()};default:throw new Error(`${q}: Unsupported action ${j}`)}}_loadAnimationEventAsync(q,f,j,d,g){if(0==g.targetedAnimations.length)return Promise.resolve();const h=g.targetedAnimations[0],L=d.k,Q=y.Get(`/extensions/${this.name}/emitters`,this._emitters,L);return this._loadEmitterAsync(q,Q).then((()=>{const f=Q._babylonData.sound;if(f){const j=new Cf(d.time,this._getEventAction(q,f,d.action,d.time,d.startOffset));h.animation.addEvent(j),g.onAnimationGroupEndObservable.add((()=>{f.stop()})),g.onAnimationGroupPauseObservable.add((()=>{f.pause()}))}}))}}x(Qj),b(Qj,!0,(q=>new Hj(q)));const rj="MSFT_lod";class uj{constructor(q){var f;this.name=rj,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new u.d,this.onMaterialLODsLoadedObservable=new u.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=q,this.maxLODsToLoad=(null===(f=this._loader.parent.extensionOptions[rj])||void 0===f?void 0:f.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(rj)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let q=0;q<this._nodePromiseLODs.length;q++){const f=Promise.all(this._nodePromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Node LOD ${q}`),this._loader.log(`Loaded node LOD ${q}`)),this.onNodeLODsLoadedObservable.notifyObservers(q),q!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${q+1}`),this._loadBufferLOD(this._nodeBufferLODs,q+1),this._nodeSignalLODs[q]&&this._nodeSignalLODs[q].resolve())}));this._loader._completePromises.push(f)}for(let q=0;q<this._materialPromiseLODs.length;q++){const f=Promise.all(this._materialPromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Material LOD ${q}`),this._loader.log(`Loaded material LOD ${q}`)),this.onMaterialLODsLoadedObservable.notifyObservers(q),q!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${q+1}`),this._loadBufferLOD(this._materialBufferLODs,q+1),this._materialSignalLODs[q]&&this._materialSignalLODs[q].resolve())}));this._loader._completePromises.push(f)}}loadSceneAsync(q,f){const j=this._loader.loadSceneAsync(q,f);return this._loadBufferLOD(this._bufferLODs,0),j}loadNodeAsync(q,f,j){return l.LoadExtensionAsync(q,f,this.name,(async(q,g)=>{let h;const L=this._getLODs(q,f,this._loader.dd.nodes,g.ids);this._loader.logOpen(`${q}`);for(let f=0;f<L.length;f++){const q=L[f];0!==f&&(this._nodeIndexLOD=f,this._nodeSignalLODs[f]=this._nodeSignalLODs[f]||new d);const g=q=>{j(q),q.DH(!1)},Q=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,g).then((q=>{if(0!==f){const q=L[f-1];q._babylonTransformNode&&(this._disposeTransformNode(q._babylonTransformNode),delete q._babylonTransformNode)}return q.DH(!0),q}));this._nodePromiseLODs[f]=this._nodePromiseLODs[f]||[],0===f?h=Q:(this._nodeIndexLOD=null,this._nodePromiseLODs[f].push(Q))}return this._loader.logClose(),await h}))}_loadMaterialAsync(q,f,j,d,g){return this._nodeIndexLOD?null:l.LoadExtensionAsync(q,f,this.name,(async(q,h)=>{let L;const Q=this._getLODs(q,f,this._loader.dd.materials,h.ids);this._loader.logOpen(`${q}`);for(let f=0;f<Q.length;f++){const q=Q[f];0!==f&&(this._materialIndexLOD=f);const h=this._loader._loadMaterialAsync(`/materials/${q.index}`,q,j,d,(q=>{0===f&&g(q)})).then((q=>{if(0!==f){g(q);const j=Q[f-1]._data;j[d]&&(this._disposeMaterials([j[d].babylonMaterial]),delete j[d])}return q}));this._materialPromiseLODs[f]=this._materialPromiseLODs[f]||[],0===f?L=h:(this._materialIndexLOD=null,this._materialPromiseLODs[f].push(h))}return this._loader.logClose(),await L}))}_loadUriAsync(q,f,j){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const g=this._nodeIndexLOD-1;return this._nodeSignalLODs[g]=this._nodeSignalLODs[g]||new d,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(q,f,j)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const g=this._materialIndexLOD-1;return this._materialSignalLODs[g]=this._materialSignalLODs[g]||new d,this._materialSignalLODs[g].promise.then((async()=>await this._loader.loadUriAsync(q,f,j)))}return null}loadBufferAsync(q,f,j,g){if(this._loader.parent.useRangeRequests&&!f.uri){if(!this._loader.bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);const f=async(q,f)=>{const h=j,L=h+g-1;let Q=q[f];return Q?(Q.start=Math.min(Q.start,h),Q.end=Math.max(Q.end,L)):(Q={start:h,end:L,loaded:new d},q[f]=Q),await Q.loaded.promise.then((q=>new Uint8Array(q.buffer,q.byteOffset+j-Q.start,g)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?f(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?f(this._materialBufferLODs,this._materialIndexLOD):f(this._bufferLODs,0)}return null}_loadBufferLOD(q,f){const j=q[f];j&&(this._loader.log(`Loading buffer range [${j.start}-${j.end}]`),this._loader.bin.readAsync(j.start,j.end-j.start+1).then((q=>{j.loaded.resolve(q)}),(q=>{j.loaded.reject(q)})))}_getLODs(q,f,j,d){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const g=[];for(let h=d.length-1;h>=0;h--)if(g.push(y.Get(`${q}/ids/${d[h]}`,j,d[h])),g.length===this.maxLODsToLoad)return g;return g.push(f),g}_disposeTransformNode(q){const f=[],j=q.material;j&&f.push(j);for(const g of q.getChildMeshes())g.material&&f.push(g.material);q.dispose();const d=f.filter((q=>this._loader.babylonScene.meshes.every((f=>f.material!=q))));this._disposeMaterials(d)}_disposeMaterials(q){const f={};for(const j of q){for(const q of j.getActiveTextures())f[q.uniqueId]=q;j.dispose()}for(const j in f)for(const q of this._loader.babylonScene.materials)q.hasTexture(f[j])&&delete f[j];for(const j in f)f[j].dispose()}}x(rj),b(rj,!0,(q=>new uj(q)));const Xj="MSFT_minecraftMesh";class zj{constructor(q){this.name=Xj,this._loader=q,this.enabled=this._loader.isExtensionUsed(Xj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtraAsync(q,f,this.name,(async(d,g)=>{if(g){if(!(j instanceof w.d))throw new Error(`${d}: Material type not supported`);const g=this._loader.loadMaterialPropertiesAsync(q,f,j);return j.needAlphaBlending()&&(j.forceDepthWrite=!0,j.separateCullingPass=!0),j.ef=j.forceDepthWrite,j.twoSidedLighting=!0,await g}}))}}x(Xj),b(Xj,!0,(q=>new zj(q)));const Bj="MSFT_sRGBFactors";class Dj{constructor(q){this.name=Bj,this._loader=q,this.enabled=this._loader.isExtensionUsed(Bj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,f,j){return l.LoadExtraAsync(q,f,this.name,(async(d,g)=>{if(g){if(!(j instanceof w.d))throw new Error(`${d}: Material type not supported`);const g=this._loader.loadMaterialPropertiesAsync(q,f,j),h=j.eq().getEngine().useExactSrgbConversions;return j.albedoTexture||j.albedoColor.toLinearSpaceToRef(j.albedoColor,h),j.reflectivityTexture||j.reflectivityColor.toLinearSpaceToRef(j.reflectivityColor,h),await g}}))}}x(Bj),b(Bj,!0,(q=>new Dj(q)));var ij=j(12691);const tj={};var Oj=j(12742),Nj=j(12721),wj=j(12699),Ej=j(12709);function sj(q,f){for(const j of q)for(const q of j.dataOutputs)if(q.uniqueId===f)return q;throw new Error("Could not find data out connection with unique id "+f)}function Sj(q,f){for(const j of q)if(j instanceof Nj.b)for(const q of j.signalInputs)if(q.uniqueId===f)return q;throw new Error("Could not find signal in connection with unique id "+f)}async function ej(q,f){const d=await Promise.all(q.allBlocks.map((async q=>{const f=function(q){switch(q){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([j.e(58),j.e(59)]).then(j.bind(j,14117))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await j.e(60).then(j.bind(j,14121))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await j.e(61).then(j.bind(j,14126))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await j.e(62).then(j.bind(j,14131))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await j.e(63).then(j.bind(j,14134))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await j.e(64).then(j.bind(j,14137))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await j.e(65).then(j.bind(j,14142))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await j.e(66).then(j.bind(j,14146))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await j.e(67).then(j.bind(j,14151))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await j.e(70).then(j.bind(j,14189))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await j.e(70).then(j.bind(j,14189))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await j.e(70).then(j.bind(j,14189))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await j.e(70).then(j.bind(j,14189))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await j.e(75).then(j.bind(j,14196))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await j.e(76).then(j.bind(j,14201))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await j.e(77).then(j.bind(j,14205))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await j.e(78).then(j.bind(j,14208))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await j.e(79).then(j.bind(j,14217))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await j.e(80).then(j.bind(j,14223))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await j.e(81).then(j.bind(j,14231))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await j.e(82).then(j.bind(j,14234))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await j.e(83).then(j.bind(j,14243))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await j.e(84).then(j.bind(j,14247))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await j.e(85).then(j.bind(j,14255))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await j.e(86).then(j.bind(j,14257))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await j.e(87).then(j.bind(j,14260))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await j.e(88).then(j.bind(j,14263))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await j.e(89).then(j.bind(j,14266))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await j.e(90).then(j.bind(j,14273))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await j.e(91).then(j.bind(j,14276))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await j.e(92).then(j.bind(j,14281))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await j.e(93).then(j.bind(j,14286))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await j.e(72).then(j.bind(j,14291))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await j.e(94).then(j.bind(j,14298))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await j.e(95).then(j.bind(j,14305))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await j.e(96).then(j.bind(j,14307))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await j.e(73).then(j.bind(j,14315))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await j.e(68).then(j.bind(j,14157))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await j.e(74).then(j.bind(j,14321))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await j.e(69).then(j.bind(j,14182))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await j.e(70).then(j.bind(j,14189))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await j.e(70).then(j.bind(j,14189))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await j.e(71).then(j.bind(j,14325))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await j.e(71).then(j.bind(j,14325))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await j.e(71).then(j.bind(j,14325))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await j.e(71).then(j.bind(j,14325))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await j.e(71).then(j.bind(j,14325))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await j.e(71).then(j.bind(j,14325))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await j.e(97).then(j.bind(j,14333))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await j.e(98).then(j.bind(j,14336))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await j.e(99).then(j.bind(j,14343))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await j.e(100).then(j.bind(j,14351))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await j.e(101).then(j.bind(j,14355))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await j.e(102).then(j.bind(j,14360))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await j.e(103).then(j.bind(j,14369))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await j.e(104).then(j.bind(j,14378))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await j.e(105).then(j.bind(j,14387))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await j.e(106).then(j.bind(j,14391))).FlowGraphDataSwitchBlock;default:if(tj[q])return tj[q];throw new Error(`Unknown block name ${q}`)}}(q.className);return await f()})));return function(q,f,j){const d=f.coordinator.createGraph(),g=[],h=f.valueParseFunction??wj.d;for(let L=0;L<q.allBlocks.length;L++){const Q=Ij(q.allBlocks[L],{Sf:f.coordinator.config.Sf,pathConverter:f.pathConverter,assetsContainer:f.coordinator.config.Sf,valueParseFunction:h},j[L]);g.push(Q),Q instanceof Oj.e&&d.addEventBlock(Q)}for(const L of g){for(const q of L.dataInputs)for(const f of q.connectedPointIds){const j=sj(g,f);q.connectTo(j)}if(L instanceof Nj.b)for(const q of L.signalOutputs)for(const f of q.connectedPointIds){const j=Sj(g,f);q.connectTo(j)}}for(const L of q.executionContexts)Zj(L,{graph:d,valueParseFunction:h},q.rightHanded);return d}(q,f,d)}function Zj(q,f,j){const d=f.graph.createContext();q.enableLogging&&(d.enableLogging=!0),d.treatDataAsRightHanded=j||!1;const g=f.valueParseFunction??wj.d;d.uniqueId=q.uniqueId;const h=d.eq();if(q._assetsContext){var L,Q,H,r,u,X,z,B,D,i;const f=q._assetsContext,j={meshes:null===(L=f.meshes)||void 0===L?void 0:L.map((q=>h.getMeshById(q))),lights:null===(Q=f.lights)||void 0===Q?void 0:Q.map((q=>h.getLightByName(q))),cameras:null===(H=f.cameras)||void 0===H?void 0:H.map((q=>h.getCameraByName(q))),materials:null===(r=f.materials)||void 0===r?void 0:r.map((q=>h.getMaterialById(q))),textures:null===(u=f.textures)||void 0===u?void 0:u.map((q=>h.getTextureByName(q))),animations:null===(X=f.animations)||void 0===X?void 0:X.map((q=>h.animations.find((f=>f.name===q)))),skeletons:null===(z=f.skeletons)||void 0===z?void 0:z.map((q=>h.getSkeletonByName(q))),ez:null===(B=f.ez)||void 0===B?void 0:B.map((q=>h.getParticleSystemById(q))),animationGroups:null===(D=f.animationGroups)||void 0===D?void 0:D.map((q=>h.getAnimationGroupByName(q))),transformNodes:null===(i=f.transformNodes)||void 0===i?void 0:i.map((q=>h.getTransformNodeById(q))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],QB:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};d.assetsContext=j}for(const t in q._userVariables){const f=g(t,q._userVariables,d.assetsContext,h);d.userVariables[t]=f}for(const t in q._connectionValues){const f=g(t,q._connectionValues,d.assetsContext,h);d._setConnectionValueByKey(t,f)}return d}function Ij(q,f,j){const d={},g=f.valueParseFunction??wj.d;if(q.config)for(const L in q.config)d[L]=g(L,q.config,f.assetsContainer||f.Sf,f.Sf);if((0,wj.g)(q.className)){if(!f.pathConverter)throw new Error("Path converter is required for this block");d.pathConverter=f.pathConverter}const h=new j(d);h.uniqueId=q.uniqueId;for(let L=0;L<q.dataInputs.length;L++){const f=h.getDataInput(q.dataInputs[L].name);if(!f)throw new Error("Could not find data input with name "+q.dataInputs[L].name+" in block "+q.className);f.deserialize(q.dataInputs[L])}for(let L=0;L<q.dataOutputs.length;L++){const f=h.getDataOutput(q.dataOutputs[L].name);if(!f)throw new Error("Could not find data output with name "+q.dataOutputs[L].name+" in block "+q.className);f.deserialize(q.dataOutputs[L])}return h.metadata=q.metadata,h.deserialize&&h.deserialize(q),h}function Tj(q){const[f,j]=q.split(":");return Wj({op:f,extension:j})}function Wj(q){var f;let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=q.extension?null===(f=Uj[q.extension])||void 0===f?void 0:f[q.op]:Yj[q.op];if(!d&&(i.e.Warn(`No mapping found for operation ${q.op} and extension ${q.extension||"KHR_interactivity"}`),j)){const f={},j={flows:{}};if(q.inputValueSockets){f.values={};for(const j in q.inputValueSockets)f.values[j]={name:j}}return q.outputValueSockets&&(j.values={},Object.keys(q.outputValueSockets).forEach((q=>{j.values[q]={name:q}}))),{Au:[],inputs:f,outputs:j}}return d}function nj(q,f,j){Uj[f]||(Uj[f]={}),Uj[f][q]=j}const Uj={BABYLON:{"flow/log":{Au:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Yj={"event/onStart":{Au:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Au:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Au:["FlowGraphSendCustomEventBlock"],extraProcessor(q,f,j,d,g){if("event/send"!==f.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const h=q.configuration.event.value[0];if("number"!==typeof h)throw new Error("Event id should be a number");const L=d.arrays.events[h],Q=g[0];return Q.config||(Q.config={}),Q.config.eventId=L.eventId,Q.config.eventData=L.eventData,g}},"event/receive":{Au:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(q,f){var j;if(!q.configuration)return i.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const d=q.configuration.event;if(!d)return i.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const g=d.value[0];if("number"!==typeof g)return i.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(j=f.events)||void 0===j?void 0:j[g])?{valid:!0}:(i.e.Error(`Event with id ${g} not found`),{valid:!1,error:`Event with id ${g} not found`})},extraProcessor(q,f,j,d,g){if("event/receive"!==f.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const h=q.configuration.event.value[0];if("number"!==typeof h)throw new Error("Event id should be a number");const L=d.arrays.events[h],Q=g[0];return Q.config||(Q.config={}),Q.config.eventId=L.eventId,Q.config.eventData=L.eventData,g}},"math/e":vj("FlowGraphEBlock"),"math/pi":vj("FlowGraphPIBlock"),"math/inf":vj("FlowGraphInfBlock"),"math/nan":vj("FlowGraphNaNBlock"),"math/abs":vj("FlowGraphAbsBlock"),"math/sign":vj("FlowGraphSignBlock"),"math/trunc":vj("FlowGraphTruncBlock"),"math/floor":vj("FlowGraphFloorBlock"),"math/ceil":vj("FlowGraphCeilBlock"),"math/round":{Au:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g){var h;return(h=g[0]).config||(h.config={}),g[0].config.roundHalfAwayFromZero=!0,g}},"math/fract":vj("FlowGraphFractBlock"),"math/neg":vj("FlowGraphNegationBlock"),"math/add":vj("FlowGraphAddBlock",["a","b"],!0),"math/sub":vj("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Au:["FlowGraphMultiplyBlock"],extraProcessor(q,f,j,d,g){var h;(h=g[0]).config||(h.config={}),g[0].config.useMatrixPerComponent=!0,g[0].config.preventIntegerFloatArithmetic=!0;let L=-1;return Object.keys(q.values||{}).find((f=>{var j;return void 0!==(null===(j=q.values)||void 0===j?void 0:j[f].type)&&(L=q.values[f].type,!0)})),-1!==L&&(g[0].config.type=d.arrays.types[L].flowGraphType),g},validation:q=>q.values?Fj(q):{valid:!0}},"math/div":vj("FlowGraphDivideBlock",["a","b"],!0),"math/rem":vj("FlowGraphModuloBlock",["a","b"]),"math/min":vj("FlowGraphMinBlock",["a","b"]),"math/max":vj("FlowGraphMaxBlock",["a","b"]),"math/clamp":vj("FlowGraphClampBlock",["a","b","c"]),"math/saturate":vj("FlowGraphSaturateBlock"),"math/mix":vj("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":vj("FlowGraphEqualityBlock",["a","b"]),"math/lt":vj("FlowGraphLessThanBlock",["a","b"]),"math/le":vj("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":vj("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":vj("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":vj("FlowGraphIsNaNBlock"),"math/isinf":vj("FlowGraphIsInfBlock"),"math/select":{Au:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Au:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":vj("FlowGraphSinBlock"),"math/cos":vj("FlowGraphCosBlock"),"math/tan":vj("FlowGraphTanBlock"),"math/asin":vj("FlowGraphASinBlock"),"math/acos":vj("FlowGraphACosBlock"),"math/atan":vj("FlowGraphATanBlock"),"math/atan2":vj("FlowGraphATan2Block",["a","b"]),"math/sinh":vj("FlowGraphSinhBlock"),"math/cosh":vj("FlowGraphCoshBlock"),"math/tanh":vj("FlowGraphTanhBlock"),"math/asinh":vj("FlowGraphASinhBlock"),"math/acosh":vj("FlowGraphACoshBlock"),"math/atanh":vj("FlowGraphATanhBlock"),"math/exp":vj("FlowGraphExponentialBlock"),"math/log":vj("FlowGraphLogBlock"),"math/log2":vj("FlowGraphLog2Block"),"math/log10":vj("FlowGraphLog10Block"),"math/sqrt":vj("FlowGraphSquareRootBlock"),"math/cbrt":vj("FlowGraphCubeRootBlock"),"math/pow":vj("FlowGraphPowerBlock",["a","b"]),"math/length":vj("FlowGraphLengthBlock"),"math/normalize":vj("FlowGraphNormalizeBlock"),"math/dot":vj("FlowGraphDotBlock",["a","b"]),"math/cross":vj("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":vj("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":vj("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Au:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Au:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Au:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Au:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Au:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Au:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Au:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":vj("FlowGraphTransposeBlock"),"math/determinant":vj("FlowGraphDeterminantBlock"),"math/inverse":vj("FlowGraphInvertMatrixBlock"),"math/matmul":vj("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Au:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Vf",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g,h){const L=g[0].dataInputs.find((q=>"rotationQuaternion"===q.name));if(!L)throw new Error("Rotation quaternion input not found");return h._connectionValues[L.uniqueId]&&(h._connectionValues[L.uniqueId].type="Quaternion"),g}},"math/matDecompose":{Au:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Vf"}}}},"math/quatConjugate":vj("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Au:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g){var h;return(h=g[0]).config||(h.config={}),g[0].config.type="Quaternion",g}},"math/quatAngleBetween":vj("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Au:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":vj("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":vj("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Au:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g){var h;return(h=g[0]).config||(h.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract2x2":{Au:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Au:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g){var h;return(h=g[0]).config||(h.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract3x3":{Au:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Au:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g){var h;return(h=g[0]).config||(h.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract4x4":{Au:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Au:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g,h){var L,Q;(Q=g[0]).config||(Q.config={});const H=g[0].dataInputs[0];return g[0].config.valueType=(null===(L=h._connectionValues[H.uniqueId])||void 0===L?void 0:L.type)??"FlowGraphInteger",g}},"math/and":{Au:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g,h){var L,Q,H;(H=g[0]).config||(H.config={});const r=g[0].dataInputs[0],u=g[0].dataInputs[1];return g[0].config.valueType=(null===(L=h._connectionValues[r.uniqueId])||void 0===L?void 0:L.type)??(null===(Q=h._connectionValues[u.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",g}},"math/or":{Au:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g,h){var L,Q,H;(H=g[0]).config||(H.config={});const r=g[0].dataInputs[0],u=g[0].dataInputs[1];return g[0].config.valueType=(null===(L=h._connectionValues[r.uniqueId])||void 0===L?void 0:L.type)??(null===(Q=h._connectionValues[u.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",g}},"math/xor":{Au:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,f,j,d,g,h){var L,Q,H;(H=g[0]).config||(H.config={});const r=g[0].dataInputs[0],u=g[0].dataInputs[1];return g[0].config.valueType=(null===(L=h._connectionValues[r.uniqueId])||void 0===L?void 0:L.type)??(null===(Q=h._connectionValues[u.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",g}},"math/asr":vj("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":vj("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":vj("FlowGraphLeadingZerosBlock"),"math/ctz":vj("FlowGraphTrailingZerosBlock"),"math/popcnt":vj("FlowGraphOneBitsCounterBlock"),"math/rad":vj("FlowGraphDegToRadBlock"),"math/deg":vj("FlowGraphRadToDegBlock"),"type/boolToInt":vj("FlowGraphBooleanToInt"),"type/boolToFloat":vj("FlowGraphBooleanToFloat"),"type/intToBool":vj("FlowGraphIntToBoolean"),"type/intToFloat":vj("FlowGraphIntToFloat"),"type/floatToInt":vj("FlowGraphFloatToInt"),"type/floatToBool":vj("FlowGraphFloatToBoolean"),"flow/sequence":{Au:["FlowGraphSequenceBlock"],extraProcessor(q,f,j,d,g){const h=g[0];return h.config||(h.config={}),h.config.outputSignalCount=Object.keys(q.flows||[]).length,h.signalOutputs.forEach(((q,f)=>{q.name="out_"+f})),g}},"flow/branch":{Au:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Au:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(q){if(q.configuration&&q.configuration.cases){const f=q.configuration.cases.value;if(!f.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return i.e.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const j=new Set(f);q.configuration.cases.value=Array.from(j)}return{valid:!0}},extraProcessor(q,f,j,d,g){if("flow/switch"!==f.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return g[0].signalOutputs.forEach((q=>{"default"!==q.name&&(q.name="out_"+q.name)})),g}},"flow/while":{Au:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Au:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(q,f,j,d,g){const h=g[0];return h.config||(h.config={}),h.config.incrementIndexWhenLoopDone=!0,g}},"flow/doN":{Au:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Au:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(q,f,j,d,g){if("flow/multiGate"!==f.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const h=g[0];return h.config||(h.config={}),h.config.outputSignalCount=Object.keys(q.flows).length,h.signalOutputs.forEach(((q,f)=>{q.name="out_"+f})),g}},"flow/waitAll":{Au:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(q){var f,j;return"number"!==typeof(null===(f=q.configuration)||void 0===f||null===(j=f.inputFlows)||void 0===j?void 0:j.value[0])&&(q.configuration=q.configuration||{inputFlows:{value:[0]}},q.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Au:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Au:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Au:["FlowGraphCancelDelayBlock"]},"variable/get":{Au:["FlowGraphGetVariableBlock"],validation(q){var f,j;return null!==(f=q.configuration)&&void 0!==f&&null!==(j=f.variable)&&void 0!==j&&j.value?{valid:!0}:(i.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,f)=>[f.getVariableName(q[0])]}}},"variable/set":{Au:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,f)=>[f.getVariableName(q[0])]}}},"variable/setMultiple":{Au:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(q,f)=>[q[0].map((q=>f.getVariableName(q)))]}},extraProcessor:(q,f,j,d,g)=>(g[0].dataInputs.forEach((q=>{q.name=d.getVariableName(+q.name)})),g)},"variable/interpolate":{Au:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(q,f)=>[f.getVariableName(q[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:q=>!0===q[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Tj:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Tj:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Tj:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Tj:"FlowGraphPlayAnimationBlock"},out:{name:"out",Tj:"FlowGraphPlayAnimationBlock"},done:{name:"done",Tj:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(q,f,j,d,g){var h,L,Q;const H=g[0],r=null===(h=q.configuration)||void 0===h?void 0:h.variable.value[0];if("number"!==typeof r)throw i.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const u=d.arrays.staticVariables[r];"undefined"===typeof H.config.animationType.value&&(d.arrays.staticVariables,H.config.animationType.value=(0,Ej.y)(u.type));const X=g[4];return X.config||(X.config={}),(L=X.config).variable||(L.variable={}),X.config.variable.value=d.getVariableName(r),(Q=g[3]).config||(Q.config={}),g}},"pointer/get":{Au:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Tj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Tj:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,f,j,d,g)=>(g.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),g)},"pointer/set":{Au:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Tj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Tj:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,f,j,d,g)=>(g.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),g)},"pointer/interpolate":{Au:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Tj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Tj:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Tj:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Tj:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Tj:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Tj:"FlowGraphPlayAnimationBlock"},out:{name:"out",Tj:"FlowGraphPlayAnimationBlock"},done:{name:"done",Tj:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,f,j,d,g)=>(g.forEach((f=>{"FlowGraphJsonPointerParserBlock"===f.className?(f.config||(f.config={}),f.config.outputValue=!0):"FlowGraphInterpolationBlock"===f.className&&(f.config||(f.config={}),Object.keys(q.values||[]).forEach((j=>{var g;const h=null===(g=q.values)||void 0===g?void 0:g[j];if("value"===j&&h){const q=h.type;void 0!==q&&(f.config.animationType=d.arrays.types[q].flowGraphType)}})))})),g)},"animation/start":{Au:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Tj:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(q,f)=>[q[0]*f._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(q,f)=>[q[0]*f._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,f,j,d,g,h,L){const Q=g[g.length-1];return Q.config||(Q.config={}),Q.config.glTF=L,g}},"animation/stop":{Au:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Tj:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,f,j,d,g,h,L){const Q=g[g.length-1];return Q.config||(Q.config={}),Q.config.glTF=L,g}},"animation/stopAt":{Au:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Tj:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(q,f)=>[q[0]*f._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,f,j,d,g,h,L){const Q=g[g.length-1];return Q.config||(Q.config={}),Q.config.glTF=L,g}},"math/switch":{Au:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(q){if(q.configuration&&q.configuration.cases){const f=q.configuration.cases.value;if(!f.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return i.e.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const j=new Set(f);q.configuration.cases.value=Array.from(j)}return{valid:!0}},extraProcessor(q,f,j,d,g){const h=g[0];return h.dataInputs.forEach((q=>{"default"!==q.name&&"case"!==q.name&&(q.name="in_"+q.name)})),h.config||(h.config={}),h.config.treatCasesAsIntegers=!0,g}},"debug/log":{Au:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function vj(q){let f=arguments.length>2?arguments[2]:void 0;return{Au:[q],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((q,f)=>(q[f]={name:f},q)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(q,j,d,g,h){var L;if(f){(L=h[0]).config||(L.config={}),h[0].config.preventIntegerFloatArithmetic=!0;let f=-1;Object.keys(q.values||{}).find((j=>{var d;return void 0!==(null===(d=q.values)||void 0===d?void 0:d[j].type)&&(f=q.values[j].type,!0)})),-1!==f&&(h[0].config.type=g.arrays.types[f].flowGraphType)}return h},validation:q=>f?Fj(q):{valid:!0}}}function Fj(q){if(q.values){const f=Object.keys(q.values).map((f=>q.values[f].type)).filter((q=>void 0!==q));if(!f.every((q=>q===f[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Yj["math/compose"]=Yj["math/matCompose"],Yj["math/decompose"]=Yj["math/matDecompose"];var Mj=j(11105);const oj={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"kf",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class bj{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=q,this._gltf=f,this._animationTargetFps=j,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const q of this._interactivityGraph.types)this._types.push(oj[q.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const q of this._interactivityGraph.declarations){const f=Wj(q);if(!f)throw i.e.Error(["No mapping found for declaration",q]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:f,fullOperationName:q.extension?q.op+":"+q.extension:q.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const q of this._interactivityGraph.variables){const f=this._parseVariable(q);this._staticVariables.push(f)}}_parseVariable(q,f){const j=this._types[q.type];if(!j)throw i.e.Error(["No type found for variable",q]),new Error("Error parsing variables");if(q.value&&q.value.length!==j.length)throw i.e.Error(["Invalid value length for variable",q,j]),new Error("Error parsing variables");const d=q.value||[];if(!d.length)switch(j.flowGraphType){case"boolean":d.push(!1);break;case"FlowGraphInteger":d.push(0);break;case"number":d.push(NaN);break;case"Vector2":d.push(NaN,NaN);break;case"kf":d.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":d.fill(NaN,0,4);break;case"Matrix":d.fill(NaN,0,16);break;case"Matrix3D":d.fill(NaN,0,9)}return"number"===j.elementType&&"string"===typeof d[0]&&(d[0]=parseFloat(d[0])),{type:j.flowGraphType,value:f?f(d,this):d}}_parseEvents(){if(this._interactivityGraph.events)for(const q of this._interactivityGraph.events){const f={eventId:q.id||"internalEvent_"+this._internalEventsCounter++};q.values&&(f.eventData=Object.keys(q.values).map((f=>{var j;const d=null===(j=q.values)||void 0===j?void 0:j[f];if(!d)throw i.e.Error(["No value found for event key",f]),new Error("Error parsing events");const g=this._types[d.type];if(!g)throw i.e.Error(["No type found for event value",d]),new Error("Error parsing events");const h="undefined"!==typeof d.value?this._parseVariable(d):void 0;return{id:f,type:g.flowGraphType,eventData:!0,value:h}}))),this._events.push(f)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const f of this._interactivityGraph.nodes){if("number"!==typeof f.declaration)throw i.e.Error(["No declaration found for node",f]),new Error("Error parsing nodes");const j=this._mappings[f.declaration];if(!j)throw i.e.Error(["No mapping found for node",f]),new Error("Error parsing nodes");if(j.flowGraphMapping.validation){const d=j.flowGraphMapping.validation(f,this._interactivityGraph,this._gltf);var q;if(!d.valid)throw new Error(`Error validating interactivity node ${null===(q=this._interactivityGraph.declarations)||void 0===q?void 0:q[f.declaration].op} - ${d.error}`)}const d=[];for(const q of j.flowGraphMapping.Au){const g=this._getEmptyBlock(q,j.fullOperationName);this._parseNodeConfiguration(f,g,j.flowGraphMapping,q),d.push(g)}this._nodes.push({Au:d,fullOperationName:j.fullOperationName})}}_getEmptyBlock(q,f){return{uniqueId:(0,Mj.d)(),className:q,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:f,metadata:{}}}_parseNodeConfiguration(q,f,j,d){const g=f.config;if(q.configuration){const f=Object.keys(q.configuration);for(const Q of f){var h,L;const f=null===(h=q.configuration)||void 0===h?void 0:h[Q];if(!f)throw i.e.Error(["No value found for node configuration",Q]),new Error("Error parsing node configuration");const H=null===(L=j.configuration)||void 0===L?void 0:L[Q];if(H&&H.Tj?H.Tj===d:0===j.Au.indexOf(d)){const q=(null===H||void 0===H?void 0:H.name)||Q;f&&"undefined"!==typeof f.value||"undefined"===typeof(null===H||void 0===H?void 0:H.defaultValue)?f.value.length>=0?g[q]={value:1===f.value.length?f.value[0]:f.value}:i.e.Warn(["Invalid value for node configuration",f]):g[q]={value:H.defaultValue},H&&H.dataTransformer&&(g[q].value=H.dataTransformer([g[q].value],this)[0])}}}}_parseNodeConnections(q){for(let S=0;S<this._nodes.length;S++){var f;const e=null===(f=this._interactivityGraph.nodes)||void 0===f?void 0:f[S];if(!e)throw i.e.Error(["No node found for interactivity node",this._nodes[S]]),new Error("Error parsing node connections");const Z=this._nodes[S],I=this._mappings[e.declaration];if(!I)throw i.e.Error(["No mapping found for node",e]),new Error("Error parsing node connections");const T=e.flows||{},W=Object.keys(T).sort();for(const q of W){var j,d,g,h;const f=T[q],r=null===(j=I.flowGraphMapping.outputs)||void 0===j||null===(d=j.flows)||void 0===d?void 0:d[q],u=(null===r||void 0===r?void 0:r.name)||q,X=this._createNewSocketConnection(u,!0);(r&&r.Tj&&Z.Au.find((q=>q.className===r.Tj))||Z.Au[0]).signalOutputs.push(X);const z=f.node,B=this._nodes[z];if(!B)throw i.e.Error(["No node found for input node id",z]),new Error("Error parsing node connections");const D=Tj(B.fullOperationName);if(!D)throw i.e.Error(["No mapping found for input node",B]),new Error("Error parsing node connections");let t=null===(g=D.inputs)||void 0===g||null===(h=g.flows)||void 0===h?void 0:h[f.socket||"in"],O=!1;if(!t)for(const q in null===(L=D.inputs)||void 0===L?void 0:L.flows){var L,Q,H;if(q.startsWith("[")&&q.endsWith("]"))O=!0,t=null===(Q=D.inputs)||void 0===Q||null===(H=Q.flows)||void 0===H?void 0:H[q]}const N=t?O?t.name.replace("$1",f.socket||""):t.name:f.socket||"in",w=t&&t.Tj&&B.Au.find((q=>q.className===t.Tj))||B.Au[0];let E=w.signalInputs.find((q=>q.name===N));E||(E=this._createNewSocketConnection(N),w.signalInputs.push(E)),E.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(E.uniqueId)}const n=e.values||{},U=Object.keys(n);for(const f of U){var r,u;const j=n[f];let d=null===(r=I.flowGraphMapping.inputs)||void 0===r||null===(u=r.values)||void 0===u?void 0:u[f],g=!1;if(!d)for(const q in null===(X=I.flowGraphMapping.inputs)||void 0===X?void 0:X.values){var X,z,B;if(q.startsWith("[")&&q.endsWith("]"))g=!0,d=null===(z=I.flowGraphMapping.inputs)||void 0===z||null===(B=z.values)||void 0===B?void 0:B[q]}const h=d?g?d.name.replace("$1",f):d.name:f,L=this._createNewSocketConnection(h);if((d&&d.Tj&&Z.Au.find((q=>q.className===d.Tj))||Z.Au[0]).dataInputs.push(L),void 0!==j.value){const f=this._parseVariable(j,d&&d.dataTransformer);q._connectionValues[L.uniqueId]=f}else{if("undefined"===typeof j.node)throw i.e.Error(["Invalid value for value connection",j]),new Error("Error parsing node connections");{var D,t,O;const q=j.node,f=j.socket||"value",d=this._nodes[q];if(!d)throw i.e.Error(["No node found for output socket reference",j]),new Error("Error parsing node connections");const g=Tj(d.fullOperationName);if(!g)throw i.e.Error(["No mapping found for output socket reference",j]),new Error("Error parsing node connections");let h=null===(D=g.outputs)||void 0===D||null===(t=D.values)||void 0===t?void 0:t[f],Q=!1;if(!h)for(const j in null===(N=g.outputs)||void 0===N?void 0:N.values){var N,w,E;if(j.startsWith("[")&&j.endsWith("]"))Q=!0,h=null===(w=g.outputs)||void 0===w||null===(E=w.values)||void 0===E?void 0:E[j]}const H=h?Q?h.name.replace("$1",f):null===(O=h)||void 0===O?void 0:O.name:f,r=h&&h.Tj&&d.Au.find((q=>q.className===h.Tj))||d.Au[0];let u=r.dataOutputs.find((q=>q.name===H));u||(u=this._createNewSocketConnection(H,!0),r.dataOutputs.push(u)),L.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(L.uniqueId)}}}if(I.flowGraphMapping.interBlockConnectors)for(const q of I.flowGraphMapping.interBlockConnectors){const f=q.input,j=q.output,d=q.isVariable;this._connectFlowGraphNodes(f,j,Z.Au[q.inputBlockIndex],Z.Au[q.outputBlockIndex],d)}if(I.flowGraphMapping.extraProcessor){var s;const f=null===(s=this._interactivityGraph.declarations)||void 0===s?void 0:s[e.declaration];if(!f)throw i.e.Error(["No declaration found for extra processor",e]),new Error("Error parsing node connections");Z.Au=I.flowGraphMapping.extraProcessor(e,f,I.flowGraphMapping,this,Z.Au,q,this._gltf)}}}_createNewSocketConnection(q,f){return{uniqueId:(0,Mj.d)(),name:q,_connectionType:f?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(q,f,j,d,g){const h=g?j.dataInputs:j.signalInputs,L=g?d.dataOutputs:d.signalOutputs,Q=h.find((f=>f.name===q))||this._createNewSocketConnection(q),H=L.find((q=>q.name===f))||this._createNewSocketConnection(f,!0);h.find((f=>f.name===q))||h.push(Q),L.find((q=>q.name===f))||L.push(H),Q.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(Q.uniqueId)}getVariableName(q){return"staticVariable_"+q}serializeToFlowGraph(){const q={uniqueId:(0,Mj.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(q);for(let f=0;f<this._staticVariables.length;f++){const j=this._staticVariables[f];q._userVariables[this.getVariableName(f)]=j}return{rightHanded:!0,allBlocks:this._nodes.reduce(((q,f)=>q.concat(f.Au)),[]),executionContexts:[q]}}}const xj="KHR_interactivity";class Rj{constructor(q){this._loader=q,this.name=xj,this.enabled=this._loader.isExtensionUsed(xj),this._pathConverter=(0,R.m)(this._loader.dd),q._skipStartAnimationStep=!0;const f=q.babylonScene;f&&function(q){(0,R.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!q.activeCamera)return new g.e(NaN,NaN,NaN,NaN);const f=g.e.FromRotationMatrix(q.activeCamera.getWorldMatrix()).normalize();return q.useRightHandedSystem||(f.w*=-1,f.x*=-1),f},type:"Quaternion",getTarget:()=>q.activeCamera}),(0,R.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!q.activeCamera)return new g.j(NaN,NaN,NaN);const f=q.activeCamera.getWorldMatrix().getTranslation();return q.useRightHandedSystem||(f.x*=-1),f},type:"kf",getTarget:()=>q.activeCamera}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:q=>{var f;return(null===(f=q._babylonAnimationGroup)||void 0===f?void 0:f.isPlaying)??!1},type:"boolean",getTarget:q=>q._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:q=>{var f;return((null===(f=q._babylonAnimationGroup)||void 0===f?void 0:f.from)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:q=>{var f;return((null===(f=q._babylonAnimationGroup)||void 0===f?void 0:f.to)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:q=>{var f;return((null===(f=q._babylonAnimationGroup)||void 0===f?void 0:f.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:q=>{var f;return((null===(f=q._babylonAnimationGroup)||void 0===f?void 0:f.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup})}(f)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var q;if(!this._loader.babylonScene||!this._pathConverter)return;const f=this._loader.babylonScene,j=null===(q=this._loader.dd.extensions)||void 0===q?void 0:q.KHR_interactivity;if(!j)return;const d=new ij.e({Sf:f});d.dispatchEventsSynchronously=!1;const g=j.graphs.map((q=>new bj(q,this._loader.dd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(g.map((async q=>await ej(q,{coordinator:d,pathConverter:this._pathConverter})))),d.start()}}var Aj;Aj=async()=>(await Promise.resolve().then(j.bind(j,12758))).FlowGraphGLTFDataProvider,tj[`${xj}/${"FlowGraphGLTFDataProvider"}`]=Aj,x(xj),b(xj,!0,(q=>new Rj(q)));const kj="KHR_node_visibility";(0,R.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:q=>{const f=q._babylonTransformNode;return!f||void 0===f.isVisible||f.isVisible},set:(q,f)=>{var j,d;null===(j=f._primitiveBabylonMeshes)||void 0===j||j.forEach((q=>{q.inheritVisibility=!0})),f._babylonTransformNode&&(f._babylonTransformNode.isVisible=q),null===(d=f._primitiveBabylonMeshes)||void 0===d||d.forEach((f=>{f.isVisible=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class yj{constructor(q){this.name=kj,this._loader=q,this.enabled=q.isExtensionUsed(kj)}async onReady(){var q;null===(q=this._loader.dd.nodes)||void 0===q||q.forEach((q=>{var f,j,d,g;(null===(f=q._primitiveBabylonMeshes)||void 0===f||f.forEach((q=>{q.inheritVisibility=!0})),null!==(j=q.extensions)&&void 0!==j&&j.KHR_node_visibility)&&(!1===(null===(d=q.extensions)||void 0===d?void 0:d.KHR_node_visibility.visible)&&(q._babylonTransformNode&&(q._babylonTransformNode.isVisible=!1),null===(g=q._primitiveBabylonMeshes)||void 0===g||g.forEach((q=>{q.isVisible=!1}))))}))}dispose(){this._loader=null}}x(kj),b(kj,!0,(q=>new yj(q)));const pj="KHR_node_selectability";nj("event/onSelect",pj,{Au:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Tj:"FlowGraphGetVariableBlock",dataTransformer:q=>["pickedMesh_"+q[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Tj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,f,j,d,g,h,L){var Q,H,r,u,X,z;const B=g[g.length-1];B.config=B.config||{},B.config.glTF=L;const D=null===(Q=q.configuration)||void 0===Q||null===(H=Q.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const i="pickedMesh_"+D;return g[1].config.variable=i,h._userVariables[i]={className:"Mesh",id:null===L||void 0===L||null===(r=L.nodes)||void 0===r||null===(u=r[D]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===L||void 0===L||null===(X=L.nodes)||void 0===X||null===(z=X[D]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},g}}),(0,R.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:q=>{const f=q._babylonTransformNode;return!f||void 0===f.Xr||f.Xr},set:(q,f)=>{var j;null===(j=f._primitiveBabylonMeshes)||void 0===j||j.forEach((f=>{f.Xr=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"Xr"],type:"boolean"});class lj{constructor(q){this.name=pj,this._loader=q,this.enabled=q.isExtensionUsed(pj)}async onReady(){var q;null===(q=this._loader.dd.nodes)||void 0===q||q.forEach((q=>{var f,j,d;null!==(f=q.extensions)&&void 0!==f&&f.KHR_node_selectability&&!1===(null===(j=q.extensions)||void 0===j?void 0:j.KHR_node_selectability.selectable)&&(null===(d=q._babylonTransformNode)||void 0===d||d.getChildMeshes().forEach((q=>{q.Xr=!1})))}))}dispose(){this._loader=null}}x(pj),b(pj,!0,(q=>new lj(q)));const Vj="KHR_node_hoverability",aj="targetMeshPointerOver_";nj("event/onHoverIn",Vj,{Au:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Tj:"FlowGraphGetVariableBlock",dataTransformer:q=>[aj+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Tj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,f,j,d,g,h,L){var Q,H,r,u,X,z;const B=g[g.length-1];B.config=B.config||{},B.config.glTF=L;const D=null===(Q=q.configuration)||void 0===Q||null===(H=Q.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const i=aj+D;return g[1].config.variable=i,h._userVariables[i]={className:"Mesh",id:null===L||void 0===L||null===(r=L.nodes)||void 0===r||null===(u=r[D]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===L||void 0===L||null===(X=L.nodes)||void 0===X||null===(z=X[D]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},g}});const Pj="targetMeshPointerOut_";nj("event/onHoverOut",Vj,{Au:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Tj:"FlowGraphGetVariableBlock",dataTransformer:q=>[Pj+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Tj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,f,j,d,g,h,L){var Q,H,r,u,X,z;const B=g[g.length-1];B.config=B.config||{},B.config.glTF=L;const D=null===(Q=q.configuration)||void 0===Q||null===(H=Q.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const i=Pj+D;return g[1].config.variable=i,h._userVariables[i]={className:"Mesh",id:null===L||void 0===L||null===(r=L.nodes)||void 0===r||null===(u=r[D]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===L||void 0===L||null===(X=L.nodes)||void 0===X||null===(z=X[D]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},g}}),(0,R.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:q=>{const f=q._babylonTransformNode;return!f||void 0===f.pointerOverDisableMeshTesting||f.pointerOverDisableMeshTesting},set:(q,f)=>{var j;null===(j=f._primitiveBabylonMeshes)||void 0===j||j.forEach((f=>{f.pointerOverDisableMeshTesting=!q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Cj{constructor(q){this.name=Vj,this._loader=q,this.enabled=q.isExtensionUsed(Vj)}async onReady(){var q;null===(q=this._loader.dd.nodes)||void 0===q||q.forEach((q=>{var f,j,d;null!==(f=q.extensions)&&void 0!==f&&f.KHR_node_hoverability&&!1===(null===(j=q.extensions)||void 0===j?void 0:j.KHR_node_hoverability.hoverable)&&(null===(d=q._babylonTransformNode)||void 0===d||d.getChildMeshes().forEach((q=>{q.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}x(Vj),b(Vj,!0,(q=>new Cj(q)));const cj="ExtrasAsMetadata";class Gj{_assignExtras(q,f){if(f.extras&&Object.keys(f.extras).length>0){const j=q.metadata=q.metadata||{};(j.dd=j.dd||{}).extras=f.extras}}constructor(q){this.name=cj,this.enabled=!0,this._loader=q}dispose(){this._loader=null}loadNodeAsync(q,f,j){return this._loader.loadNodeAsync(q,f,(q=>{this._assignExtras(q,f),j(q)}))}loadCameraAsync(q,f,j){return this._loader.loadCameraAsync(q,f,(q=>{this._assignExtras(q,f),j(q)}))}createMaterial(q,f,j){const d=this._loader.createMaterial(q,f,j);return this._assignExtras(d,f),d}}x(cj),b(cj,!1,(q=>new Gj(q)));j(12758)},12636:(q,f,j)=>{"use strict";j.d(f,{c:()=>v,d:()=>I,f:()=>Z,i:()=>T});var d=j(10982),g=j(10992),h=j(12317),L=j(11289),Q=j(11245),H=j(11249),r=j(11005),u=j(10980),X=j(11280),z=j(11632),B=j(11293),D=j(11202);class i{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ez=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.QB=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture=q}getNodes(){let q=[];q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes);for(const f of this.skeletons)q=q.concat(f.bones);return q}}class t extends i{}class O{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const q=this.rootNodes;for(const d of q)d.dispose();q.length=0;const f=this.skeletons;for(const d of f)d.dispose();f.length=0;const j=this.animationGroups;for(const d of j)d.dispose();j.length=0}}class N extends i{constructor(q){super(),this._wasAddedToScene=!1,(q=q||u.d.LastCreatedScene)&&(this.Sf=q,this.proceduralTextures=[],q.qd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=q.getEngine().onContextRestoredObservable.add((()=>{for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();for(const q of this.ez)q.rebuild();for(const q of this.textures)q._rebuild()})))}_topologicalSort(q){const f=new Map;for(const L of q)f.set(L.uniqueId,L);const j={dependsOn:new Map,dependedBy:new Map};for(const L of q){const q=L.uniqueId;j.dependsOn.set(q,new Set),j.dependedBy.set(q,new Set)}for(const L of q){const q=L.uniqueId,d=j.dependsOn.get(q);if(L instanceof X.d){const g=L.sourceMesh;f.has(g.uniqueId)&&(d.add(g.uniqueId),j.dependedBy.get(g.uniqueId).add(q))}const g=j.dependedBy.get(q);for(const h of L.getDescendants()){const d=h.uniqueId;if(f.has(d)){g.add(d);j.dependsOn.get(d).add(q)}}}const d=[],g=[];for(const L of q){const q=L.uniqueId;0===j.dependsOn.get(q).size&&(g.push(L),f.delete(q))}const h=g;for(;h.length>0;){const q=h.shift();d.push(q);const g=j.dependedBy.get(q.uniqueId);for(const d of Array.from(g.values())){const g=j.dependsOn.get(d);g.delete(q.uniqueId),0===g.size&&f.get(d)&&(h.push(f.get(d)),f.delete(d))}}return f.size>0&&(r.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),f.forEach((q=>{r.e.Error(q.name)}))),d}_addNodeAndDescendantsToList(q,f,j,d){if(j&&(!d||d(j))&&!f.has(j.uniqueId)){q.push(j),f.add(j.uniqueId);for(const g of j.getDescendants(!0))this._addNodeAndDescendantsToList(q,f,g,d)}}_isNodeInContainer(q){return q instanceof H.e&&-1!==this.meshes.indexOf(q)||(q instanceof Q.b&&-1!==this.transformNodes.indexOf(q)||(q instanceof z.e&&-1!==this.lights.indexOf(q)||q instanceof B.d&&-1!==this.cameras.indexOf(q)))}_isValidHierarchy(){for(const q of this.meshes)if(q.parent&&!this._isNodeInContainer(q.parent))return r.e.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.transformNodes)if(q.parent&&!this._isNodeInContainer(q.parent))return r.e.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.lights)if(q.parent&&!this._isNodeInContainer(q.parent))return r.e.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.cameras)if(q.parent&&!this._isNodeInContainer(q.parent))return r.e.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||g.h.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const d={},h={},Q=new O,H=[],r=[],u={doNotInstantiate:!0,...j},X=[],z=new Set;for(const g of this.transformNodes)null===g.parent&&this._addNodeAndDescendantsToList(X,z,g,u.predicate);for(const g of this.meshes)null===g.parent&&this._addNodeAndDescendantsToList(X,z,g,u.predicate);const B=this._topologicalSort(X),D=(j,g)=>{if(((f,j)=>{if(d[f.uniqueId]=j.uniqueId,h[j.uniqueId]=j,q&&(j.name=q(f.name)),j instanceof L.e){const q=j;if(q.morphTargetManager){const j=f.morphTargetManager;q.morphTargetManager=j.clone();for(let f=0;f<j.numTargets;f++){const g=j.getTarget(f),L=q.morphTargetManager.getTarget(f);d[g.uniqueId]=L.uniqueId,h[L.uniqueId]=L}}}})(j,g),j.parent){const q=d[j.parent.uniqueId],f=h[q];g.parent=f||j.parent}if(g.position&&j.position&&g.position.H(j.position),g.rotationQuaternion&&j.rotationQuaternion&&g.rotationQuaternion.H(j.rotationQuaternion),g.rotation&&j.rotation&&g.rotation.H(j.rotation),g.Vf&&j.Vf&&g.Vf.H(j.Vf),g.material){const L=g;if(L.material)if(f){const f=j.material;if(-1===r.indexOf(f)){let j=f.clone(q?q(f.name):"Clone of "+f.name);if(r.push(f),d[f.uniqueId]=j.uniqueId,h[j.uniqueId]=j,"MultiMaterial"===f.getClassName()){const g=f;for(const f of g.rd)f&&(j=f.clone(q?q(f.name):"Clone of "+f.name),r.push(f),d[f.uniqueId]=j.uniqueId,h[j.uniqueId]=j);g.rd=g.rd.map((q=>q&&h[d[q.uniqueId]]))}}"InstancedMesh"!==L.getClassName()&&(L.material=h[d[f.uniqueId]])}else"MultiMaterial"===L.material.getClassName()?-1===this.Sf.multiMaterials.indexOf(L.material)&&this.Sf.addMultiMaterial(L.material):-1===this.Sf.materials.indexOf(L.material)&&this.Sf.addMaterial(L.material)}null===g.parent&&Q.rootNodes.push(g)};for(const g of B)if("InstancedMesh"===g.getClassName()){const q=g,f=q.sourceMesh,j=d[f.uniqueId];D(q,("number"===typeof j?h[j]:f).createInstance(q.name))}else{let q=!0;"Ed"===g.getClassName()||"Node"===g.getClassName()||g.skeleton||!g.getTotalVertices||0===g.getTotalVertices()?q=!1:u.doNotInstantiate&&(q="function"===typeof u.doNotInstantiate?!u.doNotInstantiate(g):!u.doNotInstantiate);const f=q?g.createInstance(`instance of ${g.name}`):g.clone(`Clone of ${g.name}`,null,!0);if(!f)throw new Error(`Could not clone or instantiate node on Asset Container ${g.name}`);D(g,f)}for(const g of this.skeletons){if(u.predicate&&!u.predicate(g))continue;const f=g.clone(q?q(g.name):"Clone of "+g.name);for(const q of this.meshes)if(q.skeleton===g&&!q.isAnInstance){const j=h[d[q.uniqueId]];if(!j||j.isAnInstance)continue;if(j.skeleton=f,-1!==H.indexOf(f))continue;H.push(f);for(const q of f.bones)q._linkedTransformNode&&(q._linkedTransformNode=h[d[q._linkedTransformNode.uniqueId]])}Q.skeletons.push(f)}for(const g of this.animationGroups){if(u.predicate&&!u.predicate(g))continue;const f=g.clone(q?q(g.name):"Clone of "+g.name,(q=>h[d[q.uniqueId]]||q));Q.animationGroups.push(f)}return Q}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||g.h.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Sf.environmentTexture=this.environmentTexture);for(const q of this.Sf._serializableComponents)q.addFromContainer(this);this.Sf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const f=[];for(const j of this.cameras)q&&!q(j)||(this.Sf.addCamera(j),f.push(j));for(const j of this.lights)q&&!q(j)||(this.Sf.addLight(j),f.push(j));for(const j of this.meshes)q&&!q(j)||(this.Sf.Iu(j),f.push(j));for(const j of this.skeletons)q&&!q(j)||this.Sf.addSkeleton(j);for(const j of this.animations)q&&!q(j)||this.Sf.addAnimation(j);for(const j of this.animationGroups)q&&!q(j)||this.Sf.addAnimationGroup(j);for(const j of this.multiMaterials)q&&!q(j)||this.Sf.addMultiMaterial(j);for(const j of this.materials)q&&!q(j)||this.Sf.addMaterial(j);for(const j of this.morphTargetManagers)q&&!q(j)||this.Sf.addMorphTargetManager(j);for(const j of this.geometries)q&&!q(j)||this.Sf.addGeometry(j);for(const j of this.transformNodes)q&&!q(j)||(this.Sf.addTransformNode(j),f.push(j));for(const j of this.actionManagers)q&&!q(j)||this.Sf.addActionManager(j);for(const j of this.textures)q&&!q(j)||this.Sf.addTexture(j);for(const j of this.reflectionProbes)q&&!q(j)||this.Sf.addReflectionProbe(j);for(const j of f)j.parent&&-1===this.Sf.getNodes().indexOf(j.parent)&&(j.setParent?j.setParent(null):j.parent=null)}removeAllFromScene(){this._isValidHierarchy()||g.h.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Sf.environmentTexture&&(this.Sf.environmentTexture=null);for(const q of this.Sf._serializableComponents)q.removeFromContainer(this)}removeFromScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const f of this.cameras)q&&!q(f)||this.Sf.removeCamera(f);for(const f of this.lights)q&&!q(f)||this.Sf.removeLight(f);for(const f of this.meshes)q&&!q(f)||this.Sf.Zu(f,!0);for(const f of this.skeletons)q&&!q(f)||this.Sf.removeSkeleton(f);for(const f of this.animations)q&&!q(f)||this.Sf.removeAnimation(f);for(const f of this.animationGroups)q&&!q(f)||this.Sf.removeAnimationGroup(f);for(const f of this.multiMaterials)q&&!q(f)||this.Sf.removeMultiMaterial(f);for(const f of this.materials)q&&!q(f)||this.Sf.removeMaterial(f);for(const f of this.morphTargetManagers)q&&!q(f)||this.Sf.removeMorphTargetManager(f);for(const f of this.geometries)q&&!q(f)||this.Sf.removeGeometry(f);for(const f of this.transformNodes)q&&!q(f)||this.Sf.removeTransformNode(f);for(const f of this.actionManagers)q&&!q(f)||this.Sf.removeActionManager(f);for(const f of this.textures)q&&!q(f)||this.Sf.removeTexture(f);for(const f of this.reflectionProbes)q&&!q(f)||this.Sf.removeReflectionProbe(f)}dispose(){const q=this.cameras.slice(0);for(const B of q)B.dispose();this.cameras.length=0;const f=this.lights.slice(0);for(const B of f)B.dispose();this.lights.length=0;const j=this.meshes.slice(0);for(const B of j)B.dispose();this.meshes.length=0;const d=this.skeletons.slice(0);for(const B of d)B.dispose();this.skeletons.length=0;const g=this.animationGroups.slice(0);for(const B of g)B.dispose();this.animationGroups.length=0;const h=this.multiMaterials.slice(0);for(const B of h)B.dispose();this.multiMaterials.length=0;const L=this.materials.slice(0);for(const B of L)B.dispose();this.materials.length=0;const Q=this.geometries.slice(0);for(const B of Q)B.dispose();this.geometries.length=0;const H=this.transformNodes.slice(0);for(const B of H)B.dispose();this.transformNodes.length=0;const r=this.actionManagers.slice(0);for(const B of r)B.dispose();this.actionManagers.length=0;const u=this.textures.slice(0);for(const B of u)B.dispose();this.textures.length=0;const X=this.reflectionProbes.slice(0);for(const B of X)B.dispose();this.reflectionProbes.length=0;const z=this.morphTargetManagers.slice(0);for(const B of z)B.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const B of this.Sf._serializableComponents)B.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Sf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(q,f,j){if(q&&f)for(const d of q){let q=!0;if(j)for(const f of j)if(d===f){q=!1;break}q&&(f.push(d),d._parentContainer=this)}}moveAllFromScene(q){this._wasAddedToScene=!1,void 0===q&&(q=new t);for(const f in this)Object.prototype.hasOwnProperty.call(this,f)&&(this[f]=this[f]||("_environmentTexture"===f?null:[]),this._moveAssets(this.Sf[f],this[f],q[f]));this.environmentTexture=this.Sf.environmentTexture,this.removeAllFromScene()}createRootMesh(){const q=new L.e("assetContainerRootMesh",this.Sf);for(const f of this.meshes)f.parent||q.addChild(f);return this.meshes.unshift(q),q}mergeAnimationsTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.d.LastCreatedScene,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!q)return r.e.Error("No scene available to merge animations to"),[];const d=j||(f=>{let j=null;const d=f.animations.length?f.animations[0].targetProperty:"",g=f.name.split(".").join("").split("_primitive")[0];switch(d){case"position":case"rotationQuaternion":j=q.getTransformNodeByName(f.name)||q.getTransformNodeByName(g);break;case"influence":j=q.getMorphTargetByName(f.name)||q.getMorphTargetByName(g);break;default:j=q.getNodeByName(f.name)||q.getNodeByName(g)}return j}),g=this.getNodes();for(const Q of g){const q=d(Q);if(null!==q){for(const f of Q.animations){const j=q.animations.filter((q=>q.targetProperty===f.targetProperty));for(const f of j){const j=q.animations.indexOf(f,0);j>-1&&q.animations.splice(j,1)}}q.animations=q.animations.concat(Q.animations)}}const h=[],L=this.animationGroups.slice();for(const Q of L){h.push(Q.clone(Q.name,d));for(const q of Q.animatables)q.stop()}for(const Q of f){const f=d(Q.target);f&&(q.beginAnimation(f,Q.fromFrame,Q.toFrame,Q.loopAnimation,Q.speedRatio,Q.onAnimationEnd?Q.onAnimationEnd:void 0,void 0,!0,void 0,Q.onAnimationLoop?Q.onAnimationLoop:void 0),q.stopAnimation(Q.target))}return h}populateRootNodes(){this.rootNodes.length=0;for(const q of this.meshes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.transformNodes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.lights)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.cameras)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)}addAllAssetsToContainer(q){if(!q)return;const f=[],j=new Set;for(f.push(q);f.length>0;){const q=f.pop();if(q instanceof L.e?(q.wf&&-1===this.geometries.indexOf(q.wf)&&this.geometries.push(q.wf),this.meshes.push(q)):q instanceof X.d?this.meshes.push(q):q instanceof Q.b?this.transformNodes.push(q):q instanceof z.e?this.lights.push(q):q instanceof B.d&&this.cameras.push(q),q instanceof H.e){if(q.material&&-1===this.materials.indexOf(q.material)){this.materials.push(q.material);for(const f of q.material.getActiveTextures())-1===this.textures.indexOf(f)&&this.textures.push(f)}q.skeleton&&-1===this.skeletons.indexOf(q.skeleton)&&this.skeletons.push(q.skeleton),q.morphTargetManager&&-1===this.morphTargetManagers.indexOf(q.morphTargetManager)&&this.morphTargetManagers.push(q.morphTargetManager)}for(const d of q.getChildren())j.has(d)||f.push(d);j.add(q)}this.populateRootNodes()}_getByTags(q,f,j){if(void 0===f)return q;const d=[];for(const g in q){const h=q[g];D.c&&D.c.MatchesQuery(h,f)&&(!j||j(h))&&d.push(h)}return d}getMeshesByTags(q,f){return this._getByTags(this.meshes,q,f)}getCamerasByTags(q,f){return this._getByTags(this.cameras,q,f)}getLightsByTags(q,f){return this._getByTags(this.lights,q,f)}getMaterialsByTags(q,f){return this._getByTags(this.materials,q,f).concat(this._getByTags(this.multiMaterials,q,f))}getTransformNodesByTags(q,f){return this._getByTags(this.transformNodes,q,f)}}var w=j(11044);class E{constructor(q){this.byteOffset=0,this.buffer=q}async loadAsync(q){const f=await this.buffer.readAsync(this.byteOffset,q);this._dataView=new DataView(f.buffer,f.byteOffset,f.byteLength),this._dataByteOffset=0}readUint32(){const q=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,q}readUint8Array(q){const f=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,q);return this._dataByteOffset+=q,this.byteOffset+=q,f}readString(q){return(0,w.k)(this.readUint8Array(q))}skipBytes(q){this._dataByteOffset+=q,this.byteOffset+=q}}var s=j(12644);const S="Z2xURg",e={name:"dd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:q=>-1!==q.indexOf("asset")&&-1!==q.indexOf("version")||q.startsWith("data:base64,"+S)||q.startsWith("data:;base64,"+S)||q.startsWith("data:application/octet-stream;base64,"+S)||q.startsWith("data:model/gltf-binary;base64,"+S)};var Z,I,T,W=j(11030),n=j(11035);function U(q,f,j){try{return Promise.resolve(new Uint8Array(q,f,j))}catch(d){return Promise.reject(d)}}!function(q){q[q.AUTO=0]="AUTO",q[q.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Z||(Z={})),function(q){q[q.NONE=0]="NONE",q[q.FIRST=1]="FIRST",q[q.ALL=2]="ALL"}(I||(I={})),function(q){q[q.LOADING=0]="LOADING",q[q.READY=1]="READY",q[q.COMPLETE=2]="COMPLETE"}(T||(T={}));class Y{constructor(){this.coordinateSystemMode=Z.AUTO,this.animationStartMode=I.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=q=>Promise.resolve(q),this.extensionOptions={}}H(q){q&&(this.onParsed=q.onParsed,this.coordinateSystemMode=q.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=q.animationStartMode??this.animationStartMode,this.loadNodeAnimations=q.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=q.loadSkins??this.loadSkins,this.loadMorphTargets=q.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=q.compileMaterials??this.compileMaterials,this.useClipPlane=q.useClipPlane??this.useClipPlane,this.compileShadowGenerators=q.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=q.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=q.useRangeRequests??this.useRangeRequests,this.createInstances=q.createInstances??this.createInstances,this.alwaysComputeBoundingBox=q.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=q.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=q.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=q.skipMaterials??this.skipMaterials,this.useSRGBBuffers=q.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=q.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=q.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=q.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=q.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=q.customRootNode,this.onMeshLoaded=q.onMeshLoaded,this.onSkinLoaded=q.onSkinLoaded,this.onTextureLoaded=q.onTextureLoaded,this.onMaterialLoaded=q.onMaterialLoaded,this.onCameraLoaded=q.onCameraLoaded,this.extensionOptions=q.extensionOptions??this.extensionOptions)}}class v extends Y{constructor(q){super(),this.onParsedObservable=new d.d,this.onMeshLoadedObservable=new d.d,this.onSkinLoadedObservable=new d.d,this.onTextureLoadedObservable=new d.d,this.onMaterialLoadedObservable=new d.d,this.onCameraLoadedObservable=new d.d,this.onCompleteObservable=new d.d,this.onErrorObservable=new d.d,this.qd=new d.d,this.onExtensionLoadedObservable=new d.d,this.validate=!1,this.onValidatedObservable=new d.d,this._loader=null,this._state=null,this._requests=new Array,this.name=e.name,this.extensions=e.extensions,this.onLoaderStateChangedObservable=new d.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.H(q)}set onParsed(q){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),q&&(this._onParsedObserver=this.onParsedObservable.add(q))}set onMeshLoaded(q){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),q&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(q))}set onSkinLoaded(q){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),q&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((f=>q(f.node,f.skinnedNode))))}set onTextureLoaded(q){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),q&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(q))}set onMaterialLoaded(q){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),q&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(q))}set onCameraLoaded(q){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),q&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(q))}set onComplete(q){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(q)}set onError(q){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(q)}set onDispose(q){this._onDisposeObserver&&this.qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.qd.add(q)}set onExtensionLoaded(q){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(q)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(q){this._loggingEnabled!==q&&(this._loggingEnabled=q,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(q){this._capturePerformanceCounters!==q&&(this._capturePerformanceCounters=q,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(q){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(q)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const q of this._requests)q.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=q=>Promise.resolve(q),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.qd.notifyObservers(void 0),this.qd.clear()}loadFile(q,f,j,h,L,Q,H,u){if(ArrayBuffer.isView(f))return this._loadBinary(q,f,j,h,H,u),null;this._progressCallback=L;const X=f.name||g.h.GetFilename(f);if(Q){if(this.useRangeRequests){this.validate&&r.e.Warn("glTF validation is not supported when range requests are enabled");const j={abort:()=>{},onCompleteObservable:new d.d},g={readAsync:(j,d)=>new Promise(((g,h)=>{this._loadFile(q,f,(q=>{g(new Uint8Array(q))}),!0,(q=>{h(q)}),(q=>{q.setRequestHeader("Range",`bytes=${j}-${j+d-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(g)).then((q=>{j.onCompleteObservable.notifyObservers(j),h(q)}),H?q=>H(void 0,q):void 0),j}return this._loadFile(q,f,(f=>{this._validate(q,new Uint8Array(f,0,f.byteLength),j,X),this._unpackBinaryAsync(new E({readAsync:(q,j)=>U(f,q,j),byteLength:f.byteLength})).then((q=>{h(q)}),H?q=>H(void 0,q):void 0)}),!0,H)}return this._loadFile(q,f,(f=>{try{this._validate(q,f,j,X),h({json:this._parseJson(f)})}catch{H&&H()}}),!1,H)}_loadBinary(q,f,j,d,g,h){this._validate(q,new Uint8Array(f.buffer,f.byteOffset,f.byteLength),j,h),this._unpackBinaryAsync(new E({readAsync:(q,j)=>function(q,f,j){try{if(f<0||f>=q.byteLength)throw new RangeError("Offset is out of range.");if(f+j>q.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(q.buffer,q.byteOffset+f,j))}catch(d){return Promise.reject(d)}}(f,q,j),byteLength:f.byteLength})).then((q=>{d(q)}),g?q=>g(void 0,q):void 0)}importMeshAsync(q,f,j,d,g,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(j),this._loader.importMeshAsync(q,f,null,j,d,g,h))))}loadAsync(q,f,j,d,g){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(f),this._loader.loadAsync(q,f,j,d,g))))}loadAssetContainerAsync(q,f,j,d,g){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(f);const h=new N(q),L=[];this.onMaterialLoadedObservable.add((q=>{L.push(q)}));const Q=[];this.onTextureLoadedObservable.add((q=>{Q.push(q)}));const H=[];this.onCameraLoadedObservable.add((q=>{H.push(q)}));const r=[];return this.onMeshLoadedObservable.add((q=>{q.morphTargetManager&&r.push(q.morphTargetManager)})),this._loader.importMeshAsync(null,q,h,f,j,d,g).then((q=>(Array.prototype.push.apply(h.geometries,q.geometries),Array.prototype.push.apply(h.meshes,q.meshes),Array.prototype.push.apply(h.ez,q.ez),Array.prototype.push.apply(h.skeletons,q.skeletons),Array.prototype.push.apply(h.animationGroups,q.animationGroups),Array.prototype.push.apply(h.materials,L),Array.prototype.push.apply(h.textures,Q),Array.prototype.push.apply(h.lights,q.lights),Array.prototype.push.apply(h.transformNodes,q.transformNodes),Array.prototype.push.apply(h.cameras,H),Array.prototype.push.apply(h.morphTargetManagers,r),h)))}))}canDirectLoad(q){return e.canDirectLoad(q)}directLoad(q,f){if(f.startsWith("base64,"+S)||f.startsWith(";base64,"+S)||f.startsWith("application/octet-stream;base64,"+S)||f.startsWith("model/gltf-binary;base64,"+S)){const j=(0,W.c)(f);return this._validate(q,new Uint8Array(j,0,j.byteLength)),this._unpackBinaryAsync(new E({readAsync:(q,f)=>U(j,q,f),byteLength:j.byteLength}))}return this._validate(q,f),Promise.resolve({json:this._parseJson(f)})}createPlugin(q){return new v(q[e.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((q,f)=>{this.onCompleteObservable.addOnce((()=>{q()})),this.onErrorObservable.addOnce((q=>{f(q)}))}))}_setState(q){this._state!==q&&(this._state=q,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(T[this._state]))}_loadFile(q,f,j,d,g,h){const L=q._loadFile(f,j,(q=>{this._onProgress(q,L)}),!0,d,g,h);return L.onCompleteObservable.add((()=>{L._lengthComputable=!0,L._total=L._loaded})),this._requests.push(L),L}_onProgress(q,f){if(!this._progressCallback)return;f._lengthComputable=q.lengthComputable,f._loaded=q.loaded,f._total=q.total;let j=!0,d=0,g=0;for(const h of this._requests){if(void 0===h._lengthComputable||void 0===h._loaded||void 0===h._total)return;j=j&&h._lengthComputable,d+=h._loaded,g+=h._total}this._progressCallback({lengthComputable:j,loaded:d,total:j?g:0})}_validate(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.c.ValidateAsync(f,j,d,(f=>this.preprocessUrlAsync(j+f).then((f=>q._loadFileAsync(f,void 0,!0,!0).then((q=>new Uint8Array(q,0,q.byteLength))))))).then((q=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(q),this.onValidatedObservable.clear()}),(q=>{this._endPerformanceCounter("Validate JSON"),g.h.Warn(`Failed to validate: ${q.message}`),this.onValidatedObservable.clear()})))}_getLoader(q){const f=q.json.asset||{};this._log(`Asset version: ${f.version}`),f.minVersion&&this._log(`Asset minimum version: ${f.minVersion}`),f.generator&&this._log(`Asset generator: ${f.generator}`);const j=v._parseVersion(f.version);if(!j)throw new Error("Invalid version: "+f.version);if(void 0!==f.minVersion){const q=v._parseVersion(f.minVersion);if(!q)throw new Error("Invalid minimum version: "+f.minVersion);if(v._compareVersion(q,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+f.minVersion)}const d={1:v._CreateGLTF1Loader,2:v._CreateGLTF2Loader}[j.major];if(!d)throw new Error("Unsupported version: "+f.version);return d(this)}_parseJson(q){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${q.length}`);const f=JSON.parse(q);return this._endPerformanceCounter("Parse JSON"),f}_unpackBinaryAsync(q){return this._startPerformanceCounter("Unpack Binary"),q.loadAsync(20).then((()=>{const f=q.readUint32();if(1179937895!==f)throw new n.i("Unexpected magic: "+f,n.g.GLTFLoaderUnexpectedMagicError);const j=q.readUint32();this.loggingEnabled&&this._log(`Binary version: ${j}`);const d=q.readUint32();let g;switch(this.useRangeRequests||d===q.buffer.byteLength||r.e.Warn(`Length in header does not match actual data length: ${d} != ${q.buffer.byteLength}`),j){case 1:g=this._unpackBinaryV1Async(q,d);break;case 2:g=this._unpackBinaryV2Async(q,d);break;default:throw new Error("Unsupported version: "+j)}return this._endPerformanceCounter("Unpack Binary"),g}))}_unpackBinaryV1Async(q,f){const j=q.readUint32(),d=q.readUint32();if(0!==d)throw new Error(`Unexpected content format: ${d}`);const g=f-q.byteOffset,h={json:this._parseJson(q.readString(j)),bin:null};if(0!==g){const f=q.byteOffset;h.bin={readAsync:(j,d)=>q.buffer.readAsync(f+j,d),byteLength:g}}return Promise.resolve(h)}_unpackBinaryV2Async(q,f){const j=1313821514,d=5130562,g=q.readUint32();if(q.readUint32()!==j)throw new Error("First chunk format is not JSON");return q.byteOffset+g===f?q.loadAsync(g).then((()=>({json:this._parseJson(q.readString(g)),bin:null}))):q.loadAsync(g+8).then((()=>{const h={json:this._parseJson(q.readString(g)),bin:null},L=()=>{const g=q.readUint32();switch(q.readUint32()){case j:throw new Error("Unexpected JSON chunk");case d:{const f=q.byteOffset;h.bin={readAsync:(j,d)=>q.buffer.readAsync(f+j,d),byteLength:g},q.skipBytes(g);break}default:q.skipBytes(g)}return q.byteOffset!==f?q.loadAsync(8).then(L):Promise.resolve(h)};return L()}))}static _parseVersion(q){if("1.0"===q||"1.0.1"===q)return{major:1,minor:0};const f=(q+"").match(/^(\d+)\.(\d+)/);return f?{major:parseInt(f[1]),minor:parseInt(f[2])}:null}static _compareVersion(q,f){return q.major>f.major?1:q.major<f.major?-1:q.minor>f.minor?1:q.minor<f.minor?-1:0}_logOpen(q){this._log(q),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(q){const f=v._logSpaces.substring(0,2*this._logIndentLevel);r.e.Log(`${f}${q}`)}_logDisabled(q){}_startPerformanceCounterEnabled(q){g.h.StartPerformanceCounter(q)}_startPerformanceCounterDisabled(q){}_endPerformanceCounterEnabled(q){g.h.EndPerformanceCounter(q)}_endPerformanceCounterDisabled(q){}}v.IncrementalLoading=!0,v.HomogeneousCoordinates=!1,v._logSpaces="                                ",(0,h.e)(new v)},12644:(q,f,j)=>{"use strict";j.d(f,{c:()=>L});var d=j(10992);function g(q,f,j,d){const g={externalResourceFunction:d};return j&&(g.uri="file:"===f?j:f+j),ArrayBuffer.isView(q)?GLTFValidator.validateBytes(q,g):GLTFValidator.validateString(q,g)}function h(){const q=[];onmessage=f=>{const j=f.data;switch(j.id){case"init":importScripts(j.url);break;case"validate":g(j.data,j.rootUrl,j.fileName,(f=>new Promise(((j,d)=>{const g=q.length;q.push({resolve:j,reject:d}),postMessage({id:"getExternalResource",index:g,uri:f})})))).then((q=>{postMessage({id:"validate.resolve",value:q})}),(q=>{postMessage({id:"validate.reject",reason:q})}));break;case"getExternalResource.resolve":q[j.index].resolve(j.value);break;case"getExternalResource.reject":q[j.index].reject(j.reason)}}}class L{static ValidateAsync(q,f,j,L){return"function"===typeof Worker?new Promise(((Q,H)=>{const r=`${g}(${h})()`,u=URL.createObjectURL(new Blob([r],{type:"application/javascript"})),X=new Worker(u),z=q=>{X.removeEventListener("error",z),X.removeEventListener("message",B),H(q)},B=q=>{const f=q.data;switch(f.id){case"getExternalResource":L(f.uri).then((q=>{X.postMessage({id:"getExternalResource.resolve",index:f.index,value:q},[q.buffer])}),(q=>{X.postMessage({id:"getExternalResource.reject",index:f.index,reason:q})}));break;case"validate.resolve":X.removeEventListener("error",z),X.removeEventListener("message",B),Q(f.value),X.terminate();break;case"validate.reject":X.removeEventListener("error",z),X.removeEventListener("message",B),H(f.reason),X.terminate()}};if(X.addEventListener("error",z),X.addEventListener("message",B),X.postMessage({id:"init",url:d.h.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(q)){const d=q.slice();X.postMessage({id:"validate",data:d,rootUrl:f,fileName:j},[d.buffer])}else X.postMessage({id:"validate",data:q,rootUrl:f,fileName:j})})):(this._LoadScriptPromise||(this._LoadScriptPromise=d.h.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>g(q,f,j,L))))}}L.Configuration={url:`${d.h._DefaultCdnUrl}/gltf_validator.js`}},13159:(q,f,j)=>{"use strict";j.d(f,{b:()=>e});var d=j(11125),g=j(11130),h=j(11199),L=j(10941),Q=j(11549),H=j(11566),r=j(11151),u=j(11506),X=j(10965),z=j(11075);j(12417),j(12340),j(12356),j(12346),j(12358),j(12361),j(12363);const B="imageProcessingCompatibility",D="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";z.b.IncludesShadersStore[B]||(z.b.IncludesShadersStore[B]=D);const i="skyPixelShader",t="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";z.b.ShadersStore[i]||(z.b.ShadersStore[i]=t);j(12425),j(12371),j(12373),j(12378),j(12376);const O="skyVertexShader",N="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";z.b.ShadersStore[O]||(z.b.ShadersStore[O]=N);var w=j(11588),E=j(11236),s=j(11219);class S extends Q.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class e extends H.b{constructor(q,f){super(q,f),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new L.j(0,100,0),this.useSunPosition=!1,this.cameraOffset=L.j.Zero(),this.up=L.j.Up(),this.dithering=!1,this._cameraPosition=L.j.Zero(),this._skyOrientation=new L.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(q,f){const j=f._drawWrapper;if(this.isFrozen&&j.effect&&j._wasPreviouslyReady)return!0;f.materialDefines||(f.materialDefines=new S);const d=f.materialDefines,g=this.eq();if(this._isReadyForSubMesh(f))return!0;if((0,s.R)(q,g,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,d),(0,s.I)(q,d,!0,!1),d.IMAGEPROCESSINGPOSTPROCESS!==g.imageProcessingConfiguration.applyByPostProcess&&d.markAsMiscDirty(),d.DITHER!==this.dithering&&d.markAsMiscDirty(),d.isDirty){d.markAsProcessed(),g.resetCachedMaterial();const q=new w.d;d.FOG&&q.addFallback(1,"FOG"),d.IMAGEPROCESSINGPOSTPROCESS=g.imageProcessingConfiguration.applyByPostProcess,d.DITHER=this.dithering;const j=[r.i.PositionKind];d.VERTEXCOLOR&&j.push(r.i.ColorKind);const h="sky",L=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.c)(L);const Q=d.toString();f.setEffect(g.getEngine().createEffect(h,j,L,[],Q,q,this.onCompiled,this.onError),d,this._materialContext)}return!(!f.effect||!f.effect.isReady())&&(d._renderId=g.getRenderId(),j._wasPreviouslyReady=!0,!0)}bindForSubMesh(q,f,j){const d=this.eq(),g=j.materialDefines;if(!g)return;const h=j.effect;if(!h)return;this._activeEffect=h,this.bindOnlyWorldMatrix(q),this._activeEffect.setMatrix("viewProjection",d.getTransformMatrix()),this._mustRebind(d,h,j)&&((0,E.f)(h,this,d),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,s.i)(g,h,d)),d.fogEnabled&&f.applyFog&&d.fogMode!==u.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",d.getViewMatrix()),(0,s.d)(d,f,this._activeEffect);const Q=d.activeCamera;if(Q){const q=Q.getWorldMatrix();this._cameraPosition.x=q.m[12],this._cameraPosition.y=q.m[13],this._cameraPosition.z=q.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const q=Math.PI*(this.inclination-.5),f=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(f)*Math.cos(q),this.sunPosition.y=this.distance*Math.sin(-q),this.sunPosition.z=this.distance*Math.sin(f)*Math.cos(q),L.e.FromUnitVectorsToRef(L.j.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(f,this._activeEffect,j)}getAnimatables(){return[]}dispose(q){super.dispose(q)}clone(q){return h.d.Clone((()=>new e(q,this.eq())),this)}serialize(){const q=super.serialize();return q.customType="BABYLON.SkyMaterial",q}getClassName(){return"SkyMaterial"}static Parse(q,f,j){return h.d.Parse((()=>new e(q.name,f)),q,f,j)}}(0,d.b)([(0,g.O)()],e.prototype,"luminance",void 0),(0,d.b)([(0,g.O)()],e.prototype,"turbidity",void 0),(0,d.b)([(0,g.O)()],e.prototype,"rayleigh",void 0),(0,d.b)([(0,g.O)()],e.prototype,"mieCoefficient",void 0),(0,d.b)([(0,g.O)()],e.prototype,"mieDirectionalG",void 0),(0,d.b)([(0,g.O)()],e.prototype,"distance",void 0),(0,d.b)([(0,g.O)()],e.prototype,"inclination",void 0),(0,d.b)([(0,g.O)()],e.prototype,"azimuth",void 0),(0,d.b)([(0,g.M)()],e.prototype,"sunPosition",void 0),(0,d.b)([(0,g.O)()],e.prototype,"useSunPosition",void 0),(0,d.b)([(0,g.M)()],e.prototype,"cameraOffset",void 0),(0,d.b)([(0,g.M)()],e.prototype,"up",void 0),(0,d.b)([(0,g.O)()],e.prototype,"dithering",void 0),(0,X.f)("BABYLON.SkyMaterial",e)},11722:(q,f,j)=>{"use strict";function d(q,f){f.headers=q.headers||{},f.statusMessage=q.statusText,f.statusCode=q.status,f.data=q.response}function g(q,f,j){return new Promise((function(g,h){j=j||{};var L,Q,H,r=new XMLHttpRequest,u=j.body,X=j.headers||{};for(L in j.timeout&&(r.timeout=j.timeout),r.ontimeout=r.onerror=function(q){q.timeout="timeout"==q.type,h(q)},r.open(q,f.href||f),r.onload=function(){for(H=r.getAllResponseHeaders().trim().split(/[\r\n]+/),d(r,r);Q=H.shift();)Q=Q.split(": "),r.headers[Q.shift().toLowerCase()]=Q.join(": ");if((Q=r.headers["content-type"])&&~Q.indexOf("application/json"))try{r.data=JSON.parse(r.data,j.reviver)}catch(q){return d(r,q),h(q)}(r.status>=400?h:g)(r)},typeof FormData<"u"&&u instanceof FormData||u&&"object"==typeof u&&(X["content-type"]="application/json",u=JSON.stringify(u)),r.withCredentials=!!j.withCredentials,X)r.setRequestHeader(L,X[L]);r.send(u)}))}j.r(f),j.d(f,{del:()=>H,get:()=>h,patch:()=>Q,post:()=>L,put:()=>r,send:()=>g});var h=g.bind(g,"GET"),L=g.bind(g,"POST"),Q=g.bind(g,"PATCH"),H=g.bind(g,"DELETE"),r=g.bind(g,"PUT")},13278:(q,f,j)=>{"use strict";j.d(f,{b:()=>X});const d=.5*(Math.sqrt(3)-1),g=(3-Math.sqrt(3))/6,h=1/3,L=1/6,Q=(Math.sqrt(5)-1)/4,H=(5-Math.sqrt(5))/20,r=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),u=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const X=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const f="function"==typeof q?q:function(q){let f=0,j=0,d=0,g=1;const h=function(){let q=4022871197;return function(f){f=f.toString();for(let j=0;j<f.length;j++){q+=f.charCodeAt(j);let d=.02519603282416938*q;q=d>>>0,d-=q,d*=q,q=d>>>0,d-=q,q+=4294967296*d}return 2.3283064365386963e-10*(q>>>0)}}();f=h(" "),j=h(" "),d=h(" "),f-=h(q),f<0&&(f+=1);j-=h(q),j<0&&(j+=1);d-=h(q),d<0&&(d+=1);return function(){const q=2091639*f+2.3283064365386963e-10*g;return f=j,j=d,d=q-(g=0|q)}}(q);this.p=function(q){const f=new Uint8Array(256);for(let j=0;j<256;j++)f[j]=j;for(let j=0;j<255;j++){const d=j+~~(q()*(256-j)),g=f[j];f[j]=f[d],f[d]=g}return f}(f),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let j=0;j<512;j++)this.perm[j]=this.p[255&j],this.permMod12[j]=this.perm[j]%12}noise2D(q,f){const j=this.permMod12,h=this.perm;let L=0,Q=0,H=0;const u=(q+f)*d,X=Math.floor(q+u),z=Math.floor(f+u),B=(X+z)*g,D=q-(X-B),i=f-(z-B);let t,O;D>i?(t=1,O=0):(t=0,O=1);const N=D-t+g,w=i-O+g,E=D-1+2*g,s=i-1+2*g,S=255&X,e=255&z;let Z=.5-D*D-i*i;if(Z>=0){const q=3*j[S+h[e]];Z*=Z,L=Z*Z*(r[q]*D+r[q+1]*i)}let I=.5-N*N-w*w;if(I>=0){const q=3*j[S+t+h[e+O]];I*=I,Q=I*I*(r[q]*N+r[q+1]*w)}let T=.5-E*E-s*s;if(T>=0){const q=3*j[S+1+h[e+1]];T*=T,H=T*T*(r[q]*E+r[q+1]*s)}return 70*(L+Q+H)}noise3D(q,f,j){const d=this.permMod12,g=this.perm;let Q,H,u,X;const z=(q+f+j)*h,B=Math.floor(q+z),D=Math.floor(f+z),i=Math.floor(j+z),t=(B+D+i)*L,O=q-(B-t),N=f-(D-t),w=j-(i-t);let E,s,S,e,Z,I;O>=N?N>=w?(E=1,s=0,S=0,e=1,Z=1,I=0):O>=w?(E=1,s=0,S=0,e=1,Z=0,I=1):(E=0,s=0,S=1,e=1,Z=0,I=1):N<w?(E=0,s=0,S=1,e=0,Z=1,I=1):O<w?(E=0,s=1,S=0,e=0,Z=1,I=1):(E=0,s=1,S=0,e=1,Z=1,I=0);const T=O-E+L,W=N-s+L,n=w-S+L,U=O-e+2*L,Y=N-Z+2*L,v=w-I+2*L,F=O-1+.5,M=N-1+.5,o=w-1+.5,b=255&B,x=255&D,R=255&i;let A=.6-O*O-N*N-w*w;if(A<0)Q=0;else{const q=3*d[b+g[x+g[R]]];A*=A,Q=A*A*(r[q]*O+r[q+1]*N+r[q+2]*w)}let k=.6-T*T-W*W-n*n;if(k<0)H=0;else{const q=3*d[b+E+g[x+s+g[R+S]]];k*=k,H=k*k*(r[q]*T+r[q+1]*W+r[q+2]*n)}let y=.6-U*U-Y*Y-v*v;if(y<0)u=0;else{const q=3*d[b+e+g[x+Z+g[R+I]]];y*=y,u=y*y*(r[q]*U+r[q+1]*Y+r[q+2]*v)}let p=.6-F*F-M*M-o*o;if(p<0)X=0;else{const q=3*d[b+1+g[x+1+g[R+1]]];p*=p,X=p*p*(r[q]*F+r[q+1]*M+r[q+2]*o)}return 32*(Q+H+u+X)}noise4D(q,f,j,d){const g=this.perm;let h,L,r,X,z;const B=(q+f+j+d)*Q,D=Math.floor(q+B),i=Math.floor(f+B),t=Math.floor(j+B),O=Math.floor(d+B),N=(D+i+t+O)*H,w=q-(D-N),E=f-(i-N),s=j-(t-N),S=d-(O-N);let e=0,Z=0,I=0,T=0;w>E?e++:Z++,w>s?e++:I++,w>S?e++:T++,E>s?Z++:I++,E>S?Z++:T++,s>S?I++:T++;const W=e>=3?1:0,n=Z>=3?1:0,U=I>=3?1:0,Y=T>=3?1:0,v=e>=2?1:0,F=Z>=2?1:0,M=I>=2?1:0,o=T>=2?1:0,b=e>=1?1:0,x=Z>=1?1:0,R=I>=1?1:0,A=T>=1?1:0,k=w-W+H,y=E-n+H,p=s-U+H,l=S-Y+H,V=w-v+2*H,a=E-F+2*H,P=s-M+2*H,C=S-o+2*H,c=w-b+3*H,G=E-x+3*H,m=s-R+3*H,K=S-A+3*H,J=w-1+4*H,qq=E-1+4*H,fq=s-1+4*H,jq=S-1+4*H,dq=255&D,gq=255&i,hq=255&t,Lq=255&O;let Qq=.6-w*w-E*E-s*s-S*S;if(Qq<0)h=0;else{const q=g[dq+g[gq+g[hq+g[Lq]]]]%32*4;Qq*=Qq,h=Qq*Qq*(u[q]*w+u[q+1]*E+u[q+2]*s+u[q+3]*S)}let Hq=.6-k*k-y*y-p*p-l*l;if(Hq<0)L=0;else{const q=g[dq+W+g[gq+n+g[hq+U+g[Lq+Y]]]]%32*4;Hq*=Hq,L=Hq*Hq*(u[q]*k+u[q+1]*y+u[q+2]*p+u[q+3]*l)}let rq=.6-V*V-a*a-P*P-C*C;if(rq<0)r=0;else{const q=g[dq+v+g[gq+F+g[hq+M+g[Lq+o]]]]%32*4;rq*=rq,r=rq*rq*(u[q]*V+u[q+1]*a+u[q+2]*P+u[q+3]*C)}let uq=.6-c*c-G*G-m*m-K*K;if(uq<0)X=0;else{const q=g[dq+b+g[gq+x+g[hq+R+g[Lq+A]]]]%32*4;uq*=uq,X=uq*uq*(u[q]*c+u[q+1]*G+u[q+2]*m+u[q+3]*K)}let Xq=.6-J*J-qq*qq-fq*fq-jq*jq;if(Xq<0)z=0;else{const q=g[dq+1+g[gq+1+g[hq+1+g[Lq+1]]]]%32*4;Xq*=Xq,z=Xq*Xq*(u[q]*J+u[q+1]*qq+u[q+2]*fq+u[q+3]*jq)}return 27*(h+L+r+X+z)}}}}]);