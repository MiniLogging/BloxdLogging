/*! For license information please see 8sk687.11.a473b424.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{13046:(s,Z,o)=>{"use strict";var t=o(13050),j=o(13053),S=o(13061);o.g.__TYPEDARRAY_POOL||(o.g.__TYPEDARRAY_POOL={UINT8:j([32,0]),UINT16:j([32,0]),UINT32:j([32,0]),INT8:j([32,0]),INT16:j([32,0]),INT32:j([32,0]),FLOAT:j([32,0]),DOUBLE:j([32,0]),DATA:j([32,0]),UINT8C:j([32,0]),BUFFER:j([32,0])});var a="undefined"!==typeof Uint8ClampedArray,O=o.g.__TYPEDARRAY_POOL;O.UINT8C||(O.UINT8C=j([32,0])),O.BUFFER||(O.BUFFER=j([32,0]));var v=O.DATA,G=O.BUFFER;function B(s){if(s){var Z=s.length||s.byteLength,o=t.log2(Z);v[o].push(s)}}function Q(s){s=t.nextPow2(s);var Z=t.log2(s),o=v[Z];return o.length>0?o.pop():new ArrayBuffer(s)}function D(s){return new Uint8Array(Q(s),0,s)}function z(s){return new Uint16Array(Q(2*s),0,s)}function Y(s){return new Uint32Array(Q(4*s),0,s)}function b(s){return new Int8Array(Q(s),0,s)}function f(s){return new Int16Array(Q(2*s),0,s)}function A(s){return new Int32Array(Q(4*s),0,s)}function d(s){return new Float32Array(Q(4*s),0,s)}function U(s){return new Float64Array(Q(8*s),0,s)}function u(s){return a?new Uint8ClampedArray(Q(s),0,s):D(s)}function H(s){return new DataView(Q(s),0,s)}Z.free=function(s){if(S(s))G[t.log2(s.length)].push(s);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(s)&&(s=s.buffer),!s)return;var Z=s.length||s.byteLength,o=0|t.log2(Z);v[o].push(s)}},Z.freeUint8=Z.freeUint16=Z.freeUint32=Z.freeInt8=Z.freeInt16=Z.freeInt32=Z.freeFloat32=Z.freeFloat=Z.freeFloat64=Z.freeDouble=Z.freeUint8Clamped=Z.freeDataView=function(s){B(s.buffer)},Z.freeArrayBuffer=B,Z.freeBuffer=function(s){G[t.log2(s.length)].push(s)},Z.malloc=function(s,Z){if(void 0===Z||"arraybuffer"===Z)return Q(s);switch(Z){case"uint8":return D(s);case"uint16":return z(s);case"uint32":return Y(s);case"int8":return b(s);case"int16":return f(s);case"int32":return A(s);case"float":case"float32":return d(s);case"double":case"float64":return U(s);case"uint8_clamped":return u(s);case"buffer":throw"Buffer not supported";case"data":case"dataview":return H(s);default:return null}return null},Z.mallocArrayBuffer=Q,Z.mallocUint8=D,Z.mallocUint16=z,Z.mallocUint32=Y,Z.mallocInt8=b,Z.mallocInt16=f,Z.mallocInt32=A,Z.mallocFloat32=Z.mallocFloat=d,Z.mallocFloat64=Z.mallocDouble=U,Z.mallocUint8Clamped=u,Z.mallocDataView=H,Z.clearCache=function(){for(var s=0;s<32;++s)O.UINT8[s].length=0,O.UINT16[s].length=0,O.UINT32[s].length=0,O.INT8[s].length=0,O.INT16[s].length=0,O.INT32[s].length=0,O.FLOAT[s].length=0,O.DOUBLE[s].length=0,O.UINT8C[s].length=0,v[s].length=0,G[s].length=0}},13127:(s,Z,o)=>{s.exports=j;var t=o(11898);function j(s,Z){if(!(this instanceof j))return new j(s,Z);var o=t.create();t.add(o,s,Z),this.base=t.min(t.create(),s,o),this.VG=t.clone(Z),this.max=t.max(t.create(),s,o),this.mag=t.length(this.VG)}var S=j.prototype;S.width=function(){return this.VG[0]},S.height=function(){return this.VG[1]},S.depth=function(){return this.VG[2]},S.x0=function(){return this.base[0]},S.y0=function(){return this.base[1]},S.z0=function(){return this.base[2]},S.x1=function(){return this.max[0]},S.y1=function(){return this.max[1]},S.z1=function(){return this.max[2]},S.translate=function(s){return t.add(this.max,this.max,s),t.add(this.base,this.base,s),this},S.setPosition=function(s){return t.add(this.max,s,this.VG),t.i(this.base,s),this},S.expand=function(s){var Z=t.create(),o=t.create();return t.max(Z,s.max,this.max),t.min(o,s.base,this.base),t.Go(Z,Z,o),new j(o,Z)},S.intersects=function(s){return!(s.base[0]>this.max[0])&&(!(s.base[1]>this.max[1])&&(!(s.base[2]>this.max[2])&&(!(s.max[0]<this.base[0])&&(!(s.max[1]<this.base[1])&&!(s.max[2]<this.base[2])))))},S.touches=function(s){var Z=this.union(s);return null!==Z&&(0==Z.width()||0==Z.height()||0==Z.depth())},S.union=function(s){if(!this.intersects(s))return null;var Z=Math.max(s.base[0],this.base[0]),o=Math.max(s.base[1],this.base[1]),t=Math.max(s.base[2],this.base[2]);return new j([Z,o,t],[Math.min(s.max[0],this.max[0])-Z,Math.min(s.max[1],this.max[1])-o,Math.min(s.max[2],this.max[2])-t])}},13050:(s,Z)=>{"use strict";function o(s){var Z=32;return(s&=-s)&&Z--,65535&s&&(Z-=16),16711935&s&&(Z-=8),252645135&s&&(Z-=4),858993459&s&&(Z-=2),1431655765&s&&(Z-=1),Z}Z.INT_BITS=32,Z.INT_MAX=2147483647,Z.INT_MIN=-1<<31,Z.sign=function(s){return(s>0)-(s<0)},Z.abs=function(s){var Z=s>>31;return(s^Z)-Z},Z.min=function(s,Z){return Z^(s^Z)&-(s<Z)},Z.max=function(s,Z){return s^(s^Z)&-(s<Z)},Z.isPow2=function(s){return!(s&s-1)&&!!s},Z.log2=function(s){var Z,o;return Z=(s>65535)<<4,Z|=o=((s>>>=Z)>255)<<3,Z|=o=((s>>>=o)>15)<<2,(Z|=o=((s>>>=o)>3)<<1)|(s>>>=o)>>1},Z.log10=function(s){return s>=1e9?9:s>=1e8?8:s>=1e7?7:s>=1e6?6:s>=1e5?5:s>=1e4?4:s>=1e3?3:s>=100?2:s>=10?1:0},Z.popCount=function(s){return 16843009*((s=(858993459&(s-=s>>>1&1431655765))+(s>>>2&858993459))+(s>>>4)&252645135)>>>24},Z.countTrailingZeros=o,Z.nextPow2=function(s){return s+=0===s,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)+1},Z.prevPow2=function(s){return s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)-(s>>>1)},Z.parity=function(s){return s^=s>>>16,s^=s>>>8,s^=s>>>4,27030>>>(s&=15)&1};var t=new Array(256);!function(s){for(var Z=0;Z<256;++Z){var o=Z,t=Z,j=7;for(o>>>=1;o;o>>>=1)t<<=1,t|=1&o,--j;s[Z]=t<<j&255}}(t),Z.reverse=function(s){return t[255&s]<<24|t[s>>>8&255]<<16|t[s>>>16&255]<<8|t[s>>>24&255]},Z.interleave2=function(s,Z){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s&=65535)|s<<8))|s<<4))|s<<2))|s<<1))|(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))<<1},Z.deinterleave2=function(s,Z){return(s=65535&((s=16711935&((s=252645135&((s=858993459&((s=s>>>Z&1431655765)|s>>>1))|s>>>2))|s>>>4))|s>>>16))<<16>>16},Z.interleave3=function(s,Z,o){return s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2),(s|=(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},Z.deinterleave3=function(s,Z){return(s=1023&((s=4278190335&((s=251719695&((s=3272356035&((s=s>>>Z&1227133513)|s>>>2))|s>>>4))|s>>>8))|s>>>16))<<22>>22},Z.nextCombination=function(s){var Z=s|s-1;return Z+1|(~Z&-~Z)-1>>>o(s)+1}},13042:(s,Z,o)=>{"use strict";s.exports=function(s,Z,o){switch(arguments.length){case 1:return t=[],G(j=s,j,B,!0),t;case 2:return"function"===typeof Z?G(s,s,Z,!0):function(s,Z){return t=[],G(s,Z,B,!1),t}(s,Z);case 3:return G(s,Z,o,!1);default:throw new Error("box-intersect: Invalid arguments")}var j};var t,j=o(13046),S=o(13066),a=o(13080);function O(s,Z){for(var o=0;o<s;++o)if(!(Z[o]<=Z[o+s]))return!0;return!1}function v(s,Z,o,t){for(var j=0,S=0,a=0,v=s.length;a<v;++a){var G=s[a];if(!O(Z,G)){for(var B=0;B<2*Z;++B)o[j++]=G[B];t[S++]=a}}return S}function G(s,Z,o,t){var O=s.length,G=Z.length;if(!(O<=0||G<=0)){var B=s[0].length>>>1;if(!(B<=0)){var Q,D=j.mallocDouble(2*B*O),z=j.mallocInt32(O);if((O=v(s,B,D,z))>0){if(1===B&&t)S.init(O),Q=S.sweepComplete(B,o,0,O,D,z,0,O,D,z);else{var Y=j.mallocDouble(2*B*G),b=j.mallocInt32(G);(G=v(Z,B,Y,b))>0&&(S.init(O+G),Q=1===B?S.sweepBipartite(B,o,0,O,D,z,0,G,Y,b):a(B,o,t,O,D,z,G,Y,b),j.free(Y),j.free(b))}j.free(D),j.free(z)}return Q}}}function B(s,Z){t.push([s,Z])}},13084:(s,Z)=>{"use strict";var o="d",t="ax",j="fp",S="es",a="rs",O="re",v="rb",G="bs",B="be",Q="bb",D=[o,t,"vv",a,O,v,"ri",G,B,Q,"bi"];function z(s){var Z="bruteForce"+(s?"Full":"Partial"),t=[],a=D.slice();s||a.splice(3,0,j);var O=["function "+Z+"("+a.join()+"){"];function v(Z,j){var a=function(s,Z,t){var j="bruteForce"+(s?"Red":"Blue")+(Z?"Flip":"")+(t?"Full":""),a=["function ",j,"(",D.join(),"){","var ",S,"=2*",o,";"],O="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",v="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(t?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return s?a.push(O,"Q",":",v):a.push(v,"Q",":",O),t?a.push("if(y1<x0||x1<y0)continue;"):Z?a.push("if(y0<=x0||x1<y0)continue;"):a.push("if(y0<x0||x1<y0)continue;"),a.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),Z?a.push("yi,xi"):a.push("xi,yi"),a.push(");if(rv!==void 0)return rv;}}}"),{name:j,code:a.join("")}}(Z,j,s);t.push(a.code),O.push("return "+a.name+"("+D.join()+");")}O.push("if(re-rs>be-bs){"),s?(v(!0,!1),O.push("}else{"),v(!1,!1)):(O.push("if(fp){"),v(!0,!0),O.push("}else{"),v(!0,!1),O.push("}}else{if(fp){"),v(!1,!0),O.push("}else{"),v(!1,!1),O.push("}")),O.push("}}return "+Z);var G=t.join("")+O.join("");return new Function(G)()}Z.partial=z(!1),Z.full=z(!0)},13080:(s,Z,o)=>{"use strict";s.exports=function(s,Z,o,S,B,g,l,R,e){!function(s,Z){var o=8*j.log2(Z+1)*(s+1)|0,S=j.nextPow2(u*o);F.length<S&&(t.free(F),F=t.mallocInt32(S));var a=j.nextPow2(H*o);i.length<a&&(t.free(i),i=t.mallocDouble(a))}(s,S+l);var c,w=0,X=2*s;N(w++,0,0,S,0,l,o?16:0,-1/0,1/0),o||N(w++,0,0,l,0,S,1,-1/0,1/0);for(;w>0;){var W=(w-=1)*u,q=F[W],h=F[W+1],M=F[W+2],x=F[W+3],k=F[W+4],y=F[W+5],I=w*H,C=i[I],K=i[I+1],p=1&y,E=!!(16&y),P=B,r=g,T=R,m=e;if(p&&(P=R,r=e,T=B,m=g),!(2&y&&h>=(M=f(s,q,h,M,P,r,K)))&&!(4&y&&(h=A(s,q,h,M,P,r,C))>=M)){var n=M-h,J=k-x;if(E){if(s*n*(n+J)<z){if(void 0!==(c=v.scanComplete(s,q,Z,h,M,P,r,x,k,T,m)))return c;continue}}else{if(s*Math.min(n,J)<Q){if(void 0!==(c=a(s,q,Z,p,h,M,P,r,x,k,T,m)))return c;continue}if(s*n*J<D){if(void 0!==(c=v.scanBipartite(s,q,Z,p,h,M,P,r,x,k,T,m)))return c;continue}}var ss=Y(s,q,h,M,P,r,C,K);if(h<ss)if(s*(ss-h)<Q){if(void 0!==(c=O(s,q+1,Z,h,ss,P,r,x,k,T,m)))return c}else if(q===s-2){if(void 0!==(c=p?v.sweepBipartite(s,Z,x,k,T,m,h,ss,P,r):v.sweepBipartite(s,Z,h,ss,P,r,x,k,T,m)))return c}else N(w++,q+1,h,ss,x,k,p,-1/0,1/0),N(w++,q+1,x,k,h,ss,1^p,-1/0,1/0);if(ss<M){var Zs=G(s,q,x,k,T,m),os=T[X*Zs+q],ts=b(s,q,Zs,k,T,m,os);if(ts<k&&N(w++,q,ss,M,ts,k,(4|p)+(E?16:0),os,K),x<Zs&&N(w++,q,ss,M,x,Zs,(2|p)+(E?16:0),C,os),Zs+1===ts){if(void 0!==(c=E?V(s,q,Z,ss,M,P,r,Zs,T,m[Zs]):L(s,q,Z,p,ss,M,P,r,Zs,T,m[Zs])))return c}else if(Zs<ts){var js;if(E){if(ss<(js=d(s,q,ss,M,P,r,os))){var Ss=b(s,q,ss,js,P,r,os);if(q===s-2){if(ss<Ss&&void 0!==(c=v.sweepComplete(s,Z,ss,Ss,P,r,Zs,ts,T,m)))return c;if(Ss<js&&void 0!==(c=v.sweepBipartite(s,Z,Ss,js,P,r,Zs,ts,T,m)))return c}else ss<Ss&&N(w++,q+1,ss,Ss,Zs,ts,16,-1/0,1/0),Ss<js&&(N(w++,q+1,Ss,js,Zs,ts,0,-1/0,1/0),N(w++,q+1,Zs,ts,Ss,js,1,-1/0,1/0))}}else ss<(js=p?U(s,q,ss,M,P,r,os):d(s,q,ss,M,P,r,os))&&(q===s-2?c=p?v.sweepBipartite(s,Z,Zs,ts,T,m,ss,js,P,r):v.sweepBipartite(s,Z,ss,js,P,r,Zs,ts,T,m):(N(w++,q+1,ss,js,Zs,ts,p,-1/0,1/0),N(w++,q+1,Zs,ts,ss,js,1^p,-1/0,1/0)))}}}}};var t=o(13046),j=o(13050),S=o(13084),a=S.partial,O=S.full,v=o(13066),G=o(13090),B=o(13098),Q=128,D=1<<22,z=1<<22,Y=B("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),b=B("lo===p0",["p0"]),f=B("lo<p0",["p0"]),A=B("hi<=p0",["p0"]),d=B("lo<=p0&&p0<=hi",["p0"]),U=B("lo<p0&&p0<=hi",["p0"]),u=6,H=2,F=t.mallocInt32(1024),i=t.mallocDouble(1024);function N(s,Z,o,t,j,S,a,O,v){var G=u*s;F[G]=Z,F[G+1]=o,F[G+2]=t,F[G+3]=j,F[G+4]=S,F[G+5]=a;var B=H*s;i[B]=O,i[B+1]=v}function L(s,Z,o,t,j,S,a,O,v,G,B){var Q=2*s,D=v*Q,z=G[D+Z];s:for(var Y=j,b=j*Q;Y<S;++Y,b+=Q){var f=a[b+Z],A=a[b+Z+s];if(!(z<f||A<z)&&(!t||z!==f)){for(var d,U=O[Y],u=Z+1;u<s;++u){f=a[b+u],A=a[b+u+s];var H=G[D+u],F=G[D+u+s];if(A<H||F<f)continue s}if(void 0!==(d=t?o(B,U):o(U,B)))return d}}}function V(s,Z,o,t,j,S,a,O,v,G){var B=2*s,Q=O*B,D=v[Q+Z];s:for(var z=t,Y=t*B;z<j;++z,Y+=B){var b=a[z];if(b!==G){var f=S[Y+Z],A=S[Y+Z+s];if(!(D<f||A<D)){for(var d=Z+1;d<s;++d){f=S[Y+d],A=S[Y+d+s];var U=v[Q+d],u=v[Q+d+s];if(A<U||u<f)continue s}var H=o(b,G);if(void 0!==H)return H}}}}},13090:(s,Z,o)=>{"use strict";s.exports=function(s,Z,o,a,O,v){if(a<=o+1)return o;var G=o,B=a,Q=a+o>>>1,D=2*s,z=Q,Y=O[D*Q+Z];for(;G<B;){if(B-G<j){S(s,Z,G,B,O,v),Y=O[D*Q+Z];break}var b=B-G,f=Math.random()*b+G|0,A=O[D*f+Z],d=Math.random()*b+G|0,U=O[D*d+Z],u=Math.random()*b+G|0,H=O[D*u+Z];A<=U?H>=U?(z=d,Y=U):A>=H?(z=f,Y=A):(z=u,Y=H):U>=H?(z=d,Y=U):H>=A?(z=f,Y=A):(z=u,Y=H);for(var F=D*(B-1),i=D*z,N=0;N<D;++N,++F,++i){var L=O[F];O[F]=O[i],O[i]=L}var V=v[B-1];v[B-1]=v[z],v[z]=V;for(F=D*(B-1),i=D*(z=t(s,Z,G,B-1,O,v,Y)),N=0;N<D;++N,++F,++i){L=O[F];O[F]=O[i],O[i]=L}V=v[B-1];if(v[B-1]=v[z],v[z]=V,Q<z){for(B=z-1;G<B&&O[D*(B-1)+Z]===Y;)B-=1;B+=1}else{if(!(z<Q))break;for(G=z+1;G<B&&O[D*G+Z]===Y;)G+=1}}return t(s,Z,o,Q,O,v,O[D*Q+Z])};var t=o(13098)("lo<p0",["p0"]),j=8;function S(s,Z,o,t,j,S){for(var a=2*s,O=a*(o+1)+Z,v=o+1;v<t;++v,O+=a)for(var G=j[O],B=v,Q=a*(v-1);B>o&&j[Q+Z]>G;--B,Q-=a){for(var D=Q,z=Q+a,Y=0;Y<a;++Y,++D,++z){var b=j[D];j[D]=j[z],j[z]=b}var f=S[B];S[B]=S[B-1],S[B-1]=f}}},13098:s=>{"use strict";s.exports=function(s,o){var t="abcdef".split("").concat(o),j=[];s.indexOf("lo")>=0&&j.push("lo=e[k+n]");s.indexOf("hi")>=0&&j.push("hi=e[k+o]");return t.push(Z.replace("_",j.join()).replace("$",s)),Function.apply(void 0,t)};var Z="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13072:s=>{"use strict";s.exports=function(s,t){t<=4*Z?o(0,t-1,s):G(0,t-1,s)};var Z=32;function o(s,Z,o){for(var t=2*(s+1),j=s+1;j<=Z;++j){for(var S=o[t++],a=o[t++],O=j,v=t-2;O-- >s;){var G=o[v-2],B=o[v-1];if(G<S)break;if(G===S&&B<a)break;o[v]=G,o[v+1]=B,v-=2}o[v]=S,o[v+1]=a}}function t(s,Z,o){Z*=2;var t=o[s*=2],j=o[s+1];o[s]=o[Z],o[s+1]=o[Z+1],o[Z]=t,o[Z+1]=j}function j(s,Z,o){Z*=2,o[s*=2]=o[Z],o[s+1]=o[Z+1]}function S(s,Z,o,t){Z*=2,o*=2;var j=t[s*=2],S=t[s+1];t[s]=t[Z],t[s+1]=t[Z+1],t[Z]=t[o],t[Z+1]=t[o+1],t[o]=j,t[o+1]=S}function a(s,Z,o,t,j){Z*=2,j[s*=2]=j[Z],j[Z]=o,j[s+1]=j[Z+1],j[Z+1]=t}function O(s,Z,o){Z*=2;var t=o[s*=2],j=o[Z];return!(t<j)&&(t!==j||o[s+1]>o[Z+1])}function v(s,Z,o,t){var j=t[s*=2];return j<Z||j===Z&&t[s+1]<o}function G(s,B,Q){var D=(B-s+1)/6|0,z=s+D,Y=B-D,b=s+B>>1,f=b-D,A=b+D,d=z,U=f,u=b,H=A,F=Y,i=s+1,N=B-1,L=0;O(d,U,Q)&&(L=d,d=U,U=L),O(H,F,Q)&&(L=H,H=F,F=L),O(d,u,Q)&&(L=d,d=u,u=L),O(U,u,Q)&&(L=U,U=u,u=L),O(d,H,Q)&&(L=d,d=H,H=L),O(u,H,Q)&&(L=u,u=H,H=L),O(U,F,Q)&&(L=U,U=F,F=L),O(U,u,Q)&&(L=U,U=u,u=L),O(H,F,Q)&&(L=H,H=F,F=L);for(var V=Q[2*U],g=Q[2*U+1],l=Q[2*H],R=Q[2*H+1],e=2*d,c=2*u,w=2*F,X=2*z,W=2*b,q=2*Y,h=0;h<2;++h){var M=Q[e+h],x=Q[c+h],k=Q[w+h];Q[X+h]=M,Q[W+h]=x,Q[q+h]=k}j(f,s,Q),j(A,B,Q);for(var y=i;y<=N;++y)if(v(y,V,g,Q))y!==i&&t(y,i,Q),++i;else if(!v(y,l,R,Q))for(;;){if(v(N,l,R,Q)){v(N,V,g,Q)?(S(y,i,N,Q),++i,--N):(t(y,N,Q),--N);break}if(--N<y)break}a(s,i-1,V,g,Q),a(B,N+1,l,R,Q),i-2-s<=Z?o(s,i-2,Q):G(s,i-2,Q),B-(N+2)<=Z?o(N+2,B,Q):G(N+2,B,Q),N-i<=Z?o(i,N,Q):G(i,N,Q)}},13066:(s,Z,o)=>{"use strict";s.exports={init:function(s){var Z=j.nextPow2(s);v.length<Z&&(t.free(v),v=t.mallocInt32(Z));G.length<Z&&(t.free(G),G=t.mallocInt32(Z));B.length<Z&&(t.free(B),B=t.mallocInt32(Z));Q.length<Z&&(t.free(Q),Q=t.mallocInt32(Z));D.length<Z&&(t.free(D),D=t.mallocInt32(Z));z.length<Z&&(t.free(z),z=t.mallocInt32(Z));var o=8*Z;Y.length<o&&(t.free(Y),Y=t.mallocDouble(o))},sweepBipartite:function(s,Z,o,t,j,O,D,z,A,d){for(var U=0,u=2*s,H=s-1,F=u-1,i=o;i<t;++i){var N=O[i],L=u*i;Y[U++]=j[L+H],Y[U++]=-(N+1),Y[U++]=j[L+F],Y[U++]=N}for(i=D;i<z;++i){N=d[i]+a;var V=u*i;Y[U++]=A[V+H],Y[U++]=-N,Y[U++]=A[V+F],Y[U++]=N}var g=U>>>1;S(Y,g);var l=0,R=0;for(i=0;i<g;++i){var e=0|Y[2*i+1];if(e>=a)b(B,Q,R--,e=e-a|0);else if(e>=0)b(v,G,l--,e);else if(e<=-a){e=-e-a|0;for(var c=0;c<l;++c){if(void 0!==(w=Z(v[c],e)))return w}f(B,Q,R++,e)}else{e=-e-1|0;for(c=0;c<R;++c){var w;if(void 0!==(w=Z(e,B[c])))return w}f(v,G,l++,e)}}},sweepComplete:function(s,Z,o,t,j,a,O,A,d,U){for(var u=0,H=2*s,F=s-1,i=H-1,N=o;N<t;++N){var L=a[N]+1<<1,V=H*N;Y[u++]=j[V+F],Y[u++]=-L,Y[u++]=j[V+i],Y[u++]=L}for(N=O;N<A;++N){L=U[N]+1<<1;var g=H*N;Y[u++]=d[g+F],Y[u++]=1|-L,Y[u++]=d[g+i],Y[u++]=1|L}var l=u>>>1;S(Y,l);var R=0,e=0,c=0;for(N=0;N<l;++N){var w=0|Y[2*N+1],X=1&w;if(N<l-1&&w>>1===Y[2*N+3]>>1&&(X=2,N+=1),w<0){for(var W=-(w>>1)-1,q=0;q<c;++q){if(void 0!==(h=Z(D[q],W)))return h}if(0!==X)for(q=0;q<R;++q){if(void 0!==(h=Z(v[q],W)))return h}if(1!==X)for(q=0;q<e;++q){var h;if(void 0!==(h=Z(B[q],W)))return h}0===X?f(v,G,R++,W):1===X?f(B,Q,e++,W):2===X&&f(D,z,c++,W)}else{W=(w>>1)-1;0===X?b(v,G,R--,W):1===X?b(B,Q,e--,W):2===X&&b(D,z,c--,W)}}},scanBipartite:function(s,Z,o,t,j,O,B,Q,D,z,A,d){var U=0,u=2*s,H=Z,F=Z+s,i=1,N=1;t?N=a:i=a;for(var L=j;L<O;++L){var V=L+i,g=u*L;Y[U++]=B[g+H],Y[U++]=-V,Y[U++]=B[g+F],Y[U++]=V}for(L=D;L<z;++L){V=L+N;var l=u*L;Y[U++]=A[l+H],Y[U++]=-V}var R=U>>>1;S(Y,R);var e=0;for(L=0;L<R;++L){var c=0|Y[2*L+1];if(c<0){var w=!1;if((V=-c)>=a?(w=!t,V-=a):(w=!!t,V-=1),w)f(v,G,e++,V);else{var X=d[V],W=u*V,q=A[W+Z+1],h=A[W+Z+1+s];s:for(var M=0;M<e;++M){var x=v[M],k=u*x;if(!(h<B[k+Z+1]||B[k+Z+1+s]<q)){for(var y=Z+2;y<s;++y)if(A[W+y+s]<B[k+y]||B[k+y+s]<A[W+y])continue s;var I,C=Q[x];if(void 0!==(I=t?o(X,C):o(C,X)))return I}}}}else b(v,G,e--,c-i)}},scanComplete:function(s,Z,o,t,j,O,G,B,Q,D,z){for(var b=0,f=2*s,A=Z,d=Z+s,U=t;U<j;++U){var u=U+a,H=f*U;Y[b++]=O[H+A],Y[b++]=-u,Y[b++]=O[H+d],Y[b++]=u}for(U=B;U<Q;++U){u=U+1;var F=f*U;Y[b++]=D[F+A],Y[b++]=-u}var i=b>>>1;S(Y,i);var N=0;for(U=0;U<i;++U){var L=0|Y[2*U+1];if(L<0){if((u=-L)>=a)v[N++]=u-a;else{var V=z[u-=1],g=f*u,l=D[g+Z+1],R=D[g+Z+1+s];s:for(var e=0;e<N;++e){var c=v[e],w=G[c];if(w===V)break;var X=f*c;if(!(R<O[X+Z+1]||O[X+Z+1+s]<l)){for(var W=Z+2;W<s;++W)if(D[g+W+s]<O[X+W]||O[X+W+s]<D[g+W])continue s;var q=o(w,V);if(void 0!==q)return q}}}}else{for(u=L-a,e=N-1;e>=0;--e)if(v[e]===u){for(W=e+1;W<N;++W)v[W-1]=v[W];break}--N}}}};var t=o(13046),j=o(13050),S=o(13072),a=1<<28,O=1024,v=t.mallocInt32(O),G=t.mallocInt32(O),B=t.mallocInt32(O),Q=t.mallocInt32(O),D=t.mallocInt32(O),z=t.mallocInt32(O),Y=t.mallocDouble(8192);function b(s,Z,o,t){var j=Z[t],S=s[o-1];s[j]=S,Z[S]=j}function f(s,Z,o,t){s[o]=t,Z[t]=o}},13053:s=>{"use strict";function Z(s,o,t){var j=0|s[t];if(j<=0)return[];var S,a=new Array(j);if(t===s.length-1)for(S=0;S<j;++S)a[S]=o;else for(S=0;S<j;++S)a[S]=Z(s,o,t+1);return a}s.exports=function(s,o){switch("undefined"===typeof o&&(o=0),typeof s){case"number":if(s>0)return function(s,Z){var o,t;for(o=new Array(s),t=0;t<s;++t)o[t]=Z;return o}(0|s,o);break;case"object":if("number"===typeof s.length)return Z(s,o,0)}return[]}},13018:(s,Z,o)=>{s.exports=function(){var s=this;this.components={},this.comps=this.components;var Z=this.components,o=1,j={},S=[],a=[],O={timeout:!1,removals:[],multiComps:[]};function v(s,o){var t=Z[o],S=j[o],a=S.hash[s];a&&(S.remove(s),t.lt&&(t.multi?(a.forEach((Z=>{Z&&t.lt(s,Z)})),a.length=0):t.lt(s,a)),O.removals.push(S),G())}function G(){O.timeout||(O.timeout=!0,setTimeout(B,1))}function B(){O.timeout=!1,Q()}function Q(){O.multiComps.length&&function(s){for(var Z=0;Z<s.length;Z++){var{entID:o,data:t}=s[Z],j=t.hash[o];if(j){for(var S=0;S<j.length;S++)j[S]||(j.splice(S,1),S--);0===j.length&&(t.remove(o),O.removals.push(t))}}s.length=0}(O.multiComps),O.removals.length&&function(s){for(var Z=0;Z<s.length;Z++){s[Z].flush()}s.length=0}(O.removals)}this.IB=j,this._systems=S,this._renderSystems=a,this.eG=function(Z){var t=o++;return Array.isArray(Z)&&Z.forEach((Z=>s.Av(t,Z))),t},this.deleteEntity=function(Z){return Object.keys(j).forEach((s=>{j[s].hash[Z]&&v(Z,s)})),s},this.PG=function(s){if(!s)throw new Error("Missing component definition");var o=s.name;if(!o)throw new Error("Component definition must have a name property.");if("string"!==typeof o)throw new Error("Component name must be a string.");if(""===o)throw new Error("Component name must be a non-empty string.");if(j[o])throw new Error(`Component ${o} already exists.`);var O={};return O.name=o,O.multi=!!s.multi,O.order=isNaN(s.order)?99:s.order,O.stateConstructor=s.stateConstructor||null,O.state=s.state||{},O.HO=s.HO||null,O.lt=s.lt||null,O.system=s.system||null,O.RO=s.RO||null,Z[o]=O,j[o]=new t,j[o]._pendingMultiCleanup=!1,j[o]._multiCleanupIDs=O.multi?[]:null,O.system&&(S.push(o),S.sort(((s,o)=>Z[s].order-Z[o].order))),O.RO&&(a.push(o),a.sort(((s,o)=>Z[s].order-Z[o].order))),o},this.overwriteComponent=function(s,o){var t=Z[s];if(!t)throw new Error(`Unknown component: ${s}`);if(!o)throw new Error("Missing component definition");if(t.name!==o.name)throw new Error("Overwriting component must use the same name property.");var O={};O.name=s,O.multi=!!o.multi,O.order=isNaN(o.order)?99:o.order,O.state=o.state||{},O.HO=o.HO||null,O.lt=o.lt||null,O.system=o.system||null,O.RO=o.RO||null,Z[s]=O,j[s]._pendingMultiCleanup=!1,j[s]._multiCleanupIDs=O.multi?[]:null;var v=S.indexOf(s);O.system&&v<0&&S.push(s),!O.system&&v>=0&&S.splice(v,1),S.sort(((s,o)=>Z[s].order-Z[o].order));var G=a.indexOf(s);O.RO&&G<0&&a.push(s),!O.RO&&G>=0&&a.splice(G,1),a.sort(((s,o)=>Z[s].order-Z[o].order));var B=O.state;return this.zG(s).forEach((s=>{for(var Z in B)Z in s||(s[Z]=B[Z]);O.HO&&O.HO(s.gO,s)})),s},this.deleteComponent=function(o){var t=j[o];if(!t)throw new Error(`Unknown component: ${o}`);t.flush(),t.list.forEach((s=>{s&&v(s.gO||s[0].gO,o)}));var O=S.indexOf(o),G=a.indexOf(o);return O>-1&&S.splice(O,1),G>-1&&a.splice(G,1),j[o].dispose(),delete j[o],delete Z[o],s},this.Av=function(s,o,t){var S,a=Z[o],O=j[o];if(!O)throw new Error(`Unknown component: ${o}.`);if(O.hash[s]&&!a.multi)throw new Error(`Entity ${s} already has component: ${o}.`);if(a.stateConstructor){if(!(S=new a.stateConstructor).hasOwnProperty("gO"))throw new Error(`Component ${a.name} stateConstructor type does not have property __id`)}else S=Object.assign({},{gO:s},a.state,t);if(S.gO=s,a.multi){var v=O.hash[s];v||(v=[],O.add(s,v)),v.push(S)}else O.add(s,S);return a.HO&&a.HO(s,S),this},this.Vv=function(s,Z){var o=j[Z];if(!o)throw new Error(`Unknown component: ${Z}.`);return!!o.hash[s]},this.Hv=function(Z,o){if(!j[o])throw new Error(`Unknown component: ${o}.`);return v(Z,o),s},this.getState=function(s,Z){var o=j[Z];if(!o)throw new Error(`Unknown component: ${Z}.`);return o.hash[s]},this.zG=function(s){var Z=j[s];if(!Z)throw new Error(`Unknown component: ${s}.`);return Q(),Z.list},this.wD=function(s){if(!j[s])throw new Error(`Unknown component: ${s}.`);var Z=j[s].hash;return s=>Z[s]},this.qD=function(s){if(!j[s])throw new Error(`Unknown component: ${s}.`);var Z=j[s].hash;return s=>!!Z[s]},this.Ia=function(o){Q();for(var t=0;t<S.length;t++){var a=S[t],O=Z[a],v=j[a];O.system(o,v.list),Q()}return s},this.render=function(o){Q();for(var t=0;t<a.length;t++){var S=a[t],O=Z[S],v=j[S];O.RO(o,v.list),Q()}return s},this.removeMultiComponent=function(o,t,S){var a=Z[t],v=j[t];if(!v)throw new Error(`Unknown component: ${t}.`);if(!a.multi)throw new Error("removeMultiComponent called on non-multi component");return function(s,Z,o,t){var j=o.hash[s];if(j){var S=j[t];S&&(j[t]=null,Z.lt&&Z.lt(s,S),O.multiComps.push({entID:s,data:o}),G())}}(o,a,v,S),s}};var t=o(13023)},13023:s=>{function Z(s,Z){var o=s._map[Z];if(delete s.hash[Z],delete s._map[Z],o===s.list.length-1)s.list.pop();else{var t=s.list.pop();if(s.list[o]=t,null===t||null===t[0]){var j=s.list.length;for(var S in s._map)if(s._map[S]===j)return void(s._map[S]=o)}else{var a=t.gO||t[0].gO;s._map[a]=o}}}s.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(s,Z){if("number"===typeof this._map[s]){var o=this._map[s];this.hash[s]=Z,this.list[o]=Z}else this._map[s]=this.list.length,this.hash[s]=Z,this.list.push(Z)}remove(s){var Z=this._map[s];this.hash[s]=null,this.list[Z]=null,this._pendingRemovals.push(s)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var s=0;s<this._pendingRemovals.length;s++){var o=this._pendingRemovals[s];null===this.hash[o]&&Z(this,o)}this._pendingRemovals.length=0}}},12978:s=>{"use strict";var Z,o="object"===typeof Reflect?Reflect:null,t=function(s,Z,o){return Function.prototype.apply.call(s,Z,o)};Z=o&&"function"===typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:function(s){return Object.getOwnPropertyNames(s)};var j=Number.isNaN||function(s){return s!==s};function S(){S.init.call(this)}s.exports=S,s.exports.once=function(s,Z){return new Promise((function(o,t){function j(o){s.removeListener(Z,S),t(o)}function S(){"function"===typeof s.removeListener&&s.removeListener("error",j),o([].slice.call(arguments))}b(s,Z,S,{once:!0}),"error"!==Z&&function(s,Z,o){"function"===typeof s.on&&b(s,"error",Z,o)}(s,j,{once:!0})}))},S.EventEmitter=S,S.prototype._events=void 0,S.prototype._eventsCount=0,S.prototype._maxListeners=void 0;var a=10;function O(s){if("function"!==typeof s)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}function v(s){return void 0===s._maxListeners?S.defaultMaxListeners:s._maxListeners}function G(s,Z,o,t){var j,S,a,G;if(O(o),void 0===(S=s._events)?(S=s._events=Object.create(null),s._eventsCount=0):(void 0!==S.newListener&&(s.emit("newListener",Z,o.listener?o.listener:o),S=s._events),a=S[Z]),void 0===a)a=S[Z]=o,++s._eventsCount;else if("function"===typeof a?a=S[Z]=t?[o,a]:[a,o]:t?a.unshift(o):a.push(o),(j=v(s))>0&&a.length>j&&!a.warned){a.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(Z)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.k=s,B.type=Z,B.count=a.length,G=B,console&&console.warn&&console.warn(G)}return s}function B(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Q(s,Z,o){var t={fired:!1,wrapFn:void 0,target:s,type:Z,listener:o},j=B.bind(t);return j.listener=o,t.wrapFn=j,j}function D(s,Z,o){var t=s._events;if(void 0===t)return[];var j=t[Z];return void 0===j?[]:"function"===typeof j?o?[j.listener||j]:[j]:o?function(s){for(var Z=new Array(s.length),o=0;o<Z.length;++o)Z[o]=s[o].listener||s[o];return Z}(j):Y(j,j.length)}function z(s){var Z=this._events;if(void 0!==Z){var o=Z[s];if("function"===typeof o)return 1;if(void 0!==o)return o.length}return 0}function Y(s,Z){for(var o=new Array(Z),t=0;t<Z;++t)o[t]=s[t];return o}function b(s,Z,o,t){if("function"===typeof s.on)t.once?s.once(Z,o):s.on(Z,o);else{if("function"!==typeof s.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s);s.addEventListener(Z,(function j(S){t.once&&s.removeEventListener(Z,j),o(S)}))}}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(s){if("number"!==typeof s||s<0||j(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");a=s}}),S.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(s){if("number"!==typeof s||s<0||j(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this},S.prototype.getMaxListeners=function(){return v(this)},S.prototype.emit=function(s){for(var Z=[],o=1;o<arguments.length;o++)Z.push(arguments[o]);var j="error"===s,S=this._events;if(void 0!==S)j=j&&void 0===S.error;else if(!j)return!1;if(j){var a;if(Z.length>0&&(a=Z[0]),a instanceof Error)throw a;var O=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw O.context=a,O}var v=S[s];if(void 0===v)return!1;if("function"===typeof v)t(v,this,Z);else{var G=v.length,B=Y(v,G);for(o=0;o<G;++o)t(B[o],this,Z)}return!0},S.prototype.addListener=function(s,Z){return G(this,s,Z,!1)},S.prototype.on=S.prototype.addListener,S.prototype.prependListener=function(s,Z){return G(this,s,Z,!0)},S.prototype.once=function(s,Z){return O(Z),this.on(s,Q(this,s,Z)),this},S.prototype.prependOnceListener=function(s,Z){return O(Z),this.prependListener(s,Q(this,s,Z)),this},S.prototype.removeListener=function(s,Z){var o,t,j,S,a;if(O(Z),void 0===(t=this._events))return this;if(void 0===(o=t[s]))return this;if(o===Z||o.listener===Z)0===--this._eventsCount?this._events=Object.create(null):(delete t[s],t.removeListener&&this.emit("removeListener",s,o.listener||Z));else if("function"!==typeof o){for(j=-1,S=o.length-1;S>=0;S--)if(o[S]===Z||o[S].listener===Z){a=o[S].listener,j=S;break}if(j<0)return this;0===j?o.shift():function(s,Z){for(;Z+1<s.length;Z++)s[Z]=s[Z+1];s.pop()}(o,j),1===o.length&&(t[s]=o[0]),void 0!==t.removeListener&&this.emit("removeListener",s,a||Z)}return this},S.prototype.off=S.prototype.removeListener,S.prototype.removeAllListeners=function(s){var Z,o,t;if(void 0===(o=this._events))return this;if(void 0===o.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==o[s]&&(0===--this._eventsCount?this._events=Object.create(null):delete o[s]),this;if(0===arguments.length){var j,S=Object.keys(o);for(t=0;t<S.length;++t)"removeListener"!==(j=S[t])&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(Z=o[s]))this.removeListener(s,Z);else if(void 0!==Z)for(t=Z.length-1;t>=0;t--)this.removeListener(s,Z[t]);return this},S.prototype.listeners=function(s){return D(this,s,!0)},S.prototype.rawListeners=function(s){return D(this,s,!1)},S.listenerCount=function(s,Z){return"function"===typeof s.listenerCount?s.listenerCount(Z):z.call(s,Z)},S.prototype.listenerCount=z,S.prototype.eventNames=function(){return this._eventsCount>0?Z(this._events):[]}},13250:s=>{"use strict";s.exports=function(s,Z,o,t,j,S){var a=+Z[0],O=+Z[1],v=+Z[2],G=+o[0],B=+o[1],Q=+o[2],D=Math.sqrt(G*G+B*B+Q*Q);if(0===D)throw new Error("Can't raycast along a zero vector");return function(s,Z,o,t,j,S,a,O,v,G){for(var B=0,Q=Math.floor,D=0|Q(Z),z=0|Q(o),Y=0|Q(t),b=j>0?1:-1,f=S>0?1:-1,A=a>0?1:-1,d=Math.abs(1/j),U=Math.abs(1/S),u=Math.abs(1/a),H=d<1/0?d*(b>0?D+1-Z:Z-D):1/0,F=U<1/0?U*(f>0?z+1-o:o-z):1/0,i=u<1/0?u*(A>0?Y+1-t:t-Y):1/0,N=-1;B<=O;){var L=s(D,z,Y);if(L)return v&&(v[0]=Z+B*j,v[1]=o+B*S,v[2]=t+B*a),G&&(G[0]=G[1]=G[2]=0,0===N&&(G[0]=-b),1===N&&(G[1]=-f),2===N&&(G[2]=-A)),L;H<F?H<i?(D+=b,B=H,H+=d,N=0):(Y+=A,B=i,i+=u,N=2):F<i?(z+=f,B=F,F+=U,N=1):(Y+=A,B=i,i+=u,N=2)}return v&&(v[0]=Z+B*j,v[1]=o+B*S,v[2]=t+B*a),G&&(G[0]=G[1]=G[2]=0),0}(s,a,O,v,G/=D,B/=D,Q/=D,t="undefined"===typeof t?64:+t,j,S)}},13274:(s,Z,o)=>{"use strict";o.d(Z,{d:()=>S});var t=o(12978);function j(){this.wQ=!1,this.stopPropagation=!1,this.XQ=!1,this.disabled=!1}class S{constructor(s,Z){this.version="0.7.0";var o=Object.assign({},new j,Z||{});this.element=s||document,this.wQ=!!o.wQ,this.stopPropagation=!!o.stopPropagation,this.XQ=!!o.XQ,this.disabled=!!o.disabled,this.filterEvents=(s,Z)=>!0,this.down=new t.EventEmitter,this.up=new t.EventEmitter,this.state={},this.OG={dx:0,dy:0,iD:0,aG:0,ND:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?O(this):document.addEventListener("DOMContentLoaded",(s=>{O(this)}),{once:!0})}bind(s){for(var Z=arguments.length,o=new Array(Z>1?Z-1:0),t=1;t<Z;t++)o[t-1]=arguments[t];o.forEach((Z=>{var o=this._keyBindmap[Z]||[];o.includes(s)||(o.push(s),this._keyBindmap[Z]=o)})),this.state[s]=!!this.state[s],this.pressCount[s]=this.pressCount[s]||0,this.releaseCount[s]=this.releaseCount[s]||0}unbind(s){for(var Z in this._keyBindmap){var o=this._keyBindmap[Z],t=o.indexOf(s);t>-1&&o.splice(t,1)}}getBindings(){var s={};for(var Z in this._keyBindmap){this._keyBindmap[Z].forEach((o=>{s[o]=s[o]||[],s[o].push(Z)}))}return s}Ia(){a(this.OG),a(this.pressCount),a(this.releaseCount)}}function a(s){for(var Z in s)s[Z]=0}function O(s){window.addEventListener("keydown",Y.bind(null,s,!0),!1),window.addEventListener("keyup",Y.bind(null,s,!1),!1);var Z={passive:!0};s.element.addEventListener("touchstart",Q.bind(void 0,s),{passive:!1}),s.element.addEventListener("touchend",z.bind(void 0,s),Z),s.element.addEventListener("mousedown",b.bind(null,s,!0),Z),window.document.addEventListener("mouseup",b.bind(null,s,!1),Z),s.element.addEventListener("touchmove",f.bind(null,s),Z),s.element.addEventListener("mousemove",f.bind(null,s),Z),window.PointerEvent,s.element.addEventListener("wheel",A.bind(null,s),Z),s.element.addEventListener("contextmenu",d.bind(null,s),!1),window.addEventListener("blur",U.bind(null,s),!1)}var v=0,G=0,B=null;function Q(s,Z){Z.preventDefault(),D(Z)}function D(s){let Z=!1;for(let o=0;o<s.touches.length;++o)if(s.touches[o].identifier===B){Z=!0;break}if(!Z){const Z=s.changedTouches[0];v=Z.clientX,G=Z.clientY,B=Z.identifier}}function z(s,Z){for(var o=Z.changedTouches,t=0;t<o.length;++t)o[t].identifier===B&&(B=null)}function Y(s,Z,o){u(o.code,Z,s,o)}function b(s,Z,o){if("pointerId"in o)if(Z){if(null!==s._touches.currID)return;s._touches.currID=o.pointerId}else{if(s._touches.currID!==o.pointerId)return;s._touches.currID=null}return u("Mouse"+("button"in o?o.button+1:1),Z,s,o),!1}function f(s,Z){var o=Z.movementX||Z.mozMovementX||0,t=Z.movementY||Z.mozMovementY||0;if(Z.touches&&0===(o|t)){var j=function(s){D(s);for(let Z=0;Z<s.changedTouches.length;++Z)if(s.changedTouches[Z].identifier==B){const o=s.changedTouches[Z],t=[o.clientX-v,o.clientY-G];return v=o.clientX,G=o.clientY,t}return console.error(`Did not find touch id ${B}`),[0,0]}(Z);o=j[0],t=j[1]}s.OG.dx+=o,s.OG.dy+=t}function A(s,Z){var o=1;switch(Z.deltaMode){case 0:o=1;break;case 1:o=12;break;case 2:o=s.element.clientHeight||window.innerHeight}s.OG.iD+=(Z.deltaX||0)*o,s.OG.aG+=(Z.deltaY||0)*o,s.OG.ND+=(Z.deltaZ||0)*o}function d(s,Z){if(!s.XQ)return Z.preventDefault(),!1}function U(s){for(var Z in s._keyStates)s._keyStates[Z]&&(/^Mouse\d/.test(Z)||u(Z,!1,s,{code:Z,note:"arrfjfag1em",preventDefault:()=>{},stopPropagation:()=>{}}))}function u(s,Z,o,t){var j=o._keyBindmap[s];j&&(H(o._keyStates[s],Z)&&(o._keyStates[s]=Z,j.forEach((s=>{(!o.filterEvents||o.filterEvents(t,s))&&function(s,Z,o,t){var j=Z?o.pressCount:o.releaseCount;j[s]=(j[s]||0)+1;var S=o._bindPressCount[s]||0;(S+=Z?1:-1)<0&&(S=0);o._bindPressCount[s]=S;var a=o.state[s];if(H(a,S)){o.state[s]=S>0;var O=Z?o.down:o.up;o.disabled||O.emit(s,t)}}(s,Z,o,t)}))),"button"in t||(o.wQ&&!t.defaultPrevented&&t.preventDefault(),o.stopPropagation&&t.stopPropagation()))}function H(s,Z){return s?!Z:Z}},11959:s=>{s.exports=function(s,Z,o){return s[0]=Z[0]+o[0],s[1]=Z[1]+o[1],s[2]=Z[2]+o[2],s}},11924:(s,Z,o)=>{s.exports=function(s,Z){var o=t(s[0],s[1],s[2]),a=t(Z[0],Z[1],Z[2]);j(o,o),j(a,a);var O=S(o,a);return O>1?0:Math.acos(O)};var t=o(11926),j=o(11931),S=o(11934)},12005:s=>{s.exports=function(s,Z){return s[0]=Math.ceil(Z[0]),s[1]=Math.ceil(Z[1]),s[2]=Math.ceil(Z[2]),s}},11915:s=>{s.exports=function(s){var Z=new Float32Array(3);return Z[0]=s[0],Z[1]=s[1],Z[2]=s[2],Z}},11936:s=>{s.exports=function(s,Z){return s[0]=Z[0],s[1]=Z[1],s[2]=Z[2],s}},11911:s=>{s.exports=function(){var s=new Float32Array(3);return s[0]=0,s[1]=0,s[2]=0,s}},12078:s=>{s.exports=function(s,Z,o){var t=Z[0],j=Z[1],S=Z[2],a=o[0],O=o[1],v=o[2];return s[0]=j*v-S*O,s[1]=S*a-t*v,s[2]=t*O-j*a,s}},12029:(s,Z,o)=>{s.exports=o(12022)},12022:s=>{s.exports=function(s,Z){var o=Z[0]-s[0],t=Z[1]-s[1],j=Z[2]-s[2];return Math.sqrt(o*o+t*t+j*j)}},11992:(s,Z,o)=>{s.exports=o(11988)},11988:s=>{s.exports=function(s,Z,o){return s[0]=Z[0]/o[0],s[1]=Z[1]/o[1],s[2]=Z[2]/o[2],s}},11934:s=>{s.exports=function(s,Z){return s[0]*Z[0]+s[1]*Z[1]+s[2]*Z[2]}},11904:s=>{s.exports=1e-6},11946:(s,Z,o)=>{s.exports=function(s,Z){var o=s[0],j=s[1],S=s[2],a=Z[0],O=Z[1],v=Z[2];return Math.abs(o-a)<=t*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(j-O)<=t*Math.max(1,Math.abs(j),Math.abs(O))&&Math.abs(S-v)<=t*Math.max(1,Math.abs(S),Math.abs(v))};var t=o(11904)},11953:s=>{s.exports=function(s,Z){return s[0]===Z[0]&&s[1]===Z[1]&&s[2]===Z[2]}},12002:s=>{s.exports=function(s,Z){return s[0]=Math.floor(Z[0]),s[1]=Math.floor(Z[1]),s[2]=Math.floor(Z[2]),s}},12123:(s,Z,o)=>{s.exports=function(s,Z,o,j,S,a){var O,v;Z||(Z=3);o||(o=0);v=j?Math.min(j*Z+o,s.length):s.length;for(O=o;O<v;O+=Z)t[0]=s[O],t[1]=s[O+1],t[2]=s[O+2],S(t,t,a),s[O]=t[0],s[O+1]=t[1],s[O+2]=t[2];return s};var t=o(11911)()},11926:s=>{s.exports=function(s,Z,o){var t=new Float32Array(3);return t[0]=s,t[1]=Z,t[2]=o,t}},11898:(s,Z,o)=>{s.exports={EPSILON:o(11904),create:o(11911),clone:o(11915),angle:o(11924),Xa:o(11926),i:o(11936),set:o(11938),equals:o(11946),exactEquals:o(11953),add:o(11959),Go:o(11966),sub:o(11972),multiply:o(11976),mul:o(11981),divide:o(11988),div:o(11992),min:o(11995),max:o(11998),floor:o(12002),ceil:o(12005),round:o(12007),scale:o(12012),Wa:o(12019),distance:o(12022),j:o(12029),squaredDistance:o(12031),sqrDist:o(12034),length:o(12042),len:o(12047),squaredLength:o(12055),qa:o(12060),negate:o(12066),inverse:o(12073),normalize:o(11931),dot:o(11934),cross:o(12078),Ra:o(12081),random:o(12083),transformMat4:o(12091),transformMat3:o(12097),transformQuat:o(12103),ha:o(12108),Ma:o(12112),xa:o(12116),forEach:o(12123)}},12073:s=>{s.exports=function(s,Z){return s[0]=1/Z[0],s[1]=1/Z[1],s[2]=1/Z[2],s}},12047:(s,Z,o)=>{s.exports=o(12042)},12042:s=>{s.exports=function(s){var Z=s[0],o=s[1],t=s[2];return Math.sqrt(Z*Z+o*o+t*t)}},12081:s=>{s.exports=function(s,Z,o,t){var j=Z[0],S=Z[1],a=Z[2];return s[0]=j+t*(o[0]-j),s[1]=S+t*(o[1]-S),s[2]=a+t*(o[2]-a),s}},11998:s=>{s.exports=function(s,Z,o){return s[0]=Math.max(Z[0],o[0]),s[1]=Math.max(Z[1],o[1]),s[2]=Math.max(Z[2],o[2]),s}},11995:s=>{s.exports=function(s,Z,o){return s[0]=Math.min(Z[0],o[0]),s[1]=Math.min(Z[1],o[1]),s[2]=Math.min(Z[2],o[2]),s}},11981:(s,Z,o)=>{s.exports=o(11976)},11976:s=>{s.exports=function(s,Z,o){return s[0]=Z[0]*o[0],s[1]=Z[1]*o[1],s[2]=Z[2]*o[2],s}},12066:s=>{s.exports=function(s,Z){return s[0]=-Z[0],s[1]=-Z[1],s[2]=-Z[2],s}},11931:s=>{s.exports=function(s,Z){var o=Z[0],t=Z[1],j=Z[2],S=o*o+t*t+j*j;S>0&&(S=1/Math.sqrt(S),s[0]=Z[0]*S,s[1]=Z[1]*S,s[2]=Z[2]*S);return s}},12083:s=>{s.exports=function(s,Z){Z=Z||1;var o=2*Math.random()*Math.PI,t=2*Math.random()-1,j=Math.sqrt(1-t*t)*Z;return s[0]=Math.cos(o)*j,s[1]=Math.sin(o)*j,s[2]=t*Z,s}},12108:s=>{s.exports=function(s,Z,o,t){var j=o[1],S=o[2],a=Z[1]-j,O=Z[2]-S,v=Math.sin(t),G=Math.cos(t);return s[0]=Z[0],s[1]=j+a*G-O*v,s[2]=S+a*v+O*G,s}},12112:s=>{s.exports=function(s,Z,o,t){var j=o[0],S=o[2],a=Z[0]-j,O=Z[2]-S,v=Math.sin(t),G=Math.cos(t);return s[0]=j+O*v+a*G,s[1]=Z[1],s[2]=S+O*G-a*v,s}},12116:s=>{s.exports=function(s,Z,o,t){var j=o[0],S=o[1],a=Z[0]-j,O=Z[1]-S,v=Math.sin(t),G=Math.cos(t);return s[0]=j+a*G-O*v,s[1]=S+a*v+O*G,s[2]=Z[2],s}},12007:s=>{s.exports=function(s,Z){return s[0]=Math.round(Z[0]),s[1]=Math.round(Z[1]),s[2]=Math.round(Z[2]),s}},12012:s=>{s.exports=function(s,Z,o){return s[0]=Z[0]*o,s[1]=Z[1]*o,s[2]=Z[2]*o,s}},12019:s=>{s.exports=function(s,Z,o,t){return s[0]=Z[0]+o[0]*t,s[1]=Z[1]+o[1]*t,s[2]=Z[2]+o[2]*t,s}},11938:s=>{s.exports=function(s,Z,o,t){return s[0]=Z,s[1]=o,s[2]=t,s}},12034:(s,Z,o)=>{s.exports=o(12031)},12060:(s,Z,o)=>{s.exports=o(12055)},12031:s=>{s.exports=function(s,Z){var o=Z[0]-s[0],t=Z[1]-s[1],j=Z[2]-s[2];return o*o+t*t+j*j}},12055:s=>{s.exports=function(s){var Z=s[0],o=s[1],t=s[2];return Z*Z+o*o+t*t}},11972:(s,Z,o)=>{s.exports=o(11966)},11966:s=>{s.exports=function(s,Z,o){return s[0]=Z[0]-o[0],s[1]=Z[1]-o[1],s[2]=Z[2]-o[2],s}},12097:s=>{s.exports=function(s,Z,o){var t=Z[0],j=Z[1],S=Z[2];return s[0]=t*o[0]+j*o[3]+S*o[6],s[1]=t*o[1]+j*o[4]+S*o[7],s[2]=t*o[2]+j*o[5]+S*o[8],s}},12091:s=>{s.exports=function(s,Z,o){var t=Z[0],j=Z[1],S=Z[2],a=o[3]*t+o[7]*j+o[11]*S+o[15];return a=a||1,s[0]=(o[0]*t+o[4]*j+o[8]*S+o[12])/a,s[1]=(o[1]*t+o[5]*j+o[9]*S+o[13])/a,s[2]=(o[2]*t+o[6]*j+o[10]*S+o[14])/a,s}},12103:s=>{s.exports=function(s,Z,o){var t=Z[0],j=Z[1],S=Z[2],a=o[0],O=o[1],v=o[2],G=o[3],B=G*t+O*S-v*j,Q=G*j+v*t-a*S,D=G*S+a*j-O*t,z=-a*t-O*j-v*S;return s[0]=B*G+z*-a+Q*-v-D*-O,s[1]=Q*G+z*-O+D*-a-B*-v,s[2]=D*G+z*-v+B*-O-Q*-a,s}},13001:s=>{"use strict";s.exports=function(s){for(var Z=new Array(s),o=0;o<s;++o)Z[o]=o;return Z}},13061:s=>{s.exports=function(s){return null!=s&&null!=s.constructor&&"function"===typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}},13255:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>t});class t{constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.YB=!1,this.bB=!1,this.DB=30,this.zB=0,this.iB=!1,this.fullscreen=!1,this.AB=function(s){},this.dB=function(){},this.HB=function(){},this.Ca=function(){},this.UB=function(s){},this.onFullscreenChanged=function(s){},G((()=>{!function(s,Z){s._nowObject=performance||Date,s._lastTick=0,s._renderAccum=0,s._rt=0,s._frameCB=O.bind(null,s),requestAnimationFrame(s._frameCB),Z>0&&(s._intervalCB=a.bind(null,s),s._interval=setInterval(s._intervalCB,Math.max(Z,1e3/s.DB/2)))}(this,Z),function(s,Z){if(!Z)return;var o=!1,t=!1;document.addEventListener("pointerlockchange",(t=>{o=document.pointerLockElement===Z,s.UB(o)})),document.addEventListener("fullscreenchange",(o=>{t=document.fullscreenElement===Z,s.onFullscreenChanged(t)})),Object.defineProperty(s,"iB",{get:()=>o,set:s=>{s&&!o?v(Z):o&&!s&&function(s){s.exitPointerLock&&s.exitPointerLock()}(document)}}),Object.defineProperty(s,"fullscreen",{get:()=>t,set:s=>{s&&!t?Z.requestFullscreen():t&&!s&&document.exitFullscreen()}}),Z.addEventListener("click",(j=>{s.YB&&!o&&v(Z),s.bB&&!t&&Z.requestFullscreen()}));var j=()=>s.Ca();if(window.ResizeObserver){new ResizeObserver(j).observe(Z)}else window.addEventListener("resize",j)}(this,s),this.HB()}))}}var j=3,S=20;function a(s){for(var Z=1e3/s.DB,o=s._nowObject.now()+S,t=0;s._nowObject.now()>=s._lastTick+Z&&s._nowObject.now()<o&&++t<=j;)s.AB(Z),s._lastTick+=Z;var a=5*(Z+5),O=s._nowObject.now();if(O-s._lastTick>a)for(;O>=s._lastTick+Z;)s._lastTick+=Z}function O(s){requestAnimationFrame(s._frameCB),a(s);var Z=s._nowObject.now(),o=Z-s._rt;if(s._rt=Z,s.zB>0){s._renderAccum+=o;var t=1e3/s.zB;if(s._renderAccum<t)return;s._renderAccum=Math.min(s._renderAccum-t,t)}var j=1e3/s.DB,S=(Z-s._lastTick)/j;s.dB(o,S,j)}function v(s){s.requestPointerLock&&s.requestPointerLock()}var G=s=>{if("loading"===document.readyState){var Z=()=>{document.removeEventListener("readystatechange",Z),s()};document.addEventListener("readystatechange",Z)}else setTimeout(s,1)}},12997:(s,Z,o)=>{var t=o(13001),j=o(13005),S="undefined"!==typeof Float64Array;function a(s,Z){return s[0]-Z[0]}function O(){var s,Z=this.stride,o=new Array(Z.length);for(s=0;s<o.length;++s)o[s]=[Math.abs(Z[s]),s];o.sort(a);var t=new Array(o.length);for(s=0;s<t.length;++s)t[s]=o[s][1];return t}function v(s,Z){var o=["View",Z,"d",s].join("");Z<0&&(o="View_Nil"+s);var j="generic"===s;if(-1===Z){var S="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+s+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(S)()}if(0===Z){S="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+s+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(j?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(j?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",S)(G[s][0])}S=["'use strict'"];var a=t(Z),v=a.map((function(s){return"i"+s})),B="this.offset+"+a.map((function(s){return"this.stride["+s+"]*i"+s})).join("+"),Q=a.map((function(s){return"b"+s})).join(","),D=a.map((function(s){return"c"+s})).join(",");S.push("function "+o+"(a,"+Q+","+D+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+s+"'","proto.dimension="+Z),S.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+a.map((function(s){return"this.shape["+s+"]"})).join("*"),"}})"),1===Z?S.push("proto.order=[0]"):(S.push("Object.defineProperty(proto,'order',{get:"),Z<4?(S.push("function "+o+"_order(){"),2===Z?S.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Z&&S.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):S.push("ORDER})")),S.push("proto.set=function "+o+"_set("+v.join(",")+",v){"),j?S.push("return this.data.set("+B+",v)}"):S.push("return this.data["+B+"]=v}"),S.push("proto.get=function "+o+"_get("+v.join(",")+"){"),j?S.push("return this.data.get("+B+")}"):S.push("return this.data["+B+"]}"),S.push("proto.index=function "+o+"_index(",v.join(),"){return "+B+"}"),S.push("proto.hi=function "+o+"_hi("+v.join(",")+"){return new "+o+"(this.data,"+a.map((function(s){return["(typeof i",s,"!=='number'||i",s,"<0)?this.shape[",s,"]:i",s,"|0"].join("")})).join(",")+","+a.map((function(s){return"this.stride["+s+"]"})).join(",")+",this.offset)}");var z=a.map((function(s){return"a"+s+"=this.shape["+s+"]"})),Y=a.map((function(s){return"c"+s+"=this.stride["+s+"]"}));S.push("proto.lo=function "+o+"_lo("+v.join(",")+"){var b=this.offset,d=0,"+z.join(",")+","+Y.join(","));for(var b=0;b<Z;++b)S.push("if(typeof i"+b+"==='number'&&i"+b+">=0){d=i"+b+"|0;b+=c"+b+"*d;a"+b+"-=d}");S.push("return new "+o+"(this.data,"+a.map((function(s){return"a"+s})).join(",")+","+a.map((function(s){return"c"+s})).join(",")+",b)}"),S.push("proto.step=function "+o+"_step("+v.join(",")+"){var "+a.map((function(s){return"a"+s+"=this.shape["+s+"]"})).join(",")+","+a.map((function(s){return"b"+s+"=this.stride["+s+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(b=0;b<Z;++b)S.push("if(typeof i"+b+"==='number'){d=i"+b+"|0;if(d<0){c+=b"+b+"*(a"+b+"-1);a"+b+"=ceil(-a"+b+"/d)}else{a"+b+"=ceil(a"+b+"/d)}b"+b+"*=d}");S.push("return new "+o+"(this.data,"+a.map((function(s){return"a"+s})).join(",")+","+a.map((function(s){return"b"+s})).join(",")+",c)}");var f=new Array(Z),A=new Array(Z);for(b=0;b<Z;++b)f[b]="a[i"+b+"]",A[b]="b[i"+b+"]";S.push("proto.transpose=function "+o+"_transpose("+v+"){"+v.map((function(s,Z){return s+"=("+s+"===undefined?"+Z+":"+s+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+f.join(",")+","+A.join(",")+",this.offset)}"),S.push("proto.pick=function "+o+"_pick("+v+"){var a=[],b=[],c=this.offset");for(b=0;b<Z;++b)S.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");return S.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),S.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+a.map((function(s){return"shape["+s+"]"})).join(",")+","+a.map((function(s){return"stride["+s+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",S.join("\n"))(G[s],O)}var G={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};s.exports=function(s,Z,o,t){if(void 0===s)return(0,G.array[0])([]);"number"===typeof s&&(s=[s]),void 0===Z&&(Z=[s.length]);var a=Z.length;if(void 0===o){o=new Array(a);for(var O=a-1,B=1;O>=0;--O)o[O]=B,B*=Z[O]}if(void 0===t){t=0;for(O=0;O<a;++O)o[O]<0&&(t-=(Z[O]-1)*o[O])}for(var Q=function(s){if(j(s))return"buffer";if(S)switch(Object.prototype.toString.call(s)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(s)?"array":"generic"}(s),D=G[Q];D.length<=a+1;)D.push(v(Q,D.length-1));return(0,D[a+1])(s,Z,o,t)}},13005:s=>{function Z(s){return!!s.constructor&&"function"===typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}s.exports=function(s){return null!=s&&(Z(s)||function(s){return"function"===typeof s.readFloatLE&&"function"===typeof s.slice&&Z(s.slice(0,0))}(s)||!!s._isBuffer)}},13135:s=>{"use strict";var Z=[],o=[],t=[],j=[],S=[],a=[],O=[],v=[],G=[],B=[],Q=[],D=[];s.exports=function(s,z,Y,b,f,A){for(var d=O,U=G,u=B,H=D,F=0;F<3;F++)d[F]=+Y[F],u[F]=+z.max[F],U[F]=+z.base[F];A||(A=1e-10);var i=function(s,O,G,B,D,z){var Y=Z,b=o,f=t,A=j,d=S,U=a,u=v,H=Math.floor,F=0,i=0,N=0,L=0,V=0;if(g(),0===N)return 0;for(L=e();i<=N;){if(l(L)&&R())return F;L=e()}for(F+=N,V=0;V<3;V++)B[V]+=G[V],D[V]+=G[V];return F;function g(){if(i=0,0!==(N=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2])))for(var s=0;s<3;s++){var Z=G[s]>=0;A[s]=Z?1:-1;var o=Z?D[s]:B[s];Y[s]=Z?B[s]:D[s],b[s]=c(o,A[s]),f[s]=w(Y[s],A[s]),u[s]=G[s]/N,d[s]=Math.abs(1/u[s]);var t=Z?b[s]+1-o:o-b[s];U[s]=d[s]<1/0?d[s]*t:1/0}}function l(Z){for(var o=A[0],t=0===Z?b[0]:f[0],j=b[0]+o,S=A[1],a=1===Z?b[1]:f[1],O=b[1]+S,v=A[2],G=2===Z?b[2]:f[2],B=b[2]+v,Q=t;Q!=j;Q+=o)for(var D=a;D!=O;D+=S)for(var z=G;z!=B;z+=v)if(s(Q,D,z))return!0;return!1}function R(){F+=i;var s=A[L],Z=i/N,o=Q;for(V=0;V<3;V++){var t=G[V]*Z;B[V]+=t,D[V]+=t,o[V]=G[V]-t}if(s>0?D[L]=Math.round(D[L]):B[L]=Math.round(B[L]),O(F,L,s,o))return!0;for(V=0;V<3;V++)G[V]=o[V];return g(),0===N}function e(){var s=U[0]<U[1]?U[0]<U[2]?0:2:U[1]<U[2]?1:2,Z=U[s]-i;for(i=U[s],b[s]+=A[s],U[s]+=d[s],V=0;V<3;V++)Y[V]+=Z*u[V],f[V]=w(Y[V],A[V]);return s}function c(s,Z){return H(s-Z*z)}function w(s,Z){return H(s+Z*z)}}(s,b,d,U,u,A);if(!f){for(F=0;F<3;F++)H[F]=Y[F]>0?u[F]-z.max[F]:U[F]-z.base[F];z.translate(H)}return i}},13281:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>Q});var t=o(13127),j=o(11898);class S{constructor(s,Z,o,S,a,O,v){this.DG=new t(s.base,s.VG),this.Nj=Z,this.friction=o,this.restitution=S,this.Fa=a,this.KD=O,this.ia=!!v,this.LG=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.cz=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Iv=j.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=j.create(),this._impulses=j.create(),this._sleepFrameCount=10}loadFromCopy(s){j.i(this.DG.base,s.DG.base),j.i(this.DG.VG,s.DG.VG),j.i(this.DG.max,s.DG.max),this.DG.mag=s.DG.mag,this.Nj=s.Nj,this.friction=s.friction,this.restitution=s.restitution,this.Fa=s.Fa,this.KD=s.KD,this.ia=s.ia,this.LG=s.LG,this.fluidDrag=s.fluidDrag,this.cz=s.cz,this.preventFallOffEdge=s.preventFallOffEdge,this.rolledBackLastTick=s.rolledBackLastTick,j.i(this.Iv,s.Iv),j.i(this.resting,s.resting),this.inFluid=s.inFluid,this._ratioInFluid=s._ratioInFluid,j.i(this._forces,s._forces),j.i(this._impulses,s._impulses),this._sleepFrameCount=s._sleepFrameCount}setPosition(s){a(s),j.Go(s,s,this.DG.base),this.DG.translate(s),this.pv()}Ka(){return j.clone(this.DG.base)}applyForce(s){a(s),j.add(this._forces,this._forces,s),this.pv()}applyImpulse(s){a(s),j.add(this._impulses,this._impulses,s),this.pv()}pv(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var a=s=>{};var O=o(13127),v=o(11898),G=o(13135);function B(){this.LG=.1,this.fluidDrag=.4,this.la=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Q(s,Z,o){s=Object.assign(new B,s),this.gravity=s.gravity||[0,-10,0],this.LG=s.LG||.1,this.la=s.la||2,this.fluidDrag=s.fluidDrag||.4,this.minBounceImpulse=s.minBounceImpulse,this.bodies=[],this.zD=s.zD,this.testSolid=Z,this.testFluid=o}Q.prototype.nD=function(s,Z,o,t,j,a){s=s||new O([0,0,0],[1,1,1]),"undefined"==typeof Z&&(Z=1),"undefined"==typeof o&&(o=1),"undefined"==typeof t&&(t=0),"undefined"==typeof j&&(j=1);var v=new S(s,Z,o,t,j,a);return this.bodies.push(v),v},Q.prototype.JD=function(s){var Z=this.bodies.indexOf(s);Z<0||(this.bodies.splice(Z,1),s.DG=s.KD=null)};var D=v.create(),z=v.create(),Y=v.create(),b=v.create(),f=v.create(),A=v.create(),d=v.create(),U=new O([0,0,0],[1,1,1]),u=new S(U,1,1,0,1,(()=>{}),!1);function H(s,Z,o){return Z=o,Z*=1-(1-s.ratioInFluid)**2}Q.prototype.Ia=function(s){s/=1e3;var Z=M(0,v.squaredLength(this.gravity));this.bodies.forEach((o=>function(s,Z,o,t){v.i(f,Z.resting),s.zD&&u.loadFromCopy(Z);if(Z.Nj<=0)return v.set(Z.Iv,0,0,0),v.set(Z._forces,0,0,0),void v.set(Z._impulses,0,0,0);var j=t||0===Z.Fa;if(function(s,Z,o,t){if(Z._sleepFrameCount>0)return!1;if(t)return!0;var j=!1,S=.5*o*o*Z.Fa;return v.scale(h,s.gravity,S),G(s.testSolid,Z.DG,h,(function(){return j=!0,!0}),!0),j}(s,Z,o,j))return;Z._sleepFrameCount--,function(s,Z){var o=Z.DG,t=Math.floor(o.base[0]),j=Math.floor(o.base[2]),S=Math.floor(o.base[1]),a=Math.floor(o.max[1]);if(!s.testFluid(t,S,j))return Z.inFluid=!1,void(Z.ratioInFluid=0);var O=1,G=S+1;for(;G<=a&&s.testFluid(t,G,j);)O++,G++;var B=(S+O-o.base[1])/o.VG[1];B>1&&(B=1);var Q=o.VG[0]*o.VG[1]*o.VG[2]*B,D=i;v.scale(D,s.gravity,-s.la*Q*Z.Fa),Z.applyForce(D),Z.inFluid=!0,Z.ratioInFluid=B}(s,Z),k(Z._forces),k(Z._impulses),k(Z.Iv),k(Z.resting),v.scale(D,Z._forces,1/Z.Nj),v.Wa(D,D,s.gravity,Z.Fa),v.scale(z,Z._impulses,1/Z.Nj),v.Wa(z,z,D,o),v.add(Z.Iv,Z.Iv,z),Z.friction&&(N(s,0,Z,z,o),N(s,1,Z,z,o),N(s,2,Z,z,o));var S=Z.fluidDrag>=0?Z.fluidDrag:s.fluidDrag,a=Z.LG>=0?Z.LG:s.LG,O=a,B=a;Z.inFluid&&(O=H(Z,O,Z.fluidDragHoriz>=0?Z.fluidDragHoriz:S),B=H(Z,B,Z.fluidDragVert>=0?Z.fluidDragVert:S));O=Math.max(1-O*o/Z.Nj,0),B=Math.max(1-B*o/Z.Nj,0),v.set(F,O,B,O),v.multiply(Z.Iv,Z.Iv,F),v.scale(Y,Z.Iv,o),v.set(Z._forces,0,0,0),v.set(Z._impulses,0,0,0),Z.ia&&x(g,Z.DG);v.i(A,Y),v.set(d,0,0,0),Z.preventFallOffEdge&&function(s,Z,o,t){if(!Z.resting[1]||o[1]>0)return;var j=X;x(j,Z.DG);for(var S=0;S<3;S+=2){v.set(w,0,0,0),w[S]=o[S];var a=!0;(a=(a=(a=(a=a&&!q(s,j.base[0]+w[0]+1e-5,j.base[1],j.base[2]+w[2]+1e-5))&&!q(s,j.max[0]+w[0]-1e-5,j.base[1],j.base[2]+w[2]+1e-5))&&!q(s,j.base[0]+w[0]+1e-5,j.base[1],j.max[2]+w[2]-1e-5))&&!q(s,j.max[0]+w[0]-1e-5,j.base[1],j.max[2]+w[2]-1e-5))?(t[S]=o[S]>0?1:-1,o[S]=0):0===S&&(v.set(W,o[0],0,0),V(s,j,W,t,Z.slideOnCollision))}}(s,Z,Y,d);V(s,Z.DG,Y,Z.resting,Z.slideOnCollision),Z.ia&&function(s,Z,o,t){if(Z.resting[1]>=0&&!Z.inFluid)return;var j=0!==Z.resting[0],S=0!==Z.resting[2];if(!j&&!S)return;var a=Math.abs(t[0]/t[2]),O=4;if(!j&&a>O)return;if(!S&&a<1/O)return;v.add(R,o.base,t);var B=s.testSolid;G(B,o,t,(function(s,Z,o,t){if(1!==Z)return!0;t[Z]=0}));var Q=o.base[1],D=Z.inFluid?1.951:1.001,z=Math.floor(Q+D)-Q;v.set(e,0,z,0);var Y=!1;if(G(B,o,e,(function(s,Z,o,t){return Y=!0,!0})),Y)return;v.Go(c,R,o.base),c[1]=0,V(s,o,c,l,!0);var b=M(o.base[0],R[0]),f=M(o.base[2],R[2]);if(j&&!b&&(!f||!S))return;if(S&&(!b||!j)&&!f)return;var A=!0;if(A=A&&!q(s,o.base[0]+1e-5,o.base[1],o.base[2]+1e-5),A=A&&!q(s,o.max[0]-1e-5,o.base[1],o.base[2]+1e-5),A=A&&!q(s,o.base[0]+1e-5,o.base[1],o.max[2]-1e-5),A=A&&!q(s,o.max[0]-1e-5,o.base[1],o.max[2]-1e-5),A)return;x(Z.DG,o),Z.resting[0]=l[0],Z.resting[2]=l[2],Z.cz&&Z.cz()}(s,Z,g,A);for(var Q=0;Q<3;++Q)Z.resting[Q]=Z.resting[Q]||d[Q],b[Q]=0,Z.resting[Q]&&(f[Q]||(b[Q]=-Z.Iv[Q]),Z.Iv[Q]=0);var U=v.length(b);U>.001&&(v.scale(b,b,Z.Nj),Z.KD&&Z.KD(b),Z.restitution>0&&U>s.minBounceImpulse&&(v.scale(b,b,Z.restitution),Z.applyImpulse(b)));var L=v.squaredLength(Z.Iv);L>1e-5&&Z.pv();s.zD&&s.zD(Z)?(Z.loadFromCopy(u),Z.rolledBackLastTick=!0):Z.rolledBackLastTick=!1}(this,o,s,Z)))};var F=v.create([0,0,0]);var i=v.create();function N(s,Z,o,t,j){var S=o.resting[Z],a=t[Z];if(!o.alwaysApplyHorizFriction||1!==Z){if(0===S)return;if(S*a<=0)return}v.i(L,o.Iv),L[Z]=0;var O=v.length(L);if(!M(O,0)){var G=Math.abs(o.friction*s.gravity[Z]*j),B=O>G?(O-G)/O:0;o.Iv[(Z+1)%3]*=B,o.Iv[(Z+2)%3]*=B}}var L=v.create();function V(s,Z,o,t,j){return v.set(t,0,0,0),G(s.testSolid,Z,o,(function(s,Z,o,S){t[Z]=o,S[Z]=0,j||(S[0]=0,S[1]=0,S[2]=0)}))}var g=new O([],[]),l=v.create(),R=v.create(),e=v.create(),c=v.create();var w=v.create(),X=new O([],[]),W=v.create();function q(s,Z,o,t){return s.testSolid(Math.floor(Z),Math.floor(o-1),Math.floor(t))}var h=v.create();function M(s,Z){return Math.abs(s-Z)<1e-5}function x(s,Z){for(var o=0;o<3;o++)s.base[o]=Z.base[o],s.max[o]=Z.max[o],s.VG[o]=Z.VG[o]}var k=function(s){}},11777:function(s,Z){!function(s){"use strict";var Z=function(s,o){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,Z){s.__proto__=Z}||function(s,Z){for(var o in Z)Object.prototype.hasOwnProperty.call(Z,o)&&(s[o]=Z[o])},Z(s,o)};function o(s,o){if("function"!==typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function t(){this.constructor=s}Z(s,o),s.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}function t(s,Z,o,t){var j,S=arguments.length,a=S<3?Z:null===t?t=Object.getOwnPropertyDescriptor(Z,o):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(s,Z,o,t);else for(var O=s.length-1;O>=0;O--)(j=s[O])&&(a=(S<3?j(a):S>3?j(Z,o,a):j(Z,o))||a);return S>3&&a&&Object.defineProperty(Z,o,a),a}function j(s,Z,o){if(o||2===arguments.length)for(var t,j=0,S=Z.length;j<S;j++)!t&&j in Z||(t||(t=Array.prototype.slice.call(Z,0,j)),t[j]=Z[j]);return s.concat(t||Array.prototype.slice.call(Z))}var S,a=255,O=213;s.OPERATION=void 0,(S=s.OPERATION||(s.OPERATION={}))[S.ADD=128]="ADD",S[S.REPLACE=0]="REPLACE",S[S.DELETE=64]="DELETE",S[S.DELETE_AND_ADD=192]="DELETE_AND_ADD",S[S.TOUCH=1]="TOUCH",S[S.CLEAR=10]="CLEAR";var v=function(){function Z(s,Z,o){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=s,this.setParent(Z,o)}return Z.prototype.setParent=function(s,Z,o){var t=this;if(this.indexes||(this.indexes=this.ref instanceof cs?this.ref._definition.indexes:{}),this.parent=s,this.parentIndex=o,Z)if(this.root=Z,this.ref instanceof cs){var j=this.ref._definition;for(var S in j.schema){var a=this.ref[S];if(a&&a.$changes){var O=j.indexes[S];a.$changes.setParent(this.ref,Z,O)}}}else"object"===typeof this.ref&&this.ref.forEach((function(s,Z){if(s instanceof cs){var o=s.$changes,j=t.ref.$changes.indexes[Z];o.setParent(t.ref,t.root,j)}}))},Z.prototype.operation=function(s){this.changes.set(--this.currentCustomOperation,s)},Z.prototype.change=function(Z,o){void 0===o&&(o=s.OPERATION.ADD);var t="number"===typeof Z?Z:this.indexes[Z];this.assertValidIndex(t,Z);var j=this.changes.get(t);j&&j.op!==s.OPERATION.DELETE&&j.op!==s.OPERATION.TOUCH||this.changes.set(t,{op:j&&j.op===s.OPERATION.DELETE?s.OPERATION.DELETE_AND_ADD:o,index:t}),this.allChanges.add(t),this.changed=!0,this.touchParents()},Z.prototype.touch=function(Z){var o="number"===typeof Z?Z:this.indexes[Z];this.assertValidIndex(o,Z),this.changes.has(o)||this.changes.set(o,{op:s.OPERATION.TOUCH,index:o}),this.allChanges.add(o),this.touchParents()},Z.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},Z.prototype.getType=function(s){if(this.ref._definition)return(Z=this.ref._definition).schema[Z.fieldsByIndex[s]];var Z,o=(Z=this.parent._definition).schema[Z.fieldsByIndex[this.parentIndex]];return Object.values(o)[0]},Z.prototype.getChildrenFilter=function(){var s=this.parent._definition.childFilters;return s&&s[this.parentIndex]},Z.prototype.getValue=function(s){return this.ref.getByIndex(s)},Z.prototype.delete=function(Z){var o="number"===typeof Z?Z:this.indexes[Z];if(void 0!==o){var t=this.getValue(o);this.changes.set(o,{op:s.OPERATION.DELETE,index:o}),this.allChanges.delete(o),delete this.caches[o],t&&t.$changes&&(t.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(Z," (").concat(o,")"))},Z.prototype.discard=function(Z,o){var t=this;void 0===Z&&(Z=!1),void 0===o&&(o=!1),this.ref instanceof cs||this.changes.forEach((function(Z){if(Z.op===s.OPERATION.DELETE){var o=t.ref.getIndex(Z.index);delete t.indexes[o]}})),this.changes.clear(),this.changed=Z,o&&this.allChanges.clear(),this.currentCustomOperation=0},Z.prototype.discardAll=function(){var s=this;this.changes.forEach((function(Z){var o=s.getValue(Z.index);o&&o.$changes&&o.$changes.discardAll()})),this.discard()},Z.prototype.cache=function(s,Z){this.caches[s]=Z},Z.prototype.clone=function(){return new Z(this.ref,this.parent,this.root)},Z.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},Z.prototype.assertValidIndex=function(s,Z){if(void 0===s)throw new Error('ChangeTree: missing index for field "'.concat(Z,'"'))},Z}();function G(s,Z,o,t){return s[Z]||(s[Z]=[]),s[Z].push(o),null===t||void 0===t||t.forEach((function(s,Z){return o(s,Z)})),function(){return Q(s[Z],s[Z].indexOf(o))}}function B(Z){var o=this,t="string"!==typeof this.$changes.getType();this.$items.forEach((function(j,S){Z.push({refId:o.$changes.refId,op:s.OPERATION.DELETE,field:S,value:void 0,previousValue:j}),t&&o.$changes.root.removeRef(j.$changes.refId)}))}function Q(s,Z){if(-1===Z||Z>=s.length)return!1;for(var o=s.length-1,t=Z;t<o;t++)s[t]=s[t+1];return s.length=o,!0}var D=function(s,Z){var o=s.toString(),t=Z.toString();return o<t?-1:o>t?1:0};function z(s){return s.$proxy=!0,s=new Proxy(s,{get:function(s,Z){return"symbol"===typeof Z||isNaN(Z)?s[Z]:s.at(Z)},set:function(s,Z,o){if("symbol"===typeof Z||isNaN(Z))s[Z]=o;else{var t=Array.from(s.$items.keys()),j=parseInt(t[Z]||Z);void 0===o||null===o?s.deleteAt(j):s.setAt(j,o)}return!0},deleteProperty:function(s,Z){return"number"===typeof Z?s.deleteAt(Z):delete s[Z],!0}})}var Y=function(){function Z(){for(var s=[],Z=0;Z<arguments.length;Z++)s[Z]=arguments[Z];this.$changes=new v(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,s)}return Z.prototype.HO=function(Z,o){return void 0===o&&(o=!0),G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,Z,o?this.$items:void 0)},Z.prototype.lt=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,Z)},Z.is=function(s){return Array.isArray(s)||void 0!==s.array},Object.defineProperty(Z.prototype,"length",{get:function(){return this.$items.size},set:function(s){0===s?this.clear():this.splice(s,this.length-s)},enumerable:!1,configurable:!0}),Z.prototype.push=function(){for(var s,Z=this,o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];return o.forEach((function(o){s=Z.$refId++,Z.setAt(s,o)})),s},Z.prototype.pop=function(){var s=Array.from(this.$indexes.values()).pop();if(void 0!==s){this.$changes.delete(s),this.$indexes.delete(s);var Z=this.$items.get(s);return this.$items.delete(s),Z}},Z.prototype.at=function(s){var Z=Array.from(this.$items.keys())[s];return this.$items.get(Z)},Z.prototype.setAt=function(Z,o){var t,j;if(void 0!==o&&null!==o){if(this.$items.get(Z)!==o){void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,Z);var S=null!==(j=null===(t=this.$changes.indexes[Z])||void 0===t?void 0:t.op)&&void 0!==j?j:s.OPERATION.ADD;this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,o),this.$changes.change(Z,S)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},Z.prototype.deleteAt=function(s){var Z=Array.from(this.$items.keys())[s];return void 0!==Z&&this.$deleteAt(Z)},Z.prototype.$deleteAt=function(s){return this.$changes.delete(s),this.$indexes.delete(s),this.$items.delete(s)},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&B.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.concat=function(){for(var s,o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];return new(Z.bind.apply(Z,j([void 0],(s=Array.from(this.$items.values())).concat.apply(s,o),!1)))},Z.prototype.join=function(s){return Array.from(this.$items.values()).join(s)},Z.prototype.reverse=function(){var s=this,Z=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(o,t){s.setAt(Z[t],o)})),this},Z.prototype.shift=function(){var s=Array.from(this.$items.keys()).shift();if(void 0!==s){var Z=this.$items.get(s);return this.$deleteAt(s),Z}},Z.prototype.slice=function(s,o){var t=new Z;return t.push.apply(t,Array.from(this.$items.values()).slice(s,o)),t},Z.prototype.sort=function(s){var Z=this;void 0===s&&(s=D);var o=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(s).forEach((function(s,t){Z.setAt(o[t],s)})),this},Z.prototype.splice=function(s,Z){void 0===Z&&(Z=this.length-s);for(var o=Array.from(this.$items.keys()),t=[],j=s;j<s+Z;j++)t.push(this.$items.get(o[j])),this.$deleteAt(o[j]);return t},Z.prototype.unshift=function(){for(var s=this,Z=[],o=0;o<arguments.length;o++)Z[o]=arguments[o];var t=this.length,j=Z.length,S=Array.from(this.$items.values());return Z.forEach((function(Z,o){s.setAt(o,Z)})),S.forEach((function(Z,o){s.setAt(j+o,Z)})),t+j},Z.prototype.indexOf=function(s,Z){return Array.from(this.$items.values()).indexOf(s,Z)},Z.prototype.lastIndexOf=function(s,Z){return void 0===Z&&(Z=this.length-1),Array.from(this.$items.values()).lastIndexOf(s,Z)},Z.prototype.every=function(s,Z){return Array.from(this.$items.values()).every(s,Z)},Z.prototype.some=function(s,Z){return Array.from(this.$items.values()).some(s,Z)},Z.prototype.forEach=function(s,Z){Array.from(this.$items.values()).forEach(s,Z)},Z.prototype.map=function(s,Z){return Array.from(this.$items.values()).map(s,Z)},Z.prototype.filter=function(s,Z){return Array.from(this.$items.values()).filter(s,Z)},Z.prototype.reduce=function(s,Z){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},Z.prototype.reduceRight=function(s,Z){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},Z.prototype.find=function(s,Z){return Array.from(this.$items.values()).find(s,Z)},Z.prototype.findIndex=function(s,Z){return Array.from(this.$items.values()).findIndex(s,Z)},Z.prototype.fill=function(s,Z,o){throw new Error("ArraySchema#fill() not implemented")},Z.prototype.copyWithin=function(s,Z,o){throw new Error("ArraySchema#copyWithin() not implemented")},Z.prototype.toString=function(){return this.$items.toString()},Z.prototype.toLocaleString=function(){return this.$items.toLocaleString()},Z.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(Z,Symbol.species,{get:function(){return Z},enumerable:!1,configurable:!0}),Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.keys=function(){return this.$items.keys()},Z.prototype.values=function(){return this.$items.values()},Z.prototype.includes=function(s,Z){return Array.from(this.$items.values()).includes(s,Z)},Z.prototype.flatMap=function(s,Z){throw new Error("ArraySchema#flatMap() is not supported.")},Z.prototype.flat=function(s){throw new Error("ArraySchema#flat() is not supported.")},Z.prototype.findLast=function(){var s=Array.from(this.$items.values());return s.findLast.apply(s,arguments)},Z.prototype.findLastIndex=function(){var s=Array.from(this.$items.values());return s.findLastIndex.apply(s,arguments)},Z.prototype.setIndex=function(s,Z){this.$indexes.set(s,Z)},Z.prototype.getIndex=function(s){return this.$indexes.get(s)},Z.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},Z.prototype.deleteByIndex=function(s){var Z=this.$indexes.get(s);this.$items.delete(Z),this.$indexes.delete(s)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){return this.toArray().map((function(s){return"function"===typeof s.toJSON?s.toJSON():s}))},Z.prototype.clone=function(s){return s?new(Z.bind.apply(Z,j([void 0],Array.from(this.$items.values()),!1))):new(Z.bind.apply(Z,j([void 0],this.map((function(s){return s.$changes?s.clone():s})),!1)))},Z}();function b(s){return s.$proxy=!0,s=new Proxy(s,{get:function(s,Z){return"symbol"!==typeof Z&&"undefined"===typeof s[Z]?s.get(Z):s[Z]},set:function(s,Z,o){return"symbol"!==typeof Z&&-1===Z.indexOf("$")&&"HO"!==Z&&"lt"!==Z&&"onChange"!==Z?s.set(Z,o):s[Z]=o,!0},deleteProperty:function(s,Z){return s.delete(Z),!0}})}var f=function(){function Z(s){var o=this;if(this.$changes=new v(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,s)if(s instanceof Map||s instanceof Z)s.forEach((function(s,Z){return o.set(Z,s)}));else for(var t in s)this.set(t,s[t])}return Z.prototype.HO=function(Z,o){return void 0===o&&(o=!0),G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,Z,o?this.$items:void 0)},Z.prototype.lt=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,Z)},Z.is=function(s){return void 0!==s.map},Z.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(Z.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(Z,Symbol.species,{get:function(){return Z},enumerable:!1,configurable:!0}),Z.prototype.set=function(Z,o){if(void 0===o||null===o)throw new Error("MapSchema#set('".concat(Z,"', ").concat(o,"): trying to set ").concat(o," value on '").concat(Z,"'."));Z=Z.toString();var t="undefined"!==typeof this.$changes.indexes[Z],j=t?this.$changes.indexes[Z]:this.$refId++,S=t?s.OPERATION.REPLACE:s.OPERATION.ADD,a=void 0!==o.$changes;if(a&&o.$changes.setParent(this,this.$changes.root,j),t){if(!a&&this.$items.get(Z)===o)return;a&&this.$items.get(Z)!==o&&(S=s.OPERATION.ADD)}else this.$changes.indexes[Z]=j,this.$indexes.set(j,Z);return this.$items.set(Z,o),this.$changes.change(Z,S),this},Z.prototype.get=function(s){return this.$items.get(s)},Z.prototype.delete=function(s){return this.$changes.delete(s),this.$items.delete(s)},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&B.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(s){return this.$items.has(s)},Z.prototype.forEach=function(s){this.$items.forEach(s)},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.keys=function(){return this.$items.keys()},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(s,Z){this.$indexes.set(s,Z)},Z.prototype.getIndex=function(s){return this.$indexes.get(s)},Z.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},Z.prototype.deleteByIndex=function(s){var Z=this.$indexes.get(s);this.$items.delete(Z),this.$indexes.delete(s)},Z.prototype.toJSON=function(){var s={};return this.forEach((function(Z,o){s[o]="function"===typeof Z.toJSON?Z.toJSON():Z})),s},Z.prototype.clone=function(s){var o;return s?o=Object.assign(new Z,this):(o=new Z,this.forEach((function(s,Z){s.$changes?o.set(Z,s.clone()):o.set(Z,s)}))),o},Z}(),A={};function d(s,Z){A[s]=Z}function U(s){return A[s]}var u=function(){function s(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return s.create=function(Z){var o=new s;return o.schema=Object.assign({},Z&&Z.schema||{}),o.indexes=Object.assign({},Z&&Z.indexes||{}),o.fieldsByIndex=Object.assign({},Z&&Z.fieldsByIndex||{}),o.descriptors=Object.assign({},Z&&Z.descriptors||{}),o.deprecated=Object.assign({},Z&&Z.deprecated||{}),o},s.prototype.addField=function(s,Z){var o=this.getNextFieldIndex();this.fieldsByIndex[o]=s,this.indexes[s]=o,this.schema[s]=Array.isArray(Z)?{array:Z[0]}:Z},s.prototype.hasField=function(s){return void 0!==this.indexes[s]},s.prototype.addFilter=function(s,Z){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[s]]=Z,this.indexesWithFilters.push(this.indexes[s]),!0},s.prototype.addChildrenFilter=function(s,Z){var o=this.indexes[s],t=this.schema[s];if(U(Object.keys(t)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[o]=Z,!0;console.warn("@filterChildren: field '".concat(s,"' can't have children. Ignoring filter."))},s.prototype.getChildrenFilter=function(s){return this.childFilters&&this.childFilters[this.indexes[s]]},s.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},s}();function H(s){return s._context&&s._context.useFilters}var F=function(){function s(){this.types={},this.schemas=new Map,this.useFilters=!1}return s.prototype.has=function(s){return this.schemas.has(s)},s.prototype.get=function(s){return this.types[s]},s.prototype.add=function(s,Z){void 0===Z&&(Z=this.schemas.size),s._definition=u.create(s._definition),s._typeid=Z,this.types[Z]=s,this.schemas.set(s,Z)},s.create=function(Z){return void 0===Z&&(Z={}),function(o){return Z.context||(Z.context=new s),N(o,Z)}},s}(),i=new F;function N(s,Z){return void 0===Z&&(Z={}),function(o,t){var S=Z.context||i,a=o.constructor;if(a._context=S,!s)throw new Error("".concat(a.name,': @type() reference provided for "').concat(t,"\" is undefined. Make sure you don't have any circular dependencies."));S.has(a)||S.add(a);var O=a._definition;if(O.addField(t,s),O.descriptors[t]){if(O.deprecated[t])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(t,"' definition on '").concat(a.name,"'.\nCheck @type() annotation"))}catch(A){var v=A.stack.split("\n")[4].trim();throw new Error("".concat(A.message," ").concat(v))}}var G=Y.is(s),B=!G&&f.is(s);if("string"!==typeof s&&!cs.is(s)){var Q=Object.values(s)[0];"string"===typeof Q||S.has(Q)||S.add(Q)}if(Z.manual)O.descriptors[t]={enumerable:!0,configurable:!0,writable:!0};else{var D="_".concat(t);O.descriptors[D]={enumerable:!1,configurable:!1,writable:!0},O.descriptors[t]={get:function(){return this[D]},set:function(s){s!==this[D]&&(void 0!==s&&null!==s?(!G||s instanceof Y||(s=new(Y.bind.apply(Y,j([void 0],s,!1)))),!B||s instanceof f||(s=new f(s)),void 0===s.$proxy&&(B?s=b(s):G&&(s=z(s))),this.$changes.change(t),s.$changes&&s.$changes.setParent(this,this.$changes.root,this._definition.indexes[t])):this[D]&&this.$changes.delete(t),this[D]=s)},enumerable:!0,configurable:!0}}}}function L(s){return function(Z,o){var t=Z.constructor;t._definition.addFilter(o,s)&&(t._context.useFilters=!0)}}function V(s){return function(Z,o){var t=Z.constructor;t._definition.addChildrenFilter(o,s)&&(t._context.useFilters=!0)}}function g(s){return void 0===s&&(s=!0),function(Z,o){var t=Z.constructor._definition;t.deprecated[o]=!0,s&&(t.descriptors[o]={get:function(){throw new Error("".concat(o," is deprecated."))},set:function(s){},enumerable:!1,configurable:!0})}}function l(s,Z,o){for(var t in void 0===o&&(o={}),o.context||(o.context=s._context||o.context||i),Z)N(Z[t],o)(s.prototype,t);return s}function R(s){for(var Z=0,o=0,t=0,j=s.length;t<j;t++)(Z=s.charCodeAt(t))<128?o+=1:Z<2048?o+=2:Z<55296||Z>=57344?o+=3:(t++,o+=4);return o}function e(s,Z,o){for(var t=0,j=0,S=o.length;j<S;j++)(t=o.charCodeAt(j))<128?s[Z++]=t:t<2048?(s[Z++]=192|t>>6,s[Z++]=128|63&t):t<55296||t>=57344?(s[Z++]=224|t>>12,s[Z++]=128|t>>6&63,s[Z++]=128|63&t):(j++,t=65536+((1023&t)<<10|1023&o.charCodeAt(j)),s[Z++]=240|t>>18,s[Z++]=128|t>>12&63,s[Z++]=128|t>>6&63,s[Z++]=128|63&t)}function c(s,Z){s.push(255&Z)}function w(s,Z){s.push(255&Z)}function X(s,Z){s.push(255&Z),s.push(Z>>8&255)}function W(s,Z){s.push(255&Z),s.push(Z>>8&255)}function q(s,Z){s.push(255&Z),s.push(Z>>8&255),s.push(Z>>16&255),s.push(Z>>24&255)}function h(s,Z){var o=Z>>24,t=Z>>16,j=Z>>8,S=Z;s.push(255&S),s.push(255&j),s.push(255&t),s.push(255&o)}function M(s,Z){var o=Math.floor(Z/Math.pow(2,32));h(s,Z>>>0),h(s,o)}function x(s,Z){var o=Z/Math.pow(2,32)|0;h(s,Z>>>0),h(s,o)}function k(s,Z){p(s,Z)}function y(s,Z){E(s,Z)}var I=new Int32Array(2),C=new Float32Array(I.buffer),K=new Float64Array(I.buffer);function p(s,Z){C[0]=Z,q(s,I[0])}function E(s,Z){K[0]=Z,q(s,I[0]),q(s,I[1])}function P(s,Z){return w(s,Z?1:0)}function r(s,Z){Z||(Z="");var o=R(Z),t=0;if(o<32)s.push(160|o),t=1;else if(o<256)s.push(217),w(s,o),t=2;else if(o<65536)s.push(218),W(s,o),t=3;else{if(!(o<4294967296))throw new Error("String too long");s.push(219),h(s,o),t=5}return e(s,s.length,Z),t+o}function T(s,Z){return isNaN(Z)?T(s,0):isFinite(Z)?Z!==(0|Z)?(s.push(203),E(s,Z),9):Z>=0?Z<128?(w(s,Z),1):Z<256?(s.push(204),w(s,Z),2):Z<65536?(s.push(205),W(s,Z),3):Z<4294967296?(s.push(206),h(s,Z),5):(s.push(207),x(s,Z),9):Z>=-32?(s.push(224|Z+32),1):Z>=-128?(s.push(208),c(s,Z),2):Z>=-32768?(s.push(209),X(s,Z),3):Z>=-2147483648?(s.push(210),q(s,Z),5):(s.push(211),M(s,Z),9):T(s,Z>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var m=Object.freeze({__proto__:null,utf8Write:e,int8:c,uint8:w,int16:X,uint16:W,int32:q,uint32:h,int64:M,uint64:x,float32:k,float64:y,writeFloat32:p,writeFloat64:E,boolean:P,string:r,number:T});function n(s,Z,o){for(var t="",j=0,S=Z,a=Z+o;S<a;S++){var O=s[S];0!==(128&O)?192!==(224&O)?224!==(240&O)?240!==(248&O)?console.error("Invalid byte "+O.toString(16)):(j=(7&O)<<18|(63&s[++S])<<12|(63&s[++S])<<6|63&s[++S])>=65536?(j-=65536,t+=String.fromCharCode(55296+(j>>>10),56320+(1023&j))):t+=String.fromCharCode(j):t+=String.fromCharCode((15&O)<<12|(63&s[++S])<<6|63&s[++S]):t+=String.fromCharCode((31&O)<<6|63&s[++S]):t+=String.fromCharCode(O)}return t}function J(s,Z){return ss(s,Z)<<24>>24}function ss(s,Z){return s[Z.offset++]}function Zs(s,Z){return os(s,Z)<<16>>16}function os(s,Z){return s[Z.offset++]|s[Z.offset++]<<8}function ts(s,Z){return s[Z.offset++]|s[Z.offset++]<<8|s[Z.offset++]<<16|s[Z.offset++]<<24}function js(s,Z){return ts(s,Z)>>>0}function Ss(s,Z){return Ds(s,Z)}function as(s,Z){return zs(s,Z)}function Os(s,Z){var o=js(s,Z);return ts(s,Z)*Math.pow(2,32)+o}function vs(s,Z){var o=js(s,Z);return js(s,Z)*Math.pow(2,32)+o}var Gs=new Int32Array(2),Bs=new Float32Array(Gs.buffer),Qs=new Float64Array(Gs.buffer);function Ds(s,Z){return Gs[0]=ts(s,Z),Bs[0]}function zs(s,Z){return Gs[0]=ts(s,Z),Gs[1]=ts(s,Z),Qs[0]}function Ys(s,Z){return ss(s,Z)>0}function bs(s,Z){var o,t=s[Z.offset++];t<192?o=31&t:217===t?o=ss(s,Z):218===t?o=os(s,Z):219===t&&(o=js(s,Z));var j=n(s,Z.offset,o);return Z.offset+=o,j}function fs(s,Z){var o=s[Z.offset];return o<192&&o>160||217===o||218===o||219===o}function As(s,Z){var o=s[Z.offset++];return o<128?o:202===o?Ds(s,Z):203===o?zs(s,Z):204===o?ss(s,Z):205===o?os(s,Z):206===o?js(s,Z):207===o?vs(s,Z):208===o?J(s,Z):209===o?Zs(s,Z):210===o?ts(s,Z):211===o?Os(s,Z):o>223?-1*(255-o+1):void 0}function ds(s,Z){var o=s[Z.offset];return o<128||o>=202&&o<=211}function Us(s,Z){return s[Z.offset]<160}function us(s,Z){return s[Z.offset-1]===a&&(s[Z.offset]<128||s[Z.offset]>=202&&s[Z.offset]<=211)}var Hs=Object.freeze({__proto__:null,int8:J,uint8:ss,int16:Zs,uint16:os,int32:ts,uint32:js,float32:Ss,float64:as,int64:Os,uint64:vs,readFloat32:Ds,readFloat64:zs,boolean:Ys,string:bs,stringCheck:fs,number:As,numberCheck:ds,arrayCheck:Us,switchStructureCheck:us}),Fs=function(){function Z(s){var Z=this;this.$changes=new v(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,s&&s.forEach((function(s){return Z.add(s)}))}return Z.prototype.HO=function(Z,o){return void 0===o&&(o=!0),G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,Z,o?this.$items:void 0)},Z.prototype.lt=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,Z)},Z.is=function(s){return void 0!==s.collection},Z.prototype.add=function(s){var Z=this.$refId++;return void 0!==s.$changes&&s.$changes.setParent(this,this.$changes.root,Z),this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,s),this.$changes.change(Z),Z},Z.prototype.at=function(s){var Z=Array.from(this.$items.keys())[s];return this.$items.get(Z)},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.delete=function(s){for(var Z,o,t=this.$items.entries();(o=t.next())&&!o.done;)if(s===o.value[1]){Z=o.value[0];break}return void 0!==Z&&(this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z))},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&B.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(s){return Array.from(this.$items.values()).some((function(Z){return Z===s}))},Z.prototype.forEach=function(s){var Z=this;this.$items.forEach((function(o,t,j){return s(o,t,Z)}))},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(s,Z){this.$indexes.set(s,Z)},Z.prototype.getIndex=function(s){return this.$indexes.get(s)},Z.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},Z.prototype.deleteByIndex=function(s){var Z=this.$indexes.get(s);this.$items.delete(Z),this.$indexes.delete(s)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){var s=[];return this.forEach((function(Z,o){s.push("function"===typeof Z.toJSON?Z.toJSON():Z)})),s},Z.prototype.clone=function(s){var o;return s?o=Object.assign(new Z,this):(o=new Z,this.forEach((function(s){s.$changes?o.add(s.clone()):o.add(s)}))),o},Z}(),is=function(){function Z(s){var Z=this;this.$changes=new v(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,s&&s.forEach((function(s){return Z.add(s)}))}return Z.prototype.HO=function(Z,o){return void 0===o&&(o=!0),G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,Z,o?this.$items:void 0)},Z.prototype.lt=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,Z)},Z.is=function(s){return void 0!==s.set},Z.prototype.add=function(Z){var o,t;if(this.has(Z))return!1;var j=this.$refId++;void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,j);var S=null!==(t=null===(o=this.$changes.indexes[j])||void 0===o?void 0:o.op)&&void 0!==t?t:s.OPERATION.ADD;return this.$changes.indexes[j]=j,this.$indexes.set(j,j),this.$items.set(j,Z),this.$changes.change(j,S),j},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.delete=function(s){for(var Z,o,t=this.$items.entries();(o=t.next())&&!o.done;)if(s===o.value[1]){Z=o.value[0];break}return void 0!==Z&&(this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z))},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&B.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(s){for(var Z,o=this.$items.values(),t=!1;(Z=o.next())&&!Z.done;)if(s===Z.value){t=!0;break}return t},Z.prototype.forEach=function(s){var Z=this;this.$items.forEach((function(o,t,j){return s(o,t,Z)}))},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(s,Z){this.$indexes.set(s,Z)},Z.prototype.getIndex=function(s){return this.$indexes.get(s)},Z.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},Z.prototype.deleteByIndex=function(s){var Z=this.$indexes.get(s);this.$items.delete(Z),this.$indexes.delete(s)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){var s=[];return this.forEach((function(Z,o){s.push("function"===typeof Z.toJSON?Z.toJSON():Z)})),s},Z.prototype.clone=function(s){var o;return s?o=Object.assign(new Z,this):(o=new Z,this.forEach((function(s){s.$changes?o.add(s.clone()):o.add(s)}))),o},Z}(),Ns=function(){function s(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return s.prototype.addRefId=function(s){this.refIds.has(s)||(this.refIds.add(s),this.containerIndexes.set(s,new Set))},s.get=function(Z){return void 0===Z.$filterState&&(Z.$filterState=new s),Z.$filterState},s}(),Ls=function(){function s(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return s.prototype.getNextUniqueId=function(){return this.nextUniqueId++},s.prototype.addRef=function(s,Z,o){void 0===o&&(o=!0),this.refs.set(s,Z),o&&(this.refCounts[s]=(this.refCounts[s]||0)+1)},s.prototype.removeRef=function(s){this.refCounts[s]=this.refCounts[s]-1,this.deletedRefs.add(s)},s.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},s.prototype.garbageCollectDeletedRefs=function(){var s=this;this.deletedRefs.forEach((function(Z){if(!(s.refCounts[Z]>0)){var o=s.refs.get(Z);if(o instanceof cs)for(var t in o._definition.schema)"string"!==typeof o._definition.schema[t]&&o[t]&&o[t].$changes&&s.removeRef(o[t].$changes.refId);else{var j=o.$changes.parent._definition,S=j.schema[j.fieldsByIndex[o.$changes.parentIndex]];"function"===typeof Object.values(S)[0]&&Array.from(o.values()).forEach((function(Z){return s.removeRef(Z.$changes.refId)}))}s.refs.delete(Z),delete s.refCounts[Z]}})),this.deletedRefs.clear()},s}(),Vs=function(s){function Z(){return null!==s&&s.apply(this,arguments)||this}return o(Z,s),Z}(Error);function gs(s,Z,o,t){var j,S=!1;switch(Z){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":j="number",isNaN(s)&&console.log('trying to encode "NaN" in '.concat(o.constructor.name,"#").concat(t));break;case"string":j="string",S=!0;break;case"boolean":return}if(typeof s!==j&&(!S||S&&null!==s)){var a="'".concat(JSON.stringify(s),"'").concat(s&&s.constructor&&" (".concat(s.constructor.name,")")||"");throw new Vs("a '".concat(j,"' was expected, but ").concat(a," was provided in ").concat(o.constructor.name,"#").concat(t))}}function ls(s,Z,o,t){if(!(s instanceof Z))throw new Vs("a '".concat(Z.name,"' was expected, but '").concat(s.constructor.name,"' was provided in ").concat(o.constructor.name,"#").concat(t))}function Rs(s,Z,o,t,j){gs(o,s,t,j);var S=m[s];if(!S)throw new Vs("a '".concat(s,"' was expected, but ").concat(o," was provided in ").concat(t.constructor.name,"#").concat(j));S(Z,o)}function es(s,Z,o){return Hs[s](Z,o)}var cs=function(){function Z(){for(var s=[],Z=0;Z<arguments.length;Z++)s[Z]=arguments[Z];Object.defineProperties(this,{$changes:{value:new v(this,void 0,new Ls),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var o=this._definition.descriptors;o&&Object.defineProperties(this,o),s[0]&&this.assign(s[0])}return Z.onError=function(s){console.error(s)},Z.is=function(s){return s._definition&&void 0!==s._definition.schema},Z.prototype.onChange=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,Z)},Z.prototype.lt=function(Z){return G(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,Z)},Z.prototype.assign=function(s){return Object.assign(this,s),this},Object.defineProperty(Z.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Z.prototype.setDirty=function(s,Z){this.$changes.change(s,Z)},Z.prototype.listen=function(s,Z,o){var t=this;return void 0===o&&(o=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[s]||(this.$callbacks[s]=[]),this.$callbacks[s].push(Z),o&&void 0!==this[s]&&Z(this[s],void 0),function(){return Q(t.$callbacks[s],t.$callbacks[s].indexOf(Z))}},Z.prototype.decode=function(o,t,j){var S;void 0===t&&(t={offset:0}),void 0===j&&(j=this);var O=[],v=this.$changes.root,G=o.length,B=0;for(v.refs.set(B,this);t.offset<G;){var Q=o[t.offset++];if(Q!=a){var D=j.$changes,z=void 0!==j._definition,b=z?Q>>6<<6:Q;if(b!==s.OPERATION.CLEAR){var A=z?Q%(b||255):As(o,t),d=z?j._definition.fieldsByIndex[A]:"",u=D.getType(A),H=void 0,F=void 0,i=void 0;if(z?F=j["_".concat(d)]:(F=j.getByIndex(A),(b&s.OPERATION.ADD)===s.OPERATION.ADD?(i=j instanceof f?bs(o,t):A,j.setIndex(A,i)):i=j.getIndex(A)),(b&s.OPERATION.DELETE)===s.OPERATION.DELETE&&(b!==s.OPERATION.DELETE_AND_ADD&&j.deleteByIndex(A),F&&F.$changes&&v.removeRef(F.$changes.refId),H=null),void 0!==d){if(b===s.OPERATION.DELETE);else if(Z.is(u)){var N=As(o,t);if(H=v.refs.get(N),b!==s.OPERATION.REPLACE){var L=this.getSchemaType(o,t,u);H||((H=this.createTypeInstance(L)).$changes.refId=N,F&&(H.$callbacks=F.$callbacks,F.$changes.refId&&N!==F.$changes.refId&&v.removeRef(F.$changes.refId))),v.addRef(N,H,H!==F)}}else if("string"===typeof u)H=es(u,o,t);else{var V=U(Object.keys(u)[0]),g=As(o,t),l=v.refs.has(g)?F||v.refs.get(g):new V.constructor;if((H=l.clone(!0)).$changes.refId=g,F&&(H.$callbacks=F.$callbacks,F.$changes.refId&&g!==F.$changes.refId)){v.removeRef(F.$changes.refId);for(var R=F.entries(),e=void 0;(e=R.next())&&!e.done;){var c=(S=e.value)[0],w=S[1];O.push({refId:g,op:s.OPERATION.DELETE,field:c,value:void 0,previousValue:w})}}v.addRef(g,H,l!==F)}if(null!==H&&void 0!==H)if(H.$changes&&H.$changes.setParent(D.ref,D.root,A),j instanceof Z)j[d]=H;else if(j instanceof f)c=i,j.$items.set(c,H),j.$changes.allChanges.add(A);else if(j instanceof Y)j.setAt(A,H);else if(j instanceof Fs){var X=j.add(H);j.setIndex(A,X)}else j instanceof is&&!1!==(X=j.add(H))&&j.setIndex(A,X);F!==H&&O.push({refId:B,op:b,field:d,dynamicIndex:i,value:H,previousValue:F})}else{console.warn("@colyseus/schema: definition mismatch");for(var W={offset:t.offset};t.offset<G&&(!us(o,t)||(W.offset=t.offset+1,!v.refs.has(As(o,W))));)t.offset++}}else j.clear(O)}else{B=As(o,t);var q=v.refs.get(B);if(!q)throw new Error('"refId" not found: '.concat(B));j=q}}return this._triggerChanges(O),v.garbageCollectDeletedRefs(),O},Z.prototype.encode=function(o,t,j){void 0===o&&(o=!1),void 0===t&&(t=[]),void 0===j&&(j=!1);for(var S=this.$changes,O=new WeakSet,v=[S],G=1,B=0;B<G;B++){var Q=v[B],D=Q.ref,z=D instanceof Z;Q.ensureRefId(),O.add(Q),Q!==S&&(Q.changed||o)&&(w(t,a),T(t,Q.refId));for(var Y=o?Array.from(Q.allChanges):Array.from(Q.changes.values()),b=0,A=Y.length;b<A;b++){var d=o?{op:s.OPERATION.ADD,index:Y[b]}:Y[b],u=d.index,H=z?D._definition.fieldsByIndex&&D._definition.fieldsByIndex[u]:u,F=t.length;if(d.op!==s.OPERATION.TOUCH)if(z)w(t,u|d.op);else{if(w(t,d.op),d.op===s.OPERATION.CLEAR)continue;T(t,u)}if(z||(d.op&s.OPERATION.ADD)!=s.OPERATION.ADD||D instanceof f&&r(t,Q.ref.$indexes.get(u)),d.op!==s.OPERATION.DELETE){var i=Q.getType(u),N=Q.getValue(u);if(N&&N.$changes&&!O.has(N.$changes)&&(v.push(N.$changes),N.$changes.ensureRefId(),G++),d.op!==s.OPERATION.TOUCH){if(Z.is(i))ls(N,i,D,H),T(t,N.$changes.refId),(d.op&s.OPERATION.ADD)===s.OPERATION.ADD&&this.tryEncodeTypeId(t,i,N.constructor);else if("string"===typeof i)Rs(i,t,N,D,H);else{var L=U(Object.keys(i)[0]);ls(D["_".concat(H)],L.constructor,D,H),T(t,N.$changes.refId)}j&&Q.cache(u,t.slice(F))}}}o||j||Q.discard()}return t},Z.prototype.encodeAll=function(s){return this.encode(!0,[],s)},Z.prototype.applyFilters=function(o,t){var j,S;void 0===t&&(t=!1);for(var O=this,v=new Set,G=Ns.get(o),B=[this.$changes],Q=1,D=[],z=function(z){var Y=B[z];if(v.has(Y.refId))return"continue";var b=Y.ref,A=b instanceof Z;w(D,a),T(D,Y.refId);var d=G.refIds.has(Y),U=t||!d;G.addRefId(Y);var u=G.containerIndexes.get(Y),H=U?Array.from(Y.allChanges):Array.from(Y.changes.values());!t&&A&&b._definition.indexesWithFilters&&b._definition.indexesWithFilters.forEach((function(Z){!u.has(Z)&&Y.allChanges.has(Z)&&(U?H.push(Z):H.push({op:s.OPERATION.ADD,index:Z}))}));for(var F=0,i=H.length;F<i;F++){var N=U?{op:s.OPERATION.ADD,index:H[F]}:H[F];if(N.op!==s.OPERATION.CLEAR){var L=N.index;if(N.op!==s.OPERATION.DELETE){var V=Y.getValue(L),g=Y.getType(L);if(A){if((l=b._definition.filters&&b._definition.filters[L])&&!l.call(b,o,V,O)){V&&V.$changes&&v.add(V.$changes.refId);continue}}else{var l,R=Y.parent;if((l=Y.getChildrenFilter())&&!l.call(R,o,b.$indexes.get(L),V,O)){V&&V.$changes&&v.add(V.$changes.refId);continue}}if(V.$changes&&(B.push(V.$changes),Q++),N.op!==s.OPERATION.TOUCH)if(N.op===s.OPERATION.ADD||A)D.push.apply(D,null!==(j=Y.caches[L])&&void 0!==j?j:[]),u.add(L);else if(u.has(L))D.push.apply(D,null!==(S=Y.caches[L])&&void 0!==S?S:[]);else{if(u.add(L),w(D,s.OPERATION.ADD),T(D,L),b instanceof f){var e=Y.ref.$indexes.get(L);r(D,e)}V.$changes?T(D,V.$changes.refId):m[g](D,V)}else V.$changes&&!A&&(w(D,s.OPERATION.ADD),T(D,L),b instanceof f&&(e=Y.ref.$indexes.get(L),r(D,e)),T(D,V.$changes.refId))}else A?w(D,N.op|L):(w(D,N.op),T(D,L))}else w(D,N.op)}},Y=0;Y<Q;Y++)z(Y);return D},Z.prototype.clone=function(){var s,Z=new this.constructor,o=this._definition.schema;for(var t in o)"object"===typeof this[t]&&"function"===typeof(null===(s=this[t])||void 0===s?void 0:s.clone)?Z[t]=this[t].clone():Z[t]=this[t];return Z},Z.prototype.toJSON=function(){var s=this._definition.schema,Z=this._definition.deprecated,o={};for(var t in s)Z[t]||null===this[t]||"undefined"===typeof this[t]||(o[t]="function"===typeof this[t].toJSON?this[t].toJSON():this["_".concat(t)]);return o},Z.prototype.discardAllChanges=function(){this.$changes.discardAll()},Z.prototype.getByIndex=function(s){return this[this._definition.fieldsByIndex[s]]},Z.prototype.deleteByIndex=function(s){this[this._definition.fieldsByIndex[s]]=void 0},Z.prototype.tryEncodeTypeId=function(s,Z,o){Z._typeid!==o._typeid&&(w(s,O),T(s,o._typeid))},Z.prototype.getSchemaType=function(s,Z,o){var t;return s[Z.offset]===O&&(Z.offset++,t=this.constructor._context.get(As(s,Z))),t||o},Z.prototype.createTypeInstance=function(s){var Z=new s;return Z.$changes.root=this.$changes.root,Z},Z.prototype._triggerChanges=function(o){for(var t,j,S,a,O,v,G,B,Q,D=new Set,z=this.$changes.root.refs,Y=function(Y){var b=o[Y],f=b.refId,A=z.get(f),d=A.$callbacks;if((b.op&s.OPERATION.DELETE)===s.OPERATION.DELETE&&b.previousValue instanceof Z&&(null===(j=null===(t=b.previousValue.$callbacks)||void 0===t?void 0:t[s.OPERATION.DELETE])||void 0===j||j.forEach((function(s){return s()}))),!d)return"continue";if(A instanceof Z){if(!D.has(f))try{null===(S=null===d||void 0===d?void 0:d[s.OPERATION.REPLACE])||void 0===S||S.forEach((function(s){return s()}))}catch(U){Z.onError(U)}try{d.hasOwnProperty(b.field)&&(null===(a=d[b.field])||void 0===a||a.forEach((function(s){return s(b.value,b.previousValue)})))}catch(U){Z.onError(U)}}else b.op===s.OPERATION.ADD&&void 0===b.previousValue?null===(O=d[s.OPERATION.ADD])||void 0===O||O.forEach((function(s){var Z;return s(b.value,null!==(Z=b.dynamicIndex)&&void 0!==Z?Z:b.field)})):b.op===s.OPERATION.DELETE?void 0!==b.previousValue&&(null===(v=d[s.OPERATION.DELETE])||void 0===v||v.forEach((function(s){var Z;return s(b.previousValue,null!==(Z=b.dynamicIndex)&&void 0!==Z?Z:b.field)}))):b.op===s.OPERATION.DELETE_AND_ADD&&(void 0!==b.previousValue&&(null===(G=d[s.OPERATION.DELETE])||void 0===G||G.forEach((function(s){var Z;return s(b.previousValue,null!==(Z=b.dynamicIndex)&&void 0!==Z?Z:b.field)}))),null===(B=d[s.OPERATION.ADD])||void 0===B||B.forEach((function(s){var Z;return s(b.value,null!==(Z=b.dynamicIndex)&&void 0!==Z?Z:b.field)}))),b.value!==b.previousValue&&(null===(Q=d[s.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(s){var Z;return s(b.value,null!==(Z=b.dynamicIndex)&&void 0!==Z?Z:b.field)})));D.add(f)},b=0;b<o.length;b++)Y(b)},Z._definition=u.create(),Z}();function ws(s){for(var Z=[s.$changes],o=1,t={},j=t,S=function(s){var o=Z[s];o.changes.forEach((function(s){var Z=o.ref,t=s.index,S=Z._definition?Z._definition.fieldsByIndex[t]:Z.$indexes.get(t);j[S]=o.getValue(t)}))},a=0;a<o;a++)S(a);return t}var Xs={context:new F},Ws=function(s){function Z(){return null!==s&&s.apply(this,arguments)||this}return o(Z,s),t([N("string",Xs)],Z.prototype,"name",void 0),t([N("string",Xs)],Z.prototype,"type",void 0),t([N("number",Xs)],Z.prototype,"referencedType",void 0),Z}(cs),qs=function(s){function Z(){var Z=null!==s&&s.apply(this,arguments)||this;return Z.fields=new Y,Z}return o(Z,s),t([N("number",Xs)],Z.prototype,"id",void 0),t([N([Ws],Xs)],Z.prototype,"fields",void 0),Z}(cs),hs=function(s){function Z(){var Z=null!==s&&s.apply(this,arguments)||this;return Z.types=new Y,Z}return o(Z,s),Z.encode=function(s){var o=s.constructor,t=new Z;t.rootType=o._typeid;var j=function(s,Z){for(var o in Z){var j=new Ws;j.name=o;var S=void 0;if("string"===typeof Z[o])S=Z[o];else{var a=Z[o],O=void 0;cs.is(a)?(S="ref",O=Z[o]):"string"===typeof a[S=Object.keys(a)[0]]?S+=":"+a[S]:O=a[S],j.referencedType=O?O._typeid:-1}j.type=S,s.fields.push(j)}t.types.push(s)},S=o._context.types;for(var a in S){var O=new qs;O.id=Number(a),j(O,S[a]._definition.schema)}return t.encodeAll()},Z.decode=function(s,t){var j=new F,S=new Z;S.decode(s,t);var a=S.types.reduce((function(s,Z){var t=function(s){function Z(){return null!==s&&s.apply(this,arguments)||this}return o(Z,s),Z}(cs),S=Z.id;return s[S]=t,j.add(t,S),s}),{});S.types.forEach((function(s){var Z=a[s.id];s.fields.forEach((function(s){var o;if(void 0!==s.referencedType){var t=s.type,S=a[s.referencedType];if(!S){var O=s.type.split(":");t=O[0],S=O[1]}"ref"===t?N(S,{context:j})(Z.prototype,s.name):N(((o={})[t]=S,o),{context:j})(Z.prototype,s.name)}else N(s.type,{context:j})(Z.prototype,s.name)}))}));var O=a[S.rootType],v=new O;for(var G in O._definition.schema){var B=O._definition.schema[G];"string"!==typeof B&&(v[G]="function"===typeof B?new B:new(U(Object.keys(B)[0]).constructor))}return v},t([N([qs],Xs)],Z.prototype,"types",void 0),t([N("number",Xs)],Z.prototype,"rootType",void 0),Z}(cs);d("map",{constructor:f}),d("array",{constructor:Y}),d("set",{constructor:is}),d("collection",{constructor:Fs}),s.ArraySchema=Y,s.CollectionSchema=Fs,s.Context=F,s.MapSchema=f,s.Reflection=hs,s.ReflectionField=Ws,s.ReflectionType=qs,s.Schema=cs,s.SchemaDefinition=u,s.SetSchema=is,s.decode=Hs,s.defineTypes=l,s.deprecated=g,s.dumpChanges=ws,s.encode=m,s.filter=L,s.filterChildren=V,s.hasFilter=H,s.registerType=d,s.type=N,Object.defineProperty(s,"__esModule",{value:!0})}(Z)},13169:s=>{"use strict";s.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13164:(s,Z,o)=>{var t=o(13169),j=o(13171),S=Object.hasOwnProperty,a=Object.create(null);for(var O in t)S.call(t,O)&&(a[t[O]]=O);var v=s.exports={to:{},get:{}};function G(s,Z,o){return Math.min(Math.max(Z,s),o)}function B(s){var Z=Math.round(s).toString(16).toUpperCase();return Z.length<2?"0"+Z:Z}v.get=function(s){var Z,o;switch(s.substring(0,3).toLowerCase()){case"hsl":Z=v.get.hsl(s),o="hsl";break;case"hwb":Z=v.get.hwb(s),o="hwb";break;default:Z=v.get.rgb(s),o="rgb"}return Z?{model:o,value:Z}:null},v.get.rgb=function(s){if(!s)return null;var Z,o,j,a=[0,0,0,1];if(Z=s.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(j=Z[2],Z=Z[1],o=0;o<3;o++){var O=2*o;a[o]=parseInt(Z.slice(O,O+2),16)}j&&(a[3]=parseInt(j,16)/255)}else if(Z=s.match(/^#([a-f0-9]{3,4})$/i)){for(j=(Z=Z[1])[3],o=0;o<3;o++)a[o]=parseInt(Z[o]+Z[o],16);j&&(a[3]=parseInt(j+j,16)/255)}else if(Z=s.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(o=0;o<3;o++)a[o]=parseInt(Z[o+1],0);Z[4]&&(Z[5]?a[3]=.01*parseFloat(Z[4]):a[3]=parseFloat(Z[4]))}else{if(!(Z=s.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(Z=s.match(/^(\w+)$/))?"transparent"===Z[1]?[0,0,0,0]:S.call(t,Z[1])?((a=t[Z[1]])[3]=1,a):null:null;for(o=0;o<3;o++)a[o]=Math.round(2.55*parseFloat(Z[o+1]));Z[4]&&(Z[5]?a[3]=.01*parseFloat(Z[4]):a[3]=parseFloat(Z[4]))}for(o=0;o<3;o++)a[o]=G(a[o],0,255);return a[3]=G(a[3],0,1),a},v.get.hsl=function(s){if(!s)return null;var Z=s.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Z){var o=parseFloat(Z[4]);return[(parseFloat(Z[1])%360+360)%360,G(parseFloat(Z[2]),0,100),G(parseFloat(Z[3]),0,100),G(isNaN(o)?1:o,0,1)]}return null},v.get.hwb=function(s){if(!s)return null;var Z=s.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Z){var o=parseFloat(Z[4]);return[(parseFloat(Z[1])%360+360)%360,G(parseFloat(Z[2]),0,100),G(parseFloat(Z[3]),0,100),G(isNaN(o)?1:o,0,1)]}return null},v.to.hex=function(){var s=j(arguments);return"#"+B(s[0])+B(s[1])+B(s[2])+(s[3]<1?B(Math.round(255*s[3])):"")},v.to.rgb=function(){var s=j(arguments);return s.length<4||1===s[3]?"rgb("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+")":"rgba("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+", "+s[3]+")"},v.to.rgb.percent=function(){var s=j(arguments),Z=Math.round(s[0]/255*100),o=Math.round(s[1]/255*100),t=Math.round(s[2]/255*100);return s.length<4||1===s[3]?"rgb("+Z+"%, "+o+"%, "+t+"%)":"rgba("+Z+"%, "+o+"%, "+t+"%, "+s[3]+")"},v.to.hsl=function(){var s=j(arguments);return s.length<4||1===s[3]?"hsl("+s[0]+", "+s[1]+"%, "+s[2]+"%)":"hsla("+s[0]+", "+s[1]+"%, "+s[2]+"%, "+s[3]+")"},v.to.hwb=function(){var s=j(arguments),Z="";return s.length>=4&&1!==s[3]&&(Z=", "+s[3]),"hwb("+s[0]+", "+s[1]+"%, "+s[2]+"%"+Z+")"},v.to.keyword=function(s){return a[s.slice(0,3)]}},13161:(s,Z,o)=>{const t=o(13164),j=o(13187),S=["keyword","gray","hex"],a={};for(const z of Object.keys(j))a[[...j[z].labels].sort().join("")]=z;const O={};function v(s,Z){if(!(this instanceof v))return new v(s,Z);if(Z&&Z in S&&(Z=null),Z&&!(Z in j))throw new Error("Unknown model: "+Z);let o,G;if(null==s)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(s instanceof v)this.model=s.model,this.color=[...s.color],this.valpha=s.valpha;else if("string"===typeof s){const Z=t.get(s);if(null===Z)throw new Error("Unable to parse color from string: "+s);this.model=Z.model,G=j[this.model].channels,this.color=Z.value.slice(0,G),this.valpha="number"===typeof Z.value[G]?Z.value[G]:1}else if(s.length>0){this.model=Z||"rgb",G=j[this.model].channels;const o=Array.prototype.slice.call(s,0,G);this.color=D(o,G),this.valpha="number"===typeof s[G]?s[G]:1}else if("number"===typeof s)this.model="rgb",this.color=[s>>16&255,s>>8&255,255&s],this.valpha=1;else{this.valpha=1;const Z=Object.keys(s);"alpha"in s&&(Z.splice(Z.indexOf("alpha"),1),this.valpha="number"===typeof s.alpha?s.alpha:0);const t=Z.sort().join("");if(!(t in a))throw new Error("Unable to parse color from object: "+JSON.stringify(s));this.model=a[t];const{labels:S}=j[this.model],O=[];for(o=0;o<S.length;o++)O.push(s[S[o]]);this.color=D(O)}if(O[this.model])for(G=j[this.model].channels,o=0;o<G;o++){const s=O[this.model][o];s&&(this.color[o]=s(this.color[o]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}v.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(s){let Z=this.model in t.to?this:this.rgb();Z=Z.round("number"===typeof s?s:1);const o=1===Z.valpha?Z.color:[...Z.color,this.valpha];return t.to[Z.model](o)},percentString(s){const Z=this.rgb().round("number"===typeof s?s:1),o=1===Z.valpha?Z.color:[...Z.color,this.valpha];return t.to.rgb.percent(o)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const s={},{channels:Z}=j[this.model],{labels:o}=j[this.model];for(let t=0;t<Z;t++)s[o[t]]=this.color[t];return 1!==this.valpha&&(s.alpha=this.valpha),s},unitArray(){const s=this.rgb().color;return s[0]/=255,s[1]/=255,s[2]/=255,1!==this.valpha&&s.push(this.valpha),s},unitObject(){const s=this.rgb().object();return s.r/=255,s.g/=255,s.b/=255,1!==this.valpha&&(s.alpha=this.valpha),s},round(s){return s=Math.max(s||0,0),new v([...this.color.map(G(s)),this.valpha],this.model)},alpha(s){return void 0!==s?new v([...this.color,Math.max(0,Math.min(1,s))],this.model):this.valpha},red:B("rgb",0,Q(255)),green:B("rgb",1,Q(255)),blue:B("rgb",2,Q(255)),hue:B(["hsl","hsv","hsl","hwb","hcg"],0,(s=>(s%360+360)%360)),saturationl:B("hsl",1,Q(100)),lightness:B("hsl",2,Q(100)),saturationv:B("hsv",1,Q(100)),value:B("hsv",2,Q(100)),chroma:B("hcg",1,Q(100)),gray:B("hcg",2,Q(100)),white:B("hwb",1,Q(100)),wblack:B("hwb",2,Q(100)),cyan:B("cmyk",0,Q(100)),magenta:B("cmyk",1,Q(100)),yellow:B("cmyk",2,Q(100)),black:B("cmyk",3,Q(100)),x:B("xyz",0,Q(95.047)),y:B("xyz",1,Q(100)),z:B("xyz",2,Q(108.833)),l:B("lab",0,Q(100)),a:B("lab",1),b:B("lab",2),keyword(s){return void 0!==s?new v(s):j[this.model].keyword(this.color)},hex(s){return void 0!==s?new v(s):t.to.hex(this.rgb().round().color)},hexa(s){if(void 0!==s)return new v(s);const Z=this.rgb().round().color;let o=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===o.length&&(o="0"+o),t.to.hex(Z)+o},rgbNumber(){const s=this.rgb().color;return(255&s[0])<<16|(255&s[1])<<8|255&s[2]},luminosity(){const s=this.rgb().color,Z=[];for(const[o,t]of s.entries()){const s=t/255;Z[o]=s<=.04045?s/12.92:((s+.055)/1.055)**2.4}return.2126*Z[0]+.7152*Z[1]+.0722*Z[2]},contrast(s){const Z=this.luminosity(),o=s.luminosity();return Z>o?(Z+.05)/(o+.05):(o+.05)/(Z+.05)},level(s){const Z=this.contrast(s);return Z>=7?"AAA":Z>=4.5?"AA":""},isDark(){const s=this.rgb().color;return(2126*s[0]+7152*s[1]+722*s[2])/1e4<128},isLight(){return!this.isDark()},negate(){const s=this.rgb();for(let Z=0;Z<3;Z++)s.color[Z]=255-s.color[Z];return s},lighten(s){const Z=this.hsl();return Z.color[2]+=Z.color[2]*s,Z},darken(s){const Z=this.hsl();return Z.color[2]-=Z.color[2]*s,Z},saturate(s){const Z=this.hsl();return Z.color[1]+=Z.color[1]*s,Z},desaturate(s){const Z=this.hsl();return Z.color[1]-=Z.color[1]*s,Z},whiten(s){const Z=this.hwb();return Z.color[1]+=Z.color[1]*s,Z},blacken(s){const Z=this.hwb();return Z.color[2]+=Z.color[2]*s,Z},grayscale(){const s=this.rgb().color,Z=.3*s[0]+.59*s[1]+.11*s[2];return v.rgb(Z,Z,Z)},fade(s){return this.alpha(this.valpha-this.valpha*s)},opaquer(s){return this.alpha(this.valpha+this.valpha*s)},rotate(s){const Z=this.hsl();let o=Z.color[0];return o=(o+s)%360,o=o<0?360+o:o,Z.color[0]=o,Z},mix(s,Z){if(!s||!s.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof s);const o=s.rgb(),t=this.rgb(),j=void 0===Z?.5:Z,S=2*j-1,a=o.alpha()-t.alpha(),O=((S*a===-1?S:(S+a)/(1+S*a))+1)/2,G=1-O;return v.rgb(O*o.red()+G*t.red(),O*o.green()+G*t.green(),O*o.blue()+G*t.blue(),o.alpha()*j+t.alpha()*(1-j))}};for(const z of Object.keys(j)){if(S.includes(z))continue;const{channels:s}=j[z];v.prototype[z]=function(){if(this.model===z)return new v(this);for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];return Z.length>0?new v(Z,z):new v([...(t=j[this.model][z].raw(this.color),Array.isArray(t)?t:[t]),this.valpha],z);var t},v[z]=function(){for(var Z=arguments.length,o=new Array(Z),t=0;t<Z;t++)o[t]=arguments[t];let j=o[0];return"number"===typeof j&&(j=D(o,s)),new v(j,z)}}function G(s){return function(Z){return function(s,Z){return Number(s.toFixed(Z))}(Z,s)}}function B(s,Z,o){s=Array.isArray(s)?s:[s];for(const t of s)(O[t]||(O[t]=[]))[Z]=o;return s=s[0],function(t){let j;return void 0!==t?(o&&(t=o(t)),j=this[s](),j.color[Z]=t,j):(j=this[s]().color[Z],o&&(j=o(j)),j)}}function Q(s){return function(Z){return Math.max(0,Math.min(s,Z))}}function D(s,Z){for(let o=0;o<Z;o++)"number"!==typeof s[o]&&(s[o]=0);return s}s.exports=v},13194:(s,Z,o)=>{const t=o(13199),j={};for(const a of Object.keys(t))j[t[a]]=a;const S={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};s.exports=S;for(const a of Object.keys(S)){if(!("channels"in S[a]))throw new Error("missing channels property: "+a);if(!("labels"in S[a]))throw new Error("missing channel labels property: "+a);if(S[a].labels.length!==S[a].channels)throw new Error("channel and label counts mismatch: "+a);const{channels:s,labels:Z}=S[a];delete S[a].channels,delete S[a].labels,Object.defineProperty(S[a],"channels",{value:s}),Object.defineProperty(S[a],"labels",{value:Z})}S.rgb.hsl=function(s){const Z=s[0]/255,o=s[1]/255,t=s[2]/255,j=Math.min(Z,o,t),S=Math.max(Z,o,t),a=S-j;let O,v;S===j?O=0:Z===S?O=(o-t)/a:o===S?O=2+(t-Z)/a:t===S&&(O=4+(Z-o)/a),O=Math.min(60*O,360),O<0&&(O+=360);const G=(j+S)/2;return v=S===j?0:G<=.5?a/(S+j):a/(2-S-j),[O,100*v,100*G]},S.rgb.hsv=function(s){let Z,o,t,j,S;const a=s[0]/255,O=s[1]/255,v=s[2]/255,G=Math.max(a,O,v),B=G-Math.min(a,O,v),Q=function(s){return(G-s)/6/B+.5};return 0===B?(j=0,S=0):(S=B/G,Z=Q(a),o=Q(O),t=Q(v),a===G?j=t-o:O===G?j=1/3+Z-t:v===G&&(j=2/3+o-Z),j<0?j+=1:j>1&&(j-=1)),[360*j,100*S,100*G]},S.rgb.hwb=function(s){const Z=s[0],o=s[1];let t=s[2];const j=S.rgb.hsl(s)[0],a=1/255*Math.min(Z,Math.min(o,t));return t=1-1/255*Math.max(Z,Math.max(o,t)),[j,100*a,100*t]},S.rgb.cmyk=function(s){const Z=s[0]/255,o=s[1]/255,t=s[2]/255,j=Math.min(1-Z,1-o,1-t);return[100*((1-Z-j)/(1-j)||0),100*((1-o-j)/(1-j)||0),100*((1-t-j)/(1-j)||0),100*j]},S.rgb.keyword=function(s){const Z=j[s];if(Z)return Z;let o,S=1/0;for(const j of Object.keys(t)){const Z=t[j],v=(O=Z,((a=s)[0]-O[0])**2+(a[1]-O[1])**2+(a[2]-O[2])**2);v<S&&(S=v,o=j)}var a,O;return o},S.keyword.rgb=function(s){return t[s]},S.rgb.xyz=function(s){let Z=s[0]/255,o=s[1]/255,t=s[2]/255;Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,t=t>.04045?((t+.055)/1.055)**2.4:t/12.92;return[100*(.4124*Z+.3576*o+.1805*t),100*(.2126*Z+.7152*o+.0722*t),100*(.0193*Z+.1192*o+.9505*t)]},S.rgb.lab=function(s){const Z=S.rgb.xyz(s);let o=Z[0],t=Z[1],j=Z[2];o/=95.047,t/=100,j/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,t=t>.008856?t**(1/3):7.787*t+16/116,j=j>.008856?j**(1/3):7.787*j+16/116;return[116*t-16,500*(o-t),200*(t-j)]},S.hsl.rgb=function(s){const Z=s[0]/360,o=s[1]/100,t=s[2]/100;let j,S,a;if(0===o)return a=255*t,[a,a,a];j=t<.5?t*(1+o):t+o-t*o;const O=2*t-j,v=[0,0,0];for(let G=0;G<3;G++)S=Z+1/3*-(G-1),S<0&&S++,S>1&&S--,a=6*S<1?O+6*(j-O)*S:2*S<1?j:3*S<2?O+(j-O)*(2/3-S)*6:O,v[G]=255*a;return v},S.hsl.hsv=function(s){const Z=s[0];let o=s[1]/100,t=s[2]/100,j=o;const S=Math.max(t,.01);t*=2,o*=t<=1?t:2-t,j*=S<=1?S:2-S;return[Z,100*(0===t?2*j/(S+j):2*o/(t+o)),100*((t+o)/2)]},S.hsv.rgb=function(s){const Z=s[0]/60,o=s[1]/100;let t=s[2]/100;const j=Math.floor(Z)%6,S=Z-Math.floor(Z),a=255*t*(1-o),O=255*t*(1-o*S),v=255*t*(1-o*(1-S));switch(t*=255,j){case 0:return[t,v,a];case 1:return[O,t,a];case 2:return[a,t,v];case 3:return[a,O,t];case 4:return[v,a,t];case 5:return[t,a,O]}},S.hsv.hsl=function(s){const Z=s[0],o=s[1]/100,t=s[2]/100,j=Math.max(t,.01);let S,a;a=(2-o)*t;const O=(2-o)*j;return S=o*j,S/=O<=1?O:2-O,S=S||0,a/=2,[Z,100*S,100*a]},S.hwb.rgb=function(s){const Z=s[0]/360;let o=s[1]/100,t=s[2]/100;const j=o+t;let S;j>1&&(o/=j,t/=j);const a=Math.floor(6*Z),O=1-t;S=6*Z-a,0!==(1&a)&&(S=1-S);const v=o+S*(O-o);let G,B,Q;switch(a){default:case 6:case 0:G=O,B=v,Q=o;break;case 1:G=v,B=O,Q=o;break;case 2:G=o,B=O,Q=v;break;case 3:G=o,B=v,Q=O;break;case 4:G=v,B=o,Q=O;break;case 5:G=O,B=o,Q=v}return[255*G,255*B,255*Q]},S.cmyk.rgb=function(s){const Z=s[0]/100,o=s[1]/100,t=s[2]/100,j=s[3]/100;return[255*(1-Math.min(1,Z*(1-j)+j)),255*(1-Math.min(1,o*(1-j)+j)),255*(1-Math.min(1,t*(1-j)+j))]},S.xyz.rgb=function(s){const Z=s[0]/100,o=s[1]/100,t=s[2]/100;let j,S,a;return j=3.2406*Z+-1.5372*o+-.4986*t,S=-.9689*Z+1.8758*o+.0415*t,a=.0557*Z+-.204*o+1.057*t,j=j>.0031308?1.055*j**(1/2.4)-.055:12.92*j,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,j=Math.min(Math.max(0,j),1),S=Math.min(Math.max(0,S),1),a=Math.min(Math.max(0,a),1),[255*j,255*S,255*a]},S.xyz.lab=function(s){let Z=s[0],o=s[1],t=s[2];Z/=95.047,o/=100,t/=108.883,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*o-16,500*(Z-o),200*(o-t)]},S.lab.xyz=function(s){let Z,o,t;o=(s[0]+16)/116,Z=s[1]/500+o,t=o-s[2]/200;const j=o**3,S=Z**3,a=t**3;return o=j>.008856?j:(o-16/116)/7.787,Z=S>.008856?S:(Z-16/116)/7.787,t=a>.008856?a:(t-16/116)/7.787,Z*=95.047,o*=100,t*=108.883,[Z,o,t]},S.lab.lch=function(s){const Z=s[0],o=s[1],t=s[2];let j;j=360*Math.atan2(t,o)/2/Math.PI,j<0&&(j+=360);return[Z,Math.sqrt(o*o+t*t),j]},S.lch.lab=function(s){const Z=s[0],o=s[1],t=s[2]/360*2*Math.PI;return[Z,o*Math.cos(t),o*Math.sin(t)]},S.rgb.ansi16=function(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[o,t,j]=s;let a=null===Z?S.rgb.hsv(s)[2]:Z;if(a=Math.round(a/50),0===a)return 30;let O=30+(Math.round(j/255)<<2|Math.round(t/255)<<1|Math.round(o/255));return 2===a&&(O+=60),O},S.hsv.ansi16=function(s){return S.rgb.ansi16(S.hsv.rgb(s),s[2])},S.rgb.ansi256=function(s){const Z=s[0],o=s[1],t=s[2];if(Z===o&&o===t)return Z<8?16:Z>248?231:Math.round((Z-8)/247*24)+232;return 16+36*Math.round(Z/255*5)+6*Math.round(o/255*5)+Math.round(t/255*5)},S.ansi16.rgb=function(s){let Z=s%10;if(0===Z||7===Z)return s>50&&(Z+=3.5),Z=Z/10.5*255,[Z,Z,Z];const o=.5*(1+~~(s>50));return[(1&Z)*o*255,(Z>>1&1)*o*255,(Z>>2&1)*o*255]},S.ansi256.rgb=function(s){if(s>=232){const Z=10*(s-232)+8;return[Z,Z,Z]}let Z;s-=16;return[Math.floor(s/36)/5*255,Math.floor((Z=s%36)/6)/5*255,Z%6/5*255]},S.rgb.hex=function(s){const Z=(((255&Math.round(s[0]))<<16)+((255&Math.round(s[1]))<<8)+(255&Math.round(s[2]))).toString(16).toUpperCase();return"000000".substring(Z.length)+Z},S.hex.rgb=function(s){const Z=s.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!Z)return[0,0,0];let o=Z[0];3===Z[0].length&&(o=o.split("").map((s=>s+s)).join(""));const t=parseInt(o,16);return[t>>16&255,t>>8&255,255&t]},S.rgb.hcg=function(s){const Z=s[0]/255,o=s[1]/255,t=s[2]/255,j=Math.max(Math.max(Z,o),t),S=Math.min(Math.min(Z,o),t),a=j-S;let O,v;return O=a<1?S/(1-a):0,v=a<=0?0:j===Z?(o-t)/a%6:j===o?2+(t-Z)/a:4+(Z-o)/a,v/=6,v%=1,[360*v,100*a,100*O]},S.hsl.hcg=function(s){const Z=s[1]/100,o=s[2]/100,t=o<.5?2*Z*o:2*Z*(1-o);let j=0;return t<1&&(j=(o-.5*t)/(1-t)),[s[0],100*t,100*j]},S.hsv.hcg=function(s){const Z=s[1]/100,o=s[2]/100,t=Z*o;let j=0;return t<1&&(j=(o-t)/(1-t)),[s[0],100*t,100*j]},S.hcg.rgb=function(s){const Z=s[0]/360,o=s[1]/100,t=s[2]/100;if(0===o)return[255*t,255*t,255*t];const j=[0,0,0],S=Z%1*6,a=S%1,O=1-a;let v=0;switch(Math.floor(S)){case 0:j[0]=1,j[1]=a,j[2]=0;break;case 1:j[0]=O,j[1]=1,j[2]=0;break;case 2:j[0]=0,j[1]=1,j[2]=a;break;case 3:j[0]=0,j[1]=O,j[2]=1;break;case 4:j[0]=a,j[1]=0,j[2]=1;break;default:j[0]=1,j[1]=0,j[2]=O}return v=(1-o)*t,[255*(o*j[0]+v),255*(o*j[1]+v),255*(o*j[2]+v)]},S.hcg.hsv=function(s){const Z=s[1]/100,o=Z+s[2]/100*(1-Z);let t=0;return o>0&&(t=Z/o),[s[0],100*t,100*o]},S.hcg.hsl=function(s){const Z=s[1]/100,o=s[2]/100*(1-Z)+.5*Z;let t=0;return o>0&&o<.5?t=Z/(2*o):o>=.5&&o<1&&(t=Z/(2*(1-o))),[s[0],100*t,100*o]},S.hcg.hwb=function(s){const Z=s[1]/100,o=Z+s[2]/100*(1-Z);return[s[0],100*(o-Z),100*(1-o)]},S.hwb.hcg=function(s){const Z=s[1]/100,o=1-s[2]/100,t=o-Z;let j=0;return t<1&&(j=(o-t)/(1-t)),[s[0],100*t,100*j]},S.apple.rgb=function(s){return[s[0]/65535*255,s[1]/65535*255,s[2]/65535*255]},S.rgb.apple=function(s){return[s[0]/255*65535,s[1]/255*65535,s[2]/255*65535]},S.gray.rgb=function(s){return[s[0]/100*255,s[0]/100*255,s[0]/100*255]},S.gray.hsl=function(s){return[0,0,s[0]]},S.gray.hsv=S.gray.hsl,S.gray.hwb=function(s){return[0,100,s[0]]},S.gray.cmyk=function(s){return[0,0,0,s[0]]},S.gray.lab=function(s){return[s[0],0,0]},S.gray.hex=function(s){const Z=255&Math.round(s[0]/100*255),o=((Z<<16)+(Z<<8)+Z).toString(16).toUpperCase();return"000000".substring(o.length)+o},S.rgb.gray=function(s){return[(s[0]+s[1]+s[2])/3/255*100]}},13187:(s,Z,o)=>{const t=o(13194),j=o(13204),S={};Object.keys(t).forEach((s=>{S[s]={},Object.defineProperty(S[s],"channels",{value:t[s].channels}),Object.defineProperty(S[s],"labels",{value:t[s].labels});const Z=j(s);Object.keys(Z).forEach((o=>{const t=Z[o];S[s][o]=function(s){const Z=function(){for(var Z=arguments.length,o=new Array(Z),t=0;t<Z;t++)o[t]=arguments[t];const j=o[0];if(void 0===j||null===j)return j;j.length>1&&(o=j);const S=s(o);if("object"===typeof S)for(let s=S.length,a=0;a<s;a++)S[a]=Math.round(S[a]);return S};return"conversion"in s&&(Z.conversion=s.conversion),Z}(t),S[s][o].raw=function(s){const Z=function(){for(var Z=arguments.length,o=new Array(Z),t=0;t<Z;t++)o[t]=arguments[t];const j=o[0];return void 0===j||null===j?j:(j.length>1&&(o=j),s(o))};return"conversion"in s&&(Z.conversion=s.conversion),Z}(t)}))})),s.exports=S},13204:(s,Z,o)=>{const t=o(13194);function j(s){const Z=function(){const s={},Z=Object.keys(t);for(let o=Z.length,t=0;t<o;t++)s[Z[t]]={distance:-1,parent:null};return s}(),o=[s];for(Z[s].distance=0;o.length;){const s=o.pop(),j=Object.keys(t[s]);for(let t=j.length,S=0;S<t;S++){const t=j[S],a=Z[t];-1===a.distance&&(a.distance=Z[s].distance+1,a.parent=s,o.unshift(t))}}return Z}function S(s,Z){return function(o){return Z(s(o))}}function a(s,Z){const o=[Z[s].parent,s];let j=t[Z[s].parent][s],a=Z[s].parent;for(;Z[a].parent;)o.unshift(Z[a].parent),j=S(t[Z[a].parent][a],j),a=Z[a].parent;return j.conversion=o,j}s.exports=function(s){const Z=j(s),o={},t=Object.keys(Z);for(let j=t.length,S=0;S<j;S++){const s=t[S];null!==Z[s].parent&&(o[s]=a(s,Z))}return o}},13199:s=>{"use strict";s.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11780:function(s,Z,o){"use strict";var t=this&&this.__createBinding||(Object.create?function(s,Z,o,t){void 0===t&&(t=o);var j=Object.getOwnPropertyDescriptor(Z,o);j&&!("get"in j?!Z.__esModule:j.writable||j.configurable)||(j={enumerable:!0,get:function(){return Z[o]}}),Object.defineProperty(s,t,j)}:function(s,Z,o,t){void 0===t&&(t=o),s[t]=Z[o]}),j=this&&this.__setModuleDefault||(Object.create?function(s,Z){Object.defineProperty(s,"default",{enumerable:!0,value:Z})}:function(s,Z){s.default=Z}),S=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var Z={};if(null!=s)for(var o in s)"default"!==o&&Object.prototype.hasOwnProperty.call(s,o)&&t(Z,s,o);return j(Z,s),Z},a=this&&this.__awaiter||function(s,Z,o,t){return new(o||(o=Promise))((function(j,S){function a(s){try{v(t.next(s))}catch(Z){S(Z)}}function O(s){try{v(t.throw(s))}catch(Z){S(Z)}}function v(s){var Z;s.done?j(s.value):(Z=s.value,Z instanceof o?Z:new o((function(s){s(Z)}))).then(a,O)}v((t=t.apply(s,Z||[])).next())}))};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Auth=Z.Platform=void 0;const O=S(o(11712)),v=o(11787),G="colyseus-auth-token";!function(s){s.ios="ios",s.android="android"}(Z.Platform||(Z.Platform={}));Z.Auth=class{constructor(s){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=s.replace("ws","http"),(0,v.getItem)(G,(s=>this.token=s))}get hasToken(){return!!this.token}login(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,void 0,void 0,(function*(){const Z=Object.assign({},s);this.hasToken&&(Z.token=this.token);const o=yield this.request("post","/auth",Z);this.token=o.token,(0,v.setItem)(G,this.token);for(let s in o)this.hasOwnProperty(s)&&(this[s]=o[s]);return this.registerPingService(),this}))}save(){return a(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return a(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return a(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return a(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(s){return a(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:s})}))}acceptFriendRequest(s){return a(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:s})}))}declineFriendRequest(s){return a(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:s})}))}blockUser(s){return a(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:s})}))}unblockUser(s){return a(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:s})}))}request(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return a(this,void 0,void 0,(function*(){j.Accept="application/json",this.hasToken&&(j.Authorization="Bearer "+this.token);const S=[];for(const s in o)S.push(`${s}=${o[s]}`);const a=S.length>0?`?${S.join("&")}`:"",v={headers:j};return t&&(v.body=t),(yield O[s](`${this.endpoint}${Z}${a}`,v)).data}))}logout(){this.token=void 0,(0,v.removeItem)(G),this.unregisterPingService()}registerPingService(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),s)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11704:function(s,Z,o){"use strict";var t,j=this&&this.__awaiter||function(s,Z,o,t){return new(o||(o=Promise))((function(j,S){function a(s){try{v(t.next(s))}catch(Z){S(Z)}}function O(s){try{v(t.throw(s))}catch(Z){S(Z)}}function v(s){var Z;s.done?j(s.value):(Z=s.value,Z instanceof o?Z:new o((function(s){s(Z)}))).then(a,O)}v((t=t.apply(s,Z||[])).next())}))};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Client=Z.MatchMakeError=void 0;const S=o(11712),a=o(11714),O=o(11720);class v extends Error{constructor(s,Z){super(s),this.code=Z,Object.setPrototypeOf(this,v.prototype)}}Z.MatchMakeError=v;const G="undefined"!==typeof window&&"undefined"!==typeof(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";Z.Client=class{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G;if("string"===typeof s){const Z=new URL(s),o="https:"===Z.protocol||"wss:"===Z.protocol,t=Number(Z.port||(o?443:80));this.settings={hostname:Z.hostname,pathname:"/"!==Z.pathname?Z.pathname:"",port:t,secure:o}}else void 0===s.port&&(s.port=s.secure?443:80),void 0===s.pathname&&(s.pathname=""),this.settings=s}joinOrCreate(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return j(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",s,Z,o)}))}create(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return j(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",s,Z,o)}))}join(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return j(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",s,Z,o)}))}joinById(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return j(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",s,Z,o)}))}reconnect(s,Z){return j(this,void 0,void 0,(function*(){if("string"===typeof s&&"string"===typeof Z)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[o,t]=s.split(":");return yield this.createMatchMakeRequest("reconnect",o,{reconnectionToken:t},Z)}))}getAvailableRooms(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return j(this,void 0,void 0,(function*(){return(yield(0,S.get)(this.getHttpEndpoint(`${s}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(s,Z,o){return j(this,void 0,void 0,(function*(){const t=this.createRoom(s.room.name,Z);t.roomId=s.room.roomId,t.sessionId=s.sessionId;const S={sessionId:t.sessionId};s.reconnectionToken&&(S.reconnectionToken=s.reconnectionToken);const O=o||t;return t.connect(this.buildEndpoint(s.room,S),s.devMode&&(()=>j(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${t.roomId}'...`);let o=0;const S=()=>j(this,void 0,void 0,(function*(){o++;try{yield this.consumeSeatReservation(s,Z,O),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${t.roomId}'`)}catch(j){o<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${o} out of 8)`),setTimeout(S,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(S,2e3)}))),O),new Promise(((s,Z)=>{const o=(s,o)=>Z(new a.ServerError(s,o));O.onError.once(o),O.onJoin.once((()=>{O.onError.remove(o),s(O)}))}))}))}createMatchMakeRequest(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return j(this,void 0,void 0,(function*(){const j=(yield(0,S.post)(this.getHttpEndpoint(`${s}/${Z}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(o)})).data;if(j.error)throw new v(j.error,j.code);return"reconnect"===s&&(j.reconnectionToken=o.reconnectionToken),yield this.consumeSeatReservation(j,t,a)}))}createRoom(s,Z){return new O.Room(s,Z)}buildEndpoint(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[];for(const j in Z)Z.hasOwnProperty(j)&&o.push(`${j}=${Z[j]}`);let t=this.settings.secure?"wss://":"ws://";return s.publicAddress?t+=`${s.publicAddress}`:t+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${t}/${s.processId}/${s.roomId}?${o.join("&")}`}getHttpEndpoint(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${s}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11735:(s,Z,o)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Connection=void 0;const t=o(11741);Z.Connection=class{constructor(){this.events={},this.transport=new t.WebSocketTransport(this.events)}send(s){this.transport.send(s)}connect(s){this.transport.connect(s)}close(s,Z){this.transport.close(s,Z)}get isOpen(){return this.transport.isOpen}}},11755:(s,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.utf8Length=Z.utf8Read=Z.ErrorCode=Z.Protocol=void 0,function(s){s[s.HANDSHAKE=9]="HANDSHAKE",s[s.JOIN_ROOM=10]="JOIN_ROOM",s[s.ERROR=11]="ERROR",s[s.LEAVE_ROOM=12]="LEAVE_ROOM",s[s.ROOM_DATA=13]="ROOM_DATA",s[s.ROOM_STATE=14]="ROOM_STATE",s[s.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",s[s.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",s[s.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(Z.Protocol||(Z.Protocol={})),function(s){s[s.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",s[s.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",s[s.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",s[s.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",s[s.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",s[s.AUTH_FAILED=4215]="AUTH_FAILED",s[s.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(Z.ErrorCode||(Z.ErrorCode={})),Z.utf8Read=function(s,Z){const o=s[Z++];for(var t="",j=0,S=Z,a=Z+o;S<a;S++){var O=s[S];if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(j=(7&O)<<18|(63&s[++S])<<12|(63&s[++S])<<6|63&s[++S])>=65536?(j-=65536,t+=String.fromCharCode(55296+(j>>>10),56320+(1023&j))):t+=String.fromCharCode(j)}else t+=String.fromCharCode((15&O)<<12|(63&s[++S])<<6|63&s[++S]);else t+=String.fromCharCode((31&O)<<6|63&s[++S]);else t+=String.fromCharCode(O)}return t},Z.utf8Length=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Z=0,o=0;for(let t=0,j=s.length;t<j;t++)Z=s.charCodeAt(t),Z<128?o+=1:Z<2048?o+=2:Z<55296||Z>=57344?o+=3:(t++,o+=4);return o+1}},11720:function(s,Z,o){"use strict";var t=this&&this.__createBinding||(Object.create?function(s,Z,o,t){void 0===t&&(t=o);var j=Object.getOwnPropertyDescriptor(Z,o);j&&!("get"in j?!Z.__esModule:j.writable||j.configurable)||(j={enumerable:!0,get:function(){return Z[o]}}),Object.defineProperty(s,t,j)}:function(s,Z,o,t){void 0===t&&(t=o),s[t]=Z[o]}),j=this&&this.__setModuleDefault||(Object.create?function(s,Z){Object.defineProperty(s,"default",{enumerable:!0,value:Z})}:function(s,Z){s.default=Z}),S=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var Z={};if(null!=s)for(var o in s)"default"!==o&&Object.prototype.hasOwnProperty.call(s,o)&&t(Z,s,o);return j(Z,s),Z};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Room=void 0;const a=S(o(11726)),O=o(11735),v=o(11755),G=o(11757),B=o(11765),Q=o(11771),D=o(11777),z=o(11714);class Y{constructor(s,Z){this.onStateChange=(0,Q.createSignal)(),this.onError=(0,Q.createSignal)(),this.onLeave=(0,Q.createSignal)(),this.onJoin=(0,Q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,B.createNanoEvents)(),this.roomId=null,this.name=s,Z&&(this.serializer=new((0,G.getSerializer)("schema")),this.rootSchema=Z,this.serializer.state=new Z),this.onError(((s,Z)=>{var o;return null===(o=console.warn)||void 0===o?void 0:o.call(console,`colyseus.js - onError => (${s}) ${Z}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const t=new O.Connection;o.connection=t,t.events.onmessage=Y.prototype.onMessageCallback.bind(o),t.events.onclose=function(s){var t;if(!o.hasJoined)return null===(t=console.warn)||void 0===t||t.call(console,`Room connection was closed unexpectedly (${s.code}): ${s.reason}`),void o.onError.invoke(s.code,s.reason);s.code===z.CloseCode.DEVMODE_RESTART&&Z?Z():(o.onLeave.invoke(s.code),o.destroy())},t.events.onerror=function(s){var Z;null===(Z=console.warn)||void 0===Z||Z.call(console,`Room, onError (${s.code}): ${s.reason}`),o.onError.invoke(s.code,s.reason)},t.connect(s)}leave(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((Z=>{this.onLeave((s=>Z(s))),this.connection?s?this.connection.send([v.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(z.CloseCode.CONSENTED)}))}onMessage(s,Z){return this.onMessageHandlers.on(this.getMessageHandlerKey(s),Z)}send(s,Z){const o=[v.Protocol.ROOM_DATA];let t;if("string"===typeof s?D.encode.string(o,s):D.encode.number(o,s),void 0!==Z){const s=a.encode(Z);t=new Uint8Array(o.length+s.byteLength),t.set(new Uint8Array(o),0),t.set(new Uint8Array(s),o.length)}else t=new Uint8Array(o);this.connection.send(t.buffer)}sendBytes(s,Z){const o=[v.Protocol.ROOM_DATA_BYTES];let t;"string"===typeof s?D.encode.string(o,s):D.encode.number(o,s),t=new Uint8Array(o.length+(Z.byteLength||Z.length)),t.set(new Uint8Array(o),0),t.set(new Uint8Array(Z),o.length),this.connection.send(t.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(s){const Z=Array.from(new Uint8Array(s.data)),o=Z[0];if(o===v.Protocol.JOIN_ROOM){let s=1;const o=(0,v.utf8Read)(Z,s);if(s+=(0,v.utf8Length)(o),this.serializerId=(0,v.utf8Read)(Z,s),s+=(0,v.utf8Length)(this.serializerId),!this.serializer){const s=(0,G.getSerializer)(this.serializerId);this.serializer=new s}Z.length>s&&this.serializer.handshake&&this.serializer.handshake(Z,{offset:s}),this.reconnectionToken=`${this.roomId}:${o}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([v.Protocol.JOIN_ROOM])}else if(o===v.Protocol.ERROR){const s={offset:1},o=D.decode.number(Z,s),t=D.decode.string(Z,s);this.onError.invoke(o,t)}else if(o===v.Protocol.LEAVE_ROOM)this.leave();else if(o===v.Protocol.ROOM_DATA_SCHEMA){const s={offset:1},o=this.serializer.getState().constructor._context.get(D.decode.number(Z,s)),t=new o;t.decode(Z,s),this.dispatchMessage(o,t)}else if(o===v.Protocol.ROOM_STATE)Z.shift(),this.setState(Z);else if(o===v.Protocol.ROOM_STATE_PATCH)Z.shift(),this.patch(Z);else if(o===v.Protocol.ROOM_DATA){const o={offset:1},t=D.decode.stringCheck(Z,o)?D.decode.string(Z,o):D.decode.number(Z,o),j=Z.length>o.offset?a.decode(s.data,o.offset):void 0;this.dispatchMessage(t,j)}else if(o===v.Protocol.ROOM_DATA_BYTES){const s={offset:1},o=D.decode.stringCheck(Z,s)?D.decode.string(Z,s):D.decode.number(Z,s);this.dispatchMessage(o,new Uint8Array(Z.slice(s.offset)))}}setState(s){this.serializer.setState(s),this.onStateChange.invoke(this.serializer.getState())}patch(s){this.serializer.patch(s),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(s,Z){var o;const t=this.getMessageHandlerKey(s);this.onMessageHandlers.events[t]?this.onMessageHandlers.emit(t,Z):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",s,Z):null===(o=console.warn)||void 0===o||o.call(console,`colyseus.js: onMessage() not registered for type '${s}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(s){switch(typeof s){case"function":return`$${s._typeid}`;case"string":return s;case"number":return`i${s}`;default:throw new Error("invalid message type.")}}}Z.Room=Y},11787:(s,Z)=>{"use strict";let o;function t(){return o||(o="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(s,Z){this.cache[s]=Z},getItem:function(s){this.cache[s]},removeItem:function(s){delete this.cache[s]}}),o}Object.defineProperty(Z,"__esModule",{value:!0}),Z.getItem=Z.removeItem=Z.setItem=void 0,Z.setItem=function(s,Z){t().setItem(s,Z)},Z.removeItem=function(s){t().removeItem(s)},Z.getItem=function(s,Z){const o=t().getItem(s);"undefined"!==typeof Promise&&o instanceof Promise?o.then((s=>Z(s))):Z(o)}},11765:(s,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.createNanoEvents=void 0;Z.createNanoEvents=()=>({emit(s){let Z=this.events[s]||[];for(var o=arguments.length,t=new Array(o>1?o-1:0),j=1;j<o;j++)t[j-1]=arguments[j];for(let S=0,a=Z.length;S<a;S++)Z[S](...t)},events:{},on(s,Z){var o;return(null===(o=this.events[s])||void 0===o?void 0:o.push(Z))||(this.events[s]=[Z]),()=>{var o;this.events[s]=null===(o=this.events[s])||void 0===o?void 0:o.filter((s=>Z!==s))}}})},11771:(s,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.createSignal=Z.EventEmitter=void 0;class o{constructor(){this.handlers=[]}register(s){return this.handlers.push(s),this}invoke(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];this.handlers.forEach((s=>s.apply(this,Z)))}invokeAsync(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];return Promise.all(this.handlers.map((s=>s.apply(this,Z))))}remove(s){const Z=this.handlers.indexOf(s);this.handlers[Z]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}Z.EventEmitter=o,Z.createSignal=function(){const s=new o;function Z(Z){return s.register(Z,null===this)}return Z.once=Z=>{const o=function(){for(var t=arguments.length,j=new Array(t),S=0;S<t;S++)j[S]=arguments[S];Z.apply(this,j),s.remove(o)};s.register(o)},Z.remove=Z=>s.remove(Z),Z.invoke=function(){return s.invoke(...arguments)},Z.invokeAsync=function(){return s.invokeAsync(...arguments)},Z.clear=()=>s.clear(),Z}},11714:(s,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.ServerError=Z.CloseCode=void 0,function(s){s[s.CONSENTED=4e3]="CONSENTED",s[s.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(Z.CloseCode||(Z.CloseCode={}));class o extends Error{constructor(s,Z){super(Z),this.name="ServerError",this.code=s}}Z.ServerError=o},11696:(s,Z,o)=>{"use strict";Z.d=void 0,o(11699);var t=o(11704);Object.defineProperty(Z,"d",{enumerable:!0,get:function(){return t.Client}});var j=o(11755);var S=o(11720);var a=o(11780);const O=o(11795);const v=o(11801),G=o(11757);(0,G.registerSerializer)("schema",O.SchemaSerializer),(0,G.registerSerializer)("none",v.NoneSerializer)},11699:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=s=>null!==s&&"object"===typeof s&&s.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11726:(s,Z)=>{"use strict";function o(s,Z){if(this._offset=Z,s instanceof ArrayBuffer)this._buffer=s,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(s))throw new Error("Invalid argument");this._buffer=s.buffer,this._view=new DataView(this._buffer,s.byteOffset,s.byteLength)}}Object.defineProperty(Z,"__esModule",{value:!0}),Z.decode=Z.encode=void 0,o.prototype._array=function(s){for(var Z=new Array(s),o=0;o<s;o++)Z[o]=this._parse();return Z},o.prototype._map=function(s){for(var Z={},o=0;o<s;o++)Z[this._parse()]=this._parse();return Z},o.prototype._str=function(s){var Z=function(s,Z,o){for(var t="",j=0,S=Z,a=Z+o;S<a;S++){var O=s.getUint8(S);if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(j=(7&O)<<18|(63&s.getUint8(++S))<<12|(63&s.getUint8(++S))<<6|63&s.getUint8(++S))>=65536?(j-=65536,t+=String.fromCharCode(55296+(j>>>10),56320+(1023&j))):t+=String.fromCharCode(j)}else t+=String.fromCharCode((15&O)<<12|(63&s.getUint8(++S))<<6|63&s.getUint8(++S));else t+=String.fromCharCode((31&O)<<6|63&s.getUint8(++S));else t+=String.fromCharCode(O)}return t}(this._view,this._offset,s);return this._offset+=s,Z},o.prototype._bin=function(s){var Z=this._buffer.slice(this._offset,this._offset+s);return this._offset+=s,Z},o.prototype._parse=function(){var s,Z=this._view.getUint8(this._offset++),o=0,t=0,j=0,S=0;if(Z<192)return Z<128?Z:Z<144?this._map(15&Z):Z<160?this._array(15&Z):this._str(31&Z);if(Z>223)return-1*(255-Z+1);switch(Z){case 192:return null;case 194:return!1;case 195:return!0;case 196:return o=this._view.getUint8(this._offset),this._offset+=1,this._bin(o);case 197:return o=this._view.getUint16(this._offset),this._offset+=2,this._bin(o);case 198:return o=this._view.getUint32(this._offset),this._offset+=4,this._bin(o);case 199:if(o=this._view.getUint8(this._offset),t=this._view.getInt8(this._offset+1),this._offset+=2,-1===t){var a=this._view.getUint32(this._offset);return j=this._view.getInt32(this._offset+4),S=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*j+S)+a/1e6)}return[t,this._bin(o)];case 200:return o=this._view.getUint16(this._offset),t=this._view.getInt8(this._offset+2),this._offset+=3,[t,this._bin(o)];case 201:return o=this._view.getUint32(this._offset),t=this._view.getInt8(this._offset+4),this._offset+=5,[t,this._bin(o)];case 202:return s=this._view.getFloat32(this._offset),this._offset+=4,s;case 203:return s=this._view.getFloat64(this._offset),this._offset+=8,s;case 204:return s=this._view.getUint8(this._offset),this._offset+=1,s;case 205:return s=this._view.getUint16(this._offset),this._offset+=2,s;case 206:return s=this._view.getUint32(this._offset),this._offset+=4,s;case 207:return j=this._view.getUint32(this._offset)*Math.pow(2,32),S=this._view.getUint32(this._offset+4),this._offset+=8,j+S;case 208:return s=this._view.getInt8(this._offset),this._offset+=1,s;case 209:return s=this._view.getInt16(this._offset),this._offset+=2,s;case 210:return s=this._view.getInt32(this._offset),this._offset+=4,s;case 211:return j=this._view.getInt32(this._offset)*Math.pow(2,32),S=this._view.getUint32(this._offset+4),this._offset+=8,j+S;case 212:return t=this._view.getInt8(this._offset),this._offset+=1,0===t?void(this._offset+=1):[t,this._bin(1)];case 213:return t=this._view.getInt8(this._offset),this._offset+=1,[t,this._bin(2)];case 214:return t=this._view.getInt8(this._offset),this._offset+=1,-1===t?(s=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*s)):[t,this._bin(4)];case 215:return t=this._view.getInt8(this._offset),this._offset+=1,0===t?(j=this._view.getInt32(this._offset)*Math.pow(2,32),S=this._view.getUint32(this._offset+4),this._offset+=8,new Date(j+S)):-1===t?(j=this._view.getUint32(this._offset),S=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&j)+S)+(j>>>2)/1e6)):[t,this._bin(8)];case 216:return t=this._view.getInt8(this._offset),this._offset+=1,[t,this._bin(16)];case 217:return o=this._view.getUint8(this._offset),this._offset+=1,this._str(o);case 218:return o=this._view.getUint16(this._offset),this._offset+=2,this._str(o);case 219:return o=this._view.getUint32(this._offset),this._offset+=4,this._str(o);case 220:return o=this._view.getUint16(this._offset),this._offset+=2,this._array(o);case 221:return o=this._view.getUint32(this._offset),this._offset+=4,this._array(o);case 222:return o=this._view.getUint16(this._offset),this._offset+=2,this._map(o);case 223:return o=this._view.getUint32(this._offset),this._offset+=4,this._map(o)}throw new Error("Could not parse")},Z.decode=function(s){var Z=new o(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),t=Z._parse();if(Z._offset!==s.byteLength)throw new Error(s.byteLength-Z._offset+" trailing bytes");return t};function t(s,Z,o){for(var t=0,j=0,S=o.length;j<S;j++)(t=o.charCodeAt(j))<128?s.setUint8(Z++,t):t<2048?(s.setUint8(Z++,192|t>>6),s.setUint8(Z++,128|63&t)):t<55296||t>=57344?(s.setUint8(Z++,224|t>>12),s.setUint8(Z++,128|t>>6&63),s.setUint8(Z++,128|63&t)):(j++,t=65536+((1023&t)<<10|1023&o.charCodeAt(j)),s.setUint8(Z++,240|t>>18),s.setUint8(Z++,128|t>>12&63),s.setUint8(Z++,128|t>>6&63),s.setUint8(Z++,128|63&t))}function j(s,Z,o){var t=typeof o,S=0,a=0,O=0,v=0,G=0,B=0;if("string"===t){if(G=function(s){for(var Z=0,o=0,t=0,j=s.length;t<j;t++)(Z=s.charCodeAt(t))<128?o+=1:Z<2048?o+=2:Z<55296||Z>=57344?o+=3:(t++,o+=4);return o}(o),G<32)s.push(160|G),B=1;else if(G<256)s.push(217,G),B=2;else if(G<65536)s.push(218,G>>8,G),B=3;else{if(!(G<4294967296))throw new Error("String too long");s.push(219,G>>24,G>>16,G>>8,G),B=5}return Z.push({_str:o,_length:G,_offset:s.length}),B+G}if("number"===t)return Math.floor(o)===o&&isFinite(o)?o>=0?o<128?(s.push(o),1):o<256?(s.push(204,o),2):o<65536?(s.push(205,o>>8,o),3):o<4294967296?(s.push(206,o>>24,o>>16,o>>8,o),5):(O=o/Math.pow(2,32)|0,v=o>>>0,s.push(207,O>>24,O>>16,O>>8,O,v>>24,v>>16,v>>8,v),9):o>=-32?(s.push(o),1):o>=-128?(s.push(208,o),2):o>=-32768?(s.push(209,o>>8,o),3):o>=-2147483648?(s.push(210,o>>24,o>>16,o>>8,o),5):(O=Math.floor(o/Math.pow(2,32)),v=o>>>0,s.push(211,O>>24,O>>16,O>>8,O,v>>24,v>>16,v>>8,v),9):(s.push(203),Z.push({_float:o,_length:8,_offset:s.length}),9);if("object"===t){if(null===o)return s.push(192),1;if(Array.isArray(o)){if((G=o.length)<16)s.push(144|G),B=1;else if(G<65536)s.push(220,G>>8,G),B=3;else{if(!(G<4294967296))throw new Error("Array too large");s.push(221,G>>24,G>>16,G>>8,G),B=5}for(S=0;S<G;S++)B+=j(s,Z,o[S]);return B}if(o instanceof Date){var Q=o.getTime(),D=Math.floor(Q/1e3),z=1e6*(Q-1e3*D);return D>=0&&z>=0&&D<=17179869183?0===z&&D<=4294967295?(s.push(214,255,D>>24,D>>16,D>>8,D),6):(O=D/4294967296,v=4294967295&D,s.push(215,255,z>>22,z>>14,z>>6,O,v>>24,v>>16,v>>8,v),10):(O=Math.floor(D/4294967296),v=D>>>0,s.push(199,12,255,z>>24,z>>16,z>>8,z,O>>24,O>>16,O>>8,O,v>>24,v>>16,v>>8,v),15)}if(o instanceof ArrayBuffer){if((G=o.byteLength)<256)s.push(196,G),B=2;else if(G<65536)s.push(197,G>>8,G),B=3;else{if(!(G<4294967296))throw new Error("Buffer too large");s.push(198,G>>24,G>>16,G>>8,G),B=5}return Z.push({_bin:o,_length:G,_offset:s.length}),B+G}if("function"===typeof o.toJSON)return j(s,Z,o.toJSON());var Y=[],b="",f=Object.keys(o);for(S=0,a=f.length;S<a;S++)void 0!==o[b=f[S]]&&"function"!==typeof o[b]&&Y.push(b);if((G=Y.length)<16)s.push(128|G),B=1;else if(G<65536)s.push(222,G>>8,G),B=3;else{if(!(G<4294967296))throw new Error("Object too large");s.push(223,G>>24,G>>16,G>>8,G),B=5}for(S=0;S<G;S++)B+=j(s,Z,b=Y[S]),B+=j(s,Z,o[b]);return B}if("boolean"===t)return s.push(o?195:194),1;if("undefined"===t)return s.push(192),1;if("function"===typeof o.toJSON)return j(s,Z,o.toJSON());throw new Error("Could not encode")}Z.encode=function(s){var Z=[],o=[],S=j(Z,o,s),a=new ArrayBuffer(S),O=new DataView(a),v=0,G=0,B=-1;o.length>0&&(B=o[0]._offset);for(var Q,D=0,z=0,Y=0,b=Z.length;Y<b;Y++)if(O.setUint8(G+Y,Z[Y]),Y+1===B){if(D=(Q=o[v])._length,z=G+B,Q._bin)for(var f=new Uint8Array(Q._bin),A=0;A<D;A++)O.setUint8(z+A,f[A]);else Q._str?t(O,z,Q._str):void 0!==Q._float&&O.setFloat64(z,Q._float);G+=D,o[++v]&&(B=o[v]._offset)}return a}},11801:(s,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.NoneSerializer=void 0;Z.NoneSerializer=class{setState(s){}getState(){return null}patch(s){}teardown(){}handshake(s){}}},11795:(s,Z,o)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.SchemaSerializer=void 0;const t=o(11777);Z.SchemaSerializer=class{setState(s){return this.state.decode(s)}getState(){return this.state}patch(s){return this.state.decode(s)}teardown(){var s,Z;null===(Z=null===(s=this.state)||void 0===s?void 0:s.$changes)||void 0===Z||Z.root.clearRefs()}handshake(s,Z){if(this.state){(new t.Reflection).decode(s,Z)}else this.state=t.Reflection.decode(s,Z)}}},11757:(s,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.getSerializer=Z.registerSerializer=void 0;const o={};Z.registerSerializer=function(s,Z){o[s]=Z},Z.getSerializer=function(s){const Z=o[s];if(!Z)throw new Error("missing serializer: "+s);return Z}},11741:function(s,Z,o){"use strict";var t=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.WebSocketTransport=void 0;const j=t(o(11749)),S=globalThis.WebSocket||j.default;Z.WebSocketTransport=class{constructor(s){this.events=s}send(s){s instanceof ArrayBuffer?this.ws.send(s):Array.isArray(s)&&this.ws.send(new Uint8Array(s).buffer)}connect(s){this.ws=new S(s,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(s,Z){this.ws.close(s,Z)}get isOpen(){return this.ws.readyState===S.OPEN}}},11749:s=>{"use strict";s.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12153:s=>{"use strict";s.exports=function(s){for(var Z=new Array(s),o=0;o<s;++o)Z[o]=o;return Z}},12161:s=>{function Z(s){return!!s.constructor&&"function"===typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}s.exports=function(s){return null!=s&&(Z(s)||function(s){return"function"===typeof s.readFloatLE&&"function"===typeof s.slice&&Z(s.slice(0,0))}(s)||!!s._isBuffer)}},12150:(s,Z,o)=>{var t=o(12153),j=o(12161),S="undefined"!==typeof Float64Array;function a(s,Z){return s[0]-Z[0]}function O(){var s,Z=this.stride,o=new Array(Z.length);for(s=0;s<o.length;++s)o[s]=[Math.abs(Z[s]),s];o.sort(a);var t=new Array(o.length);for(s=0;s<t.length;++s)t[s]=o[s][1];return t}function v(s,Z){var o=["View",Z,"d",s].join("");Z<0&&(o="View_Nil"+s);var j="generic"===s;if(-1===Z){var S="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+s+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(S)()}if(0===Z){S="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+s+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(j?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(j?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",S)(G[s][0])}S=["'use strict'"];var a=t(Z),v=a.map((function(s){return"i"+s})),B="this.offset+"+a.map((function(s){return"this.stride["+s+"]*i"+s})).join("+"),Q=a.map((function(s){return"b"+s})).join(","),D=a.map((function(s){return"c"+s})).join(",");S.push("function "+o+"(a,"+Q+","+D+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+s+"'","proto.dimension="+Z),S.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+a.map((function(s){return"this.shape["+s+"]"})).join("*"),"}})"),1===Z?S.push("proto.order=[0]"):(S.push("Object.defineProperty(proto,'order',{get:"),Z<4?(S.push("function "+o+"_order(){"),2===Z?S.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Z&&S.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):S.push("ORDER})")),S.push("proto.set=function "+o+"_set("+v.join(",")+",v){"),j?S.push("return this.data.set("+B+",v)}"):S.push("return this.data["+B+"]=v}"),S.push("proto.get=function "+o+"_get("+v.join(",")+"){"),j?S.push("return this.data.get("+B+")}"):S.push("return this.data["+B+"]}"),S.push("proto.index=function "+o+"_index(",v.join(),"){return "+B+"}"),S.push("proto.hi=function "+o+"_hi("+v.join(",")+"){return new "+o+"(this.data,"+a.map((function(s){return["(typeof i",s,"!=='number'||i",s,"<0)?this.shape[",s,"]:i",s,"|0"].join("")})).join(",")+","+a.map((function(s){return"this.stride["+s+"]"})).join(",")+",this.offset)}");var z=a.map((function(s){return"a"+s+"=this.shape["+s+"]"})),Y=a.map((function(s){return"c"+s+"=this.stride["+s+"]"}));S.push("proto.lo=function "+o+"_lo("+v.join(",")+"){var b=this.offset,d=0,"+z.join(",")+","+Y.join(","));for(var b=0;b<Z;++b)S.push("if(typeof i"+b+"==='number'&&i"+b+">=0){d=i"+b+"|0;b+=c"+b+"*d;a"+b+"-=d}");S.push("return new "+o+"(this.data,"+a.map((function(s){return"a"+s})).join(",")+","+a.map((function(s){return"c"+s})).join(",")+",b)}"),S.push("proto.step=function "+o+"_step("+v.join(",")+"){var "+a.map((function(s){return"a"+s+"=this.shape["+s+"]"})).join(",")+","+a.map((function(s){return"b"+s+"=this.stride["+s+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(b=0;b<Z;++b)S.push("if(typeof i"+b+"==='number'){d=i"+b+"|0;if(d<0){c+=b"+b+"*(a"+b+"-1);a"+b+"=ceil(-a"+b+"/d)}else{a"+b+"=ceil(a"+b+"/d)}b"+b+"*=d}");S.push("return new "+o+"(this.data,"+a.map((function(s){return"a"+s})).join(",")+","+a.map((function(s){return"b"+s})).join(",")+",c)}");var f=new Array(Z),A=new Array(Z);for(b=0;b<Z;++b)f[b]="a[i"+b+"]",A[b]="b[i"+b+"]";S.push("proto.transpose=function "+o+"_transpose("+v+"){"+v.map((function(s,Z){return s+"=("+s+"===undefined?"+Z+":"+s+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+f.join(",")+","+A.join(",")+",this.offset)}"),S.push("proto.pick=function "+o+"_pick("+v+"){var a=[],b=[],c=this.offset");for(b=0;b<Z;++b)S.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");return S.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),S.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+a.map((function(s){return"shape["+s+"]"})).join(",")+","+a.map((function(s){return"stride["+s+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",S.join("\n"))(G[s],O)}var G={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};s.exports=function(s,Z,o,t){if(void 0===s)return(0,G.array[0])([]);"number"===typeof s&&(s=[s]),void 0===Z&&(Z=[s.length]);var a=Z.length;if(void 0===o){o=new Array(a);for(var O=a-1,B=1;O>=0;--O)o[O]=B,B*=Z[O]}if(void 0===t){t=0;for(O=0;O<a;++O)o[O]<0&&(t-=(Z[O]-1)*o[O])}for(var Q=function(s){if(j(s))return"buffer";if(S)switch(Object.prototype.toString.call(s)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(s)?"array":"generic"}(s),D=G[Q];D.length<=a+1;)D.push(v(Q,D.length-1));return(0,D[a+1])(s,Z,o,t)}},13146:s=>{var Z;self,Z=()=>(()=>{"use strict";var s={d:(Z,o)=>{for(var t in o)s.o(o,t)&&!s.o(Z,t)&&Object.defineProperty(Z,t,{enumerable:!0,get:o[t]})},o:(s,Z)=>Object.prototype.hasOwnProperty.call(s,Z)},Z={};s.d(Z,{default:()=>w});var o,t=function(s,Z){var o=Z.x-s.x,t=Z.y-s.y;return Math.sqrt(o*o+t*t)},j=function(s){return s*(Math.PI/180)},S=new Map,a=function(s){S.has(s)&&clearTimeout(S.get(s)),S.set(s,setTimeout(s,100))},O=function(s,Z,o){for(var t,j=Z.split(/[ ,]+/g),S=0;S<j.length;S+=1)t=j[S],s.addEventListener?s.addEventListener(t,o,!1):s.attachEvent&&s.attachEvent(t,o)},v=function(s,Z,o){for(var t,j=Z.split(/[ ,]+/g),S=0;S<j.length;S+=1)t=j[S],s.removeEventListener?s.removeEventListener(t,o):s.detachEvent&&s.detachEvent(t,o)},G=function(s){return s.preventDefault(),s.type.match(/^touch/)?s.changedTouches:s},B=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Q=function(s,Z){Z.top||Z.right||Z.bottom||Z.left?(s.style.top=Z.top,s.style.right=Z.right,s.style.bottom=Z.bottom,s.style.left=Z.left):(s.style.left=Z.x+"px",s.style.top=Z.y+"px")},D=function(s,Z,o){var t=z(s);for(var j in t)if(t.hasOwnProperty(j))if("string"==typeof Z)t[j]=Z+" "+o;else{for(var S="",a=0,O=Z.length;a<O;a+=1)S+=Z[a]+" "+o+", ";t[j]=S.slice(0,-2)}return t},z=function(s){var Z={};return Z[s]="",["webkit","Moz","o"].forEach((function(o){Z[o+s.charAt(0).toUpperCase()+s.slice(1)]=""})),Z},Y=function(s,Z){for(var o in Z)Z.hasOwnProperty(o)&&(s[o]=Z[o]);return s},b=function(s,Z){if(s.length)for(var o=0,t=s.length;o<t;o+=1)Z(s[o]);else Z(s)},f="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,A=window.matchMedia("(any-hover: none)").matches,d=!!("ontouchstart"in window),U=!!window.PointerEvent,u=!!window.MSPointerEvent,H={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},F={start:"mousedown",move:"mousemove",end:"mouseup"},i={};function N(){}f&&!A?o=H:U?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:u?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:d?(o=H,i=F):o=F,N.prototype.on=function(s,Z){var o,t=this,j=s.split(/[ ,]+/g);t._handlers_=t._handlers_||{};for(var S=0;S<j.length;S+=1)o=j[S],t._handlers_[o]=t._handlers_[o]||[],t._handlers_[o].push(Z);return t},N.prototype.off=function(s,Z){var o=this;return o._handlers_=o._handlers_||{},void 0===s?o._handlers_={}:void 0===Z?o._handlers_[s]=null:o._handlers_[s]&&o._handlers_[s].indexOf(Z)>=0&&o._handlers_[s].splice(o._handlers_[s].indexOf(Z),1),o},N.prototype.trigger=function(s,Z){var o,t=this,j=s.split(/[ ,]+/g);t._handlers_=t._handlers_||{};for(var S=0;S<j.length;S+=1)o=j[S],t._handlers_[o]&&t._handlers_[o].length&&t._handlers_[o].forEach((function(s){s.call(t,{type:o,target:t},Z)}))},N.prototype.config=function(s){var Z=this;Z.options=Z.defaults||{},s&&(Z.options=function(s,Z){var o={};for(var t in s)s.hasOwnProperty(t)&&Z.hasOwnProperty(t)?o[t]=Z[t]:s.hasOwnProperty(t)&&(o[t]=s[t]);return o}(Z.options,s))},N.prototype.bindEvt=function(s,Z){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[Z]=function(){"function"==typeof t["on"+Z]?t["on"+Z].apply(t,arguments):console.warn('[WARNING] : Missing "on'+Z+'" handler.')},O(s,o[Z],t._domHandlers_[Z]),i[Z]&&O(s,i[Z],t._domHandlers_[Z]),t},N.prototype.unbindEvt=function(s,Z){var t=this;return t._domHandlers_=t._domHandlers_||{},v(s,o[Z],t._domHandlers_[Z]),i[Z]&&v(s,i[Z],t._domHandlers_[Z]),delete t._domHandlers_[Z],this};const L=N;function V(s,Z){return this.identifier=Z.identifier,this.position=Z.position,this.frontPosition=Z.frontPosition,this.collection=s,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(Z),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=V.id,V.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}V.prototype=new L,V.constructor=V,V.id=0,V.prototype.buildEl=function(s){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},V.prototype.stylize=function(){if(this.options.dataOnly)return this;var s=this.options.fadeTime+"ms",Z=function(){var s=z("borderRadius");for(var Z in s)s.hasOwnProperty(Z)&&(s[Z]="50%");return s}(),o=D("transition","opacity",s),t={};return t.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},t.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},t.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Y(t.el,o),"circle"===this.options.shape&&Y(t.back,Z),Y(t.front,Z),this.applyStyles(t),this},V.prototype.applyStyles=function(s){for(var Z in this.ui)if(this.ui.hasOwnProperty(Z))for(var o in s[Z])this.ui[Z].style[o]=s[Z][o];return this},V.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},V.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},V.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},V.prototype.show=function(s){var Z=this;return Z.options.dataOnly||(clearTimeout(Z.removeTimeout),clearTimeout(Z.showTimeout),clearTimeout(Z.restTimeout),Z.addToDom(),Z.restCallback(),setTimeout((function(){Z.ui.el.style.opacity=1}),0),Z.showTimeout=setTimeout((function(){Z.trigger("shown",Z.instance),"function"==typeof s&&s.call(this)}),Z.options.fadeTime)),Z},V.prototype.hide=function(s){var Z=this;if(Z.options.dataOnly)return Z;if(Z.ui.el.style.opacity=Z.options.restOpacity,clearTimeout(Z.removeTimeout),clearTimeout(Z.showTimeout),clearTimeout(Z.restTimeout),Z.removeTimeout=setTimeout((function(){var o="dynamic"===Z.options.mode?"none":"block";Z.ui.el.style.display=o,"function"==typeof s&&s.call(Z),Z.trigger("hidden",Z.instance)}),Z.options.fadeTime),Z.options.restJoystick){var o=Z.options.restJoystick,t={};t.x=!0===o||!1!==o.x?0:Z.instance.frontPosition.x,t.y=!0===o||!1!==o.y?0:Z.instance.frontPosition.y,Z.setPosition(s,t)}return Z},V.prototype.setPosition=function(s,Z){var o=this;o.frontPosition={x:Z.x,y:Z.y};var t=o.options.fadeTime+"ms",j={};j.front=D("transition",["transform"],t);var S={front:{}};S.front={transform:"translate("+o.frontPosition.x+"px,"+o.frontPosition.y+"px)"},o.applyStyles(j),o.applyStyles(S),o.restTimeout=setTimeout((function(){"function"==typeof s&&s.call(o),o.restCallback()}),o.options.fadeTime)},V.prototype.restCallback=function(){var s=this,Z={};Z.front=D("transition","none",""),s.applyStyles(Z),s.trigger("rested",s.instance)},V.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},V.prototype.computeDirection=function(s){var Z,o,t,j=s.angle.radian,S=Math.PI/4,a=Math.PI/2;if(j>S&&j<3*S&&!s.lockX?Z="up":j>-S&&j<=S&&!s.lockY?Z="left":j>3*-S&&j<=-S&&!s.lockX?Z="down":s.lockY||(Z="right"),s.lockY||(o=j>-a&&j<a?"left":"right"),s.lockX||(t=j>0?"up":"down"),s.force>this.options.threshold){var O,v={};for(O in this.direction)this.direction.hasOwnProperty(O)&&(v[O]=this.direction[O]);var G={};for(O in this.direction={x:o,y:t,angle:Z},s.direction=this.direction,v)v[O]===this.direction[O]&&(G[O]=!0);if(G.x&&G.y&&G.angle)return s;G.x&&G.y||this.trigger("plain",s),G.x||this.trigger("plain:"+o,s),G.y||this.trigger("plain:"+t,s),G.angle||this.trigger("dir dir:"+Z,s)}else this.resetDirection();return s};const g=V;function l(s,Z){var o=this;o.nipples=[],o.idles=[],o.actives=[],o.ids=[],o.pressureIntervals={},o.manager=s,o.id=l.id,l.id+=1,o.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},o.config(Z),"static"!==o.options.mode&&"semi"!==o.options.mode||(o.options.multitouch=!1),o.options.multitouch||(o.options.maxNumberOfNipples=1);var t=getComputedStyle(o.options.zone.parentElement);return t&&"flex"===t.display&&(o.parentIsFlex=!0),o.updateBox(),o.prepareNipples(),o.WQ(),o.begin(),o.nipples}l.prototype=new L,l.constructor=l,l.id=0,l.prototype.prepareNipples=function(){var s=this,Z=s.nipples;Z.on=s.on.bind(s),Z.off=s.off.bind(s),Z.options=s.options,Z.destroy=s.destroy.bind(s),Z.ids=s.ids,Z.id=s.id,Z.processOnMove=s.processOnMove.bind(s),Z.processOnEnd=s.processOnEnd.bind(s),Z.get=function(s){if(void 0===s)return Z[0];for(var o=0,t=Z.length;o<t;o+=1)if(Z[o].identifier===s)return Z[o];return!1}},l.prototype.WQ=function(){var s=this;s.bindEvt(s.options.zone,"start"),s.options.zone.style.touchAction="none",s.options.zone.style.msTouchAction="none"},l.prototype.begin=function(){var s=this,Z=s.options;if("static"===Z.mode){var o=s.createNipple(Z.position,s.manager.getIdentifier());o.add(),s.idles.push(o)}},l.prototype.createNipple=function(s,Z){var o=this,t=o.manager.scroll,j={},S=o.options,a=o.parentIsFlex?t.x:t.x+o.box.left,O=o.parentIsFlex?t.y:t.y+o.box.top;if(s.x&&s.y)j={x:s.x-a,y:s.y-O};else if(s.top||s.right||s.bottom||s.left){var v=document.createElement("DIV");v.style.display="hidden",v.style.top=s.top,v.style.right=s.right,v.style.bottom=s.bottom,v.style.left=s.left,v.style.position="absolute",S.zone.appendChild(v);var G=v.getBoundingClientRect();S.zone.removeChild(v),j=s,s={x:G.left+t.x,y:G.top+t.y}}var B=new g(o,{color:S.color,size:S.size,threshold:S.threshold,fadeTime:S.fadeTime,dataOnly:S.dataOnly,restJoystick:S.restJoystick,restOpacity:S.restOpacity,mode:S.mode,identifier:Z,position:s,zone:S.zone,frontPosition:{x:0,y:0},shape:S.shape});return S.dataOnly||(Q(B.ui.el,j),Q(B.ui.front,B.frontPosition)),o.nipples.push(B),o.trigger("added "+B.identifier+":added",B),o.manager.trigger("added "+B.identifier+":added",B),o.bindNipple(B),B},l.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},l.prototype.bindNipple=function(s){var Z,o=this,t=function(s,t){Z=s.type+" "+t.id+":"+s.type,o.trigger(Z,t)};s.on("destroyed",o.onDestroyed.bind(o)),s.on("shown hidden rested dir plain",t),s.on("dir:up dir:right dir:down dir:left",t),s.on("plain:up plain:right plain:down plain:left",t)},l.prototype.pressureFn=function(s,Z,o){var t=this,j=0;clearInterval(t.pressureIntervals[o]),t.pressureIntervals[o]=setInterval(function(){var o=s.force||s.pressure||s.webkitForce||0;o!==j&&(Z.trigger("pressure",o),t.trigger("pressure "+Z.identifier+":pressure",o),j=o)}.bind(t),100)},l.prototype.onstart=function(s){var Z=this,o=Z.options,t=s;return s=G(s),Z.updateBox(),b(s,(function(j){Z.actives.length<o.maxNumberOfNipples?Z.processOnStart(j):t.type.match(/^touch/)&&(Object.keys(Z.manager.ids).forEach((function(o){if(Object.values(t.touches).findIndex((function(s){return s.identifier===o}))<0){var j=[s[0]];j.identifier=o,Z.processOnEnd(j)}})),Z.actives.length<o.maxNumberOfNipples&&Z.processOnStart(j))})),Z.manager.bindDocument(),!1},l.prototype.processOnStart=function(s){var Z,o=this,j=o.options,S=o.manager.getIdentifier(s),a=s.force||s.pressure||s.webkitForce||0,O={x:s.pageX,y:s.pageY},v=o.getOrCreate(S,O);v.identifier!==S&&o.manager.removeIdentifier(v.identifier),v.identifier=S;var G=function(Z){Z.trigger("start",Z),o.trigger("start "+Z.id+":start",Z),Z.show(),a>0&&o.pressureFn(s,Z,Z.identifier),o.processOnMove(s)};if((Z=o.idles.indexOf(v))>=0&&o.idles.splice(Z,1),o.actives.push(v),o.ids.push(v.identifier),"semi"!==j.mode)G(v);else{if(!(t(O,v.position)<=j.catchDistance))return v.destroy(),void o.processOnStart(s);G(v)}return v},l.prototype.getOrCreate=function(s,Z){var o,t=this,j=t.options;return/(semi|static)/.test(j.mode)?(o=t.idles[0])?(t.idles.splice(0,1),o):"semi"===j.mode?t.createNipple(Z,s):(console.warn("Coudln't find the needed nipple."),!1):o=t.createNipple(Z,s)},l.prototype.processOnMove=function(s){var Z=this,o=Z.options,S=Z.manager.getIdentifier(s),a=Z.nipples.get(S),O=Z.manager.scroll;if(function(s){return isNaN(s.buttons)?0!==s.pressure:0!==s.buttons}(s)){if(!a)return console.error("Found zombie joystick with ID "+S),void Z.manager.removeIdentifier(S);if(o.dynamicPage){var v=a.el.getBoundingClientRect();a.position={x:O.x+v.left,y:O.y+v.top}}a.identifier=S;var G=a.options.size/2,B={x:s.pageX,y:s.pageY};o.lockX&&(B.y=a.position.y),o.lockY&&(B.x=a.position.x);var Q,D,z,Y,b,f,A,d,U,u,H=t(B,a.position),F=(Q=B,z=(D=a.position).x-Q.x,Y=D.y-Q.y,function(s){return s*(180/Math.PI)}(Math.atan2(Y,z))),i=j(F),N=H/G,L={distance:H,position:B};if("circle"===a.options.shape?(b=Math.min(H,G),A=a.position,d=b,u={x:0,y:0},U=j(U=F),u.x=A.x-d*Math.cos(U),u.y=A.y-d*Math.sin(U),f=u):(f=function(s,Z,o){return{x:Math.min(Math.max(s.x,Z.x-o),Z.x+o),y:Math.min(Math.max(s.y,Z.y-o),Z.y+o)}}(B,a.position,G),b=t(f,a.position)),o.follow){if(H>G){var V=B.x-f.x,g=B.y-f.y;a.position.x+=V,a.position.y+=g,a.el.style.top=a.position.y-(Z.box.top+O.y)+"px",a.el.style.left=a.position.x-(Z.box.left+O.x)+"px",H=t(B,a.position)}}else B=f,H=b;var l=B.x-a.position.x,R=B.y-a.position.y;a.frontPosition={x:l,y:R},o.dataOnly||(a.ui.front.style.transform="translate("+l+"px,"+R+"px)");var e={identifier:a.identifier,position:B,force:N,pressure:s.force||s.pressure||s.webkitForce||0,distance:H,angle:{radian:i,degree:F},vector:{x:l/G,y:-R/G},raw:L,instance:a,lockX:o.lockX,lockY:o.lockY};(e=a.computeDirection(e)).angle={radian:j(180-F),degree:180-F},a.trigger("move",e),Z.trigger("move "+a.id+":move",e)}else this.processOnEnd(s)},l.prototype.processOnEnd=function(s){var Z=this,o=Z.options,t=Z.manager.getIdentifier(s),j=Z.nipples.get(t),S=Z.manager.removeIdentifier(j.identifier);j&&(o.dataOnly||j.hide((function(){"dynamic"===o.mode&&(j.trigger("removed",j),Z.trigger("removed "+j.id+":removed",j),Z.manager.trigger("removed "+j.id+":removed",j),j.destroy())})),clearInterval(Z.pressureIntervals[j.identifier]),j.resetDirection(),j.trigger("end",j),Z.trigger("end "+j.id+":end",j),Z.ids.indexOf(j.identifier)>=0&&Z.ids.splice(Z.ids.indexOf(j.identifier),1),Z.actives.indexOf(j)>=0&&Z.actives.splice(Z.actives.indexOf(j),1),/(semi|static)/.test(o.mode)?Z.idles.push(j):Z.nipples.indexOf(j)>=0&&Z.nipples.splice(Z.nipples.indexOf(j),1),Z.manager.unbindDocument(),/(semi|static)/.test(o.mode)&&(Z.manager.ids[S.id]=S.identifier))},l.prototype.onDestroyed=function(s,Z){var o=this;o.nipples.indexOf(Z)>=0&&o.nipples.splice(o.nipples.indexOf(Z),1),o.actives.indexOf(Z)>=0&&o.actives.splice(o.actives.indexOf(Z),1),o.idles.indexOf(Z)>=0&&o.idles.splice(o.idles.indexOf(Z),1),o.ids.indexOf(Z.identifier)>=0&&o.ids.splice(o.ids.indexOf(Z.identifier),1),o.manager.removeIdentifier(Z.identifier),o.manager.unbindDocument()},l.prototype.destroy=function(){var s=this;for(var Z in s.unbindEvt(s.options.zone,"start"),s.nipples.forEach((function(s){s.destroy()})),s.pressureIntervals)s.pressureIntervals.hasOwnProperty(Z)&&clearInterval(s.pressureIntervals[Z]);s.trigger("destroyed",s.nipples),s.manager.unbindDocument(),s.off()};const R=l;function e(s){var Z=this;Z.ids={},Z.index=0,Z.collections=[],Z.scroll=B(),Z.config(s),Z.prepareCollections();var o=function(){var s;Z.collections.forEach((function(o){o.forEach((function(o){s=o.el.getBoundingClientRect(),o.position={x:Z.scroll.x+s.left,y:Z.scroll.y+s.top}}))}))};O(window,"resize",(function(){a(o)}));var t=function(){Z.scroll=B()};return O(window,"scroll",(function(){a(t)})),Z.collections}e.prototype=new L,e.constructor=e,e.prototype.prepareCollections=function(){var s=this;s.collections.create=s.create.bind(s),s.collections.on=s.on.bind(s),s.collections.off=s.off.bind(s),s.collections.destroy=s.destroy.bind(s),s.collections.get=function(Z){var o;return s.collections.every((function(s){return!(o=s.get(Z))})),o}},e.prototype.create=function(s){return this.createCollection(s)},e.prototype.createCollection=function(s){var Z=this,o=new R(Z,s);return Z.bindCollection(o),Z.collections.push(o),o},e.prototype.bindCollection=function(s){var Z,o=this,t=function(s,t){Z=s.type+" "+t.id+":"+s.type,o.trigger(Z,t)};s.on("destroyed",o.onDestroyed.bind(o)),s.on("shown hidden rested dir plain",t),s.on("dir:up dir:right dir:down dir:left",t),s.on("plain:up plain:right plain:down plain:left",t)},e.prototype.bindDocument=function(){var s=this;s.binded||(s.bindEvt(document,"move").bindEvt(document,"end"),s.binded=!0)},e.prototype.unbindDocument=function(s){var Z=this;Object.keys(Z.ids).length&&!0!==s||(Z.unbindEvt(document,"move").unbindEvt(document,"end"),Z.binded=!1)},e.prototype.getIdentifier=function(s){var Z;return s?void 0===(Z=void 0===s.identifier?s.pointerId:s.identifier)&&(Z=this.latest||0):Z=this.index,void 0===this.ids[Z]&&(this.ids[Z]=this.index,this.index+=1),this.latest=Z,this.ids[Z]},e.prototype.removeIdentifier=function(s){var Z={};for(var o in this.ids)if(this.ids[o]===s){Z.id=o,Z.identifier=this.ids[o],delete this.ids[o];break}return Z},e.prototype.onmove=function(s){return this.onAny("move",s),!1},e.prototype.onend=function(s){return this.onAny("end",s),!1},e.prototype.oncancel=function(s){return this.onAny("end",s),!1},e.prototype.onAny=function(s,Z){var o,t=this,j="processOn"+s.charAt(0).toUpperCase()+s.slice(1);Z=G(Z);var S=function(s,Z,o){o.ids.indexOf(Z)>=0&&(o[j](s),s._found_=!0)};return b(Z,(function(s){o=t.getIdentifier(s),b(t.collections,S.bind(null,s,o)),s._found_||t.removeIdentifier(o)})),!1},e.prototype.destroy=function(){var s=this;s.unbindDocument(!0),s.ids={},s.index=0,s.collections.forEach((function(s){s.destroy()})),s.off()},e.prototype.onDestroyed=function(s,Z){var o=this;if(o.collections.indexOf(Z)<0)return!1;o.collections.splice(o.collections.indexOf(Z),1)};var c=new e;const w={create:function(s){return c.create(s)},factory:c};return Z.default})(),s.exports=Z()},12181:(s,Z,o)=>{"use strict";const{Deflate:t,deflate:j,deflateRaw:S,gzip:a}=o(12187),{Inflate:O,inflate:v,inflateRaw:G,ungzip:B}=o(12238),Q=o(12226);s.exports.Deflate=t,s.exports.deflate=j,s.exports.deflateRaw=S,s.exports.gzip=a,s.exports.Inflate=O,s.exports.inflate=v,s.exports.inflateRaw=G,s.exports.ungzip=B,s.exports.constants=Q},12187:(s,Z,o)=>{"use strict";const t=o(12195),j=o(12230),S=o(12233),a=o(12218),O=o(12236),v=Object.prototype.toString,{Z_NO_FLUSH:G,Z_SYNC_FLUSH:B,Z_FULL_FLUSH:Q,Z_FINISH:D,Z_OK:z,Z_STREAM_END:Y,Z_DEFAULT_COMPRESSION:b,Z_DEFAULT_STRATEGY:f,Z_DEFLATED:A}=o(12226);function d(s){this.options=j.assign({level:b,method:A,ks:16384,windowBits:15,memLevel:8,strategy:f},s||{});let Z=this.options;Z.raw&&Z.windowBits>0?Z.windowBits=-Z.windowBits:Z.gzip&&Z.windowBits>0&&Z.windowBits<16&&(Z.windowBits+=16),this.err=0,this.BZ="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let o=t.deflateInit2(this.strm,Z.level,Z.method,Z.windowBits,Z.memLevel,Z.strategy);if(o!==z)throw new Error(a[o]);if(Z.header&&t.deflateSetHeader(this.strm,Z.header),Z.dictionary){let s;if(s="string"===typeof Z.dictionary?S.string2buf(Z.dictionary):"[object ArrayBuffer]"===v.call(Z.dictionary)?new Uint8Array(Z.dictionary):Z.dictionary,o=t.deflateSetDictionary(this.strm,s),o!==z)throw new Error(a[o]);this._dict_set=!0}}function U(s,Z){const o=new d(Z);if(o.push(s,!0),o.err)throw o.BZ||a[o.err];return o.result}d.prototype.push=function(s,Z){const o=this.strm,j=this.options.ks;let a,O;if(this.ended)return!1;for(O=Z===~~Z?Z:!0===Z?D:G,"string"===typeof s?o.input=S.string2buf(s):"[object ArrayBuffer]"===v.call(s)?o.input=new Uint8Array(s):o.input=s,o.next_in=0,o.avail_in=o.input.length;;)if(0===o.avail_out&&(o.output=new Uint8Array(j),o.next_out=0,o.avail_out=j),(O===B||O===Q)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(a=t.deflate(o,O),a===Y)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),a=t.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===z;if(0!==o.avail_out){if(O>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(0===o.avail_in)break}else this.onData(o.output)}return!0},d.prototype.onData=function(s){this.chunks.push(s)},d.prototype.onEnd=function(s){s===z&&(this.result=j.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.BZ=this.strm.BZ},s.exports.Deflate=d,s.exports.deflate=U,s.exports.deflateRaw=function(s,Z){return(Z=Z||{}).raw=!0,U(s,Z)},s.exports.gzip=function(s,Z){return(Z=Z||{}).gzip=!0,U(s,Z)},s.exports.constants=o(12226)},12238:(s,Z,o)=>{"use strict";const t=o(12247),j=o(12230),S=o(12233),a=o(12218),O=o(12236),v=o(12259),G=Object.prototype.toString,{Z_NO_FLUSH:B,Z_FINISH:Q,Z_OK:D,Z_STREAM_END:z,Z_NEED_DICT:Y,Z_STREAM_ERROR:b,Z_DATA_ERROR:f,Z_MEM_ERROR:A}=o(12226);function d(s){this.options=j.assign({ks:65536,windowBits:15,to:""},s||{});const Z=this.options;Z.raw&&Z.windowBits>=0&&Z.windowBits<16&&(Z.windowBits=-Z.windowBits,0===Z.windowBits&&(Z.windowBits=-15)),!(Z.windowBits>=0&&Z.windowBits<16)||s&&s.windowBits||(Z.windowBits+=32),Z.windowBits>15&&Z.windowBits<48&&0===(15&Z.windowBits)&&(Z.windowBits|=15),this.err=0,this.BZ="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let o=t.inflateInit2(this.strm,Z.windowBits);if(o!==D)throw new Error(a[o]);if(this.header=new v,t.inflateGetHeader(this.strm,this.header),Z.dictionary&&("string"===typeof Z.dictionary?Z.dictionary=S.string2buf(Z.dictionary):"[object ArrayBuffer]"===G.call(Z.dictionary)&&(Z.dictionary=new Uint8Array(Z.dictionary)),Z.raw&&(o=t.inflateSetDictionary(this.strm,Z.dictionary),o!==D)))throw new Error(a[o])}function U(s,Z){const o=new d(Z);if(o.push(s),o.err)throw o.BZ||a[o.err];return o.result}d.prototype.push=function(s,Z){const o=this.strm,j=this.options.ks,a=this.options.dictionary;let O,v,d;if(this.ended)return!1;for(v=Z===~~Z?Z:!0===Z?Q:B,"[object ArrayBuffer]"===G.call(s)?o.input=new Uint8Array(s):o.input=s,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(j),o.next_out=0,o.avail_out=j),O=t.inflate(o,v),O===Y&&a&&(O=t.inflateSetDictionary(o,a),O===D?O=t.inflate(o,v):O===f&&(O=Y));o.avail_in>0&&O===z&&o.state.wrap>0&&0!==s[o.next_in];)t.inflateReset(o),O=t.inflate(o,v);switch(O){case b:case f:case Y:case A:return this.onEnd(O),this.ended=!0,!1}if(d=o.avail_out,o.next_out&&(0===o.avail_out||O===z))if("string"===this.options.to){let s=S.utf8border(o.output,o.next_out),Z=o.next_out-s,t=S.buf2string(o.output,s);o.next_out=Z,o.avail_out=j-Z,Z&&o.output.set(o.output.subarray(s,s+Z),0),this.onData(t)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(O!==D||0!==d){if(O===z)return O=t.inflateEnd(this.strm),this.onEnd(O),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},d.prototype.onData=function(s){this.chunks.push(s)},d.prototype.onEnd=function(s){s===D&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=j.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.BZ=this.strm.BZ},s.exports.Inflate=d,s.exports.inflate=U,s.exports.inflateRaw=function(s,Z){return(Z=Z||{}).raw=!0,U(s,Z)},s.exports.ungzip=U,s.exports.constants=o(12226)},12230:s=>{"use strict";const Z=(s,Z)=>Object.prototype.hasOwnProperty.call(s,Z);s.exports.assign=function(s){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const t=o.shift();if(t){if("object"!==typeof t)throw new TypeError(t+"must be non-object");for(const o in t)Z(t,o)&&(s[o]=t[o])}}return s},s.exports.flattenChunks=s=>{let Z=0;for(let t=0,j=s.length;t<j;t++)Z+=s[t].length;const o=new Uint8Array(Z);for(let t=0,j=0,S=s.length;t<S;t++){let Z=s[t];o.set(Z,j),j+=Z.length}return o}},12233:s=>{"use strict";let Z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Z=!1}const o=new Uint8Array(256);for(let j=0;j<256;j++)o[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;o[254]=o[254]=1,s.exports.string2buf=s=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let Z,o,t,j,S,a=s.length,O=0;for(j=0;j<a;j++)o=s.charCodeAt(j),55296===(64512&o)&&j+1<a&&(t=s.charCodeAt(j+1),56320===(64512&t)&&(o=65536+(o-55296<<10)+(t-56320),j++)),O+=o<128?1:o<2048?2:o<65536?3:4;for(Z=new Uint8Array(O),S=0,j=0;S<O;j++)o=s.charCodeAt(j),55296===(64512&o)&&j+1<a&&(t=s.charCodeAt(j+1),56320===(64512&t)&&(o=65536+(o-55296<<10)+(t-56320),j++)),o<128?Z[S++]=o:o<2048?(Z[S++]=192|o>>>6,Z[S++]=128|63&o):o<65536?(Z[S++]=224|o>>>12,Z[S++]=128|o>>>6&63,Z[S++]=128|63&o):(Z[S++]=240|o>>>18,Z[S++]=128|o>>>12&63,Z[S++]=128|o>>>6&63,Z[S++]=128|63&o);return Z};s.exports.buf2string=(s,t)=>{const j=t||s.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,t));let S,a;const O=new Array(2*j);for(a=0,S=0;S<j;){let Z=s[S++];if(Z<128){O[a++]=Z;continue}let t=o[Z];if(t>4)O[a++]=65533,S+=t-1;else{for(Z&=2===t?31:3===t?15:7;t>1&&S<j;)Z=Z<<6|63&s[S++],t--;t>1?O[a++]=65533:Z<65536?O[a++]=Z:(Z-=65536,O[a++]=55296|Z>>10&1023,O[a++]=56320|1023&Z)}}return((s,o)=>{if(o<65534&&s.subarray&&Z)return String.fromCharCode.apply(null,s.length===o?s:s.subarray(0,o));let t="";for(let Z=0;Z<o;Z++)t+=String.fromCharCode(s[Z]);return t})(O,a)},s.exports.utf8border=(s,Z)=>{(Z=Z||s.length)>s.length&&(Z=s.length);let t=Z-1;for(;t>=0&&128===(192&s[t]);)t--;return t<0||0===t?Z:t+o[s[t]]>Z?t:Z}},12202:s=>{"use strict";s.exports=(s,Z,o,t)=>{let j=65535&s,S=s>>>16&65535,a=0;for(;0!==o;){a=o>2e3?2e3:o,o-=a;do{j=j+Z[t++]|0,S=S+j|0}while(--a);j%=65521,S%=65521}return j|S<<16}},12226:s=>{"use strict";s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12209:s=>{"use strict";const Z=new Uint32Array((()=>{let s,Z=[];for(var o=0;o<256;o++){s=o;for(var t=0;t<8;t++)s=1&s?3988292384^s>>>1:s>>>1;Z[o]=s}return Z})());s.exports=(s,o,t,j)=>{const S=Z,a=j+t;s^=-1;for(let Z=j;Z<a;Z++)s=s>>>8^S[255&(s^o[Z])];return~s}},12195:(s,Z,o)=>{"use strict";const{_tr_init:t,_tr_stored_block:j,_tr_flush_block:S,_tr_tally:a,_tr_align:O}=o(12198),v=o(12202),G=o(12209),B=o(12218),{Z_NO_FLUSH:Q,Z_PARTIAL_FLUSH:D,Z_FULL_FLUSH:z,Z_FINISH:Y,Z_BLOCK:b,Z_OK:f,Z_STREAM_END:A,Z_STREAM_ERROR:d,Z_DATA_ERROR:U,Z_BUF_ERROR:u,Z_DEFAULT_COMPRESSION:H,Z_FILTERED:F,Z_HUFFMAN_ONLY:i,Z_RLE:N,Z_FIXED:L,Z_DEFAULT_STRATEGY:V,Z_UNKNOWN:g,Z_DEFLATED:l}=o(12226),R=258,e=262,c=103,w=113,X=666,W=(s,Z)=>(s.BZ=B[Z],Z),q=s=>(s<<1)-(s>4?9:0),h=s=>{let Z=s.length;for(;--Z>=0;)s[Z]=0};let M=(s,Z,o)=>(Z<<s.hash_shift^o)&s.hash_mask;const x=s=>{const Z=s.state;let o=Z.pending;o>s.avail_out&&(o=s.avail_out),0!==o&&(s.output.set(Z.pending_buf.subarray(Z.pending_out,Z.pending_out+o),s.next_out),s.next_out+=o,Z.pending_out+=o,s.total_out+=o,s.avail_out-=o,Z.pending-=o,0===Z.pending&&(Z.pending_out=0))},k=(s,Z)=>{S(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,Z),s.block_start=s.strstart,x(s.strm)},y=(s,Z)=>{s.pending_buf[s.pending++]=Z},I=(s,Z)=>{s.pending_buf[s.pending++]=Z>>>8&255,s.pending_buf[s.pending++]=255&Z},C=(s,Z,o,t)=>{let j=s.avail_in;return j>t&&(j=t),0===j?0:(s.avail_in-=j,Z.set(s.input.subarray(s.next_in,s.next_in+j),o),1===s.state.wrap?s.adler=v(s.adler,Z,j,o):2===s.state.wrap&&(s.adler=G(s.adler,Z,j,o)),s.next_in+=j,s.total_in+=j,j)},K=(s,Z)=>{let o,t,j=s.max_chain_length,S=s.strstart,a=s.prev_length,O=s.nice_match;const v=s.strstart>s.w_size-e?s.strstart-(s.w_size-e):0,G=s.window,B=s.w_mask,Q=s.prev,D=s.strstart+R;let z=G[S+a-1],Y=G[S+a];s.prev_length>=s.good_match&&(j>>=2),O>s.lookahead&&(O=s.lookahead);do{if(o=Z,G[o+a]===Y&&G[o+a-1]===z&&G[o]===G[S]&&G[++o]===G[S+1]){S+=2,o++;do{}while(G[++S]===G[++o]&&G[++S]===G[++o]&&G[++S]===G[++o]&&G[++S]===G[++o]&&G[++S]===G[++o]&&G[++S]===G[++o]&&G[++S]===G[++o]&&G[++S]===G[++o]&&S<D);if(t=R-(D-S),S=D-R,t>a){if(s.match_start=Z,a=t,t>=O)break;z=G[S+a-1],Y=G[S+a]}}}while((Z=Q[Z&B])>v&&0!==--j);return a<=s.lookahead?a:s.lookahead},p=s=>{const Z=s.w_size;let o,t,j,S,a;do{if(S=s.window_size-s.lookahead-s.strstart,s.strstart>=Z+(Z-e)){s.window.set(s.window.subarray(Z,Z+Z),0),s.match_start-=Z,s.strstart-=Z,s.block_start-=Z,t=s.hash_size,o=t;do{j=s.head[--o],s.head[o]=j>=Z?j-Z:0}while(--t);t=Z,o=t;do{j=s.prev[--o],s.prev[o]=j>=Z?j-Z:0}while(--t);S+=Z}if(0===s.strm.avail_in)break;if(t=C(s.strm,s.window,s.strstart+s.lookahead,S),s.lookahead+=t,s.lookahead+s.insert>=3)for(a=s.strstart-s.insert,s.ins_h=s.window[a],s.ins_h=M(s,s.ins_h,s.window[a+1]);s.insert&&(s.ins_h=M(s,s.ins_h,s.window[a+3-1]),s.prev[a&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=a,a++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<e&&0!==s.strm.avail_in)},E=(s,Z)=>{let o,t;for(;;){if(s.lookahead<e){if(p(s),s.lookahead<e&&Z===Q)return 1;if(0===s.lookahead)break}if(o=0,s.lookahead>=3&&(s.ins_h=M(s,s.ins_h,s.window[s.strstart+3-1]),o=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==o&&s.strstart-o<=s.w_size-e&&(s.match_length=K(s,o)),s.match_length>=3)if(t=a(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=M(s,s.ins_h,s.window[s.strstart+3-1]),o=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!==--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=M(s,s.ins_h,s.window[s.strstart+1]);else t=a(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(t&&(k(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,Z===Y?(k(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(k(s,!1),0===s.strm.avail_out)?1:2},P=(s,Z)=>{let o,t,j;for(;;){if(s.lookahead<e){if(p(s),s.lookahead<e&&Z===Q)return 1;if(0===s.lookahead)break}if(o=0,s.lookahead>=3&&(s.ins_h=M(s,s.ins_h,s.window[s.strstart+3-1]),o=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==o&&s.prev_length<s.max_lazy_match&&s.strstart-o<=s.w_size-e&&(s.match_length=K(s,o),s.match_length<=5&&(s.strategy===F||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){j=s.strstart+s.lookahead-3,t=a(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=j&&(s.ins_h=M(s,s.ins_h,s.window[s.strstart+3-1]),o=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!==--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,t&&(k(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(t=a(s,0,s.window[s.strstart-1]),t&&k(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(t=a(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,Z===Y?(k(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(k(s,!1),0===s.strm.avail_out)?1:2};function r(s,Z,o,t,j){this.good_length=s,this.max_lazy=Z,this.nice_length=o,this.max_chain=t,this.func=j}const T=[new r(0,0,0,0,((s,Z)=>{let o=65535;for(o>s.pending_buf_size-5&&(o=s.pending_buf_size-5);;){if(s.lookahead<=1){if(p(s),0===s.lookahead&&Z===Q)return 1;if(0===s.lookahead)break}s.strstart+=s.lookahead,s.lookahead=0;const t=s.block_start+o;if((0===s.strstart||s.strstart>=t)&&(s.lookahead=s.strstart-t,s.strstart=t,k(s,!1),0===s.strm.avail_out))return 1;if(s.strstart-s.block_start>=s.w_size-e&&(k(s,!1),0===s.strm.avail_out))return 1}return s.insert=0,Z===Y?(k(s,!0),0===s.strm.avail_out?3:4):(s.strstart>s.block_start&&(k(s,!1),s.strm.avail_out),1)})),new r(4,4,8,4,E),new r(4,5,16,8,E),new r(4,6,32,32,E),new r(4,4,16,16,P),new r(8,16,32,32,P),new r(8,16,128,128,P),new r(8,32,128,256,P),new r(32,128,258,1024,P),new r(32,258,258,4096,P)];function m(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=l,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const n=s=>{if(!s||!s.state)return W(s,d);s.total_in=s.total_out=0,s.data_type=g;const Z=s.state;return Z.pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?42:w,s.adler=2===Z.wrap?0:1,Z.last_flush=Q,t(Z),f},J=s=>{const Z=n(s);var o;return Z===f&&((o=s.state).window_size=2*o.w_size,h(o.head),o.max_lazy_match=T[o.level].max_lazy,o.good_match=T[o.level].good_length,o.nice_match=T[o.level].nice_length,o.max_chain_length=T[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),Z},ss=(s,Z,o,t,j,S)=>{if(!s)return d;let a=1;if(Z===H&&(Z=6),t<0?(a=0,t=-t):t>15&&(a=2,t-=16),j<1||j>9||o!==l||t<8||t>15||Z<0||Z>9||S<0||S>L)return W(s,d);8===t&&(t=9);const O=new m;return s.state=O,O.strm=s,O.wrap=a,O.gzhead=null,O.w_bits=t,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=j+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+3-1)/3),O.window=new Uint8Array(2*O.w_size),O.head=new Uint16Array(O.hash_size),O.prev=new Uint16Array(O.w_size),O.lit_bufsize=1<<j+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new Uint8Array(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=Z,O.strategy=S,O.method=o,J(s)};s.exports.deflateInit=(s,Z)=>ss(s,Z,l,15,8,V),s.exports.deflateInit2=ss,s.exports.deflateReset=J,s.exports.deflateResetKeep=n,s.exports.deflateSetHeader=(s,Z)=>s&&s.state?2!==s.state.wrap?d:(s.state.gzhead=Z,f):d,s.exports.deflate=(s,Z)=>{let o,t;if(!s||!s.state||Z>b||Z<0)return s?W(s,d):d;const S=s.state;if(!s.output||!s.input&&0!==s.avail_in||S.status===X&&Z!==Y)return W(s,0===s.avail_out?u:d);S.strm=s;const v=S.last_flush;if(S.last_flush=Z,42===S.status)if(2===S.wrap)s.adler=0,y(S,31),y(S,139),y(S,8),S.gzhead?(y(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),y(S,255&S.gzhead.time),y(S,S.gzhead.time>>8&255),y(S,S.gzhead.time>>16&255),y(S,S.gzhead.time>>24&255),y(S,9===S.level?2:S.strategy>=i||S.level<2?4:0),y(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(y(S,255&S.gzhead.extra.length),y(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(s.adler=G(s.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(y(S,0),y(S,0),y(S,0),y(S,0),y(S,0),y(S,9===S.level?2:S.strategy>=i||S.level<2?4:0),y(S,3),S.status=w);else{let Z=l+(S.w_bits-8<<4)<<8,o=-1;o=S.strategy>=i||S.level<2?0:S.level<6?1:6===S.level?2:3,Z|=o<<6,0!==S.strstart&&(Z|=32),Z+=31-Z%31,S.status=w,I(S,Z),0!==S.strstart&&(I(S,s.adler>>>16),I(S,65535&s.adler)),s.adler=1}if(69===S.status)if(S.gzhead.extra){for(o=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>o&&(s.adler=G(s.adler,S.pending_buf,S.pending-o,o)),x(s),o=S.pending,S.pending!==S.pending_buf_size));)y(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>o&&(s.adler=G(s.adler,S.pending_buf,S.pending-o,o)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(73===S.status)if(S.gzhead.name){o=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>o&&(s.adler=G(s.adler,S.pending_buf,S.pending-o,o)),x(s),o=S.pending,S.pending===S.pending_buf_size)){t=1;break}t=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,y(S,t)}while(0!==t);S.gzhead.hcrc&&S.pending>o&&(s.adler=G(s.adler,S.pending_buf,S.pending-o,o)),0===t&&(S.gzindex=0,S.status=91)}else S.status=91;if(91===S.status)if(S.gzhead.comment){o=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>o&&(s.adler=G(s.adler,S.pending_buf,S.pending-o,o)),x(s),o=S.pending,S.pending===S.pending_buf_size)){t=1;break}t=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,y(S,t)}while(0!==t);S.gzhead.hcrc&&S.pending>o&&(s.adler=G(s.adler,S.pending_buf,S.pending-o,o)),0===t&&(S.status=c)}else S.status=c;if(S.status===c&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&x(s),S.pending+2<=S.pending_buf_size&&(y(S,255&s.adler),y(S,s.adler>>8&255),s.adler=0,S.status=w)):S.status=w),0!==S.pending){if(x(s),0===s.avail_out)return S.last_flush=-1,f}else if(0===s.avail_in&&q(Z)<=q(v)&&Z!==Y)return W(s,u);if(S.status===X&&0!==s.avail_in)return W(s,u);if(0!==s.avail_in||0!==S.lookahead||Z!==Q&&S.status!==X){let o=S.strategy===i?((s,Z)=>{let o;for(;;){if(0===s.lookahead&&(p(s),0===s.lookahead)){if(Z===Q)return 1;break}if(s.match_length=0,o=a(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,o&&(k(s,!1),0===s.strm.avail_out))return 1}return s.insert=0,Z===Y?(k(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(k(s,!1),0===s.strm.avail_out)?1:2})(S,Z):S.strategy===N?((s,Z)=>{let o,t,j,S;const O=s.window;for(;;){if(s.lookahead<=R){if(p(s),s.lookahead<=R&&Z===Q)return 1;if(0===s.lookahead)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(j=s.strstart-1,t=O[j],t===O[++j]&&t===O[++j]&&t===O[++j])){S=s.strstart+R;do{}while(t===O[++j]&&t===O[++j]&&t===O[++j]&&t===O[++j]&&t===O[++j]&&t===O[++j]&&t===O[++j]&&t===O[++j]&&j<S);s.match_length=R-(S-j),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(o=a(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(o=a(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),o&&(k(s,!1),0===s.strm.avail_out))return 1}return s.insert=0,Z===Y?(k(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(k(s,!1),0===s.strm.avail_out)?1:2})(S,Z):T[S.level].func(S,Z);if(3!==o&&4!==o||(S.status=X),1===o||3===o)return 0===s.avail_out&&(S.last_flush=-1),f;if(2===o&&(Z===D?O(S):Z!==b&&(j(S,0,0,!1),Z===z&&(h(S.head),0===S.lookahead&&(S.strstart=0,S.block_start=0,S.insert=0))),x(s),0===s.avail_out))return S.last_flush=-1,f}return Z!==Y?f:S.wrap<=0?A:(2===S.wrap?(y(S,255&s.adler),y(S,s.adler>>8&255),y(S,s.adler>>16&255),y(S,s.adler>>24&255),y(S,255&s.total_in),y(S,s.total_in>>8&255),y(S,s.total_in>>16&255),y(S,s.total_in>>24&255)):(I(S,s.adler>>>16),I(S,65535&s.adler)),x(s),S.wrap>0&&(S.wrap=-S.wrap),0!==S.pending?f:A)},s.exports.deflateEnd=s=>{if(!s||!s.state)return d;const Z=s.state.status;return 42!==Z&&69!==Z&&73!==Z&&91!==Z&&Z!==c&&Z!==w&&Z!==X?W(s,d):(s.state=null,Z===w?W(s,U):f)},s.exports.deflateSetDictionary=(s,Z)=>{let o=Z.length;if(!s||!s.state)return d;const t=s.state,j=t.wrap;if(2===j||1===j&&42!==t.status||t.lookahead)return d;if(1===j&&(s.adler=v(s.adler,Z,o,0)),t.wrap=0,o>=t.w_size){0===j&&(h(t.head),t.strstart=0,t.block_start=0,t.insert=0);let s=new Uint8Array(t.w_size);s.set(Z.subarray(o-t.w_size,o),0),Z=s,o=t.w_size}const S=s.avail_in,a=s.next_in,O=s.input;for(s.avail_in=o,s.next_in=0,s.input=Z,p(t);t.lookahead>=3;){let s=t.strstart,Z=t.lookahead-2;do{t.ins_h=M(t,t.ins_h,t.window[s+3-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++}while(--Z);t.strstart=s,t.lookahead=2,p(t)}return t.strstart+=t.lookahead,t.block_start=t.strstart,t.insert=t.lookahead,t.lookahead=0,t.match_length=t.prev_length=2,t.match_available=0,s.next_in=a,s.input=O,s.avail_in=S,t.wrap=j,f},s.exports.deflateInfo="pako deflate (from Nodeca project)"},12259:s=>{"use strict";s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12254:s=>{"use strict";s.exports=function(s,Z){let o,t,j,S,a,O,v,G,B,Q,D,z,Y,b,f,A,d,U,u,H,F,i,N,L;const V=s.state;o=s.next_in,N=s.input,t=o+(s.avail_in-5),j=s.next_out,L=s.output,S=j-(Z-s.avail_out),a=j+(s.avail_out-257),O=V.dmax,v=V.wsize,G=V.whave,B=V.wnext,Q=V.window,D=V.hold,z=V.bits,Y=V.lencode,b=V.distcode,f=(1<<V.lenbits)-1,A=(1<<V.distbits)-1;s:do{z<15&&(D+=N[o++]<<z,z+=8,D+=N[o++]<<z,z+=8),d=Y[D&f];Z:for(;;){if(U=d>>>24,D>>>=U,z-=U,U=d>>>16&255,0===U)L[j++]=65535&d;else{if(!(16&U)){if(0===(64&U)){d=Y[(65535&d)+(D&(1<<U)-1)];continue Z}if(32&U){V.mode=12;break s}s.BZ="invalid literal/length code",V.mode=30;break s}u=65535&d,U&=15,U&&(z<U&&(D+=N[o++]<<z,z+=8),u+=D&(1<<U)-1,D>>>=U,z-=U),z<15&&(D+=N[o++]<<z,z+=8,D+=N[o++]<<z,z+=8),d=b[D&A];o:for(;;){if(U=d>>>24,D>>>=U,z-=U,U=d>>>16&255,!(16&U)){if(0===(64&U)){d=b[(65535&d)+(D&(1<<U)-1)];continue o}s.BZ="invalid distance code",V.mode=30;break s}if(H=65535&d,U&=15,z<U&&(D+=N[o++]<<z,z+=8,z<U&&(D+=N[o++]<<z,z+=8)),H+=D&(1<<U)-1,H>O){s.BZ="invalid distance too far back",V.mode=30;break s}if(D>>>=U,z-=U,U=j-S,H>U){if(U=H-U,U>G&&V.sane){s.BZ="invalid distance too far back",V.mode=30;break s}if(F=0,i=Q,0===B){if(F+=v-U,U<u){u-=U;do{L[j++]=Q[F++]}while(--U);F=j-H,i=L}}else if(B<U){if(F+=v+B-U,U-=B,U<u){u-=U;do{L[j++]=Q[F++]}while(--U);if(F=0,B<u){U=B,u-=U;do{L[j++]=Q[F++]}while(--U);F=j-H,i=L}}}else if(F+=B-U,U<u){u-=U;do{L[j++]=Q[F++]}while(--U);F=j-H,i=L}for(;u>2;)L[j++]=i[F++],L[j++]=i[F++],L[j++]=i[F++],u-=3;u&&(L[j++]=i[F++],u>1&&(L[j++]=i[F++]))}else{F=j-H;do{L[j++]=L[F++],L[j++]=L[F++],L[j++]=L[F++],u-=3}while(u>2);u&&(L[j++]=L[F++],u>1&&(L[j++]=L[F++]))}break}}break}}while(o<t&&j<a);u=z>>3,o-=u,z-=u<<3,D&=(1<<z)-1,s.next_in=o,s.next_out=j,s.avail_in=o<t?t-o+5:5-(o-t),s.avail_out=j<a?a-j+257:257-(j-a),V.hold=D,V.bits=z}},12247:(s,Z,o)=>{"use strict";const t=o(12202),j=o(12209),S=o(12254),a=o(12257),{Z_FINISH:O,Z_BLOCK:v,Z_TREES:G,Z_OK:B,Z_STREAM_END:Q,Z_NEED_DICT:D,Z_STREAM_ERROR:z,Z_DATA_ERROR:Y,Z_MEM_ERROR:b,Z_BUF_ERROR:f,Z_DEFLATED:A}=o(12226),d=12,U=30,u=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function H(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const F=s=>{if(!s||!s.state)return z;const Z=s.state;return s.total_in=s.total_out=Z.total=0,s.BZ="",Z.wrap&&(s.adler=1&Z.wrap),Z.mode=1,Z.last=0,Z.havedict=0,Z.dmax=32768,Z.head=null,Z.hold=0,Z.bits=0,Z.lencode=Z.lendyn=new Int32Array(852),Z.distcode=Z.distdyn=new Int32Array(592),Z.sane=1,Z.back=-1,B},i=s=>{if(!s||!s.state)return z;const Z=s.state;return Z.wsize=0,Z.whave=0,Z.wnext=0,F(s)},N=(s,Z)=>{let o;if(!s||!s.state)return z;const t=s.state;return Z<0?(o=0,Z=-Z):(o=1+(Z>>4),Z<48&&(Z&=15)),Z&&(Z<8||Z>15)?z:(null!==t.window&&t.wbits!==Z&&(t.window=null),t.wrap=o,t.wbits=Z,i(s))},L=(s,Z)=>{if(!s)return z;const o=new H;s.state=o,o.window=null;const t=N(s,Z);return t!==B&&(s.state=null),t};let V,g,l=!0;const R=s=>{if(l){V=new Int32Array(512),g=new Int32Array(32);let Z=0;for(;Z<144;)s.lens[Z++]=8;for(;Z<256;)s.lens[Z++]=9;for(;Z<280;)s.lens[Z++]=7;for(;Z<288;)s.lens[Z++]=8;for(a(1,s.lens,0,288,V,0,s.work,{bits:9}),Z=0;Z<32;)s.lens[Z++]=5;a(2,s.lens,0,32,g,0,s.work,{bits:5}),l=!1}s.lencode=V,s.lenbits=9,s.distcode=g,s.distbits=5},e=(s,Z,o,t)=>{let j;const S=s.state;return null===S.window&&(S.wsize=1<<S.wbits,S.wnext=0,S.whave=0,S.window=new Uint8Array(S.wsize)),t>=S.wsize?(S.window.set(Z.subarray(o-S.wsize,o),0),S.wnext=0,S.whave=S.wsize):(j=S.wsize-S.wnext,j>t&&(j=t),S.window.set(Z.subarray(o-t,o-t+j),S.wnext),(t-=j)?(S.window.set(Z.subarray(o-t,o),0),S.wnext=t,S.whave=S.wsize):(S.wnext+=j,S.wnext===S.wsize&&(S.wnext=0),S.whave<S.wsize&&(S.whave+=j))),0};s.exports.inflateReset=i,s.exports.inflateReset2=N,s.exports.inflateResetKeep=F,s.exports.inflateInit=s=>L(s,15),s.exports.inflateInit2=L,s.exports.inflate=(s,Z)=>{let o,H,F,i,N,L,V,g,l,c,w,X,W,q,h,M,x,k,y,I,C,K,p=0;const E=new Uint8Array(4);let P,r;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!s||!s.state||!s.output||!s.input&&0!==s.avail_in)return z;o=s.state,o.mode===d&&(o.mode=13),N=s.next_out,F=s.output,V=s.avail_out,i=s.next_in,H=s.input,L=s.avail_in,g=o.hold,l=o.bits,c=L,w=V,K=B;s:for(;;)switch(o.mode){case 1:if(0===o.wrap){o.mode=13;break}for(;l<16;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(2&o.wrap&&35615===g){o.check=0,E[0]=255&g,E[1]=g>>>8&255,o.check=j(o.check,E,2,0),g=0,l=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&g)<<8)+(g>>8))%31){s.BZ="incorrect header check",o.mode=U;break}if((15&g)!==A){s.BZ="unknown compression method",o.mode=U;break}if(g>>>=4,l-=4,C=8+(15&g),0===o.wbits)o.wbits=C;else if(C>o.wbits){s.BZ="invalid window size",o.mode=U;break}o.dmax=1<<o.wbits,s.adler=o.check=1,o.mode=512&g?10:d,g=0,l=0;break;case 2:for(;l<16;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(o.flags=g,(255&o.flags)!==A){s.BZ="unknown compression method",o.mode=U;break}if(57344&o.flags){s.BZ="unknown header flags set",o.mode=U;break}o.head&&(o.head.text=g>>8&1),512&o.flags&&(E[0]=255&g,E[1]=g>>>8&255,o.check=j(o.check,E,2,0)),g=0,l=0,o.mode=3;case 3:for(;l<32;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}o.head&&(o.head.time=g),512&o.flags&&(E[0]=255&g,E[1]=g>>>8&255,E[2]=g>>>16&255,E[3]=g>>>24&255,o.check=j(o.check,E,4,0)),g=0,l=0,o.mode=4;case 4:for(;l<16;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}o.head&&(o.head.xflags=255&g,o.head.os=g>>8),512&o.flags&&(E[0]=255&g,E[1]=g>>>8&255,o.check=j(o.check,E,2,0)),g=0,l=0,o.mode=5;case 5:if(1024&o.flags){for(;l<16;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}o.length=g,o.head&&(o.head.extra_len=g),512&o.flags&&(E[0]=255&g,E[1]=g>>>8&255,o.check=j(o.check,E,2,0)),g=0,l=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(X=o.length,X>L&&(X=L),X&&(o.head&&(C=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(H.subarray(i,i+X),C)),512&o.flags&&(o.check=j(o.check,H,X,i)),L-=X,i+=X,o.length-=X),o.length))break s;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(0===L)break s;X=0;do{C=H[i+X++],o.head&&C&&o.length<65536&&(o.head.name+=String.fromCharCode(C))}while(C&&X<L);if(512&o.flags&&(o.check=j(o.check,H,X,i)),L-=X,i+=X,C)break s}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(0===L)break s;X=0;do{C=H[i+X++],o.head&&C&&o.length<65536&&(o.head.comment+=String.fromCharCode(C))}while(C&&X<L);if(512&o.flags&&(o.check=j(o.check,H,X,i)),L-=X,i+=X,C)break s}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;l<16;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(g!==(65535&o.check)){s.BZ="header crc mismatch",o.mode=U;break}g=0,l=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),s.adler=o.check=0,o.mode=d;break;case 10:for(;l<32;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}s.adler=o.check=u(g),g=0,l=0,o.mode=11;case 11:if(0===o.havedict)return s.next_out=N,s.avail_out=V,s.next_in=i,s.avail_in=L,o.hold=g,o.bits=l,D;s.adler=o.check=1,o.mode=d;case d:if(Z===v||Z===G)break s;case 13:if(o.last){g>>>=7&l,l-=7&l,o.mode=27;break}for(;l<3;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}switch(o.last=1&g,g>>>=1,l-=1,3&g){case 0:o.mode=14;break;case 1:if(R(o),o.mode=20,Z===G){g>>>=2,l-=2;break s}break;case 2:o.mode=17;break;case 3:s.BZ="invalid block type",o.mode=U}g>>>=2,l-=2;break;case 14:for(g>>>=7&l,l-=7&l;l<32;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if((65535&g)!==(g>>>16^65535)){s.BZ="invalid stored block lengths",o.mode=U;break}if(o.length=65535&g,g=0,l=0,o.mode=15,Z===G)break s;case 15:o.mode=16;case 16:if(X=o.length,X){if(X>L&&(X=L),X>V&&(X=V),0===X)break s;F.set(H.subarray(i,i+X),N),L-=X,i+=X,V-=X,N+=X,o.length-=X;break}o.mode=d;break;case 17:for(;l<14;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(o.nlen=257+(31&g),g>>>=5,l-=5,o.ndist=1+(31&g),g>>>=5,l-=5,o.ncode=4+(15&g),g>>>=4,l-=4,o.nlen>286||o.ndist>30){s.BZ="too many length or distance symbols",o.mode=U;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;l<3;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}o.lens[T[o.have++]]=7&g,g>>>=3,l-=3}for(;o.have<19;)o.lens[T[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,P={bits:o.lenbits},K=a(0,o.lens,0,19,o.lencode,0,o.work,P),o.lenbits=P.bits,K){s.BZ="invalid code lengths set",o.mode=U;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;p=o.lencode[g&(1<<o.lenbits)-1],h=p>>>24,M=p>>>16&255,x=65535&p,!(h<=l);){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(x<16)g>>>=h,l-=h,o.lens[o.have++]=x;else{if(16===x){for(r=h+2;l<r;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(g>>>=h,l-=h,0===o.have){s.BZ="invalid bit length repeat",o.mode=U;break}C=o.lens[o.have-1],X=3+(3&g),g>>>=2,l-=2}else if(17===x){for(r=h+3;l<r;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}g>>>=h,l-=h,C=0,X=3+(7&g),g>>>=3,l-=3}else{for(r=h+7;l<r;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}g>>>=h,l-=h,C=0,X=11+(127&g),g>>>=7,l-=7}if(o.have+X>o.nlen+o.ndist){s.BZ="invalid bit length repeat",o.mode=U;break}for(;X--;)o.lens[o.have++]=C}}if(o.mode===U)break;if(0===o.lens[256]){s.BZ="invalid code -- missing end-of-block",o.mode=U;break}if(o.lenbits=9,P={bits:o.lenbits},K=a(1,o.lens,0,o.nlen,o.lencode,0,o.work,P),o.lenbits=P.bits,K){s.BZ="invalid literal/lengths set",o.mode=U;break}if(o.distbits=6,o.distcode=o.distdyn,P={bits:o.distbits},K=a(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,P),o.distbits=P.bits,K){s.BZ="invalid distances set",o.mode=U;break}if(o.mode=20,Z===G)break s;case 20:o.mode=21;case 21:if(L>=6&&V>=258){s.next_out=N,s.avail_out=V,s.next_in=i,s.avail_in=L,o.hold=g,o.bits=l,S(s,w),N=s.next_out,F=s.output,V=s.avail_out,i=s.next_in,H=s.input,L=s.avail_in,g=o.hold,l=o.bits,o.mode===d&&(o.back=-1);break}for(o.back=0;p=o.lencode[g&(1<<o.lenbits)-1],h=p>>>24,M=p>>>16&255,x=65535&p,!(h<=l);){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(M&&0===(240&M)){for(k=h,y=M,I=x;p=o.lencode[I+((g&(1<<k+y)-1)>>k)],h=p>>>24,M=p>>>16&255,x=65535&p,!(k+h<=l);){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}g>>>=k,l-=k,o.back+=k}if(g>>>=h,l-=h,o.back+=h,o.length=x,0===M){o.mode=26;break}if(32&M){o.back=-1,o.mode=d;break}if(64&M){s.BZ="invalid literal/length code",o.mode=U;break}o.extra=15&M,o.mode=22;case 22:if(o.extra){for(r=o.extra;l<r;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}o.length+=g&(1<<o.extra)-1,g>>>=o.extra,l-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;p=o.distcode[g&(1<<o.distbits)-1],h=p>>>24,M=p>>>16&255,x=65535&p,!(h<=l);){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(0===(240&M)){for(k=h,y=M,I=x;p=o.distcode[I+((g&(1<<k+y)-1)>>k)],h=p>>>24,M=p>>>16&255,x=65535&p,!(k+h<=l);){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}g>>>=k,l-=k,o.back+=k}if(g>>>=h,l-=h,o.back+=h,64&M){s.BZ="invalid distance code",o.mode=U;break}o.offset=x,o.extra=15&M,o.mode=24;case 24:if(o.extra){for(r=o.extra;l<r;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}o.offset+=g&(1<<o.extra)-1,g>>>=o.extra,l-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){s.BZ="invalid distance too far back",o.mode=U;break}o.mode=25;case 25:if(0===V)break s;if(X=w-V,o.offset>X){if(X=o.offset-X,X>o.whave&&o.sane){s.BZ="invalid distance too far back",o.mode=U;break}X>o.wnext?(X-=o.wnext,W=o.wsize-X):W=o.wnext-X,X>o.length&&(X=o.length),q=o.window}else q=F,W=N-o.offset,X=o.length;X>V&&(X=V),V-=X,o.length-=X;do{F[N++]=q[W++]}while(--X);0===o.length&&(o.mode=21);break;case 26:if(0===V)break s;F[N++]=o.length,V--,o.mode=21;break;case 27:if(o.wrap){for(;l<32;){if(0===L)break s;L--,g|=H[i++]<<l,l+=8}if(w-=V,s.total_out+=w,o.total+=w,w&&(s.adler=o.check=o.flags?j(o.check,F,w,N-w):t(o.check,F,w,N-w)),w=V,(o.flags?g:u(g))!==o.check){s.BZ="incorrect data check",o.mode=U;break}g=0,l=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;l<32;){if(0===L)break s;L--,g+=H[i++]<<l,l+=8}if(g!==(4294967295&o.total)){s.BZ="incorrect length check",o.mode=U;break}g=0,l=0}o.mode=29;case 29:K=Q;break s;case U:K=Y;break s;case 31:return b;default:return z}return s.next_out=N,s.avail_out=V,s.next_in=i,s.avail_in=L,o.hold=g,o.bits=l,(o.wsize||w!==s.avail_out&&o.mode<U&&(o.mode<27||Z!==O))&&e(s,s.output,s.next_out,w-s.avail_out)?(o.mode=31,b):(c-=s.avail_in,w-=s.avail_out,s.total_in+=c,s.total_out+=w,o.total+=w,o.wrap&&w&&(s.adler=o.check=o.flags?j(o.check,F,w,s.next_out-w):t(o.check,F,w,s.next_out-w)),s.data_type=o.bits+(o.last?64:0)+(o.mode===d?128:0)+(20===o.mode||15===o.mode?256:0),(0===c&&0===w||Z===O)&&K===B&&(K=f),K)},s.exports.inflateEnd=s=>{if(!s||!s.state)return z;let Z=s.state;return Z.window&&(Z.window=null),s.state=null,B},s.exports.inflateGetHeader=(s,Z)=>{if(!s||!s.state)return z;const o=s.state;return 0===(2&o.wrap)?z:(o.head=Z,Z.done=!1,B)},s.exports.inflateSetDictionary=(s,Z)=>{const o=Z.length;let j,S,a;return s&&s.state?(j=s.state,0!==j.wrap&&11!==j.mode?z:11===j.mode&&(S=1,S=t(S,Z,o,0),S!==j.check)?Y:(a=e(s,Z,o,o),a?(j.mode=31,b):(j.havedict=1,B))):z},s.exports.inflateInfo="pako inflate (from Nodeca project)"},12257:s=>{"use strict";const Z=15,o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),t=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),j=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),S=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);s.exports=(s,a,O,v,G,B,Q,D)=>{const z=D.bits;let Y,b,f,A,d,U,u=0,H=0,F=0,i=0,N=0,L=0,V=0,g=0,l=0,R=0,e=null,c=0;const w=new Uint16Array(16),X=new Uint16Array(16);let W,q,h,M=null,x=0;for(u=0;u<=Z;u++)w[u]=0;for(H=0;H<v;H++)w[a[O+H]]++;for(N=z,i=Z;i>=1&&0===w[i];i--);if(N>i&&(N=i),0===i)return G[B++]=20971520,G[B++]=20971520,D.bits=1,0;for(F=1;F<i&&0===w[F];F++);for(N<F&&(N=F),g=1,u=1;u<=Z;u++)if(g<<=1,g-=w[u],g<0)return-1;if(g>0&&(0===s||1!==i))return-1;for(X[1]=0,u=1;u<Z;u++)X[u+1]=X[u]+w[u];for(H=0;H<v;H++)0!==a[O+H]&&(Q[X[a[O+H]]++]=H);if(0===s?(e=M=Q,U=19):1===s?(e=o,c-=257,M=t,x-=257,U=256):(e=j,M=S,U=-1),R=0,H=0,u=F,d=B,L=N,V=0,f=-1,l=1<<N,A=l-1,1===s&&l>852||2===s&&l>592)return 1;for(;;){W=u-V,Q[H]<U?(q=0,h=Q[H]):Q[H]>U?(q=M[x+Q[H]],h=e[c+Q[H]]):(q=96,h=0),Y=1<<u-V,b=1<<L,F=b;do{b-=Y,G[d+(R>>V)+b]=W<<24|q<<16|h}while(0!==b);for(Y=1<<u-1;R&Y;)Y>>=1;if(0!==Y?(R&=Y-1,R+=Y):R=0,H++,0===--w[u]){if(u===i)break;u=a[O+Q[H]]}if(u>N&&(R&A)!==f){for(0===V&&(V=N),d+=F,L=u-V,g=1<<L;L+V<i&&(g-=w[L+V],!(g<=0));)L++,g<<=1;if(l+=1<<L,1===s&&l>852||2===s&&l>592)return 1;f=R&A,G[f]=N<<24|L<<16|d-B}}return 0!==R&&(G[d+R]=u-V<<24|64<<16),D.bits=N,0}},12218:s=>{"use strict";s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12198:s=>{"use strict";function Z(s){let Z=s.length;for(;--Z>=0;)s[Z]=0}const o=256,t=286,j=30,S=15,a=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),v=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),G=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),B=new Array(576);Z(B);const Q=new Array(60);Z(Q);const D=new Array(512);Z(D);const z=new Array(256);Z(z);const Y=new Array(29);Z(Y);const b=new Array(j);function f(s,Z,o,t,j){this.static_tree=s,this.extra_bits=Z,this.extra_base=o,this.elems=t,this.max_length=j,this.has_stree=s&&s.length}let A,d,U;function u(s,Z){this.dyn_tree=s,this.max_code=0,this.stat_desc=Z}Z(b);const H=s=>s<256?D[s]:D[256+(s>>>7)],F=(s,Z)=>{s.pending_buf[s.pending++]=255&Z,s.pending_buf[s.pending++]=Z>>>8&255},i=(s,Z,o)=>{s.bi_valid>16-o?(s.bi_buf|=Z<<s.bi_valid&65535,F(s,s.bi_buf),s.bi_buf=Z>>16-s.bi_valid,s.bi_valid+=o-16):(s.bi_buf|=Z<<s.bi_valid&65535,s.bi_valid+=o)},N=(s,Z,o)=>{i(s,o[2*Z],o[2*Z+1])},L=(s,Z)=>{let o=0;do{o|=1&s,s>>>=1,o<<=1}while(--Z>0);return o>>>1},V=(s,Z,o)=>{const t=new Array(16);let j,a,O=0;for(j=1;j<=S;j++)t[j]=O=O+o[j-1]<<1;for(a=0;a<=Z;a++){let Z=s[2*a+1];0!==Z&&(s[2*a]=L(t[Z]++,Z))}},g=s=>{let Z;for(Z=0;Z<t;Z++)s.dyn_ltree[2*Z]=0;for(Z=0;Z<j;Z++)s.dyn_dtree[2*Z]=0;for(Z=0;Z<19;Z++)s.bl_tree[2*Z]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.last_lit=s.matches=0},l=s=>{s.bi_valid>8?F(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},R=(s,Z,o,t)=>{const j=2*Z,S=2*o;return s[j]<s[S]||s[j]===s[S]&&t[Z]<=t[o]},e=(s,Z,o)=>{const t=s.heap[o];let j=o<<1;for(;j<=s.heap_len&&(j<s.heap_len&&R(Z,s.heap[j+1],s.heap[j],s.depth)&&j++,!R(Z,t,s.heap[j],s.depth));)s.heap[o]=s.heap[j],o=j,j<<=1;s.heap[o]=t},c=(s,Z,t)=>{let j,S,v,G,B=0;if(0!==s.last_lit)do{j=s.pending_buf[s.d_buf+2*B]<<8|s.pending_buf[s.d_buf+2*B+1],S=s.pending_buf[s.l_buf+B],B++,0===j?N(s,S,Z):(v=z[S],N(s,v+o+1,Z),G=a[v],0!==G&&(S-=Y[v],i(s,S,G)),j--,v=H(j),N(s,v,t),G=O[v],0!==G&&(j-=b[v],i(s,j,G)))}while(B<s.last_lit);N(s,256,Z)},w=(s,Z)=>{const o=Z.dyn_tree,t=Z.stat_desc.static_tree,j=Z.stat_desc.has_stree,a=Z.stat_desc.elems;let O,v,G,B=-1;for(s.heap_len=0,s.heap_max=573,O=0;O<a;O++)0!==o[2*O]?(s.heap[++s.heap_len]=B=O,s.depth[O]=0):o[2*O+1]=0;for(;s.heap_len<2;)G=s.heap[++s.heap_len]=B<2?++B:0,o[2*G]=1,s.depth[G]=0,s.opt_len--,j&&(s.static_len-=t[2*G+1]);for(Z.max_code=B,O=s.heap_len>>1;O>=1;O--)e(s,o,O);G=a;do{O=s.heap[1],s.heap[1]=s.heap[s.heap_len--],e(s,o,1),v=s.heap[1],s.heap[--s.heap_max]=O,s.heap[--s.heap_max]=v,o[2*G]=o[2*O]+o[2*v],s.depth[G]=(s.depth[O]>=s.depth[v]?s.depth[O]:s.depth[v])+1,o[2*O+1]=o[2*v+1]=G,s.heap[1]=G++,e(s,o,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((s,Z)=>{const o=Z.dyn_tree,t=Z.max_code,j=Z.stat_desc.static_tree,a=Z.stat_desc.has_stree,O=Z.stat_desc.extra_bits,v=Z.stat_desc.extra_base,G=Z.stat_desc.max_length;let B,Q,D,z,Y,b,f=0;for(z=0;z<=S;z++)s.bl_count[z]=0;for(o[2*s.heap[s.heap_max]+1]=0,B=s.heap_max+1;B<573;B++)Q=s.heap[B],z=o[2*o[2*Q+1]+1]+1,z>G&&(z=G,f++),o[2*Q+1]=z,Q>t||(s.bl_count[z]++,Y=0,Q>=v&&(Y=O[Q-v]),b=o[2*Q],s.opt_len+=b*(z+Y),a&&(s.static_len+=b*(j[2*Q+1]+Y)));if(0!==f){do{for(z=G-1;0===s.bl_count[z];)z--;s.bl_count[z]--,s.bl_count[z+1]+=2,s.bl_count[G]--,f-=2}while(f>0);for(z=G;0!==z;z--)for(Q=s.bl_count[z];0!==Q;)D=s.heap[--B],D>t||(o[2*D+1]!==z&&(s.opt_len+=(z-o[2*D+1])*o[2*D],o[2*D+1]=z),Q--)}})(s,Z),V(o,B,s.bl_count)},X=(s,Z,o)=>{let t,j,S=-1,a=Z[1],O=0,v=7,G=4;for(0===a&&(v=138,G=3),Z[2*(o+1)+1]=65535,t=0;t<=o;t++)j=a,a=Z[2*(t+1)+1],++O<v&&j===a||(O<G?s.bl_tree[2*j]+=O:0!==j?(j!==S&&s.bl_tree[2*j]++,s.bl_tree[32]++):O<=10?s.bl_tree[34]++:s.bl_tree[36]++,O=0,S=j,0===a?(v=138,G=3):j===a?(v=6,G=3):(v=7,G=4))},W=(s,Z,o)=>{let t,j,S=-1,a=Z[1],O=0,v=7,G=4;for(0===a&&(v=138,G=3),t=0;t<=o;t++)if(j=a,a=Z[2*(t+1)+1],!(++O<v&&j===a)){if(O<G)do{N(s,j,s.bl_tree)}while(0!==--O);else 0!==j?(j!==S&&(N(s,j,s.bl_tree),O--),N(s,16,s.bl_tree),i(s,O-3,2)):O<=10?(N(s,17,s.bl_tree),i(s,O-3,3)):(N(s,18,s.bl_tree),i(s,O-11,7));O=0,S=j,0===a?(v=138,G=3):j===a?(v=6,G=3):(v=7,G=4)}};let q=!1;const h=(s,Z,o,t)=>{i(s,0+(t?1:0),3),((s,Z,o,t)=>{l(s),t&&(F(s,o),F(s,~o)),s.pending_buf.set(s.window.subarray(Z,Z+o),s.pending),s.pending+=o})(s,Z,o,!0)};s.exports._tr_init=s=>{q||((()=>{let s,Z,o,G,u;const H=new Array(16);for(o=0,G=0;G<28;G++)for(Y[G]=o,s=0;s<1<<a[G];s++)z[o++]=G;for(z[o-1]=G,u=0,G=0;G<16;G++)for(b[G]=u,s=0;s<1<<O[G];s++)D[u++]=G;for(u>>=7;G<j;G++)for(b[G]=u<<7,s=0;s<1<<O[G]-7;s++)D[256+u++]=G;for(Z=0;Z<=S;Z++)H[Z]=0;for(s=0;s<=143;)B[2*s+1]=8,s++,H[8]++;for(;s<=255;)B[2*s+1]=9,s++,H[9]++;for(;s<=279;)B[2*s+1]=7,s++,H[7]++;for(;s<=287;)B[2*s+1]=8,s++,H[8]++;for(V(B,287,H),s=0;s<j;s++)Q[2*s+1]=5,Q[2*s]=L(s,5);A=new f(B,a,257,t,S),d=new f(Q,O,0,j,S),U=new f(new Array(0),v,0,19,7)})(),q=!0),s.l_desc=new u(s.dyn_ltree,A),s.d_desc=new u(s.dyn_dtree,d),s.bl_desc=new u(s.bl_tree,U),s.bi_buf=0,s.bi_valid=0,g(s)},s.exports._tr_stored_block=h,s.exports._tr_flush_block=(s,Z,t,j)=>{let S,a,O=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(s=>{let Z,t=4093624447;for(Z=0;Z<=31;Z++,t>>>=1)if(1&t&&0!==s.dyn_ltree[2*Z])return 0;if(0!==s.dyn_ltree[18]||0!==s.dyn_ltree[20]||0!==s.dyn_ltree[26])return 1;for(Z=32;Z<o;Z++)if(0!==s.dyn_ltree[2*Z])return 1;return 0})(s)),w(s,s.l_desc),w(s,s.d_desc),O=(s=>{let Z;for(X(s,s.dyn_ltree,s.l_desc.max_code),X(s,s.dyn_dtree,s.d_desc.max_code),w(s,s.bl_desc),Z=18;Z>=3&&0===s.bl_tree[2*G[Z]+1];Z--);return s.opt_len+=3*(Z+1)+5+5+4,Z})(s),S=s.opt_len+3+7>>>3,a=s.static_len+3+7>>>3,a<=S&&(S=a)):S=a=t+5,t+4<=S&&-1!==Z?h(s,Z,t,j):4===s.strategy||a===S?(i(s,2+(j?1:0),3),c(s,B,Q)):(i(s,4+(j?1:0),3),((s,Z,o,t)=>{let j;for(i(s,Z-257,5),i(s,o-1,5),i(s,t-4,4),j=0;j<t;j++)i(s,s.bl_tree[2*G[j]+1],3);W(s,s.dyn_ltree,Z-1),W(s,s.dyn_dtree,o-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,O+1),c(s,s.dyn_ltree,s.dyn_dtree)),g(s),j&&l(s)},s.exports._tr_tally=(s,Z,t)=>(s.pending_buf[s.d_buf+2*s.last_lit]=Z>>>8&255,s.pending_buf[s.d_buf+2*s.last_lit+1]=255&Z,s.pending_buf[s.l_buf+s.last_lit]=255&t,s.last_lit++,0===Z?s.dyn_ltree[2*t]++:(s.matches++,Z--,s.dyn_ltree[2*(z[t]+o+1)]++,s.dyn_dtree[2*H(Z)]++),s.last_lit===s.lit_bufsize-1),s.exports._tr_align=s=>{i(s,2,3),N(s,256,B),(s=>{16===s.bi_valid?(F(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)})(s)}},12236:s=>{"use strict";s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.BZ="",this.state=null,this.data_type=2,this.adler=0}},11887:s=>{function Z(s,Z,o){for(var t=s.length,j=-1/0,S=1/0,a=0;a<t;a++){var O=(o[0][a]-s[a])/Z[a],v=(o[1][a]-s[a])/Z[a];if(O>v){var G=O;O=v,v=G}if(v<j||O>S)return 1/0;O>j&&(j=O),v<S&&(S=v)}return j>S?1/0:j}s.exports=function(s,o,t,j){var S=Z(o,t,j);if(S===1/0)s=null;else{s=s||[];for(var a=0;a<o.length;a++)s[a]=o[a]+t[a]*S}return s},s.exports.distance=Z},13221:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>a});var t=o(40);const j=t.useLayoutEffect;const S=function(s){var Z=(0,t.useRef)(s);return j((function(){Z.current=s})),Z};var a=function(s){var Z=S(s);(0,t.OZ)((function(){var s=function(s){var o;if(null!=Z.current&&(o=Z.current(s)),s.defaultPrevented&&(s.returnValue=""),"string"===typeof o)return s.returnValue=o,o};return window.addEventListener("beforeunload",s),function(){window.removeEventListener("beforeunload",s)}}),[])}},13171:(s,Z,o)=>{"use strict";var t=o(13179),j=Array.prototype.concat,S=Array.prototype.slice,a=s.exports=function(s){for(var Z=[],o=0,a=s.length;o<a;o++){var O=s[o];t(O)?Z=j.call(Z,S.call(O)):Z.push(O)}return Z};a.wrap=function(s){return function(){return s(a(arguments))}}},13179:s=>{s.exports=function(s){return!(!s||"string"===typeof s)&&(s instanceof Array||Array.isArray(s)||s.length>=0&&(s.splice instanceof Function||Object.getOwnPropertyDescriptor(s,s.length-1)&&"String"!==s.constructor.name))}},12136:(s,Z,o)=>{var t=o(12141);function j(s){for(var Z,o,j=0,S=s.length,a=0;a<s.length;){for(Z=s[a],o=0;a<S&&s[a]===Z;)++a,++o;j+=t.log2(o)/7|0,j+=t.log2(Z>>>0)/7|0,j+=2}return j}Z.size=j,Z.encode=function(s,Z){Z||(Z=new Uint8Array(j(s)));for(var o,t,S=0,a=Z.length,O=0;O<s.length;){for(o=s[O],t=0;O<s.length&&s[O]===o;)++O,++t;for(;S<a&&t>=128;)Z[S++]=128+(127&t),t>>>=7;if(S>=a)throw new Error("RLE buffer overflow");for(Z[S++]=t,o>>>=0;S<a&&o>=128;)Z[S++]=128+(127&o),o>>>=7;if(S>=a)throw new Error("RLE buffer overflow");Z[S++]=o}return Z},Z.decode=function(s,Z){for(var o,t,j,S,a=Z.length,O=s.length,v=0,G=0;G<O;){for(o=0,t=0;G<O&&s[G]>=128;)o+=(127&s[G++])<<t,t+=7;if(o+=s[G++]<<t,G>=O)throw new Error("RLE buffer underrun");if(v+o>a)throw new Error("Chunk buffer overflow");for(j=0,t=0;G<O&&s[G]>=128;)j+=(127&s[G++])<<t,t+=7;if(G>=O)throw new Error("RLE buffer underrun");for(j+=s[G++]<<t,S=0;S<o;++S)Z[v++]=j}return Z}},12141:(s,Z)=>{"use strict";function o(s){var Z=32;return(s&=-s)&&Z--,65535&s&&(Z-=16),16711935&s&&(Z-=8),252645135&s&&(Z-=4),858993459&s&&(Z-=2),1431655765&s&&(Z-=1),Z}Z.INT_BITS=32,Z.INT_MAX=2147483647,Z.INT_MIN=-1<<31,Z.sign=function(s){return(s>0)-(s<0)},Z.abs=function(s){var Z=s>>31;return(s^Z)-Z},Z.min=function(s,Z){return Z^(s^Z)&-(s<Z)},Z.max=function(s,Z){return s^(s^Z)&-(s<Z)},Z.isPow2=function(s){return!(s&s-1)&&!!s},Z.log2=function(s){var Z,o;return Z=(s>65535)<<4,Z|=o=((s>>>=Z)>255)<<3,Z|=o=((s>>>=o)>15)<<2,(Z|=o=((s>>>=o)>3)<<1)|(s>>>=o)>>1},Z.log10=function(s){return s>=1e9?9:s>=1e8?8:s>=1e7?7:s>=1e6?6:s>=1e5?5:s>=1e4?4:s>=1e3?3:s>=100?2:s>=10?1:0},Z.popCount=function(s){return 16843009*((s=(858993459&(s-=s>>>1&1431655765))+(s>>>2&858993459))+(s>>>4)&252645135)>>>24},Z.countTrailingZeros=o,Z.nextPow2=function(s){return s+=0===s,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)+1},Z.prevPow2=function(s){return s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)-(s>>>1)},Z.parity=function(s){return s^=s>>>16,s^=s>>>8,s^=s>>>4,27030>>>(s&=15)&1};var t=new Array(256);!function(s){for(var Z=0;Z<256;++Z){var o=Z,t=Z,j=7;for(o>>>=1;o;o>>>=1)t<<=1,t|=1&o,--j;s[Z]=t<<j&255}}(t),Z.reverse=function(s){return t[255&s]<<24|t[s>>>8&255]<<16|t[s>>>16&255]<<8|t[s>>>24&255]},Z.interleave2=function(s,Z){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s&=65535)|s<<8))|s<<4))|s<<2))|s<<1))|(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))<<1},Z.deinterleave2=function(s,Z){return(s=65535&((s=16711935&((s=252645135&((s=858993459&((s=s>>>Z&1431655765)|s>>>1))|s>>>2))|s>>>4))|s>>>16))<<16>>16},Z.interleave3=function(s,Z,o){return s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2),(s|=(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},Z.deinterleave3=function(s,Z){return(s=1023&((s=4278190335&((s=251719695&((s=3272356035&((s=s>>>Z&1227133513)|s>>>2))|s>>>4))|s>>>8))|s>>>16))<<22>>22},Z.nextCombination=function(s){var Z=s|s-1;return Z+1|(~Z&-~Z)-1>>>o(s)+1}},12172:s=>{"use strict";s.exports=function(s,Z,o,t){var j=self||window;try{try{var S;try{S=new j.Blob([s])}catch(G){(S=new(j.BlobBuilder||j.WebKitBlobBuilder||j.MozBlobBuilder||j.MSBlobBuilder)).append(s),S=S.getBlob()}var a=j.URL||j.webkitURL,O=a.createObjectURL(S),v=new j[Z](O,o);return a.revokeObjectURL(O),v}catch(G){return new j[Z]("data:application/javascript,".concat(encodeURIComponent(s)),o)}}catch(G){if(!t)throw Error("Inline worker is not supported");return new j[Z](t,o)}}},11865:(s,Z,o)=>{"use strict";function t(s,Z,o,t,j){var S={};return Object.keys(t).forEach((function(s){S[s]=t[s]})),S.enumerable=!!S.enumerable,S.configurable=!!S.configurable,("value"in S||S.initializer)&&(S.writable=!0),S=o.slice().reverse().reduce((function(o,t){return t(s,Z,o)||o}),S),j&&void 0!==S.initializer&&(S.value=S.initializer?S.initializer.call(j):void 0,S.initializer=void 0),void 0===S.initializer&&(Object.defineProperty(s,Z,S),S=null),S}o.d(Z,{c:()=>t})},11861:(s,Z,o)=>{"use strict";function t(s,Z,o,t){o&&Object.defineProperty(s,Z,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(t):void 0})}o.d(Z,{d:()=>t})},13212:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>a,f:()=>Q,g:()=>O,h:()=>S,j:()=>v,m:()=>j,q:()=>G,u:()=>B});var t=o(11383);class j{constructor(){this._easingMode=j.EASINGMODE_EASEIN}setEasingMode(s){const Z=Math.min(Math.max(s,0),2);this._easingMode=Z}getEasingMode(){return this._easingMode}easeInCore(s){throw new Error("You must implement this method")}ease(s){switch(this._easingMode){case j.EASINGMODE_EASEIN:return this.easeInCore(s);case j.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-s)}return s>=.5?.5*(1-this.easeInCore(2*(1-s)))+.5:.5*this.easeInCore(2*s)}}j.EASINGMODE_EASEIN=0,j.EASINGMODE_EASEOUT=1,j.EASINGMODE_EASEINOUT=2;class S extends j{easeInCore(s){return s=Math.max(0,Math.min(1,s)),1-Math.sqrt(1-s*s)}}class a extends j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=s}easeInCore(s){const Z=Math.max(0,this.amplitude);return Math.pow(s,3)-s*Z*Math.sin(3.141592653589793*s)}}class O extends j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=s,this.bounciness=Z}easeInCore(s){const Z=Math.max(0,this.bounces);let o=this.bounciness;o<=1&&(o=1.001);const t=Math.pow(o,Z),j=1-o,S=(1-t)/j+.5*t,a=s*S,O=Math.log(-a*(1-o)+1)/Math.log(o),v=Math.floor(O),G=v+1,B=(1-Math.pow(o,v))/(j*S),Q=.5*(B+(1-Math.pow(o,G))/(j*S)),D=s-Q,z=Q-B;return-Math.pow(1/o,Z-v)/(z*z)*(D-z)*(D+z)}}class v extends j{easeInCore(s){return s*s*s}}class G extends j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=s,this.springiness=Z}easeInCore(s){let Z;const o=Math.max(0,this.oscillations),t=Math.max(0,this.springiness);return Z=0==t?s:(Math.exp(t*s)-1)/(Math.exp(t)-1),Z*Math.sin((6.283185307179586*o+1.5707963267948966)*s)}}class B extends j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=s}easeInCore(s){return this.exponent<=0?s:(Math.exp(this.exponent*s)-1)/(Math.exp(this.exponent)-1)}}class Q extends j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=s,this.y1=Z,this.x2=o,this.y2=t}easeInCore(s){return t.d.Interpolate(s,this.x1,this.y1,this.x2,this.y2)}}},12699:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>a});var t=o(10900),j=o(10911),S=o(11201);class a extends S.d{get _matrix(){return this._compose(),this.nQ}set _matrix(s){(s.updateFlag!==this.nQ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.nQ.O(s),this._markAsDirtyAndDecompose())}constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(s,Z.Ls(),!1),this.name=s,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=Z,this.nQ=(null===j||void 0===j?void 0:j.clone())??t.b.Identity(),this._restMatrix=S??this.nQ.clone(),this._bindMatrix=a??this.nQ.clone(),this._index=O,this._absoluteMatrix=new t.b,this._absoluteBindMatrix=new t.b,this._absoluteInverseBindMatrix=new t.b,this._finalMatrix=new t.b,Z.bones.push(this),this.setParent(o,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(s){this.setParent(s)}setParent(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==s){if(this.parent){const s=this.parent.children.indexOf(this);-1!==s&&this.parent.children.splice(s,1)}this._parentNode=s,this.parent&&this.parent.children.push(this),Z&&this._updateAbsoluteBindMatrices(),this.dG()}}getLocalMatrix(){return this._compose(),this.nQ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(s){this._restMatrix.O(s)}setRestPose(s){this.setRestMatrix(s)}getBindPose(){return this.getBindMatrix()}setBindMatrix(s){this.SO(s)}setBindPose(s){this.setBindMatrix(s)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const s=t.g.sO[0],Z=t.g.Quaternion[0],o=t.g.sO[1];this.getRestMatrix().decompose(s,Z,o),this._linkedTransformNode.position.O(o),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??t.e.Identity(),this._linkedTransformNode.rotationQuaternion.O(Z),this._linkedTransformNode.ZO.O(s)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(s){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=s,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.qO}set position(s){this._decompose(),this.qO.O(s),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(s){this.setRotation(s)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(s){this.setRotationQuaternion(s)}get ZO(){return this.getScale()}set ZO(s){this.setScale(s)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=t.n.Zero(),this._localRotation=t.e.Zero(),this.qO=t.n.Zero()),this.nQ.decompose(this._localScaling,this._localRotation,this.qO))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,t.b.ComposeToRef(this._localScaling,this._localRotation,this.qO,this.nQ)):this._needToCompose=!1)}SO(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.O(s),Z&&this._updateAbsoluteBindMatrices(),o?this._matrix=s:this.dG()}_updateAbsoluteBindMatrices(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(s||(s=this._bindMatrix),this.parent?s.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.O(s),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),Z)for(let o=0;o<this.children.length;o++)this.children[o]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}dG(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.dG(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.dG(),this._needToDecompose=!0}_updatePosition(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=this.getLocalMatrix();if(0==Z)j?(S.addAtIndex(12,s.x),S.addAtIndex(13,s.y),S.addAtIndex(14,s.z)):S.setTranslationFromFloats(s.x,s.y,s.z);else{let Z=null;o&&(Z=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=a._TmpMats[0],v=a._TmpVecs[0];this.parent?o&&Z?(O.O(this.parent.getAbsoluteMatrix()),O.multiplyToRef(Z,O)):O.O(this.parent.getAbsoluteMatrix()):t.b.IdentityToRef(O),j&&O.setTranslationFromFloats(0,0,0),O.invert(),t.n.TransformCoordinatesToRef(s,O,v),j?(S.addAtIndex(12,v.x),S.addAtIndex(13,v.y),S.addAtIndex(14,v.z)):S.setTranslationFromFloats(v.x,v.y,v.z)}this._markAsDirtyAndDecompose()}translate(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(s,Z,o,!0)}setPosition(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(s,Z,o,!1)}setAbsolutePosition(s,Z){this.setPosition(s,1,Z)}scale(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=this.getLocalMatrix(),O=a._TmpMats[0];t.b.ScalingToRef(s,Z,o,O),O.multiplyToRef(S,S),O.invert();for(const t of this.children){const j=t.getLocalMatrix();j.multiplyToRef(O,j),j.multiplyAtIndex(12,s),j.multiplyAtIndex(13,Z),j.multiplyAtIndex(14,o),t._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),j)for(const t of this.children)t.scale(s,Z,o,j)}setScale(s){this._decompose(),this._localScaling.O(s),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(s){this._decompose(),s.O(this._localScaling)}setYawPitchRoll(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4?arguments[4]:void 0;if(0===j){const O=a._TmpQuat;return t.e.RotationYawPitchRollToRef(s,Z,o,O),void this.setRotationQuaternion(O,j,S)}const O=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,S))return;const v=a._TmpMats[1];t.b.RotationYawPitchRollToRef(s,Z,o,v),O.multiplyToRef(v,v),this._rotateWithMatrix(v,j,S)}rotate(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3?arguments[3]:void 0;const S=a._TmpMats[0];S.setTranslationFromFloats(0,0,0),t.b.RotationAxisToRef(s,Z,S),this._rotateWithMatrix(S,o,j)}setAxisAngle(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3?arguments[3]:void 0;if(0===o){const S=a._TmpQuat;return t.e.RotationAxisToRef(s,Z,S),void this.setRotationQuaternion(S,o,j)}const S=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,j))return;const O=a._TmpMats[1];t.b.RotationAxisToRef(s,Z,O),S.multiplyToRef(O,O),this._rotateWithMatrix(O,o,j)}setRotation(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(s.y,s.x,s.z,Z,o)}setRotationQuaternion(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===Z)return this._decompose(),this._localRotation.O(s),void this._markAsDirtyAndCompose();const j=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,o))return;const S=a._TmpMats[1];t.b.FromQuaternionToRef(s,S),j.multiplyToRef(S,S),this._rotateWithMatrix(S,Z,o)}setRotationMatrix(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===Z){const j=a._TmpQuat;return t.e.FromRotationMatrixToRef(s,j),void this.setRotationQuaternion(j,Z,o)}const j=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,o))return;const S=a._TmpMats[1];S.O(s),j.multiplyToRef(s,S),this._rotateWithMatrix(S,Z,o)}_rotateWithMatrix(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const t=this.getLocalMatrix(),j=t.m[12],S=t.m[13],O=t.m[14],v=this.getParent(),G=a._TmpMats[3],B=a._TmpMats[4];v&&1==Z?(o?(G.O(o.getWorldMatrix()),v.getAbsoluteMatrix().multiplyToRef(G,G)):G.O(v.getAbsoluteMatrix()),B.O(G),B.invert(),t.multiplyToRef(G,t),t.multiplyToRef(s,t),t.multiplyToRef(B,t)):1==Z&&o?(G.O(o.getWorldMatrix()),B.O(G),B.invert(),t.multiplyToRef(G,t),t.multiplyToRef(s,t),t.multiplyToRef(B,t)):t.multiplyToRef(s,t),t.setTranslationFromFloats(j,S,O),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(s,Z){const o=a._TmpMats[2];return s.O(this.getAbsoluteMatrix()),Z?(s.multiplyToRef(Z.getWorldMatrix(),s),t.b.ScalingToRef(Z.ZO.x,Z.ZO.y,Z.ZO.z,o)):t.b.IdentityToRef(o),s.invert(),!isNaN(s.m[0])&&(o.multiplyAtIndex(0,this._scalingDeterminant),s.multiplyToRef(o,s),!0)}Ka(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=t.n.Zero();return this.getPositionToRef(s,Z,o),o}getPositionToRef(){let s=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const s=this.getLocalMatrix();Z.x=s.m[12],Z.y=s.m[13],Z.z=s.m[14]}else{let o=null;s&&(o=s.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let t=a._TmpMats[0];s&&o?(t.O(this.getAbsoluteMatrix()),t.multiplyToRef(o,t)):t=this.getAbsoluteMatrix(),Z.x=t.m[12],Z.y=t.m[13],Z.z=t.m[14]}}getAbsolutePosition(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Z=t.n.Zero();return this.getPositionToRef(1,s,Z),Z}getAbsolutePositionToRef(s,Z){this.getPositionToRef(1,s,Z)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.nQ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.O(this.nQ);const s=this._skeleton.getPoseMatrix();s&&this._absoluteMatrix.multiplyToRef(s,this._absoluteMatrix)}const s=this.children,Z=s.length;for(let o=0;o<Z;o++)s[o].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Bv(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=t.n.Zero();return this.getDirectionToRef(s,Z,o),o}getDirectionToRef(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,j=null;Z&&(j=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=a._TmpMats[0];S.O(this.getAbsoluteMatrix()),Z&&j&&S.multiplyToRef(j,S),t.n.TransformNormalToRef(s,S,o),o.normalize()}getRotation(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=t.n.Zero();return this.getRotationToRef(s,Z,o),o}getRotationToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;const t=a._TmpQuat;this.getRotationQuaternionToRef(s,Z,t),t.toEulerAnglesToRef(o)}getRotationQuaternion(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=t.e.Identity();return this.getRotationQuaternionToRef(s,Z,o),o}getRotationQuaternionToRef(){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),Z.O(this._localRotation);else{const o=a._TmpMats[0],t=this.getAbsoluteMatrix();s?t.multiplyToRef(s.getWorldMatrix(),o):o.O(t),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,Z,void 0)}}getRotationMatrix(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1?arguments[1]:void 0;const o=t.b.Identity();return this.getRotationMatrixToRef(s,Z,o),o}getRotationMatrixToRef(){let s=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(Z);else{const o=a._TmpMats[0],t=this.getAbsoluteMatrix();s?t.multiplyToRef(s.getWorldMatrix(),o):o.O(t),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(Z)}}getAbsolutePositionFromLocal(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=t.n.Zero();return this.getAbsolutePositionFromLocalToRef(s,Z,o),o}getAbsolutePositionFromLocalToRef(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,j=null;Z&&(j=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=a._TmpMats[0];S.O(this.getAbsoluteMatrix()),Z&&j&&S.multiplyToRef(j,S),t.n.TransformCoordinatesToRef(s,S,o)}getLocalPositionFromAbsolute(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=t.n.Zero();return this.getLocalPositionFromAbsoluteToRef(s,Z,o),o}getLocalPositionFromAbsoluteToRef(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,j=null;Z&&(j=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=a._TmpMats[0];S.O(this.getAbsoluteMatrix()),Z&&j&&S.multiplyToRef(j,S),S.invert(),t.n.TransformCoordinatesToRef(s,S,o)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const s=this._skeleton.bones.indexOf(this);if(-1!==s&&this._skeleton.bones.splice(s,1),this._parentNode&&this._parentNode.children){const s=this._parentNode.children,Z=s.indexOf(this);-1!==Z&&s.splice(Z,1)}super.dispose()}}a._TmpVecs=(0,j.e)(2,t.n.Zero),a._TmpQuat=t.e.Identity(),a._TmpMats=(0,j.e)(5,t.b.Identity)},13209:(s,Z,o)=>{"use strict";o.d(Z,{d:()=>w});var t=o(11086),j=o(11091),S=o(10932),a=o(10900),O=o(10935),v=o(11201),G=o(11240),B=o(11516),Q=o(10968),D=o(10904);class z{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(s){this._zoomStopsAnimation=s}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(s){this._idleRotationSpeed=s}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(s){this._idleRotationWaitTime=s}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(s){this._idleRotationSpinupTime=s}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(s){this._attachedCamera=s;const Z=this._attachedCamera.Ls();this._onPrePointerObservableObserver=Z.onPrePointerObservable.add((s=>{s.type!==B.b.POINTERDOWN?s.type===B.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const s=Q.c.Now;let Z=0;null!=this._lastFrameTime&&(Z=s-this._lastFrameTime),this._lastFrameTime=s,this._applyUserInteraction();const o=s-this._lastInteractionTime-this._idleRotationWaitTime,t=Math.max(Math.min(o/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*t,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(Z/1e3))}))}detach(){if(!this._attachedCamera)return;const s=this._attachedCamera.Ls();this._onPrePointerObservableObserver&&s.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(s){this._lastInteractionTime=s??Q.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<D.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let s=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(s=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?s:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Q.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Y=o(13212),b=o(11611);class f{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(s){if(this._autoTransitionRange===s)return;this._autoTransitionRange=s;const Z=this._attachedCamera;Z&&(s?this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((s=>{if(s&&(s.Ea(!0),s.getBoundingInfo)){const Z=s.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*Z,this.upperRadiusTransitionRange=.05*Z}})):this._onMeshTargetChangedObserver&&Z.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(s){this._attachedCamera=s,this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(s){return!!this._attachedCamera&&(this._attachedCamera.radius===s&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(s){if(!this._attachedCamera)return;this._radiusBounceTransition||(f.EasingFunction.setEasingMode(f.EasingMode),this._radiusBounceTransition=b.e.CreateAnimation("radius",b.e.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const Z=b.e.TransitionTo("radius",this._attachedCamera.radius+s,this._attachedCamera,this._attachedCamera.Ls(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));Z&&this._animatables.push(Z)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}f.EasingFunction=new Y.b(.3),f.EasingMode=Y.m.EASINGMODE_EASEOUT;class A{constructor(){this.onTargetFramingAnimationEndObservable=new S.b,this._mode=A.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(s){this._mode=s}get mode(){return this._mode}set radiusScale(s){this._radiusScale=s}get radiusScale(){return this._radiusScale}set positionScale(s){this._positionScale=s}get positionScale(){return this._positionScale}set defaultElevation(s){this._defaultElevation=s}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(s){this._elevationReturnTime=s}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(s){this._elevationReturnWaitTime=s}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(s){this._zoomStopsAnimation=s}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(s){this._framingTime=s}get framingTime(){return this._framingTime}init(){}attach(s){this._attachedCamera=s;const Z=this._attachedCamera.Ls();A.EasingFunction.setEasingMode(A.EasingMode),this._onPrePointerObservableObserver=Z.onPrePointerObservable.add((s=>{s.type!==B.b.POINTERDOWN?s.type===B.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=s.onMeshTargetChangedObservable.add((s=>{s&&s.getBoundingInfo&&this.zoomOnMesh(s,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const s=this._attachedCamera.Ls();this._onPrePointerObservableObserver&&s.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s.Ea(!0);const t=s.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(t.minimumWorld,t.maximumWorld,Z,o)}zoomOnMeshHierarchy(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s.Ea(!0);const t=s.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(t.min,t.max,Z,o)}zoomOnMeshesHierarchy(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new a.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new a.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let S=0;S<s.length;S++){const Z=s[S].getHierarchyBoundingVectors(!0);a.n.CheckExtends(Z.min,t,j),a.n.CheckExtends(Z.max,t,j)}this.zoomOnBoundingInfo(t,j,Z,o)}zoomOnBoundingInfo(s,Z){let o,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const S=s.y,O=S+(Z.y-S)*this._positionScale,v=Z.Go(s).scale(.5);if(!isFinite(O))return!1;if(t)o=new a.n(0,O,0);else{const Z=s.add(v);o=new a.n(Z.x,O,Z.z)}this._vectorTransition||(this._vectorTransition=b.e.CreateAnimation("target",b.e.ANIMATIONTYPE_VECTOR3,60,A.EasingFunction)),this._betaIsAnimating=!0;let G=b.e.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.Ls(),60,this._vectorTransition,this._framingTime);G&&this._animatables.push(G);let B=0;if(this._mode===A.FitFrustumSidesMode){const o=this._calculateLowerRadiusFromModelBoundingSphere(s,Z);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=v.length()+this._attachedCamera.OO),B=o}else this._mode===A.IgnoreBoundsSizeMode&&(B=this._calculateLowerRadiusFromModelBoundingSphere(s,Z),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.OO));if(this.autoCorrectCameraLimitsAndSensibility){const o=Z.Go(s).length();this._attachedCamera.panningSensibility=5e3/o,this._attachedCamera.wheelPrecision=100/B}return this._radiusTransition||(this._radiusTransition=b.e.CreateAnimation("radius",b.e.ANIMATIONTYPE_FLOAT,60,A.EasingFunction)),G=b.e.TransitionTo("radius",B,this._attachedCamera,this._attachedCamera.Ls(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),j&&j(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),G&&this._animatables.push(G),!0}_calculateLowerRadiusFromModelBoundingSphere(s,Z){const o=this._attachedCamera;if(!o)return 0;let t=o._calculateLowerRadiusFromModelBoundingSphere(s,Z,this._radiusScale);return o.lowerRadiusLimit&&this._mode===A.IgnoreBoundsSizeMode&&(t=t<o.lowerRadiusLimit?o.lowerRadiusLimit:t),o.upperRadiusLimit&&(t=t>o.upperRadiusLimit?o.upperRadiusLimit:t),t}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const s=Q.c.Now-this._lastInteractionTime,Z=.5*Math.PI-this._defaultElevation,o=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>o&&s>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=b.e.CreateAnimation("beta",b.e.ANIMATIONTYPE_FLOAT,60,A.EasingFunction));const s=b.e.TransitionTo("beta",Z,this._attachedCamera,this._attachedCamera.Ls(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));s&&this._animatables.push(s)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Q.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}A.EasingFunction=new Y.u,A.EasingMode=Y.m.EASINGMODE_EASEINOUT,A.IgnoreBoundsSizeMode=0,A.FitFrustumSidesMode=1;var d=o(11246),U=o(11468),u=o(12694),H=o(10938);class F{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(s){s=H.g.BackCompatCameraNoPreventDefault(arguments);const Z=this.camera.getEngine(),o=Z.getInputElement();let t=0,j=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=S=>{var a,O;const v=S.event,G="touch"===v.pointerType;if(S.type!==B.b.POINTERMOVE&&-1===this.buttons.indexOf(v.button))return;const Q=v.target;if(this._altKey=v.altKey,this._ctrlKey=v.ctrlKey,this._metaKey=v.metaKey,this._shiftKey=v.shiftKey,this._buttonsPressed=v.buttons,Z.isPointerLock){const s=v.movementX,Z=v.movementY;this.onTouch(null,s,Z),this._pointA=null,this._pointB=null}else{if(S.type!==B.b.POINTERDOWN&&S.type!==B.b.POINTERDOUBLETAP&&G&&(null===(a=this._pointA)||void 0===a?void 0:a.pointerId)!==v.pointerId&&(null===(O=this._pointB)||void 0===O?void 0:O.pointerId)!==v.pointerId)return;if(S.type!==B.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!G)if(S.type===B.b.POINTERDOUBLETAP)this.onDoubleTap(v.pointerType);else if(S.type!==B.b.POINTERUP||this._currentMousePointerIdDown!==v.pointerId&&!G){if(S.type===B.b.POINTERMOVE)if(s||v.preventDefault(),this._pointA&&null===this._pointB){const s=v.clientX-this._pointA.x,Z=v.clientY-this._pointA.y;this._pointA.x=v.clientX,this._pointA.y=v.clientY,this.onTouch(this._pointA,s,Z)}else if(this._pointA&&this._pointB){const s=this._pointA.pointerId===v.pointerId?this._pointA:this._pointB;s.x=v.clientX,s.y=v.clientY;const Z=this._pointA.x-this._pointB.x,o=this._pointA.y-this._pointB.y,a=Z*Z+o*o,O={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:v.pointerId,type:S.type};this.onMultiTouch(this._pointA,this._pointB,t,a,j,O),j=O,t=a}}else{try{null===Q||void 0===Q||Q.releasePointerCapture(v.pointerId)}catch(D){}G||(this._pointB=null),Z._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==v.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==v.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==t||j)&&(this.onMultiTouch(this._pointA,this._pointB,t,0,j,null),t=0,j=null),this._currentMousePointerIdDown=-1,this.onButtonUp(v),s||v.preventDefault()}else{try{null===Q||void 0===Q||Q.setPointerCapture(v.pointerId)}catch(D){}if(null===this._pointA)this._pointA={x:v.clientX,y:v.clientY,pointerId:v.pointerId,type:v.pointerType};else{if(null!==this._pointB)return;this._pointB={x:v.clientX,y:v.clientY,pointerId:v.pointerId,type:v.pointerType}}-1!==this._currentMousePointerIdDown||G||(this._currentMousePointerIdDown=v.pointerId),this.onButtonDown(v),s||(v.preventDefault(),o&&o.focus())}}},this._observer=this.camera.Ls()._inputManager._addCameraPointerObserver(this._pointerInput,B.b.POINTERDOWN|B.b.POINTERUP|B.b.POINTERMOVE|B.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,t=0,j=null,this.onLostFocus()},this._contextMenuBind=s=>this.onContextMenu(s),o&&o.addEventListener("contextmenu",this._contextMenuBind,!1);const S=this.camera.Ls().getEngine().getHostWindow();S&&H.g.RegisterTopRootEvents(S,[{name:"blur",handler:this._onLostFocus}])}SQ(){if(this._onLostFocus){const s=this.camera.Ls().getEngine().getHostWindow();s&&H.g.UnregisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ls()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const s=this.camera.Ls().getEngine().getInputElement();s&&s.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(s){}onTouch(s,Z,o){}onMultiTouch(s,Z,o,t,j,S){}onContextMenu(s){s.preventDefault()}onButtonDown(s){}onButtonUp(s){}onLostFocus(){}}(0,t.c)([(0,j.K)()],F.prototype,"buttons",void 0);class i extends F{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(s,Z){if(0!==this.panningSensibility&&s&&Z){const o=Z.x-s.x,t=Z.y-s.y;this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=t/this.panningSensibility}}_computePinchZoom(s,Z){const o=this.camera.radius||i.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=o*Math.sqrt(s)/Math.sqrt(Z):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(Z-s)*o*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(Z-s)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(s,Z,o){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-Z/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility):(this.camera.inertialAlphaOffset-=Z/this.angularSensibilityX,this.camera.inertialBetaOffset-=o/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(s,Z,o,t,j,S){0===o&&null===j||0===t&&null===S||(this.multiTouchPanAndZoom?(this._computePinchZoom(o,t),this._computeMultiTouchPanning(j,S)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(t)-Math.sqrt(o))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(o,t),this._isPinching=!0):this._computeMultiTouchPanning(j,S)):this.multiTouchPanning?this._computeMultiTouchPanning(j,S):this.pinchZoom&&this._computePinchZoom(o,t))}onButtonDown(s){this._isPanClick=s.button===this.camera._panningMouseButton}onButtonUp(s){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}i.MinimumRadiusForPinch=.001,(0,t.c)([(0,j.K)()],i.prototype,"buttons",void 0),(0,t.c)([(0,j.K)()],i.prototype,"angularSensibilityX",void 0),(0,t.c)([(0,j.K)()],i.prototype,"angularSensibilityY",void 0),(0,t.c)([(0,j.K)()],i.prototype,"pinchPrecision",void 0),(0,t.c)([(0,j.K)()],i.prototype,"pinchDeltaPercentage",void 0),(0,t.c)([(0,j.K)()],i.prototype,"useNaturalPinchZoom",void 0),(0,t.c)([(0,j.K)()],i.prototype,"pinchZoom",void 0),(0,t.c)([(0,j.K)()],i.prototype,"panningSensibility",void 0),(0,t.c)([(0,j.K)()],i.prototype,"multiTouchPanning",void 0),(0,t.c)([(0,j.K)()],i.prototype,"multiTouchPanAndZoom",void 0),u.e.ArcRotateCameraPointersInput=i;var N=o(11525);class L{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(s){s=H.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ls(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Z=>{const o=Z.event;if(!o.metaKey)if(Z.type===N.e.KEYDOWN){if(this._ctrlPressed=o.ctrlKey,this._altPressed=o.altKey,-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),o.preventDefault&&(s||o.preventDefault())}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){const Z=this._keys.indexOf(o.keyCode);Z>=0&&this._keys.splice(Z,1),o.preventDefault&&(s||o.preventDefault())}})))}SQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const s=this.camera;for(let Z=0;Z<this._keys.length;Z++){const o=this._keys[Z];-1!==this.keysLeft.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningX-=1/this.panningSensibility:s.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?s.inertialRadiusOffset+=1/this.zoomingSensibility:s.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningX+=1/this.panningSensibility:s.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?s.inertialRadiusOffset-=1/this.zoomingSensibility:s.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(o)&&s.useInputToRestoreState&&s.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,t.c)([(0,j.K)()],L.prototype,"keysUp",void 0),(0,t.c)([(0,j.K)()],L.prototype,"keysDown",void 0),(0,t.c)([(0,j.K)()],L.prototype,"keysLeft",void 0),(0,t.c)([(0,j.K)()],L.prototype,"keysRight",void 0),(0,t.c)([(0,j.K)()],L.prototype,"keysReset",void 0),(0,t.c)([(0,j.K)()],L.prototype,"panningSensibility",void 0),(0,t.c)([(0,j.K)()],L.prototype,"zoomingSensibility",void 0),(0,t.c)([(0,j.K)()],L.prototype,"useAltToZoom",void 0),(0,t.c)([(0,j.K)()],L.prototype,"angularSpeed",void 0),u.e.ArcRotateCameraKeyboardMoveInput=L;var V=o(11159),g=o(11532);class l{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new a.n(0,0,0),this._globalOffset=new a.n(0,0,0),this._inertialPanning=a.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(s,Z){let o=0;const t=.01*s*this.wheelDeltaPercentage*Z;return o=s>0?t/(1+this.wheelDeltaPercentage):t*(1+this.wheelDeltaPercentage),o}attachControl(s){s=H.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=Z=>{if(Z.type!==B.b.POINTERWHEEL)return;const o=Z.event;let t=0;const j=o.deltaMode===g.d.DOM_DELTA_LINE?40:1,S=-o.deltaY*j;if(this.customComputeDeltaFromMouseWheel)t=this.customComputeDeltaFromMouseWheel(S,this,o);else if(this.wheelDeltaPercentage){if(t=this._computeDeltaFromMouseWheelLegacyEvent(S,this.camera.radius),t>0){let s=this.camera.radius,Z=this.camera.inertialRadiusOffset+t;for(let o=0;o<20&&!(s<=Z)&&!(Math.abs(Z*this.camera.inertia)<.001);o++)s-=Z,Z*=this.camera.inertia;s=(0,O.Clamp)(s,0,Number.MAX_VALUE),t=this._computeDeltaFromMouseWheelLegacyEvent(S,s)}}else t=S/(40*this.wheelPrecision);t&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(t)):this.camera.inertialRadiusOffset+=t),o.preventDefault&&(s||o.preventDefault())},this._observer=this.camera.Ls()._inputManager._addCameraPointerObserver(this._wheel,B.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.tO(0)}SQ(){this._observer&&(this.camera.Ls()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const s=this.camera;0+s.inertialAlphaOffset+s.inertialBetaOffset+s.inertialRadiusOffset&&(this._updateHitPlane(),s.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(s.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const s=this.camera,Z=s.target.Go(s.position);this._hitPlane=V.b.FromPositionAndNormal(s.target,Z)}_getPosition(){const s=this.camera,Z=s.Ls(),o=Z.createPickingRay(Z.pointerX,Z.pointerY,a.b.Identity(),s,!1);0===s.targetScreenOffset.x&&0===s.targetScreenOffset.y||(this._viewOffset.set(s.targetScreenOffset.x,s.targetScreenOffset.y,0),s.getViewMatrix().invertToRef(s._cameraTransformMatrix),this._globalOffset=a.n.TransformNormal(this._viewOffset,s._cameraTransformMatrix),o.origin.addInPlace(this._globalOffset));let t=0;return this._hitPlane&&(t=o.intersectsPlane(this._hitPlane)??0),o.origin.addInPlace(o.direction.scaleInPlace(t))}_zoomToMouse(s){const Z=this.camera,o=1-Z.inertia;if(Z.lowerRadiusLimit){const t=Z.lowerRadiusLimit??0;Z.radius-(Z.inertialRadiusOffset+s)/o<t&&(s=(Z.radius-t)*o-Z.inertialRadiusOffset)}if(Z.upperRadiusLimit){const t=Z.upperRadiusLimit??0;Z.radius-(Z.inertialRadiusOffset+s)/o>t&&(s=(Z.radius-t)*o-Z.inertialRadiusOffset)}const t=s/o/Z.radius,j=this._getPosition(),S=a.g.sO[6];j.subtractToRef(Z.target,S),S.scaleInPlace(t),S.scaleInPlace(o),this._inertialPanning.addInPlace(S),Z.inertialRadiusOffset+=s}_zeroIfClose(s){Math.abs(s.x)<D.b&&(s.x=0),Math.abs(s.y)<D.b&&(s.y=0),Math.abs(s.z)<D.b&&(s.z=0)}}(0,t.c)([(0,j.K)()],l.prototype,"wheelPrecision",void 0),(0,t.c)([(0,j.K)()],l.prototype,"zoomToMouseLocation",void 0),(0,t.c)([(0,j.K)()],l.prototype,"wheelDeltaPercentage",void 0),u.e.ArcRotateCameraMouseWheelInput=l;class R extends u.h{constructor(s){super(s)}addMouseWheel(){return this.add(new l),this}addPointers(){return this.add(new i),this}addKeyboard(){return this.add(new L),this}}var e=o(10916);function c(s,Z){return isNaN(s)?Z:s}v.d.AddNodeConstructor("ArcRotateCamera",((s,Z)=>()=>new w(s,0,0,1,a.n.Zero(),Z)));class w extends U.b{get target(){return this._target}set target(s){this.setTarget(s)}get targetHost(){return this._targetHost}set targetHost(s){s&&this.setTarget(s)}getTarget(){return this.target}get position(){return this._position}set position(s){this.setPosition(s)}set upVector(s){this._upToYMatrix||(this._yToUpMatrix=new a.b,this._upToYMatrix=new a.b,this._upVector=a.n.Zero()),s.normalize(),this._upVector.O(s),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){a.b.RotationAlignToRef(a.n.UpReadOnly,this._upVector,this._yToUpMatrix),a.b.RotationAlignToRef(this._upVector,a.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const s=this.inputs.attached.pointers;return s?s.angularSensibilityX:0}set angularSensibilityX(s){const Z=this.inputs.attached.pointers;Z&&(Z.angularSensibilityX=s)}get angularSensibilityY(){const s=this.inputs.attached.pointers;return s?s.angularSensibilityY:0}set angularSensibilityY(s){const Z=this.inputs.attached.pointers;Z&&(Z.angularSensibilityY=s)}get pinchPrecision(){const s=this.inputs.attached.pointers;return s?s.pinchPrecision:0}set pinchPrecision(s){const Z=this.inputs.attached.pointers;Z&&(Z.pinchPrecision=s)}get pinchDeltaPercentage(){const s=this.inputs.attached.pointers;return s?s.pinchDeltaPercentage:0}set pinchDeltaPercentage(s){const Z=this.inputs.attached.pointers;Z&&(Z.pinchDeltaPercentage=s)}get useNaturalPinchZoom(){const s=this.inputs.attached.pointers;return!!s&&s.useNaturalPinchZoom}set useNaturalPinchZoom(s){const Z=this.inputs.attached.pointers;Z&&(Z.useNaturalPinchZoom=s)}get panningSensibility(){const s=this.inputs.attached.pointers;return s?s.panningSensibility:0}set panningSensibility(s){const Z=this.inputs.attached.pointers;Z&&(Z.panningSensibility=s)}get keysUp(){const s=this.inputs.attached.keyboard;return s?s.keysUp:[]}set keysUp(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUp=s)}get keysDown(){const s=this.inputs.attached.keyboard;return s?s.keysDown:[]}set keysDown(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDown=s)}get keysLeft(){const s=this.inputs.attached.keyboard;return s?s.keysLeft:[]}set keysLeft(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysLeft=s)}get keysRight(){const s=this.inputs.attached.keyboard;return s?s.keysRight:[]}set keysRight(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRight=s)}get wheelPrecision(){const s=this.inputs.attached.mousewheel;return s?s.wheelPrecision:0}set wheelPrecision(s){const Z=this.inputs.attached.mousewheel;Z&&(Z.wheelPrecision=s)}get zoomToMouseLocation(){const s=this.inputs.attached.mousewheel;return!!s&&s.zoomToMouseLocation}set zoomToMouseLocation(s){const Z=this.inputs.attached.mousewheel;Z&&(Z.zoomToMouseLocation=s)}get wheelDeltaPercentage(){const s=this.inputs.attached.mousewheel;return s?s.wheelDeltaPercentage:0}set wheelDeltaPercentage(s){const Z=this.inputs.attached.mousewheel;Z&&(Z.wheelDeltaPercentage=s)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(s){s!==this.useBouncingBehavior&&(s?(this._bouncingBehavior=new f,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(s){s!==this.useFramingBehavior&&(s?(this._framingBehavior=new A,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(s){s!==this.useAutoRotationBehavior&&(s?(this._autoRotationBehavior=new z,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(s,Z,o,t,j,O){var v;let G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(s,a.n.Zero(),O,G),v=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=a.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=a.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new a.b,this.panningAxis=new a.n(1,1,0),this._transformedDirection=new a.n,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new S.b,this.checkCollisions=!1,this.collisionRadius=new a.n(.5,.5,.5),this._previousPosition=a.n.Zero(),this._collisionVelocity=a.n.Zero(),this._newPosition=a.n.Zero(),this._computationVector=a.n.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new a.n(NaN,NaN,NaN),this._goalTargetScreenOffset=new a.j(NaN,NaN),this._onCollisionPositionChange=function(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o?(v.setPosition(Z),v.KD&&v.KD(o)):v._previousPosition.O(v._position);const t=Math.cos(v.alpha),j=Math.sin(v.alpha),S=Math.cos(v.beta);let a=Math.sin(v.beta);0===a&&(a=1e-4);const O=v._getTargetPosition();v._computationVector.Ja(v.radius*t*a,v.radius*S,v.radius*j*a),O.addToRef(v._computationVector,v._newPosition),v._position.O(v._newPosition);let G=v.upVector;v.allowUpsideDown&&v.beta<0&&(G=G.clone(),G=G.negate()),v._computeViewMatrix(v._position,O,G),v._viewMatrix.addAtIndex(12,v.targetScreenOffset.x),v._viewMatrix.addAtIndex(13,v.targetScreenOffset.y),v._collisionTriggered=!1},this._target=a.n.Zero(),j&&this.setTarget(j),this.alpha=Z,this.beta=o,this.radius=t,this.getViewMatrix(),this.inputs=new R(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new a.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=a.j.Zero()}_updateCache(s){s||super._updateCache(),this._cache._target.O(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.O(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const s=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?s.addToRef(this._targetBoundingCenter,this._target):this._target.O(s)}const s=this._getLockedTargetPosition();return s||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>D.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,S=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=S?this._currentInterpolationFactor=S:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=c(s,this._goalAlpha),this._goalBeta=c(Z,this._goalBeta),this._goalRadius=c(o,this._goalRadius),this._goalTarget.set(c(t.x,this._goalTarget.x),c(t.y,this._goalTarget.y),c(t.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(c(j.x,this._goalTargetScreenOffset.x),c(j.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,O.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,O.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,O.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,O.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const j=arguments;Z=H.g.BackCompatCameraNoPreventDefault(j),this._useCtrlForPanning=o,this._panningMouseButton=t,"boolean"===typeof j[0]&&(j.length>1&&(this._useCtrlForPanning=j[1]),j.length>2&&(this._panningMouseButton=j[2])),this.inputs.attachElement(Z),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}SQ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let s=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){s=!0;const Z=this.invertRotation?-1:1,o=this._calculateHandednessMultiplier();let t=this.inertialAlphaOffset*o;this.beta<0&&(t*=-1),this.alpha+=t*Z,this.beta+=this.inertialBetaOffset*Z,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<D.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<D.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*D.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){s=!0;const Z=new a.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),Z.multiplyInPlace(this.panningAxis),a.n.TransformNormalToRef(Z,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const s=this.upVector,Z=a.n.CrossToRef(this._transformedDirection,s,this._transformedDirection);a.n.CrossToRef(s,Z,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);a.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.O(this._transformedDirection)}else{if(this.parent){const s=a.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.transposeToRef(s),a.n.TransformCoordinatesToRef(this._transformedDirection,s,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*D.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*D.b&&(this.inertialPanningY=0)}if(s)this.stopInterpolation();else if(this._isInterpolating){let s=!1;const Z=this._scene.getEngine().getDeltaTime()/1e3,o=1-Math.pow(2,-Z/this._currentInterpolationFactor),t=c(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const Z=a.g.sO[0].set(c(this._goalTarget.x,this._target.x),c(this._goalTarget.y,this._target.y),c(this._goalTarget.z,this._target.z));a.n.LerpToRef(this.target,Z,o,this._target),10*a.n.Distance(this.target,Z)/t<D.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.O(Z),this.setTarget(this.target,!1,!0,!0)):s=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const Z=a.e.RotationAlphaBetaGammaToRef(c(this._goalAlpha,this.alpha),c(this._goalBeta,this.beta),0,a.g.Quaternion[0]),t=a.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,a.g.Quaternion[1]),j=a.e.SlerpToRef(t,Z,o,a.g.Quaternion[2]);j.normalize();const S=j.toAlphaBetaGammaToRef(a.g.sO[0]);if(this.alpha=S.x,this.beta=S.y,j.isApprox(Z,D.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const s=Z.toAlphaBetaGammaToRef(a.g.sO[0]);this.alpha=s.x,this.beta=s.y}else s=!0}if(isNaN(this._goalRadius)||(this.radius+=(t-this.radius)*o,Math.abs(t/this.radius-1)<D.b?(this._goalRadius=NaN,this.radius=t):s=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const Z=a.g.Vector2[0].set(c(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),c(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));a.j.LerpToRef(this.targetScreenOffset,Z,o,this.targetScreenOffset),a.j.Distance(this.targetScreenOffset,Z)<D.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.O(Z)):s=!0}this._isInterpolating=s}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||a.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const s=this.alpha;var Z,o;this.alpha=function(s){let Z=Math.PI/2;return 0===s.x&&0===s.z||(Z=Math.acos(s.x/Math.sqrt(Math.pow(s.x,2)+Math.pow(s.z,2)))),s.z<0&&(Z=2*Math.PI-Z),Z}(this._computationVector),this.beta=(Z=this._computationVector.y,o=this.radius,Math.acos(Z/o));const t=Math.round((s-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this._checkLimits()}setPosition(s){this._position.equals(s)||(this._position.O(s),this.rebuildAnglesAndRadius())}setTarget(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t=this.overrideCloneAlphaBetaRadius??t,s.Ea)Z&&s.getBoundingInfo?this._targetBoundingCenter=s.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,s.Ea(),this._targetHost=s,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const Z=s,t=this._getTargetPosition();if(t&&!o&&t.equals(Z))return;this._targetHost=null,this._target=Z,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}t||this.rebuildAnglesAndRadius()}_getViewMatrix(){const s=Math.cos(this.alpha),Z=Math.sin(this.alpha),o=Math.cos(this.beta);let t=Math.sin(this.beta);0===t&&(t=1e-4),0===this.radius&&(this.radius=1e-4);const j=this._getTargetPosition();if(this._computationVector.Ja(this.radius*s*t,this.radius*o,this.radius*Z*t),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||a.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),j.addToRef(this._computationVector,this._newPosition),this.Ls().collisionsEnabled&&this.checkCollisions){const s=this.Ls().collisionCoordinator;this._collider||(this._collider=s.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,s.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.O(this._newPosition);let s=this.upVector;this.allowUpsideDown&&t<0&&(s=s.negate()),this._computeViewMatrix(this._position,j,s),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.O(j),this._viewMatrix}zoomOn(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s=s||this.Ls().meshes;const o=G.d.MinMax(s);let t=this._calculateLowerRadiusFromModelBoundingSphere(o.min,o.max);if(t=Math.max(Math.min(t,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=t*this.zoomOnFactor,this.mode===d.e.ORTHOGRAPHIC_CAMERA){const s=this.Ls().getEngine().getAspectRatio(this),Z=t*this.zoomOnFactor/2;this.orthoLeft=-Z*s,this.orthoRight=Z*s,this.orthoBottom=-Z,this.orthoTop=Z}this.focusOn({min:o.min,max:o.max,distance:t},Z)}focusOn(s){let Z,o,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===s.min){const t=s||this.Ls().meshes;Z=G.d.MinMax(t),o=a.n.Distance(Z.min,Z.max)}else{Z=s,o=s.distance}this._target=G.d.Center(Z),t||(this.maxZ=2*o)}createRigCamera(s,Z){let o=0;switch(this.cameraRigMode){case d.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.e.RIG_MODE_VR:o=this._cameraRigParams.stereoHalfAngle*(0===Z?1:-1);break;case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o=this._cameraRigParams.stereoHalfAngle*(0===Z?-1:1)}const t=new w(s,this.alpha+o,this.beta,this.radius,this._target,this.Ls());return t._cameraRigParams={},t.isRigCamera=!0,t.rigParent=this,t.upVector=this.upVector,t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoBottom=this.orthoBottom,t.orthoTop=this.orthoTop,t}_updateRigCameras(){const s=this._rigCameras[0],Z=this._rigCameras[1];switch(s.beta=Z.beta=this.beta,this.cameraRigMode){case d.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.e.RIG_MODE_VR:s.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:s.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const t=a.n.Distance(s,Z),j=this.Ls().getEngine().getAspectRatio(this),S=Math.tan(this.fov/2),O=S*j,v=.5*t*o,G=v*Math.sqrt(1+1/(O*O)),B=v*Math.sqrt(1+1/(S*S));return Math.max(G,B)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,t.c)([(0,j.K)()],w.prototype,"alpha",void 0),(0,t.c)([(0,j.K)()],w.prototype,"beta",void 0),(0,t.c)([(0,j.K)()],w.prototype,"radius",void 0),(0,t.c)([(0,j.K)()],w.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,t.c)([(0,j.G)("target")],w.prototype,"_target",void 0),(0,t.c)([(0,j.v)("targetHost")],w.prototype,"_targetHost",void 0),(0,t.c)([(0,j.K)()],w.prototype,"inertialAlphaOffset",void 0),(0,t.c)([(0,j.K)()],w.prototype,"inertialBetaOffset",void 0),(0,t.c)([(0,j.K)()],w.prototype,"inertialRadiusOffset",void 0),(0,t.c)([(0,j.K)()],w.prototype,"lowerAlphaLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"upperAlphaLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"lowerBetaLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"upperBetaLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"lowerRadiusLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"upperRadiusLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"lowerTargetYLimit",void 0),(0,t.c)([(0,j.K)()],w.prototype,"inertialPanningX",void 0),(0,t.c)([(0,j.K)()],w.prototype,"inertialPanningY",void 0),(0,t.c)([(0,j.K)()],w.prototype,"pinchToPanMaxDistance",void 0),(0,t.c)([(0,j.K)()],w.prototype,"panningDistanceLimit",void 0),(0,t.c)([(0,j.G)()],w.prototype,"panningOriginTarget",void 0),(0,t.c)([(0,j.K)()],w.prototype,"panningInertia",void 0),(0,t.c)([(0,j.K)()],w.prototype,"zoomToMouseLocation",null),(0,t.c)([(0,j.K)()],w.prototype,"zoomOnFactor",void 0),(0,t.c)([(0,j.F)()],w.prototype,"targetScreenOffset",void 0),(0,t.c)([(0,j.K)()],w.prototype,"allowUpsideDown",void 0),(0,t.c)([(0,j.K)()],w.prototype,"useInputToRestoreState",void 0),(0,t.c)([(0,j.K)()],w.prototype,"restoreStateInterpolationFactor",void 0),(0,e.f)("BABYLON.ArcRotateCamera",w)},12694:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>a,h:()=>O});var t=o(10955),j=o(11167),S=o(11246),a={};class O{constructor(s){this.attachedToElement=!1,this.attached={},this.camera=s,this.checkInputs=()=>{}}add(s){const Z=s.getSimpleName();this.attached[Z]?t.b.Warn("camera input of type "+Z+" already exists on camera"):(this.attached[Z]=s,s.camera=this.camera,s.checkInputs&&(this.checkInputs=this._addCheckInputs(s.checkInputs.bind(s))),this.attachedToElement&&s.attachControl(this.noPreventDefault))}remove(s){for(const Z in this.attached){const o=this.attached[Z];if(o===s)return o.SQ(),o.camera=null,delete this.attached[Z],void this.rebuildInputCheck()}}removeByType(s){for(const Z in this.attached){const o=this.attached[Z];o.getClassName()===s&&(o.SQ(),o.camera=null,delete this.attached[Z],this.rebuildInputCheck())}}_addCheckInputs(s){const Z=this.checkInputs;return()=>{Z(),s()}}attachInput(s){this.attachedToElement&&s.attachControl(this.noPreventDefault)}attachElement(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){s=!S.e.ForceAttachControlToAlwaysPreventDefault&&s,this.attachedToElement=!0,this.noPreventDefault=s;for(const Z in this.attached)this.attached[Z].attachControl(s)}}detachElement(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const Z in this.attached)this.attached[Z].SQ(),s&&(this.attached[Z].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const s in this.attached){const Z=this.attached[s];Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(s){const Z={};for(const o in this.attached){const s=this.attached[o],t=j.c.Serialize(s);Z[s.getClassName()]=t}s.inputsmgr=Z}parse(s){const Z=s.inputsmgr;if(Z){this.clear();for(const s in Z){const o=a[s];if(o){const t=Z[s],S=j.c.Parse((()=>new o),t,null);this.add(S)}}}else for(const o in this.attached){const Z=a[this.attached[o].getClassName()];if(Z){const t=j.c.Parse((()=>new Z),s,null);this.remove(this.attached[o]),this.add(t)}}}}},12690:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>F});var t=o(11086),j=o(11091),S=o(10900),a=o(11468),O=o(12694),v=o(11525),G=o(10938);class B{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(s){s=G.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ls(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Z=>{const o=Z.event;if(!o.metaKey)if(Z.type===v.e.KEYDOWN){if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),s||o.preventDefault()}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){const Z=this._keys.indexOf(o.keyCode);Z>=0&&this._keys.splice(Z,1),s||o.preventDefault()}})))}SQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const s=this.camera;for(let Z=0;Z<this._keys.length;Z++){const o=this._keys[Z],t=s._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(o)?s._localDirection.Ja(-t,0,0):-1!==this.keysUp.indexOf(o)?s._localDirection.Ja(0,0,t):-1!==this.keysRight.indexOf(o)?s._localDirection.Ja(t,0,0):-1!==this.keysDown.indexOf(o)?s._localDirection.Ja(0,0,-t):-1!==this.keysUpward.indexOf(o)?s._localDirection.Ja(0,t,0):-1!==this.keysDownward.indexOf(o)?s._localDirection.Ja(0,-t,0):-1!==this.keysRotateLeft.indexOf(o)?(s._localDirection.Ja(0,0,0),s.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(o)?(s._localDirection.Ja(0,0,0),s.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(o)?(s._localDirection.Ja(0,0,0),s.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(o)&&(s._localDirection.Ja(0,0,0),s.cameraRotation.x+=this._getLocalRotation()),s.Ls().useRightHandedSystem&&(s._localDirection.z*=-1),s.getViewMatrix().invertToRef(s._cameraTransformMatrix),S.n.TransformNormalToRef(s._localDirection,s._cameraTransformMatrix,s._transformedDirection),s.cameraDirection.addInPlace(s._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const s=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*s}}(0,t.c)([(0,j.K)()],B.prototype,"keysUp",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysUpward",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysDown",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysDownward",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysLeft",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysRight",void 0),(0,t.c)([(0,j.K)()],B.prototype,"rotationSpeed",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysRotateLeft",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysRotateRight",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysRotateUp",void 0),(0,t.c)([(0,j.K)()],B.prototype,"keysRotateDown",void 0),O.e.FreeCameraKeyboardMoveInput=B;var Q=o(10932),D=o(11516);class z{constructor(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=s,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Q.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(s){s=G.g.BackCompatCameraNoPreventDefault(arguments);const Z=this.camera.getEngine(),o=Z.getInputElement();this._pointerInput||(this._pointerInput=t=>{const j=t.event,S="touch"===j.pointerType;if(!this.touchEnabled&&S)return;if(t.type!==D.b.POINTERMOVE&&-1===this.buttons.indexOf(j.button))return;const a=j.target;if(t.type===D.b.POINTERDOWN){if(S&&-1!==this._activePointerId||!S&&-1!==this._currentActiveButton)return;this._activePointerId=j.pointerId;try{null===a||void 0===a||a.setPointerCapture(j.pointerId)}catch(O){}-1===this._currentActiveButton&&(this._currentActiveButton=j.button),this._previousPosition={x:j.clientX,y:j.clientY},s||(j.preventDefault(),o&&o.focus()),Z.isPointerLock&&this._onMouseMove&&this._onMouseMove(t.event)}else if(t.type===D.b.POINTERUP){if(S&&this._activePointerId!==j.pointerId||!S&&this._currentActiveButton!==j.button)return;try{null===a||void 0===a||a.releasePointerCapture(j.pointerId)}catch(O){}this._currentActiveButton=-1,this._previousPosition=null,s||j.preventDefault(),this._activePointerId=-1}else if(t.type===D.b.POINTERMOVE&&(this._activePointerId===j.pointerId||!S))if(Z.isPointerLock&&this._onMouseMove)this._onMouseMove(t.event);else if(this._previousPosition){const Z=this.camera._calculateHandednessMultiplier(),o=(j.clientX-this._previousPosition.x)*Z,t=j.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=o/this.angularSensibility,this.camera.cameraRotation.x+=t/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:o,offsetY:t}),this._previousPosition={x:j.clientX,y:j.clientY},s||j.preventDefault()}}),this._onMouseMove=o=>{if(!Z.isPointerLock)return;const t=this.camera._calculateHandednessMultiplier(),j=o.movementX*t;this.camera.cameraRotation.y+=j/this.angularSensibility;const S=o.movementY;this.camera.cameraRotation.x+=S/this.angularSensibility,this._previousPosition=null,s||o.preventDefault()},this._observer=this.camera.Ls()._inputManager._addCameraPointerObserver(this._pointerInput,D.b.POINTERDOWN|D.b.POINTERUP|D.b.POINTERMOVE),o&&(this._contextMenuBind=s=>this.onContextMenu(s),o.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(s){s.preventDefault()}SQ(){if(this._observer){if(this.camera.Ls()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const s=this.camera.getEngine().getInputElement();s&&s.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,t.c)([(0,j.K)()],z.prototype,"buttons",void 0),(0,t.c)([(0,j.K)()],z.prototype,"angularSensibility",void 0),O.e.FreeCameraMouseInput=z;var Y,b=o(11532);class f{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Q.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(s){s=G.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=Z=>{if(Z.type!==D.b.POINTERWHEEL)return;const o=Z.event,t=o.deltaMode===b.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*t*o.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*t*o.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*t*o.deltaZ/this._normalize,o.preventDefault&&(s||o.preventDefault())},this._observer=this.camera.Ls()._inputManager._addCameraPointerObserver(this._wheel,D.b.POINTERWHEEL)}SQ(){this._observer&&(this.camera.Ls()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,t.c)([(0,j.K)()],f.prototype,"wheelPrecisionX",void 0),(0,t.c)([(0,j.K)()],f.prototype,"wheelPrecisionY",void 0),(0,t.c)([(0,j.K)()],f.prototype,"wheelPrecisionZ",void 0),function(s){s[s.MoveRelative=0]="MoveRelative",s[s.RotateRelative=1]="RotateRelative",s[s.MoveScene=2]="MoveScene"}(Y||(Y={}));class A extends f{constructor(){super(...arguments),this._moveRelative=S.n.Zero(),this._rotateRelative=S.n.Zero(),this._moveScene=S.n.Zero(),this._wheelXAction=Y.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Y.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(s){null===s&&this._wheelXAction!==Y.MoveRelative||(this._wheelXAction=Y.MoveRelative,this._wheelXActionCoordinate=s)}get wheelXMoveRelative(){return this._wheelXAction!==Y.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(s){null===s&&this._wheelYAction!==Y.MoveRelative||(this._wheelYAction=Y.MoveRelative,this._wheelYActionCoordinate=s)}get wheelYMoveRelative(){return this._wheelYAction!==Y.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(s){null===s&&this._wheelZAction!==Y.MoveRelative||(this._wheelZAction=Y.MoveRelative,this._wheelZActionCoordinate=s)}get wheelZMoveRelative(){return this._wheelZAction!==Y.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(s){null===s&&this._wheelXAction!==Y.RotateRelative||(this._wheelXAction=Y.RotateRelative,this._wheelXActionCoordinate=s)}get wheelXRotateRelative(){return this._wheelXAction!==Y.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(s){null===s&&this._wheelYAction!==Y.RotateRelative||(this._wheelYAction=Y.RotateRelative,this._wheelYActionCoordinate=s)}get wheelYRotateRelative(){return this._wheelYAction!==Y.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(s){null===s&&this._wheelZAction!==Y.RotateRelative||(this._wheelZAction=Y.RotateRelative,this._wheelZActionCoordinate=s)}get wheelZRotateRelative(){return this._wheelZAction!==Y.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(s){null===s&&this._wheelXAction!==Y.MoveScene||(this._wheelXAction=Y.MoveScene,this._wheelXActionCoordinate=s)}get wheelXMoveScene(){return this._wheelXAction!==Y.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(s){null===s&&this._wheelYAction!==Y.MoveScene||(this._wheelYAction=Y.MoveScene,this._wheelYActionCoordinate=s)}get wheelYMoveScene(){return this._wheelYAction!==Y.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(s){null===s&&this._wheelZAction!==Y.MoveScene||(this._wheelZAction=Y.MoveScene,this._wheelZActionCoordinate=s)}get wheelZMoveScene(){return this._wheelZAction!==Y.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.tO(0),this._rotateRelative.tO(0),this._moveScene.tO(0),this._updateCamera(),this.camera.Ls().useRightHandedSystem&&(this._moveRelative.z*=-1);const s=S.b.Zero();this.camera.getViewMatrix().invertToRef(s);const Z=S.n.Zero();S.n.TransformNormalToRef(this._moveRelative,s,Z),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(Z),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(s,Z,o){if(0===s)return;if(null===Z||null===o)return;let t=null;switch(Z){case Y.MoveRelative:t=this._moveRelative;break;case Y.RotateRelative:t=this._rotateRelative;break;case Y.MoveScene:t=this._moveScene}switch(o){case 0:t.set(s,0,0);break;case 1:t.set(0,s,0);break;case 2:t.set(0,0,s)}}}(0,t.c)([(0,j.K)()],A.prototype,"wheelXMoveRelative",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelYMoveRelative",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelZMoveRelative",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelXRotateRelative",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelYRotateRelative",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelZRotateRelative",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelXMoveScene",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelYMoveScene",null),(0,t.c)([(0,j.K)()],A.prototype,"wheelZMoveScene",null),O.e.FreeCameraMouseWheelInput=A;class d{constructor(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=s,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=G.g.IsSafari()}attachControl(s){s=G.g.BackCompatCameraNoPreventDefault(arguments);let Z=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=o=>{const t=o.event,j="mouse"===t.pointerType||this._isSafari&&"undefined"===typeof t.pointerType;if(this.allowMouse||!j)if(o.type===D.b.POINTERDOWN){if(s||t.preventDefault(),this._pointerPressed.push(t.pointerId),1!==this._pointerPressed.length)return;Z={x:t.clientX,y:t.clientY}}else if(o.type===D.b.POINTERUP){s||t.preventDefault();const o=this._pointerPressed.indexOf(t.pointerId);if(-1===o)return;if(this._pointerPressed.splice(o,1),0!=o)return;Z=null,this._offsetX=null,this._offsetY=null}else if(o.type===D.b.POINTERMOVE){if(s||t.preventDefault(),!Z)return;if(0!=this._pointerPressed.indexOf(t.pointerId))return;this._offsetX=t.clientX-Z.x,this._offsetY=-(t.clientY-Z.y)}}),this._observer=this.camera.Ls()._inputManager._addCameraPointerObserver(this._pointerInput,D.b.POINTERDOWN|D.b.POINTERUP|D.b.POINTERMOVE),this._onLostFocus){const s=this.camera.getEngine().getInputElement();s&&s.addEventListener("blur",this._onLostFocus)}}SQ(){if(this._pointerInput){if(this._observer&&(this.camera.Ls()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const s=this.camera.getEngine().getInputElement();s&&s.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const s=this.camera,Z=s._calculateHandednessMultiplier();s.cameraRotation.y=Z*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)s.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const Z=s._computeLocalCameraSpeed(),o=new S.n(0,0,0!==this.touchMoveSensibility?Z*this._offsetY/this.touchMoveSensibility:0);S.b.RotationYawPitchRollToRef(s.rotation.y,s.rotation.x,0,s._cameraRotationMatrix),s.cameraDirection.addInPlace(S.n.TransformCoordinates(o,s._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,t.c)([(0,j.K)()],d.prototype,"touchAngularSensibility",void 0),(0,t.c)([(0,j.K)()],d.prototype,"touchMoveSensibility",void 0),O.e.FreeCameraTouchInput=d;class U extends O.h{constructor(s){super(s),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new B),this}addMouse(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new z(s),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new A,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new d),this}clear(){super.clear(),this._mouseInput=null}}var u=o(10916),H=o(11013);class F extends a.b{get angularSensibility(){const s=this.inputs.attached.mouse;return s?s.angularSensibility:0}set angularSensibility(s){const Z=this.inputs.attached.mouse;Z&&(Z.angularSensibility=s)}get keysUp(){const s=this.inputs.attached.keyboard;return s?s.keysUp:[]}set keysUp(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUp=s)}get keysUpward(){const s=this.inputs.attached.keyboard;return s?s.keysUpward:[]}set keysUpward(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUpward=s)}get keysDown(){const s=this.inputs.attached.keyboard;return s?s.keysDown:[]}set keysDown(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDown=s)}get keysDownward(){const s=this.inputs.attached.keyboard;return s?s.keysDownward:[]}set keysDownward(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDownward=s)}get keysLeft(){const s=this.inputs.attached.keyboard;return s?s.keysLeft:[]}set keysLeft(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysLeft=s)}get keysRight(){const s=this.inputs.attached.keyboard;return s?s.keysRight:[]}set keysRight(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRight=s)}get keysRotateLeft(){const s=this.inputs.attached.keyboard;return s?s.keysRotateLeft:[]}set keysRotateLeft(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateLeft=s)}get keysRotateRight(){const s=this.inputs.attached.keyboard;return s?s.keysRotateRight:[]}set keysRotateRight(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateRight=s)}get keysRotateUp(){const s=this.inputs.attached.keyboard;return s?s.keysRotateUp:[]}set keysRotateUp(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateUp=s)}get keysRotateDown(){const s=this.inputs.attached.keyboard;return s?s.keysRotateDown:[]}set keysRotateDown(s){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateDown=s)}constructor(s,Z,o){var t;super(s,Z,o,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),t=this,this.ellipsoid=new S.n(.5,1,.5),this.ellipsoidOffset=new S.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=S.n.Zero(),this._diffPosition=S.n.Zero(),this._newPosition=S.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t._newPosition.O(Z),t._newPosition.subtractToRef(t._oldPosition,t._diffPosition),t._diffPosition.length()>H.e.CollisionsEpsilon&&(t.position.addToRef(t._diffPosition,t._deferredPositionUpdate),t._deferOnly?t._deferredUpdated=!0:t.position.O(t._deferredPositionUpdate),t.KD&&o&&t.KD(o))},this.inputs=new U(this),this.inputs.addKeyboard().addMouse()}attachControl(s,Z){Z=G.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(Z)}SQ(){this.inputs.detachElement(),this.cameraDirection=new S.n(0,0,0),this.cameraRotation=new S.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(s){this._collisionMask=isNaN(s)?-1:s}_collideWithWorld(s){let Z;Z=this.parent?S.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,Z.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const o=this.Ls().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let t=s;this.applyGravity&&(t=s.add(this.Ls().gravity)),o.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=S.n.Zero(),this._transformedDirection=S.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(s){this._needMoveForGravity=s}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ls().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"VY"}}(0,t.c)([(0,j.G)()],F.prototype,"ellipsoid",void 0),(0,t.c)([(0,j.G)()],F.prototype,"ellipsoidOffset",void 0),(0,t.c)([(0,j.K)()],F.prototype,"checkCollisions",void 0),(0,t.c)([(0,j.K)()],F.prototype,"applyGravity",void 0),(0,u.f)("BABYLON.FreeCamera",F)},13257:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>S});var t=o(11253),j=o(13259);class S{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=o,this.VB=[],this._maxBlockCapacity=Z||64,this._selectionContent=new t.b(1024),this._creationFunc=s}update(s,Z,o){j.c._CreateBlocks(s,Z,o,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}wG(s){for(let Z=0;Z<this.EG.length;Z++){this.EG[Z].addEntry(s)}}cG(s){for(let Z=0;Z<this.EG.length;Z++){this.EG[Z].removeEntry(s)}}select(s,Z){this._selectionContent.reset();for(let o=0;o<this.EG.length;o++){this.EG[o].select(s,this._selectionContent,Z)}return Z?this._selectionContent.concat(this.VB):this._selectionContent.concatWithNoDuplicate(this.VB),this._selectionContent}intersects(s,Z,o){this._selectionContent.reset();for(let t=0;t<this.EG.length;t++){this.EG[t].intersects(s,Z,this._selectionContent,o)}return o?this._selectionContent.concat(this.VB):this._selectionContent.concatWithNoDuplicate(this.VB),this._selectionContent}intersectsRay(s){this._selectionContent.reset();for(let Z=0;Z<this.EG.length;Z++){this.EG[Z].intersectsRay(s,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.VB),this._selectionContent}}S.CreationFuncForMeshes=(s,Z)=>{const o=s.getBoundingInfo();!s.isBlocked&&o.boundingBox.intersectsMinMax(Z.eB,Z.cB)&&Z.entries.push(s)},S.CreationFuncForSubMeshes=(s,Z)=>{s.getBoundingInfo().boundingBox.intersectsMinMax(Z.eB,Z.cB)&&Z.entries.push(s)}},13259:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>S});var t=o(10900),j=o(11133);class S{constructor(s,Z,o,t,j,S){this.entries=[],this.wB=new Array,this._capacity=o,this._depth=t,this._maxDepth=j,this._creationFunc=S,this._minPoint=s,this._maxPoint=Z,this.wB.push(s.clone()),this.wB.push(Z.clone()),this.wB.push(s.clone()),this.wB[2].x=Z.x,this.wB.push(s.clone()),this.wB[3].y=Z.y,this.wB.push(s.clone()),this.wB[4].z=Z.z,this.wB.push(Z.clone()),this.wB[5].z=s.z,this.wB.push(Z.clone()),this.wB[6].x=s.x,this.wB.push(Z.clone()),this.wB[7].y=s.y}get eZ(){return this._capacity}get eB(){return this._minPoint}get cB(){return this._maxPoint}addEntry(s){if(this.EG)for(let Z=0;Z<this.EG.length;Z++){this.EG[Z].addEntry(s)}else this._creationFunc(s,this),this.entries.length>this.eZ&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(s){if(this.EG){for(let Z=0;Z<this.EG.length;Z++){this.EG[Z].removeEntry(s)}return}const Z=this.entries.indexOf(s);Z>-1&&this.entries.splice(Z,1)}addEntries(s){for(let Z=0;Z<s.length;Z++){const o=s[Z];this.addEntry(o)}}select(s,Z,o){if(j.b.IsInFrustum(this.wB,s)){if(this.EG){for(let t=0;t<this.EG.length;t++){this.EG[t].select(s,Z,o)}return}o?Z.concat(this.entries):Z.concatWithNoDuplicate(this.entries)}}intersects(s,Z,o,t){if(j.b.IntersectsSphere(this._minPoint,this._maxPoint,s,Z)){if(this.EG){for(let j=0;j<this.EG.length;j++){this.EG[j].intersects(s,Z,o,t)}return}t?o.concat(this.entries):o.concatWithNoDuplicate(this.entries)}}intersectsRay(s,Z){if(s.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.EG){for(let o=0;o<this.EG.length;o++){this.EG[o].intersectsRay(s,Z)}return}Z.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){S._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(s,Z,o,j,a,O,v,G){v.EG=new Array;const B=new t.n((Z.x-s.x)/2,(Z.y-s.y)/2,(Z.z-s.z)/2);for(let t=0;t<2;t++)for(let Z=0;Z<2;Z++)for(let Q=0;Q<2;Q++){const D=s.add(B.multiplyByFloats(t,Z,Q)),z=s.add(B.multiplyByFloats(t+1,Z+1,Q+1)),Y=new S(D,z,j,a+1,O,G);Y.addEntries(o),v.EG.push(Y)}}}},13262:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>B});var t=o(11493),j=o(10900),S=o(11206),a=o(12446),O=o(11297),v=o(13257),G=o(10927);t.c.prototype.createOrUpdateSelectionOctree=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=this._getComponent(O.d.NAME_OCTREE);o||(o=new B(this),this.o(o)),this.NB||(this.NB=new v.b(v.b.CreationFuncForMeshes,s,Z));const t=this.getWorldExtends();return this.NB.update(t.min,t.max,this.meshes),this.NB},Object.defineProperty(t.c.prototype,"selectionOctree",{get:function(){return this.NB},enumerable:!0,configurable:!0}),S.b.prototype.createOrUpdateSubmeshesOctree=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const o=this.Ls();let t=o._getComponent(O.d.NAME_OCTREE);t||(t=new B(o),o.o(t)),this._submeshesOctree||(this._submeshesOctree=new v.b(v.b.CreationFuncForSubMeshes,s,Z)),this.Ea(!0);const j=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(j.minimumWorld,j.maximumWorld,this.vO),this._submeshesOctree};class B{constructor(s){this.name=O.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new a.b(j.n.Zero(),new j.n(1,1,1)),(s=s||G.c.LastCreatedScene)&&(this.fZ=s,this.fZ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.fZ.getActiveSubMeshCandidates=s=>this.getActiveSubMeshCandidates(s),this.fZ.getCollidingSubMeshCandidates=(s,Z)=>this.getCollidingSubMeshCandidates(s,Z),this.fZ.getIntersectingSubMeshCandidates=(s,Z)=>this.getIntersectingSubMeshCandidates(s,Z))}register(){this.fZ.onMeshRemovedObservable.add((s=>{const Z=this.fZ.selectionOctree;if(void 0!==Z&&null!==Z){const o=Z.VB.indexOf(s);-1!==o&&Z.VB.splice(o,1)}})),this.fZ.onMeshImportedObservable.add((s=>{const Z=this.fZ.selectionOctree;void 0!==Z&&null!==Z&&Z.wG(s)}))}getActiveMeshCandidates(){var s;return(null===(s=this.fZ.NB)||void 0===s?void 0:s.select(this.fZ.frustumPlanes))||this.fZ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(s){if(s._submeshesOctree&&s.useOctreeForRenderingSelection){return s._submeshesOctree.select(this.fZ.frustumPlanes)}return this.fZ._getDefaultSubMeshCandidates(s)}getIntersectingSubMeshCandidates(s,Z){if(s._submeshesOctree&&s.useOctreeForPicking){a.b.TransformToRef(Z,s.getWorldMatrix(),this._tempRay);return s._submeshesOctree.intersectsRay(this._tempRay)}return this.fZ._getDefaultSubMeshCandidates(s)}getCollidingSubMeshCandidates(s,Z){if(s._submeshesOctree&&s.useOctreeForCollisions){const o=Z._velocityWorldLength+Math.max(Z._radius.x,Z._radius.y,Z._radius.z);return s._submeshesOctree.intersects(Z._basePointWorld,o)}return this.fZ._getDefaultSubMeshCandidates(s)}rebuild(){}dispose(){}}},12446:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>z});var t=o(11493),j=o(11246),S=o(10904),a=o(10900),O=o(10911),v=o(11126),G=o(11223),B=o(10927),Q=o(11534);const D={internalPickerForMesh:void 0};class z{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.b;this.origin=s,this.direction=Z,this.length=o,this.epsilon=t}clone(){return new z(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=z._TmpVector3[0].Ja(s.x-o,s.y-o,s.z-o),j=z._TmpVector3[1].Ja(Z.x+o,Z.y+o,Z.z+o);let S,a,O,v,G=0,B=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>j.x)return!1}else if(S=1/this.direction.x,a=(t.x-this.origin.x)*S,O=(j.x-this.origin.x)*S,O===-1/0&&(O=1/0),a>O&&(v=a,a=O,O=v),G=Math.max(a,G),B=Math.min(O,B),G>B)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>j.y)return!1}else if(S=1/this.direction.y,a=(t.y-this.origin.y)*S,O=(j.y-this.origin.y)*S,O===-1/0&&(O=1/0),a>O&&(v=a,a=O,O=v),G=Math.max(a,G),B=Math.min(O,B),G>B)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>j.z)return!1}else if(S=1/this.direction.z,a=(t.z-this.origin.z)*S,O=(j.z-this.origin.z)*S,O===-1/0&&(O=1/0),a>O&&(v=a,a=O,O=v),G=Math.max(a,G),B=Math.min(O,B),G>B)return!1;return!0}intersectsBox(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(s.minimum,s.maximum,Z)}intersectsSphere(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=s.center.x-this.origin.x,t=s.center.y-this.origin.y,j=s.center.z-this.origin.z,S=o*o+t*t+j*j,a=s.radius+Z,O=a*a;if(S<=O)return!0;const v=o*this.direction.x+t*this.direction.y+j*this.direction.z;if(v<0)return!1;return S-v*v<=O}intersectsTriangle(s,Z,o){const t=z._TmpVector3[0],j=z._TmpVector3[1],S=z._TmpVector3[2],O=z._TmpVector3[3],G=z._TmpVector3[4];Z.subtractToRef(s,t),o.subtractToRef(s,j),a.n.CrossToRef(this.direction,j,S);const B=a.n.Dot(t,S);if(0===B)return null;const Q=1/B;this.origin.subtractToRef(s,O);const D=a.n.Dot(O,S)*Q;if(D<-this.epsilon||D>1+this.epsilon)return null;a.n.CrossToRef(O,t,G);const Y=a.n.Dot(this.direction,G)*Q;if(Y<-this.epsilon||D+Y>1+this.epsilon)return null;const b=a.n.Dot(j,G)*Q;return b>this.length?null:new v.d(1-D-Y,D,b)}intersectsPlane(s){let Z;const o=a.n.Dot(s.gt,this.direction);if(Math.abs(o)<9.99999997475243e-7)return null;{const t=a.n.Dot(s.gt,this.origin);return Z=(-s.d-t)/o,Z<0?Z<-9.99999997475243e-7?null:0:Z}}intersectsAxis(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(s){case"y":{const s=(this.origin.y-Z)/this.direction.y;return s>0?null:new a.n(this.origin.x+this.direction.x*-s,Z,this.origin.z+this.direction.z*-s)}case"x":{const s=(this.origin.x-Z)/this.direction.x;return s>0?null:new a.n(Z,this.origin.y+this.direction.y*-s,this.origin.z+this.direction.z*-s)}case"z":{const s=(this.origin.z-Z)/this.direction.z;return s>0?null:new a.n(this.origin.x+this.direction.x*-s,this.origin.y+this.direction.y*-s,Z)}default:return null}}intersectsMesh(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=a.g.Matrix[0];return s.getWorldMatrix().invertToRef(O),this._tmpRay?z.TransformToRef(this,O,this._tmpRay):this._tmpRay=z.Transform(this,O),s.intersects(this._tmpRay,Z,o,t,j,S)}intersectsMeshes(s,Z,o){o?o.length=0:o=[];for(let t=0;t<s.length;t++){const j=this.intersectsMesh(s[t],Z);j.hit&&o.push(j)}return o.sort(this._comparePickingInfo),o}_comparePickingInfo(s,Z){return s.distance<Z.distance?-1:s.distance>Z.distance?1:0}intersectionSegment(s,Z,o){const t=this.origin,j=a.g.sO[0],S=a.g.sO[1],O=a.g.sO[2],v=a.g.sO[3];Z.subtractToRef(s,j),this.direction.scaleToRef(z._Rayl,O),t.addToRef(O,S),s.subtractToRef(t,v);const G=a.n.Dot(j,j),B=a.n.Dot(j,O),Q=a.n.Dot(O,O),D=a.n.Dot(j,v),Y=a.n.Dot(O,v),b=G*Q-B*B;let f,A,d=b,U=b;b<z._Smallnum?(f=0,d=1,A=Y,U=Q):(f=B*Y-Q*D,A=G*Y-B*D,f<0?(f=0,A=Y,U=Q):f>d&&(f=d,A=Y+B,U=Q)),A<0?(A=0,-D<0?f=0:-D>G?f=d:(f=-D,d=G)):A>U&&(A=U,-D+B<0?f=0:-D+B>G?f=d:(f=-D+B,d=G));const u=Math.abs(f)<z._Smallnum?0:f/d,H=Math.abs(A)<z._Smallnum?0:A/U,F=a.g.sO[4];O.scaleToRef(H,F);const i=a.g.sO[5];j.scaleToRef(u,i),i.addInPlace(v);const N=a.g.sO[6];i.subtractToRef(F,N);return H>0&&H<=this.length&&N.lengthSquared()<o*o?i.length():-1}update(s,Z,o,t,j,S,O){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){z._RayDistant||(z._RayDistant=z.Zero()),z._RayDistant.unprojectRayToRef(s,Z,o,t,a.b.IdentityReadOnly,S,O);const v=a.g.Matrix[0];j.invertToRef(v),z.TransformToRef(z._RayDistant,v,this)}else this.unprojectRayToRef(s,Z,o,t,j,S,O);return this}static Zero(){return new z(a.n.Zero(),a.n.Zero())}static CreateNew(s,Z,o,t,j,S,a){return z.Zero().update(s,Z,o,t,j,S,a)}static CreateNewFromTo(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.b.IdentityReadOnly;const t=new z(new a.n(0,0,0),new a.n(0,0,0));return z.CreateFromToToRef(s,Z,t,o)}static CreateFromToToRef(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.b.IdentityReadOnly;o.origin.O(s);const j=Z.subtractToRef(s,o.direction),S=Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z);return o.length=S,o.direction.normalize(),z.TransformToRef(o,t,o)}static Transform(s,Z){const o=new z(new a.n(0,0,0),new a.n(0,0,0));return z.TransformToRef(s,Z,o),o}static TransformToRef(s,Z,o){a.n.TransformCoordinatesToRef(s.origin,Z,o.origin),a.n.TransformNormalToRef(s.direction,Z,o.direction),o.length=s.length,o.epsilon=s.epsilon;const t=o.direction,j=t.length();if(0!==j&&1!==j){const s=1/j;t.x*=s,t.y*=s,t.z*=s,o.length*=j}return o}unprojectRayToRef(s,Z,o,t,j,S,O){const v=a.g.Matrix[0];j.multiplyToRef(S,v),v.multiplyToRef(O,v),v.invert();const G=B.c.LastCreatedEngine,Q=a.g.sO[0];Q.x=s/o*2-1,Q.y=-(Z/t*2-1),Q.z=null!==G&&void 0!==G&&G.useReverseDepthBuffer?1:null!==G&&void 0!==G&&G.isNDCHalfZRange?0:-1;const D=a.g.sO[1].Ja(Q.x,Q.y,1-1e-8),z=a.g.sO[2],Y=a.g.sO[3];a.n._UnprojectFromInvertedMatrixToRef(Q,v,z),a.n._UnprojectFromInvertedMatrixToRef(D,v,Y),this.origin.O(z),Y.subtractToRef(z,this.direction),this.direction.normalize()}}function Y(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=z.Zero();return b(s,Z,o,t,a,j,S),a}function b(s,Z,o,t,j,S){let O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const G=s.getEngine();if(!S&&!(S=s.activeCamera))return s;const B=S.viewport,Q=G.getRenderHeight(),{x:D,y:z,width:Y,height:b}=B.toGlobal(G.getRenderWidth(),Q),f=1/G.getHardwareScalingLevel();return Z=Z*f-D,o=o*f-(Q-z-b),j.update(Z,o,Y,b,t||a.b.IdentityReadOnly,O?a.b.IdentityReadOnly:S.getViewMatrix(),S.getProjectionMatrix(),v),s}function f(s,Z,o,t,j){if(!G.b)return s;const S=s.getEngine();if(!j&&!(j=s.activeCamera))throw new Error("Active camera not set");const O=j.viewport,v=S.getRenderHeight(),{x:B,y:Q,width:D,height:z}=O.toGlobal(S.getRenderWidth(),v),Y=a.b.Identity(),b=1/S.getHardwareScalingLevel();return Z=Z*b-B,o=o*b-(v-Q-z),t.update(Z,o,D,z,Y,Y,j.getProjectionMatrix()),s}function A(s,Z,o,t,j,S,a,O){const v=Z(t,o.enableDistantPicking),G=o.intersects(v,j,a,S,t,O);return G&&G.hit?!j&&null!=s&&G.distance>=s.distance?null:G:null}function d(s,Z,o,t,j,S){let O=null;const v=!!(s.activeCameras&&s.activeCameras.length>1&&s.cameraToUseForPointers!==s.activeCamera),B=s.cameraToUseForPointers||s.activeCamera,Q=D.internalPickerForMesh||A;for(let G=0;G<s.meshes.length;G++){const D=s.meshes[G];if(o){if(!o(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.Uv)continue;const z=v&&D.isWorldMatrixCameraDependent(),Y=D.Ea(z,B);if(D.hasThinInstances&&D.thinInstanceEnablePicking){const s=Q(O,Z,D,Y,!0,!0,S);if(s){if(j)return s;const v=a.g.Matrix[1],G=D.thinInstanceGetWorldMatrices();for(let s=0;s<G.length;s++){if(o&&!o(D,s))continue;G[s].multiplyToRef(Y,v);const a=Q(O,Z,D,v,t,j,S,!0);if(a&&(O=a,O.thinInstanceIndex=s,t))return O}}}else{const s=Q(O,Z,D,Y,t,j,S);if(s&&(O=s,t))return O}}return O||new G.b}function U(s,Z,o,t){if(!G.b)return null;const j=[],S=!!(s.activeCameras&&s.activeCameras.length>1&&s.cameraToUseForPointers!==s.activeCamera),O=s.cameraToUseForPointers||s.activeCamera,v=D.internalPickerForMesh||A;for(let G=0;G<s.meshes.length;G++){const B=s.meshes[G];if(o){if(!o(B,-1))continue}else if(!B.isEnabled()||!B.isVisible||!B.Uv)continue;const Q=S&&B.isWorldMatrixCameraDependent(),D=B.Ea(Q,O);if(B.hasThinInstances&&B.thinInstanceEnablePicking){if(v(null,Z,B,D,!0,!0,t)){const s=a.g.Matrix[1],S=B.thinInstanceGetWorldMatrices();for(let a=0;a<S.length;a++){if(o&&!o(B,a))continue;S[a].multiplyToRef(D,s);const O=v(null,Z,B,s,!1,!1,t,!0);O&&(O.thinInstanceIndex=a,j.push(O))}}}else{const s=v(null,Z,B,D,!1,!1,t);s&&j.push(s)}}return j}function u(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0;t||(t=s.getWorldMatrix()),Z.length=o,j?Z.origin.O(j):Z.origin.O(s.position);const S=a.g.sO[2];S.set(0,0,s._scene.useRightHandedSystem?-1:1);const O=a.g.sO[3];return a.n.TransformNormalToRef(S,t,O),a.n.NormalizeToRef(O,Z.direction),Z}var H,F;z._TmpVector3=(0,O.e)(6,a.n.Zero),z._RayDistant=z.Zero(),z._Smallnum=1e-8,z._Rayl=1e9,H=t.c,(F=j.e)&&(F.prototype.getForwardRay=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;return u(this,new z(a.n.Zero(),a.n.Zero(),s),s,Z,o)},F.prototype.getForwardRayToRef=function(s){return u(this,s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),H&&(Q.c._IsPickingAvailable=!0,H.prototype.createPickingRay=function(s,Z,o,t){return Y(this,s,Z,o,t,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),t.c.prototype.createPickingRayToRef=function(s,Z,o,t,j){return b(this,s,Z,o,t,j,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},t.c.prototype.createPickingRayInCameraSpace=function(s,Z,o){return function(s,Z,o,t){const j=z.Zero();return f(s,Z,o,j,t),j}(this,s,Z,o)},t.c.prototype.createPickingRayInCameraSpaceToRef=function(s,Z,o,t){return f(this,s,Z,o,t)},t.c.prototype.pickWithBoundingInfo=function(s,Z,o,t,j){return function(s,Z,o,t,j,S){if(!G.b)return null;const O=d(s,(t=>(s._tempPickingRay||(s._tempPickingRay=z.Zero()),b(s,Z,o,t,s._tempPickingRay,S||null),s._tempPickingRay)),t,j,!0);return O&&(O.ray=Y(s,Z,o,a.b.Identity(),S||null)),O}(this,s,Z,o,t,j)},t.c.prototype.vo=function(s,Z,o,t,j,S){return function(s,Z,o,t,j,S,O){const v=d(s,((t,j)=>(s._tempPickingRay||(s._tempPickingRay=z.Zero()),b(s,Z,o,t,s._tempPickingRay,S||null,!1,j),s._tempPickingRay)),t,j,!1,O);return v&&(v.ray=Y(s,Z,o,a.b.Identity(),S||null)),v}(this,s,Z,o,t,j,S)},t.c.prototype.pickWithRay=function(s,Z,o,t){return function(s,Z,o,t,j){const S=d(s,(o=>(s._pickWithRayInverseMatrix||(s._pickWithRayInverseMatrix=a.b.Identity()),o.invertToRef(s._pickWithRayInverseMatrix),s._cachedRayForTransform||(s._cachedRayForTransform=z.Zero()),z.TransformToRef(Z,s._pickWithRayInverseMatrix,s._cachedRayForTransform),s._cachedRayForTransform)),o,t,!1,j);return S&&(S.ray=Z),S}(this,s,Z,o,t)},t.c.prototype.multiPick=function(s,Z,o,t,j){return function(s,Z,o,t,j,S){return U(s,(t=>Y(s,Z,o,t,j||null)),t,S)}(this,s,Z,o,t,j)},t.c.prototype.multiPickWithRay=function(s,Z,o){return function(s,Z,o,t){return U(s,(o=>(s._pickWithRayInverseMatrix||(s._pickWithRayInverseMatrix=a.b.Identity()),o.invertToRef(s._pickWithRayInverseMatrix),s._cachedRayForTransform||(s._cachedRayForTransform=z.Zero()),z.TransformToRef(Z,s._pickWithRayInverseMatrix,s._cachedRayForTransform),s._cachedRayForTransform)),o,t)}(this,s,Z,o)}},12747:(s,Z,o)=>{"use strict";var t=o(11044),j=o(10955),S=o(10982),a=o(11070),O=o(11013),v=o(11059);O.e.prototype._partialLoadFile=function(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(s,(s=>{o[Z]=s,o._internalCount++,6===o._internalCount&&t(o)}),void 0,void 0,!0,((s,Z)=>{j&&s&&j(s.status+" "+s.statusText,Z)}))},O.e.prototype._cascadeLoadFiles=function(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=[];j._internalCount=0;for(let S=0;S<6;S++)this._partialLoadFile(o[S],S,j,Z,t)},O.e.prototype._cascadeLoadImgs=function(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5?arguments[5]:void 0;const a=[];a._internalCount=0;for(let O=0;O<6;O++)this._partialLoadImg(t[O],O,a,s,Z,o,j,S)},O.e.prototype._partialLoadImg=function(s,Z,o,t,j,O){let v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0;const B=(0,a.c)();(0,S.x)(s,(s=>{o[Z]=s,o._internalCount++,t&&t.removePendingData(B),6===o._internalCount&&O&&O(j,o)}),((s,Z)=>{t&&t.removePendingData(B),v&&v(s,Z)}),t?t.offlineProvider:null,G),t&&t.addPendingData(B)},O.e.prototype.createCubeTextureBase=function(s,Z,o,S){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6?arguments[6]:void 0,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,A=arguments.length>14&&void 0!==arguments[14]&&arguments[14],d=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const U=Y||new t.b(this,7);U.isCube=!0,U.url=s,U.generateMipMaps=!S,U._lodGenerationScale=D,U._lodGenerationOffset=z,U._useSRGBBuffer=!!A&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!S),U!==Y&&(U.label=s.substring(0,60)),this._doNotHandleContextLost||(U._extension=B,U._files=o,U._buffer=d);const u=s;this._transformTextureUrl&&!Y&&(s=this._transformTextureUrl(s));const H=B??function(s){const Z=s.split("?")[0],o=Z.lastIndexOf(".");return o>-1?Z.substring(o).toLowerCase():""}(s),F=(0,v.c)(H),i=(s,Z)=>{U.dispose(),O?O(s,Z):s&&j.b.Warn(s)},N=(t,O)=>{s===u?t&&i(t.status+" "+t.statusText,O):(j.b.Warn(`Failed to load ${s}, falling back to the ${u}`),this.createCubeTextureBase(u,Z,o,!!S,a,i,G,B,Q,D,z,U,b,f,A,d))};if(F)F.then((t=>{const j=s=>{b&&b(U,s),t.loadCubeData(s,U,Q,a,((s,Z)=>{i(s,Z)}))};d?j(d):o&&6===o.length?t.supportCascades?this._cascadeLoadFiles(Z,(s=>j(s.map((s=>new Uint8Array(s))))),o,i):i("Textures type does not support cascades."):this._loadFile(s,(s=>j(new Uint8Array(s))),void 0,void 0,!0,N)}));else{if(!o||0===o.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(Z,U,((s,Z)=>{f&&f(s,Z)}),o,i)}return this._internalTexturesCache.push(U),U}},13265:(s,Z,o)=>{"use strict";o(10955);var t=o(11304);o(11044),o(11115),o(10924),o(11357),o(11318);t.d},12771:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>j});var t=o(10916);class j{constructor(s){this.value=this._toInt(s)}_toInt(s){return 0|s}add(s){return new j(this.value+s.value)}Go(s){return new j(this.value-s.value)}multiply(s){return new j(Math.imul(this.value,s.value))}divide(s){return new j(this.value/s.value)}getClassName(){return j.ClassName}equals(s){return this.value===s.value}static FromValue(s){return new j(s)}toString(){return this.value.toString()}}j.ClassName="FlowGraphInteger",(0,t.f)("FlowGraphInteger",j)},12784:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>j,d:()=>S});var t=o(10900);class j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.mQ=s}get m(){return this.mQ}transformVector(s){return this.transformVectorToRef(s,new t.j)}transformVectorToRef(s,Z){return Z.x=s.x*this.mQ[0]+s.y*this.mQ[1],Z.y=s.x*this.mQ[2]+s.y*this.mQ[3],Z}ma(){return this.toArray()}toArray(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let Z=0;Z<4;Z++)s[Z]=this.mQ[Z];return s}Bo(s){for(let Z=0;Z<4;Z++)this.mQ[Z]=s[Z];return this}multiplyToRef(s,Z){const o=s.mQ,t=this.mQ,j=Z.mQ;return j[0]=o[0]*t[0]+o[1]*t[2],j[1]=o[0]*t[1]+o[1]*t[3],j[2]=o[2]*t[0]+o[3]*t[2],j[3]=o[2]*t[1]+o[3]*t[3],Z}multiply(s){return this.multiplyToRef(s,new j)}divideToRef(s,Z){const o=this.mQ,t=s.mQ,j=Z.mQ;return j[0]=o[0]/t[0],j[1]=o[1]/t[1],j[2]=o[2]/t[2],j[3]=o[3]/t[3],Z}divide(s){return this.divideToRef(s,new j)}addToRef(s,Z){const o=this.mQ,t=s.m,j=Z.m;return j[0]=o[0]+t[0],j[1]=o[1]+t[1],j[2]=o[2]+t[2],j[3]=o[3]+t[3],Z}add(s){return this.addToRef(s,new j)}subtractToRef(s,Z){const o=this.mQ,t=s.m,j=Z.m;return j[0]=o[0]-t[0],j[1]=o[1]-t[1],j[2]=o[2]-t[2],j[3]=o[3]-t[3],Z}Go(s){return this.subtractToRef(s,new j)}transpose(){const s=this.mQ;return new j([s[0],s[2],s[1],s[3]])}determinant(){const s=this.mQ;return s[0]*s[3]-s[1]*s[2]}inverse(){const s=this.determinant();if(0===s)throw new Error("Matrix is not invertible");const Z=this.mQ,o=1/s;return new j([Z[3]*o,-Z[1]*o,-Z[2]*o,Z[0]*o])}equals(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.mQ,t=s.m;return 0===Z?o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]:Math.abs(o[0]-t[0])<Z&&Math.abs(o[1]-t[1])<Z&&Math.abs(o[2]-t[2])<Z&&Math.abs(o[3]-t[3])<Z}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.mQ.join(", ")})`}}class S{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.mQ=s}get m(){return this.mQ}transformVector(s){return this.transformVectorToRef(s,new t.n)}transformVectorToRef(s,Z){const o=this.mQ;return Z.x=s.x*o[0]+s.y*o[1]+s.z*o[2],Z.y=s.x*o[3]+s.y*o[4]+s.z*o[5],Z.z=s.x*o[6]+s.y*o[7]+s.z*o[8],Z}multiplyToRef(s,Z){const o=s.mQ,t=this.mQ,j=Z.m;return j[0]=o[0]*t[0]+o[1]*t[3]+o[2]*t[6],j[1]=o[0]*t[1]+o[1]*t[4]+o[2]*t[7],j[2]=o[0]*t[2]+o[1]*t[5]+o[2]*t[8],j[3]=o[3]*t[0]+o[4]*t[3]+o[5]*t[6],j[4]=o[3]*t[1]+o[4]*t[4]+o[5]*t[7],j[5]=o[3]*t[2]+o[4]*t[5]+o[5]*t[8],j[6]=o[6]*t[0]+o[7]*t[3]+o[8]*t[6],j[7]=o[6]*t[1]+o[7]*t[4]+o[8]*t[7],j[8]=o[6]*t[2]+o[7]*t[5]+o[8]*t[8],Z}multiply(s){return this.multiplyToRef(s,new S)}divideToRef(s,Z){const o=this.mQ,t=s.m,j=Z.m;return j[0]=o[0]/t[0],j[1]=o[1]/t[1],j[2]=o[2]/t[2],j[3]=o[3]/t[3],j[4]=o[4]/t[4],j[5]=o[5]/t[5],j[6]=o[6]/t[6],j[7]=o[7]/t[7],j[8]=o[8]/t[8],Z}divide(s){return this.divideToRef(s,new S)}addToRef(s,Z){const o=this.mQ,t=s.m,j=Z.m;return j[0]=o[0]+t[0],j[1]=o[1]+t[1],j[2]=o[2]+t[2],j[3]=o[3]+t[3],j[4]=o[4]+t[4],j[5]=o[5]+t[5],j[6]=o[6]+t[6],j[7]=o[7]+t[7],j[8]=o[8]+t[8],Z}add(s){return this.addToRef(s,new S)}subtractToRef(s,Z){const o=this.mQ,t=s.m,j=Z.m;return j[0]=o[0]-t[0],j[1]=o[1]-t[1],j[2]=o[2]-t[2],j[3]=o[3]-t[3],j[4]=o[4]-t[4],j[5]=o[5]-t[5],j[6]=o[6]-t[6],j[7]=o[7]-t[7],j[8]=o[8]-t[8],Z}Go(s){return this.subtractToRef(s,new S)}toArray(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let Z=0;Z<9;Z++)s[Z]=this.mQ[Z];return s}ma(){return this.toArray()}Bo(s){for(let Z=0;Z<9;Z++)this.mQ[Z]=s[Z];return this}transpose(){const s=this.mQ;return new S([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]])}determinant(){const s=this.mQ;return s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6])}inverse(){const s=this.determinant();if(0===s)throw new Error("Matrix is not invertible");const Z=this.mQ,o=1/s;return new S([(Z[4]*Z[8]-Z[5]*Z[7])*o,(Z[2]*Z[7]-Z[1]*Z[8])*o,(Z[1]*Z[5]-Z[2]*Z[4])*o,(Z[5]*Z[6]-Z[3]*Z[8])*o,(Z[0]*Z[8]-Z[2]*Z[6])*o,(Z[2]*Z[3]-Z[0]*Z[5])*o,(Z[3]*Z[7]-Z[4]*Z[6])*o,(Z[1]*Z[6]-Z[0]*Z[7])*o,(Z[0]*Z[4]-Z[1]*Z[3])*o])}equals(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.mQ,t=s.m;return 0===Z?o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&o[5]===t[5]&&o[6]===t[6]&&o[7]===t[7]&&o[8]===t[8]:Math.abs(o[0]-t[0])<Z&&Math.abs(o[1]-t[1])<Z&&Math.abs(o[2]-t[2])<Z&&Math.abs(o[3]-t[3])<Z&&Math.abs(o[4]-t[4])<Z&&Math.abs(o[5]-t[5])<Z&&Math.abs(o[6]-t[6])<Z&&Math.abs(o[7]-t[7])<Z&&Math.abs(o[8]-t[8])<Z}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.mQ.join(", ")})`}}},12792:(s,Z,o)=>{"use strict";var t;function j(s,Z,o,t){switch(Z){case"Animation":return t?s.animations.find((s=>s.uniqueId===o))??null:s.animations[o]??null;case"AnimationGroup":return t?s.animationGroups.find((s=>s.uniqueId===o))??null:s.animationGroups[o]??null;case"Mesh":return t?s.meshes.find((s=>s.uniqueId===o))??null:s.meshes[o]??null;case"Material":return t?s.materials.find((s=>s.uniqueId===o))??null:s.materials[o]??null;case"IG":return t?s.cameras.find((s=>s.uniqueId===o))??null:s.cameras[o]??null;case"Light":return t?s.lights.find((s=>s.uniqueId===o))??null:s.lights[o]??null;default:return null}}o.d(Z,{d:()=>j}),function(s){s.Animation="Animation",s.AnimationGroup="AnimationGroup",s.Mesh="Mesh",s.Material="Material",s.IG="IG",s.Light="Light"}(t||(t={}))},12828:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>j});var t=o(12831);class j extends t.b{constructor(s,Z){if(super(s),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),Z)for(const o of Z)this._eventsSignalOutputs[o]=this._registerSignalOutput(o+"Event")}_executeOnTick(s){}_startPendingTasks(s){s._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(s),this._resetAfterCanceled(s)),this._preparePendingTasks(s),s._addPendingBlock(this),this.out._activateSignal(s),s._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(s){s._deleteExecutionVariable(this,"_initialized"),s._removePendingBlock(this)}}},12802:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>G});var t=o(11070),j=o(10916),S=o(12811),a=o(10932),O=o(12766);class v extends S.b{constructor(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.defaultValue,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(s,Z,o),this.richType=t,this._defaultValue=j,this._optional=S,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new a.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(s){this._isDisabled!==s&&(this._isDisabled=s,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(s,Z){Z._getConnectionValue(this)!==s&&(Z._setConnectionValue(this,s),this.onValueChangedObservable.notifyObservers(s))}resetToDefaultValue(s){s._setConnectionValue(this,this._defaultValue)}connectTo(s){this._isDisabled||super.connectTo(s)}_getValueOrDefault(s){const Z=s._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(Z):Z}getValue(s){if(1===this.connectionType){s._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(s);const Z=this._getValueOrDefault(s);return this._lastValue=Z,this.richType.typeTransformer?this.richType.typeTransformer(Z):Z}const Z=this.isConnected()?this._connectedPoint[0].getValue(s):this._getValueOrDefault(s);return this._lastValue=Z,this.richType.typeTransformer?this.richType.typeTransformer(Z):Z}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(s),s.richType={},this.richType.serialize(s.richType),s.optional=this._optional,(0,O.g)("defaultValue",this._defaultValue,s)}}(0,j.f)("FlowGraphDataConnection",v);class G{constructor(s){var Z;this.config=s,this.uniqueId=(0,t.c)(),this.name=(null===(Z=this.config)||void 0===Z?void 0:Z.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(s){}registerDataInput(s,Z,o){const t=new v(s,0,this,Z,o);return this.dataInputs.push(t),t}registerDataOutput(s,Z,o){const t=new v(s,1,this,Z,o);return this.dataOutputs.push(t),t}getDataInput(s){return this.dataInputs.find((Z=>Z.name===s))}getDataOutput(s){return this.dataOutputs.find((Z=>Z.name===s))}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.g;if(s.uniqueId=this.uniqueId,s.config={},this.config){const o=this.config,t=Object.keys(o);for(const j of t)Z(j,o[j],s.config)}s.dataInputs=[],s.dataOutputs=[],s.className=this.getClassName();for(const o of this.dataInputs){const Z={};o.serialize(Z),s.dataInputs.push(Z)}for(const o of this.dataOutputs){const Z={};o.serialize(Z),s.dataOutputs.push(Z)}}deserialize(s){}_log(s,Z,o){var t;null===(t=s.logger)||void 0===t||t.addLogItem({action:Z,payload:o,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12811:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>S});var t,j=o(11070);!function(s){s[s.Input=0]="Input",s[s.Output=1]="Output"}(t||(t={}));class S{constructor(s,Z,o){this._ownerBlock=o,this._connectedPoint=[],this.uniqueId=(0,j.c)(),this.connectedPointIds=[],this.name=s,this._connectionType=Z}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(s){if(this._connectionType===s._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||s._isSingularConnection()&&s._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(s),s._connectedPoint.push(this)}disconnectFrom(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this._connectedPoint.indexOf(s),t=s._connectedPoint.indexOf(this);-1!==o&&-1!==t&&(Z&&this._connectedPoint.splice(o,1),s._connectedPoint.splice(t,1))}disconnectFromAll(){for(const s of this._connectedPoint)this.disconnectFrom(s,!1);this._connectedPoint.length=0}dispose(){for(const s of this._connectedPoint)this.disconnectFrom(s)}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.uniqueId=this.uniqueId,s.name=this.name,s._connectionType=this._connectionType,s.connectedPointIds=[],s.className=this.getClassName();for(const Z of this._connectedPoint)s.connectedPointIds.push(Z.uniqueId)}getClassName(){return"FGConnection"}deserialize(s){this.uniqueId=s.uniqueId,this.name=s.name,this._connectionType=s._connectionType,this.connectedPointIds=s.connectedPointIds}}},12763:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>U});var t,j=o(10932),S=o(11086),a=o(11091),O=o(11070),v=o(12766),G=o(12792),B=o(10955);!function(s){s.ExecuteBlock="ExecuteBlock",s.ExecuteEvent="ExecuteEvent",s.TriggerConnection="TriggerConnection",s.ContextVariableSet="ContextVariableSet",s.GlobalVariableSet="GlobalVariableSet",s.GlobalVariableDelete="GlobalVariableDelete",s.GlobalVariableGet="GlobalVariableGet",s.AddConnection="AddConnection",s.GetConnectionValue="GetConnectionValue",s.SetConnectionValue="SetConnectionValue",s.ActivateSignal="ActivateSignal",s.ContextVariableGet="ContextVariableGet"}(t||(t={}));class Q{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(s){if(s.time||(s.time=Date.now()),this.log.push(s),this.logToConsole){var Z;const o=null===(Z=s.payload)||void 0===Z?void 0:Z.value;"object"===typeof o&&o.getClassName?B.b.Log(`[FGLog] ${s.className}:${s.uniqueId.split("-")[0]} ${s.action} - ${JSON.stringify(o.getClassName())}: ${o.toString()}`):B.b.Log(`[FGLog] ${s.className}:${s.uniqueId.split("-")[0]} ${s.action} - ${JSON.stringify(s.payload)}`)}}getItemsOfType(s){return this.log.filter((Z=>Z.action===s))}}class D{get enableLogging(){return this._enableLogging}set enableLogging(s){this._enableLogging!==s&&(this._enableLogging=s,this._enableLogging?(this.logger=new Q,this.logger.logToConsole=!0):this.logger=null)}constructor(s){this.uniqueId=(0,O.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new j.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=s,this.assetsContext=s.assetsContext??s.fZ}hasVariable(s){return s in this._userVariables}setVariable(s,Z){var o;this._userVariables[s]=Z,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:s,value:Z}})}getAsset(s,Z){return(0,G.d)(this.assetsContext,s,Z)}getVariable(s){var Z;return null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:s,value:this._userVariables[s]}}),this._userVariables[s]}get userVariables(){return this._userVariables}Ls(){return this._configuration.fZ}_getUniqueIdPrefixedName(s,Z){return`${s.uniqueId}_${Z}`}_getGlobalContextVariable(s,Z){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:s,defaultValue:Z,possibleValue:this._globalContextVariables[s]}}),this._hasGlobalContextVariable(s)?this._globalContextVariables[s]:Z}_setGlobalContextVariable(s,Z){var o;null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:s,value:Z}}),this._globalContextVariables[s]=Z}_deleteGlobalContextVariable(s){var Z;null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:s}}),delete this._globalContextVariables[s]}_hasGlobalContextVariable(s){return s in this._globalContextVariables}_setExecutionVariable(s,Z,o){this._executionVariables[this._getUniqueIdPrefixedName(s,Z)]=o}_getExecutionVariable(s,Z,o){return this._hasExecutionVariable(s,Z)?this._executionVariables[this._getUniqueIdPrefixedName(s,Z)]:o}_deleteExecutionVariable(s,Z){delete this._executionVariables[this._getUniqueIdPrefixedName(s,Z)]}_hasExecutionVariable(s,Z){return this._getUniqueIdPrefixedName(s,Z)in this._executionVariables}_hasConnectionValue(s){return s.uniqueId in this._connectionValues}_setConnectionValue(s,Z){var o;this._connectionValues[s.uniqueId]=Z,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:s.uniqueId,value:Z}})}_setConnectionValueByKey(s,Z){this._connectionValues[s]=Z}_getConnectionValue(s){var Z;return null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:s.uniqueId,value:this._connectionValues[s.uniqueId]}}),this._connectionValues[s.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(s){this._pendingBlocks.includes(s)||(this._pendingBlocks.push(s),this._pendingBlocks.sort(((s,Z)=>s.priority-Z.priority)))}_removePendingBlock(s){const Z=this._pendingBlocks.indexOf(s);-1!==Z&&this._pendingBlocks.splice(Z,1)}_clearPendingBlocks(){for(const s of this._pendingBlocks)s._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(s){var Z;this.onNodeExecutedObservable.notifyObservers(s),null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:s.getClassName(),uniqueId:s.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(s){this._setGlobalContextVariable("timeSinceStart",s.timeSinceStart),this._setGlobalContextVariable("deltaTime",s.deltaTime);for(const o of this._pendingBlocks){var Z;null===(Z=o._executeOnTick)||void 0===Z||Z.call(o,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.g;s.uniqueId=this.uniqueId,s._userVariables={};for(const t in this._userVariables)Z(t,this._userVariables[t],s._userVariables);s._connectionValues={};for(const t in this._connectionValues)Z(t,this._connectionValues[t],s._connectionValues);var o;this.assetsContext!==this.Ls()&&(s._assetsContext={meshes:this.assetsContext.meshes.map((s=>s.id)),materials:this.assetsContext.materials.map((s=>s.id)),textures:this.assetsContext.textures.map((s=>s.name)),animations:this.assetsContext.animations.map((s=>s.name)),lights:this.assetsContext.lights.map((s=>s.id)),cameras:this.assetsContext.cameras.map((s=>s.id)),GD:null===(o=this.assetsContext.GD)||void 0===o?void 0:o.map((s=>s.name)),skeletons:this.assetsContext.skeletons.map((s=>s.id)),gQ:this.assetsContext.gQ.map((s=>s.name)),geometries:this.assetsContext.geometries.map((s=>s.id)),multiMaterials:this.assetsContext.multiMaterials.map((s=>s.id)),transformNodes:this.assetsContext.transformNodes.map((s=>s.id))})}getClassName(){return"FlowGraphContext"}}(0,S.c)([(0,a.K)()],D.prototype,"uniqueId",void 0);var z=o(12798),Y=o(11516);class b{constructor(s){this.onEventTriggeredObservable=new j.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=s,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.jO.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const s=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:s}}),this._startingTime+=s})),this._meshPickedObserver=this._scene.onPointerObservable.add((s=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:s})}),Y.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((s=>{const Z=s.pointerId,o=s.mesh,t=this._pointerUnderMeshState[Z];!t&&o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:Z,mesh:o}}):t&&!o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:Z,mesh:t}}):t&&o&&t!==o&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:Z,mesh:t,over:o}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:Z,mesh:o,out:t}})),this._pointerUnderMeshState[Z]=o}),Y.b.POINTERMOVE)}dispose(){var s,Z,o,t,j;null===(s=this._sceneDisposeObserver)||void 0===s||s.remove(),null===(Z=this._sceneReadyObserver)||void 0===Z||Z.remove(),null===(o=this._sceneOnBeforeRenderObserver)||void 0===o||o.remove(),null===(t=this._meshPickedObserver)||void 0===t||t.remove(),null===(j=this._meshUnderPointerObserver)||void 0===j||j.remove(),this.onEventTriggeredObservable.clear()}}var f,A=o(12816);!function(s){s[s.Stopped=0]="Stopped",s[s.Started=1]="Started"}(f||(f={}));class d{get state(){return this._state}set state(s){this._state=s,this.onStateChangedObservable.notifyObservers(s)}constructor(s){this.onStateChangedObservable=new j.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=s.fZ,this._sceneEventCoordinator=new b(this._scene),this._coordinator=s.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((s=>{for(const Z of this._executionContexts){const o=this._getContextualOrder(s.type,Z);for(const t of o)if(!t._executeEvent(Z,s.payload))break}switch(s.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const Z of this._executionContexts)Z._notifyOnTick(s.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const s=new D({fZ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(s),s}getContext(s){return this._executionContexts[s]}addEventBlock(s){if("PointerOver"!==s.type&&"PointerOut"!==s.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==s.type&&this._eventBlocks[s.type].push(s),1===this.state)for(const Z of this._executionContexts)s._startPendingTasks(Z);else this.onStateChangedObservable.addOnce((Z=>{if(1===Z)for(const o of this._executionContexts)s._startPendingTasks(o)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((s=>{1===s&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const s of this._executionContexts)for(const Z in this._eventBlocks){const o=this._getContextualOrder(Z,s);for(const Z of o)Z._startPendingTasks(s)}}_getContextualOrder(s,Z){const o=this._eventBlocks[s].sort(((s,Z)=>Z.initPriority-s.initPriority));if("MeshPick"===s){const s=[];for(const t of o){const j=t.asset.getValue(Z);let S=0;for(;S<o.length;S++){const s=o[S].asset.getValue(Z);if(j&&s&&(0,A.m)(j,s))break}s.splice(S,0,t)}return s}return o}dispose(){var s;if(0!==this.state){this.state=0;for(const s of this._executionContexts)s._clearPendingBlocks();this._executionContexts.length=0;for(const s in this._eventBlocks)this._eventBlocks[s].length=0;null===(s=this._eventObserver)||void 0===s||s.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(s){const Z=[],o=new Set;for(const t in this._eventBlocks)for(const s of this._eventBlocks[t])Z.push(s),o.add(s.uniqueId);for(;Z.length>0;){const t=Z.pop();s(t);for(const s of t.dataInputs)for(const t of s._connectedPoint)o.has(t._ownerBlock.uniqueId)||(Z.push(t._ownerBlock),o.add(t._ownerBlock.uniqueId));if(t instanceof z.c)for(const s of t.signalOutputs)for(const t of s._connectedPoint)o.has(t._ownerBlock.uniqueId)||(Z.push(t._ownerBlock),o.add(t._ownerBlock.uniqueId))}}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1?arguments[1]:void 0;s.allBlocks=[],this.visitAllBlocks((Z=>{const o={};Z.serialize(o),s.allBlocks.push(o)})),s.executionContexts=[];for(const o of this._executionContexts){const t={};o.serialize(t,Z),s.executionContexts.push(t)}}}class U{constructor(s){this.config=s,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.fZ.jO.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.fZ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const s=this._executeOnNextFrame.slice(0);if(s.length)for(const Z of s){this.notifyCustomEvent(Z.id,Z.data,!1);const s=this._executeOnNextFrame.findIndex((s=>s.uniqueId===Z.uniqueId));-1!==s&&this._executeOnNextFrame.splice(s,1)}}));(U.SceneCoordinators.get(this.config.fZ)??[]).push(this)}createGraph(){const s=new d({fZ:this.config.fZ,coordinator:this});return this._flowGraphs.push(s),s}removeGraph(s){const Z=this._flowGraphs.indexOf(s);-1!==Z&&(s.dispose(),this._flowGraphs.splice(Z,1))}start(){for(const s of this._flowGraphs)s.start()}dispose(){var s,Z;for(const j of this._flowGraphs)j.dispose();this._flowGraphs.length=0,null===(s=this._disposeObserver)||void 0===s||s.remove(),null===(Z=this._onBeforeRenderObserver)||void 0===Z||Z.remove();const o=U.SceneCoordinators.get(this.config.fZ)??[],t=o.indexOf(this);-1!==t&&o.splice(t,1)}serialize(s,Z){s._flowGraphs=[];for(const o of this._flowGraphs){const t={};o.serialize(t,Z),s._flowGraphs.push(t)}s.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(s){let Z=this._customEventsMap.get(s);return Z||(Z=new j.b,this._customEventsMap.set(s,Z)),Z}notifyCustomEvent(s,Z){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:s,data:Z,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(s)){const Z=this._eventExecutionCounter.get(s);if(this._eventExecutionCounter.set(s,Z+1),Z>=U.MaxEventTypeExecutionPerFrame)return void(Z===U.MaxEventTypeExecutionPerFrame&&B.b.Warn(`FlowGraphCoordinator: Too many executions of event "${s}".`))}else this._eventExecutionCounter.set(s,1);const o=this._customEventsMap.get(s);o&&o.notifyObservers(Z)}}U.MaxEventsPerType=30,U.MaxEventTypeExecutionPerFrame=30,U.SceneCoordinators=new Map},12825:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>j});var t=o(12828);class j extends t.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(s){s._notifyExecuteNode(this),this.done._activateSignal(s)}}},12798:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>O});var t=o(12802),j=o(12811),S=o(10916);class a extends j.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(s){super.connectTo(s),this._connectedPoint.sort(((s,Z)=>Z.priority-s.priority))}_activateSignal(s){var Z;if(null===(Z=s.logger)||void 0===Z||Z.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)s._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(s,this),s._increaseExecutionId();else for(const o of this._connectedPoint)o._activateSignal(s)}}(0,S.f)("FlowGraphSignalConnection",a);class O extends t.e{constructor(s){super(s),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(s){const Z=new a(s,0,this);return this.signalInputs.push(Z),Z}_registerSignalOutput(s){const Z=new a(s,1,this);return this.signalOutputs.push(Z),Z}_unregisterSignalInput(s){const Z=this.signalInputs.findIndex((Z=>Z.name===s));-1!==Z&&(this.signalInputs[Z].dispose(),this.signalInputs.splice(Z,1))}_unregisterSignalOutput(s){const Z=this.signalOutputs.findIndex((Z=>Z.name===s));-1!==Z&&(this.signalOutputs[Z].dispose(),this.signalOutputs.splice(Z,1))}_reportError(s,Z){this.error.payload="string"===typeof Z?new Error(Z):Z,this.error._activateSignal(s)}getSignalInput(s){return this.signalInputs.find((Z=>Z.name===s))}getSignalOutput(s){return this.signalOutputs.find((Z=>Z.name===s))}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(s),s.signalInputs=[],s.signalOutputs=[];for(const Z of this.signalInputs){const o={};Z.serialize(o),s.signalInputs.push(o)}for(const Z of this.signalOutputs){const o={};Z.serialize(o),s.signalOutputs.push(o)}}deserialize(s){for(let Z=0;Z<s.signalInputs.length;Z++){const o=this.getSignalInput(s.signalInputs[Z].name);if(!o)throw new Error("Could not find signal input with name "+s.signalInputs[Z].name+" in block "+s.className);o.deserialize(s.signalInputs[Z])}for(let Z=0;Z<s.signalOutputs.length;Z++){const o=this.getSignalOutput(s.signalOutputs[Z].name);if(!o)throw new Error("Could not find signal output with name "+s.signalOutputs[Z].name+" in block "+s.className);o.deserialize(s.signalOutputs[Z])}}getClassName(){return"FlowGraphExecutionBlock"}}},12831:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>j});var t=o(12798);class j extends t.c{constructor(s){super(s),this.out=this._registerSignalOutput("out")}}},12775:(s,Z,o)=>{"use strict";o.d(Z,{A:()=>B,E:()=>z,H:()=>Y,L:()=>b,O:()=>L,R:()=>V,U:()=>N,X:()=>i,d:()=>G,g:()=>D,j:()=>F,n:()=>f,q:()=>A,u:()=>d,w:()=>Q,x:()=>H});var t,j=o(10900),S=o(11174),a=o(12771),O=o(12784);!function(s){s.Any="any",s.String="string",s.Number="number",s.Boolean="boolean",s.Object="object",s.Integer="FlowGraphInteger",s.Vector2="Vector2",s.sO="sO",s.Vector4="Vector4",s.Quaternion="Quaternion",s.Matrix="Matrix",s.Matrix2D="Matrix2D",s.Matrix3D="Matrix3D",s.pz="pz",s.nz="nz"}(t||(t={}));class v{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=s,this.defaultValue=Z,this.animationType=o}serialize(s){s.typeName=this.typeName,s.defaultValue=this.defaultValue}}const G=new v("any",void 0),B=new v("string",""),Q=new v("number",0,0),D=new v("boolean",!1),z=new v("Vector2",j.j.Zero(),5),Y=new v("sO",j.n.Zero(),1),b=new v("Vector4",j.p.Zero()),f=new v("Matrix",j.b.Identity(),3),A=new v("Matrix2D",new O.c),d=new v("Matrix3D",new O.d),U=new v("pz",S.d.Black(),4),u=new v("nz",new S.h(0,0,0,0),7),H=new v("Quaternion",j.e.Identity(),2);H.typeTransformer=s=>{if(s.getClassName){if("Vector4"===s.getClassName())return j.e.oO(s.ma());if("sO"===s.getClassName())return j.e.FromEulerVector(s);if("Matrix"===s.getClassName())return j.e.FromRotationMatrix(s)}return s};const F=new v("FlowGraphInteger",new a.b(0),0);function i(s){const Z=s;switch(typeof s){case"string":return B;case"number":return Q;case"boolean":return D;case"object":if(Z.getClassName)switch(Z.getClassName()){case"Vector2":return z;case"sO":return Y;case"Vector4":return b;case"Matrix":return f;case"pz":return U;case"nz":return u;case"Quaternion":return H;case"FlowGraphInteger":return F;case"Matrix2D":return A;case"Matrix3D":return d}return G;default:return G}}function N(s){switch(s){case"string":return B;case"number":return Q;case"boolean":return D;case"Vector2":return z;case"sO":return Y;case"Vector4":return b;case"Matrix":return f;case"pz":return U;case"nz":return u;case"Quaternion":return H;case"FlowGraphInteger":return F;case"Matrix2D":return A;case"Matrix3D":return d;default:return G}}function L(s){switch(s){case"number":default:return 0;case"Vector2":return 5;case"sO":return 1;case"Matrix":return 3;case"pz":return 4;case"nz":return 7;case"Quaternion":return 2}}function V(s){switch(s){case 0:return Q;case 5:return z;case 1:return Y;case 3:return f;case 4:return U;case 7:return u;case 2:return H;default:return G}}},12766:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>B,g:()=>G,k:()=>Q});var t=o(11174),j=o(10900),S=o(12771),a=o(12775),O=o(12784);function v(s){return"Vector2"===s||"sO"===s||"Vector4"===s||"Quaternion"===s||"pz"===s||"nz"===s}function G(s,Z,o){var t;const j=(null===Z||void 0===Z||null===(t=Z.getClassName)||void 0===t?void 0:t.call(Z))??"";if(v(j)||function(s){return"Matrix"===s||"Matrix2D"===s||"Matrix3D"===s}(j))o[s]={value:Z.ma(),className:j};else if("FlowGraphInteger"===j)o[s]={value:Z.value,className:j};else if(j&&(Z.id||Z.name))o[s]={id:Z.id,name:Z.name,className:j};else{if("object"===typeof Z)throw new Error(`Could not serialize value ${Z}`);o[s]=Z}}function B(s,Z,o,G){const Q=Z[s];let D;const z=(null===Q||void 0===Q?void 0:Q.type)??(null===Q||void 0===Q?void 0:Q.className);if(function(s){return"Mesh"===s||"AbstractMesh"===s||"GroundMesh"===s||"InstanceMesh"===s||"LinesMesh"===s||"GoldbergMesh"===s||"GreasedLineMesh"===s||"TrailMesh"===s}(z)){let s=G.meshes.filter((s=>Q.id?s.id===Q.id:s.name===Q.name));0===s.length&&(s=G.transformNodes.filter((s=>Q.id?s.id===Q.id:s.name===Q.name))),D=Q.uniqueId?s.find((s=>s.uniqueId===Q.uniqueId)):s[0]}else if(v(z))D=function(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===s)return j.j.oO(Z);if("sO"===s)return o&&(Z[2]*=-1),j.n.oO(Z);if("Vector4"===s)return j.p.oO(Z);if("Quaternion"===s)return o&&(Z[2]*=-1,Z[3]*=-1),j.e.oO(Z);if("pz"===s)return new t.d(Z[0],Z[1],Z[2]);if("nz"===s)return new t.h(Z[0],Z[1],Z[2],Z[3]);throw new Error(`Unknown vector class name ${s}`)}(z,Q.value);else if(function(s){return"AnimationGroup"===s}(z)){const s=G.animationGroups.filter((s=>s.name===Q.name));D=1===s.length?s[0]:s.find((s=>s.uniqueId===Q.uniqueId))}else D="Matrix"===z?j.b.oO(Q.value):"Matrix2D"===z?new O.c(Q.value):"Matrix3D"===z?new O.d(Q.value):"FlowGraphInteger"===z?S.b.FromValue(Q.value):"number"===z||"string"===z||"boolean"===z?Q.value[0]:Q&&void 0!==Q.value?Q.value:Array.isArray(Q)?Q.reduce(((s,Z)=>Z.eventData?(s[Z.id]={type:(0,a.U)(Z.type)},"undefined"!==typeof Z.value&&(s[Z.id].value=B("value",Z,o,G)),s):s),{}):Q;return D}function Q(s){return"FlowGraphJsonPointerParserBlock"===s}},12816:(s,Z,o)=>{"use strict";function t(s,Z){return!(!s.parent||s.parent!==Z&&!t(s.parent,Z))}function j(s){if(s.getClassName)return s.getClassName()}function S(s,Z){return s===Z&&("Vector2"===s||"sO"===s||"Vector4"===s||"Quaternion"===s)}function a(s,Z){return s===Z&&("Matrix"===s||"Matrix2D"===s||"Matrix3D"===s)}function O(s,Z){return"FlowGraphInteger"===s&&"FlowGraphInteger"===Z}function v(s,Z){const o="number"===typeof s||"number"===typeof(null===s||void 0===s?void 0:s.value);return o&&!Z?!isNaN(G(s)):o}function G(s){return"number"===typeof s?s:s.value}o.d(Z,{c:()=>O,e:()=>a,f:()=>S,i:()=>j,m:()=>t,o:()=>G,s:()=>v})},12166:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{SceneInstrumentation:()=>S});var t=o(10938),j=o(11396);class S{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(s){s!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=s,s?(this._onBeforeActiveMeshesEvaluationObserver=this.fZ.onBeforeActiveMeshesEvaluationObservable.add((()=>{t.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.fZ.onAfterActiveMeshesEvaluationObservable.add((()=>{t.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.fZ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.fZ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(s){s!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=s,s?(this._onBeforeRenderTargetsRenderObserver=this.fZ.onBeforeRenderTargetsRenderObservable.add((()=>{t.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.fZ.onAfterRenderTargetsRenderObservable.add((()=>{t.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.fZ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.fZ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(s){s!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=s,s?(this._onBeforeParticlesRenderingObserver=this.fZ.onBeforeParticlesRenderingObservable.add((()=>{t.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.fZ.onAfterParticlesRenderingObservable.add((()=>{t.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.fZ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.fZ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(s){s!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=s,this.fZ.spriteManagers&&(s?(this._onBeforeSpritesRenderingObserver=this.fZ.onBeforeSpritesRenderingObservable.add((()=>{t.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.fZ.onAfterSpritesRenderingObservable.add((()=>{t.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.fZ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.fZ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(s){s!==this._capturePhysicsTime&&this.fZ.onBeforePhysicsObservable&&(this._capturePhysicsTime=s,s?(this._onBeforePhysicsObserver=this.fZ.onBeforePhysicsObservable.add((()=>{t.g.StartPerformanceCounter("gY"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.fZ.onAfterPhysicsObservable.add((()=>{t.g.EndPerformanceCounter("gY"),this._physicsTime.endMonitoring()}))):(this.fZ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.fZ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(s){s!==this._captureAnimationsTime&&(this._captureAnimationsTime=s,s?this._onAfterAnimationsObserver=this.fZ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.fZ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(s){this._captureFrameTime=s}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(s){this._captureInterFrameTime=s}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(s){s!==this._captureRenderTime&&(this._captureRenderTime=s,s?(this._onBeforeDrawPhaseObserver=this.fZ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),t.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.fZ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),t.g.EndPerformanceCounter("Main render")}))):(this.fZ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.fZ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(s){s!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=s,s?(this._onBeforeCameraRenderObserver=this.fZ.onBeforeCameraRenderObservable.add((s=>{this._cameraRenderTime.beginMonitoring(),t.g.StartPerformanceCounter(`Rendering camera ${s.name}`)})),this._onAfterCameraRenderObserver=this.fZ.onAfterCameraRenderObservable.add((s=>{this._cameraRenderTime.endMonitoring(!1),t.g.EndPerformanceCounter(`Rendering camera ${s.name}`)}))):(this.fZ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.fZ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.fZ.getEngine()._drawCalls}constructor(s){this.fZ=s,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new j.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new j.d,this._captureFrameTime=!1,this._frameTime=new j.d,this._captureRenderTime=!1,this._renderTime=new j.d,this._captureInterFrameTime=!1,this._interFrameTime=new j.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new j.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new j.d,this._capturePhysicsTime=!1,this._physicsTime=new j.d,this._captureAnimationsTime=!1,this._animationsTime=new j.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new j.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=s.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(t.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.fZ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=s.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(t.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dQ(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dQ(),this._captureParticlesRenderTime&&this._particlesRenderTime.dQ(),this._captureSpritesRenderTime&&this._spritesRenderTime.dQ(),this._captureRenderTime&&this._renderTime.dQ(),this._captureCameraRenderTime&&this._cameraRenderTime.dQ()}))}dispose(){this._disposed||(this.fZ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.fZ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.fZ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.fZ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.fZ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.fZ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.fZ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.fZ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.fZ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.fZ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.fZ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.fZ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.fZ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.fZ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.fZ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.fZ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.fZ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.fZ=null,this._disposed=!0)}}},12758:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>B});var t=o(11086),j=o(11091),S=o(10900),a=o(11201),O=o(11626),v=o(11689),G=o(10916);a.d.AddNodeConstructor("Light_Type_1",((s,Z)=>()=>new B(s,S.n.Zero(),Z)));class B extends v.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(s){this._shadowFrustumSize=s,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(s){this._shadowOrthoScale=s,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(s){this._orthoLeft=s}get orthoRight(){return this._orthoRight}set orthoRight(s){this._orthoRight=s}get orthoTop(){return this._orthoTop}set orthoTop(s){this._orthoTop=s}get orthoBottom(){return this._orthoBottom}set orthoBottom(s){this._orthoBottom=s}constructor(s,Z,o){super(s,o),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=Z.scale(-1),this.direction=Z}getClassName(){return"lY"}getTypeID(){return O.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(s,Z,o){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(s):this._setDefaultAutoExtendShadowProjectionMatrix(s,Z,o)}_setDefaultFixedFrustumShadowProjectionMatrix(s){const Z=this.Ls().activeCamera;Z&&S.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:Z.OO,void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,s,this.Ls().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(s,Z,o){const t=this.Ls().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const s=S.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let t=Number.MAX_VALUE,j=-Number.MAX_VALUE;for(let a=0;a<o.length;a++){const O=o[a];if(!O)continue;const v=O.getBoundingInfo().boundingBox;for(let o=0;o<v.vectorsWorld.length;o++)S.n.TransformCoordinatesToRef(v.vectorsWorld[o],Z,s),s.x<this._orthoLeft&&(this._orthoLeft=s.x),s.y<this._orthoBottom&&(this._orthoBottom=s.y),s.x>this._orthoRight&&(this._orthoRight=s.x),s.y>this._orthoTop&&(this._orthoTop=s.y),this.autoCalcShadowZBounds&&(s.z<t&&(t=s.z),s.z>j&&(j=s.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=t,this._shadowMaxZ=j)}const j=this._orthoRight-this._orthoLeft,a=this._orthoTop-this._orthoBottom,O=void 0!==this.shadowMinZ?this.shadowMinZ:(null===t||void 0===t?void 0:t.OO)||0,v=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===t||void 0===t?void 0:t.maxZ)||1e4,G=this.Ls().getEngine().useReverseDepthBuffer;S.b.OrthoOffCenterLHToRef(this._orthoLeft-j*this.shadowOrthoScale,this._orthoRight+j*this.shadowOrthoScale,this._orthoBottom-a*this.shadowOrthoScale,this._orthoTop+a*this.shadowOrthoScale,G?v:O,G?O:v,s,this.Ls().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(s,Z){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,Z),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,Z),this)}transferToNodeMaterialEffect(s,Z){return this.computeTransformedInformation()?(s.setFloat3(Z,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(s.setFloat3(Z,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(s){const Z=this._scene.getEngine();return!Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?0:1}getDepthMaxZ(s){const Z=this._scene.getEngine();return Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?0:1}prepareLightSpecificDefines(s,Z){s["DIRLIGHT"+Z]=!0}}(0,t.c)([(0,j.K)()],B.prototype,"shadowFrustumSize",null),(0,t.c)([(0,j.K)()],B.prototype,"shadowOrthoScale",null),(0,t.c)([(0,j.K)()],B.prototype,"autoUpdateExtends",void 0),(0,t.c)([(0,j.K)()],B.prototype,"autoCalcShadowZBounds",void 0),(0,t.c)([(0,j.K)("orthoLeft")],B.prototype,"_orthoLeft",void 0),(0,t.c)([(0,j.K)("orthoRight")],B.prototype,"_orthoRight",void 0),(0,t.c)([(0,j.K)("orthoTop")],B.prototype,"_orthoTop",void 0),(0,t.c)([(0,j.K)("orthoBottom")],B.prototype,"_orthoBottom",void 0),(0,G.f)("BABYLON.DirectionalLight",B)},13217:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>B});var t=o(11086),j=o(11091),S=o(10900),a=o(11174),O=o(11201),v=o(11626),G=o(10916);O.d.AddNodeConstructor("Light_Type_3",((s,Z)=>()=>new B(s,S.n.Zero(),Z)));class B extends v.b{constructor(s,Z,o){super(s,o),this.groundColor=new a.d(0,0,0),this.direction=Z||S.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"RY"}setDirectionToTarget(s){return this.direction=S.n.Normalize(s.Go(S.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(s,Z){const o=S.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",o.x,o.y,o.z,0,Z),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.QO),Z),this}transferToNodeMaterialEffect(s,Z){const o=S.n.Normalize(this.direction);return s.setFloat3(Z,o.x,o.y,o.z),this}Ea(){return this._worldMatrix||(this._worldMatrix=S.b.Identity()),this._worldMatrix}getTypeID(){return v.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(s,Z){s["HEMILIGHT"+Z]=!0}}(0,t.c)([(0,j.i)()],B.prototype,"groundColor",void 0),(0,t.c)([(0,j.G)()],B.prototype,"direction",void 0),(0,G.f)("BABYLON.HemisphericLight",B)},12721:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>Q});var t=o(11086),j=o(11091),S=o(10900),a=o(11201),O=o(11626),v=o(11689),G=o(11410),B=o(10916);a.d.AddNodeConstructor("Light_Type_2",((s,Z)=>()=>new Q(s,S.n.Zero(),S.n.Zero(),0,0,Z)));class Q extends v.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(s){this._iesProfileTexture!==s&&(this._iesProfileTexture=s,this._iesProfileTexture&&Q._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(s){this._angle=s,this._cosHalfAngle=Math.cos(.5*s),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(s){this._innerAngle=s,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(s){this._shadowAngleScale=s,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(s){this._projectionTextureLightNear=s,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(s){this._projectionTextureLightFar=s,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(s){this._projectionTextureUpDirection=s,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(s){this._projectionTexture!==s&&(this._projectionTexture=s,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Q._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Q._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(s){return void 0!==s.onGeneratedObservable}static _IsTexture(s){return void 0!==s.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(s){this._projectionTextureProjectionLightMatrix=s,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(s,Z,o,t,j,a){super(s,a),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=S.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=S.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=S.n.Zero(),this._projectionTextureViewLightMatrix=S.b.Zero(),this._projectionTextureProjectionLightMatrix=S.b.Zero(),this._projectionTextureScalingMatrix=S.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=Z,this.direction=o,this.angle=t,this.exponent=j}getClassName(){return"SpotLight"}getTypeID(){return O.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(s){super._setDirection(s),this._projectionTextureViewLightDirty=!0}_setPosition(s){super._setPosition(s),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(s,Z,o){const t=this.Ls().activeCamera;if(!t)return;this._shadowAngleScale=this._shadowAngleScale||1;const j=this._shadowAngleScale*this._angle,a=void 0!==this.shadowMinZ?this.shadowMinZ:t.OO,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,v=this.Ls().getEngine().useReverseDepthBuffer;S.b.PerspectiveFovLHToRef(j,1,v?O:a,v?a:O,s,!0,this._scene.getEngine().isNDCHalfZRange,void 0,v)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),S.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const s=this.projectionTextureLightFar,Z=this.projectionTextureLightNear,o=s/(s-Z),t=-o*Z,j=1/Math.tan(this._angle/2);S.b.FromValuesToRef(j/1,0,0,0,0,j,0,0,0,0,o,1,0,0,t,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof G.c){const s=this._projectionTexture.uScale/2,Z=this._projectionTexture.vScale/2;S.b.FromValuesToRef(s,0,0,0,0,Z,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(s,Z){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),s.setMatrix("textureProjectionMatrix"+Z,this._projectionTextureMatrix),s.setTexture("projectionLightTexture"+Z,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&s.setTexture("iesLightTexture"+Z,this._iesProfileTexture),this}transferToEffect(s,Z){let o;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,Z),o=S.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,Z),o=S.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",o.x,o.y,o.z,this._cosHalfAngle,Z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,Z),this}transferToNodeMaterialEffect(s,Z){let o;return o=this.computeTransformedInformation()?S.n.Normalize(this.transformedDirection):S.n.Normalize(this.direction),this.Ls().useRightHandedSystem?s.setFloat3(Z,-o.x,-o.y,-o.z):s.setFloat3(Z,o.x,o.y,o.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(s){const Z=this._scene.getEngine(),o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===s||void 0===s?void 0:s.OO)??0;return Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?o:this._scene.getEngine().isNDCHalfZRange?0:o}getDepthMaxZ(s){const Z=this._scene.getEngine(),o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===s||void 0===s?void 0:s.maxZ)??1e4;return Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?0:o}prepareLightSpecificDefines(s,Z){s["SPOTLIGHT"+Z]=!0,s["PROJECTEDLIGHTTEXTURE"+Z]=!(!this.projectionTexture||!this.projectionTexture.isReady()),s["IESLIGHTTEXTURE"+Z]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,t.c)([(0,j.K)()],Q.prototype,"angle",null),(0,t.c)([(0,j.K)()],Q.prototype,"innerAngle",null),(0,t.c)([(0,j.K)()],Q.prototype,"shadowAngleScale",null),(0,t.c)([(0,j.K)()],Q.prototype,"exponent",void 0),(0,t.c)([(0,j.K)()],Q.prototype,"projectionTextureLightNear",null),(0,t.c)([(0,j.K)()],Q.prototype,"projectionTextureLightFar",null),(0,t.c)([(0,j.K)()],Q.prototype,"projectionTextureUpDirection",null),(0,t.c)([(0,j.D)("projectedLightTexture")],Q.prototype,"_projectionTexture",void 0),(0,B.f)("BABYLON.SpotLight",Q)},12439:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>a,g:()=>S,h:()=>O});const t={},j={};function S(s,Z){t[s]=Z}function a(s,Z){j[s]=Z}function O(s){return j[s]?j[s]:null}},12340:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>i,f:()=>W});var t,j=o(10938),S=o(10932),a=o(11493),O=o(10927),v=o(10955),G=o(11282),B=o(10982),Q=o(10990),D=o(11070),z=o(11013),Y=o(10977);!function(s){s[s.Clean=0]="Clean",s[s.Stop=1]="Stop",s[s.Sync=2]="Sync",s[s.NoSync=3]="NoSync"}(t||(t={}));const b=new S.b,f={};let A=!1;function d(){return f[".babylon"]}function U(s,Z){const o=f[s];return o||(v.b.Warn("Unable to find a plugin to load "+s+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),Z?d():void 0)}function u(s,Z,o){let t="Unable to load from "+(s.rawData?"binary data":s.url);return Z?t+=`: ${Z}`:o&&(t+=`: ${o}`),t}async function H(s,Z,o,t,j,S,a,O,v){var G;const Q="data:"===(D=s.url).substring(0,5)?D.substring(5):null;var D;if(s.rawData&&!a)throw"When using ArrayBufferView to load data the file extension must be provided.";const A=Q||a?"":function(s){const Z=s.indexOf("?");-1!==Z&&(s=s.substring(0,Z));const o=s.lastIndexOf(".");return s.substring(o,s.length).toLowerCase()}(s.url);let u=a?U(a,!0):Q?function(s){for(const Z in f){const o=f[Z].plugin;if(o.canDirectLoad&&o.canDirectLoad(s))return f[Z]}return d()}(s.url):U(A,!1);if(!u&&A){if(s.url&&!s.url.startsWith("blob:")){const Z=await async function(s,Z){const o=Z.method||"GET";return await new Promise(((t,j)=>{const S=new Y.c;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const s={};if(Z.responseHeaders)for(const o of Z.responseHeaders)s[o]=S.getResponseHeader(o)||"";t({response:S.response,headerValues:s})}else j(`Unable to fetch data from ${s}. Error code: ${S.status}`)})),S.open(o,s),S.send()}))}(s.url,{method:"HEAD",responseHeaders:["Content-Type"]}),o=Z.headerValues?Z.headerValues["Content-Type"]:"";o&&(u=function(s){for(const Z in f){const o=f[Z];if(o.mimeType===s)return o}}(o))}u||(u=d())}if(!u)throw new Error(`No plugin or fallback for ${a??s.url}`);if(!1===(null===v||void 0===v||null===(G=v[u.plugin.name])||void 0===G?void 0:G.enabled))throw new Error(`The '${u.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(s.rawData&&!u.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(s=>{if(u.plugin.createPlugin){const Z=u.plugin.createPlugin(v??{});return Z instanceof Promise?(Z.then(s).catch((s=>{j("Error instantiating plugin.",s)})),null):(s(Z),Z)}return s(u.plugin),u.plugin})((v=>{var G;if(!v)throw`The loader plugin corresponding to the '${a}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(b.notifyObservers(v),Q&&(v.canDirectLoad&&v.canDirectLoad(s.url)||!(0,B.p)(s.url))){if(v.directLoad){const s=v.directLoad(Z,Q);s instanceof Promise?s.then((s=>{o(v,s)})).catch((s=>{j("Error in directLoad of _loadData: "+s,s)})):o(v,s)}else o(v,Q);return}const D=u.isBinary,Y=(s,t)=>{Z.B?j("Scene has been disposed"):o(v,s,t)};let f=null,A=!1;null===(G=v.jO)||void 0===G||G.add((()=>{A=!0,f&&(f.abort(),f=null),S()}));const d=()=>{if(A)return;const o=(s,Z)=>{j(null===s||void 0===s?void 0:s.statusText,Z)};if(!v.loadFile&&s.rawData)throw"Plugin does not support loading ArrayBufferView.";f=v.loadFile?v.loadFile(Z,s.rawData||s.file||s.url,s.rootUrl,Y,t,D,o,O):Z._loadFile(s.file||s.url,Y,t,!0,D,o)},U=Z.getEngine();let H=U.enableOfflineSupport;if(H){let o=!1;for(const t of Z.disableOfflineSupportExceptionRules)if(t.test(s.url)){o=!0;break}H=!o}H&&z.e.OfflineProviderFactory?Z.offlineProvider=z.e.OfflineProviderFactory(s.url,d,U.disableManifestCheck):d()}))}function F(s,Z){let o,t,S=null,a=null;if(Z)if(Z.name)o=`file:${Z.name}`,t=Z.name,S=Z;else if(ArrayBuffer.isView(Z))o="",t=(0,D.c)(),a=Z;else if(Z.startsWith("data:"))o=Z,t="";else if(s){const S=Z;if("/"===S.substring(0,1))return j.g.Error("Wrong sceneFilename parameter"),null;o=s+S,t=S}else o=Z,t=j.g.GetFilename(Z),s=j.g.GetFolderPath(Z);else o=s,t=j.g.GetFilename(s),s=j.g.GetFolderPath(s);return{url:o,rootUrl:s,name:t,file:S,rawData:a}}function i(s){if("string"===typeof s.extensions){const Z=s.extensions;f[Z.toLowerCase()]={plugin:s,isBinary:!1}}else{const Z=s.extensions,o=Object.keys(Z);for(const t of o)f[t.toLowerCase()]={plugin:s,isBinary:Z[t].isBinary,mimeType:Z[t].mimeType}}}async function N(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.c.LastCreatedScene,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!t)return v.b.Error("No scene available to import mesh to"),null;const z=F(Z,o);if(!z)return null;const Y={};t.addPendingData(Y);const b=()=>{t.removePendingData(Y)},f=(s,Z)=>{const o=u(z,s,Z);a?a(t,o,new Q.g(o,Q.f.SceneLoaderError,Z)):v.b.Error(o),b()},A=S?s=>{try{S(s)}catch(Z){f("Error in onProgress callback: "+Z,Z)}}:void 0,d=(s,Z,o,S,a,O,v,G)=>{if(t.importedMeshesFiles.push(z.url),j)try{j(s,Z,o,S,a,O,v,G)}catch(B){f("Error in onSuccess callback: "+B,B)}t.removePendingData(Y)};return await H(z,t,((Z,o,j)=>{if(Z.rewriteRootURL&&(z.rootUrl=Z.rewriteRootURL(z.rootUrl,j)),Z.importMesh){const j=[],S=[],a=[];if(!Z.importMesh(s,t,o,z.rootUrl,j,S,a,f))return;t.loadingPluginName=Z.name,d(j,S,a,[],[],[],[],[])}else{Z.importMeshAsync(s,t,o,z.rootUrl,A,z.name).then((s=>{t.loadingPluginName=Z.name,d(s.meshes,s.gQ,s.skeletons,s.animationGroups,s.transformNodes,s.geometries,s.lights,s.spriteManagers)})).catch((s=>{f(s.message,s)}))}}),A,f,b,G,B,D)}async function L(s,Z,o,t,j,S,a,O){return await new Promise(((v,G)=>{try{N(s,Z,o,t,((s,Z,o,t,j,S,a,O)=>{v({meshes:s,gQ:Z,skeletons:o,animationGroups:t,transformNodes:j,geometries:S,lights:a,spriteManagers:O})}),j,((s,Z,o)=>{G(o||new Error(Z))}),S,a,O).catch(G)}catch(Q){G(Q)}}))}async function V(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.c.LastCreatedEngine,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};o?await l(s,Z,new a.c(o),t,S,v,G,B,Q):j.g.Error("No engine available")}async function g(s,Z,o,t,j,S,a){return await new Promise(((O,v)=>{V(s,Z,o,(s=>{O(s)}),t,((s,Z,o)=>{v(o||new Error(Z))}),j,S,a)}))}async function l(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.c.LastCreatedScene,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return v.b.Error("No scene available to append to"),null;const z=F(s,Z);if(!z)return null;const Y={};o.addPendingData(Y);const b=()=>{o.removePendingData(Y)};G.b.ShowLoadingScreen&&!A&&(A=!0,o.getEngine().displayLoadingUI(),o.executeWhenReady((()=>{o.getEngine().hideLoadingUI(),A=!1})));const f=(s,Z)=>{const t=u(z,s,Z);S?S(o,t,new Q.g(t,Q.f.SceneLoaderError,Z)):v.b.Error(t),b()},d=j?s=>{try{j(s)}catch(Z){f("Error in onProgress callback",Z)}}:void 0,U=()=>{if(t)try{t(o)}catch(s){f("Error in onSuccess callback",s)}o.removePendingData(Y)};return await H(z,o,((s,Z)=>{if(s.load){if(!s.load(o,Z,z.rootUrl,f))return;o.loadingPluginName=s.name,U()}else{s.loadAsync(o,Z,z.rootUrl,d,z.name).then((()=>{o.loadingPluginName=s.name,U()})).catch((s=>{f(s.message,s)}))}}),d,f,b,a,B,D)}async function R(s,Z,o,t,j,S,a){return await new Promise(((O,v)=>{try{l(s,Z,o,(s=>{O(s)}),t,((s,Z,o)=>{v(o||new Error(Z))}),j,S,a).catch(v)}catch(Q){v(Q)}}))}async function e(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.c.LastCreatedScene,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return v.b.Error("No scene available to load asset container to"),null;const D=F(s,Z);if(!D)return null;const z={};o.addPendingData(z);const Y=()=>{o.removePendingData(z)},b=(s,Z)=>{const t=u(D,s,Z);S?S(o,t,new Q.g(t,Q.f.SceneLoaderError,Z)):v.b.Error(t),Y()},f=j?s=>{try{j(s)}catch(Z){b("Error in onProgress callback",Z)}}:void 0,A=s=>{if(t)try{t(s)}catch(Z){b("Error in onSuccess callback",Z)}o.removePendingData(z)};return await H(D,o,((s,Z)=>{if(s.loadAssetContainer){const t=s.loadAssetContainer(o,Z,D.rootUrl,b);if(!t)return;t.populateRootNodes(),o.loadingPluginName=s.name,A(t)}else if(s.loadAssetContainerAsync){s.loadAssetContainerAsync(o,Z,D.rootUrl,f,D.name).then((Z=>{Z.populateRootNodes(),o.loadingPluginName=s.name,A(Z)})).catch((s=>{b(s.message,s)}))}else b("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),f,b,Y,a,G,B)}async function c(s,Z,o,t,j,S,a){return await new Promise(((O,v)=>{try{e(s,Z,o,(s=>{O(s)}),t,((s,Z,o)=>{v(o||new Error(Z))}),j,S,a).catch(v)}catch(Q){v(Q)}}))}async function w(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.c.LastCreatedScene,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!o)return void v.b.Error("No scene available to load animations to");if(t){for(const t of o.animatables)t.reset();o.stopAllAnimations();const s=o.animationGroups.slice();for(const o of s)o.dispose();const Z=o.getNodes();for(const o of Z)o.animations&&(o.animations=[])}else switch(j){case 0:const s=o.animationGroups.slice();for(const Z of s)Z.dispose();break;case 1:for(const Z of o.animationGroups)Z.stop();break;case 2:for(const Z of o.animationGroups)Z.reset(),Z.restart();break;case 3:break;default:return void v.b.Error("Unknown animation group loading mode value '"+j+"'")}const Y=o.animatables.length;await e(s,Z,o,(s=>{s.mergeAnimationsTo(o,o.animatables.slice(Y),S),s.dispose(),o.onAnimationFileImportedObservable.notifyObservers(o),a&&a(o)}),G,B,Q,D,z)}async function X(s,Z,o,t,j,S,a,O,v,G){return await new Promise(((B,D)=>{try{w(s,Z,o,t,j,S,(s=>{B(s)}),a,((s,Z,o)=>{D(o||new Error(Z))}),O,v,G).catch(D)}catch(Q){D(Q)}}))}class W{static get ForceFullSceneLoadingForIncremental(){return G.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(s){G.b.ForceFullSceneLoadingForIncremental=s}static get ShowLoadingScreen(){return G.b.ShowLoadingScreen}static set ShowLoadingScreen(s){G.b.ShowLoadingScreen=s}static get loggingLevel(){return G.b.loggingLevel}static set loggingLevel(s){G.b.loggingLevel=s}static get CleanBoneMatrixWeights(){return G.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(s){G.b.CleanBoneMatrixWeights=s}static GetDefaultPlugin(){return d()}static GetPluginForExtension(s){var Z;return null===(Z=U(s,!0))||void 0===Z?void 0:Z.plugin}static IsPluginForExtensionAvailable(s){return function(s){return!!f[s]}(s)}static RegisterPlugin(s){i(s)}static ImportMesh(s,Z,o,t,j,S,a,v,G){N(s,Z,o,t,j,S,a,v,G).catch((s=>null===a||void 0===a?void 0:a(O.c.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async ImportMeshAsync(s,Z,o,t,j,S,a){return await L(s,Z,o,t,j,S,a)}static Load(s,Z,o,t,j,S,a,v){V(s,Z,o,t,j,S,a,v).catch((s=>null===S||void 0===S?void 0:S(O.c.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async LoadAsync(s,Z,o,t,j,S){return await g(s,Z,o,t,j,S)}static Append(s,Z,o,t,j,S,a,v){l(s,Z,o,t,j,S,a,v).catch((s=>null===S||void 0===S?void 0:S(o??O.c.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async AppendAsync(s,Z,o,t,j,S){return await R(s,Z,o,t,j,S)}static LoadAssetContainer(s,Z,o,t,j,S,a,v){e(s,Z,o,t,j,S,a,v).catch((s=>null===S||void 0===S?void 0:S(o??O.c.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async LoadAssetContainerAsync(s,Z,o,t,j,S){return await c(s,Z,o,t,j,S)}static ImportAnimations(s,Z,o,t,j,S,a,v,G,B,Q){w(s,Z,o,t,j,S,a,v,G,B,Q).catch((s=>null===G||void 0===G?void 0:G(o??O.c.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async ImportAnimationsAsync(s,Z,o,t,j,S,a,O,v,G,B){return await X(s,Z,o,t,j,S,O,G,B)}}W.NO_LOGGING=0,W.MINIMAL_LOGGING=1,W.SUMMARY_LOGGING=2,W.DETAILED_LOGGING=3,W.OnPluginActivatedObservable=b},12743:(s,Z,o)=>{"use strict";o.d(Z,{d:()=>D});var t=o(11086),j=o(11091),S=o(10938),a=o(10900),O=o(11393),v=o(11410),G=o(10916),B=o(10932),Q=o(11167);o(12747);class D extends O.b{set boundingBoxSize(s){if(this._boundingBoxSize&&this._boundingBoxSize.equals(s))return;this._boundingBoxSize=s;const Z=this.Ls();Z&&Z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(s){this._rotationY=s,this.setReflectionTextureMatrix(a.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(s,Z,o){let t="";for(const j of s)t+=j;return new D(t,Z,null,o,s)}static CreateFromPrefilteredData(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const j=Z.useDelayedTextureLoading;Z.useDelayedTextureLoading=!1;const S=new D(s,Z,null,!1,null,null,null,void 0,!0,o,t);return Z.useDelayedTextureLoading=j,S}constructor(s,Z){var o;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,A=arguments.length>13?arguments[13]:void 0,d=arguments.length>14?arguments[14]:void 0;super(Z),this.onLoadObservable=new B.b,this.boundingBoxPosition=a.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new a.b,this._buffer=null,this.name=s,this.url=s,this._noMipmap=j,this.na=!1,this.isCube=!0,this._textureMatrix=a.b.Identity(),this.coordinatesMode=v.c.CUBIC_MODE;let U=null,u=null;null===t||Array.isArray(t)?(this._noMipmap=j,this._format=Q,this._createPolynomials=Y,U=t,this._loaderOptions=A,this._useSRGBBuffer=d,this._lodScale=b,this._lodOffset=f):(U=t.extensions??null,this._noMipmap=t.noMipmap??!1,S=t.files??null,u=t.buffer??null,this._format=t.format??5,D=t.prefiltered??!1,z=t.forcedExtension??null,this._createPolynomials=t.createPolynomials??!1,this._lodScale=t.lodScale??.8,this._lodOffset=t.lodOffset??0,this._loaderOptions=t.loaderOptions,this._useSRGBBuffer=t.useSRGBBuffer,O=t.T??null,G=t.onError??null),(s||S)&&this.updateURL(s,z,O,D,G,U,null===(o=this.Ls())||void 0===o?void 0:o.useDelayedTextureLoading,S,u)}getClassName(){return"CubeTexture"}updateURL(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=s),this.url=s,Z&&(this._forcedExtension=Z);const G=s.lastIndexOf("."),B=Z||(G>-1?s.substring(G).toLowerCase():""),Q=0===B.indexOf(".dds"),D=0===B.indexOf(".env"),z=0===B.indexOf(".basis");if(D?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=t,t&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),O)this._files=O;else if(z||D||Q||S||(S=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,S){for(let Z=0;Z<S.length;Z++)this._files.push(s+S[Z]);this._extensions=S}this._buffer=v,a?(this.delayLoadState=4,this._delayedOnLoad=o,this._delayedOnError=j):this._loadTexture(o,j)}delayLoad(s){4===this.delayLoadState&&(s&&(this._forcedExtension=s),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(s){var Z,o;if(s.updateFlag===this._textureMatrix.updateFlag)return;s.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(o=this.Ls())||void 0===o||o.markAllMaterialsAsDirty(1,(s=>-1!==s.getActiveTextures().indexOf(this))));if(this._textureMatrix=s,null===(Z=this.Ls())||void 0===Z||!Z.useRightHandedSystem)return;const t=a.g.sO[0],j=a.g.Quaternion[0],S=a.g.sO[1];this._textureMatrix.decompose(t,j,S),j.z*=-1,j.w*=-1,a.b.ComposeToRef(t,j,S,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var s;return null!==(s=this.Ls())&&void 0!==s&&s.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this.Ls(),t=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const j=()=>{var Z;(this.onLoadObservable.notifyObservers(this),t)&&(t.dispose(),null===(Z=this.Ls())||void 0===Z||Z.markAllMaterialsAsDirty(1));s&&s()},a=(s,o)=>{this._loadingError=!0,this._errorObject={message:s,exception:o},Z&&Z(s,o),v.c.OnTextureLoadErrorObservable.notifyObservers(this)};var O;this._texture?this._texture.isReady?S.g.SetImmediate((()=>j())):this._texture.onLoadedObservable.add((()=>j())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,this._lodScale,this._lodOffset,s,a,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,s,a,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(O=this._texture)||void 0===O||O.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(s,Z,o){const t=Q.c.Parse((()=>{let t=!1;return s.prefiltered&&(t=s.prefiltered),new D(o+(s.url??s.name),Z,s.extensions,!1,s.files||null,null,null,void 0,t,s.forcedExtension)}),s,Z);if(s.boundingBoxPosition&&(t.boundingBoxPosition=a.n.oO(s.boundingBoxPosition)),s.boundingBoxSize&&(t.boundingBoxSize=a.n.oO(s.boundingBoxSize)),s.animations)for(let j=0;j<s.animations.length;j++){const Z=s.animations[j],o=(0,G.e)("BABYLON.Animation");o&&t.animations.push(o.Parse(Z))}return t}clone(){let s=0;const Z=Q.c.Clone((()=>{const Z=new D(this.url,this.Ls()||this._getEngine(),this._extensions,this._noMipmap,this._files);return s=Z.uniqueId,Z}),this);return Z.uniqueId=s,Z}}(0,t.c)([(0,j.K)()],D.prototype,"url",void 0),(0,t.c)([(0,j.G)()],D.prototype,"boundingBoxPosition",void 0),(0,t.c)([(0,j.G)()],D.prototype,"boundingBoxSize",null),(0,t.c)([(0,j.K)("rotationY")],D.prototype,"rotationY",null),(0,t.c)([(0,j.K)("files")],D.prototype,"_files",void 0),(0,t.c)([(0,j.K)("forcedExtension")],D.prototype,"_forcedExtension",void 0),(0,t.c)([(0,j.K)("extensions")],D.prototype,"_extensions",void 0),(0,t.c)([(0,j.s)("textureMatrix")],D.prototype,"_textureMatrix",void 0),(0,t.c)([(0,j.s)("textureMatrixRefraction")],D.prototype,"_textureMatrixRefraction",void 0),v.c._CubeTextureParser=D.Parse,(0,G.f)("BABYLON.CubeTexture",D)},13226:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>v});var t=o(10955),j=o(11410),S=o(11077),a=o(11313),O=o(11044);a.ThinEngine.prototype.createDynamicTexture=function(s,Z,o,t){const j=new O.b(this,4);return j.baseWidth=s,j.baseHeight=Z,o&&(s=this.needPOTTextures?(0,S.f)(s,this._caps.maxTextureSize):s,Z=this.needPOTTextures?(0,S.f)(Z,this._caps.maxTextureSize):Z),j.width=s,j.height=Z,j.isReady=!1,j.generateMipMaps=o,j.samplingMode=t,this.updateTextureSamplingMode(t,j),this._internalTexturesCache.push(j),j},a.ThinEngine.prototype.updateDynamicTexture=function(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!s)return;const a=this._gl,O=a.TEXTURE_2D,v=this._bindTextureDirectly(O,s,!0,S);this._unpackFlipY(void 0===o?s.invertY:o),t&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const G=this._getWebGLTextureType(s.type),B=this._getInternalFormat(j||s.format),Q=this._getRGBABufferInternalSizedFormat(s.type,B);a.texImage2D(O,0,Q,B,G,Z),s.generateMipMaps&&a.generateMipmap(O),v||this._bindTextureDirectly(O,null),t&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),j&&(s.format=j),s._dynamicTextureSource=Z,s._premulAlpha=t,s.invertY=o||!1,s.isReady=!0};class v extends j.c{constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,O=arguments.length>6?arguments[6]:void 0;const v=!o||o._isScene;super(null,v?o:null===o||void 0===o?void 0:o.fZ,v?!t:o,O,S,void 0,void 0,void 0,void 0,a),this.name=s,this.wrapU=j.c.CLAMP_ADDRESSMODE,this.wrapV=j.c.CLAMP_ADDRESSMODE,this._generateMipMaps=t;const G=this._getEngine();if(!G)return;if(Z.getContext)this._canvas=Z,this._ownCanvas=!1,this._texture=G.createDynamicTexture(this._canvas.width,this._canvas.height,t,S);else{this._canvas=G.createCanvas(1,1),this._ownCanvas=!0;const s=Z;s.width||0===s.width?this._texture=G.createDynamicTexture(s.width,s.height,t,S):this._texture=G.createDynamicTexture(Z,Z,t,S)}const B=this.getSize();this._canvas.width!==B.width&&(this._canvas.width=B.width),this._canvas.height!==B.height&&(this._canvas.height=B.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(s){this._canvas.width=s.width,this._canvas.height=s.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(s.width,s.height,this._generateMipMaps,this.samplingMode)}scale(s){const Z=this.getSize();Z.width*=s,Z.height*=s,this._recreate(Z)}scaleTo(s,Z){const o=this.getSize();o.width=s,o.height=Z,this._recreate(o)}getContext(){return this._context}clear(s){const Z=this.getSize();s&&(this._context.fillStyle=s),this._context.clearRect(0,0,Z.width,Z.height)}update(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===s||s,Z,this._format||void 0,void 0,o)}drawText(s,Z,o,t,j,S,a){let O=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const v=this.getSize();if(S&&(this._context.fillStyle=S,this._context.fillRect(0,0,v.width,v.height)),this._context.font=t,null===Z||void 0===Z){const o=this._context.measureText(s);Z=(v.width-o.width)/2}if(null===o||void 0===o){const s=parseInt(t.replace(/\D/g,""));o=v.height/2+s/3.65}this._context.fillStyle=j||"",this._context.fillText(s,Z,o),O&&this.update(a)}dispose(){var s,Z;(super.dispose(),this._ownCanvas)&&(null===(s=this._canvas)||void 0===s||null===(Z=s.remove)||void 0===Z||Z.call(s));this._canvas=null,this._context=null}clone(){const s=this.Ls();if(!s)return this;const Z=this.getSize(),o=new v(this.name,Z,s,this._generateMipMaps);return o.na=this.na,o.level=this.level,o.wrapU=this.wrapU,o.wrapV=this.wrapV,o}serialize(){const s=this.Ls();s&&!s.isReady()&&t.b.Warn("The scene must be ready before serializing the dynamic texture");const Z=super.serialize();return v._IsCanvasElement(this._canvas)&&(Z.base64String=this._canvas.toDataURL()),Z.invertY=this._invertY,Z.samplingMode=this.samplingMode,Z}static _IsCanvasElement(s){return void 0!==s.toDataURL}_rebuild(){this.update()}}},12660:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>j});var t=o(11410);class j extends t.c{get depth(){return this._depth}constructor(s,Z,o,j,S,a){let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],v=arguments.length>7&&void 0!==arguments[7]&&arguments[7],G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:t.c.TRILINEAR_SAMPLINGMODE,B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10?arguments[10]:void 0;super(null,a,!O,v),this.format=S,this._texture=a.getEngine().createRawTexture2DArray(s,Z,o,j,S,O,v,G,null,B,Q),this._depth=j,this.is2DArray=!0}update(s){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,s,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(s,Z,o,t,S){return new j(s,Z,o,t,5,S,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12454:(s,Z,o)=>{"use strict";o.d(Z,{d:()=>O,g:()=>v,h:()=>S,l:()=>a});var t=o(10935),j=o(10900);function S(s,Z){return`{X: ${s.x.toFixed(Z)} Y: ${s.y.toFixed(Z)}}`}function a(s,Z){return`{X: ${s._x.toFixed(Z)} Y: ${s._y.toFixed(Z)} Z: ${s._z.toFixed(Z)}}`}function O(s,Z){return 2*Math.acos((0,t.Clamp)(j.e.Dot(s,Z)))}function v(s,Z){const o=new j.e;return function(s,Z,o){const S=j.n.Cross(s,Z),a=Math.acos((0,t.Clamp)(j.n.Dot(s,Z),-1,1));j.e.RotationAxisToRef(S,a,o)}(s,Z,o),o}},12294:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>G});var t=o(10900),j=o(11174),S=o(11240),a=o(11214),O=o(11291);o(12302);function v(s){let Z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const o=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],S=[];let v=[];const G=s.width||s.size||1,B=s.height||s.size||1,Q=s.depth||s.size||1,D=s.wrap||!1;let z=void 0===s.topBaseAt?1:s.topBaseAt,Y=void 0===s.bottomBaseAt?0:s.bottomBaseAt;z=(z+4)%4,Y=(Y+4)%4;let b=[2,0,3,1][z],f=[2,0,1,3][Y],A=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(D){Z=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],A=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let s=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],o=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const t=[17,18,19,16],j=[22,23,20,21];for(;b>0;)s.unshift(s.pop()),t.unshift(t.pop()),b--;for(;f>0;)o.unshift(o.pop()),j.unshift(j.pop()),f--;s=s.flat(),o=o.flat(),A=A.concat(s).concat(o),Z.push(t[0],t[2],t[3],t[0],t[1],t[2]),Z.push(j[0],j[2],j[3],j[0],j[1],j[2])}const d=[G/2,B/2,Q/2];v=A.reduce(((s,Z,o)=>s.concat(Z*d[o%3])),[]);const U=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,u=s.faceUV||new Array(6),H=s.faceColors,F=[];for(let a=0;a<6;a++)void 0===u[a]&&(u[a]=new t.p(0,0,1,1)),H&&void 0===H[a]&&(H[a]=new j.h(1,1,1,1));for(let t=0;t<6;t++)if(S.push(u[t].z,O.b?1-u[t].w:u[t].w),S.push(u[t].x,O.b?1-u[t].w:u[t].w),S.push(u[t].x,O.b?1-u[t].y:u[t].y),S.push(u[t].z,O.b?1-u[t].y:u[t].y),H)for(let s=0;s<4;s++)F.push(H[t].r,H[t].g,H[t].b,H[t].a);a.d._ComputeSides(U,v,Z,o,S,s.frontUVs,s.backUVs);const i=new a.d;if(i.indices=Z,i.gs=v,i.ls=o,i.es=S,H){const s=U===a.d.DOUBLESIDE?F.concat(F):F;i.Rs=s}return i}function G(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new S.d(s,o);Z.sideOrientation=S.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return v(Z).ws(t,Z.updatable),t}a.d.CreateBox=v,S.d.CreateBox=function(s,Z){return G(s,{size:Z,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12444:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>O});var t=o(11240),j=o(11214),S=o(11291);function a(s){const Z=[],o=[],t=[],a=[],O=s.radius||.5,v=s.tessellation||64,G=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,B=0===s.sideOrientation?0:s.sideOrientation||j.d.DEFAULTSIDE;Z.push(0,0,0),a.push(.5,.5);const Q=2*Math.PI*G,D=1===G?Q/v:Q/(v-1);let z=0;for(let j=0;j<v;j++){const s=Math.cos(z),o=Math.sin(z),t=(s+1)/2,j=(1-o)/2;Z.push(O*s,O*o,0),a.push(t,S.b?1-j:j),z+=D}1===G&&(Z.push(Z[3],Z[4],Z[5]),a.push(a[2],S.b?1-a[3]:a[3]));const Y=Z.length/3;for(let j=1;j<Y-1;j++)o.push(j+1,0,j);j.d.ComputeNormals(Z,o,t),j.d._ComputeSides(B,Z,o,t,a,s.frontUVs,s.backUVs);const b=new j.d;return b.indices=o,b.gs=Z,b.ls=t,b.es=a,b}function O(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new t.d(s,o);Z.sideOrientation=t.d._GetDefaultSideOrientation(Z.sideOrientation),j._originalBuilderSideOrientation=Z.sideOrientation;return a(Z).ws(j,Z.updatable),j}j.d.CreateDisc=a,t.d.CreateDisc=function(s,Z,o){return O(s,{radius:Z,tessellation:o,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12302:(s,Z,o)=>{"use strict";o.d(Z,{d:()=>f,c:()=>d,e:()=>A});var t=o(10900),j=o(11174),S=o(11240),a=o(11214),O=o(11113);S.d._GroundMeshParser=(s,Z)=>v.Parse(s,Z);class v extends S.d{constructor(s,Z){super(s,Z),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=s,this._subdivisionsY=s,this.subdivide(s);const o=this;o.createOrUpdateSubmeshesOctree&&o.createOrUpdateSubmeshesOctree(Z)}getHeightAtCoordinates(s,Z){const o=this.getWorldMatrix(),j=t.g.Matrix[5];o.invertToRef(j);const S=t.g.sO[8];if(t.n.TransformCoordinatesFromFloatsToRef(s,0,Z,j,S),s=S.x,Z=S.z,s<this._minX||s>=this._maxX||Z<=this._minZ||Z>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(s,Z),O=-(a.x*s+a.z*Z+a.w)/a.y;return t.n.TransformCoordinatesFromFloatsToRef(0,O,0,o,S),S.y}getNormalAtCoordinates(s,Z){const o=new t.n(0,1,0);return this.getNormalAtCoordinatesToRef(s,Z,o),o}getNormalAtCoordinatesToRef(s,Z,o){const j=this.getWorldMatrix(),S=t.g.Matrix[5];j.invertToRef(S);const a=t.g.sO[8];if(t.n.TransformCoordinatesFromFloatsToRef(s,0,Z,S,a),s=a.x,Z=a.z,s<this._minX||s>this._maxX||Z<this._minZ||Z>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const O=this._getFacetAt(s,Z);return t.n.TransformNormalFromFloatsToRef(O.x,O.y,O.z,j,o),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(s,Z){const o=Math.floor((s+this._maxX)*this._subdivisionsX/this._width),t=Math.floor(-(Z+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),j=this._heightQuads[t*this._subdivisionsX+o];let S;return S=Z<j.slope.x*s+j.slope.y?j.facet1:j.facet2,S}_initHeightQuads(){const s=this._subdivisionsX,Z=this._subdivisionsY;this._heightQuads=[];for(let o=0;o<Z;o++)for(let Z=0;Z<s;Z++){const j={slope:t.j.Zero(),facet1:new t.p(0,0,0,0),facet2:new t.p(0,0,0,0)};this._heightQuads[o*s+Z]=j}return this}_computeHeightQuads(){const s=this.getVerticesData(O.e.PositionKind);if(!s)return this;const Z=t.g.sO[3],o=t.g.sO[2],j=t.g.sO[1],S=t.g.sO[0],a=t.g.sO[4],v=t.g.sO[5],G=t.g.sO[6],B=t.g.sO[7],Q=t.g.sO[8];let D=0,z=0,Y=0,b=0,f=0,A=0,d=0;const U=this._subdivisionsX,u=this._subdivisionsY;for(let O=0;O<u;O++)for(let u=0;u<U;u++){D=3*u,z=O*(U+1)*3,Y=(O+1)*(U+1)*3,Z.x=s[z+D],Z.y=s[z+D+1],Z.z=s[z+D+2],o.x=s[z+D+3],o.y=s[z+D+4],o.z=s[z+D+5],j.x=s[Y+D],j.y=s[Y+D+1],j.z=s[Y+D+2],S.x=s[Y+D+3],S.y=s[Y+D+4],S.z=s[Y+D+5],b=(S.z-Z.z)/(S.x-Z.x),f=Z.z-b*Z.x,o.subtractToRef(Z,a),j.subtractToRef(Z,v),S.subtractToRef(Z,G),t.n.CrossToRef(G,v,B),t.n.CrossToRef(a,G,Q),B.normalize(),Q.normalize(),A=-(B.x*Z.x+B.y*Z.y+B.z*Z.z),d=-(Q.x*o.x+Q.y*o.y+Q.z*o.z);const H=this._heightQuads[O*U+u];H.slope.Ja(b,f),H.facet1.Ja(B.x,B.y,B.z,A),H.facet2.Ja(Q.x,Q.y,Q.z,d)}return this}serialize(s){super.serialize(s),s.subdivisionsX=this._subdivisionsX,s.subdivisionsY=this._subdivisionsY,s.minX=this._minX,s.maxX=this._maxX,s.OO=this._minZ,s.maxZ=this._maxZ,s.width=this._width,s.height=this._height}static Parse(s,Z){const o=new v(s.name,Z);return o._subdivisionsX=s.subdivisionsX||1,o._subdivisionsY=s.subdivisionsY||1,o._minX=s.minX,o._maxX=s.maxX,o._minZ=s.OO,o._maxZ=s.maxZ,o._width=s.width,o._height=s.height,o}}var G=o(10938),B=o(10927),Q=o(10904),D=o(11291);function z(s){const Z=[],o=[],j=[],S=[];let O,v;const G=s.width||s.size||1,B=s.height||s.size||1,Q=0|(s.subdivisionsX||s.subdivisions||1),z=0|(s.subdivisionsY||s.subdivisions||1);for(O=0;O<=z;O++)for(v=0;v<=Q;v++){const s=new t.n(v*G/Q-G/2,0,(z-O)*B/z-B/2),Z=new t.n(0,1,0);o.push(s.x,s.y,s.z),j.push(Z.x,Z.y,Z.z),S.push(v/Q,D.b?O/z:1-O/z)}for(O=0;O<z;O++)for(v=0;v<Q;v++)Z.push(v+1+(O+1)*(Q+1)),Z.push(v+1+O*(Q+1)),Z.push(v+O*(Q+1)),Z.push(v+(O+1)*(Q+1)),Z.push(v+1+(O+1)*(Q+1)),Z.push(v+O*(Q+1));const Y=new a.d;return Y.indices=Z,Y.gs=o,Y.ls=j,Y.es=S,Y}function Y(s){const Z=void 0!==s.xmin&&null!==s.xmin?s.xmin:-1,o=void 0!==s.zmin&&null!==s.zmin?s.zmin:-1,j=void 0!==s.xmax&&null!==s.xmax?s.xmax:1,S=void 0!==s.zmax&&null!==s.zmax?s.zmax:1,O=s.subdivisions||{w:1,h:1},v=s.precision||{w:1,h:1},G=[],B=[],Q=[],D=[];let z,Y,b,f;O.h=O.h<1?1:O.h,O.w=O.w<1?1:O.w,v.w=v.w<1?1:v.w,v.h=v.h<1?1:v.h;const A=(j-Z)/O.w,d=(S-o)/O.h;function U(s,Z,o,j){const S=B.length/3,a=v.w+1;for(z=0;z<v.h;z++)for(Y=0;Y<v.w;Y++){const s=[S+Y+z*a,S+(Y+1)+z*a,S+(Y+1)+(z+1)*a,S+Y+(z+1)*a];G.push(s[1]),G.push(s[2]),G.push(s[3]),G.push(s[0]),G.push(s[1]),G.push(s[3])}const O=t.n.Zero(),b=new t.n(0,1,0);for(z=0;z<=v.h;z++)for(O.z=z*(j-Z)/v.h+Z,Y=0;Y<=v.w;Y++)O.x=Y*(o-s)/v.w+s,O.y=0,B.push(O.x,O.y,O.z),Q.push(b.x,b.y,b.z),D.push(Y/v.w,z/v.h)}for(b=0;b<O.h;b++)for(f=0;f<O.w;f++)U(Z+f*A,o+b*d,Z+(f+1)*A,o+(b+1)*d);const u=new a.d;return u.indices=G,u.gs=B,u.ls=Q,u.es=D,u}function b(s){const Z=[],o=[],S=[],O=[];let v,G;const B=s.colorFilter||new j.d(.3,.59,.11),D=s.alphaFilter||0;let z=!1;if(s.minHeight>s.maxHeight){z=!0;const Z=s.maxHeight;s.maxHeight=s.minHeight,s.minHeight=Z}for(v=0;v<=s.subdivisions;v++)for(G=0;G<=s.subdivisions;G++){const Z=new t.n(G*s.width/s.subdivisions-s.width/2,0,(s.subdivisions-v)*s.height/s.subdivisions-s.height/2),j=4*(((Z.x+s.width/2)/s.width*(s.bufferWidth-1)|0)+((1-(Z.z+s.height/2)/s.height)*(s.bufferHeight-1)|0)*s.bufferWidth);let a=s.buffer[j]/255,Y=s.buffer[j+1]/255,b=s.buffer[j+2]/255;const f=s.buffer[j+3]/255;z&&(a=1-a,Y=1-Y,b=1-b);const A=a*B.r+Y*B.g+b*B.b;Z.y=f>=D?s.minHeight+(s.maxHeight-s.minHeight)*A:s.minHeight-Q.b,s.heightBuffer&&(s.heightBuffer[v*(s.subdivisions+1)+G]=Z.y),o.push(Z.x,Z.y,Z.z),S.push(0,0,0),O.push(G/s.subdivisions,1-v/s.subdivisions)}for(v=0;v<s.subdivisions;v++)for(G=0;G<s.subdivisions;G++){const t=G+1+(v+1)*(s.subdivisions+1),j=G+1+v*(s.subdivisions+1),S=G+v*(s.subdivisions+1),a=G+(v+1)*(s.subdivisions+1),O=o[3*t+1]>=s.minHeight,B=o[3*j+1]>=s.minHeight,Q=o[3*S+1]>=s.minHeight;O&&B&&Q&&(Z.push(t),Z.push(j),Z.push(S));o[3*a+1]>=s.minHeight&&O&&Q&&(Z.push(a),Z.push(t),Z.push(S))}a.d.ComputeNormals(o,Z,S);const Y=new a.d;return Y.indices=Z,Y.gs=o,Y.ls=S,Y.es=O,Y}function f(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new v(s,arguments.length>2?arguments[2]:void 0);o._setReady(!1),o._subdivisionsX=Z.subdivisionsX||Z.subdivisions||1,o._subdivisionsY=Z.subdivisionsY||Z.subdivisions||1,o._width=Z.width||1,o._height=Z.height||1,o._maxX=o._width/2,o._maxZ=o._height/2,o._minX=-o._maxX,o._minZ=-o._maxZ;return z(Z).ws(o,Z.updatable),o._setReady(!0),o}function A(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new S.d(s,o);return Y(Z).ws(t,Z.updatable),t}function d(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=o.width||10,a=o.height||10,O=o.subdivisions||1,Q=o.minHeight||0,D=o.maxHeight||1,z=o.colorFilter||new j.d(.3,.59,.11),Y=o.alphaFilter||0,f=o.updatable,A=o.onReady;t=t||B.c.LastCreatedScene;const d=new v(s,t);let U;d._subdivisionsX=O,d._subdivisionsY=O,d._width=S,d._height=a,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1),o.passHeightBufferInCallback&&(U=new Float32Array((O+1)*(O+1)));const u=(s,Z,o)=>{b({width:S,height:a,subdivisions:O,minHeight:Q,maxHeight:D,colorFilter:z,buffer:s,bufferWidth:Z,bufferHeight:o,alphaFilter:Y,heightBuffer:U}).ws(d,f),A&&A(d,U),d._setReady(!0)};if("string"===typeof Z){const s=s=>{var Z;const o=s.width,j=s.height;if(t.B)return;const S=null===(Z=t)||void 0===Z?void 0:Z.getEngine().resizeImageBitmap(s,o,j);u(S,o,j)};G.g.LoadImage(Z,s,o.onError?o.onError:()=>{},t.offlineProvider)}else u(Z.data,Z.width,Z.height);return d}a.d.CreateGround=z,a.d.CreateTiledGround=Y,a.d.CreateGroundFromHeightMap=b,S.d.CreateGround=(s,Z,o,t,j,S)=>f(s,{width:Z,height:o,subdivisions:t,updatable:S},j),S.d.CreateTiledGround=(s,Z,o,t,j,S,a,O,v)=>A(s,{xmin:Z,zmin:o,xmax:t,zmax:j,subdivisions:S,precision:a,updatable:v},O),S.d.CreateGroundFromHeightMap=(s,Z,o,t,j,S,a,O,v,G,B)=>d(s,Z,{width:o,height:t,subdivisions:j,minHeight:S,maxHeight:a,updatable:v,onReady:G,alphaFilter:B},O)},12955:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>z,d:()=>Q,g:()=>D});var t=o(10900),j=o(11240),S=o(11214),a=o(11635),O=o(11113),v=o(10955);function G(s){const Z=[],o=[],t=s.lines,j=s.Rs,a=[];let O=0;for(let S=0;S<t.length;S++){const s=t[S];for(let t=0;t<s.length;t++){const{x:v,y:G,z:B}=s[t];if(o.push(v,G,B),j){const s=j[S],{r:Z,g:o,b:O,a:v}=s[t];a.push(Z,o,O,v)}t>0&&(Z.push(O-1),Z.push(O)),O++}}const v=new S.d;return v.indices=Z,v.gs=o,j&&(v.Rs=a),v}function B(s){const Z=s.dashSize||3,o=s.gapSize||1,j=s.dashNb||200,a=s.points,O=[],v=[],G=t.n.Zero();let B=0,Q=0,D=0,z=0,Y=0,b=0,f=0;for(f=0;f<a.length-1;f++)a[f+1].subtractToRef(a[f],G),B+=G.length();for(D=B/j,z=Z*D/(Z+o),f=0;f<a.length-1;f++){a[f+1].subtractToRef(a[f],G),Q=Math.floor(G.length()/D),G.normalize();for(let s=0;s<Q;s++)Y=D*s,O.push(a[f].x+Y*G.x,a[f].y+Y*G.y,a[f].z+Y*G.z),O.push(a[f].x+(Y+z)*G.x,a[f].y+(Y+z)*G.y,a[f].z+(Y+z)*G.z),v.push(b,b+1),b+=2}const A=new S.d;return A.gs=O,A.indices=v,A}function Q(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=Z.instance,j=Z.lines,S=Z.Rs;if(t){const s=t.getVerticesData(O.e.PositionKind);let Z,o;S&&(Z=t.getVerticesData(O.e.ColorKind));let a=0,v=0;for(let t=0;t<j.length;t++){const O=j[t];for(let j=0;j<O.length;j++)s[a]=O[j].x,s[a+1]=O[j].y,s[a+2]=O[j].z,S&&Z&&(o=S[t],Z[v]=o[j].r,Z[v+1]=o[j].g,Z[v+2]=o[j].b,Z[v+3]=o[j].a,v+=4),a+=3}return t.updateVerticesData(O.e.PositionKind,s,!1,!1),S&&Z&&t.updateVerticesData(O.e.ColorKind,Z,!1,!1),t.refreshBoundingInfo(),t}const v=!!S,B=new a.d(s,o,null,void 0,void 0,v,Z.useVertexAlpha,Z.material);return G(Z).ws(B,Z.updatable),B}function D(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=Z.Rs?[Z.Rs]:null;return Q(s,{lines:[Z.points],updatable:Z.updatable,instance:Z.instance,Rs:t,useVertexAlpha:Z.useVertexAlpha,material:Z.material},o)}function z(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Z.points,O=Z.instance,G=Z.gapSize||1,Q=Z.dashSize||3;if(O){const s=s=>{const Z=t.n.Zero(),o=s.length/6;let j=0,a=0,v=0,G=0,B=0,Q=0,D=0,z=0;for(D=0;D<S.length-1;D++)S[D+1].subtractToRef(S[D],Z),j+=Z.length();v=j/o;const Y=O._creationDataStorage.dashSize;for(G=Y*v/(Y+O._creationDataStorage.gapSize),D=0;D<S.length-1;D++)for(S[D+1].subtractToRef(S[D],Z),a=Math.floor(Z.length()/v),Z.normalize(),z=0;z<a&&Q<s.length;)B=v*z,s[Q]=S[D].x+B*Z.x,s[Q+1]=S[D].y+B*Z.y,s[Q+2]=S[D].z+B*Z.z,s[Q+3]=S[D].x+(B+G)*Z.x,s[Q+4]=S[D].y+(B+G)*Z.y,s[Q+5]=S[D].z+(B+G)*Z.z,Q+=6,z++;for(;Q<s.length;)s[Q]=S[D].x,s[Q+1]=S[D].y,s[Q+2]=S[D].z,Q+=3};return(Z.dashNb||Z.dashSize||Z.gapSize||Z.useVertexAlpha||Z.material)&&v.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),O.updateMeshPositions(s,!1),O}const D=new a.d(s,o,null,void 0,void 0,void 0,Z.useVertexAlpha,Z.material);return B(Z).ws(D,Z.updatable),D._creationDataStorage=new j.f,D._creationDataStorage.dashSize=Q,D._creationDataStorage.gapSize=G,D}S.d.CreateLineSystem=G,S.d.CreateDashedLines=B,j.d.mv=function(s,Z){return D(s,{points:Z,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},j.d.CreateDashedLines=function(s,Z,o,t,j){return z(s,{points:Z,dashSize:o,gapSize:t,dashNb:j,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12346:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>O,g:()=>v});var t=o(11240),j=o(11214),S=o(11291);function a(s){const Z=[],o=[],t=[],a=[],O=void 0!==s.width?s.width:void 0!==s.size?s.size:1,v=void 0!==s.height?s.height:void 0!==s.size?s.size:1,G=0===s.sideOrientation?0:s.sideOrientation||j.d.DEFAULTSIDE,B=O/2,Q=v/2;o.push(-B,-Q,0),t.push(0,0,-1),a.push(0,S.b?1:0),o.push(B,-Q,0),t.push(0,0,-1),a.push(1,S.b?1:0),o.push(B,Q,0),t.push(0,0,-1),a.push(1,S.b?0:1),o.push(-B,Q,0),t.push(0,0,-1),a.push(0,S.b?0:1),Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),j.d._ComputeSides(G,o,Z,t,a,s.frontUVs,s.backUVs);const D=new j.d;return D.indices=Z,D.gs=o,D.ls=t,D.es=a,D}function O(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new t.d(s,o);Z.sideOrientation=t.d._GetDefaultSideOrientation(Z.sideOrientation),j._originalBuilderSideOrientation=Z.sideOrientation;return a(Z).ws(j,Z.updatable),Z.sourcePlane&&(j.translate(Z.sourcePlane.gt,-Z.sourcePlane.d),j.setDirection(Z.sourcePlane.gt.scale(-1))),j}const v={Jv:O};j.d.Jv=a,t.d.Jv=(s,Z,o,t,j)=>O(s,{size:Z,width:Z,height:Z,sideOrientation:j,updatable:t},o)},12433:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>v});var t=o(10900),j=o(11240),S=o(11214),a=o(11291);function O(s){const Z=0|(s.segments||32),o=s.diameterX||s.diameter||1,j=s.diameterY||s.diameter||1,O=s.diameterZ||s.diameter||1,v=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,G=s.slice&&s.slice<=0?1:s.slice||1,B=0===s.sideOrientation?0:s.sideOrientation||S.d.DEFAULTSIDE,Q=!!s.dedupTopBottomIndices,D=new t.n(o/2,j/2,O/2),z=2+Z,Y=2*z,b=[],f=[],A=[],d=[];for(let S=0;S<=z;S++){const s=S/z,Z=s*Math.PI*G;for(let o=0;o<=Y;o++){const j=o/Y,S=j*Math.PI*2*v,O=t.b.RotationZ(-Z),G=t.b.RotationY(S),B=t.n.TransformCoordinates(t.n.Up(),O),Q=t.n.TransformCoordinates(B,G),z=Q.multiply(D),b=Q.divide(D).normalize();f.push(z.x,z.y,z.z),A.push(b.x,b.y,b.z),d.push(j,a.b?1-s:s)}if(S>0){const s=f.length/3;for(let Z=s-2*(Y+1);Z+Y+2<s;Z++)Q?(S>1&&(b.push(Z),b.push(Z+1),b.push(Z+Y+1)),(S<z||G<1)&&(b.push(Z+Y+1),b.push(Z+1),b.push(Z+Y+2))):(b.push(Z),b.push(Z+1),b.push(Z+Y+1),b.push(Z+Y+1),b.push(Z+1),b.push(Z+Y+2))}}S.d._ComputeSides(B,f,b,A,d,s.frontUVs,s.backUVs);const U=new S.d;return U.indices=b,U.gs=f,U.ls=A,U.es=d,U}function v(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return O(Z).ws(t,Z.updatable),t}S.d.CreateSphere=O,j.d.CreateSphere=(s,Z,o,t,j,S)=>v(s,{segments:Z,diameterX:o,diameterY:o,diameterZ:o,sideOrientation:S,updatable:j},t)},13234:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>O});var t=o(11661),j=o(12752),S=o(11675),a=o(11214);class O{static get Configuration(){return{get decoder(){return j.b.DefaultConfiguration},set decoder(s){j.b.DefaultConfiguration=s}}}static set Configuration(s){j.b.DefaultConfiguration=s.decoder}static get DecoderAvailable(){return(0,t.i)(j.b.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(s){O._Default&&(s||O._Default.dispose(),O._Default=null)}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultNumWorkers;const Z="number"===typeof s?{...j.b.DefaultConfiguration,numWorkers:s}:{...j.b.DefaultConfiguration,...s};this._decoder=new j.b(Z)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(s,Z,o){return this._decoder.decodeMeshToMeshDataAsync(s,Z,o)}async decodeMeshToGeometryAsync(s,Z,o,t){return await this._decoder.decodeMeshToGeometryAsync(s,Z,o,t)}async _decodeMeshToGeometryForGltfAsync(s,Z,o,t,j,S){return await this._decoder._decodeMeshToGeometryForGltfAsync(s,Z,o,t,j,S)}async decodeMeshAsync(s,Z){const o=await this._decoder.decodeMeshToMeshDataAsync(s,Z),t=new a.d;o.indices&&(t.indices=o.indices);for(const j of o.attributes){const s=S.e.GetFloatData(j.data,j.size,S.e.GetDataType(j.data),j.byteOffset,j.byteStride,j.normalized,o.totalVertices);t.set(s,j.kind)}return t}}O.DefaultNumWorkers=(0,t.g)(),O._Default=null},12752:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>G});var t=o(11661),j=o(10938),S=o(11273),a=o(11675),O=o(10955),v=o(11669);class G extends t.e{static get DefaultAvailable(){return(0,t.i)(G.DefaultConfiguration)}static get Default(){return G._Default??(G._Default=new G),G._Default}static ResetDefault(s){G._Default&&(s||G._Default.dispose(),G._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(s,Z){return{module:await(Z||DracoDecoderModule)({wasmBinary:s})}}_getWorkerContent(){return`${v.c}(${v.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.DefaultConfiguration)}decodeMeshToMeshDataAsync(s,Z,o){const t=s instanceof ArrayBuffer?new Int8Array(s):new Int8Array(s.buffer,s.byteOffset,s.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async s=>await new Promise(((j,S)=>{s.push(((s,a)=>{let v=null;const G=[],B=Z=>{s.removeEventListener("error",B),s.removeEventListener("message",Q),S(Z),a()},Q=Z=>{const t=Z.data;switch(t.id){case"indices":v=t.data;break;case"attribute":G.push({kind:t.kind,data:t.data,size:t.size,byteOffset:t.byteOffset,byteStride:t.byteStride,normalized:(S=t.kind,D=t.normalized,o&&void 0!==o[S]?(D!==o[S]&&O.b.Warn(`Normalized flag from Draco data (${D}) does not match normalized flag from glTF accessor (${o[S]}). Using flag from glTF accessor.`),o[S]):D)});break;case"decodeMeshDone":s.removeEventListener("error",B),s.removeEventListener("message",Q),j({indices:v,attributes:G,totalVertices:t.totalVertices}),a()}var S,D};s.addEventListener("error",B),s.addEventListener("message",Q);const D=t.slice();s.postMessage({id:"decodeMesh",dataView:D,attributes:Z},[D.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((s=>{let o=null;const j=[],S=(0,v.c)(s.module,t,Z,(s=>{o=s}),((s,Z,o,t,S,a)=>{j.push({kind:s,data:Z,size:o,byteOffset:t,byteStride:S,normalized:a})}));return{indices:o,attributes:j,totalVertices:S}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(s,Z,o,t){const j=await this.decodeMeshToMeshDataAsync(o,t),O=new S.e(s,Z);j.indices&&O.setIndices(j.indices);for(const S of j.attributes)O.setVerticesBuffer(new a.e(Z.getEngine(),S.data,S.kind,!1,void 0,S.byteStride,void 0,S.byteOffset,S.size,void 0,S.normalized,!0),j.totalVertices);return O}async _decodeMeshToGeometryForGltfAsync(s,Z,o,t,j,O){const v=await this.decodeMeshToMeshDataAsync(o,t,j),G=new S.e(s,Z);O&&(G._boundingInfo=O,G.useBoundingInfoFromGeometry=!0),v.indices&&G.setIndices(v.indices);for(const S of v.attributes)G.setVerticesBuffer(new a.e(Z.getEngine(),S.data,S.kind,!1,void 0,S.byteStride,void 0,S.byteOffset,S.size,void 0,S.normalized,!0),v.totalVertices);return G}}G.DefaultConfiguration={wasmUrl:`${j.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${j.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${j.g._DefaultCdnUrl}/draco_decoder_gltf.js`},G._Default=null},12950:(s,Z,o)=>{"use strict";o.d(Z,{c:()=>Os});var t=o(10900),j=o(11240),S=o(11113),a=o(11214),O=o(11291);function v(s){let Z=s.pathArray;const o=s.closeArray||!1,t=s.closePath||!1,j=s.invertUV||!1,v=Math.floor(Z[0].length/2);let G=s.offset||v;G=G>v?v:Math.floor(G);const B=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,Q=s.es,D=s.Rs,z=[],Y=[],b=[],f=[],A=[],d=[],U=[],u=[];let H;const F=[],i=[];let N,L,V;if(Z.length<2){const s=[],o=[];for(L=0;L<Z[0].length-G;L++)s.push(Z[0][L]),o.push(Z[0][L+G]);Z=[s,o]}let g=0;const l=t?1:0,R=o?1:0;let e,c,w,X,W,q;for(H=Z[0].length,N=0;N<Z.length+R;N++){for(U[N]=0,A[N]=[0],e=N===Z.length?Z[0]:Z[N],c=e.length,H=H<c?H:c,V=0;V<c;)z.push(e[V].x,e[V].y,e[V].z),V>0&&(w=e[V].Go(e[V-1]).length(),X=w+U[N],A[N].push(X),U[N]=X),V++;t&&(V--,z.push(e[0].x,e[0].y,e[0].z),w=e[V].Go(e[0]).length(),X=w+U[N],A[N].push(X),U[N]=X),F[N]=c+l,i[N]=g,g+=c+l}let h,M,x=null,k=null;for(L=0;L<H+l;L++)for(u[L]=0,d[L]=[0],N=0;N<Z.length-1+R;N++)W=Z[N],q=N===Z.length-1?Z[0]:Z[N+1],L===H?(x=W[0],k=q[0]):(x=W[L],k=q[L]),w=k.Go(x).length(),X=w+u[L],d[L].push(X),u[L]=X;if(Q)for(N=0;N<Q.length;N++)f.push(Q[N].x,O.b?1-Q[N].y:Q[N].y);else for(N=0;N<Z.length+R;N++)for(L=0;L<H+l;L++)h=0!=U[N]?A[N][L]/U[N]:0,M=0!=u[L]?d[L][N]/u[L]:0,j?f.push(M,h):f.push(h,O.b?1-M:M);N=0;let y=0,I=F[N]-1,C=F[N+1]-1,K=I<C?I:C,p=i[1]-i[0];const E=F.length-1;for(;y<=K&&N<E;)Y.push(y,y+p,y+1),Y.push(y+p+1,y+1,y+p),y+=1,y===K&&(N++,p=i[N+1]-i[N],I=F[N]-1,C=F[N+1]-1,y=i[N],K=I<C?I+y:C+y);if(a.d.ComputeNormals(z,Y,b),t){let s=0,o=0;for(N=0;N<Z.length;N++){s=3*i[N],o=N+1<Z.length?3*(i[N+1]-1):b.length-3,b[s]=.5*(b[s]+b[o]),b[s+1]=.5*(b[s+1]+b[o+1]),b[s+2]=.5*(b[s+2]+b[o+2]);const t=Math.sqrt(b[s]*b[s]+b[s+1]*b[s+1]+b[s+2]*b[s+2]);b[s]/=t,b[s+1]/=t,b[s+2]/=t,b[o]=b[s],b[o+1]=b[s+1],b[o+2]=b[s+2]}}if(o){let s=3*i[0],o=3*i[Z.length];for(L=0;L<H+l;L++){b[s]=.5*(b[s]+b[o]),b[s+1]=.5*(b[s+1]+b[o+1]),b[s+2]=.5*(b[s+2]+b[o+2]);const Z=Math.sqrt(b[s]*b[s]+b[s+1]*b[s+1]+b[s+2]*b[s+2]);b[s]/=Z,b[s+1]/=Z,b[s+2]/=Z,b[o]=b[s],b[o+1]=b[s+1],b[o+2]=b[s+2],s+=3,o+=3}}a.d._ComputeSides(B,z,Y,b,f,s.frontUVs,s.backUVs);let P=null;if(D){P=new Float32Array(4*D.length);for(let s=0;s<D.length;s++)P[4*s]=D[s].r,P[4*s+1]=D[s].g,P[4*s+2]=D[s].b,P[4*s+3]=D[s].a}const r=new a.d,T=new Float32Array(z),m=new Float32Array(b),n=new Float32Array(f);return r.indices=Y,r.gs=T,r.ls=m,r.es=n,P&&r.set(P,S.e.ColorKind),t&&(r._idx=i),r}function G(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=Z.pathArray,B=Z.closeArray,Q=Z.closePath,D=j.d._GetDefaultSideOrientation(Z.sideOrientation),z=Z.instance,Y=Z.updatable;if(z){const s=t.g.sO[0].tO(Number.MAX_VALUE),o=t.g.sO[1].tO(-Number.MAX_VALUE),v=Z=>{let t=G[0].length;const S=z;let a=0;const O=S._originalBuilderSideOrientation===j.d.DOUBLESIDE?2:1;for(let j=1;j<=O;++j)for(let O=0;O<G.length;++O){const j=G[O],v=j.length;t=t<v?t:v;for(let S=0;S<t;++S){const t=j[S];Z[a]=t.x,Z[a+1]=t.y,Z[a+2]=t.z,s.minimizeInPlaceFromFloats(t.x,t.y,t.z),o.maximizeInPlaceFromFloats(t.x,t.y,t.z),a+=3}if(S._creationDataStorage&&S._creationDataStorage.closePath){const s=j[0];Z[a]=s.x,Z[a+1]=s.y,Z[a+2]=s.z,a+=3}}},B=z.getVerticesData(S.e.PositionKind);if(v(B),z.hasBoundingInfo?z.getBoundingInfo().reConstruct(s,o,z._worldMatrix):z.buildBoundingInfo(s,o,z._worldMatrix),z.updateVerticesData(S.e.PositionKind,B,!1,!1),Z.Rs){const s=z.getVerticesData(S.e.ColorKind);for(let o=0,t=0;o<Z.Rs.length;o++,t+=4){const j=Z.Rs[o];s[t]=j.r,s[t+1]=j.g,s[t+2]=j.b,s[t+3]=j.a}z.updateVerticesData(S.e.ColorKind,s,!1,!1)}if(Z.es){const s=z.getVerticesData(S.e.UVKind);for(let o=0;o<Z.es.length;o++)s[2*o]=Z.es[o].x,s[2*o+1]=O.b?1-Z.es[o].y:Z.es[o].y;z.updateVerticesData(S.e.UVKind,s,!1,!1)}if(!z.areNormalsFrozen||z.isFacetDataEnabled){const s=z.ra(),Z=z.getVerticesData(S.e.NormalKind),o=z.isFacetDataEnabled?z.getFacetDataParameters():null;if(a.d.ComputeNormals(B,s,Z,o),z._creationDataStorage&&z._creationDataStorage.closePath){let s=0,o=0;for(let t=0;t<G.length;t++)s=3*z._creationDataStorage.idx[t],o=t+1<G.length?3*(z._creationDataStorage.idx[t+1]-1):Z.length-3,Z[s]=.5*(Z[s]+Z[o]),Z[s+1]=.5*(Z[s+1]+Z[o+1]),Z[s+2]=.5*(Z[s+2]+Z[o+2]),Z[o]=Z[s],Z[o+1]=Z[s+1],Z[o+2]=Z[s+2]}z.areNormalsFrozen||z.updateVerticesData(S.e.NormalKind,Z,!1,!1)}return z}{const t=new j.d(s,o);t._originalBuilderSideOrientation=D,t._creationDataStorage=new j.f;const S=v(Z);return Q&&(t._creationDataStorage.idx=S._idx),t._creationDataStorage.closePath=Q,t._creationDataStorage.closeArray=B,S.ws(t,Y),t}}a.d.CreateRibbon=v,j.d.CreateRibbon=function(s,Z){return G(s,{pathArray:Z,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var B=o(12444),Q=o(12294),D=o(11174);function z(s){const Z=s.pattern||j.d.NO_FLIP,o=s.tileWidth||s.tileSize||1,t=s.tileHeight||s.tileSize||1,S=s.alignHorizontal||0,O=s.alignVertical||0,v=s.width||s.size||1,G=Math.floor(v/o);let B=v-G*o;const Q=s.height||s.size||1,D=Math.floor(Q/t);let z=Q-D*t;const Y=o*G/2,b=t*D/2;let f=0,A=0,d=0,U=0,u=0,H=0;if(B>0||z>0){switch(d=-Y,U=-b,u=Y,H=b,S){case j.d.CENTER:B/=2,d-=B,u+=B;break;case j.d.LEFT:u+=B,f=-B/2;break;case j.d.RIGHT:d-=B,f=B/2}switch(O){case j.d.CENTER:z/=2,U-=z,H+=z;break;case j.d.BOTTOM:H+=z,A=-z/2;break;case j.d.TOP:U-=z,A=z/2}}const F=[],i=[],N=[];N[0]=[0,0,1,0,1,1,0,1],N[1]=[0,0,1,0,1,1,0,1],Z!==j.d.ROTATE_TILE&&Z!==j.d.ROTATE_ROW||(N[1]=[1,1,0,1,0,0,1,0]),Z!==j.d.FLIP_TILE&&Z!==j.d.FLIP_ROW||(N[1]=[1,0,0,0,0,1,1,1]),Z!==j.d.FLIP_N_ROTATE_TILE&&Z!==j.d.FLIP_N_ROTATE_ROW||(N[1]=[0,1,1,1,1,0,0,0]);let L=[];const V=[],g=[];let l=0;for(let a=0;a<D;a++)for(let s=0;s<G;s++)F.push(s*o-Y+f,a*t-b+A,0),F.push((s+1)*o-Y+f,a*t-b+A,0),F.push((s+1)*o-Y+f,(a+1)*t-b+A,0),F.push(s*o-Y+f,(a+1)*t-b+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),L=Z===j.d.FLIP_TILE||Z===j.d.ROTATE_TILE||Z===j.d.FLIP_N_ROTATE_TILE?L.concat(N[(s%2+a%2)%2]):Z===j.d.FLIP_ROW||Z===j.d.ROTATE_ROW||Z===j.d.FLIP_N_ROTATE_ROW?L.concat(N[a%2]):L.concat(N[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),l+=4;if(B>0||z>0){const s=z>0&&(O===j.d.CENTER||O===j.d.TOP),a=z>0&&(O===j.d.CENTER||O===j.d.BOTTOM),v=B>0&&(S===j.d.CENTER||S===j.d.RIGHT),Q=B>0&&(S===j.d.CENTER||S===j.d.LEFT);let N,R,e,c,w=[];if(s&&v&&(F.push(d+f,U+A,0),F.push(-Y+f,U+A,0),F.push(-Y+f,U+z+A,0),F.push(d+f,U+z+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,N=1-B/o,R=1-z/t,e=1,c=1,w=[N,R,e,R,e,c,N,c],Z===j.d.ROTATE_ROW&&(w=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),Z===j.d.FLIP_ROW&&(w=[1-N,R,1-e,R,1-e,c,1-N,c]),Z===j.d.FLIP_N_ROTATE_ROW&&(w=[N,1-R,e,1-R,e,1-c,N,1-c]),L=L.concat(w),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),s&&Q&&(F.push(Y+f,U+A,0),F.push(u+f,U+A,0),F.push(u+f,U+z+A,0),F.push(Y+f,U+z+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,N=0,R=1-z/t,e=B/o,c=1,w=[N,R,e,R,e,c,N,c],(Z===j.d.ROTATE_ROW||Z===j.d.ROTATE_TILE&&G%2===0)&&(w=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),(Z===j.d.FLIP_ROW||Z===j.d.FLIP_TILE&&G%2===0)&&(w=[1-N,R,1-e,R,1-e,c,1-N,c]),(Z===j.d.FLIP_N_ROTATE_ROW||Z===j.d.FLIP_N_ROTATE_TILE&&G%2===0)&&(w=[N,1-R,e,1-R,e,1-c,N,1-c]),L=L.concat(w),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&v&&(F.push(d+f,b+A,0),F.push(-Y+f,b+A,0),F.push(-Y+f,H+A,0),F.push(d+f,H+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,N=1-B/o,R=0,e=1,c=z/t,w=[N,R,e,R,e,c,N,c],(Z===j.d.ROTATE_ROW&&D%2===1||Z===j.d.ROTATE_TILE&&D%1===0)&&(w=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),(Z===j.d.FLIP_ROW&&D%2===1||Z===j.d.FLIP_TILE&&D%2===0)&&(w=[1-N,R,1-e,R,1-e,c,1-N,c]),(Z===j.d.FLIP_N_ROTATE_ROW&&D%2===1||Z===j.d.FLIP_N_ROTATE_TILE&&D%2===0)&&(w=[N,1-R,e,1-R,e,1-c,N,1-c]),L=L.concat(w),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&Q&&(F.push(Y+f,b+A,0),F.push(u+f,b+A,0),F.push(u+f,H+A,0),F.push(Y+f,H+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,N=0,R=0,e=B/o,c=z/t,w=[N,R,e,R,e,c,N,c],(Z===j.d.ROTATE_ROW&&D%2===1||Z===j.d.ROTATE_TILE&&(D+G)%2===1)&&(w=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),(Z===j.d.FLIP_ROW&&D%2===1||Z===j.d.FLIP_TILE&&(D+G)%2===1)&&(w=[1-N,R,1-e,R,1-e,c,1-N,c]),(Z===j.d.FLIP_N_ROTATE_ROW&&D%2===1||Z===j.d.FLIP_N_ROTATE_TILE&&(D+G)%2===1)&&(w=[N,1-R,e,1-R,e,1-c,N,1-c]),L=L.concat(w),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),s){const s=[];N=0,R=1-z/t,e=1,c=1,s[0]=[N,R,e,R,e,c,N,c],s[1]=[N,R,e,R,e,c,N,c],Z!==j.d.ROTATE_TILE&&Z!==j.d.ROTATE_ROW||(s[1]=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),Z!==j.d.FLIP_TILE&&Z!==j.d.FLIP_ROW||(s[1]=[1-N,R,1-e,R,1-e,c,1-N,c]),Z!==j.d.FLIP_N_ROTATE_TILE&&Z!==j.d.FLIP_N_ROTATE_ROW||(s[1]=[N,1-R,e,1-R,e,1-c,N,1-c]);for(let t=0;t<G;t++)F.push(t*o-Y+f,U+A,0),F.push((t+1)*o-Y+f,U+A,0),F.push((t+1)*o-Y+f,U+z+A,0),F.push(t*o-Y+f,U+z+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,L=Z===j.d.FLIP_TILE||Z===j.d.ROTATE_TILE||Z===j.d.FLIP_N_ROTATE_TILE?L.concat(s[(t+1)%2]):Z===j.d.FLIP_ROW||Z===j.d.ROTATE_ROW||Z===j.d.FLIP_N_ROTATE_ROW?L.concat(s[1]):L.concat(s[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const s=[];N=0,R=0,e=1,c=z/t,s[0]=[N,R,e,R,e,c,N,c],s[1]=[N,R,e,R,e,c,N,c],Z!==j.d.ROTATE_TILE&&Z!==j.d.ROTATE_ROW||(s[1]=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),Z!==j.d.FLIP_TILE&&Z!==j.d.FLIP_ROW||(s[1]=[1-N,R,1-e,R,1-e,c,1-N,c]),Z!==j.d.FLIP_N_ROTATE_TILE&&Z!==j.d.FLIP_N_ROTATE_ROW||(s[1]=[N,1-R,e,1-R,e,1-c,N,1-c]);for(let t=0;t<G;t++)F.push(t*o-Y+f,H-z+A,0),F.push((t+1)*o-Y+f,H-z+A,0),F.push((t+1)*o-Y+f,H+A,0),F.push(t*o-Y+f,H+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,L=Z===j.d.FLIP_TILE||Z===j.d.ROTATE_TILE||Z===j.d.FLIP_N_ROTATE_TILE?L.concat(s[(t+D)%2]):Z===j.d.FLIP_ROW||Z===j.d.ROTATE_ROW||Z===j.d.FLIP_N_ROTATE_ROW?L.concat(s[D%2]):L.concat(s[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const s=[];N=1-B/o,R=0,e=1,c=1,s[0]=[N,R,e,R,e,c,N,c],s[1]=[N,R,e,R,e,c,N,c],Z!==j.d.ROTATE_TILE&&Z!==j.d.ROTATE_ROW||(s[1]=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),Z!==j.d.FLIP_TILE&&Z!==j.d.FLIP_ROW||(s[1]=[1-N,R,1-e,R,1-e,c,1-N,c]),Z!==j.d.FLIP_N_ROTATE_TILE&&Z!==j.d.FLIP_N_ROTATE_ROW||(s[1]=[N,1-R,e,1-R,e,1-c,N,1-c]);for(let o=0;o<D;o++)F.push(d+f,o*t-b+A,0),F.push(d+B+f,o*t-b+A,0),F.push(d+B+f,(o+1)*t-b+A,0),F.push(d+f,(o+1)*t-b+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,L=Z===j.d.FLIP_TILE||Z===j.d.ROTATE_TILE||Z===j.d.FLIP_N_ROTATE_TILE?L.concat(s[(o+1)%2]):Z===j.d.FLIP_ROW||Z===j.d.ROTATE_ROW||Z===j.d.FLIP_N_ROTATE_ROW?L.concat(s[o%2]):L.concat(s[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const s=[];N=0,R=0,e=B/t,c=1,s[0]=[N,R,e,R,e,c,N,c],s[1]=[N,R,e,R,e,c,N,c],Z!==j.d.ROTATE_TILE&&Z!==j.d.ROTATE_ROW||(s[1]=[1-N,1-R,1-e,1-R,1-e,1-c,1-N,1-c]),Z!==j.d.FLIP_TILE&&Z!==j.d.FLIP_ROW||(s[1]=[1-N,R,1-e,R,1-e,c,1-N,c]),Z!==j.d.FLIP_N_ROTATE_TILE&&Z!==j.d.FLIP_N_ROTATE_ROW||(s[1]=[N,1-R,e,1-R,e,1-c,N,1-c]);for(let o=0;o<D;o++)F.push(u-B+f,o*t-b+A,0),F.push(u+f,o*t-b+A,0),F.push(u+f,(o+1)*t-b+A,0),F.push(u-B+f,(o+1)*t-b+A,0),g.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,L=Z===j.d.FLIP_TILE||Z===j.d.ROTATE_TILE||Z===j.d.FLIP_N_ROTATE_TILE?L.concat(s[(o+G)%2]):Z===j.d.FLIP_ROW||Z===j.d.ROTATE_ROW||Z===j.d.FLIP_N_ROTATE_ROW?L.concat(s[o%2]):L.concat(s[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const R=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE;a.d._ComputeSides(R,F,g,i,L,s.frontUVs,s.backUVs);const e=new a.d;e.indices=g,e.gs=F,e.ls=i,e.es=L;const c=R===a.d.DOUBLESIDE?V.concat(V):V;return e.Rs=c,e}function Y(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return z(Z).ws(t,Z.updatable),t}function b(s){const Z=s.faceUV||new Array(6),o=s.faceColors,S=s.pattern||j.d.NO_FLIP,v=s.width||s.size||1,G=s.height||s.size||1,B=s.depth||s.size||1,Q=s.tileWidth||s.tileSize||1,Y=s.tileHeight||s.tileSize||1,b=s.alignHorizontal||0,f=s.alignVertical||0,A=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE;for(let j=0;j<6;j++)void 0===Z[j]&&(Z[j]=new t.p(0,0,1,1)),o&&void 0===o[j]&&(o[j]=new D.h(1,1,1,1));const d=v/2,U=G/2,u=B/2,H=[];for(let t=0;t<2;t++)H[t]=z({pattern:S,tileWidth:Q,tileHeight:Y,width:v,height:G,alignVertical:f,alignHorizontal:b,sideOrientation:A});for(let t=2;t<4;t++)H[t]=z({pattern:S,tileWidth:Q,tileHeight:Y,width:B,height:G,alignVertical:f,alignHorizontal:b,sideOrientation:A});let F=f;f===j.d.BOTTOM?F=j.d.TOP:f===j.d.TOP&&(F=j.d.BOTTOM);for(let t=4;t<6;t++)H[t]=z({pattern:S,tileWidth:Q,tileHeight:Y,width:v,height:B,alignVertical:F,alignHorizontal:b,sideOrientation:A});let i=[],N=[],L=[],V=[];const g=[],l=[],R=[],e=[];let c=0,w=0;for(let j=0;j<6;j++){const s=H[j].gs.length;l[j]=[],R[j]=[];for(let Z=0;Z<s/3;Z++)l[j].push(new t.n(H[j].gs[3*Z],H[j].gs[3*Z+1],H[j].gs[3*Z+2])),R[j].push(new t.n(H[j].ls[3*Z],H[j].ls[3*Z+1],H[j].ls[3*Z+2]));c=H[j].es.length,e[j]=[];for(let o=0;o<c;o+=2)e[j][o]=Z[j].x+(Z[j].z-Z[j].x)*H[j].es[o],e[j][o+1]=Z[j].y+(Z[j].w-Z[j].y)*H[j].es[o+1],O.b&&(e[j][o+1]=1-e[j][o+1]);if(L=L.concat(e[j]),V=V.concat(H[j].indices.map((s=>s+w))),w+=l[j].length,o)for(let Z=0;Z<4;Z++)g.push(o[j].r,o[j].g,o[j].b,o[j].a)}const X=new t.n(0,0,u),W=t.b.RotationY(Math.PI);i=l[0].map((s=>t.n.TransformNormal(s,W).add(X))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[]),N=R[0].map((s=>t.n.TransformNormal(s,W))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[]),i=i.concat(l[1].map((s=>s.Go(X))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[])),N=N.concat(R[1].map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[]));const q=new t.n(d,0,0),h=t.b.RotationY(-Math.PI/2);i=i.concat(l[2].map((s=>t.n.TransformNormal(s,h).add(q))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[])),N=N.concat(R[2].map((s=>t.n.TransformNormal(s,h))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[]));const M=t.b.RotationY(Math.PI/2);i=i.concat(l[3].map((s=>t.n.TransformNormal(s,M).Go(q))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[])),N=N.concat(R[3].map((s=>t.n.TransformNormal(s,M))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[]));const x=new t.n(0,U,0),k=t.b.RotationX(Math.PI/2);i=i.concat(l[4].map((s=>t.n.TransformNormal(s,k).add(x))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[])),N=N.concat(R[4].map((s=>t.n.TransformNormal(s,k))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[]));const y=t.b.RotationX(-Math.PI/2);i=i.concat(l[5].map((s=>t.n.TransformNormal(s,y).Go(x))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[])),N=N.concat(R[5].map((s=>t.n.TransformNormal(s,y))).map((s=>[s.x,s.y,s.z])).reduce(((s,Z)=>s.concat(Z)),[])),a.d._ComputeSides(A,i,V,N,L);const I=new a.d;if(I.indices=V,I.gs=i,I.ls=N,I.es=L,o){const s=A===a.d.DOUBLESIDE?g.concat(g):g;I.Rs=s}return I}function f(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return b(Z).ws(t,Z.updatable),t}a.d.CreateTiledPlane=z;a.d.CreateTiledBox=b;var A=o(12433),d=o(11493),U=o(11229);function u(s){const Z=s.height||2;let o=0===s.diameterTop?0:s.diameterTop||s.diameter||1,S=0===s.diameterBottom?0:s.diameterBottom||s.diameter||1;o=o||1e-5,S=S||1e-5;const v=0|(s.tessellation||24),G=0|(s.subdivisions||1),B=!!s.hasRings,Q=!!s.enclose,z=0===s.cap?0:s.cap||j.d.CAP_ALL,Y=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,b=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,f=s.faceUV||new Array(3),A=s.faceColors,d=2+(1+(1!==Y&&Q?2:0))*(B?G:1);let u;for(u=0;u<d;u++)A&&void 0===A[u]&&(A[u]=new D.h(1,1,1,1));for(u=0;u<d;u++)f&&void 0===f[u]&&(f[u]=new t.p(0,0,1,1));const H=[],F=[],i=[],N=[],L=[],V=2*Math.PI*Y/v;let g,l,R;const e=(S-o)/2/Z,c=t.n.Zero(),w=t.n.Zero(),X=t.n.Zero(),W=t.n.Zero(),q=t.n.Zero(),h=U.c.Y;let M,x,k,y=1,I=1,C=0,K=0;for(M=0;M<=G;M++)for(l=M/G,R=(l*(o-S)+S)/2,y=B&&0!==M&&M!==G?2:1,k=0;k<y;k++){for(B&&(I+=k),Q&&(I+=2*k),x=0;x<=v;x++)g=x*V,c.x=Math.cos(-g)*R,c.y=-Z/2+l*Z,c.z=Math.sin(-g)*R,0===o&&M===G?(w.x=i[i.length-3*(v+1)],w.y=i[i.length-3*(v+1)+1],w.z=i[i.length-3*(v+1)+2]):(w.x=c.x,w.z=c.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*e,w.normalize()),0===x&&(X.O(c),W.O(w)),F.push(c.x,c.y,c.z),i.push(w.x,w.y,w.z),K=B?C!==I?f[I].y:f[I].w:f[I].y+(f[I].w-f[I].y)*l,N.push(f[I].x+(f[I].z-f[I].x)*x/v,O.b?1-K:K),A&&L.push(A[I].r,A[I].g,A[I].b,A[I].a);1!==Y&&Q&&(F.push(c.x,c.y,c.z),F.push(0,c.y,0),F.push(0,c.y,0),F.push(X.x,X.y,X.z),t.n.CrossToRef(h,w,q),q.normalize(),i.push(q.x,q.y,q.z,q.x,q.y,q.z),t.n.CrossToRef(W,h,q),q.normalize(),i.push(q.x,q.y,q.z,q.x,q.y,q.z),K=B?C!==I?f[I+1].y:f[I+1].w:f[I+1].y+(f[I+1].w-f[I+1].y)*l,N.push(f[I+1].x,O.b?1-K:K),N.push(f[I+1].z,O.b?1-K:K),K=B?C!==I?f[I+2].y:f[I+2].w:f[I+2].y+(f[I+2].w-f[I+2].y)*l,N.push(f[I+2].x,O.b?1-K:K),N.push(f[I+2].z,O.b?1-K:K),A&&(L.push(A[I+1].r,A[I+1].g,A[I+1].b,A[I+1].a),L.push(A[I+1].r,A[I+1].g,A[I+1].b,A[I+1].a),L.push(A[I+2].r,A[I+2].g,A[I+2].b,A[I+2].a),L.push(A[I+2].r,A[I+2].g,A[I+2].b,A[I+2].a))),C!==I&&(C=I)}const p=1!==Y&&Q?v+4:v;for(M=0,I=0;I<G;I++){let s=0,Z=0,o=0,t=0;for(x=0;x<v;x++)s=M*(p+1)+x,Z=(M+1)*(p+1)+x,o=M*(p+1)+(x+1),t=(M+1)*(p+1)+(x+1),H.push(s,Z,o),H.push(t,o,Z);1!==Y&&Q&&(H.push(s+2,Z+2,o+2),H.push(t+2,o+2,Z+2),H.push(s+4,Z+4,o+4),H.push(t+4,o+4,Z+4)),M=B?M+2:M+1}const E=s=>{const j=s?o/2:S/2;if(0===j)return;let a,G,B;const Q=s?f[d-1]:f[0];let D=null;A&&(D=s?A[d-1]:A[0]);const z=F.length/3,b=s?Z/2:-Z/2,U=new t.n(0,b,0);F.push(U.x,U.y,U.z),i.push(0,s?1:-1,0);const u=Q.y+.5*(Q.w-Q.y);N.push(Q.x+.5*(Q.z-Q.x),O.b?1-u:u),D&&L.push(D.r,D.g,D.b,D.a);const V=new t.j(.5,.5);for(B=0;B<=v;B++){a=2*Math.PI*B*Y/v;const Z=Math.cos(-a),o=Math.sin(-a);G=new t.n(Z*j,b,o*j);const S=new t.j(Z*V.x+.5,o*V.y+.5);F.push(G.x,G.y,G.z),i.push(0,s?1:-1,0);const z=Q.y+(Q.w-Q.y)*S.y;N.push(Q.x+(Q.z-Q.x)*S.x,O.b?1-z:z),D&&L.push(D.r,D.g,D.b,D.a)}for(B=0;B<v;B++)s?(H.push(z),H.push(z+(B+2)),H.push(z+(B+1))):(H.push(z),H.push(z+(B+1)),H.push(z+(B+2)))};z!==j.d.CAP_START&&z!==j.d.CAP_ALL||E(!1),z!==j.d.CAP_END&&z!==j.d.CAP_ALL||E(!0),a.d._ComputeSides(b,F,H,i,N,s.frontUVs,s.backUVs);const P=new a.d;return P.indices=H,P.gs=F,P.ls=i,P.es=N,A&&(P.Rs=L),P}function H(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return u(Z).ws(t,Z.updatable),t}function F(s){const Z=[],o=[],j=[],S=[],v=s.diameter||1,G=s.thickness||.5,B=0|(s.tessellation||16),Q=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,D=B+1;for(let a=0;a<=B;a++){const s=a/B,Q=a*Math.PI*2/B-Math.PI/2,z=t.b.Translation(v/2,0,0).multiply(t.b.RotationY(Q));for(let v=0;v<=B;v++){const Q=1-v/B,Y=v*Math.PI*2/B+Math.PI,b=Math.cos(Y),f=Math.sin(Y);let A=new t.n(b,f,0),d=A.scale(G/2);const U=new t.j(s,Q);d=t.n.TransformCoordinates(d,z),A=t.n.TransformNormal(A,z),o.push(d.x,d.y,d.z),j.push(A.x,A.y,A.z),S.push(U.x,O.b?1-U.y:U.y);const u=(a+1)%D,H=(v+1)%D;Z.push(a*D+v),Z.push(a*D+H),Z.push(u*D+v),Z.push(a*D+H),Z.push(u*D+H),Z.push(u*D+v)}}a.d._ComputeSides(Q,o,Z,j,S,s.frontUVs,s.backUVs);const z=new a.d;return z.indices=Z,z.gs=o,z.ls=j,z.es=S,z}function i(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return F(Z).ws(t,Z.updatable),t}a.d.CreateCylinder=u,j.d.CreateCylinder=(s,Z,o,t,S,a,O,v,G)=>{void 0!==O&&O instanceof d.c||(void 0!==O&&(G=v||j.d.DEFAULTSIDE,v=O),O=a,a=1);return H(s,{height:Z,diameterTop:o,diameterBottom:t,tessellation:S,subdivisions:a,sideOrientation:G,updatable:v},O)};function N(s){const Z=[],o=[],j=[],S=[],v=s.radius||2,G=s.tube||.5,B=s.radialSegments||32,Q=s.tubularSegments||32,D=s.p||2,z=s.q||3,Y=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,b=s=>{const Z=Math.cos(s),o=Math.sin(s),j=z/D*s,S=Math.cos(j),a=v*(2+S)*.5*Z,O=v*(2+S)*o*.5,G=v*Math.sin(j)*.5;return new t.n(a,O,G)};let f,A;for(f=0;f<=B;f++){const s=f%B/B*2*D*Math.PI,Z=b(s),j=b(s+.01),a=j.Go(Z);let v=j.add(Z);const z=t.n.Cross(a,v);for(v=t.n.Cross(z,a),z.normalize(),v.normalize(),A=0;A<Q;A++){const s=A%Q/Q*2*Math.PI,t=-G*Math.cos(s),j=G*Math.sin(s);o.push(Z.x+t*v.x+j*z.x),o.push(Z.y+t*v.y+j*z.y),o.push(Z.z+t*v.z+j*z.z),S.push(f/B),S.push(O.b?1-A/Q:A/Q)}}for(f=0;f<B;f++)for(A=0;A<Q;A++){const s=(A+1)%Q,o=f*Q+A,t=(f+1)*Q+A,j=(f+1)*Q+s,S=f*Q+s;Z.push(S),Z.push(t),Z.push(o),Z.push(S),Z.push(j),Z.push(t)}a.d.ComputeNormals(o,Z,j),a.d._ComputeSides(Y,o,Z,j,S,s.frontUVs,s.backUVs);const d=new a.d;return d.indices=Z,d.gs=o,d.ls=j,d.es=S,d}function L(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return N(Z).ws(t,Z.updatable),t}a.d.CreateTorus=F,j.d.CreateTorus=(s,Z,o,t,j,S,a)=>i(s,{diameter:Z,thickness:o,tessellation:t,sideOrientation:a,updatable:S},j);a.d.CreateTorusKnot=N,j.d.CreateTorusKnot=(s,Z,o,t,j,S,a,O,v,G)=>L(s,{radius:Z,tube:o,radialSegments:t,tubularSegments:j,p:S,q:a,sideOrientation:G,updatable:v},O);var V=o(12955),g=o(11653),l=o(11383);function R(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=Z.path,S=Z.shape,a=Z.scale||1,O=Z.rotation||0,v=0===Z.cap?0:Z.cap||j.d.NO_CAP,G=Z.updatable,B=j.d._GetDefaultSideOrientation(Z.sideOrientation),Q=Z.instance||null,D=Z.invertUV||!1,z=Z.closeShape||!1,Y=Z.closePath||!1,b=Z.capFunction||null;return c(s,S,t,a,O,null,null,Y,z,v,!1,o,!!G,B,Q,D,Z.frontUVs||null,Z.backUVs||null,Z.firstNormal||null,!!Z.adjustFrame,b)}function e(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=Z.path,S=Z.shape,a=Z.scaleFunction||(()=>1),O=Z.rotationFunction||(()=>0),v=Z.closePath||Z.ribbonCloseArray||!1,G=Z.closeShape||Z.ribbonClosePath||!1,B=0===Z.cap?0:Z.cap||j.d.NO_CAP,Q=Z.updatable,D=Z.firstNormal||null,z=Z.adjustFrame||!1,Y=j.d._GetDefaultSideOrientation(Z.sideOrientation),b=Z.instance,f=Z.invertUV||!1,A=Z.capFunction||null;return c(s,S,t,null,null,a,O,v,G,B,!0,o,!!Q,Y,b||null,f,Z.frontUVs||null,Z.backUVs||null,D,z,A||null)}function c(s,Z,o,S,a,O,v,B,Q,D,z,Y,b,f,A,d,U,u,H,F,i){const N=(s,Z,o,S,a,O,v,G,B,Q,D)=>{const z=o.getTangents(),Y=o.getNormals(),b=o.getBinormals(),f=o.getDistances();if(D)for(let j=0;j<z.length;j++)if(0==z[j].x&&0==z[j].y&&0==z[j].z&&z[j].O(z[j-1]),0==Y[j].x&&0==Y[j].y&&0==Y[j].z&&Y[j].O(Y[j-1]),0==b[j].x&&0==b[j].y&&0==b[j].z&&b[j].O(b[j-1]),j>0){let s=z[j-1];t.n.Dot(s,z[j])<0&&z[j].scaleInPlace(-1),s=Y[j-1],t.n.Dot(s,Y[j])<0&&Y[j].scaleInPlace(-1),s=b[j-1],t.n.Dot(s,b[j])<0&&b[j].scaleInPlace(-1)}let A=0;const d=Q&&G?G:()=>null!==O?O:0,U=Q&&v?v:()=>null!==a?a:1;let u=B===j.d.NO_CAP||B===j.d.CAP_END?0:2;const H=t.g.Matrix[0];for(let j=0;j<Z.length;j++){const o=[],a=d(j,f[j]),O=U(j,f[j]);t.b.RotationAxisToRef(z[j],A,H);for(let S=0;S<s.length;S++){const a=z[j].scale(s[S].z).add(Y[j].scale(s[S].x)).add(b[j].scale(s[S].y)),v=t.n.Zero();t.n.TransformCoordinatesToRef(a,H,v),v.scaleInPlace(O).addInPlace(Z[j]),o[S]=v}S[u]=o,A+=a,u++}const F=i||(s=>{const Z=Array(),o=t.n.Zero();let j;for(j=0;j<s.length;j++)o.addInPlace(s[j]);for(o.scaleInPlace(1/s.length),j=0;j<s.length;j++)Z.push(o);return Z});switch(B){case j.d.NO_CAP:break;case j.d.CAP_START:S[0]=F(S[2]),S[1]=S[2];break;case j.d.CAP_END:S[u]=S[u-1],S[u+1]=F(S[u-1]);break;case j.d.CAP_ALL:S[0]=F(S[2]),S[1]=S[2],S[u]=S[u-1],S[u+1]=F(S[u-1])}return S};let L,V;if(A){const s=A._creationDataStorage;return L=H?s.path3D.update(o,H):s.path3D.update(o),V=N(Z,o,s.path3D,s.pathArray,S,a,O,v,s.cap,z,F),A=G("",{pathArray:V,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:A},Y||void 0)}L=H?new l.j(o,H):new l.j(o);V=N(Z,o,L,new Array,S,a,O,v,D=D<0||D>3?0:D,z,F);const g=G(s,{pathArray:V,closeArray:B,closePath:Q,updatable:b,sideOrientation:f,invertUV:d,frontUVs:U||void 0,backUVs:u||void 0},Y);return g._creationDataStorage.pathArray=V,g._creationDataStorage.path3D=L,g._creationDataStorage.cap=D,g}function w(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Z.arc?Z.arc<=0||Z.arc>1?1:Z.arc:1,a=void 0===Z.closed||Z.closed,O=Z.shape,v=Z.radius||1,B=Z.tessellation||64,Q=Z.clip||0,D=Z.updatable,z=j.d._GetDefaultSideOrientation(Z.sideOrientation),Y=Z.cap||j.d.NO_CAP,b=2*Math.PI,f=[],A=Z.invertUV||!1;let d=0,U=0;const u=b/B*S;let H,F;for(d=0;d<=B-Q;d++){for(F=[],Y!=j.d.CAP_START&&Y!=j.d.CAP_ALL||(F.push(new t.n(0,O[0].y,0)),F.push(new t.n(Math.cos(d*u)*O[0].x*v,O[0].y,Math.sin(d*u)*O[0].x*v))),U=0;U<O.length;U++)H=new t.n(Math.cos(d*u)*O[U].x*v,O[U].y,Math.sin(d*u)*O[U].x*v),F.push(H);Y!=j.d.CAP_END&&Y!=j.d.CAP_ALL||(F.push(new t.n(Math.cos(d*u)*O[O.length-1].x*v,O[O.length-1].y,Math.sin(d*u)*O[O.length-1].x*v)),F.push(new t.n(0,O[O.length-1].y,0))),f.push(F)}return G(s,{pathArray:f,closeArray:a,sideOrientation:z,updatable:D,invertUV:A,frontUVs:Z.frontUVs,backUVs:Z.backUVs},o)}j.d.ExtrudeShape=function(s,Z,o,t,S,a){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7?arguments[7]:void 0,G=arguments.length>8?arguments[8]:void 0,B=arguments.length>9?arguments[9]:void 0;return R(s,{shape:Z,path:o,scale:t,rotation:S,cap:0===a?0:a||j.d.NO_CAP,sideOrientation:G,instance:B,updatable:v},O)},j.d.ExtrudeShapeCustom=(s,Z,o,t,S,a,O,v,G,B,Q,D)=>e(s,{shape:Z,path:o,scaleFunction:t,rotationFunction:S,ribbonCloseArray:a,ribbonClosePath:O,cap:0===v?0:v||j.d.NO_CAP,sideOrientation:Q,instance:D,updatable:B},G);j.d.CreateLathe=(s,Z,o,t,j,S,a)=>w(s,{shape:Z,radius:o,tessellation:t,sideOrientation:a,updatable:S},j);var X=o(12346),W=o(12302);function q(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Z.path;let a=Z.instance,O=1;void 0!==Z.radius?O=Z.radius:a&&(O=a._creationDataStorage.radius);const v=Z.tessellation||64,B=Z.radiusFunction||null;let Q=Z.cap||j.d.NO_CAP;const D=Z.invertUV||!1,z=Z.updatable,Y=j.d._GetDefaultSideOrientation(Z.sideOrientation);Z.arc=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1;const b=(s,Z,o,S,a,O,v,G)=>{const B=Z.getTangents(),Q=Z.getNormals(),D=Z.getDistances(),z=2*Math.PI/a*G,Y=O||(()=>S);let b,f,A,d;const U=t.g.Matrix[0];let u=v===j.d.NO_CAP||v===j.d.CAP_END?0:2;for(let j=0;j<s.length;j++){f=Y(j,D[j]),b=Array(),A=Q[j];for(let Z=0;Z<a;Z++)t.b.RotationAxisToRef(B[j],z*Z,U),d=b[Z]?b[Z]:t.n.Zero(),t.n.TransformCoordinatesToRef(A,U,d),d.scaleInPlace(f).addInPlace(s[j]),b[Z]=d;o[u]=b,u++}const H=(Z,o)=>{const t=Array();for(let j=0;j<Z;j++)t.push(s[o]);return t};switch(v){case j.d.NO_CAP:break;case j.d.CAP_START:o[0]=H(a,0),o[1]=o[2].slice(0);break;case j.d.CAP_END:o[u]=o[u-1].slice(0),o[u+1]=H(a,s.length-1);break;case j.d.CAP_ALL:o[0]=H(a,0),o[1]=o[2].slice(0),o[u]=o[u-1].slice(0),o[u+1]=H(a,s.length-1)}return o};let f,A;if(a){const s=a._creationDataStorage,o=Z.arc||s.arc;return f=s.path3D.update(S),A=b(S,f,s.pathArray,O,s.tessellation,B,s.cap,o),a=G("",{pathArray:A,instance:a}),s.path3D=f,s.pathArray=A,s.arc=o,s.radius=O,a}f=new l.j(S);Q=Q<0||Q>3?0:Q,A=b(S,f,new Array,O,v,B,Q,Z.arc);const d=G(s,{pathArray:A,closePath:!0,closeArray:!1,updatable:z,sideOrientation:Y,invertUV:D,frontUVs:Z.frontUVs,backUVs:Z.backUVs},o);return d._creationDataStorage.pathArray=A,d._creationDataStorage.path3D=f,d._creationDataStorage.tessellation=v,d._creationDataStorage.cap=Q,d._creationDataStorage.arc=Z.arc,d._creationDataStorage.radius=O,d}function h(s){const Z=[];Z[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},Z[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},Z[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},Z[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},Z[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},Z[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},Z[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},Z[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},Z[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},Z[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},Z[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},Z[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},Z[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},Z[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},Z[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const o=s.type&&(s.type<0||s.type>=Z.length)?0:s.type||0,j=s.size,S=s.sizeX||j||1,v=s.sizeY||j||1,G=s.sizeZ||j||1,B=s.custom||Z[o],Q=B.face.length,z=s.faceUV||new Array(Q),Y=s.faceColors,b=void 0===s.flat||s.flat,f=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,A=[],d=[],U=[],u=[],H=[];let F=0,i=0;const N=[];let L,V,g,l,R,e,c=0,w=0;if(b)for(w=0;w<Q;w++)Y&&void 0===Y[w]&&(Y[w]=new D.h(1,1,1,1)),z&&void 0===z[w]&&(z[w]=new t.p(0,0,1,1));if(b)for(w=0;w<Q;w++){const s=B.face[w].length;for(g=2*Math.PI/s,l=.5*Math.tan(g/2),R=.5,c=0;c<s;c++)A.push(B.vertex[B.face[w][c]][0]*S,B.vertex[B.face[w][c]][1]*v,B.vertex[B.face[w][c]][2]*G),N.push(F),F++,L=z[w].x+(z[w].z-z[w].x)*(.5+l),V=z[w].y+(z[w].w-z[w].y)*(R-.5),u.push(L,O.b?1-V:V),e=l*Math.cos(g)-R*Math.sin(g),R=l*Math.sin(g)+R*Math.cos(g),l=e,Y&&H.push(Y[w].r,Y[w].g,Y[w].b,Y[w].a);for(c=0;c<s-2;c++)d.push(N[0+i],N[c+2+i],N[c+1+i]);i+=s}else{for(c=0;c<B.vertex.length;c++)A.push(B.vertex[c][0]*S,B.vertex[c][1]*v,B.vertex[c][2]*G),u.push(0,O.b?1:0);for(w=0;w<Q;w++)for(c=0;c<B.face[w].length-2;c++)d.push(B.face[w][0],B.face[w][c+2],B.face[w][c+1])}a.d.ComputeNormals(A,d,U),a.d._ComputeSides(f,A,d,U,u,s.frontUVs,s.backUVs);const X=new a.d;return X.gs=A,X.indices=d,X.ls=U,X.es=u,Y&&b&&(X.Rs=H),X}function M(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return h(Z).ws(t,Z.updatable),t}j.d.CreateTube=(s,Z,o,t,j,S,a,O,v,G)=>q(s,{path:Z,radius:o,tessellation:t,radiusFunction:j,arc:1,cap:S,updatable:O,sideOrientation:v,instance:G},a);function x(s){const Z=s.sideOrientation||a.d.DEFAULTSIDE,o=s.radius||1,j=void 0===s.flat||s.flat,S=0|(s.subdivisions||4),v=s.radiusX||o,G=s.radiusY||o,B=s.radiusZ||o,Q=(1+Math.sqrt(5))/2,D=[-1,Q,-0,1,Q,0,-1,-Q,0,1,-Q,0,0,-1,-Q,0,1,-Q,0,-1,Q,0,1,Q,Q,0,1,Q,0,-1,-Q,0,1,-Q,0,-1],z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Y=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],b=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],f=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],A=[],d=[],U=[],u=[];let H=0;const F=new Array(3),i=new Array(3);let N;for(N=0;N<3;N++)F[N]=t.n.Zero(),i[N]=t.j.Zero();for(let a=0;a<20;a++){for(N=0;N<3;N++){const s=z[3*a+N];F[N].Ja(D[3*Y[s]],D[3*Y[s]+1],D[3*Y[s]+2]),F[N].normalize(),i[N].Ja(.134765625*b[2*s]+.05859375+-.0390625*f[a],.2333984375*b[2*s+1]+.025390625+.01953125*f[a])}const s=(s,Z,o,a)=>{const Q=t.n.Lerp(F[0],F[2],Z/S),D=t.n.Lerp(F[1],F[2],Z/S),z=S===Z?F[2]:t.n.Lerp(Q,D,s/(S-Z));let Y;if(z.normalize(),j){const s=t.n.Lerp(F[0],F[2],a/S),Z=t.n.Lerp(F[1],F[2],a/S);Y=t.n.Lerp(s,Z,o/(S-a))}else Y=new t.n(z.x,z.y,z.z);Y.x/=v,Y.y/=G,Y.z/=B,Y.normalize();const b=t.j.Lerp(i[0],i[2],Z/S),f=t.j.Lerp(i[1],i[2],Z/S),N=S===Z?i[2]:t.j.Lerp(b,f,s/(S-Z));d.push(z.x*v,z.y*G,z.z*B),U.push(Y.x,Y.y,Y.z),u.push(N.x,O.b?1-N.y:N.y),A.push(H),H++};for(let Z=0;Z<S;Z++)for(let o=0;o+Z<S;o++)s(o,Z,o+1/3,Z+1/3),s(o+1,Z,o+1/3,Z+1/3),s(o,Z+1,o+1/3,Z+1/3),o+Z+1<S&&(s(o+1,Z,o+2/3,Z+2/3),s(o+1,Z+1,o+2/3,Z+2/3),s(o,Z+1,o+2/3,Z+2/3))}a.d._ComputeSides(Z,d,A,U,u,s.frontUVs,s.backUVs);const L=new a.d;return L.indices=A,L.gs=d,L.ls=U,L.es=u,L}function k(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new j.d(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),t._originalBuilderSideOrientation=Z.sideOrientation;return x(Z).ws(t,Z.updatable),t}a.d.CreatePolyhedron=h,j.d.CreatePolyhedron=(s,Z,o)=>M(s,Z,o);a.d.CreateIcoSphere=x,j.d.CreateIcoSphere=(s,Z,o)=>k(s,Z,o);var y=o(10935);const I=new t.n(1,0,0),C=new t.n(-1,0,0),K=new t.n(0,1,0),p=new t.n(0,-1,0),E=new t.n(0,0,1),P=new t.n(0,0,-1);class r{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.n.Zero(),Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.n.Up(),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.j.Zero(),j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=s,this.gt=Z,this.uv=o,this.vertexIdx=j,this.vertexIdxForBones=S,this.localPositionOverride=a,this.localNormalOverride=O,this.matrixIndicesOverride=v,this.matrixWeightsOverride=G}clone(){var s,Z,o,t;return new r(this.position.clone(),this.gt.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(s=this.localPositionOverride)||void 0===s?void 0:s.slice(),null===(Z=this.localNormalOverride)||void 0===Z?void 0:Z.slice(),null===(o=this.matrixIndicesOverride)||void 0===o?void 0:o.slice(),null===(t=this.matrixWeightsOverride)||void 0===t?void 0:t.slice())}}function T(s,Z,o){var v,G,B,Q,D;const z=!!Z.skeleton,Y=!(null===(v=Z.morphTargetManager)||void 0===v||!v.numTargets),b=o.localMode||z,f=Z.ra(),A=z||Y?Z.LO(!0,!0):Z.getVerticesData(S.e.PositionKind),d=z||Y?Z.getNormalsData(!0,!0):Z.getVerticesData(S.e.NormalKind),U=b?z?Z.getVerticesData(S.e.PositionKind):A:null,u=b?z?Z.getVerticesData(S.e.NormalKind):d:null,H=Z.getVerticesData(S.e.UVKind),F=z?Z.getVerticesData(S.e.MatricesIndicesKind):null,i=z?Z.getVerticesData(S.e.MatricesWeightsKind):null,N=z?Z.getVerticesData(S.e.MatricesIndicesExtraKind):null,L=z?Z.getVerticesData(S.e.MatricesWeightsExtraKind):null,V=o.position||t.n.Zero();let g=o.gt||t.n.Up();const l=o.size||t.n.One(),R=o.angle||0;if(!g){const s=new t.n(0,0,1),o=Z.Ls().activeCamera,j=t.n.TransformCoordinates(s,o.getWorldMatrix());g=o.globalPosition.Go(j)}const e=-Math.atan2(g.z,g.x)-Math.PI/2,c=Math.sqrt(g.x*g.x+g.z*g.z),w=Math.atan2(g.y,c),X=new a.d;X.indices=[],X.gs=[],X.ls=[],X.es=[],X.matricesIndices=z?[]:null,X.matricesWeights=z?[]:null,X.matricesIndicesExtra=N?[]:null,X.matricesWeightsExtra=L?[]:null;let W=0;const q=(s,Z)=>{const j=new r;if(!f||!A||!d)return j;const S=f[s];if(j.vertexIdx=3*S,j.vertexIdxForBones=4*S,j.position=new t.n(A[3*S],A[3*S+1],A[3*S+2]),t.n.TransformCoordinatesToRef(j.position,Z,j.position),j.gt=new t.n(d[3*S],d[3*S+1],d[3*S+2]),t.n.TransformNormalToRef(j.gt,Z,j.gt),o.captureUVS&&H){const s=H[2*S+1];j.uv=new t.j(H[2*S],O.b?1-s:s)}return j},h=[0,0,0,0],M=(s,Z)=>{if(0===s.length)return s;const o=.5*Math.abs(t.n.Dot(l,Z)),j=(s,Z,o,t)=>{for(let j=0;j<t;++j)if(s[o+j]===Z)return o+j;return-1},S=(s,S)=>{const a=t.n.GetClipFactor(s.position,S.position,Z,o);let O=h,v=h;if(F&&i){const Z=s.matrixIndicesOverride?0:s.vertexIdxForBones,o=s.matrixIndicesOverride??F,t=s.matrixWeightsOverride??i,G=S.matrixIndicesOverride?0:S.vertexIdxForBones,B=S.matrixIndicesOverride??F,Q=S.matrixWeightsOverride??i;O=[0,0,0,0],v=[0,0,0,0];let D=0;for(let s=0;s<4;++s)if(t[Z+s]>0){const S=j(B,o[Z+s],G,4);O[D]=o[Z+s],v[D]=(0,y.Lerp)(t[Z+s],S>=0?Q[S]:0,a),D++}for(let s=0;s<4&&D<4;++s){const t=B[G+s];-1===j(o,t,Z,4)&&(O[D]=t,v[D]=(0,y.Lerp)(0,Q[G+s],a),D++)}const z=v[0]+v[1]+v[2]+v[3];v[0]/=z,v[1]/=z,v[2]/=z,v[3]/=z}const G=s.localPositionOverride?s.localPositionOverride[0]:(null===U||void 0===U?void 0:U[s.vertexIdx])??0,B=s.localPositionOverride?s.localPositionOverride[1]:(null===U||void 0===U?void 0:U[s.vertexIdx+1])??0,Q=s.localPositionOverride?s.localPositionOverride[2]:(null===U||void 0===U?void 0:U[s.vertexIdx+2])??0,D=S.localPositionOverride?S.localPositionOverride[0]:(null===U||void 0===U?void 0:U[S.vertexIdx])??0,z=S.localPositionOverride?S.localPositionOverride[1]:(null===U||void 0===U?void 0:U[S.vertexIdx+1])??0,Y=S.localPositionOverride?S.localPositionOverride[2]:(null===U||void 0===U?void 0:U[S.vertexIdx+2])??0,b=s.localNormalOverride?s.localNormalOverride[0]:(null===u||void 0===u?void 0:u[s.vertexIdx])??0,f=s.localNormalOverride?s.localNormalOverride[1]:(null===u||void 0===u?void 0:u[s.vertexIdx+1])??0,A=s.localNormalOverride?s.localNormalOverride[2]:(null===u||void 0===u?void 0:u[s.vertexIdx+2])??0,d=b+((S.localNormalOverride?S.localNormalOverride[0]:(null===u||void 0===u?void 0:u[S.vertexIdx])??0)-b)*a,H=f+((S.localNormalOverride?S.localNormalOverride[1]:(null===u||void 0===u?void 0:u[S.vertexIdx+1])??0)-f)*a,N=A+((S.localNormalOverride?S.localNormalOverride[2]:(null===u||void 0===u?void 0:u[S.vertexIdx+2])??0)-A)*a,L=Math.sqrt(d*d+H*H+N*N);return new r(t.n.Lerp(s.position,S.position,a),t.n.Lerp(s.gt,S.gt,a).normalize(),t.j.Lerp(s.uv,S.uv,a),-1,-1,U?[G+(D-G)*a,B+(z-B)*a,Q+(Y-Q)*a]:null,u?[d/L,H/L,N/L]:null,O,v)};let a=null;s.length>3&&(a=[]);for(let O=0;O<s.length;O+=3){let j=0,v=null,G=null,B=null,Q=null;const D=t.n.Dot(s[O].position,Z)-o>0,z=t.n.Dot(s[O+1].position,Z)-o>0,Y=t.n.Dot(s[O+2].position,Z)-o>0;switch(j=(D?1:0)+(z?1:0)+(Y?1:0),j){case 0:s.length>3?(a.push(s[O]),a.push(s[O+1]),a.push(s[O+2])):a=s;break;case 1:if(a=a??new Array,D&&(v=s[O+1],G=s[O+2],B=S(s[O],v),Q=S(s[O],G)),z){v=s[O],G=s[O+2],B=S(s[O+1],v),Q=S(s[O+1],G),a.push(B),a.push(G.clone()),a.push(v.clone()),a.push(G.clone()),a.push(B.clone()),a.push(Q);break}Y&&(v=s[O],G=s[O+1],B=S(s[O+2],v),Q=S(s[O+2],G)),v&&G&&B&&Q&&(a.push(v.clone()),a.push(G.clone()),a.push(B),a.push(Q),a.push(B.clone()),a.push(G.clone()));break;case 2:a=a??new Array,D||(v=s[O].clone(),G=S(v,s[O+1]),B=S(v,s[O+2]),a.push(v),a.push(G),a.push(B)),z||(v=s[O+1].clone(),G=S(v,s[O+2]),B=S(v,s[O]),a.push(v),a.push(G),a.push(B)),Y||(v=s[O+2].clone(),G=S(v,s[O]),B=S(v,s[O+1]),a.push(v),a.push(G),a.push(B))}}return a},x=Z instanceof j.d?Z:null,k=null===x||void 0===x?void 0:x._thinInstanceDataStorage.matrixData,T=(null===x||void 0===x?void 0:x.BO)||1,m=t.g.Matrix[0];m.O(t.b.IdentityReadOnly);for(let j=0;j<T;++j){if(null!==x&&void 0!==x&&x.hasThinInstances&&k){const s=16*j;m.setRowFromFloats(0,k[s+0],k[s+1],k[s+2],k[s+3]),m.setRowFromFloats(1,k[s+4],k[s+5],k[s+6],k[s+7]),m.setRowFromFloats(2,k[s+8],k[s+9],k[s+10],k[s+11]),m.setRowFromFloats(3,k[s+12],k[s+13],k[s+14],k[s+15])}const s=t.b.RotationYawPitchRoll(e,w,R).multiply(t.b.Translation(V.x,V.y,V.z)),S=t.b.Invert(s),a=Z.getWorldMatrix(),v=m.multiply(a).multiply(S),G=new Array(3);for(let Z=0;Z<f.length;Z+=3){let s=G;if(s[0]=q(Z,v),s[1]=q(Z+1,v),s[2]=q(Z+2,v),!(o.cullBackFaces&&-s[0].gt.z<=0&&-s[1].gt.z<=0&&-s[2].gt.z<=0)&&(s=M(s,I),s&&(s=M(s,C),s&&(s=M(s,K),s&&(s=M(s,p),s&&(s=M(s,E),s&&(s=M(s,P),s)))))))for(let Z=0;Z<s.length;Z++){const t=s[Z];if(X.indices.push(W),b?(t.localPositionOverride?(X.gs[3*W]=t.localPositionOverride[0],X.gs[3*W+1]=t.localPositionOverride[1],X.gs[3*W+2]=t.localPositionOverride[2]):U&&(X.gs[3*W]=U[t.vertexIdx],X.gs[3*W+1]=U[t.vertexIdx+1],X.gs[3*W+2]=U[t.vertexIdx+2]),t.localNormalOverride?(X.ls[3*W]=t.localNormalOverride[0],X.ls[3*W+1]=t.localNormalOverride[1],X.ls[3*W+2]=t.localNormalOverride[2]):u&&(X.ls[3*W]=u[t.vertexIdx],X.ls[3*W+1]=u[t.vertexIdx+1],X.ls[3*W+2]=u[t.vertexIdx+2])):(t.position.toArray(X.gs,3*W),t.gt.toArray(X.ls,3*W)),X.matricesIndices&&X.matricesWeights&&(t.matrixIndicesOverride?(X.matricesIndices[4*W]=t.matrixIndicesOverride[0],X.matricesIndices[4*W+1]=t.matrixIndicesOverride[1],X.matricesIndices[4*W+2]=t.matrixIndicesOverride[2],X.matricesIndices[4*W+3]=t.matrixIndicesOverride[3]):(F&&(X.matricesIndices[4*W]=F[t.vertexIdxForBones],X.matricesIndices[4*W+1]=F[t.vertexIdxForBones+1],X.matricesIndices[4*W+2]=F[t.vertexIdxForBones+2],X.matricesIndices[4*W+3]=F[t.vertexIdxForBones+3]),N&&X.matricesIndicesExtra&&(X.matricesIndicesExtra[4*W]=N[t.vertexIdxForBones],X.matricesIndicesExtra[4*W+1]=N[t.vertexIdxForBones+1],X.matricesIndicesExtra[4*W+2]=N[t.vertexIdxForBones+2],X.matricesIndicesExtra[4*W+3]=N[t.vertexIdxForBones+3])),t.matrixWeightsOverride?(X.matricesWeights[4*W]=t.matrixWeightsOverride[0],X.matricesWeights[4*W+1]=t.matrixWeightsOverride[1],X.matricesWeights[4*W+2]=t.matrixWeightsOverride[2],X.matricesWeights[4*W+3]=t.matrixWeightsOverride[3]):(i&&(X.matricesWeights[4*W]=i[t.vertexIdxForBones],X.matricesWeights[4*W+1]=i[t.vertexIdxForBones+1],X.matricesWeights[4*W+2]=i[t.vertexIdxForBones+2],X.matricesWeights[4*W+3]=i[t.vertexIdxForBones+3]),L&&X.matricesWeightsExtra&&(X.matricesWeightsExtra[4*W]=L[t.vertexIdxForBones],X.matricesWeightsExtra[4*W+1]=L[t.vertexIdxForBones+1],X.matricesWeightsExtra[4*W+2]=L[t.vertexIdxForBones+2],X.matricesWeightsExtra[4*W+3]=L[t.vertexIdxForBones+3]))),o.captureUVS)t.uv.toArray(X.es,2*W);else{X.es.push(.5+t.position.x/l.x);const s=.5+t.position.y/l.y;X.es.push(O.b?1-s:s)}W++}}}0===X.indices.length&&(X.indices=null),0===X.gs.length&&(X.gs=null),0===X.ls.length&&(X.ls=null),0===X.es.length&&(X.es=null),0===(null===(G=X.matricesIndices)||void 0===G?void 0:G.length)&&(X.matricesIndices=null),0===(null===(B=X.matricesWeights)||void 0===B?void 0:B.length)&&(X.matricesWeights=null),0===(null===(Q=X.matricesIndicesExtra)||void 0===Q?void 0:Q.length)&&(X.matricesIndicesExtra=null),0===(null===(D=X.matricesWeightsExtra)||void 0===D?void 0:D.length)&&(X.matricesWeightsExtra=null);const n=new j.d(s,Z.Ls());return X.ws(n),b?(n.skeleton=Z.skeleton,n.parent=Z):(n.position=V.clone(),n.rotation=new t.n(w,e,R)),n.Ea(!0),n.refreshBoundingInfo(!0,!0),n}function m(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const Z=0|Math.max(s.subdivisions?s.subdivisions:2,1),o=0|Math.max(s.tessellation?s.tessellation:16,3),j=Math.max(s.height?s.height:1,0),S=Math.max(s.radius?s.radius:.25,0),v=0|Math.max(s.capSubdivisions?s.capSubdivisions:6,1),G=o,B=Z,Q=Math.max(s.radiusTop?s.radiusTop:S,0),D=Math.max(s.radiusBottom?s.radiusBottom:S,0),z=j-(Q+D),Y=2*Math.PI,b=Math.max(s.topCapSubdivisions?s.topCapSubdivisions:v,1),f=Math.max(s.bottomCapSubdivisions?s.bottomCapSubdivisions:v,1),A=Math.acos((D-Q)/j);let d=[];const U=[],u=[],H=[];let F=0;const i=[],N=.5*z,L=.5*Math.PI;let V,g;const l=t.n.Zero(),R=t.n.Zero(),e=Math.cos(A),c=Math.sin(A),w=new t.j(Q*c,N+Q*e).Go(new t.j(D*c,D*e-N)).length(),X=Q*A+w+D*(L-A);let W=0;for(g=0;g<=b;g++){const s=[],Z=L-A*(g/b);W+=Q*A/b;const o=Math.cos(Z),t=Math.sin(Z),j=o*Q;for(V=0;V<=G;V++){const Z=V/G,S=Z*Y+0,a=Math.sin(S),v=Math.cos(S);R.x=j*a,R.y=N+t*Q,R.z=j*v,U.push(R.x,R.y,R.z),l.set(o*a,t,o*v),u.push(l.x,l.y,l.z),H.push(Z,O.b?W/X:1-W/X),s.push(F),F++}i.push(s)}const q=j-Q-D+e*Q-e*D,h=c*(D-Q)/q;for(g=1;g<=B;g++){const s=[];W+=w/B;const Z=c*(g*(D-Q)/B+Q);for(V=0;V<=G;V++){const o=V/G,t=o*Y+0,j=Math.sin(t),S=Math.cos(t);R.x=Z*j,R.y=N+e*Q-g*q/B,R.z=Z*S,U.push(R.x,R.y,R.z),l.set(j,h,S).normalize(),u.push(l.x,l.y,l.z),H.push(o,O.b?W/X:1-W/X),s.push(F),F++}i.push(s)}for(g=1;g<=f;g++){const s=[],Z=L-A-(Math.PI-A)*(g/f);W+=D*A/f;const o=Math.cos(Z),t=Math.sin(Z),j=o*D;for(V=0;V<=G;V++){const Z=V/G,S=Z*Y+0,a=Math.sin(S),v=Math.cos(S);R.x=j*a,R.y=t*D-N,R.z=j*v,U.push(R.x,R.y,R.z),l.set(o*a,t,o*v),u.push(l.x,l.y,l.z),H.push(Z,O.b?W/X:1-W/X),s.push(F),F++}i.push(s)}for(V=0;V<G;V++)for(g=0;g<b+B+f;g++){const s=i[g][V],Z=i[g+1][V],o=i[g+1][V+1],t=i[g][V+1];d.push(s),d.push(Z),d.push(t),d.push(Z),d.push(o),d.push(t)}if(d=d.reverse(),s.orientation&&!s.orientation.equals(t.n.Up())){const Z=new t.b;s.orientation.clone().scale(.5*Math.PI).cross(t.n.Up()).toQuaternion().toRotationMatrix(Z);const o=t.n.Zero();for(let s=0;s<U.length;s+=3)o.set(U[s],U[s+1],U[s+2]),t.n.TransformCoordinatesToRef(o.clone(),Z,o),U[s]=o.x,U[s+1]=o.y,U[s+2]=o.z}const M=new a.d;return M.gs=U,M.ls=u,M.es=H,M.indices=d,M}function n(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:t.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new j.d(s,o);return m(Z).ws(S,Z.updatable),S}j.d.CreateDecal=(s,Z,o,t,j,S)=>T(s,Z,{position:o,gt:t,size:j,angle:S});j.d.CreateCapsule=(s,Z,o)=>n(s,Z,o),a.d.CreateCapsule=m;var J=o(10955),ss=o(10904);class Zs{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=s,this.y=Z,s!==Math.floor(s)&&(s=Math.floor(s),J.b.Warn("x is not an integer, floor(x) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),J.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Zs(this.x,this.y)}rotate60About(s){const Z=this.x;return this.x=s.x+s.y-this.y,this.y=Z+this.y-s.x,this}rotateNeg60About(s){const Z=this.x;return this.x=Z+this.y-s.y,this.y=s.x+s.y-Z,this}rotate120(s,Z){s!==Math.floor(s)&&(s=Math.floor(s),J.b.Warn("m not an integer only floor(m) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),J.b.Warn("n not an integer only floor(n) used"));const o=this.x;return this.x=s-o-this.y,this.y=Z+o,this}rotateNeg120(s,Z){s!==Math.floor(s)&&(s=Math.floor(s),J.b.Warn("m is not an integer, floor(m) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),J.b.Warn("n is not an integer,   floor(n) used"));const o=this.x;return this.x=this.y-Z,this.y=s+Z-o-this.y,this}toCartesianOrigin(s,Z){const o=t.n.Zero();return o.x=s.x+2*this.x*Z+this.y*Z,o.y=s.y+Math.sqrt(3)*this.y*Z,o}static Zero(){return new Zs(0,0)}}class os{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ts("icosahedron","Regular",[[0,ss.e,-1],[-ss.e,1,0],[-1,0,-ss.e],[1,0,-ss.e],[ss.e,1,0],[0,ss.e,1],[-1,0,ss.e],[-ss.e,-1,0],[0,-ss.e,-1],[ss.e,-1,0],[1,0,ss.e],[0,-ss.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let s=12;const Z={},o=this.m,t=this.n;let j,S,a,O,v,G=o,B=1,Q=0;0!==t&&(G=(0,y.HighestCommonFactor)(o,t)),B=o/G,Q=t/G;const D=Zs.Zero(),z=new Zs(o,t),Y=new Zs(-t,o+t),b=Zs.Zero(),f=Zs.Zero(),A=Zs.Zero();let d,U,u,H,F=[];const i=[],N=this.vertByDist,L=(o,t,j,S)=>{d=o+"|"+j,U=t+"|"+S,d in Z||U in Z?d in Z&&!(U in Z)?Z[U]=Z[d]:U in Z&&!(d in Z)&&(Z[d]=Z[U]):(Z[d]=s,Z[U]=s,s++),N[j][0]>2?i[Z[d]]=[-N[j][0],N[j][1],Z[d]]:i[Z[d]]=[F[N[j][0]],N[j][1],Z[d]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let V=0;V<20;V++){if(F=this.IDATA.face[V],a=F[2],O=F[1],v=F[0],u=D.x+"|"+D.y,d=V+"|"+u,d in Z||(Z[d]=a,i[a]=[F[N[u][0]],N[u][1]]),u=z.x+"|"+z.y,d=V+"|"+u,d in Z||(Z[d]=O,i[O]=[F[N[u][0]],N[u][1]]),u=Y.x+"|"+Y.y,d=V+"|"+u,d in Z||(Z[d]=v,i[v]=[F[N[u][0]],N[u][1]]),j=this.IDATA.edgematch[V][0],S=this.IDATA.edgematch[V][1],"B"===S)for(let s=1;s<G;s++)f.x=o-s*(B+Q),f.y=t+s*B,A.x=-s*Q,A.y=s*(B+Q),u=f.x+"|"+f.y,H=A.x+"|"+A.y,L(V,j,u,H);if("O"===S)for(let s=1;s<G;s++)A.x=-s*Q,A.y=s*(B+Q),b.x=s*B,b.y=s*Q,u=A.x+"|"+A.y,H=b.x+"|"+b.y,L(V,j,u,H);if(j=this.IDATA.edgematch[V][2],S=this.IDATA.edgematch[V][3],S&&"A"===S)for(let s=1;s<G;s++)b.x=s*B,b.y=s*Q,f.x=o-(G-s)*(B+Q),f.y=t+(G-s)*B,u=b.x+"|"+b.y,H=f.x+"|"+f.y,L(V,j,u,H);for(let o=0;o<this.vertices.length;o++)u=this.vertices[o].x+"|"+this.vertices[o].y,d=V+"|"+u,d in Z||(Z[d]=s++,N[u][0]>2?i[Z[d]]=[-N[u][0],N[u][1],Z[d]]:i[Z[d]]=[F[N[u][0]],N[u][1],Z[d]])}this.closestTo=i,this.vecToidx=Z}calcCoeffs(){const s=this.m,Z=this.n,o=Math.sqrt(3)/3,t=s*s+Z*Z+s*Z;this.coau=(s+Z)/t,this.cobu=-Z/t,this.coav=-o*(s-Z)/t,this.cobv=o*(2*s+Z)/t}createInnerFacets(){const s=this.m,Z=this.n;for(let o=0;o<Z+s+1;o++)for(let s=this.min[o];s<this.max[o]+1;s++)s<this.max[o]&&s<this.max[o+1]+1&&this.innerFacets.push(["|"+s+"|"+o,"|"+s+"|"+(o+1),"|"+(s+1)+"|"+o]),o>0&&s<this.max[o-1]&&s+1<this.max[o]+1&&this.innerFacets.push(["|"+s+"|"+o,"|"+(s+1)+"|"+o,"|"+(s+1)+"|"+(o-1)])}edgeVecsABOB(){const s=this.m,Z=this.n,o=new Zs(-Z,s+Z);for(let t=1;t<s+Z;t++){const s=new Zs(this.min[t],t),Z=new Zs(this.min[t-1],t-1),j=new Zs(this.min[t+1],t+1),S=s.clone(),a=Z.clone(),O=j.clone();S.rotate60About(o),a.rotate60About(o),O.rotate60About(o);const v=new Zs(this.max[S.y],S.y),G=new Zs(this.max[S.y-1],S.y-1),B=new Zs(this.max[S.y-1]-1,S.y-1);S.x===v.x&&S.y===v.y||(S.x!==G.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,G,B]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,B,v])):S.y===O.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,Z,G]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([s,G,j])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,Z,G]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,G,v])))}}mapABOBtoOBOA(){const s=new Zs(0,0);for(let Z=0;Z<this.isoVecsABOB.length;Z++){const o=[];for(let t=0;t<3;t++)s.x=this.isoVecsABOB[Z][t].x,s.y=this.isoVecsABOB[Z][t].y,0===this.vertexTypes[Z][t]&&s.rotateNeg120(this.m,this.n),o.push(s.clone());this.isoVecsOBOA.push(o)}}mapABOBtoBAOA(){const s=new Zs(0,0);for(let Z=0;Z<this.isoVecsABOB.length;Z++){const o=[];for(let t=0;t<3;t++)s.x=this.isoVecsABOB[Z][t].x,s.y=this.isoVecsABOB[Z][t].y,1===this.vertexTypes[Z][t]&&s.rotate120(this.m,this.n),o.push(s.clone());this.isoVecsBAOA.push(o)}}MapToFace(s,Z){const o=this.IDATA.face[s],j=o[2],S=o[1],a=o[0],O=t.n.oO(this.IDATA.vertex[j]),v=t.n.oO(this.IDATA.vertex[S]),G=t.n.oO(this.IDATA.vertex[a]),B=v.Go(O),Q=G.Go(O),D=B.scale(this.coau).add(Q.scale(this.cobu)),z=B.scale(this.coav).add(Q.scale(this.cobv)),Y=[];let b,f=t.g.sO[0];for(let t=0;t<this.cartesian.length;t++)f=D.scale(this.cartesian[t].x).add(z.scale(this.cartesian[t].y)).add(O),Y[t]=[f.x,f.y,f.z],b=s+"|"+this.vertices[t].x+"|"+this.vertices[t].y,Z.vertex[this.vecToidx[b]]=[f.x,f.y,f.z]}build(s,Z){const o=[],t=Zs.Zero(),j=new Zs(s,Z),S=new Zs(-Z,s+Z);o.push(t,j,S);for(let u=Z;u<s+1;u++)for(let Z=0;Z<s+1-u;Z++)o.push(new Zs(Z,u));if(Z>0){const t=(0,y.HighestCommonFactor)(s,Z),j=s/t,S=Z/t;for(let O=1;O<t;O++)o.push(new Zs(O*j,O*S)),o.push(new Zs(-O*S,O*(j+S))),o.push(new Zs(s-O*(j+S),Z+O*j));const a=s/Z;for(let O=1;O<Z;O++)for(let t=0;t<O*a;t++)o.push(new Zs(t,O)),o.push(new Zs(t,O).rotate120(s,Z)),o.push(new Zs(t,O).rotateNeg120(s,Z))}o.sort(((s,Z)=>s.x-Z.x)),o.sort(((s,Z)=>s.y-Z.y));const a=new Array(s+Z+1),O=new Array(s+Z+1);for(let u=0;u<a.length;u++)a[u]=1/0,O[u]=-1/0;let v=0,G=0;const B=o.length;for(let u=0;u<B;u++)G=o[u].x,v=o[u].y,a[v]=Math.min(G,a[v]),O[v]=Math.max(G,O[v]);const Q=(o,t)=>{const j=o.clone();return"A"===t&&j.rotateNeg120(s,Z),"B"===t&&j.rotate120(s,Z),j.x<0?j.y:j.x+j.y},D=[],z=[],Y=[],b=[],f={},A=[];let d=-1,U=-1;for(let u=0;u<B;u++)D[u]=o[u].toCartesianOrigin(new Zs(0,0),.5),z[u]=Q(o[u],"O"),Y[u]=Q(o[u],"A"),b[u]=Q(o[u],"B"),z[u]===Y[u]&&Y[u]===b[u]?(d=3,U=z[u]):z[u]===Y[u]?(d=4,U=z[u]):Y[u]===b[u]?(d=5,U=Y[u]):b[u]===z[u]&&(d=6,U=z[u]),z[u]<Y[u]&&z[u]<b[u]&&(d=2,U=z[u]),Y[u]<z[u]&&Y[u]<b[u]&&(d=1,U=Y[u]),b[u]<Y[u]&&b[u]<z[u]&&(d=0,U=b[u]),A.push([d,U,o[u].x,o[u].y]);A.sort(((s,Z)=>s[2]-Z[2])),A.sort(((s,Z)=>s[3]-Z[3])),A.sort(((s,Z)=>s[1]-Z[1])),A.sort(((s,Z)=>s[0]-Z[0]));for(let u=0;u<A.length;u++)f[A[u][2]+"|"+A[u][3]]=[A[u][0],A[u][1],u];return this.m=s,this.n=Z,this.vertices=o,this.vertByDist=f,this.cartesian=D,this.min=a,this.max=O,this}}class ts{constructor(s,Z,o,t){this.name=s,this.category=Z,this.vertex=o,this.face=t}}class js extends ts{innerToData(s,Z){for(let o=0;o<Z.innerFacets.length;o++)this.face.push(Z.innerFacets[o].map((o=>Z.vecToidx[s+o])))}mapABOBtoDATA(s,Z){const o=Z.IDATA.edgematch[s][0];for(let t=0;t<Z.isoVecsABOB.length;t++){const j=[];for(let S=0;S<3;S++)0===Z.vertexTypes[t][S]?j.push(s+"|"+Z.isoVecsABOB[t][S].x+"|"+Z.isoVecsABOB[t][S].y):j.push(o+"|"+Z.isoVecsABOB[t][S].x+"|"+Z.isoVecsABOB[t][S].y);this.face.push([Z.vecToidx[j[0]],Z.vecToidx[j[1]],Z.vecToidx[j[2]]])}}mapOBOAtoDATA(s,Z){const o=Z.IDATA.edgematch[s][0];for(let t=0;t<Z.isoVecsOBOA.length;t++){const j=[];for(let S=0;S<3;S++)1===Z.vertexTypes[t][S]?j.push(s+"|"+Z.isoVecsOBOA[t][S].x+"|"+Z.isoVecsOBOA[t][S].y):j.push(o+"|"+Z.isoVecsOBOA[t][S].x+"|"+Z.isoVecsOBOA[t][S].y);this.face.push([Z.vecToidx[j[0]],Z.vecToidx[j[1]],Z.vecToidx[j[2]]])}}mapBAOAtoDATA(s,Z){const o=Z.IDATA.edgematch[s][2];for(let t=0;t<Z.isoVecsBAOA.length;t++){const j=[];for(let S=0;S<3;S++)1===Z.vertexTypes[t][S]?j.push(s+"|"+Z.isoVecsBAOA[t][S].x+"|"+Z.isoVecsBAOA[t][S].y):j.push(o+"|"+Z.isoVecsBAOA[t][S].x+"|"+Z.isoVecsBAOA[t][S].y);this.face.push([Z.vecToidx[j[0]],Z.vecToidx[j[1]],Z.vecToidx[j[2]]])}}orderData(s){const Z=[];for(let S=0;S<13;S++)Z[S]=[];const o=s.closestTo;for(let S=0;S<o.length;S++)o[S][0]>-1?o[S][1]>0&&Z[o[S][0]].push([S,o[S][1]]):Z[12].push([S,o[S][0]]);const t=[];for(let S=0;S<12;S++)t[S]=S;let j=12;for(let S=0;S<12;S++){Z[S].sort(((s,Z)=>s[1]-Z[1]));for(let s=0;s<Z[S].length;s++)t[Z[S][s][0]]=j++}for(let S=0;S<Z[12].length;S++)t[Z[12][S][0]]=j++;for(let S=0;S<this.vertex.length;S++)this.vertex[S].push(t[S]);this.vertex.sort(((s,Z)=>s[3]-Z[3]));for(let S=0;S<this.vertex.length;S++)this.vertex[S].pop();for(let S=0;S<this.face.length;S++)for(let s=0;s<this.face[S].length;s++)this.face[S][s]=t[this.face[S][s]];this.sharedNodes=Z[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(s,Z){const o=[],t=[];let j=Z.pop();t.push(j);let S=this.face[j].indexOf(s);S=(S+2)%3;let a=this.face[j][S];o.push(a);let O=0;for(;Z.length>0;)j=Z[O],this.face[j].indexOf(a)>-1?(S=(this.face[j].indexOf(a)+1)%3,a=this.face[j][S],o.push(a),t.push(j),Z.splice(O,1),O=0):O++;return this.adjacentFaces.push(o),t}toGoldbergPolyhedronData(){const s=new ts("GeoDual","Goldberg",[],[]);s.name="GD dual";const Z=this.vertex.length,o=new Array(Z);for(let v=0;v<Z;v++)o[v]=[];for(let v=0;v<this.face.length;v++)for(let s=0;s<3;s++)o[this.face[v][s]].push(v);let t=0,j=0,S=0,a=[],O=[];this.adjacentFaces=[];for(let v=0;v<o.length;v++){s.face[v]=this.setOrder(v,o[v].concat([]));for(const Z of o[v]){t=0,j=0,S=0,a=this.face[Z];for(let s=0;s<3;s++)O=this.vertex[a[s]],t+=O[0],j+=O[1],S+=O[2];s.vertex[Z]=[t/3,j/3,S/3]}}return s}static BuildGeodesicData(s){const Z=new js("Geodesic-m-n","Geodesic",[[0,ss.e,-1],[-ss.e,1,0],[-1,0,-ss.e],[1,0,-ss.e],[ss.e,1,0],[0,ss.e,1],[-1,0,ss.e],[-ss.e,-1,0],[0,-ss.e,-1],[ss.e,-1,0],[1,0,ss.e],[0,-ss.e,1]],[]);s.setIndices(),s.calcCoeffs(),s.createInnerFacets(),s.edgeVecsABOB(),s.mapABOBtoOBOA(),s.mapABOBtoBAOA();for(let o=0;o<s.IDATA.face.length;o++)s.MapToFace(o,Z),Z.innerToData(o,s),"B"===s.IDATA.edgematch[o][1]&&Z.mapABOBtoDATA(o,s),"O"===s.IDATA.edgematch[o][1]&&Z.mapOBOAtoDATA(o,s),"A"===s.IDATA.edgematch[o][3]&&Z.mapBAOAtoDATA(o,s);Z.orderData(s);return Z.vertex=Z.vertex.map((function(s){const Z=s[0],o=s[1],t=s[2],j=Math.sqrt(Z*Z+o*o+t*t);return s[0]*=1/j,s[1]*=1/j,s[2]*=1/j,s})),Z}}j.d._GoldbergMeshParser=(s,Z)=>Ss.Parse(s,Z);class Ss extends j.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(s,Z){return void 0===Z?(s>this.goldbergData.nbUnsharedFaces-1&&(J.b.Warn("Maximum number of unshared faces used"),s=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+s):(s>11&&(J.b.Warn("Last pole used"),s=11),Z>this.goldbergData.nbFacesAtPole-1&&(J.b.Warn("Maximum number of faces at a pole used"),Z=this.goldbergData.nbFacesAtPole-1),12+s*this.goldbergData.nbFacesAtPole+Z)}_changeGoldbergFaceColors(s){for(let o=0;o<s.length;o++){const Z=s[o][0],t=s[o][1],j=s[o][2];for(let s=Z;s<t+1;s++)this.goldbergData.faceColors[s]=j}const Z=[];for(let o=0;o<12;o++)for(let s=0;s<5;s++)Z.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);for(let o=12;o<this.goldbergData.faceColors.length;o++)for(let s=0;s<6;s++)Z.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);return Z}setGoldbergFaceColors(s){const Z=this._changeGoldbergFaceColors(s);this.hs(S.e.ColorKind,Z)}updateGoldbergFaceColors(s){const Z=this._changeGoldbergFaceColors(s);this.updateVerticesData(S.e.ColorKind,Z)}_changeGoldbergFaceUVs(s){const Z=this.getVerticesData(S.e.UVKind);for(let o=0;o<s.length;o++){const t=s[o][0],j=s[o][1],S=s[o][2],a=s[o][3],O=s[o][4],v=[],G=[];let B,Q;for(let s=0;s<5;s++)B=S.x+a*Math.cos(O+s*Math.PI/2.5),Q=S.y+a*Math.sin(O+s*Math.PI/2.5),B<0&&(B=0),B>1&&(B=1),v.push(B,Q);for(let s=0;s<6;s++)B=S.x+a*Math.cos(O+s*Math.PI/3),Q=S.y+a*Math.sin(O+s*Math.PI/3),B<0&&(B=0),B>1&&(B=1),G.push(B,Q);for(let s=t;s<Math.min(12,j+1);s++)for(let o=0;o<5;o++)Z[10*s+2*o]=v[2*o],Z[10*s+2*o+1]=v[2*o+1];for(let s=Math.max(12,t);s<j+1;s++)for(let o=0;o<6;o++)Z[12*s-24+2*o]=G[2*o],Z[12*s-23+2*o]=G[2*o+1]}return Z}setGoldbergFaceUVs(s){const Z=this._changeGoldbergFaceUVs(s);this.hs(S.e.UVKind,Z)}updateGoldbergFaceUVs(s){const Z=this._changeGoldbergFaceUVs(s);this.updateVerticesData(S.e.UVKind,Z)}placeOnGoldbergFaceAt(s,Z,o){const j=t.n.RotationFromAxis(this.goldbergData.faceXaxis[Z],this.goldbergData.faceYaxis[Z],this.goldbergData.faceZaxis[Z]);s.rotation=j,s.position=this.goldbergData.faceCenters[Z].add(this.goldbergData.faceXaxis[Z].scale(o.x)).add(this.goldbergData.faceYaxis[Z].scale(o.y)).add(this.goldbergData.faceZaxis[Z].scale(o.z))}serialize(s){super.serialize(s),s.type="GoldbergMesh";const Z={};if(Z.adjacentFaces=this.goldbergData.adjacentFaces,Z.nbSharedFaces=this.goldbergData.nbSharedFaces,Z.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,Z.nbFaces=this.goldbergData.nbFaces,Z.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){Z.faceColors=[];for(const s of this.goldbergData.faceColors)Z.faceColors.push(s.ma())}if(this.goldbergData.faceCenters){Z.faceCenters=[];for(const s of this.goldbergData.faceCenters)Z.faceCenters.push(s.ma())}if(this.goldbergData.faceZaxis){Z.faceZaxis=[];for(const s of this.goldbergData.faceZaxis)Z.faceZaxis.push(s.ma())}if(this.goldbergData.faceYaxis){Z.faceYaxis=[];for(const s of this.goldbergData.faceYaxis)Z.faceYaxis.push(s.ma())}if(this.goldbergData.faceXaxis){Z.faceXaxis=[];for(const s of this.goldbergData.faceXaxis)Z.faceXaxis.push(s.ma())}s.goldbergData=Z}static Parse(s,Z){const o=s.goldbergData;o.faceColors=o.faceColors.map((s=>D.h.oO(s))),o.faceCenters=o.faceCenters.map((s=>t.n.oO(s))),o.faceZaxis=o.faceZaxis.map((s=>t.n.oO(s))),o.faceXaxis=o.faceXaxis.map((s=>t.n.oO(s))),o.faceYaxis=o.faceYaxis.map((s=>t.n.oO(s)));const j=new Ss(s.name,Z);return j.goldbergData=o,j}}var as=o(11649);const Os={CreateBox:Q.c,CreateTiledBox:f,CreateSphere:A.e,CreateDisc:B.e,CreateIcoSphere:k,CreateRibbon:G,CreateCylinder:H,CreateTorus:i,CreateTorusKnot:L,CreateLineSystem:V.d,mv:V.g,CreateDashedLines:V.b,ExtrudeShape:R,ExtrudeShapeCustom:e,CreateLathe:w,CreateTiledPlane:Y,Jv:X.c,CreateGround:W.d,CreateTiledGround:W.e,CreateGroundFromHeightMap:W.c,CreatePolygon:g.d,ExtrudePolygon:g.f,CreateTube:q,CreatePolyhedron:M,CreateGeodesic:function(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=Z.m||1;t!==Math.floor(t)&&(t=Math.floor(t),J.b.Warn("m not an integer only floor(m) used"));let j=Z.n||0;if(j!==Math.floor(j)&&(j=Math.floor(j),J.b.Warn("n not an integer only floor(n) used")),j>t){const s=j;j=t,t=s,J.b.Warn("n > m therefore m and n swapped")}const S=new os;return S.build(t,j),M(s,{custom:js.BuildGeodesicData(S),size:Z.size,sizeX:Z.sizeX,sizeY:Z.sizeY,sizeZ:Z.sizeZ,faceUV:Z.faceUV,faceColors:Z.faceColors,flat:Z.flat,updatable:Z.updatable,sideOrientation:Z.sideOrientation,frontUVs:Z.frontUVs,backUVs:Z.backUVs},o)},CreateGoldberg:function(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Z.size,v=Z.sizeX||S||1,G=Z.sizeY||S||1,B=Z.sizeZ||S||1;let Q=Z.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),J.b.Warn("m not an integer only floor(m) used"));let z=Z.n||0;if(z!==Math.floor(z)&&(z=Math.floor(z),J.b.Warn("n not an integer only floor(n) used")),z>Q){const s=z;z=Q,Q=s,J.b.Warn("n > m therefore m and n swapped")}const Y=new os;Y.build(Q,z);const b=js.BuildGeodesicData(Y),f=b.toGoldbergPolyhedronData(),A=new Ss(s,o);Z.sideOrientation=j.d._GetDefaultSideOrientation(Z.sideOrientation),A._originalBuilderSideOrientation=Z.sideOrientation;(function(s,Z){const o=s.size,j=s.sizeX||o||1,S=s.sizeY||o||1,v=s.sizeZ||o||1,G=0===s.sideOrientation?0:s.sideOrientation||a.d.DEFAULTSIDE,B=[],Q=[],D=[],z=[];let Y=1/0,b=-1/0,f=1/0,A=-1/0;for(let t=0;t<Z.vertex.length;t++)Y=Math.min(Y,Z.vertex[t][0]*j),b=Math.max(b,Z.vertex[t][0]*j),f=Math.min(f,Z.vertex[t][1]*S),A=Math.max(A,Z.vertex[t][1]*S);let d=0;for(let a=0;a<Z.face.length;a++){const s=Z.face[a],o=t.n.oO(Z.vertex[s[0]]),G=t.n.oO(Z.vertex[s[2]]),U=t.n.oO(Z.vertex[s[1]]),u=G.Go(o),H=U.Go(o),F=t.n.Cross(H,u).normalize();for(let t=0;t<s.length;t++){D.push(F.x,F.y,F.z);const o=Z.vertex[s[t]];B.push(o[0]*j,o[1]*S,o[2]*v);const a=(o[1]*S-f)/(A-f);z.push((o[0]*j-Y)/(b-Y),O.b?1-a:a)}for(let Z=0;Z<s.length-2;Z++)Q.push(d,d+Z+2,d+Z+1);d+=s.length}a.d._ComputeSides(G,B,Q,D,z);const U=new a.d;return U.gs=B,U.indices=Q,U.ls=D,U.es=z,U})(Z,f).ws(A,Z.updatable),A.goldbergData.nbSharedFaces=b.sharedNodes,A.goldbergData.nbUnsharedFaces=b.poleNodes,A.goldbergData.adjacentFaces=b.adjacentFaces,A.goldbergData.nbFaces=A.goldbergData.nbSharedFaces+A.goldbergData.nbUnsharedFaces,A.goldbergData.nbFacesAtPole=(A.goldbergData.nbUnsharedFaces-12)/12;for(let j=0;j<b.vertex.length;j++)A.goldbergData.faceCenters.push(t.n.oO(b.vertex[j])),A.goldbergData.faceCenters[j].x*=v,A.goldbergData.faceCenters[j].y*=G,A.goldbergData.faceCenters[j].z*=B,A.goldbergData.faceColors.push(new D.h(1,1,1,1));for(let j=0;j<f.face.length;j++){const s=f.face[j],Z=t.n.oO(f.vertex[s[0]]),o=t.n.oO(f.vertex[s[2]]),S=t.n.oO(f.vertex[s[1]]),a=o.Go(Z),O=S.Go(Z),v=t.n.Cross(O,a).normalize(),G=t.n.Cross(O,v).normalize();A.goldbergData.faceXaxis.push(O.normalize()),A.goldbergData.faceYaxis.push(v),A.goldbergData.faceZaxis.push(G)}return A},CreateDecal:T,CreateCapsule:n,CreateText:as.e}},12369:(s,Z,o)=>{"use strict";o.d(Z,{b:()=>OZ});var t=o(10900),j=o(11548);class S extends j.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var a=o(11174),O=(o(11346),o(10916));class v{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(s){this._targetStopDuration!==s&&(this._targetStopDuration=s)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(s){this._noiseTexture!==s&&(this._noiseTexture=s,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(s){this._animationSheetEnabled!==s&&(this._animationSheetEnabled=s)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(s){this._isAnimationSheetEnabled!=s&&(this._isAnimationSheetEnabled=s,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(s){this._useLogarithmicDepth=s&&this.Ls().getEngine().getCaps().fragmentDepthSupported}Ls(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(s){switch(s){case v.BLENDMODE_MULTIPLYADD:return;case v.BLENDMODE_ADD:s=1;break;case v.BLENDMODE_ONEONE:s=6;break;case v.BLENDMODE_STANDARD:s=2;break;case v.BLENDMODE_MULTIPLY:s=4;break;case v.BLENDMODE_SUBTRACT:s=3}this._engine.setAlphaMode(s)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:t.n.Zero()}set direction1(s){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=s)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:t.n.Zero()}set direction2(s){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=s)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:t.n.Zero()}set minEmitBox(s){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=s)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:t.n.Zero()}set maxEmitBox(s){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=s)}get billboardMode(){return this._billboardMode}set billboardMode(s){this._billboardMode!==s&&(this._billboardMode=s,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(s){this._isBillboardBased!==s&&(this._isBillboardBased=s,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(s){this._attachImageProcessingConfiguration(s)}_attachImageProcessingConfiguration(s){s!==this._imageProcessingConfiguration&&(!s&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=s)}_reset(){}_removeGradientAndTexture(s,Z,o){if(!Z)return this;let t=0;for(const j of Z){if(j.gradient===s){Z.splice(t,1);break}t++}return o&&o.dispose(),this}constructor(s){this.animations=[],this.renderingGroupId=0,this.k=t.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new t.n(10,10,10),this.onAnimationEnd=null,this.blendMode=v.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new t.j(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Ev=new t.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=t.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new a.h(1,1,1,1),this.color2=new a.h(1,1,1,1),this.colorDead=new a.h(0,0,0,1),this.textureMask=new a.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new S,this.id=s,this.name=s}createPointEmitter(s,Z){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new t.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new t.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new t.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new t.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new t.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new t.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(s,Z,o,t){throw new Error("Method not implemented.")}}v.BLENDMODE_ONEONE=0,v.BLENDMODE_STANDARD=1,v.BLENDMODE_ADD=2,v.BLENDMODE_MULTIPLY=3,v.BLENDMODE_MULTIPLYADD=4,v.BLENDMODE_SUBTRACT=-1,(0,O.f)("BABYLON.BaseParticleSystem",v);var G=o(10935),B=o(10964);class Q{constructor(){this.direction1=new t.n(0,1,0),this.direction2=new t.n(0,1,0),this.minEmitBox=new t.n(-.5,-.5,-.5),this.maxEmitBox=new t.n(.5,.5,.5)}startDirectionFunction(s,Z,o,j){const S=(0,G.RandomRange)(this.direction1.x,this.direction2.x),a=(0,G.RandomRange)(this.direction1.y,this.direction2.y),O=(0,G.RandomRange)(this.direction1.z,this.direction2.z);if(j)return Z.x=S,Z.y=a,void(Z.z=O);t.n.TransformNormalFromFloatsToRef(S,a,O,s,Z)}startPositionFunction(s,Z,o,j){const S=(0,G.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),a=(0,G.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),O=(0,G.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(j)return Z.x=S,Z.y=a,void(Z.z=O);t.n.TransformCoordinatesFromFloatsToRef(S,a,O,s,Z)}clone(){const s=new Q;return B.c.DeepCopy(this,s),s}applyToShader(s){s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2),s.setVector3("minEmitBox",this.minEmitBox),s.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(s){s.addUniform("direction1",3),s.addUniform("direction2",3),s.addUniform("minEmitBox",3),s.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.direction1=this.direction1.ma(),s.direction2=this.direction2.ma(),s.minEmitBox=this.minEmitBox.ma(),s.maxEmitBox=this.maxEmitBox.ma(),s}parse(s){t.n.FromArrayToRef(s.direction1,0,this.direction1),t.n.FromArrayToRef(s.direction2,0,this.direction2),t.n.FromArrayToRef(s.minEmitBox,0,this.minEmitBox),t.n.FromArrayToRef(s.maxEmitBox,0,this.maxEmitBox)}}class D{get radius(){return this._radius}set radius(s){this._radius=s,this._buildHeight()}get angle(){return this._angle}set angle(s){this._angle=s,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=o,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=Z,this.radius=s}startDirectionFunction(s,Z,o,j){j?t.g.sO[0].O(o.qO).normalize():o.position.subtractToRef(s.getTranslation(),t.g.sO[0]).normalize();const S=(0,G.RandomRange)(0,this.directionRandomizer),a=(0,G.RandomRange)(0,this.directionRandomizer),O=(0,G.RandomRange)(0,this.directionRandomizer);Z.x=t.g.sO[0].x+S,Z.y=t.g.sO[0].y+a,Z.z=t.g.sO[0].z+O,Z.normalize()}startPositionFunction(s,Z,o,j){const S=(0,G.RandomRange)(0,2*Math.PI);let a;this.emitFromSpawnPointOnly?a=1e-4:(a=(0,G.RandomRange)(0,this.heightRange),a=1-a*a);let O=this._radius-(0,G.RandomRange)(0,this._radius*this.radiusRange);O*=a;const v=O*Math.sin(S),B=O*Math.cos(S),Q=a*this._height;if(j)return Z.x=v,Z.y=Q,void(Z.z=B);t.n.TransformCoordinatesFromFloatsToRef(v,Q,B,s,Z)}clone(){const s=new D(this._radius,this._angle,this.directionRandomizer);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat2("radius",this._radius,this.radiusRange),s.setFloat("coneAngle",this._angle),s.setFloat2("height",this._height,this.heightRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",2),s.addUniform("coneAngle",1),s.addUniform("height",2),s.addUniform("directionRandomizer",1)}getEffectDefines(){let s="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(s+="\n#define CONEEMITTERSPAWNPOINT"),s}getClassName(){return"ConeParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this._radius,s.angle=this._angle,s.directionRandomizer=this.directionRandomizer,s.radiusRange=this.radiusRange,s.heightRange=this.heightRange,s.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,s}parse(s){this.radius=s.radius,this.angle=s.angle,this.directionRandomizer=s.directionRandomizer,this.radiusRange=void 0!==s.radiusRange?s.radiusRange:1,this.heightRange=void 0!==s.radiusRange?s.heightRange:1,this.emitFromSpawnPointOnly=void 0!==s.emitFromSpawnPointOnly&&s.emitFromSpawnPointOnly}}class z extends D{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0),j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0);super(s,Z),this.direction1=o,this.direction2=j}startDirectionFunction(s,Z){const o=(0,G.RandomRange)(this.direction1.x,this.direction2.x),j=(0,G.RandomRange)(this.direction1.y,this.direction2.y),S=(0,G.RandomRange)(this.direction1.z,this.direction2.z);t.n.TransformNormalFromFloatsToRef(o,j,S,s,Z)}clone(){const s=new z(this.radius,this.angle,this.direction1,this.direction2);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const s=super.serialize();return s.direction1=this.direction1.ma(),s.direction2=this.direction2.ma(),s}parse(s){super.parse(s),this.direction1.O(s.direction1),this.direction2.O(s.direction2)}}class Y{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=s,this.height=Z,this.radiusRange=o,this.directionRandomizer=j,this._tempVector=t.n.Zero()}startDirectionFunction(s,Z,o,j,S){o.position.subtractToRef(s.getTranslation(),this._tempVector),this._tempVector.normalize(),t.n.TransformNormalToRef(this._tempVector,S,this._tempVector);const a=(0,G.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let O=Math.atan2(this._tempVector.x,this._tempVector.z);O+=(0,G.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=a,this._tempVector.x=Math.sin(O),this._tempVector.z=Math.cos(O),this._tempVector.normalize(),j?Z.O(this._tempVector):t.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,s,Z)}startPositionFunction(s,Z,o,j){const S=(0,G.RandomRange)(-this.height/2,this.height/2),a=(0,G.RandomRange)(0,2*Math.PI),O=(0,G.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),v=Math.sqrt(O)*this.radius,B=v*Math.cos(a),Q=v*Math.sin(a);j?Z.Ja(B,S,Q):t.n.TransformCoordinatesFromFloatsToRef(B,S,Q,s,Z)}clone(){const s=new Y(this.radius,this.directionRandomizer);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("height",this.height),s.setFloat("radiusRange",this.radiusRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("height",1),s.addUniform("radiusRange",1),s.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this.radius,s.height=this.height,s.radiusRange=this.radiusRange,s.directionRandomizer=this.directionRandomizer,s}parse(s){this.radius=s.radius,this.height=s.height,this.radiusRange=s.radiusRange,this.directionRandomizer=s.directionRandomizer}}class b extends Y{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0),S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.n(0,1,0);super(s,Z,o),this.direction1=j,this.direction2=S}startDirectionFunction(s,Z,o,j){const S=(0,G.RandomRange)(this.direction1.x,this.direction2.x),a=(0,G.RandomRange)(this.direction1.y,this.direction2.y),O=(0,G.RandomRange)(this.direction1.z,this.direction2.z);j?Z.Ja(S,a,O):t.n.TransformNormalFromFloatsToRef(S,a,O,s,Z)}clone(){const s=new b(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("height",this.height),s.setFloat("radiusRange",this.radiusRange),s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("height",1),s.addUniform("radiusRange",1),s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const s=super.serialize();return s.direction1=this.direction1.ma(),s.direction2=this.direction2.ma(),s}parse(s){super.parse(s),t.n.FromArrayToRef(s.direction1,0,this.direction1),t.n.FromArrayToRef(s.direction2,0,this.direction2)}}class f{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=s,this.radiusRange=Z,this.directionRandomizer=o}startDirectionFunction(s,Z,o,j){const S=o.position.Go(s.getTranslation()).normalize(),a=(0,G.RandomRange)(0,this.directionRandomizer),O=(0,G.RandomRange)(0,this.directionRandomizer),v=(0,G.RandomRange)(0,this.directionRandomizer);S.x+=a,S.y+=O,S.z+=v,S.normalize(),j?Z.O(S):t.n.TransformNormalFromFloatsToRef(S.x,S.y,S.z,s,Z)}startPositionFunction(s,Z,o,j){const S=this.radius-(0,G.RandomRange)(0,this.radius*this.radiusRange),a=(0,G.RandomRange)(0,1),O=(0,G.RandomRange)(0,2*Math.PI),v=Math.acos(2*a-1),B=S*Math.cos(O)*Math.sin(v),Q=S*Math.cos(v),D=S*Math.sin(O)*Math.sin(v);j?Z.Ja(B,Math.abs(Q),D):t.n.TransformCoordinatesFromFloatsToRef(B,Math.abs(Q),D,s,Z)}clone(){const s=new f(this.radius,this.directionRandomizer);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this.radius,s.radiusRange=this.radiusRange,s.directionRandomizer=this.directionRandomizer,s}parse(s){this.radius=s.radius,this.radiusRange=s.radiusRange,this.directionRandomizer=s.directionRandomizer}}class A{constructor(){this.direction1=new t.n(0,1,0),this.direction2=new t.n(0,1,0)}startDirectionFunction(s,Z,o,j){const S=(0,G.RandomRange)(this.direction1.x,this.direction2.x),a=(0,G.RandomRange)(this.direction1.y,this.direction2.y),O=(0,G.RandomRange)(this.direction1.z,this.direction2.z);j?Z.Ja(S,a,O):t.n.TransformNormalFromFloatsToRef(S,a,O,s,Z)}startPositionFunction(s,Z,o,j){j?Z.Ja(0,0,0):t.n.TransformCoordinatesFromFloatsToRef(0,0,0,s,Z)}clone(){const s=new A;return B.c.DeepCopy(this,s),s}applyToShader(s){s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.direction1=this.direction1.ma(),s.direction2=this.direction2.ma(),s}parse(s){t.n.FromArrayToRef(s.direction1,0,this.direction1),t.n.FromArrayToRef(s.direction2,0,this.direction2)}}class d{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=s,this.radiusRange=Z,this.directionRandomizer=o}startDirectionFunction(s,Z,o,j){const S=o.position.Go(s.getTranslation()).normalize(),a=(0,G.RandomRange)(0,this.directionRandomizer),O=(0,G.RandomRange)(0,this.directionRandomizer),v=(0,G.RandomRange)(0,this.directionRandomizer);S.x+=a,S.y+=O,S.z+=v,S.normalize(),j?Z.O(S):t.n.TransformNormalFromFloatsToRef(S.x,S.y,S.z,s,Z)}startPositionFunction(s,Z,o,j){const S=this.radius-(0,G.RandomRange)(0,this.radius*this.radiusRange),a=(0,G.RandomRange)(0,1),O=(0,G.RandomRange)(0,2*Math.PI),v=Math.acos(2*a-1),B=S*Math.cos(O)*Math.sin(v),Q=S*Math.cos(v),D=S*Math.sin(O)*Math.sin(v);j?Z.Ja(B,Q,D):t.n.TransformCoordinatesFromFloatsToRef(B,Q,D,s,Z)}clone(){const s=new d(this.radius,this.directionRandomizer);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this.radius,s.radiusRange=this.radiusRange,s.directionRandomizer=this.directionRandomizer,s}parse(s){this.radius=s.radius,this.radiusRange=s.radiusRange,this.directionRandomizer=s.directionRandomizer}}class U extends d{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.n(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0);super(s),this.direction1=Z,this.direction2=o}startDirectionFunction(s,Z){const o=(0,G.RandomRange)(this.direction1.x,this.direction2.x),j=(0,G.RandomRange)(this.direction1.y,this.direction2.y),S=(0,G.RandomRange)(this.direction1.z,this.direction2.z);t.n.TransformNormalFromFloatsToRef(o,j,S,s,Z)}clone(){const s=new U(this.radius,this.direction1,this.direction2);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const s=super.serialize();return s.direction1=this.direction1.ma(),s.direction2=this.direction2.ma(),s}parse(s){super.parse(s),this.direction1.O(s.direction1),this.direction2.O(s.direction2)}}class u{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(s,Z,o,j){const S=t.g.sO[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,o,S);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,o,S);const s=t.g.sO[1];S.subtractToRef(o.position,s),s.scaleToRef(1/o.lifeTime,S)}else S.set(0,0,0);j?Z.O(S):t.n.TransformNormalToRef(S,s,Z)}startPositionFunction(s,Z,o,j){const S=t.g.sO[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,o,S):S.set(0,0,0),j?Z.O(S):t.n.TransformCoordinatesToRef(S,s,Z)}clone(){const s=new u;return B.c.DeepCopy(this,s),s}applyToShader(s){}buildUniformLayout(s){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.particlePositionGenerator=this.particlePositionGenerator,s.particleDestinationGenerator=this.particleDestinationGenerator,s}parse(s){s.particlePositionGenerator&&(this.particlePositionGenerator=s.particlePositionGenerator),s.particleDestinationGenerator&&(this.particleDestinationGenerator=s.particleDestinationGenerator)}}var H=o(11113);class F{get mesh(){return this._mesh}set mesh(s){this._mesh!==s&&(this._mesh=s,s?(this._indices=s.ra(),this._positions=s.getVerticesData(H.e.PositionKind),this._normals=s.getVerticesData(H.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=t.n.Zero(),this._mesh=null,this.direction1=new t.n(0,1,0),this.direction2=new t.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=s}startDirectionFunction(s,Z,o,j){if(this.useMeshNormalsForDirection&&this._normals)return void t.n.TransformNormalToRef(this._storedNormal,s,Z);const S=(0,G.RandomRange)(this.direction1.x,this.direction2.x),a=(0,G.RandomRange)(this.direction1.y,this.direction2.y),O=(0,G.RandomRange)(this.direction1.z,this.direction2.z);j?Z.Ja(S,a,O):t.n.TransformNormalFromFloatsToRef(S,a,O,s,Z)}startPositionFunction(s,Z,o,j){if(!this._indices||!this._positions)return;const S=3*(Math.random()*(this._indices.length/3)|0),a=Math.random(),O=Math.random()*(1-a),v=1-a-O,G=this._indices[S],B=this._indices[S+1],Q=this._indices[S+2],D=t.g.sO[0],z=t.g.sO[1],Y=t.g.sO[2],b=t.g.sO[3];t.n.FromArrayToRef(this._positions,3*G,D),t.n.FromArrayToRef(this._positions,3*B,z),t.n.FromArrayToRef(this._positions,3*Q,Y),b.x=a*D.x+O*z.x+v*Y.x,b.y=a*D.y+O*z.y+v*Y.y,b.z=a*D.z+O*z.z+v*Y.z,j?Z.Ja(b.x,b.y,b.z):t.n.TransformCoordinatesFromFloatsToRef(b.x,b.y,b.z,s,Z),this.useMeshNormalsForDirection&&this._normals&&(t.n.FromArrayToRef(this._normals,3*G,D),t.n.FromArrayToRef(this._normals,3*B,z),t.n.FromArrayToRef(this._normals,3*Q,Y),this._storedNormal.x=a*D.x+O*z.x+v*Y.x,this._storedNormal.y=a*D.y+O*z.y+v*Y.y,this._storedNormal.z=a*D.z+O*z.z+v*Y.z)}clone(){const s=new F(this.mesh);return B.c.DeepCopy(this,s),s}applyToShader(s){s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var s;const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.ma(),Z.direction2=this.direction2.ma(),Z.meshId=null===(s=this.mesh)||void 0===s?void 0:s.id,Z.useMeshNormalsForDirection=this.useMeshNormalsForDirection,Z}parse(s,Z){t.n.FromArrayToRef(s.direction1,0,this.direction1),t.n.FromArrayToRef(s.direction2,0,this.direction2),s.meshId&&Z&&(this.mesh=Z.getLastMeshById(s.meshId)),this.useMeshNormalsForDirection=s.useMeshNormalsForDirection}}class i{_isUbo(s){return void 0!==s.addUniform}constructor(s){this._isUbo(s)?(this.setMatrix3x3=s.updateMatrix3x3.bind(s),this.setMatrix2x2=s.updateMatrix2x2.bind(s),this.setFloat=s.updateFloat.bind(s),this.setFloat2=s.updateFloat2.bind(s),this.setFloat3=s.updateFloat3.bind(s),this.setFloat4=s.updateFloat4.bind(s),this.setFloatArray=s.updateFloatArray.bind(s),this.setArray=s.updateArray.bind(s),this.setIntArray=s.updateIntArray.bind(s),this.setMatrix=s.SO.bind(s),this.setMatrices=s.updateMatrices.bind(s),this.setVector3=s.updateVector3.bind(s),this.setVector4=s.updateVector4.bind(s),this.setColor3=s.updateColor3.bind(s),this.setColor4=s.updateColor4.bind(s),this.setDirectColor4=s.updateDirectColor4.bind(s),this.setInt=s.updateInt.bind(s),this.setInt2=s.updateInt2.bind(s),this.setInt3=s.updateInt3.bind(s),this.setInt4=s.updateInt4.bind(s)):(this.setMatrix3x3=s.setMatrix3x3.bind(s),this.setMatrix2x2=s.setMatrix2x2.bind(s),this.setFloat=s.setFloat.bind(s),this.setFloat2=s.setFloat2.bind(s),this.setFloat3=s.setFloat3.bind(s),this.setFloat4=s.setFloat4.bind(s),this.setFloatArray=s.setFloatArray.bind(s),this.setArray=s.setArray.bind(s),this.setIntArray=s.setIntArray.bind(s),this.setMatrix=s.setMatrix.bind(s),this.setMatrices=s.setMatrices.bind(s),this.setVector3=s.setVector3.bind(s),this.setVector4=s.setVector4.bind(s),this.setColor3=s.setColor3.bind(s),this.setColor4=s.setColor4.bind(s),this.setDirectColor4=s.setDirectColor4.bind(s),this.setInt=s.setInt.bind(s),this.setInt2=s.setInt2.bind(s),this.setInt3=s.setInt3.bind(s),this.setInt4=s.setInt4.bind(s))}}var N=o(11026);const L="gpuUpdateParticlesPixelShader",V="#version 300 es\nvoid main() {discard;}\n";N.d.ShadersStore[L]||(N.d.ShadersStore[L]=V);const g="gpuUpdateParticlesVertexShader",l="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";N.d.ShadersStore[g]||(N.d.ShadersStore[g]=l);(0,O.f)("BABYLON.WebGL2ParticleSystem",class{constructor(s,Z){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=s,this._engine=Z,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var s;return(null===(s=this._updateEffect)||void 0===s?void 0:s.isReady())??!1}createUpdateBuffer(s){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof u&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=s,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new i(this._updateEffect)}createVertexBuffers(s,Z){this._updateVAO.push(this._createUpdateVAO(s)),this._renderVAO.push(this._engine.recordVertexArrayObject(Z,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=Z}createParticleBuffer(s){return s}bindDrawBuffers(s,Z,o){o?this._engine.bindBuffers(this._renderVertexBuffers,o,Z):this._engine.bindVertexArrayObject(this._renderVAO[s],null)}preUpdateParticleBuffer(){const s=this._engine;if(this._engine.enableEffect(this._updateEffect),!s.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(s,Z,o){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[s],null);const t=this._engine;t.bindTransformFeedbackBuffer(Z.getBuffer()),t.setRasterizerState(!1),t.beginTransformFeedback(!0),t.drawArraysType(3,0,o),t.endTransformFeedback(),t.setRasterizerState(!0),t.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let s=0;s<this._updateVAO.length;s++)this._engine.releaseVertexArrayObject(this._updateVAO[s]);this._updateVAO.length=0;for(let s=0;s<this._renderVAO.length;s++)this._engine.releaseVertexArrayObject(this._renderVAO[s]);this._renderVAO.length=0}_createUpdateVAO(s){const Z={};Z.position=s.createVertexBuffer("position",0,3);let o=3;Z.age=s.createVertexBuffer("age",o,1),o+=1,Z.size=s.createVertexBuffer("size",o,3),o+=3,Z.life=s.createVertexBuffer("life",o,1),o+=1,Z.seed=s.createVertexBuffer("seed",o,4),o+=4,Z.direction=s.createVertexBuffer("direction",o,3),o+=3,this._parent.particleEmitterType instanceof u&&(Z.initialPosition=s.createVertexBuffer("initialPosition",o,3),o+=3),this._parent._colorGradientsTexture||(Z.color=s.createVertexBuffer("color",o,4),o+=4),this._parent._isBillboardBased||(Z.initialDirection=s.createVertexBuffer("initialDirection",o,3),o+=3),this._parent.noiseTexture&&(Z.noiseCoordinates1=s.createVertexBuffer("noiseCoordinates1",o,3),o+=3,Z.noiseCoordinates2=s.createVertexBuffer("noiseCoordinates2",o,3),o+=3),this._parent._angularSpeedGradientsTexture?(Z.angle=s.createVertexBuffer("angle",o,1),o+=1):(Z.angle=s.createVertexBuffer("angle",o,2),o+=2),this._parent._isAnimationSheetEnabled&&(Z.cellIndex=s.createVertexBuffer("cellIndex",o,1),o+=1,this._parent.spriteRandomStartCell&&(Z.cellStartOffset=s.createVertexBuffer("cellStartOffset",o,1),o+=1));const t=this._engine.recordVertexArrayObject(Z,null,this._updateEffect);return this._engine.bindArrayBuffer(null),t}});class R{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,t=arguments.length>3?arguments[3]:void 0;this._engine=s,this._label=t,this._engine._storageBuffers.push(this),this._create(Z,o)}_create(s,Z){this._bufferSize=s,this._creationFlags=Z,this._buffer=this._engine.createStorageBuffer(s,Z,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(s,Z,o){this._buffer&&this._engine.updateStorageBuffer(this._buffer,s,Z,o)}async read(s,Z,o,t){return await this._engine.readFromStorageBuffer(this._buffer,s,Z,o,t)}dispose(){const s=this._engine._storageBuffers,Z=s.indexOf(this);-1!==Z&&(s[Z]=s[s.length-1],s.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var e=o(11086),c=o(11091),w=o(11167),X=o(11410),W=o(11539),q=o(10955),h=o(11052),M=o(11396);class x{constructor(){this._gpuTimeInFrameId=-1,this.counter=new M.d}_addDuration(s,Z){s<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==s?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(Z,!1),this._gpuTimeInFrameId=s):this.counter.addCount(Z,!1))}}var k=o(11009);class y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=s,this._engine=Z,this.uniqueId=W.b.UniqueId,Z.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new x),this._engine.getCaps().supportComputeShaders?t.bindingsMapping?(this._context=Z.createComputeContext(),this._shaderPath=o,this._options={bindingsMapping:{},defines:[],...t}):q.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):q.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const t=this._bindings[s];this._bindings[s]={type:o?0:4,object:Z,indexInGroupEntries:null===t||void 0===t?void 0:t.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!t||t.object!==Z||t.type!==this._bindings[s].type)}setStorageTexture(s,Z){const o=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==Z),this._bindings[s]={type:1,object:Z,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setExternalTexture(s,Z){const o=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==Z),this._bindings[s]={type:6,object:Z,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setVideoTexture(s,Z){return!!Z.externalTexture&&(this.setExternalTexture(s,Z.externalTexture),!0)}setUniformBuffer(s,Z){const o=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==Z),this._bindings[s]={type:y._BufferIsDataBuffer(Z)?7:2,object:Z,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setStorageBuffer(s,Z){const o=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==Z),this._bindings[s]={type:y._BufferIsDataBuffer(Z)?7:3,object:Z,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setTextureSampler(s,Z){const o=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!o||!Z.compareSampler(o.object)),this._bindings[s]={type:5,object:Z,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}isReady(){let s=this._effect;for(const j in this._bindings){const s=this._bindings[j],Z=s.type,o=s.object;switch(Z){case 0:case 4:case 1:if(!o.isReady())return!1;break;case 6:if(!o.isReady())return!1;break}}const Z=[],o=this._shaderPath;if(this._options.defines)for(let j=0;j<this._options.defines.length;j++)Z.push(this._options.defines[j]);const t=Z.join("\n");return this._cachedDefines!==t&&(this._cachedDefines=t,s=this._engine.createComputeEffect(o,{defines:t,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=s),!!s.isReady()}dispatch(s,Z,o){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,s,Z,o,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const o=y._BufferIsDataBuffer(s)?s:s.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,o,Z,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const Z in this._bindings){const o=this._bindings[Z];if(!this._options.bindingsMapping[Z])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+Z+"'");switch(o.type){case 0:{const t=this._samplers[Z],j=o.object;var s;if(!t||!j._texture||!t.compareSampler(j._texture))this._samplers[Z]=(new h.e).setParameters(j.wrapU,j.wrapV,j.wrapR,j.anisotropicFilteringLevel,j._texture.samplingMode,null===(s=j._texture)||void 0===s?void 0:s._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const s=o.object;s.getBuffer()!==o.buffer&&(o.buffer=s.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((j=>{(0,k.d)((()=>this.dispatch(s,Z,o)),j,void 0,t)}))}serialize(){const s=w.c.Serialize(this);s.options=this._options,s.shaderPath=this._shaderPath,s.WQ={},s.textures={};for(const Z in this._bindings){const o=this._bindings[Z],t=o.object;switch(o.type){case 0:case 4:case 1:{const j=t.serialize();j&&(s.textures[Z]=j,s.WQ[Z]={type:o.type});break}}}return s}static Parse(s,Z,o){const t=w.c.Parse((()=>new y(s.name,Z.getEngine(),s.shaderPath,s.options)),s,Z,o);for(const j in s.textures){const S=s.WQ[j],a=X.c.Parse(s.textures[j],Z,o);0===S.type?t.setTexture(j,a):4===S.type?t.setTexture(j,a,!1):t.setStorageTexture(j,a)}return t}static _BufferIsDataBuffer(s){return void 0!==s.underlyingResource}}(0,e.c)([(0,c.K)()],y.prototype,"name",void 0),(0,e.c)([(0,c.K)()],y.prototype,"fastMode",void 0),(0,O.f)("BABYLON.ComputeShader",y);var I=o(11155);const C="gpuUpdateParticlesComputeShader",K="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";N.d.ShadersStoreWGSL[C]||(N.d.ShadersStoreWGSL[C]=K);(0,O.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(s,Z){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=s,this._engine=Z}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var s;return(null===(s=this._updateComputeShader)||void 0===s?void 0:s.isReady())??!1}createUpdateBuffer(s){var Z;const o={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(o.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(o.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(o.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(o.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(o.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(o.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(o.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:o,defines:s.split("\n")}),null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=new I.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new i(this._simParamsComputeShader)}createVertexBuffers(s,Z){this._renderVertexBuffers.push(Z)}createParticleBuffer(s){const Z=new R(this._engine,4*s.length,11,"ComputeShaderParticleSystemBuffer");return Z.update(s),this._bufferComputeShader.push(Z),Z.getBuffer()}bindDrawBuffers(s,Z,o){this._engine.bindBuffers(this._renderVertexBuffers[s],o,Z)}preUpdateParticleBuffer(){}updateParticleBuffer(s,Z,o){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[s]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^s]),this._updateComputeShader.dispatch(Math.ceil(o/64))}releaseBuffers(){var s;for(let Z=0;Z<this._bufferComputeShader.length;++Z)this._bufferComputeShader[Z].dispose();this._bufferComputeShader.length=0,null===(s=this._simParamsComputeShader)||void 0===s||s.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class p{constructor(s,Z,o){this.gradient=s,this.color1=Z,this.color2=o}getColorToRef(s){this.color2?a.h.LerpToRef(this.color1,this.color2,Math.random(),s):s.O(this.color1)}}class E{constructor(s,Z){this.gradient=s,this.color=Z}}class P{constructor(s,Z,o){this.gradient=s,this.factor1=Z,this.factor2=o}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class r{static GetCurrentGradient(s,Z,o){if(Z[0].gradient>s)return void o(Z[0],Z[0],1);for(let j=0;j<Z.length-1;j++){const t=Z[j],S=Z[j+1];if(s>=t.gradient&&s<=S.gradient){return void o(t,S,(s-t.gradient)/(S.gradient-t.gradient))}}const t=Z.length-1;o(Z[t],Z[t],1)}}var T=o(10932),m=o(11451),n=o(10927);class J{constructor(s){this.particleSystem=s,this.position=t.n.Zero(),this.direction=t.n.Zero(),this.color=new a.h(0,0,0,0),this.colorStep=new a.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new t.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new a.h(0,0,0,0),this._currentColor2=new a.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=J._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let s=this.age,Z=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===Z?(Z=1,s=this._randomCellOffset):s+=this._randomCellOffset);const o=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let t;t=this._initialSpriteCellLoop?(0,G.Clamp)(s*Z%this.lifeTime/this.lifeTime):(0,G.Clamp)(s*Z/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+t*o|0}_inheritParticleInfoToSubEmitter(s){if(s.particleSystem.k.position){const Z=s.particleSystem.k;if(Z.position.O(this.position),s.inheritDirection){const s=t.g.sO[0];this.direction.normalizeToRef(s),Z.setDirection(s,0,Math.PI/2)}}else{s.particleSystem.k.O(this.position)}this.direction.scaleToRef(s.inheritedVelocityAmount/2,t.g.sO[0]),s.particleSystem._inheritedVelocityOffset.O(t.g.sO[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const s of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(s)}_reset(){this.age=0,this.id=J._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(s){s.position.O(this.position),this._initialDirection?s._initialDirection?s._initialDirection.O(this._initialDirection):s._initialDirection=this._initialDirection.clone():s._initialDirection=null,s.direction.O(this.direction),this.qO&&(s.qO?s.qO.O(this.qO):s.qO=this.qO.clone()),s.color.O(this.color),s.colorStep.O(this.colorStep),s.lifeTime=this.lifeTime,s.age=this.age,s._randomCellOffset=this._randomCellOffset,s.size=this.size,s.scale.O(this.scale),s.angle=this.angle,s.angularSpeed=this.angularSpeed,s.particleSystem=this.particleSystem,s.cellIndex=this.cellIndex,s.id=this.id,s._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(s._currentColorGradient=this._currentColorGradient,s._currentColor1.O(this._currentColor1),s._currentColor2.O(this._currentColor2)),this._currentSizeGradient&&(s._currentSizeGradient=this._currentSizeGradient,s._currentSize1=this._currentSize1,s._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(s._currentAngularSpeedGradient=this._currentAngularSpeedGradient,s._currentAngularSpeed1=this._currentAngularSpeed1,s._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(s._currentVelocityGradient=this._currentVelocityGradient,s._currentVelocity1=this._currentVelocity1,s._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(s._currentLimitVelocityGradient=this._currentLimitVelocityGradient,s._currentLimitVelocity1=this._currentLimitVelocity1,s._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(s._currentDragGradient=this._currentDragGradient,s._currentDrag1=this._currentDrag1,s._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(s._initialStartSpriteCellId=this._initialStartSpriteCellId,s._initialEndSpriteCellId=this._initialEndSpriteCellId,s._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(s.remapData&&this.remapData?s.remapData.O(this.remapData):s.remapData=new t.p(0,0,0,0)),this._randomNoiseCoordinates1&&(s._randomNoiseCoordinates1?(s._randomNoiseCoordinates1.O(this._randomNoiseCoordinates1),s._randomNoiseCoordinates2.O(this._randomNoiseCoordinates2)):(s._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),s._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}J._Count=0;var ss=o(11151),Zs=(o(11343),o(11189)),os=o(11181),ts=o(11509);function js(s,Z){const o=(0,G.RandomRange)(0,1);a.h.LerpToRef(Z.color1,Z.color2,o,s.color),Z.colorDead.subtractToRef(s.color,Z._colorDiff),Z._colorDiff.scaleToRef(1/s.lifeTime,s.colorStep)}function Ss(s,Z){s._currentColorGradient=Z._colorGradients[0],s._currentColorGradient.getColorToRef(s.color),s._currentColor1.O(s.color),Z._colorGradients.length>1?Z._colorGradients[1].getColorToRef(s._currentColor2):s._currentColor2.O(s.color)}function as(s,Z){const o=Z._colorGradients;r.GetCurrentGradient(Z._ratio,o,((Z,o,t)=>{Z!==s._currentColorGradient&&(s._currentColor1.O(s._currentColor2),o.getColorToRef(s._currentColor2),s._currentColorGradient=Z),a.h.LerpToRef(s._currentColor1,s._currentColor2,t,s.color)}))}function Os(s,Z){s.colorStep.scaleToRef(Z._scaledUpdateSpeed,Z._scaledColorStep),s.color.addInPlace(Z._scaledColorStep),s.color.a<0&&(s.color.a=0)}function vs(s,Z){r.GetCurrentGradient(Z._ratio,Z._angularSpeedGradients,((Z,o,t)=>{Z!==s._currentAngularSpeedGradient&&(s._currentAngularSpeed1=s._currentAngularSpeed2,s._currentAngularSpeed2=o.getFactor(),s._currentAngularSpeedGradient=Z),s.angularSpeed=(0,G.Lerp)(s._currentAngularSpeed1,s._currentAngularSpeed2,t)}))}function Gs(s,Z){s.angle+=s.angularSpeed*Z._scaledUpdateSpeed}function Bs(s,Z){Z.particleEmitterType.startDirectionFunction(Z._emitterWorldMatrix,s.direction,s,Z.isLocal,Z._emitterInverseWorldMatrix)}function Qs(s,Z){Z.startDirectionFunction(Z._emitterWorldMatrix,s.direction,s,Z.isLocal)}function Ds(s,Z){s._currentVelocityGradient=Z._velocityGradients[0],s._currentVelocity1=s._currentVelocityGradient.getFactor(),Z._velocityGradients.length>1?s._currentVelocity2=Z._velocityGradients[1].getFactor():s._currentVelocity2=s._currentVelocity1}function zs(s,Z){s._currentLimitVelocityGradient=Z._limitVelocityGradients[0],s._currentLimitVelocity1=s._currentLimitVelocityGradient.getFactor(),Z._limitVelocityGradients.length>1?s._currentLimitVelocity2=Z._limitVelocityGradients[1].getFactor():s._currentLimitVelocity2=s._currentLimitVelocity1}function Ys(s,Z){r.GetCurrentGradient(Z._ratio,Z._velocityGradients,((o,t,j)=>{o!==s._currentVelocityGradient&&(s._currentVelocity1=s._currentVelocity2,s._currentVelocity2=t.getFactor(),s._currentVelocityGradient=o),Z._directionScale*=(0,G.Lerp)(s._currentVelocity1,s._currentVelocity2,j)}))}function bs(s,Z){r.GetCurrentGradient(Z._ratio,Z._limitVelocityGradients,((o,t,j)=>{o!==s._currentLimitVelocityGradient&&(s._currentLimitVelocity1=s._currentLimitVelocity2,s._currentLimitVelocity2=t.getFactor(),s._currentLimitVelocityGradient=o);const S=(0,G.Lerp)(s._currentLimitVelocity1,s._currentLimitVelocity2,j);s.direction.length()>S&&s.direction.scaleInPlace(Z.limitVelocityDamping)}))}function fs(s,Z){s.direction.scaleToRef(Z._directionScale,Z._scaledDirection)}function As(s,Z){Z.particleEmitterType.startPositionFunction(Z._emitterWorldMatrix,s.position,s,Z.isLocal)}function ds(s,Z){Z.startPositionFunction(Z._emitterWorldMatrix,s.position,s,Z.isLocal)}function Us(s,Z){s.qO?s.qO.O(s.position):s.qO=s.position.clone(),t.n.TransformCoordinatesToRef(s.qO,Z._emitterWorldMatrix,s.position)}function us(s,Z){Z.isLocal&&s.qO?(s.qO.addInPlace(Z._scaledDirection),t.n.TransformCoordinatesToRef(s.qO,Z._emitterWorldMatrix,s.position)):s.position.addInPlace(Z._scaledDirection)}function Hs(s,Z){s._currentDragGradient=Z._dragGradients[0],s._currentDrag1=s._currentDragGradient.getFactor(),Z._dragGradients.length>1?s._currentDrag2=Z._dragGradients[1].getFactor():s._currentDrag2=s._currentDrag1}function Fs(s,Z){r.GetCurrentGradient(Z._ratio,Z._dragGradients,((o,t,j)=>{o!==s._currentDragGradient&&(s._currentDrag1=s._currentDrag2,s._currentDrag2=t.getFactor(),s._currentDragGradient=o);const S=(0,G.Lerp)(s._currentDrag1,s._currentDrag2,j);Z._scaledDirection.scaleInPlace(1-S)}))}function is(s,Z){s._randomNoiseCoordinates1?(s._randomNoiseCoordinates1.Ja(Math.random(),Math.random(),Math.random()),s._randomNoiseCoordinates2.Ja(Math.random(),Math.random(),Math.random())):(s._randomNoiseCoordinates1=new t.n(Math.random(),Math.random(),Math.random()),s._randomNoiseCoordinates2=new t.n(Math.random(),Math.random(),Math.random()))}function Ns(s,Z){const o=Z._noiseTextureData,j=Z._noiseTextureSize;if(o&&j&&s._randomNoiseCoordinates1){const S=Z._fetchR(s._randomNoiseCoordinates1.x,s._randomNoiseCoordinates1.y,j.width,j.height,o),a=Z._fetchR(s._randomNoiseCoordinates1.z,s._randomNoiseCoordinates2.x,j.width,j.height,o),O=Z._fetchR(s._randomNoiseCoordinates2.y,s._randomNoiseCoordinates2.z,j.width,j.height,o),v=t.g.sO[0],G=t.g.sO[1];v.Ja((2*S-1)*Z.noiseStrength.x,(2*a-1)*Z.noiseStrength.y,(2*O-1)*Z.noiseStrength.z),v.scaleToRef(Z._tempScaledUpdateSpeed,G),s.direction.addInPlace(G)}}function Ls(s,Z){Z.gravity.scaleToRef(Z._tempScaledUpdateSpeed,Z._scaledGravity),s.direction.addInPlace(Z._scaledGravity)}function Vs(s,Z){s.size=(0,G.RandomRange)(Z.minSize,Z.maxSize),s.scale.Ja((0,G.RandomRange)(Z.minScaleX,Z.maxScaleX),(0,G.RandomRange)(Z.minScaleY,Z.maxScaleY))}function gs(s,Z){s._currentSizeGradient=Z._sizeGradients[0],s._currentSize1=s._currentSizeGradient.getFactor(),s.size=s._currentSize1,Z._sizeGradients.length>1?s._currentSize2=Z._sizeGradients[1].getFactor():s._currentSize2=s._currentSize1,s.scale.Ja((0,G.RandomRange)(Z.minScaleX,Z.maxScaleX),(0,G.RandomRange)(Z.minScaleY,Z.maxScaleY))}function ls(s,Z){const o=Z._actualFrame/Z.targetStopDuration;r.GetCurrentGradient(o,Z._startSizeGradients,((o,t,j)=>{o!==Z._currentStartSizeGradient&&(Z._currentStartSize1=Z._currentStartSize2,Z._currentStartSize2=t.getFactor(),Z._currentStartSizeGradient=o);const S=(0,G.Lerp)(Z._currentStartSize1,Z._currentStartSize2,j);s.scale.scaleInPlace(S)}))}function Rs(s,Z){r.GetCurrentGradient(Z._ratio,Z._sizeGradients,((Z,o,t)=>{Z!==s._currentSizeGradient&&(s._currentSize1=s._currentSize2,s._currentSize2=o.getFactor(),s._currentSizeGradient=Z),s.size=(0,G.Lerp)(s._currentSize1,s._currentSize2,t)}))}function es(s,Z){s.remapData=new t.p(0,1,0,1)}function cs(s,Z){Z._colorRemapGradients&&Z._colorRemapGradients.length>0&&r.GetCurrentGradient(Z._ratio,Z._colorRemapGradients,((Z,o,t)=>{const j=(0,G.Lerp)(Z.factor1,o.factor1,t),S=(0,G.Lerp)(Z.factor2,o.factor2,t);s.remapData.x=j,s.remapData.y=S-j})),Z._alphaRemapGradients&&Z._alphaRemapGradients.length>0&&r.GetCurrentGradient(Z._ratio,Z._alphaRemapGradients,((Z,o,t)=>{const j=(0,G.Lerp)(Z.factor1,o.factor1,t),S=(0,G.Lerp)(Z.factor2,o.factor2,t);s.remapData.z=j,s.remapData.w=S-j}))}function ws(s,Z){const o=(0,G.Clamp)(Z._actualFrame/Z.targetStopDuration);r.GetCurrentGradient(o,Z._lifeTimeGradients,((Z,t)=>{const j=Z,S=t,a=j.getFactor(),O=S.getFactor(),v=(o-j.gradient)/(S.gradient-j.gradient);s.lifeTime=(0,G.Lerp)(a,O,v)})),Z._emitPower=(0,G.RandomRange)(Z.minEmitPower,Z.maxEmitPower)}function Xs(s,Z){s.lifeTime=(0,G.RandomRange)(Z.minLifeTime,Z.maxLifeTime),Z._emitPower=(0,G.RandomRange)(Z.minEmitPower,Z.maxEmitPower)}function Ws(s,Z){0===Z._emitPower?(s._initialDirection?s._initialDirection.O(s.direction):s._initialDirection=s.direction.clone(),s.direction.set(0,0,0)):(s._initialDirection=null,s.direction.scaleInPlace(Z._emitPower)),s.direction.addInPlace(Z._inheritedVelocityOffset)}function qs(s,Z){s.angularSpeed=(0,G.RandomRange)(Z.minAngularSpeed,Z.maxAngularSpeed),s.angle=(0,G.RandomRange)(Z.minInitialRotation,Z.maxInitialRotation)}function hs(s,Z){s._currentAngularSpeedGradient=Z._angularSpeedGradients[0],s.angularSpeed=s._currentAngularSpeedGradient.getFactor(),s._currentAngularSpeed1=s.angularSpeed,Z._angularSpeedGradients.length>1?s._currentAngularSpeed2=Z._angularSpeedGradients[1].getFactor():s._currentAngularSpeed2=s._currentAngularSpeed1,s.angle=(0,G.RandomRange)(Z.minInitialRotation,Z.maxInitialRotation)}function Ms(s,Z){s._initialStartSpriteCellId=Z.startSpriteCellID,s._initialEndSpriteCellId=Z.endSpriteCellID,s._initialSpriteCellLoop=Z.spriteCellLoop}function xs(s,Z){s.previousItem=Z.previousItem,s.nextItem=Z,Z.previousItem&&(Z.previousItem.nextItem=s),Z.previousItem=s}function ks(s,Z){s.previousItem=Z,s.nextItem=Z.nextItem,Z.nextItem&&(Z.nextItem.previousItem=s),Z.nextItem=s}function ys(s,Z){let o=Z;for(;o.nextItem;)o=o.nextItem;s.previousItem=o,s.nextItem=o.nextItem,o.nextItem=s}function Is(s){s.previousItem&&(s.previousItem.nextItem=s.nextItem),s.nextItem&&(s.nextItem.previousItem=s.previousItem)}class Cs extends v{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(s){this._startDirectionFunction!==s&&(this._startDirectionFunction=s,this._directionProcessing.process=s?Qs:Bs)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(s){this._startPositionFunction!==s&&(this._startPositionFunction=s,this._positionCreation.process=s?ds:As)}set onDispose(s){this._onDisposeObserver&&this.jO.remove(this._onDisposeObserver),this._onDisposeObserver=this.jO.add(s)}get B(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(s){this._useRampGradients!==s&&(this._useRampGradients=s,this._resetEffect(),s?(this._rampCreation={process:es,previousItem:null,nextItem:null},ks(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:cs,previousItem:null,nextItem:null},ks(this._remapGradientProcessing,this._gravityProcessing)):(Is(this._rampCreation),Is(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(s){this._isLocal!==s&&(this._isLocal=s,s?(this._isLocalCreation={process:Us,previousItem:null,nextItem:null},ks(this._isLocalCreation,this._positionCreation)):Is(this._isLocalCreation))}get particles(){return this.RQ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(s){this._animationSheetEnabled!==s&&(this._animationSheetEnabled=s,s?(this._sheetCreation={process:Ms,previousItem:null,nextItem:null},ks(this._sheetCreation,this._colorCreation)):Is(this._sheetCreation),this._reset())}getActiveCount(){return this.RQ.length}getClassName(){return"NY"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var s;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(s=this._customWrappers[Z])||void 0===s?void 0:s.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[s]??this._customWrappers[0]}setCustomEffect(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Z]=new ss.e(this._engine),this._customWrappers[Z].effect=s,this._customWrappers[Z].drawContext&&(this._customWrappers[Z].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new T.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(s){if(this.noiseTexture!==s){if(this._noiseTexture=s,!s)return Is(this._noiseCreation),void Is(this._noiseProcessing);this._noiseCreation={process:is,previousItem:null,nextItem:null},ks(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Ns,previousItem:null,nextItem:null},ks(this._noiseProcessing,this._positionProcessing)}}constructor(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(s),this._emitterInverseWorldMatrix=t.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new t.n,this.jO=new T.b,this.onStoppedObservable=new T.b,this.onStartedObservable=new T.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.RQ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new a.h(0,0,0,0),this._colorDiff=new a.h(0,0,0,0),this._scaledDirection=t.n.Zero(),this._scaledGravity=t.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=s=>{},this.recycleParticle=s=>{const Z=this.RQ.pop();Z!==s&&Z.copyTo(s),this._stockParticles.push(Z)},this._createParticle=()=>{let s;return 0!==this._stockParticles.length?(s=this._stockParticles.pop(),s._reset()):s=new J(this),this._prepareParticle(s),s},this.paused=!1,this._shadersLoaded=!1,this._capacity=Z,this._epsilon=O,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=t.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||n.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.gQ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Xs,previousItem:null,nextItem:null},this._positionCreation={process:As,previousItem:null,nextItem:null},ks(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Bs,previousItem:null,nextItem:null},ks(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Ws,previousItem:null,nextItem:null},ks(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Vs,previousItem:null,nextItem:null},ks(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:qs,previousItem:null,nextItem:null},ks(this._angleCreation,this._sizeCreation),this._colorCreation={process:js,previousItem:null,nextItem:null},ks(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,v||(this._colorProcessing={process:Os,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Gs,previousItem:null,nextItem:null},ks(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:fs,previousItem:null,nextItem:null},ks(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:us,previousItem:null,nextItem:null},ks(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Ls,previousItem:null,nextItem:null},ks(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=S,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ss.e(this._engine)},this._customWrappers[0].effect=j,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Q,this.updateFunction=s=>{var Z;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(Z=this.noiseTexture.getContent())||void 0===Z||Z.then((s=>{this._noiseTextureData=s})));const o=s===this.RQ;for(let t=0;t<s.length;t++){const Z=s[t];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const j=Z.age;if(Z.age+=this._tempScaledUpdateSpeed,Z.age>Z.lifeTime){const s=Z.age-j,o=Z.lifeTime-j;this._tempScaledUpdateSpeed=o*this._tempScaledUpdateSpeed/s,Z.age=Z.lifeTime}this._ratio=Z.age/Z.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let S=this._updateQueueStart;for(;S;)S.process(Z,this),S=S.nextItem;if(this._isAnimationSheetEnabled&&!v&&Z.updateCellIndex(),Z._inheritParticleInfoToSubEmitters(),Z.age>=Z.lifeTime){if(this._emitFromParticle(Z),Z._attachedSubEmitters){for(const s of Z._attachedSubEmitters)s.particleSystem.disposeOnStop=!0,s.particleSystem.stop();Z._attachedSubEmitters=null}this.recycleParticle(Z),o&&t--}else;}}}serialize(s){throw new Error("Method not implemented.")}clone(s,Z){throw new Error("Method not implemented.")}_addFactorGradient(s,Z,o,t){const j=new P(Z,o,t);s.push(j),s.sort(((s,Z)=>s.gradient<Z.gradient?-1:s.gradient>Z.gradient?1:0))}_removeFactorGradient(s,Z){if(!s)return;let o=0;for(const t of s){if(t.gradient===Z){s.splice(o,1);break}o++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=ws:this._lifeTimeCreation.process=Xs}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ls,previousItem:null,nextItem:null},ks(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Is(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(s){this.targetStopDuration!==s&&(this._targetStopDuration=s,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(s,Z,o){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,s,Z,o),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(s){return this._removeFactorGradient(this._lifeTimeGradients,s),this._syncLifeTimeCreation(),this}addSizeGradient(s,Z,o){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=gs,this._sizeGradientProcessing={process:Rs,previousItem:null,nextItem:null},xs(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,s,Z,o),this}removeSizeGradient(s){var Z;return this._removeFactorGradient(this._sizeGradients,s),0===(null===(Z=this._sizeGradients)||void 0===Z?void 0:Z.length)&&(Is(this._sizeGradientProcessing),this._sizeCreation.process=Vs),this}addColorRemapGradient(s,Z,o){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,s,Z,o),this}removeColorRemapGradient(s){return this._removeFactorGradient(this._colorRemapGradients,s),this}addAlphaRemapGradient(s,Z,o){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,s,Z,o),this}removeAlphaRemapGradient(s){return this._removeFactorGradient(this._alphaRemapGradients,s),this}addAngularSpeedGradient(s,Z,o){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=hs,this._angularSpeedGradientProcessing={process:vs,previousItem:null,nextItem:null},xs(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,s,Z,o),this}removeAngularSpeedGradient(s){var Z;return this._removeFactorGradient(this._angularSpeedGradients,s),0===(null===(Z=this._angularSpeedGradients)||void 0===Z?void 0:Z.length)&&(this._angleCreation.process=qs,Is(this._angularSpeedGradientProcessing)),this}addVelocityGradient(s,Z,o){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Ds,previousItem:null,nextItem:null},ks(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Ys,previousItem:null,nextItem:null},xs(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,s,Z,o),this}removeVelocityGradient(s){var Z;return this._removeFactorGradient(this._velocityGradients,s),0===(null===(Z=this._velocityGradients)||void 0===Z?void 0:Z.length)&&(Is(this._velocityCreation),Is(this._velocityGradientProcessing)),this}addLimitVelocityGradient(s,Z,o){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:zs,previousItem:null,nextItem:null},ks(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:bs,previousItem:null,nextItem:null},ks(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,s,Z,o),this}removeLimitVelocityGradient(s){var Z;return this._removeFactorGradient(this._limitVelocityGradients,s),0===(null===(Z=this._limitVelocityGradients)||void 0===Z?void 0:Z.length)&&(Is(this._limitVelocityCreation),Is(this._limitVelocityGradientProcessing)),this}addDragGradient(s,Z,o){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Hs,previousItem:null,nextItem:null},xs(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Fs,previousItem:null,nextItem:null},xs(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,s,Z,o),this}removeDragGradient(s){var Z;return this._removeFactorGradient(this._dragGradients,s),0===(null===(Z=this._dragGradients)||void 0===Z?void 0:Z.length)&&(Is(this._dragCreation),Is(this._dragGradientProcessing)),this}addEmitRateGradient(s,Z,o){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,s,Z,o),this}removeEmitRateGradient(s){return this._removeFactorGradient(this._emitRateGradients,s),this}addStartSizeGradient(s,Z,o){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,s,Z,o),this._syncStartSizeCreation(),this}removeStartSizeGradient(s){return this._removeFactorGradient(this._startSizeGradients,s),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const s=new Uint8Array(4*this._rawTextureWidth),Z=a.k.pz[0];for(let o=0;o<this._rawTextureWidth;o++){const t=o/this._rawTextureWidth;r.GetCurrentGradient(t,this._rampGradients,((t,j,S)=>{a.d.LerpToRef(t.color,j.color,S,Z),s[4*o]=255*Z.r,s[4*o+1]=255*Z.g,s[4*o+2]=255*Z.b,s[4*o+3]=255}))}this._rampGradientsTexture=m.b.CreateRGBATexture(s,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((s,Z)=>s.gradient<Z.gradient?-1:s.gradient>Z.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(s,Z){this._rampGradients||(this._rampGradients=[]);const o=new E(s,Z);return this._rampGradients.push(o),this._syncRampGradientTexture(),this}removeRampGradient(s){return this._removeGradientAndTexture(s,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(s,Z,o){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ss,this._colorProcessing.process=as);const t=new p(s,Z,o);return this._colorGradients.push(t),this._colorGradients.sort(((s,Z)=>s.gradient<Z.gradient?-1:s.gradient>Z.gradient?1:0)),this}removeColorGradient(s){if(!this._colorGradients)return this;let Z=0;for(const o of this._colorGradients){if(o.gradient===s){this._colorGradients.splice(Z,1);break}Z++}return 0===this._colorGradients.length&&(this._colorCreation.process=js,this._colorProcessing.process=Os),this}resetDrawCache(){if(this._drawWrappers){for(const s of this._drawWrappers)if(s)for(const Z of s)null===Z||void 0===Z||Z.dispose();this._drawWrappers=[]}}_fetchR(s,Z,o,t,j){return j[4*(((s=.5*Math.abs(s)+.5)*o%o|0)+((Z=.5*Math.abs(Z)+.5)*t%t|0)*o)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const s=this._engine,Z=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*Z),this._vertexBuffer=new H.c(s,this._vertexData,!0,Z);let o=0;const t=this._vertexBuffer.createVertexBuffer(H.e.PositionKind,o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[H.e.PositionKind]=t,o+=3;const j=this._vertexBuffer.createVertexBuffer(H.e.ColorKind,o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[H.e.ColorKind]=j,o+=4;const S=this._vertexBuffer.createVertexBuffer("angle",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=S,o+=1;const a=this._vertexBuffer.createVertexBuffer("size",o,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=a,o+=2,this._isAnimationSheetEnabled){const s=this._vertexBuffer.createVertexBuffer("cellIndex",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=s,o+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const s=this._vertexBuffer.createVertexBuffer("direction",o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=s,o+=3}if(this._useRampGradients){const s=this._vertexBuffer.createVertexBuffer("remapData",o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=s,o+=4}let O;if(this._useInstancing){const Z=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new H.c(s,Z,!1,2),O=this._spriteBuffer.createVertexBuffer("offset",0,2)}else O=this._vertexBuffer.createVertexBuffer("offset",o,2,this._vertexBufferSize,this._useInstancing),o+=2;this._vertexBuffers.offset=O,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const s=[],Z=[];let o=0;for(let t=0;t<this._capacity;t++)s.push(o),s.push(o+1),s.push(o+2),s.push(o),s.push(o+2),s.push(o+3),Z.push(o,o+1,o+1,o+2,o+2,o+3,o+3,o,o,o+3),o+=4;this._indexBuffer=this._engine.createIndexBuffer(s),this._linesIndexBuffer=this._engine.createIndexBuffer(Z)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(s)setTimeout((()=>{this.start(0)}),s);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var Z;-1!==(null===(Z=this.k)||void 0===Z?void 0:Z.getClassName().indexOf("Mesh"))&&this.k.Ea(!0);const s=this.noiseTexture;if(s&&s.onGeneratedObservable)s.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),s.render()}))}));else for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(s))}_postStop(s){}reset(){this._stockParticles.length=0,this.RQ.length=0}_appendParticleVertex(s,Z,o,j){let S=s*this._vertexBufferSize;if(this._vertexData[S++]=Z.position.x+this.Ev.x,this._vertexData[S++]=Z.position.y+this.Ev.y,this._vertexData[S++]=Z.position.z+this.Ev.z,this._vertexData[S++]=Z.color.r,this._vertexData[S++]=Z.color.g,this._vertexData[S++]=Z.color.b,this._vertexData[S++]=Z.color.a,this._vertexData[S++]=Z.angle,this._vertexData[S++]=Z.scale.x*Z.size,this._vertexData[S++]=Z.scale.y*Z.size,this._isAnimationSheetEnabled&&(this._vertexData[S++]=Z.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[S++]=Z.direction.x,this._vertexData[S++]=Z.direction.y,this._vertexData[S++]=Z.direction.z);else if(Z._initialDirection){let s=Z._initialDirection;this.isLocal&&(t.n.TransformNormalToRef(s,this._emitterWorldMatrix,t.g.sO[0]),s=t.g.sO[0]),0===s.x&&0===s.z&&(s.x=.001),this._vertexData[S++]=s.x,this._vertexData[S++]=s.y,this._vertexData[S++]=s.z}else{let s=Z.direction;this.isLocal&&(t.n.TransformNormalToRef(s,this._emitterWorldMatrix,t.g.sO[0]),s=t.g.sO[0]),0===s.x&&0===s.z&&(s.x=.001),this._vertexData[S++]=s.x,this._vertexData[S++]=s.y,this._vertexData[S++]=s.z}this._useRampGradients&&Z.remapData&&(this._vertexData[S++]=Z.remapData.x,this._vertexData[S++]=Z.remapData.y,this._vertexData[S++]=Z.remapData.z,this._vertexData[S++]=Z.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===o?o=this._epsilon:1===o&&(o=1-this._epsilon),0===j?j=this._epsilon:1===j&&(j=1-this._epsilon)),this._vertexData[S++]=o,this._vertexData[S++]=j)}_prepareParticle(s){}_createNewOnes(s){let Z;for(let o=0;o<s&&this.RQ.length!==this._capacity;o++){Z=this._createParticle(),this.RQ.push(Z);let s=this._createQueueStart;for(;s;)s.process(Z,this),s=s.nextItem;Z._inheritParticleInfoToSubEmitters()}}_update(s){if(this._alive=this.RQ.length>0,this.k.position){const s=this.k;this._emitterWorldMatrix=s.getWorldMatrix()}else{const s=this.k;this._emitterWorldMatrix=t.b.Translation(s.x,s.y,s.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.RQ),this._createNewOnes(s)}static _GetAttributeNamesOrOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=[H.e.PositionKind,H.e.ColorKind,"angle","offset","size"];return s&&t.push("cellIndex"),Z||t.push("direction"),o&&t.push("remapData"),t}static _GetEffectCreationOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Zs.b)(t),s&&t.push("particlesInfos"),Z&&t.push("logarithmicDepthConstant"),o&&(t.push("vFogInfos"),t.push("vFogColor")),t}fillDefines(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Zs.i)(this,this._scene,s),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&s.push("#define FOG")),this._isAnimationSheetEnabled&&s.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&s.push("#define LOGARITHMICDEPTH"),Z===v.BLENDMODE_MULTIPLY&&s.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&s.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(s.push("#define BILLBOARD"),this.billboardMode){case 2:s.push("#define BILLBOARDY");break;case 8:case 9:s.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&s.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:s.push("#define BILLBOARDMODE_ALL")}o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),s.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(s,Z,o){Z.push(...Cs._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),s.push(...Cs._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ts.e)(s,this._imageProcessingConfigurationDefines),(0,ts.d)(o,this._imageProcessingConfigurationDefines))}_getWrapper(s){const Z=this._getCustomDrawWrapper(s);if(null!==Z&&void 0!==Z&&Z.effect)return Z;const o=[];this.fillDefines(o,s);const t=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let j=this._drawWrappers[t];j||(j=this._drawWrappers[t]=[]);let S=j[s];S||(S=new ss.e(this._engine),S.drawContext&&(S.drawContext.useInstancing=this._useInstancing),j[s]=S);const a=o.join("\n");if(S.defines!==a){const s=[],Z=[],o=[];this.fillUniformsAttributesAndSamplerNames(Z,s,o),S.setEffect(this._engine.createEffect("particles",s,Z,o,a,void 0,void 0,void 0,void 0,this._shaderLanguage),a)}return S}animate(){var s;let Z,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!o&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(o?this.preWarmStepOffset:(null===(s=this._scene)||void 0===s?void 0:s.getAnimationRatio())||1),this.manualEmitCount>-1)Z=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let s=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const Z=this._actualFrame/this.targetStopDuration;r.GetCurrentGradient(Z,this._emitRateGradients,((Z,o,t)=>{Z!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=o.getFactor(),this._currentEmitRateGradient=Z),s=(0,G.Lerp)(this._currentEmitRate1,this._currentEmitRate2,t)}))}Z=s*this._scaledUpdateSpeed|0,this._newPartsExcess+=s*this._scaledUpdateSpeed-Z}if(this._newPartsExcess>1&&(Z+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?Z=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(Z),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!o){let s=0;for(let Z=0;Z<this.RQ.length;Z++){const o=this.RQ[Z];this._appendParticleVertices(s,o),s+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.RQ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(s,Z){this._appendParticleVertex(s++,Z,0,0),this._useInstancing||(this._appendParticleVertex(s++,Z,1,0),this._appendParticleVertex(s++,Z,1,1),this._appendParticleVertex(s++,Z,0,1))}rebuild(){var s;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(s=this._spriteBuffer)||void 0===s||s._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Cs.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(o.bind(o,12548)),Promise.resolve().then(o.bind(o,12484))])):await Promise.all([Promise.resolve().then(o.bind(o,12468)),Promise.resolve().then(o.bind(o,12458))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==v.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(v.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(v.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(s){const Z=this._getWrapper(s),o=Z.effect,j=this._engine;j.enableEffect(Z);const S=this.defaultViewMatrix??this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",S),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const s=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,this.spriteCellWidth/s.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const s=this._scene.activeCamera;o.setVector3("eyePosition",s.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));const a=o.defines;var O,v,G,B,Q,D;(this._scene&&((0,Zs.f)(o,this,this._scene),this.applyFog&&(0,os.e)(this._scene,void 0,o)),a.indexOf("#define BILLBOARDMODE_ALL")>=0&&(S.invertToRef(t.g.Matrix[0]),o.setMatrix("invView",t.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?j.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,o):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?j.bindBuffers(this._vertexBuffers,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBuffer:this._indexBuffer,o):j.bindBuffers(this._vertexBuffers,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null,o);(this.useLogarithmicDepth&&this._scene&&(0,os.h)(a,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(s),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?j.drawElementsType(6,0,10,this.RQ.length):j.drawArraysType(7,0,4,this.RQ.length):null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?j.drawElementsType(1,0,10*this.RQ.length):j.drawElementsType(0,0,6*this.RQ.length);return this.RQ.length}render(){if(!this.isReady()||!this.RQ.length)return 0;const s=this._engine;s.setState&&(s.setState(!1),this.forceDepthWrite&&s.setDepthWrite(!0));let Z=0;return Z=this.blendMode===v.BLENDMODE_MULTIPLYADD?this._render(v.BLENDMODE_MULTIPLY)+this._render(v.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),Z}_onDispose(){}dispose(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),s&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),s&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(Z,o),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const s=this._scene.gQ.indexOf(this);s>-1&&this._scene.gQ.splice(s,1),this._scene._activeParticleSystems.dispose()}this.jO.notifyObservers(this),this.jO.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Cs.ForceGLSL=!1;var Ks,ps=o(10975);!function(s){s[s.ATTACHED=0]="ATTACHED",s[s.END=1]="END"}(Ks||(Ks={}));class Es{constructor(s){if(this.particleSystem=s,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!s.k||!s.k.dispose){const Z=(0,O.e)("BABYLON.AbstractMesh");s.k=new Z("SubemitterSystemEmitter",s.Ls()),s._disposeEmitterOnDispose=!0}}clone(){let s=this.particleSystem.k;if(s){if(s instanceof t.n)s=s.clone();else if(-1!==s.getClassName().indexOf("Mesh")){s=new((0,O.e)("BABYLON.Mesh"))("",s.Ls()),s.isVisible=!1}}else s=new t.n;const Z=new Es(this.particleSystem.clone(this.particleSystem.name,s));return Z.particleSystem.name+="Clone",Z.type=this.type,Z.inheritDirection=this.inheritDirection,Z.inheritedVelocityAmount=this.inheritedVelocityAmount,Z.particleSystem._disposeEmitterOnDispose=!0,Z.particleSystem.disposeOnStop=!0,Z}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};return Z.type=this.type,Z.inheritDirection=this.inheritDirection,Z.inheritedVelocityAmount=this.inheritedVelocityAmount,Z.particleSystem=this.particleSystem.serialize(s),Z}static _ParseParticleSystem(s,Z,o){throw(0,ps.d)("ParseParticle")}static Parse(s,Z,o){const t=s.particleSystem,j=new Es(Es._ParseParticleSystem(t,Z,o,!0));return j.type=s.type,j.inheritDirection=s.inheritDirection,j.inheritedVelocityAmount=s.inheritedVelocityAmount,j.particleSystem._isSubEmitter=!0,j}dispose(){this.particleSystem.dispose()}}var Ps=o(11013);function rs(s,Z){const o=new A;return o.direction1=s,o.direction2=Z,o}function Ts(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ms(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ns(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.n(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0);return new U(s,Z,o)}function Js(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function sZ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0),S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.n(0,1,0);return new b(s,Z,o,j,S)}function ZZ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new D(s,Z)}function oZ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0),j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0);return new z(s,Z,o,j)}const tZ=t.n.Zero(),jZ=t.n.Zero(),SZ=t.n.Zero();class aZ{constructor(){this.strength=0,this.position=t.n.Zero()}_processParticle(s,Z){this.position.subtractToRef(s.position,tZ);const o=tZ.lengthSquared()+1;tZ.normalize().scaleToRef(this.strength/o,jZ),jZ.scaleToRef(Z._tempScaledUpdateSpeed,SZ),s.direction.addInPlace(SZ)}serialize(){return{position:this.position.ma(),strength:this.strength}}}class OZ extends Cs{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=s=>{if(!this._subEmitters||0===this._subEmitters.length)return;const Z=Math.floor(Math.random()*this._subEmitters.length);for(const o of this._subEmitters[Z])if(1===o.type){const Z=o.clone();s._inheritParticleInfoToSubEmitter(Z),Z.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(Z.particleSystem),Z.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(s,Z){const o=rs(s,Z);return this.particleEmitterType=o,o}get flowMap(){return this._flowMap}set flowMap(s){this._flowMap!==s&&(this._flowMap=s,this._flowMapUpdate&&(Is(this._flowMapUpdate),this._flowMapUpdate=null),s&&(this._flowMapUpdate={process:s=>{var Z;const o=null===(Z=this.Ls())||void 0===Z?void 0:Z.getTransformMatrix();this._flowMap._processParticle(s,this.flowMapStrength*this._tempScaledUpdateSpeed,o)},previousItem:null,nextItem:null},ks(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(s){this._attractors.push(s),1===this._attractors.length&&(this._attractorUpdate={process:s=>{for(const Z of this._attractors)Z._processParticle(s,this)},previousItem:null,nextItem:null},ks(this._attractorUpdate,this._directionProcessing))}removeAttractor(s){const Z=this._attractors.indexOf(s);-1!==Z&&this._attractors.splice(Z,1),0===this._attractors.length&&Is(this._attractorUpdate)}start(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(s)}createHemisphericEmitter(){const s=Ts(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createSphereEmitter(){const s=ms(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createDirectedSphereEmitter(){const s=ns(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0));return this.particleEmitterType=s,s}createCylinderEmitter(){const s=Js(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=s,s}createDirectedCylinderEmitter(){const s=sZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.n(0,1,0));return this.particleEmitterType=s,s}createConeEmitter(){const s=ZZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=s,s}createDirectedConeEmitter(){const s=oZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0));return this.particleEmitterType=s,s}createBoxEmitter(s,Z,o,t){const j=new Q;return this.particleEmitterType=j,this.direction1=s,this.direction2=Z,this.minEmitBox=o,this.maxEmitBox=t,j}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const s of this.subEmitters)s instanceof OZ?this._subEmitters.push([new Es(s)]):s instanceof Es?this._subEmitters.push([s]):s instanceof Array&&this._subEmitters.push(s)}_stopSubEmitters(){if(this.activeSubSystems){for(const s of this.activeSubSystems)s.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const s=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==s&&this._rootParticleSystem.activeSubSystems.splice(s,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(s){s&&this._stopSubEmitters()}_prepareParticle(s){if(this._subEmitters&&this._subEmitters.length>0){const Z=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];s._attachedSubEmitters=[];for(const o of Z)if(0===o.type){const Z=o.clone();s._attachedSubEmitters.push(Z),Z.particleSystem.start()}}}_onDispose(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),s&&this.particles)for(const o of this.particles)if(o._attachedSubEmitters)for(let s=o._attachedSubEmitters.length-1;s>=0;s-=1)o._attachedSubEmitters[s].dispose();if(Z&&this.activeSubSystems)for(let o=this.activeSubSystems.length-1;o>=0;o-=1)this.activeSubSystems[o].dispose();if(this._subEmitters&&this._subEmitters.length){for(let s=0;s<this._subEmitters.length;s++)for(const Z of this._subEmitters[s])Z.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(s,Z,o,j){let S;S=o instanceof Ps.e?null:o;const v=(0,O.e)("BABYLON.Texture");if(v&&S&&(s.texture?Z.particleTexture=v.Parse(s.texture,S,j):s.textureName&&(Z.particleTexture=new v(j+s.textureName,S,!1,void 0===s.invertY||s.invertY),Z.particleTexture.name=s.textureName)),s.emitterId||0===s.emitterId||void 0!==s.k?s.emitterId&&S?Z.k=S.getLastMeshById(s.emitterId):Z.k=t.n.oO(s.k):Z.k=t.n.Zero(),Z.isLocal=!!s.isLocal,void 0!==s.renderingGroupId&&(Z.renderingGroupId=s.renderingGroupId),void 0!==s.isBillboardBased&&(Z.isBillboardBased=s.isBillboardBased),void 0!==s.billboardMode&&(Z.billboardMode=s.billboardMode),void 0!==s.useLogarithmicDepth&&(Z.useLogarithmicDepth=s.useLogarithmicDepth),s.animations){for(let o=0;o<s.animations.length;o++){const t=s.animations[o],j=(0,O.e)("BABYLON.Animation");j&&Z.animations.push(j.Parse(t))}Z.beginAnimationOnStart=s.beginAnimationOnStart,Z.beginAnimationFrom=s.beginAnimationFrom,Z.beginAnimationTo=s.beginAnimationTo,Z.beginAnimationLoop=s.beginAnimationLoop}if(s.autoAnimate&&S&&S.beginAnimation(Z,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),Z.startDelay=0|s.startDelay,Z.minAngularSpeed=s.minAngularSpeed,Z.maxAngularSpeed=s.maxAngularSpeed,Z.minSize=s.minSize,Z.maxSize=s.maxSize,s.minScaleX&&(Z.minScaleX=s.minScaleX,Z.maxScaleX=s.maxScaleX,Z.minScaleY=s.minScaleY,Z.maxScaleY=s.maxScaleY),void 0!==s.preWarmCycles&&(Z.preWarmCycles=s.preWarmCycles,Z.preWarmStepOffset=s.preWarmStepOffset),void 0!==s.minInitialRotation&&(Z.minInitialRotation=s.minInitialRotation,Z.maxInitialRotation=s.maxInitialRotation),Z.minLifeTime=s.minLifeTime,Z.maxLifeTime=s.maxLifeTime,Z.minEmitPower=s.minEmitPower,Z.maxEmitPower=s.maxEmitPower,Z.emitRate=s.emitRate,Z.gravity=t.n.oO(s.gravity),s.noiseStrength&&(Z.noiseStrength=t.n.oO(s.noiseStrength)),Z.color1=a.h.oO(s.color1),Z.color2=a.h.oO(s.color2),Z.colorDead=a.h.oO(s.colorDead),Z.updateSpeed=s.updateSpeed,Z.targetStopDuration=s.targetStopDuration,Z.blendMode=s.blendMode,s.colorGradients)for(const t of s.colorGradients)Z.addColorGradient(t.gradient,a.h.oO(t.color1),t.color2?a.h.oO(t.color2):void 0);if(s.rampGradients){for(const o of s.rampGradients)Z.addRampGradient(o.gradient,a.d.oO(o.color));Z.useRampGradients=s.useRampGradients}if(s.colorRemapGradients)for(const t of s.colorRemapGradients)Z.addColorRemapGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.alphaRemapGradients)for(const t of s.alphaRemapGradients)Z.addAlphaRemapGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.sizeGradients)for(const t of s.sizeGradients)Z.addSizeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.angularSpeedGradients)for(const t of s.angularSpeedGradients)Z.addAngularSpeedGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.velocityGradients)for(const t of s.velocityGradients)Z.addVelocityGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.dragGradients)for(const t of s.dragGradients)Z.addDragGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.emitRateGradients)for(const t of s.emitRateGradients)Z.addEmitRateGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.startSizeGradients)for(const t of s.startSizeGradients)Z.addStartSizeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.lifeTimeGradients)for(const t of s.lifeTimeGradients)Z.addLifeTimeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(s.limitVelocityGradients){for(const o of s.limitVelocityGradients)Z.addLimitVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);Z.limitVelocityDamping=s.limitVelocityDamping}if(s.noiseTexture&&S){const o=(0,O.e)("BABYLON.ProceduralTexture");Z.noiseTexture=o.Parse(s.noiseTexture,S,j)}let G;if(s.particleEmitterType){switch(s.particleEmitterType.type){case"SphereParticleEmitter":G=new d;break;case"SphereDirectedParticleEmitter":G=new U;break;case"ConeEmitter":case"ConeParticleEmitter":G=new D;break;case"ConeDirectedParticleEmitter":G=new z;break;case"CylinderParticleEmitter":G=new Y;break;case"CylinderDirectedParticleEmitter":G=new b;break;case"HemisphericParticleEmitter":G=new f;break;case"PointParticleEmitter":G=new A;break;case"MeshParticleEmitter":G=new F;break;case"CustomParticleEmitter":G=new u;break;default:G=new Q}G.parse(s.particleEmitterType,S)}else G=new Q,G.parse(s,S);Z.particleEmitterType=G,Z.startSpriteCellID=s.startSpriteCellID,Z.endSpriteCellID=s.endSpriteCellID,Z.spriteCellLoop=s.spriteCellLoop??!0,Z.spriteCellWidth=s.spriteCellWidth,Z.spriteCellHeight=s.spriteCellHeight,Z.spriteCellChangeSpeed=s.spriteCellChangeSpeed,Z.spriteRandomStartCell=s.spriteRandomStartCell,Z.disposeOnStop=s.disposeOnStop??!1,Z.manualEmitCount=s.manualEmitCount??-1}static Parse(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0;const O=s.name;let v,G,B=null,Q=null;if(Z instanceof Ps.e?v=Z:(G=Z,v=G.getEngine()),s.customShader&&v.createEffectForParticles){Q=s.customShader;const Z=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";B=v.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,Z)}const D=new OZ(O,S||s.eZ,Z,B,s.isAnimationSheetEnabled);if(D.customShader=Q,D._rootUrl=o,s.id&&(D.id=s.id),s.subEmitters){D.subEmitters=[];for(const t of s.subEmitters){const s=[];for(const j of t)s.push(Es.Parse(j,Z,o));D.subEmitters.push(s)}}if(s.attractors)for(const a of s.attractors){const s=new aZ;s.position=t.n.oO(a.position),s.strength=a.strength,D.addAttractor(s)}return OZ._Parse(s,D,Z,o),s.textureMask&&(D.textureMask=a.h.oO(s.textureMask)),s.Ev&&(D.Ev=t.n.oO(s.Ev)),s.preventAutoStart&&(D.preventAutoStart=s.preventAutoStart),j||D.preventAutoStart||D.start(),D}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};if(OZ._Serialize(Z,this,s),Z.textureMask=this.textureMask.ma(),Z.customShader=this.customShader,Z.preventAutoStart=this.preventAutoStart,Z.Ev=this.Ev.ma(),this.subEmitters){Z.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const o of this._subEmitters){const t=[];for(const Z of o)t.push(Z.serialize(s));Z.subEmitters.push(t)}}if(this._attractors&&this._attractors.length){Z.attractors=[];for(const s of this._attractors)Z.attractors.push(s.serialize())}return Z}static _Serialize(s,Z,o){if(s.name=Z.name,s.id=Z.id,s.eZ=Z.getCapacity(),s.disposeOnStop=Z.disposeOnStop,s.manualEmitCount=Z.manualEmitCount,Z.k.position){const o=Z.k;s.emitterId=o.id}else{const o=Z.k;s.k=o.ma()}Z.particleEmitterType&&(s.particleEmitterType=Z.particleEmitterType.serialize()),Z.particleTexture&&(o?s.texture=Z.particleTexture.serialize():(s.textureName=Z.particleTexture.name,s.invertY=!!Z.particleTexture._invertY)),s.isLocal=Z.isLocal,w.c.AppendSerializedAnimations(Z,s),s.beginAnimationOnStart=Z.beginAnimationOnStart,s.beginAnimationFrom=Z.beginAnimationFrom,s.beginAnimationTo=Z.beginAnimationTo,s.beginAnimationLoop=Z.beginAnimationLoop,s.startDelay=Z.startDelay,s.renderingGroupId=Z.renderingGroupId,s.isBillboardBased=Z.isBillboardBased,s.billboardMode=Z.billboardMode,s.minAngularSpeed=Z.minAngularSpeed,s.maxAngularSpeed=Z.maxAngularSpeed,s.minSize=Z.minSize,s.maxSize=Z.maxSize,s.minScaleX=Z.minScaleX,s.maxScaleX=Z.maxScaleX,s.minScaleY=Z.minScaleY,s.maxScaleY=Z.maxScaleY,s.minEmitPower=Z.minEmitPower,s.maxEmitPower=Z.maxEmitPower,s.minLifeTime=Z.minLifeTime,s.maxLifeTime=Z.maxLifeTime,s.emitRate=Z.emitRate,s.gravity=Z.gravity.ma(),s.noiseStrength=Z.noiseStrength.ma(),s.color1=Z.color1.ma(),s.color2=Z.color2.ma(),s.colorDead=Z.colorDead.ma(),s.updateSpeed=Z.updateSpeed,s.targetStopDuration=Z.targetStopDuration,s.blendMode=Z.blendMode,s.preWarmCycles=Z.preWarmCycles,s.preWarmStepOffset=Z.preWarmStepOffset,s.minInitialRotation=Z.minInitialRotation,s.maxInitialRotation=Z.maxInitialRotation,s.startSpriteCellID=Z.startSpriteCellID,s.spriteCellLoop=Z.spriteCellLoop,s.endSpriteCellID=Z.endSpriteCellID,s.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,s.spriteCellWidth=Z.spriteCellWidth,s.spriteCellHeight=Z.spriteCellHeight,s.spriteRandomStartCell=Z.spriteRandomStartCell,s.isAnimationSheetEnabled=Z.isAnimationSheetEnabled,s.useLogarithmicDepth=Z.useLogarithmicDepth;const t=Z.getColorGradients();if(t){s.colorGradients=[];for(const Z of t){const o={gradient:Z.gradient,color1:Z.color1.ma()};Z.color2?o.color2=Z.color2.ma():o.color2=Z.color1.ma(),s.colorGradients.push(o)}}const j=Z.getRampGradients();if(j){s.rampGradients=[];for(const Z of j){const o={gradient:Z.gradient,color:Z.color.ma()};s.rampGradients.push(o)}s.useRampGradients=Z.useRampGradients}const S=Z.getColorRemapGradients();if(S){s.colorRemapGradients=[];for(const Z of S){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.colorRemapGradients.push(o)}}const a=Z.getAlphaRemapGradients();if(a){s.alphaRemapGradients=[];for(const Z of a){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.alphaRemapGradients.push(o)}}const O=Z.getSizeGradients();if(O){s.sizeGradients=[];for(const Z of O){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.sizeGradients.push(o)}}const v=Z.getAngularSpeedGradients();if(v){s.angularSpeedGradients=[];for(const Z of v){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.angularSpeedGradients.push(o)}}const G=Z.getVelocityGradients();if(G){s.velocityGradients=[];for(const Z of G){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.velocityGradients.push(o)}}const B=Z.getDragGradients();if(B){s.dragGradients=[];for(const Z of B){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.dragGradients.push(o)}}const Q=Z.getEmitRateGradients();if(Q){s.emitRateGradients=[];for(const Z of Q){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.emitRateGradients.push(o)}}const D=Z.getStartSizeGradients();if(D){s.startSizeGradients=[];for(const Z of D){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.startSizeGradients.push(o)}}const z=Z.getLifeTimeGradients();if(z){s.lifeTimeGradients=[];for(const Z of z){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.lifeTimeGradients.push(o)}}const Y=Z.getLimitVelocityGradients();if(Y){s.limitVelocityGradients=[];for(const Z of Y){const o={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?o.factor2=Z.factor2:o.factor2=Z.factor1,s.limitVelocityGradients.push(o)}s.limitVelocityDamping=Z.limitVelocityDamping}Z.noiseTexture&&(s.noiseTexture=Z.noiseTexture.serialize())}clone(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t={...this._customWrappers};let j=null;const S=this._engine;if(S.createEffectForParticles&&null!=this.customShader){j=this.customShader;const s=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"",Z=S.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,s);t[0]?t[0].effect=Z:this.setCustomEffect(Z,0)}const a=this.serialize(o),O=OZ.Parse(a,this._scene||this._engine,this._rootUrl);return O.name=s,O.customShader=j,O._customWrappers=t,void 0===Z&&(Z=this.k),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.k=Z,this.preventAutoStart||O.start(),O}}OZ.BILLBOARDMODE_Y=2,OZ.BILLBOARDMODE_ALL=7,OZ.BILLBOARDMODE_STRETCHED=8,OZ.BILLBOARDMODE_STRETCHED_LOCAL=9,Es._ParseParticleSystem=OZ.Parse;var vZ=o(11502),GZ=o(11493),BZ=o(11304);BZ.d.prototype.createTransformFeedback=function(){const s=this._gl.createTransformFeedback();if(!s)throw new Error("Unable to create Transform Feedback");return s},BZ.d.prototype.deleteTransformFeedback=function(s){this._gl.deleteTransformFeedback(s)},BZ.d.prototype.bindTransformFeedback=function(s){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,s)},BZ.d.prototype.beginTransformFeedback=function(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(s?this._gl.POINTS:this._gl.TRIANGLES)},BZ.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},BZ.d.prototype.setTranformFeedbackVaryings=function(s,Z){this._gl.transformFeedbackVaryings(s,Z,this._gl.INTERLEAVED_ATTRIBS)},BZ.d.prototype.bindTransformFeedbackBuffer=function(s){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,s?s.underlyingResource:null)},BZ.d.prototype.readTransformFeedbackBuffer=function(s){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,s)};const QZ="clipPlaneFragmentDeclaration2",DZ="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";N.d.IncludesShadersStore[QZ]||(N.d.IncludesShadersStore[QZ]=DZ);o(12372),o(12376),o(12378),o(12381),o(12385),o(12389),o(12392),o(12401);const zZ="gpuRenderParticlesPixelShader",YZ="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";N.d.ShadersStore[zZ]||(N.d.ShadersStore[zZ]=YZ);const bZ="clipPlaneVertexDeclaration2",fZ="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";N.d.IncludesShadersStore[bZ]||(N.d.IncludesShadersStore[bZ]=fZ);o(12407),o(12410),o(12418),o(12427);const AZ="gpuRenderParticlesVertexShader",dZ="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";N.d.ShadersStore[AZ]||(N.d.ShadersStore[AZ]=dZ);class UZ extends v{static get IsSupported(){if(!n.c.LastCreatedEngine)return!1;const s=n.c.LastCreatedEngine.getCaps();return s.supportTransformFeedbacks||s.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(s){this._maxActiveParticleCount=Math.min(s,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(s){this.maxActiveParticleCount=s}createPointEmitter(s,Z){const o=rs(s,Z);return this.particleEmitterType=o,o}createHemisphericEmitter(){const s=Ts(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createSphereEmitter(){const s=ms(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createDirectedSphereEmitter(){const s=ns(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0));return this.particleEmitterType=s,s}createCylinderEmitter(){const s=Js(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=s,s}createDirectedCylinderEmitter(){const s=sZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.n(0,1,0));return this.particleEmitterType=s,s}createConeEmitter(){const s=ZZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=s,s}createDirectedConeEmitter(){const s=oZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.n(0,1,0));return this.particleEmitterType=s,s}createBoxEmitter(s,Z,o,t){const j=new Q;return this.particleEmitterType=j,this.direction1=s,this.direction2=Z,this.minEmitBox=o,this.maxEmitBox=t,j}get flowMap(){return this._flowMap}set flowMap(s){this._flowMap!==s&&(this._flowMap=s)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==OZ.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(OZ.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(OZ.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";s?setTimeout((()=>{this.start(0)}),s):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var s;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(s=this._customWrappers[Z])||void 0===s?void 0:s.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[s]??this._customWrappers[0]}setCustomEffect(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Z]=new ss.e(this._engine),this._customWrappers[Z].effect=s}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new T.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(s,Z,o){return super._removeGradientAndTexture(s,Z,o),this._releaseBuffers(),this}addColorGradient(s,Z){this._colorGradients||(this._colorGradients=[]);const o=new p(s,Z);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(s&&this._colorGradients.sort(((s,Z)=>s.gradient<Z.gradient?-1:s.gradient>Z.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(s){return this._removeGradientAndTexture(s,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const Z in this._drawWrappers){var s;null===(s=this._drawWrappers[Z].drawContext)||void 0===s||s.reset()}}_addFactorGradient(s,Z,o){const t=new P(Z,o);s.push(t),this._releaseBuffers()}addSizeGradient(s,Z){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,s,Z),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(s){return this._removeGradientAndTexture(s,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(s,Z){if(!s)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&s.sort(((s,Z)=>s.gradient<Z.gradient?-1:s.gradient>Z.gradient?1:0));const o=this;o[Z]&&(o[Z].dispose(),o[Z]=null)}addAngularSpeedGradient(s,Z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,s,Z),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(s){return this._removeGradientAndTexture(s,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(s,Z){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,s,Z),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(s){return this._removeGradientAndTexture(s,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(s,Z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,s,Z),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(s){return this._removeGradientAndTexture(s,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(s,Z){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,s,Z),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(s){return this._removeGradientAndTexture(s,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(s){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(s),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.jO=new T.b,this.onStoppedObservable=new T.b,this.onStartedObservable=new T.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=t.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||n.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.gQ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,O.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,O.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ss.e(this._engine)},this._customWrappers[0].effect=j,this._drawWrappers={0:new ss.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(Z=Z??{}).randomTextureSize||delete Z.randomTextureSize;const a={eZ:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...Z},v=Z;isFinite(v)&&(a.eZ=v),this._capacity=a.eZ,this._maxActiveParticleCount=a.eZ,this._currentActiveCount=0,this._isAnimationSheetEnabled=S,this.particleEmitterType=new Q;const G=Math.min(this._engine.getCaps().maxTextureSize,a.randomTextureSize);let B=[];for(let t=0;t<G;++t)B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random());this._randomTexture=new m.b(new Float32Array(B),G,1,5,o,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,B=[];for(let t=0;t<G;++t)B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random());this._randomTexture2=new m.b(new Float32Array(B),G,1,5,o,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=G}_reset(){this._releaseBuffers()}_createVertexBuffers(s,Z,o){const t={};t.position=Z.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let j=3;t.age=Z.createVertexBuffer("age",j,1,this._attributesStrideSize,!0),j+=1,t.size=Z.createVertexBuffer("size",j,3,this._attributesStrideSize,!0),j+=3,t.life=Z.createVertexBuffer("life",j,1,this._attributesStrideSize,!0),j+=1,j+=4,this.billboardMode===OZ.BILLBOARDMODE_STRETCHED&&(t.direction=Z.createVertexBuffer("direction",j,3,this._attributesStrideSize,!0)),j+=3,this._platform.alignDataInBuffer&&(j+=1),this.particleEmitterType instanceof u&&(j+=3,this._platform.alignDataInBuffer&&(j+=1)),this._colorGradientsTexture||(t.color=Z.createVertexBuffer("color",j,4,this._attributesStrideSize,!0),j+=4),this._isBillboardBased||(t.initialDirection=Z.createVertexBuffer("initialDirection",j,3,this._attributesStrideSize,!0),j+=3,this._platform.alignDataInBuffer&&(j+=1)),this.noiseTexture&&(t.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",j,3,this._attributesStrideSize,!0),j+=3,this._platform.alignDataInBuffer&&(j+=1),t.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",j,3,this._attributesStrideSize,!0),j+=3,this._platform.alignDataInBuffer&&(j+=1)),t.angle=Z.createVertexBuffer("angle",j,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?j++:j+=2,this._isAnimationSheetEnabled&&(t.cellIndex=Z.createVertexBuffer("cellIndex",j,1,this._attributesStrideSize,!0),j+=1,this.spriteRandomStartCell&&(t.cellStartOffset=Z.createVertexBuffer("cellStartOffset",j,1,this._attributesStrideSize,!0),j+=1)),t.offset=o.createVertexBuffer("offset",0,2),t.uv=o.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(t),this._platform.createVertexBuffers(s,t),this.resetDrawCache()}_initialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!s)return;const Z=this._engine,o=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof u&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const j=this.particleEmitterType instanceof u,S=t.g.sO[0];let a=0;for(let t=0;t<this._capacity;t++)if(o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),j?(this.particleEmitterType.particleDestinationGenerator(t,null,S),o.push(S.x),o.push(S.y),o.push(S.z)):(o.push(0),o.push(0),o.push(0)),this._platform.alignDataInBuffer&&o.push(0),a+=16,j&&(this.particleEmitterType.particlePositionGenerator(t,null,S),o.push(S.x),o.push(S.y),o.push(S.z),this._platform.alignDataInBuffer&&o.push(0),a+=4),this._colorGradientsTexture||(o.push(0),o.push(0),o.push(0),o.push(0),a+=4),this.isBillboardBased||(o.push(0),o.push(0),o.push(0),this._platform.alignDataInBuffer&&o.push(0),a+=4),this.noiseTexture&&(o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),a+=8),o.push(0),a+=1,this._angularSpeedGradientsTexture||(o.push(0),a+=1),this._isAnimationSheetEnabled&&(o.push(0),a+=1,this.spriteRandomStartCell&&(o.push(0),a+=1)),this._platform.alignDataInBuffer){let s=3-(a+3&3);for(a+=s;s-- >0;)o.push(0)}const O=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),v=this._platform.createParticleBuffer(o),G=this._platform.createParticleBuffer(o);this._buffer0=new H.c(Z,v,!1,this._attributesStrideSize),this._buffer1=new H.c(Z,G,!1,this._attributesStrideSize),this._spriteBuffer=new H.c(Z,O,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let s=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(s+="\n#define BILLBOARD"),this._colorGradientsTexture&&(s+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(s+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(s+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(s+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(s+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(s+="\n#define DRAGGRADIENTS"),this._flowMap&&(s+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(s+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(s+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(s+="\n#define NOISE"),this.isLocal&&(s+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===s||(this._cachedUpdateDefines=s,this._updateBuffer=this._platform.createUpdateBuffer(s)),this._platform.isUpdateBufferReady()}_getWrapper(s){const Z=this._getCustomDrawWrapper(s);if(null!==Z&&void 0!==Z&&Z.effect)return Z;const o=[];this.fillDefines(o,s);let t=this._drawWrappers[s];t||(t=new ss.e(this._engine),t.drawContext&&(t.drawContext.useInstancing=!0),this._drawWrappers[s]=t);const j=o.join("\n");if(t.defines!==j){const s=[],Z=[],o=[];this.fillUniformsAttributesAndSamplerNames(Z,s,o),t.setEffect(this._engine.createEffect("gpuRenderParticles",s,Z,o,j),j)}return t}static _GetAttributeNamesOrOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=[H.e.PositionKind,"age","life","size","angle"];return s||j.push(H.e.ColorKind),Z&&j.push("cellIndex"),o||j.push("initialDirection"),t&&j.push("direction"),j.push("offset",H.e.UVKind),j}static _GetEffectCreationOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=["emitterWM","Ev","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Zs.b)(t),s&&t.push("sheetInfos"),Z&&t.push("logarithmicDepthConstant"),o&&(t.push("vFogInfos"),t.push("vFogColor")),t}fillDefines(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Zs.i)(this,this._scene,s),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==GZ.c.FOGMODE_NONE&&s.push("#define FOG")),Z===OZ.BLENDMODE_MULTIPLY&&s.push("#define BLENDMULTIPLYMODE"),this.isLocal&&s.push("#define LOCAL"),this.useLogarithmicDepth&&s.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(s.push("#define BILLBOARD"),this.billboardMode){case OZ.BILLBOARDMODE_Y:s.push("#define BILLBOARDY");break;case OZ.BILLBOARDMODE_STRETCHED:s.push("#define BILLBOARDSTRETCHED");break;case OZ.BILLBOARDMODE_ALL:s.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&s.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&s.push("#define ANIMATESHEET"),o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),s.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(s,Z,o){Z.push(...UZ._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===OZ.BILLBOARDMODE_STRETCHED)),s.push(...UZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(vZ.c.PrepareUniforms(s,this._imageProcessingConfigurationDefines),vZ.c.PrepareSamplers(o,this._imageProcessingConfigurationDefines))}animate(){var s;let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(s=this._scene)||void 0===s?void 0:s.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(s,Z){const o=this[Z];if(!s||!s.length||o)return;const t=new Float32Array(this._rawTextureWidth);for(let j=0;j<this._rawTextureWidth;j++){const Z=j/this._rawTextureWidth;r.GetCurrentGradient(Z,s,((s,Z,o)=>{t[j]=(0,G.Lerp)(s.factor1,Z.factor1,o)}))}this[Z]=m.b.CreateRTexture(t,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[Z].name=Z.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const s=new Uint8Array(4*this._rawTextureWidth),Z=a.k.nz[0];for(let o=0;o<this._rawTextureWidth;o++){const t=o/this._rawTextureWidth;r.GetCurrentGradient(t,this._colorGradients,((t,j,S)=>{a.h.LerpToRef(t.color1,j.color1,S,Z),s[4*o]=255*Z.r,s[4*o+1]=255*Z.g,s[4*o+2]=255*Z.b,s[4*o+3]=255*Z.a}))}this._colorGradientsTexture=m.b.CreateRGBATexture(s,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(s,Z){var o,j,S,a;const O=this._getWrapper(s),v=O.effect;this._engine.enableEffect(O);const G=(null===(o=this._scene)||void 0===o?void 0:o.getViewMatrix())||t.b.IdentityReadOnly;if(v.setMatrix("view",G),v.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),v.setTexture("diffuseSampler",this.particleTexture),v.setVector2("translationPivot",this.translationPivot),v.setVector3("Ev",this.Ev),this.isLocal&&v.setMatrix("emitterWM",Z),this._colorGradientsTexture?v.setTexture("colorGradientSampler",this._colorGradientsTexture):v.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const s=this.particleTexture.getBaseSize();v.setFloat3("sheetInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,s.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const s=this._scene.activeCamera;v.setVector3("eyePosition",s.globalPosition)}const B=v.defines;if(this._scene&&((0,Zs.f)(v,this,this._scene),this.applyFog&&(0,os.e)(this._scene,void 0,v)),B.indexOf("#define BILLBOARDMODE_ALL")>=0){const s=G.clone();s.invert(),v.setMatrix("invView",s)}return this.useLogarithmicDepth&&this._scene&&(0,os.h)(B,v,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(v),this._setEngineBasedOnBlendMode(s),this._platform.bindDrawBuffers(this._targetIndex,v,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(v),null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(a=this._scene)&&void 0!==a&&a.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(s){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!s)if(this.k.position){s=this.k.getWorldMatrix()}else{const Z=this.k;s=t.g.Matrix[0],t.b.TranslationToRef(Z.x,Z.y,Z.z,s)}const Z=this._engine,o=Z.getDepthWrite();if(Z.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const s=this.Ls();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",s.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",s),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const j=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=j,Z.setDepthWrite(o)}render(){let s,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!Z&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let s=0;s<this.preWarmCycles;s++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const s=0|this._accumulatedCount;this._accumulatedCount-=s,this._currentActiveCount+=s}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){s=this.k.getWorldMatrix()}else{const Z=this.k;s=t.g.Matrix[0],t.b.TranslationToRef(Z.x,Z.y,Z.z,s)}const j=this._engine;this.updateInAnimate||this._update(s);let S=0;return Z||o||(j.setState(!1),this.forceDepthWrite&&j.setDepthWrite(!0),S=this.blendMode===OZ.BLENDMODE_MULTIPLYADD?this._render(OZ.BLENDMODE_MULTIPLY,s)+this._render(OZ.BLENDMODE_ADD,s):this._render(this.blendMode,s),this._engine.setAlphaMode(0)),S}rebuild(){const s=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(s,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,s()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const Z in this._drawWrappers){this._drawWrappers[Z].dispose()}if(this._drawWrappers={},this._scene){const s=this._scene.gQ.indexOf(this);s>-1&&this._scene.gQ.splice(s,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let Z=0;Z<this._renderVertexBuffers.length;++Z){const s=this._renderVertexBuffers[Z];for(const Z in s)s[Z].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),s&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),s&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.jO.notifyObservers(this),this.jO.clear()}clone(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t={...this._customWrappers};let j=null;const S=this._engine;if(S.createEffectForParticles&&null!=this.customShader){j=this.customShader;const s=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"";t[0]=S.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,s,void 0,void 0,void 0,this)}const a=this.serialize(o),O=UZ.Parse(a,this._scene||this._engine,this._rootUrl);return O.name=s,O.customShader=j,O._customWrappers=t,void 0===Z&&(Z=this.k),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.k=Z,O}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};return OZ._Serialize(Z,this,s),Z.activeParticleCount=this.activeParticleCount,Z.randomTextureSize=this._randomTextureSize,Z.customShader=this.customShader,Z}static Parse(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0;const S=s.name;let a,O;Z instanceof Ps.e?a=Z:(O=Z,a=O.getEngine());const v=new UZ(S,{eZ:j||s.eZ,randomTextureSize:s.randomTextureSize},Z,null,s.isAnimationSheetEnabled);if(v._rootUrl=o,s.customShader&&a.createEffectForParticles){const Z=s.customShader,o=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"",t=a.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,o,void 0,void 0,void 0,v);v.setCustomEffect(t,0),v.customShader=Z}return s.id&&(v.id=s.id),s.activeParticleCount&&(v.activeParticleCount=s.activeParticleCount),OZ._Parse(s,v,Z,o),s.preventAutoStart&&(v.preventAutoStart=s.preventAutoStart),t||v.preventAutoStart||v.start(),v}}var uZ=o(10938),HZ=o(12433),FZ=o(11608);class iZ{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(s){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const Z of this.systems)Z.k=s;this._emitterNode=s}setEmitterAsSphere(s,Z,o){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:s,renderingGroupId:Z};const t=(0,HZ.e)("emitterSphere",{diameter:s.diameter,segments:s.segments},o);t.renderingGroupId=Z;const j=new FZ.e("emitterSphereMaterial",o);j.emissiveColor=s.color,t.material=j;for(const S of this.systems)S.k=t;this._emitterNode=t}start(s){for(const Z of this.systems)s&&(Z.k=s),Z.start()}dispose(){for(const s of this.systems)s.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={systems:[]};for(const o of this.systems)Z.systems.push(o.serialize(s));return this._emitterNode&&(Z.k=this._emitterCreationOptions),Z}static Parse(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;const j=new iZ,S=this.BaseAssetsUrl+"/textures/";Z=Z||n.c.LastCreatedScene;for(const a of s.systems)j.systems.push(o?UZ.Parse(a,Z,S,!0,t):OZ.Parse(a,Z,S,!0,t));if(s.k){const o=s.k.options;if("Sphere"===s.k.kind)j.setEmitterAsSphere({diameter:o.diameter,segments:o.segments,color:a.d.oO(o.color)},s.k.renderingGroupId,Z)}return j}}iZ.BaseAssetsUrl="https://assets.babylonjs.com/particles";var NZ=o(10977);class LZ{static CreateDefault(s){let Z,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,t=arguments.length>2?arguments[2]:void 0;Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new UZ("default system",{eZ:o},t):new OZ("default system",o,t),Z.k=s;const j=uZ.g.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return Z.particleTexture=new X.c(j,Z.Ls()),Z.createConeEmitter(.1,Math.PI/4),Z.color1=new a.h(1,1,1,1),Z.color2=new a.h(1,1,1,1),Z.colorDead=new a.h(1,1,1,0),Z.minSize=.1,Z.maxSize=.1,Z.minEmitPower=2,Z.maxEmitPower=2,Z.updateSpeed=1/60,Z.emitRate=30,Z}static CreateAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;Z||(Z=n.c.LastCreatedScene);const j={};return Z.addPendingData(j),new Promise(((S,a)=>{if(o&&!UZ.IsSupported)return Z.removePendingData(j),a("Particle system with GPU is not supported.");uZ.g.LoadFile(`${LZ.BaseAssetsUrl}/systems/${s}.json`,(s=>{Z.removePendingData(j);const a=JSON.parse(s.toString());return S(iZ.Parse(a,Z,o,t))}),void 0,void 0,void 0,(()=>(Z.removePendingData(j),a(`An error occurred with the creation of your particle system. Check if your type '${s}' exists.`))))}))}static ExportSet(s){const Z=new iZ;for(const o of s)Z.systems.push(o);return Z}static ParseFromFileAsync(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",S=arguments.length>5?arguments[5]:void 0;return new Promise(((a,O)=>{const v=new NZ.c;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const Z=JSON.parse(v.responseText);let O;O=t?UZ.Parse(Z,o,j,!1,S):OZ.Parse(Z,o,j,!1,S),s&&(O.name=s),a(O)}else O("Unable to load the particle system")})),v.open("GET",Z),v.send()}))}static ParseFromSnippetAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",j=arguments.length>4?arguments[4]:void 0;if("_BLANK"===s){const s=this.CreateDefault(null);return s.start(),Promise.resolve(s)}return new Promise(((S,a)=>{const O=new NZ.c;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const a=JSON.parse(JSON.parse(O.responseText).jsonPayload),v=JSON.parse(a.particleSystem);let G;G=o?UZ.Parse(v,Z,t,!1,j):OZ.Parse(v,Z,t,!1,j),G.snippetId=s,S(G)}else a("Unable to load the snippet "+s)})),O.open("GET",this.SnippetUrl+"/"+s.replace(/#/g,"/")),O.send()}))}}LZ.BaseAssetsUrl=iZ.BaseAssetsUrl,LZ.SnippetUrl="https://snippet.babylonjs.com",LZ.CreateFromSnippetAsync=LZ.ParseFromSnippetAsync;var VZ=o(11240),gZ=o(11297),lZ=o(12439);(0,lZ.g)(gZ.d.NAME_PARTICLESYSTEM,((s,Z,o,t)=>{const j=(0,lZ.h)(gZ.d.NAME_PARTICLESYSTEM);if(j&&void 0!==s.gQ&&null!==s.gQ)for(let S=0,a=s.gQ.length;S<a;S++){const a=s.gQ[S];o.gQ.push(j(a,Z,t))}})),(0,lZ.c)(gZ.d.NAME_PARTICLESYSTEM,((s,Z,o)=>{if(s.activeParticleCount){return UZ.Parse(s,Z,o)}return OZ.Parse(s,Z,o)})),Ps.e.prototype.createEffectForParticles=function(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",S=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0,v=arguments.length>7?arguments[7]:void 0,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,B=arguments.length>9?arguments[9]:void 0,Q=[],D=[];const z=[];return v?v.fillUniformsAttributesAndSamplerNames(D,Q,z):(Q=OZ._GetAttributeNamesOrOptions(),D=OZ._GetEffectCreationOptions()),-1===j.indexOf(" BILLBOARD")&&(j+="\n#define BILLBOARD\n"),null!==v&&void 0!==v&&v.isAnimationSheetEnabled&&-1===j.indexOf(" ANIMATESHEET")&&(j+="\n#define ANIMATESHEET\n"),-1===t.indexOf("diffuseSampler")&&t.push("diffuseSampler"),this.createEffect({vertex:B??(null===v||void 0===v?void 0:v.vertexShaderName)??"particles",fragmentElement:s},Q,D.concat(Z),z.concat(t),j,S,a,O,void 0,G,(async()=>{0===G?await Promise.resolve().then(o.bind(o,12468)):await Promise.resolve().then(o.bind(o,12548))}))},VZ.d.prototype.getEmittedParticleSystems=function(){const s=[];for(let Z=0;Z<this.Ls().gQ.length;Z++){const o=this.Ls().gQ[Z];o.k===this&&s.push(o)}return s},VZ.d.prototype.getHierarchyEmittedParticleSystems=function(){const s=[],Z=this.getDescendants();Z.push(this);for(let o=0;o<this.Ls().gQ.length;o++){const t=this.Ls().gQ[o],j=t.k;j.position&&-1!==Z.indexOf(j)&&s.push(t)}return s};o(11130),o(11138),o(11206);o(11214),o(12444),o(11229),o(11108),o(11295);o(11376);var RZ;o(12446),o(11393);!function(s){s[s.Color=2]="Color",s[s.UV=1]="UV",s[s.Random=0]="Random",s[s.Stated=3]="Stated"}(RZ||(RZ={}));var eZ=o(11405);const cZ=new t.n(0,0,0),wZ=new t.n(0,0,0),XZ=new t.n(0,0,0);class WZ{constructor(s,Z,o){this.width=s,this.height=Z,this.data=o}processFlowable(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;if(!o)return;o instanceof t.b?t.n.TransformCoordinatesToRef(s.position,o,XZ):(XZ.x=o.x,XZ.y=o.y,XZ.z=o.z);const j=.5*XZ.x+.5,S=1-(.5*XZ.y+.5),a=Math.floor(j*this.width),O=Math.floor(S*this.height);if(a<0||a>=this.width||O<0||O>=this.height)return;const v=4*(O*this.width+a),G=this.data[v]/255*2-1,B=this.data[v+1]/255*2-1,Q=this.data[v+2]/255*2-1,D=this.data[v+3]/255;cZ.set(G,B,Q),cZ.scaleToRef(Z*D,wZ),s.direction.addInPlace(wZ)}_processParticle(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;this.processFlowable(s,Z,o)}static async FromUrlAsync(s){return await new Promise(((Z,o)=>{const t=document.createElement("canvas"),j=t.getContext("2d");let S=null;const a=new Image;a.crossOrigin="anonymous",a.src=s,a.onerror=Z=>{o(new Error(`Failed to load image: ${s} : ${Z}`))},a.onload=()=>{t.width=a.width,t.height=a.height,j.drawImage(a,0,0),S=j.getImageData(0,0,t.width,t.height),Z(new WZ(t.width,t.height,S.data))}}))}static async ExtractFromTextureAsync(s){return await new Promise(((Z,o)=>{if(!s.isReady())return void s.onLoadObservable.addOnce((async()=>{try{const o=await this.ExtractFromTextureAsync(s);Z(o)}catch(t){o(t)}}));const t=s.getSize();eZ.h.GetTextureDataAsync(s,t.width,t.height).then((s=>{Z(new WZ(t.width,t.height,new Uint8ClampedArray(s)))})).catch(o)}))}}var qZ,hZ,MZ,xZ,kZ,yZ,IZ,CZ,KZ;!function(s){s[s.Int=1]="Int",s[s.Float=2]="Float",s[s.Vector2=4]="Vector2",s[s.sO=8]="sO",s[s.Matrix=16]="Matrix",s[s.Particle=32]="Particle",s[s.Texture=64]="Texture",s[s.nz=128]="nz",s[s.FloatGradient=256]="FloatGradient",s[s.Vector2Gradient=512]="Vector2Gradient",s[s.Vector3Gradient=1024]="Vector3Gradient",s[s.Color4Gradient=2048]="Color4Gradient",s[s.System=4096]="System",s[s.AutoDetect=8192]="AutoDetect",s[s.BasedOnInput=16384]="BasedOnInput",s[s.Undefined=32768]="Undefined",s[s.All=65535]="All"}(qZ||(qZ={})),function(s){s[s.Compatible=0]="Compatible",s[s.TypeIncompatible=1]="TypeIncompatible",s[s.HierarchyIssue=2]="HierarchyIssue"}(hZ||(hZ={})),function(s){s[s.Input=0]="Input",s[s.Output=1]="Output"}(MZ||(MZ={}));class pZ{get direction(){return this._direction}get type(){if(this._type===qZ.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===qZ.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(s){this._type=s}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((s=>s.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(s,Z,o){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=qZ.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new T.b,this.onDisconnectionObservable=new T.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=Z,this.name=s,this._direction=o}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(s){var Z;return this.isConnected?null!==(Z=this._connectedPoint)&&void 0!==Z&&Z._storedFunction?this._connectedPoint._storedFunction(s):this._connectedPoint._storedValue:this.value}canConnectTo(s){return 0===this.checkCompatibilityState(s)}checkCompatibilityState(s){const Z=this._ownerBlock,o=s.ownerBlock;if(this.type!==s.type&&s.innerType!==qZ.AutoDetect)return s.acceptedConnectionPointTypes&&-1!==s.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(s.excludedConnectionPointTypes&&-1!==s.excludedConnectionPointTypes.indexOf(this.type))return 1;let t=o,j=Z;return 0===this.direction&&(t=Z,j=o),t.isAnAncestorOf(j)?2:0}connectTo(s){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(s))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${s.ownerBlock.name}".${s.name}`;return this._endpoints.push(s),s._connectedPoint=this,this.onConnectionObservable.notifyObservers(s),s.onConnectionObservable.notifyObservers(this),this}disconnectFrom(s){const Z=this._endpoints.indexOf(s);return-1===Z||(this._endpoints.splice(Z,1),s._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(s),s.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(s){let Z=1;for(;Z<qZ.All;)s&Z||this.excludedConnectionPointTypes.push(Z),Z<<=1}serialize(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const Z={};return Z.name=this.name,Z.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.ma?(Z.valueType="BABYLON."+this.value.getClassName(),Z.value=this.value.ma()):(Z.valueType="number",Z.value=this.value)),s&&this.connectedPoint&&(Z.inputName=this.name,Z.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,Z.targetConnectionName=this.connectedPoint.name,Z.isExposedOnFrame=!0,Z.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(Z.isExposedOnFrame=!0,Z.exposedPortPosition=this.exposedPortPosition),Z}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class EZ{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(s){this._name=s}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(s){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new T.b,this.jO=new T.b,this.onInputChangedObservable=new T.b,this.visibleOnFrame=!1,this._name=s,this.uniqueId=W.b.UniqueId}_inputRename(s){return s}_outputRename(s){return s}isAnAncestorOf(s){for(const Z of this._outputs)if(Z.hasEndpoints)for(const o of Z.endpoints){if(o.ownerBlock===s)return!0;if(o.ownerBlock.isAnAncestorOf(s))return!0}return!1}isAnAncestorOfType(s){if(this.getClassName()===s)return!0;for(const Z of this._outputs)if(Z.hasEndpoints)for(const o of Z.endpoints)if(o.ownerBlock.isAnAncestorOfType(s))return!0;return!1}getInputByName(s){const Z=this._inputs.filter((Z=>Z.name===s));return Z.length?Z[0]:null}_linkConnectionTypes(s,Z){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[Z]._acceptedConnectionPointType=this._inputs[s]:(this._inputs[s]._linkedConnectionSource=this._inputs[Z],this._inputs[s]._isMainLinkSource=!0),this._inputs[Z]._linkedConnectionSource=this._inputs[s]}registerInput(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;const a=new pZ(s,this,0);return a.type=Z,a.isOptional=o,a.defaultValue=t,a.value=t,a.valueMin=j,a.valueMax=S,this._inputs.push(a),this.onInputChangedObservable.notifyObservers(a),this}registerOutput(s,Z,o){return(o=o??new pZ(s,this,1)).type=Z,this._outputs.push(o),this}_build(s){}_customBuildStep(s){}build(s){if(this._buildId===s.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((s=>s.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=s.buildId;for(const Z of this._inputs){if(!Z.connectedPoint){Z.isOptional||s.notConnectedNonOptionalInputs.push(Z);continue}const o=Z.connectedPoint.ownerBlock;o&&o!==this&&!o.isSystem&&o.build(s)}return this._customBuildStep(s),s.verbose&&q.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(s),this.onBuildObservable.notifyObservers(this),!1}serialize(){const s={};s.customType="BABYLON."+this.getClassName(),s.id=this.uniqueId,s.name=this.name,s.visibleOnFrame=this.visibleOnFrame,s.inputs=[],s.outputs=[];for(const Z of this.inputs)s.inputs.push(Z.serialize());for(const Z of this.outputs)s.outputs.push(Z.serialize(!1));return s}_deserialize(s){this._name=s.name,this.comments=s.comments,this.visibleOnFrame=!!s.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(s)}_deserializePortDisplayNamesAndExposedOnFrame(s){const Z=s.inputs,o=s.outputs;if(Z)for(const t of Z){const s=this.inputs.find((s=>s.name===t.name));if(!s)return;if(t.displayName&&(s.displayName=t.displayName),t.isExposedOnFrame&&(s.isExposedOnFrame=t.isExposedOnFrame,s.exposedPortPosition=t.exposedPortPosition),void 0!==t.value&&null!==t.value)if("number"===t.valueType)s.value=t.value;else{const Z=(0,O.e)(t.valueType);Z&&(s.value=Z.oO(t.value))}}if(o)for(let t=0;t<o.length;t++){const s=o[t];s.displayName&&(this.outputs[t].displayName=s.displayName),s.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=s.isExposedOnFrame,this.outputs[t].exposedPortPosition=s.exposedPortPosition)}}clone(){const s=this.serialize(),Z=(0,O.e)(s.customType);if(Z){const o=new Z;return o._deserialize(s),o}return null}dispose(){this.jO.notifyObservers(this),this.jO.clear();for(const s of this.inputs)s.dispose();for(const s of this.outputs)s.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function PZ(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",t=arguments.length>3?arguments[3]:void 0;return(j,S)=>{let a=j._propStore;a||(a=[],j._propStore=a),a.push({propertyName:S,displayName:s,type:Z,groupName:o,options:t??{},className:j.getClassName()})}}(0,e.c)([(0,c.K)("comment")],EZ.prototype,"comments",void 0),function(s){s[s.Boolean=0]="Boolean",s[s.Float=1]="Float",s[s.Int=2]="Int",s[s.Vector2=3]="Vector2",s[s.List=4]="List",s[s.nz=5]="nz",s[s.SamplingMode=6]="SamplingMode",s[s.TextureFormat=7]="TextureFormat",s[s.TextureType=8]="TextureType"}(xZ||(xZ={})),function(s){s[s.None=0]="None",s[s.Position=1]="Position",s[s.Direction=2]="Direction",s[s.Age=3]="Age",s[s.Lifetime=4]="Lifetime",s[s.Color=5]="Color",s[s.ScaledDirection=6]="ScaledDirection",s[s.Scale=7]="Scale",s[s.AgeGradient=8]="AgeGradient",s[s.Angle=9]="Angle",s[s.SpriteCellIndex=16]="SpriteCellIndex",s[s.SpriteCellStart=17]="SpriteCellStart",s[s.SpriteCellEnd=18]="SpriteCellEnd"}(kZ||(kZ={})),function(s){s[s.None=0]="None",s[s.Time=1]="Time",s[s.Delta=2]="Delta",s[s.Emitter=3]="Emitter"}(yZ||(yZ={}));class rZ{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let s="";for(const Z of this.notConnectedNonOptionalInputs)s+=`input ${Z.name} from block ${Z.ownerBlock.name}[${Z.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(s)throw"Build of Node Particle System Set failed:\n"+s}adapt(s,Z){const o=s.getConnectedValue(this)||0;if(s.type===Z)return o;switch(Z){case qZ.Vector2:return new t.j(o,o);case qZ.sO:return new t.n(o,o,o);case qZ.nz:return new a.h(o,o,o,o)}return null}getContextualValue(s){if(!this.particleContext||!this.systemContext)return null;switch(s){case kZ.Position:return this.particleContext.position;case kZ.Direction:return this.particleContext.direction;case kZ.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case kZ.Color:return this.particleContext.color;case kZ.Age:return this.particleContext.age;case kZ.Lifetime:return this.particleContext.lifeTime;case kZ.Angle:return this.particleContext.angle;case kZ.Scale:return this.particleContext.scale;case kZ.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case kZ.SpriteCellEnd:return this.systemContext.endSpriteCellID;case kZ.SpriteCellIndex:return this.particleContext.cellIndex;case kZ.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(s){if(!this.particleContext||!this.systemContext)return null;switch(s){case yZ.Time:return this.systemContext._actualFrame;case yZ.Delta:return this.systemContext._scaledUpdateSpeed;case yZ.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function TZ(s,Z,o){const t=new rZ;t.fZ=Z;const j=s.createSystem(t);return j.canStart=()=>!0,j.k=o.clone(),j.disposeOnStop=!0,j.start(),j}class mZ extends EZ{constructor(s){super(s),this.blendMode=v.BLENDMODE_ONEONE,this.eZ=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",qZ.Particle),this.registerInput("texture",qZ.Texture),this.registerInput("onStart",qZ.System,!0),this.registerInput("onEnd",qZ.System,!0),this.registerOutput("system",qZ.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(s){s.eZ=this.eZ,s.buildId=this._buildId++,this.build(s);const Z=this.particle.getConnectedValue(s);return Z.particleTexture=this.texture.getConnectedValue(s),Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.name=this.name,Z._nodeGenerated=!0,Z._targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,this.system._storedValue=this,Z.canStart=()=>!this.doNoStart,Z.onStartedObservable.add((o=>{const t=this.onStart.getConnectedValue(s);t&&o.onStartedObservable.addOnce((()=>{s.systemContext=Z;const o=TZ(t,s.fZ,s.emitterPosition);this.jO.addOnce((()=>{o.dispose()}))}));const j=this.onEnd.getConnectedValue(s);j&&o.onStoppedObservable.addOnce((()=>{s.systemContext=Z;const o=TZ(j,s.fZ,s.emitterPosition);this.jO.addOnce((()=>{o.dispose()}))}))})),this.jO.addOnce((()=>{Z.dispose()})),Z}serialize(){const s=super.serialize();return s.eZ=this.eZ,s.emitRate=this.emitRate,s.blendMode=this.blendMode,s.doNoStart=this.doNoStart,s.targetStopDuration=this.targetStopDuration,s.startDelay=this.startDelay,s}_deserialize(s){super._deserialize(s),this.eZ=s.eZ,this.emitRate=s.emitRate,this.doNoStart=!!s.doNoStart,void 0!==s.blendMode&&(this.blendMode=s.blendMode),void 0!==s.targetStopDuration&&(this.targetStopDuration=s.targetStopDuration),void 0!==s.startDelay&&(this.startDelay=s.startDelay)}}(0,e.c)([PZ("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:v.BLENDMODE_ONEONE},{label:"Standard",value:v.BLENDMODE_STANDARD},{label:"Add",value:v.BLENDMODE_ADD},{label:"Multiply",value:v.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:v.BLENDMODE_MULTIPLYADD}]})],mZ.prototype,"blendMode",void 0),(0,e.c)([PZ("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],mZ.prototype,"eZ",void 0),(0,e.c)([PZ("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mZ.prototype,"emitRate",void 0),(0,e.c)([PZ("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mZ.prototype,"targetStopDuration",void 0),(0,e.c)([PZ("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mZ.prototype,"startDelay",void 0),(0,e.c)([PZ("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mZ.prototype,"doNoStart",void 0),(0,O.f)("BABYLON.SystemBlock",mZ);class nZ extends EZ{get type(){if(this._type===qZ.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=qZ.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=qZ.Vector2,this._type;case"sO":return this._type=qZ.sO,this._type;case"nz":return this._type=qZ.nz,this._type;case"Matrix":return this._type=qZ.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===kZ.None&&this._systemSource!==yZ.None}get systemSource(){return this._systemSource}set systemSource(s){if(this._systemSource=s,s!==yZ.None){switch(this._contextualSource=kZ.None,this._type=qZ.Float,s){case yZ.Time:case yZ.Delta:this._type=qZ.Float;break;case yZ.Emitter:this._type=qZ.sO}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==kZ.None}get contextualValue(){return this._contextualSource}set contextualValue(s){if(this._contextualSource=s,s!==kZ.None){switch(this._systemSource=yZ.None,s){case kZ.Scale:this._type=qZ.Vector2;break;case kZ.Position:case kZ.Direction:case kZ.ScaledDirection:this._type=qZ.sO;break;case kZ.Color:this._type=qZ.nz;break;case kZ.Age:case kZ.Lifetime:case kZ.Angle:case kZ.AgeGradient:this._type=qZ.Float;break;case kZ.SpriteCellEnd:case kZ.SpriteCellStart:case kZ.SpriteCellIndex:this._type=qZ.Int}this.output&&(this.output.type=this._type)}}constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qZ.AutoDetect;super(s),this._type=qZ.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new T.b,this._systemSource=yZ.None,this._contextualSource=kZ.None,this._type=Z,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",Z)}get value(){return this._storedValue}set value(s){this.type===qZ.Float&&this.min!==this.max&&(s=Math.max(this.min,s),s=Math.min(this.max,s)),this._storedValue=s,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(s){this._valueCallback=s}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case qZ.Int:case qZ.Float:this.value=0;break;case qZ.Vector2:this.value=t.j.Zero();break;case qZ.sO:this.value=t.n.Zero();break;case qZ.nz:this.value=new a.h(1,1,1,1);break;case qZ.Matrix:this.value=t.b.Identity()}}_build(s){super._build(s),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=s=>s.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=s=>s.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const s=super.serialize();return s.type=this.type,s.contextualValue=this.contextualValue,s.systemSource=this.systemSource,s.min=this.min,s.max=this.max,s.groupInInspector=this.groupInInspector,s.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.ma?(s.valueType="BABYLON."+this._storedValue.getClassName(),s.value=this._storedValue.ma()):(s.valueType="number",s.value=this._storedValue)),s}_deserialize(s){if(super._deserialize(s),this._type=s.type,this.contextualValue=s.contextualValue,this.systemSource=s.systemSource||yZ.None,this.min=s.min||0,this.max=s.max||0,this.groupInInspector=s.groupInInspector||"",void 0!==s.displayInInspector&&(this.displayInInspector=s.displayInInspector),s.valueType)if("number"===s.valueType)this._storedValue=s.value;else{const Z=(0,O.e)(s.valueType);Z&&(this._storedValue=Z.oO(s.value))}}}(0,O.f)("BABYLON.ParticleInputBlock",nZ);class JZ extends EZ{get url(){return this._url}set url(s){this._url!==s&&(this._cachedData=null,this._url=s,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(s){this._textureDataUrl!==s&&(this._cachedData=null,this._textureDataUrl=s,this._url="",this._sourceTexture=null)}set sourceTexture(s){this._sourceTexture!==s&&(this._cachedData=null,this._sourceTexture=s,this._url="",this._textureDataUrl="")}constructor(s){super(s),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",qZ.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const s=this.texture._storedValue;return await new Promise(((Z,o)=>{if(!s.isReady())return void s.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),Z(this._cachedData)}catch(s){o(s)}}));const t=s.getSize();eZ.h.GetTextureDataAsync(s,t.width,t.height).then((o=>{this._cachedData={width:t.width,height:t.height,data:new Uint8ClampedArray(o)},s.dispose(),Z(this._cachedData)})).catch(o)}))}_build(s){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new X.c(this._textureDataUrl,s.fZ):this.texture._storedValue=new X.c(this._url,s.fZ):this.texture._storedValue=null}serialize(){const s=super.serialize();return s.url=this.url,s.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(s.textureDataUrl=this.textureDataUrl),s}_deserialize(s){super._deserialize(s),this.url=s.url,this.serializedCachedData=!!s.serializedCachedData,s.textureDataUrl&&(this.textureDataUrl=s.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,O.f)("BABYLON.ParticleTextureSourceBlock",JZ);class so extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("position",qZ.sO),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(s){const Z=this.particle.getConnectedValue(s);if(this.output._storedValue=Z,!this.position.isConnected)return;const o={process:o=>{s.particleContext=o,s.systemContext=Z,o.position.O(this.position.getConnectedValue(s))},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o}}(0,O.f)("BABYLON.UpdatePositionBlock",so),function(s){s[s.Add=0]="Add",s[s.Subtract=1]="Subtract",s[s.Multiply=2]="Multiply",s[s.Divide=3]="Divide",s[s.Max=4]="Max",s[s.Min=5]="Min"}(IZ||(IZ={}));class Zo extends EZ{constructor(s){super(s),this.operation=IZ.Add,this.registerInput("left",qZ.AutoDetect),this.registerInput("right",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this.output._typeConnectionSource=this.left;const Z=[qZ.Matrix,qZ.Particle,qZ.Texture,qZ.System,qZ.FloatGradient,qZ.Color4Gradient,qZ.Vector2Gradient,qZ.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...Z),this.right.excludedConnectionPointTypes.push(...Z),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(s){let Z;const o=this.left,j=this.right;if(!o.isConnected||!j.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const S=o.type===qZ.Float||o.type===qZ.Int,O=j.type===qZ.Float||j.type===qZ.Int,v=S&&O;switch(this.operation){case IZ.Add:Z=v?s=>o.getConnectedValue(s)+j.getConnectedValue(s):S?s=>s.adapt(o,j.type).add(j.getConnectedValue(s)):s=>o.getConnectedValue(s).add(s.adapt(j,o.type));break;case IZ.Subtract:Z=v?s=>o.getConnectedValue(s)-j.getConnectedValue(s):S?s=>s.adapt(o,j.type).Go(j.getConnectedValue(s)):s=>o.getConnectedValue(s).Go(s.adapt(j,o.type));break;case IZ.Multiply:Z=v?s=>o.getConnectedValue(s)*j.getConnectedValue(s):S?s=>s.adapt(o,j.type).multiply(j.getConnectedValue(s)):s=>o.getConnectedValue(s).multiply(s.adapt(j,o.type));break;case IZ.Divide:Z=v?s=>o.getConnectedValue(s)/j.getConnectedValue(s):S?s=>s.adapt(o,j.type).divide(j.getConnectedValue(s)):s=>o.getConnectedValue(s).divide(s.adapt(j,o.type));break;case IZ.Min:if(v)Z=s=>Math.min(o.getConnectedValue(s),j.getConnectedValue(s));else{const[s,O]=S?[j,o]:[o,j];switch(s.type){case qZ.Vector2:Z=Z=>t.j.Minimize(s.getConnectedValue(Z),Z.adapt(O,s.type));break;case qZ.sO:Z=Z=>t.n.Minimize(s.getConnectedValue(Z),Z.adapt(O,s.type));break;case qZ.nz:Z=Z=>{const o=s.getConnectedValue(Z),{r:t,g:j,b:S,a:v}=Z.adapt(O,s.type);return new a.h(Math.min(o.r,t),Math.min(o.g,j),Math.min(o.b,S),Math.min(o.a,v))}}}break;case IZ.Max:if(!v){const[s,O]=S?[j,o]:[o,j];switch(s.type){case qZ.Vector2:Z=Z=>t.j.Maximize(s.getConnectedValue(Z),Z.adapt(O,s.type));break;case qZ.sO:Z=Z=>t.n.Maximize(s.getConnectedValue(Z),Z.adapt(O,s.type));break;case qZ.nz:Z=Z=>{const o=s.getConnectedValue(Z),{r:t,g:j,b:S,a:v}=Z.adapt(O,s.type);return new a.h(Math.max(o.r,t),Math.min(o.g,j),Math.min(o.b,S),Math.min(o.a,v))}}break}Z=s=>Math.max(o.getConnectedValue(s),j.getConnectedValue(s))}this.output._storedFunction=s=>o.type===qZ.Int?0|Z(s):Z(s)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===qZ.Int||this.left.type===qZ.Float&&this.right.type!==qZ.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[s,Z]of[[this.left,this.right],[this.right,this.left]])s.acceptedConnectionPointTypes=[qZ.Int,qZ.Float],Z.isConnected&&(s.acceptedConnectionPointTypes.push(Z.type),Z.type!==qZ.Int&&Z.type!==qZ.Float||s.acceptedConnectionPointTypes.push(qZ.Vector2,qZ.sO,qZ.nz))}dispose(){super.dispose();for(const s of this._connectionObservers)s.remove();this._connectionObservers.length=0}serialize(){const s=super.serialize();return s.operation=this.operation,s}_deserialize(s){super._deserialize(s),this.operation=s.operation}}(0,e.c)([PZ("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:IZ.Add},{label:"Subtract",value:IZ.Subtract},{label:"Multiply",value:IZ.Multiply},{label:"Divide",value:IZ.Divide},{label:"Max",value:IZ.Max},{label:"Min",value:IZ.Min}]})],Zo.prototype,"operation",void 0),(0,O.f)("BABYLON.ParticleMathBlock",Zo);class oo extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("direction1",qZ.sO,!0,new t.n(0,1,0)),this.registerInput("direction2",qZ.sO,!0,new t.n(0,1,0)),this.registerInput("minEmitBox",qZ.sO,!0,new t.n(-.5,-.5,-.5)),this.registerInput("maxEmitBox",qZ.sO,!0,new t.n(.5,.5,.5)),this.registerOutput("output",qZ.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(s){const Z=this.particle.getConnectedValue(s);Z._directionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.direction1.getConnectedValue(s),S=this.direction2.getConnectedValue(s),a=(0,G.RandomRange)(j.x,S.x),O=(0,G.RandomRange)(j.y,S.y),v=(0,G.RandomRange)(j.z,S.z);s.isEmitterTransformNode?t.n.TransformNormalFromFloatsToRef(a,O,v,s.emitterWorldMatrix,o.direction):o.direction.Ja(a,O,v)},Z._positionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.minEmitBox.getConnectedValue(s),S=this.maxEmitBox.getConnectedValue(s),a=(0,G.RandomRange)(j.x,S.x),O=(0,G.RandomRange)(j.y,S.y),v=(0,G.RandomRange)(j.z,S.z);s.isEmitterTransformNode?t.n.TransformCoordinatesFromFloatsToRef(a,O,v,s.emitterWorldMatrix,o.position):(o.position.Ja(a,O,v),o.position.addInPlace(s.emitterPosition))},this.output._storedValue=Z}}(0,O.f)("BABYLON.BoxShapeBlock",oo);class to extends EZ{constructor(s){super(s),this.registerInput("emitPower",qZ.Float,!0,1),this.registerInput("lifeTime",qZ.Float,!0,1),this.registerInput("color",qZ.nz,!0,new a.h(1,1,1,1)),this.registerInput("scale",qZ.Vector2,!0,new t.j(1,1)),this.registerInput("angle",qZ.Float,!0,0),this.registerOutput("particle",qZ.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(s){const Z=new OZ(this.name,s.eZ,s.fZ,null,!1,void 0,!0);Z.particleEmitterType=new A,Z._lifeTimeCreation.process=(Z,o)=>{s.particleContext=Z,Z.lifeTime=this.lifeTime.getConnectedValue(s),o._emitPower=this.emitPower.getConnectedValue(s)},Z._colorCreation.process=Z=>{s.particleContext=Z,Z.color.O(this.color.getConnectedValue(s))},Z._sizeCreation.process=Z=>{s.particleContext=Z,Z.size=1,Z.scale.O(this.scale.getConnectedValue(s))},Z._angleCreation.process=Z=>{s.particleContext=Z,Z.angle=this.angle.getConnectedValue(s)},this.particle._storedValue=Z}}(0,O.f)("BABYLON.CreateParticleBlock",to);class jo{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const s=[];for(const Z of this.attachedBlocks)Z.isInput&&s.push(Z);return s}constructor(s){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new T.b,this.name=s}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(s)&&this.attachedBlocks.push(s);for(const o of s.inputs){const t=o.connectedPoint;if(t){const o=t.ownerBlock;o!==s&&this._initializeBlock(o,Z)}}}async buildAsync(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((o=>{const t=new iZ;for(const s of this._systemBlocks)this._initializeBlock(s);for(const j of this.systemBlocks){const o=new rZ;o.buildId=this._buildId++,o.fZ=s,o.verbose=Z;const S=j.createSystem(o);o.emitErrors(),t.systems.push(S)}this.onBuildObservable.notifyObservers(this),o(t)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const s=new mZ("Particle system"),Z=new so("Update position");Z.output.connectTo(s.particle);const o=new nZ("Position");o.contextualValue=kZ.Position;const t=new nZ("Scaled direction");t.contextualValue=kZ.ScaledDirection;const j=new Zo("Add");j.operation=IZ.Add,o.output.connectTo(j.left),t.output.connectTo(j.right),j.output.connectTo(Z.position);const S=new to("Create particle"),a=new oo("Box shape");S.particle.connectTo(a.particle),a.output.connectTo(Z.particle);const O=new JZ("Texture");O.texture.connectTo(s.texture),O.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(s)}removeBlock(s){const Z=this.attachedBlocks.indexOf(s);if(Z>-1&&this.attachedBlocks.splice(Z,1),s.isSystem){const Z=this._systemBlocks.indexOf(s);Z>-1&&this._systemBlocks.splice(Z,1)}}parseSerializedObject(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z||this.clear();const o={};for(const t of s.EG){const s=(0,O.e)(t.customType);if(s){const Z=new s;Z._deserialize(t),o[t.id]=Z,this.attachedBlocks.push(Z),Z.isSystem&&this._systemBlocks.push(Z)}}for(const t of this.attachedBlocks)if(t.isTeleportOut){const s=t,Z=s._tempEntryPointUniqueId;if(Z){const t=o[Z];t&&t.attachToEndpoint(s)}}for(let t=0;t<s.EG.length;t++){const j=s.EG[t],S=o[j.id];S&&(S.inputs.length&&j.inputs.some((s=>s.targetConnectionName))&&!Z||this._restoreConnections(S,s,o))}if(s.locations||s.editorData&&s.editorData.locations){const t=s.locations||s.editorData.locations;for(const s of t)o[s.mo]&&(s.mo=o[s.mo].uniqueId);Z&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),s.locations?this.editorData={locations:t}:(this.editorData=s.editorData,this.editorData.locations=t);const j=[];for(const s in o)j[s]=o[s].uniqueId;this.editorData.map=j}this.comment=s.comment}_restoreConnections(s,Z,o){for(const t of s.outputs)for(const j of Z.EG){const S=o[j.id];if(S)for(const a of j.inputs)if(o[a.targetBlockId]!==s||a.targetConnectionName!==t.name);else{const s=S.getInputByName(a.inputName);if(!s||s.isConnected)continue;t.connectTo(s,!0),this._restoreConnections(S,Z,o)}}}serialize(s){const Z=s?{}:w.c.Serialize(this);Z.editorData=JSON.parse(JSON.stringify(this.editorData));let o=[];s?o=s:Z.customType="BABYLON.NodeParticleSystemSet",Z.EG=[];for(const t of o)Z.EG.push(t.serialize());if(!s)for(const t of this.attachedBlocks)-1===o.indexOf(t)&&Z.EG.push(t.serialize());return Z}dispose(){for(const s of this.attachedBlocks)s.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(s){const Z=new jo(s);return Z.setToDefault(),Z}static Parse(s){const Z=w.c.Parse((()=>new jo(s.name)),s,null);return Z.parseSerializedObject(s),Z}static ParseFromSnippetAsync(s,Z){return"_BLANK"===s?Promise.resolve(jo.CreateDefault("blank")):new Promise(((o,t)=>{const j=new NZ.c;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const a=JSON.parse(JSON.parse(j.responseText).jsonPayload),O=JSON.parse(a.nodeParticle);Z||(Z=w.c.Parse((()=>new jo(s)),O,null)),Z.parseSerializedObject(O),Z.snippetId=s;try{o(Z)}catch(S){t(S)}}else t("Unable to load the snippet "+s)})),j.open("GET",this.SnippetUrl+"/"+s.replace(/#/g,"/")),j.send()}))}}jo.EditorURL=`${uZ.g._DefaultCdnUrl}/v${Ps.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,jo.SnippetUrl="https://snippet.babylonjs.com",(0,e.c)([(0,c.K)()],jo.prototype,"name",void 0),(0,e.c)([(0,c.K)("comment")],jo.prototype,"comment",void 0),function(s){s[s.None=0]="None",s[s.PerParticle=1]="PerParticle",s[s.PerSystem=2]="PerSystem"}(CZ||(CZ={}));class So extends EZ{constructor(s){super(s),this._currentLockId=-2,this.lockMode=CZ.PerParticle,this.registerInput("min",qZ.AutoDetect,!0,0),this.registerInput("max",qZ.AutoDetect,!0,1),this.registerOutput("output",qZ.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qZ.Float|qZ.Int|qZ.Vector2|qZ.sO|qZ.nz),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(qZ.Float|qZ.Int|qZ.Vector2|qZ.sO|qZ.nz),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=qZ.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let s=null;switch(this._currentLockId=-2,this.min.type){case qZ.AutoDetect:case qZ.Int:case qZ.Float:s=s=>{const Z=this.min.getConnectedValue(s)||0,o=this.max.getConnectedValue(s)||1;return Z+Math.random()*(o-Z)};break;case qZ.Vector2:s=s=>{const Z=this.min.getConnectedValue(s)||t.j.Zero(),o=this.max.getConnectedValue(s)||t.j.One();return new t.j(Z.x+Math.random()*(o.x-Z.x),Z.y+Math.random()*(o.y-Z.y))};break;case qZ.sO:s=s=>{const Z=this.min.getConnectedValue(s)||t.n.Zero(),o=this.max.getConnectedValue(s)||t.n.One();return new t.n(Z.x+Math.random()*(o.x-Z.x),Z.y+Math.random()*(o.y-Z.y),Z.z+Math.random()*(o.z-Z.z))};break;case qZ.nz:s=s=>{const Z=this.min.getConnectedValue(s)||new a.h(0,0,0,0),o=this.max.getConnectedValue(s)||new a.h(1,1,1,1);return new a.h(Z.x+Math.random()*(o.x-Z.x),Z.y+Math.random()*(o.y-Z.y),Z.z+Math.random()*(o.z-Z.z),Z.w+Math.random()*(o.w-Z.w))}}this.output._storedFunction=Z=>{var o;let t=0;switch(this.lockMode){case CZ.PerParticle:t=(null===(o=Z.particleContext)||void 0===o?void 0:o.id)||-1;break;case CZ.PerSystem:t=Z.buildId||0}return this._currentLockId!==t&&(this.lockMode!==CZ.None&&(this._currentLockId=t),this.output._storedValue=s(Z)),this.output._storedValue}}serialize(){const s=super.serialize();return s.lockMode=this.lockMode,s}_deserialize(s){super._deserialize(s),this.lockMode=s.lockMode}}(0,e.c)([PZ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:CZ.None},{label:"Per particle",value:CZ.PerParticle},{label:"Per system",value:CZ.PerSystem}]})],So.prototype,"lockMode",void 0),(0,O.f)("BABYLON.ParticleRandomBlock",So);class ao extends EZ{constructor(s){super(s),this._currentLockId=-2,this.lockMode=CZ.PerParticle,this.registerInput("min",qZ.AutoDetect),this.registerInput("max",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const Z=[qZ.Matrix,qZ.Particle,qZ.Texture,qZ.System,qZ.FloatGradient,qZ.Color4Gradient,qZ.Vector2Gradient,qZ.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...Z),this.max.excludedConnectionPointTypes.push(...Z)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let s=null;switch(this._currentLockId=-2,this.min.type){case qZ.Float:case qZ.Int:s=s=>{const Z=this.min.getConnectedValue(s),o=this.max.getConnectedValue(s);return Math.random()*(o-Z)+Z};break;case qZ.Vector2:s=s=>{const Z=this.min.getConnectedValue(s),o=this.max.getConnectedValue(s);return new t.j(Math.random()*(o.x-Z.x)+Z.x,Math.random()*(o.y-Z.y)+Z.y)};break;case qZ.sO:s=s=>{const Z=this.min.getConnectedValue(s),o=this.max.getConnectedValue(s);return new t.n(Math.random()*(o.x-Z.x)+Z.x,Math.random()*(o.y-Z.y)+Z.y,Math.random()*(o.z-Z.z)+Z.z)};break;case qZ.nz:s=s=>{const Z=this.min.getConnectedValue(s),o=this.max.getConnectedValue(s);return new a.h(Math.random()*(o.r-Z.r)+Z.r,Math.random()*(o.g-Z.g)+Z.g,Math.random()*(o.b-Z.b)+Z.b,Math.random()*(o.a-Z.a)+Z.a)}}this.output._storedFunction=Z=>{var o;let t=0;switch(this.lockMode){case CZ.PerParticle:t=(null===(o=Z.particleContext)||void 0===o?void 0:o.id)||-1;break;case CZ.PerSystem:t=Z.buildId||0}return this._currentLockId!==t&&(this.lockMode!==CZ.None&&(this._currentLockId=t),this.output._storedValue=s(Z)),this.output._storedValue}}serialize(){const s=super.serialize();return s.lockMode=this.lockMode,s}_deserialize(s){super._deserialize(s),void 0!==s.lockMode&&(this.lockMode=s.lockMode)}}(0,e.c)([PZ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:CZ.None},{label:"Per particle",value:CZ.PerParticle},{label:"Per system",value:CZ.PerSystem}]})],ao.prototype,"lockMode",void 0),(0,O.f)("BABYLON.RandomRangeBlock",ao);(0,O.f)("BABYLON.ParticleLerpBlock",class extends EZ{constructor(s){super(s),this.registerInput("left",qZ.AutoDetect),this.registerInput("right",qZ.AutoDetect),this.registerInput("gradient",qZ.Float,!0,0,0,1),this.registerOutput("output",qZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qZ.Float|qZ.Int|qZ.Vector2|qZ.sO|qZ.nz)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const s=(s,Z,o)=>(1-s)*Z+s*o;this.output._storedFunction=Z=>{const o=this.left.getConnectedValue(Z),j=this.right.getConnectedValue(Z),S=this.gradient.getConnectedValue(Z);switch(this.left.type){case qZ.Int:case qZ.Float:return s(S,o,j);case qZ.Vector2:return new t.j(s(S,o.x,j.x),s(S,o.y,j.y));case qZ.sO:return new t.n(s(S,o.x,j.x),s(S,o.y,j.y),s(S,o.z,j.z));case qZ.nz:return new a.h(s(S,o.r,j.r),s(S,o.g,j.g),s(S,o.b,j.b),s(S,o.a,j.a))}return 0}}});(0,O.f)("BABYLON.UpdateDirectionBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("direction",qZ.sO),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(s){const Z=this.particle.getConnectedValue(s);if(this.output._storedValue=Z,!this.direction.isConnected)return;const o={process:o=>{s.particleContext=o,s.systemContext=Z,o.direction.O(this.direction.getConnectedValue(s))},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o}});(0,O.f)("BABYLON.UpdateColorBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("color",qZ.nz),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(s){const Z=this.particle.getConnectedValue(s);if(this.output._storedValue=Z,!this.color.isConnected)return;const o={process:o=>{s.particleContext=o,s.systemContext=Z,o.color.O(this.color.getConnectedValue(s))},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o}});(0,O.f)("BABYLON.UpdateScaleBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("scale",qZ.Vector2),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(s){const Z=this.particle.getConnectedValue(s);if(this.output._storedValue=Z,!this.scale.isConnected)return;const o={process:o=>{s.particleContext=o,s.systemContext=Z,o.scale.O(this.scale.getConnectedValue(s))},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o}});(0,O.f)("BABYLON.UpdateAngleBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("angle",qZ.Float),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(s){const Z=this.particle.getConnectedValue(s);if(this.output._storedValue=Z,!this.angle.isConnected)return;const o={process:o=>{s.particleContext=o,s.systemContext=Z,o.angle=this.angle.getConnectedValue(s)},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o}});(0,O.f)("BABYLON.BasicPositionUpdateBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(s){const Z=this.particle.getConnectedValue(s),o={process:o=>{s.particleContext=o,s.systemContext=Z,o.direction.scaleToRef(Z._directionScale,Z._scaledDirection),o.position.addInPlace(Z._scaledDirection)},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o,this.output._storedValue=Z}});(0,O.f)("BABYLON.BasicSpriteUpdateBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(s){const Z=this.particle.getConnectedValue(s),o={process:o=>{s.particleContext=o,s.systemContext=Z,o.updateCellIndex()},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o,this.output._storedValue=Z}});(0,O.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("cellIndex",qZ.Int),this.registerOutput("output",qZ.Particle),this.cellIndex.acceptedConnectionPointTypes=[qZ.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(s){const Z=this.particle.getConnectedValue(s);if(this.output._storedValue=Z,!this.cellIndex.isConnected)return;const o={process:o=>{s.particleContext=o,s.systemContext=Z,o.cellIndex=Math.floor(this.cellIndex.getConnectedValue(s))},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o}});class Oo extends EZ{constructor(s){super(s),this.strength=1,this.registerInput("particle",qZ.Particle),this.registerInput("flowMap",qZ.Texture),this.registerOutput("output",qZ.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(s){var Z;const o=this.particle.getConnectedValue(s),t=s.fZ;let j;(null===(Z=this.flowMap.connectedPoint)||void 0===Z?void 0:Z.ownerBlock).extractTextureContentAsync().then((s=>{s&&(j=new WZ(s.width,s.height,s.data))}));const S={process:s=>{const Z=t.getTransformMatrix();j&&j._processParticle(s,this.strength*o._tempScaledUpdateSpeed,Z)},previousItem:null,nextItem:null};o._updateQueueStart?ys(S,o._updateQueueStart):o._updateQueueStart=S,this.output._storedValue=o}serialize(){const s=super.serialize();return s.strength=this.strength,s}_deserialize(s){super._deserialize(s),this.strength=s.strength}}(0,e.c)([PZ("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Oo.prototype,"strength",void 0),(0,O.f)("BABYLON.UpdateFlowMapBlock",Oo);(0,O.f)("BABYLON.SphereShapeBlock",class extends EZ{constructor(s){super(s),this.registerInput("input",qZ.Particle),this.registerInput("radius",qZ.Float,!0,1),this.registerInput("radiusRange",qZ.Float,!0,1,0,1),this.registerInput("directionRandomizer",qZ.Float,!0,0,0,1),this.registerOutput("output",qZ.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(s){const Z=this.input.getConnectedValue(s);Z._directionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.directionRandomizer.getConnectedValue(s),S=o.position.Go(s.emitterPosition).normalize(),a=(0,G.RandomRange)(0,j),O=(0,G.RandomRange)(0,j),v=(0,G.RandomRange)(0,j);S.x+=a,S.y+=O,S.z+=v,S.normalize(),s.isEmitterTransformNode?t.n.TransformNormalFromFloatsToRef(a,O,v,s.emitterWorldMatrix,o.direction):o.direction.Ja(a,O,v)},Z._positionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.radius.getConnectedValue(s),S=this.radiusRange.getConnectedValue(s),a=j-(0,G.RandomRange)(0,j*S),O=(0,G.RandomRange)(0,1),v=(0,G.RandomRange)(0,2*Math.PI),B=Math.acos(2*O-1),Q=a*Math.cos(v)*Math.sin(B),D=a*Math.cos(B),z=a*Math.sin(v)*Math.sin(B);s.isEmitterTransformNode?t.n.TransformCoordinatesFromFloatsToRef(Q,D,z,s.emitterWorldMatrix,o.position):(o.position.Ja(Q,D,z),o.position.addInPlace(s.emitterPosition))},this.output._storedValue=Z}});(0,O.f)("BABYLON.PointShapeBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("direction1",qZ.sO,!0,new t.n(0,1,0)),this.registerInput("direction2",qZ.sO,!0,new t.n(0,1,0)),this.registerOutput("output",qZ.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(s){const Z=this.particle.getConnectedValue(s);Z._directionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.direction1.getConnectedValue(s),S=this.direction2.getConnectedValue(s),a=(0,G.RandomRange)(j.x,S.x),O=(0,G.RandomRange)(j.y,S.y),v=(0,G.RandomRange)(j.z,S.z);s.isEmitterTransformNode?t.n.TransformNormalFromFloatsToRef(a,O,v,s.emitterWorldMatrix,o.direction):o.direction.Ja(a,O,v)},Z._positionCreation.process=o=>{s.systemContext=Z,s.isEmitterTransformNode?t.n.TransformCoordinatesFromFloatsToRef(0,0,0,s.emitterWorldMatrix,o.position):o.position.O(s.emitterPosition)},this.output._storedValue=Z}});(0,O.f)("BABYLON.CustomShapeBlock",class extends EZ{constructor(s){super(s),this.registerInput("particle",qZ.Particle),this.registerInput("position",qZ.sO,!0,new t.n(0,0,0)),this.registerInput("direction",qZ.sO,!0,new t.n(0,1,0)),this.registerOutput("output",qZ.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(s){const Z=this.particle.getConnectedValue(s);Z._directionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.direction.getConnectedValue(s);s.isEmitterTransformNode?t.n.TransformNormalToRef(j,s.emitterWorldMatrix,o.direction):o.direction.O(j)},Z._positionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.position.getConnectedValue(s);s.isEmitterTransformNode?t.n.TransformCoordinatesToRef(j,s.emitterWorldMatrix,o.position):(o.position.O(j),o.position.addInPlace(s.emitterPosition))},this.output._storedValue=Z}});(0,O.f)("BABYLON.CylinderShapeBlock",class extends EZ{constructor(s){super(s),this._tempVector=t.n.Zero(),this.registerInput("particle",qZ.Particle),this.registerInput("radius",qZ.Float,!0,1),this.registerInput("height",qZ.Float,!0,1,0),this.registerInput("radiusRange",qZ.Float,!0,1,0,1),this.registerInput("directionRandomizer",qZ.Float,!0,0,0,1),this.registerOutput("output",qZ.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(s){const Z=this.particle.getConnectedValue(s);Z._directionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.directionRandomizer.getConnectedValue(s);o.position.subtractToRef(s.emitterPosition,this._tempVector),this._tempVector.normalize(),s.isEmitterTransformNode&&t.n.TransformNormalToRef(this._tempVector,s.emitterInverseWorldMatrix,this._tempVector);const S=(0,G.RandomRange)(-j/2,j/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,G.RandomRange)(-Math.PI/2,Math.PI/2)*j,this._tempVector.y=S,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),s.isEmitterTransformNode?t.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,s.emitterWorldMatrix,o.direction):o.direction.O(this._tempVector)},Z._positionCreation.process=o=>{s.particleContext=o,s.systemContext=Z;const j=this.height.getConnectedValue(s),S=this.radiusRange.getConnectedValue(s),a=this.radius.getConnectedValue(s),O=(0,G.RandomRange)(-j/2,j/2),v=(0,G.RandomRange)(0,2*Math.PI),B=(0,G.RandomRange)((1-S)*(1-S),1),Q=Math.sqrt(B)*a,D=Q*Math.cos(v),z=Q*Math.sin(v);s.isEmitterTransformNode?t.n.TransformCoordinatesFromFloatsToRef(D,O,z,s.emitterWorldMatrix,o.position):(o.position.Ja(D,O,z),o.position.addInPlace(s.emitterPosition))},this.output._storedValue=Z}});class vo extends EZ{constructor(s){super(s),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",qZ.Particle),this.registerOutput("output",qZ.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){super._build(s);const Z=this.particle.getConnectedValue(s);Z._isAnimationSheetEnabled=!0,Z.spriteCellWidth=this.width,Z.spriteCellHeight=this.height,Z.startSpriteCellID=this.start,Z.endSpriteCellID=this.end,Z.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=Z}serialize(){const s=super.serialize();return s.width=this.width,s.height=this.height,s.start=this.start,s.end=this.end,s.randomStartCell=this.randomStartCell,s}_deserialize(s){super._deserialize(s),this.width=s.width,this.height=s.height,this.start=s.start,this.end=s.end,this.randomStartCell=s.randomStartCell}}(0,e.c)([PZ("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],vo.prototype,"start",void 0),(0,e.c)([PZ("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],vo.prototype,"end",void 0),(0,e.c)([PZ("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],vo.prototype,"width",void 0),(0,e.c)([PZ("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],vo.prototype,"height",void 0),(0,e.c)([PZ("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],vo.prototype,"loop",void 0),(0,e.c)([PZ("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],vo.prototype,"randomStartCell",void 0),(0,O.f)("BABYLON.SetupSpriteSheetBlock",vo);class Go extends EZ{constructor(s){super(s),this.reference=0,this.registerInput("value",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=s=>{switch(s){case qZ.Float:return qZ.FloatGradient;case qZ.Vector2:return qZ.Vector2Gradient;case qZ.sO:return qZ.Vector3Gradient;case qZ.nz:return qZ.Color4Gradient}return s},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qZ.Float|qZ.Vector2|qZ.sO|qZ.nz)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=s=>null}serialize(){const s=super.serialize();return s.reference=this.reference,s}_deserialize(s){super._deserialize(s),this.reference=s.reference}}(0,e.c)([PZ("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Go.prototype,"reference",void 0),(0,O.f)("BABYLON.ParticleGradientValueBlock",Go);(0,O.f)("BABYLON.ParticleGradientBlock",class extends EZ{constructor(s){super(s),this._entryCount=1,this.registerInput("gradient",qZ.Float,!0,1,0,1),this.registerInput("value0",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=s=>{switch(s){case qZ.FloatGradient:return qZ.Float;case qZ.Vector2Gradient:return qZ.Vector2;case qZ.Vector3Gradient:return qZ.sO;case qZ.Color4Gradient:return qZ.nz}return s},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(qZ.FloatGradient|qZ.Vector2Gradient|qZ.Vector3Gradient|qZ.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(s){this._inputs[s].onConnectionObservable.add((()=>{this._entryCount>s||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),qZ.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const s=[];for(let o=1;o<this._inputs.length;o++){var Z;if(this._inputs[o].isConnected)s.push(null===(Z=this._inputs[o].connectedPoint)||void 0===Z?void 0:Z.ownerBlock)}s.sort(((s,Z)=>s.reference-Z.reference)),this.output._storedFunction=Z=>{const o=this.gradient.getConnectedValue(Z);if(1===s.length)return s[0].value.getConnectedValue(Z);let j=null;for(let S=s.length-1;S>=0;S--){const O=s[S];if(O.reference<=o){const s=O.value.getConnectedValue(Z);if(j){const S=j.value.getConnectedValue(Z),v=j.reference,B=O.reference,Q=Math.max(0,Math.min(1,(o-B)/(v-B)));switch(this.output.type){case qZ.Float:return(0,G.Lerp)(s,S,Q);case qZ.Vector2:return t.j.Lerp(s,S,Q);case qZ.sO:return t.n.Lerp(s,S,Q);case qZ.nz:return a.h.Lerp(s,S,Q)}}return s}j=O}return 0}}});(0,O.f)("BABYLON.ParticleConverterBlock",class extends EZ{constructor(s){super(s),this.registerInput("color ",qZ.nz,!0),this.registerInput("xyz ",qZ.sO,!0),this.registerInput("xy ",qZ.Vector2,!0),this.registerInput("zw ",qZ.Vector2,!0),this.registerInput("x ",qZ.Float,!0),this.registerInput("y ",qZ.Float,!0),this.registerInput("z ",qZ.Float,!0),this.registerInput("w ",qZ.Float,!0),this.registerOutput("color",qZ.nz),this.registerOutput("xyz",qZ.sO),this.registerOutput("xy",qZ.Vector2),this.registerOutput("zw",qZ.Vector2),this.registerOutput("x",qZ.Float),this.registerOutput("y",qZ.Float),this.registerOutput("z",qZ.Float),this.registerOutput("w",qZ.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(s){return"color "===s?"colorIn":"xyz "===s?"xyzIn":"xy "===s?"xyIn":"zw "===s?"zwIn":"x "===s?"xIn":"y "===s?"yIn":"z "===s?"zIn":"w "===s?"wIn":s}_outputRename(s){switch(s){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return s}}_build(s){super._build(s);const Z=this.xIn,o=this.yIn,j=this.zIn,S=this.wIn,O=this.xyIn,v=this.zwIn,G=this.xyzIn,B=this.colorIn,Q=this.colorOut,D=this.xyzOut,z=this.xyOut,Y=this.zwOut,b=this.xOut,f=this.yOut,A=this.zOut,d=this.wOut,U=s=>{if(B.isConnected)return B.getConnectedValue(s);let t=0,Q=0,D=0,z=0;if(Z.isConnected&&(t=Z.getConnectedValue(s)),o.isConnected&&(Q=o.getConnectedValue(s)),j.isConnected&&(D=j.getConnectedValue(s)),S.isConnected&&(z=S.getConnectedValue(s)),O.isConnected){const Z=O.getConnectedValue(s);Z&&(t=Z.x,Q=Z.y)}if(v.isConnected){const Z=v.getConnectedValue(s);Z&&(D=Z.x,z=Z.y)}if(G.isConnected){const Z=G.getConnectedValue(s);Z&&(t=Z.x,Q=Z.y,D=Z.z)}return new a.h(t,Q,D,z)};Q._storedFunction=s=>U(s),D._storedFunction=s=>{const Z=U(s);return new t.n(Z.r,Z.g,Z.b)},z._storedFunction=s=>{const Z=U(s);return new t.j(Z.r,Z.g)},Y._storedFunction=s=>{const Z=U(s);return new t.j(Z.b,Z.a)},b._storedFunction=s=>U(s).r,f._storedFunction=s=>U(s).g,A._storedFunction=s=>U(s).b,d._storedFunction=s=>U(s).a}}),function(s){s[s.Cos=0]="Cos",s[s.Sin=1]="Sin",s[s.Abs=2]="Abs",s[s.Exp=3]="Exp",s[s.Exp2=4]="Exp2",s[s.Round=5]="Round",s[s.Floor=6]="Floor",s[s.Ceiling=7]="Ceiling",s[s.Sqrt=8]="Sqrt",s[s.Log=9]="Log",s[s.Tan=10]="Tan",s[s.ArcTan=11]="ArcTan",s[s.ArcCos=12]="ArcCos",s[s.ArcSin=13]="ArcSin",s[s.Sign=14]="Sign",s[s.Negate=15]="Negate",s[s.OneMinus=16]="OneMinus",s[s.Reciprocal=17]="Reciprocal",s[s.ToDegrees=18]="ToDegrees",s[s.ToRadians=19]="ToRadians",s[s.Fract=20]="Fract"}(KZ||(KZ={}));class Bo extends EZ{constructor(s){super(s),this.operation=KZ.Cos,this.registerInput("input",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qZ.Float|qZ.Int|qZ.Vector2|qZ.sO|qZ.nz)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){super._build(s);let Z=null;switch(this.operation){case KZ.Cos:Z=s=>Math.cos(s);break;case KZ.Sin:Z=s=>Math.sin(s);break;case KZ.Abs:Z=s=>Math.abs(s);break;case KZ.Exp:Z=s=>Math.exp(s);break;case KZ.Exp2:Z=s=>Math.pow(2,s);break;case KZ.Round:Z=s=>Math.round(s);break;case KZ.Floor:Z=s=>Math.floor(s);break;case KZ.Ceiling:Z=s=>Math.ceil(s);break;case KZ.Sqrt:Z=s=>Math.sqrt(s);break;case KZ.Log:Z=s=>Math.log(s);break;case KZ.Tan:Z=s=>Math.tan(s);break;case KZ.ArcTan:Z=s=>Math.atan(s);break;case KZ.ArcCos:Z=s=>Math.acos(s);break;case KZ.ArcSin:Z=s=>Math.asin(s);break;case KZ.Sign:Z=s=>Math.sign(s);break;case KZ.Negate:Z=s=>-s;break;case KZ.OneMinus:Z=s=>1-s;break;case KZ.Reciprocal:Z=s=>1/s;break;case KZ.ToRadians:Z=s=>s*Math.PI/180;break;case KZ.ToDegrees:Z=s=>180*s/Math.PI;break;case KZ.Fract:Z=s=>s>=0?s-Math.floor(s):s-Math.ceil(s)}if(!Z)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case qZ.Int:case qZ.Float:this.output._storedFunction=s=>{const o=this.input.getConnectedValue(s);return Z(o)};break;case qZ.Vector2:this.output._storedFunction=s=>{const o=this.input.getConnectedValue(s);return new t.j(Z(o.x),Z(o.y))};break;case qZ.sO:this.output._storedFunction=s=>{const o=this.input.getConnectedValue(s);return new t.n(Z(o.x),Z(o.y),Z(o.z))};break;case qZ.nz:this.output._storedFunction=s=>{const o=this.input.getConnectedValue(s);return new a.h(Z(o.r),Z(o.g),Z(o.b),Z(o.a))}}return this}serialize(){const s=super.serialize();return s.operation=this.operation,s}_deserialize(s){super._deserialize(s),this.operation=s.operation}}(0,e.c)([PZ("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:KZ.Cos},{label:"Sin",value:KZ.Sin},{label:"Abs",value:KZ.Abs},{label:"Exp",value:KZ.Exp},{label:"Exp2",value:KZ.Exp2},{label:"Round",value:KZ.Round},{label:"Floor",value:KZ.Floor},{label:"Ceiling",value:KZ.Ceiling},{label:"Sqrt",value:KZ.Sqrt},{label:"Log",value:KZ.Log},{label:"Tan",value:KZ.Tan},{label:"ArcTan",value:KZ.ArcTan},{label:"ArcCos",value:KZ.ArcCos},{label:"ArcSin",value:KZ.ArcSin},{label:"Sign",value:KZ.Sign},{label:"Negate",value:KZ.Negate},{label:"OneMinus",value:KZ.OneMinus},{label:"Reciprocal",value:KZ.Reciprocal},{label:"ToDegrees",value:KZ.ToDegrees},{label:"ToRadians",value:KZ.ToRadians},{label:"Fract",value:KZ.Fract}]})],Bo.prototype,"operation",void 0),(0,O.f)("BABYLON.ParticleTrigonometryBlock",Bo);var Qo,Do=o(12454);class zo extends EZ{constructor(s){super(s),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(qZ.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(qZ.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(qZ.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(qZ.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(qZ.System),this._inputs[0].excludedConnectionPointTypes.push(qZ.Particle),this._inputs[0].excludedConnectionPointTypes.push(qZ.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const Z=s=>{const Z=this.input.getConnectedValue(s);if(this.log.length>=this.stackSize)return Z;if(null===Z||void 0===Z)return this.log.push(["null",""]),Z;switch(this.input.type){case qZ.Vector2:this.log.push([(0,Do.h)(Z,4),Z.toString()]);break;case qZ.sO:this.log.push([(0,Do.l)(Z,4),Z.toString()]);break;case qZ.nz:this.log.push([`{R: ${Z.r.toFixed(4)} G: ${Z.g.toFixed(4)} B: ${Z.b.toFixed(4)} A: ${Z.a.toFixed(4)}}`,Z.toString()]);break;default:this.log.push([Z.toString(),Z.toString()])}return Z};this.output.isConnected?this.output._storedFunction=Z:this.output._storedValue=Z(s)}serialize(){const s=super.serialize();return s.stackSize=this.stackSize,s}_deserialize(s){super._deserialize(s),this.stackSize=s.stackSize}}(0,e.c)([PZ("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],zo.prototype,"stackSize",void 0),(0,O.f)("BABYLON.ParticleDebugBlock",zo);(0,O.f)("BABYLON.ParticleElbowBlock",class extends EZ{constructor(s){super(s),this.registerInput("input",qZ.AutoDetect),this.registerOutput("output",qZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){super._build(s);const Z=this._outputs[0],o=this._inputs[0];Z._storedFunction=s=>o.getConnectedValue(s)}});(0,O.f)("BABYLON.ParticleTeleportInBlock",class extends EZ{get endpoints(){return this._endpoints}constructor(s){super(s),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",qZ.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(s){if(this.getClassName()===s)return!0;for(const Z of this.endpoints)if(Z.isAnAncestorOfType(s))return!0;return!1}isAnAncestorOf(s){for(const Z of this.endpoints){if(Z===s)return!0;if(Z.isAnAncestorOf(s))return!0}return!1}attachToEndpoint(s){s.detach(),this._endpoints.push(s),s._entryPoint=this,s._outputs[0]._typeConnectionSource=this._inputs[0],s._tempEntryPointUniqueId=null,s.name="> "+this.name}detachFromEndpoint(s){const Z=this._endpoints.indexOf(s);-1!==Z&&(this._endpoints.splice(Z,1),s._outputs[0]._typeConnectionSource=null,s._entryPoint=null)}_build(){for(const s of this._endpoints)s.output._storedFunction=s=>this.input.getConnectedValue(s)}});(0,O.f)("BABYLON.ParticleTeleportOutBlock",class extends EZ{constructor(s){super(s),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",qZ.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(s){this.entryPoint&&this.entryPoint.build(s)}clone(){const s=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(s),s}serialize(){var s;const Z=super.serialize();return Z.entryPoint=(null===(s=this.entryPoint)||void 0===s?void 0:s.uniqueId)??"",Z}_deserialize(s){super._deserialize(s),this._tempEntryPointUniqueId=s.entryPoint}}),function(s){s[s.Equal=0]="Equal",s[s.NotEqual=1]="NotEqual",s[s.LessThan=2]="LessThan",s[s.GreaterThan=3]="GreaterThan",s[s.LessOrEqual=4]="LessOrEqual",s[s.GreaterOrEqual=5]="GreaterOrEqual",s[s.Xor=6]="Xor",s[s.Or=7]="Or",s[s.And=8]="And"}(Qo||(Qo={}));class Yo extends EZ{constructor(s){super(s),this.test=Qo.Equal,this.epsilon=0,this.registerInput("left",qZ.Float),this.registerInput("right",qZ.Float,!0,0),this.registerInput("ifTrue",qZ.AutoDetect,!0,1),this.registerInput("ifFalse",qZ.AutoDetect,!0,0),this.registerOutput("output",qZ.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=qZ.Float,this._inputs[0].acceptedConnectionPointTypes.push(qZ.Int),this._inputs[1].acceptedConnectionPointTypes.push(qZ.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const s=s=>{const Z=this.left.getConnectedValue(s),o=this.right.getConnectedValue(s);let t=!1;switch(this.test){case Qo.Equal:t=(0,G.WithinEpsilon)(Z,o,this.epsilon);break;case Qo.NotEqual:t=!(0,G.WithinEpsilon)(Z,o,this.epsilon);break;case Qo.LessThan:t=Z<o+this.epsilon;break;case Qo.GreaterThan:t=Z>o-this.epsilon;break;case Qo.LessOrEqual:t=Z<=o+this.epsilon;break;case Qo.GreaterOrEqual:t=Z>=o-this.epsilon;break;case Qo.Xor:t=!!Z&&!o||!Z&&!!o;break;case Qo.Or:t=!!Z||!!o;break;case Qo.And:t=!!Z&&!!o}return t};this.output._storedFunction=Z=>s(Z)?this.ifTrue.getConnectedValue(Z):this.ifFalse.getConnectedValue(Z)}serialize(){const s=super.serialize();return s.test=this.test,s.epsilon=this.epsilon,s}_deserialize(s){super._deserialize(s),this.test=s.test,void 0!==s.epsilon&&(this.epsilon=s.epsilon)}}(0,e.c)([PZ("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Qo.Equal},{label:"NotEqual",value:Qo.NotEqual},{label:"LessThan",value:Qo.LessThan},{label:"GreaterThan",value:Qo.GreaterThan},{label:"LessOrEqual",value:Qo.LessOrEqual},{label:"GreaterOrEqual",value:Qo.GreaterOrEqual},{label:"Xor",value:Qo.Xor},{label:"Or",value:Qo.Or},{label:"And",value:Qo.And}]})],Yo.prototype,"test",void 0),(0,e.c)([PZ("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Yo.prototype,"epsilon",void 0),(0,O.f)("BABYLON.ParticleConditionBlock",Yo);class bo extends EZ{constructor(s){super(s),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",qZ.Particle),this.registerInput("condition",qZ.Float,!0,0),this.registerInput("system",qZ.System),this.registerOutput("output",qZ.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(s){this._triggerCount=0;const Z=this.input.getConnectedValue(s),o={process:o=>{if(s.particleContext=o,s.systemContext=Z,0!==this.condition.getConnectedValue(s)&&(0===this.limit||this._triggerCount<this.limit)){const t=(new Date).getTime();if(this._previousOne&&t-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=t;const j=this.system.getConnectedValue(s);if(j){const t=TZ(j,s.fZ,o.position);t.jO.addOnce((()=>{this._triggerCount--})),Z.jO.addOnce((()=>{t.dispose()}))}}},previousItem:null,nextItem:null};Z._updateQueueStart?ys(o,Z._updateQueueStart):Z._updateQueueStart=o,this.output._storedValue=Z}serialize(){const s=super.serialize();return s.limit=this.limit,s.delay=this.delay,s}_deserialize(s){super._deserialize(s),void 0!==s.limit&&(this.limit=s.limit),void 0!==s.delay&&(this.delay=s.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,e.c)([PZ("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bo.prototype,"limit",void 0),(0,e.c)([PZ("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bo.prototype,"delay",void 0),(0,O.f)("BABYLON.ParticleTriggerBlock",bo);o(12458),o(12468),o(12484),o(12548)},12527:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneFragment",S="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12493:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneFragmentDeclaration",S="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12567:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneVertex",S="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12552:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneVertexDeclaration",S="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12541:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogFragment",S="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12523:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogFragmentDeclaration",S="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12569:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogVertex",S="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12559:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogVertexDeclaration",S="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12511:(s,Z,o)=>{"use strict";var t=o(11026);const j="helperFunctions",S="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12502:(s,Z,o)=>{"use strict";var t=o(11026);const j="imageProcessingDeclaration",S="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12518:(s,Z,o)=>{"use strict";var t=o(11026);const j="imageProcessingFunctions",S="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12507:(s,Z,o)=>{"use strict";var t=o(11026);const j="logDepthDeclaration",S="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12534:(s,Z,o)=>{"use strict";var t=o(11026);const j="logDepthFragment",S="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12577:(s,Z,o)=>{"use strict";var t=o(11026);const j="logDepthVertex",S="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";t.d.IncludesShadersStoreWGSL[j]||(t.d.IncludesShadersStoreWGSL[j]=S)},12484:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{particlesPixelShaderWGSL:()=>a});var t=o(11026);o(12493),o(12502),o(12507),o(12511),o(12518),o(12523),o(12527),o(12534),o(12541);const j="particlesPixelShader",S="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";t.d.ShadersStoreWGSL[j]||(t.d.ShadersStoreWGSL[j]=S);const a={name:j,shader:S}},12548:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{particlesVertexShaderWGSL:()=>a});var t=o(11026);o(12552),o(12559),o(12507),o(12567),o(12569),o(12577);const j="particlesVertexShader",S="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";t.d.ShadersStoreWGSL[j]||(t.d.ShadersStoreWGSL[j]=S);const a={name:j,shader:S}},12389:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneFragment",S="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12465:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneFragmentDeclaration",S="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12410:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneVertex",S="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12475:(s,Z,o)=>{"use strict";var t=o(11026);const j="clipPlaneVertexDeclaration",S="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12401:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogFragment",S="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12385:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogFragmentDeclaration",S="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12418:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogVertex",S="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12407:(s,Z,o)=>{"use strict";var t=o(11026);const j="fogVertexDeclaration",S="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12378:(s,Z,o)=>{"use strict";var t=o(11026);const j="helperFunctions",S="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12372:(s,Z,o)=>{"use strict";var t=o(11026);const j="imageProcessingDeclaration",S="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12381:(s,Z,o)=>{"use strict";var t=o(11026);const j="imageProcessingFunctions",S="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12376:(s,Z,o)=>{"use strict";var t=o(11026);const j="logDepthDeclaration",S="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12392:(s,Z,o)=>{"use strict";var t=o(11026);const j="logDepthFragment",S="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12427:(s,Z,o)=>{"use strict";var t=o(11026);const j="logDepthVertex",S="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";t.d.IncludesShadersStore[j]||(t.d.IncludesShadersStore[j]=S)},12458:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{particlesPixelShader:()=>a});var t=o(11026);o(12465),o(12372),o(12376),o(12378),o(12381),o(12385),o(12389),o(12392),o(12401);const j="particlesPixelShader",S="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";t.d.ShadersStore[j]||(t.d.ShadersStore[j]=S);const a={name:j,shader:S}},12468:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{particlesVertexShader:()=>a});var t=o(11026);o(12475),o(12407),o(12376),o(12410),o(12418),o(12427);const j="particlesVertexShader",S="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";t.d.ShadersStore[j]||(t.d.ShadersStore[j]=S);const a={name:j,shader:S}},12837:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{FlowGraphGLTFDataProvider:()=>S});var t=o(12802),j=o(12775);class S extends t.e{constructor(s){var Z,o;super();const t=s.glTF,S=(null===(Z=t.animations)||void 0===Z?void 0:Z.map((s=>s._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",j.d,S);const a=(null===(o=t.nodes)||void 0===o?void 0:o.map((s=>s._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",j.d,a)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12717:(s,Z,o)=>{"use strict";o.d(Z,{d:()=>f,h:()=>Y,i:()=>z,l:()=>b});var t=o(10900),j=o(11457),S=o(11174),a=o(12721);const O=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class v{constructor(s,Z){this._gltf=s,this._infoTree=Z}convert(s){let Z,o=this._gltf,t=this._infoTree;if(!s.startsWith("/"))throw new Error("Path must start with a /");const j=s.split("/");if(j.shift(),j[j.length-1].includes(".length")){const s=j[j.length-1].split(".");j.pop(),j.push(...s)}let S=!1;for(const v of j){const j="length"===v;if(j&&!t.__array__)throw new Error(`Path ${s} is invalid`);if(t.__ignoreObjectTree__&&(S=!0),t.__array__&&!j)t=t.__array__;else if(t=t[v],!t)throw new Error(`Path ${s} is invalid`);if(!S)if(void 0===o){if(!O.find((Z=>Z.regex.test(s))))throw new Error(`Path ${s} is invalid`)}else if(!j){var a;o=null===(a=o)||void 0===a?void 0:a[v]}(t.__target__||j)&&(Z=o)}return{object:Z,info:t}}}function G(s,Z,o,t){const j=B(s,Z);return t?j[o][t]:j[o]}function B(s,Z,o){var t,S;return null===(t=s._data)||void 0===t||null===(S=t[(null===o||void 0===o?void 0:o.fillMode)??j.b.MATERIAL_TriangleFillMode])||void 0===S?void 0:S.babylonMaterial}function Q(s,Z){return{offset:{componentsCount:2,type:"Vector2",get:(o,j,S)=>{const a=G(o,S,s,Z);return new t.j(null===a||void 0===a?void 0:a.uOffset,null===a||void 0===a?void 0:a.vOffset)},getTarget:B,set:(o,t,j,S)=>{const a=G(t,S,s,Z);a.uOffset=o.x,a.vOffset=o.y},getPropertyName:[()=>`${s}${Z?"."+Z:""}.uOffset`,()=>`${s}${Z?"."+Z:""}.vOffset`]},rotation:{type:"number",get:(o,t,j)=>{var S;return null===(S=G(o,j,s,Z))||void 0===S?void 0:S.wAng},getTarget:B,set:(o,t,j,S)=>G(t,S,s,Z).wAng=o,getPropertyName:[()=>`${s}${Z?"."+Z:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(o,j,S)=>{const a=G(o,S,s,Z);return new t.j(null===a||void 0===a?void 0:a.uScale,null===a||void 0===a?void 0:a.vScale)},getTarget:B,set:(o,t,j,S)=>{const a=G(t,S,s,Z);a.uScale=o.x,a.vScale=o.y},getPropertyName:[()=>`${s}${Z?"."+Z:""}.uScale`,()=>`${s}${Z?"."+Z:""}.vScale`]}}}const D={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:s=>{var Z,o;return new t.j((null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.orthoLeft)??0,(null===(o=s._babylonCamera)||void 0===o?void 0:o.orthoRight)??0)},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.orthoLeft=s.x,Z._babylonCamera.orthoRight=s.y)},getTarget:s=>s,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:s=>{var Z,o;return new t.j((null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.orthoBottom)??0,(null===(o=s._babylonCamera)||void 0===o?void 0:o.orthoTop)??0)},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.orthoBottom=s.x,Z._babylonCamera.orthoTop=s.y)},getTarget:s=>s,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:s=>{var Z;return null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.maxZ},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.maxZ=s)},getTarget:s=>s,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:s=>{var Z;return null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.OO},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.OO=s)},getTarget:s=>s,getPropertyName:[()=>"OO"]}},perspective:{aspectRatio:{type:"number",get:s=>{var Z;return null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.getEngine().getAspectRatio(s._babylonCamera)},getTarget:s=>s,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:s=>{var Z;return null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.fov},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.fov=s)},getTarget:s=>s,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:s=>{var Z;return null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.maxZ},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.maxZ=s)},getTarget:s=>s,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:s=>{var Z;return null===(Z=s._babylonCamera)||void 0===Z?void 0:Z.OO},set:(s,Z)=>{Z._babylonCamera&&(Z._babylonCamera.OO=s)},getTarget:s=>s,getPropertyName:[()=>"OO"]}}}},nodes:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"sO",get:s=>{var Z;return null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.position},set:(s,Z)=>{var o;return null===(o=Z._babylonTransformNode)||void 0===o?void 0:o.position.O(s)},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:s=>{var Z;return null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.rotationQuaternion},set:(s,Z)=>{var o,t;return null===(o=Z._babylonTransformNode)||void 0===o||null===(t=o.rotationQuaternion)||void 0===t?void 0:t.O(s)},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"sO",get:s=>{var Z;return null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.ZO},set:(s,Z)=>{var o;return null===(o=Z._babylonTransformNode)||void 0===o?void 0:o.ZO.O(s)},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"ZO"]},weights:{length:{type:"number",get:s=>s._numMorphTargets,getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(s,Z)=>{var o,t;return void 0!==Z?null===(o=s._primitiveBabylonMeshes)||void 0===o||null===(t=o[0].morphTargetManager)||void 0===t?void 0:t.getTarget(Z).influence:void 0},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(s,Z)=>[0],getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:s=>{var Z,o,j;return t.b.Compose(null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.ZO,null===(o=s._babylonTransformNode)||void 0===o?void 0:o.rotationQuaternion,null===(j=s._babylonTransformNode)||void 0===j?void 0:j.position)},getTarget:s=>s._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:s=>{var Z,o,j,S;const a=t.b.Identity();let O=s.parent;for(;O&&O.parent;)O=O.parent;const v=(null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.position._isDirty)||(null===(o=s._babylonTransformNode)||void 0===o||null===(j=o.rotationQuaternion)||void 0===j?void 0:j._isDirty)||(null===(S=s._babylonTransformNode)||void 0===S?void 0:S.ZO._isDirty);if(O){var G;const Z=null===(G=O._babylonTransformNode)||void 0===G?void 0:G.Ea(!0).invert();var B,Q;if(Z)null===(B=s._babylonTransformNode)||void 0===B||null===(Q=B.Ea(v))||void 0===Q||Q.multiplyToRef(Z,a)}else s._babylonTransformNode&&a.O(s._babylonTransformNode.Ea(v));return a},getTarget:s=>s._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:s=>{var Z,o;return null===(Z=s._babylonTransformNode)||void 0===Z||null===(o=Z.getChildren((s=>s instanceof a.e),!0)[0])||void 0===o?void 0:o.QO},getTarget:s=>{var Z;return null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.getChildren((s=>s instanceof a.e),!0)[0]},set:(s,Z)=>{if(Z._babylonTransformNode){const o=Z._babylonTransformNode.getChildren((s=>s instanceof a.e),!0)[0];o&&(o.QO=s)}}},color:{type:"pz",get:s=>{var Z,o;return null===(Z=s._babylonTransformNode)||void 0===Z||null===(o=Z.getChildren((s=>s instanceof a.e),!0)[0])||void 0===o?void 0:o.DO},getTarget:s=>{var Z;return null===(Z=s._babylonTransformNode)||void 0===Z?void 0:Z.getChildren((s=>s instanceof a.e),!0)[0]},set:(s,Z)=>{if(Z._babylonTransformNode){const o=Z._babylonTransformNode.getChildren((s=>s instanceof a.e),!0)[0];o&&(o.DO=s)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"pz",get:(s,Z,o)=>B(s,Z,o).emissiveColor,set:(s,Z,o,t)=>B(Z,o,t).emissiveColor.O(s),getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Q("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(s,Z,o)=>{var t;return null===(t=G(s,o,"bumpTexture"))||void 0===t?void 0:t.level},set:(s,Z,o,t)=>{const j=G(Z,t,"bumpTexture");j&&(j.level=s)},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Q("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(s,Z,o)=>B(s,Z,o).ambientTextureStrength,set:(s,Z,o,t)=>{const j=B(Z,o,t);j&&(j.ambientTextureStrength=s)},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Q("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"nz",get:(s,Z,o)=>{const t=B(s,Z,o);return S.h.FromColor3(t.albedoColor,t.alpha)},set:(s,Z,o,t)=>{const j=B(Z,o,t);j.albedoColor.set(s.r,s.g,s.b),j.alpha=s.a},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Q("albedoTexture")}},metallicFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).metallic,set:(s,Z,o,t)=>{const j=B(Z,o,t);j&&(j.metallic=s)},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).roughness,set:(s,Z,o,t)=>{const j=B(Z,o,t);j&&(j.roughness=s)},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Q("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(s,Z,o)=>B(s,Z,o).anisotropy.QO,set:(s,Z,o,t)=>{B(Z,o,t).anisotropy.QO=s},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(s,Z,o)=>B(s,Z,o).anisotropy.angle,set:(s,Z,o,t)=>{B(Z,o,t).anisotropy.angle=s},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Q("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).clearCoat.QO,set:(s,Z,o,t)=>{B(Z,o,t).clearCoat.QO=s},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).clearCoat.roughness,set:(s,Z,o,t)=>{B(Z,o,t).clearCoat.roughness=s},getTarget:(s,Z,o)=>B(s,Z,o),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Q("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(s,Z,o)=>{var t;return null===(t=B(s,Z,o).clearCoat.bumpTexture)||void 0===t?void 0:t.level},getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).clearCoat.bumpTexture.level=s},extensions:{KHR_texture_transform:Q("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Q("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(s,Z,o)=>B(s,Z,o).subSurface.dispersion,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).subSurface.dispersion=s}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(s,Z,o)=>B(s,Z,o).emissiveIntensity,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).emissiveIntensity=s}},KHR_materials_ior:{ior:{type:"number",get:(s,Z,o)=>B(s,Z,o).indexOfRefraction,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).indexOfRefraction=s}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).iridescence.QO,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).iridescence.QO=s},iridescenceIor:{type:"number",get:(s,Z,o)=>B(s,Z,o).iridescence.indexOfRefraction,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).iridescence.indexOfRefraction=s},iridescenceTexture:{extensions:{KHR_texture_transform:Q("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(s,Z,o)=>B(s,Z,o).iridescence.maximumThickness,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).iridescence.maximumThickness=s},iridescenceThicknessMinimum:{type:"number",get:(s,Z,o)=>B(s,Z,o).iridescence.minimumThickness,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).iridescence.minimumThickness=s},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Q("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"pz",get:(s,Z,o)=>B(s,Z,o).sheen.color,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).sheen.color.O(s)},sheenColorTexture:{extensions:{KHR_texture_transform:Q("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).sheen.QO,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).sheen.QO=s},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Q("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).metallicF0Factor,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).metallicF0Factor=s,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"pz",get:(s,Z,o)=>B(s,Z,o).metallicReflectanceColor,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).metallicReflectanceColor.O(s),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Q("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Q("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).subSurface.refractionIntensity,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).subSurface.refractionIntensity=s,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).subSurface.translucencyIntensity,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).subSurface.translucencyIntensity=s},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"pz",get:(s,Z,o)=>B(s,Z,o).subSurface.translucencyColor,getTarget:B,set:(s,Z,o,t)=>{var j;return s&&(null===(j=B(Z,o,t).subSurface.translucencyColor)||void 0===j?void 0:j.O(s))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"pz",get:(s,Z,o)=>B(s,Z,o).subSurface.tintColor,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).subSurface.tintColor.O(s)},attenuationDistance:{type:"number",get:(s,Z,o)=>B(s,Z,o).subSurface.tintColorAtDistance,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).subSurface.tintColorAtDistance=s},thicknessFactor:{type:"number",get:(s,Z,o)=>B(s,Z,o).subSurface.maximumThickness,getTarget:B,set:(s,Z,o,t)=>B(Z,o,t).subSurface.maximumThickness=s},thicknessTexture:{extensions:{KHR_texture_transform:Q("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonLight)),getPropertyName:[s=>"length"]},__array__:{__target__:!0,color:{type:"pz",get:s=>{var Z;return null===(Z=s._babylonLight)||void 0===Z?void 0:Z.DO},set:(s,Z)=>{var o;return null===(o=Z._babylonLight)||void 0===o?void 0:o.DO.O(s)},getTarget:s=>s._babylonLight,getPropertyName:[s=>"diffuse"]},QO:{type:"number",get:s=>{var Z;return null===(Z=s._babylonLight)||void 0===Z?void 0:Z.QO},set:(s,Z)=>Z._babylonLight?Z._babylonLight.QO=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"intensity"]},range:{type:"number",get:s=>{var Z;return null===(Z=s._babylonLight)||void 0===Z?void 0:Z.range},set:(s,Z)=>Z._babylonLight?Z._babylonLight.range=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"range"]},spot:{innerConeAngle:{type:"number",get:s=>{var Z;return null===(Z=s._babylonLight)||void 0===Z?void 0:Z.innerAngle},set:(s,Z)=>Z._babylonLight?Z._babylonLight.innerAngle=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"innerConeAngle"]},outerConeAngle:{type:"number",get:s=>{var Z;return null===(Z=s._babylonLight)||void 0===Z?void 0:Z.angle},set:(s,Z)=>Z._babylonLight?Z._babylonLight.angle=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonLight)),getPropertyName:[s=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonTexture)),getPropertyName:[s=>"length"]},__array__:{__target__:!0,QO:{type:"number",get:s=>{var Z;return null===(Z=s._babylonTexture)||void 0===Z?void 0:Z.level},set:(s,Z)=>{Z._babylonTexture&&(Z._babylonTexture.level=s)},getTarget:s=>s._babylonTexture},rotation:{type:"Quaternion",get:s=>{var Z;return s._babylonTexture&&t.e.FromRotationMatrix(null===(Z=s._babylonTexture)||void 0===Z?void 0:Z.getReflectionTextureMatrix())},set:(s,Z)=>{var o;Z._babylonTexture&&(null!==(o=Z._babylonTexture.Ls())&&void 0!==o&&o.useRightHandedSystem||(s=t.e.Inverse(s)),t.b.FromQuaternionToRef(s,Z._babylonTexture.getReflectionTextureMatrix()))},getTarget:s=>s._babylonTexture}}}}},animations:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>{var Z;return null===(Z=s.primitives[0]._instanceData)||void 0===Z?void 0:Z.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function z(s){return new v(s,D)}function Y(s){const Z=s.split("/").map((s=>s.replace(/{}/g,"__array__")));let o=D;for(const t of Z)t&&(o=o[t]);if(o&&o.type&&o.get)return o}function b(s,Z){const o=s.split("/").map((s=>s.replace(/{}/g,"__array__")));let t=D;for(const j of o)j&&(t=t[j]);t&&t.type&&t.get&&(t.interpolation=Z)}function f(s,Z){const o=s.split("/").map((s=>s.replace(/{}/g,"__array__")));let t=D;for(const j of o)if(j){if(!t[j]){if("?"===j){t.__ignoreObjectTree__=!0;continue}t[j]={},"__array__"===j&&(t[j].__target__=!0)}t=t[j]}Object.assign(t,Z)}},12730:(s,Z,o)=>{"use strict";o.r(Z),o.d(Z,{AnimationPropertyInfo:()=>G,TransformNodeAnimationPropertyInfo:()=>B,WeightAnimationPropertyInfo:()=>Q,getQuaternion:()=>O,getVector3:()=>a,getWeights:()=>v});var t=o(11611),j=o(10900),S=o(12717);function a(s,Z,o,t){return j.n.oO(Z,o).scaleInPlace(t)}function O(s,Z,o,t){return j.e.oO(Z,o).scaleInPlace(t)}function v(s,Z,o,t){const j=new Array(s._numMorphTargets);for(let S=0;S<j.length;S++)j[S]=Z[o++]*t;return j}class G{constructor(s,Z,o,t){this.type=s,this.name=Z,this.getValue=o,this.getStride=t}_buildAnimation(s,Z,o){const j=new t.e(s,this.name,Z,this.type);return j.setKeys(o),j}}class B extends G{buildAnimations(s,Z,o,t){const j=[];return j.push({babylonAnimatable:s._babylonTransformNode,babylonAnimation:this._buildAnimation(Z,o,t)}),j}}class Q extends G{buildAnimations(s,Z,o,j){const S=[];if(s._numMorphTargets)for(let a=0;a<s._numMorphTargets;a++){const O=new t.e(`${Z}_${a}`,this.name,o,this.type);if(O.setKeys(j.map((s=>({frame:s.frame,inTangent:s.inTangent?s.inTangent[a]:void 0,value:s.value[a],outTangent:s.outTangent?s.outTangent[a]:void 0,interpolation:s.interpolation})))),s._primitiveBabylonMeshes)for(const Z of s._primitiveBabylonMeshes)if(Z.morphTargetManager){const s=Z.morphTargetManager.getTarget(a),o=O.clone();s.animations.push(o),S.push({babylonAnimatable:s,babylonAnimation:o})}}return S}}(0,S.l)("/nodes/{}/translation",[new B(t.e.ANIMATIONTYPE_VECTOR3,"position",a,(()=>3))]),(0,S.l)("/nodes/{}/rotation",[new B(t.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",O,(()=>4))]),(0,S.l)("/nodes/{}/scale",[new B(t.e.ANIMATIONTYPE_VECTOR3,"ZO",a,(()=>3))]),(0,S.l)("/nodes/{}/weights",[new Q(t.e.ANIMATIONTYPE_FLOAT,"influence",v,(s=>s._numMorphTargets))])},12687:(s,Z,o)=>{"use strict";class t{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((s,Z)=>{this._resolve=s,this._reject=Z}))}}var j=o(10900),S=o(11174),a=o(10938),O=o(11246),v=o(12690),G=o(12699),B=o(10932),Q=o(11451),D=o(11611),z=o(11614),Y=o(10927),b=o(10955),f=o(10964);class A{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(s){this._useTextureToStoreBoneMatrices=s,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(s){this._animationPropertiesOverride=s}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(s,Z,o){this.name=s,this.id=Z,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=j.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new B.b,this.bones=[],this._scene=o||Y.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const t=this._scene.getEngine().getCaps();this._canUseTextureForBones=t.textureFloat&&t.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((s=>!s.getParent()))}getTransformMatrices(s){if(this.needInitialSkinMatrix){if(!s)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return s._bonesTransformMatrices||this.prepare(!0),s._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(s){return this.needInitialSkinMatrix&&s._transformMatrixTexture?s._transformMatrixTexture:this._transformMatrixTexture}Ls(){return this._scene}toString(s){let Z=`Name: ${this.name}, nBones: ${this.bones.length}`;if(Z+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,s){Z+=", Ranges: {";let s=!0;for(const o in this._ranges)s&&(Z+=", ",s=!1),Z+=o;Z+="}"}return Z}getBoneIndexByName(s){for(let Z=0,o=this.bones.length;Z<o;Z++)if(this.bones[Z].name===s)return Z;return-1}createAnimationRange(s,Z,o){if(!this._ranges[s]){this._ranges[s]=new z.e(s,Z,o);for(let t=0,j=this.bones.length;t<j;t++)this.bones[t].animations[0]&&this.bones[t].animations[0].createRange(s,Z,o)}}deleteAnimationRange(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let o=0,t=this.bones.length;o<t;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].deleteRange(s,Z);this._ranges[s]=null}getAnimationRange(s){return this._ranges[s]||null}getAnimationRanges(){const s=[];let Z;for(Z in this._ranges)s.push(this._ranges[Z]);return s}copyAnimationRange(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[Z]||!s.getAnimationRange(Z))return!1;let t=!0;const j=this._getHighestAnimationFrame()+1,S={},a=s.bones;let O,v;for(v=0,O=a.length;v<O;v++)S[a[v].name]=a[v];this.bones.length!==a.length&&(b.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${a.length}`),t=!1);const G=o&&this.dimensionsAtRest&&s.dimensionsAtRest?this.dimensionsAtRest.divide(s.dimensionsAtRest):null;for(v=0,O=this.bones.length;v<O;v++){const s=this.bones[v].name,a=S[s];a?t=t&&this.bones[v].copyAnimationRange(a,Z,j,o,G):(b.b.Warn("copyAnimationRange: not same rig, missing source bone "+s),t=!1)}const B=s.getAnimationRange(Z);return B&&(this._ranges[Z]=new z.e(Z,B.from+j,B.to+j)),t}returnToRest(){for(const s of this.bones)-1!==s._index&&s.returnToRest()}_getHighestAnimationFrame(){let s=0;for(let Z=0,o=this.bones.length;Z<o;Z++)if(this.bones[Z].animations[0]){const o=this.bones[Z].animations[0].getHighestFrame();s<o&&(s=o)}return s}beginAnimation(s,Z,o,t){const j=this.getAnimationRange(s);return j?this._scene.beginAnimation(this,j.from,j.to,Z,o,t):null}static MakeAnimationAdditive(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const t=s.getAnimationRange(o);if(!t)return null;const j=s._scene.getAllAnimatablesByTarget(s);let S=null;for(let O=0;O<j.length;O++){const s=j[O];if(s.fromFrame===(null===t||void 0===t?void 0:t.from)&&s.toFrame===(null===t||void 0===t?void 0:t.to)){S=s;break}}const a=s.getAnimatables();for(let O=0;O<a.length;O++){const s=a[O].animations;if(s)for(let t=0;t<s.length;t++)D.e.MakeAnimationAdditive(s[t],Z,o)}return S&&(S.isAdditive=!0),s}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(s){this._meshesWithPoseMatrix.push(s)}_unregisterMeshWithPoseMatrix(s){const Z=this._meshesWithPoseMatrix.indexOf(s);Z>-1&&this._meshesWithPoseMatrix.splice(Z,1)}_computeTransformMatrices(s,Z){this.onBeforeComputeObservable.notifyObservers(this);for(let o=0;o<this.bones.length;o++){const t=this.bones[o];t._childUpdateId++;const j=t.getParent();if(j?t.getLocalMatrix().multiplyToRef(j.getFinalMatrix(),t.getFinalMatrix()):Z?t.getLocalMatrix().multiplyToRef(Z,t.getFinalMatrix()):t.getFinalMatrix().O(t.getLocalMatrix()),-1!==t._index){const Z=null===t._index?o:t._index;t.getAbsoluteInverseBindMatrix().multiplyToArray(t.getFinalMatrix(),s,16*Z)}}this._identity.copyToArray(s,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const s=this.Ls().getRenderId();if(this._currentRenderId===s)return;this._currentRenderId=s}if(this._numBonesWithLinkedTransformNode>0)for(const s of this.bones)if(s._linkedTransformNode){const Z=s._linkedTransformNode;s.position=Z.position,Z.rotationQuaternion?s.rotationQuaternion=Z.rotationQuaternion:s.rotation=Z.rotation,s.ZO=Z.ZO}if(this.needInitialSkinMatrix)for(const s of this._meshesWithPoseMatrix){const Z=s.getPoseMatrix();let o=this._isDirty;if(s._bonesTransformMatrices&&s._bonesTransformMatrices.length===16*(this.bones.length+1)||(s._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),o=!0),o){if(this._synchronizedWithMesh!==s){this._synchronizedWithMesh=s;for(const s of this.bones)if(!s.getParent()){s.getBindMatrix().multiplyToRef(Z,j.g.Matrix[1]),s._updateAbsoluteBindMatrices(j.g.Matrix[1])}if(this.isUsingTextureForMatrices){const Z=4*(this.bones.length+1);s._transformMatrixTexture&&s._transformMatrixTexture.getSize().width===Z||(s._transformMatrixTexture&&s._transformMatrixTexture.dispose(),s._transformMatrixTexture=Q.b.CreateRGBATexture(s._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(s._bonesTransformMatrices,Z),this.isUsingTextureForMatrices&&s._transformMatrixTexture&&s._transformMatrixTexture.update(s._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Q.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let s=0;s<this.bones.length;s++)this._animatables.push(this.bones[s])}return this._animatables}clone(s,Z){const o=new A(s,Z||s,this._scene);o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const s=this.bones[t];let Z=null;const j=s.getParent();if(j){const s=this.bones.indexOf(j);Z=o.bones[s]}const S=new G.c(s.name,o,Z,s.getBindMatrix().clone(),s.getRestMatrix().clone());S._index=s._index,s._linkedTransformNode&&S.linkTransformNode(s._linkedTransformNode),f.c.DeepCopy(s.animations,S.animations)}if(this._ranges){o._ranges={};for(const s in this._ranges){const Z=this._ranges[s];Z&&(o._ranges[s]=Z.clone())}}return this._isDirty=!0,o.prepare(!0),o}enableBlending(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const Z of this.bones)for(const o of Z.animations)o.enableBlending=!0,o.blendingSpeed=s}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ls().stopAnimation(this),this.Ls().removeSkeleton(this),this._parentContainer){const s=this._parentContainer.skeletons.indexOf(this);s>-1&&this._parentContainer.skeletons.splice(s,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const s={};s.name=this.name,s.id=this.id,this.dimensionsAtRest&&(s.dimensionsAtRest=this.dimensionsAtRest.ma()),s.bones=[],s.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){var Z;const t=this.bones[o],j=t.getParent(),S={parentBoneIndex:j?this.bones.indexOf(j):-1,index:t.getIndex(),name:t.name,id:t.id,matrix:t.getBindMatrix().ma(),rest:t.getRestMatrix().ma(),linkedTransformNodeId:null===(Z=t.getTransformNode())||void 0===Z?void 0:Z.id};s.bones.push(S),t.length&&(S.length=t.length),t.metadata&&(S.metadata=t.metadata),t.animations&&t.animations.length>0&&(S.animation=t.animations[0].serialize()),s.ranges=[];for(const Z in this._ranges){const o=this._ranges[Z];if(!o)continue;const t={};t.name=Z,t.from=o.from,t.to=o.to,s.ranges.push(t)}}return s}static Parse(s,Z){const o=new A(s.name,s.id,Z);let t;for(s.dimensionsAtRest&&(o.dimensionsAtRest=j.n.oO(s.dimensionsAtRest)),o.needInitialSkinMatrix=s.needInitialSkinMatrix,t=0;t<s.bones.length;t++){const Z=s.bones[t],S=s.bones[t].index;let a=null;Z.parentBoneIndex>-1&&(a=o.bones[Z.parentBoneIndex]);const O=Z.rest?j.b.oO(Z.rest):null,v=new G.c(Z.name,o,a,j.b.oO(Z.matrix),O,null,S);void 0!==Z.id&&null!==Z.id&&(v.id=Z.id),Z.length&&(v.length=Z.length),Z.metadata&&(v.metadata=Z.metadata),Z.animation&&v.animations.push(D.e.Parse(Z.animation)),void 0!==Z.linkedTransformNodeId&&null!==Z.linkedTransformNodeId&&(o._hasWaitingData=!0,v._waitingTransformNodeId=Z.linkedTransformNodeId)}if(s.ranges)for(t=0;t<s.ranges.length;t++){const Z=s.ranges[t];o.createAnimationRange(Z.name,Z.from,Z.to)}return o}computeAbsoluteMatrices(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||s)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(s)}getPoseMatrix(){let s=null;return this._meshesWithPoseMatrix.length>0&&(s=this._meshesWithPoseMatrix[0].getPoseMatrix()),s}sortBones(){const s=[],Z=new Array(this.bones.length);for(let o=0;o<this.bones.length;o++)this._sortBones(o,s,Z);this.bones=s}_sortBones(s,Z,o){if(o[s])return;o[s]=!0;const t=this.bones[s];if(!t)return;void 0===t._index&&(t._index=s);const j=t.getParent();j&&this._sortBones(this.bones.indexOf(j),Z,o),Z.push(t)}setCurrentPoseAsRest(){for(const s of this.bones)s.setCurrentPoseAsRest()}}var d=o(11081),U=o(11475),u=o(11410),H=o(11197),F=o(11113),i=o(11273),N=o(11206),L=o(11240),V=o(11619),g=o(11253),l=o(12660);class R{set areUpdatesFrozen(s){s?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new g.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,s||(s=Y.c.LastCreatedScene),this._scene=s,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const s=this._scene.getEngine().getCaps();this._canUseTextureForTargets=s.canUseGLVertexID&&s.textureFloat&&s.maxVertexTextureImageUnits>0&&s.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return R.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?R.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(s){this._numMaxInfluencers!==s&&(this._numMaxInfluencers=s,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(s){this._useTextureToStoreTargets!==s&&(this._useTextureToStoreTargets=s,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var s;return R.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(s=this._scene)&&void 0!==s&&s.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(s){return this._activeTargets.data[s]}getTarget(s){return this._targets[s]}getTargetByName(s){for(const Z of this._targets)if(Z.name===s)return Z;return null}addTarget(s){this._targets.push(s),this._targetInfluenceChangedObservers.push(s.onInfluenceChanged.add((s=>{this.areUpdatesFrozen&&s&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(s)}))),this._targetDataLayoutChangedObservers.push(s._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(s){const Z=this._targets.indexOf(s);Z>=0&&(this._targets.splice(Z,1),s.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(Z,1)[0]),s._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(Z,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(s)}_bind(s){s.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),s.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),s.setTexture("morphTargets",this._targetStoreTexture),s.setInt("morphTargetCount",this.numInfluencers)}clone(){const s=new R(this._scene);for(const Z of this._targets)s.addTarget(Z.clone());return s.enablePositionMorphing=this.enablePositionMorphing,s.enableNormalMorphing=this.enableNormalMorphing,s.enableTangentMorphing=this.enableTangentMorphing,s.enableUVMorphing=this.enableUVMorphing,s.enableUV2Morphing=this.enableUV2Morphing,s.enableColorMorphing=this.enableColorMorphing,s}serialize(){const s={};s.id=this.uniqueId,s.targets=[];for(const Z of this._targets)s.targets.push(Z.serialize());return s}_syncActiveTargets(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const Z=!!this._targetStoreTexture,o=this.isUsingTextureForTargets;(this._mustSynchronize||Z!==o)&&(this._mustSynchronize=!1,this.synchronize());let t=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let j=-1;for(const S of this._targets)if(j++,0!==S.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=R.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(S),this._morphTargetTextureIndices[t]=j,this._tempInfluences[t++]=S.influence}this._morphTargetTextureIndices.length!==t&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,t)),this._influences&&this._influences.length===t||(this._influences=new Float32Array(t));for(let S=0;S<t;S++)this._influences[S]=this._tempInfluences[S];if(s&&this._scene)for(const S of this._scene.meshes)S.morphTargetManager===this&&(o?S._markSubMeshesAsAttributesDirty():S._syncGeometryWithMorphTargetManager())}synchronize(){var s;if(!this._scene||this.areUpdatesFrozen)return;const Z=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(s=this._targetStoreTexture)||void 0===s||s.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>Z.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const o of this._targets){this._supportsPositions=this._supportsPositions&&o.hasPositions,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs,this._supportsUV2s=this._supportsUV2s&&o.hasUV2s,this._supportsColors=this._supportsColors&&o.hasColors;const s=o.vertexCount;if(0===this._vertexCount)this._vertexCount=s;else if(this._vertexCount!==s)return void b.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${o.name}": ${s}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const s=Z.getCaps().maxTextureSize;this._textureWidth>s&&(this._textureHeight=Math.ceil(this._textureWidth/s),this._textureWidth=s);const o=this._targets.length,t=new Float32Array(o*this._textureWidth*this._textureHeight*4);let j=0;for(let Z=0;Z<o;Z++){const s=this._targets[Z],o=s.getPositions(),S=s.getNormals(),a=s.getUVs(),O=s.getTangents(),v=s.getUV2s(),G=s.getColors();j=Z*this._textureWidth*this._textureHeight*4;for(let Z=0;Z<this._vertexCount;Z++)this._supportsPositions&&o&&(t[j]=o[3*Z],t[j+1]=o[3*Z+1],t[j+2]=o[3*Z+2],j+=4),this._supportsNormals&&S&&(t[j]=S[3*Z],t[j+1]=S[3*Z+1],t[j+2]=S[3*Z+2],j+=4),this._supportsUVs&&a&&(t[j]=a[2*Z],t[j+1]=a[2*Z+1],j+=4),this._supportsTangents&&O&&(t[j]=O[3*Z],t[j+1]=O[3*Z+1],t[j+2]=O[3*Z+2],j+=4),this._supportsUV2s&&v&&(t[j]=v[2*Z],t[j+1]=v[2*Z+1],j+=4),this._supportsColors&&G&&(t[j]=G[4*Z],t[j+1]=G[4*Z+1],t[j+2]=G[4*Z+2],t[j+3]=G[4*Z+3],j+=4)}this._targetStoreTexture=l.b.CreateRGBATexture(t,this._textureWidth,this._textureHeight,o,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const o of this._scene.meshes)o.morphTargetManager===this&&o._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const s=this._parentContainer.morphTargetManagers.indexOf(this);s>-1&&this._parentContainer.morphTargetManagers.splice(s,1),this._parentContainer=null}for(const s of this._targets)this._scene.stopAnimation(s)}}static Parse(s,Z){const o=new R(Z);for(const t of s.targets)o.addTarget(V.e.Parse(t,Z));return o}}R.EnableTextureStorage=!0,R.MaxActiveMorphTargetsInVertexAttributeMode=8,R.ConstantTargetCountForTextureMode=0;var e=o(12708),c=o(10982),w=o(11130);const X=new Map,W=X;function q(s,Z,o){h(s)&&b.b.Warn(`Extension with the name '${s}' already exists`),X.set(s,{isGLTFExtension:Z,factory:o})}function h(s){return X.delete(s)}var M=o(12717),x=o(11683),k=o(11122);class y{static Get(s,Z,o){if(!Z||void 0==o||!Z[o])throw new Error(`${s}: Failed to find index (${o})`);return Z[o]}static TryGet(s,Z){return s&&void 0!=Z&&s[Z]?s[Z]:null}static Assign(s){if(s)for(let Z=0;Z<s.length;Z++)s[Z].index=Z}}function I(s){if(s.min&&s.max){const Z=s.min,o=s.max,t=j.g.sO[0].Ja(Z[0],Z[1],Z[2]),S=j.g.sO[1].Ja(o[0],o[1],o[2]);if(s.normalized&&5126!==s.componentType){let Z=1;switch(s.componentType){case 5120:Z=127;break;case 5121:Z=255;break;case 5122:Z=32767;break;case 5123:Z=65535}const o=1/Z;t.scaleInPlace(o),S.scaleInPlace(o)}return new w.e(t,S)}return null}class C{static RegisterExtension(s,Z){q(s,!1,Z)}static UnregisterExtension(s){return h(s)}get aO(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(s){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=s}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((s=>s.dispose&&s.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(s,Z,o,t,j,S){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=Z,this._assetContainer=o,this._loadData(t);let S=null;if(s){const Z={};if(this._gltf.nodes)for(const s of this._gltf.nodes)s.name&&(Z[s.name]=s.index);S=(s instanceof Array?s:[s]).map((s=>{const o=Z[s];if(void 0===o)throw new Error(`Failed to find node '${s}'`);return o}))}return await this._loadAsync(j,a,S,(()=>({meshes:this._getMeshes(),gQ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=s,this._loadData(Z),await this._loadAsync(o,j,null,(()=>{}))}async _loadAsync(s,Z,o,t){return await Promise.resolve().then((async()=>{this._rootUrl=s,this._uniqueRootUrl=!s.startsWith("file:")&&Z?s:`${s}${Date.now()}/`,this._fileName=Z,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const j=`${e.n[e.n.LOADING]} => ${e.n[e.n.READY]}`,S=`${e.n[e.n.LOADING]} => ${e.n[e.n.COMPLETE]}`;this._parent._startPerformanceCounter(j),this._parent._startPerformanceCounter(S),this._parent._setState(e.n.LOADING),this._extensionsOnLoading();const O=new Array;if(!this.parent.loadOnlyMaterials)if(o)O.push(this.loadSceneAsync("/nodes",{nodes:o,index:-1}));else if(void 0!=this._gltf.fZ||this._gltf.scenes&&this._gltf.scenes[0]){const s=y.Get("/scene",this._gltf.scenes,this._gltf.fZ||0);O.push(this.loadSceneAsync(`/scenes/${s.index}`,s))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let s=0;s<this._gltf.materials.length;++s){const Z=this._gltf.materials[s],o="/materials/"+s,t=d.c.TriangleFillMode;O.push(this._loadMaterialAsync(o,Z,null,t,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&O.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&O.push(this._compileShadowGeneratorsAsync());const v=Promise.all(O).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.iO(!0);for(const s of this._babylonScene.materials){const Z=s;void 0!==Z.maxSimultaneousLights&&(Z.maxSimultaneousLights=Math.max(Z.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(e.n.READY),this._skipStartAnimationStep||this._startAnimations(),t()}));return await v.then((s=>(this._parent._endPerformanceCounter(j),a.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(S),this._parent._setState(e.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(s=>{this._parent.onErrorObservable.notifyObservers(s),this._parent.onErrorObservable.clear(),this.dispose()}))})),s)))})).catch((s=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(s),this._parent.onErrorObservable.clear(),this.dispose()),s}))}_loadData(s){if(this._gltf=s.json,this._setupData(),s.bin){const Z=this._gltf.buffers;if(Z&&Z[0]&&!Z[0].uri){const o=Z[0];(o.byteLength<s.bin.byteLength-3||o.byteLength>s.bin.byteLength)&&b.b.Warn(`Binary buffer length (${o.byteLength}) from JSON does not match chunk length (${s.bin.byteLength})`),this._bin=s.bin}else b.b.Warn("Unexpected BIN chunk")}}_setupData(){if(y.Assign(this._gltf.accessors),y.Assign(this._gltf.animations),y.Assign(this._gltf.buffers),y.Assign(this._gltf.bufferViews),y.Assign(this._gltf.cameras),y.Assign(this._gltf.images),y.Assign(this._gltf.materials),y.Assign(this._gltf.meshes),y.Assign(this._gltf.nodes),y.Assign(this._gltf.samplers),y.Assign(this._gltf.scenes),y.Assign(this._gltf.skins),y.Assign(this._gltf.textures),this._gltf.nodes){const s={};for(const o of this._gltf.nodes)if(o.children)for(const Z of o.children)s[Z]=o.index;const Z=this._createRootNode();for(const o of this._gltf.nodes){const t=s[o.index];o.parent=void 0===t?Z:this._gltf.nodes[t]}}}async _loadExtensionsAsync(){const s=[];if(W.forEach(((Z,o)=>{var t;!1===(null===(t=this.parent.extensionOptions[o])||void 0===t?void 0:t.enabled)?Z.isGLTFExtension&&this.isExtensionUsed(o)&&b.b.Warn(`Extension ${o} is used but has been explicitly disabled.`):Z.isGLTFExtension&&!this.isExtensionUsed(o)||s.push((async()=>{const s=await Z.factory(this);return s.name!==o&&b.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${s.name} !== ${o}`),this._parent.onExtensionLoadedObservable.notifyObservers(s),s})())})),this._extensions.push(...await Promise.all(s)),this._extensions.sort(((s,Z)=>(s.order||Number.MAX_VALUE)-(Z.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const o of this._gltf.extensionsRequired){if(!this._extensions.some((s=>s.name===o&&s.enabled))){var Z;if(!1===(null===(Z=this.parent.extensionOptions[o])||void 0===Z?void 0:Z.enabled))throw new Error(`Required extension ${o} is disabled`);throw new Error(`Required extension ${o} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new L.d("__root__",this._babylonScene);this._rootBabylonMesh=s,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.iO(!1);const Z={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case e.j.AUTO:this._babylonScene.useRightHandedSystem||(Z.rotation=[0,1,0,0],Z.scale=[1,1,-1],C._LoadTransform(Z,this._rootBabylonMesh));break;case e.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(s),Z}loadSceneAsync(s,Z){const o=this._extensionsLoadSceneAsync(s,Z);if(o)return o;const t=new Array;if(this.logOpen(`${s} ${Z.name||""}`),Z.nodes)for(const j of Z.nodes){const Z=y.Get(`${s}/nodes/${j}`,this._gltf.nodes,j);t.push(this.loadNodeAsync(`/nodes/${Z.index}`,Z,(s=>{s.parent=this._rootBabylonMesh})))}for(const j of this._postSceneLoadActions)j();return t.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(t).then((()=>{}))}_forEachPrimitive(s,Z){if(s._primitiveBabylonMeshes)for(const o of s._primitiveBabylonMeshes)Z(o)}_getGeometries(){const s=[],Z=this._gltf.nodes;if(Z)for(const o of Z)this._forEachPrimitive(o,(Z=>{const o=Z.Pa;o&&-1===s.indexOf(o)&&s.push(o)}));return s}_getMeshes(){const s=[];this._rootBabylonMesh instanceof N.b&&s.push(this._rootBabylonMesh);const Z=this._gltf.nodes;if(Z)for(const o of Z)this._forEachPrimitive(o,(Z=>{s.push(Z)}));return s}_getTransformNodes(){const s=[],Z=this._gltf.nodes;if(Z)for(const o of Z)o._babylonTransformNode&&"dY"===o._babylonTransformNode.getClassName()&&s.push(o._babylonTransformNode),o._babylonTransformNodeForSkin&&s.push(o._babylonTransformNodeForSkin);return s}_getSkeletons(){const s=[],Z=this._gltf.skins;if(Z)for(const o of Z)o._data&&s.push(o._data.babylonSkeleton);return s}_getAnimationGroups(){const s=[],Z=this._gltf.animations;if(Z)for(const o of Z)o._babylonAnimationGroup&&s.push(o._babylonAnimationGroup);return s}_startAnimations(){switch(this._parent.animationStartMode){case e.f.NONE:break;case e.f.FIRST:{const s=this._getAnimationGroups();0!==s.length&&s[0].start(!0);break}case e.f.ALL:{const s=this._getAnimationGroups();for(const Z of s)Z.start(!0);break}default:return void b.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadNodeAsync(s,Z,o);if(t)return t;if(Z._babylonTransformNode)throw new Error(`${s}: Invalid recursive node hierarchy`);const j=new Array;this.logOpen(`${s} ${Z.name||""}`);const S=t=>{if(C.AddPointerMetadata(t,s),C._LoadTransform(Z,t),void 0!=Z.camera){const o=y.Get(`${s}/camera`,this._gltf.cameras,Z.camera);j.push(this.loadCameraAsync(`/cameras/${o.index}`,o,(s=>{s.parent=t,this._babylonScene.useRightHandedSystem||(t.ZO.x=-1)})))}if(Z.children)for(const o of Z.children){const Z=y.Get(`${s}/children/${o}`,this._gltf.nodes,o);j.push(this.loadNodeAsync(`/nodes/${Z.index}`,Z,(s=>{s.parent=t})))}o(t)},a=void 0!=Z.mesh,O=this._parent.loadSkins&&void 0!=Z.skin;if(!a||O){const s=Z.name||`node${Z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new H.c(s,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==Z.mesh?Z._babylonTransformNode=o:Z._babylonTransformNodeForSkin=o,S(o)}if(a)if(O){const o=y.Get(`${s}/mesh`,this._gltf.meshes,Z.mesh);j.push(this._loadMeshAsync(`/meshes/${o.index}`,Z,o,(o=>{const t=Z._babylonTransformNodeForSkin;o.metadata=(0,x.e)(t.metadata,o.metadata||{});const S=y.Get(`${s}/skin`,this._gltf.skins,Z.skin);j.push(this._loadSkinAsync(`/skins/${S.index}`,Z,S,(s=>{this._forEachPrimitive(Z,(Z=>{Z.skeleton=s})),this._postSceneLoadActions.push((()=>{if(void 0!=S.skeleton){const s=y.Get(`/skins/${S.index}/skeleton`,this._gltf.nodes,S.skeleton).parent;Z.index===s.index?o.parent=t.parent:o.parent=s._babylonTransformNode}else o.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:t,skinnedNode:o})}))})))})))}else{const o=y.Get(`${s}/mesh`,this._gltf.meshes,Z.mesh);j.push(this._loadMeshAsync(`/meshes/${o.index}`,Z,o,S))}return this.logClose(),Promise.all(j).then((()=>(this._forEachPrimitive(Z,(s=>{const Z=s;!Z.isAnInstance&&Z.Pa&&Z.Pa.useBoundingInfoFromGeometry?s.Ws():s.refreshBoundingInfo(!0,!0)})),Z._babylonTransformNode)))}_loadMeshAsync(s,Z,o,t){const j=o.primitives;if(!j||!j.length)throw new Error(`${s}: Primitives are missing`);void 0==j[0].index&&y.Assign(j);const S=new Array;this.logOpen(`${s} ${o.name||""}`);const a=Z.name||`node${Z.index}`;if(1===j.length){const t=o.primitives[0];S.push(this._loadMeshPrimitiveAsync(`${s}/primitives/${t.index}`,a,Z,o,t,(s=>{Z._babylonTransformNode=s,Z._primitiveBabylonMeshes=[s]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,Z._babylonTransformNode=new H.c(a,this._babylonScene),Z._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._primitiveBabylonMeshes=[];for(const t of j)S.push(this._loadMeshPrimitiveAsync(`${s}/primitives/${t.index}`,`${a}_primitive${t.index}`,Z,o,t,(s=>{s.parent=Z._babylonTransformNode,Z._primitiveBabylonMeshes.push(s)})))}return t(Z._babylonTransformNode),this.logClose(),Promise.all(S).then((()=>Z._babylonTransformNode))}_loadMeshPrimitiveAsync(s,Z,o,t,j,S){const a=this._extensionsLoadMeshPrimitiveAsync(s,Z,o,t,j,S);if(a)return a;this.logOpen(`${s}`);const O=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==o.skin&&!t.primitives[0].targets;let v,G;if(O&&j._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,v=j._instanceData.babylonSourceMesh.createInstance(Z),v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G=j._instanceData.promise;else{const S=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new L.d(Z,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.sideOrientation=this._babylonScene.useRightHandedSystem?d.c.CounterClockWiseSideOrientation:d.c.ClockWiseSideOrientation,this._createMorphTargets(s,o,t,j,a),S.push(this._loadVertexDataAsync(s,j,a).then((async Z=>await this._loadMorphTargetsAsync(s,j,a,Z).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,Z.ws(a),Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const B=C._GetDrawMode(s,j.mode);if(void 0==j.material){let s=this._defaultBabylonMaterialData[B];s||(s=this._createDefaultMaterial("__GLTFLoader._default",B),this._parent.onMaterialLoadedObservable.notifyObservers(s),this._defaultBabylonMaterialData[B]=s),a.material=s}else if(!this.parent.skipMaterials){const Z=y.Get(`${s}/material`,this._gltf.materials,j.material);S.push(this._loadMaterialAsync(`/materials/${Z.index}`,Z,a,B,(s=>{a.material=s})))}G=Promise.all(S),O&&(j._instanceData={babylonSourceMesh:a,promise:G}),v=a}return C.AddPointerMetadata(v,s),this._parent.onMeshLoadedObservable.notifyObservers(v),S(v),this.logClose(),G.then((()=>v))}_loadVertexDataAsync(s,Z,o){const t=this._extensionsLoadVertexDataAsync(s,Z,o);if(t)return t;const j=Z.attributes;if(!j)throw new Error(`${s}: Attributes are missing`);const S=new Array,a=new i.e(o.name,this._babylonScene);if(void 0==Z.indices)o.isUnIndexed=!0;else{const o=y.Get(`${s}/indices`,this._gltf.accessors,Z.indices);S.push(this._loadIndicesAccessorAsync(`/accessors/${o.index}`,o).then((s=>{a.setIndices(s)})))}const O=(Z,t,O)=>{if(void 0==j[Z])return;o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(t)&&o._delayInfo.push(t);const v=y.Get(`${s}/attributes/${Z}`,this._gltf.accessors,j[Z]);S.push(this._loadVertexAccessorAsync(`/accessors/${v.index}`,v,t).then((s=>{if(s.getKind()===F.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!o.skeleton){const s=I(v);s&&(a._boundingInfo=s,a.useBoundingInfoFromGeometry=!0)}a.setVerticesBuffer(s,v.count)}))),t==F.e.MatricesIndicesExtraKind&&(o.numBoneInfluencers=8),O&&O(v)};return O("POSITION",F.e.PositionKind),O("NORMAL",F.e.NormalKind),O("TANGENT",F.e.TangentKind),O("TEXCOORD_0",F.e.UVKind),O("TEXCOORD_1",F.e.UV2Kind),O("TEXCOORD_2",F.e.UV3Kind),O("TEXCOORD_3",F.e.UV4Kind),O("TEXCOORD_4",F.e.UV5Kind),O("TEXCOORD_5",F.e.UV6Kind),O("JOINTS_0",F.e.MatricesIndicesKind),O("WEIGHTS_0",F.e.MatricesWeightsKind),O("JOINTS_1",F.e.MatricesIndicesExtraKind),O("WEIGHTS_1",F.e.MatricesWeightsExtraKind),O("COLOR_0",F.e.ColorKind,(s=>{"VEC4"===s.type&&(o.hasVertexAlpha=!0)})),Promise.all(S).then((()=>a))}_createMorphTargets(s,Z,o,t,j){if(!t.targets||!this._parent.loadMorphTargets)return;if(void 0==Z._numMorphTargets)Z._numMorphTargets=t.targets.length;else if(t.targets.length!==Z._numMorphTargets)throw new Error(`${s}: Primitives do not have the same number of targets`);const S=o.extras?o.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,j.morphTargetManager=new R(this._babylonScene),j.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.morphTargetManager.areUpdatesFrozen=!0;for(let a=0;a<t.targets.length;a++){const s=Z.weights?Z.weights[a]:o.weights?o.weights[a]:0,t=S?S[a]:`morphTarget${a}`;j.morphTargetManager.addTarget(new V.e(t,s,j.Ls()))}}_loadMorphTargetsAsync(s,Z,o,t){if(!Z.targets||!this._parent.loadMorphTargets)return Promise.resolve();const j=new Array,S=o.morphTargetManager;for(let a=0;a<S.numTargets;a++){const o=S.getTarget(a);j.push(this._loadMorphTargetVertexDataAsync(`${s}/targets/${a}`,t,Z.targets[a],o))}return Promise.all(j).then((()=>{S.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(s,Z,o,t){const j=new Array,S=(t,S,a)=>{if(void 0==o[t])return;const O=Z.getVertexBuffer(S);if(!O)return;const v=y.Get(`${s}/${t}`,this._gltf.accessors,o[t]);j.push(this._loadFloatAccessorAsync(`/accessors/${v.index}`,v).then((s=>{a(O,s)})))};return S("POSITION",F.e.PositionKind,((s,Z)=>{const o=new Float32Array(Z.length);s.forEach(Z.length,((s,t)=>{o[t]=Z[t]+s})),t.setPositions(o)})),S("NORMAL",F.e.NormalKind,((s,Z)=>{const o=new Float32Array(Z.length);s.forEach(o.length,((s,t)=>{o[t]=Z[t]+s})),t.setNormals(o)})),S("TANGENT",F.e.TangentKind,((s,Z)=>{const o=new Float32Array(Z.length/3*4);let j=0;s.forEach(Z.length/3*4,((s,t)=>{(t+1)%4!==0&&(o[j]=Z[j]+s,j++)})),t.setTangents(o)})),S("TEXCOORD_0",F.e.UVKind,((s,Z)=>{const o=new Float32Array(Z.length);s.forEach(Z.length,((s,t)=>{o[t]=Z[t]+s})),t.setUVs(o)})),S("TEXCOORD_1",F.e.UV2Kind,((s,Z)=>{const o=new Float32Array(Z.length);s.forEach(Z.length,((s,t)=>{o[t]=Z[t]+s})),t.setUV2s(o)})),S("COLOR_0",F.e.ColorKind,((Z,o)=>{let j=null;const S=Z.getSize();if(3===S){j=new Float32Array(o.length/3*4),Z.forEach(o.length,((s,Z)=>{const t=Math.floor(Z/3),S=Z%3;j[4*t+S]=o[3*t+S]+s}));for(let s=0;s<o.length/3;++s)j[4*s+3]=1}else{if(4!==S)throw new Error(`${s}: Invalid number of components (${S}) for COLOR_0 attribute`);j=new Float32Array(o.length),Z.forEach(o.length,((s,Z)=>{j[Z]=o[Z]+s}))}t.setColors(j)})),await Promise.all(j).then((()=>{}))}static _LoadTransform(s,Z){if(void 0!=s.skin)return;let o=j.n.Zero(),t=j.e.Identity(),S=j.n.One();if(s.matrix){j.b.oO(s.matrix).decompose(S,t,o)}else s.translation&&(o=j.n.oO(s.translation)),s.rotation&&(t=j.e.oO(s.rotation)),s.scale&&(S=j.n.oO(s.scale));Z.position=o,Z.rotationQuaternion=t,Z.ZO=S}_loadSkinAsync(s,Z,o,t){if(!this._parent.loadSkins)return Promise.resolve();const j=this._extensionsLoadSkinAsync(s,Z,o);if(j)return j;if(o._data)return t(o._data.babylonSkeleton),o._data.promise;const S=`skeleton${o.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new A(o.name||S,S,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(s,o,a);const O=this._loadSkinInverseBindMatricesDataAsync(s,o).then((s=>{this._updateBoneMatrices(a,s)}));return o._data={babylonSkeleton:a,promise:O},t(a),O}_loadBones(s,Z,o){if(void 0==Z.skeleton||this._parent.alwaysComputeSkeletonRootNode){const o=this._findSkeletonRootNode(`${s}/joints`,Z.joints);if(o)if(void 0===Z.skeleton)Z.skeleton=o.index;else{const t=(s,Z)=>{for(;Z.parent;Z=Z.parent)if(Z.parent===s)return!0;return!1},j=y.Get(`${s}/skeleton`,this._gltf.nodes,Z.skeleton);j===o||t(j,o)||(b.b.Warn(`${s}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),Z.skeleton=o.index)}else b.b.Warn(`${s}: Failed to find common root`)}const t={};for(const j of Z.joints){const S=y.Get(`${s}/joints/${j}`,this._gltf.nodes,j);this._loadBone(S,Z,o,t)}}_findSkeletonRootNode(s,Z){if(0===Z.length)return null;const o={};for(const j of Z){const Z=[];let t=y.Get(`${s}/${j}`,this._gltf.nodes,j);for(;-1!==t.index;)Z.unshift(t),t=t.parent;o[j]=Z}let t=null;for(let j=0;;++j){let s=o[Z[0]];if(j>=s.length)return t;const S=s[j];for(let a=1;a<Z.length;++a)if(s=o[Z[a]],j>=s.length||S!==s[j])return t;t=S}}_loadBone(s,Z,o,t){s._isJoint=!0;let j=t[s.index];if(j)return j;let S=null;s.index!==Z.skeleton&&(s.parent&&-1!==s.parent.index?S=this._loadBone(s.parent,Z,o,t):void 0!==Z.skeleton&&b.b.Warn(`/skins/${Z.index}/skeleton: Skeleton node is not a common root`));const a=Z.joints.indexOf(s.index);return j=new G.c(s.name||`joint${s.index}`,o,S,this._getNodeMatrix(s),null,null,a),t[s.index]=j,this._postSceneLoadActions.push((()=>{j.linkTransformNode(s._babylonTransformNode)})),j}_loadSkinInverseBindMatricesDataAsync(s,Z){if(void 0==Z.inverseBindMatrices)return Promise.resolve(null);const o=y.Get(`${s}/inverseBindMatrices`,this._gltf.accessors,Z.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)}_updateBoneMatrices(s,Z){for(const o of s.bones){const s=j.b.Identity(),t=o._index;Z&&-1!==t&&(j.b.FromArrayToRef(Z,16*t,s),s.invertToRef(s));const S=o.getParent();S&&s.multiplyToRef(S.getAbsoluteInverseBindMatrix(),s),o.SO(s,!1,!1),o._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(s){return s.matrix?j.b.oO(s.matrix):j.b.Compose(s.scale?j.n.oO(s.scale):j.n.One(),s.rotation?j.e.oO(s.rotation):j.e.Identity(),s.translation?j.n.oO(s.translation):j.n.Zero())}loadCameraAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadCameraAsync(s,Z,o);if(t)return t;const S=new Array;this.logOpen(`${s} ${Z.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new v.c(Z.name||`camera${Z.index}`,j.n.Zero(),this._babylonScene,!1);switch(a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._babylonCamera=a,a.setTarget(new j.n(0,0,-1)),Z.type){case"perspective":{const o=Z.perspective;if(!o)throw new Error(`${s}: Camera perspective properties are missing`);a.fov=o.yfov,a.OO=o.znear,a.maxZ=o.zfar||0;break}case"orthographic":if(!Z.orthographic)throw new Error(`${s}: Camera orthographic properties are missing`);a.mode=O.e.ORTHOGRAPHIC_CAMERA,a.orthoLeft=-Z.orthographic.xmag,a.orthoRight=Z.orthographic.xmag,a.orthoBottom=-Z.orthographic.ymag,a.orthoTop=Z.orthographic.ymag,a.OO=Z.orthographic.znear,a.maxZ=Z.orthographic.zfar;break;default:throw new Error(`${s}: Invalid camera type (${Z.type})`)}return C.AddPointerMetadata(a,s),this._parent.onCameraLoadedObservable.notifyObservers(a),o(a),this.logClose(),Promise.all(S).then((()=>a))}_loadAnimationsAsync(){const s=this._gltf.animations;if(!s)return Promise.resolve();const Z=new Array;for(let o=0;o<s.length;o++){const t=s[o];Z.push(this.loadAnimationAsync(`/animations/${t.index}`,t).then((s=>{0===s.targetedAnimations.length&&s.dispose()})))}return Promise.all(Z).then((()=>{}))}loadAnimationAsync(s,Z){const t=this._extensionsLoadAnimationAsync(s,Z);return t||o.e(58).then(o.bind(o,14214)).then((o=>{let{AnimationGroup:t}=o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new t(Z.name||`animation${Z.index}`,this._babylonScene);j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._babylonAnimationGroup=j;const S=new Array;y.Assign(Z.channels),y.Assign(Z.samplers);for(const a of Z.channels)S.push(this._loadAnimationChannelAsync(`${s}/channels/${a.index}`,s,Z,a,((s,Z)=>{s.animations=s.animations||[],s.animations.push(Z),j.addTargetedAnimation(Z,s)})));return Promise.all(S).then((()=>(j.normalize(0),j)))}))}async _loadAnimationChannelAsync(s,Z,t,j,S){const a=this._extensionsLoadAnimationChannelAsync(s,Z,t,j,S);if(a)return await a;if(void 0==j.target.node)return await Promise.resolve();const O=y.Get(`${s}/target/node`,this._gltf.nodes,j.target.node),v=j.target.path,G="weights"===v;if(G&&!O._numMorphTargets||!G&&!O._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!G&&!O._isJoint)return await Promise.resolve();let B;switch(await Promise.resolve().then(o.bind(o,12730)),v){case"translation":var Q;B=null===(Q=(0,M.h)("/nodes/{}/translation"))||void 0===Q?void 0:Q.interpolation;break;case"rotation":var D;B=null===(D=(0,M.h)("/nodes/{}/rotation"))||void 0===D?void 0:D.interpolation;break;case"scale":var z;B=null===(z=(0,M.h)("/nodes/{}/scale"))||void 0===z?void 0:z.interpolation;break;case"weights":var Y;B=null===(Y=(0,M.h)("/nodes/{}/weights"))||void 0===Y?void 0:Y.interpolation;break;default:throw new Error(`${s}/target/path: Invalid value (${j.target.path})`)}if(!B)throw new Error(`${s}/target/path: Could not find interpolation properties for target path (${j.target.path})`);const b={object:O,info:B};return await this._loadAnimationChannelFromTargetInfoAsync(s,Z,t,j,b,S)}_loadAnimationChannelFromTargetInfoAsync(s,Z,o,t,j,S){const a=this.parent.targetFps,O=1/a,v=y.Get(`${s}/sampler`,o.samplers,t.sampler);return this._loadAnimationSamplerAsync(`${Z}/samplers/${t.sampler}`,v).then((s=>{let Z=0;const v=j.object,G=j.info;for(const j of G){const G=j.getStride(v),B=s.input,Q=s.output,D=new Array(B.length);let z=0;switch(s.interpolation){case"STEP":for(let s=0;s<B.length;s++){const Z=j.getValue(v,Q,z,1);z+=G,D[s]={frame:B[s]*a,value:Z,interpolation:1}}break;case"CUBICSPLINE":for(let s=0;s<B.length;s++){const Z=j.getValue(v,Q,z,O);z+=G;const o=j.getValue(v,Q,z,1);z+=G;const t=j.getValue(v,Q,z,O);z+=G,D[s]={frame:B[s]*a,inTangent:Z,value:o,outTangent:t}}break;case"LINEAR":for(let s=0;s<B.length;s++){const Z=j.getValue(v,Q,z,1);z+=G,D[s]={frame:B[s]*a,value:Z}}}if(z>0){const s=`${o.name||`animation${o.index}`}_channel${t.index}_${Z}`,O=j.buildAnimations(v,s,a,D);for(const o of O)Z++,S(o.babylonAnimatable,o.babylonAnimation)}}}))}_loadAnimationSamplerAsync(s,Z){if(Z._data)return Z._data;const o=Z.interpolation||"LINEAR";switch(o){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${s}/interpolation: Invalid value (${Z.interpolation})`)}const t=y.Get(`${s}/input`,this._gltf.accessors,Z.input),j=y.Get(`${s}/output`,this._gltf.accessors,Z.output);return Z._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${t.index}`,t),this._loadFloatAccessorAsync(`/accessors/${j.index}`,j)]).then((s=>{let[Z,t]=s;return{input:Z,interpolation:o,output:t}})),Z._data}loadBufferAsync(s,Z,o,t){const j=this._extensionsLoadBufferAsync(s,Z,o,t);if(j)return j;if(!Z._data)if(Z.uri)Z._data=this.loadUriAsync(`${s}/uri`,Z,Z.uri);else{if(!this._bin)throw new Error(`${s}: Uri is missing or the binary glTF is missing its binary chunk`);Z._data=this._bin.readAsync(0,Z.byteLength)}return Z._data.then((Z=>{try{return new Uint8Array(Z.buffer,Z.byteOffset+o,t)}catch(j){throw new Error(`${s}: ${j.message}`)}}))}loadBufferViewAsync(s,Z){const o=this._extensionsLoadBufferViewAsync(s,Z);if(o)return o;if(Z._data)return Z._data;const t=y.Get(`${s}/buffer`,this._gltf.buffers,Z.buffer);return Z._data=this.loadBufferAsync(`/buffers/${t.index}`,t,Z.byteOffset||0,Z.byteLength),Z._data}_loadAccessorAsync(s,Z,o){if(Z._data)return Z._data;const t=C._GetNumComponents(s,Z.type),j=t*F.e.GetTypeByteLength(Z.componentType),S=t*Z.count;if(void 0==Z.bufferView)Z._data=Promise.resolve(new o(S));else{const a=y.Get(`${s}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((O=>{if(5126!==Z.componentType||Z.normalized||a.byteStride&&a.byteStride!==j){const s=new o(S);return F.e.ForEach(O,Z.byteOffset||0,a.byteStride||j,t,Z.componentType,s.length,Z.normalized||!1,((Z,o)=>{s[o]=Z})),s}return C._GetTypedArray(s,Z.componentType,O,Z.byteOffset,S)}))}if(Z.sparse){const S=Z.sparse;Z._data=Z._data.then((a=>{const O=a,v=y.Get(`${s}/sparse/indices/bufferView`,this._gltf.bufferViews,S.indices.bufferView),G=y.Get(`${s}/sparse/values/bufferView`,this._gltf.bufferViews,S.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${v.index}`,v),this.loadBufferViewAsync(`/bufferViews/${G.index}`,G)]).then((a=>{let[v,G]=a;const B=C._GetTypedArray(`${s}/sparse/indices`,S.indices.componentType,v,S.indices.byteOffset,S.count),Q=t*S.count;let D;if(5126!==Z.componentType||Z.normalized){const a=C._GetTypedArray(`${s}/sparse/values`,Z.componentType,G,S.values.byteOffset,Q);D=new o(Q),F.e.ForEach(a,0,j,t,Z.componentType,D.length,Z.normalized||!1,((s,Z)=>{D[Z]=s}))}else D=C._GetTypedArray(`${s}/sparse/values`,Z.componentType,G,S.values.byteOffset,Q);let z=0;for(let s=0;s<B.length;s++){let Z=B[s]*t;for(let s=0;s<t;s++)O[Z++]=D[z++]}return O}))}))}return Z._data}_loadFloatAccessorAsync(s,Z){return this._loadAccessorAsync(s,Z,Float32Array)}_loadIndicesAccessorAsync(s,Z){if("SCALAR"!==Z.type)throw new Error(`${s}/type: Invalid value ${Z.type}`);if(5121!==Z.componentType&&5123!==Z.componentType&&5125!==Z.componentType)throw new Error(`${s}/componentType: Invalid value ${Z.componentType}`);if(Z._data)return Z._data;if(Z.sparse){const o=C._GetTypedArrayConstructor(`${s}/componentType`,Z.componentType);Z._data=this._loadAccessorAsync(s,Z,o)}else{const o=y.Get(`${s}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((o=>C._GetTypedArray(s,Z.componentType,o,Z.byteOffset,Z.count)))}return Z._data}_loadVertexBufferViewAsync(s){if(s._babylonBuffer)return s._babylonBuffer;const Z=this._babylonScene.getEngine();return s._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((s=>new F.c(Z,s,!1))),s._babylonBuffer}_loadVertexAccessorAsync(s,Z,o){var t;if(null!==(t=Z._babylonVertexBuffer)&&void 0!==t&&t[o])return Z._babylonVertexBuffer[o];Z._babylonVertexBuffer||(Z._babylonVertexBuffer={});const j=this._babylonScene.getEngine();if(Z.sparse||void 0==Z.bufferView)Z._babylonVertexBuffer[o]=this._loadFloatAccessorAsync(s,Z).then((s=>new F.e(j,s,o,!1)));else{const t=y.Get(`${s}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._babylonVertexBuffer[o]=this._loadVertexBufferViewAsync(t).then((S=>{const a=C._GetNumComponents(s,Z.type);return new F.e(j,S,o,!1,void 0,t.byteStride,void 0,Z.byteOffset,a,Z.componentType,Z.normalized,!0,void 0,!0)}))}return Z._babylonVertexBuffer[o]}_loadMaterialMetallicRoughnessPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return Z&&(Z.baseColorFactor?(o.albedoColor=S.d.oO(Z.baseColorFactor),o.alpha=Z.baseColorFactor[3]):o.albedoColor=S.d.White(),o.metallic=void 0==Z.metallicFactor?1:Z.metallicFactor,o.roughness=void 0==Z.roughnessFactor?1:Z.roughnessFactor,Z.baseColorTexture&&t.push(this.loadTextureInfoAsync(`${s}/baseColorTexture`,Z.baseColorTexture,(s=>{s.name=`${o.name} (Base Color)`,o.albedoTexture=s}))),Z.metallicRoughnessTexture&&(Z.metallicRoughnessTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${s}/metallicRoughnessTexture`,Z.metallicRoughnessTexture,(s=>{s.name=`${o.name} (Metallic Roughness)`,o.metallicTexture=s}))),o.useMetallnessFromMetallicTextureBlue=!0,o.useRoughnessFromMetallicTextureGreen=!0,o.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(t).then((()=>{}))}_loadMaterialAsync(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const S=this._extensionsLoadMaterialAsync(s,Z,o,t,j);if(S)return S;Z._data=Z._data||{};let a=Z._data[t];if(!a){this.logOpen(`${s} ${Z.name||""}`);const o=this.createMaterial(s,Z,t);a={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(s,Z,o)},Z._data[t]=a,C.AddPointerMetadata(o,s),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()}return o&&(a.babylonMeshes.push(o),o.jO.addOnce((()=>{const s=a.babylonMeshes.indexOf(o);-1!==s&&a.babylonMeshes.splice(s,1)}))),j(a.babylonMaterial),a.promise.then((()=>a.babylonMaterial))}_createDefaultMaterial(s,Z){this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new U.d(s,this._babylonScene);return o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.fillMode=Z,o.enableSpecularAntiAliasing=!0,o.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,o.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,o.transparencyMode=U.d.PBRMATERIAL_OPAQUE,o.metallic=1,o.roughness=1,o}createMaterial(s,Z,o){const t=this._extensionsCreateMaterial(s,Z,o);if(t)return t;const j=Z.name||`material${Z.index}`;return this._createDefaultMaterial(j,o)}loadMaterialPropertiesAsync(s,Z,o){const t=this._extensionsLoadMaterialPropertiesAsync(s,Z,o);if(t)return t;const j=new Array;return j.push(this.loadMaterialBasePropertiesAsync(s,Z,o)),Z.pbrMetallicRoughness&&j.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${s}/pbrMetallicRoughness`,Z.pbrMetallicRoughness,o)),this.loadMaterialAlphaProperties(s,Z,o),Promise.all(j).then((()=>{}))}loadMaterialBasePropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return o.emissiveColor=Z.emissiveFactor?S.d.oO(Z.emissiveFactor):new S.d(0,0,0),Z.doubleSided&&(o.Ta=!1,o.twoSidedLighting=!0),Z.normalTexture&&(Z.normalTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${s}/normalTexture`,Z.normalTexture,(s=>{s.name=`${o.name} (Normal)`,o.bumpTexture=s}))),o.invertNormalMapX=!this._babylonScene.useRightHandedSystem,o.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=Z.normalTexture.scale&&o.bumpTexture&&(o.bumpTexture.level=Z.normalTexture.scale),o.forceIrradianceInFragment=!0),Z.occlusionTexture&&(Z.occlusionTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${s}/occlusionTexture`,Z.occlusionTexture,(s=>{s.name=`${o.name} (Occlusion)`,o.ambientTexture=s}))),o.useAmbientInGrayScale=!0,void 0!=Z.occlusionTexture.strength&&(o.ambientTextureStrength=Z.occlusionTexture.strength)),Z.emissiveTexture&&t.push(this.loadTextureInfoAsync(`${s}/emissiveTexture`,Z.emissiveTexture,(s=>{s.name=`${o.name} (Emissive)`,o.emissiveTexture=s}))),Promise.all(t).then((()=>{}))}loadMaterialAlphaProperties(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);switch(Z.alphaMode||"OPAQUE"){case"OPAQUE":o.transparencyMode=U.d.PBRMATERIAL_OPAQUE,o.alpha=1;break;case"MASK":o.transparencyMode=U.d.PBRMATERIAL_ALPHATEST,o.alphaCutOff=void 0==Z.alphaCutoff?.5:Z.alphaCutoff,o.albedoTexture&&(o.albedoTexture.na=!0);break;case"BLEND":o.transparencyMode=U.d.PBRMATERIAL_ALPHABLEND,o.albedoTexture&&(o.albedoTexture.na=!0,o.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${s}/alphaMode: Invalid value (${Z.alphaMode})`)}}loadTextureInfoAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadTextureInfoAsync(s,Z,o);if(t)return t;if(this.logOpen(`${s}`),Z.texCoord>=6)throw new Error(`${s}/texCoord: Invalid value (${Z.texCoord})`);const j=y.Get(`${s}/index`,this._gltf.textures,Z.index);j._textureInfo=Z;const S=this._loadTextureAsync(`/textures/${Z.index}`,j,(t=>{t.coordinatesIndex=Z.texCoord||0,C.AddPointerMetadata(t,s),this._parent.onTextureLoadedObservable.notifyObservers(t),o(t)}));return this.logClose(),S}_loadTextureAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadTextureAsync(s,Z,o);if(t)return t;this.logOpen(`${s} ${Z.name||""}`);const j=void 0==Z.sampler?C.DefaultSampler:y.Get(`${s}/sampler`,this._gltf.samplers,Z.sampler),S=y.Get(`${s}/source`,this._gltf.images,Z.source),a=this._createTextureAsync(s,j,S,o,void 0,!Z._textureInfo.nonColorData);return this.logClose(),a}_createTextureAsync(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},S=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;const O=this._loadSampler(`/samplers/${Z.index}`,Z),v=new Array,G=new t;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B={noMipmap:O.noMipMaps,invertY:!1,samplingMode:O.samplingMode,T:()=>{this._disposed||G.resolve()},onError:(Z,o)=>{this._disposed||G.reject(new Error(`${s}: ${o&&o.message?o.message:Z||"Failed to load texture"}`))},mimeType:o.mimeType??(0,c.l)(o.uri??""),loaderOptions:S,useSRGBBuffer:!!a&&this._parent.useSRGBBuffers},Q=new u.c(null,this._babylonScene,B);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.push(G.promise),v.push(this.loadImageAsync(`/images/${o.index}`,o).then((s=>{const Z=o.uri||`${this._fileName}#image${o.index}`,t=`data:${this._uniqueRootUrl}${Z}`;Q.updateURL(t,s);const j=Q.getInternalTexture();j&&(j.label=o.name)}))),Q.wrapU=O.wrapU,Q.wrapV=O.wrapV,j(Q),this._parent.useGltfTextureNames&&(Q.name=o.name||o.uri||`image${o.index}`),Promise.all(v).then((()=>Q))}_loadSampler(s,Z){return Z._data||(Z._data={noMipMaps:9728===Z.minFilter||9729===Z.minFilter,samplingMode:C._GetTextureSamplingMode(s,Z),wrapU:C._GetTextureWrapMode(`${s}/wrapS`,Z.wrapS),wrapV:C._GetTextureWrapMode(`${s}/wrapT`,Z.wrapT)}),Z._data}loadImageAsync(s,Z){if(!Z._data){if(this.logOpen(`${s} ${Z.name||""}`),Z.uri)Z._data=this.loadUriAsync(`${s}/uri`,Z,Z.uri);else{const o=y.Get(`${s}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}this.logClose()}return Z._data}loadUriAsync(s,Z,o){const t=this._extensionsLoadUriAsync(s,Z,o);if(t)return t;if(!C._ValidateUri(o))throw new Error(`${s}: '${o}' is invalid`);if((0,c.p)(o)){const Z=new Uint8Array((0,c.e)(o));return this.log(`${s}: Decoded ${o.substring(0,64)}... (${Z.length} bytes)`),Promise.resolve(Z)}return this.log(`${s}: Loading ${o}`),this._parent.preprocessUrlAsync(this._rootUrl+o).then((Z=>new Promise(((t,j)=>{this._parent._loadFile(this._babylonScene,Z,(Z=>{this._disposed||(this.log(`${s}: Loaded ${o} (${Z.byteLength} bytes)`),t(new Uint8Array(Z)))}),!0,(Z=>{j(new c.s(`${s}: Failed to load '${o}'${Z?": "+Z.status+" "+Z.statusText:""}`,Z))}))}))))}static AddPointerMetadata(s,Z){s.metadata=s.metadata||{};const o=s._internalMetadata=s._internalMetadata||{},t=o.aO=o.aO||{};(t.pointers=t.pointers||[]).push(Z)}static _GetTextureWrapMode(s,Z){switch(Z=void 0==Z?10497:Z){case 33071:return u.c.CLAMP_ADDRESSMODE;case 33648:return u.c.MIRROR_ADDRESSMODE;case 10497:return u.c.WRAP_ADDRESSMODE;default:return b.b.Warn(`${s}: Invalid value (${Z})`),u.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(s,Z){const o=void 0==Z.magFilter?9729:Z.magFilter,t=void 0==Z.minFilter?9987:Z.minFilter;if(9729===o)switch(t){case 9728:return u.c.LINEAR_NEAREST;case 9729:return u.c.LINEAR_LINEAR;case 9984:return u.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return u.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return u.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return u.c.LINEAR_LINEAR_MIPLINEAR;default:return b.b.Warn(`${s}/minFilter: Invalid value (${t})`),u.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==o&&b.b.Warn(`${s}/magFilter: Invalid value (${o})`),t){case 9728:return u.c.NEAREST_NEAREST;case 9729:return u.c.NEAREST_LINEAR;case 9984:return u.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return u.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return u.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return u.c.NEAREST_LINEAR_MIPLINEAR;default:return b.b.Warn(`${s}/minFilter: Invalid value (${t})`),u.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(s,Z){try{return(0,k.q)(Z)}catch(o){throw new Error(`${s}: ${o.message}`)}}static _GetTypedArray(s,Z,o,t,j){const S=o.buffer;t=o.byteOffset+(t||0);const a=C._GetTypedArrayConstructor(`${s}/componentType`,Z),O=F.e.GetTypeByteLength(Z);return t%O!==0?(b.b.Warn(`${s}: Copying buffer as byte offset (${t}) is not a multiple of component type byte length (${O})`),new a(S.slice(t,t+j*O),0)):new a(S,t,j)}static _GetNumComponents(s,Z){switch(Z){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${s}: Invalid type (${Z})`)}static _ValidateUri(s){return a.g.IsBase64(s)||-1===s.indexOf("..")}static _GetDrawMode(s,Z){switch(void 0==Z&&(Z=4),Z){case 0:return d.c.PointListDrawMode;case 1:return d.c.LineListDrawMode;case 2:return d.c.LineLoopDrawMode;case 3:return d.c.LineStripDrawMode;case 4:return d.c.TriangleFillMode;case 5:return d.c.TriangleStripDrawMode;case 6:return d.c.TriangleFanDrawMode}throw new Error(`${s}: Invalid mesh primitive mode (${Z})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const s=new Array;if(this._gltf.materials)for(const Z of this._gltf.materials)if(Z._data)for(const o in Z._data){const t=Z._data[o];for(const Z of t.babylonMeshes){Z.Ea(!0);const o=t.babylonMaterial;s.push(o.forceCompilationAsync(Z)),s.push(o.forceCompilationAsync(Z,{useInstances:!0})),this._parent.useClipPlane&&(s.push(o.forceCompilationAsync(Z,{clipPlane:!0})),s.push(o.forceCompilationAsync(Z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(s).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const s=new Array,Z=this._babylonScene.lights;for(const o of Z){const Z=o.getShadowGenerator();Z&&s.push(Z.forceCompilationAsync())}return Promise.all(s).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(s){for(const Z of this._extensions)Z.enabled&&s(Z)}_applyExtensions(s,Z,o){for(const t of this._extensions)if(t.enabled){const j=`${t.name}.${Z}`,S=s;S._activeLoaderExtensionFunctions=S._activeLoaderExtensionFunctions||{};const a=S._activeLoaderExtensionFunctions;if(!a[j]){a[j]=!0;try{const s=o(t);if(s)return s}finally{delete a[j]}}}return null}_extensionsOnLoading(){this._forEachExtensions((s=>s.onLoading&&s.onLoading()))}_extensionsOnReady(){this._forEachExtensions((s=>s.onReady&&s.onReady()))}_extensionsLoadSceneAsync(s,Z){return this._applyExtensions(Z,"loadScene",(o=>o.loadSceneAsync&&o.loadSceneAsync(s,Z)))}_extensionsLoadNodeAsync(s,Z,o){return this._applyExtensions(Z,"loadNode",(t=>t.loadNodeAsync&&t.loadNodeAsync(s,Z,o)))}_extensionsLoadCameraAsync(s,Z,o){return this._applyExtensions(Z,"loadCamera",(t=>t.loadCameraAsync&&t.loadCameraAsync(s,Z,o)))}_extensionsLoadVertexDataAsync(s,Z,o){return this._applyExtensions(Z,"loadVertexData",(t=>t._loadVertexDataAsync&&t._loadVertexDataAsync(s,Z,o)))}_extensionsLoadMeshPrimitiveAsync(s,Z,o,t,j,S){return this._applyExtensions(j,"loadMeshPrimitive",(a=>a._loadMeshPrimitiveAsync&&a._loadMeshPrimitiveAsync(s,Z,o,t,j,S)))}_extensionsLoadMaterialAsync(s,Z,o,t,j){return this._applyExtensions(Z,"loadMaterial",(S=>S._loadMaterialAsync&&S._loadMaterialAsync(s,Z,o,t,j)))}_extensionsCreateMaterial(s,Z,o){return this._applyExtensions(Z,"createMaterial",(t=>t.createMaterial&&t.createMaterial(s,Z,o)))}_extensionsLoadMaterialPropertiesAsync(s,Z,o){return this._applyExtensions(Z,"loadMaterialProperties",(t=>t.loadMaterialPropertiesAsync&&t.loadMaterialPropertiesAsync(s,Z,o)))}_extensionsLoadTextureInfoAsync(s,Z,o){return this._applyExtensions(Z,"loadTextureInfo",(t=>t.loadTextureInfoAsync&&t.loadTextureInfoAsync(s,Z,o)))}_extensionsLoadTextureAsync(s,Z,o){return this._applyExtensions(Z,"loadTexture",(t=>t._loadTextureAsync&&t._loadTextureAsync(s,Z,o)))}_extensionsLoadAnimationAsync(s,Z){return this._applyExtensions(Z,"loadAnimation",(o=>o.loadAnimationAsync&&o.loadAnimationAsync(s,Z)))}_extensionsLoadAnimationChannelAsync(s,Z,o,t,j){return this._applyExtensions(o,"loadAnimationChannel",(S=>S._loadAnimationChannelAsync&&S._loadAnimationChannelAsync(s,Z,o,t,j)))}_extensionsLoadSkinAsync(s,Z,o){return this._applyExtensions(o,"loadSkin",(t=>t._loadSkinAsync&&t._loadSkinAsync(s,Z,o)))}_extensionsLoadUriAsync(s,Z,o){return this._applyExtensions(Z,"loadUri",(t=>t._loadUriAsync&&t._loadUriAsync(s,Z,o)))}_extensionsLoadBufferViewAsync(s,Z){return this._applyExtensions(Z,"loadBufferView",(o=>o.loadBufferViewAsync&&o.loadBufferViewAsync(s,Z)))}_extensionsLoadBufferAsync(s,Z,o,t){return this._applyExtensions(Z,"loadBuffer",(j=>j.loadBufferAsync&&j.loadBufferAsync(s,Z,o,t)))}static LoadExtensionAsync(s,Z,o,t){if(!Z.extensions)return null;const j=Z.extensions[o];return j?t(`${s}/extensions/${o}`,j):null}static LoadExtraAsync(s,Z,o,t){if(!Z.extras)return null;const j=Z.extras[o];return j?t(`${s}/extras/${o}`,j):null}isExtensionUsed(s){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(s)}logOpen(s){this._parent._logOpen(s)}logClose(){this._parent._logClose()}log(s){this._parent._log(s)}startPerformanceCounter(s){this._parent._startPerformanceCounter(s)}endPerformanceCounter(s){this._parent._endPerformanceCounter(s)}}C.DefaultSampler={index:-1},e.e._CreateGLTF2Loader=s=>new C(s);var K=o(12730),p=o(11367),E=o(11167),P=o(12738),r=o(12743);class T extends r.d{constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",s),this._texture=s.getEngine().createRawCubeTexture(Z,o,t,j,S,a,O,v)}update(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,s,Z,o,t,j)}updateRGBDAsync(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,P.i)(this._texture,s,Z,o,t).then((()=>{}))}clone(){return E.c.Clone((()=>{const s=this.Ls(),Z=this._texture,o=new T(s,Z._bufferViewArray,Z.width,Z.format,Z.type,Z.generateMipMaps,Z.invertY,Z.samplingMode,Z._compression);return 13===Z.source&&o.updateRGBDAsync(Z._bufferViewArrayArray,Z._sphericalPolynomial,Z._lodGenerationScale,Z._lodGenerationOffset),o}),this)}}const m="EXT_lights_image_based";class n{constructor(s){this.name=m,this._loader=s,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null,delete this._lights}onLoading(){const s=this._loader.aO.extensions;if(s&&s[this.name]){const Z=s[this.name];this._lights=Z.lights}}loadSceneAsync(s,Z){return C.LoadExtensionAsync(s,Z,this.name,(async(o,t)=>{this._loader._allMaterialsDirtyRequired=!0;const j=new Array;j.push(this._loader.loadSceneAsync(s,Z)),this._loader.logOpen(`${o}`);const S=y.Get(`${o}/light`,this._lights,t.pa);return j.push(this._loadLightAsync(`/extensions/${this.name}/lights/${t.pa}`,S).then((s=>{this._loader.babylonScene.environmentTexture=s}))),this._loader.logClose(),await Promise.all(j).then((()=>{}))}))}_loadLightAsync(s,Z){if(!Z._loaded){const o=new Array;this._loader.logOpen(`${s}`);const t=new Array(Z.specularImages.length);for(let j=0;j<Z.specularImages.length;j++){const S=Z.specularImages[j];t[j]=new Array(S.length);for(let Z=0;Z<S.length;Z++){const a=`${s}/specularImages/${j}/${Z}`;this._loader.logOpen(`${a}`);const O=S[Z],v=y.Get(a,this._loader.aO.images,O);o.push(this._loader.loadImageAsync(`/images/${O}`,v).then((s=>{t[j][Z]=s}))),this._loader.logClose()}}this._loader.logClose(),Z._loaded=Promise.all(o).then((async()=>{const o=new T(this._loader.babylonScene,null,Z.specularImageSize);if(o.name=Z.name||"environment",Z._babylonTexture=o,void 0!=Z.QO&&(o.level=Z.QO),Z.rotation){let s=j.e.oO(Z.rotation);this._loader.babylonScene.useRightHandedSystem||(s=j.e.Inverse(s)),j.b.FromQuaternionToRef(s,o.getReflectionTextureMatrix())}if(!Z.irradianceCoefficients)throw new Error(`${s}: Irradiance coefficients are missing`);const S=p.e.oO(Z.irradianceCoefficients);S.scaleInPlace(Z.QO),S.convertIrradianceToLambertianRadiance();const a=p.h.FromHarmonics(S),O=(t.length-1)/Math.log2(Z.specularImageSize);return await o.updateRGBDAsync(t,a,O)}))}return Z._loaded.then((()=>Z._babylonTexture))}}h(m),q(m,!0,(s=>new n(s)));o(11656);const J="EXT_mesh_gpu_instancing";class ss{constructor(s){this.name=J,this._loader=s,this.enabled=this._loader.isExtensionUsed(J)}dispose(){this._loader=null}loadNodeAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(s,t)=>{this._loader._disableInstancedMesh++;const S=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,o);if(this._loader._disableInstancedMesh--,!Z._primitiveBabylonMeshes)return await S;const a=new Array;let O=0;const v=Z=>{if(void 0==t.attributes[Z])return void a.push(Promise.resolve(null));const o=y.Get(`${s}/attributes/${Z}`,this._loader.aO.accessors,t.attributes[Z]);if(a.push(this._loader._loadFloatAccessorAsync(`/accessors/${o.bufferView}`,o)),0===O)O=o.count;else if(O!==o.count)throw new Error(`${s}/attributes: Instance buffer accessors do not have the same count.`)};return v("TRANSLATION"),v("ROTATION"),v("SCALE"),await S.then((async s=>{const[o,t,S]=await Promise.all(a),v=new Float32Array(16*O);j.g.sO[0].Ja(0,0,0),j.g.Quaternion[0].Ja(0,0,0,1),j.g.sO[1].Ja(1,1,1);for(let Z=0;Z<O;++Z)o&&j.n.FromArrayToRef(o,3*Z,j.g.sO[0]),t&&j.e.FromArrayToRef(t,4*Z,j.g.Quaternion[0]),S&&j.n.FromArrayToRef(S,3*Z,j.g.sO[1]),j.b.ComposeToRef(j.g.sO[1],j.g.Quaternion[0],j.g.sO[0],j.g.Matrix[0]),j.g.Matrix[0].copyToArray(v,16*Z);for(const j of Z._primitiveBabylonMeshes)j.pB("matrix",v,16,!0);return s}))}))}}h(J),q(J,!0,(s=>new ss(s)));let Zs=0,os=null;class ts{static get Default(){return ts._Default||(ts._Default=new ts),ts._Default}constructor(){const s=ts.Configuration.decoder;this._decoderModulePromise=a.g.LoadBabylonScriptAsync(s.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(s,Z,o,t,j){await this._decoderModulePromise,0===Zs&&(MeshoptDecoder.useWorkers(1),Zs=1);const S=await MeshoptDecoder.decodeGltfBufferAsync(Z,o,s,t,j);return null!==os&&clearTimeout(os),os=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Zs=0,os=null}),1e3),S}}ts.Configuration={decoder:{url:`${a.g._DefaultCdnUrl}/meshopt_decoder.js`}},ts._Default=null;const js="EXT_meshopt_compression";class Ss{constructor(s){this.name=js,this.enabled=s.isExtensionUsed(js),this._loader=s}dispose(){this._loader=null}loadBufferViewAsync(s,Z){return C.LoadExtensionAsync(s,Z,this.name,(async(o,t)=>{const j=Z;if(j._meshOptData)return await j._meshOptData;const S=y.Get(`${s}/buffer`,this._loader.aO.buffers,t.buffer);return j._meshOptData=this._loader.loadBufferAsync(`/buffers/${S.index}`,S,t.byteOffset||0,t.byteLength).then((async s=>await ts.Default.decodeGltfBufferAsync(s,t.count,t.byteStride,t.mode,t.filter))),await j._meshOptData}))}}h(js),q(js,!0,(s=>new Ss(s)));const as="EXT_texture_webp";class Os{constructor(s){this.name=as,this._loader=s,this.enabled=s.isExtensionUsed(as)}dispose(){this._loader=null}_loadTextureAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=void 0==Z.sampler?C.DefaultSampler:y.Get(`${s}/sampler`,this._loader.aO.samplers,Z.sampler),a=y.Get(`${t}/source`,this._loader.aO.images,j.source);return await this._loader._createTextureAsync(s,S,a,(s=>{o(s)}),void 0,!Z._textureInfo.nonColorData)}))}}h(as),q(as,!0,(s=>new Os(s)));const vs="EXT_texture_avif";class Gs{constructor(s){this.name=vs,this._loader=s,this.enabled=s.isExtensionUsed(vs)}dispose(){this._loader=null}_loadTextureAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=void 0==Z.sampler?C.DefaultSampler:y.Get(`${s}/sampler`,this._loader.aO.samplers,Z.sampler),a=y.Get(`${t}/source`,this._loader.aO.images,j.source);return await this._loader._createTextureAsync(s,S,a,(s=>{o(s)}),void 0,!Z._textureInfo.nonColorData)}))}}h(vs),q(vs,!0,(s=>new Gs(s)));var Bs=o(12721),Qs=o(11626);const Ds="EXT_lights_ies";class zs{constructor(s){this.name=Ds,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ds)}dispose(){this._loader=null,delete this._lights}onLoading(){const s=this._loader.aO.extensions;if(s&&s[this.name]){const Z=s[this.name];this._lights=Z.lights,y.Assign(this._lights)}}loadNodeAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,a)=>{let O,v;this._loader._allMaterialsDirtyRequired=!0;const G=await this._loader.loadNodeAsync(s,Z,(s=>{v=y.Get(t,this._lights,a.pa);const Z=v.name||s.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O=new Bs.e(Z,j.n.Zero(),j.n.Backward(),0,1,this._loader.babylonScene),O.angle=Math.PI/2,O.innerAngle=0,O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,v._babylonLight=O,O.falloffType=Qs.b.FALLOFF_GLTF,O.DO=a.color?S.d.oO(a.color):S.d.White(),O.QO=a.multiplier||1,O.range=Number.MAX_VALUE,O.parent=s,this._loader._babylonLights.push(O),C.AddPointerMetadata(O,t),o(s)}));let B;if(v.uri)B=await this._loader.loadUriAsync(s,v,v.uri);else{const Z=y.Get(`${s}/bufferView`,this._loader.aO.bufferViews,v.bufferView);B=await this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}return O.iesProfileTexture=new u.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,B,!0,void 0,void 0,void 0,void 0,".ies"),G}))}}h(Ds),q(Ds,!0,(s=>new zs(s)));var Ys=o(12752);const bs="KHR_draco_mesh_compression";class fs{constructor(s){this.name=bs,this.useNormalizedFlagFromAccessor=!0,this._loader=s,this.enabled=Ys.b.DefaultAvailable&&this._loader.isExtensionUsed(bs)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{if(void 0!=Z.mode&&4!==Z.mode&&5!==Z.mode)throw new Error(`${s}: Unsupported mode ${Z.mode}`);const S={},a={},O=(s,t)=>{const O=j.attributes[s];if(void 0!=O&&(o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(t)&&o._delayInfo.push(t),S[t]=O,this.useNormalizedFlagFromAccessor)){const o=y.TryGet(this._loader.aO.accessors,Z.attributes[s]);o&&(a[t]=o.normalized||!1)}};O("POSITION",F.e.PositionKind),O("NORMAL",F.e.NormalKind),O("TANGENT",F.e.TangentKind),O("TEXCOORD_0",F.e.UVKind),O("TEXCOORD_1",F.e.UV2Kind),O("TEXCOORD_2",F.e.UV3Kind),O("TEXCOORD_3",F.e.UV4Kind),O("TEXCOORD_4",F.e.UV5Kind),O("TEXCOORD_5",F.e.UV6Kind),O("JOINTS_0",F.e.MatricesIndicesKind),O("WEIGHTS_0",F.e.MatricesWeightsKind),O("COLOR_0",F.e.ColorKind);const v=y.Get(t,this._loader.aO.bufferViews,j.bufferView);return v._dracoBabylonGeometry||(v._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((async t=>{const j=this.dracoDecoder||Ys.b.Default,O=y.TryGet(this._loader.aO.accessors,Z.attributes.POSITION),v=this._loader.parent.alwaysComputeBoundingBox||o.skeleton||!O?null:I(O);return await j._decodeMeshToGeometryForGltfAsync(o.name,this._loader.babylonScene,t,S,a,v).catch((Z=>{throw new Error(`${s}: ${Z.message}`)}))}))),await v._dracoBabylonGeometry}))}}h(bs),q(bs,!0,(s=>new fs(s)));var As=o(12758),ds=o(11086),Us=o(11091),us=o(11201),Hs=o(11689),Fs=o(10916);us.d.AddNodeConstructor("Light_Type_0",((s,Z)=>()=>new is(s,j.n.Zero(),Z)));class is extends Hs.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(s){this._shadowAngle=s,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(s){const Z=this.needCube();if(this._direction=s,this.needCube()!==Z&&this._shadowGenerators){const s=this._shadowGenerators.values();for(let Z=s.next();!0!==Z.done;Z=s.next()){Z.value.recreateShadowMap()}}}constructor(s,Z,o){super(s,o),this._shadowAngle=Math.PI/2,this.position=Z}getClassName(){return"PointLight"}getTypeID(){return Qs.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(s){if(this.direction)return super.getShadowDirection(s);switch(s){case 0:return new j.n(1,0,0);case 1:return new j.n(-1,0,0);case 2:return new j.n(0,-1,0);case 3:return new j.n(0,1,0);case 4:return new j.n(0,0,1);case 5:return new j.n(0,0,-1)}return j.n.Zero()}_setDefaultShadowProjectionMatrix(s,Z,o){const t=this.Ls().activeCamera;if(!t)return;const S=void 0!==this.shadowMinZ?this.shadowMinZ:t.OO,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,O=this.Ls().getEngine().useReverseDepthBuffer;j.b.PerspectiveFovLHToRef(this.shadowAngle,1,O?a:S,O?S:a,s,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(s,Z){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,Z):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,Z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,Z),this}transferToNodeMaterialEffect(s,Z){return this.computeTransformedInformation()?s.setFloat3(Z,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):s.setFloat3(Z,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(s,Z){s["POINTLIGHT"+Z]=!0}}(0,ds.c)([(0,Us.K)()],is.prototype,"shadowAngle",null),(0,Fs.f)("BABYLON.PointLight",is);const Ns="KHR_lights_punctual";class Ls{constructor(s){this.name=Ns,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ns)}dispose(){this._loader=null,delete this._lights}onLoading(){const s=this._loader.aO.extensions;if(s&&s[this.name]){const Z=s[this.name];this._lights=Z.lights,y.Assign(this._lights)}}loadNodeAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,a)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(s,Z,(s=>{let Z;const O=y.Get(t,this._lights,a.pa),v=O.name||s.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O.type){case"directional":{const s=new As.e(v,j.n.Backward(),this._loader.babylonScene);s.position.tO(0),Z=s;break}case"point":Z=new is(v,j.n.Zero(),this._loader.babylonScene);break;case"spot":{const s=new Bs.e(v,j.n.Zero(),j.n.Backward(),0,1,this._loader.babylonScene);s.angle=2*(O.spot&&O.spot.outerConeAngle||Math.PI/4),s.innerAngle=2*(O.spot&&O.spot.innerConeAngle||0),Z=s;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${t}: Invalid light type (${O.type})`)}Z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,O._babylonLight=Z,Z.falloffType=Qs.b.FALLOFF_GLTF,Z.DO=O.color?S.d.oO(O.color):S.d.White(),Z.QO=void 0==O.QO?1:O.QO,Z.range=void 0==O.range?Number.MAX_VALUE:O.range,Z.parent=s,this._loader._babylonLights.push(Z),C.AddPointerMetadata(Z,t),o(s)})))))}}h(Ns),q(Ns,!0,(s=>new Ls(s)));const Vs="KHR_materials_pbrSpecularGlossiness";class gs{constructor(s){this.name=Vs,this.order=200,this._loader=s,this.enabled=this._loader.isExtensionUsed(Vs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialBasePropertiesAsync(s,Z,o)),S.push(this._loadSpecularGlossinessPropertiesAsync(t,j,o)),this._loader.loadMaterialAlphaProperties(s,Z,o),await Promise.all(S).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return o.metallic=null,o.roughness=null,Z.diffuseFactor?(o.albedoColor=S.d.oO(Z.diffuseFactor),o.alpha=Z.diffuseFactor[3]):o.albedoColor=S.d.White(),o.reflectivityColor=Z.specularFactor?S.d.oO(Z.specularFactor):S.d.White(),o.microSurface=void 0==Z.glossinessFactor?1:Z.glossinessFactor,Z.diffuseTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/diffuseTexture`,Z.diffuseTexture,(s=>{s.name=`${o.name} (Diffuse)`,o.albedoTexture=s}))),Z.specularGlossinessTexture&&(t.push(this._loader.loadTextureInfoAsync(`${s}/specularGlossinessTexture`,Z.specularGlossinessTexture,(s=>{s.name=`${o.name} (Specular Glossiness)`,o.reflectivityTexture=s,o.reflectivityTexture.na=!0}))),o.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(t).then((()=>{}))}}h(Vs),q(Vs,!0,(s=>new gs(s)));const ls="KHR_materials_unlit";class Rs{constructor(s){this.name=ls,this.order=210,this._loader=s,this.enabled=this._loader.isExtensionUsed(ls)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async()=>await this._loadUnlitPropertiesAsync(s,Z,o)))}_loadUnlitPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;o.unlit=!0;const j=Z.pbrMetallicRoughness;return j&&(j.baseColorFactor?(o.albedoColor=S.d.oO(j.baseColorFactor),o.alpha=j.baseColorFactor[3]):o.albedoColor=S.d.White(),j.baseColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/baseColorTexture`,j.baseColorTexture,(s=>{s.name=`${o.name} (Base Color)`,o.albedoTexture=s})))),Z.doubleSided&&(o.Ta=!1,o.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(s,Z,o),Promise.all(t).then((()=>{}))}}h(ls),q(ls,!0,(s=>new Rs(s)));const es="KHR_materials_clearcoat";class cs{constructor(s){this.name=es,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(es)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadClearCoatPropertiesAsync(t,j,o)),await Promise.all(S)}))}_loadClearCoatPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return o.clearCoat.isEnabled=!0,o.clearCoat.useRoughnessFromMainTexture=!1,o.clearCoat.remapF0OnInterfaceChange=!1,void 0!=Z.clearcoatFactor?o.clearCoat.QO=Z.clearcoatFactor:o.clearCoat.QO=0,Z.clearcoatTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/clearcoatTexture`,Z.clearcoatTexture,(s=>{s.name=`${o.name} (ClearCoat)`,o.clearCoat.texture=s}))),void 0!=Z.clearcoatRoughnessFactor?o.clearCoat.roughness=Z.clearcoatRoughnessFactor:o.clearCoat.roughness=0,Z.clearcoatRoughnessTexture&&(Z.clearcoatRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${s}/clearcoatRoughnessTexture`,Z.clearcoatRoughnessTexture,(s=>{s.name=`${o.name} (ClearCoat Roughness)`,o.clearCoat.textureRoughness=s})))),Z.clearcoatNormalTexture&&(Z.clearcoatNormalTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${s}/clearcoatNormalTexture`,Z.clearcoatNormalTexture,(s=>{s.name=`${o.name} (ClearCoat Normal)`,o.clearCoat.bumpTexture=s}))),o.invertNormalMapX=!o.Ls().useRightHandedSystem,o.invertNormalMapY=o.Ls().useRightHandedSystem,void 0!=Z.clearcoatNormalTexture.scale&&(o.clearCoat.bumpTexture.level=Z.clearcoatNormalTexture.scale)),Promise.all(t).then((()=>{}))}}h(es),q(es,!0,(s=>new cs(s)));const ws="KHR_materials_iridescence";class Xs{constructor(s){this.name=ws,this.order=195,this._loader=s,this.enabled=this._loader.isExtensionUsed(ws)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadIridescencePropertiesAsync(t,j,o)),await Promise.all(S).then((()=>{}))}))}_loadIridescencePropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return o.iridescence.isEnabled=!0,o.iridescence.QO=Z.iridescenceFactor??0,o.iridescence.indexOfRefraction=Z.iridescenceIor??Z.iridescenceIOR??1.3,o.iridescence.minimumThickness=Z.iridescenceThicknessMinimum??100,o.iridescence.maximumThickness=Z.iridescenceThicknessMaximum??400,Z.iridescenceTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/iridescenceTexture`,Z.iridescenceTexture,(s=>{s.name=`${o.name} (Iridescence)`,o.iridescence.texture=s}))),Z.iridescenceThicknessTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/iridescenceThicknessTexture`,Z.iridescenceThicknessTexture,(s=>{s.name=`${o.name} (Iridescence Thickness)`,o.iridescence.thicknessTexture=s}))),Promise.all(t).then((()=>{}))}}h(ws),q(ws,!0,(s=>new Xs(s)));const Ws="KHR_materials_anisotropy";class qs{constructor(s){this.name=Ws,this.order=195,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ws)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadIridescencePropertiesAsync(t,j,o)),await Promise.all(S)}))}async _loadIridescencePropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;o.anisotropy.isEnabled=!0,o.anisotropy.QO=Z.anisotropyStrength??0,o.anisotropy.angle=Z.anisotropyRotation??0,Z.anisotropyTexture&&(Z.anisotropyTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${s}/anisotropyTexture`,Z.anisotropyTexture,(s=>{s.name=`${o.name} (Anisotropy Intensity)`,o.anisotropy.texture=s})))),await Promise.all(t)}}h(Ws),q(Ws,!0,(s=>new qs(s)));const hs="KHR_materials_emissive_strength";class Ms{constructor(s){this.name=hs,this.order=170,this._loader=s,this.enabled=this._loader.isExtensionUsed(hs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>await this._loader.loadMaterialPropertiesAsync(s,Z,o).then((()=>{this._loadEmissiveProperties(t,j,o)}))))}_loadEmissiveProperties(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);void 0!==Z.emissiveStrength&&(o.emissiveIntensity=Z.emissiveStrength)}}h(hs),q(hs,!0,(s=>new Ms(s)));const xs="KHR_materials_sheen";class ks{constructor(s){this.name=xs,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(xs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadSheenPropertiesAsync(t,j,o)),await Promise.all(S).then((()=>{}))}))}_loadSheenPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return o.sheen.isEnabled=!0,o.sheen.QO=1,void 0!=Z.sheenColorFactor?o.sheen.color=S.d.oO(Z.sheenColorFactor):o.sheen.color=S.d.Black(),Z.sheenColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/sheenColorTexture`,Z.sheenColorTexture,(s=>{s.name=`${o.name} (Sheen Color)`,o.sheen.texture=s}))),void 0!==Z.sheenRoughnessFactor?o.sheen.roughness=Z.sheenRoughnessFactor:o.sheen.roughness=0,Z.sheenRoughnessTexture&&(Z.sheenRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${s}/sheenRoughnessTexture`,Z.sheenRoughnessTexture,(s=>{s.name=`${o.name} (Sheen Roughness)`,o.sheen.textureRoughness=s})))),o.sheen.albedoScaling=!0,o.sheen.useRoughnessFromMainTexture=!1,Promise.all(t).then((()=>{}))}}h(xs),q(xs,!0,(s=>new ks(s)));var ys=o(11457);const Is="KHR_materials_specular";class Cs{constructor(s){this.name=Is,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(Is)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;if(S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadSpecularPropertiesAsync(t,j,o)),j.extensions&&j.extensions.EXT_materials_specular_edge_color&&o instanceof U.d){j.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(o.brdf.dielectricSpecularModel=ys.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,o.brdf.conductorSpecularModel=ys.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(S).then((()=>{}))}))}_loadSpecularPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return void 0!==Z.specularFactor&&(o.metallicF0Factor=Z.specularFactor),void 0!==Z.specularColorFactor&&(o.metallicReflectanceColor=S.d.oO(Z.specularColorFactor)),Z.specularTexture&&(Z.specularTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${s}/specularTexture`,Z.specularTexture,(s=>{s.name=`${o.name} (Specular)`,o.metallicReflectanceTexture=s,o.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),Z.specularColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/specularColorTexture`,Z.specularColorTexture,(s=>{s.name=`${o.name} (Specular Color)`,o.reflectanceTexture=s}))),Promise.all(t).then((()=>{}))}}h(Is),q(Is,!0,(s=>new Cs(s)));const Ks="KHR_materials_ior";class ps{constructor(s){this.name=Ks,this.order=180,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ks)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadIorPropertiesAsync(t,j,o)),await Promise.all(S).then((()=>{}))}))}_loadIorPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);return void 0!==Z.ior?o.indexOfRefraction=Z.ior:o.indexOfRefraction=ps._DEFAULT_IOR,Promise.resolve()}}ps._DEFAULT_IOR=1.5,h(Ks),q(Ks,!0,(s=>new ps(s)));const Es="KHR_materials_variants";class Ps{constructor(s){this.name=Es,this._loader=s,this.enabled=this._loader.isExtensionUsed(Es)}dispose(){this._loader=null}static GetAvailableVariants(s){const Z=this._GetExtensionMetadata(s);return Z?Object.keys(Z.variants):[]}getAvailableVariants(s){return Ps.GetAvailableVariants(s)}static SelectVariant(s,Z){const o=this._GetExtensionMetadata(s);if(!o)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Es} extension`);const t=s=>{const Z=o.variants[s];if(Z)for(const o of Z)o.mesh.material=o.material};if(Z instanceof Array)for(const j of Z)t(j);else t(Z);o.lastSelected=Z}selectVariant(s,Z){Ps.SelectVariant(s,Z)}static Reset(s){const Z=this._GetExtensionMetadata(s);if(!Z)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Es} extension`);for(const o of Z.original)o.mesh.material=o.material;Z.lastSelected=null}reset(s){Ps.Reset(s)}static GetLastSelectedVariant(s){const Z=this._GetExtensionMetadata(s);if(!Z)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Es} extension`);return Z.lastSelected}getLastSelectedVariant(s){return Ps.GetLastSelectedVariant(s)}static _GetExtensionMetadata(s){var Z,o;return(null===s||void 0===s||null===(Z=s._internalMetadata)||void 0===Z||null===(o=Z.aO)||void 0===o?void 0:o[Es])||null}onLoading(){const s=this._loader.aO.extensions;if(s&&s[this.name]){const Z=s[this.name];this._variants=Z.variants}}onReady(){const s=this._loader.rootBabylonMesh;if(s){var Z;const o=this._loader.parent.extensionOptions[Es];null!==o&&void 0!==o&&o.defaultVariant&&Ps.SelectVariant(s,o.defaultVariant),null===o||void 0===o||null===(Z=o.onLoaded)||void 0===Z||Z.call(o,{get variants(){return Ps.GetAvailableVariants(s)},get selectedVariant(){const Z=Ps.GetLastSelectedVariant(s);return Z?Array.isArray(Z)?Z[0]:Z:Ps.GetAvailableVariants(s)[0]},set selectedVariant(Z){Ps.SelectVariant(s,Z)}})}}_loadMeshPrimitiveAsync(s,Z,o,t,j,S){return C.LoadExtensionAsync(s,j,this.name,(async(a,O)=>{const v=new Array;return v.push(this._loader._loadMeshPrimitiveAsync(s,Z,o,t,j,(Z=>{if(S(Z),Z instanceof L.d){const o=C._GetDrawMode(s,j.mode),t=this._loader.rootBabylonMesh,S=t?t._internalMetadata=t._internalMetadata||{}:{},G=S.aO=S.aO||{},B=G[Es]=G[Es]||{lastSelected:null,original:[],variants:{}};B.original.push({mesh:Z,material:Z.material});for(let s=0;s<O.mappings.length;++s){const j=O.mappings[s],S=y.Get(`${a}/mappings/${s}/material`,this._loader.aO.materials,j.material);v.push(this._loader._loadMaterialAsync(`#/materials/${j.material}`,S,Z,o,(s=>{for(let o=0;o<j.variants.length;++o){const S=j.variants[o],a=y.Get(`/extensions/${Es}/variants/${S}`,this._variants,S);B.variants[a.name]=B.variants[a.name]||[],B.variants[a.name].push({mesh:Z,material:s}),Z.onClonedObservable.add((s=>{const o=s;let j=null,S=o;do{if(S=S.parent,!S)return;j=Ps._GetExtensionMetadata(S)}while(null===j);if(t&&j===Ps._GetExtensionMetadata(t)){S._internalMetadata={};for(const s in t._internalMetadata)S._internalMetadata[s]=t._internalMetadata[s];S._internalMetadata.aO=[];for(const s in t._internalMetadata.aO)S._internalMetadata.aO[s]=t._internalMetadata.aO[s];S._internalMetadata.aO[Es]={lastSelected:null,original:[],variants:{}};for(const s of j.original)S._internalMetadata.aO[Es].original.push({mesh:s.mesh,material:s.material});for(const s in j.variants)if(Object.prototype.hasOwnProperty.call(j.variants,s)){S._internalMetadata.aO[Es].variants[s]=[];for(const Z of j.variants[s])S._internalMetadata.aO[Es].variants[s].push({mesh:Z.mesh,material:Z.material})}j=S._internalMetadata.aO[Es]}for(const t of j.original)t.mesh===Z&&(t.mesh=o);for(const t of j.variants[a.name])t.mesh===Z&&(t.mesh=o)}))}})))}}}))),await Promise.all(v).then((s=>{let[Z]=s;return Z}))}))}}h(Es),q(Es,!0,(s=>new Ps(s)));var rs=o(11416);class Ts{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ys.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(s,Z){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ts._GetDefaultOptions(),...s},this._scene=Z,this._scene._transmissionHelper=this,this.onErrorObservable=new B.b,this._scene.jO.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(s){if(!Object.keys(s).filter((Z=>this._options[Z]!==s[Z])).length)return;const Z={...this._options,...s},o=this._options;this._options=Z,Z.renderSize===o.renderSize&&Z.renderTargetTextureType===o.renderTargetTextureType&&Z.generateMipmaps===o.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=Z.samples,this._opaqueRenderTarget.lodGenerationScale=Z.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=Z.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(s){return!!s&&!!(s instanceof U.d&&s.subSurface.isRefractionEnabled)}_addMesh(s){this._materialObservers[s.uniqueId]=s.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),a.g.SetImmediate((()=>{this._shouldRenderAsTransmission(s.material)?(s.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(s)&&this._transparentMeshesCache.push(s)):-1===this._opaqueMeshesCache.indexOf(s)&&this._opaqueMeshesCache.push(s)}))}_removeMesh(s){s.onMaterialChangedObservable.remove(this._materialObservers[s.uniqueId]),delete this._materialObservers[s.uniqueId];let Z=this._transparentMeshesCache.indexOf(s);-1!==Z&&this._transparentMeshesCache.splice(Z,1),Z=this._opaqueMeshesCache.indexOf(s),-1!==Z&&this._opaqueMeshesCache.splice(Z,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(s){const Z=this._transparentMeshesCache.indexOf(s),o=this._opaqueMeshesCache.indexOf(s);this._shouldRenderAsTransmission(s.material)?(s.material instanceof U.d&&(s.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==o?(this._opaqueMeshesCache.splice(o,1),this._transparentMeshesCache.push(s)):-1===Z&&this._transparentMeshesCache.push(s)):-1!==Z?(this._transparentMeshesCache.splice(Z,1),this._opaqueMeshesCache.push(s)):-1===o&&this._opaqueMeshesCache.push(s)}_isRenderTargetValid(){var s;return null!==(null===(s=this._opaqueRenderTarget)||void 0===s?void 0:s.getInternalTexture())}_setupRenderTargets(){var s;let Z;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new rs.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(s=this._options.clearColor)||void 0===s?void 0:s.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((s=>{Z=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?s.clearColor.O(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(s.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=Z}));for(const o of this._transparentMeshesCache)this._shouldRenderAsTransmission(o.material)&&(o.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ms="KHR_materials_transmission";class ns{constructor(s){this.name=ms,this.order=175,this._loader=s,this.enabled=this._loader.isExtensionUsed(ms),this.enabled&&(s.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadTransparentPropertiesAsync(t,Z,o,j)),await Promise.all(S).then((()=>{}))}))}_loadTransparentPropertiesAsync(s,Z,o,t){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const j=o;if(j.subSurface.isRefractionEnabled=!0,j.subSurface.volumeIndexOfRefraction=1,j.subSurface.useAlbedoToTintRefraction=!0,void 0===t.transmissionFactor)return j.subSurface.refractionIntensity=0,j.subSurface.isRefractionEnabled=!1,Promise.resolve();{var S;j.subSurface.refractionIntensity=t.transmissionFactor;const s=j.Ls();if(j.subSurface.refractionIntensity&&!s._transmissionHelper)new Ts({},j.Ls());else if(j.subSurface.refractionIntensity&&(null===(S=s._transmissionHelper)||void 0===S||!S._isRenderTargetValid())){var a;null===(a=s._transmissionHelper)||void 0===a||a._setupRenderTargets()}}return j.subSurface.minimumThickness=0,j.subSurface.maximumThickness=0,t.transmissionTexture?(t.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${s}/transmissionTexture`,t.transmissionTexture,void 0).then((s=>{s.name=`${o.name} (Transmission)`,j.subSurface.refractionIntensityTexture=s,j.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(ms),q(ms,!0,(s=>new ns(s)));const Js="KHR_materials_diffuse_transmission";class sZ{constructor(s){this.name=Js,this.order=174,this._loader=s,this.enabled=this._loader.isExtensionUsed(Js),this.enabled&&(s.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadTranslucentPropertiesAsync(t,Z,o,j)),await Promise.all(S).then((()=>{}))}))}_loadTranslucentPropertiesAsync(s,Z,o,t){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const j=o;if(j.subSurface.isTranslucencyEnabled=!0,j.subSurface.volumeIndexOfRefraction=1,j.subSurface.minimumThickness=0,j.subSurface.maximumThickness=0,j.subSurface.useAlbedoToTintTranslucency=!1,void 0===t.diffuseTransmissionFactor)return j.subSurface.translucencyIntensity=0,j.subSurface.isTranslucencyEnabled=!1,Promise.resolve();j.subSurface.translucencyIntensity=t.diffuseTransmissionFactor;const a=new Array;return j.subSurface.useGltfStyleTextures=!0,t.diffuseTransmissionTexture&&(t.diffuseTransmissionTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${s}/diffuseTransmissionTexture`,t.diffuseTransmissionTexture).then((s=>{s.name=`${o.name} (Diffuse Transmission)`,j.subSurface.translucencyIntensityTexture=s})))),void 0!==t.diffuseTransmissionColorFactor?j.subSurface.translucencyColor=S.d.oO(t.diffuseTransmissionColorFactor):j.subSurface.translucencyColor=S.d.White(),t.diffuseTransmissionColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${s}/diffuseTransmissionColorTexture`,t.diffuseTransmissionColorTexture).then((s=>{s.name=`${o.name} (Diffuse Transmission Color)`,j.subSurface.translucencyColorTexture=s}))),Promise.all(a).then((()=>{}))}}h(Js),q(Js,!0,(s=>new sZ(s)));const ZZ="KHR_materials_volume";class oZ{constructor(s){this.name=ZZ,this.order=173,this._loader=s,this.enabled=this._loader.isExtensionUsed(ZZ),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadVolumePropertiesAsync(t,Z,o,j)),await Promise.all(S).then((()=>{}))}))}_loadVolumePropertiesAsync(s,Z,o,t){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);if(!o.subSurface.isRefractionEnabled&&!o.subSurface.isTranslucencyEnabled||!t.thicknessFactor)return Promise.resolve();o.subSurface.volumeIndexOfRefraction=o.indexOfRefraction;const j=void 0!==t.attenuationDistance?t.attenuationDistance:Number.MAX_VALUE;return o.subSurface.tintColorAtDistance=j,void 0!==t.attenuationColor&&3==t.attenuationColor.length&&o.subSurface.tintColor.Ja(t.attenuationColor[0],t.attenuationColor[1],t.attenuationColor[2]),o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=t.thicknessFactor,o.subSurface.useThicknessAsDepth=!0,t.thicknessTexture?(t.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${s}/thicknessTexture`,t.thicknessTexture).then((s=>{s.name=`${o.name} (Thickness)`,o.subSurface.thicknessTexture=s,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(ZZ),q(ZZ,!0,(s=>new oZ(s)));const tZ="KHR_materials_dispersion";class jZ{constructor(s){this.name=tZ,this.order=174,this._loader=s,this.enabled=this._loader.isExtensionUsed(tZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadDispersionPropertiesAsync(t,Z,o,j)),await Promise.all(S).then((()=>{}))}))}_loadDispersionPropertiesAsync(s,Z,o,t){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);return o.subSurface.isRefractionEnabled&&t.dispersion?(o.subSurface.isDispersionEnabled=!0,o.subSurface.dispersion=t.dispersion,Promise.resolve()):Promise.resolve()}}h(tZ),q(tZ,!0,(s=>new jZ(s)));const SZ="EXT_materials_diffuse_roughness";class aZ{constructor(s){this.name=SZ,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(SZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(s,Z,o)),S.push(this._loadDiffuseRoughnessPropertiesAsync(t,j,o)),await Promise.all(S).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(s,Z,o){if(!(o instanceof U.d))throw new Error(`${s}: Material type not supported`);const t=new Array;return o.brdf.baseDiffuseModel=ys.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=Z.diffuseRoughnessFactor?o.baseDiffuseRoughness=Z.diffuseRoughnessFactor:o.baseDiffuseRoughness=0,Z.diffuseRoughnessTexture&&t.push(this._loader.loadTextureInfoAsync(`${s}/diffuseRoughnessTexture`,Z.diffuseRoughnessTexture,(s=>{s.name=`${o.name} (Diffuse Roughness)`,o.baseDiffuseRoughnessTexture=s}))),Promise.all(t).then((()=>{}))}}h(SZ),q(SZ,!0,(s=>new aZ(s)));const OZ="KHR_mesh_quantization";class vZ{constructor(s){this.name=OZ,this.enabled=s.isExtensionUsed(OZ)}dispose(){}}h(OZ),q(OZ,!0,(s=>new vZ(s)));const GZ="KHR_texture_basisu";class BZ{constructor(s){this.name=GZ,this._loader=s,this.enabled=s.isExtensionUsed(GZ)}dispose(){this._loader=null}_loadTextureAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>{const S=void 0==Z.sampler?C.DefaultSampler:y.Get(`${s}/sampler`,this._loader.aO.samplers,Z.sampler),a=y.Get(`${t}/source`,this._loader.aO.images,j.source);return await this._loader._createTextureAsync(s,S,a,(s=>{o(s)}),Z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!Z._textureInfo.nonColorData)}))}}h(GZ),q(GZ,!0,(s=>new BZ(s)));const QZ="KHR_texture_transform";class DZ{constructor(s){this.name=QZ,this._loader=s,this.enabled=this._loader.isExtensionUsed(QZ)}dispose(){this._loader=null}loadTextureInfoAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(t,j)=>await this._loader.loadTextureInfoAsync(s,Z,(s=>{if(!(s instanceof u.c))throw new Error(`${t}: Texture type not supported`);j.offset&&(s.uOffset=j.offset[0],s.vOffset=j.offset[1]),s.uRotationCenter=0,s.vRotationCenter=0,j.rotation&&(s.wAng=-j.rotation),j.scale&&(s.uScale=j.scale[0],s.vScale=j.scale[1]),void 0!=j.texCoord&&(s.coordinatesIndex=j.texCoord),o(s)}))))}}h(QZ),q(QZ,!0,(s=>new DZ(s)));const zZ="KHR_xmp_json_ld";class YZ{constructor(s){this.name=zZ,this.order=100,this._loader=s,this.enabled=this._loader.isExtensionUsed(zZ)}dispose(){this._loader=null}onLoading(){var s,Z,o;if(null===this._loader.rootBabylonMesh)return;const t=null===(s=this._loader.aO.extensions)||void 0===s?void 0:s.KHR_xmp_json_ld,j=null===(Z=this._loader.aO.asset)||void 0===Z||null===(o=Z.extensions)||void 0===o?void 0:o.KHR_xmp_json_ld;if(t&&j){const s=+j.packet;t.packets&&s<t.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=t.packets[s])}}}function bZ(s,Z,o,t){return S.d.oO(Z,o).scale(t)}function fZ(s,Z,o,t){return Z[o]*t}function AZ(s,Z,o,t){return-Z[o]*t}function dZ(s,Z,o,t){return Z[o+1]*t}function UZ(s,Z,o,t){return Z[o]*t*2}function uZ(s){return{scale:[new FZ(D.e.ANIMATIONTYPE_FLOAT,`${s}.uScale`,fZ,(()=>2)),new FZ(D.e.ANIMATIONTYPE_FLOAT,`${s}.vScale`,dZ,(()=>2))],offset:[new FZ(D.e.ANIMATIONTYPE_FLOAT,`${s}.uOffset`,fZ,(()=>2)),new FZ(D.e.ANIMATIONTYPE_FLOAT,`${s}.vOffset`,dZ,(()=>2))],rotation:[new FZ(D.e.ANIMATIONTYPE_FLOAT,`${s}.wAng`,AZ,(()=>1))]}}h(zZ),q(zZ,!0,(s=>new YZ(s)));class HZ extends K.AnimationPropertyInfo{buildAnimations(s,Z,o,t){return[{babylonAnimatable:s._babylonCamera,babylonAnimation:this._buildAnimation(Z,o,t)}]}}class FZ extends K.AnimationPropertyInfo{buildAnimations(s,Z,o,t){const j=[];for(const S in s._data)j.push({babylonAnimatable:s._data[S].babylonMaterial,babylonAnimation:this._buildAnimation(Z,o,t)});return j}}class iZ extends K.AnimationPropertyInfo{buildAnimations(s,Z,o,t){return[{babylonAnimatable:s._babylonLight,babylonAnimation:this._buildAnimation(Z,o,t)}]}}(0,M.l)("/cameras/{}/orthographic/xmag",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"orthoLeft",AZ,(()=>1)),new HZ(D.e.ANIMATIONTYPE_FLOAT,"orthoRight",dZ,(()=>1))]),(0,M.l)("/cameras/{}/orthographic/ymag",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"orthoBottom",AZ,(()=>1)),new HZ(D.e.ANIMATIONTYPE_FLOAT,"orthoTop",dZ,(()=>1))]),(0,M.l)("/cameras/{}/orthographic/zfar",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"maxZ",fZ,(()=>1))]),(0,M.l)("/cameras/{}/orthographic/znear",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"OO",fZ,(()=>1))]),(0,M.l)("/cameras/{}/perspective/yfov",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"fov",fZ,(()=>1))]),(0,M.l)("/cameras/{}/perspective/zfar",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"maxZ",fZ,(()=>1))]),(0,M.l)("/cameras/{}/perspective/znear",[new HZ(D.e.ANIMATIONTYPE_FLOAT,"OO",fZ,(()=>1))]),(0,M.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new FZ(D.e.ANIMATIONTYPE_COLOR3,"albedoColor",bZ,(()=>4)),new FZ(D.e.ANIMATIONTYPE_FLOAT,"alpha",(function(s,Z,o,t){return Z[o+3]*t}),(()=>4))]),(0,M.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"metallic",fZ,(()=>1))]),(0,M.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"roughness",fZ,(()=>1))]);const NZ=uZ("albedoTexture");(0,M.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",NZ.scale),(0,M.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",NZ.offset),(0,M.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",NZ.rotation);const LZ=uZ("metallicTexture");(0,M.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",LZ.scale),(0,M.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",LZ.offset),(0,M.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",LZ.rotation),(0,M.l)("/materials/{}/emissiveFactor",[new FZ(D.e.ANIMATIONTYPE_COLOR3,"emissiveColor",bZ,(()=>3))]);const VZ=uZ("bumpTexture");(0,M.l)("/materials/{}/normalTexture/scale",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",fZ,(()=>1))]),(0,M.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",VZ.scale),(0,M.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",VZ.offset),(0,M.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",VZ.rotation),(0,M.l)("/materials/{}/occlusionTexture/strength",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",fZ,(()=>1))]);const gZ=uZ("ambientTexture");(0,M.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",gZ.scale),(0,M.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",gZ.offset),(0,M.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",gZ.rotation);const lZ=uZ("emissiveTexture");(0,M.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",lZ.scale),(0,M.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",lZ.offset),(0,M.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",lZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",fZ,(()=>1))]);const RZ=uZ("anisotropy.texture");(0,M.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",RZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",RZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",RZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",fZ,(()=>1))]);const eZ=uZ("clearCoat.texture");(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",eZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",eZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",eZ.rotation);const cZ=uZ("clearCoat.bumpTexture");(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",cZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",cZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",cZ.rotation);const wZ=uZ("clearCoat.textureRoughness");(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",wZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",wZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",wZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",fZ,(()=>1))]);const XZ=uZ("iridescence.texture");(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",XZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",XZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",XZ.rotation);const WZ=uZ("iridescence.thicknessTexture");(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",WZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",WZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",WZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new FZ(D.e.ANIMATIONTYPE_COLOR3,"sheen.color",bZ,(()=>3))]),(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",fZ,(()=>1))]);const qZ=uZ("sheen.texture");(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",qZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",qZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",qZ.rotation);const hZ=uZ("sheen.textureRoughness");(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",hZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",hZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",hZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new FZ(D.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",bZ,(()=>3))]);const MZ=uZ("metallicReflectanceTexture");(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",MZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",MZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",MZ.rotation);const xZ=uZ("reflectanceTexture");(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",xZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",xZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",xZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",fZ,(()=>1))]);const kZ=uZ("subSurface.refractionIntensityTexture");(0,M.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",kZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",kZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",kZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new FZ(D.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",bZ,(()=>3))]),(0,M.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",fZ,(()=>1))]),(0,M.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",fZ,(()=>1))]);const yZ=uZ("subSurface.thicknessTexture");(0,M.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",yZ.scale),(0,M.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",yZ.offset),(0,M.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",yZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new FZ(D.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",fZ,(()=>1))]);const IZ=uZ("subSurface.translucencyIntensityTexture");(0,M.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",IZ.scale),(0,M.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",IZ.offset),(0,M.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",IZ.rotation),(0,M.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new FZ(D.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",bZ,(()=>3))]);const CZ=uZ("subSurface.translucencyColorTexture");(0,M.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",CZ.scale),(0,M.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",CZ.offset),(0,M.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",CZ.rotation),(0,M.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new iZ(D.e.ANIMATIONTYPE_COLOR3,"diffuse",bZ,(()=>3))]),(0,M.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new iZ(D.e.ANIMATIONTYPE_FLOAT,"intensity",fZ,(()=>1))]),(0,M.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new iZ(D.e.ANIMATIONTYPE_FLOAT,"range",fZ,(()=>1))]),(0,M.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new iZ(D.e.ANIMATIONTYPE_FLOAT,"innerAngle",UZ,(()=>1))]),(0,M.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new iZ(D.e.ANIMATIONTYPE_FLOAT,"angle",UZ,(()=>1))]),(0,M.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new iZ(D.e.ANIMATIONTYPE_COLOR3,"diffuse",bZ,(()=>3))]),(0,M.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new iZ(D.e.ANIMATIONTYPE_FLOAT,"intensity",fZ,(()=>1))]);const KZ="KHR_animation_pointer";class pZ{constructor(s){this.name=KZ,this._loader=s,this._pathToObjectConverter=(0,M.i)(this._loader.aO)}get enabled(){return this._loader.isExtensionUsed(KZ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(s,Z,o,t,j){var S;const a=null===(S=t.target.extensions)||void 0===S?void 0:S.KHR_animation_pointer;if(!a||!this._pathToObjectConverter)return null;"pointer"!==t.target.path&&b.b.Warn(`${s}/target/path: Value (${t.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=t.target.node&&b.b.Warn(`${s}/target/node: Value (${t.target.node}) must not be present when using the ${this.name} extension`);const O=`${s}/extensions/${this.name}`,v=a.pointer;if(!v)throw new Error(`${O}: Pointer is missing`);try{const S=this._pathToObjectConverter.convert(v);if(!S.info.interpolation)throw new Error(`${O}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(s,Z,o,t,{object:S.object,info:S.info.interpolation},j)}catch(G){return b.b.Warn(`${O}/pointer: Invalid pointer (${v}) skipped`),null}}}h(KZ),q(KZ,!0,(s=>new pZ(s)));class EZ{constructor(s,Z,o){this.frame=s,this.action=Z,this.onlyOnce=o,this.isDone=!1}_clone(){return new EZ(this.frame,this.action,this.onlyOnce)}}var PZ=o(10975),rZ=o(11013),TZ=o(11009);class mZ{get loop(){return this._loop}set loop(s){s!==this._loop&&(this._loop=s,this.updateOptions({loop:s}))}get currentTime(){var s;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.audioContext&&(this.isPlaying||this.isPaused)){const s=this.isPaused?0:rZ.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+s}return 0}get spatialSound(){return this._spatialSound}set spatialSound(s){if(s==this._spatialSound)return;const Z=this.isPlaying;this.pause(),s?(this._spatialSound=s,this._updateSpatialParameters()):this._disableSpatialSound(),Z&&this.play()}constructor(s,Z,o){var t;let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new B.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=j.n.Zero(),this._localDirection=new j.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=s,o=o||Y.c.LastCreatedScene)if(this._scene=o,mZ._SceneComponentInitialization(o),this._readyToPlayCallback=S,this._customAttenuationFunction=(s,Z,o,t,j)=>Z<o?s*(1-Z/o):0,O&&(this.autoplay=O.autoplay||!1,this._loop=O.loop||!1,void 0!==O.volume&&(this._volume=O.volume),this._spatialSound=O.spatialSound??!1,this.maxDistance=O.maxDistance??100,this.useCustomAttenuation=O.useCustomAttenuation??!1,this.rolloffFactor=O.rolloffFactor||1,this.refDistance=O.refDistance||1,this.distanceModel=O.distanceModel||"linear",this._playbackRate=O.playbackRate||1,this._streaming=O.streaming??!1,this._length=O.length,this._offset=O.offset),null!==(t=rZ.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&rZ.e.audioEngine.audioContext){this._soundGain=rZ.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let s=!0;if(Z)try{"string"===typeof Z?(this._urlType="String",this._url=Z):Z instanceof ArrayBuffer?this._urlType="ArrayBuffer":Z instanceof HTMLMediaElement?this._urlType="MediaElement":Z instanceof MediaStream?this._urlType="MediaStream":Z instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(Z)&&(this._urlType="Array");let o=[],t=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=rZ.e.audioEngine.audioContext.createMediaElementSource(Z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=rZ.e.audioEngine.audioContext.createMediaStreamSource(Z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":Z.byteLength>0&&(t=!0,this._soundLoaded(Z));break;case"AudioBuffer":this._audioBufferLoaded(Z);break;case"String":o.push(Z);case"Array":0===o.length&&(o=Z);for(let s=0;s<o.length;s++){const Z=o[s];if(t=O&&O.skipCodecCheck||-1!==Z.indexOf(".mp3",Z.length-4)&&rZ.e.audioEngine.isMP3supported||-1!==Z.indexOf(".ogg",Z.length-4)&&rZ.e.audioEngine.isOGGsupported||-1!==Z.indexOf(".wav",Z.length-4)||-1!==Z.indexOf(".m4a",Z.length-4)||-1!==Z.indexOf(".mp4",Z.length-4)||-1!==Z.indexOf("blob:"),t){this._streaming?(this._htmlAudioElement=new Audio(Z),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,a.g.SetCorsBehavior(Z,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(Z,(s=>{this._soundLoaded(s)}),void 0,!0,!0,(s=>{s&&b.b.Error("XHR "+s.status+" error on: "+Z+"."),b.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:s=!1}s?t||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):b.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(v){b.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),rZ.e.audioEngine&&!rZ.e.audioEngine.WarnedWebAudioUnsupported&&(b.b.Error("Web Audio is not supported by your browser."),rZ.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var s;null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(s){var Z;null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.audioContext&&(this._audioBuffer=s,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(s){var Z;null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.audioContext&&rZ.e.audioEngine.audioContext.decodeAudioData(s,(s=>{this._audioBufferLoaded(s)}),(s=>{b.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+s)}))}setAudioBuffer(s){var Z;null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this._audioBuffer=s,this._isReadyToPlay=!0)}updateOptions(s){s&&(this.loop=s.loop??this.loop,this.maxDistance=s.maxDistance??this.maxDistance,this.useCustomAttenuation=s.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=s.rolloffFactor??this.rolloffFactor,this.refDistance=s.refDistance??this.refDistance,this.distanceModel=s.distanceModel??this.distanceModel,this._playbackRate=s.playbackRate??this._playbackRate,this._length=s.length??void 0,this.spatialSound=s.spatialSound??this._spatialSound,this._setOffset(s.offset??void 0),this.setVolume(s.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var s;null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&rZ.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??rZ.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var s;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(s=this._soundPanner)||void 0===s||s.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var s;null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(s){var Z;null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(s),this._isOutputConnected=!0)}setDirectionalCone(s,Z,o){Z<s?b.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=s,this._coneOuterAngle=Z,this._coneOuterGain=o,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(s){if(s!=this._coneInnerAngle){var Z;if(this._coneOuterAngle<s)return void b.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=s,null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(s){if(s!=this._coneOuterAngle){var Z;if(s<this._coneInnerAngle)return void b.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=s,null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(s){var Z;s.equals(this._position)||(this._position.O(s),null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(s){var Z;this._localDirection=s,null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const s=this._connectedTransformNode.getWorldMatrix(),Z=j.n.TransformNormal(this._localDirection,s);Z.normalize(),this._soundPanner.orientationX.value=Z.x,this._soundPanner.orientationY.value=Z.y,this._soundPanner.orientationZ.value=Z.z}updateDistanceFromListener(){var s;if(null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const s=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Go(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,s,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(s){this._customAttenuationFunction=s}play(s,Z,o){var t;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(t=rZ.e.audioEngine)&&void 0!==t&&t.audioContext)try{var j,S;this._clearTimeoutsAndObservers();let t=s?(null===(j=rZ.e.audioEngine)||void 0===j?void 0:j.audioContext.currentTime)+s:null===(S=rZ.e.audioEngine)||void 0===S?void 0:S.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=rZ.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const s=()=>{var o;if(null!==(o=rZ.e.audioEngine)&&void 0!==o&&o.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=Z??0;const o=this._htmlAudioElement.play();void 0!==o&&o.catch((()=>{var Z,o;(null===(Z=rZ.e.audioEngine)||void 0===Z||Z.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(o=rZ.e.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{s()})))}))}else{var t;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(t=rZ.e.audioEngine)||void 0===t?void 0:t.onAudioUnlockedObservable.addOnce((()=>{s()}))}};s()}}else{var a;const j=()=>{var j;if(null!==(j=rZ.e.audioEngine)&&void 0!==j&&j.audioContext){var S;if(o=o||this._length,void 0!==Z&&this._setOffset(Z),this._soundSource){const s=this._soundSource;s.onended=()=>{s.disconnect()}}if(this._soundSource=null===(S=rZ.e.audioEngine)||void 0===S?void 0:S.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var a;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==Z&&(this._soundSource.loopStart=Z),void 0!==o&&(this._soundSource.loopEnd=(0|Z)+o),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},t=s?(null===(a=rZ.e.audioEngine)||void 0===a?void 0:a.audioContext.currentTime)+s:rZ.e.audioEngine.audioContext.currentTime;const j=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(t,j,this.loop?void 0:o)}}};"suspended"===(null===(a=rZ.e.audioEngine)||void 0===a?void 0:a.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var s;"suspended"===(null===(s=rZ.e.audioEngine)||void 0===s?void 0:s.audioContext.state)?(rZ.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=rZ.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{j()})))):j()}),500):j()}this._startTime=t,this.isPlaying=!0,this.isPaused=!1}catch(O){b.b.Error("Error while trying to play audio: "+this.name+", "+O.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(s){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var o;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(o=this._streamingSource)||void 0===o||o.disconnect();this.isPlaying=!1}else if(null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource){const Z=s?rZ.e.audioEngine.audioContext.currentTime+s:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(Z)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var s;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Z;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(Z=this._streamingSource)||void 0===Z||Z.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=rZ.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(s,Z){var o;null!==(o=rZ.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._soundGain&&(Z&&rZ.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(rZ.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,rZ.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(s,rZ.e.audioEngine.audioContext.currentTime+Z)):this._soundGain.gain.value=s),this._volume=s}setPlaybackRate(s){this._playbackRate=s,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(s){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=s,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=s=>this._onRegisterAfterWorldMatrixUpdate(s),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(s){var Z;if(s.getBoundingInfo){const Z=s.getBoundingInfo();this.setPosition(Z.boundingSphere.centerWorld)}else this.setPosition(s.absolutePosition);null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const s=()=>{(0,TZ.d)((()=>this._isReadyToPlay),(()=>{o._audioBuffer=this.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,this._offset,this._length)}),void 0,300)},Z={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},o=new mZ(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,Z);return this.useCustomAttenuation&&o.setAttenuationFunction(this._customAttenuationFunction),o.setPosition(this._position),o.setPlaybackRate(this._playbackRate),s(),o}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const s={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(s.connectedMeshId=this._connectedTransformNode.id),s.position=this._position.ma(),s.refDistance=this.refDistance,s.distanceModel=this.distanceModel,s.isDirectional=this._isDirectional,s.localDirectionToMesh=this._localDirection.ma(),s.coneInnerAngle=this._coneInnerAngle,s.coneOuterAngle=this._coneOuterAngle,s.coneOuterGain=this._coneOuterGain),s}static Parse(s,Z,o,t){const S=s.name;let a;a=s.url?o+s.url:o+S;const O={autoplay:s.autoplay,loop:s.loop,volume:s.volume,spatialSound:s.spatialSound,maxDistance:s.maxDistance,rolloffFactor:s.rolloffFactor,refDistance:s.refDistance,distanceModel:s.distanceModel,playbackRate:s.playbackRate};let v;if(t){const s=()=>{(0,TZ.d)((()=>t._isReadyToPlay),(()=>{v._audioBuffer=t.getAudioBuffer(),v._isReadyToPlay=!0,v.autoplay&&v.play(0,v._offset,v._length)}),void 0,300)};v=new mZ(S,new ArrayBuffer(0),Z,null,O),s()}else v=new mZ(S,a,Z,(()=>{Z.removePendingData(v)}),O),Z.addPendingData(v);if(s.position){const Z=j.n.oO(s.position);v.setPosition(Z)}if(s.isDirectional&&(v.setDirectionalCone(s.coneInnerAngle||360,s.coneOuterAngle||360,s.coneOuterGain||0),s.localDirectionToMesh)){const Z=j.n.oO(s.localDirectionToMesh);v.setLocalDirectionToMesh(Z)}if(s.connectedMeshId){const o=Z.getMeshById(s.connectedMeshId);o&&v.attachToMesh(o)}return s.metadata&&(v.metadata=s.metadata),v}_setOffset(s){this._offset!==s&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=s)}_clearTimeoutsAndObservers(){var s;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(s=rZ.e.audioEngine)||void 0===s||s.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}mZ._SceneComponentInitialization=s=>{throw(0,PZ.d)("AudioSceneComponent")},(0,Fs.f)("BABYLON.Sound",mZ);class nZ{constructor(s,Z,o){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],Z.length!==o.length)throw new Error("Sounds length does not equal weights length");this.loop=s,this._weights=o;let t=0;for(const S of o)t+=S;const j=t>0?1/t:0;for(let S=0;S<this._weights.length;S++)this._weights[S]*=j;this._sounds=Z;for(const S of this._sounds)S.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(s){if(s!==this._coneInnerAngle){if(this._coneOuterAngle<s)return void b.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=s;for(const Z of this._sounds)Z.directionalConeInnerAngle=s}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(s){if(s!==this._coneOuterAngle){if(s<this._coneInnerAngle)return void b.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=s;for(const Z of this._sounds)Z.directionalConeOuterAngle=s}}get volume(){return this._volume}set volume(s){if(s!==this._volume)for(const Z of this._sounds)Z.setVolume(s)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(s){if(!this.isPaused){this.stop();const s=Math.random();let Z=0;for(let o=0;o<this._weights.length;o++)if(Z+=this._weights[o],s<=Z){this._currentIndex=o;break}}const Z=this._sounds[this._currentIndex??0];Z.isReady()?Z.play(0,this.isPaused?void 0:s):Z.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class JZ{constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(s=s||Y.c.LastCreatedScene)&&(this._scene=s,this.soundCollection=[],this._options=Z,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var s;null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&rZ.e.audioEngine.audioContext&&(this._outputAudioNode=rZ.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(rZ.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(rZ.e.audioEngine&&rZ.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(s){var Z;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&s.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==s.soundTrackId&&(-1===s.soundTrackId?this._scene.mainSoundTrack.removeSound(s):this._scene.soundTracks&&this._scene.soundTracks[s.soundTrackId].removeSound(s)),this.soundCollection.push(s),s.soundTrackId=this.id}removeSound(s){const Z=this.soundCollection.indexOf(s);-1!==Z&&this.soundCollection.splice(Z,1)}setVolume(s){var Z;null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=s)}switchPanningModelToHRTF(){var s;if(null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio)for(let Z=0;Z<this.soundCollection.length;Z++)this.soundCollection[Z].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var s;if(null!==(s=rZ.e.audioEngine)&&void 0!==s&&s.canUseWebAudio)for(let Z=0;Z<this.soundCollection.length;Z++)this.soundCollection[Z].switchPanningModelToEqualPower()}connectToAnalyser(s){var Z;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=s,null!==(Z=rZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,rZ.e.audioEngine.masterGain))}}var so=o(11297),Zo=o(11493),oo=o(10947);rZ.e.AudioEngineFactory=(s,Z,o)=>new to(s,Z,o);class to{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new B.b,this.onAudioLockedObservable=new B.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,oo.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const t=document.createElement("audio");this._hostElement=s,this._audioContext=Z,this._audioDestination=o;try{t&&t.canPlayType&&(t.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||t.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(j){}try{t&&t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(j){}}lock(){this._triggerSuspendedState()}unlock(){var s,Z;if("running"===(null===(s=this._audioContext)||void 0===s?void 0:s.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(Z=this._audioContext)||void 0===Z||Z.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{b.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var s;null===(s=this._audioContext)||void 0===s||s.addEventListener("statechange",(()=>{var s;this.unlocked&&"running"!==(null===(s=this._audioContext)||void 0===s?void 0:s.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var s;return null!==(s=this._audioContext)&&void 0!==s&&s.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(s){this.canUseWebAudio=!1,b.b.Error("Web Audio: "+s.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(s){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const s=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",Z=document.createElement("style");Z.appendChild(document.createTextNode(s)),document.getElementsByTagName("head")[0].appendChild(Z),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var s;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(s=this._audioContext)||void 0===s||s.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(s){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=s)}connectToAnalyser(s){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=s,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var jo=o(10968);(0,o(12439).g)(so.d.NAME_AUDIO,((s,Z,o,t)=>{let j,S=[];if(o.GD=o.GD||[],void 0!==s.GD&&null!==s.GD)for(let O=0,v=s.GD.length;O<v;O++){var a;const v=s.GD[O];null!==(a=rZ.e.audioEngine)&&void 0!==a&&a.canUseWebAudio?(v.url||(v.url=v.name),S[v.url]?o.GD.push(mZ.Parse(v,Z,t,S[v.url])):(j=mZ.Parse(v,Z,t),S[v.url]=j,o.GD.push(j))):o.GD.push(new mZ(v.name,null,Z))}S=[]})),Object.defineProperty(Zo.c.prototype,"mainSoundTrack",{get:function(){let s=this._getComponent(so.d.NAME_AUDIO);return s||(s=new So(this),this.o(s)),this._mainSoundTrack||(this._mainSoundTrack=new JZ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Zo.c.prototype.getSoundByName=function(s){let Z;for(Z=0;Z<this.mainSoundTrack.soundCollection.length;Z++)if(this.mainSoundTrack.soundCollection[Z].name===s)return this.mainSoundTrack.soundCollection[Z];if(this.soundTracks)for(let o=0;o<this.soundTracks.length;o++)for(Z=0;Z<this.soundTracks[o].soundCollection.length;Z++)if(this.soundTracks[o].soundCollection[Z].name===s)return this.soundTracks[o].soundCollection[Z];return null},Object.defineProperty(Zo.c.prototype,"audioEnabled",{get:function(){let s=this._getComponent(so.d.NAME_AUDIO);return s||(s=new So(this),this.o(s)),s.audioEnabled},set:function(s){let Z=this._getComponent(so.d.NAME_AUDIO);Z||(Z=new So(this),this.o(Z)),s?Z.enableAudio():Z.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.c.prototype,"headphone",{get:function(){let s=this._getComponent(so.d.NAME_AUDIO);return s||(s=new So(this),this.o(s)),s.headphone},set:function(s){let Z=this._getComponent(so.d.NAME_AUDIO);Z||(Z=new So(this),this.o(Z)),s?Z.switchAudioModeForHeadphones():Z.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.c.prototype,"audioListenerPositionProvider",{get:function(){let s=this._getComponent(so.d.NAME_AUDIO);return s||(s=new So(this),this.o(s)),s.audioListenerPositionProvider},set:function(s){let Z=this._getComponent(so.d.NAME_AUDIO);if(Z||(Z=new So(this),this.o(Z)),s&&"function"!==typeof s)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");Z.audioListenerPositionProvider=s},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.c.prototype,"audioListenerRotationProvider",{get:function(){let s=this._getComponent(so.d.NAME_AUDIO);return s||(s=new So(this),this.o(s)),s.audioListenerRotationProvider},set:function(s){let Z=this._getComponent(so.d.NAME_AUDIO);if(Z||(Z=new So(this),this.o(Z)),s&&"function"!==typeof s)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");Z.audioListenerRotationProvider=s},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.c.prototype,"audioPositioningRefreshRate",{get:function(){let s=this._getComponent(so.d.NAME_AUDIO);return s||(s=new So(this),this.o(s)),s.audioPositioningRefreshRate},set:function(s){let Z=this._getComponent(so.d.NAME_AUDIO);Z||(Z=new So(this),this.o(Z)),Z.audioPositioningRefreshRate=s},enumerable:!0,configurable:!0});class So{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(s){this.name=so.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new j.n,this._cachedCameraPosition=new j.n,this._lastCheck=0,this._invertMatrixTemp=new j.b,this._cameraDirectionTemp=new j.n,(s=s||Y.c.LastCreatedScene)&&(this.fZ=s,s.soundTracks=[],s.GD=[])}register(){this.fZ._afterRenderStage.registerStep(so.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(s){if(s.GD=[],this.fZ.soundTracks)for(let Z=0;Z<this.fZ.soundTracks.length;Z++){const o=this.fZ.soundTracks[Z];for(let Z=0;Z<o.soundCollection.length;Z++)s.GD.push(o.soundCollection[Z].serialize())}}addFromContainer(s){if(s.GD)for(const Z of s.GD)Z.play(),Z.autoplay=!0,this.fZ.mainSoundTrack.addSound(Z)}removeFromContainer(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s.GD)for(const o of s.GD)o.stop(),o.autoplay=!1,this.fZ.mainSoundTrack.removeSound(o),Z&&o.dispose()}dispose(){const s=this.fZ;if(s._mainSoundTrack&&s.mainSoundTrack.dispose(),s.soundTracks)for(let Z=0;Z<s.soundTracks.length;Z++)s.soundTracks[Z].dispose()}disableAudio(){const s=this.fZ;let Z;for(this._audioEnabled=!1,rZ.e.audioEngine&&rZ.e.audioEngine.audioContext&&rZ.e.audioEngine.audioContext.suspend(),Z=0;Z<s.mainSoundTrack.soundCollection.length;Z++)s.mainSoundTrack.soundCollection[Z].pause();if(s.soundTracks)for(Z=0;Z<s.soundTracks.length;Z++)for(let o=0;o<s.soundTracks[Z].soundCollection.length;o++)s.soundTracks[Z].soundCollection[o].pause()}enableAudio(){const s=this.fZ;let Z;for(this._audioEnabled=!0,rZ.e.audioEngine&&rZ.e.audioEngine.audioContext&&rZ.e.audioEngine.audioContext.resume(),Z=0;Z<s.mainSoundTrack.soundCollection.length;Z++)s.mainSoundTrack.soundCollection[Z].isPaused&&s.mainSoundTrack.soundCollection[Z].play();if(s.soundTracks)for(Z=0;Z<s.soundTracks.length;Z++)for(let o=0;o<s.soundTracks[Z].soundCollection.length;o++)s.soundTracks[Z].soundCollection[o].isPaused&&s.soundTracks[Z].soundCollection[o].play()}switchAudioModeForHeadphones(){const s=this.fZ;if(this._headphone=!0,s.mainSoundTrack.switchPanningModelToHRTF(),s.soundTracks)for(let Z=0;Z<s.soundTracks.length;Z++)s.soundTracks[Z].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const s=this.fZ;if(this._headphone=!1,s.mainSoundTrack.switchPanningModelToEqualPower(),s.soundTracks)for(let Z=0;Z<s.soundTracks.length;Z++)s.soundTracks[Z].switchPanningModelToEqualPower()}_afterRender(){const s=jo.c.Now;if(this._lastCheck&&s-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=s;const Z=this.fZ;if(!this._audioEnabled||!Z._mainSoundTrack||!Z.soundTracks||0===Z._mainSoundTrack.soundCollection.length&&1===Z.soundTracks.length)return;const o=rZ.e.audioEngine;if(o&&o.audioContext){let s,t=Z.activeCamera;if(Z.activeCameras&&Z.activeCameras.length>0&&(t=Z.activeCameras[0]),this.audioListenerPositionProvider){const s=this.audioListenerPositionProvider();o.audioContext.listener.setPosition(s.x||0,s.y||0,s.z||0)}else t?this._cachedCameraPosition.equals(t.globalPosition)||(this._cachedCameraPosition.O(t.globalPosition),o.audioContext.listener.setPosition(t.globalPosition.x,t.globalPosition.y,t.globalPosition.z)):o.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const s=this.audioListenerRotationProvider();o.audioContext.listener.setOrientation(s.x||0,s.y||0,s.z||0,0,1,0)}else t?(t.rigCameras&&t.rigCameras.length>0&&(t=t.rigCameras[0]),t.getViewMatrix().invertToRef(this._invertMatrixTemp),j.n.TransformNormalToRef(So._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.O(this._cameraDirectionTemp),o.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):o.audioContext.listener.setOrientation(0,0,0,0,1,0);for(s=0;s<Z.mainSoundTrack.soundCollection.length;s++){const o=Z.mainSoundTrack.soundCollection[s];o.useCustomAttenuation&&o.updateDistanceFromListener()}if(Z.soundTracks)for(s=0;s<Z.soundTracks.length;s++)for(let o=0;o<Z.soundTracks[s].soundCollection.length;o++){const t=Z.soundTracks[s].soundCollection[o];t.useCustomAttenuation&&t.updateDistanceFromListener()}}}}So._CameraDirection=new j.n(0,0,-1),mZ._SceneComponentInitialization=s=>{let Z=s._getComponent(so.d.NAME_AUDIO);Z||(Z=new So(s),s.o(Z))};const ao="MSFT_audio_emitter";class Oo{constructor(s){this.name=ao,this._loader=s,this.enabled=this._loader.isExtensionUsed(ao)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const s=this._loader.aO.extensions;if(s&&s[this.name]){const Z=s[this.name];this._clips=Z.clips,this._emitters=Z.emitters,y.Assign(this._clips),y.Assign(this._emitters)}}loadSceneAsync(s,Z){return C.LoadExtensionAsync(s,Z,this.name,(async(o,t)=>{const j=new Array;j.push(this._loader.loadSceneAsync(s,Z));for(const s of t.emitters){const Z=y.Get(`${o}/emitters`,this._emitters,s);if(void 0!=Z.refDistance||void 0!=Z.maxDistance||void 0!=Z.rolloffFactor||void 0!=Z.distanceModel||void 0!=Z.innerAngle||void 0!=Z.outerAngle)throw new Error(`${o}: Direction or Distance properties are not allowed on emitters attached to a scene`);j.push(this._loadEmitterAsync(`${o}/emitters/${Z.index}`,Z))}await Promise.all(j)}))}loadNodeAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(s,t)=>{const S=new Array,O=await this._loader.loadNodeAsync(s,Z,(Z=>{for(const o of t.emitters){const t=y.Get(`${s}/emitters`,this._emitters,o);S.push(this._loadEmitterAsync(`${s}/emitters/${t.index}`,t).then((()=>{for(const s of t._babylonSounds)s.attachToMesh(Z),void 0==t.innerAngle&&void 0==t.outerAngle||(s.setLocalDirectionToMesh(j.n.Forward()),s.setDirectionalCone(2*a.g.ToDegrees(void 0==t.innerAngle?Math.PI:t.innerAngle),2*a.g.ToDegrees(void 0==t.outerAngle?Math.PI:t.outerAngle),0))})))}o(Z)}));return await Promise.all(S),O}))}loadAnimationAsync(s,Z){return C.LoadExtensionAsync(s,Z,this.name,(async(o,t)=>{const j=await this._loader.loadAnimationAsync(s,Z),S=new Array;y.Assign(t.events);for(const a of t.events)S.push(this._loadAnimationEventAsync(`${o}/events/${a.index}`,s,Z,a,j));return await Promise.all(S),j}))}_loadClipAsync(s,Z){if(Z._objectURL)return Z._objectURL;let o;if(Z.uri)o=this._loader.loadUriAsync(s,Z,Z.uri);else{const t=y.Get(`${s}/bufferView`,this._loader.aO.bufferViews,Z.bufferView);o=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return Z._objectURL=o.then((s=>URL.createObjectURL(new Blob([s],{type:Z.mimeType})))),Z._objectURL}_loadEmitterAsync(s,Z){if(Z._babylonSounds=Z._babylonSounds||[],!Z._babylonData){const s=new Array,o=Z.name||`emitter${Z.index}`,t={loop:!1,autoplay:!1,volume:void 0==Z.volume?1:Z.volume};for(let S=0;S<Z.clips.length;S++){const j=`/extensions/${this.name}/clips`,a=y.Get(j,this._clips,Z.clips[S].clip);s.push(this._loadClipAsync(`${j}/${Z.clips[S].clip}`,a).then((s=>{const j=Z._babylonSounds[S]=new mZ(o,s,this._loader.babylonScene,null,t);j.refDistance=Z.refDistance||1,j.maxDistance=Z.maxDistance||256,j.rolloffFactor=Z.rolloffFactor||1,j.distanceModel=Z.distanceModel||"exponential"})))}const j=Promise.all(s).then((()=>{const s=Z.clips.map((s=>s.weight||1)),o=new nZ(Z.loop||!1,Z._babylonSounds,s);Z.innerAngle&&(o.directionalConeInnerAngle=2*a.g.ToDegrees(Z.innerAngle)),Z.outerAngle&&(o.directionalConeOuterAngle=2*a.g.ToDegrees(Z.outerAngle)),Z.volume&&(o.volume=Z.volume),Z._babylonData.sound=o}));Z._babylonData={loaded:j}}return Z._babylonData.loaded}_getEventAction(s,Z,o,t,j){switch(o){case"play":return s=>{const o=(j||0)+(s-t);Z.play(o)};case"stop":return()=>{Z.stop()};case"pause":return()=>{Z.pause()};default:throw new Error(`${s}: Unsupported action ${o}`)}}_loadAnimationEventAsync(s,Z,o,t,j){if(0==j.targetedAnimations.length)return Promise.resolve();const S=j.targetedAnimations[0],a=t.k,O=y.Get(`/extensions/${this.name}/emitters`,this._emitters,a);return this._loadEmitterAsync(s,O).then((()=>{const Z=O._babylonData.sound;if(Z){const o=new EZ(t.time,this._getEventAction(s,Z,t.action,t.time,t.startOffset));S.animation.addEvent(o),j.onAnimationGroupEndObservable.add((()=>{Z.stop()})),j.onAnimationGroupPauseObservable.add((()=>{Z.pause()}))}}))}}h(ao),q(ao,!0,(s=>new Oo(s)));const vo="MSFT_lod";class Go{constructor(s){var Z;this.name=vo,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new B.b,this.onMaterialLODsLoadedObservable=new B.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=s,this.maxLODsToLoad=(null===(Z=this._loader.parent.extensionOptions[vo])||void 0===Z?void 0:Z.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(vo)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let s=0;s<this._nodePromiseLODs.length;s++){const Z=Promise.all(this._nodePromiseLODs[s]).then((()=>{0!==s&&(this._loader.endPerformanceCounter(`Node LOD ${s}`),this._loader.log(`Loaded node LOD ${s}`)),this.onNodeLODsLoadedObservable.notifyObservers(s),s!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${s+1}`),this._loadBufferLOD(this._nodeBufferLODs,s+1),this._nodeSignalLODs[s]&&this._nodeSignalLODs[s].resolve())}));this._loader._completePromises.push(Z)}for(let s=0;s<this._materialPromiseLODs.length;s++){const Z=Promise.all(this._materialPromiseLODs[s]).then((()=>{0!==s&&(this._loader.endPerformanceCounter(`Material LOD ${s}`),this._loader.log(`Loaded material LOD ${s}`)),this.onMaterialLODsLoadedObservable.notifyObservers(s),s!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${s+1}`),this._loadBufferLOD(this._materialBufferLODs,s+1),this._materialSignalLODs[s]&&this._materialSignalLODs[s].resolve())}));this._loader._completePromises.push(Z)}}loadSceneAsync(s,Z){const o=this._loader.loadSceneAsync(s,Z);return this._loadBufferLOD(this._bufferLODs,0),o}loadNodeAsync(s,Z,o){return C.LoadExtensionAsync(s,Z,this.name,(async(s,j)=>{let S;const a=this._getLODs(s,Z,this._loader.aO.nodes,j.ids);this._loader.logOpen(`${s}`);for(let Z=0;Z<a.length;Z++){const s=a[Z];0!==Z&&(this._nodeIndexLOD=Z,this._nodeSignalLODs[Z]=this._nodeSignalLODs[Z]||new t);const j=s=>{o(s),s.iO(!1)},O=this._loader.loadNodeAsync(`/nodes/${s.index}`,s,j).then((s=>{if(0!==Z){const s=a[Z-1];s._babylonTransformNode&&(this._disposeTransformNode(s._babylonTransformNode),delete s._babylonTransformNode)}return s.iO(!0),s}));this._nodePromiseLODs[Z]=this._nodePromiseLODs[Z]||[],0===Z?S=O:(this._nodeIndexLOD=null,this._nodePromiseLODs[Z].push(O))}return this._loader.logClose(),await S}))}_loadMaterialAsync(s,Z,o,t,j){return this._nodeIndexLOD?null:C.LoadExtensionAsync(s,Z,this.name,(async(s,S)=>{let a;const O=this._getLODs(s,Z,this._loader.aO.materials,S.ids);this._loader.logOpen(`${s}`);for(let Z=0;Z<O.length;Z++){const s=O[Z];0!==Z&&(this._materialIndexLOD=Z);const S=this._loader._loadMaterialAsync(`/materials/${s.index}`,s,o,t,(s=>{0===Z&&j(s)})).then((s=>{if(0!==Z){j(s);const o=O[Z-1]._data;o[t]&&(this._disposeMaterials([o[t].babylonMaterial]),delete o[t])}return s}));this._materialPromiseLODs[Z]=this._materialPromiseLODs[Z]||[],0===Z?a=S:(this._materialIndexLOD=null,this._materialPromiseLODs[Z].push(S))}return this._loader.logClose(),await a}))}_loadUriAsync(s,Z,o){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const j=this._nodeIndexLOD-1;return this._nodeSignalLODs[j]=this._nodeSignalLODs[j]||new t,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(s,Z,o)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const j=this._materialIndexLOD-1;return this._materialSignalLODs[j]=this._materialSignalLODs[j]||new t,this._materialSignalLODs[j].promise.then((async()=>await this._loader.loadUriAsync(s,Z,o)))}return null}loadBufferAsync(s,Z,o,j){if(this._loader.parent.useRangeRequests&&!Z.uri){if(!this._loader.bin)throw new Error(`${s}: Uri is missing or the binary glTF is missing its binary chunk`);const Z=async(s,Z)=>{const S=o,a=S+j-1;let O=s[Z];return O?(O.start=Math.min(O.start,S),O.end=Math.max(O.end,a)):(O={start:S,end:a,loaded:new t},s[Z]=O),await O.loaded.promise.then((s=>new Uint8Array(s.buffer,s.byteOffset+o-O.start,j)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Z(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Z(this._materialBufferLODs,this._materialIndexLOD):Z(this._bufferLODs,0)}return null}_loadBufferLOD(s,Z){const o=s[Z];o&&(this._loader.log(`Loading buffer range [${o.start}-${o.end}]`),this._loader.bin.readAsync(o.start,o.end-o.start+1).then((s=>{o.loaded.resolve(s)}),(s=>{o.loaded.reject(s)})))}_getLODs(s,Z,o,t){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const j=[];for(let S=t.length-1;S>=0;S--)if(j.push(y.Get(`${s}/ids/${t[S]}`,o,t[S])),j.length===this.maxLODsToLoad)return j;return j.push(Z),j}_disposeTransformNode(s){const Z=[],o=s.material;o&&Z.push(o);for(const j of s.getChildMeshes())j.material&&Z.push(j.material);s.dispose();const t=Z.filter((s=>this._loader.babylonScene.meshes.every((Z=>Z.material!=s))));this._disposeMaterials(t)}_disposeMaterials(s){const Z={};for(const o of s){for(const s of o.getActiveTextures())Z[s.uniqueId]=s;o.dispose()}for(const o in Z)for(const s of this._loader.babylonScene.materials)s.hasTexture(Z[o])&&delete Z[o];for(const o in Z)Z[o].dispose()}}h(vo),q(vo,!0,(s=>new Go(s)));const Bo="MSFT_minecraftMesh";class Qo{constructor(s){this.name=Bo,this._loader=s,this.enabled=this._loader.isExtensionUsed(Bo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtraAsync(s,Z,this.name,(async(t,j)=>{if(j){if(!(o instanceof U.d))throw new Error(`${t}: Material type not supported`);const j=this._loader.loadMaterialPropertiesAsync(s,Z,o);return o.needAlphaBlending()&&(o.forceDepthWrite=!0,o.separateCullingPass=!0),o.Ta=o.forceDepthWrite,o.twoSidedLighting=!0,await j}}))}}h(Bo),q(Bo,!0,(s=>new Qo(s)));const Do="MSFT_sRGBFactors";class zo{constructor(s){this.name=Do,this._loader=s,this.enabled=this._loader.isExtensionUsed(Do)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,Z,o){return C.LoadExtraAsync(s,Z,this.name,(async(t,j)=>{if(j){if(!(o instanceof U.d))throw new Error(`${t}: Material type not supported`);const j=this._loader.loadMaterialPropertiesAsync(s,Z,o),S=o.Ls().getEngine().useExactSrgbConversions;return o.albedoTexture||o.albedoColor.toLinearSpaceToRef(o.albedoColor,S),o.reflectivityTexture||o.reflectivityColor.toLinearSpaceToRef(o.reflectivityColor,S),await j}}))}}h(Do),q(Do,!0,(s=>new zo(s)));var Yo=o(12763);const bo={};var fo=o(12825),Ao=o(12798),Uo=o(12766),uo=o(12775);function Ho(s,Z){for(const o of s)for(const s of o.dataOutputs)if(s.uniqueId===Z)return s;throw new Error("Could not find data out connection with unique id "+Z)}function Fo(s,Z){for(const o of s)if(o instanceof Ao.c)for(const s of o.signalInputs)if(s.uniqueId===Z)return s;throw new Error("Could not find signal in connection with unique id "+Z)}async function io(s,Z){const t=await Promise.all(s.allBlocks.map((async s=>{const Z=function(s){switch(s){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([o.e(58),o.e(59)]).then(o.bind(o,14223))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await o.e(60).then(o.bind(o,14227))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await o.e(61).then(o.bind(o,14231))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await o.e(62).then(o.bind(o,14237))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await o.e(63).then(o.bind(o,14241))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await o.e(64).then(o.bind(o,14243))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await o.e(65).then(o.bind(o,14248))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await o.e(66).then(o.bind(o,14250))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await o.e(67).then(o.bind(o,14252))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await o.e(70).then(o.bind(o,14282))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await o.e(70).then(o.bind(o,14282))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await o.e(70).then(o.bind(o,14282))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await o.e(70).then(o.bind(o,14282))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await o.e(75).then(o.bind(o,14285))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await o.e(76).then(o.bind(o,14289))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await o.e(77).then(o.bind(o,14295))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await o.e(78).then(o.bind(o,14299))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await o.e(79).then(o.bind(o,14303))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await o.e(80).then(o.bind(o,14311))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await o.e(81).then(o.bind(o,14313))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await o.e(82).then(o.bind(o,14317))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await o.e(83).then(o.bind(o,14321))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await o.e(84).then(o.bind(o,14329))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await o.e(85).then(o.bind(o,14333))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await o.e(86).then(o.bind(o,14335))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await o.e(87).then(o.bind(o,14343))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await o.e(88).then(o.bind(o,14346))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await o.e(89).then(o.bind(o,14355))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await o.e(90).then(o.bind(o,14364))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await o.e(91).then(o.bind(o,14366))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await o.e(92).then(o.bind(o,14370))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await o.e(93).then(o.bind(o,14372))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await o.e(72).then(o.bind(o,14381))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await o.e(94).then(o.bind(o,14384))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await o.e(95).then(o.bind(o,14390))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await o.e(96).then(o.bind(o,14398))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await o.e(73).then(o.bind(o,14403))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await o.e(68).then(o.bind(o,14261))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await o.e(74).then(o.bind(o,14405))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await o.e(69).then(o.bind(o,14280))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await o.e(70).then(o.bind(o,14282))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await o.e(70).then(o.bind(o,14282))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await o.e(71).then(o.bind(o,14407))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await o.e(71).then(o.bind(o,14407))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await o.e(71).then(o.bind(o,14407))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await o.e(71).then(o.bind(o,14407))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await o.e(71).then(o.bind(o,14407))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await o.e(71).then(o.bind(o,14407))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await o.e(97).then(o.bind(o,14416))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await o.e(98).then(o.bind(o,14419))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await o.e(99).then(o.bind(o,14427))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await o.e(100).then(o.bind(o,14434))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await o.e(101).then(o.bind(o,14443))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await o.e(102).then(o.bind(o,14445))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await o.e(103).then(o.bind(o,14452))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await o.e(104).then(o.bind(o,14459))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await o.e(105).then(o.bind(o,14468))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await o.e(106).then(o.bind(o,14475))).FlowGraphDataSwitchBlock;default:if(bo[s])return bo[s];throw new Error(`Unknown block name ${s}`)}}(s.className);return await Z()})));return function(s,Z,o){const t=Z.coordinator.createGraph(),j=[],S=Z.valueParseFunction??Uo.e;for(let a=0;a<s.allBlocks.length;a++){const O=Lo(s.allBlocks[a],{fZ:Z.coordinator.config.fZ,pathConverter:Z.pathConverter,assetsContainer:Z.coordinator.config.fZ,valueParseFunction:S},o[a]);j.push(O),O instanceof fo.c&&t.addEventBlock(O)}for(const a of j){for(const s of a.dataInputs)for(const Z of s.connectedPointIds){const o=Ho(j,Z);s.connectTo(o)}if(a instanceof Ao.c)for(const s of a.signalOutputs)for(const Z of s.connectedPointIds){const o=Fo(j,Z);s.connectTo(o)}}for(const a of s.executionContexts)No(a,{graph:t,valueParseFunction:S},s.rightHanded);return t}(s,Z,t)}function No(s,Z,o){const t=Z.graph.createContext();s.enableLogging&&(t.enableLogging=!0),t.treatDataAsRightHanded=o||!1;const j=Z.valueParseFunction??Uo.e;t.uniqueId=s.uniqueId;const S=t.Ls();if(s._assetsContext){var a,O,v,G,B,Q,D,z,Y,b;const Z=s._assetsContext,o={meshes:null===(a=Z.meshes)||void 0===a?void 0:a.map((s=>S.getMeshById(s))),lights:null===(O=Z.lights)||void 0===O?void 0:O.map((s=>S.getLightByName(s))),cameras:null===(v=Z.cameras)||void 0===v?void 0:v.map((s=>S.getCameraByName(s))),materials:null===(G=Z.materials)||void 0===G?void 0:G.map((s=>S.getMaterialById(s))),textures:null===(B=Z.textures)||void 0===B?void 0:B.map((s=>S.getTextureByName(s))),animations:null===(Q=Z.animations)||void 0===Q?void 0:Q.map((s=>S.animations.find((Z=>Z.name===s)))),skeletons:null===(D=Z.skeletons)||void 0===D?void 0:D.map((s=>S.getSkeletonByName(s))),gQ:null===(z=Z.gQ)||void 0===z?void 0:z.map((s=>S.getParticleSystemById(s))),animationGroups:null===(Y=Z.animationGroups)||void 0===Y?void 0:Y.map((s=>S.getAnimationGroupByName(s))),transformNodes:null===(b=Z.transformNodes)||void 0===b?void 0:b.map((s=>S.getTransformNodeById(s))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],GD:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};t.assetsContext=o}for(const f in s._userVariables){const Z=j(f,s._userVariables,t.assetsContext,S);t.userVariables[f]=Z}for(const f in s._connectionValues){const Z=j(f,s._connectionValues,t.assetsContext,S);t._setConnectionValueByKey(f,Z)}return t}function Lo(s,Z,o){const t={},j=Z.valueParseFunction??Uo.e;if(s.config)for(const a in s.config)t[a]=j(a,s.config,Z.assetsContainer||Z.fZ,Z.fZ);if((0,Uo.k)(s.className)){if(!Z.pathConverter)throw new Error("Path converter is required for this block");t.pathConverter=Z.pathConverter}const S=new o(t);S.uniqueId=s.uniqueId;for(let a=0;a<s.dataInputs.length;a++){const Z=S.getDataInput(s.dataInputs[a].name);if(!Z)throw new Error("Could not find data input with name "+s.dataInputs[a].name+" in block "+s.className);Z.deserialize(s.dataInputs[a])}for(let a=0;a<s.dataOutputs.length;a++){const Z=S.getDataOutput(s.dataOutputs[a].name);if(!Z)throw new Error("Could not find data output with name "+s.dataOutputs[a].name+" in block "+s.className);Z.deserialize(s.dataOutputs[a])}return S.metadata=s.metadata,S.deserialize&&S.deserialize(s),S}function Vo(s){const[Z,o]=s.split(":");return go({op:Z,extension:o})}function go(s){var Z;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const t=s.extension?null===(Z=Ro[s.extension])||void 0===Z?void 0:Z[s.op]:eo[s.op];if(!t&&(b.b.Warn(`No mapping found for operation ${s.op} and extension ${s.extension||"KHR_interactivity"}`),o)){const Z={},o={flows:{}};if(s.inputValueSockets){Z.values={};for(const o in s.inputValueSockets)Z.values[o]={name:o}}return s.outputValueSockets&&(o.values={},Object.keys(s.outputValueSockets).forEach((s=>{o.values[s]={name:s}}))),{EG:[],inputs:Z,outputs:o}}return t}function lo(s,Z,o){Ro[Z]||(Ro[Z]={}),Ro[Z][s]=o}const Ro={BABYLON:{"flow/log":{EG:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},eo={"event/onStart":{EG:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{EG:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{EG:["FlowGraphSendCustomEventBlock"],extraProcessor(s,Z,o,t,j){if("event/send"!==Z.op||!s.configuration||1!==Object.keys(s.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const S=s.configuration.event.value[0];if("number"!==typeof S)throw new Error("Event id should be a number");const a=t.arrays.events[S],O=j[0];return O.config||(O.config={}),O.config.eventId=a.eventId,O.config.eventData=a.eventData,j}},"event/receive":{EG:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(s,Z){var o;if(!s.configuration)return b.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const t=s.configuration.event;if(!t)return b.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const j=t.value[0];if("number"!==typeof j)return b.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(o=Z.events)||void 0===o?void 0:o[j])?{valid:!0}:(b.b.Error(`Event with id ${j} not found`),{valid:!1,error:`Event with id ${j} not found`})},extraProcessor(s,Z,o,t,j){if("event/receive"!==Z.op||!s.configuration||1!==Object.keys(s.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const S=s.configuration.event.value[0];if("number"!==typeof S)throw new Error("Event id should be a number");const a=t.arrays.events[S],O=j[0];return O.config||(O.config={}),O.config.eventId=a.eventId,O.config.eventData=a.eventData,j}},"math/e":co("FlowGraphEBlock"),"math/pi":co("FlowGraphPIBlock"),"math/inf":co("FlowGraphInfBlock"),"math/nan":co("FlowGraphNaNBlock"),"math/abs":co("FlowGraphAbsBlock"),"math/sign":co("FlowGraphSignBlock"),"math/trunc":co("FlowGraphTruncBlock"),"math/floor":co("FlowGraphFloorBlock"),"math/ceil":co("FlowGraphCeilBlock"),"math/round":{EG:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j){var S;return(S=j[0]).config||(S.config={}),j[0].config.roundHalfAwayFromZero=!0,j}},"math/fract":co("FlowGraphFractBlock"),"math/neg":co("FlowGraphNegationBlock"),"math/add":co("FlowGraphAddBlock",["a","b"],!0),"math/sub":co("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{EG:["FlowGraphMultiplyBlock"],extraProcessor(s,Z,o,t,j){var S;(S=j[0]).config||(S.config={}),j[0].config.useMatrixPerComponent=!0,j[0].config.preventIntegerFloatArithmetic=!0;let a=-1;return Object.keys(s.values||{}).find((Z=>{var o;return void 0!==(null===(o=s.values)||void 0===o?void 0:o[Z].type)&&(a=s.values[Z].type,!0)})),-1!==a&&(j[0].config.type=t.arrays.types[a].flowGraphType),j},validation:s=>s.values?wo(s):{valid:!0}},"math/div":co("FlowGraphDivideBlock",["a","b"],!0),"math/rem":co("FlowGraphModuloBlock",["a","b"]),"math/min":co("FlowGraphMinBlock",["a","b"]),"math/max":co("FlowGraphMaxBlock",["a","b"]),"math/clamp":co("FlowGraphClampBlock",["a","b","c"]),"math/saturate":co("FlowGraphSaturateBlock"),"math/mix":co("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":co("FlowGraphEqualityBlock",["a","b"]),"math/lt":co("FlowGraphLessThanBlock",["a","b"]),"math/le":co("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":co("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":co("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":co("FlowGraphIsNaNBlock"),"math/isinf":co("FlowGraphIsInfBlock"),"math/select":{EG:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{EG:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":co("FlowGraphSinBlock"),"math/cos":co("FlowGraphCosBlock"),"math/tan":co("FlowGraphTanBlock"),"math/asin":co("FlowGraphASinBlock"),"math/acos":co("FlowGraphACosBlock"),"math/atan":co("FlowGraphATanBlock"),"math/atan2":co("FlowGraphATan2Block",["a","b"]),"math/sinh":co("FlowGraphSinhBlock"),"math/cosh":co("FlowGraphCoshBlock"),"math/tanh":co("FlowGraphTanhBlock"),"math/asinh":co("FlowGraphASinhBlock"),"math/acosh":co("FlowGraphACoshBlock"),"math/atanh":co("FlowGraphATanhBlock"),"math/exp":co("FlowGraphExponentialBlock"),"math/log":co("FlowGraphLogBlock"),"math/log2":co("FlowGraphLog2Block"),"math/log10":co("FlowGraphLog10Block"),"math/sqrt":co("FlowGraphSquareRootBlock"),"math/cbrt":co("FlowGraphCubeRootBlock"),"math/pow":co("FlowGraphPowerBlock",["a","b"]),"math/length":co("FlowGraphLengthBlock"),"math/normalize":co("FlowGraphNormalizeBlock"),"math/dot":co("FlowGraphDotBlock",["a","b"]),"math/cross":co("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":co("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":co("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{EG:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{EG:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{EG:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{EG:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{EG:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{EG:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{EG:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":co("FlowGraphTransposeBlock"),"math/determinant":co("FlowGraphDeterminantBlock"),"math/inverse":co("FlowGraphInvertMatrixBlock"),"math/matmul":co("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{EG:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ZO",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j,S){const a=j[0].dataInputs.find((s=>"rotationQuaternion"===s.name));if(!a)throw new Error("Rotation quaternion input not found");return S._connectionValues[a.uniqueId]&&(S._connectionValues[a.uniqueId].type="Quaternion"),j}},"math/matDecompose":{EG:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ZO"}}}},"math/quatConjugate":co("FlowGraphConjugateBlock",["a"]),"math/quatMul":{EG:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j){var S;return(S=j[0]).config||(S.config={}),j[0].config.type="Quaternion",j}},"math/quatAngleBetween":co("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{EG:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":co("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":co("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{EG:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j){var S;return(S=j[0]).config||(S.config={}),j[0].config.inputIsColumnMajor=!0,j}},"math/extract2x2":{EG:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{EG:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j){var S;return(S=j[0]).config||(S.config={}),j[0].config.inputIsColumnMajor=!0,j}},"math/extract3x3":{EG:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{EG:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j){var S;return(S=j[0]).config||(S.config={}),j[0].config.inputIsColumnMajor=!0,j}},"math/extract4x4":{EG:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{EG:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j,S){var a,O;(O=j[0]).config||(O.config={});const v=j[0].dataInputs[0];return j[0].config.valueType=(null===(a=S._connectionValues[v.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",j}},"math/and":{EG:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j,S){var a,O,v;(v=j[0]).config||(v.config={});const G=j[0].dataInputs[0],B=j[0].dataInputs[1];return j[0].config.valueType=(null===(a=S._connectionValues[G.uniqueId])||void 0===a?void 0:a.type)??(null===(O=S._connectionValues[B.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",j}},"math/or":{EG:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j,S){var a,O,v;(v=j[0]).config||(v.config={});const G=j[0].dataInputs[0],B=j[0].dataInputs[1];return j[0].config.valueType=(null===(a=S._connectionValues[G.uniqueId])||void 0===a?void 0:a.type)??(null===(O=S._connectionValues[B.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",j}},"math/xor":{EG:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,Z,o,t,j,S){var a,O,v;(v=j[0]).config||(v.config={});const G=j[0].dataInputs[0],B=j[0].dataInputs[1];return j[0].config.valueType=(null===(a=S._connectionValues[G.uniqueId])||void 0===a?void 0:a.type)??(null===(O=S._connectionValues[B.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",j}},"math/asr":co("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":co("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":co("FlowGraphLeadingZerosBlock"),"math/ctz":co("FlowGraphTrailingZerosBlock"),"math/popcnt":co("FlowGraphOneBitsCounterBlock"),"math/rad":co("FlowGraphDegToRadBlock"),"math/deg":co("FlowGraphRadToDegBlock"),"type/boolToInt":co("FlowGraphBooleanToInt"),"type/boolToFloat":co("FlowGraphBooleanToFloat"),"type/intToBool":co("FlowGraphIntToBoolean"),"type/intToFloat":co("FlowGraphIntToFloat"),"type/floatToInt":co("FlowGraphFloatToInt"),"type/floatToBool":co("FlowGraphFloatToBoolean"),"flow/sequence":{EG:["FlowGraphSequenceBlock"],extraProcessor(s,Z,o,t,j){const S=j[0];return S.config||(S.config={}),S.config.outputSignalCount=Object.keys(s.flows||[]).length,S.signalOutputs.forEach(((s,Z)=>{s.name="out_"+Z})),j}},"flow/branch":{EG:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{EG:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(s){if(s.configuration&&s.configuration.cases){const Z=s.configuration.cases.value;if(!Z.every((s=>"number"===typeof s&&/^-?\d+$/.test(s.toString()))))return b.b.Warn("Switch cases should be integers. Using empty array instead."),s.configuration.cases.value=[],{valid:!0};const o=new Set(Z);s.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(s,Z,o,t,j){if("flow/switch"!==Z.op||!s.flows||0===Object.keys(s.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return j[0].signalOutputs.forEach((s=>{"default"!==s.name&&(s.name="out_"+s.name)})),j}},"flow/while":{EG:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{EG:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(s,Z,o,t,j){const S=j[0];return S.config||(S.config={}),S.config.incrementIndexWhenLoopDone=!0,j}},"flow/doN":{EG:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{EG:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(s,Z,o,t,j){if("flow/multiGate"!==Z.op||!s.flows||0===Object.keys(s.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const S=j[0];return S.config||(S.config={}),S.config.outputSignalCount=Object.keys(s.flows).length,S.signalOutputs.forEach(((s,Z)=>{s.name="out_"+Z})),j}},"flow/waitAll":{EG:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(s){var Z,o;return"number"!==typeof(null===(Z=s.configuration)||void 0===Z||null===(o=Z.inputFlows)||void 0===o?void 0:o.value[0])&&(s.configuration=s.configuration||{inputFlows:{value:[0]}},s.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{EG:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{EG:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{EG:["FlowGraphCancelDelayBlock"]},"variable/get":{EG:["FlowGraphGetVariableBlock"],validation(s){var Z,o;return null!==(Z=s.configuration)&&void 0!==Z&&null!==(o=Z.variable)&&void 0!==o&&o.value?{valid:!0}:(b.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(s,Z)=>[Z.getVariableName(s[0])]}}},"variable/set":{EG:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(s,Z)=>[Z.getVariableName(s[0])]}}},"variable/setMultiple":{EG:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(s,Z)=>[s[0].map((s=>Z.getVariableName(s)))]}},extraProcessor:(s,Z,o,t,j)=>(j[0].dataInputs.forEach((s=>{s.name=t.getVariableName(+s.name)})),j)},"variable/interpolate":{EG:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(s,Z)=>[Z.getVariableName(s[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:s=>!0===s[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",do:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",do:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",do:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",do:"FlowGraphPlayAnimationBlock"},out:{name:"out",do:"FlowGraphPlayAnimationBlock"},done:{name:"done",do:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(s,Z,o,t,j){var S,a,O;const v=j[0],G=null===(S=s.configuration)||void 0===S?void 0:S.variable.value[0];if("number"!==typeof G)throw b.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const B=t.arrays.staticVariables[G];"undefined"===typeof v.config.animationType.value&&(t.arrays.staticVariables,v.config.animationType.value=(0,uo.O)(B.type));const Q=j[4];return Q.config||(Q.config={}),(a=Q.config).variable||(a.variable={}),Q.config.variable.value=t.getVariableName(G),(O=j[3]).config||(O.config={}),j}},"pointer/get":{EG:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",do:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",do:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(s,Z,o,t,j)=>(j.forEach((s=>{"FlowGraphJsonPointerParserBlock"===s.className&&(s.config||(s.config={}),s.config.outputValue=!0)})),j)},"pointer/set":{EG:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",do:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",do:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(s,Z,o,t,j)=>(j.forEach((s=>{"FlowGraphJsonPointerParserBlock"===s.className&&(s.config||(s.config={}),s.config.outputValue=!0)})),j)},"pointer/interpolate":{EG:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",do:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",do:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",do:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",do:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",do:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",do:"FlowGraphPlayAnimationBlock"},out:{name:"out",do:"FlowGraphPlayAnimationBlock"},done:{name:"done",do:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(s,Z,o,t,j)=>(j.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className?(Z.config||(Z.config={}),Z.config.outputValue=!0):"FlowGraphInterpolationBlock"===Z.className&&(Z.config||(Z.config={}),Object.keys(s.values||[]).forEach((o=>{var j;const S=null===(j=s.values)||void 0===j?void 0:j[o];if("value"===o&&S){const s=S.type;void 0!==s&&(Z.config.animationType=t.arrays.types[s].flowGraphType)}})))})),j)},"animation/start":{EG:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",do:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(s,Z)=>[s[0]*Z._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(s,Z)=>[s[0]*Z._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(s,Z,o,t,j,S,a){const O=j[j.length-1];return O.config||(O.config={}),O.config.glTF=a,j}},"animation/stop":{EG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",do:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(s,Z,o,t,j,S,a){const O=j[j.length-1];return O.config||(O.config={}),O.config.glTF=a,j}},"animation/stopAt":{EG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",do:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(s,Z)=>[s[0]*Z._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(s,Z,o,t,j,S,a){const O=j[j.length-1];return O.config||(O.config={}),O.config.glTF=a,j}},"math/switch":{EG:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(s){if(s.configuration&&s.configuration.cases){const Z=s.configuration.cases.value;if(!Z.every((s=>"number"===typeof s&&/^-?\d+$/.test(s.toString()))))return b.b.Warn("Switch cases should be integers. Using empty array instead."),s.configuration.cases.value=[],{valid:!0};const o=new Set(Z);s.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(s,Z,o,t,j){const S=j[0];return S.dataInputs.forEach((s=>{"default"!==s.name&&"case"!==s.name&&(s.name="in_"+s.name)})),S.config||(S.config={}),S.config.treatCasesAsIntegers=!0,j}},"debug/log":{EG:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function co(s){let Z=arguments.length>2?arguments[2]:void 0;return{EG:[s],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((s,Z)=>(s[Z]={name:Z},s)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(s,o,t,j,S){var a;if(Z){(a=S[0]).config||(a.config={}),S[0].config.preventIntegerFloatArithmetic=!0;let Z=-1;Object.keys(s.values||{}).find((o=>{var t;return void 0!==(null===(t=s.values)||void 0===t?void 0:t[o].type)&&(Z=s.values[o].type,!0)})),-1!==Z&&(S[0].config.type=j.arrays.types[Z].flowGraphType)}return S},validation:s=>Z?wo(s):{valid:!0}}}function wo(s){if(s.values){const Z=Object.keys(s.values).map((Z=>s.values[Z].type)).filter((s=>void 0!==s));if(!Z.every((s=>s===Z[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}eo["math/compose"]=eo["math/matCompose"],eo["math/decompose"]=eo["math/matDecompose"];var Xo=o(11070);const Wo={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"sO",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class qo{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=s,this._gltf=Z,this._animationTargetFps=o,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const s of this._interactivityGraph.types)this._types.push(Wo[s.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const s of this._interactivityGraph.declarations){const Z=go(s);if(!Z)throw b.b.Error(["No mapping found for declaration",s]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:Z,fullOperationName:s.extension?s.op+":"+s.extension:s.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const s of this._interactivityGraph.variables){const Z=this._parseVariable(s);this._staticVariables.push(Z)}}_parseVariable(s,Z){const o=this._types[s.type];if(!o)throw b.b.Error(["No type found for variable",s]),new Error("Error parsing variables");if(s.value&&s.value.length!==o.length)throw b.b.Error(["Invalid value length for variable",s,o]),new Error("Error parsing variables");const t=s.value||[];if(!t.length)switch(o.flowGraphType){case"boolean":t.push(!1);break;case"FlowGraphInteger":t.push(0);break;case"number":t.push(NaN);break;case"Vector2":t.push(NaN,NaN);break;case"sO":t.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":t.fill(NaN,0,4);break;case"Matrix":t.fill(NaN,0,16);break;case"Matrix3D":t.fill(NaN,0,9)}return"number"===o.elementType&&"string"===typeof t[0]&&(t[0]=parseFloat(t[0])),{type:o.flowGraphType,value:Z?Z(t,this):t}}_parseEvents(){if(this._interactivityGraph.events)for(const s of this._interactivityGraph.events){const Z={eventId:s.id||"internalEvent_"+this._internalEventsCounter++};s.values&&(Z.eventData=Object.keys(s.values).map((Z=>{var o;const t=null===(o=s.values)||void 0===o?void 0:o[Z];if(!t)throw b.b.Error(["No value found for event key",Z]),new Error("Error parsing events");const j=this._types[t.type];if(!j)throw b.b.Error(["No type found for event value",t]),new Error("Error parsing events");const S="undefined"!==typeof t.value?this._parseVariable(t):void 0;return{id:Z,type:j.flowGraphType,eventData:!0,value:S}}))),this._events.push(Z)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const Z of this._interactivityGraph.nodes){if("number"!==typeof Z.declaration)throw b.b.Error(["No declaration found for node",Z]),new Error("Error parsing nodes");const o=this._mappings[Z.declaration];if(!o)throw b.b.Error(["No mapping found for node",Z]),new Error("Error parsing nodes");if(o.flowGraphMapping.validation){const t=o.flowGraphMapping.validation(Z,this._interactivityGraph,this._gltf);var s;if(!t.valid)throw new Error(`Error validating interactivity node ${null===(s=this._interactivityGraph.declarations)||void 0===s?void 0:s[Z.declaration].op} - ${t.error}`)}const t=[];for(const s of o.flowGraphMapping.EG){const j=this._getEmptyBlock(s,o.fullOperationName);this._parseNodeConfiguration(Z,j,o.flowGraphMapping,s),t.push(j)}this._nodes.push({EG:t,fullOperationName:o.fullOperationName})}}_getEmptyBlock(s,Z){return{uniqueId:(0,Xo.c)(),className:s,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:Z,metadata:{}}}_parseNodeConfiguration(s,Z,o,t){const j=Z.config;if(s.configuration){const Z=Object.keys(s.configuration);for(const O of Z){var S,a;const Z=null===(S=s.configuration)||void 0===S?void 0:S[O];if(!Z)throw b.b.Error(["No value found for node configuration",O]),new Error("Error parsing node configuration");const v=null===(a=o.configuration)||void 0===a?void 0:a[O];if(v&&v.do?v.do===t:0===o.EG.indexOf(t)){const s=(null===v||void 0===v?void 0:v.name)||O;Z&&"undefined"!==typeof Z.value||"undefined"===typeof(null===v||void 0===v?void 0:v.defaultValue)?Z.value.length>=0?j[s]={value:1===Z.value.length?Z.value[0]:Z.value}:b.b.Warn(["Invalid value for node configuration",Z]):j[s]={value:v.defaultValue},v&&v.dataTransformer&&(j[s].value=v.dataTransformer([j[s].value],this)[0])}}}}_parseNodeConnections(s){for(let F=0;F<this._nodes.length;F++){var Z;const i=null===(Z=this._interactivityGraph.nodes)||void 0===Z?void 0:Z[F];if(!i)throw b.b.Error(["No node found for interactivity node",this._nodes[F]]),new Error("Error parsing node connections");const N=this._nodes[F],L=this._mappings[i.declaration];if(!L)throw b.b.Error(["No mapping found for node",i]),new Error("Error parsing node connections");const V=i.flows||{},g=Object.keys(V).sort();for(const s of g){var o,t,j,S;const Z=V[s],G=null===(o=L.flowGraphMapping.outputs)||void 0===o||null===(t=o.flows)||void 0===t?void 0:t[s],B=(null===G||void 0===G?void 0:G.name)||s,Q=this._createNewSocketConnection(B,!0);(G&&G.do&&N.EG.find((s=>s.className===G.do))||N.EG[0]).signalOutputs.push(Q);const D=Z.node,z=this._nodes[D];if(!z)throw b.b.Error(["No node found for input node id",D]),new Error("Error parsing node connections");const Y=Vo(z.fullOperationName);if(!Y)throw b.b.Error(["No mapping found for input node",z]),new Error("Error parsing node connections");let f=null===(j=Y.inputs)||void 0===j||null===(S=j.flows)||void 0===S?void 0:S[Z.socket||"in"],A=!1;if(!f)for(const s in null===(a=Y.inputs)||void 0===a?void 0:a.flows){var a,O,v;if(s.startsWith("[")&&s.endsWith("]"))A=!0,f=null===(O=Y.inputs)||void 0===O||null===(v=O.flows)||void 0===v?void 0:v[s]}const d=f?A?f.name.replace("$1",Z.socket||""):f.name:Z.socket||"in",U=f&&f.do&&z.EG.find((s=>s.className===f.do))||z.EG[0];let u=U.signalInputs.find((s=>s.name===d));u||(u=this._createNewSocketConnection(d),U.signalInputs.push(u)),u.connectedPointIds.push(Q.uniqueId),Q.connectedPointIds.push(u.uniqueId)}const l=i.values||{},R=Object.keys(l);for(const Z of R){var G,B;const o=l[Z];let t=null===(G=L.flowGraphMapping.inputs)||void 0===G||null===(B=G.values)||void 0===B?void 0:B[Z],j=!1;if(!t)for(const s in null===(Q=L.flowGraphMapping.inputs)||void 0===Q?void 0:Q.values){var Q,D,z;if(s.startsWith("[")&&s.endsWith("]"))j=!0,t=null===(D=L.flowGraphMapping.inputs)||void 0===D||null===(z=D.values)||void 0===z?void 0:z[s]}const S=t?j?t.name.replace("$1",Z):t.name:Z,a=this._createNewSocketConnection(S);if((t&&t.do&&N.EG.find((s=>s.className===t.do))||N.EG[0]).dataInputs.push(a),void 0!==o.value){const Z=this._parseVariable(o,t&&t.dataTransformer);s._connectionValues[a.uniqueId]=Z}else{if("undefined"===typeof o.node)throw b.b.Error(["Invalid value for value connection",o]),new Error("Error parsing node connections");{var Y,f,A;const s=o.node,Z=o.socket||"value",t=this._nodes[s];if(!t)throw b.b.Error(["No node found for output socket reference",o]),new Error("Error parsing node connections");const j=Vo(t.fullOperationName);if(!j)throw b.b.Error(["No mapping found for output socket reference",o]),new Error("Error parsing node connections");let S=null===(Y=j.outputs)||void 0===Y||null===(f=Y.values)||void 0===f?void 0:f[Z],O=!1;if(!S)for(const o in null===(d=j.outputs)||void 0===d?void 0:d.values){var d,U,u;if(o.startsWith("[")&&o.endsWith("]"))O=!0,S=null===(U=j.outputs)||void 0===U||null===(u=U.values)||void 0===u?void 0:u[o]}const v=S?O?S.name.replace("$1",Z):null===(A=S)||void 0===A?void 0:A.name:Z,G=S&&S.do&&t.EG.find((s=>s.className===S.do))||t.EG[0];let B=G.dataOutputs.find((s=>s.name===v));B||(B=this._createNewSocketConnection(v,!0),G.dataOutputs.push(B)),a.connectedPointIds.push(B.uniqueId),B.connectedPointIds.push(a.uniqueId)}}}if(L.flowGraphMapping.interBlockConnectors)for(const s of L.flowGraphMapping.interBlockConnectors){const Z=s.input,o=s.output,t=s.isVariable;this._connectFlowGraphNodes(Z,o,N.EG[s.inputBlockIndex],N.EG[s.outputBlockIndex],t)}if(L.flowGraphMapping.extraProcessor){var H;const Z=null===(H=this._interactivityGraph.declarations)||void 0===H?void 0:H[i.declaration];if(!Z)throw b.b.Error(["No declaration found for extra processor",i]),new Error("Error parsing node connections");N.EG=L.flowGraphMapping.extraProcessor(i,Z,L.flowGraphMapping,this,N.EG,s,this._gltf)}}}_createNewSocketConnection(s,Z){return{uniqueId:(0,Xo.c)(),name:s,_connectionType:Z?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(s,Z,o,t,j){const S=j?o.dataInputs:o.signalInputs,a=j?t.dataOutputs:t.signalOutputs,O=S.find((Z=>Z.name===s))||this._createNewSocketConnection(s),v=a.find((s=>s.name===Z))||this._createNewSocketConnection(Z,!0);S.find((Z=>Z.name===s))||S.push(O),a.find((s=>s.name===Z))||a.push(v),O.connectedPointIds.push(v.uniqueId),v.connectedPointIds.push(O.uniqueId)}getVariableName(s){return"staticVariable_"+s}serializeToFlowGraph(){const s={uniqueId:(0,Xo.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(s);for(let Z=0;Z<this._staticVariables.length;Z++){const o=this._staticVariables[Z];s._userVariables[this.getVariableName(Z)]=o}return{rightHanded:!0,allBlocks:this._nodes.reduce(((s,Z)=>s.concat(Z.EG)),[]),executionContexts:[s]}}}const ho="KHR_interactivity";class Mo{constructor(s){this._loader=s,this.name=ho,this.enabled=this._loader.isExtensionUsed(ho),this._pathConverter=(0,M.i)(this._loader.aO),s._skipStartAnimationStep=!0;const Z=s.babylonScene;Z&&function(s){(0,M.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!s.activeCamera)return new j.e(NaN,NaN,NaN,NaN);const Z=j.e.FromRotationMatrix(s.activeCamera.getWorldMatrix()).normalize();return s.useRightHandedSystem||(Z.w*=-1,Z.x*=-1),Z},type:"Quaternion",getTarget:()=>s.activeCamera}),(0,M.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!s.activeCamera)return new j.n(NaN,NaN,NaN);const Z=s.activeCamera.getWorldMatrix().getTranslation();return s.useRightHandedSystem||(Z.x*=-1),Z},type:"sO",getTarget:()=>s.activeCamera}),(0,M.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:s=>{var Z;return(null===(Z=s._babylonAnimationGroup)||void 0===Z?void 0:Z.isPlaying)??!1},type:"boolean",getTarget:s=>s._babylonAnimationGroup}),(0,M.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:s=>{var Z;return((null===(Z=s._babylonAnimationGroup)||void 0===Z?void 0:Z.from)??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup}),(0,M.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:s=>{var Z;return((null===(Z=s._babylonAnimationGroup)||void 0===Z?void 0:Z.to)??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup}),(0,M.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:s=>{var Z;return((null===(Z=s._babylonAnimationGroup)||void 0===Z?void 0:Z.getCurrentFrame())??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup}),(0,M.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:s=>{var Z;return((null===(Z=s._babylonAnimationGroup)||void 0===Z?void 0:Z.getCurrentFrame())??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup})}(Z)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var s;if(!this._loader.babylonScene||!this._pathConverter)return;const Z=this._loader.babylonScene,o=null===(s=this._loader.aO.extensions)||void 0===s?void 0:s.KHR_interactivity;if(!o)return;const t=new Yo.c({fZ:Z});t.dispatchEventsSynchronously=!1;const j=o.graphs.map((s=>new qo(s,this._loader.aO,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(j.map((async s=>await io(s,{coordinator:t,pathConverter:this._pathConverter})))),t.start()}}var xo;xo=async()=>(await Promise.resolve().then(o.bind(o,12837))).FlowGraphGLTFDataProvider,bo[`${ho}/${"FlowGraphGLTFDataProvider"}`]=xo,h(ho),q(ho,!0,(s=>new Mo(s)));const ko="KHR_node_visibility";(0,M.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:s=>{const Z=s._babylonTransformNode;return!Z||void 0===Z.isVisible||Z.isVisible},set:(s,Z)=>{var o,t;null===(o=Z._primitiveBabylonMeshes)||void 0===o||o.forEach((s=>{s.inheritVisibility=!0})),Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=s),null===(t=Z._primitiveBabylonMeshes)||void 0===t||t.forEach((Z=>{Z.isVisible=s}))},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class yo{constructor(s){this.name=ko,this._loader=s,this.enabled=s.isExtensionUsed(ko)}async onReady(){var s;null===(s=this._loader.aO.nodes)||void 0===s||s.forEach((s=>{var Z,o,t,j;(null===(Z=s._primitiveBabylonMeshes)||void 0===Z||Z.forEach((s=>{s.inheritVisibility=!0})),null!==(o=s.extensions)&&void 0!==o&&o.KHR_node_visibility)&&(!1===(null===(t=s.extensions)||void 0===t?void 0:t.KHR_node_visibility.visible)&&(s._babylonTransformNode&&(s._babylonTransformNode.isVisible=!1),null===(j=s._primitiveBabylonMeshes)||void 0===j||j.forEach((s=>{s.isVisible=!1}))))}))}dispose(){this._loader=null}}h(ko),q(ko,!0,(s=>new yo(s)));const Io="KHR_node_selectability";lo("event/onSelect",Io,{EG:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",do:"FlowGraphGetVariableBlock",dataTransformer:s=>["pickedMesh_"+s[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",do:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(s,Z,o,t,j,S,a){var O,v,G,B,Q,D;const z=j[j.length-1];z.config=z.config||{},z.config.glTF=a;const Y=null===(O=s.configuration)||void 0===O||null===(v=O.nodeIndex)||void 0===v?void 0:v.value[0];if(void 0===Y||"number"!==typeof Y)throw new Error("nodeIndex not found in configuration");const b="pickedMesh_"+Y;return j[1].config.variable=b,S._userVariables[b]={className:"Mesh",id:null===a||void 0===a||null===(G=a.nodes)||void 0===G||null===(B=G[Y]._babylonTransformNode)||void 0===B?void 0:B.id,uniqueId:null===a||void 0===a||null===(Q=a.nodes)||void 0===Q||null===(D=Q[Y]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},j}}),(0,M.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:s=>{const Z=s._babylonTransformNode;return!Z||void 0===Z.Uv||Z.Uv},set:(s,Z)=>{var o;null===(o=Z._primitiveBabylonMeshes)||void 0===o||o.forEach((Z=>{Z.Uv=s}))},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"Uv"],type:"boolean"});class Co{constructor(s){this.name=Io,this._loader=s,this.enabled=s.isExtensionUsed(Io)}async onReady(){var s;null===(s=this._loader.aO.nodes)||void 0===s||s.forEach((s=>{var Z,o,t;null!==(Z=s.extensions)&&void 0!==Z&&Z.KHR_node_selectability&&!1===(null===(o=s.extensions)||void 0===o?void 0:o.KHR_node_selectability.selectable)&&(null===(t=s._babylonTransformNode)||void 0===t||t.getChildMeshes().forEach((s=>{s.Uv=!1})))}))}dispose(){this._loader=null}}h(Io),q(Io,!0,(s=>new Co(s)));const Ko="KHR_node_hoverability",po="targetMeshPointerOver_";lo("event/onHoverIn",Ko,{EG:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",do:"FlowGraphGetVariableBlock",dataTransformer:s=>[po+s[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",do:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(s,Z,o,t,j,S,a){var O,v,G,B,Q,D;const z=j[j.length-1];z.config=z.config||{},z.config.glTF=a;const Y=null===(O=s.configuration)||void 0===O||null===(v=O.nodeIndex)||void 0===v?void 0:v.value[0];if(void 0===Y||"number"!==typeof Y)throw new Error("nodeIndex not found in configuration");const b=po+Y;return j[1].config.variable=b,S._userVariables[b]={className:"Mesh",id:null===a||void 0===a||null===(G=a.nodes)||void 0===G||null===(B=G[Y]._babylonTransformNode)||void 0===B?void 0:B.id,uniqueId:null===a||void 0===a||null===(Q=a.nodes)||void 0===Q||null===(D=Q[Y]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},j}});const Eo="targetMeshPointerOut_";lo("event/onHoverOut",Ko,{EG:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",do:"FlowGraphGetVariableBlock",dataTransformer:s=>[Eo+s[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",do:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(s,Z,o,t,j,S,a){var O,v,G,B,Q,D;const z=j[j.length-1];z.config=z.config||{},z.config.glTF=a;const Y=null===(O=s.configuration)||void 0===O||null===(v=O.nodeIndex)||void 0===v?void 0:v.value[0];if(void 0===Y||"number"!==typeof Y)throw new Error("nodeIndex not found in configuration");const b=Eo+Y;return j[1].config.variable=b,S._userVariables[b]={className:"Mesh",id:null===a||void 0===a||null===(G=a.nodes)||void 0===G||null===(B=G[Y]._babylonTransformNode)||void 0===B?void 0:B.id,uniqueId:null===a||void 0===a||null===(Q=a.nodes)||void 0===Q||null===(D=Q[Y]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},j}}),(0,M.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:s=>{const Z=s._babylonTransformNode;return!Z||void 0===Z.pointerOverDisableMeshTesting||Z.pointerOverDisableMeshTesting},set:(s,Z)=>{var o;null===(o=Z._primitiveBabylonMeshes)||void 0===o||o.forEach((Z=>{Z.pointerOverDisableMeshTesting=!s}))},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Po{constructor(s){this.name=Ko,this._loader=s,this.enabled=s.isExtensionUsed(Ko)}async onReady(){var s;null===(s=this._loader.aO.nodes)||void 0===s||s.forEach((s=>{var Z,o,t;null!==(Z=s.extensions)&&void 0!==Z&&Z.KHR_node_hoverability&&!1===(null===(o=s.extensions)||void 0===o?void 0:o.KHR_node_hoverability.hoverable)&&(null===(t=s._babylonTransformNode)||void 0===t||t.getChildMeshes().forEach((s=>{s.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}h(Ko),q(Ko,!0,(s=>new Po(s)));const ro="ExtrasAsMetadata";class To{_assignExtras(s,Z){if(Z.extras&&Object.keys(Z.extras).length>0){const o=s.metadata=s.metadata||{};(o.aO=o.aO||{}).extras=Z.extras}}constructor(s){this.name=ro,this.enabled=!0,this._loader=s}dispose(){this._loader=null}loadNodeAsync(s,Z,o){return this._loader.loadNodeAsync(s,Z,(s=>{this._assignExtras(s,Z),o(s)}))}loadCameraAsync(s,Z,o){return this._loader.loadCameraAsync(s,Z,(s=>{this._assignExtras(s,Z),o(s)}))}createMaterial(s,Z,o){const t=this._loader.createMaterial(s,Z,o);return this._assignExtras(t,Z),t}}h(ro),q(ro,!1,(s=>new To(s)));o(12837)},12708:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>c,f:()=>L,j:()=>N,n:()=>V});var t=o(10932),j=o(10938),S=o(12340),a=o(11240),O=o(11197),v=o(11206),G=o(10955),B=o(10927),Q=o(11236),D=o(11626),z=o(11246),Y=o(11172);class b{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.gQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.GD=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(s){this._environmentTexture=s}getNodes(){let s=[];s=s.concat(this.meshes),s=s.concat(this.lights),s=s.concat(this.cameras),s=s.concat(this.transformNodes);for(const Z of this.skeletons)s=s.concat(Z.bones);return s}}class f extends b{}class A{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const s=this.rootNodes;for(const t of s)t.dispose();s.length=0;const Z=this.skeletons;for(const t of Z)t.dispose();Z.length=0;const o=this.animationGroups;for(const t of o)t.dispose();o.length=0}}class d extends b{constructor(s){super(),this._wasAddedToScene=!1,(s=s||B.c.LastCreatedScene)&&(this.fZ=s,this.proceduralTextures=[],s.jO.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=s.getEngine().onContextRestoredObservable.add((()=>{for(const s of this.geometries)s._rebuild();for(const s of this.meshes)s._rebuild();for(const s of this.gQ)s.rebuild();for(const s of this.textures)s._rebuild()})))}_topologicalSort(s){const Z=new Map;for(const a of s)Z.set(a.uniqueId,a);const o={dependsOn:new Map,dependedBy:new Map};for(const a of s){const s=a.uniqueId;o.dependsOn.set(s,new Set),o.dependedBy.set(s,new Set)}for(const a of s){const s=a.uniqueId,t=o.dependsOn.get(s);if(a instanceof Q.e){const j=a.sourceMesh;Z.has(j.uniqueId)&&(t.add(j.uniqueId),o.dependedBy.get(j.uniqueId).add(s))}const j=o.dependedBy.get(s);for(const S of a.getDescendants()){const t=S.uniqueId;if(Z.has(t)){j.add(t);o.dependsOn.get(t).add(s)}}}const t=[],j=[];for(const a of s){const s=a.uniqueId;0===o.dependsOn.get(s).size&&(j.push(a),Z.delete(s))}const S=j;for(;S.length>0;){const s=S.shift();t.push(s);const j=o.dependedBy.get(s.uniqueId);for(const t of Array.from(j.values())){const j=o.dependsOn.get(t);j.delete(s.uniqueId),0===j.size&&Z.get(t)&&(S.push(Z.get(t)),Z.delete(t))}}return Z.size>0&&(G.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),Z.forEach((s=>{G.b.Error(s.name)}))),t}_addNodeAndDescendantsToList(s,Z,o,t){if(o&&(!t||t(o))&&!Z.has(o.uniqueId)){s.push(o),Z.add(o.uniqueId);for(const j of o.getDescendants(!0))this._addNodeAndDescendantsToList(s,Z,j,t)}}_isNodeInContainer(s){return s instanceof v.b&&-1!==this.meshes.indexOf(s)||(s instanceof O.c&&-1!==this.transformNodes.indexOf(s)||(s instanceof D.b&&-1!==this.lights.indexOf(s)||s instanceof z.e&&-1!==this.cameras.indexOf(s)))}_isValidHierarchy(){for(const s of this.meshes)if(s.parent&&!this._isNodeInContainer(s.parent))return G.b.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;for(const s of this.transformNodes)if(s.parent&&!this._isNodeInContainer(s.parent))return G.b.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;for(const s of this.lights)if(s.parent&&!this._isNodeInContainer(s.parent))return G.b.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;for(const s of this.cameras)if(s.parent&&!this._isNodeInContainer(s.parent))return G.b.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||j.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const t={},S={},O=new A,v=[],G=[],B={doNotInstantiate:!0,...o},Q=[],D=new Set;for(const j of this.transformNodes)null===j.parent&&this._addNodeAndDescendantsToList(Q,D,j,B.predicate);for(const j of this.meshes)null===j.parent&&this._addNodeAndDescendantsToList(Q,D,j,B.predicate);const z=this._topologicalSort(Q),Y=(o,j)=>{if(((Z,o)=>{if(t[Z.uniqueId]=o.uniqueId,S[o.uniqueId]=o,s&&(o.name=s(Z.name)),o instanceof a.d){const s=o;if(s.morphTargetManager){const o=Z.morphTargetManager;s.morphTargetManager=o.clone();for(let Z=0;Z<o.numTargets;Z++){const j=o.getTarget(Z),a=s.morphTargetManager.getTarget(Z);t[j.uniqueId]=a.uniqueId,S[a.uniqueId]=a}}}})(o,j),o.parent){const s=t[o.parent.uniqueId],Z=S[s];j.parent=Z||o.parent}if(j.position&&o.position&&j.position.O(o.position),j.rotationQuaternion&&o.rotationQuaternion&&j.rotationQuaternion.O(o.rotationQuaternion),j.rotation&&o.rotation&&j.rotation.O(o.rotation),j.ZO&&o.ZO&&j.ZO.O(o.ZO),j.material){const a=j;if(a.material)if(Z){const Z=o.material;if(-1===G.indexOf(Z)){let o=Z.clone(s?s(Z.name):"Clone of "+Z.name);if(G.push(Z),t[Z.uniqueId]=o.uniqueId,S[o.uniqueId]=o,"MultiMaterial"===Z.getClassName()){const j=Z;for(const Z of j.GO)Z&&(o=Z.clone(s?s(Z.name):"Clone of "+Z.name),G.push(Z),t[Z.uniqueId]=o.uniqueId,S[o.uniqueId]=o);j.GO=j.GO.map((s=>s&&S[t[s.uniqueId]]))}}"InstancedMesh"!==a.getClassName()&&(a.material=S[t[Z.uniqueId]])}else"MultiMaterial"===a.material.getClassName()?-1===this.fZ.multiMaterials.indexOf(a.material)&&this.fZ.addMultiMaterial(a.material):-1===this.fZ.materials.indexOf(a.material)&&this.fZ.addMaterial(a.material)}null===j.parent&&O.rootNodes.push(j)};for(const j of z)if("InstancedMesh"===j.getClassName()){const s=j,Z=s.sourceMesh,o=t[Z.uniqueId];Y(s,("number"===typeof o?S[o]:Z).createInstance(s.name))}else{let s=!0;"dY"===j.getClassName()||"Node"===j.getClassName()||j.skeleton||!j.getTotalVertices||0===j.getTotalVertices()?s=!1:B.doNotInstantiate&&(s="function"===typeof B.doNotInstantiate?!B.doNotInstantiate(j):!B.doNotInstantiate);const Z=s?j.createInstance(`instance of ${j.name}`):j.clone(`Clone of ${j.name}`,null,!0);if(!Z)throw new Error(`Could not clone or instantiate node on Asset Container ${j.name}`);Y(j,Z)}for(const j of this.skeletons){if(B.predicate&&!B.predicate(j))continue;const Z=j.clone(s?s(j.name):"Clone of "+j.name);for(const s of this.meshes)if(s.skeleton===j&&!s.isAnInstance){const o=S[t[s.uniqueId]];if(!o||o.isAnInstance)continue;if(o.skeleton=Z,-1!==v.indexOf(Z))continue;v.push(Z);for(const s of Z.bones)s._linkedTransformNode&&(s._linkedTransformNode=S[t[s._linkedTransformNode.uniqueId]])}O.skeletons.push(Z)}for(const j of this.animationGroups){if(B.predicate&&!B.predicate(j))continue;const Z=j.clone(s?s(j.name):"Clone of "+j.name,(s=>S[t[s.uniqueId]]||s));O.animationGroups.push(Z)}return O}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||j.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.fZ.environmentTexture=this.environmentTexture);for(const s of this.fZ._serializableComponents)s.addFromContainer(this);this.fZ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Z=[];for(const o of this.cameras)s&&!s(o)||(this.fZ.addCamera(o),Z.push(o));for(const o of this.lights)s&&!s(o)||(this.fZ.addLight(o),Z.push(o));for(const o of this.meshes)s&&!s(o)||(this.fZ.wG(o),Z.push(o));for(const o of this.skeletons)s&&!s(o)||this.fZ.addSkeleton(o);for(const o of this.animations)s&&!s(o)||this.fZ.addAnimation(o);for(const o of this.animationGroups)s&&!s(o)||this.fZ.addAnimationGroup(o);for(const o of this.multiMaterials)s&&!s(o)||this.fZ.addMultiMaterial(o);for(const o of this.materials)s&&!s(o)||this.fZ.addMaterial(o);for(const o of this.morphTargetManagers)s&&!s(o)||this.fZ.addMorphTargetManager(o);for(const o of this.geometries)s&&!s(o)||this.fZ.addGeometry(o);for(const o of this.transformNodes)s&&!s(o)||(this.fZ.addTransformNode(o),Z.push(o));for(const o of this.actionManagers)s&&!s(o)||this.fZ.addActionManager(o);for(const o of this.textures)s&&!s(o)||this.fZ.addTexture(o);for(const o of this.reflectionProbes)s&&!s(o)||this.fZ.addReflectionProbe(o);for(const o of Z)o.parent&&-1===this.fZ.getNodes().indexOf(o.parent)&&(o.setParent?o.setParent(null):o.parent=null)}removeAllFromScene(){this._isValidHierarchy()||j.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.fZ.environmentTexture&&(this.fZ.environmentTexture=null);for(const s of this.fZ._serializableComponents)s.removeFromContainer(this)}removeFromScene(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const Z of this.cameras)s&&!s(Z)||this.fZ.removeCamera(Z);for(const Z of this.lights)s&&!s(Z)||this.fZ.removeLight(Z);for(const Z of this.meshes)s&&!s(Z)||this.fZ.cG(Z,!0);for(const Z of this.skeletons)s&&!s(Z)||this.fZ.removeSkeleton(Z);for(const Z of this.animations)s&&!s(Z)||this.fZ.removeAnimation(Z);for(const Z of this.animationGroups)s&&!s(Z)||this.fZ.removeAnimationGroup(Z);for(const Z of this.multiMaterials)s&&!s(Z)||this.fZ.removeMultiMaterial(Z);for(const Z of this.materials)s&&!s(Z)||this.fZ.removeMaterial(Z);for(const Z of this.morphTargetManagers)s&&!s(Z)||this.fZ.removeMorphTargetManager(Z);for(const Z of this.geometries)s&&!s(Z)||this.fZ.removeGeometry(Z);for(const Z of this.transformNodes)s&&!s(Z)||this.fZ.removeTransformNode(Z);for(const Z of this.actionManagers)s&&!s(Z)||this.fZ.removeActionManager(Z);for(const Z of this.textures)s&&!s(Z)||this.fZ.removeTexture(Z);for(const Z of this.reflectionProbes)s&&!s(Z)||this.fZ.removeReflectionProbe(Z)}dispose(){const s=this.cameras.slice(0);for(const z of s)z.dispose();this.cameras.length=0;const Z=this.lights.slice(0);for(const z of Z)z.dispose();this.lights.length=0;const o=this.meshes.slice(0);for(const z of o)z.dispose();this.meshes.length=0;const t=this.skeletons.slice(0);for(const z of t)z.dispose();this.skeletons.length=0;const j=this.animationGroups.slice(0);for(const z of j)z.dispose();this.animationGroups.length=0;const S=this.multiMaterials.slice(0);for(const z of S)z.dispose();this.multiMaterials.length=0;const a=this.materials.slice(0);for(const z of a)z.dispose();this.materials.length=0;const O=this.geometries.slice(0);for(const z of O)z.dispose();this.geometries.length=0;const v=this.transformNodes.slice(0);for(const z of v)z.dispose();this.transformNodes.length=0;const G=this.actionManagers.slice(0);for(const z of G)z.dispose();this.actionManagers.length=0;const B=this.textures.slice(0);for(const z of B)z.dispose();this.textures.length=0;const Q=this.reflectionProbes.slice(0);for(const z of Q)z.dispose();this.reflectionProbes.length=0;const D=this.morphTargetManagers.slice(0);for(const z of D)z.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const z of this.fZ._serializableComponents)z.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.fZ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(s,Z,o){if(s&&Z)for(const t of s){let s=!0;if(o)for(const Z of o)if(t===Z){s=!1;break}s&&(Z.push(t),t._parentContainer=this)}}moveAllFromScene(s){this._wasAddedToScene=!1,void 0===s&&(s=new f);for(const Z in this)Object.prototype.hasOwnProperty.call(this,Z)&&(this[Z]=this[Z]||("_environmentTexture"===Z?null:[]),this._moveAssets(this.fZ[Z],this[Z],s[Z]));this.environmentTexture=this.fZ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const s=new a.d("assetContainerRootMesh",this.fZ);for(const Z of this.meshes)Z.parent||s.addChild(Z);return this.meshes.unshift(s),s}mergeAnimationsTo(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.c.LastCreatedScene,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!s)return G.b.Error("No scene available to merge animations to"),[];const t=o||(Z=>{let o=null;const t=Z.animations.length?Z.animations[0].targetProperty:"",j=Z.name.split(".").join("").split("_primitive")[0];switch(t){case"position":case"rotationQuaternion":o=s.getTransformNodeByName(Z.name)||s.getTransformNodeByName(j);break;case"influence":o=s.getMorphTargetByName(Z.name)||s.getMorphTargetByName(j);break;default:o=s.getNodeByName(Z.name)||s.getNodeByName(j)}return o}),j=this.getNodes();for(const O of j){const s=t(O);if(null!==s){for(const Z of O.animations){const o=s.animations.filter((s=>s.targetProperty===Z.targetProperty));for(const Z of o){const o=s.animations.indexOf(Z,0);o>-1&&s.animations.splice(o,1)}}s.animations=s.animations.concat(O.animations)}}const S=[],a=this.animationGroups.slice();for(const O of a){S.push(O.clone(O.name,t));for(const s of O.animatables)s.stop()}for(const O of Z){const Z=t(O.target);Z&&(s.beginAnimation(Z,O.fromFrame,O.toFrame,O.loopAnimation,O.speedRatio,O.onAnimationEnd?O.onAnimationEnd:void 0,void 0,!0,void 0,O.onAnimationLoop?O.onAnimationLoop:void 0),s.stopAnimation(O.target))}return S}populateRootNodes(){this.rootNodes.length=0;for(const s of this.meshes)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s);for(const s of this.transformNodes)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s);for(const s of this.lights)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s);for(const s of this.cameras)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s)}addAllAssetsToContainer(s){if(!s)return;const Z=[],o=new Set;for(Z.push(s);Z.length>0;){const s=Z.pop();if(s instanceof a.d?(s.Pa&&-1===this.geometries.indexOf(s.Pa)&&this.geometries.push(s.Pa),this.meshes.push(s)):s instanceof Q.e?this.meshes.push(s):s instanceof O.c?this.transformNodes.push(s):s instanceof D.b?this.lights.push(s):s instanceof z.e&&this.cameras.push(s),s instanceof v.b){if(s.material&&-1===this.materials.indexOf(s.material)){this.materials.push(s.material);for(const Z of s.material.getActiveTextures())-1===this.textures.indexOf(Z)&&this.textures.push(Z)}s.skeleton&&-1===this.skeletons.indexOf(s.skeleton)&&this.skeletons.push(s.skeleton),s.morphTargetManager&&-1===this.morphTargetManagers.indexOf(s.morphTargetManager)&&this.morphTargetManagers.push(s.morphTargetManager)}for(const t of s.getChildren())o.has(t)||Z.push(t);o.add(s)}this.populateRootNodes()}_getByTags(s,Z,o){if(void 0===Z)return s;const t=[];for(const j in s){const S=s[j];Y.b&&Y.b.MatchesQuery(S,Z)&&(!o||o(S))&&t.push(S)}return t}getMeshesByTags(s,Z){return this._getByTags(this.meshes,s,Z)}getCamerasByTags(s,Z){return this._getByTags(this.cameras,s,Z)}getLightsByTags(s,Z){return this._getByTags(this.lights,s,Z)}getMaterialsByTags(s,Z){return this._getByTags(this.materials,s,Z).concat(this._getByTags(this.multiMaterials,s,Z))}getTransformNodesByTags(s,Z){return this._getByTags(this.transformNodes,s,Z)}}var U=o(10999);class u{constructor(s){this.byteOffset=0,this.buffer=s}async loadAsync(s){const Z=await this.buffer.readAsync(this.byteOffset,s);this._dataView=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),this._dataByteOffset=0}readUint32(){const s=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,s}readUint8Array(s){const Z=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,s);return this._dataByteOffset+=s,this.byteOffset+=s,Z}readString(s){return(0,U.f)(this.readUint8Array(s))}skipBytes(s){this._dataByteOffset+=s,this.byteOffset+=s}}var H=o(12713);const F="Z2xURg",i={name:"aO",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:s=>-1!==s.indexOf("asset")&&-1!==s.indexOf("version")||s.startsWith("data:base64,"+F)||s.startsWith("data:;base64,"+F)||s.startsWith("data:application/octet-stream;base64,"+F)||s.startsWith("data:model/gltf-binary;base64,"+F)};var N,L,V,g=o(10982),l=o(10990);function R(s,Z,o){try{return Promise.resolve(new Uint8Array(s,Z,o))}catch(t){return Promise.reject(t)}}!function(s){s[s.AUTO=0]="AUTO",s[s.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(N||(N={})),function(s){s[s.NONE=0]="NONE",s[s.FIRST=1]="FIRST",s[s.ALL=2]="ALL"}(L||(L={})),function(s){s[s.LOADING=0]="LOADING",s[s.READY=1]="READY",s[s.COMPLETE=2]="COMPLETE"}(V||(V={}));class e{constructor(){this.coordinateSystemMode=N.AUTO,this.animationStartMode=L.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=s=>Promise.resolve(s),this.extensionOptions={}}O(s){s&&(this.onParsed=s.onParsed,this.coordinateSystemMode=s.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=s.animationStartMode??this.animationStartMode,this.loadNodeAnimations=s.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=s.loadSkins??this.loadSkins,this.loadMorphTargets=s.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=s.compileMaterials??this.compileMaterials,this.useClipPlane=s.useClipPlane??this.useClipPlane,this.compileShadowGenerators=s.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=s.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=s.useRangeRequests??this.useRangeRequests,this.createInstances=s.createInstances??this.createInstances,this.alwaysComputeBoundingBox=s.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=s.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=s.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=s.skipMaterials??this.skipMaterials,this.useSRGBBuffers=s.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=s.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=s.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=s.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=s.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=s.customRootNode,this.onMeshLoaded=s.onMeshLoaded,this.onSkinLoaded=s.onSkinLoaded,this.onTextureLoaded=s.onTextureLoaded,this.onMaterialLoaded=s.onMaterialLoaded,this.onCameraLoaded=s.onCameraLoaded,this.extensionOptions=s.extensionOptions??this.extensionOptions)}}class c extends e{constructor(s){super(),this.onParsedObservable=new t.b,this.onMeshLoadedObservable=new t.b,this.onSkinLoadedObservable=new t.b,this.onTextureLoadedObservable=new t.b,this.onMaterialLoadedObservable=new t.b,this.onCameraLoadedObservable=new t.b,this.onCompleteObservable=new t.b,this.onErrorObservable=new t.b,this.jO=new t.b,this.onExtensionLoadedObservable=new t.b,this.validate=!1,this.onValidatedObservable=new t.b,this._loader=null,this._state=null,this._requests=new Array,this.name=i.name,this.extensions=i.extensions,this.onLoaderStateChangedObservable=new t.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.O(s)}set onParsed(s){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),s&&(this._onParsedObserver=this.onParsedObservable.add(s))}set onMeshLoaded(s){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),s&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(s))}set onSkinLoaded(s){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),s&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((Z=>s(Z.node,Z.skinnedNode))))}set onTextureLoaded(s){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),s&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(s))}set onMaterialLoaded(s){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),s&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(s))}set onCameraLoaded(s){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),s&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(s))}set onComplete(s){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(s)}set onError(s){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(s)}set onDispose(s){this._onDisposeObserver&&this.jO.remove(this._onDisposeObserver),this._onDisposeObserver=this.jO.add(s)}set onExtensionLoaded(s){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(s)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(s){this._loggingEnabled!==s&&(this._loggingEnabled=s,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(s){this._capturePerformanceCounters!==s&&(this._capturePerformanceCounters=s,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(s){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(s)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const s of this._requests)s.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=s=>Promise.resolve(s),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.jO.notifyObservers(void 0),this.jO.clear()}loadFile(s,Z,o,S,a,O,v,B){if(ArrayBuffer.isView(Z))return this._loadBinary(s,Z,o,S,v,B),null;this._progressCallback=a;const Q=Z.name||j.g.GetFilename(Z);if(O){if(this.useRangeRequests){this.validate&&G.b.Warn("glTF validation is not supported when range requests are enabled");const o={abort:()=>{},onCompleteObservable:new t.b},j={readAsync:(o,t)=>new Promise(((j,S)=>{this._loadFile(s,Z,(s=>{j(new Uint8Array(s))}),!0,(s=>{S(s)}),(s=>{s.setRequestHeader("Range",`bytes=${o}-${o+t-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new u(j)).then((s=>{o.onCompleteObservable.notifyObservers(o),S(s)}),v?s=>v(void 0,s):void 0),o}return this._loadFile(s,Z,(Z=>{this._validate(s,new Uint8Array(Z,0,Z.byteLength),o,Q),this._unpackBinaryAsync(new u({readAsync:(s,o)=>R(Z,s,o),byteLength:Z.byteLength})).then((s=>{S(s)}),v?s=>v(void 0,s):void 0)}),!0,v)}return this._loadFile(s,Z,(Z=>{try{this._validate(s,Z,o,Q),S({json:this._parseJson(Z)})}catch{v&&v()}}),!1,v)}_loadBinary(s,Z,o,t,j,S){this._validate(s,new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength),o,S),this._unpackBinaryAsync(new u({readAsync:(s,o)=>function(s,Z,o){try{if(Z<0||Z>=s.byteLength)throw new RangeError("Offset is out of range.");if(Z+o>s.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(s.buffer,s.byteOffset+Z,o))}catch(t){return Promise.reject(t)}}(Z,s,o),byteLength:Z.byteLength})).then((s=>{t(s)}),j?s=>j(void 0,s):void 0)}importMeshAsync(s,Z,o,t,j,S){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(o),this._loader.importMeshAsync(s,Z,null,o,t,j,S))))}loadAsync(s,Z,o,t,j){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${j||""}`),this._loader=this._getLoader(Z),this._loader.loadAsync(s,Z,o,t,j))))}loadAssetContainerAsync(s,Z,o,t,j){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${j||""}`),this._loader=this._getLoader(Z);const S=new d(s),a=[];this.onMaterialLoadedObservable.add((s=>{a.push(s)}));const O=[];this.onTextureLoadedObservable.add((s=>{O.push(s)}));const v=[];this.onCameraLoadedObservable.add((s=>{v.push(s)}));const G=[];return this.onMeshLoadedObservable.add((s=>{s.morphTargetManager&&G.push(s.morphTargetManager)})),this._loader.importMeshAsync(null,s,S,Z,o,t,j).then((s=>(Array.prototype.push.apply(S.geometries,s.geometries),Array.prototype.push.apply(S.meshes,s.meshes),Array.prototype.push.apply(S.gQ,s.gQ),Array.prototype.push.apply(S.skeletons,s.skeletons),Array.prototype.push.apply(S.animationGroups,s.animationGroups),Array.prototype.push.apply(S.materials,a),Array.prototype.push.apply(S.textures,O),Array.prototype.push.apply(S.lights,s.lights),Array.prototype.push.apply(S.transformNodes,s.transformNodes),Array.prototype.push.apply(S.cameras,v),Array.prototype.push.apply(S.morphTargetManagers,G),S)))}))}canDirectLoad(s){return i.canDirectLoad(s)}directLoad(s,Z){if(Z.startsWith("base64,"+F)||Z.startsWith(";base64,"+F)||Z.startsWith("application/octet-stream;base64,"+F)||Z.startsWith("model/gltf-binary;base64,"+F)){const o=(0,g.e)(Z);return this._validate(s,new Uint8Array(o,0,o.byteLength)),this._unpackBinaryAsync(new u({readAsync:(s,Z)=>R(o,s,Z),byteLength:o.byteLength}))}return this._validate(s,Z),Promise.resolve({json:this._parseJson(Z)})}createPlugin(s){return new c(s[i.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((s,Z)=>{this.onCompleteObservable.addOnce((()=>{s()})),this.onErrorObservable.addOnce((s=>{Z(s)}))}))}_setState(s){this._state!==s&&(this._state=s,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(V[this._state]))}_loadFile(s,Z,o,t,j,S){const a=s._loadFile(Z,o,(s=>{this._onProgress(s,a)}),!0,t,j,S);return a.onCompleteObservable.add((()=>{a._lengthComputable=!0,a._total=a._loaded})),this._requests.push(a),a}_onProgress(s,Z){if(!this._progressCallback)return;Z._lengthComputable=s.lengthComputable,Z._loaded=s.loaded,Z._total=s.total;let o=!0,t=0,j=0;for(const S of this._requests){if(void 0===S._lengthComputable||void 0===S._loaded||void 0===S._total)return;o=o&&S._lengthComputable,t+=S._loaded,j+=S._total}this._progressCallback({lengthComputable:o,loaded:t,total:o?j:0})}_validate(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),H.e.ValidateAsync(Z,o,t,(Z=>this.preprocessUrlAsync(o+Z).then((Z=>s._loadFileAsync(Z,void 0,!0,!0).then((s=>new Uint8Array(s,0,s.byteLength))))))).then((s=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(s),this.onValidatedObservable.clear()}),(s=>{this._endPerformanceCounter("Validate JSON"),j.g.Warn(`Failed to validate: ${s.message}`),this.onValidatedObservable.clear()})))}_getLoader(s){const Z=s.json.asset||{};this._log(`Asset version: ${Z.version}`),Z.minVersion&&this._log(`Asset minimum version: ${Z.minVersion}`),Z.generator&&this._log(`Asset generator: ${Z.generator}`);const o=c._parseVersion(Z.version);if(!o)throw new Error("Invalid version: "+Z.version);if(void 0!==Z.minVersion){const s=c._parseVersion(Z.minVersion);if(!s)throw new Error("Invalid minimum version: "+Z.minVersion);if(c._compareVersion(s,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+Z.minVersion)}const t={1:c._CreateGLTF1Loader,2:c._CreateGLTF2Loader}[o.major];if(!t)throw new Error("Unsupported version: "+Z.version);return t(this)}_parseJson(s){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${s.length}`);const Z=JSON.parse(s);return this._endPerformanceCounter("Parse JSON"),Z}_unpackBinaryAsync(s){return this._startPerformanceCounter("Unpack Binary"),s.loadAsync(20).then((()=>{const Z=s.readUint32();if(1179937895!==Z)throw new l.g("Unexpected magic: "+Z,l.f.GLTFLoaderUnexpectedMagicError);const o=s.readUint32();this.loggingEnabled&&this._log(`Binary version: ${o}`);const t=s.readUint32();let j;switch(this.useRangeRequests||t===s.buffer.byteLength||G.b.Warn(`Length in header does not match actual data length: ${t} != ${s.buffer.byteLength}`),o){case 1:j=this._unpackBinaryV1Async(s,t);break;case 2:j=this._unpackBinaryV2Async(s,t);break;default:throw new Error("Unsupported version: "+o)}return this._endPerformanceCounter("Unpack Binary"),j}))}_unpackBinaryV1Async(s,Z){const o=s.readUint32(),t=s.readUint32();if(0!==t)throw new Error(`Unexpected content format: ${t}`);const j=Z-s.byteOffset,S={json:this._parseJson(s.readString(o)),bin:null};if(0!==j){const Z=s.byteOffset;S.bin={readAsync:(o,t)=>s.buffer.readAsync(Z+o,t),byteLength:j}}return Promise.resolve(S)}_unpackBinaryV2Async(s,Z){const o=1313821514,t=5130562,j=s.readUint32();if(s.readUint32()!==o)throw new Error("First chunk format is not JSON");return s.byteOffset+j===Z?s.loadAsync(j).then((()=>({json:this._parseJson(s.readString(j)),bin:null}))):s.loadAsync(j+8).then((()=>{const S={json:this._parseJson(s.readString(j)),bin:null},a=()=>{const j=s.readUint32();switch(s.readUint32()){case o:throw new Error("Unexpected JSON chunk");case t:{const Z=s.byteOffset;S.bin={readAsync:(o,t)=>s.buffer.readAsync(Z+o,t),byteLength:j},s.skipBytes(j);break}default:s.skipBytes(j)}return s.byteOffset!==Z?s.loadAsync(8).then(a):Promise.resolve(S)};return a()}))}static _parseVersion(s){if("1.0"===s||"1.0.1"===s)return{major:1,minor:0};const Z=(s+"").match(/^(\d+)\.(\d+)/);return Z?{major:parseInt(Z[1]),minor:parseInt(Z[2])}:null}static _compareVersion(s,Z){return s.major>Z.major?1:s.major<Z.major?-1:s.minor>Z.minor?1:s.minor<Z.minor?-1:0}_logOpen(s){this._log(s),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(s){const Z=c._logSpaces.substring(0,2*this._logIndentLevel);G.b.Log(`${Z}${s}`)}_logDisabled(s){}_startPerformanceCounterEnabled(s){j.g.StartPerformanceCounter(s)}_startPerformanceCounterDisabled(s){}_endPerformanceCounterEnabled(s){j.g.EndPerformanceCounter(s)}_endPerformanceCounterDisabled(s){}}c.IncrementalLoading=!0,c.HomogeneousCoordinates=!1,c._logSpaces="                                ",(0,S.c)(new c)},12713:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>a});var t=o(10938);function j(s,Z,o,t){const j={externalResourceFunction:t};return o&&(j.uri="file:"===Z?o:Z+o),ArrayBuffer.isView(s)?GLTFValidator.validateBytes(s,j):GLTFValidator.validateString(s,j)}function S(){const s=[];onmessage=Z=>{const o=Z.data;switch(o.id){case"init":importScripts(o.url);break;case"validate":j(o.data,o.rootUrl,o.fileName,(Z=>new Promise(((o,t)=>{const j=s.length;s.push({resolve:o,reject:t}),postMessage({id:"getExternalResource",index:j,uri:Z})})))).then((s=>{postMessage({id:"validate.resolve",value:s})}),(s=>{postMessage({id:"validate.reject",reason:s})}));break;case"getExternalResource.resolve":s[o.index].resolve(o.value);break;case"getExternalResource.reject":s[o.index].reject(o.reason)}}}class a{static ValidateAsync(s,Z,o,a){return"function"===typeof Worker?new Promise(((O,v)=>{const G=`${j}(${S})()`,B=URL.createObjectURL(new Blob([G],{type:"application/javascript"})),Q=new Worker(B),D=s=>{Q.removeEventListener("error",D),Q.removeEventListener("message",z),v(s)},z=s=>{const Z=s.data;switch(Z.id){case"getExternalResource":a(Z.uri).then((s=>{Q.postMessage({id:"getExternalResource.resolve",index:Z.index,value:s},[s.buffer])}),(s=>{Q.postMessage({id:"getExternalResource.reject",index:Z.index,reason:s})}));break;case"validate.resolve":Q.removeEventListener("error",D),Q.removeEventListener("message",z),O(Z.value),Q.terminate();break;case"validate.reject":Q.removeEventListener("error",D),Q.removeEventListener("message",z),v(Z.reason),Q.terminate()}};if(Q.addEventListener("error",D),Q.addEventListener("message",z),Q.postMessage({id:"init",url:t.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(s)){const t=s.slice();Q.postMessage({id:"validate",data:t,rootUrl:Z,fileName:o},[t.buffer])}else Q.postMessage({id:"validate",data:s,rootUrl:Z,fileName:o})})):(this._LoadScriptPromise||(this._LoadScriptPromise=t.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>j(s,Z,o,a))))}}a.Configuration={url:`${t.g._DefaultCdnUrl}/gltf_validator.js`}},13229:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>i});var t=o(11086),j=o(11091),S=o(11167),a=o(10900),O=o(11548),v=o(11566),G=o(11113),B=o(11493),Q=o(10916),D=o(11026);o(12465),o(12376),o(12385),o(12378),o(12389),o(12392),o(12401);const z="imageProcessingCompatibility",Y="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";D.d.IncludesShadersStore[z]||(D.d.IncludesShadersStore[z]=Y);const b="skyPixelShader",f="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";D.d.ShadersStore[b]||(D.d.ShadersStore[b]=f);o(12475),o(12407),o(12410),o(12427),o(12418);const A="skyVertexShader",d="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";D.d.ShadersStore[A]||(D.d.ShadersStore[A]=d);var U=o(11590),u=o(11189),H=o(11181);class F extends O.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class i extends v.e{constructor(s,Z){super(s,Z),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new a.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=a.n.Zero(),this.up=a.n.Up(),this.dithering=!1,this._cameraPosition=a.n.Zero(),this._skyOrientation=new a.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(s,Z){const o=Z._drawWrapper;if(this.isFrozen&&o.effect&&o._wasPreviouslyReady)return!0;Z.materialDefines||(Z.materialDefines=new F);const t=Z.materialDefines,j=this.Ls();if(this._isReadyForSubMesh(Z))return!0;if((0,H.I)(s,j,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,t),(0,H.z)(s,t,!0,!1),t.IMAGEPROCESSINGPOSTPROCESS!==j.imageProcessingConfiguration.applyByPostProcess&&t.markAsMiscDirty(),t.DITHER!==this.dithering&&t.markAsMiscDirty(),t.isDirty){t.markAsProcessed(),j.resetCachedMaterial();const s=new U.c;t.FOG&&s.addFallback(1,"FOG"),t.IMAGEPROCESSINGPOSTPROCESS=j.imageProcessingConfiguration.applyByPostProcess,t.DITHER=this.dithering;const o=[G.e.PositionKind];t.VERTEXCOLOR&&o.push(G.e.ColorKind);const S="sky",a=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,u.b)(a);const O=t.toString();Z.setEffect(j.getEngine().createEffect(S,o,a,[],O,s,this.onCompiled,this.onError),t,this._materialContext)}return!(!Z.effect||!Z.effect.isReady())&&(t._renderId=j.getRenderId(),o._wasPreviouslyReady=!0,!0)}bindForSubMesh(s,Z,o){const t=this.Ls(),j=o.materialDefines;if(!j)return;const S=o.effect;if(!S)return;this._activeEffect=S,this.bindOnlyWorldMatrix(s),this._activeEffect.setMatrix("viewProjection",t.getTransformMatrix()),this._mustRebind(t,S,o)&&((0,u.f)(S,this,t),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,H.h)(j,S,t)),t.fogEnabled&&Z.applyFog&&t.fogMode!==B.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",t.getViewMatrix()),(0,H.e)(t,Z,this._activeEffect);const O=t.activeCamera;if(O){const s=O.getWorldMatrix();this._cameraPosition.x=s.m[12],this._cameraPosition.y=s.m[13],this._cameraPosition.z=s.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const s=Math.PI*(this.inclination-.5),Z=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(Z)*Math.cos(s),this.sunPosition.y=this.distance*Math.sin(-s),this.sunPosition.z=this.distance*Math.sin(Z)*Math.cos(s),a.e.FromUnitVectorsToRef(a.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(Z,this._activeEffect,o)}getAnimatables(){return[]}dispose(s){super.dispose(s)}clone(s){return S.c.Clone((()=>new i(s,this.Ls())),this)}serialize(){const s=super.serialize();return s.customType="BABYLON.SkyMaterial",s}getClassName(){return"SkyMaterial"}static Parse(s,Z,o){return S.c.Parse((()=>new i(s.name,Z)),s,Z,o)}}(0,t.c)([(0,j.K)()],i.prototype,"luminance",void 0),(0,t.c)([(0,j.K)()],i.prototype,"turbidity",void 0),(0,t.c)([(0,j.K)()],i.prototype,"rayleigh",void 0),(0,t.c)([(0,j.K)()],i.prototype,"mieCoefficient",void 0),(0,t.c)([(0,j.K)()],i.prototype,"mieDirectionalG",void 0),(0,t.c)([(0,j.K)()],i.prototype,"distance",void 0),(0,t.c)([(0,j.K)()],i.prototype,"inclination",void 0),(0,t.c)([(0,j.K)()],i.prototype,"azimuth",void 0),(0,t.c)([(0,j.G)()],i.prototype,"sunPosition",void 0),(0,t.c)([(0,j.K)()],i.prototype,"useSunPosition",void 0),(0,t.c)([(0,j.G)()],i.prototype,"cameraOffset",void 0),(0,t.c)([(0,j.G)()],i.prototype,"up",void 0),(0,t.c)([(0,j.K)()],i.prototype,"dithering",void 0),(0,Q.f)("BABYLON.SkyMaterial",i)},11712:(s,Z,o)=>{"use strict";function t(s,Z){Z.headers=s.headers||{},Z.statusMessage=s.statusText,Z.statusCode=s.status,Z.data=s.response}function j(s,Z,o){return new Promise((function(j,S){o=o||{};var a,O,v,G=new XMLHttpRequest,B=o.body,Q=o.headers||{};for(a in o.timeout&&(G.timeout=o.timeout),G.ontimeout=G.onerror=function(s){s.timeout="timeout"==s.type,S(s)},G.open(s,Z.href||Z),G.onload=function(){for(v=G.getAllResponseHeaders().trim().split(/[\r\n]+/),t(G,G);O=v.shift();)O=O.split(": "),G.headers[O.shift().toLowerCase()]=O.join(": ");if((O=G.headers["content-type"])&&~O.indexOf("application/json"))try{G.data=JSON.parse(G.data,o.reviver)}catch(s){return t(G,s),S(s)}(G.status>=400?S:j)(G)},typeof FormData<"u"&&B instanceof FormData||B&&"object"==typeof B&&(Q["content-type"]="application/json",B=JSON.stringify(B)),G.withCredentials=!!o.withCredentials,Q)G.setRequestHeader(a,Q[a]);G.send(B)}))}o.r(Z),o.d(Z,{del:()=>v,get:()=>S,patch:()=>O,post:()=>a,put:()=>G,send:()=>j});var S=j.bind(j,"GET"),a=j.bind(j,"POST"),O=j.bind(j,"PATCH"),v=j.bind(j,"DELETE"),G=j.bind(j,"PUT")},13333:(s,Z,o)=>{"use strict";o.d(Z,{e:()=>Q});const t=.5*(Math.sqrt(3)-1),j=(3-Math.sqrt(3))/6,S=1/3,a=1/6,O=(Math.sqrt(5)-1)/4,v=(5-Math.sqrt(5))/20,G=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),B=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Q=class{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const Z="function"==typeof s?s:function(s){let Z=0,o=0,t=0,j=1;const S=function(){let s=4022871197;return function(Z){Z=Z.toString();for(let o=0;o<Z.length;o++){s+=Z.charCodeAt(o);let t=.02519603282416938*s;s=t>>>0,t-=s,t*=s,s=t>>>0,t-=s,s+=4294967296*t}return 2.3283064365386963e-10*(s>>>0)}}();Z=S(" "),o=S(" "),t=S(" "),Z-=S(s),Z<0&&(Z+=1);o-=S(s),o<0&&(o+=1);t-=S(s),t<0&&(t+=1);return function(){const s=2091639*Z+2.3283064365386963e-10*j;return Z=o,o=t,t=s-(j=0|s)}}(s);this.p=function(s){const Z=new Uint8Array(256);for(let o=0;o<256;o++)Z[o]=o;for(let o=0;o<255;o++){const t=o+~~(s()*(256-o)),j=Z[o];Z[o]=Z[t],Z[t]=j}return Z}(Z),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let o=0;o<512;o++)this.perm[o]=this.p[255&o],this.permMod12[o]=this.perm[o]%12}noise2D(s,Z){const o=this.permMod12,S=this.perm;let a=0,O=0,v=0;const B=(s+Z)*t,Q=Math.floor(s+B),D=Math.floor(Z+B),z=(Q+D)*j,Y=s-(Q-z),b=Z-(D-z);let f,A;Y>b?(f=1,A=0):(f=0,A=1);const d=Y-f+j,U=b-A+j,u=Y-1+2*j,H=b-1+2*j,F=255&Q,i=255&D;let N=.5-Y*Y-b*b;if(N>=0){const s=3*o[F+S[i]];N*=N,a=N*N*(G[s]*Y+G[s+1]*b)}let L=.5-d*d-U*U;if(L>=0){const s=3*o[F+f+S[i+A]];L*=L,O=L*L*(G[s]*d+G[s+1]*U)}let V=.5-u*u-H*H;if(V>=0){const s=3*o[F+1+S[i+1]];V*=V,v=V*V*(G[s]*u+G[s+1]*H)}return 70*(a+O+v)}noise3D(s,Z,o){const t=this.permMod12,j=this.perm;let O,v,B,Q;const D=(s+Z+o)*S,z=Math.floor(s+D),Y=Math.floor(Z+D),b=Math.floor(o+D),f=(z+Y+b)*a,A=s-(z-f),d=Z-(Y-f),U=o-(b-f);let u,H,F,i,N,L;A>=d?d>=U?(u=1,H=0,F=0,i=1,N=1,L=0):A>=U?(u=1,H=0,F=0,i=1,N=0,L=1):(u=0,H=0,F=1,i=1,N=0,L=1):d<U?(u=0,H=0,F=1,i=0,N=1,L=1):A<U?(u=0,H=1,F=0,i=0,N=1,L=1):(u=0,H=1,F=0,i=1,N=1,L=0);const V=A-u+a,g=d-H+a,l=U-F+a,R=A-i+2*a,e=d-N+2*a,c=U-L+2*a,w=A-1+.5,X=d-1+.5,W=U-1+.5,q=255&z,h=255&Y,M=255&b;let x=.6-A*A-d*d-U*U;if(x<0)O=0;else{const s=3*t[q+j[h+j[M]]];x*=x,O=x*x*(G[s]*A+G[s+1]*d+G[s+2]*U)}let k=.6-V*V-g*g-l*l;if(k<0)v=0;else{const s=3*t[q+u+j[h+H+j[M+F]]];k*=k,v=k*k*(G[s]*V+G[s+1]*g+G[s+2]*l)}let y=.6-R*R-e*e-c*c;if(y<0)B=0;else{const s=3*t[q+i+j[h+N+j[M+L]]];y*=y,B=y*y*(G[s]*R+G[s+1]*e+G[s+2]*c)}let I=.6-w*w-X*X-W*W;if(I<0)Q=0;else{const s=3*t[q+1+j[h+1+j[M+1]]];I*=I,Q=I*I*(G[s]*w+G[s+1]*X+G[s+2]*W)}return 32*(O+v+B+Q)}noise4D(s,Z,o,t){const j=this.perm;let S,a,G,Q,D;const z=(s+Z+o+t)*O,Y=Math.floor(s+z),b=Math.floor(Z+z),f=Math.floor(o+z),A=Math.floor(t+z),d=(Y+b+f+A)*v,U=s-(Y-d),u=Z-(b-d),H=o-(f-d),F=t-(A-d);let i=0,N=0,L=0,V=0;U>u?i++:N++,U>H?i++:L++,U>F?i++:V++,u>H?N++:L++,u>F?N++:V++,H>F?L++:V++;const g=i>=3?1:0,l=N>=3?1:0,R=L>=3?1:0,e=V>=3?1:0,c=i>=2?1:0,w=N>=2?1:0,X=L>=2?1:0,W=V>=2?1:0,q=i>=1?1:0,h=N>=1?1:0,M=L>=1?1:0,x=V>=1?1:0,k=U-g+v,y=u-l+v,I=H-R+v,C=F-e+v,K=U-c+2*v,p=u-w+2*v,E=H-X+2*v,P=F-W+2*v,r=U-q+3*v,T=u-h+3*v,m=H-M+3*v,n=F-x+3*v,J=U-1+4*v,ss=u-1+4*v,Zs=H-1+4*v,os=F-1+4*v,ts=255&Y,js=255&b,Ss=255&f,as=255&A;let Os=.6-U*U-u*u-H*H-F*F;if(Os<0)S=0;else{const s=j[ts+j[js+j[Ss+j[as]]]]%32*4;Os*=Os,S=Os*Os*(B[s]*U+B[s+1]*u+B[s+2]*H+B[s+3]*F)}let vs=.6-k*k-y*y-I*I-C*C;if(vs<0)a=0;else{const s=j[ts+g+j[js+l+j[Ss+R+j[as+e]]]]%32*4;vs*=vs,a=vs*vs*(B[s]*k+B[s+1]*y+B[s+2]*I+B[s+3]*C)}let Gs=.6-K*K-p*p-E*E-P*P;if(Gs<0)G=0;else{const s=j[ts+c+j[js+w+j[Ss+X+j[as+W]]]]%32*4;Gs*=Gs,G=Gs*Gs*(B[s]*K+B[s+1]*p+B[s+2]*E+B[s+3]*P)}let Bs=.6-r*r-T*T-m*m-n*n;if(Bs<0)Q=0;else{const s=j[ts+q+j[js+h+j[Ss+M+j[as+x]]]]%32*4;Bs*=Bs,Q=Bs*Bs*(B[s]*r+B[s+1]*T+B[s+2]*m+B[s+3]*n)}let Qs=.6-J*J-ss*ss-Zs*Zs-os*os;if(Qs<0)D=0;else{const s=j[ts+1+j[js+1+j[Ss+1+j[as+1]]]]%32*4;Qs*=Qs,D=Qs*Qs*(B[s]*J+B[s+1]*ss+B[s+2]*Zs+B[s+3]*os)}return 27*(S+a+G+Q+D)}}}}]);