/*! For license information please see s8oeea.11.fb958111.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{13314:(G,V,W)=>{"use strict";var J=W(13320),R=W(13323),d=W(13326);W.g.__TYPEDARRAY_POOL||(W.g.__TYPEDARRAY_POOL={UINT8:R([32,0]),UINT16:R([32,0]),UINT32:R([32,0]),INT8:R([32,0]),INT16:R([32,0]),INT32:R([32,0]),FLOAT:R([32,0]),DOUBLE:R([32,0]),DATA:R([32,0]),UINT8C:R([32,0]),BUFFER:R([32,0])});var k="undefined"!==typeof Uint8ClampedArray,z=W.g.__TYPEDARRAY_POOL;z.UINT8C||(z.UINT8C=R([32,0])),z.BUFFER||(z.BUFFER=R([32,0]));var X=z.DATA,P=z.BUFFER;function A(G){if(G){var V=G.length||G.byteLength,W=J.log2(V);X[W].push(G)}}function x(G){G=J.nextPow2(G);var V=J.log2(G),W=X[V];return W.length>0?W.pop():new ArrayBuffer(G)}function q(G){return new Uint8Array(x(G),0,G)}function L(G){return new Uint16Array(x(2*G),0,G)}function t(G){return new Uint32Array(x(4*G),0,G)}function Y(G){return new Int8Array(x(G),0,G)}function g(G){return new Int16Array(x(2*G),0,G)}function B(G){return new Int32Array(x(4*G),0,G)}function S(G){return new Float32Array(x(4*G),0,G)}function p(G){return new Float64Array(x(8*G),0,G)}function b(G){return k?new Uint8ClampedArray(x(G),0,G):q(G)}function r(G){return new DataView(x(G),0,G)}V.free=function(G){if(d(G))P[J.log2(G.length)].push(G);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(G)&&(G=G.buffer),!G)return;var V=G.length||G.byteLength,W=0|J.log2(V);X[W].push(G)}},V.freeUint8=V.freeUint16=V.freeUint32=V.freeInt8=V.freeInt16=V.freeInt32=V.freeFloat32=V.freeFloat=V.freeFloat64=V.freeDouble=V.freeUint8Clamped=V.freeDataView=function(G){A(G.buffer)},V.freeArrayBuffer=A,V.freeBuffer=function(G){P[J.log2(G.length)].push(G)},V.malloc=function(G,V){if(void 0===V||"arraybuffer"===V)return x(G);switch(V){case"uint8":return q(G);case"uint16":return L(G);case"uint32":return t(G);case"int8":return Y(G);case"int16":return g(G);case"int32":return B(G);case"float":case"float32":return S(G);case"double":case"float64":return p(G);case"uint8_clamped":return b(G);case"buffer":throw"Buffer not supported";case"data":case"dataview":return r(G);default:return null}return null},V.mallocArrayBuffer=x,V.mallocUint8=q,V.mallocUint16=L,V.mallocUint32=t,V.mallocInt8=Y,V.mallocInt16=g,V.mallocInt32=B,V.mallocFloat32=V.mallocFloat=S,V.mallocFloat64=V.mallocDouble=p,V.mallocUint8Clamped=b,V.mallocDataView=r,V.clearCache=function(){for(var G=0;G<32;++G)z.UINT8[G].length=0,z.UINT16[G].length=0,z.UINT32[G].length=0,z.INT8[G].length=0,z.INT16[G].length=0,z.INT32[G].length=0,z.FLOAT[G].length=0,z.DOUBLE[G].length=0,z.UINT8C[G].length=0,X[G].length=0,P[G].length=0}},13390:(G,V,W)=>{G.exports=R;var J=W(12153);function R(G,V){if(!(this instanceof R))return new R(G,V);var W=J.create();J.add(W,G,V),this.base=J.min(J.create(),G,W),this.iP=J.clone(V),this.max=J.max(J.create(),G,W),this.mag=J.length(this.iP)}var d=R.prototype;d.width=function(){return this.iP[0]},d.height=function(){return this.iP[1]},d.depth=function(){return this.iP[2]},d.x0=function(){return this.base[0]},d.y0=function(){return this.base[1]},d.z0=function(){return this.base[2]},d.x1=function(){return this.max[0]},d.y1=function(){return this.max[1]},d.z1=function(){return this.max[2]},d.translate=function(G){return J.add(this.max,this.max,G),J.add(this.base,this.base,G),this},d.setPosition=function(G){return J.add(this.max,G,this.iP),J.i(this.base,G),this},d.expand=function(G){var V=J.create(),W=J.create();return J.max(V,G.max,this.max),J.min(W,G.base,this.base),J.zW(V,V,W),new R(W,V)},d.intersects=function(G){return!(G.base[0]>this.max[0])&&(!(G.base[1]>this.max[1])&&(!(G.base[2]>this.max[2])&&(!(G.max[0]<this.base[0])&&(!(G.max[1]<this.base[1])&&!(G.max[2]<this.base[2])))))},d.touches=function(G){var V=this.union(G);return null!==V&&(0==V.width()||0==V.height()||0==V.depth())},d.union=function(G){if(!this.intersects(G))return null;var V=Math.max(G.base[0],this.base[0]),W=Math.max(G.base[1],this.base[1]),J=Math.max(G.base[2],this.base[2]);return new R([V,W,J],[Math.min(G.max[0],this.max[0])-V,Math.min(G.max[1],this.max[1])-W,Math.min(G.max[2],this.max[2])-J])}},13320:(G,V)=>{"use strict";function W(G){var V=32;return(G&=-G)&&V--,65535&G&&(V-=16),16711935&G&&(V-=8),252645135&G&&(V-=4),858993459&G&&(V-=2),1431655765&G&&(V-=1),V}V.INT_BITS=32,V.INT_MAX=2147483647,V.INT_MIN=-1<<31,V.sign=function(G){return(G>0)-(G<0)},V.abs=function(G){var V=G>>31;return(G^V)-V},V.min=function(G,V){return V^(G^V)&-(G<V)},V.max=function(G,V){return G^(G^V)&-(G<V)},V.isPow2=function(G){return!(G&G-1)&&!!G},V.log2=function(G){var V,W;return V=(G>65535)<<4,V|=W=((G>>>=V)>255)<<3,V|=W=((G>>>=W)>15)<<2,(V|=W=((G>>>=W)>3)<<1)|(G>>>=W)>>1},V.log10=function(G){return G>=1e9?9:G>=1e8?8:G>=1e7?7:G>=1e6?6:G>=1e5?5:G>=1e4?4:G>=1e3?3:G>=100?2:G>=10?1:0},V.popCount=function(G){return 16843009*((G=(858993459&(G-=G>>>1&1431655765))+(G>>>2&858993459))+(G>>>4)&252645135)>>>24},V.countTrailingZeros=W,V.nextPow2=function(G){return G+=0===G,--G,G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)+1},V.prevPow2=function(G){return G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)-(G>>>1)},V.parity=function(G){return G^=G>>>16,G^=G>>>8,G^=G>>>4,27030>>>(G&=15)&1};var J=new Array(256);!function(G){for(var V=0;V<256;++V){var W=V,J=V,R=7;for(W>>>=1;W;W>>>=1)J<<=1,J|=1&W,--R;G[V]=J<<R&255}}(J),V.reverse=function(G){return J[255&G]<<24|J[G>>>8&255]<<16|J[G>>>16&255]<<8|J[G>>>24&255]},V.interleave2=function(G,V){return(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))<<1},V.deinterleave2=function(G,V){return(G=65535&((G=16711935&((G=252645135&((G=858993459&((G=G>>>V&1431655765)|G>>>1))|G>>>2))|G>>>4))|G>>>16))<<16>>16},V.interleave3=function(G,V,W){return G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2),(G|=(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},V.deinterleave3=function(G,V){return(G=1023&((G=4278190335&((G=251719695&((G=3272356035&((G=G>>>V&1227133513)|G>>>2))|G>>>4))|G>>>8))|G>>>16))<<22>>22},V.nextCombination=function(G){var V=G|G-1;return V+1|(~V&-~V)-1>>>W(G)+1}},13310:(G,V,W)=>{"use strict";G.exports=function(G,V,W){switch(arguments.length){case 1:return J=[],P(R=G,R,A,!0),J;case 2:return"function"===typeof V?P(G,G,V,!0):function(G,V){return J=[],P(G,V,A,!1),J}(G,V);case 3:return P(G,V,W,!1);default:throw new Error("box-intersect: Invalid arguments")}var R};var J,R=W(13314),d=W(13335),k=W(13346);function z(G,V){for(var W=0;W<G;++W)if(!(V[W]<=V[W+G]))return!0;return!1}function X(G,V,W,J){for(var R=0,d=0,k=0,X=G.length;k<X;++k){var P=G[k];if(!z(V,P)){for(var A=0;A<2*V;++A)W[R++]=P[A];J[d++]=k}}return d}function P(G,V,W,J){var z=G.length,P=V.length;if(!(z<=0||P<=0)){var A=G[0].length>>>1;if(!(A<=0)){var x,q=R.mallocDouble(2*A*z),L=R.mallocInt32(z);if((z=X(G,A,q,L))>0){if(1===A&&J)d.init(z),x=d.sweepComplete(A,W,0,z,q,L,0,z,q,L);else{var t=R.mallocDouble(2*A*P),Y=R.mallocInt32(P);(P=X(V,A,t,Y))>0&&(d.init(z+P),x=1===A?d.sweepBipartite(A,W,0,z,q,L,0,P,t,Y):k(A,W,J,z,q,L,P,t,Y),R.free(t),R.free(Y))}R.free(q),R.free(L)}return x}}}function A(G,V){J.push([G,V])}},13353:(G,V)=>{"use strict";var W="d",J="ax",R="fp",d="es",k="rs",z="re",X="rb",P="bs",A="be",x="bb",q=[W,J,"vv",k,z,X,"ri",P,A,x,"bi"];function L(G){var V="bruteForce"+(G?"Full":"Partial"),J=[],k=q.slice();G||k.splice(3,0,R);var z=["function "+V+"("+k.join()+"){"];function X(V,R){var k=function(G,V,J){var R="bruteForce"+(G?"Red":"Blue")+(V?"Flip":"")+(J?"Full":""),k=["function ",R,"(",q.join(),"){","var ",d,"=2*",W,";"],z="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",X="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(J?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return G?k.push(z,"Q",":",X):k.push(X,"Q",":",z),J?k.push("if(y1<x0||x1<y0)continue;"):V?k.push("if(y0<=x0||x1<y0)continue;"):k.push("if(y0<x0||x1<y0)continue;"),k.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),V?k.push("yi,xi"):k.push("xi,yi"),k.push(");if(rv!==void 0)return rv;}}}"),{name:R,code:k.join("")}}(V,R,G);J.push(k.code),z.push("return "+k.name+"("+q.join()+");")}z.push("if(re-rs>be-bs){"),G?(X(!0,!1),z.push("}else{"),X(!1,!1)):(z.push("if(fp){"),X(!0,!0),z.push("}else{"),X(!0,!1),z.push("}}else{if(fp){"),X(!1,!0),z.push("}else{"),X(!1,!1),z.push("}")),z.push("}}return "+V);var P=J.join("")+z.join("");return new Function(P)()}V.partial=L(!1),V.full=L(!0)},13346:(G,V,W)=>{"use strict";G.exports=function(G,V,W,d,A,i,e,F,f){!function(G,V){var W=8*R.log2(V+1)*(G+1)|0,d=R.nextPow2(b*W);y.length<d&&(J.free(y),y=J.mallocInt32(d));var k=R.nextPow2(r*W);u.length<k&&(J.free(u),u=J.mallocDouble(k))}(G,d+e);var v,C=0,l=2*G;H(C++,0,0,d,0,e,W?16:0,-1/0,1/0),W||H(C++,0,0,e,0,d,1,-1/0,1/0);for(;C>0;){var m=(C-=1)*b,w=y[m],N=y[m+1],U=y[m+2],a=y[m+3],M=y[m+4],T=y[m+5],K=C*r,s=u[K],Q=u[K+1],Z=1&T,E=!!(16&T),h=A,o=i,c=F,j=f;if(Z&&(h=F,o=f,c=A,j=i),!(2&T&&N>=(U=g(G,w,N,U,h,o,Q)))&&!(4&T&&(N=B(G,w,N,U,h,o,s))>=U)){var I=U-N,O=M-a;if(E){if(G*I*(I+O)<L){if(void 0!==(v=X.scanComplete(G,w,V,N,U,h,o,a,M,c,j)))return v;continue}}else{if(G*Math.min(I,O)<x){if(void 0!==(v=k(G,w,V,Z,N,U,h,o,a,M,c,j)))return v;continue}if(G*I*O<q){if(void 0!==(v=X.scanBipartite(G,w,V,Z,N,U,h,o,a,M,c,j)))return v;continue}}var GG=t(G,w,N,U,h,o,s,Q);if(N<GG)if(G*(GG-N)<x){if(void 0!==(v=z(G,w+1,V,N,GG,h,o,a,M,c,j)))return v}else if(w===G-2){if(void 0!==(v=Z?X.sweepBipartite(G,V,a,M,c,j,N,GG,h,o):X.sweepBipartite(G,V,N,GG,h,o,a,M,c,j)))return v}else H(C++,w+1,N,GG,a,M,Z,-1/0,1/0),H(C++,w+1,a,M,N,GG,1^Z,-1/0,1/0);if(GG<U){var VG=P(G,w,a,M,c,j),WG=c[l*VG+w],JG=Y(G,w,VG,M,c,j,WG);if(JG<M&&H(C++,w,GG,U,JG,M,(4|Z)+(E?16:0),WG,Q),a<VG&&H(C++,w,GG,U,a,VG,(2|Z)+(E?16:0),s,WG),VG+1===JG){if(void 0!==(v=E?D(G,w,V,GG,U,h,o,VG,c,j[VG]):n(G,w,V,Z,GG,U,h,o,VG,c,j[VG])))return v}else if(VG<JG){var RG;if(E){if(GG<(RG=S(G,w,GG,U,h,o,WG))){var dG=Y(G,w,GG,RG,h,o,WG);if(w===G-2){if(GG<dG&&void 0!==(v=X.sweepComplete(G,V,GG,dG,h,o,VG,JG,c,j)))return v;if(dG<RG&&void 0!==(v=X.sweepBipartite(G,V,dG,RG,h,o,VG,JG,c,j)))return v}else GG<dG&&H(C++,w+1,GG,dG,VG,JG,16,-1/0,1/0),dG<RG&&(H(C++,w+1,dG,RG,VG,JG,0,-1/0,1/0),H(C++,w+1,VG,JG,dG,RG,1,-1/0,1/0))}}else GG<(RG=Z?p(G,w,GG,U,h,o,WG):S(G,w,GG,U,h,o,WG))&&(w===G-2?v=Z?X.sweepBipartite(G,V,VG,JG,c,j,GG,RG,h,o):X.sweepBipartite(G,V,GG,RG,h,o,VG,JG,c,j):(H(C++,w+1,GG,RG,VG,JG,Z,-1/0,1/0),H(C++,w+1,VG,JG,GG,RG,1^Z,-1/0,1/0)))}}}}};var J=W(13314),R=W(13320),d=W(13353),k=d.partial,z=d.full,X=W(13335),P=W(13355),A=W(13359),x=128,q=1<<22,L=1<<22,t=A("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Y=A("lo===p0",["p0"]),g=A("lo<p0",["p0"]),B=A("hi<=p0",["p0"]),S=A("lo<=p0&&p0<=hi",["p0"]),p=A("lo<p0&&p0<=hi",["p0"]),b=6,r=2,y=J.mallocInt32(1024),u=J.mallocDouble(1024);function H(G,V,W,J,R,d,k,z,X){var P=b*G;y[P]=V,y[P+1]=W,y[P+2]=J,y[P+3]=R,y[P+4]=d,y[P+5]=k;var A=r*G;u[A]=z,u[A+1]=X}function n(G,V,W,J,R,d,k,z,X,P,A){var x=2*G,q=X*x,L=P[q+V];G:for(var t=R,Y=R*x;t<d;++t,Y+=x){var g=k[Y+V],B=k[Y+V+G];if(!(L<g||B<L)&&(!J||L!==g)){for(var S,p=z[t],b=V+1;b<G;++b){g=k[Y+b],B=k[Y+b+G];var r=P[q+b],y=P[q+b+G];if(B<r||y<g)continue G}if(void 0!==(S=J?W(A,p):W(p,A)))return S}}}function D(G,V,W,J,R,d,k,z,X,P){var A=2*G,x=z*A,q=X[x+V];G:for(var L=J,t=J*A;L<R;++L,t+=A){var Y=k[L];if(Y!==P){var g=d[t+V],B=d[t+V+G];if(!(q<g||B<q)){for(var S=V+1;S<G;++S){g=d[t+S],B=d[t+S+G];var p=X[x+S],b=X[x+S+G];if(B<p||b<g)continue G}var r=W(Y,P);if(void 0!==r)return r}}}}},13355:(G,V,W)=>{"use strict";G.exports=function(G,V,W,k,z,X){if(k<=W+1)return W;var P=W,A=k,x=k+W>>>1,q=2*G,L=x,t=z[q*x+V];for(;P<A;){if(A-P<R){d(G,V,P,A,z,X),t=z[q*x+V];break}var Y=A-P,g=Math.random()*Y+P|0,B=z[q*g+V],S=Math.random()*Y+P|0,p=z[q*S+V],b=Math.random()*Y+P|0,r=z[q*b+V];B<=p?r>=p?(L=S,t=p):B>=r?(L=g,t=B):(L=b,t=r):p>=r?(L=S,t=p):r>=B?(L=g,t=B):(L=b,t=r);for(var y=q*(A-1),u=q*L,H=0;H<q;++H,++y,++u){var n=z[y];z[y]=z[u],z[u]=n}var D=X[A-1];X[A-1]=X[L],X[L]=D;for(y=q*(A-1),u=q*(L=J(G,V,P,A-1,z,X,t)),H=0;H<q;++H,++y,++u){n=z[y];z[y]=z[u],z[u]=n}D=X[A-1];if(X[A-1]=X[L],X[L]=D,x<L){for(A=L-1;P<A&&z[q*(A-1)+V]===t;)A-=1;A+=1}else{if(!(L<x))break;for(P=L+1;P<A&&z[q*P+V]===t;)P+=1}}return J(G,V,W,x,z,X,z[q*x+V])};var J=W(13359)("lo<p0",["p0"]),R=8;function d(G,V,W,J,R,d){for(var k=2*G,z=k*(W+1)+V,X=W+1;X<J;++X,z+=k)for(var P=R[z],A=X,x=k*(X-1);A>W&&R[x+V]>P;--A,x-=k){for(var q=x,L=x+k,t=0;t<k;++t,++q,++L){var Y=R[q];R[q]=R[L],R[L]=Y}var g=d[A];d[A]=d[A-1],d[A-1]=g}}},13359:G=>{"use strict";G.exports=function(G,W){var J="abcdef".split("").concat(W),R=[];G.indexOf("lo")>=0&&R.push("lo=e[k+n]");G.indexOf("hi")>=0&&R.push("hi=e[k+o]");return J.push(V.replace("_",R.join()).replace("$",G)),Function.apply(void 0,J)};var V="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13337:G=>{"use strict";G.exports=function(G,J){J<=4*V?W(0,J-1,G):P(0,J-1,G)};var V=32;function W(G,V,W){for(var J=2*(G+1),R=G+1;R<=V;++R){for(var d=W[J++],k=W[J++],z=R,X=J-2;z-- >G;){var P=W[X-2],A=W[X-1];if(P<d)break;if(P===d&&A<k)break;W[X]=P,W[X+1]=A,X-=2}W[X]=d,W[X+1]=k}}function J(G,V,W){V*=2;var J=W[G*=2],R=W[G+1];W[G]=W[V],W[G+1]=W[V+1],W[V]=J,W[V+1]=R}function R(G,V,W){V*=2,W[G*=2]=W[V],W[G+1]=W[V+1]}function d(G,V,W,J){V*=2,W*=2;var R=J[G*=2],d=J[G+1];J[G]=J[V],J[G+1]=J[V+1],J[V]=J[W],J[V+1]=J[W+1],J[W]=R,J[W+1]=d}function k(G,V,W,J,R){V*=2,R[G*=2]=R[V],R[V]=W,R[G+1]=R[V+1],R[V+1]=J}function z(G,V,W){V*=2;var J=W[G*=2],R=W[V];return!(J<R)&&(J!==R||W[G+1]>W[V+1])}function X(G,V,W,J){var R=J[G*=2];return R<V||R===V&&J[G+1]<W}function P(G,A,x){var q=(A-G+1)/6|0,L=G+q,t=A-q,Y=G+A>>1,g=Y-q,B=Y+q,S=L,p=g,b=Y,r=B,y=t,u=G+1,H=A-1,n=0;z(S,p,x)&&(n=S,S=p,p=n),z(r,y,x)&&(n=r,r=y,y=n),z(S,b,x)&&(n=S,S=b,b=n),z(p,b,x)&&(n=p,p=b,b=n),z(S,r,x)&&(n=S,S=r,r=n),z(b,r,x)&&(n=b,b=r,r=n),z(p,y,x)&&(n=p,p=y,y=n),z(p,b,x)&&(n=p,p=b,b=n),z(r,y,x)&&(n=r,r=y,y=n);for(var D=x[2*p],i=x[2*p+1],e=x[2*r],F=x[2*r+1],f=2*S,v=2*b,C=2*y,l=2*L,m=2*Y,w=2*t,N=0;N<2;++N){var U=x[f+N],a=x[v+N],M=x[C+N];x[l+N]=U,x[m+N]=a,x[w+N]=M}R(g,G,x),R(B,A,x);for(var T=u;T<=H;++T)if(X(T,D,i,x))T!==u&&J(T,u,x),++u;else if(!X(T,e,F,x))for(;;){if(X(H,e,F,x)){X(H,D,i,x)?(d(T,u,H,x),++u,--H):(J(T,H,x),--H);break}if(--H<T)break}k(G,u-1,D,i,x),k(A,H+1,e,F,x),u-2-G<=V?W(G,u-2,x):P(G,u-2,x),A-(H+2)<=V?W(H+2,A,x):P(H+2,A,x),H-u<=V?W(u,H,x):P(u,H,x)}},13335:(G,V,W)=>{"use strict";G.exports={init:function(G){var V=R.nextPow2(G);X.length<V&&(J.free(X),X=J.mallocInt32(V));P.length<V&&(J.free(P),P=J.mallocInt32(V));A.length<V&&(J.free(A),A=J.mallocInt32(V));x.length<V&&(J.free(x),x=J.mallocInt32(V));q.length<V&&(J.free(q),q=J.mallocInt32(V));L.length<V&&(J.free(L),L=J.mallocInt32(V));var W=8*V;t.length<W&&(J.free(t),t=J.mallocDouble(W))},sweepBipartite:function(G,V,W,J,R,z,q,L,B,S){for(var p=0,b=2*G,r=G-1,y=b-1,u=W;u<J;++u){var H=z[u],n=b*u;t[p++]=R[n+r],t[p++]=-(H+1),t[p++]=R[n+y],t[p++]=H}for(u=q;u<L;++u){H=S[u]+k;var D=b*u;t[p++]=B[D+r],t[p++]=-H,t[p++]=B[D+y],t[p++]=H}var i=p>>>1;d(t,i);var e=0,F=0;for(u=0;u<i;++u){var f=0|t[2*u+1];if(f>=k)Y(A,x,F--,f=f-k|0);else if(f>=0)Y(X,P,e--,f);else if(f<=-k){f=-f-k|0;for(var v=0;v<e;++v){if(void 0!==(C=V(X[v],f)))return C}g(A,x,F++,f)}else{f=-f-1|0;for(v=0;v<F;++v){var C;if(void 0!==(C=V(f,A[v])))return C}g(X,P,e++,f)}}},sweepComplete:function(G,V,W,J,R,k,z,B,S,p){for(var b=0,r=2*G,y=G-1,u=r-1,H=W;H<J;++H){var n=k[H]+1<<1,D=r*H;t[b++]=R[D+y],t[b++]=-n,t[b++]=R[D+u],t[b++]=n}for(H=z;H<B;++H){n=p[H]+1<<1;var i=r*H;t[b++]=S[i+y],t[b++]=1|-n,t[b++]=S[i+u],t[b++]=1|n}var e=b>>>1;d(t,e);var F=0,f=0,v=0;for(H=0;H<e;++H){var C=0|t[2*H+1],l=1&C;if(H<e-1&&C>>1===t[2*H+3]>>1&&(l=2,H+=1),C<0){for(var m=-(C>>1)-1,w=0;w<v;++w){if(void 0!==(N=V(q[w],m)))return N}if(0!==l)for(w=0;w<F;++w){if(void 0!==(N=V(X[w],m)))return N}if(1!==l)for(w=0;w<f;++w){var N;if(void 0!==(N=V(A[w],m)))return N}0===l?g(X,P,F++,m):1===l?g(A,x,f++,m):2===l&&g(q,L,v++,m)}else{m=(C>>1)-1;0===l?Y(X,P,F--,m):1===l?Y(A,x,f--,m):2===l&&Y(q,L,v--,m)}}},scanBipartite:function(G,V,W,J,R,z,A,x,q,L,B,S){var p=0,b=2*G,r=V,y=V+G,u=1,H=1;J?H=k:u=k;for(var n=R;n<z;++n){var D=n+u,i=b*n;t[p++]=A[i+r],t[p++]=-D,t[p++]=A[i+y],t[p++]=D}for(n=q;n<L;++n){D=n+H;var e=b*n;t[p++]=B[e+r],t[p++]=-D}var F=p>>>1;d(t,F);var f=0;for(n=0;n<F;++n){var v=0|t[2*n+1];if(v<0){var C=!1;if((D=-v)>=k?(C=!J,D-=k):(C=!!J,D-=1),C)g(X,P,f++,D);else{var l=S[D],m=b*D,w=B[m+V+1],N=B[m+V+1+G];G:for(var U=0;U<f;++U){var a=X[U],M=b*a;if(!(N<A[M+V+1]||A[M+V+1+G]<w)){for(var T=V+2;T<G;++T)if(B[m+T+G]<A[M+T]||A[M+T+G]<B[m+T])continue G;var K,s=x[a];if(void 0!==(K=J?W(l,s):W(s,l)))return K}}}}else Y(X,P,f--,v-u)}},scanComplete:function(G,V,W,J,R,z,P,A,x,q,L){for(var Y=0,g=2*G,B=V,S=V+G,p=J;p<R;++p){var b=p+k,r=g*p;t[Y++]=z[r+B],t[Y++]=-b,t[Y++]=z[r+S],t[Y++]=b}for(p=A;p<x;++p){b=p+1;var y=g*p;t[Y++]=q[y+B],t[Y++]=-b}var u=Y>>>1;d(t,u);var H=0;for(p=0;p<u;++p){var n=0|t[2*p+1];if(n<0){if((b=-n)>=k)X[H++]=b-k;else{var D=L[b-=1],i=g*b,e=q[i+V+1],F=q[i+V+1+G];G:for(var f=0;f<H;++f){var v=X[f],C=P[v];if(C===D)break;var l=g*v;if(!(F<z[l+V+1]||z[l+V+1+G]<e)){for(var m=V+2;m<G;++m)if(q[i+m+G]<z[l+m]||z[l+m+G]<q[i+m])continue G;var w=W(C,D);if(void 0!==w)return w}}}}else{for(b=n-k,f=H-1;f>=0;--f)if(X[f]===b){for(m=f+1;m<H;++m)X[m-1]=X[m];break}--H}}}};var J=W(13314),R=W(13320),d=W(13337),k=1<<28,z=1024,X=J.mallocInt32(z),P=J.mallocInt32(z),A=J.mallocInt32(z),x=J.mallocInt32(z),q=J.mallocInt32(z),L=J.mallocInt32(z),t=J.mallocDouble(8192);function Y(G,V,W,J){var R=V[J],d=G[W-1];G[R]=d,V[d]=R}function g(G,V,W,J){G[W]=J,V[J]=W}},13323:G=>{"use strict";function V(G,W,J){var R=0|G[J];if(R<=0)return[];var d,k=new Array(R);if(J===G.length-1)for(d=0;d<R;++d)k[d]=W;else for(d=0;d<R;++d)k[d]=V(G,W,J+1);return k}G.exports=function(G,W){switch("undefined"===typeof W&&(W=0),typeof G){case"number":if(G>0)return function(G,V){var W,J;for(W=new Array(G),J=0;J<G;++J)W[J]=V;return W}(0|G,W);break;case"object":if("number"===typeof G.length)return V(G,W,0)}return[]}},13281:(G,V,W)=>{G.exports=function(){var G=this;this.components={},this.comps=this.components;var V=this.components,W=1,R={},d=[],k=[],z={timeout:!1,removals:[],multiComps:[]};function X(G,W){var J=V[W],d=R[W],k=d.hash[G];k&&(d.remove(G),J.Gd&&(J.multi?(k.forEach((V=>{V&&J.Gd(G,V)})),k.length=0):J.Gd(G,k)),z.removals.push(d),P())}function P(){z.timeout||(z.timeout=!0,setTimeout(A,1))}function A(){z.timeout=!1,x()}function x(){z.multiComps.length&&function(G){for(var V=0;V<G.length;V++){var{entID:W,data:J}=G[V],R=J.hash[W];if(R){for(var d=0;d<R.length;d++)R[d]||(R.splice(d,1),d--);0===R.length&&(J.remove(W),z.removals.push(J))}}G.length=0}(z.multiComps),z.removals.length&&function(G){for(var V=0;V<G.length;V++){G[V].flush()}G.length=0}(z.removals)}this.KA=R,this._systems=d,this._renderSystems=k,this.fP=function(V){var J=W++;return Array.isArray(V)&&V.forEach((V=>G.SX(J,V))),J},this.deleteEntity=function(V){return Object.keys(R).forEach((G=>{R[G].hash[V]&&X(V,G)})),G},this.hP=function(G){if(!G)throw new Error("Missing component definition");var W=G.name;if(!W)throw new Error("Component definition must have a name property.");if("string"!==typeof W)throw new Error("Component name must be a string.");if(""===W)throw new Error("Component name must be a non-empty string.");if(R[W])throw new Error(`Component ${W} already exists.`);var z={};return z.name=W,z.multi=!!G.multi,z.order=isNaN(G.order)?99:G.order,z.stateConstructor=G.stateConstructor||null,z.state=G.state||{},z.Sz=G.Sz||null,z.Gd=G.Gd||null,z.system=G.system||null,z.Fz=G.Fz||null,V[W]=z,R[W]=new J,R[W]._pendingMultiCleanup=!1,R[W]._multiCleanupIDs=z.multi?[]:null,z.system&&(d.push(W),d.sort(((G,W)=>V[G].order-V[W].order))),z.Fz&&(k.push(W),k.sort(((G,W)=>V[G].order-V[W].order))),W},this.overwriteComponent=function(G,W){var J=V[G];if(!J)throw new Error(`Unknown component: ${G}`);if(!W)throw new Error("Missing component definition");if(J.name!==W.name)throw new Error("Overwriting component must use the same name property.");var z={};z.name=G,z.multi=!!W.multi,z.order=isNaN(W.order)?99:W.order,z.state=W.state||{},z.Sz=W.Sz||null,z.Gd=W.Gd||null,z.system=W.system||null,z.Fz=W.Fz||null,V[G]=z,R[G]._pendingMultiCleanup=!1,R[G]._multiCleanupIDs=z.multi?[]:null;var X=d.indexOf(G);z.system&&X<0&&d.push(G),!z.system&&X>=0&&d.splice(X,1),d.sort(((G,W)=>V[G].order-V[W].order));var P=k.indexOf(G);z.Fz&&P<0&&k.push(G),!z.Fz&&P>=0&&k.splice(P,1),k.sort(((G,W)=>V[G].order-V[W].order));var A=z.state;return this.tP(G).forEach((G=>{for(var V in A)V in G||(G[V]=A[V]);z.Sz&&z.Sz(G.iz,G)})),G},this.deleteComponent=function(W){var J=R[W];if(!J)throw new Error(`Unknown component: ${W}`);J.flush(),J.list.forEach((G=>{G&&X(G.iz||G[0].iz,W)}));var z=d.indexOf(W),P=k.indexOf(W);return z>-1&&d.splice(z,1),P>-1&&k.splice(P,1),R[W].dispose(),delete R[W],delete V[W],G},this.SX=function(G,W,J){var d,k=V[W],z=R[W];if(!z)throw new Error(`Unknown component: ${W}.`);if(z.hash[G]&&!k.multi)throw new Error(`Entity ${G} already has component: ${W}.`);if(k.stateConstructor){if(!(d=new k.stateConstructor).hasOwnProperty("iz"))throw new Error(`Component ${k.name} stateConstructor type does not have property __id`)}else d=Object.assign({},{iz:G},k.state,J);if(d.iz=G,k.multi){var X=z.hash[G];X||(X=[],z.add(G,X)),X.push(d)}else z.add(G,d);return k.Sz&&k.Sz(G,d),this},this.iX=function(G,V){var W=R[V];if(!W)throw new Error(`Unknown component: ${V}.`);return!!W.hash[G]},this.yX=function(V,W){if(!R[W])throw new Error(`Unknown component: ${W}.`);return X(V,W),G},this.getState=function(G,V){var W=R[V];if(!W)throw new Error(`Unknown component: ${V}.`);return W.hash[G]},this.tP=function(G){var V=R[G];if(!V)throw new Error(`Unknown component: ${G}.`);return x(),V.list},this.Kq=function(G){if(!R[G])throw new Error(`Unknown component: ${G}.`);var V=R[G].hash;return G=>V[G]},this.Zq=function(G){if(!R[G])throw new Error(`Unknown component: ${G}.`);var V=R[G].hash;return G=>!!V[G]},this.zz=function(W){x();for(var J=0;J<d.length;J++){var k=d[J],z=V[k],X=R[k];z.system(W,X.list),x()}return G},this.render=function(W){x();for(var J=0;J<k.length;J++){var d=k[J],z=V[d],X=R[d];z.Fz(W,X.list),x()}return G},this.removeMultiComponent=function(W,J,d){var k=V[J],X=R[J];if(!X)throw new Error(`Unknown component: ${J}.`);if(!k.multi)throw new Error("removeMultiComponent called on non-multi component");return function(G,V,W,J){var R=W.hash[G];if(R){var d=R[J];d&&(R[J]=null,V.Gd&&V.Gd(G,d),z.multiComps.push({entID:G,data:W}),P())}}(W,k,X,d),G}};var J=W(13290)},13290:G=>{function V(G,V){var W=G._map[V];if(delete G.hash[V],delete G._map[V],W===G.list.length-1)G.list.pop();else{var J=G.list.pop();if(G.list[W]=J,null===J||null===J[0]){var R=G.list.length;for(var d in G._map)if(G._map[d]===R)return void(G._map[d]=W)}else{var k=J.iz||J[0].iz;G._map[k]=W}}}G.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(G,V){if("number"===typeof this._map[G]){var W=this._map[G];this.hash[G]=V,this.list[W]=V}else this._map[G]=this.list.length,this.hash[G]=V,this.list.push(V)}remove(G){var V=this._map[G];this.hash[G]=null,this.list[V]=null,this._pendingRemovals.push(G)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var G=0;G<this._pendingRemovals.length;G++){var W=this._pendingRemovals[G];null===this.hash[W]&&V(this,W)}this._pendingRemovals.length=0}}},13249:G=>{"use strict";var V,W="object"===typeof Reflect?Reflect:null,J=function(G,V,W){return Function.prototype.apply.call(G,V,W)};V=W&&"function"===typeof W.ownKeys?W.ownKeys:Object.getOwnPropertySymbols?function(G){return Object.getOwnPropertyNames(G).concat(Object.getOwnPropertySymbols(G))}:function(G){return Object.getOwnPropertyNames(G)};var R=Number.isNaN||function(G){return G!==G};function d(){d.init.call(this)}G.exports=d,G.exports.once=function(G,V){return new Promise((function(W,J){function R(W){G.removeListener(V,d),J(W)}function d(){"function"===typeof G.removeListener&&G.removeListener("error",R),W([].slice.call(arguments))}Y(G,V,d,{once:!0}),"error"!==V&&function(G,V,W){"function"===typeof G.on&&Y(G,"error",V,W)}(G,R,{once:!0})}))},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var k=10;function z(G){if("function"!==typeof G)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof G)}function X(G){return void 0===G._maxListeners?d.defaultMaxListeners:G._maxListeners}function P(G,V,W,J){var R,d,k,P;if(z(W),void 0===(d=G._events)?(d=G._events=Object.create(null),G._eventsCount=0):(void 0!==d.newListener&&(G.emit("newListener",V,W.listener?W.listener:W),d=G._events),k=d[V]),void 0===k)k=d[V]=W,++G._eventsCount;else if("function"===typeof k?k=d[V]=J?[W,k]:[k,W]:J?k.unshift(W):k.push(W),(R=X(G))>0&&k.length>R&&!k.warned){k.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(V)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.j=G,A.type=V,A.count=k.length,P=A,console&&console.warn&&console.warn(P)}return G}function A(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(G,V,W){var J={fired:!1,wrapFn:void 0,target:G,type:V,listener:W},R=A.bind(J);return R.listener=W,J.wrapFn=R,R}function q(G,V,W){var J=G._events;if(void 0===J)return[];var R=J[V];return void 0===R?[]:"function"===typeof R?W?[R.listener||R]:[R]:W?function(G){for(var V=new Array(G.length),W=0;W<V.length;++W)V[W]=G[W].listener||G[W];return V}(R):t(R,R.length)}function L(G){var V=this._events;if(void 0!==V){var W=V[G];if("function"===typeof W)return 1;if(void 0!==W)return W.length}return 0}function t(G,V){for(var W=new Array(V),J=0;J<V;++J)W[J]=G[J];return W}function Y(G,V,W,J){if("function"===typeof G.on)J.once?G.once(V,W):G.on(V,W);else{if("function"!==typeof G.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof G);G.addEventListener(V,(function R(d){J.once&&G.removeEventListener(V,R),W(d)}))}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return k},set:function(G){if("number"!==typeof G||G<0||R(G))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+G+".");k=G}}),d.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(G){if("number"!==typeof G||G<0||R(G))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+G+".");return this._maxListeners=G,this},d.prototype.getMaxListeners=function(){return X(this)},d.prototype.emit=function(G){for(var V=[],W=1;W<arguments.length;W++)V.push(arguments[W]);var R="error"===G,d=this._events;if(void 0!==d)R=R&&void 0===d.error;else if(!R)return!1;if(R){var k;if(V.length>0&&(k=V[0]),k instanceof Error)throw k;var z=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw z.context=k,z}var X=d[G];if(void 0===X)return!1;if("function"===typeof X)J(X,this,V);else{var P=X.length,A=t(X,P);for(W=0;W<P;++W)J(A[W],this,V)}return!0},d.prototype.addListener=function(G,V){return P(this,G,V,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(G,V){return P(this,G,V,!0)},d.prototype.once=function(G,V){return z(V),this.on(G,x(this,G,V)),this},d.prototype.prependOnceListener=function(G,V){return z(V),this.prependListener(G,x(this,G,V)),this},d.prototype.removeListener=function(G,V){var W,J,R,d,k;if(z(V),void 0===(J=this._events))return this;if(void 0===(W=J[G]))return this;if(W===V||W.listener===V)0===--this._eventsCount?this._events=Object.create(null):(delete J[G],J.removeListener&&this.emit("removeListener",G,W.listener||V));else if("function"!==typeof W){for(R=-1,d=W.length-1;d>=0;d--)if(W[d]===V||W[d].listener===V){k=W[d].listener,R=d;break}if(R<0)return this;0===R?W.shift():function(G,V){for(;V+1<G.length;V++)G[V]=G[V+1];G.pop()}(W,R),1===W.length&&(J[G]=W[0]),void 0!==J.removeListener&&this.emit("removeListener",G,k||V)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(G){var V,W,J;if(void 0===(W=this._events))return this;if(void 0===W.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==W[G]&&(0===--this._eventsCount?this._events=Object.create(null):delete W[G]),this;if(0===arguments.length){var R,d=Object.keys(W);for(J=0;J<d.length;++J)"removeListener"!==(R=d[J])&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(V=W[G]))this.removeListener(G,V);else if(void 0!==V)for(J=V.length-1;J>=0;J--)this.removeListener(G,V[J]);return this},d.prototype.listeners=function(G){return q(this,G,!0)},d.prototype.rawListeners=function(G){return q(this,G,!1)},d.listenerCount=function(G,V){return"function"===typeof G.listenerCount?G.listenerCount(V):L.call(G,V)},d.prototype.listenerCount=L,d.prototype.eventNames=function(){return this._eventsCount>0?V(this._events):[]}},13549:G=>{"use strict";G.exports=function(G,V,W,J,R,d){var k=+V[0],z=+V[1],X=+V[2],P=+W[0],A=+W[1],x=+W[2],q=Math.sqrt(P*P+A*A+x*x);if(0===q)throw new Error("Can't raycast along a zero vector");return function(G,V,W,J,R,d,k,z,X,P){for(var A=0,x=Math.floor,q=0|x(V),L=0|x(W),t=0|x(J),Y=R>0?1:-1,g=d>0?1:-1,B=k>0?1:-1,S=Math.abs(1/R),p=Math.abs(1/d),b=Math.abs(1/k),r=S<1/0?S*(Y>0?q+1-V:V-q):1/0,y=p<1/0?p*(g>0?L+1-W:W-L):1/0,u=b<1/0?b*(B>0?t+1-J:J-t):1/0,H=-1;A<=z;){var n=G(q,L,t);if(n)return X&&(X[0]=V+A*R,X[1]=W+A*d,X[2]=J+A*k),P&&(P[0]=P[1]=P[2]=0,0===H&&(P[0]=-Y),1===H&&(P[1]=-g),2===H&&(P[2]=-B)),n;r<y?r<u?(q+=Y,A=r,r+=S,H=0):(t+=B,A=u,u+=b,H=2):y<u?(L+=g,A=y,y+=p,H=1):(t+=B,A=u,u+=b,H=2)}return X&&(X[0]=V+A*R,X[1]=W+A*d,X[2]=J+A*k),P&&(P[0]=P[1]=P[2]=0),0}(G,k,z,X,P/=q,A/=q,x/=q,J="undefined"===typeof J?64:+J,R,d)}},13584:(G,V,W)=>{"use strict";W.d(V,{e:()=>d});var J=W(13249);function R(){this.Tx=!1,this.stopPropagation=!1,this.Kx=!1,this.disabled=!1}class d{constructor(G,V){this.version="0.7.0";var W=Object.assign({},new R,V||{});this.element=G||document,this.Tx=!!W.Tx,this.stopPropagation=!!W.stopPropagation,this.Kx=!!W.Kx,this.disabled=!!W.disabled,this.filterEvents=(G,V)=>!0,this.down=new J.EventEmitter,this.up=new J.EventEmitter,this.state={},this.XP={dx:0,dy:0,Cq:0,zP:0,lq:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?z(this):document.addEventListener("DOMContentLoaded",(G=>{z(this)}),{once:!0})}bind(G){for(var V=arguments.length,W=new Array(V>1?V-1:0),J=1;J<V;J++)W[J-1]=arguments[J];W.forEach((V=>{var W=this._keyBindmap[V]||[];W.includes(G)||(W.push(G),this._keyBindmap[V]=W)})),this.state[G]=!!this.state[G],this.pressCount[G]=this.pressCount[G]||0,this.releaseCount[G]=this.releaseCount[G]||0}unbind(G){for(var V in this._keyBindmap){var W=this._keyBindmap[V],J=W.indexOf(G);J>-1&&W.splice(J,1)}}getBindings(){var G={};for(var V in this._keyBindmap){this._keyBindmap[V].forEach((W=>{G[W]=G[W]||[],G[W].push(V)}))}return G}zz(){k(this.XP),k(this.pressCount),k(this.releaseCount)}}function k(G){for(var V in G)G[V]=0}function z(G){window.addEventListener("keydown",t.bind(null,G,!0),!1),window.addEventListener("keyup",t.bind(null,G,!1),!1);var V={passive:!0};G.element.addEventListener("touchstart",x.bind(void 0,G),{passive:!1}),G.element.addEventListener("touchend",L.bind(void 0,G),V),G.element.addEventListener("mousedown",Y.bind(null,G,!0),V),window.document.addEventListener("mouseup",Y.bind(null,G,!1),V),G.element.addEventListener("touchmove",g.bind(null,G),V),G.element.addEventListener("mousemove",g.bind(null,G),V),window.PointerEvent,G.element.addEventListener("wheel",B.bind(null,G),V),G.element.addEventListener("contextmenu",S.bind(null,G),!1),window.addEventListener("blur",p.bind(null,G),!1)}var X=0,P=0,A=null;function x(G,V){V.preventDefault(),q(V)}function q(G){let V=!1;for(let W=0;W<G.touches.length;++W)if(G.touches[W].identifier===A){V=!0;break}if(!V){const V=G.changedTouches[0];X=V.clientX,P=V.clientY,A=V.identifier}}function L(G,V){for(var W=V.changedTouches,J=0;J<W.length;++J)W[J].identifier===A&&(A=null)}function t(G,V,W){b(W.code,V,G,W)}function Y(G,V,W){if("pointerId"in W)if(V){if(null!==G._touches.currID)return;G._touches.currID=W.pointerId}else{if(G._touches.currID!==W.pointerId)return;G._touches.currID=null}return b("Mouse"+("button"in W?W.button+1:1),V,G,W),!1}function g(G,V){var W=V.movementX||V.mozMovementX||0,J=V.movementY||V.mozMovementY||0;if(V.touches&&0===(W|J)){var R=function(G){q(G);for(let V=0;V<G.changedTouches.length;++V)if(G.changedTouches[V].identifier==A){const W=G.changedTouches[V],J=[W.clientX-X,W.clientY-P];return X=W.clientX,P=W.clientY,J}return console.error(`Did not find touch id ${A}`),[0,0]}(V);W=R[0],J=R[1]}G.XP.dx+=W,G.XP.dy+=J}function B(G,V){var W=1;switch(V.deltaMode){case 0:W=1;break;case 1:W=12;break;case 2:W=G.element.clientHeight||window.innerHeight}G.XP.Cq+=(V.deltaX||0)*W,G.XP.zP+=(V.deltaY||0)*W,G.XP.lq+=(V.deltaZ||0)*W}function S(G,V){if(!G.Kx)return V.preventDefault(),!1}function p(G){for(var V in G._keyStates)G._keyStates[V]&&(/^Mouse\d/.test(V)||b(V,!1,G,{code:V,note:"q1fzqqowt4i",preventDefault:()=>{},stopPropagation:()=>{}}))}function b(G,V,W,J){var R=W._keyBindmap[G];R&&(r(W._keyStates[G],V)&&(W._keyStates[G]=V,R.forEach((G=>{(!W.filterEvents||W.filterEvents(J,G))&&function(G,V,W,J){var R=V?W.pressCount:W.releaseCount;R[G]=(R[G]||0)+1;var d=W._bindPressCount[G]||0;(d+=V?1:-1)<0&&(d=0);W._bindPressCount[G]=d;var k=W.state[G];if(r(k,d)){W.state[G]=d>0;var z=V?W.down:W.up;W.disabled||z.emit(G,J)}}(G,V,W,J)}))),"button"in J||(W.Tx&&!J.defaultPrevented&&J.preventDefault(),W.stopPropagation&&J.stopPropagation()))}function r(G,V){return G?!V:V}},12213:G=>{G.exports=function(G,V,W){return G[0]=V[0]+W[0],G[1]=V[1]+W[1],G[2]=V[2]+W[2],G}},12173:(G,V,W)=>{G.exports=function(G,V){var W=J(G[0],G[1],G[2]),k=J(V[0],V[1],V[2]);R(W,W),R(k,k);var z=d(W,k);return z>1?0:Math.acos(z)};var J=W(12178),R=W(12181),d=W(12183)},12272:G=>{G.exports=function(G,V){return G[0]=Math.ceil(V[0]),G[1]=Math.ceil(V[1]),G[2]=Math.ceil(V[2]),G}},12170:G=>{G.exports=function(G){var V=new Float32Array(3);return V[0]=G[0],V[1]=G[1],V[2]=G[2],V}},12190:G=>{G.exports=function(G,V){return G[0]=V[0],G[1]=V[1],G[2]=V[2],G}},12161:G=>{G.exports=function(){var G=new Float32Array(3);return G[0]=0,G[1]=0,G[2]=0,G}},12342:G=>{G.exports=function(G,V,W){var J=V[0],R=V[1],d=V[2],k=W[0],z=W[1],X=W[2];return G[0]=R*X-d*z,G[1]=d*k-J*X,G[2]=J*z-R*k,G}},12293:(G,V,W)=>{G.exports=W(12291)},12291:G=>{G.exports=function(G,V){var W=V[0]-G[0],J=V[1]-G[1],R=V[2]-G[2];return Math.sqrt(W*W+J*J+R*R)}},12248:(G,V,W)=>{G.exports=W(12245)},12245:G=>{G.exports=function(G,V,W){return G[0]=V[0]/W[0],G[1]=V[1]/W[1],G[2]=V[2]/W[2],G}},12183:G=>{G.exports=function(G,V){return G[0]*V[0]+G[1]*V[1]+G[2]*V[2]}},12155:G=>{G.exports=1e-6},12204:(G,V,W)=>{G.exports=function(G,V){var W=G[0],R=G[1],d=G[2],k=V[0],z=V[1],X=V[2];return Math.abs(W-k)<=J*Math.max(1,Math.abs(W),Math.abs(k))&&Math.abs(R-z)<=J*Math.max(1,Math.abs(R),Math.abs(z))&&Math.abs(d-X)<=J*Math.max(1,Math.abs(d),Math.abs(X))};var J=W(12155)},12211:G=>{G.exports=function(G,V){return G[0]===V[0]&&G[1]===V[1]&&G[2]===V[2]}},12267:G=>{G.exports=function(G,V){return G[0]=Math.floor(V[0]),G[1]=Math.floor(V[1]),G[2]=Math.floor(V[2]),G}},12403:(G,V,W)=>{G.exports=function(G,V,W,R,d,k){var z,X;V||(V=3);W||(W=0);X=R?Math.min(R*V+W,G.length):G.length;for(z=W;z<X;z+=V)J[0]=G[z],J[1]=G[z+1],J[2]=G[z+2],d(J,J,k),G[z]=J[0],G[z+1]=J[1],G[z+2]=J[2];return G};var J=W(12161)()},12178:G=>{G.exports=function(G,V,W){var J=new Float32Array(3);return J[0]=G,J[1]=V,J[2]=W,J}},12153:(G,V,W)=>{G.exports={EPSILON:W(12155),create:W(12161),clone:W(12170),angle:W(12173),Ok:W(12178),i:W(12190),set:W(12196),equals:W(12204),exactEquals:W(12211),add:W(12213),zW:W(12222),sub:W(12224),multiply:W(12232),mul:W(12237),divide:W(12245),div:W(12248),min:W(12251),max:W(12259),floor:W(12267),ceil:W(12272),round:W(12279),scale:W(12285),Gz:W(12287),distance:W(12291),k:W(12293),squaredDistance:W(12295),sqrDist:W(12304),length:W(12307),len:W(12316),squaredLength:W(12321),Vz:W(12328),negate:W(12331),inverse:W(12334),normalize:W(12181),dot:W(12183),cross:W(12342),hk:W(12351),random:W(12356),transformMat4:W(12365),transformMat3:W(12373),transformQuat:W(12382),Wz:W(12391),Jz:W(12393),Rz:W(12397),forEach:W(12403)}},12334:G=>{G.exports=function(G,V){return G[0]=1/V[0],G[1]=1/V[1],G[2]=1/V[2],G}},12316:(G,V,W)=>{G.exports=W(12307)},12307:G=>{G.exports=function(G){var V=G[0],W=G[1],J=G[2];return Math.sqrt(V*V+W*W+J*J)}},12351:G=>{G.exports=function(G,V,W,J){var R=V[0],d=V[1],k=V[2];return G[0]=R+J*(W[0]-R),G[1]=d+J*(W[1]-d),G[2]=k+J*(W[2]-k),G}},12259:G=>{G.exports=function(G,V,W){return G[0]=Math.max(V[0],W[0]),G[1]=Math.max(V[1],W[1]),G[2]=Math.max(V[2],W[2]),G}},12251:G=>{G.exports=function(G,V,W){return G[0]=Math.min(V[0],W[0]),G[1]=Math.min(V[1],W[1]),G[2]=Math.min(V[2],W[2]),G}},12237:(G,V,W)=>{G.exports=W(12232)},12232:G=>{G.exports=function(G,V,W){return G[0]=V[0]*W[0],G[1]=V[1]*W[1],G[2]=V[2]*W[2],G}},12331:G=>{G.exports=function(G,V){return G[0]=-V[0],G[1]=-V[1],G[2]=-V[2],G}},12181:G=>{G.exports=function(G,V){var W=V[0],J=V[1],R=V[2],d=W*W+J*J+R*R;d>0&&(d=1/Math.sqrt(d),G[0]=V[0]*d,G[1]=V[1]*d,G[2]=V[2]*d);return G}},12356:G=>{G.exports=function(G,V){V=V||1;var W=2*Math.random()*Math.PI,J=2*Math.random()-1,R=Math.sqrt(1-J*J)*V;return G[0]=Math.cos(W)*R,G[1]=Math.sin(W)*R,G[2]=J*V,G}},12391:G=>{G.exports=function(G,V,W,J){var R=W[1],d=W[2],k=V[1]-R,z=V[2]-d,X=Math.sin(J),P=Math.cos(J);return G[0]=V[0],G[1]=R+k*P-z*X,G[2]=d+k*X+z*P,G}},12393:G=>{G.exports=function(G,V,W,J){var R=W[0],d=W[2],k=V[0]-R,z=V[2]-d,X=Math.sin(J),P=Math.cos(J);return G[0]=R+z*X+k*P,G[1]=V[1],G[2]=d+z*P-k*X,G}},12397:G=>{G.exports=function(G,V,W,J){var R=W[0],d=W[1],k=V[0]-R,z=V[1]-d,X=Math.sin(J),P=Math.cos(J);return G[0]=R+k*P-z*X,G[1]=d+k*X+z*P,G[2]=V[2],G}},12279:G=>{G.exports=function(G,V){return G[0]=Math.round(V[0]),G[1]=Math.round(V[1]),G[2]=Math.round(V[2]),G}},12285:G=>{G.exports=function(G,V,W){return G[0]=V[0]*W,G[1]=V[1]*W,G[2]=V[2]*W,G}},12287:G=>{G.exports=function(G,V,W,J){return G[0]=V[0]+W[0]*J,G[1]=V[1]+W[1]*J,G[2]=V[2]+W[2]*J,G}},12196:G=>{G.exports=function(G,V,W,J){return G[0]=V,G[1]=W,G[2]=J,G}},12304:(G,V,W)=>{G.exports=W(12295)},12328:(G,V,W)=>{G.exports=W(12321)},12295:G=>{G.exports=function(G,V){var W=V[0]-G[0],J=V[1]-G[1],R=V[2]-G[2];return W*W+J*J+R*R}},12321:G=>{G.exports=function(G){var V=G[0],W=G[1],J=G[2];return V*V+W*W+J*J}},12224:(G,V,W)=>{G.exports=W(12222)},12222:G=>{G.exports=function(G,V,W){return G[0]=V[0]-W[0],G[1]=V[1]-W[1],G[2]=V[2]-W[2],G}},12373:G=>{G.exports=function(G,V,W){var J=V[0],R=V[1],d=V[2];return G[0]=J*W[0]+R*W[3]+d*W[6],G[1]=J*W[1]+R*W[4]+d*W[7],G[2]=J*W[2]+R*W[5]+d*W[8],G}},12365:G=>{G.exports=function(G,V,W){var J=V[0],R=V[1],d=V[2],k=W[3]*J+W[7]*R+W[11]*d+W[15];return k=k||1,G[0]=(W[0]*J+W[4]*R+W[8]*d+W[12])/k,G[1]=(W[1]*J+W[5]*R+W[9]*d+W[13])/k,G[2]=(W[2]*J+W[6]*R+W[10]*d+W[14])/k,G}},12382:G=>{G.exports=function(G,V,W){var J=V[0],R=V[1],d=V[2],k=W[0],z=W[1],X=W[2],P=W[3],A=P*J+z*d-X*R,x=P*R+X*J-k*d,q=P*d+k*R-z*J,L=-k*J-z*R-X*d;return G[0]=A*P+L*-k+x*-X-q*-z,G[1]=x*P+L*-z+q*-k-A*-X,G[2]=q*P+L*-X+A*-z-x*-k,G}},13270:G=>{"use strict";G.exports=function(G){for(var V=new Array(G),W=0;W<G;++W)V[W]=W;return V}},13326:G=>{G.exports=function(G){return null!=G&&null!=G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}},13557:(G,V,W)=>{"use strict";W.d(V,{c:()=>J});class J{constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.tA=!1,this.YA=!1,this.qA=30,this.LA=0,this.uA=!1,this.fullscreen=!1,this.BA=function(G){},this.SA=function(){},this.rA=function(){},this.Vd=function(){},this.pA=function(G){},this.onFullscreenChanged=function(G){},P((()=>{!function(G,V){G._nowObject=performance||Date,G._lastTick=0,G._renderAccum=0,G._rt=0,G._frameCB=z.bind(null,G),requestAnimationFrame(G._frameCB),V>0&&(G._intervalCB=k.bind(null,G),G._interval=setInterval(G._intervalCB,Math.max(V,1e3/G.qA/2)))}(this,V),function(G,V){if(!V)return;var W=!1,J=!1;document.addEventListener("pointerlockchange",(J=>{W=document.pointerLockElement===V,G.pA(W)})),document.addEventListener("fullscreenchange",(W=>{J=document.fullscreenElement===V,G.onFullscreenChanged(J)})),Object.defineProperty(G,"uA",{get:()=>W,set:G=>{G&&!W?X(V):W&&!G&&function(G){G.exitPointerLock&&G.exitPointerLock()}(document)}}),Object.defineProperty(G,"fullscreen",{get:()=>J,set:G=>{G&&!J?V.requestFullscreen():J&&!G&&document.exitFullscreen()}}),V.addEventListener("click",(R=>{G.tA&&!W&&X(V),G.YA&&!J&&V.requestFullscreen()}));var R=()=>G.Vd();if(window.ResizeObserver){new ResizeObserver(R).observe(V)}else window.addEventListener("resize",R)}(this,G),this.rA()}))}}var R=3,d=20;function k(G){for(var V=1e3/G.qA,W=G._nowObject.now()+d,J=0;G._nowObject.now()>=G._lastTick+V&&G._nowObject.now()<W&&++J<=R;)G.BA(V),G._lastTick+=V;var k=5*(V+5),z=G._nowObject.now();if(z-G._lastTick>k)for(;z>=G._lastTick+V;)G._lastTick+=V}function z(G){requestAnimationFrame(G._frameCB),k(G);var V=G._nowObject.now(),W=V-G._rt;if(G._rt=V,G.LA>0){G._renderAccum+=W;var J=1e3/G.LA;if(G._renderAccum<J)return;G._renderAccum=Math.min(G._renderAccum-J,J)}var R=1e3/G.qA,d=(V-G._lastTick)/R;G.SA(W,d,R)}function X(G){G.requestPointerLock&&G.requestPointerLock()}var P=G=>{if("loading"===document.readyState){var V=()=>{document.removeEventListener("readystatechange",V),G()};document.addEventListener("readystatechange",V)}else setTimeout(G,1)}},13262:(G,V,W)=>{var J=W(13270),R=W(13273),d="undefined"!==typeof Float64Array;function k(G,V){return G[0]-V[0]}function z(){var G,V=this.stride,W=new Array(V.length);for(G=0;G<W.length;++G)W[G]=[Math.abs(V[G]),G];W.sort(k);var J=new Array(W.length);for(G=0;G<J.length;++G)J[G]=W[G][1];return J}function X(G,V){var W=["View",V,"d",G].join("");V<0&&(W="View_Nil"+G);var R="generic"===G;if(-1===V){var d="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+G+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(d)()}if(0===V){d="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+G+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(R?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(R?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",d)(P[G][0])}d=["'use strict'"];var k=J(V),X=k.map((function(G){return"i"+G})),A="this.offset+"+k.map((function(G){return"this.stride["+G+"]*i"+G})).join("+"),x=k.map((function(G){return"b"+G})).join(","),q=k.map((function(G){return"c"+G})).join(",");d.push("function "+W+"(a,"+x+","+q+",d){this.data=a","this.shape=["+x+"]","this.stride=["+q+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+G+"'","proto.dimension="+V),d.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+k.map((function(G){return"this.shape["+G+"]"})).join("*"),"}})"),1===V?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),V<4?(d.push("function "+W+"_order(){"),2===V?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===V&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+W+"_set("+X.join(",")+",v){"),R?d.push("return this.data.set("+A+",v)}"):d.push("return this.data["+A+"]=v}"),d.push("proto.get=function "+W+"_get("+X.join(",")+"){"),R?d.push("return this.data.get("+A+")}"):d.push("return this.data["+A+"]}"),d.push("proto.index=function "+W+"_index(",X.join(),"){return "+A+"}"),d.push("proto.hi=function "+W+"_hi("+X.join(",")+"){return new "+W+"(this.data,"+k.map((function(G){return["(typeof i",G,"!=='number'||i",G,"<0)?this.shape[",G,"]:i",G,"|0"].join("")})).join(",")+","+k.map((function(G){return"this.stride["+G+"]"})).join(",")+",this.offset)}");var L=k.map((function(G){return"a"+G+"=this.shape["+G+"]"})),t=k.map((function(G){return"c"+G+"=this.stride["+G+"]"}));d.push("proto.lo=function "+W+"_lo("+X.join(",")+"){var b=this.offset,d=0,"+L.join(",")+","+t.join(","));for(var Y=0;Y<V;++Y)d.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");d.push("return new "+W+"(this.data,"+k.map((function(G){return"a"+G})).join(",")+","+k.map((function(G){return"c"+G})).join(",")+",b)}"),d.push("proto.step=function "+W+"_step("+X.join(",")+"){var "+k.map((function(G){return"a"+G+"=this.shape["+G+"]"})).join(",")+","+k.map((function(G){return"b"+G+"=this.stride["+G+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<V;++Y)d.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");d.push("return new "+W+"(this.data,"+k.map((function(G){return"a"+G})).join(",")+","+k.map((function(G){return"b"+G})).join(",")+",c)}");var g=new Array(V),B=new Array(V);for(Y=0;Y<V;++Y)g[Y]="a[i"+Y+"]",B[Y]="b[i"+Y+"]";d.push("proto.transpose=function "+W+"_transpose("+X+"){"+X.map((function(G,V){return G+"=("+G+"===undefined?"+V+":"+G+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+g.join(",")+","+B.join(",")+",this.offset)}"),d.push("proto.pick=function "+W+"_pick("+X+"){var a=[],b=[],c=this.offset");for(Y=0;Y<V;++Y)d.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+k.map((function(G){return"shape["+G+"]"})).join(",")+","+k.map((function(G){return"stride["+G+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(P[G],z)}var P={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};G.exports=function(G,V,W,J){if(void 0===G)return(0,P.array[0])([]);"number"===typeof G&&(G=[G]),void 0===V&&(V=[G.length]);var k=V.length;if(void 0===W){W=new Array(k);for(var z=k-1,A=1;z>=0;--z)W[z]=A,A*=V[z]}if(void 0===J){J=0;for(z=0;z<k;++z)W[z]<0&&(J-=(V[z]-1)*W[z])}for(var x=function(G){if(R(G))return"buffer";if(d)switch(Object.prototype.toString.call(G)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(G)?"array":"generic"}(G),q=P[x];q.length<=k+1;)q.push(X(x,q.length-1));return(0,q[k+1])(G,V,W,J)}},13273:G=>{function V(G){return!!G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}G.exports=function(G){return null!=G&&(V(G)||function(G){return"function"===typeof G.readFloatLE&&"function"===typeof G.slice&&V(G.slice(0,0))}(G)||!!G._isBuffer)}},13398:G=>{"use strict";var V=[],W=[],J=[],R=[],d=[],k=[],z=[],X=[],P=[],A=[],x=[],q=[];G.exports=function(G,L,t,Y,g,B){for(var S=z,p=P,b=A,r=q,y=0;y<3;y++)S[y]=+t[y],b[y]=+L.max[y],p[y]=+L.base[y];B||(B=1e-10);var u=function(G,z,P,A,q,L){var t=V,Y=W,g=J,B=R,S=d,p=k,b=X,r=Math.floor,y=0,u=0,H=0,n=0,D=0;if(i(),0===H)return 0;for(n=f();u<=H;){if(e(n)&&F())return y;n=f()}for(y+=H,D=0;D<3;D++)A[D]+=P[D],q[D]+=P[D];return y;function i(){if(u=0,0!==(H=Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2])))for(var G=0;G<3;G++){var V=P[G]>=0;B[G]=V?1:-1;var W=V?q[G]:A[G];t[G]=V?A[G]:q[G],Y[G]=v(W,B[G]),g[G]=C(t[G],B[G]),b[G]=P[G]/H,S[G]=Math.abs(1/b[G]);var J=V?Y[G]+1-W:W-Y[G];p[G]=S[G]<1/0?S[G]*J:1/0}}function e(V){for(var W=B[0],J=0===V?Y[0]:g[0],R=Y[0]+W,d=B[1],k=1===V?Y[1]:g[1],z=Y[1]+d,X=B[2],P=2===V?Y[2]:g[2],A=Y[2]+X,x=J;x!=R;x+=W)for(var q=k;q!=z;q+=d)for(var L=P;L!=A;L+=X)if(G(x,q,L))return!0;return!1}function F(){y+=u;var G=B[n],V=u/H,W=x;for(D=0;D<3;D++){var J=P[D]*V;A[D]+=J,q[D]+=J,W[D]=P[D]-J}if(G>0?q[n]=Math.round(q[n]):A[n]=Math.round(A[n]),z(y,n,G,W))return!0;for(D=0;D<3;D++)P[D]=W[D];return i(),0===H}function f(){var G=p[0]<p[1]?p[0]<p[2]?0:2:p[1]<p[2]?1:2,V=p[G]-u;for(u=p[G],Y[G]+=B[G],p[G]+=S[G],D=0;D<3;D++)t[D]+=V*b[D],g[D]=C(t[D],B[D]);return G}function v(G,V){return r(G-V*L)}function C(G,V){return r(G+V*L)}}(G,Y,S,p,b,B);if(!g){for(y=0;y<3;y++)r[y]=t[y]>0?b[y]-L.max[y]:p[y]-L.base[y];L.translate(r)}return u}},13586:(G,V,W)=>{"use strict";W.d(V,{e:()=>x});var J=W(13390),R=W(12153);class d{constructor(G,V,W,d,k,z,X){this.LP=new J(G.base,G.iP),this.PJ=V,this.friction=W,this.restitution=d,this.Mk=k,this.GL=z,this.Tk=!!X,this.DP=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ML=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.sX=R.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=R.create(),this._impulses=R.create(),this._sleepFrameCount=10}loadFromCopy(G){R.i(this.LP.base,G.LP.base),R.i(this.LP.iP,G.LP.iP),R.i(this.LP.max,G.LP.max),this.LP.mag=G.LP.mag,this.PJ=G.PJ,this.friction=G.friction,this.restitution=G.restitution,this.Mk=G.Mk,this.GL=G.GL,this.Tk=G.Tk,this.DP=G.DP,this.fluidDrag=G.fluidDrag,this.ML=G.ML,this.preventFallOffEdge=G.preventFallOffEdge,this.rolledBackLastTick=G.rolledBackLastTick,R.i(this.sX,G.sX),R.i(this.resting,G.resting),this.inFluid=G.inFluid,this._ratioInFluid=G._ratioInFluid,R.i(this._forces,G._forces),R.i(this._impulses,G._impulses),this._sleepFrameCount=G._sleepFrameCount}setPosition(G){k(G),R.zW(G,G,this.LP.base),this.LP.translate(G),this.EX()}Jd(){return R.clone(this.LP.base)}applyForce(G){k(G),R.add(this._forces,this._forces,G),this.EX()}applyImpulse(G){k(G),R.add(this._impulses,this._impulses,G),this.EX()}EX(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var k=G=>{};var z=W(13390),X=W(12153),P=W(13398);function A(){this.DP=.1,this.fluidDrag=.4,this.Ek=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function x(G,V,W){G=Object.assign(new A,G),this.gravity=G.gravity||[0,-10,0],this.DP=G.DP||.1,this.Ek=G.Ek||2,this.fluidDrag=G.fluidDrag||.4,this.minBounceImpulse=G.minBounceImpulse,this.bodies=[],this.yq=G.yq,this.testSolid=V,this.testFluid=W}x.prototype.zL=function(G,V,W,J,R,k){G=G||new z([0,0,0],[1,1,1]),"undefined"==typeof V&&(V=1),"undefined"==typeof W&&(W=1),"undefined"==typeof J&&(J=0),"undefined"==typeof R&&(R=1);var X=new d(G,V,W,J,R,k);return this.bodies.push(X),X},x.prototype.XL=function(G){var V=this.bodies.indexOf(G);V<0||(this.bodies.splice(V,1),G.LP=G.GL=null)};var q=X.create(),L=X.create(),t=X.create(),Y=X.create(),g=X.create(),B=X.create(),S=X.create(),p=new z([0,0,0],[1,1,1]),b=new d(p,1,1,0,1,(()=>{}),!1);function r(G,V,W){return V=W,V*=1-(1-G.ratioInFluid)**2}x.prototype.zz=function(G){G/=1e3;var V=U(0,X.squaredLength(this.gravity));this.bodies.forEach((W=>function(G,V,W,J){X.i(g,V.resting),G.yq&&b.loadFromCopy(V);if(V.PJ<=0)return X.set(V.sX,0,0,0),X.set(V._forces,0,0,0),void X.set(V._impulses,0,0,0);var R=J||0===V.Mk;if(function(G,V,W,J){if(V._sleepFrameCount>0)return!1;if(J)return!0;var R=!1,d=.5*W*W*V.Mk;return X.scale(N,G.gravity,d),P(G.testSolid,V.LP,N,(function(){return R=!0,!0}),!0),R}(G,V,W,R))return;V._sleepFrameCount--,function(G,V){var W=V.LP,J=Math.floor(W.base[0]),R=Math.floor(W.base[2]),d=Math.floor(W.base[1]),k=Math.floor(W.max[1]);if(!G.testFluid(J,d,R))return V.inFluid=!1,void(V.ratioInFluid=0);var z=1,P=d+1;for(;P<=k&&G.testFluid(J,P,R);)z++,P++;var A=(d+z-W.base[1])/W.iP[1];A>1&&(A=1);var x=W.iP[0]*W.iP[1]*W.iP[2]*A,q=u;X.scale(q,G.gravity,-G.Ek*x*V.Mk),V.applyForce(q),V.inFluid=!0,V.ratioInFluid=A}(G,V),M(V._forces),M(V._impulses),M(V.sX),M(V.resting),X.scale(q,V._forces,1/V.PJ),X.Gz(q,q,G.gravity,V.Mk),X.scale(L,V._impulses,1/V.PJ),X.Gz(L,L,q,W),X.add(V.sX,V.sX,L),V.friction&&(H(G,0,V,L,W),H(G,1,V,L,W),H(G,2,V,L,W));var d=V.fluidDrag>=0?V.fluidDrag:G.fluidDrag,k=V.DP>=0?V.DP:G.DP,z=k,A=k;V.inFluid&&(z=r(V,z,V.fluidDragHoriz>=0?V.fluidDragHoriz:d),A=r(V,A,V.fluidDragVert>=0?V.fluidDragVert:d));z=Math.max(1-z*W/V.PJ,0),A=Math.max(1-A*W/V.PJ,0),X.set(y,z,A,z),X.multiply(V.sX,V.sX,y),X.scale(t,V.sX,W),X.set(V._forces,0,0,0),X.set(V._impulses,0,0,0),V.Tk&&a(i,V.LP);X.i(B,t),X.set(S,0,0,0),V.preventFallOffEdge&&function(G,V,W,J){if(!V.resting[1]||W[1]>0)return;var R=l;a(R,V.LP);for(var d=0;d<3;d+=2){X.set(C,0,0,0),C[d]=W[d];var k=!0;(k=(k=(k=(k=k&&!w(G,R.base[0]+C[0]+1e-5,R.base[1],R.base[2]+C[2]+1e-5))&&!w(G,R.max[0]+C[0]-1e-5,R.base[1],R.base[2]+C[2]+1e-5))&&!w(G,R.base[0]+C[0]+1e-5,R.base[1],R.max[2]+C[2]-1e-5))&&!w(G,R.max[0]+C[0]-1e-5,R.base[1],R.max[2]+C[2]-1e-5))?(J[d]=W[d]>0?1:-1,W[d]=0):0===d&&(X.set(m,W[0],0,0),D(G,R,m,J,V.slideOnCollision))}}(G,V,t,S);D(G,V.LP,t,V.resting,V.slideOnCollision),V.Tk&&function(G,V,W,J){if(V.resting[1]>=0&&!V.inFluid)return;var R=0!==V.resting[0],d=0!==V.resting[2];if(!R&&!d)return;var k=Math.abs(J[0]/J[2]),z=4;if(!R&&k>z)return;if(!d&&k<1/z)return;X.add(F,W.base,J);var A=G.testSolid;P(A,W,J,(function(G,V,W,J){if(1!==V)return!0;J[V]=0}));var x=W.base[1],q=V.inFluid?1.951:1.001,L=Math.floor(x+q)-x;X.set(f,0,L,0);var t=!1;if(P(A,W,f,(function(G,V,W,J){return t=!0,!0})),t)return;X.zW(v,F,W.base),v[1]=0,D(G,W,v,e,!0);var Y=U(W.base[0],F[0]),g=U(W.base[2],F[2]);if(R&&!Y&&(!g||!d))return;if(d&&(!Y||!R)&&!g)return;var B=!0;if(B=B&&!w(G,W.base[0]+1e-5,W.base[1],W.base[2]+1e-5),B=B&&!w(G,W.max[0]-1e-5,W.base[1],W.base[2]+1e-5),B=B&&!w(G,W.base[0]+1e-5,W.base[1],W.max[2]-1e-5),B=B&&!w(G,W.max[0]-1e-5,W.base[1],W.max[2]-1e-5),B)return;a(V.LP,W),V.resting[0]=e[0],V.resting[2]=e[2],V.ML&&V.ML()}(G,V,i,B);for(var x=0;x<3;++x)V.resting[x]=V.resting[x]||S[x],Y[x]=0,V.resting[x]&&(g[x]||(Y[x]=-V.sX[x]),V.sX[x]=0);var p=X.length(Y);p>.001&&(X.scale(Y,Y,V.PJ),V.GL&&V.GL(Y),V.restitution>0&&p>G.minBounceImpulse&&(X.scale(Y,Y,V.restitution),V.applyImpulse(Y)));var n=X.squaredLength(V.sX);n>1e-5&&V.EX();G.yq&&G.yq(V)?(V.loadFromCopy(b),V.rolledBackLastTick=!0):V.rolledBackLastTick=!1}(this,W,G,V)))};var y=X.create([0,0,0]);var u=X.create();function H(G,V,W,J,R){var d=W.resting[V],k=J[V];if(!W.alwaysApplyHorizFriction||1!==V){if(0===d)return;if(d*k<=0)return}X.i(n,W.sX),n[V]=0;var z=X.length(n);if(!U(z,0)){var P=Math.abs(W.friction*G.gravity[V]*R),A=z>P?(z-P)/z:0;W.sX[(V+1)%3]*=A,W.sX[(V+2)%3]*=A}}var n=X.create();function D(G,V,W,J,R){return X.set(J,0,0,0),P(G.testSolid,V,W,(function(G,V,W,d){J[V]=W,d[V]=0,R||(d[0]=0,d[1]=0,d[2]=0)}))}var i=new z([],[]),e=X.create(),F=X.create(),f=X.create(),v=X.create();var C=X.create(),l=new z([],[]),m=X.create();function w(G,V,W,J){return G.testSolid(Math.floor(V),Math.floor(W-1),Math.floor(J))}var N=X.create();function U(G,V){return Math.abs(G-V)<1e-5}function a(G,V){for(var W=0;W<3;W++)G.base[W]=V.base[W],G.max[W]=V.max[W],G.iP[W]=V.iP[W]}var M=function(G){}},12023:function(G,V){!function(G){"use strict";var V=function(G,W){return V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,V){G.__proto__=V}||function(G,V){for(var W in V)Object.prototype.hasOwnProperty.call(V,W)&&(G[W]=V[W])},V(G,W)};function W(G,W){if("function"!==typeof W&&null!==W)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function J(){this.constructor=G}V(G,W),G.prototype=null===W?Object.create(W):(J.prototype=W.prototype,new J)}function J(G,V,W,J){var R,d=arguments.length,k=d<3?V:null===J?J=Object.getOwnPropertyDescriptor(V,W):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)k=Reflect.decorate(G,V,W,J);else for(var z=G.length-1;z>=0;z--)(R=G[z])&&(k=(d<3?R(k):d>3?R(V,W,k):R(V,W))||k);return d>3&&k&&Object.defineProperty(V,W,k),k}function R(G,V,W){if(W||2===arguments.length)for(var J,R=0,d=V.length;R<d;R++)!J&&R in V||(J||(J=Array.prototype.slice.call(V,0,R)),J[R]=V[R]);return G.concat(J||Array.prototype.slice.call(V))}var d,k=255,z=213;G.OPERATION=void 0,(d=G.OPERATION||(G.OPERATION={}))[d.ADD=128]="ADD",d[d.REPLACE=0]="REPLACE",d[d.DELETE=64]="DELETE",d[d.DELETE_AND_ADD=192]="DELETE_AND_ADD",d[d.TOUCH=1]="TOUCH",d[d.CLEAR=10]="CLEAR";var X=function(){function V(G,V,W){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=G,this.setParent(V,W)}return V.prototype.setParent=function(G,V,W){var J=this;if(this.indexes||(this.indexes=this.ref instanceof vG?this.ref._definition.indexes:{}),this.parent=G,this.parentIndex=W,V)if(this.root=V,this.ref instanceof vG){var R=this.ref._definition;for(var d in R.schema){var k=this.ref[d];if(k&&k.$changes){var z=R.indexes[d];k.$changes.setParent(this.ref,V,z)}}}else"object"===typeof this.ref&&this.ref.forEach((function(G,V){if(G instanceof vG){var W=G.$changes,R=J.ref.$changes.indexes[V];W.setParent(J.ref,J.root,R)}}))},V.prototype.operation=function(G){this.changes.set(--this.currentCustomOperation,G)},V.prototype.change=function(V,W){void 0===W&&(W=G.OPERATION.ADD);var J="number"===typeof V?V:this.indexes[V];this.assertValidIndex(J,V);var R=this.changes.get(J);R&&R.op!==G.OPERATION.DELETE&&R.op!==G.OPERATION.TOUCH||this.changes.set(J,{op:R&&R.op===G.OPERATION.DELETE?G.OPERATION.DELETE_AND_ADD:W,index:J}),this.allChanges.add(J),this.changed=!0,this.touchParents()},V.prototype.touch=function(V){var W="number"===typeof V?V:this.indexes[V];this.assertValidIndex(W,V),this.changes.has(W)||this.changes.set(W,{op:G.OPERATION.TOUCH,index:W}),this.allChanges.add(W),this.touchParents()},V.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},V.prototype.getType=function(G){if(this.ref._definition)return(V=this.ref._definition).schema[V.fieldsByIndex[G]];var V,W=(V=this.parent._definition).schema[V.fieldsByIndex[this.parentIndex]];return Object.values(W)[0]},V.prototype.getChildrenFilter=function(){var G=this.parent._definition.childFilters;return G&&G[this.parentIndex]},V.prototype.getValue=function(G){return this.ref.getByIndex(G)},V.prototype.delete=function(V){var W="number"===typeof V?V:this.indexes[V];if(void 0!==W){var J=this.getValue(W);this.changes.set(W,{op:G.OPERATION.DELETE,index:W}),this.allChanges.delete(W),delete this.caches[W],J&&J.$changes&&(J.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(V," (").concat(W,")"))},V.prototype.discard=function(V,W){var J=this;void 0===V&&(V=!1),void 0===W&&(W=!1),this.ref instanceof vG||this.changes.forEach((function(V){if(V.op===G.OPERATION.DELETE){var W=J.ref.getIndex(V.index);delete J.indexes[W]}})),this.changes.clear(),this.changed=V,W&&this.allChanges.clear(),this.currentCustomOperation=0},V.prototype.discardAll=function(){var G=this;this.changes.forEach((function(V){var W=G.getValue(V.index);W&&W.$changes&&W.$changes.discardAll()})),this.discard()},V.prototype.cache=function(G,V){this.caches[G]=V},V.prototype.clone=function(){return new V(this.ref,this.parent,this.root)},V.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},V.prototype.assertValidIndex=function(G,V){if(void 0===G)throw new Error('ChangeTree: missing index for field "'.concat(V,'"'))},V}();function P(G,V,W,J){return G[V]||(G[V]=[]),G[V].push(W),null===J||void 0===J||J.forEach((function(G,V){return W(G,V)})),function(){return x(G[V],G[V].indexOf(W))}}function A(V){var W=this,J="string"!==typeof this.$changes.getType();this.$items.forEach((function(R,d){V.push({refId:W.$changes.refId,op:G.OPERATION.DELETE,field:d,value:void 0,previousValue:R}),J&&W.$changes.root.removeRef(R.$changes.refId)}))}function x(G,V){if(-1===V||V>=G.length)return!1;for(var W=G.length-1,J=V;J<W;J++)G[J]=G[J+1];return G.length=W,!0}var q=function(G,V){var W=G.toString(),J=V.toString();return W<J?-1:W>J?1:0};function L(G){return G.$proxy=!0,G=new Proxy(G,{get:function(G,V){return"symbol"===typeof V||isNaN(V)?G[V]:G.at(V)},set:function(G,V,W){if("symbol"===typeof V||isNaN(V))G[V]=W;else{var J=Array.from(G.$items.keys()),R=parseInt(J[V]||V);void 0===W||null===W?G.deleteAt(R):G.setAt(R,W)}return!0},deleteProperty:function(G,V){return"number"===typeof V?G.deleteAt(V):delete G[V],!0}})}var t=function(){function V(){for(var G=[],V=0;V<arguments.length;V++)G[V]=arguments[V];this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,G)}return V.prototype.Sz=function(V,W){return void 0===W&&(W=!0),P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,V,W?this.$items:void 0)},V.prototype.Gd=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,V)},V.is=function(G){return Array.isArray(G)||void 0!==G.array},Object.defineProperty(V.prototype,"length",{get:function(){return this.$items.size},set:function(G){0===G?this.clear():this.splice(G,this.length-G)},enumerable:!1,configurable:!0}),V.prototype.push=function(){for(var G,V=this,W=[],J=0;J<arguments.length;J++)W[J]=arguments[J];return W.forEach((function(W){G=V.$refId++,V.setAt(G,W)})),G},V.prototype.pop=function(){var G=Array.from(this.$indexes.values()).pop();if(void 0!==G){this.$changes.delete(G),this.$indexes.delete(G);var V=this.$items.get(G);return this.$items.delete(G),V}},V.prototype.at=function(G){var V=Array.from(this.$items.keys())[G];return this.$items.get(V)},V.prototype.setAt=function(V,W){var J,R;if(void 0!==W&&null!==W){if(this.$items.get(V)!==W){void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,V);var d=null!==(R=null===(J=this.$changes.indexes[V])||void 0===J?void 0:J.op)&&void 0!==R?R:G.OPERATION.ADD;this.$changes.indexes[V]=V,this.$indexes.set(V,V),this.$items.set(V,W),this.$changes.change(V,d)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},V.prototype.deleteAt=function(G){var V=Array.from(this.$items.keys())[G];return void 0!==V&&this.$deleteAt(V)},V.prototype.$deleteAt=function(G){return this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G)},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&A.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.concat=function(){for(var G,W=[],J=0;J<arguments.length;J++)W[J]=arguments[J];return new(V.bind.apply(V,R([void 0],(G=Array.from(this.$items.values())).concat.apply(G,W),!1)))},V.prototype.join=function(G){return Array.from(this.$items.values()).join(G)},V.prototype.reverse=function(){var G=this,V=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(W,J){G.setAt(V[J],W)})),this},V.prototype.shift=function(){var G=Array.from(this.$items.keys()).shift();if(void 0!==G){var V=this.$items.get(G);return this.$deleteAt(G),V}},V.prototype.slice=function(G,W){var J=new V;return J.push.apply(J,Array.from(this.$items.values()).slice(G,W)),J},V.prototype.sort=function(G){var V=this;void 0===G&&(G=q);var W=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(G).forEach((function(G,J){V.setAt(W[J],G)})),this},V.prototype.splice=function(G,V){void 0===V&&(V=this.length-G);for(var W=Array.from(this.$items.keys()),J=[],R=G;R<G+V;R++)J.push(this.$items.get(W[R])),this.$deleteAt(W[R]);return J},V.prototype.unshift=function(){for(var G=this,V=[],W=0;W<arguments.length;W++)V[W]=arguments[W];var J=this.length,R=V.length,d=Array.from(this.$items.values());return V.forEach((function(V,W){G.setAt(W,V)})),d.forEach((function(V,W){G.setAt(R+W,V)})),J+R},V.prototype.indexOf=function(G,V){return Array.from(this.$items.values()).indexOf(G,V)},V.prototype.lastIndexOf=function(G,V){return void 0===V&&(V=this.length-1),Array.from(this.$items.values()).lastIndexOf(G,V)},V.prototype.every=function(G,V){return Array.from(this.$items.values()).every(G,V)},V.prototype.some=function(G,V){return Array.from(this.$items.values()).some(G,V)},V.prototype.forEach=function(G,V){Array.from(this.$items.values()).forEach(G,V)},V.prototype.map=function(G,V){return Array.from(this.$items.values()).map(G,V)},V.prototype.filter=function(G,V){return Array.from(this.$items.values()).filter(G,V)},V.prototype.reduce=function(G,V){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},V.prototype.reduceRight=function(G,V){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},V.prototype.find=function(G,V){return Array.from(this.$items.values()).find(G,V)},V.prototype.findIndex=function(G,V){return Array.from(this.$items.values()).findIndex(G,V)},V.prototype.fill=function(G,V,W){throw new Error("ArraySchema#fill() not implemented")},V.prototype.copyWithin=function(G,V,W){throw new Error("ArraySchema#copyWithin() not implemented")},V.prototype.toString=function(){return this.$items.toString()},V.prototype.toLocaleString=function(){return this.$items.toLocaleString()},V.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(V,Symbol.species,{get:function(){return V},enumerable:!1,configurable:!0}),V.prototype.entries=function(){return this.$items.entries()},V.prototype.keys=function(){return this.$items.keys()},V.prototype.values=function(){return this.$items.values()},V.prototype.includes=function(G,V){return Array.from(this.$items.values()).includes(G,V)},V.prototype.flatMap=function(G,V){throw new Error("ArraySchema#flatMap() is not supported.")},V.prototype.flat=function(G){throw new Error("ArraySchema#flat() is not supported.")},V.prototype.findLast=function(){var G=Array.from(this.$items.values());return G.findLast.apply(G,arguments)},V.prototype.findLastIndex=function(){var G=Array.from(this.$items.values());return G.findLastIndex.apply(G,arguments)},V.prototype.setIndex=function(G,V){this.$indexes.set(G,V)},V.prototype.getIndex=function(G){return this.$indexes.get(G)},V.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},V.prototype.deleteByIndex=function(G){var V=this.$indexes.get(G);this.$items.delete(V),this.$indexes.delete(G)},V.prototype.toArray=function(){return Array.from(this.$items.values())},V.prototype.toJSON=function(){return this.toArray().map((function(G){return"function"===typeof G.toJSON?G.toJSON():G}))},V.prototype.clone=function(G){return G?new(V.bind.apply(V,R([void 0],Array.from(this.$items.values()),!1))):new(V.bind.apply(V,R([void 0],this.map((function(G){return G.$changes?G.clone():G})),!1)))},V}();function Y(G){return G.$proxy=!0,G=new Proxy(G,{get:function(G,V){return"symbol"!==typeof V&&"undefined"===typeof G[V]?G.get(V):G[V]},set:function(G,V,W){return"symbol"!==typeof V&&-1===V.indexOf("$")&&"Sz"!==V&&"Gd"!==V&&"onChange"!==V?G.set(V,W):G[V]=W,!0},deleteProperty:function(G,V){return G.delete(V),!0}})}var g=function(){function V(G){var W=this;if(this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G)if(G instanceof Map||G instanceof V)G.forEach((function(G,V){return W.set(V,G)}));else for(var J in G)this.set(J,G[J])}return V.prototype.Sz=function(V,W){return void 0===W&&(W=!0),P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,V,W?this.$items:void 0)},V.prototype.Gd=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,V)},V.is=function(G){return void 0!==G.map},V.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(V.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(V,Symbol.species,{get:function(){return V},enumerable:!1,configurable:!0}),V.prototype.set=function(V,W){if(void 0===W||null===W)throw new Error("MapSchema#set('".concat(V,"', ").concat(W,"): trying to set ").concat(W," value on '").concat(V,"'."));V=V.toString();var J="undefined"!==typeof this.$changes.indexes[V],R=J?this.$changes.indexes[V]:this.$refId++,d=J?G.OPERATION.REPLACE:G.OPERATION.ADD,k=void 0!==W.$changes;if(k&&W.$changes.setParent(this,this.$changes.root,R),J){if(!k&&this.$items.get(V)===W)return;k&&this.$items.get(V)!==W&&(d=G.OPERATION.ADD)}else this.$changes.indexes[V]=R,this.$indexes.set(R,V);return this.$items.set(V,W),this.$changes.change(V,d),this},V.prototype.get=function(G){return this.$items.get(G)},V.prototype.delete=function(G){return this.$changes.delete(G),this.$items.delete(G)},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&A.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.has=function(G){return this.$items.has(G)},V.prototype.forEach=function(G){this.$items.forEach(G)},V.prototype.entries=function(){return this.$items.entries()},V.prototype.keys=function(){return this.$items.keys()},V.prototype.values=function(){return this.$items.values()},Object.defineProperty(V.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),V.prototype.setIndex=function(G,V){this.$indexes.set(G,V)},V.prototype.getIndex=function(G){return this.$indexes.get(G)},V.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},V.prototype.deleteByIndex=function(G){var V=this.$indexes.get(G);this.$items.delete(V),this.$indexes.delete(G)},V.prototype.toJSON=function(){var G={};return this.forEach((function(V,W){G[W]="function"===typeof V.toJSON?V.toJSON():V})),G},V.prototype.clone=function(G){var W;return G?W=Object.assign(new V,this):(W=new V,this.forEach((function(G,V){G.$changes?W.set(V,G.clone()):W.set(V,G)}))),W},V}(),B={};function S(G,V){B[G]=V}function p(G){return B[G]}var b=function(){function G(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return G.create=function(V){var W=new G;return W.schema=Object.assign({},V&&V.schema||{}),W.indexes=Object.assign({},V&&V.indexes||{}),W.fieldsByIndex=Object.assign({},V&&V.fieldsByIndex||{}),W.descriptors=Object.assign({},V&&V.descriptors||{}),W.deprecated=Object.assign({},V&&V.deprecated||{}),W},G.prototype.addField=function(G,V){var W=this.getNextFieldIndex();this.fieldsByIndex[W]=G,this.indexes[G]=W,this.schema[G]=Array.isArray(V)?{array:V[0]}:V},G.prototype.hasField=function(G){return void 0!==this.indexes[G]},G.prototype.addFilter=function(G,V){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[G]]=V,this.indexesWithFilters.push(this.indexes[G]),!0},G.prototype.addChildrenFilter=function(G,V){var W=this.indexes[G],J=this.schema[G];if(p(Object.keys(J)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[W]=V,!0;console.warn("@filterChildren: field '".concat(G,"' can't have children. Ignoring filter."))},G.prototype.getChildrenFilter=function(G){return this.childFilters&&this.childFilters[this.indexes[G]]},G.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},G}();function r(G){return G._context&&G._context.useFilters}var y=function(){function G(){this.types={},this.schemas=new Map,this.useFilters=!1}return G.prototype.has=function(G){return this.schemas.has(G)},G.prototype.get=function(G){return this.types[G]},G.prototype.add=function(G,V){void 0===V&&(V=this.schemas.size),G._definition=b.create(G._definition),G._typeid=V,this.types[V]=G,this.schemas.set(G,V)},G.create=function(V){return void 0===V&&(V={}),function(W){return V.context||(V.context=new G),H(W,V)}},G}(),u=new y;function H(G,V){return void 0===V&&(V={}),function(W,J){var d=V.context||u,k=W.constructor;if(k._context=d,!G)throw new Error("".concat(k.name,': @type() reference provided for "').concat(J,"\" is undefined. Make sure you don't have any circular dependencies."));d.has(k)||d.add(k);var z=k._definition;if(z.addField(J,G),z.descriptors[J]){if(z.deprecated[J])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(J,"' definition on '").concat(k.name,"'.\nCheck @type() annotation"))}catch(B){var X=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(X))}}var P=t.is(G),A=!P&&g.is(G);if("string"!==typeof G&&!vG.is(G)){var x=Object.values(G)[0];"string"===typeof x||d.has(x)||d.add(x)}if(V.manual)z.descriptors[J]={enumerable:!0,configurable:!0,writable:!0};else{var q="_".concat(J);z.descriptors[q]={enumerable:!1,configurable:!1,writable:!0},z.descriptors[J]={get:function(){return this[q]},set:function(G){G!==this[q]&&(void 0!==G&&null!==G?(!P||G instanceof t||(G=new(t.bind.apply(t,R([void 0],G,!1)))),!A||G instanceof g||(G=new g(G)),void 0===G.$proxy&&(A?G=Y(G):P&&(G=L(G))),this.$changes.change(J),G.$changes&&G.$changes.setParent(this,this.$changes.root,this._definition.indexes[J])):this[q]&&this.$changes.delete(J),this[q]=G)},enumerable:!0,configurable:!0}}}}function n(G){return function(V,W){var J=V.constructor;J._definition.addFilter(W,G)&&(J._context.useFilters=!0)}}function D(G){return function(V,W){var J=V.constructor;J._definition.addChildrenFilter(W,G)&&(J._context.useFilters=!0)}}function i(G){return void 0===G&&(G=!0),function(V,W){var J=V.constructor._definition;J.deprecated[W]=!0,G&&(J.descriptors[W]={get:function(){throw new Error("".concat(W," is deprecated."))},set:function(G){},enumerable:!1,configurable:!0})}}function e(G,V,W){for(var J in void 0===W&&(W={}),W.context||(W.context=G._context||W.context||u),V)H(V[J],W)(G.prototype,J);return G}function F(G){for(var V=0,W=0,J=0,R=G.length;J<R;J++)(V=G.charCodeAt(J))<128?W+=1:V<2048?W+=2:V<55296||V>=57344?W+=3:(J++,W+=4);return W}function f(G,V,W){for(var J=0,R=0,d=W.length;R<d;R++)(J=W.charCodeAt(R))<128?G[V++]=J:J<2048?(G[V++]=192|J>>6,G[V++]=128|63&J):J<55296||J>=57344?(G[V++]=224|J>>12,G[V++]=128|J>>6&63,G[V++]=128|63&J):(R++,J=65536+((1023&J)<<10|1023&W.charCodeAt(R)),G[V++]=240|J>>18,G[V++]=128|J>>12&63,G[V++]=128|J>>6&63,G[V++]=128|63&J)}function v(G,V){G.push(255&V)}function C(G,V){G.push(255&V)}function l(G,V){G.push(255&V),G.push(V>>8&255)}function m(G,V){G.push(255&V),G.push(V>>8&255)}function w(G,V){G.push(255&V),G.push(V>>8&255),G.push(V>>16&255),G.push(V>>24&255)}function N(G,V){var W=V>>24,J=V>>16,R=V>>8,d=V;G.push(255&d),G.push(255&R),G.push(255&J),G.push(255&W)}function U(G,V){var W=Math.floor(V/Math.pow(2,32));N(G,V>>>0),N(G,W)}function a(G,V){var W=V/Math.pow(2,32)|0;N(G,V>>>0),N(G,W)}function M(G,V){Z(G,V)}function T(G,V){E(G,V)}var K=new Int32Array(2),s=new Float32Array(K.buffer),Q=new Float64Array(K.buffer);function Z(G,V){s[0]=V,w(G,K[0])}function E(G,V){Q[0]=V,w(G,K[0]),w(G,K[1])}function h(G,V){return C(G,V?1:0)}function o(G,V){V||(V="");var W=F(V),J=0;if(W<32)G.push(160|W),J=1;else if(W<256)G.push(217),C(G,W),J=2;else if(W<65536)G.push(218),m(G,W),J=3;else{if(!(W<4294967296))throw new Error("String too long");G.push(219),N(G,W),J=5}return f(G,G.length,V),J+W}function c(G,V){return isNaN(V)?c(G,0):isFinite(V)?V!==(0|V)?(G.push(203),E(G,V),9):V>=0?V<128?(C(G,V),1):V<256?(G.push(204),C(G,V),2):V<65536?(G.push(205),m(G,V),3):V<4294967296?(G.push(206),N(G,V),5):(G.push(207),a(G,V),9):V>=-32?(G.push(224|V+32),1):V>=-128?(G.push(208),v(G,V),2):V>=-32768?(G.push(209),l(G,V),3):V>=-2147483648?(G.push(210),w(G,V),5):(G.push(211),U(G,V),9):c(G,V>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var j=Object.freeze({__proto__:null,utf8Write:f,int8:v,uint8:C,int16:l,uint16:m,int32:w,uint32:N,int64:U,uint64:a,float32:M,float64:T,writeFloat32:Z,writeFloat64:E,boolean:h,string:o,number:c});function I(G,V,W){for(var J="",R=0,d=V,k=V+W;d<k;d++){var z=G[d];0!==(128&z)?192!==(224&z)?224!==(240&z)?240!==(248&z)?console.error("Invalid byte "+z.toString(16)):(R=(7&z)<<18|(63&G[++d])<<12|(63&G[++d])<<6|63&G[++d])>=65536?(R-=65536,J+=String.fromCharCode(55296+(R>>>10),56320+(1023&R))):J+=String.fromCharCode(R):J+=String.fromCharCode((15&z)<<12|(63&G[++d])<<6|63&G[++d]):J+=String.fromCharCode((31&z)<<6|63&G[++d]):J+=String.fromCharCode(z)}return J}function O(G,V){return GG(G,V)<<24>>24}function GG(G,V){return G[V.offset++]}function VG(G,V){return WG(G,V)<<16>>16}function WG(G,V){return G[V.offset++]|G[V.offset++]<<8}function JG(G,V){return G[V.offset++]|G[V.offset++]<<8|G[V.offset++]<<16|G[V.offset++]<<24}function RG(G,V){return JG(G,V)>>>0}function dG(G,V){return qG(G,V)}function kG(G,V){return LG(G,V)}function zG(G,V){var W=RG(G,V);return JG(G,V)*Math.pow(2,32)+W}function XG(G,V){var W=RG(G,V);return RG(G,V)*Math.pow(2,32)+W}var PG=new Int32Array(2),AG=new Float32Array(PG.buffer),xG=new Float64Array(PG.buffer);function qG(G,V){return PG[0]=JG(G,V),AG[0]}function LG(G,V){return PG[0]=JG(G,V),PG[1]=JG(G,V),xG[0]}function tG(G,V){return GG(G,V)>0}function YG(G,V){var W,J=G[V.offset++];J<192?W=31&J:217===J?W=GG(G,V):218===J?W=WG(G,V):219===J&&(W=RG(G,V));var R=I(G,V.offset,W);return V.offset+=W,R}function gG(G,V){var W=G[V.offset];return W<192&&W>160||217===W||218===W||219===W}function BG(G,V){var W=G[V.offset++];return W<128?W:202===W?qG(G,V):203===W?LG(G,V):204===W?GG(G,V):205===W?WG(G,V):206===W?RG(G,V):207===W?XG(G,V):208===W?O(G,V):209===W?VG(G,V):210===W?JG(G,V):211===W?zG(G,V):W>223?-1*(255-W+1):void 0}function SG(G,V){var W=G[V.offset];return W<128||W>=202&&W<=211}function pG(G,V){return G[V.offset]<160}function bG(G,V){return G[V.offset-1]===k&&(G[V.offset]<128||G[V.offset]>=202&&G[V.offset]<=211)}var rG=Object.freeze({__proto__:null,int8:O,uint8:GG,int16:VG,uint16:WG,int32:JG,uint32:RG,float32:dG,float64:kG,int64:zG,uint64:XG,readFloat32:qG,readFloat64:LG,boolean:tG,string:YG,stringCheck:gG,number:BG,numberCheck:SG,arrayCheck:pG,switchStructureCheck:bG}),yG=function(){function V(G){var V=this;this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G&&G.forEach((function(G){return V.add(G)}))}return V.prototype.Sz=function(V,W){return void 0===W&&(W=!0),P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,V,W?this.$items:void 0)},V.prototype.Gd=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,V)},V.is=function(G){return void 0!==G.collection},V.prototype.add=function(G){var V=this.$refId++;return void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,V),this.$changes.indexes[V]=V,this.$indexes.set(V,V),this.$items.set(V,G),this.$changes.change(V),V},V.prototype.at=function(G){var V=Array.from(this.$items.keys())[G];return this.$items.get(V)},V.prototype.entries=function(){return this.$items.entries()},V.prototype.delete=function(G){for(var V,W,J=this.$items.entries();(W=J.next())&&!W.done;)if(G===W.value[1]){V=W.value[0];break}return void 0!==V&&(this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V))},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&A.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.has=function(G){return Array.from(this.$items.values()).some((function(V){return V===G}))},V.prototype.forEach=function(G){var V=this;this.$items.forEach((function(W,J,R){return G(W,J,V)}))},V.prototype.values=function(){return this.$items.values()},Object.defineProperty(V.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),V.prototype.setIndex=function(G,V){this.$indexes.set(G,V)},V.prototype.getIndex=function(G){return this.$indexes.get(G)},V.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},V.prototype.deleteByIndex=function(G){var V=this.$indexes.get(G);this.$items.delete(V),this.$indexes.delete(G)},V.prototype.toArray=function(){return Array.from(this.$items.values())},V.prototype.toJSON=function(){var G=[];return this.forEach((function(V,W){G.push("function"===typeof V.toJSON?V.toJSON():V)})),G},V.prototype.clone=function(G){var W;return G?W=Object.assign(new V,this):(W=new V,this.forEach((function(G){G.$changes?W.add(G.clone()):W.add(G)}))),W},V}(),uG=function(){function V(G){var V=this;this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G&&G.forEach((function(G){return V.add(G)}))}return V.prototype.Sz=function(V,W){return void 0===W&&(W=!0),P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,V,W?this.$items:void 0)},V.prototype.Gd=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,V)},V.prototype.onChange=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,V)},V.is=function(G){return void 0!==G.set},V.prototype.add=function(V){var W,J;if(this.has(V))return!1;var R=this.$refId++;void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,R);var d=null!==(J=null===(W=this.$changes.indexes[R])||void 0===W?void 0:W.op)&&void 0!==J?J:G.OPERATION.ADD;return this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,V),this.$changes.change(R,d),R},V.prototype.entries=function(){return this.$items.entries()},V.prototype.delete=function(G){for(var V,W,J=this.$items.entries();(W=J.next())&&!W.done;)if(G===W.value[1]){V=W.value[0];break}return void 0!==V&&(this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V))},V.prototype.clear=function(V){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),V&&A.call(this,V),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},V.prototype.has=function(G){for(var V,W=this.$items.values(),J=!1;(V=W.next())&&!V.done;)if(G===V.value){J=!0;break}return J},V.prototype.forEach=function(G){var V=this;this.$items.forEach((function(W,J,R){return G(W,J,V)}))},V.prototype.values=function(){return this.$items.values()},Object.defineProperty(V.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),V.prototype.setIndex=function(G,V){this.$indexes.set(G,V)},V.prototype.getIndex=function(G){return this.$indexes.get(G)},V.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},V.prototype.deleteByIndex=function(G){var V=this.$indexes.get(G);this.$items.delete(V),this.$indexes.delete(G)},V.prototype.toArray=function(){return Array.from(this.$items.values())},V.prototype.toJSON=function(){var G=[];return this.forEach((function(V,W){G.push("function"===typeof V.toJSON?V.toJSON():V)})),G},V.prototype.clone=function(G){var W;return G?W=Object.assign(new V,this):(W=new V,this.forEach((function(G){G.$changes?W.add(G.clone()):W.add(G)}))),W},V}(),HG=function(){function G(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return G.prototype.addRefId=function(G){this.refIds.has(G)||(this.refIds.add(G),this.containerIndexes.set(G,new Set))},G.get=function(V){return void 0===V.$filterState&&(V.$filterState=new G),V.$filterState},G}(),nG=function(){function G(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return G.prototype.getNextUniqueId=function(){return this.nextUniqueId++},G.prototype.addRef=function(G,V,W){void 0===W&&(W=!0),this.refs.set(G,V),W&&(this.refCounts[G]=(this.refCounts[G]||0)+1)},G.prototype.removeRef=function(G){this.refCounts[G]=this.refCounts[G]-1,this.deletedRefs.add(G)},G.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},G.prototype.garbageCollectDeletedRefs=function(){var G=this;this.deletedRefs.forEach((function(V){if(!(G.refCounts[V]>0)){var W=G.refs.get(V);if(W instanceof vG)for(var J in W._definition.schema)"string"!==typeof W._definition.schema[J]&&W[J]&&W[J].$changes&&G.removeRef(W[J].$changes.refId);else{var R=W.$changes.parent._definition,d=R.schema[R.fieldsByIndex[W.$changes.parentIndex]];"function"===typeof Object.values(d)[0]&&Array.from(W.values()).forEach((function(V){return G.removeRef(V.$changes.refId)}))}G.refs.delete(V),delete G.refCounts[V]}})),this.deletedRefs.clear()},G}(),DG=function(G){function V(){return null!==G&&G.apply(this,arguments)||this}return W(V,G),V}(Error);function iG(G,V,W,J){var R,d=!1;switch(V){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":R="number",isNaN(G)&&console.log('trying to encode "NaN" in '.concat(W.constructor.name,"#").concat(J));break;case"string":R="string",d=!0;break;case"boolean":return}if(typeof G!==R&&(!d||d&&null!==G)){var k="'".concat(JSON.stringify(G),"'").concat(G&&G.constructor&&" (".concat(G.constructor.name,")")||"");throw new DG("a '".concat(R,"' was expected, but ").concat(k," was provided in ").concat(W.constructor.name,"#").concat(J))}}function eG(G,V,W,J){if(!(G instanceof V))throw new DG("a '".concat(V.name,"' was expected, but '").concat(G.constructor.name,"' was provided in ").concat(W.constructor.name,"#").concat(J))}function FG(G,V,W,J,R){iG(W,G,J,R);var d=j[G];if(!d)throw new DG("a '".concat(G,"' was expected, but ").concat(W," was provided in ").concat(J.constructor.name,"#").concat(R));d(V,W)}function fG(G,V,W){return rG[G](V,W)}var vG=function(){function V(){for(var G=[],V=0;V<arguments.length;V++)G[V]=arguments[V];Object.defineProperties(this,{$changes:{value:new X(this,void 0,new nG),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var W=this._definition.descriptors;W&&Object.defineProperties(this,W),G[0]&&this.assign(G[0])}return V.onError=function(G){console.error(G)},V.is=function(G){return G._definition&&void 0!==G._definition.schema},V.prototype.onChange=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,V)},V.prototype.Gd=function(V){return P(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,V)},V.prototype.assign=function(G){return Object.assign(this,G),this},Object.defineProperty(V.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),V.prototype.setDirty=function(G,V){this.$changes.change(G,V)},V.prototype.listen=function(G,V,W){var J=this;return void 0===W&&(W=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[G]||(this.$callbacks[G]=[]),this.$callbacks[G].push(V),W&&void 0!==this[G]&&V(this[G],void 0),function(){return x(J.$callbacks[G],J.$callbacks[G].indexOf(V))}},V.prototype.decode=function(W,J,R){var d;void 0===J&&(J={offset:0}),void 0===R&&(R=this);var z=[],X=this.$changes.root,P=W.length,A=0;for(X.refs.set(A,this);J.offset<P;){var x=W[J.offset++];if(x!=k){var q=R.$changes,L=void 0!==R._definition,Y=L?x>>6<<6:x;if(Y!==G.OPERATION.CLEAR){var B=L?x%(Y||255):BG(W,J),S=L?R._definition.fieldsByIndex[B]:"",b=q.getType(B),r=void 0,y=void 0,u=void 0;if(L?y=R["_".concat(S)]:(y=R.getByIndex(B),(Y&G.OPERATION.ADD)===G.OPERATION.ADD?(u=R instanceof g?YG(W,J):B,R.setIndex(B,u)):u=R.getIndex(B)),(Y&G.OPERATION.DELETE)===G.OPERATION.DELETE&&(Y!==G.OPERATION.DELETE_AND_ADD&&R.deleteByIndex(B),y&&y.$changes&&X.removeRef(y.$changes.refId),r=null),void 0!==S){if(Y===G.OPERATION.DELETE);else if(V.is(b)){var H=BG(W,J);if(r=X.refs.get(H),Y!==G.OPERATION.REPLACE){var n=this.getSchemaType(W,J,b);r||((r=this.createTypeInstance(n)).$changes.refId=H,y&&(r.$callbacks=y.$callbacks,y.$changes.refId&&H!==y.$changes.refId&&X.removeRef(y.$changes.refId))),X.addRef(H,r,r!==y)}}else if("string"===typeof b)r=fG(b,W,J);else{var D=p(Object.keys(b)[0]),i=BG(W,J),e=X.refs.has(i)?y||X.refs.get(i):new D.constructor;if((r=e.clone(!0)).$changes.refId=i,y&&(r.$callbacks=y.$callbacks,y.$changes.refId&&i!==y.$changes.refId)){X.removeRef(y.$changes.refId);for(var F=y.entries(),f=void 0;(f=F.next())&&!f.done;){var v=(d=f.value)[0],C=d[1];z.push({refId:i,op:G.OPERATION.DELETE,field:v,value:void 0,previousValue:C})}}X.addRef(i,r,e!==y)}if(null!==r&&void 0!==r)if(r.$changes&&r.$changes.setParent(q.ref,q.root,B),R instanceof V)R[S]=r;else if(R instanceof g)v=u,R.$items.set(v,r),R.$changes.allChanges.add(B);else if(R instanceof t)R.setAt(B,r);else if(R instanceof yG){var l=R.add(r);R.setIndex(B,l)}else R instanceof uG&&!1!==(l=R.add(r))&&R.setIndex(B,l);y!==r&&z.push({refId:A,op:Y,field:S,dynamicIndex:u,value:r,previousValue:y})}else{console.warn("@colyseus/schema: definition mismatch");for(var m={offset:J.offset};J.offset<P&&(!bG(W,J)||(m.offset=J.offset+1,!X.refs.has(BG(W,m))));)J.offset++}}else R.clear(z)}else{A=BG(W,J);var w=X.refs.get(A);if(!w)throw new Error('"refId" not found: '.concat(A));R=w}}return this._triggerChanges(z),X.garbageCollectDeletedRefs(),z},V.prototype.encode=function(W,J,R){void 0===W&&(W=!1),void 0===J&&(J=[]),void 0===R&&(R=!1);for(var d=this.$changes,z=new WeakSet,X=[d],P=1,A=0;A<P;A++){var x=X[A],q=x.ref,L=q instanceof V;x.ensureRefId(),z.add(x),x!==d&&(x.changed||W)&&(C(J,k),c(J,x.refId));for(var t=W?Array.from(x.allChanges):Array.from(x.changes.values()),Y=0,B=t.length;Y<B;Y++){var S=W?{op:G.OPERATION.ADD,index:t[Y]}:t[Y],b=S.index,r=L?q._definition.fieldsByIndex&&q._definition.fieldsByIndex[b]:b,y=J.length;if(S.op!==G.OPERATION.TOUCH)if(L)C(J,b|S.op);else{if(C(J,S.op),S.op===G.OPERATION.CLEAR)continue;c(J,b)}if(L||(S.op&G.OPERATION.ADD)!=G.OPERATION.ADD||q instanceof g&&o(J,x.ref.$indexes.get(b)),S.op!==G.OPERATION.DELETE){var u=x.getType(b),H=x.getValue(b);if(H&&H.$changes&&!z.has(H.$changes)&&(X.push(H.$changes),H.$changes.ensureRefId(),P++),S.op!==G.OPERATION.TOUCH){if(V.is(u))eG(H,u,q,r),c(J,H.$changes.refId),(S.op&G.OPERATION.ADD)===G.OPERATION.ADD&&this.tryEncodeTypeId(J,u,H.constructor);else if("string"===typeof u)FG(u,J,H,q,r);else{var n=p(Object.keys(u)[0]);eG(q["_".concat(r)],n.constructor,q,r),c(J,H.$changes.refId)}R&&x.cache(b,J.slice(y))}}}W||R||x.discard()}return J},V.prototype.encodeAll=function(G){return this.encode(!0,[],G)},V.prototype.applyFilters=function(W,J){var R,d;void 0===J&&(J=!1);for(var z=this,X=new Set,P=HG.get(W),A=[this.$changes],x=1,q=[],L=function(L){var t=A[L];if(X.has(t.refId))return"continue";var Y=t.ref,B=Y instanceof V;C(q,k),c(q,t.refId);var S=P.refIds.has(t),p=J||!S;P.addRefId(t);var b=P.containerIndexes.get(t),r=p?Array.from(t.allChanges):Array.from(t.changes.values());!J&&B&&Y._definition.indexesWithFilters&&Y._definition.indexesWithFilters.forEach((function(V){!b.has(V)&&t.allChanges.has(V)&&(p?r.push(V):r.push({op:G.OPERATION.ADD,index:V}))}));for(var y=0,u=r.length;y<u;y++){var H=p?{op:G.OPERATION.ADD,index:r[y]}:r[y];if(H.op!==G.OPERATION.CLEAR){var n=H.index;if(H.op!==G.OPERATION.DELETE){var D=t.getValue(n),i=t.getType(n);if(B){if((e=Y._definition.filters&&Y._definition.filters[n])&&!e.call(Y,W,D,z)){D&&D.$changes&&X.add(D.$changes.refId);continue}}else{var e,F=t.parent;if((e=t.getChildrenFilter())&&!e.call(F,W,Y.$indexes.get(n),D,z)){D&&D.$changes&&X.add(D.$changes.refId);continue}}if(D.$changes&&(A.push(D.$changes),x++),H.op!==G.OPERATION.TOUCH)if(H.op===G.OPERATION.ADD||B)q.push.apply(q,null!==(R=t.caches[n])&&void 0!==R?R:[]),b.add(n);else if(b.has(n))q.push.apply(q,null!==(d=t.caches[n])&&void 0!==d?d:[]);else{if(b.add(n),C(q,G.OPERATION.ADD),c(q,n),Y instanceof g){var f=t.ref.$indexes.get(n);o(q,f)}D.$changes?c(q,D.$changes.refId):j[i](q,D)}else D.$changes&&!B&&(C(q,G.OPERATION.ADD),c(q,n),Y instanceof g&&(f=t.ref.$indexes.get(n),o(q,f)),c(q,D.$changes.refId))}else B?C(q,H.op|n):(C(q,H.op),c(q,n))}else C(q,H.op)}},t=0;t<x;t++)L(t);return q},V.prototype.clone=function(){var G,V=new this.constructor,W=this._definition.schema;for(var J in W)"object"===typeof this[J]&&"function"===typeof(null===(G=this[J])||void 0===G?void 0:G.clone)?V[J]=this[J].clone():V[J]=this[J];return V},V.prototype.toJSON=function(){var G=this._definition.schema,V=this._definition.deprecated,W={};for(var J in G)V[J]||null===this[J]||"undefined"===typeof this[J]||(W[J]="function"===typeof this[J].toJSON?this[J].toJSON():this["_".concat(J)]);return W},V.prototype.discardAllChanges=function(){this.$changes.discardAll()},V.prototype.getByIndex=function(G){return this[this._definition.fieldsByIndex[G]]},V.prototype.deleteByIndex=function(G){this[this._definition.fieldsByIndex[G]]=void 0},V.prototype.tryEncodeTypeId=function(G,V,W){V._typeid!==W._typeid&&(C(G,z),c(G,W._typeid))},V.prototype.getSchemaType=function(G,V,W){var J;return G[V.offset]===z&&(V.offset++,J=this.constructor._context.get(BG(G,V))),J||W},V.prototype.createTypeInstance=function(G){var V=new G;return V.$changes.root=this.$changes.root,V},V.prototype._triggerChanges=function(W){for(var J,R,d,k,z,X,P,A,x,q=new Set,L=this.$changes.root.refs,t=function(t){var Y=W[t],g=Y.refId,B=L.get(g),S=B.$callbacks;if((Y.op&G.OPERATION.DELETE)===G.OPERATION.DELETE&&Y.previousValue instanceof V&&(null===(R=null===(J=Y.previousValue.$callbacks)||void 0===J?void 0:J[G.OPERATION.DELETE])||void 0===R||R.forEach((function(G){return G()}))),!S)return"continue";if(B instanceof V){if(!q.has(g))try{null===(d=null===S||void 0===S?void 0:S[G.OPERATION.REPLACE])||void 0===d||d.forEach((function(G){return G()}))}catch(p){V.onError(p)}try{S.hasOwnProperty(Y.field)&&(null===(k=S[Y.field])||void 0===k||k.forEach((function(G){return G(Y.value,Y.previousValue)})))}catch(p){V.onError(p)}}else Y.op===G.OPERATION.ADD&&void 0===Y.previousValue?null===(z=S[G.OPERATION.ADD])||void 0===z||z.forEach((function(G){var V;return G(Y.value,null!==(V=Y.dynamicIndex)&&void 0!==V?V:Y.field)})):Y.op===G.OPERATION.DELETE?void 0!==Y.previousValue&&(null===(X=S[G.OPERATION.DELETE])||void 0===X||X.forEach((function(G){var V;return G(Y.previousValue,null!==(V=Y.dynamicIndex)&&void 0!==V?V:Y.field)}))):Y.op===G.OPERATION.DELETE_AND_ADD&&(void 0!==Y.previousValue&&(null===(P=S[G.OPERATION.DELETE])||void 0===P||P.forEach((function(G){var V;return G(Y.previousValue,null!==(V=Y.dynamicIndex)&&void 0!==V?V:Y.field)}))),null===(A=S[G.OPERATION.ADD])||void 0===A||A.forEach((function(G){var V;return G(Y.value,null!==(V=Y.dynamicIndex)&&void 0!==V?V:Y.field)}))),Y.value!==Y.previousValue&&(null===(x=S[G.OPERATION.REPLACE])||void 0===x||x.forEach((function(G){var V;return G(Y.value,null!==(V=Y.dynamicIndex)&&void 0!==V?V:Y.field)})));q.add(g)},Y=0;Y<W.length;Y++)t(Y)},V._definition=b.create(),V}();function CG(G){for(var V=[G.$changes],W=1,J={},R=J,d=function(G){var W=V[G];W.changes.forEach((function(G){var V=W.ref,J=G.index,d=V._definition?V._definition.fieldsByIndex[J]:V.$indexes.get(J);R[d]=W.getValue(J)}))},k=0;k<W;k++)d(k);return J}var lG={context:new y},mG=function(G){function V(){return null!==G&&G.apply(this,arguments)||this}return W(V,G),J([H("string",lG)],V.prototype,"name",void 0),J([H("string",lG)],V.prototype,"type",void 0),J([H("number",lG)],V.prototype,"referencedType",void 0),V}(vG),wG=function(G){function V(){var V=null!==G&&G.apply(this,arguments)||this;return V.fields=new t,V}return W(V,G),J([H("number",lG)],V.prototype,"id",void 0),J([H([mG],lG)],V.prototype,"fields",void 0),V}(vG),NG=function(G){function V(){var V=null!==G&&G.apply(this,arguments)||this;return V.types=new t,V}return W(V,G),V.encode=function(G){var W=G.constructor,J=new V;J.rootType=W._typeid;var R=function(G,V){for(var W in V){var R=new mG;R.name=W;var d=void 0;if("string"===typeof V[W])d=V[W];else{var k=V[W],z=void 0;vG.is(k)?(d="ref",z=V[W]):"string"===typeof k[d=Object.keys(k)[0]]?d+=":"+k[d]:z=k[d],R.referencedType=z?z._typeid:-1}R.type=d,G.fields.push(R)}J.types.push(G)},d=W._context.types;for(var k in d){var z=new wG;z.id=Number(k),R(z,d[k]._definition.schema)}return J.encodeAll()},V.decode=function(G,J){var R=new y,d=new V;d.decode(G,J);var k=d.types.reduce((function(G,V){var J=function(G){function V(){return null!==G&&G.apply(this,arguments)||this}return W(V,G),V}(vG),d=V.id;return G[d]=J,R.add(J,d),G}),{});d.types.forEach((function(G){var V=k[G.id];G.fields.forEach((function(G){var W;if(void 0!==G.referencedType){var J=G.type,d=k[G.referencedType];if(!d){var z=G.type.split(":");J=z[0],d=z[1]}"ref"===J?H(d,{context:R})(V.prototype,G.name):H(((W={})[J]=d,W),{context:R})(V.prototype,G.name)}else H(G.type,{context:R})(V.prototype,G.name)}))}));var z=k[d.rootType],X=new z;for(var P in z._definition.schema){var A=z._definition.schema[P];"string"!==typeof A&&(X[P]="function"===typeof A?new A:new(p(Object.keys(A)[0]).constructor))}return X},J([H([wG],lG)],V.prototype,"types",void 0),J([H("number",lG)],V.prototype,"rootType",void 0),V}(vG);S("map",{constructor:g}),S("array",{constructor:t}),S("set",{constructor:uG}),S("collection",{constructor:yG}),G.ArraySchema=t,G.CollectionSchema=yG,G.Context=y,G.MapSchema=g,G.Reflection=NG,G.ReflectionField=mG,G.ReflectionType=wG,G.Schema=vG,G.SchemaDefinition=b,G.SetSchema=uG,G.decode=rG,G.defineTypes=e,G.deprecated=i,G.dumpChanges=CG,G.encode=j,G.filter=n,G.filterChildren=D,G.hasFilter=r,G.registerType=S,G.type=H,Object.defineProperty(G,"__esModule",{value:!0})}(V)},13437:G=>{"use strict";G.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13428:(G,V,W)=>{var J=W(13437),R=W(13441),d=Object.hasOwnProperty,k=Object.create(null);for(var z in J)d.call(J,z)&&(k[J[z]]=z);var X=G.exports={to:{},get:{}};function P(G,V,W){return Math.min(Math.max(V,G),W)}function A(G){var V=Math.round(G).toString(16).toUpperCase();return V.length<2?"0"+V:V}X.get=function(G){var V,W;switch(G.substring(0,3).toLowerCase()){case"hsl":V=X.get.hsl(G),W="hsl";break;case"hwb":V=X.get.hwb(G),W="hwb";break;default:V=X.get.rgb(G),W="rgb"}return V?{model:W,value:V}:null},X.get.rgb=function(G){if(!G)return null;var V,W,R,k=[0,0,0,1];if(V=G.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(R=V[2],V=V[1],W=0;W<3;W++){var z=2*W;k[W]=parseInt(V.slice(z,z+2),16)}R&&(k[3]=parseInt(R,16)/255)}else if(V=G.match(/^#([a-f0-9]{3,4})$/i)){for(R=(V=V[1])[3],W=0;W<3;W++)k[W]=parseInt(V[W]+V[W],16);R&&(k[3]=parseInt(R+R,16)/255)}else if(V=G.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(W=0;W<3;W++)k[W]=parseInt(V[W+1],0);V[4]&&(V[5]?k[3]=.01*parseFloat(V[4]):k[3]=parseFloat(V[4]))}else{if(!(V=G.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(V=G.match(/^(\w+)$/))?"transparent"===V[1]?[0,0,0,0]:d.call(J,V[1])?((k=J[V[1]])[3]=1,k):null:null;for(W=0;W<3;W++)k[W]=Math.round(2.55*parseFloat(V[W+1]));V[4]&&(V[5]?k[3]=.01*parseFloat(V[4]):k[3]=parseFloat(V[4]))}for(W=0;W<3;W++)k[W]=P(k[W],0,255);return k[3]=P(k[3],0,1),k},X.get.hsl=function(G){if(!G)return null;var V=G.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(V){var W=parseFloat(V[4]);return[(parseFloat(V[1])%360+360)%360,P(parseFloat(V[2]),0,100),P(parseFloat(V[3]),0,100),P(isNaN(W)?1:W,0,1)]}return null},X.get.hwb=function(G){if(!G)return null;var V=G.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(V){var W=parseFloat(V[4]);return[(parseFloat(V[1])%360+360)%360,P(parseFloat(V[2]),0,100),P(parseFloat(V[3]),0,100),P(isNaN(W)?1:W,0,1)]}return null},X.to.hex=function(){var G=R(arguments);return"#"+A(G[0])+A(G[1])+A(G[2])+(G[3]<1?A(Math.round(255*G[3])):"")},X.to.rgb=function(){var G=R(arguments);return G.length<4||1===G[3]?"rgb("+Math.round(G[0])+", "+Math.round(G[1])+", "+Math.round(G[2])+")":"rgba("+Math.round(G[0])+", "+Math.round(G[1])+", "+Math.round(G[2])+", "+G[3]+")"},X.to.rgb.percent=function(){var G=R(arguments),V=Math.round(G[0]/255*100),W=Math.round(G[1]/255*100),J=Math.round(G[2]/255*100);return G.length<4||1===G[3]?"rgb("+V+"%, "+W+"%, "+J+"%)":"rgba("+V+"%, "+W+"%, "+J+"%, "+G[3]+")"},X.to.hsl=function(){var G=R(arguments);return G.length<4||1===G[3]?"hsl("+G[0]+", "+G[1]+"%, "+G[2]+"%)":"hsla("+G[0]+", "+G[1]+"%, "+G[2]+"%, "+G[3]+")"},X.to.hwb=function(){var G=R(arguments),V="";return G.length>=4&&1!==G[3]&&(V=", "+G[3]),"hwb("+G[0]+", "+G[1]+"%, "+G[2]+"%"+V+")"},X.to.keyword=function(G){return k[G.slice(0,3)]}},13420:(G,V,W)=>{const J=W(13428),R=W(13453),d=["keyword","gray","hex"],k={};for(const L of Object.keys(R))k[[...R[L].labels].sort().join("")]=L;const z={};function X(G,V){if(!(this instanceof X))return new X(G,V);if(V&&V in d&&(V=null),V&&!(V in R))throw new Error("Unknown model: "+V);let W,P;if(null==G)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(G instanceof X)this.model=G.model,this.color=[...G.color],this.valpha=G.valpha;else if("string"===typeof G){const V=J.get(G);if(null===V)throw new Error("Unable to parse color from string: "+G);this.model=V.model,P=R[this.model].channels,this.color=V.value.slice(0,P),this.valpha="number"===typeof V.value[P]?V.value[P]:1}else if(G.length>0){this.model=V||"rgb",P=R[this.model].channels;const W=Array.prototype.slice.call(G,0,P);this.color=q(W,P),this.valpha="number"===typeof G[P]?G[P]:1}else if("number"===typeof G)this.model="rgb",this.color=[G>>16&255,G>>8&255,255&G],this.valpha=1;else{this.valpha=1;const V=Object.keys(G);"alpha"in G&&(V.splice(V.indexOf("alpha"),1),this.valpha="number"===typeof G.alpha?G.alpha:0);const J=V.sort().join("");if(!(J in k))throw new Error("Unable to parse color from object: "+JSON.stringify(G));this.model=k[J];const{labels:d}=R[this.model],z=[];for(W=0;W<d.length;W++)z.push(G[d[W]]);this.color=q(z)}if(z[this.model])for(P=R[this.model].channels,W=0;W<P;W++){const G=z[this.model][W];G&&(this.color[W]=G(this.color[W]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}X.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(G){let V=this.model in J.to?this:this.rgb();V=V.round("number"===typeof G?G:1);const W=1===V.valpha?V.color:[...V.color,this.valpha];return J.to[V.model](W)},percentString(G){const V=this.rgb().round("number"===typeof G?G:1),W=1===V.valpha?V.color:[...V.color,this.valpha];return J.to.rgb.percent(W)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const G={},{channels:V}=R[this.model],{labels:W}=R[this.model];for(let J=0;J<V;J++)G[W[J]]=this.color[J];return 1!==this.valpha&&(G.alpha=this.valpha),G},unitArray(){const G=this.rgb().color;return G[0]/=255,G[1]/=255,G[2]/=255,1!==this.valpha&&G.push(this.valpha),G},unitObject(){const G=this.rgb().object();return G.r/=255,G.g/=255,G.b/=255,1!==this.valpha&&(G.alpha=this.valpha),G},round(G){return G=Math.max(G||0,0),new X([...this.color.map(P(G)),this.valpha],this.model)},alpha(G){return void 0!==G?new X([...this.color,Math.max(0,Math.min(1,G))],this.model):this.valpha},red:A("rgb",0,x(255)),green:A("rgb",1,x(255)),blue:A("rgb",2,x(255)),hue:A(["hsl","hsv","hsl","hwb","hcg"],0,(G=>(G%360+360)%360)),saturationl:A("hsl",1,x(100)),lightness:A("hsl",2,x(100)),saturationv:A("hsv",1,x(100)),value:A("hsv",2,x(100)),chroma:A("hcg",1,x(100)),gray:A("hcg",2,x(100)),white:A("hwb",1,x(100)),wblack:A("hwb",2,x(100)),cyan:A("cmyk",0,x(100)),magenta:A("cmyk",1,x(100)),yellow:A("cmyk",2,x(100)),black:A("cmyk",3,x(100)),x:A("xyz",0,x(95.047)),y:A("xyz",1,x(100)),z:A("xyz",2,x(108.833)),l:A("lab",0,x(100)),a:A("lab",1),b:A("lab",2),keyword(G){return void 0!==G?new X(G):R[this.model].keyword(this.color)},hex(G){return void 0!==G?new X(G):J.to.hex(this.rgb().round().color)},hexa(G){if(void 0!==G)return new X(G);const V=this.rgb().round().color;let W=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===W.length&&(W="0"+W),J.to.hex(V)+W},rgbNumber(){const G=this.rgb().color;return(255&G[0])<<16|(255&G[1])<<8|255&G[2]},luminosity(){const G=this.rgb().color,V=[];for(const[W,J]of G.entries()){const G=J/255;V[W]=G<=.04045?G/12.92:((G+.055)/1.055)**2.4}return.2126*V[0]+.7152*V[1]+.0722*V[2]},contrast(G){const V=this.luminosity(),W=G.luminosity();return V>W?(V+.05)/(W+.05):(W+.05)/(V+.05)},level(G){const V=this.contrast(G);return V>=7?"AAA":V>=4.5?"AA":""},isDark(){const G=this.rgb().color;return(2126*G[0]+7152*G[1]+722*G[2])/1e4<128},isLight(){return!this.isDark()},negate(){const G=this.rgb();for(let V=0;V<3;V++)G.color[V]=255-G.color[V];return G},lighten(G){const V=this.hsl();return V.color[2]+=V.color[2]*G,V},darken(G){const V=this.hsl();return V.color[2]-=V.color[2]*G,V},saturate(G){const V=this.hsl();return V.color[1]+=V.color[1]*G,V},desaturate(G){const V=this.hsl();return V.color[1]-=V.color[1]*G,V},whiten(G){const V=this.hwb();return V.color[1]+=V.color[1]*G,V},blacken(G){const V=this.hwb();return V.color[2]+=V.color[2]*G,V},grayscale(){const G=this.rgb().color,V=.3*G[0]+.59*G[1]+.11*G[2];return X.rgb(V,V,V)},fade(G){return this.alpha(this.valpha-this.valpha*G)},opaquer(G){return this.alpha(this.valpha+this.valpha*G)},rotate(G){const V=this.hsl();let W=V.color[0];return W=(W+G)%360,W=W<0?360+W:W,V.color[0]=W,V},mix(G,V){if(!G||!G.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof G);const W=G.rgb(),J=this.rgb(),R=void 0===V?.5:V,d=2*R-1,k=W.alpha()-J.alpha(),z=((d*k===-1?d:(d+k)/(1+d*k))+1)/2,P=1-z;return X.rgb(z*W.red()+P*J.red(),z*W.green()+P*J.green(),z*W.blue()+P*J.blue(),W.alpha()*R+J.alpha()*(1-R))}};for(const L of Object.keys(R)){if(d.includes(L))continue;const{channels:G}=R[L];X.prototype[L]=function(){if(this.model===L)return new X(this);for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];return V.length>0?new X(V,L):new X([...(J=R[this.model][L].raw(this.color),Array.isArray(J)?J:[J]),this.valpha],L);var J},X[L]=function(){for(var V=arguments.length,W=new Array(V),J=0;J<V;J++)W[J]=arguments[J];let R=W[0];return"number"===typeof R&&(R=q(W,G)),new X(R,L)}}function P(G){return function(V){return function(G,V){return Number(G.toFixed(V))}(V,G)}}function A(G,V,W){G=Array.isArray(G)?G:[G];for(const J of G)(z[J]||(z[J]=[]))[V]=W;return G=G[0],function(J){let R;return void 0!==J?(W&&(J=W(J)),R=this[G](),R.color[V]=J,R):(R=this[G]().color[V],W&&(R=W(R)),R)}}function x(G){return function(V){return Math.max(0,Math.min(G,V))}}function q(G,V){for(let W=0;W<V;W++)"number"!==typeof G[W]&&(G[W]=0);return G}G.exports=X},13458:(G,V,W)=>{const J=W(13466),R={};for(const k of Object.keys(J))R[J[k]]=k;const d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};G.exports=d;for(const k of Object.keys(d)){if(!("channels"in d[k]))throw new Error("missing channels property: "+k);if(!("labels"in d[k]))throw new Error("missing channel labels property: "+k);if(d[k].labels.length!==d[k].channels)throw new Error("channel and label counts mismatch: "+k);const{channels:G,labels:V}=d[k];delete d[k].channels,delete d[k].labels,Object.defineProperty(d[k],"channels",{value:G}),Object.defineProperty(d[k],"labels",{value:V})}d.rgb.hsl=function(G){const V=G[0]/255,W=G[1]/255,J=G[2]/255,R=Math.min(V,W,J),d=Math.max(V,W,J),k=d-R;let z,X;d===R?z=0:V===d?z=(W-J)/k:W===d?z=2+(J-V)/k:J===d&&(z=4+(V-W)/k),z=Math.min(60*z,360),z<0&&(z+=360);const P=(R+d)/2;return X=d===R?0:P<=.5?k/(d+R):k/(2-d-R),[z,100*X,100*P]},d.rgb.hsv=function(G){let V,W,J,R,d;const k=G[0]/255,z=G[1]/255,X=G[2]/255,P=Math.max(k,z,X),A=P-Math.min(k,z,X),x=function(G){return(P-G)/6/A+.5};return 0===A?(R=0,d=0):(d=A/P,V=x(k),W=x(z),J=x(X),k===P?R=J-W:z===P?R=1/3+V-J:X===P&&(R=2/3+W-V),R<0?R+=1:R>1&&(R-=1)),[360*R,100*d,100*P]},d.rgb.hwb=function(G){const V=G[0],W=G[1];let J=G[2];const R=d.rgb.hsl(G)[0],k=1/255*Math.min(V,Math.min(W,J));return J=1-1/255*Math.max(V,Math.max(W,J)),[R,100*k,100*J]},d.rgb.cmyk=function(G){const V=G[0]/255,W=G[1]/255,J=G[2]/255,R=Math.min(1-V,1-W,1-J);return[100*((1-V-R)/(1-R)||0),100*((1-W-R)/(1-R)||0),100*((1-J-R)/(1-R)||0),100*R]},d.rgb.keyword=function(G){const V=R[G];if(V)return V;let W,d=1/0;for(const R of Object.keys(J)){const V=J[R],X=(z=V,((k=G)[0]-z[0])**2+(k[1]-z[1])**2+(k[2]-z[2])**2);X<d&&(d=X,W=R)}var k,z;return W},d.keyword.rgb=function(G){return J[G]},d.rgb.xyz=function(G){let V=G[0]/255,W=G[1]/255,J=G[2]/255;V=V>.04045?((V+.055)/1.055)**2.4:V/12.92,W=W>.04045?((W+.055)/1.055)**2.4:W/12.92,J=J>.04045?((J+.055)/1.055)**2.4:J/12.92;return[100*(.4124*V+.3576*W+.1805*J),100*(.2126*V+.7152*W+.0722*J),100*(.0193*V+.1192*W+.9505*J)]},d.rgb.lab=function(G){const V=d.rgb.xyz(G);let W=V[0],J=V[1],R=V[2];W/=95.047,J/=100,R/=108.883,W=W>.008856?W**(1/3):7.787*W+16/116,J=J>.008856?J**(1/3):7.787*J+16/116,R=R>.008856?R**(1/3):7.787*R+16/116;return[116*J-16,500*(W-J),200*(J-R)]},d.hsl.rgb=function(G){const V=G[0]/360,W=G[1]/100,J=G[2]/100;let R,d,k;if(0===W)return k=255*J,[k,k,k];R=J<.5?J*(1+W):J+W-J*W;const z=2*J-R,X=[0,0,0];for(let P=0;P<3;P++)d=V+1/3*-(P-1),d<0&&d++,d>1&&d--,k=6*d<1?z+6*(R-z)*d:2*d<1?R:3*d<2?z+(R-z)*(2/3-d)*6:z,X[P]=255*k;return X},d.hsl.hsv=function(G){const V=G[0];let W=G[1]/100,J=G[2]/100,R=W;const d=Math.max(J,.01);J*=2,W*=J<=1?J:2-J,R*=d<=1?d:2-d;return[V,100*(0===J?2*R/(d+R):2*W/(J+W)),100*((J+W)/2)]},d.hsv.rgb=function(G){const V=G[0]/60,W=G[1]/100;let J=G[2]/100;const R=Math.floor(V)%6,d=V-Math.floor(V),k=255*J*(1-W),z=255*J*(1-W*d),X=255*J*(1-W*(1-d));switch(J*=255,R){case 0:return[J,X,k];case 1:return[z,J,k];case 2:return[k,J,X];case 3:return[k,z,J];case 4:return[X,k,J];case 5:return[J,k,z]}},d.hsv.hsl=function(G){const V=G[0],W=G[1]/100,J=G[2]/100,R=Math.max(J,.01);let d,k;k=(2-W)*J;const z=(2-W)*R;return d=W*R,d/=z<=1?z:2-z,d=d||0,k/=2,[V,100*d,100*k]},d.hwb.rgb=function(G){const V=G[0]/360;let W=G[1]/100,J=G[2]/100;const R=W+J;let d;R>1&&(W/=R,J/=R);const k=Math.floor(6*V),z=1-J;d=6*V-k,0!==(1&k)&&(d=1-d);const X=W+d*(z-W);let P,A,x;switch(k){default:case 6:case 0:P=z,A=X,x=W;break;case 1:P=X,A=z,x=W;break;case 2:P=W,A=z,x=X;break;case 3:P=W,A=X,x=z;break;case 4:P=X,A=W,x=z;break;case 5:P=z,A=W,x=X}return[255*P,255*A,255*x]},d.cmyk.rgb=function(G){const V=G[0]/100,W=G[1]/100,J=G[2]/100,R=G[3]/100;return[255*(1-Math.min(1,V*(1-R)+R)),255*(1-Math.min(1,W*(1-R)+R)),255*(1-Math.min(1,J*(1-R)+R))]},d.xyz.rgb=function(G){const V=G[0]/100,W=G[1]/100,J=G[2]/100;let R,d,k;return R=3.2406*V+-1.5372*W+-.4986*J,d=-.9689*V+1.8758*W+.0415*J,k=.0557*V+-.204*W+1.057*J,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,R=Math.min(Math.max(0,R),1),d=Math.min(Math.max(0,d),1),k=Math.min(Math.max(0,k),1),[255*R,255*d,255*k]},d.xyz.lab=function(G){let V=G[0],W=G[1],J=G[2];V/=95.047,W/=100,J/=108.883,V=V>.008856?V**(1/3):7.787*V+16/116,W=W>.008856?W**(1/3):7.787*W+16/116,J=J>.008856?J**(1/3):7.787*J+16/116;return[116*W-16,500*(V-W),200*(W-J)]},d.lab.xyz=function(G){let V,W,J;W=(G[0]+16)/116,V=G[1]/500+W,J=W-G[2]/200;const R=W**3,d=V**3,k=J**3;return W=R>.008856?R:(W-16/116)/7.787,V=d>.008856?d:(V-16/116)/7.787,J=k>.008856?k:(J-16/116)/7.787,V*=95.047,W*=100,J*=108.883,[V,W,J]},d.lab.lch=function(G){const V=G[0],W=G[1],J=G[2];let R;R=360*Math.atan2(J,W)/2/Math.PI,R<0&&(R+=360);return[V,Math.sqrt(W*W+J*J),R]},d.lch.lab=function(G){const V=G[0],W=G[1],J=G[2]/360*2*Math.PI;return[V,W*Math.cos(J),W*Math.sin(J)]},d.rgb.ansi16=function(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[W,J,R]=G;let k=null===V?d.rgb.hsv(G)[2]:V;if(k=Math.round(k/50),0===k)return 30;let z=30+(Math.round(R/255)<<2|Math.round(J/255)<<1|Math.round(W/255));return 2===k&&(z+=60),z},d.hsv.ansi16=function(G){return d.rgb.ansi16(d.hsv.rgb(G),G[2])},d.rgb.ansi256=function(G){const V=G[0],W=G[1],J=G[2];if(V===W&&W===J)return V<8?16:V>248?231:Math.round((V-8)/247*24)+232;return 16+36*Math.round(V/255*5)+6*Math.round(W/255*5)+Math.round(J/255*5)},d.ansi16.rgb=function(G){let V=G%10;if(0===V||7===V)return G>50&&(V+=3.5),V=V/10.5*255,[V,V,V];const W=.5*(1+~~(G>50));return[(1&V)*W*255,(V>>1&1)*W*255,(V>>2&1)*W*255]},d.ansi256.rgb=function(G){if(G>=232){const V=10*(G-232)+8;return[V,V,V]}let V;G-=16;return[Math.floor(G/36)/5*255,Math.floor((V=G%36)/6)/5*255,V%6/5*255]},d.rgb.hex=function(G){const V=(((255&Math.round(G[0]))<<16)+((255&Math.round(G[1]))<<8)+(255&Math.round(G[2]))).toString(16).toUpperCase();return"000000".substring(V.length)+V},d.hex.rgb=function(G){const V=G.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!V)return[0,0,0];let W=V[0];3===V[0].length&&(W=W.split("").map((G=>G+G)).join(""));const J=parseInt(W,16);return[J>>16&255,J>>8&255,255&J]},d.rgb.hcg=function(G){const V=G[0]/255,W=G[1]/255,J=G[2]/255,R=Math.max(Math.max(V,W),J),d=Math.min(Math.min(V,W),J),k=R-d;let z,X;return z=k<1?d/(1-k):0,X=k<=0?0:R===V?(W-J)/k%6:R===W?2+(J-V)/k:4+(V-W)/k,X/=6,X%=1,[360*X,100*k,100*z]},d.hsl.hcg=function(G){const V=G[1]/100,W=G[2]/100,J=W<.5?2*V*W:2*V*(1-W);let R=0;return J<1&&(R=(W-.5*J)/(1-J)),[G[0],100*J,100*R]},d.hsv.hcg=function(G){const V=G[1]/100,W=G[2]/100,J=V*W;let R=0;return J<1&&(R=(W-J)/(1-J)),[G[0],100*J,100*R]},d.hcg.rgb=function(G){const V=G[0]/360,W=G[1]/100,J=G[2]/100;if(0===W)return[255*J,255*J,255*J];const R=[0,0,0],d=V%1*6,k=d%1,z=1-k;let X=0;switch(Math.floor(d)){case 0:R[0]=1,R[1]=k,R[2]=0;break;case 1:R[0]=z,R[1]=1,R[2]=0;break;case 2:R[0]=0,R[1]=1,R[2]=k;break;case 3:R[0]=0,R[1]=z,R[2]=1;break;case 4:R[0]=k,R[1]=0,R[2]=1;break;default:R[0]=1,R[1]=0,R[2]=z}return X=(1-W)*J,[255*(W*R[0]+X),255*(W*R[1]+X),255*(W*R[2]+X)]},d.hcg.hsv=function(G){const V=G[1]/100,W=V+G[2]/100*(1-V);let J=0;return W>0&&(J=V/W),[G[0],100*J,100*W]},d.hcg.hsl=function(G){const V=G[1]/100,W=G[2]/100*(1-V)+.5*V;let J=0;return W>0&&W<.5?J=V/(2*W):W>=.5&&W<1&&(J=V/(2*(1-W))),[G[0],100*J,100*W]},d.hcg.hwb=function(G){const V=G[1]/100,W=V+G[2]/100*(1-V);return[G[0],100*(W-V),100*(1-W)]},d.hwb.hcg=function(G){const V=G[1]/100,W=1-G[2]/100,J=W-V;let R=0;return J<1&&(R=(W-J)/(1-J)),[G[0],100*J,100*R]},d.apple.rgb=function(G){return[G[0]/65535*255,G[1]/65535*255,G[2]/65535*255]},d.rgb.apple=function(G){return[G[0]/255*65535,G[1]/255*65535,G[2]/255*65535]},d.gray.rgb=function(G){return[G[0]/100*255,G[0]/100*255,G[0]/100*255]},d.gray.hsl=function(G){return[0,0,G[0]]},d.gray.hsv=d.gray.hsl,d.gray.hwb=function(G){return[0,100,G[0]]},d.gray.cmyk=function(G){return[0,0,0,G[0]]},d.gray.lab=function(G){return[G[0],0,0]},d.gray.hex=function(G){const V=255&Math.round(G[0]/100*255),W=((V<<16)+(V<<8)+V).toString(16).toUpperCase();return"000000".substring(W.length)+W},d.rgb.gray=function(G){return[(G[0]+G[1]+G[2])/3/255*100]}},13453:(G,V,W)=>{const J=W(13458),R=W(13469),d={};Object.keys(J).forEach((G=>{d[G]={},Object.defineProperty(d[G],"channels",{value:J[G].channels}),Object.defineProperty(d[G],"labels",{value:J[G].labels});const V=R(G);Object.keys(V).forEach((W=>{const J=V[W];d[G][W]=function(G){const V=function(){for(var V=arguments.length,W=new Array(V),J=0;J<V;J++)W[J]=arguments[J];const R=W[0];if(void 0===R||null===R)return R;R.length>1&&(W=R);const d=G(W);if("object"===typeof d)for(let G=d.length,k=0;k<G;k++)d[k]=Math.round(d[k]);return d};return"conversion"in G&&(V.conversion=G.conversion),V}(J),d[G][W].raw=function(G){const V=function(){for(var V=arguments.length,W=new Array(V),J=0;J<V;J++)W[J]=arguments[J];const R=W[0];return void 0===R||null===R?R:(R.length>1&&(W=R),G(W))};return"conversion"in G&&(V.conversion=G.conversion),V}(J)}))})),G.exports=d},13469:(G,V,W)=>{const J=W(13458);function R(G){const V=function(){const G={},V=Object.keys(J);for(let W=V.length,J=0;J<W;J++)G[V[J]]={distance:-1,parent:null};return G}(),W=[G];for(V[G].distance=0;W.length;){const G=W.pop(),R=Object.keys(J[G]);for(let J=R.length,d=0;d<J;d++){const J=R[d],k=V[J];-1===k.distance&&(k.distance=V[G].distance+1,k.parent=G,W.unshift(J))}}return V}function d(G,V){return function(W){return V(G(W))}}function k(G,V){const W=[V[G].parent,G];let R=J[V[G].parent][G],k=V[G].parent;for(;V[k].parent;)W.unshift(V[k].parent),R=d(J[V[k].parent][k],R),k=V[k].parent;return R.conversion=W,R}G.exports=function(G){const V=R(G),W={},J=Object.keys(V);for(let R=J.length,d=0;d<R;d++){const G=J[d];null!==V[G].parent&&(W[G]=k(G,V))}return W}},13466:G=>{"use strict";G.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12032:function(G,V,W){"use strict";var J=this&&this.__createBinding||(Object.create?function(G,V,W,J){void 0===J&&(J=W);var R=Object.getOwnPropertyDescriptor(V,W);R&&!("get"in R?!V.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return V[W]}}),Object.defineProperty(G,J,R)}:function(G,V,W,J){void 0===J&&(J=W),G[J]=V[W]}),R=this&&this.__setModuleDefault||(Object.create?function(G,V){Object.defineProperty(G,"default",{enumerable:!0,value:V})}:function(G,V){G.default=V}),d=this&&this.__importStar||function(G){if(G&&G.__esModule)return G;var V={};if(null!=G)for(var W in G)"default"!==W&&Object.prototype.hasOwnProperty.call(G,W)&&J(V,G,W);return R(V,G),V},k=this&&this.__awaiter||function(G,V,W,J){return new(W||(W=Promise))((function(R,d){function k(G){try{X(J.next(G))}catch(V){d(V)}}function z(G){try{X(J.throw(G))}catch(V){d(V)}}function X(G){var V;G.done?R(G.value):(V=G.value,V instanceof W?V:new W((function(G){G(V)}))).then(k,z)}X((J=J.apply(G,V||[])).next())}))};Object.defineProperty(V,"__esModule",{value:!0}),V.Auth=V.Platform=void 0;const z=d(W(11972)),X=W(12041),P="colyseus-auth-token";!function(G){G.ios="ios",G.android="android"}(V.Platform||(V.Platform={}));V.Auth=class{constructor(G){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=G.replace("ws","http"),(0,X.getItem)(P,(G=>this.token=G))}get hasToken(){return!!this.token}login(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return k(this,void 0,void 0,(function*(){const V=Object.assign({},G);this.hasToken&&(V.token=this.token);const W=yield this.request("post","/auth",V);this.token=W.token,(0,X.setItem)(P,this.token);for(let G in W)this.hasOwnProperty(G)&&(this[G]=W[G]);return this.registerPingService(),this}))}save(){return k(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return k(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return k(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return k(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(G){return k(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:G})}))}acceptFriendRequest(G){return k(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:G})}))}declineFriendRequest(G){return k(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:G})}))}blockUser(G){return k(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:G})}))}unblockUser(G){return k(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:G})}))}request(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return k(this,void 0,void 0,(function*(){R.Accept="application/json",this.hasToken&&(R.Authorization="Bearer "+this.token);const d=[];for(const G in W)d.push(`${G}=${W[G]}`);const k=d.length>0?`?${d.join("&")}`:"",X={headers:R};return J&&(X.body=J),(yield z[G](`${this.endpoint}${V}${k}`,X)).data}))}logout(){this.token=void 0,(0,X.removeItem)(P),this.unregisterPingService()}registerPingService(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),G)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11966:function(G,V,W){"use strict";var J,R=this&&this.__awaiter||function(G,V,W,J){return new(W||(W=Promise))((function(R,d){function k(G){try{X(J.next(G))}catch(V){d(V)}}function z(G){try{X(J.throw(G))}catch(V){d(V)}}function X(G){var V;G.done?R(G.value):(V=G.value,V instanceof W?V:new W((function(G){G(V)}))).then(k,z)}X((J=J.apply(G,V||[])).next())}))};Object.defineProperty(V,"__esModule",{value:!0}),V.Client=V.MatchMakeError=void 0;const d=W(11972),k=W(11975),z=W(11982);class X extends Error{constructor(G,V){super(G),this.code=V,Object.setPrototypeOf(this,X.prototype)}}V.MatchMakeError=X;const P="undefined"!==typeof window&&"undefined"!==typeof(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";V.Client=class{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P;if("string"===typeof G){const V=new URL(G),W="https:"===V.protocol||"wss:"===V.protocol,J=Number(V.port||(W?443:80));this.settings={hostname:V.hostname,pathname:"/"!==V.pathname?V.pathname:"",port:J,secure:W}}else void 0===G.port&&(G.port=G.secure?443:80),void 0===G.pathname&&(G.pathname=""),this.settings=G}joinOrCreate(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",G,V,W)}))}create(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",G,V,W)}))}join(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",G,V,W)}))}joinById(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",G,V,W)}))}reconnect(G,V){return R(this,void 0,void 0,(function*(){if("string"===typeof G&&"string"===typeof V)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[W,J]=G.split(":");return yield this.createMatchMakeRequest("reconnect",W,{reconnectionToken:J},V)}))}getAvailableRooms(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return R(this,void 0,void 0,(function*(){return(yield(0,d.get)(this.getHttpEndpoint(`${G}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(G,V,W){return R(this,void 0,void 0,(function*(){const J=this.createRoom(G.room.name,V);J.roomId=G.room.roomId,J.sessionId=G.sessionId;const d={sessionId:J.sessionId};G.reconnectionToken&&(d.reconnectionToken=G.reconnectionToken);const z=W||J;return J.connect(this.buildEndpoint(G.room,d),G.devMode&&(()=>R(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${J.roomId}'...`);let W=0;const d=()=>R(this,void 0,void 0,(function*(){W++;try{yield this.consumeSeatReservation(G,V,z),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${J.roomId}'`)}catch(R){W<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${W} out of 8)`),setTimeout(d,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(d,2e3)}))),z),new Promise(((G,V)=>{const W=(G,W)=>V(new k.ServerError(G,W));z.onError.once(W),z.onJoin.once((()=>{z.onError.remove(W),G(z)}))}))}))}createMatchMakeRequest(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;return R(this,void 0,void 0,(function*(){const R=(yield(0,d.post)(this.getHttpEndpoint(`${G}/${V}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(W)})).data;if(R.error)throw new X(R.error,R.code);return"reconnect"===G&&(R.reconnectionToken=W.reconnectionToken),yield this.consumeSeatReservation(R,J,k)}))}createRoom(G,V){return new z.Room(G,V)}buildEndpoint(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=[];for(const R in V)V.hasOwnProperty(R)&&W.push(`${R}=${V[R]}`);let J=this.settings.secure?"wss://":"ws://";return G.publicAddress?J+=`${G.publicAddress}`:J+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${J}/${G.processId}/${G.roomId}?${W.join("&")}`}getHttpEndpoint(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${G}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11993:(G,V,W)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.Connection=void 0;const J=W(12001);V.Connection=class{constructor(){this.events={},this.transport=new J.WebSocketTransport(this.events)}send(G){this.transport.send(G)}connect(G){this.transport.connect(G)}close(G,V){this.transport.close(G,V)}get isOpen(){return this.transport.isOpen}}},12007:(G,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.utf8Length=V.utf8Read=V.ErrorCode=V.Protocol=void 0,function(G){G[G.HANDSHAKE=9]="HANDSHAKE",G[G.JOIN_ROOM=10]="JOIN_ROOM",G[G.ERROR=11]="ERROR",G[G.LEAVE_ROOM=12]="LEAVE_ROOM",G[G.ROOM_DATA=13]="ROOM_DATA",G[G.ROOM_STATE=14]="ROOM_STATE",G[G.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",G[G.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",G[G.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(V.Protocol||(V.Protocol={})),function(G){G[G.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",G[G.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",G[G.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",G[G.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",G[G.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",G[G.AUTH_FAILED=4215]="AUTH_FAILED",G[G.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(V.ErrorCode||(V.ErrorCode={})),V.utf8Read=function(G,V){const W=G[V++];for(var J="",R=0,d=V,k=V+W;d<k;d++){var z=G[d];if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(R=(7&z)<<18|(63&G[++d])<<12|(63&G[++d])<<6|63&G[++d])>=65536?(R-=65536,J+=String.fromCharCode(55296+(R>>>10),56320+(1023&R))):J+=String.fromCharCode(R)}else J+=String.fromCharCode((15&z)<<12|(63&G[++d])<<6|63&G[++d]);else J+=String.fromCharCode((31&z)<<6|63&G[++d]);else J+=String.fromCharCode(z)}return J},V.utf8Length=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",V=0,W=0;for(let J=0,R=G.length;J<R;J++)V=G.charCodeAt(J),V<128?W+=1:V<2048?W+=2:V<55296||V>=57344?W+=3:(J++,W+=4);return W+1}},11982:function(G,V,W){"use strict";var J=this&&this.__createBinding||(Object.create?function(G,V,W,J){void 0===J&&(J=W);var R=Object.getOwnPropertyDescriptor(V,W);R&&!("get"in R?!V.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return V[W]}}),Object.defineProperty(G,J,R)}:function(G,V,W,J){void 0===J&&(J=W),G[J]=V[W]}),R=this&&this.__setModuleDefault||(Object.create?function(G,V){Object.defineProperty(G,"default",{enumerable:!0,value:V})}:function(G,V){G.default=V}),d=this&&this.__importStar||function(G){if(G&&G.__esModule)return G;var V={};if(null!=G)for(var W in G)"default"!==W&&Object.prototype.hasOwnProperty.call(G,W)&&J(V,G,W);return R(V,G),V};Object.defineProperty(V,"__esModule",{value:!0}),V.Room=void 0;const k=d(W(11986)),z=W(11993),X=W(12007),P=W(12010),A=W(12015),x=W(12019),q=W(12023),L=W(11975);class t{constructor(G,V){this.onStateChange=(0,x.createSignal)(),this.onError=(0,x.createSignal)(),this.onLeave=(0,x.createSignal)(),this.onJoin=(0,x.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,A.createNanoEvents)(),this.roomId=null,this.name=G,V&&(this.serializer=new((0,P.getSerializer)("schema")),this.rootSchema=V,this.serializer.state=new V),this.onError(((G,V)=>{var W;return null===(W=console.warn)||void 0===W?void 0:W.call(console,`colyseus.js - onError => (${G}) ${V}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const J=new z.Connection;W.connection=J,J.events.onmessage=t.prototype.onMessageCallback.bind(W),J.events.onclose=function(G){var J;if(!W.hasJoined)return null===(J=console.warn)||void 0===J||J.call(console,`Room connection was closed unexpectedly (${G.code}): ${G.reason}`),void W.onError.invoke(G.code,G.reason);G.code===L.CloseCode.DEVMODE_RESTART&&V?V():(W.onLeave.invoke(G.code),W.destroy())},J.events.onerror=function(G){var V;null===(V=console.warn)||void 0===V||V.call(console,`Room, onError (${G.code}): ${G.reason}`),W.onError.invoke(G.code,G.reason)},J.connect(G)}leave(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((V=>{this.onLeave((G=>V(G))),this.connection?G?this.connection.send([X.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(L.CloseCode.CONSENTED)}))}onMessage(G,V){return this.onMessageHandlers.on(this.getMessageHandlerKey(G),V)}send(G,V){const W=[X.Protocol.ROOM_DATA];let J;if("string"===typeof G?q.encode.string(W,G):q.encode.number(W,G),void 0!==V){const G=k.encode(V);J=new Uint8Array(W.length+G.byteLength),J.set(new Uint8Array(W),0),J.set(new Uint8Array(G),W.length)}else J=new Uint8Array(W);this.connection.send(J.buffer)}sendBytes(G,V){const W=[X.Protocol.ROOM_DATA_BYTES];let J;"string"===typeof G?q.encode.string(W,G):q.encode.number(W,G),J=new Uint8Array(W.length+(V.byteLength||V.length)),J.set(new Uint8Array(W),0),J.set(new Uint8Array(V),W.length),this.connection.send(J.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(G){const V=Array.from(new Uint8Array(G.data)),W=V[0];if(W===X.Protocol.JOIN_ROOM){let G=1;const W=(0,X.utf8Read)(V,G);if(G+=(0,X.utf8Length)(W),this.serializerId=(0,X.utf8Read)(V,G),G+=(0,X.utf8Length)(this.serializerId),!this.serializer){const G=(0,P.getSerializer)(this.serializerId);this.serializer=new G}V.length>G&&this.serializer.handshake&&this.serializer.handshake(V,{offset:G}),this.reconnectionToken=`${this.roomId}:${W}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([X.Protocol.JOIN_ROOM])}else if(W===X.Protocol.ERROR){const G={offset:1},W=q.decode.number(V,G),J=q.decode.string(V,G);this.onError.invoke(W,J)}else if(W===X.Protocol.LEAVE_ROOM)this.leave();else if(W===X.Protocol.ROOM_DATA_SCHEMA){const G={offset:1},W=this.serializer.getState().constructor._context.get(q.decode.number(V,G)),J=new W;J.decode(V,G),this.dispatchMessage(W,J)}else if(W===X.Protocol.ROOM_STATE)V.shift(),this.setState(V);else if(W===X.Protocol.ROOM_STATE_PATCH)V.shift(),this.patch(V);else if(W===X.Protocol.ROOM_DATA){const W={offset:1},J=q.decode.stringCheck(V,W)?q.decode.string(V,W):q.decode.number(V,W),R=V.length>W.offset?k.decode(G.data,W.offset):void 0;this.dispatchMessage(J,R)}else if(W===X.Protocol.ROOM_DATA_BYTES){const G={offset:1},W=q.decode.stringCheck(V,G)?q.decode.string(V,G):q.decode.number(V,G);this.dispatchMessage(W,new Uint8Array(V.slice(G.offset)))}}setState(G){this.serializer.setState(G),this.onStateChange.invoke(this.serializer.getState())}patch(G){this.serializer.patch(G),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(G,V){var W;const J=this.getMessageHandlerKey(G);this.onMessageHandlers.events[J]?this.onMessageHandlers.emit(J,V):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",G,V):null===(W=console.warn)||void 0===W||W.call(console,`colyseus.js: onMessage() not registered for type '${G}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(G){switch(typeof G){case"function":return`$${G._typeid}`;case"string":return G;case"number":return`i${G}`;default:throw new Error("invalid message type.")}}}V.Room=t},12041:(G,V)=>{"use strict";let W;function J(){return W||(W="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(G,V){this.cache[G]=V},getItem:function(G){this.cache[G]},removeItem:function(G){delete this.cache[G]}}),W}Object.defineProperty(V,"__esModule",{value:!0}),V.getItem=V.removeItem=V.setItem=void 0,V.setItem=function(G,V){J().setItem(G,V)},V.removeItem=function(G){J().removeItem(G)},V.getItem=function(G,V){const W=J().getItem(G);"undefined"!==typeof Promise&&W instanceof Promise?W.then((G=>V(G))):V(W)}},12015:(G,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.createNanoEvents=void 0;V.createNanoEvents=()=>({emit(G){let V=this.events[G]||[];for(var W=arguments.length,J=new Array(W>1?W-1:0),R=1;R<W;R++)J[R-1]=arguments[R];for(let d=0,k=V.length;d<k;d++)V[d](...J)},events:{},on(G,V){var W;return(null===(W=this.events[G])||void 0===W?void 0:W.push(V))||(this.events[G]=[V]),()=>{var W;this.events[G]=null===(W=this.events[G])||void 0===W?void 0:W.filter((G=>V!==G))}}})},12019:(G,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.createSignal=V.EventEmitter=void 0;class W{constructor(){this.handlers=[]}register(G){return this.handlers.push(G),this}invoke(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];this.handlers.forEach((G=>G.apply(this,V)))}invokeAsync(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];return Promise.all(this.handlers.map((G=>G.apply(this,V))))}remove(G){const V=this.handlers.indexOf(G);this.handlers[V]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}V.EventEmitter=W,V.createSignal=function(){const G=new W;function V(V){return G.register(V,null===this)}return V.once=V=>{const W=function(){for(var J=arguments.length,R=new Array(J),d=0;d<J;d++)R[d]=arguments[d];V.apply(this,R),G.remove(W)};G.register(W)},V.remove=V=>G.remove(V),V.invoke=function(){return G.invoke(...arguments)},V.invokeAsync=function(){return G.invokeAsync(...arguments)},V.clear=()=>G.clear(),V}},11975:(G,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.ServerError=V.CloseCode=void 0,function(G){G[G.CONSENTED=4e3]="CONSENTED",G[G.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(V.CloseCode||(V.CloseCode={}));class W extends Error{constructor(G,V){super(V),this.name="ServerError",this.code=G}}V.ServerError=W},11955:(G,V,W)=>{"use strict";V.c=void 0,W(11963);var J=W(11966);Object.defineProperty(V,"c",{enumerable:!0,get:function(){return J.Client}});var R=W(12007);var d=W(11982);var k=W(12032);const z=W(12050);const X=W(12055),P=W(12010);(0,P.registerSerializer)("schema",z.SchemaSerializer),(0,P.registerSerializer)("none",X.NoneSerializer)},11963:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=G=>null!==G&&"object"===typeof G&&G.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11986:(G,V)=>{"use strict";function W(G,V){if(this._offset=V,G instanceof ArrayBuffer)this._buffer=G,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(G))throw new Error("Invalid argument");this._buffer=G.buffer,this._view=new DataView(this._buffer,G.byteOffset,G.byteLength)}}Object.defineProperty(V,"__esModule",{value:!0}),V.decode=V.encode=void 0,W.prototype._array=function(G){for(var V=new Array(G),W=0;W<G;W++)V[W]=this._parse();return V},W.prototype._map=function(G){for(var V={},W=0;W<G;W++)V[this._parse()]=this._parse();return V},W.prototype._str=function(G){var V=function(G,V,W){for(var J="",R=0,d=V,k=V+W;d<k;d++){var z=G.getUint8(d);if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(R=(7&z)<<18|(63&G.getUint8(++d))<<12|(63&G.getUint8(++d))<<6|63&G.getUint8(++d))>=65536?(R-=65536,J+=String.fromCharCode(55296+(R>>>10),56320+(1023&R))):J+=String.fromCharCode(R)}else J+=String.fromCharCode((15&z)<<12|(63&G.getUint8(++d))<<6|63&G.getUint8(++d));else J+=String.fromCharCode((31&z)<<6|63&G.getUint8(++d));else J+=String.fromCharCode(z)}return J}(this._view,this._offset,G);return this._offset+=G,V},W.prototype._bin=function(G){var V=this._buffer.slice(this._offset,this._offset+G);return this._offset+=G,V},W.prototype._parse=function(){var G,V=this._view.getUint8(this._offset++),W=0,J=0,R=0,d=0;if(V<192)return V<128?V:V<144?this._map(15&V):V<160?this._array(15&V):this._str(31&V);if(V>223)return-1*(255-V+1);switch(V){case 192:return null;case 194:return!1;case 195:return!0;case 196:return W=this._view.getUint8(this._offset),this._offset+=1,this._bin(W);case 197:return W=this._view.getUint16(this._offset),this._offset+=2,this._bin(W);case 198:return W=this._view.getUint32(this._offset),this._offset+=4,this._bin(W);case 199:if(W=this._view.getUint8(this._offset),J=this._view.getInt8(this._offset+1),this._offset+=2,-1===J){var k=this._view.getUint32(this._offset);return R=this._view.getInt32(this._offset+4),d=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*R+d)+k/1e6)}return[J,this._bin(W)];case 200:return W=this._view.getUint16(this._offset),J=this._view.getInt8(this._offset+2),this._offset+=3,[J,this._bin(W)];case 201:return W=this._view.getUint32(this._offset),J=this._view.getInt8(this._offset+4),this._offset+=5,[J,this._bin(W)];case 202:return G=this._view.getFloat32(this._offset),this._offset+=4,G;case 203:return G=this._view.getFloat64(this._offset),this._offset+=8,G;case 204:return G=this._view.getUint8(this._offset),this._offset+=1,G;case 205:return G=this._view.getUint16(this._offset),this._offset+=2,G;case 206:return G=this._view.getUint32(this._offset),this._offset+=4,G;case 207:return R=this._view.getUint32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,R+d;case 208:return G=this._view.getInt8(this._offset),this._offset+=1,G;case 209:return G=this._view.getInt16(this._offset),this._offset+=2,G;case 210:return G=this._view.getInt32(this._offset),this._offset+=4,G;case 211:return R=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,R+d;case 212:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?void(this._offset+=1):[J,this._bin(1)];case 213:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(2)];case 214:return J=this._view.getInt8(this._offset),this._offset+=1,-1===J?(G=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*G)):[J,this._bin(4)];case 215:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?(R=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(R+d)):-1===J?(R=this._view.getUint32(this._offset),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&R)+d)+(R>>>2)/1e6)):[J,this._bin(8)];case 216:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(16)];case 217:return W=this._view.getUint8(this._offset),this._offset+=1,this._str(W);case 218:return W=this._view.getUint16(this._offset),this._offset+=2,this._str(W);case 219:return W=this._view.getUint32(this._offset),this._offset+=4,this._str(W);case 220:return W=this._view.getUint16(this._offset),this._offset+=2,this._array(W);case 221:return W=this._view.getUint32(this._offset),this._offset+=4,this._array(W);case 222:return W=this._view.getUint16(this._offset),this._offset+=2,this._map(W);case 223:return W=this._view.getUint32(this._offset),this._offset+=4,this._map(W)}throw new Error("Could not parse")},V.decode=function(G){var V=new W(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),J=V._parse();if(V._offset!==G.byteLength)throw new Error(G.byteLength-V._offset+" trailing bytes");return J};function J(G,V,W){for(var J=0,R=0,d=W.length;R<d;R++)(J=W.charCodeAt(R))<128?G.setUint8(V++,J):J<2048?(G.setUint8(V++,192|J>>6),G.setUint8(V++,128|63&J)):J<55296||J>=57344?(G.setUint8(V++,224|J>>12),G.setUint8(V++,128|J>>6&63),G.setUint8(V++,128|63&J)):(R++,J=65536+((1023&J)<<10|1023&W.charCodeAt(R)),G.setUint8(V++,240|J>>18),G.setUint8(V++,128|J>>12&63),G.setUint8(V++,128|J>>6&63),G.setUint8(V++,128|63&J))}function R(G,V,W){var J=typeof W,d=0,k=0,z=0,X=0,P=0,A=0;if("string"===J){if(P=function(G){for(var V=0,W=0,J=0,R=G.length;J<R;J++)(V=G.charCodeAt(J))<128?W+=1:V<2048?W+=2:V<55296||V>=57344?W+=3:(J++,W+=4);return W}(W),P<32)G.push(160|P),A=1;else if(P<256)G.push(217,P),A=2;else if(P<65536)G.push(218,P>>8,P),A=3;else{if(!(P<4294967296))throw new Error("String too long");G.push(219,P>>24,P>>16,P>>8,P),A=5}return V.push({_str:W,_length:P,_offset:G.length}),A+P}if("number"===J)return Math.floor(W)===W&&isFinite(W)?W>=0?W<128?(G.push(W),1):W<256?(G.push(204,W),2):W<65536?(G.push(205,W>>8,W),3):W<4294967296?(G.push(206,W>>24,W>>16,W>>8,W),5):(z=W/Math.pow(2,32)|0,X=W>>>0,G.push(207,z>>24,z>>16,z>>8,z,X>>24,X>>16,X>>8,X),9):W>=-32?(G.push(W),1):W>=-128?(G.push(208,W),2):W>=-32768?(G.push(209,W>>8,W),3):W>=-2147483648?(G.push(210,W>>24,W>>16,W>>8,W),5):(z=Math.floor(W/Math.pow(2,32)),X=W>>>0,G.push(211,z>>24,z>>16,z>>8,z,X>>24,X>>16,X>>8,X),9):(G.push(203),V.push({_float:W,_length:8,_offset:G.length}),9);if("object"===J){if(null===W)return G.push(192),1;if(Array.isArray(W)){if((P=W.length)<16)G.push(144|P),A=1;else if(P<65536)G.push(220,P>>8,P),A=3;else{if(!(P<4294967296))throw new Error("Array too large");G.push(221,P>>24,P>>16,P>>8,P),A=5}for(d=0;d<P;d++)A+=R(G,V,W[d]);return A}if(W instanceof Date){var x=W.getTime(),q=Math.floor(x/1e3),L=1e6*(x-1e3*q);return q>=0&&L>=0&&q<=17179869183?0===L&&q<=4294967295?(G.push(214,255,q>>24,q>>16,q>>8,q),6):(z=q/4294967296,X=4294967295&q,G.push(215,255,L>>22,L>>14,L>>6,z,X>>24,X>>16,X>>8,X),10):(z=Math.floor(q/4294967296),X=q>>>0,G.push(199,12,255,L>>24,L>>16,L>>8,L,z>>24,z>>16,z>>8,z,X>>24,X>>16,X>>8,X),15)}if(W instanceof ArrayBuffer){if((P=W.byteLength)<256)G.push(196,P),A=2;else if(P<65536)G.push(197,P>>8,P),A=3;else{if(!(P<4294967296))throw new Error("Buffer too large");G.push(198,P>>24,P>>16,P>>8,P),A=5}return V.push({_bin:W,_length:P,_offset:G.length}),A+P}if("function"===typeof W.toJSON)return R(G,V,W.toJSON());var t=[],Y="",g=Object.keys(W);for(d=0,k=g.length;d<k;d++)void 0!==W[Y=g[d]]&&"function"!==typeof W[Y]&&t.push(Y);if((P=t.length)<16)G.push(128|P),A=1;else if(P<65536)G.push(222,P>>8,P),A=3;else{if(!(P<4294967296))throw new Error("Object too large");G.push(223,P>>24,P>>16,P>>8,P),A=5}for(d=0;d<P;d++)A+=R(G,V,Y=t[d]),A+=R(G,V,W[Y]);return A}if("boolean"===J)return G.push(W?195:194),1;if("undefined"===J)return G.push(192),1;if("function"===typeof W.toJSON)return R(G,V,W.toJSON());throw new Error("Could not encode")}V.encode=function(G){var V=[],W=[],d=R(V,W,G),k=new ArrayBuffer(d),z=new DataView(k),X=0,P=0,A=-1;W.length>0&&(A=W[0]._offset);for(var x,q=0,L=0,t=0,Y=V.length;t<Y;t++)if(z.setUint8(P+t,V[t]),t+1===A){if(q=(x=W[X])._length,L=P+A,x._bin)for(var g=new Uint8Array(x._bin),B=0;B<q;B++)z.setUint8(L+B,g[B]);else x._str?J(z,L,x._str):void 0!==x._float&&z.setFloat64(L,x._float);P+=q,W[++X]&&(A=W[X]._offset)}return k}},12055:(G,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.NoneSerializer=void 0;V.NoneSerializer=class{setState(G){}getState(){return null}patch(G){}teardown(){}handshake(G){}}},12050:(G,V,W)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.SchemaSerializer=void 0;const J=W(12023);V.SchemaSerializer=class{setState(G){return this.state.decode(G)}getState(){return this.state}patch(G){return this.state.decode(G)}teardown(){var G,V;null===(V=null===(G=this.state)||void 0===G?void 0:G.$changes)||void 0===V||V.root.clearRefs()}handshake(G,V){if(this.state){(new J.Reflection).decode(G,V)}else this.state=J.Reflection.decode(G,V)}}},12010:(G,V)=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0}),V.getSerializer=V.registerSerializer=void 0;const W={};V.registerSerializer=function(G,V){W[G]=V},V.getSerializer=function(G){const V=W[G];if(!V)throw new Error("missing serializer: "+G);return V}},12001:function(G,V,W){"use strict";var J=this&&this.__importDefault||function(G){return G&&G.__esModule?G:{default:G}};Object.defineProperty(V,"__esModule",{value:!0}),V.WebSocketTransport=void 0;const R=J(W(12004)),d=globalThis.WebSocket||R.default;V.WebSocketTransport=class{constructor(G){this.events=G}send(G){G instanceof ArrayBuffer?this.ws.send(G):Array.isArray(G)&&this.ws.send(new Uint8Array(G).buffer)}connect(G){this.ws=new d(G,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(G,V){this.ws.close(G,V)}get isOpen(){return this.ws.readyState===d.OPEN}}},12004:G=>{"use strict";G.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12445:G=>{"use strict";G.exports=function(G){for(var V=new Array(G),W=0;W<G;++W)V[W]=W;return V}},12448:G=>{function V(G){return!!G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}G.exports=function(G){return null!=G&&(V(G)||function(G){return"function"===typeof G.readFloatLE&&"function"===typeof G.slice&&V(G.slice(0,0))}(G)||!!G._isBuffer)}},12439:(G,V,W)=>{var J=W(12445),R=W(12448),d="undefined"!==typeof Float64Array;function k(G,V){return G[0]-V[0]}function z(){var G,V=this.stride,W=new Array(V.length);for(G=0;G<W.length;++G)W[G]=[Math.abs(V[G]),G];W.sort(k);var J=new Array(W.length);for(G=0;G<J.length;++G)J[G]=W[G][1];return J}function X(G,V){var W=["View",V,"d",G].join("");V<0&&(W="View_Nil"+G);var R="generic"===G;if(-1===V){var d="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+G+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(d)()}if(0===V){d="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+G+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(R?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(R?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",d)(P[G][0])}d=["'use strict'"];var k=J(V),X=k.map((function(G){return"i"+G})),A="this.offset+"+k.map((function(G){return"this.stride["+G+"]*i"+G})).join("+"),x=k.map((function(G){return"b"+G})).join(","),q=k.map((function(G){return"c"+G})).join(",");d.push("function "+W+"(a,"+x+","+q+",d){this.data=a","this.shape=["+x+"]","this.stride=["+q+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+G+"'","proto.dimension="+V),d.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+k.map((function(G){return"this.shape["+G+"]"})).join("*"),"}})"),1===V?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),V<4?(d.push("function "+W+"_order(){"),2===V?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===V&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+W+"_set("+X.join(",")+",v){"),R?d.push("return this.data.set("+A+",v)}"):d.push("return this.data["+A+"]=v}"),d.push("proto.get=function "+W+"_get("+X.join(",")+"){"),R?d.push("return this.data.get("+A+")}"):d.push("return this.data["+A+"]}"),d.push("proto.index=function "+W+"_index(",X.join(),"){return "+A+"}"),d.push("proto.hi=function "+W+"_hi("+X.join(",")+"){return new "+W+"(this.data,"+k.map((function(G){return["(typeof i",G,"!=='number'||i",G,"<0)?this.shape[",G,"]:i",G,"|0"].join("")})).join(",")+","+k.map((function(G){return"this.stride["+G+"]"})).join(",")+",this.offset)}");var L=k.map((function(G){return"a"+G+"=this.shape["+G+"]"})),t=k.map((function(G){return"c"+G+"=this.stride["+G+"]"}));d.push("proto.lo=function "+W+"_lo("+X.join(",")+"){var b=this.offset,d=0,"+L.join(",")+","+t.join(","));for(var Y=0;Y<V;++Y)d.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");d.push("return new "+W+"(this.data,"+k.map((function(G){return"a"+G})).join(",")+","+k.map((function(G){return"c"+G})).join(",")+",b)}"),d.push("proto.step=function "+W+"_step("+X.join(",")+"){var "+k.map((function(G){return"a"+G+"=this.shape["+G+"]"})).join(",")+","+k.map((function(G){return"b"+G+"=this.stride["+G+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<V;++Y)d.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");d.push("return new "+W+"(this.data,"+k.map((function(G){return"a"+G})).join(",")+","+k.map((function(G){return"b"+G})).join(",")+",c)}");var g=new Array(V),B=new Array(V);for(Y=0;Y<V;++Y)g[Y]="a[i"+Y+"]",B[Y]="b[i"+Y+"]";d.push("proto.transpose=function "+W+"_transpose("+X+"){"+X.map((function(G,V){return G+"=("+G+"===undefined?"+V+":"+G+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+g.join(",")+","+B.join(",")+",this.offset)}"),d.push("proto.pick=function "+W+"_pick("+X+"){var a=[],b=[],c=this.offset");for(Y=0;Y<V;++Y)d.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+k.map((function(G){return"shape["+G+"]"})).join(",")+","+k.map((function(G){return"stride["+G+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(P[G],z)}var P={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};G.exports=function(G,V,W,J){if(void 0===G)return(0,P.array[0])([]);"number"===typeof G&&(G=[G]),void 0===V&&(V=[G.length]);var k=V.length;if(void 0===W){W=new Array(k);for(var z=k-1,A=1;z>=0;--z)W[z]=A,A*=V[z]}if(void 0===J){J=0;for(z=0;z<k;++z)W[z]<0&&(J-=(V[z]-1)*W[z])}for(var x=function(G){if(R(G))return"buffer";if(d)switch(Object.prototype.toString.call(G)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(G)?"array":"generic"}(G),q=P[x];q.length<=k+1;)q.push(X(x,q.length-1));return(0,q[k+1])(G,V,W,J)}},13407:G=>{var V;self,V=()=>(()=>{"use strict";var G={d:(V,W)=>{for(var J in W)G.o(W,J)&&!G.o(V,J)&&Object.defineProperty(V,J,{enumerable:!0,get:W[J]})},o:(G,V)=>Object.prototype.hasOwnProperty.call(G,V)},V={};G.d(V,{default:()=>C});var W,J=function(G,V){var W=V.x-G.x,J=V.y-G.y;return Math.sqrt(W*W+J*J)},R=function(G){return G*(Math.PI/180)},d=new Map,k=function(G){d.has(G)&&clearTimeout(d.get(G)),d.set(G,setTimeout(G,100))},z=function(G,V,W){for(var J,R=V.split(/[ ,]+/g),d=0;d<R.length;d+=1)J=R[d],G.addEventListener?G.addEventListener(J,W,!1):G.attachEvent&&G.attachEvent(J,W)},X=function(G,V,W){for(var J,R=V.split(/[ ,]+/g),d=0;d<R.length;d+=1)J=R[d],G.removeEventListener?G.removeEventListener(J,W):G.detachEvent&&G.detachEvent(J,W)},P=function(G){return G.preventDefault(),G.type.match(/^touch/)?G.changedTouches:G},A=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},x=function(G,V){V.top||V.right||V.bottom||V.left?(G.style.top=V.top,G.style.right=V.right,G.style.bottom=V.bottom,G.style.left=V.left):(G.style.left=V.x+"px",G.style.top=V.y+"px")},q=function(G,V,W){var J=L(G);for(var R in J)if(J.hasOwnProperty(R))if("string"==typeof V)J[R]=V+" "+W;else{for(var d="",k=0,z=V.length;k<z;k+=1)d+=V[k]+" "+W+", ";J[R]=d.slice(0,-2)}return J},L=function(G){var V={};return V[G]="",["webkit","Moz","o"].forEach((function(W){V[W+G.charAt(0).toUpperCase()+G.slice(1)]=""})),V},t=function(G,V){for(var W in V)V.hasOwnProperty(W)&&(G[W]=V[W]);return G},Y=function(G,V){if(G.length)for(var W=0,J=G.length;W<J;W+=1)V(G[W]);else V(G)},g="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,S=!!("ontouchstart"in window),p=!!window.PointerEvent,b=!!window.MSPointerEvent,r={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},y={start:"mousedown",move:"mousemove",end:"mouseup"},u={};function H(){}g&&!B?W=r:p?W={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:b?W={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:S?(W=r,u=y):W=y,H.prototype.on=function(G,V){var W,J=this,R=G.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var d=0;d<R.length;d+=1)W=R[d],J._handlers_[W]=J._handlers_[W]||[],J._handlers_[W].push(V);return J},H.prototype.off=function(G,V){var W=this;return W._handlers_=W._handlers_||{},void 0===G?W._handlers_={}:void 0===V?W._handlers_[G]=null:W._handlers_[G]&&W._handlers_[G].indexOf(V)>=0&&W._handlers_[G].splice(W._handlers_[G].indexOf(V),1),W},H.prototype.trigger=function(G,V){var W,J=this,R=G.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var d=0;d<R.length;d+=1)W=R[d],J._handlers_[W]&&J._handlers_[W].length&&J._handlers_[W].forEach((function(G){G.call(J,{type:W,target:J},V)}))},H.prototype.config=function(G){var V=this;V.options=V.defaults||{},G&&(V.options=function(G,V){var W={};for(var J in G)G.hasOwnProperty(J)&&V.hasOwnProperty(J)?W[J]=V[J]:G.hasOwnProperty(J)&&(W[J]=G[J]);return W}(V.options,G))},H.prototype.bindEvt=function(G,V){var J=this;return J._domHandlers_=J._domHandlers_||{},J._domHandlers_[V]=function(){"function"==typeof J["on"+V]?J["on"+V].apply(J,arguments):console.warn('[WARNING] : Missing "on'+V+'" handler.')},z(G,W[V],J._domHandlers_[V]),u[V]&&z(G,u[V],J._domHandlers_[V]),J},H.prototype.unbindEvt=function(G,V){var J=this;return J._domHandlers_=J._domHandlers_||{},X(G,W[V],J._domHandlers_[V]),u[V]&&X(G,u[V],J._domHandlers_[V]),delete J._domHandlers_[V],this};const n=H;function D(G,V){return this.identifier=V.identifier,this.position=V.position,this.frontPosition=V.frontPosition,this.collection=G,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(V),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=D.id,D.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}D.prototype=new n,D.constructor=D,D.id=0,D.prototype.buildEl=function(G){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},D.prototype.stylize=function(){if(this.options.dataOnly)return this;var G=this.options.fadeTime+"ms",V=function(){var G=L("borderRadius");for(var V in G)G.hasOwnProperty(V)&&(G[V]="50%");return G}(),W=q("transition","opacity",G),J={};return J.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},J.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},J.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},t(J.el,W),"circle"===this.options.shape&&t(J.back,V),t(J.front,V),this.applyStyles(J),this},D.prototype.applyStyles=function(G){for(var V in this.ui)if(this.ui.hasOwnProperty(V))for(var W in G[V])this.ui[V].style[W]=G[V][W];return this},D.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},D.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},D.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},D.prototype.show=function(G){var V=this;return V.options.dataOnly||(clearTimeout(V.removeTimeout),clearTimeout(V.showTimeout),clearTimeout(V.restTimeout),V.addToDom(),V.restCallback(),setTimeout((function(){V.ui.el.style.opacity=1}),0),V.showTimeout=setTimeout((function(){V.trigger("shown",V.instance),"function"==typeof G&&G.call(this)}),V.options.fadeTime)),V},D.prototype.hide=function(G){var V=this;if(V.options.dataOnly)return V;if(V.ui.el.style.opacity=V.options.restOpacity,clearTimeout(V.removeTimeout),clearTimeout(V.showTimeout),clearTimeout(V.restTimeout),V.removeTimeout=setTimeout((function(){var W="dynamic"===V.options.mode?"none":"block";V.ui.el.style.display=W,"function"==typeof G&&G.call(V),V.trigger("hidden",V.instance)}),V.options.fadeTime),V.options.restJoystick){var W=V.options.restJoystick,J={};J.x=!0===W||!1!==W.x?0:V.instance.frontPosition.x,J.y=!0===W||!1!==W.y?0:V.instance.frontPosition.y,V.setPosition(G,J)}return V},D.prototype.setPosition=function(G,V){var W=this;W.frontPosition={x:V.x,y:V.y};var J=W.options.fadeTime+"ms",R={};R.front=q("transition",["transform"],J);var d={front:{}};d.front={transform:"translate("+W.frontPosition.x+"px,"+W.frontPosition.y+"px)"},W.applyStyles(R),W.applyStyles(d),W.restTimeout=setTimeout((function(){"function"==typeof G&&G.call(W),W.restCallback()}),W.options.fadeTime)},D.prototype.restCallback=function(){var G=this,V={};V.front=q("transition","none",""),G.applyStyles(V),G.trigger("rested",G.instance)},D.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},D.prototype.computeDirection=function(G){var V,W,J,R=G.angle.radian,d=Math.PI/4,k=Math.PI/2;if(R>d&&R<3*d&&!G.lockX?V="up":R>-d&&R<=d&&!G.lockY?V="left":R>3*-d&&R<=-d&&!G.lockX?V="down":G.lockY||(V="right"),G.lockY||(W=R>-k&&R<k?"left":"right"),G.lockX||(J=R>0?"up":"down"),G.force>this.options.threshold){var z,X={};for(z in this.direction)this.direction.hasOwnProperty(z)&&(X[z]=this.direction[z]);var P={};for(z in this.direction={x:W,y:J,angle:V},G.direction=this.direction,X)X[z]===this.direction[z]&&(P[z]=!0);if(P.x&&P.y&&P.angle)return G;P.x&&P.y||this.trigger("plain",G),P.x||this.trigger("plain:"+W,G),P.y||this.trigger("plain:"+J,G),P.angle||this.trigger("dir dir:"+V,G)}else this.resetDirection();return G};const i=D;function e(G,V){var W=this;W.nipples=[],W.idles=[],W.actives=[],W.ids=[],W.pressureIntervals={},W.manager=G,W.id=e.id,e.id+=1,W.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},W.config(V),"static"!==W.options.mode&&"semi"!==W.options.mode||(W.options.multitouch=!1),W.options.multitouch||(W.options.maxNumberOfNipples=1);var J=getComputedStyle(W.options.zone.parentElement);return J&&"flex"===J.display&&(W.parentIsFlex=!0),W.updateBox(),W.prepareNipples(),W.sx(),W.begin(),W.nipples}e.prototype=new n,e.constructor=e,e.id=0,e.prototype.prepareNipples=function(){var G=this,V=G.nipples;V.on=G.on.bind(G),V.off=G.off.bind(G),V.options=G.options,V.destroy=G.destroy.bind(G),V.ids=G.ids,V.id=G.id,V.processOnMove=G.processOnMove.bind(G),V.processOnEnd=G.processOnEnd.bind(G),V.get=function(G){if(void 0===G)return V[0];for(var W=0,J=V.length;W<J;W+=1)if(V[W].identifier===G)return V[W];return!1}},e.prototype.sx=function(){var G=this;G.bindEvt(G.options.zone,"start"),G.options.zone.style.touchAction="none",G.options.zone.style.msTouchAction="none"},e.prototype.begin=function(){var G=this,V=G.options;if("static"===V.mode){var W=G.createNipple(V.position,G.manager.getIdentifier());W.add(),G.idles.push(W)}},e.prototype.createNipple=function(G,V){var W=this,J=W.manager.scroll,R={},d=W.options,k=W.parentIsFlex?J.x:J.x+W.box.left,z=W.parentIsFlex?J.y:J.y+W.box.top;if(G.x&&G.y)R={x:G.x-k,y:G.y-z};else if(G.top||G.right||G.bottom||G.left){var X=document.createElement("DIV");X.style.display="hidden",X.style.top=G.top,X.style.right=G.right,X.style.bottom=G.bottom,X.style.left=G.left,X.style.position="absolute",d.zone.appendChild(X);var P=X.getBoundingClientRect();d.zone.removeChild(X),R=G,G={x:P.left+J.x,y:P.top+J.y}}var A=new i(W,{color:d.color,size:d.size,threshold:d.threshold,fadeTime:d.fadeTime,dataOnly:d.dataOnly,restJoystick:d.restJoystick,restOpacity:d.restOpacity,mode:d.mode,identifier:V,position:G,zone:d.zone,frontPosition:{x:0,y:0},shape:d.shape});return d.dataOnly||(x(A.ui.el,R),x(A.ui.front,A.frontPosition)),W.nipples.push(A),W.trigger("added "+A.identifier+":added",A),W.manager.trigger("added "+A.identifier+":added",A),W.bindNipple(A),A},e.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},e.prototype.bindNipple=function(G){var V,W=this,J=function(G,J){V=G.type+" "+J.id+":"+G.type,W.trigger(V,J)};G.on("destroyed",W.onDestroyed.bind(W)),G.on("shown hidden rested dir plain",J),G.on("dir:up dir:right dir:down dir:left",J),G.on("plain:up plain:right plain:down plain:left",J)},e.prototype.pressureFn=function(G,V,W){var J=this,R=0;clearInterval(J.pressureIntervals[W]),J.pressureIntervals[W]=setInterval(function(){var W=G.force||G.pressure||G.webkitForce||0;W!==R&&(V.trigger("pressure",W),J.trigger("pressure "+V.identifier+":pressure",W),R=W)}.bind(J),100)},e.prototype.onstart=function(G){var V=this,W=V.options,J=G;return G=P(G),V.updateBox(),Y(G,(function(R){V.actives.length<W.maxNumberOfNipples?V.processOnStart(R):J.type.match(/^touch/)&&(Object.keys(V.manager.ids).forEach((function(W){if(Object.values(J.touches).findIndex((function(G){return G.identifier===W}))<0){var R=[G[0]];R.identifier=W,V.processOnEnd(R)}})),V.actives.length<W.maxNumberOfNipples&&V.processOnStart(R))})),V.manager.bindDocument(),!1},e.prototype.processOnStart=function(G){var V,W=this,R=W.options,d=W.manager.getIdentifier(G),k=G.force||G.pressure||G.webkitForce||0,z={x:G.pageX,y:G.pageY},X=W.getOrCreate(d,z);X.identifier!==d&&W.manager.removeIdentifier(X.identifier),X.identifier=d;var P=function(V){V.trigger("start",V),W.trigger("start "+V.id+":start",V),V.show(),k>0&&W.pressureFn(G,V,V.identifier),W.processOnMove(G)};if((V=W.idles.indexOf(X))>=0&&W.idles.splice(V,1),W.actives.push(X),W.ids.push(X.identifier),"semi"!==R.mode)P(X);else{if(!(J(z,X.position)<=R.catchDistance))return X.destroy(),void W.processOnStart(G);P(X)}return X},e.prototype.getOrCreate=function(G,V){var W,J=this,R=J.options;return/(semi|static)/.test(R.mode)?(W=J.idles[0])?(J.idles.splice(0,1),W):"semi"===R.mode?J.createNipple(V,G):(console.warn("Coudln't find the needed nipple."),!1):W=J.createNipple(V,G)},e.prototype.processOnMove=function(G){var V=this,W=V.options,d=V.manager.getIdentifier(G),k=V.nipples.get(d),z=V.manager.scroll;if(function(G){return isNaN(G.buttons)?0!==G.pressure:0!==G.buttons}(G)){if(!k)return console.error("Found zombie joystick with ID "+d),void V.manager.removeIdentifier(d);if(W.dynamicPage){var X=k.el.getBoundingClientRect();k.position={x:z.x+X.left,y:z.y+X.top}}k.identifier=d;var P=k.options.size/2,A={x:G.pageX,y:G.pageY};W.lockX&&(A.y=k.position.y),W.lockY&&(A.x=k.position.x);var x,q,L,t,Y,g,B,S,p,b,r=J(A,k.position),y=(x=A,L=(q=k.position).x-x.x,t=q.y-x.y,function(G){return G*(180/Math.PI)}(Math.atan2(t,L))),u=R(y),H=r/P,n={distance:r,position:A};if("circle"===k.options.shape?(Y=Math.min(r,P),B=k.position,S=Y,b={x:0,y:0},p=R(p=y),b.x=B.x-S*Math.cos(p),b.y=B.y-S*Math.sin(p),g=b):(g=function(G,V,W){return{x:Math.min(Math.max(G.x,V.x-W),V.x+W),y:Math.min(Math.max(G.y,V.y-W),V.y+W)}}(A,k.position,P),Y=J(g,k.position)),W.follow){if(r>P){var D=A.x-g.x,i=A.y-g.y;k.position.x+=D,k.position.y+=i,k.el.style.top=k.position.y-(V.box.top+z.y)+"px",k.el.style.left=k.position.x-(V.box.left+z.x)+"px",r=J(A,k.position)}}else A=g,r=Y;var e=A.x-k.position.x,F=A.y-k.position.y;k.frontPosition={x:e,y:F},W.dataOnly||(k.ui.front.style.transform="translate("+e+"px,"+F+"px)");var f={identifier:k.identifier,position:A,force:H,pressure:G.force||G.pressure||G.webkitForce||0,distance:r,angle:{radian:u,degree:y},vector:{x:e/P,y:-F/P},raw:n,instance:k,lockX:W.lockX,lockY:W.lockY};(f=k.computeDirection(f)).angle={radian:R(180-y),degree:180-y},k.trigger("move",f),V.trigger("move "+k.id+":move",f)}else this.processOnEnd(G)},e.prototype.processOnEnd=function(G){var V=this,W=V.options,J=V.manager.getIdentifier(G),R=V.nipples.get(J),d=V.manager.removeIdentifier(R.identifier);R&&(W.dataOnly||R.hide((function(){"dynamic"===W.mode&&(R.trigger("removed",R),V.trigger("removed "+R.id+":removed",R),V.manager.trigger("removed "+R.id+":removed",R),R.destroy())})),clearInterval(V.pressureIntervals[R.identifier]),R.resetDirection(),R.trigger("end",R),V.trigger("end "+R.id+":end",R),V.ids.indexOf(R.identifier)>=0&&V.ids.splice(V.ids.indexOf(R.identifier),1),V.actives.indexOf(R)>=0&&V.actives.splice(V.actives.indexOf(R),1),/(semi|static)/.test(W.mode)?V.idles.push(R):V.nipples.indexOf(R)>=0&&V.nipples.splice(V.nipples.indexOf(R),1),V.manager.unbindDocument(),/(semi|static)/.test(W.mode)&&(V.manager.ids[d.id]=d.identifier))},e.prototype.onDestroyed=function(G,V){var W=this;W.nipples.indexOf(V)>=0&&W.nipples.splice(W.nipples.indexOf(V),1),W.actives.indexOf(V)>=0&&W.actives.splice(W.actives.indexOf(V),1),W.idles.indexOf(V)>=0&&W.idles.splice(W.idles.indexOf(V),1),W.ids.indexOf(V.identifier)>=0&&W.ids.splice(W.ids.indexOf(V.identifier),1),W.manager.removeIdentifier(V.identifier),W.manager.unbindDocument()},e.prototype.destroy=function(){var G=this;for(var V in G.unbindEvt(G.options.zone,"start"),G.nipples.forEach((function(G){G.destroy()})),G.pressureIntervals)G.pressureIntervals.hasOwnProperty(V)&&clearInterval(G.pressureIntervals[V]);G.trigger("destroyed",G.nipples),G.manager.unbindDocument(),G.off()};const F=e;function f(G){var V=this;V.ids={},V.index=0,V.collections=[],V.scroll=A(),V.config(G),V.prepareCollections();var W=function(){var G;V.collections.forEach((function(W){W.forEach((function(W){G=W.el.getBoundingClientRect(),W.position={x:V.scroll.x+G.left,y:V.scroll.y+G.top}}))}))};z(window,"resize",(function(){k(W)}));var J=function(){V.scroll=A()};return z(window,"scroll",(function(){k(J)})),V.collections}f.prototype=new n,f.constructor=f,f.prototype.prepareCollections=function(){var G=this;G.collections.create=G.create.bind(G),G.collections.on=G.on.bind(G),G.collections.off=G.off.bind(G),G.collections.destroy=G.destroy.bind(G),G.collections.get=function(V){var W;return G.collections.every((function(G){return!(W=G.get(V))})),W}},f.prototype.create=function(G){return this.createCollection(G)},f.prototype.createCollection=function(G){var V=this,W=new F(V,G);return V.bindCollection(W),V.collections.push(W),W},f.prototype.bindCollection=function(G){var V,W=this,J=function(G,J){V=G.type+" "+J.id+":"+G.type,W.trigger(V,J)};G.on("destroyed",W.onDestroyed.bind(W)),G.on("shown hidden rested dir plain",J),G.on("dir:up dir:right dir:down dir:left",J),G.on("plain:up plain:right plain:down plain:left",J)},f.prototype.bindDocument=function(){var G=this;G.binded||(G.bindEvt(document,"move").bindEvt(document,"end"),G.binded=!0)},f.prototype.unbindDocument=function(G){var V=this;Object.keys(V.ids).length&&!0!==G||(V.unbindEvt(document,"move").unbindEvt(document,"end"),V.binded=!1)},f.prototype.getIdentifier=function(G){var V;return G?void 0===(V=void 0===G.identifier?G.pointerId:G.identifier)&&(V=this.latest||0):V=this.index,void 0===this.ids[V]&&(this.ids[V]=this.index,this.index+=1),this.latest=V,this.ids[V]},f.prototype.removeIdentifier=function(G){var V={};for(var W in this.ids)if(this.ids[W]===G){V.id=W,V.identifier=this.ids[W],delete this.ids[W];break}return V},f.prototype.onmove=function(G){return this.onAny("move",G),!1},f.prototype.onend=function(G){return this.onAny("end",G),!1},f.prototype.oncancel=function(G){return this.onAny("end",G),!1},f.prototype.onAny=function(G,V){var W,J=this,R="processOn"+G.charAt(0).toUpperCase()+G.slice(1);V=P(V);var d=function(G,V,W){W.ids.indexOf(V)>=0&&(W[R](G),G._found_=!0)};return Y(V,(function(G){W=J.getIdentifier(G),Y(J.collections,d.bind(null,G,W)),G._found_||J.removeIdentifier(W)})),!1},f.prototype.destroy=function(){var G=this;G.unbindDocument(!0),G.ids={},G.index=0,G.collections.forEach((function(G){G.destroy()})),G.off()},f.prototype.onDestroyed=function(G,V){var W=this;if(W.collections.indexOf(V)<0)return!1;W.collections.splice(W.collections.indexOf(V),1)};var v=new f;const C={create:function(G){return v.create(G)},factory:v};return V.default})(),G.exports=V()},12471:(G,V,W)=>{"use strict";const{Deflate:J,deflate:R,deflateRaw:d,gzip:k}=W(12474),{Inflate:z,inflate:X,inflateRaw:P,ungzip:A}=W(12540),x=W(12510);G.exports.Deflate=J,G.exports.deflate=R,G.exports.deflateRaw=d,G.exports.gzip=k,G.exports.Inflate=z,G.exports.inflate=X,G.exports.inflateRaw=P,G.exports.ungzip=A,G.exports.constants=x},12474:(G,V,W)=>{"use strict";const J=W(12480),R=W(12519),d=W(12528),k=W(12503),z=W(12532),X=Object.prototype.toString,{Z_NO_FLUSH:P,Z_SYNC_FLUSH:A,Z_FULL_FLUSH:x,Z_FINISH:q,Z_OK:L,Z_STREAM_END:t,Z_DEFAULT_COMPRESSION:Y,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:B}=W(12510);function S(G){this.options=R.assign({level:Y,method:B,aG:16384,windowBits:15,memLevel:8,strategy:g},G||{});let V=this.options;V.raw&&V.windowBits>0?V.windowBits=-V.windowBits:V.gzip&&V.windowBits>0&&V.windowBits<16&&(V.windowBits+=16),this.err=0,this.XV="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let W=J.deflateInit2(this.strm,V.level,V.method,V.windowBits,V.memLevel,V.strategy);if(W!==L)throw new Error(k[W]);if(V.header&&J.deflateSetHeader(this.strm,V.header),V.dictionary){let G;if(G="string"===typeof V.dictionary?d.string2buf(V.dictionary):"[object ArrayBuffer]"===X.call(V.dictionary)?new Uint8Array(V.dictionary):V.dictionary,W=J.deflateSetDictionary(this.strm,G),W!==L)throw new Error(k[W]);this._dict_set=!0}}function p(G,V){const W=new S(V);if(W.push(G,!0),W.err)throw W.XV||k[W.err];return W.result}S.prototype.push=function(G,V){const W=this.strm,R=this.options.aG;let k,z;if(this.ended)return!1;for(z=V===~~V?V:!0===V?q:P,"string"===typeof G?W.input=d.string2buf(G):"[object ArrayBuffer]"===X.call(G)?W.input=new Uint8Array(G):W.input=G,W.next_in=0,W.avail_in=W.input.length;;)if(0===W.avail_out&&(W.output=new Uint8Array(R),W.next_out=0,W.avail_out=R),(z===A||z===x)&&W.avail_out<=6)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else{if(k=J.deflate(W,z),k===t)return W.next_out>0&&this.onData(W.output.subarray(0,W.next_out)),k=J.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===L;if(0!==W.avail_out){if(z>0&&W.next_out>0)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else if(0===W.avail_in)break}else this.onData(W.output)}return!0},S.prototype.onData=function(G){this.chunks.push(G)},S.prototype.onEnd=function(G){G===L&&(this.result=R.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.XV=this.strm.XV},G.exports.Deflate=S,G.exports.deflate=p,G.exports.deflateRaw=function(G,V){return(V=V||{}).raw=!0,p(G,V)},G.exports.gzip=function(G,V){return(V=V||{}).gzip=!0,p(G,V)},G.exports.constants=W(12510)},12540:(G,V,W)=>{"use strict";const J=W(12548),R=W(12519),d=W(12528),k=W(12503),z=W(12532),X=W(12563),P=Object.prototype.toString,{Z_NO_FLUSH:A,Z_FINISH:x,Z_OK:q,Z_STREAM_END:L,Z_NEED_DICT:t,Z_STREAM_ERROR:Y,Z_DATA_ERROR:g,Z_MEM_ERROR:B}=W(12510);function S(G){this.options=R.assign({aG:65536,windowBits:15,to:""},G||{});const V=this.options;V.raw&&V.windowBits>=0&&V.windowBits<16&&(V.windowBits=-V.windowBits,0===V.windowBits&&(V.windowBits=-15)),!(V.windowBits>=0&&V.windowBits<16)||G&&G.windowBits||(V.windowBits+=32),V.windowBits>15&&V.windowBits<48&&0===(15&V.windowBits)&&(V.windowBits|=15),this.err=0,this.XV="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let W=J.inflateInit2(this.strm,V.windowBits);if(W!==q)throw new Error(k[W]);if(this.header=new X,J.inflateGetHeader(this.strm,this.header),V.dictionary&&("string"===typeof V.dictionary?V.dictionary=d.string2buf(V.dictionary):"[object ArrayBuffer]"===P.call(V.dictionary)&&(V.dictionary=new Uint8Array(V.dictionary)),V.raw&&(W=J.inflateSetDictionary(this.strm,V.dictionary),W!==q)))throw new Error(k[W])}function p(G,V){const W=new S(V);if(W.push(G),W.err)throw W.XV||k[W.err];return W.result}S.prototype.push=function(G,V){const W=this.strm,R=this.options.aG,k=this.options.dictionary;let z,X,S;if(this.ended)return!1;for(X=V===~~V?V:!0===V?x:A,"[object ArrayBuffer]"===P.call(G)?W.input=new Uint8Array(G):W.input=G,W.next_in=0,W.avail_in=W.input.length;;){for(0===W.avail_out&&(W.output=new Uint8Array(R),W.next_out=0,W.avail_out=R),z=J.inflate(W,X),z===t&&k&&(z=J.inflateSetDictionary(W,k),z===q?z=J.inflate(W,X):z===g&&(z=t));W.avail_in>0&&z===L&&W.state.wrap>0&&0!==G[W.next_in];)J.inflateReset(W),z=J.inflate(W,X);switch(z){case Y:case g:case t:case B:return this.onEnd(z),this.ended=!0,!1}if(S=W.avail_out,W.next_out&&(0===W.avail_out||z===L))if("string"===this.options.to){let G=d.utf8border(W.output,W.next_out),V=W.next_out-G,J=d.buf2string(W.output,G);W.next_out=V,W.avail_out=R-V,V&&W.output.set(W.output.subarray(G,G+V),0),this.onData(J)}else this.onData(W.output.length===W.next_out?W.output:W.output.subarray(0,W.next_out));if(z!==q||0!==S){if(z===L)return z=J.inflateEnd(this.strm),this.onEnd(z),this.ended=!0,!0;if(0===W.avail_in)break}}return!0},S.prototype.onData=function(G){this.chunks.push(G)},S.prototype.onEnd=function(G){G===q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=R.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.XV=this.strm.XV},G.exports.Inflate=S,G.exports.inflate=p,G.exports.inflateRaw=function(G,V){return(V=V||{}).raw=!0,p(G,V)},G.exports.ungzip=p,G.exports.constants=W(12510)},12519:G=>{"use strict";const V=(G,V)=>Object.prototype.hasOwnProperty.call(G,V);G.exports.assign=function(G){const W=Array.prototype.slice.call(arguments,1);for(;W.length;){const J=W.shift();if(J){if("object"!==typeof J)throw new TypeError(J+"must be non-object");for(const W in J)V(J,W)&&(G[W]=J[W])}}return G},G.exports.flattenChunks=G=>{let V=0;for(let J=0,R=G.length;J<R;J++)V+=G[J].length;const W=new Uint8Array(V);for(let J=0,R=0,d=G.length;J<d;J++){let V=G[J];W.set(V,R),R+=V.length}return W}},12528:G=>{"use strict";let V=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(J){V=!1}const W=new Uint8Array(256);for(let R=0;R<256;R++)W[R]=R>=252?6:R>=248?5:R>=240?4:R>=224?3:R>=192?2:1;W[254]=W[254]=1,G.exports.string2buf=G=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(G);let V,W,J,R,d,k=G.length,z=0;for(R=0;R<k;R++)W=G.charCodeAt(R),55296===(64512&W)&&R+1<k&&(J=G.charCodeAt(R+1),56320===(64512&J)&&(W=65536+(W-55296<<10)+(J-56320),R++)),z+=W<128?1:W<2048?2:W<65536?3:4;for(V=new Uint8Array(z),d=0,R=0;d<z;R++)W=G.charCodeAt(R),55296===(64512&W)&&R+1<k&&(J=G.charCodeAt(R+1),56320===(64512&J)&&(W=65536+(W-55296<<10)+(J-56320),R++)),W<128?V[d++]=W:W<2048?(V[d++]=192|W>>>6,V[d++]=128|63&W):W<65536?(V[d++]=224|W>>>12,V[d++]=128|W>>>6&63,V[d++]=128|63&W):(V[d++]=240|W>>>18,V[d++]=128|W>>>12&63,V[d++]=128|W>>>6&63,V[d++]=128|63&W);return V};G.exports.buf2string=(G,J)=>{const R=J||G.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(G.subarray(0,J));let d,k;const z=new Array(2*R);for(k=0,d=0;d<R;){let V=G[d++];if(V<128){z[k++]=V;continue}let J=W[V];if(J>4)z[k++]=65533,d+=J-1;else{for(V&=2===J?31:3===J?15:7;J>1&&d<R;)V=V<<6|63&G[d++],J--;J>1?z[k++]=65533:V<65536?z[k++]=V:(V-=65536,z[k++]=55296|V>>10&1023,z[k++]=56320|1023&V)}}return((G,W)=>{if(W<65534&&G.subarray&&V)return String.fromCharCode.apply(null,G.length===W?G:G.subarray(0,W));let J="";for(let V=0;V<W;V++)J+=String.fromCharCode(G[V]);return J})(z,k)},G.exports.utf8border=(G,V)=>{(V=V||G.length)>G.length&&(V=G.length);let J=V-1;for(;J>=0&&128===(192&G[J]);)J--;return J<0||0===J?V:J+W[G[J]]>V?J:V}},12490:G=>{"use strict";G.exports=(G,V,W,J)=>{let R=65535&G,d=G>>>16&65535,k=0;for(;0!==W;){k=W>2e3?2e3:W,W-=k;do{R=R+V[J++]|0,d=d+R|0}while(--k);R%=65521,d%=65521}return R|d<<16}},12510:G=>{"use strict";G.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12494:G=>{"use strict";const V=new Uint32Array((()=>{let G,V=[];for(var W=0;W<256;W++){G=W;for(var J=0;J<8;J++)G=1&G?3988292384^G>>>1:G>>>1;V[W]=G}return V})());G.exports=(G,W,J,R)=>{const d=V,k=R+J;G^=-1;for(let V=R;V<k;V++)G=G>>>8^d[255&(G^W[V])];return~G}},12480:(G,V,W)=>{"use strict";const{_tr_init:J,_tr_stored_block:R,_tr_flush_block:d,_tr_tally:k,_tr_align:z}=W(12486),X=W(12490),P=W(12494),A=W(12503),{Z_NO_FLUSH:x,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:L,Z_FINISH:t,Z_BLOCK:Y,Z_OK:g,Z_STREAM_END:B,Z_STREAM_ERROR:S,Z_DATA_ERROR:p,Z_BUF_ERROR:b,Z_DEFAULT_COMPRESSION:r,Z_FILTERED:y,Z_HUFFMAN_ONLY:u,Z_RLE:H,Z_FIXED:n,Z_DEFAULT_STRATEGY:D,Z_UNKNOWN:i,Z_DEFLATED:e}=W(12510),F=258,f=262,v=103,C=113,l=666,m=(G,V)=>(G.XV=A[V],V),w=G=>(G<<1)-(G>4?9:0),N=G=>{let V=G.length;for(;--V>=0;)G[V]=0};let U=(G,V,W)=>(V<<G.hash_shift^W)&G.hash_mask;const a=G=>{const V=G.state;let W=V.pending;W>G.avail_out&&(W=G.avail_out),0!==W&&(G.output.set(V.pending_buf.subarray(V.pending_out,V.pending_out+W),G.next_out),G.next_out+=W,V.pending_out+=W,G.total_out+=W,G.avail_out-=W,V.pending-=W,0===V.pending&&(V.pending_out=0))},M=(G,V)=>{d(G,G.block_start>=0?G.block_start:-1,G.strstart-G.block_start,V),G.block_start=G.strstart,a(G.strm)},T=(G,V)=>{G.pending_buf[G.pending++]=V},K=(G,V)=>{G.pending_buf[G.pending++]=V>>>8&255,G.pending_buf[G.pending++]=255&V},s=(G,V,W,J)=>{let R=G.avail_in;return R>J&&(R=J),0===R?0:(G.avail_in-=R,V.set(G.input.subarray(G.next_in,G.next_in+R),W),1===G.state.wrap?G.adler=X(G.adler,V,R,W):2===G.state.wrap&&(G.adler=P(G.adler,V,R,W)),G.next_in+=R,G.total_in+=R,R)},Q=(G,V)=>{let W,J,R=G.max_chain_length,d=G.strstart,k=G.prev_length,z=G.nice_match;const X=G.strstart>G.w_size-f?G.strstart-(G.w_size-f):0,P=G.window,A=G.w_mask,x=G.prev,q=G.strstart+F;let L=P[d+k-1],t=P[d+k];G.prev_length>=G.good_match&&(R>>=2),z>G.lookahead&&(z=G.lookahead);do{if(W=V,P[W+k]===t&&P[W+k-1]===L&&P[W]===P[d]&&P[++W]===P[d+1]){d+=2,W++;do{}while(P[++d]===P[++W]&&P[++d]===P[++W]&&P[++d]===P[++W]&&P[++d]===P[++W]&&P[++d]===P[++W]&&P[++d]===P[++W]&&P[++d]===P[++W]&&P[++d]===P[++W]&&d<q);if(J=F-(q-d),d=q-F,J>k){if(G.match_start=V,k=J,J>=z)break;L=P[d+k-1],t=P[d+k]}}}while((V=x[V&A])>X&&0!==--R);return k<=G.lookahead?k:G.lookahead},Z=G=>{const V=G.w_size;let W,J,R,d,k;do{if(d=G.window_size-G.lookahead-G.strstart,G.strstart>=V+(V-f)){G.window.set(G.window.subarray(V,V+V),0),G.match_start-=V,G.strstart-=V,G.block_start-=V,J=G.hash_size,W=J;do{R=G.head[--W],G.head[W]=R>=V?R-V:0}while(--J);J=V,W=J;do{R=G.prev[--W],G.prev[W]=R>=V?R-V:0}while(--J);d+=V}if(0===G.strm.avail_in)break;if(J=s(G.strm,G.window,G.strstart+G.lookahead,d),G.lookahead+=J,G.lookahead+G.insert>=3)for(k=G.strstart-G.insert,G.ins_h=G.window[k],G.ins_h=U(G,G.ins_h,G.window[k+1]);G.insert&&(G.ins_h=U(G,G.ins_h,G.window[k+3-1]),G.prev[k&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=k,k++,G.insert--,!(G.lookahead+G.insert<3)););}while(G.lookahead<f&&0!==G.strm.avail_in)},E=(G,V)=>{let W,J;for(;;){if(G.lookahead<f){if(Z(G),G.lookahead<f&&V===x)return 1;if(0===G.lookahead)break}if(W=0,G.lookahead>=3&&(G.ins_h=U(G,G.ins_h,G.window[G.strstart+3-1]),W=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),0!==W&&G.strstart-W<=G.w_size-f&&(G.match_length=Q(G,W)),G.match_length>=3)if(J=k(G,G.strstart-G.match_start,G.match_length-3),G.lookahead-=G.match_length,G.match_length<=G.max_lazy_match&&G.lookahead>=3){G.match_length--;do{G.strstart++,G.ins_h=U(G,G.ins_h,G.window[G.strstart+3-1]),W=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart}while(0!==--G.match_length);G.strstart++}else G.strstart+=G.match_length,G.match_length=0,G.ins_h=G.window[G.strstart],G.ins_h=U(G,G.ins_h,G.window[G.strstart+1]);else J=k(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++;if(J&&(M(G,!1),0===G.strm.avail_out))return 1}return G.insert=G.strstart<2?G.strstart:2,V===t?(M(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(M(G,!1),0===G.strm.avail_out)?1:2},h=(G,V)=>{let W,J,R;for(;;){if(G.lookahead<f){if(Z(G),G.lookahead<f&&V===x)return 1;if(0===G.lookahead)break}if(W=0,G.lookahead>=3&&(G.ins_h=U(G,G.ins_h,G.window[G.strstart+3-1]),W=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),G.prev_length=G.match_length,G.prev_match=G.match_start,G.match_length=2,0!==W&&G.prev_length<G.max_lazy_match&&G.strstart-W<=G.w_size-f&&(G.match_length=Q(G,W),G.match_length<=5&&(G.strategy===y||3===G.match_length&&G.strstart-G.match_start>4096)&&(G.match_length=2)),G.prev_length>=3&&G.match_length<=G.prev_length){R=G.strstart+G.lookahead-3,J=k(G,G.strstart-1-G.prev_match,G.prev_length-3),G.lookahead-=G.prev_length-1,G.prev_length-=2;do{++G.strstart<=R&&(G.ins_h=U(G,G.ins_h,G.window[G.strstart+3-1]),W=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart)}while(0!==--G.prev_length);if(G.match_available=0,G.match_length=2,G.strstart++,J&&(M(G,!1),0===G.strm.avail_out))return 1}else if(G.match_available){if(J=k(G,0,G.window[G.strstart-1]),J&&M(G,!1),G.strstart++,G.lookahead--,0===G.strm.avail_out)return 1}else G.match_available=1,G.strstart++,G.lookahead--}return G.match_available&&(J=k(G,0,G.window[G.strstart-1]),G.match_available=0),G.insert=G.strstart<2?G.strstart:2,V===t?(M(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(M(G,!1),0===G.strm.avail_out)?1:2};function o(G,V,W,J,R){this.good_length=G,this.max_lazy=V,this.nice_length=W,this.max_chain=J,this.func=R}const c=[new o(0,0,0,0,((G,V)=>{let W=65535;for(W>G.pending_buf_size-5&&(W=G.pending_buf_size-5);;){if(G.lookahead<=1){if(Z(G),0===G.lookahead&&V===x)return 1;if(0===G.lookahead)break}G.strstart+=G.lookahead,G.lookahead=0;const J=G.block_start+W;if((0===G.strstart||G.strstart>=J)&&(G.lookahead=G.strstart-J,G.strstart=J,M(G,!1),0===G.strm.avail_out))return 1;if(G.strstart-G.block_start>=G.w_size-f&&(M(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,V===t?(M(G,!0),0===G.strm.avail_out?3:4):(G.strstart>G.block_start&&(M(G,!1),G.strm.avail_out),1)})),new o(4,4,8,4,E),new o(4,5,16,8,E),new o(4,6,32,32,E),new o(4,4,16,16,h),new o(8,16,32,32,h),new o(8,16,128,128,h),new o(8,32,128,256,h),new o(32,128,258,1024,h),new o(32,258,258,4096,h)];function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=e,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const I=G=>{if(!G||!G.state)return m(G,S);G.total_in=G.total_out=0,G.data_type=i;const V=G.state;return V.pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?42:C,G.adler=2===V.wrap?0:1,V.last_flush=x,J(V),g},O=G=>{const V=I(G);var W;return V===g&&((W=G.state).window_size=2*W.w_size,N(W.head),W.max_lazy_match=c[W.level].max_lazy,W.good_match=c[W.level].good_length,W.nice_match=c[W.level].nice_length,W.max_chain_length=c[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=2,W.match_available=0,W.ins_h=0),V},GG=(G,V,W,J,R,d)=>{if(!G)return S;let k=1;if(V===r&&(V=6),J<0?(k=0,J=-J):J>15&&(k=2,J-=16),R<1||R>9||W!==e||J<8||J>15||V<0||V>9||d<0||d>n)return m(G,S);8===J&&(J=9);const z=new j;return G.state=z,z.strm=G,z.wrap=k,z.gzhead=null,z.w_bits=J,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=R+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+3-1)/3),z.window=new Uint8Array(2*z.w_size),z.head=new Uint16Array(z.hash_size),z.prev=new Uint16Array(z.w_size),z.lit_bufsize=1<<R+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new Uint8Array(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=V,z.strategy=d,z.method=W,O(G)};G.exports.deflateInit=(G,V)=>GG(G,V,e,15,8,D),G.exports.deflateInit2=GG,G.exports.deflateReset=O,G.exports.deflateResetKeep=I,G.exports.deflateSetHeader=(G,V)=>G&&G.state?2!==G.state.wrap?S:(G.state.gzhead=V,g):S,G.exports.deflate=(G,V)=>{let W,J;if(!G||!G.state||V>Y||V<0)return G?m(G,S):S;const d=G.state;if(!G.output||!G.input&&0!==G.avail_in||d.status===l&&V!==t)return m(G,0===G.avail_out?b:S);d.strm=G;const X=d.last_flush;if(d.last_flush=V,42===d.status)if(2===d.wrap)G.adler=0,T(d,31),T(d,139),T(d,8),d.gzhead?(T(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),T(d,255&d.gzhead.time),T(d,d.gzhead.time>>8&255),T(d,d.gzhead.time>>16&255),T(d,d.gzhead.time>>24&255),T(d,9===d.level?2:d.strategy>=u||d.level<2?4:0),T(d,255&d.gzhead.os),d.gzhead.extra&&d.gzhead.extra.length&&(T(d,255&d.gzhead.extra.length),T(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(G.adler=P(G.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69):(T(d,0),T(d,0),T(d,0),T(d,0),T(d,0),T(d,9===d.level?2:d.strategy>=u||d.level<2?4:0),T(d,3),d.status=C);else{let V=e+(d.w_bits-8<<4)<<8,W=-1;W=d.strategy>=u||d.level<2?0:d.level<6?1:6===d.level?2:3,V|=W<<6,0!==d.strstart&&(V|=32),V+=31-V%31,d.status=C,K(d,V),0!==d.strstart&&(K(d,G.adler>>>16),K(d,65535&G.adler)),G.adler=1}if(69===d.status)if(d.gzhead.extra){for(W=d.pending;d.gzindex<(65535&d.gzhead.extra.length)&&(d.pending!==d.pending_buf_size||(d.gzhead.hcrc&&d.pending>W&&(G.adler=P(G.adler,d.pending_buf,d.pending-W,W)),a(G),W=d.pending,d.pending!==d.pending_buf_size));)T(d,255&d.gzhead.extra[d.gzindex]),d.gzindex++;d.gzhead.hcrc&&d.pending>W&&(G.adler=P(G.adler,d.pending_buf,d.pending-W,W)),d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=73)}else d.status=73;if(73===d.status)if(d.gzhead.name){W=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>W&&(G.adler=P(G.adler,d.pending_buf,d.pending-W,W)),a(G),W=d.pending,d.pending===d.pending_buf_size)){J=1;break}J=d.gzindex<d.gzhead.name.length?255&d.gzhead.name.charCodeAt(d.gzindex++):0,T(d,J)}while(0!==J);d.gzhead.hcrc&&d.pending>W&&(G.adler=P(G.adler,d.pending_buf,d.pending-W,W)),0===J&&(d.gzindex=0,d.status=91)}else d.status=91;if(91===d.status)if(d.gzhead.comment){W=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>W&&(G.adler=P(G.adler,d.pending_buf,d.pending-W,W)),a(G),W=d.pending,d.pending===d.pending_buf_size)){J=1;break}J=d.gzindex<d.gzhead.comment.length?255&d.gzhead.comment.charCodeAt(d.gzindex++):0,T(d,J)}while(0!==J);d.gzhead.hcrc&&d.pending>W&&(G.adler=P(G.adler,d.pending_buf,d.pending-W,W)),0===J&&(d.status=v)}else d.status=v;if(d.status===v&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&a(G),d.pending+2<=d.pending_buf_size&&(T(d,255&G.adler),T(d,G.adler>>8&255),G.adler=0,d.status=C)):d.status=C),0!==d.pending){if(a(G),0===G.avail_out)return d.last_flush=-1,g}else if(0===G.avail_in&&w(V)<=w(X)&&V!==t)return m(G,b);if(d.status===l&&0!==G.avail_in)return m(G,b);if(0!==G.avail_in||0!==d.lookahead||V!==x&&d.status!==l){let W=d.strategy===u?((G,V)=>{let W;for(;;){if(0===G.lookahead&&(Z(G),0===G.lookahead)){if(V===x)return 1;break}if(G.match_length=0,W=k(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++,W&&(M(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,V===t?(M(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(M(G,!1),0===G.strm.avail_out)?1:2})(d,V):d.strategy===H?((G,V)=>{let W,J,R,d;const z=G.window;for(;;){if(G.lookahead<=F){if(Z(G),G.lookahead<=F&&V===x)return 1;if(0===G.lookahead)break}if(G.match_length=0,G.lookahead>=3&&G.strstart>0&&(R=G.strstart-1,J=z[R],J===z[++R]&&J===z[++R]&&J===z[++R])){d=G.strstart+F;do{}while(J===z[++R]&&J===z[++R]&&J===z[++R]&&J===z[++R]&&J===z[++R]&&J===z[++R]&&J===z[++R]&&J===z[++R]&&R<d);G.match_length=F-(d-R),G.match_length>G.lookahead&&(G.match_length=G.lookahead)}if(G.match_length>=3?(W=k(G,1,G.match_length-3),G.lookahead-=G.match_length,G.strstart+=G.match_length,G.match_length=0):(W=k(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++),W&&(M(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,V===t?(M(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(M(G,!1),0===G.strm.avail_out)?1:2})(d,V):c[d.level].func(d,V);if(3!==W&&4!==W||(d.status=l),1===W||3===W)return 0===G.avail_out&&(d.last_flush=-1),g;if(2===W&&(V===q?z(d):V!==Y&&(R(d,0,0,!1),V===L&&(N(d.head),0===d.lookahead&&(d.strstart=0,d.block_start=0,d.insert=0))),a(G),0===G.avail_out))return d.last_flush=-1,g}return V!==t?g:d.wrap<=0?B:(2===d.wrap?(T(d,255&G.adler),T(d,G.adler>>8&255),T(d,G.adler>>16&255),T(d,G.adler>>24&255),T(d,255&G.total_in),T(d,G.total_in>>8&255),T(d,G.total_in>>16&255),T(d,G.total_in>>24&255)):(K(d,G.adler>>>16),K(d,65535&G.adler)),a(G),d.wrap>0&&(d.wrap=-d.wrap),0!==d.pending?g:B)},G.exports.deflateEnd=G=>{if(!G||!G.state)return S;const V=G.state.status;return 42!==V&&69!==V&&73!==V&&91!==V&&V!==v&&V!==C&&V!==l?m(G,S):(G.state=null,V===C?m(G,p):g)},G.exports.deflateSetDictionary=(G,V)=>{let W=V.length;if(!G||!G.state)return S;const J=G.state,R=J.wrap;if(2===R||1===R&&42!==J.status||J.lookahead)return S;if(1===R&&(G.adler=X(G.adler,V,W,0)),J.wrap=0,W>=J.w_size){0===R&&(N(J.head),J.strstart=0,J.block_start=0,J.insert=0);let G=new Uint8Array(J.w_size);G.set(V.subarray(W-J.w_size,W),0),V=G,W=J.w_size}const d=G.avail_in,k=G.next_in,z=G.input;for(G.avail_in=W,G.next_in=0,G.input=V,Z(J);J.lookahead>=3;){let G=J.strstart,V=J.lookahead-2;do{J.ins_h=U(J,J.ins_h,J.window[G+3-1]),J.prev[G&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=G,G++}while(--V);J.strstart=G,J.lookahead=2,Z(J)}return J.strstart+=J.lookahead,J.block_start=J.strstart,J.insert=J.lookahead,J.lookahead=0,J.match_length=J.prev_length=2,J.match_available=0,G.next_in=k,G.input=z,G.avail_in=d,J.wrap=R,g},G.exports.deflateInfo="pako deflate (from Nodeca project)"},12563:G=>{"use strict";G.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12555:G=>{"use strict";G.exports=function(G,V){let W,J,R,d,k,z,X,P,A,x,q,L,t,Y,g,B,S,p,b,r,y,u,H,n;const D=G.state;W=G.next_in,H=G.input,J=W+(G.avail_in-5),R=G.next_out,n=G.output,d=R-(V-G.avail_out),k=R+(G.avail_out-257),z=D.dmax,X=D.wsize,P=D.whave,A=D.wnext,x=D.window,q=D.hold,L=D.bits,t=D.lencode,Y=D.distcode,g=(1<<D.lenbits)-1,B=(1<<D.distbits)-1;G:do{L<15&&(q+=H[W++]<<L,L+=8,q+=H[W++]<<L,L+=8),S=t[q&g];V:for(;;){if(p=S>>>24,q>>>=p,L-=p,p=S>>>16&255,0===p)n[R++]=65535&S;else{if(!(16&p)){if(0===(64&p)){S=t[(65535&S)+(q&(1<<p)-1)];continue V}if(32&p){D.mode=12;break G}G.XV="invalid literal/length code",D.mode=30;break G}b=65535&S,p&=15,p&&(L<p&&(q+=H[W++]<<L,L+=8),b+=q&(1<<p)-1,q>>>=p,L-=p),L<15&&(q+=H[W++]<<L,L+=8,q+=H[W++]<<L,L+=8),S=Y[q&B];W:for(;;){if(p=S>>>24,q>>>=p,L-=p,p=S>>>16&255,!(16&p)){if(0===(64&p)){S=Y[(65535&S)+(q&(1<<p)-1)];continue W}G.XV="invalid distance code",D.mode=30;break G}if(r=65535&S,p&=15,L<p&&(q+=H[W++]<<L,L+=8,L<p&&(q+=H[W++]<<L,L+=8)),r+=q&(1<<p)-1,r>z){G.XV="invalid distance too far back",D.mode=30;break G}if(q>>>=p,L-=p,p=R-d,r>p){if(p=r-p,p>P&&D.sane){G.XV="invalid distance too far back",D.mode=30;break G}if(y=0,u=x,0===A){if(y+=X-p,p<b){b-=p;do{n[R++]=x[y++]}while(--p);y=R-r,u=n}}else if(A<p){if(y+=X+A-p,p-=A,p<b){b-=p;do{n[R++]=x[y++]}while(--p);if(y=0,A<b){p=A,b-=p;do{n[R++]=x[y++]}while(--p);y=R-r,u=n}}}else if(y+=A-p,p<b){b-=p;do{n[R++]=x[y++]}while(--p);y=R-r,u=n}for(;b>2;)n[R++]=u[y++],n[R++]=u[y++],n[R++]=u[y++],b-=3;b&&(n[R++]=u[y++],b>1&&(n[R++]=u[y++]))}else{y=R-r;do{n[R++]=n[y++],n[R++]=n[y++],n[R++]=n[y++],b-=3}while(b>2);b&&(n[R++]=n[y++],b>1&&(n[R++]=n[y++]))}break}}break}}while(W<J&&R<k);b=L>>3,W-=b,L-=b<<3,q&=(1<<L)-1,G.next_in=W,G.next_out=R,G.avail_in=W<J?J-W+5:5-(W-J),G.avail_out=R<k?k-R+257:257-(R-k),D.hold=q,D.bits=L}},12548:(G,V,W)=>{"use strict";const J=W(12490),R=W(12494),d=W(12555),k=W(12560),{Z_FINISH:z,Z_BLOCK:X,Z_TREES:P,Z_OK:A,Z_STREAM_END:x,Z_NEED_DICT:q,Z_STREAM_ERROR:L,Z_DATA_ERROR:t,Z_MEM_ERROR:Y,Z_BUF_ERROR:g,Z_DEFLATED:B}=W(12510),S=12,p=30,b=G=>(G>>>24&255)+(G>>>8&65280)+((65280&G)<<8)+((255&G)<<24);function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const y=G=>{if(!G||!G.state)return L;const V=G.state;return G.total_in=G.total_out=V.total=0,G.XV="",V.wrap&&(G.adler=1&V.wrap),V.mode=1,V.last=0,V.havedict=0,V.dmax=32768,V.head=null,V.hold=0,V.bits=0,V.lencode=V.lendyn=new Int32Array(852),V.distcode=V.distdyn=new Int32Array(592),V.sane=1,V.back=-1,A},u=G=>{if(!G||!G.state)return L;const V=G.state;return V.wsize=0,V.whave=0,V.wnext=0,y(G)},H=(G,V)=>{let W;if(!G||!G.state)return L;const J=G.state;return V<0?(W=0,V=-V):(W=1+(V>>4),V<48&&(V&=15)),V&&(V<8||V>15)?L:(null!==J.window&&J.wbits!==V&&(J.window=null),J.wrap=W,J.wbits=V,u(G))},n=(G,V)=>{if(!G)return L;const W=new r;G.state=W,W.window=null;const J=H(G,V);return J!==A&&(G.state=null),J};let D,i,e=!0;const F=G=>{if(e){D=new Int32Array(512),i=new Int32Array(32);let V=0;for(;V<144;)G.lens[V++]=8;for(;V<256;)G.lens[V++]=9;for(;V<280;)G.lens[V++]=7;for(;V<288;)G.lens[V++]=8;for(k(1,G.lens,0,288,D,0,G.work,{bits:9}),V=0;V<32;)G.lens[V++]=5;k(2,G.lens,0,32,i,0,G.work,{bits:5}),e=!1}G.lencode=D,G.lenbits=9,G.distcode=i,G.distbits=5},f=(G,V,W,J)=>{let R;const d=G.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),J>=d.wsize?(d.window.set(V.subarray(W-d.wsize,W),0),d.wnext=0,d.whave=d.wsize):(R=d.wsize-d.wnext,R>J&&(R=J),d.window.set(V.subarray(W-J,W-J+R),d.wnext),(J-=R)?(d.window.set(V.subarray(W-J,W),0),d.wnext=J,d.whave=d.wsize):(d.wnext+=R,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=R))),0};G.exports.inflateReset=u,G.exports.inflateReset2=H,G.exports.inflateResetKeep=y,G.exports.inflateInit=G=>n(G,15),G.exports.inflateInit2=n,G.exports.inflate=(G,V)=>{let W,r,y,u,H,n,D,i,e,v,C,l,m,w,N,U,a,M,T,K,s,Q,Z=0;const E=new Uint8Array(4);let h,o;const c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!G||!G.state||!G.output||!G.input&&0!==G.avail_in)return L;W=G.state,W.mode===S&&(W.mode=13),H=G.next_out,y=G.output,D=G.avail_out,u=G.next_in,r=G.input,n=G.avail_in,i=W.hold,e=W.bits,v=n,C=D,Q=A;G:for(;;)switch(W.mode){case 1:if(0===W.wrap){W.mode=13;break}for(;e<16;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(2&W.wrap&&35615===i){W.check=0,E[0]=255&i,E[1]=i>>>8&255,W.check=R(W.check,E,2,0),i=0,e=0,W.mode=2;break}if(W.flags=0,W.head&&(W.head.done=!1),!(1&W.wrap)||(((255&i)<<8)+(i>>8))%31){G.XV="incorrect header check",W.mode=p;break}if((15&i)!==B){G.XV="unknown compression method",W.mode=p;break}if(i>>>=4,e-=4,s=8+(15&i),0===W.wbits)W.wbits=s;else if(s>W.wbits){G.XV="invalid window size",W.mode=p;break}W.dmax=1<<W.wbits,G.adler=W.check=1,W.mode=512&i?10:S,i=0,e=0;break;case 2:for(;e<16;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(W.flags=i,(255&W.flags)!==B){G.XV="unknown compression method",W.mode=p;break}if(57344&W.flags){G.XV="unknown header flags set",W.mode=p;break}W.head&&(W.head.text=i>>8&1),512&W.flags&&(E[0]=255&i,E[1]=i>>>8&255,W.check=R(W.check,E,2,0)),i=0,e=0,W.mode=3;case 3:for(;e<32;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}W.head&&(W.head.time=i),512&W.flags&&(E[0]=255&i,E[1]=i>>>8&255,E[2]=i>>>16&255,E[3]=i>>>24&255,W.check=R(W.check,E,4,0)),i=0,e=0,W.mode=4;case 4:for(;e<16;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}W.head&&(W.head.xflags=255&i,W.head.os=i>>8),512&W.flags&&(E[0]=255&i,E[1]=i>>>8&255,W.check=R(W.check,E,2,0)),i=0,e=0,W.mode=5;case 5:if(1024&W.flags){for(;e<16;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}W.length=i,W.head&&(W.head.extra_len=i),512&W.flags&&(E[0]=255&i,E[1]=i>>>8&255,W.check=R(W.check,E,2,0)),i=0,e=0}else W.head&&(W.head.extra=null);W.mode=6;case 6:if(1024&W.flags&&(l=W.length,l>n&&(l=n),l&&(W.head&&(s=W.head.extra_len-W.length,W.head.extra||(W.head.extra=new Uint8Array(W.head.extra_len)),W.head.extra.set(r.subarray(u,u+l),s)),512&W.flags&&(W.check=R(W.check,r,l,u)),n-=l,u+=l,W.length-=l),W.length))break G;W.length=0,W.mode=7;case 7:if(2048&W.flags){if(0===n)break G;l=0;do{s=r[u+l++],W.head&&s&&W.length<65536&&(W.head.name+=String.fromCharCode(s))}while(s&&l<n);if(512&W.flags&&(W.check=R(W.check,r,l,u)),n-=l,u+=l,s)break G}else W.head&&(W.head.name=null);W.length=0,W.mode=8;case 8:if(4096&W.flags){if(0===n)break G;l=0;do{s=r[u+l++],W.head&&s&&W.length<65536&&(W.head.comment+=String.fromCharCode(s))}while(s&&l<n);if(512&W.flags&&(W.check=R(W.check,r,l,u)),n-=l,u+=l,s)break G}else W.head&&(W.head.comment=null);W.mode=9;case 9:if(512&W.flags){for(;e<16;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(i!==(65535&W.check)){G.XV="header crc mismatch",W.mode=p;break}i=0,e=0}W.head&&(W.head.hcrc=W.flags>>9&1,W.head.done=!0),G.adler=W.check=0,W.mode=S;break;case 10:for(;e<32;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}G.adler=W.check=b(i),i=0,e=0,W.mode=11;case 11:if(0===W.havedict)return G.next_out=H,G.avail_out=D,G.next_in=u,G.avail_in=n,W.hold=i,W.bits=e,q;G.adler=W.check=1,W.mode=S;case S:if(V===X||V===P)break G;case 13:if(W.last){i>>>=7&e,e-=7&e,W.mode=27;break}for(;e<3;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}switch(W.last=1&i,i>>>=1,e-=1,3&i){case 0:W.mode=14;break;case 1:if(F(W),W.mode=20,V===P){i>>>=2,e-=2;break G}break;case 2:W.mode=17;break;case 3:G.XV="invalid block type",W.mode=p}i>>>=2,e-=2;break;case 14:for(i>>>=7&e,e-=7&e;e<32;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if((65535&i)!==(i>>>16^65535)){G.XV="invalid stored block lengths",W.mode=p;break}if(W.length=65535&i,i=0,e=0,W.mode=15,V===P)break G;case 15:W.mode=16;case 16:if(l=W.length,l){if(l>n&&(l=n),l>D&&(l=D),0===l)break G;y.set(r.subarray(u,u+l),H),n-=l,u+=l,D-=l,H+=l,W.length-=l;break}W.mode=S;break;case 17:for(;e<14;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(W.nlen=257+(31&i),i>>>=5,e-=5,W.ndist=1+(31&i),i>>>=5,e-=5,W.ncode=4+(15&i),i>>>=4,e-=4,W.nlen>286||W.ndist>30){G.XV="too many length or distance symbols",W.mode=p;break}W.have=0,W.mode=18;case 18:for(;W.have<W.ncode;){for(;e<3;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}W.lens[c[W.have++]]=7&i,i>>>=3,e-=3}for(;W.have<19;)W.lens[c[W.have++]]=0;if(W.lencode=W.lendyn,W.lenbits=7,h={bits:W.lenbits},Q=k(0,W.lens,0,19,W.lencode,0,W.work,h),W.lenbits=h.bits,Q){G.XV="invalid code lengths set",W.mode=p;break}W.have=0,W.mode=19;case 19:for(;W.have<W.nlen+W.ndist;){for(;Z=W.lencode[i&(1<<W.lenbits)-1],N=Z>>>24,U=Z>>>16&255,a=65535&Z,!(N<=e);){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(a<16)i>>>=N,e-=N,W.lens[W.have++]=a;else{if(16===a){for(o=N+2;e<o;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(i>>>=N,e-=N,0===W.have){G.XV="invalid bit length repeat",W.mode=p;break}s=W.lens[W.have-1],l=3+(3&i),i>>>=2,e-=2}else if(17===a){for(o=N+3;e<o;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}i>>>=N,e-=N,s=0,l=3+(7&i),i>>>=3,e-=3}else{for(o=N+7;e<o;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}i>>>=N,e-=N,s=0,l=11+(127&i),i>>>=7,e-=7}if(W.have+l>W.nlen+W.ndist){G.XV="invalid bit length repeat",W.mode=p;break}for(;l--;)W.lens[W.have++]=s}}if(W.mode===p)break;if(0===W.lens[256]){G.XV="invalid code -- missing end-of-block",W.mode=p;break}if(W.lenbits=9,h={bits:W.lenbits},Q=k(1,W.lens,0,W.nlen,W.lencode,0,W.work,h),W.lenbits=h.bits,Q){G.XV="invalid literal/lengths set",W.mode=p;break}if(W.distbits=6,W.distcode=W.distdyn,h={bits:W.distbits},Q=k(2,W.lens,W.nlen,W.ndist,W.distcode,0,W.work,h),W.distbits=h.bits,Q){G.XV="invalid distances set",W.mode=p;break}if(W.mode=20,V===P)break G;case 20:W.mode=21;case 21:if(n>=6&&D>=258){G.next_out=H,G.avail_out=D,G.next_in=u,G.avail_in=n,W.hold=i,W.bits=e,d(G,C),H=G.next_out,y=G.output,D=G.avail_out,u=G.next_in,r=G.input,n=G.avail_in,i=W.hold,e=W.bits,W.mode===S&&(W.back=-1);break}for(W.back=0;Z=W.lencode[i&(1<<W.lenbits)-1],N=Z>>>24,U=Z>>>16&255,a=65535&Z,!(N<=e);){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(U&&0===(240&U)){for(M=N,T=U,K=a;Z=W.lencode[K+((i&(1<<M+T)-1)>>M)],N=Z>>>24,U=Z>>>16&255,a=65535&Z,!(M+N<=e);){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}i>>>=M,e-=M,W.back+=M}if(i>>>=N,e-=N,W.back+=N,W.length=a,0===U){W.mode=26;break}if(32&U){W.back=-1,W.mode=S;break}if(64&U){G.XV="invalid literal/length code",W.mode=p;break}W.extra=15&U,W.mode=22;case 22:if(W.extra){for(o=W.extra;e<o;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}W.length+=i&(1<<W.extra)-1,i>>>=W.extra,e-=W.extra,W.back+=W.extra}W.was=W.length,W.mode=23;case 23:for(;Z=W.distcode[i&(1<<W.distbits)-1],N=Z>>>24,U=Z>>>16&255,a=65535&Z,!(N<=e);){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(0===(240&U)){for(M=N,T=U,K=a;Z=W.distcode[K+((i&(1<<M+T)-1)>>M)],N=Z>>>24,U=Z>>>16&255,a=65535&Z,!(M+N<=e);){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}i>>>=M,e-=M,W.back+=M}if(i>>>=N,e-=N,W.back+=N,64&U){G.XV="invalid distance code",W.mode=p;break}W.offset=a,W.extra=15&U,W.mode=24;case 24:if(W.extra){for(o=W.extra;e<o;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}W.offset+=i&(1<<W.extra)-1,i>>>=W.extra,e-=W.extra,W.back+=W.extra}if(W.offset>W.dmax){G.XV="invalid distance too far back",W.mode=p;break}W.mode=25;case 25:if(0===D)break G;if(l=C-D,W.offset>l){if(l=W.offset-l,l>W.whave&&W.sane){G.XV="invalid distance too far back",W.mode=p;break}l>W.wnext?(l-=W.wnext,m=W.wsize-l):m=W.wnext-l,l>W.length&&(l=W.length),w=W.window}else w=y,m=H-W.offset,l=W.length;l>D&&(l=D),D-=l,W.length-=l;do{y[H++]=w[m++]}while(--l);0===W.length&&(W.mode=21);break;case 26:if(0===D)break G;y[H++]=W.length,D--,W.mode=21;break;case 27:if(W.wrap){for(;e<32;){if(0===n)break G;n--,i|=r[u++]<<e,e+=8}if(C-=D,G.total_out+=C,W.total+=C,C&&(G.adler=W.check=W.flags?R(W.check,y,C,H-C):J(W.check,y,C,H-C)),C=D,(W.flags?i:b(i))!==W.check){G.XV="incorrect data check",W.mode=p;break}i=0,e=0}W.mode=28;case 28:if(W.wrap&&W.flags){for(;e<32;){if(0===n)break G;n--,i+=r[u++]<<e,e+=8}if(i!==(4294967295&W.total)){G.XV="incorrect length check",W.mode=p;break}i=0,e=0}W.mode=29;case 29:Q=x;break G;case p:Q=t;break G;case 31:return Y;default:return L}return G.next_out=H,G.avail_out=D,G.next_in=u,G.avail_in=n,W.hold=i,W.bits=e,(W.wsize||C!==G.avail_out&&W.mode<p&&(W.mode<27||V!==z))&&f(G,G.output,G.next_out,C-G.avail_out)?(W.mode=31,Y):(v-=G.avail_in,C-=G.avail_out,G.total_in+=v,G.total_out+=C,W.total+=C,W.wrap&&C&&(G.adler=W.check=W.flags?R(W.check,y,C,G.next_out-C):J(W.check,y,C,G.next_out-C)),G.data_type=W.bits+(W.last?64:0)+(W.mode===S?128:0)+(20===W.mode||15===W.mode?256:0),(0===v&&0===C||V===z)&&Q===A&&(Q=g),Q)},G.exports.inflateEnd=G=>{if(!G||!G.state)return L;let V=G.state;return V.window&&(V.window=null),G.state=null,A},G.exports.inflateGetHeader=(G,V)=>{if(!G||!G.state)return L;const W=G.state;return 0===(2&W.wrap)?L:(W.head=V,V.done=!1,A)},G.exports.inflateSetDictionary=(G,V)=>{const W=V.length;let R,d,k;return G&&G.state?(R=G.state,0!==R.wrap&&11!==R.mode?L:11===R.mode&&(d=1,d=J(d,V,W,0),d!==R.check)?t:(k=f(G,V,W,W),k?(R.mode=31,Y):(R.havedict=1,A))):L},G.exports.inflateInfo="pako inflate (from Nodeca project)"},12560:G=>{"use strict";const V=15,W=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),J=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),R=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);G.exports=(G,k,z,X,P,A,x,q)=>{const L=q.bits;let t,Y,g,B,S,p,b=0,r=0,y=0,u=0,H=0,n=0,D=0,i=0,e=0,F=0,f=null,v=0;const C=new Uint16Array(16),l=new Uint16Array(16);let m,w,N,U=null,a=0;for(b=0;b<=V;b++)C[b]=0;for(r=0;r<X;r++)C[k[z+r]]++;for(H=L,u=V;u>=1&&0===C[u];u--);if(H>u&&(H=u),0===u)return P[A++]=20971520,P[A++]=20971520,q.bits=1,0;for(y=1;y<u&&0===C[y];y++);for(H<y&&(H=y),i=1,b=1;b<=V;b++)if(i<<=1,i-=C[b],i<0)return-1;if(i>0&&(0===G||1!==u))return-1;for(l[1]=0,b=1;b<V;b++)l[b+1]=l[b]+C[b];for(r=0;r<X;r++)0!==k[z+r]&&(x[l[k[z+r]]++]=r);if(0===G?(f=U=x,p=19):1===G?(f=W,v-=257,U=J,a-=257,p=256):(f=R,U=d,p=-1),F=0,r=0,b=y,S=A,n=H,D=0,g=-1,e=1<<H,B=e-1,1===G&&e>852||2===G&&e>592)return 1;for(;;){m=b-D,x[r]<p?(w=0,N=x[r]):x[r]>p?(w=U[a+x[r]],N=f[v+x[r]]):(w=96,N=0),t=1<<b-D,Y=1<<n,y=Y;do{Y-=t,P[S+(F>>D)+Y]=m<<24|w<<16|N}while(0!==Y);for(t=1<<b-1;F&t;)t>>=1;if(0!==t?(F&=t-1,F+=t):F=0,r++,0===--C[b]){if(b===u)break;b=k[z+x[r]]}if(b>H&&(F&B)!==g){for(0===D&&(D=H),S+=y,n=b-D,i=1<<n;n+D<u&&(i-=C[n+D],!(i<=0));)n++,i<<=1;if(e+=1<<n,1===G&&e>852||2===G&&e>592)return 1;g=F&B,P[g]=H<<24|n<<16|S-A}}return 0!==F&&(P[S+F]=b-D<<24|64<<16),q.bits=H,0}},12503:G=>{"use strict";G.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12486:G=>{"use strict";function V(G){let V=G.length;for(;--V>=0;)G[V]=0}const W=256,J=286,R=30,d=15,k=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),z=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),X=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A=new Array(576);V(A);const x=new Array(60);V(x);const q=new Array(512);V(q);const L=new Array(256);V(L);const t=new Array(29);V(t);const Y=new Array(R);function g(G,V,W,J,R){this.static_tree=G,this.extra_bits=V,this.extra_base=W,this.elems=J,this.max_length=R,this.has_stree=G&&G.length}let B,S,p;function b(G,V){this.dyn_tree=G,this.max_code=0,this.stat_desc=V}V(Y);const r=G=>G<256?q[G]:q[256+(G>>>7)],y=(G,V)=>{G.pending_buf[G.pending++]=255&V,G.pending_buf[G.pending++]=V>>>8&255},u=(G,V,W)=>{G.bi_valid>16-W?(G.bi_buf|=V<<G.bi_valid&65535,y(G,G.bi_buf),G.bi_buf=V>>16-G.bi_valid,G.bi_valid+=W-16):(G.bi_buf|=V<<G.bi_valid&65535,G.bi_valid+=W)},H=(G,V,W)=>{u(G,W[2*V],W[2*V+1])},n=(G,V)=>{let W=0;do{W|=1&G,G>>>=1,W<<=1}while(--V>0);return W>>>1},D=(G,V,W)=>{const J=new Array(16);let R,k,z=0;for(R=1;R<=d;R++)J[R]=z=z+W[R-1]<<1;for(k=0;k<=V;k++){let V=G[2*k+1];0!==V&&(G[2*k]=n(J[V]++,V))}},i=G=>{let V;for(V=0;V<J;V++)G.dyn_ltree[2*V]=0;for(V=0;V<R;V++)G.dyn_dtree[2*V]=0;for(V=0;V<19;V++)G.bl_tree[2*V]=0;G.dyn_ltree[512]=1,G.opt_len=G.static_len=0,G.last_lit=G.matches=0},e=G=>{G.bi_valid>8?y(G,G.bi_buf):G.bi_valid>0&&(G.pending_buf[G.pending++]=G.bi_buf),G.bi_buf=0,G.bi_valid=0},F=(G,V,W,J)=>{const R=2*V,d=2*W;return G[R]<G[d]||G[R]===G[d]&&J[V]<=J[W]},f=(G,V,W)=>{const J=G.heap[W];let R=W<<1;for(;R<=G.heap_len&&(R<G.heap_len&&F(V,G.heap[R+1],G.heap[R],G.depth)&&R++,!F(V,J,G.heap[R],G.depth));)G.heap[W]=G.heap[R],W=R,R<<=1;G.heap[W]=J},v=(G,V,J)=>{let R,d,X,P,A=0;if(0!==G.last_lit)do{R=G.pending_buf[G.d_buf+2*A]<<8|G.pending_buf[G.d_buf+2*A+1],d=G.pending_buf[G.l_buf+A],A++,0===R?H(G,d,V):(X=L[d],H(G,X+W+1,V),P=k[X],0!==P&&(d-=t[X],u(G,d,P)),R--,X=r(R),H(G,X,J),P=z[X],0!==P&&(R-=Y[X],u(G,R,P)))}while(A<G.last_lit);H(G,256,V)},C=(G,V)=>{const W=V.dyn_tree,J=V.stat_desc.static_tree,R=V.stat_desc.has_stree,k=V.stat_desc.elems;let z,X,P,A=-1;for(G.heap_len=0,G.heap_max=573,z=0;z<k;z++)0!==W[2*z]?(G.heap[++G.heap_len]=A=z,G.depth[z]=0):W[2*z+1]=0;for(;G.heap_len<2;)P=G.heap[++G.heap_len]=A<2?++A:0,W[2*P]=1,G.depth[P]=0,G.opt_len--,R&&(G.static_len-=J[2*P+1]);for(V.max_code=A,z=G.heap_len>>1;z>=1;z--)f(G,W,z);P=k;do{z=G.heap[1],G.heap[1]=G.heap[G.heap_len--],f(G,W,1),X=G.heap[1],G.heap[--G.heap_max]=z,G.heap[--G.heap_max]=X,W[2*P]=W[2*z]+W[2*X],G.depth[P]=(G.depth[z]>=G.depth[X]?G.depth[z]:G.depth[X])+1,W[2*z+1]=W[2*X+1]=P,G.heap[1]=P++,f(G,W,1)}while(G.heap_len>=2);G.heap[--G.heap_max]=G.heap[1],((G,V)=>{const W=V.dyn_tree,J=V.max_code,R=V.stat_desc.static_tree,k=V.stat_desc.has_stree,z=V.stat_desc.extra_bits,X=V.stat_desc.extra_base,P=V.stat_desc.max_length;let A,x,q,L,t,Y,g=0;for(L=0;L<=d;L++)G.bl_count[L]=0;for(W[2*G.heap[G.heap_max]+1]=0,A=G.heap_max+1;A<573;A++)x=G.heap[A],L=W[2*W[2*x+1]+1]+1,L>P&&(L=P,g++),W[2*x+1]=L,x>J||(G.bl_count[L]++,t=0,x>=X&&(t=z[x-X]),Y=W[2*x],G.opt_len+=Y*(L+t),k&&(G.static_len+=Y*(R[2*x+1]+t)));if(0!==g){do{for(L=P-1;0===G.bl_count[L];)L--;G.bl_count[L]--,G.bl_count[L+1]+=2,G.bl_count[P]--,g-=2}while(g>0);for(L=P;0!==L;L--)for(x=G.bl_count[L];0!==x;)q=G.heap[--A],q>J||(W[2*q+1]!==L&&(G.opt_len+=(L-W[2*q+1])*W[2*q],W[2*q+1]=L),x--)}})(G,V),D(W,A,G.bl_count)},l=(G,V,W)=>{let J,R,d=-1,k=V[1],z=0,X=7,P=4;for(0===k&&(X=138,P=3),V[2*(W+1)+1]=65535,J=0;J<=W;J++)R=k,k=V[2*(J+1)+1],++z<X&&R===k||(z<P?G.bl_tree[2*R]+=z:0!==R?(R!==d&&G.bl_tree[2*R]++,G.bl_tree[32]++):z<=10?G.bl_tree[34]++:G.bl_tree[36]++,z=0,d=R,0===k?(X=138,P=3):R===k?(X=6,P=3):(X=7,P=4))},m=(G,V,W)=>{let J,R,d=-1,k=V[1],z=0,X=7,P=4;for(0===k&&(X=138,P=3),J=0;J<=W;J++)if(R=k,k=V[2*(J+1)+1],!(++z<X&&R===k)){if(z<P)do{H(G,R,G.bl_tree)}while(0!==--z);else 0!==R?(R!==d&&(H(G,R,G.bl_tree),z--),H(G,16,G.bl_tree),u(G,z-3,2)):z<=10?(H(G,17,G.bl_tree),u(G,z-3,3)):(H(G,18,G.bl_tree),u(G,z-11,7));z=0,d=R,0===k?(X=138,P=3):R===k?(X=6,P=3):(X=7,P=4)}};let w=!1;const N=(G,V,W,J)=>{u(G,0+(J?1:0),3),((G,V,W,J)=>{e(G),J&&(y(G,W),y(G,~W)),G.pending_buf.set(G.window.subarray(V,V+W),G.pending),G.pending+=W})(G,V,W,!0)};G.exports._tr_init=G=>{w||((()=>{let G,V,W,P,b;const r=new Array(16);for(W=0,P=0;P<28;P++)for(t[P]=W,G=0;G<1<<k[P];G++)L[W++]=P;for(L[W-1]=P,b=0,P=0;P<16;P++)for(Y[P]=b,G=0;G<1<<z[P];G++)q[b++]=P;for(b>>=7;P<R;P++)for(Y[P]=b<<7,G=0;G<1<<z[P]-7;G++)q[256+b++]=P;for(V=0;V<=d;V++)r[V]=0;for(G=0;G<=143;)A[2*G+1]=8,G++,r[8]++;for(;G<=255;)A[2*G+1]=9,G++,r[9]++;for(;G<=279;)A[2*G+1]=7,G++,r[7]++;for(;G<=287;)A[2*G+1]=8,G++,r[8]++;for(D(A,287,r),G=0;G<R;G++)x[2*G+1]=5,x[2*G]=n(G,5);B=new g(A,k,257,J,d),S=new g(x,z,0,R,d),p=new g(new Array(0),X,0,19,7)})(),w=!0),G.l_desc=new b(G.dyn_ltree,B),G.d_desc=new b(G.dyn_dtree,S),G.bl_desc=new b(G.bl_tree,p),G.bi_buf=0,G.bi_valid=0,i(G)},G.exports._tr_stored_block=N,G.exports._tr_flush_block=(G,V,J,R)=>{let d,k,z=0;G.level>0?(2===G.strm.data_type&&(G.strm.data_type=(G=>{let V,J=4093624447;for(V=0;V<=31;V++,J>>>=1)if(1&J&&0!==G.dyn_ltree[2*V])return 0;if(0!==G.dyn_ltree[18]||0!==G.dyn_ltree[20]||0!==G.dyn_ltree[26])return 1;for(V=32;V<W;V++)if(0!==G.dyn_ltree[2*V])return 1;return 0})(G)),C(G,G.l_desc),C(G,G.d_desc),z=(G=>{let V;for(l(G,G.dyn_ltree,G.l_desc.max_code),l(G,G.dyn_dtree,G.d_desc.max_code),C(G,G.bl_desc),V=18;V>=3&&0===G.bl_tree[2*P[V]+1];V--);return G.opt_len+=3*(V+1)+5+5+4,V})(G),d=G.opt_len+3+7>>>3,k=G.static_len+3+7>>>3,k<=d&&(d=k)):d=k=J+5,J+4<=d&&-1!==V?N(G,V,J,R):4===G.strategy||k===d?(u(G,2+(R?1:0),3),v(G,A,x)):(u(G,4+(R?1:0),3),((G,V,W,J)=>{let R;for(u(G,V-257,5),u(G,W-1,5),u(G,J-4,4),R=0;R<J;R++)u(G,G.bl_tree[2*P[R]+1],3);m(G,G.dyn_ltree,V-1),m(G,G.dyn_dtree,W-1)})(G,G.l_desc.max_code+1,G.d_desc.max_code+1,z+1),v(G,G.dyn_ltree,G.dyn_dtree)),i(G),R&&e(G)},G.exports._tr_tally=(G,V,J)=>(G.pending_buf[G.d_buf+2*G.last_lit]=V>>>8&255,G.pending_buf[G.d_buf+2*G.last_lit+1]=255&V,G.pending_buf[G.l_buf+G.last_lit]=255&J,G.last_lit++,0===V?G.dyn_ltree[2*J]++:(G.matches++,V--,G.dyn_ltree[2*(L[J]+W+1)]++,G.dyn_dtree[2*r(V)]++),G.last_lit===G.lit_bufsize-1),G.exports._tr_align=G=>{u(G,2,3),H(G,256,A),(G=>{16===G.bi_valid?(y(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):G.bi_valid>=8&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)})(G)}},12532:G=>{"use strict";G.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.XV="",this.state=null,this.data_type=2,this.adler=0}},12140:G=>{function V(G,V,W){for(var J=G.length,R=-1/0,d=1/0,k=0;k<J;k++){var z=(W[0][k]-G[k])/V[k],X=(W[1][k]-G[k])/V[k];if(z>X){var P=z;z=X,X=P}if(X<R||z>d)return 1/0;z>R&&(R=z),X<d&&(d=X)}return R>d?1/0:R}G.exports=function(G,W,J,R){var d=V(W,J,R);if(d===1/0)G=null;else{G=G||[];for(var k=0;k<W.length;k++)G[k]=W[k]+J[k]*d}return G},G.exports.distance=V},13500:(G,V,W)=>{"use strict";W.d(V,{c:()=>k});var J=W(33);const R=J.useLayoutEffect;const d=function(G){var V=(0,J.useRef)(G);return R((function(){V.current=G})),V};var k=function(G){var V=d(G);(0,J.dV)((function(){var G=function(G){var W;if(null!=V.current&&(W=V.current(G)),G.defaultPrevented&&(G.returnValue=""),"string"===typeof W)return G.returnValue=W,W};return window.addEventListener("beforeunload",G),function(){window.removeEventListener("beforeunload",G)}}),[])}},13441:(G,V,W)=>{"use strict";var J=W(13450),R=Array.prototype.concat,d=Array.prototype.slice,k=G.exports=function(G){for(var V=[],W=0,k=G.length;W<k;W++){var z=G[W];J(z)?V=R.call(V,d.call(z)):V.push(z)}return V};k.wrap=function(G){return function(){return G(k(arguments))}}},13450:G=>{G.exports=function(G){return!(!G||"string"===typeof G)&&(G instanceof Array||Array.isArray(G)||G.length>=0&&(G.splice instanceof Function||Object.getOwnPropertyDescriptor(G,G.length-1)&&"String"!==G.constructor.name))}},12427:(G,V,W)=>{var J=W(12433);function R(G){for(var V,W,R=0,d=G.length,k=0;k<G.length;){for(V=G[k],W=0;k<d&&G[k]===V;)++k,++W;R+=J.log2(W)/7|0,R+=J.log2(V>>>0)/7|0,R+=2}return R}V.size=R,V.encode=function(G,V){V||(V=new Uint8Array(R(G)));for(var W,J,d=0,k=V.length,z=0;z<G.length;){for(W=G[z],J=0;z<G.length&&G[z]===W;)++z,++J;for(;d<k&&J>=128;)V[d++]=128+(127&J),J>>>=7;if(d>=k)throw new Error("RLE buffer overflow");for(V[d++]=J,W>>>=0;d<k&&W>=128;)V[d++]=128+(127&W),W>>>=7;if(d>=k)throw new Error("RLE buffer overflow");V[d++]=W}return V},V.decode=function(G,V){for(var W,J,R,d,k=V.length,z=G.length,X=0,P=0;P<z;){for(W=0,J=0;P<z&&G[P]>=128;)W+=(127&G[P++])<<J,J+=7;if(W+=G[P++]<<J,P>=z)throw new Error("RLE buffer underrun");if(X+W>k)throw new Error("Chunk buffer overflow");for(R=0,J=0;P<z&&G[P]>=128;)R+=(127&G[P++])<<J,J+=7;if(P>=z)throw new Error("RLE buffer underrun");for(R+=G[P++]<<J,d=0;d<W;++d)V[X++]=R}return V}},12433:(G,V)=>{"use strict";function W(G){var V=32;return(G&=-G)&&V--,65535&G&&(V-=16),16711935&G&&(V-=8),252645135&G&&(V-=4),858993459&G&&(V-=2),1431655765&G&&(V-=1),V}V.INT_BITS=32,V.INT_MAX=2147483647,V.INT_MIN=-1<<31,V.sign=function(G){return(G>0)-(G<0)},V.abs=function(G){var V=G>>31;return(G^V)-V},V.min=function(G,V){return V^(G^V)&-(G<V)},V.max=function(G,V){return G^(G^V)&-(G<V)},V.isPow2=function(G){return!(G&G-1)&&!!G},V.log2=function(G){var V,W;return V=(G>65535)<<4,V|=W=((G>>>=V)>255)<<3,V|=W=((G>>>=W)>15)<<2,(V|=W=((G>>>=W)>3)<<1)|(G>>>=W)>>1},V.log10=function(G){return G>=1e9?9:G>=1e8?8:G>=1e7?7:G>=1e6?6:G>=1e5?5:G>=1e4?4:G>=1e3?3:G>=100?2:G>=10?1:0},V.popCount=function(G){return 16843009*((G=(858993459&(G-=G>>>1&1431655765))+(G>>>2&858993459))+(G>>>4)&252645135)>>>24},V.countTrailingZeros=W,V.nextPow2=function(G){return G+=0===G,--G,G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)+1},V.prevPow2=function(G){return G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)-(G>>>1)},V.parity=function(G){return G^=G>>>16,G^=G>>>8,G^=G>>>4,27030>>>(G&=15)&1};var J=new Array(256);!function(G){for(var V=0;V<256;++V){var W=V,J=V,R=7;for(W>>>=1;W;W>>>=1)J<<=1,J|=1&W,--R;G[V]=J<<R&255}}(J),V.reverse=function(G){return J[255&G]<<24|J[G>>>8&255]<<16|J[G>>>16&255]<<8|J[G>>>24&255]},V.interleave2=function(G,V){return(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))<<1},V.deinterleave2=function(G,V){return(G=65535&((G=16711935&((G=252645135&((G=858993459&((G=G>>>V&1431655765)|G>>>1))|G>>>2))|G>>>4))|G>>>16))<<16>>16},V.interleave3=function(G,V,W){return G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2),(G|=(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},V.deinterleave3=function(G,V){return(G=1023&((G=4278190335&((G=251719695&((G=3272356035&((G=G>>>V&1227133513)|G>>>2))|G>>>4))|G>>>8))|G>>>16))<<22>>22},V.nextCombination=function(G){var V=G|G-1;return V+1|(~V&-~V)-1>>>W(G)+1}},12464:G=>{"use strict";G.exports=function(G,V,W,J){var R=self||window;try{try{var d;try{d=new R.Blob([G])}catch(P){(d=new(R.BlobBuilder||R.WebKitBlobBuilder||R.MozBlobBuilder||R.MSBlobBuilder)).append(G),d=d.getBlob()}var k=R.URL||R.webkitURL,z=k.createObjectURL(d),X=new R[V](z,W);return k.revokeObjectURL(z),X}catch(P){return new R[V]("data:application/javascript,".concat(encodeURIComponent(G)),W)}}catch(P){if(!J)throw Error("Inline worker is not supported");return new R[V](J,W)}}},12126:(G,V,W)=>{"use strict";function J(G,V,W,J,R){var d={};return Object.keys(J).forEach((function(G){d[G]=J[G]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=W.slice().reverse().reduce((function(W,J){return J(G,V,W)||W}),d),R&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(R):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(G,V,d),d=null),d}W.d(V,{e:()=>J})},12122:(G,V,W)=>{"use strict";function J(G,V,W,J){W&&Object.defineProperty(G,V,{enumerable:W.enumerable,configurable:W.configurable,writable:W.writable,value:W.initializer?W.initializer.call(J):void 0})}W.d(V,{c:()=>J})},13484:(G,V,W)=>{"use strict";W.d(V,{c:()=>k,d:()=>x,f:()=>z,j:()=>d,n:()=>X,o:()=>R,r:()=>P,v:()=>A});var J=W(11627);class R{constructor(){this._easingMode=R.EASINGMODE_EASEIN}setEasingMode(G){const V=Math.min(Math.max(G,0),2);this._easingMode=V}getEasingMode(){return this._easingMode}easeInCore(G){throw new Error("You must implement this method")}ease(G){switch(this._easingMode){case R.EASINGMODE_EASEIN:return this.easeInCore(G);case R.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-G)}return G>=.5?.5*(1-this.easeInCore(2*(1-G)))+.5:.5*this.easeInCore(2*G)}}R.EASINGMODE_EASEIN=0,R.EASINGMODE_EASEOUT=1,R.EASINGMODE_EASEINOUT=2;class d extends R{easeInCore(G){return G=Math.max(0,Math.min(1,G)),1-Math.sqrt(1-G*G)}}class k extends R{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=G}easeInCore(G){const V=Math.max(0,this.amplitude);return Math.pow(G,3)-G*V*Math.sin(3.141592653589793*G)}}class z extends R{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=G,this.bounciness=V}easeInCore(G){const V=Math.max(0,this.bounces);let W=this.bounciness;W<=1&&(W=1.001);const J=Math.pow(W,V),R=1-W,d=(1-J)/R+.5*J,k=G*d,z=Math.log(-k*(1-W)+1)/Math.log(W),X=Math.floor(z),P=X+1,A=(1-Math.pow(W,X))/(R*d),x=.5*(A+(1-Math.pow(W,P))/(R*d)),q=G-x,L=x-A;return-Math.pow(1/W,V-X)/(L*L)*(q-L)*(q+L)}}class X extends R{easeInCore(G){return G*G*G}}class P extends R{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=G,this.springiness=V}easeInCore(G){let V;const W=Math.max(0,this.oscillations),J=Math.max(0,this.springiness);return V=0==J?G:(Math.exp(J*G)-1)/(Math.exp(J)-1),V*Math.sin((6.283185307179586*W+1.5707963267948966)*G)}}class A extends R{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=G}easeInCore(G){return this.exponent<=0?G:(Math.exp(this.exponent*G)-1)/(Math.exp(this.exponent)-1)}}class x extends R{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=G,this.y1=V,this.x2=W,this.y2=J}easeInCore(G){return J.c.Interpolate(G,this.x1,this.y1,this.x2,this.y2)}}},12987:(G,V,W)=>{"use strict";W.d(V,{b:()=>k});var J=W(11136),R=W(11152),d=W(11465);class k extends d.d{get _matrix(){return this._compose(),this.zq}set _matrix(G){(G.updateFlag!==this.zq.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.zq.J(G),this._markAsDirtyAndDecompose())}constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(G,V.HG(),!1),this.name=G,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=V,this.zq=(null===R||void 0===R?void 0:R.clone())??J.c.Identity(),this._restMatrix=d??this.zq.clone(),this._bindMatrix=k??this.zq.clone(),this._index=z,this._absoluteMatrix=new J.c,this._absoluteBindMatrix=new J.c,this._absoluteInverseBindMatrix=new J.c,this._finalMatrix=new J.c,V.bones.push(this),this.setParent(W,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(G){this.setParent(G)}setParent(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==G){if(this.parent){const G=this.parent.children.indexOf(this);-1!==G&&this.parent.children.splice(G,1)}this._parentNode=G,this.parent&&this.parent.children.push(this),V&&this._updateAbsoluteBindMatrices(),this.pP()}}getLocalMatrix(){return this._compose(),this.zq}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(G){this._restMatrix.J(G)}setRestPose(G){this.setRestMatrix(G)}getBindPose(){return this.getBindMatrix()}setBindMatrix(G){this.Td(G)}setBindPose(G){this.setBindMatrix(G)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const G=J.h.ed[0],V=J.h.Quaternion[0],W=J.h.ed[1];this.getRestMatrix().decompose(G,V,W),this._linkedTransformNode.position.J(W),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??J.g.Identity(),this._linkedTransformNode.rotationQuaternion.J(V),this._linkedTransformNode.vd.J(G)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(G){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=G,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.wz}set position(G){this._decompose(),this.wz.J(G),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(G){this.setRotation(G)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(G){this.setRotationQuaternion(G)}get vd(){return this.getScale()}set vd(G){this.setScale(G)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=J.o.Zero(),this._localRotation=J.g.Zero(),this.wz=J.o.Zero()),this.zq.decompose(this._localScaling,this._localRotation,this.wz))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,J.c.ComposeToRef(this._localScaling,this._localRotation,this.wz,this.zq)):this._needToCompose=!1)}Td(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.J(G),V&&this._updateAbsoluteBindMatrices(),W?this._matrix=G:this.pP()}_updateAbsoluteBindMatrices(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(G||(G=this._bindMatrix),this.parent?G.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.J(G),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),V)for(let W=0;W<this.children.length;W++)this.children[W]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}pP(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.pP(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.pP(),this._needToDecompose=!0}_updatePosition(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=this.getLocalMatrix();if(0==V)R?(d.addAtIndex(12,G.x),d.addAtIndex(13,G.y),d.addAtIndex(14,G.z)):d.setTranslationFromFloats(G.x,G.y,G.z);else{let V=null;W&&(V=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=k._TmpMats[0],X=k._TmpVecs[0];this.parent?W&&V?(z.J(this.parent.getAbsoluteMatrix()),z.multiplyToRef(V,z)):z.J(this.parent.getAbsoluteMatrix()):J.c.IdentityToRef(z),R&&z.setTranslationFromFloats(0,0,0),z.invert(),J.o.TransformCoordinatesToRef(G,z,X),R?(d.addAtIndex(12,X.x),d.addAtIndex(13,X.y),d.addAtIndex(14,X.z)):d.setTranslationFromFloats(X.x,X.y,X.z)}this._markAsDirtyAndDecompose()}translate(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(G,V,W,!0)}setPosition(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(G,V,W,!1)}setAbsolutePosition(G,V){this.setPosition(G,1,V)}scale(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.getLocalMatrix(),z=k._TmpMats[0];J.c.ScalingToRef(G,V,W,z),z.multiplyToRef(d,d),z.invert();for(const J of this.children){const R=J.getLocalMatrix();R.multiplyToRef(z,R),R.multiplyAtIndex(12,G),R.multiplyAtIndex(13,V),R.multiplyAtIndex(14,W),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),R)for(const J of this.children)J.scale(G,V,W,R)}setScale(G){this._decompose(),this._localScaling.J(G),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(G){this._decompose(),G.J(this._localScaling)}setYawPitchRoll(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0;if(0===R){const z=k._TmpQuat;return J.g.RotationYawPitchRollToRef(G,V,W,z),void this.setRotationQuaternion(z,R,d)}const z=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,d))return;const X=k._TmpMats[1];J.c.RotationYawPitchRollToRef(G,V,W,X),z.multiplyToRef(X,X),this._rotateWithMatrix(X,R,d)}rotate(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,R=arguments.length>3?arguments[3]:void 0;const d=k._TmpMats[0];d.setTranslationFromFloats(0,0,0),J.c.RotationAxisToRef(G,V,d),this._rotateWithMatrix(d,W,R)}setAxisAngle(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,R=arguments.length>3?arguments[3]:void 0;if(0===W){const d=k._TmpQuat;return J.g.RotationAxisToRef(G,V,d),void this.setRotationQuaternion(d,W,R)}const d=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,R))return;const z=k._TmpMats[1];J.c.RotationAxisToRef(G,V,z),d.multiplyToRef(z,z),this._rotateWithMatrix(z,W,R)}setRotation(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(G.y,G.x,G.z,V,W)}setRotationQuaternion(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===V)return this._decompose(),this._localRotation.J(G),void this._markAsDirtyAndCompose();const R=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,W))return;const d=k._TmpMats[1];J.c.FromQuaternionToRef(G,d),R.multiplyToRef(d,d),this._rotateWithMatrix(d,V,W)}setRotationMatrix(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===V){const R=k._TmpQuat;return J.g.FromRotationMatrixToRef(G,R),void this.setRotationQuaternion(R,V,W)}const R=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,W))return;const d=k._TmpMats[1];d.J(G),R.multiplyToRef(G,d),this._rotateWithMatrix(d,V,W)}_rotateWithMatrix(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const J=this.getLocalMatrix(),R=J.m[12],d=J.m[13],z=J.m[14],X=this.getParent(),P=k._TmpMats[3],A=k._TmpMats[4];X&&1==V?(W?(P.J(W.getWorldMatrix()),X.getAbsoluteMatrix().multiplyToRef(P,P)):P.J(X.getAbsoluteMatrix()),A.J(P),A.invert(),J.multiplyToRef(P,J),J.multiplyToRef(G,J),J.multiplyToRef(A,J)):1==V&&W?(P.J(W.getWorldMatrix()),A.J(P),A.invert(),J.multiplyToRef(P,J),J.multiplyToRef(G,J),J.multiplyToRef(A,J)):J.multiplyToRef(G,J),J.setTranslationFromFloats(R,d,z),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(G,V){const W=k._TmpMats[2];return G.J(this.getAbsoluteMatrix()),V?(G.multiplyToRef(V.getWorldMatrix(),G),J.c.ScalingToRef(V.vd.x,V.vd.y,V.vd.z,W)):J.c.IdentityToRef(W),G.invert(),!isNaN(G.m[0])&&(W.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyToRef(W,G),!0)}Jd(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=J.o.Zero();return this.getPositionToRef(G,V,W),W}getPositionToRef(){let G=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const G=this.getLocalMatrix();V.x=G.m[12],V.y=G.m[13],V.z=G.m[14]}else{let W=null;G&&(W=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let J=k._TmpMats[0];G&&W?(J.J(this.getAbsoluteMatrix()),J.multiplyToRef(W,J)):J=this.getAbsoluteMatrix(),V.x=J.m[12],V.y=J.m[13],V.z=J.m[14]}}getAbsolutePosition(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const V=J.o.Zero();return this.getPositionToRef(1,G,V),V}getAbsolutePositionToRef(G,V){this.getPositionToRef(1,G,V)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.zq.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.J(this.zq);const G=this._skeleton.getPoseMatrix();G&&this._absoluteMatrix.multiplyToRef(G,this._absoluteMatrix)}const G=this.children,V=G.length;for(let W=0;W<V;W++)G[W].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}xX(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=J.o.Zero();return this.getDirectionToRef(G,V,W),W}getDirectionToRef(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,R=null;V&&(R=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=k._TmpMats[0];d.J(this.getAbsoluteMatrix()),V&&R&&d.multiplyToRef(R,d),J.o.TransformNormalToRef(G,d,W),W.normalize()}getRotation(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=J.o.Zero();return this.getRotationToRef(G,V,W),W}getRotationToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const J=k._TmpQuat;this.getRotationQuaternionToRef(G,V,J),J.toEulerAnglesToRef(W)}getRotationQuaternion(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=J.g.Identity();return this.getRotationQuaternionToRef(G,V,W),W}getRotationQuaternionToRef(){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),V.J(this._localRotation);else{const W=k._TmpMats[0],J=this.getAbsoluteMatrix();G?J.multiplyToRef(G.getWorldMatrix(),W):W.J(J),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.decompose(void 0,V,void 0)}}getRotationMatrix(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1?arguments[1]:void 0;const W=J.c.Identity();return this.getRotationMatrixToRef(G,V,W),W}getRotationMatrixToRef(){let G=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(V);else{const W=k._TmpMats[0],J=this.getAbsoluteMatrix();G?J.multiplyToRef(G.getWorldMatrix(),W):W.J(J),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.getRotationMatrixToRef(V)}}getAbsolutePositionFromLocal(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=J.o.Zero();return this.getAbsolutePositionFromLocalToRef(G,V,W),W}getAbsolutePositionFromLocalToRef(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,R=null;V&&(R=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=k._TmpMats[0];d.J(this.getAbsoluteMatrix()),V&&R&&d.multiplyToRef(R,d),J.o.TransformCoordinatesToRef(G,d,W)}getLocalPositionFromAbsolute(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=J.o.Zero();return this.getLocalPositionFromAbsoluteToRef(G,V,W),W}getLocalPositionFromAbsoluteToRef(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,R=null;V&&(R=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=k._TmpMats[0];d.J(this.getAbsoluteMatrix()),V&&R&&d.multiplyToRef(R,d),d.invert(),J.o.TransformCoordinatesToRef(G,d,W)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const G=this._skeleton.bones.indexOf(this);if(-1!==G&&this._skeleton.bones.splice(G,1),this._parentNode&&this._parentNode.children){const G=this._parentNode.children,V=G.indexOf(this);-1!==V&&G.splice(V,1)}super.dispose()}}k._TmpVecs=(0,R.b)(2,J.o.Zero),k._TmpQuat=J.g.Identity(),k._TmpMats=(0,R.b)(5,J.c.Identity)},13475:(G,V,W)=>{"use strict";W.d(V,{d:()=>C});var J=W(11317),R=W(11324),d=W(11176),k=W(11136),z=W(11182),X=W(11465),P=W(11510),A=W(11762),x=W(11211),q=W(11145);class L{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(G){this._zoomStopsAnimation=G}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(G){this._idleRotationSpeed=G}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(G){this._idleRotationWaitTime=G}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(G){this._idleRotationSpinupTime=G}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(G){this._attachedCamera=G;const V=this._attachedCamera.HG();this._onPrePointerObservableObserver=V.onPrePointerObservable.add((G=>{G.type!==A.c.POINTERDOWN?G.type===A.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const G=x.e.Now;let V=0;null!=this._lastFrameTime&&(V=G-this._lastFrameTime),this._lastFrameTime=G,this._applyUserInteraction();const W=G-this._lastInteractionTime-this._idleRotationWaitTime,J=Math.max(Math.min(W/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*J,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(V/1e3))}))}detach(){if(!this._attachedCamera)return;const G=this._attachedCamera.HG();this._onPrePointerObservableObserver&&G.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(G){this._lastInteractionTime=G??x.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<q.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let G=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(G=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?G:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=x.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var t=W(13484),Y=W(11847);class g{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(G){if(this._autoTransitionRange===G)return;this._autoTransitionRange=G;const V=this._attachedCamera;V&&(G?this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((G=>{if(G&&(G.kd(!0),G.getBoundingInfo)){const V=G.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*V,this.upperRadiusTransitionRange=.05*V}})):this._onMeshTargetChangedObserver&&V.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(G){this._attachedCamera=G,this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(G){return!!this._attachedCamera&&(this._attachedCamera.radius===G&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(G){if(!this._attachedCamera)return;this._radiusBounceTransition||(g.EasingFunction.setEasingMode(g.EasingMode),this._radiusBounceTransition=Y.e.CreateAnimation("radius",Y.e.ANIMATIONTYPE_FLOAT,60,g.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const V=Y.e.TransitionTo("radius",this._attachedCamera.radius+G,this._attachedCamera,this._attachedCamera.HG(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));V&&this._animatables.push(V)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}g.EasingFunction=new t.c(.3),g.EasingMode=t.o.EASINGMODE_EASEOUT;class B{constructor(){this.onTargetFramingAnimationEndObservable=new d.b,this._mode=B.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(G){this._mode=G}get mode(){return this._mode}set radiusScale(G){this._radiusScale=G}get radiusScale(){return this._radiusScale}set positionScale(G){this._positionScale=G}get positionScale(){return this._positionScale}set defaultElevation(G){this._defaultElevation=G}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(G){this._elevationReturnTime=G}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(G){this._elevationReturnWaitTime=G}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(G){this._zoomStopsAnimation=G}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(G){this._framingTime=G}get framingTime(){return this._framingTime}init(){}attach(G){this._attachedCamera=G;const V=this._attachedCamera.HG();B.EasingFunction.setEasingMode(B.EasingMode),this._onPrePointerObservableObserver=V.onPrePointerObservable.add((G=>{G.type!==A.c.POINTERDOWN?G.type===A.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=G.onMeshTargetChangedObservable.add((G=>{G&&G.getBoundingInfo&&this.zoomOnMesh(G,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const G=this._attachedCamera.HG();this._onPrePointerObservableObserver&&G.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G.kd(!0);const J=G.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(J.minimumWorld,J.maximumWorld,V,W)}zoomOnMeshHierarchy(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G.kd(!0);const J=G.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(J.min,J.max,V,W)}zoomOnMeshesHierarchy(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new k.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R=new k.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let d=0;d<G.length;d++){const V=G[d].getHierarchyBoundingVectors(!0);k.o.CheckExtends(V.min,J,R),k.o.CheckExtends(V.max,J,R)}this.zoomOnBoundingInfo(J,R,V,W)}zoomOnBoundingInfo(G,V){let W,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const d=G.y,z=d+(V.y-d)*this._positionScale,X=V.zW(G).scale(.5);if(!isFinite(z))return!1;if(J)W=new k.o(0,z,0);else{const V=G.add(X);W=new k.o(V.x,z,V.z)}this._vectorTransition||(this._vectorTransition=Y.e.CreateAnimation("target",Y.e.ANIMATIONTYPE_VECTOR3,60,B.EasingFunction)),this._betaIsAnimating=!0;let P=Y.e.TransitionTo("target",W,this._attachedCamera,this._attachedCamera.HG(),60,this._vectorTransition,this._framingTime);P&&this._animatables.push(P);let A=0;if(this._mode===B.FitFrustumSidesMode){const W=this._calculateLowerRadiusFromModelBoundingSphere(G,V);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=X.length()+this._attachedCamera.Zd),A=W}else this._mode===B.IgnoreBoundsSizeMode&&(A=this._calculateLowerRadiusFromModelBoundingSphere(G,V),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Zd));if(this.autoCorrectCameraLimitsAndSensibility){const W=V.zW(G).length();this._attachedCamera.panningSensibility=5e3/W,this._attachedCamera.wheelPrecision=100/A}return this._radiusTransition||(this._radiusTransition=Y.e.CreateAnimation("radius",Y.e.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),P=Y.e.TransitionTo("radius",A,this._attachedCamera,this._attachedCamera.HG(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),R&&R(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),P&&this._animatables.push(P),!0}_calculateLowerRadiusFromModelBoundingSphere(G,V){const W=this._attachedCamera;if(!W)return 0;let J=W._calculateLowerRadiusFromModelBoundingSphere(G,V,this._radiusScale);return W.lowerRadiusLimit&&this._mode===B.IgnoreBoundsSizeMode&&(J=J<W.lowerRadiusLimit?W.lowerRadiusLimit:J),W.upperRadiusLimit&&(J=J>W.upperRadiusLimit?W.upperRadiusLimit:J),J}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const G=x.e.Now-this._lastInteractionTime,V=.5*Math.PI-this._defaultElevation,W=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>W&&G>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Y.e.CreateAnimation("beta",Y.e.ANIMATIONTYPE_FLOAT,60,B.EasingFunction));const G=Y.e.TransitionTo("beta",V,this._attachedCamera,this._attachedCamera.HG(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));G&&this._animatables.push(G)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=x.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}B.EasingFunction=new t.v,B.EasingMode=t.o.EASINGMODE_EASEINOUT,B.IgnoreBoundsSizeMode=0,B.FitFrustumSidesMode=1;var S=W(11516),p=W(11718),b=W(12979),r=W(11189);class y{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(G){G=r.h.BackCompatCameraNoPreventDefault(arguments);const V=this.camera.getEngine(),W=V.getInputElement();let J=0,R=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=d=>{var k,z;const X=d.event,P="touch"===X.pointerType;if(d.type!==A.c.POINTERMOVE&&-1===this.buttons.indexOf(X.button))return;const x=X.target;if(this._altKey=X.altKey,this._ctrlKey=X.ctrlKey,this._metaKey=X.metaKey,this._shiftKey=X.shiftKey,this._buttonsPressed=X.buttons,V.isPointerLock){const G=X.movementX,V=X.movementY;this.onTouch(null,G,V),this._pointA=null,this._pointB=null}else{if(d.type!==A.c.POINTERDOWN&&d.type!==A.c.POINTERDOUBLETAP&&P&&(null===(k=this._pointA)||void 0===k?void 0:k.pointerId)!==X.pointerId&&(null===(z=this._pointB)||void 0===z?void 0:z.pointerId)!==X.pointerId)return;if(d.type!==A.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!P)if(d.type===A.c.POINTERDOUBLETAP)this.onDoubleTap(X.pointerType);else if(d.type!==A.c.POINTERUP||this._currentMousePointerIdDown!==X.pointerId&&!P){if(d.type===A.c.POINTERMOVE)if(G||X.preventDefault(),this._pointA&&null===this._pointB){const G=X.clientX-this._pointA.x,V=X.clientY-this._pointA.y;this._pointA.x=X.clientX,this._pointA.y=X.clientY,this.onTouch(this._pointA,G,V)}else if(this._pointA&&this._pointB){const G=this._pointA.pointerId===X.pointerId?this._pointA:this._pointB;G.x=X.clientX,G.y=X.clientY;const V=this._pointA.x-this._pointB.x,W=this._pointA.y-this._pointB.y,k=V*V+W*W,z={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:X.pointerId,type:d.type};this.onMultiTouch(this._pointA,this._pointB,J,k,R,z),R=z,J=k}}else{try{null===x||void 0===x||x.releasePointerCapture(X.pointerId)}catch(q){}P||(this._pointB=null),V._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==X.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==X.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==J||R)&&(this.onMultiTouch(this._pointA,this._pointB,J,0,R,null),J=0,R=null),this._currentMousePointerIdDown=-1,this.onButtonUp(X),G||X.preventDefault()}else{try{null===x||void 0===x||x.setPointerCapture(X.pointerId)}catch(q){}if(null===this._pointA)this._pointA={x:X.clientX,y:X.clientY,pointerId:X.pointerId,type:X.pointerType};else{if(null!==this._pointB)return;this._pointB={x:X.clientX,y:X.clientY,pointerId:X.pointerId,type:X.pointerType}}-1!==this._currentMousePointerIdDown||P||(this._currentMousePointerIdDown=X.pointerId),this.onButtonDown(X),G||(X.preventDefault(),W&&W.focus())}}},this._observer=this.camera.HG()._inputManager._addCameraPointerObserver(this._pointerInput,A.c.POINTERDOWN|A.c.POINTERUP|A.c.POINTERMOVE|A.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,J=0,R=null,this.onLostFocus()},this._contextMenuBind=G=>this.onContextMenu(G),W&&W.addEventListener("contextmenu",this._contextMenuBind,!1);const d=this.camera.HG().getEngine().getHostWindow();d&&r.h.RegisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])}zx(){if(this._onLostFocus){const G=this.camera.HG().getEngine().getHostWindow();G&&r.h.UnregisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.HG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const G=this.camera.HG().getEngine().getInputElement();G&&G.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(G){}onTouch(G,V,W){}onMultiTouch(G,V,W,J,R,d){}onContextMenu(G){G.preventDefault()}onButtonDown(G){}onButtonUp(G){}onLostFocus(){}}(0,J.e)([(0,R.I)()],y.prototype,"buttons",void 0);class u extends y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(G,V){if(0!==this.panningSensibility&&G&&V){const W=V.x-G.x,J=V.y-G.y;this.camera.inertialPanningX+=-W/this.panningSensibility,this.camera.inertialPanningY+=J/this.panningSensibility}}_computePinchZoom(G,V){const W=this.camera.radius||u.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=W*Math.sqrt(G)/Math.sqrt(V):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(V-G)*W*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(V-G)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(G,V,W){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-V/this.panningSensibility,this.camera.inertialPanningY+=W/this.panningSensibility):(this.camera.inertialAlphaOffset-=V/this.angularSensibilityX,this.camera.inertialBetaOffset-=W/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(G,V,W,J,R,d){0===W&&null===R||0===J&&null===d||(this.multiTouchPanAndZoom?(this._computePinchZoom(W,J),this._computeMultiTouchPanning(R,d)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(J)-Math.sqrt(W))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(W,J),this._isPinching=!0):this._computeMultiTouchPanning(R,d)):this.multiTouchPanning?this._computeMultiTouchPanning(R,d):this.pinchZoom&&this._computePinchZoom(W,J))}onButtonDown(G){this._isPanClick=G.button===this.camera._panningMouseButton}onButtonUp(G){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}u.MinimumRadiusForPinch=.001,(0,J.e)([(0,R.I)()],u.prototype,"buttons",void 0),(0,J.e)([(0,R.I)()],u.prototype,"angularSensibilityX",void 0),(0,J.e)([(0,R.I)()],u.prototype,"angularSensibilityY",void 0),(0,J.e)([(0,R.I)()],u.prototype,"pinchPrecision",void 0),(0,J.e)([(0,R.I)()],u.prototype,"pinchDeltaPercentage",void 0),(0,J.e)([(0,R.I)()],u.prototype,"useNaturalPinchZoom",void 0),(0,J.e)([(0,R.I)()],u.prototype,"pinchZoom",void 0),(0,J.e)([(0,R.I)()],u.prototype,"panningSensibility",void 0),(0,J.e)([(0,R.I)()],u.prototype,"multiTouchPanning",void 0),(0,J.e)([(0,R.I)()],u.prototype,"multiTouchPanAndZoom",void 0),b.b.ArcRotateCameraPointersInput=u;var H=W(11771);class n{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(G){G=r.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.HG(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((V=>{const W=V.event;if(!W.metaKey)if(V.type===H.e.KEYDOWN){if(this._ctrlPressed=W.ctrlKey,this._altPressed=W.altKey,-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),W.preventDefault&&(G||W.preventDefault())}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){const V=this._keys.indexOf(W.keyCode);V>=0&&this._keys.splice(V,1),W.preventDefault&&(G||W.preventDefault())}})))}zx(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const G=this.camera;for(let V=0;V<this._keys.length;V++){const W=this._keys[V];-1!==this.keysLeft.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningX-=1/this.panningSensibility:G.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?G.inertialRadiusOffset+=1/this.zoomingSensibility:G.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningX+=1/this.panningSensibility:G.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?G.inertialRadiusOffset-=1/this.zoomingSensibility:G.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(W)&&G.useInputToRestoreState&&G.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,J.e)([(0,R.I)()],n.prototype,"keysUp",void 0),(0,J.e)([(0,R.I)()],n.prototype,"keysDown",void 0),(0,J.e)([(0,R.I)()],n.prototype,"keysLeft",void 0),(0,J.e)([(0,R.I)()],n.prototype,"keysRight",void 0),(0,J.e)([(0,R.I)()],n.prototype,"keysReset",void 0),(0,J.e)([(0,R.I)()],n.prototype,"panningSensibility",void 0),(0,J.e)([(0,R.I)()],n.prototype,"zoomingSensibility",void 0),(0,J.e)([(0,R.I)()],n.prototype,"useAltToZoom",void 0),(0,J.e)([(0,R.I)()],n.prototype,"angularSpeed",void 0),b.b.ArcRotateCameraKeyboardMoveInput=n;var D=W(11409),i=W(11777);class e{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new k.o(0,0,0),this._globalOffset=new k.o(0,0,0),this._inertialPanning=k.o.Zero()}_computeDeltaFromMouseWheelLegacyEvent(G,V){let W=0;const J=.01*G*this.wheelDeltaPercentage*V;return W=G>0?J/(1+this.wheelDeltaPercentage):J*(1+this.wheelDeltaPercentage),W}attachControl(G){G=r.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=V=>{if(V.type!==A.c.POINTERWHEEL)return;const W=V.event;let J=0;const R=W.deltaMode===i.c.DOM_DELTA_LINE?40:1,d=-W.deltaY*R;if(this.customComputeDeltaFromMouseWheel)J=this.customComputeDeltaFromMouseWheel(d,this,W);else if(this.wheelDeltaPercentage){if(J=this._computeDeltaFromMouseWheelLegacyEvent(d,this.camera.radius),J>0){let G=this.camera.radius,V=this.camera.inertialRadiusOffset+J;for(let W=0;W<20&&!(G<=V)&&!(Math.abs(V*this.camera.inertia)<.001);W++)G-=V,V*=this.camera.inertia;G=(0,z.Clamp)(G,0,Number.MAX_VALUE),J=this._computeDeltaFromMouseWheelLegacyEvent(d,G)}}else J=d/(40*this.wheelPrecision);J&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(J)):this.camera.inertialRadiusOffset+=J),W.preventDefault&&(G||W.preventDefault())},this._observer=this.camera.HG()._inputManager._addCameraPointerObserver(this._wheel,A.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Ud(0)}zx(){this._observer&&(this.camera.HG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const G=this.camera;0+G.inertialAlphaOffset+G.inertialBetaOffset+G.inertialRadiusOffset&&(this._updateHitPlane(),G.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(G.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const G=this.camera,V=G.target.zW(G.position);this._hitPlane=D.c.FromPositionAndNormal(G.target,V)}_getPosition(){const G=this.camera,V=G.HG(),W=V.createPickingRay(V.pointerX,V.pointerY,k.c.Identity(),G,!1);0===G.targetScreenOffset.x&&0===G.targetScreenOffset.y||(this._viewOffset.set(G.targetScreenOffset.x,G.targetScreenOffset.y,0),G.getViewMatrix().invertToRef(G._cameraTransformMatrix),this._globalOffset=k.o.TransformNormal(this._viewOffset,G._cameraTransformMatrix),W.origin.addInPlace(this._globalOffset));let J=0;return this._hitPlane&&(J=W.intersectsPlane(this._hitPlane)??0),W.origin.addInPlace(W.direction.scaleInPlace(J))}_zoomToMouse(G){const V=this.camera,W=1-V.inertia;if(V.lowerRadiusLimit){const J=V.lowerRadiusLimit??0;V.radius-(V.inertialRadiusOffset+G)/W<J&&(G=(V.radius-J)*W-V.inertialRadiusOffset)}if(V.upperRadiusLimit){const J=V.upperRadiusLimit??0;V.radius-(V.inertialRadiusOffset+G)/W>J&&(G=(V.radius-J)*W-V.inertialRadiusOffset)}const J=G/W/V.radius,R=this._getPosition(),d=k.h.ed[6];R.subtractToRef(V.target,d),d.scaleInPlace(J),d.scaleInPlace(W),this._inertialPanning.addInPlace(d),V.inertialRadiusOffset+=G}_zeroIfClose(G){Math.abs(G.x)<q.c&&(G.x=0),Math.abs(G.y)<q.c&&(G.y=0),Math.abs(G.z)<q.c&&(G.z=0)}}(0,J.e)([(0,R.I)()],e.prototype,"wheelPrecision",void 0),(0,J.e)([(0,R.I)()],e.prototype,"zoomToMouseLocation",void 0),(0,J.e)([(0,R.I)()],e.prototype,"wheelDeltaPercentage",void 0),b.b.ArcRotateCameraMouseWheelInput=e;class F extends b.d{constructor(G){super(G)}addMouseWheel(){return this.add(new e),this}addPointers(){return this.add(new u),this}addKeyboard(){return this.add(new n),this}}var f=W(11159);function v(G,V){return isNaN(G)?V:G}X.d.AddNodeConstructor("ArcRotateCamera",((G,V)=>()=>new C(G,0,0,1,k.o.Zero(),V)));class C extends p.e{get target(){return this._target}set target(G){this.setTarget(G)}get targetHost(){return this._targetHost}set targetHost(G){G&&this.setTarget(G)}getTarget(){return this.target}get position(){return this._position}set position(G){this.setPosition(G)}set upVector(G){this._upToYMatrix||(this._yToUpMatrix=new k.c,this._upToYMatrix=new k.c,this._upVector=k.o.Zero()),G.normalize(),this._upVector.J(G),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){k.c.RotationAlignToRef(k.o.UpReadOnly,this._upVector,this._yToUpMatrix),k.c.RotationAlignToRef(this._upVector,k.o.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const G=this.inputs.attached.pointers;return G?G.angularSensibilityX:0}set angularSensibilityX(G){const V=this.inputs.attached.pointers;V&&(V.angularSensibilityX=G)}get angularSensibilityY(){const G=this.inputs.attached.pointers;return G?G.angularSensibilityY:0}set angularSensibilityY(G){const V=this.inputs.attached.pointers;V&&(V.angularSensibilityY=G)}get pinchPrecision(){const G=this.inputs.attached.pointers;return G?G.pinchPrecision:0}set pinchPrecision(G){const V=this.inputs.attached.pointers;V&&(V.pinchPrecision=G)}get pinchDeltaPercentage(){const G=this.inputs.attached.pointers;return G?G.pinchDeltaPercentage:0}set pinchDeltaPercentage(G){const V=this.inputs.attached.pointers;V&&(V.pinchDeltaPercentage=G)}get useNaturalPinchZoom(){const G=this.inputs.attached.pointers;return!!G&&G.useNaturalPinchZoom}set useNaturalPinchZoom(G){const V=this.inputs.attached.pointers;V&&(V.useNaturalPinchZoom=G)}get panningSensibility(){const G=this.inputs.attached.pointers;return G?G.panningSensibility:0}set panningSensibility(G){const V=this.inputs.attached.pointers;V&&(V.panningSensibility=G)}get keysUp(){const G=this.inputs.attached.keyboard;return G?G.keysUp:[]}set keysUp(G){const V=this.inputs.attached.keyboard;V&&(V.keysUp=G)}get keysDown(){const G=this.inputs.attached.keyboard;return G?G.keysDown:[]}set keysDown(G){const V=this.inputs.attached.keyboard;V&&(V.keysDown=G)}get keysLeft(){const G=this.inputs.attached.keyboard;return G?G.keysLeft:[]}set keysLeft(G){const V=this.inputs.attached.keyboard;V&&(V.keysLeft=G)}get keysRight(){const G=this.inputs.attached.keyboard;return G?G.keysRight:[]}set keysRight(G){const V=this.inputs.attached.keyboard;V&&(V.keysRight=G)}get wheelPrecision(){const G=this.inputs.attached.mousewheel;return G?G.wheelPrecision:0}set wheelPrecision(G){const V=this.inputs.attached.mousewheel;V&&(V.wheelPrecision=G)}get zoomToMouseLocation(){const G=this.inputs.attached.mousewheel;return!!G&&G.zoomToMouseLocation}set zoomToMouseLocation(G){const V=this.inputs.attached.mousewheel;V&&(V.zoomToMouseLocation=G)}get wheelDeltaPercentage(){const G=this.inputs.attached.mousewheel;return G?G.wheelDeltaPercentage:0}set wheelDeltaPercentage(G){const V=this.inputs.attached.mousewheel;V&&(V.wheelDeltaPercentage=G)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(G){G!==this.useBouncingBehavior&&(G?(this._bouncingBehavior=new g,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(G){G!==this.useFramingBehavior&&(G?(this._framingBehavior=new B,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(G){G!==this.useAutoRotationBehavior&&(G?(this._autoRotationBehavior=new L,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(G,V,W,J,R,z){var X;let P=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(G,k.o.Zero(),z,P),X=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=k.o.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=k.k.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new k.c,this.panningAxis=new k.o(1,1,0),this._transformedDirection=new k.o,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new d.b,this.checkCollisions=!1,this.collisionRadius=new k.o(.5,.5,.5),this._previousPosition=k.o.Zero(),this._collisionVelocity=k.o.Zero(),this._newPosition=k.o.Zero(),this._computationVector=k.o.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new k.o(NaN,NaN,NaN),this._goalTargetScreenOffset=new k.k(NaN,NaN),this._onCollisionPositionChange=function(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W?(X.setPosition(V),X.GL&&X.GL(W)):X._previousPosition.J(X._position);const J=Math.cos(X.alpha),R=Math.sin(X.alpha),d=Math.cos(X.beta);let k=Math.sin(X.beta);0===k&&(k=1e-4);const z=X._getTargetPosition();X._computationVector.rd(X.radius*J*k,X.radius*d,X.radius*R*k),z.addToRef(X._computationVector,X._newPosition),X._position.J(X._newPosition);let P=X.upVector;X.allowUpsideDown&&X.beta<0&&(P=P.clone(),P=P.negate()),X._computeViewMatrix(X._position,z,P),X._viewMatrix.addAtIndex(12,X.targetScreenOffset.x),X._viewMatrix.addAtIndex(13,X.targetScreenOffset.y),X._collisionTriggered=!1},this._target=k.o.Zero(),R&&this.setTarget(R),this.alpha=V,this.beta=W,this.radius=J,this.getViewMatrix(),this.inputs=new F(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new k.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=k.k.Zero()}_updateCache(G){G||super._updateCache(),this._cache._target.J(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.J(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const G=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?G.addToRef(this._targetBoundingCenter,this._target):this._target.J(G)}const G=this._getLockedTargetPosition();return G||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>q.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,d=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=d?this._currentInterpolationFactor=d:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=v(G,this._goalAlpha),this._goalBeta=v(V,this._goalBeta),this._goalRadius=v(W,this._goalRadius),this._goalTarget.set(v(J.x,this._goalTarget.x),v(J.y,this._goalTarget.y),v(J.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(v(R.x,this._goalTargetScreenOffset.x),v(R.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,z.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,z.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,z.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,z.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const R=arguments;V=r.h.BackCompatCameraNoPreventDefault(R),this._useCtrlForPanning=W,this._panningMouseButton=J,"boolean"===typeof R[0]&&(R.length>1&&(this._useCtrlForPanning=R[1]),R.length>2&&(this._panningMouseButton=R[2])),this.inputs.attachElement(V),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}zx(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let G=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){G=!0;const V=this.invertRotation?-1:1,W=this._calculateHandednessMultiplier();let J=this.inertialAlphaOffset*W;this.beta<0&&(J*=-1),this.alpha+=J*V,this.beta+=this.inertialBetaOffset*V,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<q.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<q.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*q.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){G=!0;const V=new k.o(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),V.multiplyInPlace(this.panningAxis),k.o.TransformNormalToRef(V,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const G=this.upVector,V=k.o.CrossToRef(this._transformedDirection,G,this._transformedDirection);k.o.CrossToRef(G,V,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);k.o.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.J(this._transformedDirection)}else{if(this.parent){const G=k.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(G),G.transposeToRef(G),k.o.TransformCoordinatesToRef(this._transformedDirection,G,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*q.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*q.c&&(this.inertialPanningY=0)}if(G)this.stopInterpolation();else if(this._isInterpolating){let G=!1;const V=this._scene.getEngine().getDeltaTime()/1e3,W=1-Math.pow(2,-V/this._currentInterpolationFactor),J=v(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const V=k.h.ed[0].set(v(this._goalTarget.x,this._target.x),v(this._goalTarget.y,this._target.y),v(this._goalTarget.z,this._target.z));k.o.LerpToRef(this.target,V,W,this._target),10*k.o.Distance(this.target,V)/J<q.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.J(V),this.setTarget(this.target,!1,!0,!0)):G=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const V=k.g.RotationAlphaBetaGammaToRef(v(this._goalAlpha,this.alpha),v(this._goalBeta,this.beta),0,k.h.Quaternion[0]),J=k.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,k.h.Quaternion[1]),R=k.g.SlerpToRef(J,V,W,k.h.Quaternion[2]);R.normalize();const d=R.toAlphaBetaGammaToRef(k.h.ed[0]);if(this.alpha=d.x,this.beta=d.y,R.isApprox(V,q.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const G=V.toAlphaBetaGammaToRef(k.h.ed[0]);this.alpha=G.x,this.beta=G.y}else G=!0}if(isNaN(this._goalRadius)||(this.radius+=(J-this.radius)*W,Math.abs(J/this.radius-1)<q.c?(this._goalRadius=NaN,this.radius=J):G=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const V=k.h.Vector2[0].set(v(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),v(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));k.k.LerpToRef(this.targetScreenOffset,V,W,this.targetScreenOffset),k.k.Distance(this.targetScreenOffset,V)<q.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.J(V)):G=!0}this._isInterpolating=G}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||k.o.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const G=this.alpha;var V,W;this.alpha=function(G){let V=Math.PI/2;return 0===G.x&&0===G.z||(V=Math.acos(G.x/Math.sqrt(Math.pow(G.x,2)+Math.pow(G.z,2)))),G.z<0&&(V=2*Math.PI-V),V}(this._computationVector),this.beta=(V=this._computationVector.y,W=this.radius,Math.acos(V/W));const J=Math.round((G-this.alpha)/(2*Math.PI));this.alpha+=2*J*Math.PI,this._checkLimits()}setPosition(G){this._position.equals(G)||(this._position.J(G),this.rebuildAnglesAndRadius())}setTarget(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(J=this.overrideCloneAlphaBetaRadius??J,G.kd)V&&G.getBoundingInfo?this._targetBoundingCenter=G.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,G.kd(),this._targetHost=G,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const V=G,J=this._getTargetPosition();if(J&&!W&&J.equals(V))return;this._targetHost=null,this._target=V,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}J||this.rebuildAnglesAndRadius()}_getViewMatrix(){const G=Math.cos(this.alpha),V=Math.sin(this.alpha),W=Math.cos(this.beta);let J=Math.sin(this.beta);0===J&&(J=1e-4),0===this.radius&&(this.radius=1e-4);const R=this._getTargetPosition();if(this._computationVector.rd(this.radius*G*J,this.radius*W,this.radius*V*J),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||k.o.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),R.addToRef(this._computationVector,this._newPosition),this.HG().collisionsEnabled&&this.checkCollisions){const G=this.HG().collisionCoordinator;this._collider||(this._collider=G.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,G.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.J(this._newPosition);let G=this.upVector;this.allowUpsideDown&&J<0&&(G=G.negate()),this._computeViewMatrix(this._position,R,G),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.J(R),this._viewMatrix}zoomOn(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G=G||this.HG().meshes;const W=P.b.MinMax(G);let J=this._calculateLowerRadiusFromModelBoundingSphere(W.min,W.max);if(J=Math.max(Math.min(J,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=J*this.zoomOnFactor,this.mode===S.c.ORTHOGRAPHIC_CAMERA){const G=this.HG().getEngine().getAspectRatio(this),V=J*this.zoomOnFactor/2;this.orthoLeft=-V*G,this.orthoRight=V*G,this.orthoBottom=-V,this.orthoTop=V}this.focusOn({min:W.min,max:W.max,distance:J},V)}focusOn(G){let V,W,J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===G.min){const J=G||this.HG().meshes;V=P.b.MinMax(J),W=k.o.Distance(V.min,V.max)}else{V=G,W=G.distance}this._target=P.b.Center(V),J||(this.maxZ=2*W)}createRigCamera(G,V){let W=0;switch(this.cameraRigMode){case S.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.c.RIG_MODE_VR:W=this._cameraRigParams.stereoHalfAngle*(0===V?1:-1);break;case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:W=this._cameraRigParams.stereoHalfAngle*(0===V?-1:1)}const J=new C(G,this.alpha+W,this.beta,this.radius,this._target,this.HG());return J._cameraRigParams={},J.isRigCamera=!0,J.rigParent=this,J.upVector=this.upVector,J.mode=this.mode,J.orthoLeft=this.orthoLeft,J.orthoRight=this.orthoRight,J.orthoBottom=this.orthoBottom,J.orthoTop=this.orthoTop,J}_updateRigCameras(){const G=this._rigCameras[0],V=this._rigCameras[1];switch(G.beta=V.beta=this.beta,this.cameraRigMode){case S.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.c.RIG_MODE_VR:G.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:G.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const J=k.o.Distance(G,V),R=this.HG().getEngine().getAspectRatio(this),d=Math.tan(this.fov/2),z=d*R,X=.5*J*W,P=X*Math.sqrt(1+1/(z*z)),A=X*Math.sqrt(1+1/(d*d));return Math.max(P,A)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,J.e)([(0,R.I)()],C.prototype,"alpha",void 0),(0,J.e)([(0,R.I)()],C.prototype,"beta",void 0),(0,J.e)([(0,R.I)()],C.prototype,"radius",void 0),(0,J.e)([(0,R.I)()],C.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,J.e)([(0,R.F)("target")],C.prototype,"_target",void 0),(0,J.e)([(0,R.v)("targetHost")],C.prototype,"_targetHost",void 0),(0,J.e)([(0,R.I)()],C.prototype,"inertialAlphaOffset",void 0),(0,J.e)([(0,R.I)()],C.prototype,"inertialBetaOffset",void 0),(0,J.e)([(0,R.I)()],C.prototype,"inertialRadiusOffset",void 0),(0,J.e)([(0,R.I)()],C.prototype,"lowerAlphaLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"upperAlphaLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"lowerBetaLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"upperBetaLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"lowerRadiusLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"upperRadiusLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"lowerTargetYLimit",void 0),(0,J.e)([(0,R.I)()],C.prototype,"inertialPanningX",void 0),(0,J.e)([(0,R.I)()],C.prototype,"inertialPanningY",void 0),(0,J.e)([(0,R.I)()],C.prototype,"pinchToPanMaxDistance",void 0),(0,J.e)([(0,R.I)()],C.prototype,"panningDistanceLimit",void 0),(0,J.e)([(0,R.F)()],C.prototype,"panningOriginTarget",void 0),(0,J.e)([(0,R.I)()],C.prototype,"panningInertia",void 0),(0,J.e)([(0,R.I)()],C.prototype,"zoomToMouseLocation",null),(0,J.e)([(0,R.I)()],C.prototype,"zoomOnFactor",void 0),(0,J.e)([(0,R.B)()],C.prototype,"targetScreenOffset",void 0),(0,J.e)([(0,R.I)()],C.prototype,"allowUpsideDown",void 0),(0,J.e)([(0,R.I)()],C.prototype,"useInputToRestoreState",void 0),(0,J.e)([(0,R.I)()],C.prototype,"restoreStateInterpolationFactor",void 0),(0,f.d)("BABYLON.ArcRotateCamera",C)},12979:(G,V,W)=>{"use strict";W.d(V,{b:()=>k,d:()=>z});var J=W(11201),R=W(11411),d=W(11516),k={};class z{constructor(G){this.attachedToElement=!1,this.attached={},this.camera=G,this.checkInputs=()=>{}}add(G){const V=G.getSimpleName();this.attached[V]?J.c.Warn("camera input of type "+V+" already exists on camera"):(this.attached[V]=G,G.camera=this.camera,G.checkInputs&&(this.checkInputs=this._addCheckInputs(G.checkInputs.bind(G))),this.attachedToElement&&G.attachControl(this.noPreventDefault))}remove(G){for(const V in this.attached){const W=this.attached[V];if(W===G)return W.zx(),W.camera=null,delete this.attached[V],void this.rebuildInputCheck()}}removeByType(G){for(const V in this.attached){const W=this.attached[V];W.getClassName()===G&&(W.zx(),W.camera=null,delete this.attached[V],this.rebuildInputCheck())}}_addCheckInputs(G){const V=this.checkInputs;return()=>{V(),G()}}attachInput(G){this.attachedToElement&&G.attachControl(this.noPreventDefault)}attachElement(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){G=!d.c.ForceAttachControlToAlwaysPreventDefault&&G,this.attachedToElement=!0,this.noPreventDefault=G;for(const V in this.attached)this.attached[V].attachControl(G)}}detachElement(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const V in this.attached)this.attached[V].zx(),G&&(this.attached[V].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const G in this.attached){const V=this.attached[G];V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(G){const V={};for(const W in this.attached){const G=this.attached[W],J=R.e.Serialize(G);V[G.getClassName()]=J}G.inputsmgr=V}parse(G){const V=G.inputsmgr;if(V){this.clear();for(const G in V){const W=k[G];if(W){const J=V[G],d=R.e.Parse((()=>new W),J,null);this.add(d)}}}else for(const W in this.attached){const V=k[this.attached[W].getClassName()];if(V){const J=R.e.Parse((()=>new V),G,null);this.remove(this.attached[W]),this.add(J)}}}}},12973:(G,V,W)=>{"use strict";W.d(V,{b:()=>y});var J=W(11317),R=W(11324),d=W(11136),k=W(11718),z=W(12979),X=W(11771),P=W(11189);class A{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(G){G=P.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.HG(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((V=>{const W=V.event;if(!W.metaKey)if(V.type===X.e.KEYDOWN){if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),G||W.preventDefault()}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){const V=this._keys.indexOf(W.keyCode);V>=0&&this._keys.splice(V,1),G||W.preventDefault()}})))}zx(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const G=this.camera;for(let V=0;V<this._keys.length;V++){const W=this._keys[V],J=G._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(W)?G._localDirection.rd(-J,0,0):-1!==this.keysUp.indexOf(W)?G._localDirection.rd(0,0,J):-1!==this.keysRight.indexOf(W)?G._localDirection.rd(J,0,0):-1!==this.keysDown.indexOf(W)?G._localDirection.rd(0,0,-J):-1!==this.keysUpward.indexOf(W)?G._localDirection.rd(0,J,0):-1!==this.keysDownward.indexOf(W)?G._localDirection.rd(0,-J,0):-1!==this.keysRotateLeft.indexOf(W)?(G._localDirection.rd(0,0,0),G.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(W)?(G._localDirection.rd(0,0,0),G.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(W)?(G._localDirection.rd(0,0,0),G.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(W)&&(G._localDirection.rd(0,0,0),G.cameraRotation.x+=this._getLocalRotation()),G.HG().useRightHandedSystem&&(G._localDirection.z*=-1),G.getViewMatrix().invertToRef(G._cameraTransformMatrix),d.o.TransformNormalToRef(G._localDirection,G._cameraTransformMatrix,G._transformedDirection),G.cameraDirection.addInPlace(G._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const G=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*G}}(0,J.e)([(0,R.I)()],A.prototype,"keysUp",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysUpward",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysDown",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysDownward",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysLeft",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysRight",void 0),(0,J.e)([(0,R.I)()],A.prototype,"rotationSpeed",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysRotateLeft",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysRotateRight",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysRotateUp",void 0),(0,J.e)([(0,R.I)()],A.prototype,"keysRotateDown",void 0),z.b.FreeCameraKeyboardMoveInput=A;var x=W(11176),q=W(11762);class L{constructor(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=G,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new x.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(G){G=P.h.BackCompatCameraNoPreventDefault(arguments);const V=this.camera.getEngine(),W=V.getInputElement();this._pointerInput||(this._pointerInput=J=>{const R=J.event,d="touch"===R.pointerType;if(!this.touchEnabled&&d)return;if(J.type!==q.c.POINTERMOVE&&-1===this.buttons.indexOf(R.button))return;const k=R.target;if(J.type===q.c.POINTERDOWN){if(d&&-1!==this._activePointerId||!d&&-1!==this._currentActiveButton)return;this._activePointerId=R.pointerId;try{null===k||void 0===k||k.setPointerCapture(R.pointerId)}catch(z){}-1===this._currentActiveButton&&(this._currentActiveButton=R.button),this._previousPosition={x:R.clientX,y:R.clientY},G||(R.preventDefault(),W&&W.focus()),V.isPointerLock&&this._onMouseMove&&this._onMouseMove(J.event)}else if(J.type===q.c.POINTERUP){if(d&&this._activePointerId!==R.pointerId||!d&&this._currentActiveButton!==R.button)return;try{null===k||void 0===k||k.releasePointerCapture(R.pointerId)}catch(z){}this._currentActiveButton=-1,this._previousPosition=null,G||R.preventDefault(),this._activePointerId=-1}else if(J.type===q.c.POINTERMOVE&&(this._activePointerId===R.pointerId||!d))if(V.isPointerLock&&this._onMouseMove)this._onMouseMove(J.event);else if(this._previousPosition){const V=this.camera._calculateHandednessMultiplier(),W=(R.clientX-this._previousPosition.x)*V,J=R.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=W/this.angularSensibility,this.camera.cameraRotation.x+=J/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:W,offsetY:J}),this._previousPosition={x:R.clientX,y:R.clientY},G||R.preventDefault()}}),this._onMouseMove=W=>{if(!V.isPointerLock)return;const J=this.camera._calculateHandednessMultiplier(),R=W.movementX*J;this.camera.cameraRotation.y+=R/this.angularSensibility;const d=W.movementY;this.camera.cameraRotation.x+=d/this.angularSensibility,this._previousPosition=null,G||W.preventDefault()},this._observer=this.camera.HG()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE),W&&(this._contextMenuBind=G=>this.onContextMenu(G),W.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(G){G.preventDefault()}zx(){if(this._observer){if(this.camera.HG()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const G=this.camera.getEngine().getInputElement();G&&G.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,J.e)([(0,R.I)()],L.prototype,"buttons",void 0),(0,J.e)([(0,R.I)()],L.prototype,"angularSensibility",void 0),z.b.FreeCameraMouseInput=L;var t,Y=W(11777);class g{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new x.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(G){G=P.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=V=>{if(V.type!==q.c.POINTERWHEEL)return;const W=V.event,J=W.deltaMode===Y.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*J*W.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*J*W.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*J*W.deltaZ/this._normalize,W.preventDefault&&(G||W.preventDefault())},this._observer=this.camera.HG()._inputManager._addCameraPointerObserver(this._wheel,q.c.POINTERWHEEL)}zx(){this._observer&&(this.camera.HG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,J.e)([(0,R.I)()],g.prototype,"wheelPrecisionX",void 0),(0,J.e)([(0,R.I)()],g.prototype,"wheelPrecisionY",void 0),(0,J.e)([(0,R.I)()],g.prototype,"wheelPrecisionZ",void 0),function(G){G[G.MoveRelative=0]="MoveRelative",G[G.RotateRelative=1]="RotateRelative",G[G.MoveScene=2]="MoveScene"}(t||(t={}));class B extends g{constructor(){super(...arguments),this._moveRelative=d.o.Zero(),this._rotateRelative=d.o.Zero(),this._moveScene=d.o.Zero(),this._wheelXAction=t.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=t.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(G){null===G&&this._wheelXAction!==t.MoveRelative||(this._wheelXAction=t.MoveRelative,this._wheelXActionCoordinate=G)}get wheelXMoveRelative(){return this._wheelXAction!==t.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(G){null===G&&this._wheelYAction!==t.MoveRelative||(this._wheelYAction=t.MoveRelative,this._wheelYActionCoordinate=G)}get wheelYMoveRelative(){return this._wheelYAction!==t.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(G){null===G&&this._wheelZAction!==t.MoveRelative||(this._wheelZAction=t.MoveRelative,this._wheelZActionCoordinate=G)}get wheelZMoveRelative(){return this._wheelZAction!==t.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(G){null===G&&this._wheelXAction!==t.RotateRelative||(this._wheelXAction=t.RotateRelative,this._wheelXActionCoordinate=G)}get wheelXRotateRelative(){return this._wheelXAction!==t.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(G){null===G&&this._wheelYAction!==t.RotateRelative||(this._wheelYAction=t.RotateRelative,this._wheelYActionCoordinate=G)}get wheelYRotateRelative(){return this._wheelYAction!==t.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(G){null===G&&this._wheelZAction!==t.RotateRelative||(this._wheelZAction=t.RotateRelative,this._wheelZActionCoordinate=G)}get wheelZRotateRelative(){return this._wheelZAction!==t.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(G){null===G&&this._wheelXAction!==t.MoveScene||(this._wheelXAction=t.MoveScene,this._wheelXActionCoordinate=G)}get wheelXMoveScene(){return this._wheelXAction!==t.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(G){null===G&&this._wheelYAction!==t.MoveScene||(this._wheelYAction=t.MoveScene,this._wheelYActionCoordinate=G)}get wheelYMoveScene(){return this._wheelYAction!==t.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(G){null===G&&this._wheelZAction!==t.MoveScene||(this._wheelZAction=t.MoveScene,this._wheelZActionCoordinate=G)}get wheelZMoveScene(){return this._wheelZAction!==t.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Ud(0),this._rotateRelative.Ud(0),this._moveScene.Ud(0),this._updateCamera(),this.camera.HG().useRightHandedSystem&&(this._moveRelative.z*=-1);const G=d.c.Zero();this.camera.getViewMatrix().invertToRef(G);const V=d.o.Zero();d.o.TransformNormalToRef(this._moveRelative,G,V),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(V),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(G,V,W){if(0===G)return;if(null===V||null===W)return;let J=null;switch(V){case t.MoveRelative:J=this._moveRelative;break;case t.RotateRelative:J=this._rotateRelative;break;case t.MoveScene:J=this._moveScene}switch(W){case 0:J.set(G,0,0);break;case 1:J.set(0,G,0);break;case 2:J.set(0,0,G)}}}(0,J.e)([(0,R.I)()],B.prototype,"wheelXMoveRelative",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelYMoveRelative",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelZMoveRelative",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelXRotateRelative",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelYRotateRelative",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelZRotateRelative",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelXMoveScene",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelYMoveScene",null),(0,J.e)([(0,R.I)()],B.prototype,"wheelZMoveScene",null),z.b.FreeCameraMouseWheelInput=B;class S{constructor(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=G,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=P.h.IsSafari()}attachControl(G){G=P.h.BackCompatCameraNoPreventDefault(arguments);let V=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=W=>{const J=W.event,R="mouse"===J.pointerType||this._isSafari&&"undefined"===typeof J.pointerType;if(this.allowMouse||!R)if(W.type===q.c.POINTERDOWN){if(G||J.preventDefault(),this._pointerPressed.push(J.pointerId),1!==this._pointerPressed.length)return;V={x:J.clientX,y:J.clientY}}else if(W.type===q.c.POINTERUP){G||J.preventDefault();const W=this._pointerPressed.indexOf(J.pointerId);if(-1===W)return;if(this._pointerPressed.splice(W,1),0!=W)return;V=null,this._offsetX=null,this._offsetY=null}else if(W.type===q.c.POINTERMOVE){if(G||J.preventDefault(),!V)return;if(0!=this._pointerPressed.indexOf(J.pointerId))return;this._offsetX=J.clientX-V.x,this._offsetY=-(J.clientY-V.y)}}),this._observer=this.camera.HG()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE),this._onLostFocus){const G=this.camera.getEngine().getInputElement();G&&G.addEventListener("blur",this._onLostFocus)}}zx(){if(this._pointerInput){if(this._observer&&(this.camera.HG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const G=this.camera.getEngine().getInputElement();G&&G.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const G=this.camera,V=G._calculateHandednessMultiplier();G.cameraRotation.y=V*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)G.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const V=G._computeLocalCameraSpeed(),W=new d.o(0,0,0!==this.touchMoveSensibility?V*this._offsetY/this.touchMoveSensibility:0);d.c.RotationYawPitchRollToRef(G.rotation.y,G.rotation.x,0,G._cameraRotationMatrix),G.cameraDirection.addInPlace(d.o.TransformCoordinates(W,G._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,J.e)([(0,R.I)()],S.prototype,"touchAngularSensibility",void 0),(0,J.e)([(0,R.I)()],S.prototype,"touchMoveSensibility",void 0),z.b.FreeCameraTouchInput=S;class p extends z.d{constructor(G){super(G),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new A),this}addMouse(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new L(G),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new S),this}clear(){super.clear(),this._mouseInput=null}}var b=W(11159),r=W(11262);class y extends k.e{get angularSensibility(){const G=this.inputs.attached.mouse;return G?G.angularSensibility:0}set angularSensibility(G){const V=this.inputs.attached.mouse;V&&(V.angularSensibility=G)}get keysUp(){const G=this.inputs.attached.keyboard;return G?G.keysUp:[]}set keysUp(G){const V=this.inputs.attached.keyboard;V&&(V.keysUp=G)}get keysUpward(){const G=this.inputs.attached.keyboard;return G?G.keysUpward:[]}set keysUpward(G){const V=this.inputs.attached.keyboard;V&&(V.keysUpward=G)}get keysDown(){const G=this.inputs.attached.keyboard;return G?G.keysDown:[]}set keysDown(G){const V=this.inputs.attached.keyboard;V&&(V.keysDown=G)}get keysDownward(){const G=this.inputs.attached.keyboard;return G?G.keysDownward:[]}set keysDownward(G){const V=this.inputs.attached.keyboard;V&&(V.keysDownward=G)}get keysLeft(){const G=this.inputs.attached.keyboard;return G?G.keysLeft:[]}set keysLeft(G){const V=this.inputs.attached.keyboard;V&&(V.keysLeft=G)}get keysRight(){const G=this.inputs.attached.keyboard;return G?G.keysRight:[]}set keysRight(G){const V=this.inputs.attached.keyboard;V&&(V.keysRight=G)}get keysRotateLeft(){const G=this.inputs.attached.keyboard;return G?G.keysRotateLeft:[]}set keysRotateLeft(G){const V=this.inputs.attached.keyboard;V&&(V.keysRotateLeft=G)}get keysRotateRight(){const G=this.inputs.attached.keyboard;return G?G.keysRotateRight:[]}set keysRotateRight(G){const V=this.inputs.attached.keyboard;V&&(V.keysRotateRight=G)}get keysRotateUp(){const G=this.inputs.attached.keyboard;return G?G.keysRotateUp:[]}set keysRotateUp(G){const V=this.inputs.attached.keyboard;V&&(V.keysRotateUp=G)}get keysRotateDown(){const G=this.inputs.attached.keyboard;return G?G.keysRotateDown:[]}set keysRotateDown(G){const V=this.inputs.attached.keyboard;V&&(V.keysRotateDown=G)}constructor(G,V,W){var J;super(G,V,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),J=this,this.ellipsoid=new d.o(.5,1,.5),this.ellipsoidOffset=new d.o(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=d.o.Zero(),this._diffPosition=d.o.Zero(),this._newPosition=d.o.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J._newPosition.J(V),J._newPosition.subtractToRef(J._oldPosition,J._diffPosition),J._diffPosition.length()>r.b.CollisionsEpsilon&&(J.position.addToRef(J._diffPosition,J._deferredPositionUpdate),J._deferOnly?J._deferredUpdated=!0:J.position.J(J._deferredPositionUpdate),J.GL&&W&&J.GL(W))},this.inputs=new p(this),this.inputs.addKeyboard().addMouse()}attachControl(G,V){V=P.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(V)}zx(){this.inputs.detachElement(),this.cameraDirection=new d.o(0,0,0),this.cameraRotation=new d.k(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(G){this._collisionMask=isNaN(G)?-1:G}_collideWithWorld(G){let V;V=this.parent?d.o.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,V.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const W=this.HG().collisionCoordinator;this._collider||(this._collider=W.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let J=G;this.applyGravity&&(J=G.add(this.HG().gravity)),W.getNewPosition(this._oldPosition,J,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=d.o.Zero(),this._transformedDirection=d.o.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(G){this._needMoveForGravity=G}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.HG().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"vt"}}(0,J.e)([(0,R.F)()],y.prototype,"ellipsoid",void 0),(0,J.e)([(0,R.F)()],y.prototype,"ellipsoidOffset",void 0),(0,J.e)([(0,R.I)()],y.prototype,"checkCollisions",void 0),(0,J.e)([(0,R.I)()],y.prototype,"applyGravity",void 0),(0,b.d)("BABYLON.FreeCamera",y)},13560:(G,V,W)=>{"use strict";W.d(V,{d:()=>d});var J=W(11525),R=W(13564);class d{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=W,this.DA=[],this._maxBlockCapacity=V||64,this._selectionContent=new J.c(1024),this._creationFunc=G}update(G,V,W){R.e._CreateBlocks(G,V,W,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}CP(G){for(let V=0;V<this.EP.length;V++){this.EP[V].addEntry(G)}}vP(G){for(let V=0;V<this.EP.length;V++){this.EP[V].removeEntry(G)}}select(G,V){this._selectionContent.reset();for(let W=0;W<this.EP.length;W++){this.EP[W].select(G,this._selectionContent,V)}return V?this._selectionContent.concat(this.DA):this._selectionContent.concatWithNoDuplicate(this.DA),this._selectionContent}intersects(G,V,W){this._selectionContent.reset();for(let J=0;J<this.EP.length;J++){this.EP[J].intersects(G,V,this._selectionContent,W)}return W?this._selectionContent.concat(this.DA):this._selectionContent.concatWithNoDuplicate(this.DA),this._selectionContent}intersectsRay(G){this._selectionContent.reset();for(let V=0;V<this.EP.length;V++){this.EP[V].intersectsRay(G,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.DA),this._selectionContent}}d.CreationFuncForMeshes=(G,V)=>{const W=G.getBoundingInfo();!G.isBlocked&&W.boundingBox.intersectsMinMax(V.fA,V.vA)&&V.entries.push(G)},d.CreationFuncForSubMeshes=(G,V)=>{G.getBoundingInfo().boundingBox.intersectsMinMax(V.fA,V.vA)&&V.entries.push(G)}},13564:(G,V,W)=>{"use strict";W.d(V,{e:()=>d});var J=W(11136),R=W(11373);class d{constructor(G,V,W,J,R,d){this.entries=[],this.CA=new Array,this._capacity=W,this._depth=J,this._maxDepth=R,this._creationFunc=d,this._minPoint=G,this._maxPoint=V,this.CA.push(G.clone()),this.CA.push(V.clone()),this.CA.push(G.clone()),this.CA[2].x=V.x,this.CA.push(G.clone()),this.CA[3].y=V.y,this.CA.push(G.clone()),this.CA[4].z=V.z,this.CA.push(V.clone()),this.CA[5].z=G.z,this.CA.push(V.clone()),this.CA[6].x=G.x,this.CA.push(V.clone()),this.CA[7].y=G.y}get DV(){return this._capacity}get fA(){return this._minPoint}get vA(){return this._maxPoint}addEntry(G){if(this.EP)for(let V=0;V<this.EP.length;V++){this.EP[V].addEntry(G)}else this._creationFunc(G,this),this.entries.length>this.DV&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(G){if(this.EP){for(let V=0;V<this.EP.length;V++){this.EP[V].removeEntry(G)}return}const V=this.entries.indexOf(G);V>-1&&this.entries.splice(V,1)}addEntries(G){for(let V=0;V<G.length;V++){const W=G[V];this.addEntry(W)}}select(G,V,W){if(R.b.IsInFrustum(this.CA,G)){if(this.EP){for(let J=0;J<this.EP.length;J++){this.EP[J].select(G,V,W)}return}W?V.concat(this.entries):V.concatWithNoDuplicate(this.entries)}}intersects(G,V,W,J){if(R.b.IntersectsSphere(this._minPoint,this._maxPoint,G,V)){if(this.EP){for(let R=0;R<this.EP.length;R++){this.EP[R].intersects(G,V,W,J)}return}J?W.concat(this.entries):W.concatWithNoDuplicate(this.entries)}}intersectsRay(G,V){if(G.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.EP){for(let W=0;W<this.EP.length;W++){this.EP[W].intersectsRay(G,V)}return}V.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){d._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(G,V,W,R,k,z,X,P){X.EP=new Array;const A=new J.o((V.x-G.x)/2,(V.y-G.y)/2,(V.z-G.z)/2);for(let J=0;J<2;J++)for(let V=0;V<2;V++)for(let x=0;x<2;x++){const q=G.add(A.multiplyByFloats(J,V,x)),L=G.add(A.multiplyByFloats(J+1,V+1,x+1)),t=new d(q,L,R,k+1,z,P);t.addEntries(W),X.EP.push(t)}}}},13569:(G,V,W)=>{"use strict";W.d(V,{b:()=>A});var J=W(11737),R=W(11136),d=W(11473),k=W(12746),z=W(11561),X=W(13560),P=W(11169);J.e.prototype.createOrUpdateSelectionOctree=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,W=this._getComponent(z.b.NAME_OCTREE);W||(W=new A(this),this.o(W)),this.HA||(this.HA=new X.d(X.d.CreationFuncForMeshes,G,V));const J=this.getWorldExtends();return this.HA.update(J.min,J.max,this.meshes),this.HA},Object.defineProperty(J.e.prototype,"selectionOctree",{get:function(){return this.HA},enumerable:!0,configurable:!0}),d.b.prototype.createOrUpdateSubmeshesOctree=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=this.HG();let J=W._getComponent(z.b.NAME_OCTREE);J||(J=new A(W),W.o(J)),this._submeshesOctree||(this._submeshesOctree=new X.d(X.d.CreationFuncForSubMeshes,G,V)),this.kd(!0);const R=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(R.minimumWorld,R.maximumWorld,this.Ed),this._submeshesOctree};class A{constructor(G){this.name=z.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new k.e(R.o.Zero(),new R.o(1,1,1)),(G=G||P.c.LastCreatedScene)&&(this.tV=G,this.tV.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.tV.getActiveSubMeshCandidates=G=>this.getActiveSubMeshCandidates(G),this.tV.getCollidingSubMeshCandidates=(G,V)=>this.getCollidingSubMeshCandidates(G,V),this.tV.getIntersectingSubMeshCandidates=(G,V)=>this.getIntersectingSubMeshCandidates(G,V))}register(){this.tV.onMeshRemovedObservable.add((G=>{const V=this.tV.selectionOctree;if(void 0!==V&&null!==V){const W=V.DA.indexOf(G);-1!==W&&V.DA.splice(W,1)}})),this.tV.onMeshImportedObservable.add((G=>{const V=this.tV.selectionOctree;void 0!==V&&null!==V&&V.CP(G)}))}getActiveMeshCandidates(){var G;return(null===(G=this.tV.HA)||void 0===G?void 0:G.select(this.tV.frustumPlanes))||this.tV._getDefaultMeshCandidates()}getActiveSubMeshCandidates(G){if(G._submeshesOctree&&G.useOctreeForRenderingSelection){return G._submeshesOctree.select(this.tV.frustumPlanes)}return this.tV._getDefaultSubMeshCandidates(G)}getIntersectingSubMeshCandidates(G,V){if(G._submeshesOctree&&G.useOctreeForPicking){k.e.TransformToRef(V,G.getWorldMatrix(),this._tempRay);return G._submeshesOctree.intersectsRay(this._tempRay)}return this.tV._getDefaultSubMeshCandidates(G)}getCollidingSubMeshCandidates(G,V){if(G._submeshesOctree&&G.useOctreeForCollisions){const W=V._velocityWorldLength+Math.max(V._radius.x,V._radius.y,V._radius.z);return G._submeshesOctree.intersects(V._basePointWorld,W)}return this.tV._getDefaultSubMeshCandidates(G)}rebuild(){}dispose(){}}},12746:(G,V,W)=>{"use strict";W.d(V,{e:()=>L});var J=W(11737),R=W(11516),d=W(11145),k=W(11136),z=W(11152),X=W(11360),P=W(11492),A=W(11169),x=W(11781);const q={internalPickerForMesh:void 0};class L{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.c;this.origin=G,this.direction=V,this.length=W,this.epsilon=J}clone(){return new L(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=L._TmpVector3[0].rd(G.x-W,G.y-W,G.z-W),R=L._TmpVector3[1].rd(V.x+W,V.y+W,V.z+W);let d,k,z,X,P=0,A=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<J.x||this.origin.x>R.x)return!1}else if(d=1/this.direction.x,k=(J.x-this.origin.x)*d,z=(R.x-this.origin.x)*d,z===-1/0&&(z=1/0),k>z&&(X=k,k=z,z=X),P=Math.max(k,P),A=Math.min(z,A),P>A)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<J.y||this.origin.y>R.y)return!1}else if(d=1/this.direction.y,k=(J.y-this.origin.y)*d,z=(R.y-this.origin.y)*d,z===-1/0&&(z=1/0),k>z&&(X=k,k=z,z=X),P=Math.max(k,P),A=Math.min(z,A),P>A)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<J.z||this.origin.z>R.z)return!1}else if(d=1/this.direction.z,k=(J.z-this.origin.z)*d,z=(R.z-this.origin.z)*d,z===-1/0&&(z=1/0),k>z&&(X=k,k=z,z=X),P=Math.max(k,P),A=Math.min(z,A),P>A)return!1;return!0}intersectsBox(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(G.minimum,G.maximum,V)}intersectsSphere(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=G.center.x-this.origin.x,J=G.center.y-this.origin.y,R=G.center.z-this.origin.z,d=W*W+J*J+R*R,k=G.radius+V,z=k*k;if(d<=z)return!0;const X=W*this.direction.x+J*this.direction.y+R*this.direction.z;if(X<0)return!1;return d-X*X<=z}intersectsTriangle(G,V,W){const J=L._TmpVector3[0],R=L._TmpVector3[1],d=L._TmpVector3[2],z=L._TmpVector3[3],P=L._TmpVector3[4];V.subtractToRef(G,J),W.subtractToRef(G,R),k.o.CrossToRef(this.direction,R,d);const A=k.o.Dot(J,d);if(0===A)return null;const x=1/A;this.origin.subtractToRef(G,z);const q=k.o.Dot(z,d)*x;if(q<-this.epsilon||q>1+this.epsilon)return null;k.o.CrossToRef(z,J,P);const t=k.o.Dot(this.direction,P)*x;if(t<-this.epsilon||q+t>1+this.epsilon)return null;const Y=k.o.Dot(R,P)*x;return Y>this.length?null:new X.e(1-q-t,q,Y)}intersectsPlane(G){let V;const W=k.o.Dot(G.IV,this.direction);if(Math.abs(W)<9.99999997475243e-7)return null;{const J=k.o.Dot(G.IV,this.origin);return V=(-G.d-J)/W,V<0?V<-9.99999997475243e-7?null:0:V}}intersectsAxis(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(G){case"y":{const G=(this.origin.y-V)/this.direction.y;return G>0?null:new k.o(this.origin.x+this.direction.x*-G,V,this.origin.z+this.direction.z*-G)}case"x":{const G=(this.origin.x-V)/this.direction.x;return G>0?null:new k.o(V,this.origin.y+this.direction.y*-G,this.origin.z+this.direction.z*-G)}case"z":{const G=(this.origin.z-V)/this.direction.z;return G>0?null:new k.o(this.origin.x+this.direction.x*-G,this.origin.y+this.direction.y*-G,V)}default:return null}}intersectsMesh(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=k.h.Matrix[0];return G.getWorldMatrix().invertToRef(z),this._tmpRay?L.TransformToRef(this,z,this._tmpRay):this._tmpRay=L.Transform(this,z),G.intersects(this._tmpRay,V,W,J,R,d)}intersectsMeshes(G,V,W){W?W.length=0:W=[];for(let J=0;J<G.length;J++){const R=this.intersectsMesh(G[J],V);R.hit&&W.push(R)}return W.sort(this._comparePickingInfo),W}_comparePickingInfo(G,V){return G.distance<V.distance?-1:G.distance>V.distance?1:0}intersectionSegment(G,V,W){const J=this.origin,R=k.h.ed[0],d=k.h.ed[1],z=k.h.ed[2],X=k.h.ed[3];V.subtractToRef(G,R),this.direction.scaleToRef(L._Rayl,z),J.addToRef(z,d),G.subtractToRef(J,X);const P=k.o.Dot(R,R),A=k.o.Dot(R,z),x=k.o.Dot(z,z),q=k.o.Dot(R,X),t=k.o.Dot(z,X),Y=P*x-A*A;let g,B,S=Y,p=Y;Y<L._Smallnum?(g=0,S=1,B=t,p=x):(g=A*t-x*q,B=P*t-A*q,g<0?(g=0,B=t,p=x):g>S&&(g=S,B=t+A,p=x)),B<0?(B=0,-q<0?g=0:-q>P?g=S:(g=-q,S=P)):B>p&&(B=p,-q+A<0?g=0:-q+A>P?g=S:(g=-q+A,S=P));const b=Math.abs(g)<L._Smallnum?0:g/S,r=Math.abs(B)<L._Smallnum?0:B/p,y=k.h.ed[4];z.scaleToRef(r,y);const u=k.h.ed[5];R.scaleToRef(b,u),u.addInPlace(X);const H=k.h.ed[6];u.subtractToRef(y,H);return r>0&&r<=this.length&&H.lengthSquared()<W*W?u.length():-1}update(G,V,W,J,R,d,z){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){L._RayDistant||(L._RayDistant=L.Zero()),L._RayDistant.unprojectRayToRef(G,V,W,J,k.c.IdentityReadOnly,d,z);const X=k.h.Matrix[0];R.invertToRef(X),L.TransformToRef(L._RayDistant,X,this)}else this.unprojectRayToRef(G,V,W,J,R,d,z);return this}static Zero(){return new L(k.o.Zero(),k.o.Zero())}static CreateNew(G,V,W,J,R,d,k){return L.Zero().update(G,V,W,J,R,d,k)}static CreateNewFromTo(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.IdentityReadOnly;const J=new L(new k.o(0,0,0),new k.o(0,0,0));return L.CreateFromToToRef(G,V,J,W)}static CreateFromToToRef(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.c.IdentityReadOnly;W.origin.J(G);const R=V.subtractToRef(G,W.direction),d=Math.sqrt(R.x*R.x+R.y*R.y+R.z*R.z);return W.length=d,W.direction.normalize(),L.TransformToRef(W,J,W)}static Transform(G,V){const W=new L(new k.o(0,0,0),new k.o(0,0,0));return L.TransformToRef(G,V,W),W}static TransformToRef(G,V,W){k.o.TransformCoordinatesToRef(G.origin,V,W.origin),k.o.TransformNormalToRef(G.direction,V,W.direction),W.length=G.length,W.epsilon=G.epsilon;const J=W.direction,R=J.length();if(0!==R&&1!==R){const G=1/R;J.x*=G,J.y*=G,J.z*=G,W.length*=R}return W}unprojectRayToRef(G,V,W,J,R,d,z){const X=k.h.Matrix[0];R.multiplyToRef(d,X),X.multiplyToRef(z,X),X.invert();const P=A.c.LastCreatedEngine,x=k.h.ed[0];x.x=G/W*2-1,x.y=-(V/J*2-1),x.z=null!==P&&void 0!==P&&P.useReverseDepthBuffer?1:null!==P&&void 0!==P&&P.isNDCHalfZRange?0:-1;const q=k.h.ed[1].rd(x.x,x.y,1-1e-8),L=k.h.ed[2],t=k.h.ed[3];k.o._UnprojectFromInvertedMatrixToRef(x,X,L),k.o._UnprojectFromInvertedMatrixToRef(q,X,t),this.origin.J(L),t.subtractToRef(L,this.direction),this.direction.normalize()}}function t(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=L.Zero();return Y(G,V,W,J,k,R,d),k}function Y(G,V,W,J,R,d){let z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const P=G.getEngine();if(!d&&!(d=G.activeCamera))return G;const A=d.viewport,x=P.getRenderHeight(),{x:q,y:L,width:t,height:Y}=A.toGlobal(P.getRenderWidth(),x),g=1/P.getHardwareScalingLevel();return V=V*g-q,W=W*g-(x-L-Y),R.update(V,W,t,Y,J||k.c.IdentityReadOnly,z?k.c.IdentityReadOnly:d.getViewMatrix(),d.getProjectionMatrix(),X),G}function g(G,V,W,J,R){if(!P.d)return G;const d=G.getEngine();if(!R&&!(R=G.activeCamera))throw new Error("Active camera not set");const z=R.viewport,X=d.getRenderHeight(),{x:A,y:x,width:q,height:L}=z.toGlobal(d.getRenderWidth(),X),t=k.c.Identity(),Y=1/d.getHardwareScalingLevel();return V=V*Y-A,W=W*Y-(X-x-L),J.update(V,W,q,L,t,t,R.getProjectionMatrix()),G}function B(G,V,W,J,R,d,k,z){const X=V(J,W.enableDistantPicking),P=W.intersects(X,R,k,d,J,z);return P&&P.hit?!R&&null!=G&&P.distance>=G.distance?null:P:null}function S(G,V,W,J,R,d){let z=null;const X=!!(G.activeCameras&&G.activeCameras.length>1&&G.cameraToUseForPointers!==G.activeCamera),A=G.cameraToUseForPointers||G.activeCamera,x=q.internalPickerForMesh||B;for(let P=0;P<G.meshes.length;P++){const q=G.meshes[P];if(W){if(!W(q,-1))continue}else if(!q.isEnabled()||!q.isVisible||!q.bX)continue;const L=X&&q.isWorldMatrixCameraDependent(),t=q.kd(L,A);if(q.hasThinInstances&&q.thinInstanceEnablePicking){const G=x(z,V,q,t,!0,!0,d);if(G){if(R)return G;const X=k.h.Matrix[1],P=q.thinInstanceGetWorldMatrices();for(let G=0;G<P.length;G++){if(W&&!W(q,G))continue;P[G].multiplyToRef(t,X);const k=x(z,V,q,X,J,R,d,!0);if(k&&(z=k,z.thinInstanceIndex=G,J))return z}}}else{const G=x(z,V,q,t,J,R,d);if(G&&(z=G,J))return z}}return z||new P.d}function p(G,V,W,J){if(!P.d)return null;const R=[],d=!!(G.activeCameras&&G.activeCameras.length>1&&G.cameraToUseForPointers!==G.activeCamera),z=G.cameraToUseForPointers||G.activeCamera,X=q.internalPickerForMesh||B;for(let P=0;P<G.meshes.length;P++){const A=G.meshes[P];if(W){if(!W(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.bX)continue;const x=d&&A.isWorldMatrixCameraDependent(),q=A.kd(x,z);if(A.hasThinInstances&&A.thinInstanceEnablePicking){if(X(null,V,A,q,!0,!0,J)){const G=k.h.Matrix[1],d=A.thinInstanceGetWorldMatrices();for(let k=0;k<d.length;k++){if(W&&!W(A,k))continue;d[k].multiplyToRef(q,G);const z=X(null,V,A,G,!1,!1,J,!0);z&&(z.thinInstanceIndex=k,R.push(z))}}}else{const G=X(null,V,A,q,!1,!1,J);G&&R.push(G)}}return R}function b(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0;J||(J=G.getWorldMatrix()),V.length=W,R?V.origin.J(R):V.origin.J(G.position);const d=k.h.ed[2];d.set(0,0,G._scene.useRightHandedSystem?-1:1);const z=k.h.ed[3];return k.o.TransformNormalToRef(d,J,z),k.o.NormalizeToRef(z,V.direction),V}var r,y;L._TmpVector3=(0,z.b)(6,k.o.Zero),L._RayDistant=L.Zero(),L._Smallnum=1e-8,L._Rayl=1e9,r=J.e,(y=R.c)&&(y.prototype.getForwardRay=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;return b(this,new L(k.o.Zero(),k.o.Zero(),G),G,V,W)},y.prototype.getForwardRayToRef=function(G){return b(this,G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),r&&(x.d._IsPickingAvailable=!0,r.prototype.createPickingRay=function(G,V,W,J){return t(this,G,V,W,J,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),J.e.prototype.createPickingRayToRef=function(G,V,W,J,R){return Y(this,G,V,W,J,R,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},J.e.prototype.createPickingRayInCameraSpace=function(G,V,W){return function(G,V,W,J){const R=L.Zero();return g(G,V,W,R,J),R}(this,G,V,W)},J.e.prototype.createPickingRayInCameraSpaceToRef=function(G,V,W,J){return g(this,G,V,W,J)},J.e.prototype.pickWithBoundingInfo=function(G,V,W,J,R){return function(G,V,W,J,R,d){if(!P.d)return null;const z=S(G,(J=>(G._tempPickingRay||(G._tempPickingRay=L.Zero()),Y(G,V,W,J,G._tempPickingRay,d||null),G._tempPickingRay)),J,R,!0);return z&&(z.ray=t(G,V,W,k.c.Identity(),d||null)),z}(this,G,V,W,J,R)},J.e.prototype.kW=function(G,V,W,J,R,d){return function(G,V,W,J,R,d,z){const X=S(G,((J,R)=>(G._tempPickingRay||(G._tempPickingRay=L.Zero()),Y(G,V,W,J,G._tempPickingRay,d||null,!1,R),G._tempPickingRay)),J,R,!1,z);return X&&(X.ray=t(G,V,W,k.c.Identity(),d||null)),X}(this,G,V,W,J,R,d)},J.e.prototype.pickWithRay=function(G,V,W,J){return function(G,V,W,J,R){const d=S(G,(W=>(G._pickWithRayInverseMatrix||(G._pickWithRayInverseMatrix=k.c.Identity()),W.invertToRef(G._pickWithRayInverseMatrix),G._cachedRayForTransform||(G._cachedRayForTransform=L.Zero()),L.TransformToRef(V,G._pickWithRayInverseMatrix,G._cachedRayForTransform),G._cachedRayForTransform)),W,J,!1,R);return d&&(d.ray=V),d}(this,G,V,W,J)},J.e.prototype.multiPick=function(G,V,W,J,R){return function(G,V,W,J,R,d){return p(G,(J=>t(G,V,W,J,R||null)),J,d)}(this,G,V,W,J,R)},J.e.prototype.multiPickWithRay=function(G,V,W){return function(G,V,W,J){return p(G,(W=>(G._pickWithRayInverseMatrix||(G._pickWithRayInverseMatrix=k.c.Identity()),W.invertToRef(G._pickWithRayInverseMatrix),G._cachedRayForTransform||(G._cachedRayForTransform=L.Zero()),L.TransformToRef(V,G._pickWithRayInverseMatrix,G._cachedRayForTransform),G._cachedRayForTransform)),W,J)}(this,G,V,W)}},13039:(G,V,W)=>{"use strict";var J=W(11285),R=W(11201),d=W(11227),k=W(11304),z=W(11262),X=W(11298);z.b.prototype._partialLoadFile=function(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(G,(G=>{W[V]=G,W._internalCount++,6===W._internalCount&&J(W)}),void 0,void 0,!0,((G,V)=>{R&&G&&R(G.status+" "+G.statusText,V)}))},z.b.prototype._cascadeLoadFiles=function(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=[];R._internalCount=0;for(let d=0;d<6;d++)this._partialLoadFile(W[d],d,R,V,J)},z.b.prototype._cascadeLoadImgs=function(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5?arguments[5]:void 0;const k=[];k._internalCount=0;for(let z=0;z<6;z++)this._partialLoadImg(J[z],z,k,G,V,W,R,d)},z.b.prototype._partialLoadImg=function(G,V,W,J,R,z){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7?arguments[7]:void 0;const A=(0,k.b)();(0,d.p)(G,(G=>{W[V]=G,W._internalCount++,J&&J.removePendingData(A),6===W._internalCount&&z&&z(R,W)}),((G,V)=>{J&&J.removePendingData(A),X&&X(G,V)}),J?J.offlineProvider:null,P),J&&J.addPendingData(A)},z.b.prototype.createCubeTextureBase=function(G,V,W,d){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6?arguments[6]:void 0,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],S=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const p=t||new J.d(this,7);p.isCube=!0,p.url=G,p.generateMipMaps=!d,p._lodGenerationScale=q,p._lodGenerationOffset=L,p._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!d),p!==t&&(p.label=G.substring(0,60)),this._doNotHandleContextLost||(p._extension=A,p._files=W,p._buffer=S);const b=G;this._transformTextureUrl&&!t&&(G=this._transformTextureUrl(G));const r=A??function(G){const V=G.split("?")[0],W=V.lastIndexOf(".");return W>-1?V.substring(W).toLowerCase():""}(G),y=(0,X.b)(r),u=(G,V)=>{p.dispose(),z?z(G,V):G&&R.c.Warn(G)},H=(J,z)=>{G===b?J&&u(J.status+" "+J.statusText,z):(R.c.Warn(`Failed to load ${G}, falling back to the ${b}`),this.createCubeTextureBase(b,V,W,!!d,k,u,P,A,x,q,L,p,Y,g,B,S))};if(y)y.then((J=>{const R=G=>{Y&&Y(p,G),J.loadCubeData(G,p,x,k,((G,V)=>{u(G,V)}))};S?R(S):W&&6===W.length?J.supportCascades?this._cascadeLoadFiles(V,(G=>R(G.map((G=>new Uint8Array(G))))),W,u):u("Textures type does not support cascades."):this._loadFile(G,(G=>R(new Uint8Array(G))),void 0,void 0,!0,H)}));else{if(!W||0===W.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(V,p,((G,V)=>{g&&g(G,V)}),W,u)}return this._internalTexturesCache.push(p),p}},13576:(G,V,W)=>{"use strict";W(11201);var J=W(11564);W(11285),W(11353),W(11165),W(11606),W(11570);J.c},13067:(G,V,W)=>{"use strict";W.d(V,{e:()=>R});var J=W(11159);class R{constructor(G){this.value=this._toInt(G)}_toInt(G){return 0|G}add(G){return new R(this.value+G.value)}zW(G){return new R(this.value-G.value)}multiply(G){return new R(Math.imul(this.value,G.value))}divide(G){return new R(this.value/G.value)}getClassName(){return R.ClassName}equals(G){return this.value===G.value}static FromValue(G){return new R(G)}toString(){return this.value.toString()}}R.ClassName="FlowGraphInteger",(0,J.d)("FlowGraphInteger",R)},13074:(G,V,W)=>{"use strict";W.d(V,{e:()=>R,g:()=>d});var J=W(11136);class R{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.kq=G}get m(){return this.kq}transformVector(G){return this.transformVectorToRef(G,new J.k)}transformVectorToRef(G,V){return V.x=G.x*this.kq[0]+G.y*this.kq[1],V.y=G.x*this.kq[2]+G.y*this.kq[3],V}Bd(){return this.toArray()}toArray(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let V=0;V<4;V++)G[V]=this.kq[V];return G}XW(G){for(let V=0;V<4;V++)this.kq[V]=G[V];return this}multiplyToRef(G,V){const W=G.kq,J=this.kq,R=V.kq;return R[0]=W[0]*J[0]+W[1]*J[2],R[1]=W[0]*J[1]+W[1]*J[3],R[2]=W[2]*J[0]+W[3]*J[2],R[3]=W[2]*J[1]+W[3]*J[3],V}multiply(G){return this.multiplyToRef(G,new R)}divideToRef(G,V){const W=this.kq,J=G.kq,R=V.kq;return R[0]=W[0]/J[0],R[1]=W[1]/J[1],R[2]=W[2]/J[2],R[3]=W[3]/J[3],V}divide(G){return this.divideToRef(G,new R)}addToRef(G,V){const W=this.kq,J=G.m,R=V.m;return R[0]=W[0]+J[0],R[1]=W[1]+J[1],R[2]=W[2]+J[2],R[3]=W[3]+J[3],V}add(G){return this.addToRef(G,new R)}subtractToRef(G,V){const W=this.kq,J=G.m,R=V.m;return R[0]=W[0]-J[0],R[1]=W[1]-J[1],R[2]=W[2]-J[2],R[3]=W[3]-J[3],V}zW(G){return this.subtractToRef(G,new R)}transpose(){const G=this.kq;return new R([G[0],G[2],G[1],G[3]])}determinant(){const G=this.kq;return G[0]*G[3]-G[1]*G[2]}inverse(){const G=this.determinant();if(0===G)throw new Error("Matrix is not invertible");const V=this.kq,W=1/G;return new R([V[3]*W,-V[1]*W,-V[2]*W,V[0]*W])}equals(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.kq,J=G.m;return 0===V?W[0]===J[0]&&W[1]===J[1]&&W[2]===J[2]&&W[3]===J[3]:Math.abs(W[0]-J[0])<V&&Math.abs(W[1]-J[1])<V&&Math.abs(W[2]-J[2])<V&&Math.abs(W[3]-J[3])<V}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.kq.join(", ")})`}}class d{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.kq=G}get m(){return this.kq}transformVector(G){return this.transformVectorToRef(G,new J.o)}transformVectorToRef(G,V){const W=this.kq;return V.x=G.x*W[0]+G.y*W[1]+G.z*W[2],V.y=G.x*W[3]+G.y*W[4]+G.z*W[5],V.z=G.x*W[6]+G.y*W[7]+G.z*W[8],V}multiplyToRef(G,V){const W=G.kq,J=this.kq,R=V.m;return R[0]=W[0]*J[0]+W[1]*J[3]+W[2]*J[6],R[1]=W[0]*J[1]+W[1]*J[4]+W[2]*J[7],R[2]=W[0]*J[2]+W[1]*J[5]+W[2]*J[8],R[3]=W[3]*J[0]+W[4]*J[3]+W[5]*J[6],R[4]=W[3]*J[1]+W[4]*J[4]+W[5]*J[7],R[5]=W[3]*J[2]+W[4]*J[5]+W[5]*J[8],R[6]=W[6]*J[0]+W[7]*J[3]+W[8]*J[6],R[7]=W[6]*J[1]+W[7]*J[4]+W[8]*J[7],R[8]=W[6]*J[2]+W[7]*J[5]+W[8]*J[8],V}multiply(G){return this.multiplyToRef(G,new d)}divideToRef(G,V){const W=this.kq,J=G.m,R=V.m;return R[0]=W[0]/J[0],R[1]=W[1]/J[1],R[2]=W[2]/J[2],R[3]=W[3]/J[3],R[4]=W[4]/J[4],R[5]=W[5]/J[5],R[6]=W[6]/J[6],R[7]=W[7]/J[7],R[8]=W[8]/J[8],V}divide(G){return this.divideToRef(G,new d)}addToRef(G,V){const W=this.kq,J=G.m,R=V.m;return R[0]=W[0]+J[0],R[1]=W[1]+J[1],R[2]=W[2]+J[2],R[3]=W[3]+J[3],R[4]=W[4]+J[4],R[5]=W[5]+J[5],R[6]=W[6]+J[6],R[7]=W[7]+J[7],R[8]=W[8]+J[8],V}add(G){return this.addToRef(G,new d)}subtractToRef(G,V){const W=this.kq,J=G.m,R=V.m;return R[0]=W[0]-J[0],R[1]=W[1]-J[1],R[2]=W[2]-J[2],R[3]=W[3]-J[3],R[4]=W[4]-J[4],R[5]=W[5]-J[5],R[6]=W[6]-J[6],R[7]=W[7]-J[7],R[8]=W[8]-J[8],V}zW(G){return this.subtractToRef(G,new d)}toArray(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let V=0;V<9;V++)G[V]=this.kq[V];return G}Bd(){return this.toArray()}XW(G){for(let V=0;V<9;V++)this.kq[V]=G[V];return this}transpose(){const G=this.kq;return new d([G[0],G[3],G[6],G[1],G[4],G[7],G[2],G[5],G[8]])}determinant(){const G=this.kq;return G[0]*(G[4]*G[8]-G[5]*G[7])-G[1]*(G[3]*G[8]-G[5]*G[6])+G[2]*(G[3]*G[7]-G[4]*G[6])}inverse(){const G=this.determinant();if(0===G)throw new Error("Matrix is not invertible");const V=this.kq,W=1/G;return new d([(V[4]*V[8]-V[5]*V[7])*W,(V[2]*V[7]-V[1]*V[8])*W,(V[1]*V[5]-V[2]*V[4])*W,(V[5]*V[6]-V[3]*V[8])*W,(V[0]*V[8]-V[2]*V[6])*W,(V[2]*V[3]-V[0]*V[5])*W,(V[3]*V[7]-V[4]*V[6])*W,(V[1]*V[6]-V[0]*V[7])*W,(V[0]*V[4]-V[1]*V[3])*W])}equals(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.kq,J=G.m;return 0===V?W[0]===J[0]&&W[1]===J[1]&&W[2]===J[2]&&W[3]===J[3]&&W[4]===J[4]&&W[5]===J[5]&&W[6]===J[6]&&W[7]===J[7]&&W[8]===J[8]:Math.abs(W[0]-J[0])<V&&Math.abs(W[1]-J[1])<V&&Math.abs(W[2]-J[2])<V&&Math.abs(W[3]-J[3])<V&&Math.abs(W[4]-J[4])<V&&Math.abs(W[5]-J[5])<V&&Math.abs(W[6]-J[6])<V&&Math.abs(W[7]-J[7])<V&&Math.abs(W[8]-J[8])<V}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.kq.join(", ")})`}}},13079:(G,V,W)=>{"use strict";var J;function R(G,V,W,J){switch(V){case"Animation":return J?G.animations.find((G=>G.uniqueId===W))??null:G.animations[W]??null;case"AnimationGroup":return J?G.animationGroups.find((G=>G.uniqueId===W))??null:G.animationGroups[W]??null;case"Mesh":return J?G.meshes.find((G=>G.uniqueId===W))??null:G.meshes[W]??null;case"Material":return J?G.materials.find((G=>G.uniqueId===W))??null:G.materials[W]??null;case"KP":return J?G.cameras.find((G=>G.uniqueId===W))??null:G.cameras[W]??null;case"Light":return J?G.lights.find((G=>G.uniqueId===W))??null:G.lights[W]??null;default:return null}}W.d(V,{c:()=>R}),function(G){G.Animation="Animation",G.AnimationGroup="AnimationGroup",G.Mesh="Mesh",G.Material="Material",G.KP="KP",G.Light="Light"}(J||(J={}))},13108:(G,V,W)=>{"use strict";W.d(V,{c:()=>R});var J=W(13115);class R extends J.e{constructor(G,V){if(super(G),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),V)for(const W of V)this._eventsSignalOutputs[W]=this._registerSignalOutput(W+"Event")}_executeOnTick(G){}_startPendingTasks(G){G._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(G),this._resetAfterCanceled(G)),this._preparePendingTasks(G),G._addPendingBlock(this),this.out._activateSignal(G),G._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(G){G._deleteExecutionVariable(this,"_initialized"),G._removePendingBlock(this)}}},13093:(G,V,W)=>{"use strict";W.d(V,{c:()=>P});var J=W(11304),R=W(11159),d=W(13097),k=W(11176),z=W(13061);class X extends d.c{constructor(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:J.defaultValue,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(G,V,W),this.richType=J,this._defaultValue=R,this._optional=d,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new k.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(G){this._isDisabled!==G&&(this._isDisabled=G,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(G,V){V._getConnectionValue(this)!==G&&(V._setConnectionValue(this,G),this.onValueChangedObservable.notifyObservers(G))}resetToDefaultValue(G){G._setConnectionValue(this,this._defaultValue)}connectTo(G){this._isDisabled||super.connectTo(G)}_getValueOrDefault(G){const V=G._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(V):V}getValue(G){if(1===this.connectionType){G._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(G);const V=this._getValueOrDefault(G);return this._lastValue=V,this.richType.typeTransformer?this.richType.typeTransformer(V):V}const V=this.isConnected()?this._connectedPoint[0].getValue(G):this._getValueOrDefault(G);return this._lastValue=V,this.richType.typeTransformer?this.richType.typeTransformer(V):V}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.richType={},this.richType.serialize(G.richType),G.optional=this._optional,(0,z.g)("defaultValue",this._defaultValue,G)}}(0,R.d)("FlowGraphDataConnection",X);class P{constructor(G){var V;this.config=G,this.uniqueId=(0,J.b)(),this.name=(null===(V=this.config)||void 0===V?void 0:V.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(G){}registerDataInput(G,V,W){const J=new X(G,0,this,V,W);return this.dataInputs.push(J),J}registerDataOutput(G,V,W){const J=new X(G,1,this,V,W);return this.dataOutputs.push(J),J}getDataInput(G){return this.dataInputs.find((V=>V.name===G))}getDataOutput(G){return this.dataOutputs.find((V=>V.name===G))}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.g;if(G.uniqueId=this.uniqueId,G.config={},this.config){const W=this.config,J=Object.keys(W);for(const R of J)V(R,W[R],G.config)}G.dataInputs=[],G.dataOutputs=[],G.className=this.getClassName();for(const W of this.dataInputs){const V={};W.serialize(V),G.dataInputs.push(V)}for(const W of this.dataOutputs){const V={};W.serialize(V),G.dataOutputs.push(V)}}deserialize(G){}_log(G,V,W){var J;null===(J=G.logger)||void 0===J||J.addLogItem({action:V,payload:W,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13097:(G,V,W)=>{"use strict";W.d(V,{c:()=>d});var J,R=W(11304);!function(G){G[G.Input=0]="Input",G[G.Output=1]="Output"}(J||(J={}));class d{constructor(G,V,W){this._ownerBlock=W,this._connectedPoint=[],this.uniqueId=(0,R.b)(),this.connectedPointIds=[],this.name=G,this._connectionType=V}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(G){if(this._connectionType===G._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||G._isSingularConnection()&&G._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(G),G._connectedPoint.push(this)}disconnectFrom(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this._connectedPoint.indexOf(G),J=G._connectedPoint.indexOf(this);-1!==W&&-1!==J&&(V&&this._connectedPoint.splice(W,1),G._connectedPoint.splice(J,1))}disconnectFromAll(){for(const G of this._connectedPoint)this.disconnectFrom(G,!1);this._connectedPoint.length=0}dispose(){for(const G of this._connectedPoint)this.disconnectFrom(G)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.uniqueId=this.uniqueId,G.name=this.name,G._connectionType=this._connectionType,G.connectedPointIds=[],G.className=this.getClassName();for(const V of this._connectedPoint)G.connectedPointIds.push(V.uniqueId)}getClassName(){return"FGConnection"}deserialize(G){this.uniqueId=G.uniqueId,this.name=G.name,this._connectionType=G._connectionType,this.connectedPointIds=G.connectedPointIds}}},13053:(G,V,W)=>{"use strict";W.d(V,{c:()=>p});var J,R=W(11176),d=W(11317),k=W(11324),z=W(11304),X=W(13061),P=W(13079),A=W(11201);!function(G){G.ExecuteBlock="ExecuteBlock",G.ExecuteEvent="ExecuteEvent",G.TriggerConnection="TriggerConnection",G.ContextVariableSet="ContextVariableSet",G.GlobalVariableSet="GlobalVariableSet",G.GlobalVariableDelete="GlobalVariableDelete",G.GlobalVariableGet="GlobalVariableGet",G.AddConnection="AddConnection",G.GetConnectionValue="GetConnectionValue",G.SetConnectionValue="SetConnectionValue",G.ActivateSignal="ActivateSignal",G.ContextVariableGet="ContextVariableGet"}(J||(J={}));class x{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(G){if(G.time||(G.time=Date.now()),this.log.push(G),this.logToConsole){var V;const W=null===(V=G.payload)||void 0===V?void 0:V.value;"object"===typeof W&&W.getClassName?A.c.Log(`[FGLog] ${G.className}:${G.uniqueId.split("-")[0]} ${G.action} - ${JSON.stringify(W.getClassName())}: ${W.toString()}`):A.c.Log(`[FGLog] ${G.className}:${G.uniqueId.split("-")[0]} ${G.action} - ${JSON.stringify(G.payload)}`)}}getItemsOfType(G){return this.log.filter((V=>V.action===G))}}class q{get enableLogging(){return this._enableLogging}set enableLogging(G){this._enableLogging!==G&&(this._enableLogging=G,this._enableLogging?(this.logger=new x,this.logger.logToConsole=!0):this.logger=null)}constructor(G){this.uniqueId=(0,z.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new R.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=G,this.assetsContext=G.assetsContext??G.tV}hasVariable(G){return G in this._userVariables}setVariable(G,V){var W;this._userVariables[G]=V,null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:G,value:V}})}getAsset(G,V){return(0,P.c)(this.assetsContext,G,V)}getVariable(G){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:G,value:this._userVariables[G]}}),this._userVariables[G]}get userVariables(){return this._userVariables}HG(){return this._configuration.tV}_getUniqueIdPrefixedName(G,V){return`${G.uniqueId}_${V}`}_getGlobalContextVariable(G,V){var W;return null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:G,defaultValue:V,possibleValue:this._globalContextVariables[G]}}),this._hasGlobalContextVariable(G)?this._globalContextVariables[G]:V}_setGlobalContextVariable(G,V){var W;null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:G,value:V}}),this._globalContextVariables[G]=V}_deleteGlobalContextVariable(G){var V;null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:G}}),delete this._globalContextVariables[G]}_hasGlobalContextVariable(G){return G in this._globalContextVariables}_setExecutionVariable(G,V,W){this._executionVariables[this._getUniqueIdPrefixedName(G,V)]=W}_getExecutionVariable(G,V,W){return this._hasExecutionVariable(G,V)?this._executionVariables[this._getUniqueIdPrefixedName(G,V)]:W}_deleteExecutionVariable(G,V){delete this._executionVariables[this._getUniqueIdPrefixedName(G,V)]}_hasExecutionVariable(G,V){return this._getUniqueIdPrefixedName(G,V)in this._executionVariables}_hasConnectionValue(G){return G.uniqueId in this._connectionValues}_setConnectionValue(G,V){var W;this._connectionValues[G.uniqueId]=V,null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:G.uniqueId,value:V}})}_setConnectionValueByKey(G,V){this._connectionValues[G]=V}_getConnectionValue(G){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:G.uniqueId,value:this._connectionValues[G.uniqueId]}}),this._connectionValues[G.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(G){this._pendingBlocks.includes(G)||(this._pendingBlocks.push(G),this._pendingBlocks.sort(((G,V)=>G.priority-V.priority)))}_removePendingBlock(G){const V=this._pendingBlocks.indexOf(G);-1!==V&&this._pendingBlocks.splice(V,1)}_clearPendingBlocks(){for(const G of this._pendingBlocks)G._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(G){var V;this.onNodeExecutedObservable.notifyObservers(G),null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:G.getClassName(),uniqueId:G.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(G){this._setGlobalContextVariable("timeSinceStart",G.timeSinceStart),this._setGlobalContextVariable("deltaTime",G.deltaTime);for(const W of this._pendingBlocks){var V;null===(V=W._executeOnTick)||void 0===V||V.call(W,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.g;G.uniqueId=this.uniqueId,G._userVariables={};for(const J in this._userVariables)V(J,this._userVariables[J],G._userVariables);G._connectionValues={};for(const J in this._connectionValues)V(J,this._connectionValues[J],G._connectionValues);var W;this.assetsContext!==this.HG()&&(G._assetsContext={meshes:this.assetsContext.meshes.map((G=>G.id)),materials:this.assetsContext.materials.map((G=>G.id)),textures:this.assetsContext.textures.map((G=>G.name)),animations:this.assetsContext.animations.map((G=>G.name)),lights:this.assetsContext.lights.map((G=>G.id)),cameras:this.assetsContext.cameras.map((G=>G.id)),Sq:null===(W=this.assetsContext.Sq)||void 0===W?void 0:W.map((G=>G.name)),skeletons:this.assetsContext.skeletons.map((G=>G.id)),mx:this.assetsContext.mx.map((G=>G.name)),geometries:this.assetsContext.geometries.map((G=>G.id)),multiMaterials:this.assetsContext.multiMaterials.map((G=>G.id)),transformNodes:this.assetsContext.transformNodes.map((G=>G.id))})}getClassName(){return"FlowGraphContext"}}(0,d.e)([(0,k.I)()],q.prototype,"uniqueId",void 0);var L=W(13084),t=W(11762);class Y{constructor(G){this.onEventTriggeredObservable=new R.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=G,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Md.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const G=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:G}}),this._startingTime+=G})),this._meshPickedObserver=this._scene.onPointerObservable.add((G=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:G})}),t.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((G=>{const V=G.pointerId,W=G.mesh,J=this._pointerUnderMeshState[V];!J&&W?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:V,mesh:W}}):J&&!W?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:V,mesh:J}}):J&&W&&J!==W&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:V,mesh:J,over:W}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:V,mesh:W,out:J}})),this._pointerUnderMeshState[V]=W}),t.c.POINTERMOVE)}dispose(){var G,V,W,J,R;null===(G=this._sceneDisposeObserver)||void 0===G||G.remove(),null===(V=this._sceneReadyObserver)||void 0===V||V.remove(),null===(W=this._sceneOnBeforeRenderObserver)||void 0===W||W.remove(),null===(J=this._meshPickedObserver)||void 0===J||J.remove(),null===(R=this._meshUnderPointerObserver)||void 0===R||R.remove(),this.onEventTriggeredObservable.clear()}}var g,B=W(13104);!function(G){G[G.Stopped=0]="Stopped",G[G.Started=1]="Started"}(g||(g={}));class S{get state(){return this._state}set state(G){this._state=G,this.onStateChangedObservable.notifyObservers(G)}constructor(G){this.onStateChangedObservable=new R.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=G.tV,this._sceneEventCoordinator=new Y(this._scene),this._coordinator=G.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((G=>{for(const V of this._executionContexts){const W=this._getContextualOrder(G.type,V);for(const J of W)if(!J._executeEvent(V,G.payload))break}switch(G.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const V of this._executionContexts)V._notifyOnTick(G.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const G=new q({tV:this._scene,coordinator:this._coordinator});return this._executionContexts.push(G),G}getContext(G){return this._executionContexts[G]}addEventBlock(G){if("PointerOver"!==G.type&&"PointerOut"!==G.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==G.type&&this._eventBlocks[G.type].push(G),1===this.state)for(const V of this._executionContexts)G._startPendingTasks(V);else this.onStateChangedObservable.addOnce((V=>{if(1===V)for(const W of this._executionContexts)G._startPendingTasks(W)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((G=>{1===G&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const G of this._executionContexts)for(const V in this._eventBlocks){const W=this._getContextualOrder(V,G);for(const V of W)V._startPendingTasks(G)}}_getContextualOrder(G,V){const W=this._eventBlocks[G].sort(((G,V)=>V.initPriority-G.initPriority));if("MeshPick"===G){const G=[];for(const J of W){const R=J.asset.getValue(V);let d=0;for(;d<W.length;d++){const G=W[d].asset.getValue(V);if(R&&G&&(0,B.n)(R,G))break}G.splice(d,0,J)}return G}return W}dispose(){var G;if(0!==this.state){this.state=0;for(const G of this._executionContexts)G._clearPendingBlocks();this._executionContexts.length=0;for(const G in this._eventBlocks)this._eventBlocks[G].length=0;null===(G=this._eventObserver)||void 0===G||G.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(G){const V=[],W=new Set;for(const J in this._eventBlocks)for(const G of this._eventBlocks[J])V.push(G),W.add(G.uniqueId);for(;V.length>0;){const J=V.pop();G(J);for(const G of J.dataInputs)for(const J of G._connectedPoint)W.has(J._ownerBlock.uniqueId)||(V.push(J._ownerBlock),W.add(J._ownerBlock.uniqueId));if(J instanceof L.b)for(const G of J.signalOutputs)for(const J of G._connectedPoint)W.has(J._ownerBlock.uniqueId)||(V.push(J._ownerBlock),W.add(J._ownerBlock.uniqueId))}}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},V=arguments.length>1?arguments[1]:void 0;G.allBlocks=[],this.visitAllBlocks((V=>{const W={};V.serialize(W),G.allBlocks.push(W)})),G.executionContexts=[];for(const W of this._executionContexts){const J={};W.serialize(J,V),G.executionContexts.push(J)}}}class p{constructor(G){this.config=G,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.tV.Md.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.tV.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const G=this._executeOnNextFrame.slice(0);if(G.length)for(const V of G){this.notifyCustomEvent(V.id,V.data,!1);const G=this._executeOnNextFrame.findIndex((G=>G.uniqueId===V.uniqueId));-1!==G&&this._executeOnNextFrame.splice(G,1)}}));(p.SceneCoordinators.get(this.config.tV)??[]).push(this)}createGraph(){const G=new S({tV:this.config.tV,coordinator:this});return this._flowGraphs.push(G),G}removeGraph(G){const V=this._flowGraphs.indexOf(G);-1!==V&&(G.dispose(),this._flowGraphs.splice(V,1))}start(){for(const G of this._flowGraphs)G.start()}dispose(){var G,V;for(const R of this._flowGraphs)R.dispose();this._flowGraphs.length=0,null===(G=this._disposeObserver)||void 0===G||G.remove(),null===(V=this._onBeforeRenderObserver)||void 0===V||V.remove();const W=p.SceneCoordinators.get(this.config.tV)??[],J=W.indexOf(this);-1!==J&&W.splice(J,1)}serialize(G,V){G._flowGraphs=[];for(const W of this._flowGraphs){const J={};W.serialize(J,V),G._flowGraphs.push(J)}G.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(G){let V=this._customEventsMap.get(G);return V||(V=new R.b,this._customEventsMap.set(G,V)),V}notifyCustomEvent(G,V){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:G,data:V,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(G)){const V=this._eventExecutionCounter.get(G);if(this._eventExecutionCounter.set(G,V+1),V>=p.MaxEventTypeExecutionPerFrame)return void(V===p.MaxEventTypeExecutionPerFrame&&A.c.Warn(`FlowGraphCoordinator: Too many executions of event "${G}".`))}else this._eventExecutionCounter.set(G,1);const W=this._customEventsMap.get(G);W&&W.notifyObservers(V)}}p.MaxEventsPerType=30,p.MaxEventTypeExecutionPerFrame=30,p.SceneCoordinators=new Map},13106:(G,V,W)=>{"use strict";W.d(V,{d:()=>R});var J=W(13108);class R extends J.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(G){G._notifyExecuteNode(this),this.done._activateSignal(G)}}},13084:(G,V,W)=>{"use strict";W.d(V,{b:()=>z});var J=W(13093),R=W(13097),d=W(11159);class k extends R.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(G){super.connectTo(G),this._connectedPoint.sort(((G,V)=>V.priority-G.priority))}_activateSignal(G){var V;if(null===(V=G.logger)||void 0===V||V.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)G._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(G,this),G._increaseExecutionId();else for(const W of this._connectedPoint)W._activateSignal(G)}}(0,d.d)("FlowGraphSignalConnection",k);class z extends J.c{constructor(G){super(G),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(G){const V=new k(G,0,this);return this.signalInputs.push(V),V}_registerSignalOutput(G){const V=new k(G,1,this);return this.signalOutputs.push(V),V}_unregisterSignalInput(G){const V=this.signalInputs.findIndex((V=>V.name===G));-1!==V&&(this.signalInputs[V].dispose(),this.signalInputs.splice(V,1))}_unregisterSignalOutput(G){const V=this.signalOutputs.findIndex((V=>V.name===G));-1!==V&&(this.signalOutputs[V].dispose(),this.signalOutputs.splice(V,1))}_reportError(G,V){this.error.payload="string"===typeof V?new Error(V):V,this.error._activateSignal(G)}getSignalInput(G){return this.signalInputs.find((V=>V.name===G))}getSignalOutput(G){return this.signalOutputs.find((V=>V.name===G))}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.signalInputs=[],G.signalOutputs=[];for(const V of this.signalInputs){const W={};V.serialize(W),G.signalInputs.push(W)}for(const V of this.signalOutputs){const W={};V.serialize(W),G.signalOutputs.push(W)}}deserialize(G){for(let V=0;V<G.signalInputs.length;V++){const W=this.getSignalInput(G.signalInputs[V].name);if(!W)throw new Error("Could not find signal input with name "+G.signalInputs[V].name+" in block "+G.className);W.deserialize(G.signalInputs[V])}for(let V=0;V<G.signalOutputs.length;V++){const W=this.getSignalOutput(G.signalOutputs[V].name);if(!W)throw new Error("Could not find signal output with name "+G.signalOutputs[V].name+" in block "+G.className);W.deserialize(G.signalOutputs[V])}}getClassName(){return"FlowGraphExecutionBlock"}}},13115:(G,V,W)=>{"use strict";W.d(V,{e:()=>R});var J=W(13084);class R extends J.b{constructor(G){super(G),this.out=this._registerSignalOutput("out")}}},13071:(G,V,W)=>{"use strict";W.d(V,{C:()=>n,E:()=>D,I:()=>H,L:()=>u,b:()=>P,d:()=>q,h:()=>y,l:()=>g,n:()=>B,q:()=>S,r:()=>x,s:()=>r,t:()=>A,w:()=>L,x:()=>t,z:()=>Y});var J,R=W(11136),d=W(11424),k=W(13067),z=W(13074);!function(G){G.Any="any",G.String="string",G.Number="number",G.Boolean="boolean",G.Object="object",G.Integer="FlowGraphInteger",G.Vector2="Vector2",G.ed="ed",G.Vector4="Vector4",G.Quaternion="Quaternion",G.Matrix="Matrix",G.Matrix2D="Matrix2D",G.Matrix3D="Matrix3D",G.pz="pz",G.nz="nz"}(J||(J={}));class X{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=G,this.defaultValue=V,this.animationType=W}serialize(G){G.typeName=this.typeName,G.defaultValue=this.defaultValue}}const P=new X("any",void 0),A=new X("string",""),x=new X("number",0,0),q=new X("boolean",!1),L=new X("Vector2",R.k.Zero(),5),t=new X("ed",R.o.Zero(),1),Y=new X("Vector4",R.q.Zero()),g=new X("Matrix",R.c.Identity(),3),B=new X("Matrix2D",new z.e),S=new X("Matrix3D",new z.g),p=new X("pz",d.d.Black(),4),b=new X("nz",new d.h(0,0,0,0),7),r=new X("Quaternion",R.g.Identity(),2);r.typeTransformer=G=>{if(G.getClassName){if("Vector4"===G.getClassName())return R.g.ld(G.Bd());if("ed"===G.getClassName())return R.g.FromEulerVector(G);if("Matrix"===G.getClassName())return R.g.FromRotationMatrix(G)}return G};const y=new X("FlowGraphInteger",new k.e(0),0);function u(G){const V=G;switch(typeof G){case"string":return A;case"number":return x;case"boolean":return q;case"object":if(V.getClassName)switch(V.getClassName()){case"Vector2":return L;case"ed":return t;case"Vector4":return Y;case"Matrix":return g;case"pz":return p;case"nz":return b;case"Quaternion":return r;case"FlowGraphInteger":return y;case"Matrix2D":return B;case"Matrix3D":return S}return P;default:return P}}function H(G){switch(G){case"string":return A;case"number":return x;case"boolean":return q;case"Vector2":return L;case"ed":return t;case"Vector4":return Y;case"Matrix":return g;case"pz":return p;case"nz":return b;case"Quaternion":return r;case"FlowGraphInteger":return y;case"Matrix2D":return B;case"Matrix3D":return S;default:return P}}function n(G){switch(G){case"number":default:return 0;case"Vector2":return 5;case"ed":return 1;case"Matrix":return 3;case"pz":return 4;case"nz":return 7;case"Quaternion":return 2}}function D(G){switch(G){case 0:return x;case 5:return L;case 1:return t;case 3:return g;case 4:return p;case 7:return b;case 2:return r;default:return P}}},13061:(G,V,W)=>{"use strict";W.d(V,{c:()=>A,g:()=>P,i:()=>x});var J=W(11424),R=W(11136),d=W(13067),k=W(13071),z=W(13074);function X(G){return"Vector2"===G||"ed"===G||"Vector4"===G||"Quaternion"===G||"pz"===G||"nz"===G}function P(G,V,W){var J;const R=(null===V||void 0===V||null===(J=V.getClassName)||void 0===J?void 0:J.call(V))??"";if(X(R)||function(G){return"Matrix"===G||"Matrix2D"===G||"Matrix3D"===G}(R))W[G]={value:V.Bd(),className:R};else if("FlowGraphInteger"===R)W[G]={value:V.value,className:R};else if(R&&(V.id||V.name))W[G]={id:V.id,name:V.name,className:R};else{if("object"===typeof V)throw new Error(`Could not serialize value ${V}`);W[G]=V}}function A(G,V,W,P){const x=V[G];let q;const L=(null===x||void 0===x?void 0:x.type)??(null===x||void 0===x?void 0:x.className);if(function(G){return"Mesh"===G||"AbstractMesh"===G||"GroundMesh"===G||"InstanceMesh"===G||"LinesMesh"===G||"GoldbergMesh"===G||"GreasedLineMesh"===G||"TrailMesh"===G}(L)){let G=P.meshes.filter((G=>x.id?G.id===x.id:G.name===x.name));0===G.length&&(G=P.transformNodes.filter((G=>x.id?G.id===x.id:G.name===x.name))),q=x.uniqueId?G.find((G=>G.uniqueId===x.uniqueId)):G[0]}else if(X(L))q=function(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===G)return R.k.ld(V);if("ed"===G)return W&&(V[2]*=-1),R.o.ld(V);if("Vector4"===G)return R.q.ld(V);if("Quaternion"===G)return W&&(V[2]*=-1,V[3]*=-1),R.g.ld(V);if("pz"===G)return new J.d(V[0],V[1],V[2]);if("nz"===G)return new J.h(V[0],V[1],V[2],V[3]);throw new Error(`Unknown vector class name ${G}`)}(L,x.value);else if(function(G){return"AnimationGroup"===G}(L)){const G=P.animationGroups.filter((G=>G.name===x.name));q=1===G.length?G[0]:G.find((G=>G.uniqueId===x.uniqueId))}else q="Matrix"===L?R.c.ld(x.value):"Matrix2D"===L?new z.e(x.value):"Matrix3D"===L?new z.g(x.value):"FlowGraphInteger"===L?d.e.FromValue(x.value):"number"===L||"string"===L||"boolean"===L?x.value[0]:x&&void 0!==x.value?x.value:Array.isArray(x)?x.reduce(((G,V)=>V.eventData?(G[V.id]={type:(0,k.I)(V.type)},"undefined"!==typeof V.value&&(G[V.id].value=A("value",V,W,P)),G):G),{}):x;return q}function x(G){return"FlowGraphJsonPointerParserBlock"===G}},13104:(G,V,W)=>{"use strict";function J(G,V){return!(!G.parent||G.parent!==V&&!J(G.parent,V))}function R(G){if(G.getClassName)return G.getClassName()}function d(G,V){return G===V&&("Vector2"===G||"ed"===G||"Vector4"===G||"Quaternion"===G)}function k(G,V){return G===V&&("Matrix"===G||"Matrix2D"===G||"Matrix3D"===G)}function z(G,V){return"FlowGraphInteger"===G&&"FlowGraphInteger"===V}function X(G,V){const W="number"===typeof G||"number"===typeof(null===G||void 0===G?void 0:G.value);return W&&!V?!isNaN(P(G)):W}function P(G){return"number"===typeof G?G:G.value}W.d(V,{c:()=>z,e:()=>k,g:()=>d,k:()=>R,n:()=>J,r:()=>P,t:()=>X})},12457:(G,V,W)=>{"use strict";W.r(V),W.d(V,{SceneInstrumentation:()=>d});var J=W(11189),R=W(11654);class d{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(G){G!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=G,G?(this._onBeforeActiveMeshesEvaluationObserver=this.tV.onBeforeActiveMeshesEvaluationObservable.add((()=>{J.h.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.tV.onAfterActiveMeshesEvaluationObservable.add((()=>{J.h.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.tV.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.tV.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(G){G!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=G,G?(this._onBeforeRenderTargetsRenderObserver=this.tV.onBeforeRenderTargetsRenderObservable.add((()=>{J.h.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.tV.onAfterRenderTargetsRenderObservable.add((()=>{J.h.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.tV.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.tV.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(G){G!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=G,G?(this._onBeforeParticlesRenderingObserver=this.tV.onBeforeParticlesRenderingObservable.add((()=>{J.h.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.tV.onAfterParticlesRenderingObservable.add((()=>{J.h.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.tV.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.tV.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(G){G!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=G,this.tV.spriteManagers&&(G?(this._onBeforeSpritesRenderingObserver=this.tV.onBeforeSpritesRenderingObservable.add((()=>{J.h.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.tV.onAfterSpritesRenderingObservable.add((()=>{J.h.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.tV.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.tV.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(G){G!==this._capturePhysicsTime&&this.tV.onBeforePhysicsObservable&&(this._capturePhysicsTime=G,G?(this._onBeforePhysicsObserver=this.tV.onBeforePhysicsObservable.add((()=>{J.h.StartPerformanceCounter("Ct"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.tV.onAfterPhysicsObservable.add((()=>{J.h.EndPerformanceCounter("Ct"),this._physicsTime.endMonitoring()}))):(this.tV.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.tV.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(G){G!==this._captureAnimationsTime&&(this._captureAnimationsTime=G,G?this._onAfterAnimationsObserver=this.tV.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.tV.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(G){this._captureFrameTime=G}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(G){this._captureInterFrameTime=G}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(G){G!==this._captureRenderTime&&(this._captureRenderTime=G,G?(this._onBeforeDrawPhaseObserver=this.tV.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),J.h.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.tV.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),J.h.EndPerformanceCounter("Main render")}))):(this.tV.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.tV.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(G){G!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=G,G?(this._onBeforeCameraRenderObserver=this.tV.onBeforeCameraRenderObservable.add((G=>{this._cameraRenderTime.beginMonitoring(),J.h.StartPerformanceCounter(`Rendering camera ${G.name}`)})),this._onAfterCameraRenderObserver=this.tV.onAfterCameraRenderObservable.add((G=>{this._cameraRenderTime.endMonitoring(!1),J.h.EndPerformanceCounter(`Rendering camera ${G.name}`)}))):(this.tV.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.tV.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.tV.getEngine()._drawCalls}constructor(G){this.tV=G,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new R.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new R.c,this._captureFrameTime=!1,this._frameTime=new R.c,this._captureRenderTime=!1,this._renderTime=new R.c,this._captureInterFrameTime=!1,this._interFrameTime=new R.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new R.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new R.c,this._capturePhysicsTime=!1,this._physicsTime=new R.c,this._captureAnimationsTime=!1,this._animationsTime=new R.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new R.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=G.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(J.h.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.tV.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=G.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(J.h.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.yx(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.yx(),this._captureParticlesRenderTime&&this._particlesRenderTime.yx(),this._captureSpritesRenderTime&&this._spritesRenderTime.yx(),this._captureRenderTime&&this._renderTime.yx(),this._captureCameraRenderTime&&this._cameraRenderTime.yx()}))}dispose(){this._disposed||(this.tV.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.tV.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.tV.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.tV.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.tV.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.tV.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.tV.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.tV.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.tV.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.tV.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.tV.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.tV.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.tV.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.tV.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.tV.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.tV.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.tV.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.tV=null,this._disposed=!0)}}},13045:(G,V,W)=>{"use strict";W.d(V,{c:()=>A});var J=W(11317),R=W(11324),d=W(11136),k=W(11465),z=W(11868),X=W(11939),P=W(11159);k.d.AddNodeConstructor("Light_Type_1",((G,V)=>()=>new A(G,d.o.Zero(),V)));class A extends X.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(G){this._shadowFrustumSize=G,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(G){this._shadowOrthoScale=G,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(G){this._orthoLeft=G}get orthoRight(){return this._orthoRight}set orthoRight(G){this._orthoRight=G}get orthoTop(){return this._orthoTop}set orthoTop(G){this._orthoTop=G}get orthoBottom(){return this._orthoBottom}set orthoBottom(G){this._orthoBottom=G}constructor(G,V,W){super(G,W),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=V.scale(-1),this.direction=V}getClassName(){return"lt"}getTypeID(){return z.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(G,V,W){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(G):this._setDefaultAutoExtendShadowProjectionMatrix(G,V,W)}_setDefaultFixedFrustumShadowProjectionMatrix(G){const V=this.HG().activeCamera;V&&d.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:V.Zd,void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,G,this.HG().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(G,V,W){const J=this.HG().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const G=d.o.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let J=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let k=0;k<W.length;k++){const z=W[k];if(!z)continue;const X=z.getBoundingInfo().boundingBox;for(let W=0;W<X.vectorsWorld.length;W++)d.o.TransformCoordinatesToRef(X.vectorsWorld[W],V,G),G.x<this._orthoLeft&&(this._orthoLeft=G.x),G.y<this._orthoBottom&&(this._orthoBottom=G.y),G.x>this._orthoRight&&(this._orthoRight=G.x),G.y>this._orthoTop&&(this._orthoTop=G.y),this.autoCalcShadowZBounds&&(G.z<J&&(J=G.z),G.z>R&&(R=G.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=J,this._shadowMaxZ=R)}const R=this._orthoRight-this._orthoLeft,k=this._orthoTop-this._orthoBottom,z=void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.Zd)||0,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)||1e4,P=this.HG().getEngine().useReverseDepthBuffer;d.c.OrthoOffCenterLHToRef(this._orthoLeft-R*this.shadowOrthoScale,this._orthoRight+R*this.shadowOrthoScale,this._orthoBottom-k*this.shadowOrthoScale,this._orthoTop+k*this.shadowOrthoScale,P?X:z,P?z:X,G,this.HG().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(G,V){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,V),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,V),this)}transferToNodeMaterialEffect(G,V){return this.computeTransformedInformation()?(G.setFloat3(V,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(G.setFloat3(V,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(G){const V=this._scene.getEngine();return!V.useReverseDepthBuffer&&V.isNDCHalfZRange?0:1}getDepthMaxZ(G){const V=this._scene.getEngine();return V.useReverseDepthBuffer&&V.isNDCHalfZRange?0:1}prepareLightSpecificDefines(G,V){G["DIRLIGHT"+V]=!0}}(0,J.e)([(0,R.I)()],A.prototype,"shadowFrustumSize",null),(0,J.e)([(0,R.I)()],A.prototype,"shadowOrthoScale",null),(0,J.e)([(0,R.I)()],A.prototype,"autoUpdateExtends",void 0),(0,J.e)([(0,R.I)()],A.prototype,"autoCalcShadowZBounds",void 0),(0,J.e)([(0,R.I)("orthoLeft")],A.prototype,"_orthoLeft",void 0),(0,J.e)([(0,R.I)("orthoRight")],A.prototype,"_orthoRight",void 0),(0,J.e)([(0,R.I)("orthoTop")],A.prototype,"_orthoTop",void 0),(0,J.e)([(0,R.I)("orthoBottom")],A.prototype,"_orthoBottom",void 0),(0,P.d)("BABYLON.DirectionalLight",A)},13492:(G,V,W)=>{"use strict";W.d(V,{b:()=>A});var J=W(11317),R=W(11324),d=W(11136),k=W(11424),z=W(11465),X=W(11868),P=W(11159);z.d.AddNodeConstructor("Light_Type_3",((G,V)=>()=>new A(G,d.o.Zero(),V)));class A extends X.e{constructor(G,V,W){super(G,W),this.groundColor=new k.d(0,0,0),this.direction=V||d.o.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"wt"}setDirectionToTarget(G){return this.direction=d.o.Normalize(G.zW(d.o.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(G,V){const W=d.o.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",W.x,W.y,W.z,0,V),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Xz),V),this}transferToNodeMaterialEffect(G,V){const W=d.o.Normalize(this.direction);return G.setFloat3(V,W.x,W.y,W.z),this}kd(){return this._worldMatrix||(this._worldMatrix=d.c.Identity()),this._worldMatrix}getTypeID(){return X.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(G,V){G["HEMILIGHT"+V]=!0}}(0,J.e)([(0,R.m)()],A.prototype,"groundColor",void 0),(0,J.e)([(0,R.F)()],A.prototype,"direction",void 0),(0,P.d)("BABYLON.HemisphericLight",A)},13015:(G,V,W)=>{"use strict";W.d(V,{d:()=>x});var J=W(11317),R=W(11324),d=W(11136),k=W(11465),z=W(11868),X=W(11939),P=W(11666),A=W(11159);k.d.AddNodeConstructor("Light_Type_2",((G,V)=>()=>new x(G,d.o.Zero(),d.o.Zero(),0,0,V)));class x extends X.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(G){this._iesProfileTexture!==G&&(this._iesProfileTexture=G,this._iesProfileTexture&&x._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(G){this._angle=G,this._cosHalfAngle=Math.cos(.5*G),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(G){this._innerAngle=G,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(G){this._shadowAngleScale=G,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(G){this._projectionTextureLightNear=G,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(G){this._projectionTextureLightFar=G,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(G){this._projectionTextureUpDirection=G,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(G){this._projectionTexture!==G&&(this._projectionTexture=G,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(x._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):x._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(G){return void 0!==G.onGeneratedObservable}static _IsTexture(G){return void 0!==G.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(G){this._projectionTextureProjectionLightMatrix=G,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(G,V,W,J,R,k){super(G,k),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=d.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=d.o.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=d.o.Zero(),this._projectionTextureViewLightMatrix=d.c.Zero(),this._projectionTextureProjectionLightMatrix=d.c.Zero(),this._projectionTextureScalingMatrix=d.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=V,this.direction=W,this.angle=J,this.exponent=R}getClassName(){return"SpotLight"}getTypeID(){return z.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(G){super._setDirection(G),this._projectionTextureViewLightDirty=!0}_setPosition(G){super._setPosition(G),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(G,V,W){const J=this.HG().activeCamera;if(!J)return;this._shadowAngleScale=this._shadowAngleScale||1;const R=this._shadowAngleScale*this._angle,k=void 0!==this.shadowMinZ?this.shadowMinZ:J.Zd,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,X=this.HG().getEngine().useReverseDepthBuffer;d.c.PerspectiveFovLHToRef(R,1,X?z:k,X?k:z,G,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),d.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const G=this.projectionTextureLightFar,V=this.projectionTextureLightNear,W=G/(G-V),J=-W*V,R=1/Math.tan(this._angle/2);d.c.FromValuesToRef(R/1,0,0,0,0,R,0,0,0,0,W,1,0,0,J,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof P.d){const G=this._projectionTexture.uScale/2,V=this._projectionTexture.vScale/2;d.c.FromValuesToRef(G,0,0,0,0,V,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(G,V){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),G.setMatrix("textureProjectionMatrix"+V,this._projectionTextureMatrix),G.setTexture("projectionLightTexture"+V,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&G.setTexture("iesLightTexture"+V,this._iesProfileTexture),this}transferToEffect(G,V){let W;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,V),W=d.o.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,V),W=d.o.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",W.x,W.y,W.z,this._cosHalfAngle,V),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,V),this}transferToNodeMaterialEffect(G,V){let W;return W=this.computeTransformedInformation()?d.o.Normalize(this.transformedDirection):d.o.Normalize(this.direction),this.HG().useRightHandedSystem?G.setFloat3(V,-W.x,-W.y,-W.z):G.setFloat3(V,W.x,W.y,W.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(G){const V=this._scene.getEngine(),W=void 0!==this.shadowMinZ?this.shadowMinZ:(null===G||void 0===G?void 0:G.Zd)??0;return V.useReverseDepthBuffer&&V.isNDCHalfZRange?W:this._scene.getEngine().isNDCHalfZRange?0:W}getDepthMaxZ(G){const V=this._scene.getEngine(),W=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===G||void 0===G?void 0:G.maxZ)??1e4;return V.useReverseDepthBuffer&&V.isNDCHalfZRange?0:W}prepareLightSpecificDefines(G,V){G["SPOTLIGHT"+V]=!0,G["PROJECTEDLIGHTTEXTURE"+V]=!(!this.projectionTexture||!this.projectionTexture.isReady()),G["IESLIGHTTEXTURE"+V]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,J.e)([(0,R.I)()],x.prototype,"angle",null),(0,J.e)([(0,R.I)()],x.prototype,"innerAngle",null),(0,J.e)([(0,R.I)()],x.prototype,"shadowAngleScale",null),(0,J.e)([(0,R.I)()],x.prototype,"exponent",void 0),(0,J.e)([(0,R.I)()],x.prototype,"projectionTextureLightNear",null),(0,J.e)([(0,R.I)()],x.prototype,"projectionTextureLightFar",null),(0,J.e)([(0,R.I)()],x.prototype,"projectionTextureUpDirection",null),(0,J.e)([(0,R.z)("projectedLightTexture")],x.prototype,"_projectionTexture",void 0),(0,A.d)("BABYLON.SpotLight",x)},12737:(G,V,W)=>{"use strict";W.d(V,{b:()=>k,c:()=>d,e:()=>z});const J={},R={};function d(G,V){J[G]=V}function k(G,V){R[G]=V}function z(G){return R[G]?R[G]:null}},12643:(G,V,W)=>{"use strict";W.d(V,{c:()=>u,f:()=>m});var J,R=W(11189),d=W(11176),k=W(11737),z=W(11169),X=W(11201),P=W(11543),A=W(11227),x=W(11234),q=W(11304),L=W(11262),t=W(11222);!function(G){G[G.Clean=0]="Clean",G[G.Stop=1]="Stop",G[G.Sync=2]="Sync",G[G.NoSync=3]="NoSync"}(J||(J={}));const Y=new d.b,g={};let B=!1;function S(){return g[".babylon"]}function p(G,V){const W=g[G];return W||(X.c.Warn("Unable to find a plugin to load "+G+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),V?S():void 0)}function b(G,V,W){let J="Unable to load from "+(G.rawData?"binary data":G.url);return V?J+=`: ${V}`:W&&(J+=`: ${W}`),J}async function r(G,V,W,J,R,d,k,z,X){var P;const x="data:"===(q=G.url).substring(0,5)?q.substring(5):null;var q;if(G.rawData&&!k)throw"When using ArrayBufferView to load data the file extension must be provided.";const B=x||k?"":function(G){const V=G.indexOf("?");-1!==V&&(G=G.substring(0,V));const W=G.lastIndexOf(".");return G.substring(W,G.length).toLowerCase()}(G.url);let b=k?p(k,!0):x?function(G){for(const V in g){const W=g[V].plugin;if(W.canDirectLoad&&W.canDirectLoad(G))return g[V]}return S()}(G.url):p(B,!1);if(!b&&B){if(G.url&&!G.url.startsWith("blob:")){const V=await async function(G,V){const W=V.method||"GET";return await new Promise(((J,R)=>{const d=new t.b;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const G={};if(V.responseHeaders)for(const W of V.responseHeaders)G[W]=d.getResponseHeader(W)||"";J({response:d.response,headerValues:G})}else R(`Unable to fetch data from ${G}. Error code: ${d.status}`)})),d.open(W,G),d.send()}))}(G.url,{method:"HEAD",responseHeaders:["Content-Type"]}),W=V.headerValues?V.headerValues["Content-Type"]:"";W&&(b=function(G){for(const V in g){const W=g[V];if(W.mimeType===G)return W}}(W))}b||(b=S())}if(!b)throw new Error(`No plugin or fallback for ${k??G.url}`);if(!1===(null===X||void 0===X||null===(P=X[b.plugin.name])||void 0===P?void 0:P.enabled))throw new Error(`The '${b.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(G.rawData&&!b.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(G=>{if(b.plugin.createPlugin){const V=b.plugin.createPlugin(X??{});return V instanceof Promise?(V.then(G).catch((G=>{R("Error instantiating plugin.",G)})),null):(G(V),V)}return G(b.plugin),b.plugin})((X=>{var P;if(!X)throw`The loader plugin corresponding to the '${k}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Y.notifyObservers(X),x&&(X.canDirectLoad&&X.canDirectLoad(G.url)||!(0,A.h)(G.url))){if(X.directLoad){const G=X.directLoad(V,x);G instanceof Promise?G.then((G=>{W(X,G)})).catch((G=>{R("Error in directLoad of _loadData: "+G,G)})):W(X,G)}else W(X,x);return}const q=b.isBinary,t=(G,J)=>{V.P?R("Scene has been disposed"):W(X,G,J)};let g=null,B=!1;null===(P=X.Md)||void 0===P||P.add((()=>{B=!0,g&&(g.abort(),g=null),d()}));const S=()=>{if(B)return;const W=(G,V)=>{R(null===G||void 0===G?void 0:G.statusText,V)};if(!X.loadFile&&G.rawData)throw"Plugin does not support loading ArrayBufferView.";g=X.loadFile?X.loadFile(V,G.rawData||G.file||G.url,G.rootUrl,t,J,q,W,z):V._loadFile(G.file||G.url,t,J,!0,q,W)},p=V.getEngine();let r=p.enableOfflineSupport;if(r){let W=!1;for(const J of V.disableOfflineSupportExceptionRules)if(J.test(G.url)){W=!0;break}r=!W}r&&L.b.OfflineProviderFactory?V.offlineProvider=L.b.OfflineProviderFactory(G.url,S,p.disableManifestCheck):S()}))}function y(G,V){let W,J,d=null,k=null;if(V)if(V.name)W=`file:${V.name}`,J=V.name,d=V;else if(ArrayBuffer.isView(V))W="",J=(0,q.b)(),k=V;else if(V.startsWith("data:"))W=V,J="";else if(G){const d=V;if("/"===d.substring(0,1))return R.h.Error("Wrong sceneFilename parameter"),null;W=G+d,J=d}else W=V,J=R.h.GetFilename(V),G=R.h.GetFolderPath(V);else W=G,J=R.h.GetFilename(G),G=R.h.GetFolderPath(G);return{url:W,rootUrl:G,name:J,file:d,rawData:k}}function u(G){if("string"===typeof G.extensions){const V=G.extensions;g[V.toLowerCase()]={plugin:G,isBinary:!1}}else{const V=G.extensions,W=Object.keys(V);for(const J of W)g[J.toLowerCase()]={plugin:G,isBinary:V[J].isBinary,mimeType:V[J].mimeType}}}async function H(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.c.LastCreatedScene,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!J)return X.c.Error("No scene available to import mesh to"),null;const L=y(V,W);if(!L)return null;const t={};J.addPendingData(t);const Y=()=>{J.removePendingData(t)},g=(G,V)=>{const W=b(L,G,V);k?k(J,W,new x.f(W,x.d.SceneLoaderError,V)):X.c.Error(W),Y()},B=d?G=>{try{d(G)}catch(V){g("Error in onProgress callback: "+V,V)}}:void 0,S=(G,V,W,d,k,z,X,P)=>{if(J.importedMeshesFiles.push(L.url),R)try{R(G,V,W,d,k,z,X,P)}catch(A){g("Error in onSuccess callback: "+A,A)}J.removePendingData(t)};return await r(L,J,((V,W,R)=>{if(V.rewriteRootURL&&(L.rootUrl=V.rewriteRootURL(L.rootUrl,R)),V.importMesh){const R=[],d=[],k=[];if(!V.importMesh(G,J,W,L.rootUrl,R,d,k,g))return;J.loadingPluginName=V.name,S(R,d,k,[],[],[],[],[])}else{V.importMeshAsync(G,J,W,L.rootUrl,B,L.name).then((G=>{J.loadingPluginName=V.name,S(G.meshes,G.mx,G.skeletons,G.animationGroups,G.transformNodes,G.geometries,G.lights,G.spriteManagers)})).catch((G=>{g(G.message,G)}))}}),B,g,Y,P,A,q)}async function n(G,V,W,J,R,d,k,z){return await new Promise(((X,P)=>{try{H(G,V,W,J,((G,V,W,J,R,d,k,z)=>{X({meshes:G,mx:V,skeletons:W,animationGroups:J,transformNodes:R,geometries:d,lights:k,spriteManagers:z})}),R,((G,V,W)=>{P(W||new Error(V))}),d,k,z).catch(P)}catch(x){P(x)}}))}async function D(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedEngine,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};W?await e(G,V,new k.e(W),J,d,X,P,A,x):R.h.Error("No engine available")}async function i(G,V,W,J,R,d,k){return await new Promise(((z,X)=>{D(G,V,W,(G=>{z(G)}),J,((G,V,W)=>{X(W||new Error(V))}),R,d,k)}))}async function e(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return X.c.Error("No scene available to append to"),null;const L=y(G,V);if(!L)return null;const t={};W.addPendingData(t);const Y=()=>{W.removePendingData(t)};P.d.ShowLoadingScreen&&!B&&(B=!0,W.getEngine().displayLoadingUI(),W.executeWhenReady((()=>{W.getEngine().hideLoadingUI(),B=!1})));const g=(G,V)=>{const J=b(L,G,V);d?d(W,J,new x.f(J,x.d.SceneLoaderError,V)):X.c.Error(J),Y()},S=R?G=>{try{R(G)}catch(V){g("Error in onProgress callback",V)}}:void 0,p=()=>{if(J)try{J(W)}catch(G){g("Error in onSuccess callback",G)}W.removePendingData(t)};return await r(L,W,((G,V)=>{if(G.load){if(!G.load(W,V,L.rootUrl,g))return;W.loadingPluginName=G.name,p()}else{G.loadAsync(W,V,L.rootUrl,S,L.name).then((()=>{W.loadingPluginName=G.name,p()})).catch((G=>{g(G.message,G)}))}}),S,g,Y,k,A,q)}async function F(G,V,W,J,R,d,k){return await new Promise(((z,X)=>{try{e(G,V,W,(G=>{z(G)}),J,((G,V,W)=>{X(W||new Error(V))}),R,d,k).catch(X)}catch(x){X(x)}}))}async function f(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return X.c.Error("No scene available to load asset container to"),null;const q=y(G,V);if(!q)return null;const L={};W.addPendingData(L);const t=()=>{W.removePendingData(L)},Y=(G,V)=>{const J=b(q,G,V);d?d(W,J,new x.f(J,x.d.SceneLoaderError,V)):X.c.Error(J),t()},g=R?G=>{try{R(G)}catch(V){Y("Error in onProgress callback",V)}}:void 0,B=G=>{if(J)try{J(G)}catch(V){Y("Error in onSuccess callback",V)}W.removePendingData(L)};return await r(q,W,((G,V)=>{if(G.loadAssetContainer){const J=G.loadAssetContainer(W,V,q.rootUrl,Y);if(!J)return;J.populateRootNodes(),W.loadingPluginName=G.name,B(J)}else if(G.loadAssetContainerAsync){G.loadAssetContainerAsync(W,V,q.rootUrl,g,q.name).then((V=>{V.populateRootNodes(),W.loadingPluginName=G.name,B(V)})).catch((G=>{Y(G.message,G)}))}else Y("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),g,Y,t,k,P,A)}async function v(G,V,W,J,R,d,k){return await new Promise(((z,X)=>{try{f(G,V,W,(G=>{z(G)}),J,((G,V,W)=>{X(W||new Error(V))}),R,d,k).catch(X)}catch(x){X(x)}}))}async function C(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!W)return void X.c.Error("No scene available to load animations to");if(J){for(const J of W.animatables)J.reset();W.stopAllAnimations();const G=W.animationGroups.slice();for(const W of G)W.dispose();const V=W.getNodes();for(const W of V)W.animations&&(W.animations=[])}else switch(R){case 0:const G=W.animationGroups.slice();for(const V of G)V.dispose();break;case 1:for(const V of W.animationGroups)V.stop();break;case 2:for(const V of W.animationGroups)V.reset(),V.restart();break;case 3:break;default:return void X.c.Error("Unknown animation group loading mode value '"+R+"'")}const t=W.animatables.length;await f(G,V,W,(G=>{G.mergeAnimationsTo(W,W.animatables.slice(t),d),G.dispose(),W.onAnimationFileImportedObservable.notifyObservers(W),k&&k(W)}),P,A,x,q,L)}async function l(G,V,W,J,R,d,k,z,X,P){return await new Promise(((A,q)=>{try{C(G,V,W,J,R,d,(G=>{A(G)}),k,((G,V,W)=>{q(W||new Error(V))}),z,X,P).catch(q)}catch(x){q(x)}}))}class m{static get ForceFullSceneLoadingForIncremental(){return P.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(G){P.d.ForceFullSceneLoadingForIncremental=G}static get ShowLoadingScreen(){return P.d.ShowLoadingScreen}static set ShowLoadingScreen(G){P.d.ShowLoadingScreen=G}static get loggingLevel(){return P.d.loggingLevel}static set loggingLevel(G){P.d.loggingLevel=G}static get CleanBoneMatrixWeights(){return P.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(G){P.d.CleanBoneMatrixWeights=G}static GetDefaultPlugin(){return S()}static GetPluginForExtension(G){var V;return null===(V=p(G,!0))||void 0===V?void 0:V.plugin}static IsPluginForExtensionAvailable(G){return function(G){return!!g[G]}(G)}static RegisterPlugin(G){u(G)}static ImportMesh(G,V,W,J,R,d,k,X,P){H(G,V,W,J,R,d,k,X,P).catch((G=>null===k||void 0===k?void 0:k(z.c.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async ImportMeshAsync(G,V,W,J,R,d,k){return await n(G,V,W,J,R,d,k)}static Load(G,V,W,J,R,d,k,X){D(G,V,W,J,R,d,k,X).catch((G=>null===d||void 0===d?void 0:d(z.c.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async LoadAsync(G,V,W,J,R,d){return await i(G,V,W,J,R,d)}static Append(G,V,W,J,R,d,k,X){e(G,V,W,J,R,d,k,X).catch((G=>null===d||void 0===d?void 0:d(W??z.c.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async AppendAsync(G,V,W,J,R,d){return await F(G,V,W,J,R,d)}static LoadAssetContainer(G,V,W,J,R,d,k,X){f(G,V,W,J,R,d,k,X).catch((G=>null===d||void 0===d?void 0:d(W??z.c.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async LoadAssetContainerAsync(G,V,W,J,R,d){return await v(G,V,W,J,R,d)}static ImportAnimations(G,V,W,J,R,d,k,X,P,A,x){C(G,V,W,J,R,d,k,X,P,A,x).catch((G=>null===P||void 0===P?void 0:P(W??z.c.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async ImportAnimationsAsync(G,V,W,J,R,d,k,z,X,P,A){return await l(G,V,W,J,R,d,z,P,A)}}m.NO_LOGGING=0,m.MINIMAL_LOGGING=1,m.SUMMARY_LOGGING=2,m.DETAILED_LOGGING=3,m.OnPluginActivatedObservable=Y},13034:(G,V,W)=>{"use strict";W.d(V,{e:()=>q});var J=W(11317),R=W(11324),d=W(11189),k=W(11136),z=W(11645),X=W(11666),P=W(11159),A=W(11176),x=W(11411);W(13039);class q extends z.b{set boundingBoxSize(G){if(this._boundingBoxSize&&this._boundingBoxSize.equals(G))return;this._boundingBoxSize=G;const V=this.HG();V&&V.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(G){this._rotationY=G,this.setReflectionTextureMatrix(k.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(G,V,W){let J="";for(const R of G)J+=R;return new q(J,V,null,W,G)}static CreateFromPrefilteredData(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const R=V.useDelayedTextureLoading;V.useDelayedTextureLoading=!1;const d=new q(G,V,null,!1,null,null,null,void 0,!0,W,J);return V.useDelayedTextureLoading=R,d}constructor(G,V){var W;let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,S=arguments.length>14?arguments[14]:void 0;super(V),this.onLoadObservable=new A.b,this.boundingBoxPosition=k.o.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new k.c,this._buffer=null,this.name=G,this.url=G,this._noMipmap=R,this.bd=!1,this.isCube=!0,this._textureMatrix=k.c.Identity(),this.coordinatesMode=X.d.CUBIC_MODE;let p=null,b=null;null===J||Array.isArray(J)?(this._noMipmap=R,this._format=x,this._createPolynomials=t,p=J,this._loaderOptions=B,this._useSRGBBuffer=S,this._lodScale=Y,this._lodOffset=g):(p=J.extensions??null,this._noMipmap=J.noMipmap??!1,d=J.files??null,b=J.buffer??null,this._format=J.format??5,q=J.prefiltered??!1,L=J.forcedExtension??null,this._createPolynomials=J.createPolynomials??!1,this._lodScale=J.lodScale??.8,this._lodOffset=J.lodOffset??0,this._loaderOptions=J.loaderOptions,this._useSRGBBuffer=J.useSRGBBuffer,z=J.h??null,P=J.onError??null),(G||d)&&this.updateURL(G,L,z,q,P,p,null===(W=this.HG())||void 0===W?void 0:W.useDelayedTextureLoading,d,b)}getClassName(){return"CubeTexture"}updateURL(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=G),this.url=G,V&&(this._forcedExtension=V);const P=G.lastIndexOf("."),A=V||(P>-1?G.substring(P).toLowerCase():""),x=0===A.indexOf(".dds"),q=0===A.indexOf(".env"),L=0===A.indexOf(".basis");if(q?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=J,J&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),z)this._files=z;else if(L||q||x||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,d){for(let V=0;V<d.length;V++)this._files.push(G+d[V]);this._extensions=d}this._buffer=X,k?(this.delayLoadState=4,this._delayedOnLoad=W,this._delayedOnError=R):this._loadTexture(W,R)}delayLoad(G){4===this.delayLoadState&&(G&&(this._forcedExtension=G),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(G){var V,W;if(G.updateFlag===this._textureMatrix.updateFlag)return;G.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(W=this.HG())||void 0===W||W.markAllMaterialsAsDirty(1,(G=>-1!==G.getActiveTextures().indexOf(this))));if(this._textureMatrix=G,null===(V=this.HG())||void 0===V||!V.useRightHandedSystem)return;const J=k.h.ed[0],R=k.h.Quaternion[0],d=k.h.ed[1];this._textureMatrix.decompose(J,R,d),R.z*=-1,R.w*=-1,k.c.ComposeToRef(J,R,d,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var G;return null!==(G=this.HG())&&void 0!==G&&G.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this.HG(),J=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const R=()=>{var V;(this.onLoadObservable.notifyObservers(this),J)&&(J.dispose(),null===(V=this.HG())||void 0===V||V.markAllMaterialsAsDirty(1));G&&G()},k=(G,W)=>{this._loadingError=!0,this._errorObject={message:G,exception:W},V&&V(G,W),X.d.OnTextureLoadErrorObservable.notifyObservers(this)};var z;this._texture?this._texture.isReady?d.h.SetImmediate((()=>R())):this._texture.onLoadedObservable.add((()=>R())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,W,this._lodScale,this._lodOffset,G,k,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,W,this._files,this._noMipmap,G,k,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(z=this._texture)||void 0===z||z.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(G,V,W){const J=x.e.Parse((()=>{let J=!1;return G.prefiltered&&(J=G.prefiltered),new q(W+(G.url??G.name),V,G.extensions,!1,G.files||null,null,null,void 0,J,G.forcedExtension)}),G,V);if(G.boundingBoxPosition&&(J.boundingBoxPosition=k.o.ld(G.boundingBoxPosition)),G.boundingBoxSize&&(J.boundingBoxSize=k.o.ld(G.boundingBoxSize)),G.animations)for(let R=0;R<G.animations.length;R++){const V=G.animations[R],W=(0,P.c)("BABYLON.Animation");W&&J.animations.push(W.Parse(V))}return J}clone(){let G=0;const V=x.e.Clone((()=>{const V=new q(this.url,this.HG()||this._getEngine(),this._extensions,this._noMipmap,this._files);return G=V.uniqueId,V}),this);return V.uniqueId=G,V}}(0,J.e)([(0,R.I)()],q.prototype,"url",void 0),(0,J.e)([(0,R.F)()],q.prototype,"boundingBoxPosition",void 0),(0,J.e)([(0,R.F)()],q.prototype,"boundingBoxSize",null),(0,J.e)([(0,R.I)("rotationY")],q.prototype,"rotationY",null),(0,J.e)([(0,R.I)("files")],q.prototype,"_files",void 0),(0,J.e)([(0,R.I)("forcedExtension")],q.prototype,"_forcedExtension",void 0),(0,J.e)([(0,R.I)("extensions")],q.prototype,"_extensions",void 0),(0,J.e)([(0,R.u)("textureMatrix")],q.prototype,"_textureMatrix",void 0),(0,J.e)([(0,R.u)("textureMatrixRefraction")],q.prototype,"_textureMatrixRefraction",void 0),X.d._CubeTextureParser=q.Parse,(0,P.d)("BABYLON.CubeTexture",q)},13508:(G,V,W)=>{"use strict";W.d(V,{e:()=>X});var J=W(11201),R=W(11666),d=W(11307),k=W(11568),z=W(11285);k.ThinEngine.prototype.createDynamicTexture=function(G,V,W,J){const R=new z.d(this,4);return R.baseWidth=G,R.baseHeight=V,W&&(G=this.needPOTTextures?(0,d.f)(G,this._caps.maxTextureSize):G,V=this.needPOTTextures?(0,d.f)(V,this._caps.maxTextureSize):V),R.width=G,R.height=V,R.isReady=!1,R.generateMipMaps=W,R.samplingMode=J,this.updateTextureSamplingMode(J,R),this._internalTexturesCache.push(R),R},k.ThinEngine.prototype.updateDynamicTexture=function(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!G)return;const k=this._gl,z=k.TEXTURE_2D,X=this._bindTextureDirectly(z,G,!0,d);this._unpackFlipY(void 0===W?G.invertY:W),J&&k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const P=this._getWebGLTextureType(G.type),A=this._getInternalFormat(R||G.format),x=this._getRGBABufferInternalSizedFormat(G.type,A);k.texImage2D(z,0,x,A,P,V),G.generateMipMaps&&k.generateMipmap(z),X||this._bindTextureDirectly(z,null),J&&k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),R&&(G.format=R),G._dynamicTextureSource=V,G._premulAlpha=J,G.invertY=W||!1,G.isReady=!0};class X extends R.d{constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,z=arguments.length>6?arguments[6]:void 0;const X=!W||W._isScene;super(null,X?W:null===W||void 0===W?void 0:W.tV,X?!J:W,z,d,void 0,void 0,void 0,void 0,k),this.name=G,this.wrapU=R.d.CLAMP_ADDRESSMODE,this.wrapV=R.d.CLAMP_ADDRESSMODE,this._generateMipMaps=J;const P=this._getEngine();if(!P)return;if(V.getContext)this._canvas=V,this._ownCanvas=!1,this._texture=P.createDynamicTexture(this._canvas.width,this._canvas.height,J,d);else{this._canvas=P.createCanvas(1,1),this._ownCanvas=!0;const G=V;G.width||0===G.width?this._texture=P.createDynamicTexture(G.width,G.height,J,d):this._texture=P.createDynamicTexture(V,V,J,d)}const A=this.getSize();this._canvas.width!==A.width&&(this._canvas.width=A.width),this._canvas.height!==A.height&&(this._canvas.height=A.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(G){this._canvas.width=G.width,this._canvas.height=G.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(G.width,G.height,this._generateMipMaps,this.samplingMode)}scale(G){const V=this.getSize();V.width*=G,V.height*=G,this._recreate(V)}scaleTo(G,V){const W=this.getSize();W.width=G,W.height=V,this._recreate(W)}getContext(){return this._context}clear(G){const V=this.getSize();G&&(this._context.fillStyle=G),this._context.clearRect(0,0,V.width,V.height)}update(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===G||G,V,this._format||void 0,void 0,W)}drawText(G,V,W,J,R,d,k){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const X=this.getSize();if(d&&(this._context.fillStyle=d,this._context.fillRect(0,0,X.width,X.height)),this._context.font=J,null===V||void 0===V){const W=this._context.measureText(G);V=(X.width-W.width)/2}if(null===W||void 0===W){const G=parseInt(J.replace(/\D/g,""));W=X.height/2+G/3.65}this._context.fillStyle=R||"",this._context.fillText(G,V,W),z&&this.update(k)}dispose(){var G,V;(super.dispose(),this._ownCanvas)&&(null===(G=this._canvas)||void 0===G||null===(V=G.remove)||void 0===V||V.call(G));this._canvas=null,this._context=null}clone(){const G=this.HG();if(!G)return this;const V=this.getSize(),W=new X(this.name,V,G,this._generateMipMaps);return W.bd=this.bd,W.level=this.level,W.wrapU=this.wrapU,W.wrapV=this.wrapV,W}serialize(){const G=this.HG();G&&!G.isReady()&&J.c.Warn("The scene must be ready before serializing the dynamic texture");const V=super.serialize();return X._IsCanvasElement(this._canvas)&&(V.base64String=this._canvas.toDataURL()),V.invertY=this._invertY,V.samplingMode=this.samplingMode,V}static _IsCanvasElement(G){return void 0!==G.toDataURL}_rebuild(){this.update()}}},12942:(G,V,W)=>{"use strict";W.d(V,{c:()=>R});var J=W(11666);class R extends J.d{get depth(){return this._depth}constructor(G,V,W,R,d,k){let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:J.d.TRILINEAR_SAMPLINGMODE,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;super(null,k,!z,X),this.format=d,this._texture=k.getEngine().createRawTexture2DArray(G,V,W,R,d,z,X,P,null,A,x),this._depth=R,this.is2DArray=!0}update(G){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,G,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(G,V,W,J,d){return new R(G,V,W,J,5,d,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12752:(G,V,W)=>{"use strict";W.d(V,{c:()=>z,f:()=>X,j:()=>d,n:()=>k});var J=W(11182),R=W(11136);function d(G,V){return`{X: ${G.x.toFixed(V)} Y: ${G.y.toFixed(V)}}`}function k(G,V){return`{X: ${G._x.toFixed(V)} Y: ${G._y.toFixed(V)} Z: ${G._z.toFixed(V)}}`}function z(G,V){return 2*Math.acos((0,J.Clamp)(R.g.Dot(G,V)))}function X(G,V){const W=new R.g;return function(G,V,W){const d=R.o.Cross(G,V),k=Math.acos((0,J.Clamp)(R.o.Dot(G,V),-1,1));R.g.RotationAxisToRef(d,k,W)}(G,V,W),W}},12591:(G,V,W)=>{"use strict";W.d(V,{e:()=>P});var J=W(11136),R=W(11424),d=W(11510),k=W(11482),z=W(11552);W(12599);function X(G){let V=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const W=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],d=[];let X=[];const P=G.width||G.size||1,A=G.height||G.size||1,x=G.depth||G.size||1,q=G.wrap||!1;let L=void 0===G.topBaseAt?1:G.topBaseAt,t=void 0===G.bottomBaseAt?0:G.bottomBaseAt;L=(L+4)%4,t=(t+4)%4;let Y=[2,0,3,1][L],g=[2,0,1,3][t],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(q){V=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let G=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],W=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const J=[17,18,19,16],R=[22,23,20,21];for(;Y>0;)G.unshift(G.pop()),J.unshift(J.pop()),Y--;for(;g>0;)W.unshift(W.pop()),R.unshift(R.pop()),g--;G=G.flat(),W=W.flat(),B=B.concat(G).concat(W),V.push(J[0],J[2],J[3],J[0],J[1],J[2]),V.push(R[0],R[2],R[3],R[0],R[1],R[2])}const S=[P/2,A/2,x/2];X=B.reduce(((G,V,W)=>G.concat(V*S[W%3])),[]);const p=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,b=G.faceUV||new Array(6),r=G.faceColors,y=[];for(let k=0;k<6;k++)void 0===b[k]&&(b[k]=new J.q(0,0,1,1)),r&&void 0===r[k]&&(r[k]=new R.h(1,1,1,1));for(let J=0;J<6;J++)if(d.push(b[J].z,z.b?1-b[J].w:b[J].w),d.push(b[J].x,z.b?1-b[J].w:b[J].w),d.push(b[J].x,z.b?1-b[J].y:b[J].y),d.push(b[J].z,z.b?1-b[J].y:b[J].y),r)for(let G=0;G<4;G++)y.push(r[J].r,r[J].g,r[J].b,r[J].a);k.b._ComputeSides(p,X,V,W,d,G.frontUVs,G.backUVs);const u=new k.b;if(u.indices=V,u.DG=X,u.iG=W,u.FG=d,r){const G=p===k.b.DOUBLESIDE?y.concat(y):y;u.eG=G}return u}function P(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new d.b(G,W);V.sideOrientation=d.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return X(V).vG(J,V.updatable),J}k.b.CreateBox=X,d.b.CreateBox=function(G,V){return P(G,{size:V,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12743:(G,V,W)=>{"use strict";W.d(V,{e:()=>z});var J=W(11510),R=W(11482),d=W(11552);function k(G){const V=[],W=[],J=[],k=[],z=G.radius||.5,X=G.tessellation||64,P=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,A=0===G.sideOrientation?0:G.sideOrientation||R.b.DEFAULTSIDE;V.push(0,0,0),k.push(.5,.5);const x=2*Math.PI*P,q=1===P?x/X:x/(X-1);let L=0;for(let R=0;R<X;R++){const G=Math.cos(L),W=Math.sin(L),J=(G+1)/2,R=(1-W)/2;V.push(z*G,z*W,0),k.push(J,d.b?1-R:R),L+=q}1===P&&(V.push(V[3],V[4],V[5]),k.push(k[2],d.b?1-k[3]:k[3]));const t=V.length/3;for(let R=1;R<t-1;R++)W.push(R+1,0,R);R.b.ComputeNormals(V,W,J),R.b._ComputeSides(A,V,W,J,k,G.frontUVs,G.backUVs);const Y=new R.b;return Y.indices=W,Y.DG=V,Y.iG=J,Y.FG=k,Y}function z(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new J.b(G,W);V.sideOrientation=J.b._GetDefaultSideOrientation(V.sideOrientation),R._originalBuilderSideOrientation=V.sideOrientation;return k(V).vG(R,V.updatable),R}R.b.CreateDisc=k,J.b.CreateDisc=function(G,V,W){return z(G,{radius:V,tessellation:W,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12599:(G,V,W)=>{"use strict";W.d(V,{g:()=>g,c:()=>S,i:()=>B});var J=W(11136),R=W(11424),d=W(11510),k=W(11482),z=W(11345);d.b._GroundMeshParser=(G,V)=>X.Parse(G,V);class X extends d.b{constructor(G,V){super(G,V),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=G,this._subdivisionsY=G,this.subdivide(G);const W=this;W.createOrUpdateSubmeshesOctree&&W.createOrUpdateSubmeshesOctree(V)}getHeightAtCoordinates(G,V){const W=this.getWorldMatrix(),R=J.h.Matrix[5];W.invertToRef(R);const d=J.h.ed[8];if(J.o.TransformCoordinatesFromFloatsToRef(G,0,V,R,d),G=d.x,V=d.z,G<this._minX||G>=this._maxX||V<=this._minZ||V>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const k=this._getFacetAt(G,V),z=-(k.x*G+k.z*V+k.w)/k.y;return J.o.TransformCoordinatesFromFloatsToRef(0,z,0,W,d),d.y}getNormalAtCoordinates(G,V){const W=new J.o(0,1,0);return this.getNormalAtCoordinatesToRef(G,V,W),W}getNormalAtCoordinatesToRef(G,V,W){const R=this.getWorldMatrix(),d=J.h.Matrix[5];R.invertToRef(d);const k=J.h.ed[8];if(J.o.TransformCoordinatesFromFloatsToRef(G,0,V,d,k),G=k.x,V=k.z,G<this._minX||G>this._maxX||V<this._minZ||V>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const z=this._getFacetAt(G,V);return J.o.TransformNormalFromFloatsToRef(z.x,z.y,z.z,R,W),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(G,V){const W=Math.floor((G+this._maxX)*this._subdivisionsX/this._width),J=Math.floor(-(V+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),R=this._heightQuads[J*this._subdivisionsX+W];let d;return d=V<R.slope.x*G+R.slope.y?R.facet1:R.facet2,d}_initHeightQuads(){const G=this._subdivisionsX,V=this._subdivisionsY;this._heightQuads=[];for(let W=0;W<V;W++)for(let V=0;V<G;V++){const R={slope:J.k.Zero(),facet1:new J.q(0,0,0,0),facet2:new J.q(0,0,0,0)};this._heightQuads[W*G+V]=R}return this}_computeHeightQuads(){const G=this.getVerticesData(z.c.PositionKind);if(!G)return this;const V=J.h.ed[3],W=J.h.ed[2],R=J.h.ed[1],d=J.h.ed[0],k=J.h.ed[4],X=J.h.ed[5],P=J.h.ed[6],A=J.h.ed[7],x=J.h.ed[8];let q=0,L=0,t=0,Y=0,g=0,B=0,S=0;const p=this._subdivisionsX,b=this._subdivisionsY;for(let z=0;z<b;z++)for(let b=0;b<p;b++){q=3*b,L=z*(p+1)*3,t=(z+1)*(p+1)*3,V.x=G[L+q],V.y=G[L+q+1],V.z=G[L+q+2],W.x=G[L+q+3],W.y=G[L+q+4],W.z=G[L+q+5],R.x=G[t+q],R.y=G[t+q+1],R.z=G[t+q+2],d.x=G[t+q+3],d.y=G[t+q+4],d.z=G[t+q+5],Y=(d.z-V.z)/(d.x-V.x),g=V.z-Y*V.x,W.subtractToRef(V,k),R.subtractToRef(V,X),d.subtractToRef(V,P),J.o.CrossToRef(P,X,A),J.o.CrossToRef(k,P,x),A.normalize(),x.normalize(),B=-(A.x*V.x+A.y*V.y+A.z*V.z),S=-(x.x*W.x+x.y*W.y+x.z*W.z);const r=this._heightQuads[z*p+b];r.slope.rd(Y,g),r.facet1.rd(A.x,A.y,A.z,B),r.facet2.rd(x.x,x.y,x.z,S)}return this}serialize(G){super.serialize(G),G.subdivisionsX=this._subdivisionsX,G.subdivisionsY=this._subdivisionsY,G.minX=this._minX,G.maxX=this._maxX,G.Zd=this._minZ,G.maxZ=this._maxZ,G.width=this._width,G.height=this._height}static Parse(G,V){const W=new X(G.name,V);return W._subdivisionsX=G.subdivisionsX||1,W._subdivisionsY=G.subdivisionsY||1,W._minX=G.minX,W._maxX=G.maxX,W._minZ=G.Zd,W._maxZ=G.maxZ,W._width=G.width,W._height=G.height,W}}var P=W(11189),A=W(11169),x=W(11145),q=W(11552);function L(G){const V=[],W=[],R=[],d=[];let z,X;const P=G.width||G.size||1,A=G.height||G.size||1,x=0|(G.subdivisionsX||G.subdivisions||1),L=0|(G.subdivisionsY||G.subdivisions||1);for(z=0;z<=L;z++)for(X=0;X<=x;X++){const G=new J.o(X*P/x-P/2,0,(L-z)*A/L-A/2),V=new J.o(0,1,0);W.push(G.x,G.y,G.z),R.push(V.x,V.y,V.z),d.push(X/x,q.b?z/L:1-z/L)}for(z=0;z<L;z++)for(X=0;X<x;X++)V.push(X+1+(z+1)*(x+1)),V.push(X+1+z*(x+1)),V.push(X+z*(x+1)),V.push(X+(z+1)*(x+1)),V.push(X+1+(z+1)*(x+1)),V.push(X+z*(x+1));const t=new k.b;return t.indices=V,t.DG=W,t.iG=R,t.FG=d,t}function t(G){const V=void 0!==G.xmin&&null!==G.xmin?G.xmin:-1,W=void 0!==G.zmin&&null!==G.zmin?G.zmin:-1,R=void 0!==G.xmax&&null!==G.xmax?G.xmax:1,d=void 0!==G.zmax&&null!==G.zmax?G.zmax:1,z=G.subdivisions||{w:1,h:1},X=G.precision||{w:1,h:1},P=[],A=[],x=[],q=[];let L,t,Y,g;z.h=z.h<1?1:z.h,z.w=z.w<1?1:z.w,X.w=X.w<1?1:X.w,X.h=X.h<1?1:X.h;const B=(R-V)/z.w,S=(d-W)/z.h;function p(G,V,W,R){const d=A.length/3,k=X.w+1;for(L=0;L<X.h;L++)for(t=0;t<X.w;t++){const G=[d+t+L*k,d+(t+1)+L*k,d+(t+1)+(L+1)*k,d+t+(L+1)*k];P.push(G[1]),P.push(G[2]),P.push(G[3]),P.push(G[0]),P.push(G[1]),P.push(G[3])}const z=J.o.Zero(),Y=new J.o(0,1,0);for(L=0;L<=X.h;L++)for(z.z=L*(R-V)/X.h+V,t=0;t<=X.w;t++)z.x=t*(W-G)/X.w+G,z.y=0,A.push(z.x,z.y,z.z),x.push(Y.x,Y.y,Y.z),q.push(t/X.w,L/X.h)}for(Y=0;Y<z.h;Y++)for(g=0;g<z.w;g++)p(V+g*B,W+Y*S,V+(g+1)*B,W+(Y+1)*S);const b=new k.b;return b.indices=P,b.DG=A,b.iG=x,b.FG=q,b}function Y(G){const V=[],W=[],d=[],z=[];let X,P;const A=G.colorFilter||new R.d(.3,.59,.11),q=G.alphaFilter||0;let L=!1;if(G.minHeight>G.maxHeight){L=!0;const V=G.maxHeight;G.maxHeight=G.minHeight,G.minHeight=V}for(X=0;X<=G.subdivisions;X++)for(P=0;P<=G.subdivisions;P++){const V=new J.o(P*G.width/G.subdivisions-G.width/2,0,(G.subdivisions-X)*G.height/G.subdivisions-G.height/2),R=4*(((V.x+G.width/2)/G.width*(G.bufferWidth-1)|0)+((1-(V.z+G.height/2)/G.height)*(G.bufferHeight-1)|0)*G.bufferWidth);let k=G.buffer[R]/255,t=G.buffer[R+1]/255,Y=G.buffer[R+2]/255;const g=G.buffer[R+3]/255;L&&(k=1-k,t=1-t,Y=1-Y);const B=k*A.r+t*A.g+Y*A.b;V.y=g>=q?G.minHeight+(G.maxHeight-G.minHeight)*B:G.minHeight-x.c,G.heightBuffer&&(G.heightBuffer[X*(G.subdivisions+1)+P]=V.y),W.push(V.x,V.y,V.z),d.push(0,0,0),z.push(P/G.subdivisions,1-X/G.subdivisions)}for(X=0;X<G.subdivisions;X++)for(P=0;P<G.subdivisions;P++){const J=P+1+(X+1)*(G.subdivisions+1),R=P+1+X*(G.subdivisions+1),d=P+X*(G.subdivisions+1),k=P+(X+1)*(G.subdivisions+1),z=W[3*J+1]>=G.minHeight,A=W[3*R+1]>=G.minHeight,x=W[3*d+1]>=G.minHeight;z&&A&&x&&(V.push(J),V.push(R),V.push(d));W[3*k+1]>=G.minHeight&&z&&x&&(V.push(k),V.push(J),V.push(d))}k.b.ComputeNormals(W,V,d);const t=new k.b;return t.indices=V,t.DG=W,t.iG=d,t.FG=z,t}function g(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=new X(G,arguments.length>2?arguments[2]:void 0);W._setReady(!1),W._subdivisionsX=V.subdivisionsX||V.subdivisions||1,W._subdivisionsY=V.subdivisionsY||V.subdivisions||1,W._width=V.width||1,W._height=V.height||1,W._maxX=W._width/2,W._maxZ=W._height/2,W._minX=-W._maxX,W._minZ=-W._maxZ;return L(V).vG(W,V.updatable),W._setReady(!0),W}function B(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new d.b(G,W);return t(V).vG(J,V.updatable),J}function S(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=W.width||10,k=W.height||10,z=W.subdivisions||1,x=W.minHeight||0,q=W.maxHeight||1,L=W.colorFilter||new R.d(.3,.59,.11),t=W.alphaFilter||0,g=W.updatable,B=W.onReady;J=J||A.c.LastCreatedScene;const S=new X(G,J);let p;S._subdivisionsX=z,S._subdivisionsY=z,S._width=d,S._height=k,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ,S._setReady(!1),W.passHeightBufferInCallback&&(p=new Float32Array((z+1)*(z+1)));const b=(G,V,W)=>{Y({width:d,height:k,subdivisions:z,minHeight:x,maxHeight:q,colorFilter:L,buffer:G,bufferWidth:V,bufferHeight:W,alphaFilter:t,heightBuffer:p}).vG(S,g),B&&B(S,p),S._setReady(!0)};if("string"===typeof V){const G=G=>{var V;const W=G.width,R=G.height;if(J.P)return;const d=null===(V=J)||void 0===V?void 0:V.getEngine().resizeImageBitmap(G,W,R);b(d,W,R)};P.h.LoadImage(V,G,W.onError?W.onError:()=>{},J.offlineProvider)}else b(V.data,V.width,V.height);return S}k.b.CreateGround=L,k.b.CreateTiledGround=t,k.b.CreateGroundFromHeightMap=Y,d.b.CreateGround=(G,V,W,J,R,d)=>g(G,{width:V,height:W,subdivisions:J,updatable:d},R),d.b.CreateTiledGround=(G,V,W,J,R,d,k,z,X)=>B(G,{xmin:V,zmin:W,xmax:J,zmax:R,subdivisions:d,precision:k,updatable:X},z),d.b.CreateGroundFromHeightMap=(G,V,W,J,R,d,k,z,X,P,A)=>S(G,V,{width:W,height:J,subdivisions:R,minHeight:d,maxHeight:k,updatable:X,onReady:P,alphaFilter:A},z)},13228:(G,V,W)=>{"use strict";W.d(V,{e:()=>L,i:()=>x,k:()=>q});var J=W(11136),R=W(11510),d=W(11482),k=W(11877),z=W(11345),X=W(11201);function P(G){const V=[],W=[],J=G.lines,R=G.eG,k=[];let z=0;for(let d=0;d<J.length;d++){const G=J[d];for(let J=0;J<G.length;J++){const{x:X,y:P,z:A}=G[J];if(W.push(X,P,A),R){const G=R[d],{r:V,g:W,b:z,a:X}=G[J];k.push(V,W,z,X)}J>0&&(V.push(z-1),V.push(z)),z++}}const X=new d.b;return X.indices=V,X.DG=W,R&&(X.eG=k),X}function A(G){const V=G.dashSize||3,W=G.gapSize||1,R=G.dashNb||200,k=G.points,z=[],X=[],P=J.o.Zero();let A=0,x=0,q=0,L=0,t=0,Y=0,g=0;for(g=0;g<k.length-1;g++)k[g+1].subtractToRef(k[g],P),A+=P.length();for(q=A/R,L=V*q/(V+W),g=0;g<k.length-1;g++){k[g+1].subtractToRef(k[g],P),x=Math.floor(P.length()/q),P.normalize();for(let G=0;G<x;G++)t=q*G,z.push(k[g].x+t*P.x,k[g].y+t*P.y,k[g].z+t*P.z),z.push(k[g].x+(t+L)*P.x,k[g].y+(t+L)*P.y,k[g].z+(t+L)*P.z),X.push(Y,Y+1),Y+=2}const B=new d.b;return B.DG=z,B.indices=X,B}function x(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=V.instance,R=V.lines,d=V.eG;if(J){const G=J.getVerticesData(z.c.PositionKind);let V,W;d&&(V=J.getVerticesData(z.c.ColorKind));let k=0,X=0;for(let J=0;J<R.length;J++){const z=R[J];for(let R=0;R<z.length;R++)G[k]=z[R].x,G[k+1]=z[R].y,G[k+2]=z[R].z,d&&V&&(W=d[J],V[X]=W[R].r,V[X+1]=W[R].g,V[X+2]=W[R].b,V[X+3]=W[R].a,X+=4),k+=3}return J.updateVerticesData(z.c.PositionKind,G,!1,!1),d&&V&&J.updateVerticesData(z.c.ColorKind,V,!1,!1),J.refreshBoundingInfo(),J}const X=!!d,A=new k.e(G,W,null,void 0,void 0,X,V.useVertexAlpha,V.material);return P(V).vG(A,V.updatable),A}function q(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=V.eG?[V.eG]:null;return x(G,{lines:[V.points],updatable:V.updatable,instance:V.instance,eG:J,useVertexAlpha:V.useVertexAlpha,material:V.material},W)}function L(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=V.points,z=V.instance,P=V.gapSize||1,x=V.dashSize||3;if(z){const G=G=>{const V=J.o.Zero(),W=G.length/6;let R=0,k=0,X=0,P=0,A=0,x=0,q=0,L=0;for(q=0;q<d.length-1;q++)d[q+1].subtractToRef(d[q],V),R+=V.length();X=R/W;const t=z._creationDataStorage.dashSize;for(P=t*X/(t+z._creationDataStorage.gapSize),q=0;q<d.length-1;q++)for(d[q+1].subtractToRef(d[q],V),k=Math.floor(V.length()/X),V.normalize(),L=0;L<k&&x<G.length;)A=X*L,G[x]=d[q].x+A*V.x,G[x+1]=d[q].y+A*V.y,G[x+2]=d[q].z+A*V.z,G[x+3]=d[q].x+(A+P)*V.x,G[x+4]=d[q].y+(A+P)*V.y,G[x+5]=d[q].z+(A+P)*V.z,x+=6,L++;for(;x<G.length;)G[x]=d[q].x,G[x+1]=d[q].y,G[x+2]=d[q].z,x+=3};return(V.dashNb||V.dashSize||V.gapSize||V.useVertexAlpha||V.material)&&X.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),z.updateMeshPositions(G,!1),z}const q=new k.e(G,W,null,void 0,void 0,void 0,V.useVertexAlpha,V.material);return A(V).vG(q,V.updatable),q._creationDataStorage=new R.d,q._creationDataStorage.dashSize=x,q._creationDataStorage.gapSize=P,q}d.b.CreateLineSystem=P,d.b.CreateDashedLines=A,R.b.IX=function(G,V){return q(G,{points:V,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},R.b.CreateDashedLines=function(G,V,W,J,R){return L(G,{points:V,dashSize:W,gapSize:J,dashNb:R,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12646:(G,V,W)=>{"use strict";W.d(V,{d:()=>z,f:()=>X});var J=W(11510),R=W(11482),d=W(11552);function k(G){const V=[],W=[],J=[],k=[],z=void 0!==G.width?G.width:void 0!==G.size?G.size:1,X=void 0!==G.height?G.height:void 0!==G.size?G.size:1,P=0===G.sideOrientation?0:G.sideOrientation||R.b.DEFAULTSIDE,A=z/2,x=X/2;W.push(-A,-x,0),J.push(0,0,-1),k.push(0,d.b?1:0),W.push(A,-x,0),J.push(0,0,-1),k.push(1,d.b?1:0),W.push(A,x,0),J.push(0,0,-1),k.push(1,d.b?0:1),W.push(-A,x,0),J.push(0,0,-1),k.push(0,d.b?0:1),V.push(0),V.push(1),V.push(2),V.push(0),V.push(2),V.push(3),R.b._ComputeSides(P,W,V,J,k,G.frontUVs,G.backUVs);const q=new R.b;return q.indices=V,q.DG=W,q.iG=J,q.FG=k,q}function z(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new J.b(G,W);V.sideOrientation=J.b._GetDefaultSideOrientation(V.sideOrientation),R._originalBuilderSideOrientation=V.sideOrientation;return k(V).vG(R,V.updatable),V.sourcePlane&&(R.translate(V.sourcePlane.IV,-V.sourcePlane.d),R.setDirection(V.sourcePlane.IV.scale(-1))),R}const X={GP:z};R.b.GP=k,J.b.GP=(G,V,W,J,R)=>z(G,{size:V,width:V,height:V,sideOrientation:R,updatable:J},W)},12728:(G,V,W)=>{"use strict";W.d(V,{d:()=>X});var J=W(11136),R=W(11510),d=W(11482),k=W(11552);function z(G){const V=0|(G.segments||32),W=G.diameterX||G.diameter||1,R=G.diameterY||G.diameter||1,z=G.diameterZ||G.diameter||1,X=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,P=G.slice&&G.slice<=0?1:G.slice||1,A=0===G.sideOrientation?0:G.sideOrientation||d.b.DEFAULTSIDE,x=!!G.dedupTopBottomIndices,q=new J.o(W/2,R/2,z/2),L=2+V,t=2*L,Y=[],g=[],B=[],S=[];for(let d=0;d<=L;d++){const G=d/L,V=G*Math.PI*P;for(let W=0;W<=t;W++){const R=W/t,d=R*Math.PI*2*X,z=J.c.RotationZ(-V),P=J.c.RotationY(d),A=J.o.TransformCoordinates(J.o.Up(),z),x=J.o.TransformCoordinates(A,P),L=x.multiply(q),Y=x.divide(q).normalize();g.push(L.x,L.y,L.z),B.push(Y.x,Y.y,Y.z),S.push(R,k.b?1-G:G)}if(d>0){const G=g.length/3;for(let V=G-2*(t+1);V+t+2<G;V++)x?(d>1&&(Y.push(V),Y.push(V+1),Y.push(V+t+1)),(d<L||P<1)&&(Y.push(V+t+1),Y.push(V+1),Y.push(V+t+2))):(Y.push(V),Y.push(V+1),Y.push(V+t+1),Y.push(V+t+1),Y.push(V+1),Y.push(V+t+2))}}d.b._ComputeSides(A,g,Y,B,S,G.frontUVs,G.backUVs);const p=new d.b;return p.indices=Y,p.DG=g,p.iG=B,p.FG=S,p}function X(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return z(V).vG(J,V.updatable),J}d.b.CreateSphere=z,R.b.CreateSphere=(G,V,W,J,R,d)=>X(G,{segments:V,diameterX:W,diameterY:W,diameterZ:W,sideOrientation:d,updatable:R},J)},13525:(G,V,W)=>{"use strict";W.d(V,{b:()=>z});var J=W(11908),R=W(13042),d=W(11929),k=W(11482);class z{static get Configuration(){return{get decoder(){return R.b.DefaultConfiguration},set decoder(G){R.b.DefaultConfiguration=G}}}static set Configuration(G){R.b.DefaultConfiguration=G.decoder}static get DecoderAvailable(){return(0,J.i)(R.b.DefaultConfiguration)}static get Default(){return z._Default??(z._Default=new z),z._Default}static ResetDefault(G){z._Default&&(G||z._Default.dispose(),z._Default=null)}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.DefaultNumWorkers;const V="number"===typeof G?{...R.b.DefaultConfiguration,numWorkers:G}:{...R.b.DefaultConfiguration,...G};this._decoder=new R.b(V)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(G,V,W){return this._decoder.decodeMeshToMeshDataAsync(G,V,W)}async decodeMeshToGeometryAsync(G,V,W,J){return await this._decoder.decodeMeshToGeometryAsync(G,V,W,J)}async _decodeMeshToGeometryForGltfAsync(G,V,W,J,R,d){return await this._decoder._decodeMeshToGeometryForGltfAsync(G,V,W,J,R,d)}async decodeMeshAsync(G,V){const W=await this._decoder.decodeMeshToMeshDataAsync(G,V),J=new k.b;W.indices&&(J.indices=W.indices);for(const R of W.attributes){const G=d.d.GetFloatData(R.data,R.size,d.d.GetDataType(R.data),R.byteOffset,R.byteStride,R.normalized,W.totalVertices);J.set(G,R.kind)}return J}}z.DefaultNumWorkers=(0,J.e)(),z._Default=null},13042:(G,V,W)=>{"use strict";W.d(V,{b:()=>P});var J=W(11908),R=W(11189),d=W(11538),k=W(11929),z=W(11201),X=W(11920);class P extends J.b{static get DefaultAvailable(){return(0,J.i)(P.DefaultConfiguration)}static get Default(){return P._Default??(P._Default=new P),P._Default}static ResetDefault(G){P._Default&&(G||P._Default.dispose(),P._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(G,V){return{module:await(V||DracoDecoderModule)({wasmBinary:G})}}_getWorkerContent(){return`${X.c}(${X.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.DefaultConfiguration)}decodeMeshToMeshDataAsync(G,V,W){const J=G instanceof ArrayBuffer?new Int8Array(G):new Int8Array(G.buffer,G.byteOffset,G.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async G=>await new Promise(((R,d)=>{G.push(((G,k)=>{let X=null;const P=[],A=V=>{G.removeEventListener("error",A),G.removeEventListener("message",x),d(V),k()},x=V=>{const J=V.data;switch(J.id){case"indices":X=J.data;break;case"attribute":P.push({kind:J.kind,data:J.data,size:J.size,byteOffset:J.byteOffset,byteStride:J.byteStride,normalized:(d=J.kind,q=J.normalized,W&&void 0!==W[d]?(q!==W[d]&&z.c.Warn(`Normalized flag from Draco data (${q}) does not match normalized flag from glTF accessor (${W[d]}). Using flag from glTF accessor.`),W[d]):q)});break;case"decodeMeshDone":G.removeEventListener("error",A),G.removeEventListener("message",x),R({indices:X,attributes:P,totalVertices:J.totalVertices}),k()}var d,q};G.addEventListener("error",A),G.addEventListener("message",x);const q=J.slice();G.postMessage({id:"decodeMesh",dataView:q,attributes:V},[q.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((G=>{let W=null;const R=[],d=(0,X.c)(G.module,J,V,(G=>{W=G}),((G,V,W,J,d,k)=>{R.push({kind:G,data:V,size:W,byteOffset:J,byteStride:d,normalized:k})}));return{indices:W,attributes:R,totalVertices:d}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(G,V,W,J){const R=await this.decodeMeshToMeshDataAsync(W,J),z=new d.d(G,V);R.indices&&z.setIndices(R.indices);for(const d of R.attributes)z.setVerticesBuffer(new k.d(V.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),R.totalVertices);return z}async _decodeMeshToGeometryForGltfAsync(G,V,W,J,R,z){const X=await this.decodeMeshToMeshDataAsync(W,J,R),P=new d.d(G,V);z&&(P._boundingInfo=z,P.useBoundingInfoFromGeometry=!0),X.indices&&P.setIndices(X.indices);for(const d of X.attributes)P.setVerticesBuffer(new k.d(V.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),X.totalVertices);return P}}P.DefaultConfiguration={wasmUrl:`${R.h._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${R.h._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${R.h._DefaultCdnUrl}/draco_decoder_gltf.js`},P._Default=null},13225:(G,V,W)=>{"use strict";W.d(V,{b:()=>zG});var J=W(11136),R=W(11510),d=W(11345),k=W(11482),z=W(11552);function X(G){let V=G.pathArray;const W=G.closeArray||!1,J=G.closePath||!1,R=G.invertUV||!1,X=Math.floor(V[0].length/2);let P=G.offset||X;P=P>X?X:Math.floor(P);const A=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,x=G.FG,q=G.eG,L=[],t=[],Y=[],g=[],B=[],S=[],p=[],b=[];let r;const y=[],u=[];let H,n,D;if(V.length<2){const G=[],W=[];for(n=0;n<V[0].length-P;n++)G.push(V[0][n]),W.push(V[0][n+P]);V=[G,W]}let i=0;const e=J?1:0,F=W?1:0;let f,v,C,l,m,w;for(r=V[0].length,H=0;H<V.length+F;H++){for(p[H]=0,B[H]=[0],f=H===V.length?V[0]:V[H],v=f.length,r=r<v?r:v,D=0;D<v;)L.push(f[D].x,f[D].y,f[D].z),D>0&&(C=f[D].zW(f[D-1]).length(),l=C+p[H],B[H].push(l),p[H]=l),D++;J&&(D--,L.push(f[0].x,f[0].y,f[0].z),C=f[D].zW(f[0]).length(),l=C+p[H],B[H].push(l),p[H]=l),y[H]=v+e,u[H]=i,i+=v+e}let N,U,a=null,M=null;for(n=0;n<r+e;n++)for(b[n]=0,S[n]=[0],H=0;H<V.length-1+F;H++)m=V[H],w=H===V.length-1?V[0]:V[H+1],n===r?(a=m[0],M=w[0]):(a=m[n],M=w[n]),C=M.zW(a).length(),l=C+b[n],S[n].push(l),b[n]=l;if(x)for(H=0;H<x.length;H++)g.push(x[H].x,z.b?1-x[H].y:x[H].y);else for(H=0;H<V.length+F;H++)for(n=0;n<r+e;n++)N=0!=p[H]?B[H][n]/p[H]:0,U=0!=b[n]?S[n][H]/b[n]:0,R?g.push(U,N):g.push(N,z.b?1-U:U);H=0;let T=0,K=y[H]-1,s=y[H+1]-1,Q=K<s?K:s,Z=u[1]-u[0];const E=y.length-1;for(;T<=Q&&H<E;)t.push(T,T+Z,T+1),t.push(T+Z+1,T+1,T+Z),T+=1,T===Q&&(H++,Z=u[H+1]-u[H],K=y[H]-1,s=y[H+1]-1,T=u[H],Q=K<s?K+T:s+T);if(k.b.ComputeNormals(L,t,Y),J){let G=0,W=0;for(H=0;H<V.length;H++){G=3*u[H],W=H+1<V.length?3*(u[H+1]-1):Y.length-3,Y[G]=.5*(Y[G]+Y[W]),Y[G+1]=.5*(Y[G+1]+Y[W+1]),Y[G+2]=.5*(Y[G+2]+Y[W+2]);const J=Math.sqrt(Y[G]*Y[G]+Y[G+1]*Y[G+1]+Y[G+2]*Y[G+2]);Y[G]/=J,Y[G+1]/=J,Y[G+2]/=J,Y[W]=Y[G],Y[W+1]=Y[G+1],Y[W+2]=Y[G+2]}}if(W){let G=3*u[0],W=3*u[V.length];for(n=0;n<r+e;n++){Y[G]=.5*(Y[G]+Y[W]),Y[G+1]=.5*(Y[G+1]+Y[W+1]),Y[G+2]=.5*(Y[G+2]+Y[W+2]);const V=Math.sqrt(Y[G]*Y[G]+Y[G+1]*Y[G+1]+Y[G+2]*Y[G+2]);Y[G]/=V,Y[G+1]/=V,Y[G+2]/=V,Y[W]=Y[G],Y[W+1]=Y[G+1],Y[W+2]=Y[G+2],G+=3,W+=3}}k.b._ComputeSides(A,L,t,Y,g,G.frontUVs,G.backUVs);let h=null;if(q){h=new Float32Array(4*q.length);for(let G=0;G<q.length;G++)h[4*G]=q[G].r,h[4*G+1]=q[G].g,h[4*G+2]=q[G].b,h[4*G+3]=q[G].a}const o=new k.b,c=new Float32Array(L),j=new Float32Array(Y),I=new Float32Array(g);return o.indices=t,o.DG=c,o.iG=j,o.FG=I,h&&o.set(h,d.c.ColorKind),J&&(o._idx=u),o}function P(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=V.pathArray,A=V.closeArray,x=V.closePath,q=R.b._GetDefaultSideOrientation(V.sideOrientation),L=V.instance,t=V.updatable;if(L){const G=J.h.ed[0].Ud(Number.MAX_VALUE),W=J.h.ed[1].Ud(-Number.MAX_VALUE),X=V=>{let J=P[0].length;const d=L;let k=0;const z=d._originalBuilderSideOrientation===R.b.DOUBLESIDE?2:1;for(let R=1;R<=z;++R)for(let z=0;z<P.length;++z){const R=P[z],X=R.length;J=J<X?J:X;for(let d=0;d<J;++d){const J=R[d];V[k]=J.x,V[k+1]=J.y,V[k+2]=J.z,G.minimizeInPlaceFromFloats(J.x,J.y,J.z),W.maximizeInPlaceFromFloats(J.x,J.y,J.z),k+=3}if(d._creationDataStorage&&d._creationDataStorage.closePath){const G=R[0];V[k]=G.x,V[k+1]=G.y,V[k+2]=G.z,k+=3}}},A=L.getVerticesData(d.c.PositionKind);if(X(A),L.hasBoundingInfo?L.getBoundingInfo().reConstruct(G,W,L._worldMatrix):L.buildBoundingInfo(G,W,L._worldMatrix),L.updateVerticesData(d.c.PositionKind,A,!1,!1),V.eG){const G=L.getVerticesData(d.c.ColorKind);for(let W=0,J=0;W<V.eG.length;W++,J+=4){const R=V.eG[W];G[J]=R.r,G[J+1]=R.g,G[J+2]=R.b,G[J+3]=R.a}L.updateVerticesData(d.c.ColorKind,G,!1,!1)}if(V.FG){const G=L.getVerticesData(d.c.UVKind);for(let W=0;W<V.FG.length;W++)G[2*W]=V.FG[W].x,G[2*W+1]=z.b?1-V.FG[W].y:V.FG[W].y;L.updateVerticesData(d.c.UVKind,G,!1,!1)}if(!L.areNormalsFrozen||L.isFacetDataEnabled){const G=L.Pd(),V=L.getVerticesData(d.c.NormalKind),W=L.isFacetDataEnabled?L.getFacetDataParameters():null;if(k.b.ComputeNormals(A,G,V,W),L._creationDataStorage&&L._creationDataStorage.closePath){let G=0,W=0;for(let J=0;J<P.length;J++)G=3*L._creationDataStorage.idx[J],W=J+1<P.length?3*(L._creationDataStorage.idx[J+1]-1):V.length-3,V[G]=.5*(V[G]+V[W]),V[G+1]=.5*(V[G+1]+V[W+1]),V[G+2]=.5*(V[G+2]+V[W+2]),V[W]=V[G],V[W+1]=V[G+1],V[W+2]=V[G+2]}L.areNormalsFrozen||L.updateVerticesData(d.c.NormalKind,V,!1,!1)}return L}{const J=new R.b(G,W);J._originalBuilderSideOrientation=q,J._creationDataStorage=new R.d;const d=X(V);return x&&(J._creationDataStorage.idx=d._idx),J._creationDataStorage.closePath=x,J._creationDataStorage.closeArray=A,d.vG(J,t),J}}k.b.CreateRibbon=X,R.b.CreateRibbon=function(G,V){return P(G,{pathArray:V,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var A=W(12743),x=W(12591),q=W(11424);function L(G){const V=G.pattern||R.b.NO_FLIP,W=G.tileWidth||G.tileSize||1,J=G.tileHeight||G.tileSize||1,d=G.alignHorizontal||0,z=G.alignVertical||0,X=G.width||G.size||1,P=Math.floor(X/W);let A=X-P*W;const x=G.height||G.size||1,q=Math.floor(x/J);let L=x-q*J;const t=W*P/2,Y=J*q/2;let g=0,B=0,S=0,p=0,b=0,r=0;if(A>0||L>0){switch(S=-t,p=-Y,b=t,r=Y,d){case R.b.CENTER:A/=2,S-=A,b+=A;break;case R.b.LEFT:b+=A,g=-A/2;break;case R.b.RIGHT:S-=A,g=A/2}switch(z){case R.b.CENTER:L/=2,p-=L,r+=L;break;case R.b.BOTTOM:r+=L,B=-L/2;break;case R.b.TOP:p-=L,B=L/2}}const y=[],u=[],H=[];H[0]=[0,0,1,0,1,1,0,1],H[1]=[0,0,1,0,1,1,0,1],V!==R.b.ROTATE_TILE&&V!==R.b.ROTATE_ROW||(H[1]=[1,1,0,1,0,0,1,0]),V!==R.b.FLIP_TILE&&V!==R.b.FLIP_ROW||(H[1]=[1,0,0,0,0,1,1,1]),V!==R.b.FLIP_N_ROTATE_TILE&&V!==R.b.FLIP_N_ROTATE_ROW||(H[1]=[0,1,1,1,1,0,0,0]);let n=[];const D=[],i=[];let e=0;for(let k=0;k<q;k++)for(let G=0;G<P;G++)y.push(G*W-t+g,k*J-Y+B,0),y.push((G+1)*W-t+g,k*J-Y+B,0),y.push((G+1)*W-t+g,(k+1)*J-Y+B,0),y.push(G*W-t+g,(k+1)*J-Y+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),n=V===R.b.FLIP_TILE||V===R.b.ROTATE_TILE||V===R.b.FLIP_N_ROTATE_TILE?n.concat(H[(G%2+k%2)%2]):V===R.b.FLIP_ROW||V===R.b.ROTATE_ROW||V===R.b.FLIP_N_ROTATE_ROW?n.concat(H[k%2]):n.concat(H[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),e+=4;if(A>0||L>0){const G=L>0&&(z===R.b.CENTER||z===R.b.TOP),k=L>0&&(z===R.b.CENTER||z===R.b.BOTTOM),X=A>0&&(d===R.b.CENTER||d===R.b.RIGHT),x=A>0&&(d===R.b.CENTER||d===R.b.LEFT);let H,F,f,v,C=[];if(G&&X&&(y.push(S+g,p+B,0),y.push(-t+g,p+B,0),y.push(-t+g,p+L+B,0),y.push(S+g,p+L+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,H=1-A/W,F=1-L/J,f=1,v=1,C=[H,F,f,F,f,v,H,v],V===R.b.ROTATE_ROW&&(C=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),V===R.b.FLIP_ROW&&(C=[1-H,F,1-f,F,1-f,v,1-H,v]),V===R.b.FLIP_N_ROTATE_ROW&&(C=[H,1-F,f,1-F,f,1-v,H,1-v]),n=n.concat(C),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&x&&(y.push(t+g,p+B,0),y.push(b+g,p+B,0),y.push(b+g,p+L+B,0),y.push(t+g,p+L+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,H=0,F=1-L/J,f=A/W,v=1,C=[H,F,f,F,f,v,H,v],(V===R.b.ROTATE_ROW||V===R.b.ROTATE_TILE&&P%2===0)&&(C=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),(V===R.b.FLIP_ROW||V===R.b.FLIP_TILE&&P%2===0)&&(C=[1-H,F,1-f,F,1-f,v,1-H,v]),(V===R.b.FLIP_N_ROTATE_ROW||V===R.b.FLIP_N_ROTATE_TILE&&P%2===0)&&(C=[H,1-F,f,1-F,f,1-v,H,1-v]),n=n.concat(C),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&X&&(y.push(S+g,Y+B,0),y.push(-t+g,Y+B,0),y.push(-t+g,r+B,0),y.push(S+g,r+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,H=1-A/W,F=0,f=1,v=L/J,C=[H,F,f,F,f,v,H,v],(V===R.b.ROTATE_ROW&&q%2===1||V===R.b.ROTATE_TILE&&q%1===0)&&(C=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),(V===R.b.FLIP_ROW&&q%2===1||V===R.b.FLIP_TILE&&q%2===0)&&(C=[1-H,F,1-f,F,1-f,v,1-H,v]),(V===R.b.FLIP_N_ROTATE_ROW&&q%2===1||V===R.b.FLIP_N_ROTATE_TILE&&q%2===0)&&(C=[H,1-F,f,1-F,f,1-v,H,1-v]),n=n.concat(C),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&x&&(y.push(t+g,Y+B,0),y.push(b+g,Y+B,0),y.push(b+g,r+B,0),y.push(t+g,r+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,H=0,F=0,f=A/W,v=L/J,C=[H,F,f,F,f,v,H,v],(V===R.b.ROTATE_ROW&&q%2===1||V===R.b.ROTATE_TILE&&(q+P)%2===1)&&(C=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),(V===R.b.FLIP_ROW&&q%2===1||V===R.b.FLIP_TILE&&(q+P)%2===1)&&(C=[1-H,F,1-f,F,1-f,v,1-H,v]),(V===R.b.FLIP_N_ROTATE_ROW&&q%2===1||V===R.b.FLIP_N_ROTATE_TILE&&(q+P)%2===1)&&(C=[H,1-F,f,1-F,f,1-v,H,1-v]),n=n.concat(C),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G){const G=[];H=0,F=1-L/J,f=1,v=1,G[0]=[H,F,f,F,f,v,H,v],G[1]=[H,F,f,F,f,v,H,v],V!==R.b.ROTATE_TILE&&V!==R.b.ROTATE_ROW||(G[1]=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),V!==R.b.FLIP_TILE&&V!==R.b.FLIP_ROW||(G[1]=[1-H,F,1-f,F,1-f,v,1-H,v]),V!==R.b.FLIP_N_ROTATE_TILE&&V!==R.b.FLIP_N_ROTATE_ROW||(G[1]=[H,1-F,f,1-F,f,1-v,H,1-v]);for(let J=0;J<P;J++)y.push(J*W-t+g,p+B,0),y.push((J+1)*W-t+g,p+B,0),y.push((J+1)*W-t+g,p+L+B,0),y.push(J*W-t+g,p+L+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,n=V===R.b.FLIP_TILE||V===R.b.ROTATE_TILE||V===R.b.FLIP_N_ROTATE_TILE?n.concat(G[(J+1)%2]):V===R.b.FLIP_ROW||V===R.b.ROTATE_ROW||V===R.b.FLIP_N_ROTATE_ROW?n.concat(G[1]):n.concat(G[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const G=[];H=0,F=0,f=1,v=L/J,G[0]=[H,F,f,F,f,v,H,v],G[1]=[H,F,f,F,f,v,H,v],V!==R.b.ROTATE_TILE&&V!==R.b.ROTATE_ROW||(G[1]=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),V!==R.b.FLIP_TILE&&V!==R.b.FLIP_ROW||(G[1]=[1-H,F,1-f,F,1-f,v,1-H,v]),V!==R.b.FLIP_N_ROTATE_TILE&&V!==R.b.FLIP_N_ROTATE_ROW||(G[1]=[H,1-F,f,1-F,f,1-v,H,1-v]);for(let J=0;J<P;J++)y.push(J*W-t+g,r-L+B,0),y.push((J+1)*W-t+g,r-L+B,0),y.push((J+1)*W-t+g,r+B,0),y.push(J*W-t+g,r+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,n=V===R.b.FLIP_TILE||V===R.b.ROTATE_TILE||V===R.b.FLIP_N_ROTATE_TILE?n.concat(G[(J+q)%2]):V===R.b.FLIP_ROW||V===R.b.ROTATE_ROW||V===R.b.FLIP_N_ROTATE_ROW?n.concat(G[q%2]):n.concat(G[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const G=[];H=1-A/W,F=0,f=1,v=1,G[0]=[H,F,f,F,f,v,H,v],G[1]=[H,F,f,F,f,v,H,v],V!==R.b.ROTATE_TILE&&V!==R.b.ROTATE_ROW||(G[1]=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),V!==R.b.FLIP_TILE&&V!==R.b.FLIP_ROW||(G[1]=[1-H,F,1-f,F,1-f,v,1-H,v]),V!==R.b.FLIP_N_ROTATE_TILE&&V!==R.b.FLIP_N_ROTATE_ROW||(G[1]=[H,1-F,f,1-F,f,1-v,H,1-v]);for(let W=0;W<q;W++)y.push(S+g,W*J-Y+B,0),y.push(S+A+g,W*J-Y+B,0),y.push(S+A+g,(W+1)*J-Y+B,0),y.push(S+g,(W+1)*J-Y+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,n=V===R.b.FLIP_TILE||V===R.b.ROTATE_TILE||V===R.b.FLIP_N_ROTATE_TILE?n.concat(G[(W+1)%2]):V===R.b.FLIP_ROW||V===R.b.ROTATE_ROW||V===R.b.FLIP_N_ROTATE_ROW?n.concat(G[W%2]):n.concat(G[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const G=[];H=0,F=0,f=A/J,v=1,G[0]=[H,F,f,F,f,v,H,v],G[1]=[H,F,f,F,f,v,H,v],V!==R.b.ROTATE_TILE&&V!==R.b.ROTATE_ROW||(G[1]=[1-H,1-F,1-f,1-F,1-f,1-v,1-H,1-v]),V!==R.b.FLIP_TILE&&V!==R.b.FLIP_ROW||(G[1]=[1-H,F,1-f,F,1-f,v,1-H,v]),V!==R.b.FLIP_N_ROTATE_TILE&&V!==R.b.FLIP_N_ROTATE_ROW||(G[1]=[H,1-F,f,1-F,f,1-v,H,1-v]);for(let W=0;W<q;W++)y.push(b-A+g,W*J-Y+B,0),y.push(b+g,W*J-Y+B,0),y.push(b+g,(W+1)*J-Y+B,0),y.push(b-A+g,(W+1)*J-Y+B,0),i.push(e,e+1,e+3,e+1,e+2,e+3),e+=4,n=V===R.b.FLIP_TILE||V===R.b.ROTATE_TILE||V===R.b.FLIP_N_ROTATE_TILE?n.concat(G[(W+P)%2]):V===R.b.FLIP_ROW||V===R.b.ROTATE_ROW||V===R.b.FLIP_N_ROTATE_ROW?n.concat(G[W%2]):n.concat(G[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const F=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE;k.b._ComputeSides(F,y,i,u,n,G.frontUVs,G.backUVs);const f=new k.b;f.indices=i,f.DG=y,f.iG=u,f.FG=n;const v=F===k.b.DOUBLESIDE?D.concat(D):D;return f.eG=v,f}function t(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return L(V).vG(J,V.updatable),J}function Y(G){const V=G.faceUV||new Array(6),W=G.faceColors,d=G.pattern||R.b.NO_FLIP,X=G.width||G.size||1,P=G.height||G.size||1,A=G.depth||G.size||1,x=G.tileWidth||G.tileSize||1,t=G.tileHeight||G.tileSize||1,Y=G.alignHorizontal||0,g=G.alignVertical||0,B=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE;for(let R=0;R<6;R++)void 0===V[R]&&(V[R]=new J.q(0,0,1,1)),W&&void 0===W[R]&&(W[R]=new q.h(1,1,1,1));const S=X/2,p=P/2,b=A/2,r=[];for(let J=0;J<2;J++)r[J]=L({pattern:d,tileWidth:x,tileHeight:t,width:X,height:P,alignVertical:g,alignHorizontal:Y,sideOrientation:B});for(let J=2;J<4;J++)r[J]=L({pattern:d,tileWidth:x,tileHeight:t,width:A,height:P,alignVertical:g,alignHorizontal:Y,sideOrientation:B});let y=g;g===R.b.BOTTOM?y=R.b.TOP:g===R.b.TOP&&(y=R.b.BOTTOM);for(let J=4;J<6;J++)r[J]=L({pattern:d,tileWidth:x,tileHeight:t,width:X,height:A,alignVertical:y,alignHorizontal:Y,sideOrientation:B});let u=[],H=[],n=[],D=[];const i=[],e=[],F=[],f=[];let v=0,C=0;for(let R=0;R<6;R++){const G=r[R].DG.length;e[R]=[],F[R]=[];for(let V=0;V<G/3;V++)e[R].push(new J.o(r[R].DG[3*V],r[R].DG[3*V+1],r[R].DG[3*V+2])),F[R].push(new J.o(r[R].iG[3*V],r[R].iG[3*V+1],r[R].iG[3*V+2]));v=r[R].FG.length,f[R]=[];for(let W=0;W<v;W+=2)f[R][W]=V[R].x+(V[R].z-V[R].x)*r[R].FG[W],f[R][W+1]=V[R].y+(V[R].w-V[R].y)*r[R].FG[W+1],z.b&&(f[R][W+1]=1-f[R][W+1]);if(n=n.concat(f[R]),D=D.concat(r[R].indices.map((G=>G+C))),C+=e[R].length,W)for(let V=0;V<4;V++)i.push(W[R].r,W[R].g,W[R].b,W[R].a)}const l=new J.o(0,0,b),m=J.c.RotationY(Math.PI);u=e[0].map((G=>J.o.TransformNormal(G,m).add(l))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[]),H=F[0].map((G=>J.o.TransformNormal(G,m))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[]),u=u.concat(e[1].map((G=>G.zW(l))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[])),H=H.concat(F[1].map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[]));const w=new J.o(S,0,0),N=J.c.RotationY(-Math.PI/2);u=u.concat(e[2].map((G=>J.o.TransformNormal(G,N).add(w))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[])),H=H.concat(F[2].map((G=>J.o.TransformNormal(G,N))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[]));const U=J.c.RotationY(Math.PI/2);u=u.concat(e[3].map((G=>J.o.TransformNormal(G,U).zW(w))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[])),H=H.concat(F[3].map((G=>J.o.TransformNormal(G,U))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[]));const a=new J.o(0,p,0),M=J.c.RotationX(Math.PI/2);u=u.concat(e[4].map((G=>J.o.TransformNormal(G,M).add(a))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[])),H=H.concat(F[4].map((G=>J.o.TransformNormal(G,M))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[]));const T=J.c.RotationX(-Math.PI/2);u=u.concat(e[5].map((G=>J.o.TransformNormal(G,T).zW(a))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[])),H=H.concat(F[5].map((G=>J.o.TransformNormal(G,T))).map((G=>[G.x,G.y,G.z])).reduce(((G,V)=>G.concat(V)),[])),k.b._ComputeSides(B,u,D,H,n);const K=new k.b;if(K.indices=D,K.DG=u,K.iG=H,K.FG=n,W){const G=B===k.b.DOUBLESIDE?i.concat(i):i;K.eG=G}return K}function g(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return Y(V).vG(J,V.updatable),J}k.b.CreateTiledPlane=L;k.b.CreateTiledBox=Y;var B=W(12728),S=W(11737),p=W(11496);function b(G){const V=G.height||2;let W=0===G.diameterTop?0:G.diameterTop||G.diameter||1,d=0===G.diameterBottom?0:G.diameterBottom||G.diameter||1;W=W||1e-5,d=d||1e-5;const X=0|(G.tessellation||24),P=0|(G.subdivisions||1),A=!!G.hasRings,x=!!G.enclose,L=0===G.cap?0:G.cap||R.b.CAP_ALL,t=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,Y=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,g=G.faceUV||new Array(3),B=G.faceColors,S=2+(1+(1!==t&&x?2:0))*(A?P:1);let b;for(b=0;b<S;b++)B&&void 0===B[b]&&(B[b]=new q.h(1,1,1,1));for(b=0;b<S;b++)g&&void 0===g[b]&&(g[b]=new J.q(0,0,1,1));const r=[],y=[],u=[],H=[],n=[],D=2*Math.PI*t/X;let i,e,F;const f=(d-W)/2/V,v=J.o.Zero(),C=J.o.Zero(),l=J.o.Zero(),m=J.o.Zero(),w=J.o.Zero(),N=p.e.Y;let U,a,M,T=1,K=1,s=0,Q=0;for(U=0;U<=P;U++)for(e=U/P,F=(e*(W-d)+d)/2,T=A&&0!==U&&U!==P?2:1,M=0;M<T;M++){for(A&&(K+=M),x&&(K+=2*M),a=0;a<=X;a++)i=a*D,v.x=Math.cos(-i)*F,v.y=-V/2+e*V,v.z=Math.sin(-i)*F,0===W&&U===P?(C.x=u[u.length-3*(X+1)],C.y=u[u.length-3*(X+1)+1],C.z=u[u.length-3*(X+1)+2]):(C.x=v.x,C.z=v.z,C.y=Math.sqrt(C.x*C.x+C.z*C.z)*f,C.normalize()),0===a&&(l.J(v),m.J(C)),y.push(v.x,v.y,v.z),u.push(C.x,C.y,C.z),Q=A?s!==K?g[K].y:g[K].w:g[K].y+(g[K].w-g[K].y)*e,H.push(g[K].x+(g[K].z-g[K].x)*a/X,z.b?1-Q:Q),B&&n.push(B[K].r,B[K].g,B[K].b,B[K].a);1!==t&&x&&(y.push(v.x,v.y,v.z),y.push(0,v.y,0),y.push(0,v.y,0),y.push(l.x,l.y,l.z),J.o.CrossToRef(N,C,w),w.normalize(),u.push(w.x,w.y,w.z,w.x,w.y,w.z),J.o.CrossToRef(m,N,w),w.normalize(),u.push(w.x,w.y,w.z,w.x,w.y,w.z),Q=A?s!==K?g[K+1].y:g[K+1].w:g[K+1].y+(g[K+1].w-g[K+1].y)*e,H.push(g[K+1].x,z.b?1-Q:Q),H.push(g[K+1].z,z.b?1-Q:Q),Q=A?s!==K?g[K+2].y:g[K+2].w:g[K+2].y+(g[K+2].w-g[K+2].y)*e,H.push(g[K+2].x,z.b?1-Q:Q),H.push(g[K+2].z,z.b?1-Q:Q),B&&(n.push(B[K+1].r,B[K+1].g,B[K+1].b,B[K+1].a),n.push(B[K+1].r,B[K+1].g,B[K+1].b,B[K+1].a),n.push(B[K+2].r,B[K+2].g,B[K+2].b,B[K+2].a),n.push(B[K+2].r,B[K+2].g,B[K+2].b,B[K+2].a))),s!==K&&(s=K)}const Z=1!==t&&x?X+4:X;for(U=0,K=0;K<P;K++){let G=0,V=0,W=0,J=0;for(a=0;a<X;a++)G=U*(Z+1)+a,V=(U+1)*(Z+1)+a,W=U*(Z+1)+(a+1),J=(U+1)*(Z+1)+(a+1),r.push(G,V,W),r.push(J,W,V);1!==t&&x&&(r.push(G+2,V+2,W+2),r.push(J+2,W+2,V+2),r.push(G+4,V+4,W+4),r.push(J+4,W+4,V+4)),U=A?U+2:U+1}const E=G=>{const R=G?W/2:d/2;if(0===R)return;let k,P,A;const x=G?g[S-1]:g[0];let q=null;B&&(q=G?B[S-1]:B[0]);const L=y.length/3,Y=G?V/2:-V/2,p=new J.o(0,Y,0);y.push(p.x,p.y,p.z),u.push(0,G?1:-1,0);const b=x.y+.5*(x.w-x.y);H.push(x.x+.5*(x.z-x.x),z.b?1-b:b),q&&n.push(q.r,q.g,q.b,q.a);const D=new J.k(.5,.5);for(A=0;A<=X;A++){k=2*Math.PI*A*t/X;const V=Math.cos(-k),W=Math.sin(-k);P=new J.o(V*R,Y,W*R);const d=new J.k(V*D.x+.5,W*D.y+.5);y.push(P.x,P.y,P.z),u.push(0,G?1:-1,0);const L=x.y+(x.w-x.y)*d.y;H.push(x.x+(x.z-x.x)*d.x,z.b?1-L:L),q&&n.push(q.r,q.g,q.b,q.a)}for(A=0;A<X;A++)G?(r.push(L),r.push(L+(A+2)),r.push(L+(A+1))):(r.push(L),r.push(L+(A+1)),r.push(L+(A+2)))};L!==R.b.CAP_START&&L!==R.b.CAP_ALL||E(!1),L!==R.b.CAP_END&&L!==R.b.CAP_ALL||E(!0),k.b._ComputeSides(Y,y,r,u,H,G.frontUVs,G.backUVs);const h=new k.b;return h.indices=r,h.DG=y,h.iG=u,h.FG=H,B&&(h.eG=n),h}function r(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return b(V).vG(J,V.updatable),J}function y(G){const V=[],W=[],R=[],d=[],X=G.diameter||1,P=G.thickness||.5,A=0|(G.tessellation||16),x=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,q=A+1;for(let k=0;k<=A;k++){const G=k/A,x=k*Math.PI*2/A-Math.PI/2,L=J.c.Translation(X/2,0,0).multiply(J.c.RotationY(x));for(let X=0;X<=A;X++){const x=1-X/A,t=X*Math.PI*2/A+Math.PI,Y=Math.cos(t),g=Math.sin(t);let B=new J.o(Y,g,0),S=B.scale(P/2);const p=new J.k(G,x);S=J.o.TransformCoordinates(S,L),B=J.o.TransformNormal(B,L),W.push(S.x,S.y,S.z),R.push(B.x,B.y,B.z),d.push(p.x,z.b?1-p.y:p.y);const b=(k+1)%q,r=(X+1)%q;V.push(k*q+X),V.push(k*q+r),V.push(b*q+X),V.push(k*q+r),V.push(b*q+r),V.push(b*q+X)}}k.b._ComputeSides(x,W,V,R,d,G.frontUVs,G.backUVs);const L=new k.b;return L.indices=V,L.DG=W,L.iG=R,L.FG=d,L}function u(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return y(V).vG(J,V.updatable),J}k.b.CreateCylinder=b,R.b.CreateCylinder=(G,V,W,J,d,k,z,X,P)=>{void 0!==z&&z instanceof S.e||(void 0!==z&&(P=X||R.b.DEFAULTSIDE,X=z),z=k,k=1);return r(G,{height:V,diameterTop:W,diameterBottom:J,tessellation:d,subdivisions:k,sideOrientation:P,updatable:X},z)};function H(G){const V=[],W=[],R=[],d=[],X=G.radius||2,P=G.tube||.5,A=G.radialSegments||32,x=G.tubularSegments||32,q=G.p||2,L=G.q||3,t=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,Y=G=>{const V=Math.cos(G),W=Math.sin(G),R=L/q*G,d=Math.cos(R),k=X*(2+d)*.5*V,z=X*(2+d)*W*.5,P=X*Math.sin(R)*.5;return new J.o(k,z,P)};let g,B;for(g=0;g<=A;g++){const G=g%A/A*2*q*Math.PI,V=Y(G),R=Y(G+.01),k=R.zW(V);let X=R.add(V);const L=J.o.Cross(k,X);for(X=J.o.Cross(L,k),L.normalize(),X.normalize(),B=0;B<x;B++){const G=B%x/x*2*Math.PI,J=-P*Math.cos(G),R=P*Math.sin(G);W.push(V.x+J*X.x+R*L.x),W.push(V.y+J*X.y+R*L.y),W.push(V.z+J*X.z+R*L.z),d.push(g/A),d.push(z.b?1-B/x:B/x)}}for(g=0;g<A;g++)for(B=0;B<x;B++){const G=(B+1)%x,W=g*x+B,J=(g+1)*x+B,R=(g+1)*x+G,d=g*x+G;V.push(d),V.push(J),V.push(W),V.push(d),V.push(R),V.push(J)}k.b.ComputeNormals(W,V,R),k.b._ComputeSides(t,W,V,R,d,G.frontUVs,G.backUVs);const S=new k.b;return S.indices=V,S.DG=W,S.iG=R,S.FG=d,S}function n(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return H(V).vG(J,V.updatable),J}k.b.CreateTorus=y,R.b.CreateTorus=(G,V,W,J,R,d,k)=>u(G,{diameter:V,thickness:W,tessellation:J,sideOrientation:k,updatable:d},R);k.b.CreateTorusKnot=H,R.b.CreateTorusKnot=(G,V,W,J,R,d,k,z,X,P)=>n(G,{radius:V,tube:W,radialSegments:J,tubularSegments:R,p:d,q:k,sideOrientation:P,updatable:X},z);var D=W(13228),i=W(11892),e=W(11627);function F(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=V.path,d=V.shape,k=V.scale||1,z=V.rotation||0,X=0===V.cap?0:V.cap||R.b.NO_CAP,P=V.updatable,A=R.b._GetDefaultSideOrientation(V.sideOrientation),x=V.instance||null,q=V.invertUV||!1,L=V.closeShape||!1,t=V.closePath||!1,Y=V.capFunction||null;return v(G,d,J,k,z,null,null,t,L,X,!1,W,!!P,A,x,q,V.frontUVs||null,V.backUVs||null,V.firstNormal||null,!!V.adjustFrame,Y)}function f(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=V.path,d=V.shape,k=V.scaleFunction||(()=>1),z=V.rotationFunction||(()=>0),X=V.closePath||V.ribbonCloseArray||!1,P=V.closeShape||V.ribbonClosePath||!1,A=0===V.cap?0:V.cap||R.b.NO_CAP,x=V.updatable,q=V.firstNormal||null,L=V.adjustFrame||!1,t=R.b._GetDefaultSideOrientation(V.sideOrientation),Y=V.instance,g=V.invertUV||!1,B=V.capFunction||null;return v(G,d,J,null,null,k,z,X,P,A,!0,W,!!x,t,Y||null,g,V.frontUVs||null,V.backUVs||null,q,L,B||null)}function v(G,V,W,d,k,z,X,A,x,q,L,t,Y,g,B,S,p,b,r,y,u){const H=(G,V,W,d,k,z,X,P,A,x,q)=>{const L=W.getTangents(),t=W.getNormals(),Y=W.getBinormals(),g=W.getDistances();if(q)for(let R=0;R<L.length;R++)if(0==L[R].x&&0==L[R].y&&0==L[R].z&&L[R].J(L[R-1]),0==t[R].x&&0==t[R].y&&0==t[R].z&&t[R].J(t[R-1]),0==Y[R].x&&0==Y[R].y&&0==Y[R].z&&Y[R].J(Y[R-1]),R>0){let G=L[R-1];J.o.Dot(G,L[R])<0&&L[R].scaleInPlace(-1),G=t[R-1],J.o.Dot(G,t[R])<0&&t[R].scaleInPlace(-1),G=Y[R-1],J.o.Dot(G,Y[R])<0&&Y[R].scaleInPlace(-1)}let B=0;const S=x&&P?P:()=>null!==z?z:0,p=x&&X?X:()=>null!==k?k:1;let b=A===R.b.NO_CAP||A===R.b.CAP_END?0:2;const r=J.h.Matrix[0];for(let R=0;R<V.length;R++){const W=[],k=S(R,g[R]),z=p(R,g[R]);J.c.RotationAxisToRef(L[R],B,r);for(let d=0;d<G.length;d++){const k=L[R].scale(G[d].z).add(t[R].scale(G[d].x)).add(Y[R].scale(G[d].y)),X=J.o.Zero();J.o.TransformCoordinatesToRef(k,r,X),X.scaleInPlace(z).addInPlace(V[R]),W[d]=X}d[b]=W,B+=k,b++}const y=u||(G=>{const V=Array(),W=J.o.Zero();let R;for(R=0;R<G.length;R++)W.addInPlace(G[R]);for(W.scaleInPlace(1/G.length),R=0;R<G.length;R++)V.push(W);return V});switch(A){case R.b.NO_CAP:break;case R.b.CAP_START:d[0]=y(d[2]),d[1]=d[2];break;case R.b.CAP_END:d[b]=d[b-1],d[b+1]=y(d[b-1]);break;case R.b.CAP_ALL:d[0]=y(d[2]),d[1]=d[2],d[b]=d[b-1],d[b+1]=y(d[b-1])}return d};let n,D;if(B){const G=B._creationDataStorage;return n=r?G.path3D.update(W,r):G.path3D.update(W),D=H(V,W,G.path3D,G.pathArray,d,k,z,X,G.cap,L,y),B=P("",{pathArray:D,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},t||void 0)}n=r?new e.n(W,r):new e.n(W);D=H(V,W,n,new Array,d,k,z,X,q=q<0||q>3?0:q,L,y);const i=P(G,{pathArray:D,closeArray:A,closePath:x,updatable:Y,sideOrientation:g,invertUV:S,frontUVs:p||void 0,backUVs:b||void 0},t);return i._creationDataStorage.pathArray=D,i._creationDataStorage.path3D=n,i._creationDataStorage.cap=q,i}function C(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=V.arc?V.arc<=0||V.arc>1?1:V.arc:1,k=void 0===V.closed||V.closed,z=V.shape,X=V.radius||1,A=V.tessellation||64,x=V.clip||0,q=V.updatable,L=R.b._GetDefaultSideOrientation(V.sideOrientation),t=V.cap||R.b.NO_CAP,Y=2*Math.PI,g=[],B=V.invertUV||!1;let S=0,p=0;const b=Y/A*d;let r,y;for(S=0;S<=A-x;S++){for(y=[],t!=R.b.CAP_START&&t!=R.b.CAP_ALL||(y.push(new J.o(0,z[0].y,0)),y.push(new J.o(Math.cos(S*b)*z[0].x*X,z[0].y,Math.sin(S*b)*z[0].x*X))),p=0;p<z.length;p++)r=new J.o(Math.cos(S*b)*z[p].x*X,z[p].y,Math.sin(S*b)*z[p].x*X),y.push(r);t!=R.b.CAP_END&&t!=R.b.CAP_ALL||(y.push(new J.o(Math.cos(S*b)*z[z.length-1].x*X,z[z.length-1].y,Math.sin(S*b)*z[z.length-1].x*X)),y.push(new J.o(0,z[z.length-1].y,0))),g.push(y)}return P(G,{pathArray:g,closeArray:k,sideOrientation:L,updatable:q,invertUV:B,frontUVs:V.frontUVs,backUVs:V.backUVs},W)}R.b.ExtrudeShape=function(G,V,W,J,d,k){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7?arguments[7]:void 0,P=arguments.length>8?arguments[8]:void 0,A=arguments.length>9?arguments[9]:void 0;return F(G,{shape:V,path:W,scale:J,rotation:d,cap:0===k?0:k||R.b.NO_CAP,sideOrientation:P,instance:A,updatable:X},z)},R.b.ExtrudeShapeCustom=(G,V,W,J,d,k,z,X,P,A,x,q)=>f(G,{shape:V,path:W,scaleFunction:J,rotationFunction:d,ribbonCloseArray:k,ribbonClosePath:z,cap:0===X?0:X||R.b.NO_CAP,sideOrientation:x,instance:q,updatable:A},P);R.b.CreateLathe=(G,V,W,J,R,d,k)=>C(G,{shape:V,radius:W,tessellation:J,sideOrientation:k,updatable:d},R);var l=W(12646),m=W(12599);function w(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=V.path;let k=V.instance,z=1;void 0!==V.radius?z=V.radius:k&&(z=k._creationDataStorage.radius);const X=V.tessellation||64,A=V.radiusFunction||null;let x=V.cap||R.b.NO_CAP;const q=V.invertUV||!1,L=V.updatable,t=R.b._GetDefaultSideOrientation(V.sideOrientation);V.arc=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1;const Y=(G,V,W,d,k,z,X,P)=>{const A=V.getTangents(),x=V.getNormals(),q=V.getDistances(),L=2*Math.PI/k*P,t=z||(()=>d);let Y,g,B,S;const p=J.h.Matrix[0];let b=X===R.b.NO_CAP||X===R.b.CAP_END?0:2;for(let R=0;R<G.length;R++){g=t(R,q[R]),Y=Array(),B=x[R];for(let V=0;V<k;V++)J.c.RotationAxisToRef(A[R],L*V,p),S=Y[V]?Y[V]:J.o.Zero(),J.o.TransformCoordinatesToRef(B,p,S),S.scaleInPlace(g).addInPlace(G[R]),Y[V]=S;W[b]=Y,b++}const r=(V,W)=>{const J=Array();for(let R=0;R<V;R++)J.push(G[W]);return J};switch(X){case R.b.NO_CAP:break;case R.b.CAP_START:W[0]=r(k,0),W[1]=W[2].slice(0);break;case R.b.CAP_END:W[b]=W[b-1].slice(0),W[b+1]=r(k,G.length-1);break;case R.b.CAP_ALL:W[0]=r(k,0),W[1]=W[2].slice(0),W[b]=W[b-1].slice(0),W[b+1]=r(k,G.length-1)}return W};let g,B;if(k){const G=k._creationDataStorage,W=V.arc||G.arc;return g=G.path3D.update(d),B=Y(d,g,G.pathArray,z,G.tessellation,A,G.cap,W),k=P("",{pathArray:B,instance:k}),G.path3D=g,G.pathArray=B,G.arc=W,G.radius=z,k}g=new e.n(d);x=x<0||x>3?0:x,B=Y(d,g,new Array,z,X,A,x,V.arc);const S=P(G,{pathArray:B,closePath:!0,closeArray:!1,updatable:L,sideOrientation:t,invertUV:q,frontUVs:V.frontUVs,backUVs:V.backUVs},W);return S._creationDataStorage.pathArray=B,S._creationDataStorage.path3D=g,S._creationDataStorage.tessellation=X,S._creationDataStorage.cap=x,S._creationDataStorage.arc=V.arc,S._creationDataStorage.radius=z,S}function N(G){const V=[];V[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},V[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},V[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},V[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},V[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},V[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},V[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},V[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},V[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},V[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},V[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},V[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},V[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},V[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},V[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const W=G.type&&(G.type<0||G.type>=V.length)?0:G.type||0,R=G.size,d=G.sizeX||R||1,X=G.sizeY||R||1,P=G.sizeZ||R||1,A=G.custom||V[W],x=A.face.length,L=G.faceUV||new Array(x),t=G.faceColors,Y=void 0===G.flat||G.flat,g=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,B=[],S=[],p=[],b=[],r=[];let y=0,u=0;const H=[];let n,D,i,e,F,f,v=0,C=0;if(Y)for(C=0;C<x;C++)t&&void 0===t[C]&&(t[C]=new q.h(1,1,1,1)),L&&void 0===L[C]&&(L[C]=new J.q(0,0,1,1));if(Y)for(C=0;C<x;C++){const G=A.face[C].length;for(i=2*Math.PI/G,e=.5*Math.tan(i/2),F=.5,v=0;v<G;v++)B.push(A.vertex[A.face[C][v]][0]*d,A.vertex[A.face[C][v]][1]*X,A.vertex[A.face[C][v]][2]*P),H.push(y),y++,n=L[C].x+(L[C].z-L[C].x)*(.5+e),D=L[C].y+(L[C].w-L[C].y)*(F-.5),b.push(n,z.b?1-D:D),f=e*Math.cos(i)-F*Math.sin(i),F=e*Math.sin(i)+F*Math.cos(i),e=f,t&&r.push(t[C].r,t[C].g,t[C].b,t[C].a);for(v=0;v<G-2;v++)S.push(H[0+u],H[v+2+u],H[v+1+u]);u+=G}else{for(v=0;v<A.vertex.length;v++)B.push(A.vertex[v][0]*d,A.vertex[v][1]*X,A.vertex[v][2]*P),b.push(0,z.b?1:0);for(C=0;C<x;C++)for(v=0;v<A.face[C].length-2;v++)S.push(A.face[C][0],A.face[C][v+2],A.face[C][v+1])}k.b.ComputeNormals(B,S,p),k.b._ComputeSides(g,B,S,p,b,G.frontUVs,G.backUVs);const l=new k.b;return l.DG=B,l.indices=S,l.iG=p,l.FG=b,t&&Y&&(l.eG=r),l}function U(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return N(V).vG(J,V.updatable),J}R.b.CreateTube=(G,V,W,J,R,d,k,z,X,P)=>w(G,{path:V,radius:W,tessellation:J,radiusFunction:R,arc:1,cap:d,updatable:z,sideOrientation:X,instance:P},k);function a(G){const V=G.sideOrientation||k.b.DEFAULTSIDE,W=G.radius||1,R=void 0===G.flat||G.flat,d=0|(G.subdivisions||4),X=G.radiusX||W,P=G.radiusY||W,A=G.radiusZ||W,x=(1+Math.sqrt(5))/2,q=[-1,x,-0,1,x,0,-1,-x,0,1,-x,0,0,-1,-x,0,1,-x,0,-1,x,0,1,x,x,0,1,x,0,-1,-x,0,1,-x,0,-1],L=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],t=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Y=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],S=[],p=[],b=[];let r=0;const y=new Array(3),u=new Array(3);let H;for(H=0;H<3;H++)y[H]=J.o.Zero(),u[H]=J.k.Zero();for(let k=0;k<20;k++){for(H=0;H<3;H++){const G=L[3*k+H];y[H].rd(q[3*t[G]],q[3*t[G]+1],q[3*t[G]+2]),y[H].normalize(),u[H].rd(.134765625*Y[2*G]+.05859375+-.0390625*g[k],.2333984375*Y[2*G+1]+.025390625+.01953125*g[k])}const G=(G,V,W,k)=>{const x=J.o.Lerp(y[0],y[2],V/d),q=J.o.Lerp(y[1],y[2],V/d),L=d===V?y[2]:J.o.Lerp(x,q,G/(d-V));let t;if(L.normalize(),R){const G=J.o.Lerp(y[0],y[2],k/d),V=J.o.Lerp(y[1],y[2],k/d);t=J.o.Lerp(G,V,W/(d-k))}else t=new J.o(L.x,L.y,L.z);t.x/=X,t.y/=P,t.z/=A,t.normalize();const Y=J.k.Lerp(u[0],u[2],V/d),g=J.k.Lerp(u[1],u[2],V/d),H=d===V?u[2]:J.k.Lerp(Y,g,G/(d-V));S.push(L.x*X,L.y*P,L.z*A),p.push(t.x,t.y,t.z),b.push(H.x,z.b?1-H.y:H.y),B.push(r),r++};for(let V=0;V<d;V++)for(let W=0;W+V<d;W++)G(W,V,W+1/3,V+1/3),G(W+1,V,W+1/3,V+1/3),G(W,V+1,W+1/3,V+1/3),W+V+1<d&&(G(W+1,V,W+2/3,V+2/3),G(W+1,V+1,W+2/3,V+2/3),G(W,V+1,W+2/3,V+2/3))}k.b._ComputeSides(V,S,B,p,b,G.frontUVs,G.backUVs);const n=new k.b;return n.indices=B,n.DG=S,n.iG=p,n.FG=b,n}function M(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new R.b(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),J._originalBuilderSideOrientation=V.sideOrientation;return a(V).vG(J,V.updatable),J}k.b.CreatePolyhedron=N,R.b.CreatePolyhedron=(G,V,W)=>U(G,V,W);k.b.CreateIcoSphere=a,R.b.CreateIcoSphere=(G,V,W)=>M(G,V,W);var T=W(11182);const K=new J.o(1,0,0),s=new J.o(-1,0,0),Q=new J.o(0,1,0),Z=new J.o(0,-1,0),E=new J.o(0,0,1),h=new J.o(0,0,-1);class o{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.o.Zero(),V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.o.Up(),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.k.Zero(),R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=G,this.IV=V,this.uv=W,this.vertexIdx=R,this.vertexIdxForBones=d,this.localPositionOverride=k,this.localNormalOverride=z,this.matrixIndicesOverride=X,this.matrixWeightsOverride=P}clone(){var G,V,W,J;return new o(this.position.clone(),this.IV.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(G=this.localPositionOverride)||void 0===G?void 0:G.slice(),null===(V=this.localNormalOverride)||void 0===V?void 0:V.slice(),null===(W=this.matrixIndicesOverride)||void 0===W?void 0:W.slice(),null===(J=this.matrixWeightsOverride)||void 0===J?void 0:J.slice())}}function c(G,V,W){var X,P,A,x,q;const L=!!V.skeleton,t=!(null===(X=V.morphTargetManager)||void 0===X||!X.numTargets),Y=W.localMode||L,g=V.Pd(),B=L||t?V.uz(!0,!0):V.getVerticesData(d.c.PositionKind),S=L||t?V.getNormalsData(!0,!0):V.getVerticesData(d.c.NormalKind),p=Y?L?V.getVerticesData(d.c.PositionKind):B:null,b=Y?L?V.getVerticesData(d.c.NormalKind):S:null,r=V.getVerticesData(d.c.UVKind),y=L?V.getVerticesData(d.c.MatricesIndicesKind):null,u=L?V.getVerticesData(d.c.MatricesWeightsKind):null,H=L?V.getVerticesData(d.c.MatricesIndicesExtraKind):null,n=L?V.getVerticesData(d.c.MatricesWeightsExtraKind):null,D=W.position||J.o.Zero();let i=W.IV||J.o.Up();const e=W.size||J.o.One(),F=W.angle||0;if(!i){const G=new J.o(0,0,1),W=V.HG().activeCamera,R=J.o.TransformCoordinates(G,W.getWorldMatrix());i=W.globalPosition.zW(R)}const f=-Math.atan2(i.z,i.x)-Math.PI/2,v=Math.sqrt(i.x*i.x+i.z*i.z),C=Math.atan2(i.y,v),l=new k.b;l.indices=[],l.DG=[],l.iG=[],l.FG=[],l.matricesIndices=L?[]:null,l.matricesWeights=L?[]:null,l.matricesIndicesExtra=H?[]:null,l.matricesWeightsExtra=n?[]:null;let m=0;const w=(G,V)=>{const R=new o;if(!g||!B||!S)return R;const d=g[G];if(R.vertexIdx=3*d,R.vertexIdxForBones=4*d,R.position=new J.o(B[3*d],B[3*d+1],B[3*d+2]),J.o.TransformCoordinatesToRef(R.position,V,R.position),R.IV=new J.o(S[3*d],S[3*d+1],S[3*d+2]),J.o.TransformNormalToRef(R.IV,V,R.IV),W.captureUVS&&r){const G=r[2*d+1];R.uv=new J.k(r[2*d],z.b?1-G:G)}return R},N=[0,0,0,0],U=(G,V)=>{if(0===G.length)return G;const W=.5*Math.abs(J.o.Dot(e,V)),R=(G,V,W,J)=>{for(let R=0;R<J;++R)if(G[W+R]===V)return W+R;return-1},d=(G,d)=>{const k=J.o.GetClipFactor(G.position,d.position,V,W);let z=N,X=N;if(y&&u){const V=G.matrixIndicesOverride?0:G.vertexIdxForBones,W=G.matrixIndicesOverride??y,J=G.matrixWeightsOverride??u,P=d.matrixIndicesOverride?0:d.vertexIdxForBones,A=d.matrixIndicesOverride??y,x=d.matrixWeightsOverride??u;z=[0,0,0,0],X=[0,0,0,0];let q=0;for(let G=0;G<4;++G)if(J[V+G]>0){const d=R(A,W[V+G],P,4);z[q]=W[V+G],X[q]=(0,T.Lerp)(J[V+G],d>=0?x[d]:0,k),q++}for(let G=0;G<4&&q<4;++G){const J=A[P+G];-1===R(W,J,V,4)&&(z[q]=J,X[q]=(0,T.Lerp)(0,x[P+G],k),q++)}const L=X[0]+X[1]+X[2]+X[3];X[0]/=L,X[1]/=L,X[2]/=L,X[3]/=L}const P=G.localPositionOverride?G.localPositionOverride[0]:(null===p||void 0===p?void 0:p[G.vertexIdx])??0,A=G.localPositionOverride?G.localPositionOverride[1]:(null===p||void 0===p?void 0:p[G.vertexIdx+1])??0,x=G.localPositionOverride?G.localPositionOverride[2]:(null===p||void 0===p?void 0:p[G.vertexIdx+2])??0,q=d.localPositionOverride?d.localPositionOverride[0]:(null===p||void 0===p?void 0:p[d.vertexIdx])??0,L=d.localPositionOverride?d.localPositionOverride[1]:(null===p||void 0===p?void 0:p[d.vertexIdx+1])??0,t=d.localPositionOverride?d.localPositionOverride[2]:(null===p||void 0===p?void 0:p[d.vertexIdx+2])??0,Y=G.localNormalOverride?G.localNormalOverride[0]:(null===b||void 0===b?void 0:b[G.vertexIdx])??0,g=G.localNormalOverride?G.localNormalOverride[1]:(null===b||void 0===b?void 0:b[G.vertexIdx+1])??0,B=G.localNormalOverride?G.localNormalOverride[2]:(null===b||void 0===b?void 0:b[G.vertexIdx+2])??0,S=Y+((d.localNormalOverride?d.localNormalOverride[0]:(null===b||void 0===b?void 0:b[d.vertexIdx])??0)-Y)*k,r=g+((d.localNormalOverride?d.localNormalOverride[1]:(null===b||void 0===b?void 0:b[d.vertexIdx+1])??0)-g)*k,H=B+((d.localNormalOverride?d.localNormalOverride[2]:(null===b||void 0===b?void 0:b[d.vertexIdx+2])??0)-B)*k,n=Math.sqrt(S*S+r*r+H*H);return new o(J.o.Lerp(G.position,d.position,k),J.o.Lerp(G.IV,d.IV,k).normalize(),J.k.Lerp(G.uv,d.uv,k),-1,-1,p?[P+(q-P)*k,A+(L-A)*k,x+(t-x)*k]:null,b?[S/n,r/n,H/n]:null,z,X)};let k=null;G.length>3&&(k=[]);for(let z=0;z<G.length;z+=3){let R=0,X=null,P=null,A=null,x=null;const q=J.o.Dot(G[z].position,V)-W>0,L=J.o.Dot(G[z+1].position,V)-W>0,t=J.o.Dot(G[z+2].position,V)-W>0;switch(R=(q?1:0)+(L?1:0)+(t?1:0),R){case 0:G.length>3?(k.push(G[z]),k.push(G[z+1]),k.push(G[z+2])):k=G;break;case 1:if(k=k??new Array,q&&(X=G[z+1],P=G[z+2],A=d(G[z],X),x=d(G[z],P)),L){X=G[z],P=G[z+2],A=d(G[z+1],X),x=d(G[z+1],P),k.push(A),k.push(P.clone()),k.push(X.clone()),k.push(P.clone()),k.push(A.clone()),k.push(x);break}t&&(X=G[z],P=G[z+1],A=d(G[z+2],X),x=d(G[z+2],P)),X&&P&&A&&x&&(k.push(X.clone()),k.push(P.clone()),k.push(A),k.push(x),k.push(A.clone()),k.push(P.clone()));break;case 2:k=k??new Array,q||(X=G[z].clone(),P=d(X,G[z+1]),A=d(X,G[z+2]),k.push(X),k.push(P),k.push(A)),L||(X=G[z+1].clone(),P=d(X,G[z+2]),A=d(X,G[z]),k.push(X),k.push(P),k.push(A)),t||(X=G[z+2].clone(),P=d(X,G[z]),A=d(X,G[z+1]),k.push(X),k.push(P),k.push(A))}}return k},a=V instanceof R.b?V:null,M=null===a||void 0===a?void 0:a._thinInstanceDataStorage.matrixData,c=(null===a||void 0===a?void 0:a.jd)||1,j=J.h.Matrix[0];j.J(J.c.IdentityReadOnly);for(let R=0;R<c;++R){if(null!==a&&void 0!==a&&a.hasThinInstances&&M){const G=16*R;j.setRowFromFloats(0,M[G+0],M[G+1],M[G+2],M[G+3]),j.setRowFromFloats(1,M[G+4],M[G+5],M[G+6],M[G+7]),j.setRowFromFloats(2,M[G+8],M[G+9],M[G+10],M[G+11]),j.setRowFromFloats(3,M[G+12],M[G+13],M[G+14],M[G+15])}const G=J.c.RotationYawPitchRoll(f,C,F).multiply(J.c.Translation(D.x,D.y,D.z)),d=J.c.Invert(G),k=V.getWorldMatrix(),X=j.multiply(k).multiply(d),P=new Array(3);for(let V=0;V<g.length;V+=3){let G=P;if(G[0]=w(V,X),G[1]=w(V+1,X),G[2]=w(V+2,X),!(W.cullBackFaces&&-G[0].IV.z<=0&&-G[1].IV.z<=0&&-G[2].IV.z<=0)&&(G=U(G,K),G&&(G=U(G,s),G&&(G=U(G,Q),G&&(G=U(G,Z),G&&(G=U(G,E),G&&(G=U(G,h),G)))))))for(let V=0;V<G.length;V++){const J=G[V];if(l.indices.push(m),Y?(J.localPositionOverride?(l.DG[3*m]=J.localPositionOverride[0],l.DG[3*m+1]=J.localPositionOverride[1],l.DG[3*m+2]=J.localPositionOverride[2]):p&&(l.DG[3*m]=p[J.vertexIdx],l.DG[3*m+1]=p[J.vertexIdx+1],l.DG[3*m+2]=p[J.vertexIdx+2]),J.localNormalOverride?(l.iG[3*m]=J.localNormalOverride[0],l.iG[3*m+1]=J.localNormalOverride[1],l.iG[3*m+2]=J.localNormalOverride[2]):b&&(l.iG[3*m]=b[J.vertexIdx],l.iG[3*m+1]=b[J.vertexIdx+1],l.iG[3*m+2]=b[J.vertexIdx+2])):(J.position.toArray(l.DG,3*m),J.IV.toArray(l.iG,3*m)),l.matricesIndices&&l.matricesWeights&&(J.matrixIndicesOverride?(l.matricesIndices[4*m]=J.matrixIndicesOverride[0],l.matricesIndices[4*m+1]=J.matrixIndicesOverride[1],l.matricesIndices[4*m+2]=J.matrixIndicesOverride[2],l.matricesIndices[4*m+3]=J.matrixIndicesOverride[3]):(y&&(l.matricesIndices[4*m]=y[J.vertexIdxForBones],l.matricesIndices[4*m+1]=y[J.vertexIdxForBones+1],l.matricesIndices[4*m+2]=y[J.vertexIdxForBones+2],l.matricesIndices[4*m+3]=y[J.vertexIdxForBones+3]),H&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*m]=H[J.vertexIdxForBones],l.matricesIndicesExtra[4*m+1]=H[J.vertexIdxForBones+1],l.matricesIndicesExtra[4*m+2]=H[J.vertexIdxForBones+2],l.matricesIndicesExtra[4*m+3]=H[J.vertexIdxForBones+3])),J.matrixWeightsOverride?(l.matricesWeights[4*m]=J.matrixWeightsOverride[0],l.matricesWeights[4*m+1]=J.matrixWeightsOverride[1],l.matricesWeights[4*m+2]=J.matrixWeightsOverride[2],l.matricesWeights[4*m+3]=J.matrixWeightsOverride[3]):(u&&(l.matricesWeights[4*m]=u[J.vertexIdxForBones],l.matricesWeights[4*m+1]=u[J.vertexIdxForBones+1],l.matricesWeights[4*m+2]=u[J.vertexIdxForBones+2],l.matricesWeights[4*m+3]=u[J.vertexIdxForBones+3]),n&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*m]=n[J.vertexIdxForBones],l.matricesWeightsExtra[4*m+1]=n[J.vertexIdxForBones+1],l.matricesWeightsExtra[4*m+2]=n[J.vertexIdxForBones+2],l.matricesWeightsExtra[4*m+3]=n[J.vertexIdxForBones+3]))),W.captureUVS)J.uv.toArray(l.FG,2*m);else{l.FG.push(.5+J.position.x/e.x);const G=.5+J.position.y/e.y;l.FG.push(z.b?1-G:G)}m++}}}0===l.indices.length&&(l.indices=null),0===l.DG.length&&(l.DG=null),0===l.iG.length&&(l.iG=null),0===l.FG.length&&(l.FG=null),0===(null===(P=l.matricesIndices)||void 0===P?void 0:P.length)&&(l.matricesIndices=null),0===(null===(A=l.matricesWeights)||void 0===A?void 0:A.length)&&(l.matricesWeights=null),0===(null===(x=l.matricesIndicesExtra)||void 0===x?void 0:x.length)&&(l.matricesIndicesExtra=null),0===(null===(q=l.matricesWeightsExtra)||void 0===q?void 0:q.length)&&(l.matricesWeightsExtra=null);const I=new R.b(G,V.HG());return l.vG(I),Y?(I.skeleton=V.skeleton,I.parent=V):(I.position=D.clone(),I.rotation=new J.o(C,f,F)),I.kd(!0),I.refreshBoundingInfo(!0,!0),I}function j(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const V=0|Math.max(G.subdivisions?G.subdivisions:2,1),W=0|Math.max(G.tessellation?G.tessellation:16,3),R=Math.max(G.height?G.height:1,0),d=Math.max(G.radius?G.radius:.25,0),X=0|Math.max(G.capSubdivisions?G.capSubdivisions:6,1),P=W,A=V,x=Math.max(G.radiusTop?G.radiusTop:d,0),q=Math.max(G.radiusBottom?G.radiusBottom:d,0),L=R-(x+q),t=2*Math.PI,Y=Math.max(G.topCapSubdivisions?G.topCapSubdivisions:X,1),g=Math.max(G.bottomCapSubdivisions?G.bottomCapSubdivisions:X,1),B=Math.acos((q-x)/R);let S=[];const p=[],b=[],r=[];let y=0;const u=[],H=.5*L,n=.5*Math.PI;let D,i;const e=J.o.Zero(),F=J.o.Zero(),f=Math.cos(B),v=Math.sin(B),C=new J.k(x*v,H+x*f).zW(new J.k(q*v,q*f-H)).length(),l=x*B+C+q*(n-B);let m=0;for(i=0;i<=Y;i++){const G=[],V=n-B*(i/Y);m+=x*B/Y;const W=Math.cos(V),J=Math.sin(V),R=W*x;for(D=0;D<=P;D++){const V=D/P,d=V*t+0,k=Math.sin(d),X=Math.cos(d);F.x=R*k,F.y=H+J*x,F.z=R*X,p.push(F.x,F.y,F.z),e.set(W*k,J,W*X),b.push(e.x,e.y,e.z),r.push(V,z.b?m/l:1-m/l),G.push(y),y++}u.push(G)}const w=R-x-q+f*x-f*q,N=v*(q-x)/w;for(i=1;i<=A;i++){const G=[];m+=C/A;const V=v*(i*(q-x)/A+x);for(D=0;D<=P;D++){const W=D/P,J=W*t+0,R=Math.sin(J),d=Math.cos(J);F.x=V*R,F.y=H+f*x-i*w/A,F.z=V*d,p.push(F.x,F.y,F.z),e.set(R,N,d).normalize(),b.push(e.x,e.y,e.z),r.push(W,z.b?m/l:1-m/l),G.push(y),y++}u.push(G)}for(i=1;i<=g;i++){const G=[],V=n-B-(Math.PI-B)*(i/g);m+=q*B/g;const W=Math.cos(V),J=Math.sin(V),R=W*q;for(D=0;D<=P;D++){const V=D/P,d=V*t+0,k=Math.sin(d),X=Math.cos(d);F.x=R*k,F.y=J*q-H,F.z=R*X,p.push(F.x,F.y,F.z),e.set(W*k,J,W*X),b.push(e.x,e.y,e.z),r.push(V,z.b?m/l:1-m/l),G.push(y),y++}u.push(G)}for(D=0;D<P;D++)for(i=0;i<Y+A+g;i++){const G=u[i][D],V=u[i+1][D],W=u[i+1][D+1],J=u[i][D+1];S.push(G),S.push(V),S.push(J),S.push(V),S.push(W),S.push(J)}if(S=S.reverse(),G.orientation&&!G.orientation.equals(J.o.Up())){const V=new J.c;G.orientation.clone().scale(.5*Math.PI).cross(J.o.Up()).toQuaternion().toRotationMatrix(V);const W=J.o.Zero();for(let G=0;G<p.length;G+=3)W.set(p[G],p[G+1],p[G+2]),J.o.TransformCoordinatesToRef(W.clone(),V,W),p[G]=W.x,p[G+1]=W.y,p[G+2]=W.z}const U=new k.b;return U.DG=p,U.iG=b,U.FG=r,U.indices=S,U}function I(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:J.o.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new R.b(G,W);return j(V).vG(d,V.updatable),d}R.b.CreateDecal=(G,V,W,J,R,d)=>c(G,V,{position:W,IV:J,size:R,angle:d});R.b.CreateCapsule=(G,V,W)=>I(G,V,W),k.b.CreateCapsule=j;var O=W(11201),GG=W(11145);class VG{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=G,this.y=V,G!==Math.floor(G)&&(G=Math.floor(G),O.c.Warn("x is not an integer, floor(x) used")),V!==Math.floor(V)&&(V=Math.floor(V),O.c.Warn("y is not an integer, floor(y) used"))}clone(){return new VG(this.x,this.y)}rotate60About(G){const V=this.x;return this.x=G.x+G.y-this.y,this.y=V+this.y-G.x,this}rotateNeg60About(G){const V=this.x;return this.x=V+this.y-G.y,this.y=G.x+G.y-V,this}rotate120(G,V){G!==Math.floor(G)&&(G=Math.floor(G),O.c.Warn("m not an integer only floor(m) used")),V!==Math.floor(V)&&(V=Math.floor(V),O.c.Warn("n not an integer only floor(n) used"));const W=this.x;return this.x=G-W-this.y,this.y=V+W,this}rotateNeg120(G,V){G!==Math.floor(G)&&(G=Math.floor(G),O.c.Warn("m is not an integer, floor(m) used")),V!==Math.floor(V)&&(V=Math.floor(V),O.c.Warn("n is not an integer,   floor(n) used"));const W=this.x;return this.x=this.y-V,this.y=G+V-W-this.y,this}toCartesianOrigin(G,V){const W=J.o.Zero();return W.x=G.x+2*this.x*V+this.y*V,W.y=G.y+Math.sqrt(3)*this.y*V,W}static Zero(){return new VG(0,0)}}class WG{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new JG("icosahedron","Regular",[[0,GG.e,-1],[-GG.e,1,0],[-1,0,-GG.e],[1,0,-GG.e],[GG.e,1,0],[0,GG.e,1],[-1,0,GG.e],[-GG.e,-1,0],[0,-GG.e,-1],[GG.e,-1,0],[1,0,GG.e],[0,-GG.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let G=12;const V={},W=this.m,J=this.n;let R,d,k,z,X,P=W,A=1,x=0;0!==J&&(P=(0,T.HighestCommonFactor)(W,J)),A=W/P,x=J/P;const q=VG.Zero(),L=new VG(W,J),t=new VG(-J,W+J),Y=VG.Zero(),g=VG.Zero(),B=VG.Zero();let S,p,b,r,y=[];const u=[],H=this.vertByDist,n=(W,J,R,d)=>{S=W+"|"+R,p=J+"|"+d,S in V||p in V?S in V&&!(p in V)?V[p]=V[S]:p in V&&!(S in V)&&(V[S]=V[p]):(V[S]=G,V[p]=G,G++),H[R][0]>2?u[V[S]]=[-H[R][0],H[R][1],V[S]]:u[V[S]]=[y[H[R][0]],H[R][1],V[S]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let D=0;D<20;D++){if(y=this.IDATA.face[D],k=y[2],z=y[1],X=y[0],b=q.x+"|"+q.y,S=D+"|"+b,S in V||(V[S]=k,u[k]=[y[H[b][0]],H[b][1]]),b=L.x+"|"+L.y,S=D+"|"+b,S in V||(V[S]=z,u[z]=[y[H[b][0]],H[b][1]]),b=t.x+"|"+t.y,S=D+"|"+b,S in V||(V[S]=X,u[X]=[y[H[b][0]],H[b][1]]),R=this.IDATA.edgematch[D][0],d=this.IDATA.edgematch[D][1],"B"===d)for(let G=1;G<P;G++)g.x=W-G*(A+x),g.y=J+G*A,B.x=-G*x,B.y=G*(A+x),b=g.x+"|"+g.y,r=B.x+"|"+B.y,n(D,R,b,r);if("O"===d)for(let G=1;G<P;G++)B.x=-G*x,B.y=G*(A+x),Y.x=G*A,Y.y=G*x,b=B.x+"|"+B.y,r=Y.x+"|"+Y.y,n(D,R,b,r);if(R=this.IDATA.edgematch[D][2],d=this.IDATA.edgematch[D][3],d&&"A"===d)for(let G=1;G<P;G++)Y.x=G*A,Y.y=G*x,g.x=W-(P-G)*(A+x),g.y=J+(P-G)*A,b=Y.x+"|"+Y.y,r=g.x+"|"+g.y,n(D,R,b,r);for(let W=0;W<this.vertices.length;W++)b=this.vertices[W].x+"|"+this.vertices[W].y,S=D+"|"+b,S in V||(V[S]=G++,H[b][0]>2?u[V[S]]=[-H[b][0],H[b][1],V[S]]:u[V[S]]=[y[H[b][0]],H[b][1],V[S]])}this.closestTo=u,this.vecToidx=V}calcCoeffs(){const G=this.m,V=this.n,W=Math.sqrt(3)/3,J=G*G+V*V+G*V;this.coau=(G+V)/J,this.cobu=-V/J,this.coav=-W*(G-V)/J,this.cobv=W*(2*G+V)/J}createInnerFacets(){const G=this.m,V=this.n;for(let W=0;W<V+G+1;W++)for(let G=this.min[W];G<this.max[W]+1;G++)G<this.max[W]&&G<this.max[W+1]+1&&this.innerFacets.push(["|"+G+"|"+W,"|"+G+"|"+(W+1),"|"+(G+1)+"|"+W]),W>0&&G<this.max[W-1]&&G+1<this.max[W]+1&&this.innerFacets.push(["|"+G+"|"+W,"|"+(G+1)+"|"+W,"|"+(G+1)+"|"+(W-1)])}edgeVecsABOB(){const G=this.m,V=this.n,W=new VG(-V,G+V);for(let J=1;J<G+V;J++){const G=new VG(this.min[J],J),V=new VG(this.min[J-1],J-1),R=new VG(this.min[J+1],J+1),d=G.clone(),k=V.clone(),z=R.clone();d.rotate60About(W),k.rotate60About(W),z.rotate60About(W);const X=new VG(this.max[d.y],d.y),P=new VG(this.max[d.y-1],d.y-1),A=new VG(this.max[d.y-1]-1,d.y-1);d.x===X.x&&d.y===X.y||(d.x!==P.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,P,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,A,X])):d.y===z.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([G,V,P]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([G,P,R])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([G,V,P]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,P,X])))}}mapABOBtoOBOA(){const G=new VG(0,0);for(let V=0;V<this.isoVecsABOB.length;V++){const W=[];for(let J=0;J<3;J++)G.x=this.isoVecsABOB[V][J].x,G.y=this.isoVecsABOB[V][J].y,0===this.vertexTypes[V][J]&&G.rotateNeg120(this.m,this.n),W.push(G.clone());this.isoVecsOBOA.push(W)}}mapABOBtoBAOA(){const G=new VG(0,0);for(let V=0;V<this.isoVecsABOB.length;V++){const W=[];for(let J=0;J<3;J++)G.x=this.isoVecsABOB[V][J].x,G.y=this.isoVecsABOB[V][J].y,1===this.vertexTypes[V][J]&&G.rotate120(this.m,this.n),W.push(G.clone());this.isoVecsBAOA.push(W)}}MapToFace(G,V){const W=this.IDATA.face[G],R=W[2],d=W[1],k=W[0],z=J.o.ld(this.IDATA.vertex[R]),X=J.o.ld(this.IDATA.vertex[d]),P=J.o.ld(this.IDATA.vertex[k]),A=X.zW(z),x=P.zW(z),q=A.scale(this.coau).add(x.scale(this.cobu)),L=A.scale(this.coav).add(x.scale(this.cobv)),t=[];let Y,g=J.h.ed[0];for(let J=0;J<this.cartesian.length;J++)g=q.scale(this.cartesian[J].x).add(L.scale(this.cartesian[J].y)).add(z),t[J]=[g.x,g.y,g.z],Y=G+"|"+this.vertices[J].x+"|"+this.vertices[J].y,V.vertex[this.vecToidx[Y]]=[g.x,g.y,g.z]}build(G,V){const W=[],J=VG.Zero(),R=new VG(G,V),d=new VG(-V,G+V);W.push(J,R,d);for(let b=V;b<G+1;b++)for(let V=0;V<G+1-b;V++)W.push(new VG(V,b));if(V>0){const J=(0,T.HighestCommonFactor)(G,V),R=G/J,d=V/J;for(let z=1;z<J;z++)W.push(new VG(z*R,z*d)),W.push(new VG(-z*d,z*(R+d))),W.push(new VG(G-z*(R+d),V+z*R));const k=G/V;for(let z=1;z<V;z++)for(let J=0;J<z*k;J++)W.push(new VG(J,z)),W.push(new VG(J,z).rotate120(G,V)),W.push(new VG(J,z).rotateNeg120(G,V))}W.sort(((G,V)=>G.x-V.x)),W.sort(((G,V)=>G.y-V.y));const k=new Array(G+V+1),z=new Array(G+V+1);for(let b=0;b<k.length;b++)k[b]=1/0,z[b]=-1/0;let X=0,P=0;const A=W.length;for(let b=0;b<A;b++)P=W[b].x,X=W[b].y,k[X]=Math.min(P,k[X]),z[X]=Math.max(P,z[X]);const x=(W,J)=>{const R=W.clone();return"A"===J&&R.rotateNeg120(G,V),"B"===J&&R.rotate120(G,V),R.x<0?R.y:R.x+R.y},q=[],L=[],t=[],Y=[],g={},B=[];let S=-1,p=-1;for(let b=0;b<A;b++)q[b]=W[b].toCartesianOrigin(new VG(0,0),.5),L[b]=x(W[b],"O"),t[b]=x(W[b],"A"),Y[b]=x(W[b],"B"),L[b]===t[b]&&t[b]===Y[b]?(S=3,p=L[b]):L[b]===t[b]?(S=4,p=L[b]):t[b]===Y[b]?(S=5,p=t[b]):Y[b]===L[b]&&(S=6,p=L[b]),L[b]<t[b]&&L[b]<Y[b]&&(S=2,p=L[b]),t[b]<L[b]&&t[b]<Y[b]&&(S=1,p=t[b]),Y[b]<t[b]&&Y[b]<L[b]&&(S=0,p=Y[b]),B.push([S,p,W[b].x,W[b].y]);B.sort(((G,V)=>G[2]-V[2])),B.sort(((G,V)=>G[3]-V[3])),B.sort(((G,V)=>G[1]-V[1])),B.sort(((G,V)=>G[0]-V[0]));for(let b=0;b<B.length;b++)g[B[b][2]+"|"+B[b][3]]=[B[b][0],B[b][1],b];return this.m=G,this.n=V,this.vertices=W,this.vertByDist=g,this.cartesian=q,this.min=k,this.max=z,this}}class JG{constructor(G,V,W,J){this.name=G,this.category=V,this.vertex=W,this.face=J}}class RG extends JG{innerToData(G,V){for(let W=0;W<V.innerFacets.length;W++)this.face.push(V.innerFacets[W].map((W=>V.vecToidx[G+W])))}mapABOBtoDATA(G,V){const W=V.IDATA.edgematch[G][0];for(let J=0;J<V.isoVecsABOB.length;J++){const R=[];for(let d=0;d<3;d++)0===V.vertexTypes[J][d]?R.push(G+"|"+V.isoVecsABOB[J][d].x+"|"+V.isoVecsABOB[J][d].y):R.push(W+"|"+V.isoVecsABOB[J][d].x+"|"+V.isoVecsABOB[J][d].y);this.face.push([V.vecToidx[R[0]],V.vecToidx[R[1]],V.vecToidx[R[2]]])}}mapOBOAtoDATA(G,V){const W=V.IDATA.edgematch[G][0];for(let J=0;J<V.isoVecsOBOA.length;J++){const R=[];for(let d=0;d<3;d++)1===V.vertexTypes[J][d]?R.push(G+"|"+V.isoVecsOBOA[J][d].x+"|"+V.isoVecsOBOA[J][d].y):R.push(W+"|"+V.isoVecsOBOA[J][d].x+"|"+V.isoVecsOBOA[J][d].y);this.face.push([V.vecToidx[R[0]],V.vecToidx[R[1]],V.vecToidx[R[2]]])}}mapBAOAtoDATA(G,V){const W=V.IDATA.edgematch[G][2];for(let J=0;J<V.isoVecsBAOA.length;J++){const R=[];for(let d=0;d<3;d++)1===V.vertexTypes[J][d]?R.push(G+"|"+V.isoVecsBAOA[J][d].x+"|"+V.isoVecsBAOA[J][d].y):R.push(W+"|"+V.isoVecsBAOA[J][d].x+"|"+V.isoVecsBAOA[J][d].y);this.face.push([V.vecToidx[R[0]],V.vecToidx[R[1]],V.vecToidx[R[2]]])}}orderData(G){const V=[];for(let d=0;d<13;d++)V[d]=[];const W=G.closestTo;for(let d=0;d<W.length;d++)W[d][0]>-1?W[d][1]>0&&V[W[d][0]].push([d,W[d][1]]):V[12].push([d,W[d][0]]);const J=[];for(let d=0;d<12;d++)J[d]=d;let R=12;for(let d=0;d<12;d++){V[d].sort(((G,V)=>G[1]-V[1]));for(let G=0;G<V[d].length;G++)J[V[d][G][0]]=R++}for(let d=0;d<V[12].length;d++)J[V[12][d][0]]=R++;for(let d=0;d<this.vertex.length;d++)this.vertex[d].push(J[d]);this.vertex.sort(((G,V)=>G[3]-V[3]));for(let d=0;d<this.vertex.length;d++)this.vertex[d].pop();for(let d=0;d<this.face.length;d++)for(let G=0;G<this.face[d].length;G++)this.face[d][G]=J[this.face[d][G]];this.sharedNodes=V[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(G,V){const W=[],J=[];let R=V.pop();J.push(R);let d=this.face[R].indexOf(G);d=(d+2)%3;let k=this.face[R][d];W.push(k);let z=0;for(;V.length>0;)R=V[z],this.face[R].indexOf(k)>-1?(d=(this.face[R].indexOf(k)+1)%3,k=this.face[R][d],W.push(k),J.push(R),V.splice(z,1),z=0):z++;return this.adjacentFaces.push(W),J}toGoldbergPolyhedronData(){const G=new JG("GeoDual","Goldberg",[],[]);G.name="GD dual";const V=this.vertex.length,W=new Array(V);for(let X=0;X<V;X++)W[X]=[];for(let X=0;X<this.face.length;X++)for(let G=0;G<3;G++)W[this.face[X][G]].push(X);let J=0,R=0,d=0,k=[],z=[];this.adjacentFaces=[];for(let X=0;X<W.length;X++){G.face[X]=this.setOrder(X,W[X].concat([]));for(const V of W[X]){J=0,R=0,d=0,k=this.face[V];for(let G=0;G<3;G++)z=this.vertex[k[G]],J+=z[0],R+=z[1],d+=z[2];G.vertex[V]=[J/3,R/3,d/3]}}return G}static BuildGeodesicData(G){const V=new RG("Geodesic-m-n","Geodesic",[[0,GG.e,-1],[-GG.e,1,0],[-1,0,-GG.e],[1,0,-GG.e],[GG.e,1,0],[0,GG.e,1],[-1,0,GG.e],[-GG.e,-1,0],[0,-GG.e,-1],[GG.e,-1,0],[1,0,GG.e],[0,-GG.e,1]],[]);G.setIndices(),G.calcCoeffs(),G.createInnerFacets(),G.edgeVecsABOB(),G.mapABOBtoOBOA(),G.mapABOBtoBAOA();for(let W=0;W<G.IDATA.face.length;W++)G.MapToFace(W,V),V.innerToData(W,G),"B"===G.IDATA.edgematch[W][1]&&V.mapABOBtoDATA(W,G),"O"===G.IDATA.edgematch[W][1]&&V.mapOBOAtoDATA(W,G),"A"===G.IDATA.edgematch[W][3]&&V.mapBAOAtoDATA(W,G);V.orderData(G);return V.vertex=V.vertex.map((function(G){const V=G[0],W=G[1],J=G[2],R=Math.sqrt(V*V+W*W+J*J);return G[0]*=1/R,G[1]*=1/R,G[2]*=1/R,G})),V}}R.b._GoldbergMeshParser=(G,V)=>dG.Parse(G,V);class dG extends R.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(G,V){return void 0===V?(G>this.goldbergData.nbUnsharedFaces-1&&(O.c.Warn("Maximum number of unshared faces used"),G=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+G):(G>11&&(O.c.Warn("Last pole used"),G=11),V>this.goldbergData.nbFacesAtPole-1&&(O.c.Warn("Maximum number of faces at a pole used"),V=this.goldbergData.nbFacesAtPole-1),12+G*this.goldbergData.nbFacesAtPole+V)}_changeGoldbergFaceColors(G){for(let W=0;W<G.length;W++){const V=G[W][0],J=G[W][1],R=G[W][2];for(let G=V;G<J+1;G++)this.goldbergData.faceColors[G]=R}const V=[];for(let W=0;W<12;W++)for(let G=0;G<5;G++)V.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);for(let W=12;W<this.goldbergData.faceColors.length;W++)for(let G=0;G<6;G++)V.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);return V}setGoldbergFaceColors(G){const V=this._changeGoldbergFaceColors(G);this.wG(d.c.ColorKind,V)}updateGoldbergFaceColors(G){const V=this._changeGoldbergFaceColors(G);this.updateVerticesData(d.c.ColorKind,V)}_changeGoldbergFaceUVs(G){const V=this.getVerticesData(d.c.UVKind);for(let W=0;W<G.length;W++){const J=G[W][0],R=G[W][1],d=G[W][2],k=G[W][3],z=G[W][4],X=[],P=[];let A,x;for(let G=0;G<5;G++)A=d.x+k*Math.cos(z+G*Math.PI/2.5),x=d.y+k*Math.sin(z+G*Math.PI/2.5),A<0&&(A=0),A>1&&(A=1),X.push(A,x);for(let G=0;G<6;G++)A=d.x+k*Math.cos(z+G*Math.PI/3),x=d.y+k*Math.sin(z+G*Math.PI/3),A<0&&(A=0),A>1&&(A=1),P.push(A,x);for(let G=J;G<Math.min(12,R+1);G++)for(let W=0;W<5;W++)V[10*G+2*W]=X[2*W],V[10*G+2*W+1]=X[2*W+1];for(let G=Math.max(12,J);G<R+1;G++)for(let W=0;W<6;W++)V[12*G-24+2*W]=P[2*W],V[12*G-23+2*W]=P[2*W+1]}return V}setGoldbergFaceUVs(G){const V=this._changeGoldbergFaceUVs(G);this.wG(d.c.UVKind,V)}updateGoldbergFaceUVs(G){const V=this._changeGoldbergFaceUVs(G);this.updateVerticesData(d.c.UVKind,V)}placeOnGoldbergFaceAt(G,V,W){const R=J.o.RotationFromAxis(this.goldbergData.faceXaxis[V],this.goldbergData.faceYaxis[V],this.goldbergData.faceZaxis[V]);G.rotation=R,G.position=this.goldbergData.faceCenters[V].add(this.goldbergData.faceXaxis[V].scale(W.x)).add(this.goldbergData.faceYaxis[V].scale(W.y)).add(this.goldbergData.faceZaxis[V].scale(W.z))}serialize(G){super.serialize(G),G.type="GoldbergMesh";const V={};if(V.adjacentFaces=this.goldbergData.adjacentFaces,V.nbSharedFaces=this.goldbergData.nbSharedFaces,V.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,V.nbFaces=this.goldbergData.nbFaces,V.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){V.faceColors=[];for(const G of this.goldbergData.faceColors)V.faceColors.push(G.Bd())}if(this.goldbergData.faceCenters){V.faceCenters=[];for(const G of this.goldbergData.faceCenters)V.faceCenters.push(G.Bd())}if(this.goldbergData.faceZaxis){V.faceZaxis=[];for(const G of this.goldbergData.faceZaxis)V.faceZaxis.push(G.Bd())}if(this.goldbergData.faceYaxis){V.faceYaxis=[];for(const G of this.goldbergData.faceYaxis)V.faceYaxis.push(G.Bd())}if(this.goldbergData.faceXaxis){V.faceXaxis=[];for(const G of this.goldbergData.faceXaxis)V.faceXaxis.push(G.Bd())}G.goldbergData=V}static Parse(G,V){const W=G.goldbergData;W.faceColors=W.faceColors.map((G=>q.h.ld(G))),W.faceCenters=W.faceCenters.map((G=>J.o.ld(G))),W.faceZaxis=W.faceZaxis.map((G=>J.o.ld(G))),W.faceXaxis=W.faceXaxis.map((G=>J.o.ld(G))),W.faceYaxis=W.faceYaxis.map((G=>J.o.ld(G)));const R=new dG(G.name,V);return R.goldbergData=W,R}}var kG=W(11886);const zG={CreateBox:x.e,CreateTiledBox:g,CreateSphere:B.d,CreateDisc:A.e,CreateIcoSphere:M,CreateRibbon:P,CreateCylinder:r,CreateTorus:u,CreateTorusKnot:n,CreateLineSystem:D.i,IX:D.k,CreateDashedLines:D.e,ExtrudeShape:F,ExtrudeShapeCustom:f,CreateLathe:C,CreateTiledPlane:t,GP:l.d,CreateGround:m.g,CreateTiledGround:m.i,CreateGroundFromHeightMap:m.c,CreatePolygon:i.e,ExtrudePolygon:i.i,CreateTube:w,CreatePolyhedron:U,CreateGeodesic:function(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=V.m||1;J!==Math.floor(J)&&(J=Math.floor(J),O.c.Warn("m not an integer only floor(m) used"));let R=V.n||0;if(R!==Math.floor(R)&&(R=Math.floor(R),O.c.Warn("n not an integer only floor(n) used")),R>J){const G=R;R=J,J=G,O.c.Warn("n > m therefore m and n swapped")}const d=new WG;return d.build(J,R),U(G,{custom:RG.BuildGeodesicData(d),size:V.size,sizeX:V.sizeX,sizeY:V.sizeY,sizeZ:V.sizeZ,faceUV:V.faceUV,faceColors:V.faceColors,flat:V.flat,updatable:V.updatable,sideOrientation:V.sideOrientation,frontUVs:V.frontUVs,backUVs:V.backUVs},W)},CreateGoldberg:function(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=V.size,X=V.sizeX||d||1,P=V.sizeY||d||1,A=V.sizeZ||d||1;let x=V.m||1;x!==Math.floor(x)&&(x=Math.floor(x),O.c.Warn("m not an integer only floor(m) used"));let L=V.n||0;if(L!==Math.floor(L)&&(L=Math.floor(L),O.c.Warn("n not an integer only floor(n) used")),L>x){const G=L;L=x,x=G,O.c.Warn("n > m therefore m and n swapped")}const t=new WG;t.build(x,L);const Y=RG.BuildGeodesicData(t),g=Y.toGoldbergPolyhedronData(),B=new dG(G,W);V.sideOrientation=R.b._GetDefaultSideOrientation(V.sideOrientation),B._originalBuilderSideOrientation=V.sideOrientation;(function(G,V){const W=G.size,R=G.sizeX||W||1,d=G.sizeY||W||1,X=G.sizeZ||W||1,P=0===G.sideOrientation?0:G.sideOrientation||k.b.DEFAULTSIDE,A=[],x=[],q=[],L=[];let t=1/0,Y=-1/0,g=1/0,B=-1/0;for(let J=0;J<V.vertex.length;J++)t=Math.min(t,V.vertex[J][0]*R),Y=Math.max(Y,V.vertex[J][0]*R),g=Math.min(g,V.vertex[J][1]*d),B=Math.max(B,V.vertex[J][1]*d);let S=0;for(let k=0;k<V.face.length;k++){const G=V.face[k],W=J.o.ld(V.vertex[G[0]]),P=J.o.ld(V.vertex[G[2]]),p=J.o.ld(V.vertex[G[1]]),b=P.zW(W),r=p.zW(W),y=J.o.Cross(r,b).normalize();for(let J=0;J<G.length;J++){q.push(y.x,y.y,y.z);const W=V.vertex[G[J]];A.push(W[0]*R,W[1]*d,W[2]*X);const k=(W[1]*d-g)/(B-g);L.push((W[0]*R-t)/(Y-t),z.b?1-k:k)}for(let V=0;V<G.length-2;V++)x.push(S,S+V+2,S+V+1);S+=G.length}k.b._ComputeSides(P,A,x,q,L);const p=new k.b;return p.DG=A,p.indices=x,p.iG=q,p.FG=L,p})(V,g).vG(B,V.updatable),B.goldbergData.nbSharedFaces=Y.sharedNodes,B.goldbergData.nbUnsharedFaces=Y.poleNodes,B.goldbergData.adjacentFaces=Y.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let R=0;R<Y.vertex.length;R++)B.goldbergData.faceCenters.push(J.o.ld(Y.vertex[R])),B.goldbergData.faceCenters[R].x*=X,B.goldbergData.faceCenters[R].y*=P,B.goldbergData.faceCenters[R].z*=A,B.goldbergData.faceColors.push(new q.h(1,1,1,1));for(let R=0;R<g.face.length;R++){const G=g.face[R],V=J.o.ld(g.vertex[G[0]]),W=J.o.ld(g.vertex[G[2]]),d=J.o.ld(g.vertex[G[1]]),k=W.zW(V),z=d.zW(V),X=J.o.Cross(z,k).normalize(),P=J.o.Cross(z,X).normalize();B.goldbergData.faceXaxis.push(z.normalize()),B.goldbergData.faceYaxis.push(X),B.goldbergData.faceZaxis.push(P)}return B},CreateDecal:c,CreateCapsule:I,CreateText:kG.d}},12668:(G,V,W)=>{"use strict";W.d(V,{c:()=>zV});var J=W(11136),R=W(11794);class d extends R.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var k=W(11424),z=(W(11595),W(11159));class X{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(G){this._targetStopDuration!==G&&(this._targetStopDuration=G)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(G){this._noiseTexture!==G&&(this._noiseTexture=G,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(G){this._animationSheetEnabled!==G&&(this._animationSheetEnabled=G)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(G){this._isAnimationSheetEnabled!=G&&(this._isAnimationSheetEnabled=G,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(G){this._useLogarithmicDepth=G&&this.HG().getEngine().getCaps().fragmentDepthSupported}HG(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(G){switch(G){case X.BLENDMODE_MULTIPLYADD:return;case X.BLENDMODE_ADD:G=1;break;case X.BLENDMODE_ONEONE:G=6;break;case X.BLENDMODE_STANDARD:G=2;break;case X.BLENDMODE_MULTIPLY:G=4;break;case X.BLENDMODE_SUBTRACT:G=3}this._engine.setAlphaMode(G)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:J.o.Zero()}set direction1(G){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=G)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:J.o.Zero()}set direction2(G){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=G)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:J.o.Zero()}set minEmitBox(G){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=G)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:J.o.Zero()}set maxEmitBox(G){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=G)}get billboardMode(){return this._billboardMode}set billboardMode(G){this._billboardMode!==G&&(this._billboardMode=G,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(G){this._isBillboardBased!==G&&(this._isBillboardBased=G,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(G){this._attachImageProcessingConfiguration(G)}_attachImageProcessingConfiguration(G){G!==this._imageProcessingConfiguration&&(!G&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=G)}_reset(){}_removeGradientAndTexture(G,V,W){if(!V)return this;let J=0;for(const R of V){if(R.gradient===G){V.splice(J,1);break}J++}return W&&W.dispose(),this}constructor(G){this.animations=[],this.renderingGroupId=0,this.j=J.o.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new J.o(10,10,10),this.onAnimationEnd=null,this.blendMode=X.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new J.k(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.oX=new J.o(0,0,0),this._useLogarithmicDepth=!1,this.gravity=J.o.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new k.h(1,1,1,1),this.color2=new k.h(1,1,1,1),this.colorDead=new k.h(0,0,0,1),this.textureMask=new k.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new d,this.id=G,this.name=G}createPointEmitter(G,V){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new J.o(0,1,0),arguments.length>2&&void 0!==arguments[2]||new J.o(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new J.o(0,1,0),arguments.length>4&&void 0!==arguments[4]||new J.o(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new J.o(0,1,0),arguments.length>3&&void 0!==arguments[3]||new J.o(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(G,V,W,J){throw new Error("Method not implemented.")}}X.BLENDMODE_ONEONE=0,X.BLENDMODE_STANDARD=1,X.BLENDMODE_ADD=2,X.BLENDMODE_MULTIPLY=3,X.BLENDMODE_MULTIPLYADD=4,X.BLENDMODE_SUBTRACT=-1,(0,z.d)("BABYLON.BaseParticleSystem",X);var P=W(11182),A=W(11204);class x{constructor(){this.direction1=new J.o(0,1,0),this.direction2=new J.o(0,1,0),this.minEmitBox=new J.o(-.5,-.5,-.5),this.maxEmitBox=new J.o(.5,.5,.5)}startDirectionFunction(G,V,W,R){const d=(0,P.RandomRange)(this.direction1.x,this.direction2.x),k=(0,P.RandomRange)(this.direction1.y,this.direction2.y),z=(0,P.RandomRange)(this.direction1.z,this.direction2.z);if(R)return V.x=d,V.y=k,void(V.z=z);J.o.TransformNormalFromFloatsToRef(d,k,z,G,V)}startPositionFunction(G,V,W,R){const d=(0,P.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),k=(0,P.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),z=(0,P.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(R)return V.x=d,V.y=k,void(V.z=z);J.o.TransformCoordinatesFromFloatsToRef(d,k,z,G,V)}clone(){const G=new x;return A.d.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2),G.setVector3("minEmitBox",this.minEmitBox),G.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3),G.addUniform("minEmitBox",3),G.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.direction1=this.direction1.Bd(),G.direction2=this.direction2.Bd(),G.minEmitBox=this.minEmitBox.Bd(),G.maxEmitBox=this.maxEmitBox.Bd(),G}parse(G){J.o.FromArrayToRef(G.direction1,0,this.direction1),J.o.FromArrayToRef(G.direction2,0,this.direction2),J.o.FromArrayToRef(G.minEmitBox,0,this.minEmitBox),J.o.FromArrayToRef(G.maxEmitBox,0,this.maxEmitBox)}}class q{get radius(){return this._radius}set radius(G){this._radius=G,this._buildHeight()}get angle(){return this._angle}set angle(G){this._angle=G,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=W,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=V,this.radius=G}startDirectionFunction(G,V,W,R){R?J.h.ed[0].J(W.wz).normalize():W.position.subtractToRef(G.getTranslation(),J.h.ed[0]).normalize();const d=(0,P.RandomRange)(0,this.directionRandomizer),k=(0,P.RandomRange)(0,this.directionRandomizer),z=(0,P.RandomRange)(0,this.directionRandomizer);V.x=J.h.ed[0].x+d,V.y=J.h.ed[0].y+k,V.z=J.h.ed[0].z+z,V.normalize()}startPositionFunction(G,V,W,R){const d=(0,P.RandomRange)(0,2*Math.PI);let k;this.emitFromSpawnPointOnly?k=1e-4:(k=(0,P.RandomRange)(0,this.heightRange),k=1-k*k);let z=this._radius-(0,P.RandomRange)(0,this._radius*this.radiusRange);z*=k;const X=z*Math.sin(d),A=z*Math.cos(d),x=k*this._height;if(R)return V.x=X,V.y=x,void(V.z=A);J.o.TransformCoordinatesFromFloatsToRef(X,x,A,G,V)}clone(){const G=new q(this._radius,this._angle,this.directionRandomizer);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat2("radius",this._radius,this.radiusRange),G.setFloat("coneAngle",this._angle),G.setFloat2("height",this._height,this.heightRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",2),G.addUniform("coneAngle",1),G.addUniform("height",2),G.addUniform("directionRandomizer",1)}getEffectDefines(){let G="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(G+="\n#define CONEEMITTERSPAWNPOINT"),G}getClassName(){return"ConeParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this._radius,G.angle=this._angle,G.directionRandomizer=this.directionRandomizer,G.radiusRange=this.radiusRange,G.heightRange=this.heightRange,G.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,G}parse(G){this.radius=G.radius,this.angle=G.angle,this.directionRandomizer=G.directionRandomizer,this.radiusRange=void 0!==G.radiusRange?G.radiusRange:1,this.heightRange=void 0!==G.radiusRange?G.heightRange:1,this.emitFromSpawnPointOnly=void 0!==G.emitFromSpawnPointOnly&&G.emitFromSpawnPointOnly}}class L extends q{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0),R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0);super(G,V),this.direction1=W,this.direction2=R}startDirectionFunction(G,V){const W=(0,P.RandomRange)(this.direction1.x,this.direction2.x),R=(0,P.RandomRange)(this.direction1.y,this.direction2.y),d=(0,P.RandomRange)(this.direction1.z,this.direction2.z);J.o.TransformNormalFromFloatsToRef(W,R,d,G,V)}clone(){const G=new L(this.radius,this.angle,this.direction1,this.direction2);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.Bd(),G.direction2=this.direction2.Bd(),G}parse(G){super.parse(G),this.direction1.J(G.direction1),this.direction2.J(G.direction2)}}class t{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=G,this.height=V,this.radiusRange=W,this.directionRandomizer=R,this._tempVector=J.o.Zero()}startDirectionFunction(G,V,W,R,d){W.position.subtractToRef(G.getTranslation(),this._tempVector),this._tempVector.normalize(),J.o.TransformNormalToRef(this._tempVector,d,this._tempVector);const k=(0,P.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let z=Math.atan2(this._tempVector.x,this._tempVector.z);z+=(0,P.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=k,this._tempVector.x=Math.sin(z),this._tempVector.z=Math.cos(z),this._tempVector.normalize(),R?V.J(this._tempVector):J.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,G,V)}startPositionFunction(G,V,W,R){const d=(0,P.RandomRange)(-this.height/2,this.height/2),k=(0,P.RandomRange)(0,2*Math.PI),z=(0,P.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),X=Math.sqrt(z)*this.radius,A=X*Math.cos(k),x=X*Math.sin(k);R?V.rd(A,d,x):J.o.TransformCoordinatesFromFloatsToRef(A,d,x,G,V)}clone(){const G=new t(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("height",this.height),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("height",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this.radius,G.height=this.height,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.radius=G.radius,this.height=G.height,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class Y extends t{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.o(0,1,0);super(G,V,W),this.direction1=R,this.direction2=d}startDirectionFunction(G,V,W,R){const d=(0,P.RandomRange)(this.direction1.x,this.direction2.x),k=(0,P.RandomRange)(this.direction1.y,this.direction2.y),z=(0,P.RandomRange)(this.direction1.z,this.direction2.z);R?V.rd(d,k,z):J.o.TransformNormalFromFloatsToRef(d,k,z,G,V)}clone(){const G=new Y(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("height",this.height),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("height",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.Bd(),G.direction2=this.direction2.Bd(),G}parse(G){super.parse(G),J.o.FromArrayToRef(G.direction1,0,this.direction1),J.o.FromArrayToRef(G.direction2,0,this.direction2)}}class g{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=G,this.radiusRange=V,this.directionRandomizer=W}startDirectionFunction(G,V,W,R){const d=W.position.zW(G.getTranslation()).normalize(),k=(0,P.RandomRange)(0,this.directionRandomizer),z=(0,P.RandomRange)(0,this.directionRandomizer),X=(0,P.RandomRange)(0,this.directionRandomizer);d.x+=k,d.y+=z,d.z+=X,d.normalize(),R?V.J(d):J.o.TransformNormalFromFloatsToRef(d.x,d.y,d.z,G,V)}startPositionFunction(G,V,W,R){const d=this.radius-(0,P.RandomRange)(0,this.radius*this.radiusRange),k=(0,P.RandomRange)(0,1),z=(0,P.RandomRange)(0,2*Math.PI),X=Math.acos(2*k-1),A=d*Math.cos(z)*Math.sin(X),x=d*Math.cos(X),q=d*Math.sin(z)*Math.sin(X);R?V.rd(A,Math.abs(x),q):J.o.TransformCoordinatesFromFloatsToRef(A,Math.abs(x),q,G,V)}clone(){const G=new g(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this.radius,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.radius=G.radius,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class B{constructor(){this.direction1=new J.o(0,1,0),this.direction2=new J.o(0,1,0)}startDirectionFunction(G,V,W,R){const d=(0,P.RandomRange)(this.direction1.x,this.direction2.x),k=(0,P.RandomRange)(this.direction1.y,this.direction2.y),z=(0,P.RandomRange)(this.direction1.z,this.direction2.z);R?V.rd(d,k,z):J.o.TransformNormalFromFloatsToRef(d,k,z,G,V)}startPositionFunction(G,V,W,R){R?V.rd(0,0,0):J.o.TransformCoordinatesFromFloatsToRef(0,0,0,G,V)}clone(){const G=new B;return A.d.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.direction1=this.direction1.Bd(),G.direction2=this.direction2.Bd(),G}parse(G){J.o.FromArrayToRef(G.direction1,0,this.direction1),J.o.FromArrayToRef(G.direction2,0,this.direction2)}}class S{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=G,this.radiusRange=V,this.directionRandomizer=W}startDirectionFunction(G,V,W,R){const d=W.position.zW(G.getTranslation()).normalize(),k=(0,P.RandomRange)(0,this.directionRandomizer),z=(0,P.RandomRange)(0,this.directionRandomizer),X=(0,P.RandomRange)(0,this.directionRandomizer);d.x+=k,d.y+=z,d.z+=X,d.normalize(),R?V.J(d):J.o.TransformNormalFromFloatsToRef(d.x,d.y,d.z,G,V)}startPositionFunction(G,V,W,R){const d=this.radius-(0,P.RandomRange)(0,this.radius*this.radiusRange),k=(0,P.RandomRange)(0,1),z=(0,P.RandomRange)(0,2*Math.PI),X=Math.acos(2*k-1),A=d*Math.cos(z)*Math.sin(X),x=d*Math.cos(X),q=d*Math.sin(z)*Math.sin(X);R?V.rd(A,x,q):J.o.TransformCoordinatesFromFloatsToRef(A,x,q,G,V)}clone(){const G=new S(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this.radius,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.radius=G.radius,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class p extends S{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.o(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0);super(G),this.direction1=V,this.direction2=W}startDirectionFunction(G,V){const W=(0,P.RandomRange)(this.direction1.x,this.direction2.x),R=(0,P.RandomRange)(this.direction1.y,this.direction2.y),d=(0,P.RandomRange)(this.direction1.z,this.direction2.z);J.o.TransformNormalFromFloatsToRef(W,R,d,G,V)}clone(){const G=new p(this.radius,this.direction1,this.direction2);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.Bd(),G.direction2=this.direction2.Bd(),G}parse(G){super.parse(G),this.direction1.J(G.direction1),this.direction2.J(G.direction2)}}class b{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(G,V,W,R){const d=J.h.ed[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,W,d);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,W,d);const G=J.h.ed[1];d.subtractToRef(W.position,G),G.scaleToRef(1/W.lifeTime,d)}else d.set(0,0,0);R?V.J(d):J.o.TransformNormalToRef(d,G,V)}startPositionFunction(G,V,W,R){const d=J.h.ed[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,W,d):d.set(0,0,0),R?V.J(d):J.o.TransformCoordinatesToRef(d,G,V)}clone(){const G=new b;return A.d.DeepCopy(this,G),G}applyToShader(G){}buildUniformLayout(G){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.particlePositionGenerator=this.particlePositionGenerator,G.particleDestinationGenerator=this.particleDestinationGenerator,G}parse(G){G.particlePositionGenerator&&(this.particlePositionGenerator=G.particlePositionGenerator),G.particleDestinationGenerator&&(this.particleDestinationGenerator=G.particleDestinationGenerator)}}var r=W(11345);class y{get mesh(){return this._mesh}set mesh(G){this._mesh!==G&&(this._mesh=G,G?(this._indices=G.Pd(),this._positions=G.getVerticesData(r.c.PositionKind),this._normals=G.getVerticesData(r.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=J.o.Zero(),this._mesh=null,this.direction1=new J.o(0,1,0),this.direction2=new J.o(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=G}startDirectionFunction(G,V,W,R){if(this.useMeshNormalsForDirection&&this._normals)return void J.o.TransformNormalToRef(this._storedNormal,G,V);const d=(0,P.RandomRange)(this.direction1.x,this.direction2.x),k=(0,P.RandomRange)(this.direction1.y,this.direction2.y),z=(0,P.RandomRange)(this.direction1.z,this.direction2.z);R?V.rd(d,k,z):J.o.TransformNormalFromFloatsToRef(d,k,z,G,V)}startPositionFunction(G,V,W,R){if(!this._indices||!this._positions)return;const d=3*(Math.random()*(this._indices.length/3)|0),k=Math.random(),z=Math.random()*(1-k),X=1-k-z,P=this._indices[d],A=this._indices[d+1],x=this._indices[d+2],q=J.h.ed[0],L=J.h.ed[1],t=J.h.ed[2],Y=J.h.ed[3];J.o.FromArrayToRef(this._positions,3*P,q),J.o.FromArrayToRef(this._positions,3*A,L),J.o.FromArrayToRef(this._positions,3*x,t),Y.x=k*q.x+z*L.x+X*t.x,Y.y=k*q.y+z*L.y+X*t.y,Y.z=k*q.z+z*L.z+X*t.z,R?V.rd(Y.x,Y.y,Y.z):J.o.TransformCoordinatesFromFloatsToRef(Y.x,Y.y,Y.z,G,V),this.useMeshNormalsForDirection&&this._normals&&(J.o.FromArrayToRef(this._normals,3*P,q),J.o.FromArrayToRef(this._normals,3*A,L),J.o.FromArrayToRef(this._normals,3*x,t),this._storedNormal.x=k*q.x+z*L.x+X*t.x,this._storedNormal.y=k*q.y+z*L.y+X*t.y,this._storedNormal.z=k*q.z+z*L.z+X*t.z)}clone(){const G=new y(this.mesh);return A.d.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var G;const V={};return V.type=this.getClassName(),V.direction1=this.direction1.Bd(),V.direction2=this.direction2.Bd(),V.meshId=null===(G=this.mesh)||void 0===G?void 0:G.id,V.useMeshNormalsForDirection=this.useMeshNormalsForDirection,V}parse(G,V){J.o.FromArrayToRef(G.direction1,0,this.direction1),J.o.FromArrayToRef(G.direction2,0,this.direction2),G.meshId&&V&&(this.mesh=V.getLastMeshById(G.meshId)),this.useMeshNormalsForDirection=G.useMeshNormalsForDirection}}class u{_isUbo(G){return void 0!==G.addUniform}constructor(G){this._isUbo(G)?(this.setMatrix3x3=G.updateMatrix3x3.bind(G),this.setMatrix2x2=G.updateMatrix2x2.bind(G),this.setFloat=G.updateFloat.bind(G),this.setFloat2=G.updateFloat2.bind(G),this.setFloat3=G.updateFloat3.bind(G),this.setFloat4=G.updateFloat4.bind(G),this.setFloatArray=G.updateFloatArray.bind(G),this.setArray=G.updateArray.bind(G),this.setIntArray=G.updateIntArray.bind(G),this.setMatrix=G.Td.bind(G),this.setMatrices=G.updateMatrices.bind(G),this.setVector3=G.updateVector3.bind(G),this.setVector4=G.updateVector4.bind(G),this.setColor3=G.updateColor3.bind(G),this.setColor4=G.updateColor4.bind(G),this.setDirectColor4=G.updateDirectColor4.bind(G),this.setInt=G.updateInt.bind(G),this.setInt2=G.updateInt2.bind(G),this.setInt3=G.updateInt3.bind(G),this.setInt4=G.updateInt4.bind(G)):(this.setMatrix3x3=G.setMatrix3x3.bind(G),this.setMatrix2x2=G.setMatrix2x2.bind(G),this.setFloat=G.setFloat.bind(G),this.setFloat2=G.setFloat2.bind(G),this.setFloat3=G.setFloat3.bind(G),this.setFloat4=G.setFloat4.bind(G),this.setFloatArray=G.setFloatArray.bind(G),this.setArray=G.setArray.bind(G),this.setIntArray=G.setIntArray.bind(G),this.setMatrix=G.setMatrix.bind(G),this.setMatrices=G.setMatrices.bind(G),this.setVector3=G.setVector3.bind(G),this.setVector4=G.setVector4.bind(G),this.setColor3=G.setColor3.bind(G),this.setColor4=G.setColor4.bind(G),this.setDirectColor4=G.setDirectColor4.bind(G),this.setInt=G.setInt.bind(G),this.setInt2=G.setInt2.bind(G),this.setInt3=G.setInt3.bind(G),this.setInt4=G.setInt4.bind(G))}}var H=W(11270);const n="gpuUpdateParticlesPixelShader",D="#version 300 es\nvoid main() {discard;}\n";H.d.ShadersStore[n]||(H.d.ShadersStore[n]=D);const i="gpuUpdateParticlesVertexShader",e="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";H.d.ShadersStore[i]||(H.d.ShadersStore[i]=e);(0,z.d)("BABYLON.WebGL2ParticleSystem",class{constructor(G,V){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=G,this._engine=V,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var G;return(null===(G=this._updateEffect)||void 0===G?void 0:G.isReady())??!1}createUpdateBuffer(G){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof b&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=G,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new u(this._updateEffect)}createVertexBuffers(G,V){this._updateVAO.push(this._createUpdateVAO(G)),this._renderVAO.push(this._engine.recordVertexArrayObject(V,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=V}createParticleBuffer(G){return G}bindDrawBuffers(G,V,W){W?this._engine.bindBuffers(this._renderVertexBuffers,W,V):this._engine.bindVertexArrayObject(this._renderVAO[G],null)}preUpdateParticleBuffer(){const G=this._engine;if(this._engine.enableEffect(this._updateEffect),!G.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(G,V,W){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[G],null);const J=this._engine;J.bindTransformFeedbackBuffer(V.getBuffer()),J.setRasterizerState(!1),J.beginTransformFeedback(!0),J.drawArraysType(3,0,W),J.endTransformFeedback(),J.setRasterizerState(!0),J.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let G=0;G<this._updateVAO.length;G++)this._engine.releaseVertexArrayObject(this._updateVAO[G]);this._updateVAO.length=0;for(let G=0;G<this._renderVAO.length;G++)this._engine.releaseVertexArrayObject(this._renderVAO[G]);this._renderVAO.length=0}_createUpdateVAO(G){const V={};V.position=G.createVertexBuffer("position",0,3);let W=3;V.age=G.createVertexBuffer("age",W,1),W+=1,V.size=G.createVertexBuffer("size",W,3),W+=3,V.life=G.createVertexBuffer("life",W,1),W+=1,V.seed=G.createVertexBuffer("seed",W,4),W+=4,V.direction=G.createVertexBuffer("direction",W,3),W+=3,this._parent.particleEmitterType instanceof b&&(V.initialPosition=G.createVertexBuffer("initialPosition",W,3),W+=3),this._parent._colorGradientsTexture||(V.color=G.createVertexBuffer("color",W,4),W+=4),this._parent._isBillboardBased||(V.initialDirection=G.createVertexBuffer("initialDirection",W,3),W+=3),this._parent.noiseTexture&&(V.noiseCoordinates1=G.createVertexBuffer("noiseCoordinates1",W,3),W+=3,V.noiseCoordinates2=G.createVertexBuffer("noiseCoordinates2",W,3),W+=3),this._parent._angularSpeedGradientsTexture?(V.angle=G.createVertexBuffer("angle",W,1),W+=1):(V.angle=G.createVertexBuffer("angle",W,2),W+=2),this._parent._isAnimationSheetEnabled&&(V.cellIndex=G.createVertexBuffer("cellIndex",W,1),W+=1,this._parent.spriteRandomStartCell&&(V.cellStartOffset=G.createVertexBuffer("cellStartOffset",W,1),W+=1));const J=this._engine.recordVertexArrayObject(V,null,this._updateEffect);return this._engine.bindArrayBuffer(null),J}});class F{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,J=arguments.length>3?arguments[3]:void 0;this._engine=G,this._label=J,this._engine._storageBuffers.push(this),this._create(V,W)}_create(G,V){this._bufferSize=G,this._creationFlags=V,this._buffer=this._engine.createStorageBuffer(G,V,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(G,V,W){this._buffer&&this._engine.updateStorageBuffer(this._buffer,G,V,W)}async read(G,V,W,J){return await this._engine.readFromStorageBuffer(this._buffer,G,V,W,J)}dispose(){const G=this._engine._storageBuffers,V=G.indexOf(this);-1!==V&&(G[V]=G[G.length-1],G.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var f=W(11317),v=W(11324),C=W(11411),l=W(11666),m=W(11789),w=W(11201),N=W(11292),U=W(11654);class a{constructor(){this._gpuTimeInFrameId=-1,this.counter=new U.c}_addDuration(G,V){G<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==G?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(V,!1),this._gpuTimeInFrameId=G):this.counter.addCount(V,!1))}}var M=W(11254);class T{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=G,this._engine=V,this.uniqueId=m.e.UniqueId,V.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new a),this._engine.getCaps().supportComputeShaders?J.bindingsMapping?(this._context=V.createComputeContext(),this._shaderPath=W,this._options={bindingsMapping:{},defines:[],...J}):w.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):w.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=this._bindings[G];this._bindings[G]={type:W?0:4,object:V,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!J||J.object!==V||J.type!==this._bindings[G].type)}setStorageTexture(G,V){const W=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==V),this._bindings[G]={type:1,object:V,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setExternalTexture(G,V){const W=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==V),this._bindings[G]={type:6,object:V,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setVideoTexture(G,V){return!!V.externalTexture&&(this.setExternalTexture(G,V.externalTexture),!0)}setUniformBuffer(G,V){const W=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==V),this._bindings[G]={type:T._BufferIsDataBuffer(V)?7:2,object:V,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setStorageBuffer(G,V){const W=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==V),this._bindings[G]={type:T._BufferIsDataBuffer(V)?7:3,object:V,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setTextureSampler(G,V){const W=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!W||!V.compareSampler(W.object)),this._bindings[G]={type:5,object:V,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}isReady(){let G=this._effect;for(const R in this._bindings){const G=this._bindings[R],V=G.type,W=G.object;switch(V){case 0:case 4:case 1:if(!W.isReady())return!1;break;case 6:if(!W.isReady())return!1;break}}const V=[],W=this._shaderPath;if(this._options.defines)for(let R=0;R<this._options.defines.length;R++)V.push(this._options.defines[R]);const J=V.join("\n");return this._cachedDefines!==J&&(this._cachedDefines=J,G=this._engine.createComputeEffect(W,{defines:J,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=G),!!G.isReady()}dispatch(G,V,W){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,G,V,W,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const W=T._BufferIsDataBuffer(G)?G:G.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,W,V,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const V in this._bindings){const W=this._bindings[V];if(!this._options.bindingsMapping[V])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+V+"'");switch(W.type){case 0:{const J=this._samplers[V],R=W.object;var G;if(!J||!R._texture||!J.compareSampler(R._texture))this._samplers[V]=(new N.b).setParameters(R.wrapU,R.wrapV,R.wrapR,R.anisotropicFilteringLevel,R._texture.samplingMode,null===(G=R._texture)||void 0===G?void 0:G._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const G=W.object;G.getBuffer()!==W.buffer&&(W.buffer=G.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((R=>{(0,M.f)((()=>this.dispatch(G,V,W)),R,void 0,J)}))}serialize(){const G=C.e.Serialize(this);G.options=this._options,G.shaderPath=this._shaderPath,G.sx={},G.textures={};for(const V in this._bindings){const W=this._bindings[V],J=W.object;switch(W.type){case 0:case 4:case 1:{const R=J.serialize();R&&(G.textures[V]=R,G.sx[V]={type:W.type});break}}}return G}static Parse(G,V,W){const J=C.e.Parse((()=>new T(G.name,V.getEngine(),G.shaderPath,G.options)),G,V,W);for(const R in G.textures){const d=G.sx[R],k=l.d.Parse(G.textures[R],V,W);0===d.type?J.setTexture(R,k):4===d.type?J.setTexture(R,k,!1):J.setStorageTexture(R,k)}return J}static _BufferIsDataBuffer(G){return void 0!==G.underlyingResource}}(0,f.e)([(0,v.I)()],T.prototype,"name",void 0),(0,f.e)([(0,v.I)()],T.prototype,"fastMode",void 0),(0,z.d)("BABYLON.ComputeShader",T);var K=W(11400);const s="gpuUpdateParticlesComputeShader",Q="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";H.d.ShadersStoreWGSL[s]||(H.d.ShadersStoreWGSL[s]=Q);(0,z.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(G,V){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=G,this._engine=V}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var G;return(null===(G=this._updateComputeShader)||void 0===G?void 0:G.isReady())??!1}createUpdateBuffer(G){var V;const W={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(W.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(W.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(W.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(W.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(W.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(W.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(W.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new T("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:W,defines:G.split("\n")}),null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=new K.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new u(this._simParamsComputeShader)}createVertexBuffers(G,V){this._renderVertexBuffers.push(V)}createParticleBuffer(G){const V=new F(this._engine,4*G.length,11,"ComputeShaderParticleSystemBuffer");return V.update(G),this._bufferComputeShader.push(V),V.getBuffer()}bindDrawBuffers(G,V,W){this._engine.bindBuffers(this._renderVertexBuffers[G],W,V)}preUpdateParticleBuffer(){}updateParticleBuffer(G,V,W){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[G]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^G]),this._updateComputeShader.dispatch(Math.ceil(W/64))}releaseBuffers(){var G;for(let V=0;V<this._bufferComputeShader.length;++V)this._bufferComputeShader[V].dispose();this._bufferComputeShader.length=0,null===(G=this._simParamsComputeShader)||void 0===G||G.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Z{constructor(G,V,W){this.gradient=G,this.color1=V,this.color2=W}getColorToRef(G){this.color2?k.h.LerpToRef(this.color1,this.color2,Math.random(),G):G.J(this.color1)}}class E{constructor(G,V){this.gradient=G,this.color=V}}class h{constructor(G,V,W){this.gradient=G,this.factor1=V,this.factor2=W}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class o{static GetCurrentGradient(G,V,W){if(V[0].gradient>G)return void W(V[0],V[0],1);for(let R=0;R<V.length-1;R++){const J=V[R],d=V[R+1];if(G>=J.gradient&&G<=d.gradient){return void W(J,d,(G-J.gradient)/(d.gradient-J.gradient))}}const J=V.length-1;W(V[J],V[J],1)}}var c=W(11176),j=W(11701),I=W(11169);class O{constructor(G){this.particleSystem=G,this.position=J.o.Zero(),this.direction=J.o.Zero(),this.color=new k.h(0,0,0,0),this.colorStep=new k.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new J.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new k.h(0,0,0,0),this._currentColor2=new k.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=O._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let G=this.age,V=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===V?(V=1,G=this._randomCellOffset):G+=this._randomCellOffset);const W=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let J;J=this._initialSpriteCellLoop?(0,P.Clamp)(G*V%this.lifeTime/this.lifeTime):(0,P.Clamp)(G*V/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+J*W|0}_inheritParticleInfoToSubEmitter(G){if(G.particleSystem.j.position){const V=G.particleSystem.j;if(V.position.J(this.position),G.inheritDirection){const G=J.h.ed[0];this.direction.normalizeToRef(G),V.setDirection(G,0,Math.PI/2)}}else{G.particleSystem.j.J(this.position)}this.direction.scaleToRef(G.inheritedVelocityAmount/2,J.h.ed[0]),G.particleSystem._inheritedVelocityOffset.J(J.h.ed[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const G of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(G)}_reset(){this.age=0,this.id=O._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(G){G.position.J(this.position),this._initialDirection?G._initialDirection?G._initialDirection.J(this._initialDirection):G._initialDirection=this._initialDirection.clone():G._initialDirection=null,G.direction.J(this.direction),this.wz&&(G.wz?G.wz.J(this.wz):G.wz=this.wz.clone()),G.color.J(this.color),G.colorStep.J(this.colorStep),G.lifeTime=this.lifeTime,G.age=this.age,G._randomCellOffset=this._randomCellOffset,G.size=this.size,G.scale.J(this.scale),G.angle=this.angle,G.angularSpeed=this.angularSpeed,G.particleSystem=this.particleSystem,G.cellIndex=this.cellIndex,G.id=this.id,G._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(G._currentColorGradient=this._currentColorGradient,G._currentColor1.J(this._currentColor1),G._currentColor2.J(this._currentColor2)),this._currentSizeGradient&&(G._currentSizeGradient=this._currentSizeGradient,G._currentSize1=this._currentSize1,G._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(G._currentAngularSpeedGradient=this._currentAngularSpeedGradient,G._currentAngularSpeed1=this._currentAngularSpeed1,G._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(G._currentVelocityGradient=this._currentVelocityGradient,G._currentVelocity1=this._currentVelocity1,G._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(G._currentLimitVelocityGradient=this._currentLimitVelocityGradient,G._currentLimitVelocity1=this._currentLimitVelocity1,G._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(G._currentDragGradient=this._currentDragGradient,G._currentDrag1=this._currentDrag1,G._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(G._initialStartSpriteCellId=this._initialStartSpriteCellId,G._initialEndSpriteCellId=this._initialEndSpriteCellId,G._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(G.remapData&&this.remapData?G.remapData.J(this.remapData):G.remapData=new J.q(0,0,0,0)),this._randomNoiseCoordinates1&&(G._randomNoiseCoordinates1?(G._randomNoiseCoordinates1.J(this._randomNoiseCoordinates1),G._randomNoiseCoordinates2.J(this._randomNoiseCoordinates2)):(G._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),G._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}O._Count=0;var GG=W(11392),VG=(W(11593),W(11449)),WG=W(11432),JG=W(11755);function RG(G,V){const W=(0,P.RandomRange)(0,1);k.h.LerpToRef(V.color1,V.color2,W,G.color),V.colorDead.subtractToRef(G.color,V._colorDiff),V._colorDiff.scaleToRef(1/G.lifeTime,G.colorStep)}function dG(G,V){G._currentColorGradient=V._colorGradients[0],G._currentColorGradient.getColorToRef(G.color),G._currentColor1.J(G.color),V._colorGradients.length>1?V._colorGradients[1].getColorToRef(G._currentColor2):G._currentColor2.J(G.color)}function kG(G,V){const W=V._colorGradients;o.GetCurrentGradient(V._ratio,W,((V,W,J)=>{V!==G._currentColorGradient&&(G._currentColor1.J(G._currentColor2),W.getColorToRef(G._currentColor2),G._currentColorGradient=V),k.h.LerpToRef(G._currentColor1,G._currentColor2,J,G.color)}))}function zG(G,V){G.colorStep.scaleToRef(V._scaledUpdateSpeed,V._scaledColorStep),G.color.addInPlace(V._scaledColorStep),G.color.a<0&&(G.color.a=0)}function XG(G,V){o.GetCurrentGradient(V._ratio,V._angularSpeedGradients,((V,W,J)=>{V!==G._currentAngularSpeedGradient&&(G._currentAngularSpeed1=G._currentAngularSpeed2,G._currentAngularSpeed2=W.getFactor(),G._currentAngularSpeedGradient=V),G.angularSpeed=(0,P.Lerp)(G._currentAngularSpeed1,G._currentAngularSpeed2,J)}))}function PG(G,V){G.angle+=G.angularSpeed*V._scaledUpdateSpeed}function AG(G,V){V.particleEmitterType.startDirectionFunction(V._emitterWorldMatrix,G.direction,G,V.isLocal,V._emitterInverseWorldMatrix)}function xG(G,V){V.startDirectionFunction(V._emitterWorldMatrix,G.direction,G,V.isLocal)}function qG(G,V){G._currentVelocityGradient=V._velocityGradients[0],G._currentVelocity1=G._currentVelocityGradient.getFactor(),V._velocityGradients.length>1?G._currentVelocity2=V._velocityGradients[1].getFactor():G._currentVelocity2=G._currentVelocity1}function LG(G,V){G._currentLimitVelocityGradient=V._limitVelocityGradients[0],G._currentLimitVelocity1=G._currentLimitVelocityGradient.getFactor(),V._limitVelocityGradients.length>1?G._currentLimitVelocity2=V._limitVelocityGradients[1].getFactor():G._currentLimitVelocity2=G._currentLimitVelocity1}function tG(G,V){o.GetCurrentGradient(V._ratio,V._velocityGradients,((W,J,R)=>{W!==G._currentVelocityGradient&&(G._currentVelocity1=G._currentVelocity2,G._currentVelocity2=J.getFactor(),G._currentVelocityGradient=W),V._directionScale*=(0,P.Lerp)(G._currentVelocity1,G._currentVelocity2,R)}))}function YG(G,V){o.GetCurrentGradient(V._ratio,V._limitVelocityGradients,((W,J,R)=>{W!==G._currentLimitVelocityGradient&&(G._currentLimitVelocity1=G._currentLimitVelocity2,G._currentLimitVelocity2=J.getFactor(),G._currentLimitVelocityGradient=W);const d=(0,P.Lerp)(G._currentLimitVelocity1,G._currentLimitVelocity2,R);G.direction.length()>d&&G.direction.scaleInPlace(V.limitVelocityDamping)}))}function gG(G,V){G.direction.scaleToRef(V._directionScale,V._scaledDirection)}function BG(G,V){V.particleEmitterType.startPositionFunction(V._emitterWorldMatrix,G.position,G,V.isLocal)}function SG(G,V){V.startPositionFunction(V._emitterWorldMatrix,G.position,G,V.isLocal)}function pG(G,V){G.wz?G.wz.J(G.position):G.wz=G.position.clone(),J.o.TransformCoordinatesToRef(G.wz,V._emitterWorldMatrix,G.position)}function bG(G,V){V.isLocal&&G.wz?(G.wz.addInPlace(V._scaledDirection),J.o.TransformCoordinatesToRef(G.wz,V._emitterWorldMatrix,G.position)):G.position.addInPlace(V._scaledDirection)}function rG(G,V){G._currentDragGradient=V._dragGradients[0],G._currentDrag1=G._currentDragGradient.getFactor(),V._dragGradients.length>1?G._currentDrag2=V._dragGradients[1].getFactor():G._currentDrag2=G._currentDrag1}function yG(G,V){o.GetCurrentGradient(V._ratio,V._dragGradients,((W,J,R)=>{W!==G._currentDragGradient&&(G._currentDrag1=G._currentDrag2,G._currentDrag2=J.getFactor(),G._currentDragGradient=W);const d=(0,P.Lerp)(G._currentDrag1,G._currentDrag2,R);V._scaledDirection.scaleInPlace(1-d)}))}function uG(G,V){G._randomNoiseCoordinates1?(G._randomNoiseCoordinates1.rd(Math.random(),Math.random(),Math.random()),G._randomNoiseCoordinates2.rd(Math.random(),Math.random(),Math.random())):(G._randomNoiseCoordinates1=new J.o(Math.random(),Math.random(),Math.random()),G._randomNoiseCoordinates2=new J.o(Math.random(),Math.random(),Math.random()))}function HG(G,V){const W=V._noiseTextureData,R=V._noiseTextureSize;if(W&&R&&G._randomNoiseCoordinates1){const d=V._fetchR(G._randomNoiseCoordinates1.x,G._randomNoiseCoordinates1.y,R.width,R.height,W),k=V._fetchR(G._randomNoiseCoordinates1.z,G._randomNoiseCoordinates2.x,R.width,R.height,W),z=V._fetchR(G._randomNoiseCoordinates2.y,G._randomNoiseCoordinates2.z,R.width,R.height,W),X=J.h.ed[0],P=J.h.ed[1];X.rd((2*d-1)*V.noiseStrength.x,(2*k-1)*V.noiseStrength.y,(2*z-1)*V.noiseStrength.z),X.scaleToRef(V._tempScaledUpdateSpeed,P),G.direction.addInPlace(P)}}function nG(G,V){V.gravity.scaleToRef(V._tempScaledUpdateSpeed,V._scaledGravity),G.direction.addInPlace(V._scaledGravity)}function DG(G,V){G.size=(0,P.RandomRange)(V.minSize,V.maxSize),G.scale.rd((0,P.RandomRange)(V.minScaleX,V.maxScaleX),(0,P.RandomRange)(V.minScaleY,V.maxScaleY))}function iG(G,V){G._currentSizeGradient=V._sizeGradients[0],G._currentSize1=G._currentSizeGradient.getFactor(),G.size=G._currentSize1,V._sizeGradients.length>1?G._currentSize2=V._sizeGradients[1].getFactor():G._currentSize2=G._currentSize1,G.scale.rd((0,P.RandomRange)(V.minScaleX,V.maxScaleX),(0,P.RandomRange)(V.minScaleY,V.maxScaleY))}function eG(G,V){const W=V._actualFrame/V.targetStopDuration;o.GetCurrentGradient(W,V._startSizeGradients,((W,J,R)=>{W!==V._currentStartSizeGradient&&(V._currentStartSize1=V._currentStartSize2,V._currentStartSize2=J.getFactor(),V._currentStartSizeGradient=W);const d=(0,P.Lerp)(V._currentStartSize1,V._currentStartSize2,R);G.scale.scaleInPlace(d)}))}function FG(G,V){o.GetCurrentGradient(V._ratio,V._sizeGradients,((V,W,J)=>{V!==G._currentSizeGradient&&(G._currentSize1=G._currentSize2,G._currentSize2=W.getFactor(),G._currentSizeGradient=V),G.size=(0,P.Lerp)(G._currentSize1,G._currentSize2,J)}))}function fG(G,V){G.remapData=new J.q(0,1,0,1)}function vG(G,V){V._colorRemapGradients&&V._colorRemapGradients.length>0&&o.GetCurrentGradient(V._ratio,V._colorRemapGradients,((V,W,J)=>{const R=(0,P.Lerp)(V.factor1,W.factor1,J),d=(0,P.Lerp)(V.factor2,W.factor2,J);G.remapData.x=R,G.remapData.y=d-R})),V._alphaRemapGradients&&V._alphaRemapGradients.length>0&&o.GetCurrentGradient(V._ratio,V._alphaRemapGradients,((V,W,J)=>{const R=(0,P.Lerp)(V.factor1,W.factor1,J),d=(0,P.Lerp)(V.factor2,W.factor2,J);G.remapData.z=R,G.remapData.w=d-R}))}function CG(G,V){const W=(0,P.Clamp)(V._actualFrame/V.targetStopDuration);o.GetCurrentGradient(W,V._lifeTimeGradients,((V,J)=>{const R=V,d=J,k=R.getFactor(),z=d.getFactor(),X=(W-R.gradient)/(d.gradient-R.gradient);G.lifeTime=(0,P.Lerp)(k,z,X)})),V._emitPower=(0,P.RandomRange)(V.minEmitPower,V.maxEmitPower)}function lG(G,V){G.lifeTime=(0,P.RandomRange)(V.minLifeTime,V.maxLifeTime),V._emitPower=(0,P.RandomRange)(V.minEmitPower,V.maxEmitPower)}function mG(G,V){0===V._emitPower?(G._initialDirection?G._initialDirection.J(G.direction):G._initialDirection=G.direction.clone(),G.direction.set(0,0,0)):(G._initialDirection=null,G.direction.scaleInPlace(V._emitPower)),G.direction.addInPlace(V._inheritedVelocityOffset)}function wG(G,V){G.angularSpeed=(0,P.RandomRange)(V.minAngularSpeed,V.maxAngularSpeed),G.angle=(0,P.RandomRange)(V.minInitialRotation,V.maxInitialRotation)}function NG(G,V){G._currentAngularSpeedGradient=V._angularSpeedGradients[0],G.angularSpeed=G._currentAngularSpeedGradient.getFactor(),G._currentAngularSpeed1=G.angularSpeed,V._angularSpeedGradients.length>1?G._currentAngularSpeed2=V._angularSpeedGradients[1].getFactor():G._currentAngularSpeed2=G._currentAngularSpeed1,G.angle=(0,P.RandomRange)(V.minInitialRotation,V.maxInitialRotation)}function UG(G,V){G._initialStartSpriteCellId=V.startSpriteCellID,G._initialEndSpriteCellId=V.endSpriteCellID,G._initialSpriteCellLoop=V.spriteCellLoop}function aG(G,V){G.previousItem=V.previousItem,G.nextItem=V,V.previousItem&&(V.previousItem.nextItem=G),V.previousItem=G}function MG(G,V){G.previousItem=V,G.nextItem=V.nextItem,V.nextItem&&(V.nextItem.previousItem=G),V.nextItem=G}function TG(G,V){let W=V;for(;W.nextItem;)W=W.nextItem;G.previousItem=W,G.nextItem=W.nextItem,W.nextItem=G}function KG(G){G.previousItem&&(G.previousItem.nextItem=G.nextItem),G.nextItem&&(G.nextItem.previousItem=G.previousItem)}class sG extends X{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(G){this._startDirectionFunction!==G&&(this._startDirectionFunction=G,this._directionProcessing.process=G?xG:AG)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(G){this._startPositionFunction!==G&&(this._startPositionFunction=G,this._positionCreation.process=G?SG:BG)}set onDispose(G){this._onDisposeObserver&&this.Md.remove(this._onDisposeObserver),this._onDisposeObserver=this.Md.add(G)}get P(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(G){this._useRampGradients!==G&&(this._useRampGradients=G,this._resetEffect(),G?(this._rampCreation={process:fG,previousItem:null,nextItem:null},MG(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:vG,previousItem:null,nextItem:null},MG(this._remapGradientProcessing,this._gravityProcessing)):(KG(this._rampCreation),KG(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(G){this._isLocal!==G&&(this._isLocal=G,G?(this._isLocalCreation={process:pG,previousItem:null,nextItem:null},MG(this._isLocalCreation,this._positionCreation)):KG(this._isLocalCreation))}get particles(){return this.Nx}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(G){this._animationSheetEnabled!==G&&(this._animationSheetEnabled=G,G?(this._sheetCreation={process:UG,previousItem:null,nextItem:null},MG(this._sheetCreation,this._colorCreation)):KG(this._sheetCreation),this._reset())}getActiveCount(){return this.Nx.length}getClassName(){return"nx"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var G;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._customWrappers[V])||void 0===G?void 0:G.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[G]??this._customWrappers[0]}setCustomEffect(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[V]=new GG.c(this._engine),this._customWrappers[V].effect=G,this._customWrappers[V].drawContext&&(this._customWrappers[V].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new c.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(G){if(this.noiseTexture!==G){if(this._noiseTexture=G,!G)return KG(this._noiseCreation),void KG(this._noiseProcessing);this._noiseCreation={process:uG,previousItem:null,nextItem:null},MG(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:HG,previousItem:null,nextItem:null},MG(this._noiseProcessing,this._positionProcessing)}}constructor(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(G),this._emitterInverseWorldMatrix=J.c.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new J.o,this.Md=new c.b,this.onStoppedObservable=new c.b,this.onStartedObservable=new c.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Nx=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new k.h(0,0,0,0),this._colorDiff=new k.h(0,0,0,0),this._scaledDirection=J.o.Zero(),this._scaledGravity=J.o.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=G=>{},this.recycleParticle=G=>{const V=this.Nx.pop();V!==G&&V.copyTo(G),this._stockParticles.push(V)},this._createParticle=()=>{let G;return 0!==this._stockParticles.length?(G=this._stockParticles.pop(),G._reset()):G=new O(this),this._prepareParticle(G),G},this.paused=!1,this._shadersLoaded=!1,this._capacity=V,this._epsilon=z,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=J.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||I.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.mx.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:lG,previousItem:null,nextItem:null},this._positionCreation={process:BG,previousItem:null,nextItem:null},MG(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:AG,previousItem:null,nextItem:null},MG(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:mG,previousItem:null,nextItem:null},MG(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:DG,previousItem:null,nextItem:null},MG(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:wG,previousItem:null,nextItem:null},MG(this._angleCreation,this._sizeCreation),this._colorCreation={process:RG,previousItem:null,nextItem:null},MG(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,X||(this._colorProcessing={process:zG,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:PG,previousItem:null,nextItem:null},MG(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:gG,previousItem:null,nextItem:null},MG(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:bG,previousItem:null,nextItem:null},MG(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:nG,previousItem:null,nextItem:null},MG(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=d,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new GG.c(this._engine)},this._customWrappers[0].effect=R,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new x,this.updateFunction=G=>{var V;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(V=this.noiseTexture.getContent())||void 0===V||V.then((G=>{this._noiseTextureData=G})));const W=G===this.Nx;for(let J=0;J<G.length;J++){const V=G[J];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const R=V.age;if(V.age+=this._tempScaledUpdateSpeed,V.age>V.lifeTime){const G=V.age-R,W=V.lifeTime-R;this._tempScaledUpdateSpeed=W*this._tempScaledUpdateSpeed/G,V.age=V.lifeTime}this._ratio=V.age/V.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let d=this._updateQueueStart;for(;d;)d.process(V,this),d=d.nextItem;if(this._isAnimationSheetEnabled&&!X&&V.updateCellIndex(),V._inheritParticleInfoToSubEmitters(),V.age>=V.lifeTime){if(this._emitFromParticle(V),V._attachedSubEmitters){for(const G of V._attachedSubEmitters)G.particleSystem.disposeOnStop=!0,G.particleSystem.stop();V._attachedSubEmitters=null}this.recycleParticle(V),W&&J--}else;}}}serialize(G){throw new Error("Method not implemented.")}clone(G,V){throw new Error("Method not implemented.")}_addFactorGradient(G,V,W,J){const R=new h(V,W,J);G.push(R),G.sort(((G,V)=>G.gradient<V.gradient?-1:G.gradient>V.gradient?1:0))}_removeFactorGradient(G,V){if(!G)return;let W=0;for(const J of G){if(J.gradient===V){G.splice(W,1);break}W++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=CG:this._lifeTimeCreation.process=lG}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:eG,previousItem:null,nextItem:null},MG(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(KG(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(G){this.targetStopDuration!==G&&(this._targetStopDuration=G,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(G,V,W){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,G,V,W),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(G){return this._removeFactorGradient(this._lifeTimeGradients,G),this._syncLifeTimeCreation(),this}addSizeGradient(G,V,W){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=iG,this._sizeGradientProcessing={process:FG,previousItem:null,nextItem:null},aG(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,G,V,W),this}removeSizeGradient(G){var V;return this._removeFactorGradient(this._sizeGradients,G),0===(null===(V=this._sizeGradients)||void 0===V?void 0:V.length)&&(KG(this._sizeGradientProcessing),this._sizeCreation.process=DG),this}addColorRemapGradient(G,V,W){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,G,V,W),this}removeColorRemapGradient(G){return this._removeFactorGradient(this._colorRemapGradients,G),this}addAlphaRemapGradient(G,V,W){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,G,V,W),this}removeAlphaRemapGradient(G){return this._removeFactorGradient(this._alphaRemapGradients,G),this}addAngularSpeedGradient(G,V,W){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=NG,this._angularSpeedGradientProcessing={process:XG,previousItem:null,nextItem:null},aG(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,G,V,W),this}removeAngularSpeedGradient(G){var V;return this._removeFactorGradient(this._angularSpeedGradients,G),0===(null===(V=this._angularSpeedGradients)||void 0===V?void 0:V.length)&&(this._angleCreation.process=wG,KG(this._angularSpeedGradientProcessing)),this}addVelocityGradient(G,V,W){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:qG,previousItem:null,nextItem:null},MG(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:tG,previousItem:null,nextItem:null},aG(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,G,V,W),this}removeVelocityGradient(G){var V;return this._removeFactorGradient(this._velocityGradients,G),0===(null===(V=this._velocityGradients)||void 0===V?void 0:V.length)&&(KG(this._velocityCreation),KG(this._velocityGradientProcessing)),this}addLimitVelocityGradient(G,V,W){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:LG,previousItem:null,nextItem:null},MG(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:YG,previousItem:null,nextItem:null},MG(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,G,V,W),this}removeLimitVelocityGradient(G){var V;return this._removeFactorGradient(this._limitVelocityGradients,G),0===(null===(V=this._limitVelocityGradients)||void 0===V?void 0:V.length)&&(KG(this._limitVelocityCreation),KG(this._limitVelocityGradientProcessing)),this}addDragGradient(G,V,W){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:rG,previousItem:null,nextItem:null},aG(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:yG,previousItem:null,nextItem:null},aG(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,G,V,W),this}removeDragGradient(G){var V;return this._removeFactorGradient(this._dragGradients,G),0===(null===(V=this._dragGradients)||void 0===V?void 0:V.length)&&(KG(this._dragCreation),KG(this._dragGradientProcessing)),this}addEmitRateGradient(G,V,W){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,G,V,W),this}removeEmitRateGradient(G){return this._removeFactorGradient(this._emitRateGradients,G),this}addStartSizeGradient(G,V,W){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,G,V,W),this._syncStartSizeCreation(),this}removeStartSizeGradient(G){return this._removeFactorGradient(this._startSizeGradients,G),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const G=new Uint8Array(4*this._rawTextureWidth),V=k.j.pz[0];for(let W=0;W<this._rawTextureWidth;W++){const J=W/this._rawTextureWidth;o.GetCurrentGradient(J,this._rampGradients,((J,R,d)=>{k.d.LerpToRef(J.color,R.color,d,V),G[4*W]=255*V.r,G[4*W+1]=255*V.g,G[4*W+2]=255*V.b,G[4*W+3]=255}))}this._rampGradientsTexture=j.b.CreateRGBATexture(G,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((G,V)=>G.gradient<V.gradient?-1:G.gradient>V.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(G,V){this._rampGradients||(this._rampGradients=[]);const W=new E(G,V);return this._rampGradients.push(W),this._syncRampGradientTexture(),this}removeRampGradient(G){return this._removeGradientAndTexture(G,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(G,V,W){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=dG,this._colorProcessing.process=kG);const J=new Z(G,V,W);return this._colorGradients.push(J),this._colorGradients.sort(((G,V)=>G.gradient<V.gradient?-1:G.gradient>V.gradient?1:0)),this}removeColorGradient(G){if(!this._colorGradients)return this;let V=0;for(const W of this._colorGradients){if(W.gradient===G){this._colorGradients.splice(V,1);break}V++}return 0===this._colorGradients.length&&(this._colorCreation.process=RG,this._colorProcessing.process=zG),this}resetDrawCache(){if(this._drawWrappers){for(const G of this._drawWrappers)if(G)for(const V of G)null===V||void 0===V||V.dispose();this._drawWrappers=[]}}_fetchR(G,V,W,J,R){return R[4*(((G=.5*Math.abs(G)+.5)*W%W|0)+((V=.5*Math.abs(V)+.5)*J%J|0)*W)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const G=this._engine,V=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*V),this._vertexBuffer=new r.b(G,this._vertexData,!0,V);let W=0;const J=this._vertexBuffer.createVertexBuffer(r.c.PositionKind,W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.c.PositionKind]=J,W+=3;const R=this._vertexBuffer.createVertexBuffer(r.c.ColorKind,W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.c.ColorKind]=R,W+=4;const d=this._vertexBuffer.createVertexBuffer("angle",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=d,W+=1;const k=this._vertexBuffer.createVertexBuffer("size",W,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=k,W+=2,this._isAnimationSheetEnabled){const G=this._vertexBuffer.createVertexBuffer("cellIndex",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=G,W+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const G=this._vertexBuffer.createVertexBuffer("direction",W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=G,W+=3}if(this._useRampGradients){const G=this._vertexBuffer.createVertexBuffer("remapData",W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=G,W+=4}let z;if(this._useInstancing){const V=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new r.b(G,V,!1,2),z=this._spriteBuffer.createVertexBuffer("offset",0,2)}else z=this._vertexBuffer.createVertexBuffer("offset",W,2,this._vertexBufferSize,this._useInstancing),W+=2;this._vertexBuffers.offset=z,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const G=[],V=[];let W=0;for(let J=0;J<this._capacity;J++)G.push(W),G.push(W+1),G.push(W+2),G.push(W),G.push(W+2),G.push(W+3),V.push(W,W+1,W+1,W+2,W+2,W+3,W+3,W,W,W+3),W+=4;this._indexBuffer=this._engine.createIndexBuffer(G),this._linesIndexBuffer=this._engine.createIndexBuffer(V)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(G)setTimeout((()=>{this.start(0)}),G);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var V;-1!==(null===(V=this.j)||void 0===V?void 0:V.getClassName().indexOf("Mesh"))&&this.j.kd(!0);const G=this.noiseTexture;if(G&&G.onGeneratedObservable)G.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),G.render()}))}));else for(let V=0;V<this.preWarmCycles;V++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(G))}_postStop(G){}reset(){this._stockParticles.length=0,this.Nx.length=0}_appendParticleVertex(G,V,W,R){let d=G*this._vertexBufferSize;if(this._vertexData[d++]=V.position.x+this.oX.x,this._vertexData[d++]=V.position.y+this.oX.y,this._vertexData[d++]=V.position.z+this.oX.z,this._vertexData[d++]=V.color.r,this._vertexData[d++]=V.color.g,this._vertexData[d++]=V.color.b,this._vertexData[d++]=V.color.a,this._vertexData[d++]=V.angle,this._vertexData[d++]=V.scale.x*V.size,this._vertexData[d++]=V.scale.y*V.size,this._isAnimationSheetEnabled&&(this._vertexData[d++]=V.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[d++]=V.direction.x,this._vertexData[d++]=V.direction.y,this._vertexData[d++]=V.direction.z);else if(V._initialDirection){let G=V._initialDirection;this.isLocal&&(J.o.TransformNormalToRef(G,this._emitterWorldMatrix,J.h.ed[0]),G=J.h.ed[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[d++]=G.x,this._vertexData[d++]=G.y,this._vertexData[d++]=G.z}else{let G=V.direction;this.isLocal&&(J.o.TransformNormalToRef(G,this._emitterWorldMatrix,J.h.ed[0]),G=J.h.ed[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[d++]=G.x,this._vertexData[d++]=G.y,this._vertexData[d++]=G.z}this._useRampGradients&&V.remapData&&(this._vertexData[d++]=V.remapData.x,this._vertexData[d++]=V.remapData.y,this._vertexData[d++]=V.remapData.z,this._vertexData[d++]=V.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===W?W=this._epsilon:1===W&&(W=1-this._epsilon),0===R?R=this._epsilon:1===R&&(R=1-this._epsilon)),this._vertexData[d++]=W,this._vertexData[d++]=R)}_prepareParticle(G){}_createNewOnes(G){let V;for(let W=0;W<G&&this.Nx.length!==this._capacity;W++){V=this._createParticle(),this.Nx.push(V);let G=this._createQueueStart;for(;G;)G.process(V,this),G=G.nextItem;V._inheritParticleInfoToSubEmitters()}}_update(G){if(this._alive=this.Nx.length>0,this.j.position){const G=this.j;this._emitterWorldMatrix=G.getWorldMatrix()}else{const G=this.j;this._emitterWorldMatrix=J.c.Translation(G.x,G.y,G.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Nx),this._createNewOnes(G)}static _GetAttributeNamesOrOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=[r.c.PositionKind,r.c.ColorKind,"angle","offset","size"];return G&&J.push("cellIndex"),V||J.push("direction"),W&&J.push("remapData"),J}static _GetEffectCreationOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,VG.c)(J),G&&J.push("particlesInfos"),V&&J.push("logarithmicDepthConstant"),W&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,VG.l)(this,this._scene,G),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&G.push("#define FOG")),this._isAnimationSheetEnabled&&G.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&G.push("#define LOGARITHMICDEPTH"),V===X.BLENDMODE_MULTIPLY&&G.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&G.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(G.push("#define BILLBOARD"),this.billboardMode){case 2:G.push("#define BILLBOARDY");break;case 8:case 9:G.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&G.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:G.push("#define BILLBOARDMODE_ALL")}W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),G.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(G,V,W){V.push(...sG._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),G.push(...sG._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,JG.f)(G,this._imageProcessingConfigurationDefines),(0,JG.b)(W,this._imageProcessingConfigurationDefines))}_getWrapper(G){const V=this._getCustomDrawWrapper(G);if(null!==V&&void 0!==V&&V.effect)return V;const W=[];this.fillDefines(W,G);const J=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let R=this._drawWrappers[J];R||(R=this._drawWrappers[J]=[]);let d=R[G];d||(d=new GG.c(this._engine),d.drawContext&&(d.drawContext.useInstancing=this._useInstancing),R[G]=d);const k=W.join("\n");if(d.defines!==k){const G=[],V=[],W=[];this.fillUniformsAttributesAndSamplerNames(V,G,W),d.setEffect(this._engine.createEffect("particles",G,V,W,k,void 0,void 0,void 0,void 0,this._shaderLanguage),k)}return d}animate(){var G;let V,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!W&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(W?this.preWarmStepOffset:(null===(G=this._scene)||void 0===G?void 0:G.getAnimationRatio())||1),this.manualEmitCount>-1)V=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let G=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const V=this._actualFrame/this.targetStopDuration;o.GetCurrentGradient(V,this._emitRateGradients,((V,W,J)=>{V!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=W.getFactor(),this._currentEmitRateGradient=V),G=(0,P.Lerp)(this._currentEmitRate1,this._currentEmitRate2,J)}))}V=G*this._scaledUpdateSpeed|0,this._newPartsExcess+=G*this._scaledUpdateSpeed-V}if(this._newPartsExcess>1&&(V+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?V=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(V),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!W){let G=0;for(let V=0;V<this.Nx.length;V++){const W=this.Nx[V];this._appendParticleVertices(G,W),G+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Nx.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(G,V){this._appendParticleVertex(G++,V,0,0),this._useInstancing||(this._appendParticleVertex(G++,V,1,0),this._appendParticleVertex(G++,V,1,1),this._appendParticleVertex(G++,V,0,1))}rebuild(){var G;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(G=this._spriteBuffer)||void 0===G||G._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!sG.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(W.bind(W,12828)),Promise.resolve().then(W.bind(W,12772))])):await Promise.all([Promise.resolve().then(W.bind(W,12763)),Promise.resolve().then(W.bind(W,12756))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==X.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(X.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(X.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(G){const V=this._getWrapper(G),W=V.effect,R=this._engine;R.enableEffect(V);const d=this.defaultViewMatrix??this._scene.getViewMatrix();if(W.setTexture("diffuseSampler",this.particleTexture),W.setMatrix("view",d),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const G=this.particleTexture.getBaseSize();W.setFloat3("particlesInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,this.spriteCellWidth/G.width)}if(W.setVector2("translationPivot",this.translationPivot),W.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const G=this._scene.activeCamera;W.setVector3("eyePosition",G.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),W.setTexture("rampSampler",this._rampGradientsTexture));const k=W.defines;var z,X,P,A,x,q;(this._scene&&((0,VG.f)(W,this,this._scene),this.applyFog&&(0,WG.f)(this._scene,void 0,W)),k.indexOf("#define BILLBOARDMODE_ALL")>=0&&(d.invertToRef(J.h.Matrix[0]),W.setMatrix("invView",J.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?R.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,W):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,W)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?R.bindBuffers(this._vertexBuffers,null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._linesIndexBuffer:this._indexBuffer,W):R.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null,W);(this.useLogarithmicDepth&&this._scene&&(0,WG.j)(k,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),this._setEngineBasedOnBlendMode(G),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),this._useInstancing)?null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?R.drawElementsType(6,0,10,this.Nx.length):R.drawArraysType(7,0,4,this.Nx.length):null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?R.drawElementsType(1,0,10*this.Nx.length):R.drawElementsType(0,0,6*this.Nx.length);return this.Nx.length}render(){if(!this.isReady()||!this.Nx.length)return 0;const G=this._engine;G.setState&&(G.setState(!1),this.forceDepthWrite&&G.setDepthWrite(!0));let V=0;return V=this.blendMode===X.BLENDMODE_MULTIPLYADD?this._render(X.BLENDMODE_MULTIPLY)+this._render(X.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),V}_onDispose(){}dispose(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),G&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),G&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(V,W),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const G=this._scene.mx.indexOf(this);G>-1&&this._scene.mx.splice(G,1),this._scene._activeParticleSystems.dispose()}this.Md.notifyObservers(this),this.Md.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}sG.ForceGLSL=!1;var QG,ZG=W(11218);!function(G){G[G.ATTACHED=0]="ATTACHED",G[G.END=1]="END"}(QG||(QG={}));class EG{constructor(G){if(this.particleSystem=G,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!G.j||!G.j.dispose){const V=(0,z.c)("BABYLON.AbstractMesh");G.j=new V("SubemitterSystemEmitter",G.HG()),G._disposeEmitterOnDispose=!0}}clone(){let G=this.particleSystem.j;if(G){if(G instanceof J.o)G=G.clone();else if(-1!==G.getClassName().indexOf("Mesh")){G=new((0,z.c)("BABYLON.Mesh"))("",G.HG()),G.isVisible=!1}}else G=new J.o;const V=new EG(this.particleSystem.clone(this.particleSystem.name,G));return V.particleSystem.name+="Clone",V.type=this.type,V.inheritDirection=this.inheritDirection,V.inheritedVelocityAmount=this.inheritedVelocityAmount,V.particleSystem._disposeEmitterOnDispose=!0,V.particleSystem.disposeOnStop=!0,V}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={};return V.type=this.type,V.inheritDirection=this.inheritDirection,V.inheritedVelocityAmount=this.inheritedVelocityAmount,V.particleSystem=this.particleSystem.serialize(G),V}static _ParseParticleSystem(G,V,W){throw(0,ZG.e)("ParseParticle")}static Parse(G,V,W){const J=G.particleSystem,R=new EG(EG._ParseParticleSystem(J,V,W,!0));return R.type=G.type,R.inheritDirection=G.inheritDirection,R.inheritedVelocityAmount=G.inheritedVelocityAmount,R.particleSystem._isSubEmitter=!0,R}dispose(){this.particleSystem.dispose()}}var hG=W(11262);function oG(G,V){const W=new B;return W.direction1=G,W.direction2=V,W}function cG(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function jG(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function IG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.o(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0);return new p(G,V,W)}function OG(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function GV(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.o(0,1,0);return new Y(G,V,W,R,d)}function VV(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new q(G,V)}function WV(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0),R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0);return new L(G,V,W,R)}const JV=J.o.Zero(),RV=J.o.Zero(),dV=J.o.Zero();class kV{constructor(){this.strength=0,this.position=J.o.Zero()}_processParticle(G,V){this.position.subtractToRef(G.position,JV);const W=JV.lengthSquared()+1;JV.normalize().scaleToRef(this.strength/W,RV),RV.scaleToRef(V._tempScaledUpdateSpeed,dV),G.direction.addInPlace(dV)}serialize(){return{position:this.position.Bd(),strength:this.strength}}}class zV extends sG{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=G=>{if(!this._subEmitters||0===this._subEmitters.length)return;const V=Math.floor(Math.random()*this._subEmitters.length);for(const W of this._subEmitters[V])if(1===W.type){const V=W.clone();G._inheritParticleInfoToSubEmitter(V),V.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(V.particleSystem),V.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(G,V){const W=oG(G,V);return this.particleEmitterType=W,W}get flowMap(){return this._flowMap}set flowMap(G){this._flowMap!==G&&(this._flowMap=G,this._flowMapUpdate&&(KG(this._flowMapUpdate),this._flowMapUpdate=null),G&&(this._flowMapUpdate={process:G=>{var V;const W=null===(V=this.HG())||void 0===V?void 0:V.getTransformMatrix();this._flowMap._processParticle(G,this.flowMapStrength*this._tempScaledUpdateSpeed,W)},previousItem:null,nextItem:null},MG(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(G){this._attractors.push(G),1===this._attractors.length&&(this._attractorUpdate={process:G=>{for(const V of this._attractors)V._processParticle(G,this)},previousItem:null,nextItem:null},MG(this._attractorUpdate,this._directionProcessing))}removeAttractor(G){const V=this._attractors.indexOf(G);-1!==V&&this._attractors.splice(V,1),0===this._attractors.length&&KG(this._attractorUpdate)}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(G)}createHemisphericEmitter(){const G=cG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createSphereEmitter(){const G=jG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createDirectedSphereEmitter(){const G=IG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0));return this.particleEmitterType=G,G}createCylinderEmitter(){const G=OG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=G,G}createDirectedCylinderEmitter(){const G=GV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.o(0,1,0));return this.particleEmitterType=G,G}createConeEmitter(){const G=VV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=G,G}createDirectedConeEmitter(){const G=WV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0));return this.particleEmitterType=G,G}createBoxEmitter(G,V,W,J){const R=new x;return this.particleEmitterType=R,this.direction1=G,this.direction2=V,this.minEmitBox=W,this.maxEmitBox=J,R}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const G of this.subEmitters)G instanceof zV?this._subEmitters.push([new EG(G)]):G instanceof EG?this._subEmitters.push([G]):G instanceof Array&&this._subEmitters.push(G)}_stopSubEmitters(){if(this.activeSubSystems){for(const G of this.activeSubSystems)G.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const G=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==G&&this._rootParticleSystem.activeSubSystems.splice(G,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(G){G&&this._stopSubEmitters()}_prepareParticle(G){if(this._subEmitters&&this._subEmitters.length>0){const V=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];G._attachedSubEmitters=[];for(const W of V)if(0===W.type){const V=W.clone();G._attachedSubEmitters.push(V),V.particleSystem.start()}}}_onDispose(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),G&&this.particles)for(const W of this.particles)if(W._attachedSubEmitters)for(let G=W._attachedSubEmitters.length-1;G>=0;G-=1)W._attachedSubEmitters[G].dispose();if(V&&this.activeSubSystems)for(let W=this.activeSubSystems.length-1;W>=0;W-=1)this.activeSubSystems[W].dispose();if(this._subEmitters&&this._subEmitters.length){for(let G=0;G<this._subEmitters.length;G++)for(const V of this._subEmitters[G])V.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(G,V,W,R){let d;d=W instanceof hG.b?null:W;const X=(0,z.c)("BABYLON.Texture");if(X&&d&&(G.texture?V.particleTexture=X.Parse(G.texture,d,R):G.textureName&&(V.particleTexture=new X(R+G.textureName,d,!1,void 0===G.invertY||G.invertY),V.particleTexture.name=G.textureName)),G.emitterId||0===G.emitterId||void 0!==G.j?G.emitterId&&d?V.j=d.getLastMeshById(G.emitterId):V.j=J.o.ld(G.j):V.j=J.o.Zero(),V.isLocal=!!G.isLocal,void 0!==G.renderingGroupId&&(V.renderingGroupId=G.renderingGroupId),void 0!==G.isBillboardBased&&(V.isBillboardBased=G.isBillboardBased),void 0!==G.billboardMode&&(V.billboardMode=G.billboardMode),void 0!==G.useLogarithmicDepth&&(V.useLogarithmicDepth=G.useLogarithmicDepth),G.animations){for(let W=0;W<G.animations.length;W++){const J=G.animations[W],R=(0,z.c)("BABYLON.Animation");R&&V.animations.push(R.Parse(J))}V.beginAnimationOnStart=G.beginAnimationOnStart,V.beginAnimationFrom=G.beginAnimationFrom,V.beginAnimationTo=G.beginAnimationTo,V.beginAnimationLoop=G.beginAnimationLoop}if(G.autoAnimate&&d&&d.beginAnimation(V,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),V.startDelay=0|G.startDelay,V.minAngularSpeed=G.minAngularSpeed,V.maxAngularSpeed=G.maxAngularSpeed,V.minSize=G.minSize,V.maxSize=G.maxSize,G.minScaleX&&(V.minScaleX=G.minScaleX,V.maxScaleX=G.maxScaleX,V.minScaleY=G.minScaleY,V.maxScaleY=G.maxScaleY),void 0!==G.preWarmCycles&&(V.preWarmCycles=G.preWarmCycles,V.preWarmStepOffset=G.preWarmStepOffset),void 0!==G.minInitialRotation&&(V.minInitialRotation=G.minInitialRotation,V.maxInitialRotation=G.maxInitialRotation),V.minLifeTime=G.minLifeTime,V.maxLifeTime=G.maxLifeTime,V.minEmitPower=G.minEmitPower,V.maxEmitPower=G.maxEmitPower,V.emitRate=G.emitRate,V.gravity=J.o.ld(G.gravity),G.noiseStrength&&(V.noiseStrength=J.o.ld(G.noiseStrength)),V.color1=k.h.ld(G.color1),V.color2=k.h.ld(G.color2),V.colorDead=k.h.ld(G.colorDead),V.updateSpeed=G.updateSpeed,V.targetStopDuration=G.targetStopDuration,V.blendMode=G.blendMode,G.colorGradients)for(const J of G.colorGradients)V.addColorGradient(J.gradient,k.h.ld(J.color1),J.color2?k.h.ld(J.color2):void 0);if(G.rampGradients){for(const W of G.rampGradients)V.addRampGradient(W.gradient,k.d.ld(W.color));V.useRampGradients=G.useRampGradients}if(G.colorRemapGradients)for(const J of G.colorRemapGradients)V.addColorRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.alphaRemapGradients)for(const J of G.alphaRemapGradients)V.addAlphaRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.sizeGradients)for(const J of G.sizeGradients)V.addSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.angularSpeedGradients)for(const J of G.angularSpeedGradients)V.addAngularSpeedGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.velocityGradients)for(const J of G.velocityGradients)V.addVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.dragGradients)for(const J of G.dragGradients)V.addDragGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.emitRateGradients)for(const J of G.emitRateGradients)V.addEmitRateGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.startSizeGradients)for(const J of G.startSizeGradients)V.addStartSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.lifeTimeGradients)for(const J of G.lifeTimeGradients)V.addLifeTimeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(G.limitVelocityGradients){for(const W of G.limitVelocityGradients)V.addLimitVelocityGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);V.limitVelocityDamping=G.limitVelocityDamping}if(G.noiseTexture&&d){const W=(0,z.c)("BABYLON.ProceduralTexture");V.noiseTexture=W.Parse(G.noiseTexture,d,R)}let P;if(G.particleEmitterType){switch(G.particleEmitterType.type){case"SphereParticleEmitter":P=new S;break;case"SphereDirectedParticleEmitter":P=new p;break;case"ConeEmitter":case"ConeParticleEmitter":P=new q;break;case"ConeDirectedParticleEmitter":P=new L;break;case"CylinderParticleEmitter":P=new t;break;case"CylinderDirectedParticleEmitter":P=new Y;break;case"HemisphericParticleEmitter":P=new g;break;case"PointParticleEmitter":P=new B;break;case"MeshParticleEmitter":P=new y;break;case"CustomParticleEmitter":P=new b;break;default:P=new x}P.parse(G.particleEmitterType,d)}else P=new x,P.parse(G,d);V.particleEmitterType=P,V.startSpriteCellID=G.startSpriteCellID,V.endSpriteCellID=G.endSpriteCellID,V.spriteCellLoop=G.spriteCellLoop??!0,V.spriteCellWidth=G.spriteCellWidth,V.spriteCellHeight=G.spriteCellHeight,V.spriteCellChangeSpeed=G.spriteCellChangeSpeed,V.spriteRandomStartCell=G.spriteRandomStartCell,V.disposeOnStop=G.disposeOnStop??!1,V.manualEmitCount=G.manualEmitCount??-1}static Parse(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;const z=G.name;let X,P,A=null,x=null;if(V instanceof hG.b?X=V:(P=V,X=P.getEngine()),G.customShader&&X.createEffectForParticles){x=G.customShader;const V=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";A=X.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,V)}const q=new zV(z,d||G.DV,V,A,G.isAnimationSheetEnabled);if(q.customShader=x,q._rootUrl=W,G.id&&(q.id=G.id),G.subEmitters){q.subEmitters=[];for(const J of G.subEmitters){const G=[];for(const R of J)G.push(EG.Parse(R,V,W));q.subEmitters.push(G)}}if(G.attractors)for(const k of G.attractors){const G=new kV;G.position=J.o.ld(k.position),G.strength=k.strength,q.addAttractor(G)}return zV._Parse(G,q,V,W),G.textureMask&&(q.textureMask=k.h.ld(G.textureMask)),G.oX&&(q.oX=J.o.ld(G.oX)),G.preventAutoStart&&(q.preventAutoStart=G.preventAutoStart),R||q.preventAutoStart||q.start(),q}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={};if(zV._Serialize(V,this,G),V.textureMask=this.textureMask.Bd(),V.customShader=this.customShader,V.preventAutoStart=this.preventAutoStart,V.oX=this.oX.Bd(),this.subEmitters){V.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const W of this._subEmitters){const J=[];for(const V of W)J.push(V.serialize(G));V.subEmitters.push(J)}}if(this._attractors&&this._attractors.length){V.attractors=[];for(const G of this._attractors)V.attractors.push(G.serialize())}return V}static _Serialize(G,V,W){if(G.name=V.name,G.id=V.id,G.DV=V.getCapacity(),G.disposeOnStop=V.disposeOnStop,G.manualEmitCount=V.manualEmitCount,V.j.position){const W=V.j;G.emitterId=W.id}else{const W=V.j;G.j=W.Bd()}V.particleEmitterType&&(G.particleEmitterType=V.particleEmitterType.serialize()),V.particleTexture&&(W?G.texture=V.particleTexture.serialize():(G.textureName=V.particleTexture.name,G.invertY=!!V.particleTexture._invertY)),G.isLocal=V.isLocal,C.e.AppendSerializedAnimations(V,G),G.beginAnimationOnStart=V.beginAnimationOnStart,G.beginAnimationFrom=V.beginAnimationFrom,G.beginAnimationTo=V.beginAnimationTo,G.beginAnimationLoop=V.beginAnimationLoop,G.startDelay=V.startDelay,G.renderingGroupId=V.renderingGroupId,G.isBillboardBased=V.isBillboardBased,G.billboardMode=V.billboardMode,G.minAngularSpeed=V.minAngularSpeed,G.maxAngularSpeed=V.maxAngularSpeed,G.minSize=V.minSize,G.maxSize=V.maxSize,G.minScaleX=V.minScaleX,G.maxScaleX=V.maxScaleX,G.minScaleY=V.minScaleY,G.maxScaleY=V.maxScaleY,G.minEmitPower=V.minEmitPower,G.maxEmitPower=V.maxEmitPower,G.minLifeTime=V.minLifeTime,G.maxLifeTime=V.maxLifeTime,G.emitRate=V.emitRate,G.gravity=V.gravity.Bd(),G.noiseStrength=V.noiseStrength.Bd(),G.color1=V.color1.Bd(),G.color2=V.color2.Bd(),G.colorDead=V.colorDead.Bd(),G.updateSpeed=V.updateSpeed,G.targetStopDuration=V.targetStopDuration,G.blendMode=V.blendMode,G.preWarmCycles=V.preWarmCycles,G.preWarmStepOffset=V.preWarmStepOffset,G.minInitialRotation=V.minInitialRotation,G.maxInitialRotation=V.maxInitialRotation,G.startSpriteCellID=V.startSpriteCellID,G.spriteCellLoop=V.spriteCellLoop,G.endSpriteCellID=V.endSpriteCellID,G.spriteCellChangeSpeed=V.spriteCellChangeSpeed,G.spriteCellWidth=V.spriteCellWidth,G.spriteCellHeight=V.spriteCellHeight,G.spriteRandomStartCell=V.spriteRandomStartCell,G.isAnimationSheetEnabled=V.isAnimationSheetEnabled,G.useLogarithmicDepth=V.useLogarithmicDepth;const J=V.getColorGradients();if(J){G.colorGradients=[];for(const V of J){const W={gradient:V.gradient,color1:V.color1.Bd()};V.color2?W.color2=V.color2.Bd():W.color2=V.color1.Bd(),G.colorGradients.push(W)}}const R=V.getRampGradients();if(R){G.rampGradients=[];for(const V of R){const W={gradient:V.gradient,color:V.color.Bd()};G.rampGradients.push(W)}G.useRampGradients=V.useRampGradients}const d=V.getColorRemapGradients();if(d){G.colorRemapGradients=[];for(const V of d){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.colorRemapGradients.push(W)}}const k=V.getAlphaRemapGradients();if(k){G.alphaRemapGradients=[];for(const V of k){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.alphaRemapGradients.push(W)}}const z=V.getSizeGradients();if(z){G.sizeGradients=[];for(const V of z){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.sizeGradients.push(W)}}const X=V.getAngularSpeedGradients();if(X){G.angularSpeedGradients=[];for(const V of X){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.angularSpeedGradients.push(W)}}const P=V.getVelocityGradients();if(P){G.velocityGradients=[];for(const V of P){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.velocityGradients.push(W)}}const A=V.getDragGradients();if(A){G.dragGradients=[];for(const V of A){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.dragGradients.push(W)}}const x=V.getEmitRateGradients();if(x){G.emitRateGradients=[];for(const V of x){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.emitRateGradients.push(W)}}const q=V.getStartSizeGradients();if(q){G.startSizeGradients=[];for(const V of q){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.startSizeGradients.push(W)}}const L=V.getLifeTimeGradients();if(L){G.lifeTimeGradients=[];for(const V of L){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.lifeTimeGradients.push(W)}}const t=V.getLimitVelocityGradients();if(t){G.limitVelocityGradients=[];for(const V of t){const W={gradient:V.gradient,factor1:V.factor1};void 0!==V.factor2?W.factor2=V.factor2:W.factor2=V.factor1,G.limitVelocityGradients.push(W)}G.limitVelocityDamping=V.limitVelocityDamping}V.noiseTexture&&(G.noiseTexture=V.noiseTexture.serialize())}clone(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let R=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){R=this.customShader;const G=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"",V=d.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,G);J[0]?J[0].effect=V:this.setCustomEffect(V,0)}const k=this.serialize(W),z=zV.Parse(k,this._scene||this._engine,this._rootUrl);return z.name=G,z.customShader=R,z._customWrappers=J,void 0===V&&(V=this.j),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.j=V,this.preventAutoStart||z.start(),z}}zV.BILLBOARDMODE_Y=2,zV.BILLBOARDMODE_ALL=7,zV.BILLBOARDMODE_STRETCHED=8,zV.BILLBOARDMODE_STRETCHED_LOCAL=9,EG._ParseParticleSystem=zV.Parse;var XV=W(11744),PV=W(11737),AV=W(11564);AV.c.prototype.createTransformFeedback=function(){const G=this._gl.createTransformFeedback();if(!G)throw new Error("Unable to create Transform Feedback");return G},AV.c.prototype.deleteTransformFeedback=function(G){this._gl.deleteTransformFeedback(G)},AV.c.prototype.bindTransformFeedback=function(G){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,G)},AV.c.prototype.beginTransformFeedback=function(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(G?this._gl.POINTS:this._gl.TRIANGLES)},AV.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},AV.c.prototype.setTranformFeedbackVaryings=function(G,V){this._gl.transformFeedbackVaryings(G,V,this._gl.INTERLEAVED_ATTRIBS)},AV.c.prototype.bindTransformFeedbackBuffer=function(G){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,G?G.underlyingResource:null)},AV.c.prototype.readTransformFeedbackBuffer=function(G){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,G)};const xV="clipPlaneFragmentDeclaration2",qV="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";H.d.IncludesShadersStore[xV]||(H.d.IncludesShadersStore[xV]=qV);W(12671),W(12677),W(12679),W(12684),W(12690),W(12693),W(12697),W(12706);const LV="gpuRenderParticlesPixelShader",tV="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";H.d.ShadersStore[LV]||(H.d.ShadersStore[LV]=tV);const YV="clipPlaneVertexDeclaration2",gV="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";H.d.IncludesShadersStore[YV]||(H.d.IncludesShadersStore[YV]=gV);W(12708),W(12715),W(12722),W(12725);const BV="gpuRenderParticlesVertexShader",SV="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";H.d.ShadersStore[BV]||(H.d.ShadersStore[BV]=SV);class pV extends X{static get IsSupported(){if(!I.c.LastCreatedEngine)return!1;const G=I.c.LastCreatedEngine.getCaps();return G.supportTransformFeedbacks||G.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(G){this._maxActiveParticleCount=Math.min(G,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(G){this.maxActiveParticleCount=G}createPointEmitter(G,V){const W=oG(G,V);return this.particleEmitterType=W,W}createHemisphericEmitter(){const G=cG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createSphereEmitter(){const G=jG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createDirectedSphereEmitter(){const G=IG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0));return this.particleEmitterType=G,G}createCylinderEmitter(){const G=OG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=G,G}createDirectedCylinderEmitter(){const G=GV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.o(0,1,0));return this.particleEmitterType=G,G}createConeEmitter(){const G=VV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=G,G}createDirectedConeEmitter(){const G=WV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.o(0,1,0));return this.particleEmitterType=G,G}createBoxEmitter(G,V,W,J){const R=new x;return this.particleEmitterType=R,this.direction1=G,this.direction2=V,this.minEmitBox=W,this.maxEmitBox=J,R}get flowMap(){return this._flowMap}set flowMap(G){this._flowMap!==G&&(this._flowMap=G)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==zV.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(zV.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(zV.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";G?setTimeout((()=>{this.start(0)}),G):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var G;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._customWrappers[V])||void 0===G?void 0:G.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[G]??this._customWrappers[0]}setCustomEffect(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[V]=new GG.c(this._engine),this._customWrappers[V].effect=G}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new c.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(G,V,W){return super._removeGradientAndTexture(G,V,W),this._releaseBuffers(),this}addColorGradient(G,V){this._colorGradients||(this._colorGradients=[]);const W=new Z(G,V);return this._colorGradients.push(W),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(G&&this._colorGradients.sort(((G,V)=>G.gradient<V.gradient?-1:G.gradient>V.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(G){return this._removeGradientAndTexture(G,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const V in this._drawWrappers){var G;null===(G=this._drawWrappers[V].drawContext)||void 0===G||G.reset()}}_addFactorGradient(G,V,W){const J=new h(V,W);G.push(J),this._releaseBuffers()}addSizeGradient(G,V){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,G,V),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(G){return this._removeGradientAndTexture(G,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(G,V){if(!G)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&G.sort(((G,V)=>G.gradient<V.gradient?-1:G.gradient>V.gradient?1:0));const W=this;W[V]&&(W[V].dispose(),W[V]=null)}addAngularSpeedGradient(G,V){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,G,V),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(G){return this._removeGradientAndTexture(G,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(G,V){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,G,V),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(G){return this._removeGradientAndTexture(G,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(G,V){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,G,V),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(G){return this._removeGradientAndTexture(G,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(G,V){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,G,V),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(G){return this._removeGradientAndTexture(G,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(G){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(G),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Md=new c.b,this.onStoppedObservable=new c.b,this.onStartedObservable=new c.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=J.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||I.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.mx.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,z.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,z.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new GG.c(this._engine)},this._customWrappers[0].effect=R,this._drawWrappers={0:new GG.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(V=V??{}).randomTextureSize||delete V.randomTextureSize;const k={DV:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...V},X=V;isFinite(X)&&(k.DV=X),this._capacity=k.DV,this._maxActiveParticleCount=k.DV,this._currentActiveCount=0,this._isAnimationSheetEnabled=d,this.particleEmitterType=new x;const P=Math.min(this._engine.getCaps().maxTextureSize,k.randomTextureSize);let A=[];for(let J=0;J<P;++J)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture=new j.b(new Float32Array(A),P,1,5,W,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,A=[];for(let J=0;J<P;++J)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture2=new j.b(new Float32Array(A),P,1,5,W,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=P}_reset(){this._releaseBuffers()}_createVertexBuffers(G,V,W){const J={};J.position=V.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let R=3;J.age=V.createVertexBuffer("age",R,1,this._attributesStrideSize,!0),R+=1,J.size=V.createVertexBuffer("size",R,3,this._attributesStrideSize,!0),R+=3,J.life=V.createVertexBuffer("life",R,1,this._attributesStrideSize,!0),R+=1,R+=4,this.billboardMode===zV.BILLBOARDMODE_STRETCHED&&(J.direction=V.createVertexBuffer("direction",R,3,this._attributesStrideSize,!0)),R+=3,this._platform.alignDataInBuffer&&(R+=1),this.particleEmitterType instanceof b&&(R+=3,this._platform.alignDataInBuffer&&(R+=1)),this._colorGradientsTexture||(J.color=V.createVertexBuffer("color",R,4,this._attributesStrideSize,!0),R+=4),this._isBillboardBased||(J.initialDirection=V.createVertexBuffer("initialDirection",R,3,this._attributesStrideSize,!0),R+=3,this._platform.alignDataInBuffer&&(R+=1)),this.noiseTexture&&(J.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",R,3,this._attributesStrideSize,!0),R+=3,this._platform.alignDataInBuffer&&(R+=1),J.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",R,3,this._attributesStrideSize,!0),R+=3,this._platform.alignDataInBuffer&&(R+=1)),J.angle=V.createVertexBuffer("angle",R,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?R++:R+=2,this._isAnimationSheetEnabled&&(J.cellIndex=V.createVertexBuffer("cellIndex",R,1,this._attributesStrideSize,!0),R+=1,this.spriteRandomStartCell&&(J.cellStartOffset=V.createVertexBuffer("cellStartOffset",R,1,this._attributesStrideSize,!0),R+=1)),J.offset=W.createVertexBuffer("offset",0,2),J.uv=W.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(J),this._platform.createVertexBuffers(G,J),this.resetDrawCache()}_initialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!G)return;const V=this._engine,W=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof b&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const R=this.particleEmitterType instanceof b,d=J.h.ed[0];let k=0;for(let J=0;J<this._capacity;J++)if(W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),R?(this.particleEmitterType.particleDestinationGenerator(J,null,d),W.push(d.x),W.push(d.y),W.push(d.z)):(W.push(0),W.push(0),W.push(0)),this._platform.alignDataInBuffer&&W.push(0),k+=16,R&&(this.particleEmitterType.particlePositionGenerator(J,null,d),W.push(d.x),W.push(d.y),W.push(d.z),this._platform.alignDataInBuffer&&W.push(0),k+=4),this._colorGradientsTexture||(W.push(0),W.push(0),W.push(0),W.push(0),k+=4),this.isBillboardBased||(W.push(0),W.push(0),W.push(0),this._platform.alignDataInBuffer&&W.push(0),k+=4),this.noiseTexture&&(W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),k+=8),W.push(0),k+=1,this._angularSpeedGradientsTexture||(W.push(0),k+=1),this._isAnimationSheetEnabled&&(W.push(0),k+=1,this.spriteRandomStartCell&&(W.push(0),k+=1)),this._platform.alignDataInBuffer){let G=3-(k+3&3);for(k+=G;G-- >0;)W.push(0)}const z=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),X=this._platform.createParticleBuffer(W),P=this._platform.createParticleBuffer(W);this._buffer0=new r.b(V,X,!1,this._attributesStrideSize),this._buffer1=new r.b(V,P,!1,this._attributesStrideSize),this._spriteBuffer=new r.b(V,z,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let G=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(G+="\n#define BILLBOARD"),this._colorGradientsTexture&&(G+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(G+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(G+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(G+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(G+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(G+="\n#define DRAGGRADIENTS"),this._flowMap&&(G+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(G+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(G+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(G+="\n#define NOISE"),this.isLocal&&(G+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===G||(this._cachedUpdateDefines=G,this._updateBuffer=this._platform.createUpdateBuffer(G)),this._platform.isUpdateBufferReady()}_getWrapper(G){const V=this._getCustomDrawWrapper(G);if(null!==V&&void 0!==V&&V.effect)return V;const W=[];this.fillDefines(W,G);let J=this._drawWrappers[G];J||(J=new GG.c(this._engine),J.drawContext&&(J.drawContext.useInstancing=!0),this._drawWrappers[G]=J);const R=W.join("\n");if(J.defines!==R){const G=[],V=[],W=[];this.fillUniformsAttributesAndSamplerNames(V,G,W),J.setEffect(this._engine.createEffect("gpuRenderParticles",G,V,W,R),R)}return J}static _GetAttributeNamesOrOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=[r.c.PositionKind,"age","life","size","angle"];return G||R.push(r.c.ColorKind),V&&R.push("cellIndex"),W||R.push("initialDirection"),J&&R.push("direction"),R.push("offset",r.c.UVKind),R}static _GetEffectCreationOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["emitterWM","oX","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,VG.c)(J),G&&J.push("sheetInfos"),V&&J.push("logarithmicDepthConstant"),W&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,VG.l)(this,this._scene,G),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==PV.e.FOGMODE_NONE&&G.push("#define FOG")),V===zV.BLENDMODE_MULTIPLY&&G.push("#define BLENDMULTIPLYMODE"),this.isLocal&&G.push("#define LOCAL"),this.useLogarithmicDepth&&G.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(G.push("#define BILLBOARD"),this.billboardMode){case zV.BILLBOARDMODE_Y:G.push("#define BILLBOARDY");break;case zV.BILLBOARDMODE_STRETCHED:G.push("#define BILLBOARDSTRETCHED");break;case zV.BILLBOARDMODE_ALL:G.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&G.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&G.push("#define ANIMATESHEET"),W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),G.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(G,V,W){V.push(...pV._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===zV.BILLBOARDMODE_STRETCHED)),G.push(...pV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(XV.e.PrepareUniforms(G,this._imageProcessingConfigurationDefines),XV.e.PrepareSamplers(W,this._imageProcessingConfigurationDefines))}animate(){var G;let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(V?this.preWarmStepOffset:(null===(G=this._scene)||void 0===G?void 0:G.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(G,V){const W=this[V];if(!G||!G.length||W)return;const J=new Float32Array(this._rawTextureWidth);for(let R=0;R<this._rawTextureWidth;R++){const V=R/this._rawTextureWidth;o.GetCurrentGradient(V,G,((G,V,W)=>{J[R]=(0,P.Lerp)(G.factor1,V.factor1,W)}))}this[V]=j.b.CreateRTexture(J,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[V].name=V.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const G=new Uint8Array(4*this._rawTextureWidth),V=k.j.nz[0];for(let W=0;W<this._rawTextureWidth;W++){const J=W/this._rawTextureWidth;o.GetCurrentGradient(J,this._colorGradients,((J,R,d)=>{k.h.LerpToRef(J.color1,R.color1,d,V),G[4*W]=255*V.r,G[4*W+1]=255*V.g,G[4*W+2]=255*V.b,G[4*W+3]=255*V.a}))}this._colorGradientsTexture=j.b.CreateRGBATexture(G,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(G,V){var W,R,d,k;const z=this._getWrapper(G),X=z.effect;this._engine.enableEffect(z);const P=(null===(W=this._scene)||void 0===W?void 0:W.getViewMatrix())||J.c.IdentityReadOnly;if(X.setMatrix("view",P),X.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),X.setTexture("diffuseSampler",this.particleTexture),X.setVector2("translationPivot",this.translationPivot),X.setVector3("oX",this.oX),this.isLocal&&X.setMatrix("emitterWM",V),this._colorGradientsTexture?X.setTexture("colorGradientSampler",this._colorGradientsTexture):X.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const G=this.particleTexture.getBaseSize();X.setFloat3("sheetInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,G.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const G=this._scene.activeCamera;X.setVector3("eyePosition",G.globalPosition)}const A=X.defines;if(this._scene&&((0,VG.f)(X,this,this._scene),this.applyFog&&(0,WG.f)(this._scene,void 0,X)),A.indexOf("#define BILLBOARDMODE_ALL")>=0){const G=P.clone();G.invert(),X.setMatrix("invView",G)}return this.useLogarithmicDepth&&this._scene&&(0,WG.j)(A,X,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(X),this._setEngineBasedOnBlendMode(G),this._platform.bindDrawBuffers(this._targetIndex,X,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(X),null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(k=this._scene)&&void 0!==k&&k.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(G){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!G)if(this.j.position){G=this.j.getWorldMatrix()}else{const V=this.j;G=J.h.Matrix[0],J.c.TranslationToRef(V.x,V.y,V.z,G)}const V=this._engine,W=V.getDepthWrite();if(V.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const G=this.HG();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",G.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",G),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const R=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=R,V.setDepthWrite(W)}render(){let G,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!V&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let G=0;G<this.preWarmCycles;G++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const G=0|this._accumulatedCount;this._accumulatedCount-=G,this._currentActiveCount+=G}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){G=this.j.getWorldMatrix()}else{const V=this.j;G=J.h.Matrix[0],J.c.TranslationToRef(V.x,V.y,V.z,G)}const R=this._engine;this.updateInAnimate||this._update(G);let d=0;return V||W||(R.setState(!1),this.forceDepthWrite&&R.setDepthWrite(!0),d=this.blendMode===zV.BLENDMODE_MULTIPLYADD?this._render(zV.BLENDMODE_MULTIPLY,G)+this._render(zV.BLENDMODE_ADD,G):this._render(this.blendMode,G),this._engine.setAlphaMode(0)),d}rebuild(){const G=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(G,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,G()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const V in this._drawWrappers){this._drawWrappers[V].dispose()}if(this._drawWrappers={},this._scene){const G=this._scene.mx.indexOf(this);G>-1&&this._scene.mx.splice(G,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let V=0;V<this._renderVertexBuffers.length;++V){const G=this._renderVertexBuffers[V];for(const V in G)G[V].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),G&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),G&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Md.notifyObservers(this),this.Md.clear()}clone(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let R=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){R=this.customShader;const G=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"";J[0]=d.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,G,void 0,void 0,void 0,this)}const k=this.serialize(W),z=pV.Parse(k,this._scene||this._engine,this._rootUrl);return z.name=G,z.customShader=R,z._customWrappers=J,void 0===V&&(V=this.j),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.j=V,z}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={};return zV._Serialize(V,this,G),V.activeParticleCount=this.activeParticleCount,V.randomTextureSize=this._randomTextureSize,V.customShader=this.customShader,V}static Parse(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0;const d=G.name;let k,z;V instanceof hG.b?k=V:(z=V,k=z.getEngine());const X=new pV(d,{DV:R||G.DV,randomTextureSize:G.randomTextureSize},V,null,G.isAnimationSheetEnabled);if(X._rootUrl=W,G.customShader&&k.createEffectForParticles){const V=G.customShader,W=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"",J=k.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,W,void 0,void 0,void 0,X);X.setCustomEffect(J,0),X.customShader=V}return G.id&&(X.id=G.id),G.activeParticleCount&&(X.activeParticleCount=G.activeParticleCount),zV._Parse(G,X,V,W),G.preventAutoStart&&(X.preventAutoStart=G.preventAutoStart),J||X.preventAutoStart||X.start(),X}}var bV=W(11189),rV=W(12728),yV=W(11845);class uV{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(G){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const V of this.systems)V.j=G;this._emitterNode=G}setEmitterAsSphere(G,V,W){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:G,renderingGroupId:V};const J=(0,rV.d)("emitterSphere",{diameter:G.diameter,segments:G.segments},W);J.renderingGroupId=V;const R=new yV.d("emitterSphereMaterial",W);R.emissiveColor=G.color,J.material=R;for(const d of this.systems)d.j=J;this._emitterNode=J}start(G){for(const V of this.systems)G&&(V.j=G),V.start()}dispose(){for(const G of this.systems)G.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V={systems:[]};for(const W of this.systems)V.systems.push(W.serialize(G));return this._emitterNode&&(V.j=this._emitterCreationOptions),V}static Parse(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;const R=new uV,d=this.BaseAssetsUrl+"/textures/";V=V||I.c.LastCreatedScene;for(const k of G.systems)R.systems.push(W?pV.Parse(k,V,d,!0,J):zV.Parse(k,V,d,!0,J));if(G.j){const W=G.j.options;if("Sphere"===G.j.kind)R.setEmitterAsSphere({diameter:W.diameter,segments:W.segments,color:k.d.ld(W.color)},G.j.renderingGroupId,V)}return R}}uV.BaseAssetsUrl="https://assets.babylonjs.com/particles";var HV=W(11222);class nV{static CreateDefault(G){let V,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,J=arguments.length>2?arguments[2]:void 0;V=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new pV("default system",{DV:W},J):new zV("default system",W,J),V.j=G;const R=bV.h.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return V.particleTexture=new l.d(R,V.HG()),V.createConeEmitter(.1,Math.PI/4),V.color1=new k.h(1,1,1,1),V.color2=new k.h(1,1,1,1),V.colorDead=new k.h(1,1,1,0),V.minSize=.1,V.maxSize=.1,V.minEmitPower=2,V.maxEmitPower=2,V.updateSpeed=1/60,V.emitRate=30,V}static CreateAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;V||(V=I.c.LastCreatedScene);const R={};return V.addPendingData(R),new Promise(((d,k)=>{if(W&&!pV.IsSupported)return V.removePendingData(R),k("Particle system with GPU is not supported.");bV.h.LoadFile(`${nV.BaseAssetsUrl}/systems/${G}.json`,(G=>{V.removePendingData(R);const k=JSON.parse(G.toString());return d(uV.Parse(k,V,W,J))}),void 0,void 0,void 0,(()=>(V.removePendingData(R),k(`An error occurred with the creation of your particle system. Check if your type '${G}' exists.`))))}))}static ExportSet(G){const V=new uV;for(const W of G)V.systems.push(W);return V}static ParseFromFileAsync(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5?arguments[5]:void 0;return new Promise(((k,z)=>{const X=new HV.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const V=JSON.parse(X.responseText);let z;z=J?pV.Parse(V,W,R,!1,d):zV.Parse(V,W,R,!1,d),G&&(z.name=G),k(z)}else z("Unable to load the particle system")})),X.open("GET",V),X.send()}))}static ParseFromSnippetAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",R=arguments.length>4?arguments[4]:void 0;if("_BLANK"===G){const G=this.CreateDefault(null);return G.start(),Promise.resolve(G)}return new Promise(((d,k)=>{const z=new HV.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const k=JSON.parse(JSON.parse(z.responseText).jsonPayload),X=JSON.parse(k.particleSystem);let P;P=W?pV.Parse(X,V,J,!1,R):zV.Parse(X,V,J,!1,R),P.snippetId=G,d(P)}else k("Unable to load the snippet "+G)})),z.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),z.send()}))}}nV.BaseAssetsUrl=uV.BaseAssetsUrl,nV.SnippetUrl="https://snippet.babylonjs.com",nV.CreateFromSnippetAsync=nV.ParseFromSnippetAsync;var DV=W(11510),iV=W(11561),eV=W(12737);(0,eV.c)(iV.b.NAME_PARTICLESYSTEM,((G,V,W,J)=>{const R=(0,eV.e)(iV.b.NAME_PARTICLESYSTEM);if(R&&void 0!==G.mx&&null!==G.mx)for(let d=0,k=G.mx.length;d<k;d++){const k=G.mx[d];W.mx.push(R(k,V,J))}})),(0,eV.b)(iV.b.NAME_PARTICLESYSTEM,((G,V,W)=>{if(G.activeParticleCount){return pV.Parse(G,V,W)}return zV.Parse(G,V,W)})),hG.b.prototype.createEffectForParticles=function(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",d=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,X=arguments.length>7?arguments[7]:void 0,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,x=[],q=[];const L=[];return X?X.fillUniformsAttributesAndSamplerNames(q,x,L):(x=zV._GetAttributeNamesOrOptions(),q=zV._GetEffectCreationOptions()),-1===R.indexOf(" BILLBOARD")&&(R+="\n#define BILLBOARD\n"),null!==X&&void 0!==X&&X.isAnimationSheetEnabled&&-1===R.indexOf(" ANIMATESHEET")&&(R+="\n#define ANIMATESHEET\n"),-1===J.indexOf("diffuseSampler")&&J.push("diffuseSampler"),this.createEffect({vertex:A??(null===X||void 0===X?void 0:X.vertexShaderName)??"particles",fragmentElement:G},x,q.concat(V),L.concat(J),R,d,k,z,void 0,P,(async()=>{0===P?await Promise.resolve().then(W.bind(W,12763)):await Promise.resolve().then(W.bind(W,12828))}))},DV.b.prototype.getEmittedParticleSystems=function(){const G=[];for(let V=0;V<this.HG().mx.length;V++){const W=this.HG().mx[V];W.j===this&&G.push(W)}return G},DV.b.prototype.getHierarchyEmittedParticleSystems=function(){const G=[],V=this.getDescendants();V.push(this);for(let W=0;W<this.HG().mx.length;W++){const J=this.HG().mx[W],R=J.j;R.position&&-1!==V.indexOf(R)&&G.push(J)}return G};W(11368),W(11381),W(11473);W(11482),W(12743),W(11496),W(11339),W(11557);W(11623);var FV;W(12746),W(11645);!function(G){G[G.Color=2]="Color",G[G.UV=1]="UV",G[G.Random=0]="Random",G[G.Stated=3]="Stated"}(FV||(FV={}));var fV=W(11663);const vV=new J.o(0,0,0),CV=new J.o(0,0,0),lV=new J.o(0,0,0);class mV{constructor(G,V,W){this.width=G,this.height=V,this.data=W}processFlowable(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;if(!W)return;W instanceof J.c?J.o.TransformCoordinatesToRef(G.position,W,lV):(lV.x=W.x,lV.y=W.y,lV.z=W.z);const R=.5*lV.x+.5,d=1-(.5*lV.y+.5),k=Math.floor(R*this.width),z=Math.floor(d*this.height);if(k<0||k>=this.width||z<0||z>=this.height)return;const X=4*(z*this.width+k),P=this.data[X]/255*2-1,A=this.data[X+1]/255*2-1,x=this.data[X+2]/255*2-1,q=this.data[X+3]/255;vV.set(P,A,x),vV.scaleToRef(V*q,CV),G.direction.addInPlace(CV)}_processParticle(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;this.processFlowable(G,V,W)}static async FromUrlAsync(G){return await new Promise(((V,W)=>{const J=document.createElement("canvas"),R=J.getContext("2d");let d=null;const k=new Image;k.crossOrigin="anonymous",k.src=G,k.onerror=V=>{W(new Error(`Failed to load image: ${G} : ${V}`))},k.onload=()=>{J.width=k.width,J.height=k.height,R.drawImage(k,0,0),d=R.getImageData(0,0,J.width,J.height),V(new mV(J.width,J.height,d.data))}}))}static async ExtractFromTextureAsync(G){return await new Promise(((V,W)=>{if(!G.isReady())return void G.onLoadObservable.addOnce((async()=>{try{const W=await this.ExtractFromTextureAsync(G);V(W)}catch(J){W(J)}}));const J=G.getSize();fV.n.GetTextureDataAsync(G,J.width,J.height).then((G=>{V(new mV(J.width,J.height,new Uint8ClampedArray(G)))})).catch(W)}))}}var wV,NV,UV,aV,MV,TV,KV,sV,QV;!function(G){G[G.Int=1]="Int",G[G.Float=2]="Float",G[G.Vector2=4]="Vector2",G[G.ed=8]="ed",G[G.Matrix=16]="Matrix",G[G.Particle=32]="Particle",G[G.Texture=64]="Texture",G[G.nz=128]="nz",G[G.FloatGradient=256]="FloatGradient",G[G.Vector2Gradient=512]="Vector2Gradient",G[G.Vector3Gradient=1024]="Vector3Gradient",G[G.Color4Gradient=2048]="Color4Gradient",G[G.System=4096]="System",G[G.AutoDetect=8192]="AutoDetect",G[G.BasedOnInput=16384]="BasedOnInput",G[G.Undefined=32768]="Undefined",G[G.All=65535]="All"}(wV||(wV={})),function(G){G[G.Compatible=0]="Compatible",G[G.TypeIncompatible=1]="TypeIncompatible",G[G.HierarchyIssue=2]="HierarchyIssue"}(NV||(NV={})),function(G){G[G.Input=0]="Input",G[G.Output=1]="Output"}(UV||(UV={}));class ZV{get direction(){return this._direction}get type(){if(this._type===wV.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===wV.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(G){this._type=G}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((G=>G.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(G,V,W){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=wV.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new c.b,this.onDisconnectionObservable=new c.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=V,this.name=G,this._direction=W}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(G){var V;return this.isConnected?null!==(V=this._connectedPoint)&&void 0!==V&&V._storedFunction?this._connectedPoint._storedFunction(G):this._connectedPoint._storedValue:this.value}canConnectTo(G){return 0===this.checkCompatibilityState(G)}checkCompatibilityState(G){const V=this._ownerBlock,W=G.ownerBlock;if(this.type!==G.type&&G.innerType!==wV.AutoDetect)return G.acceptedConnectionPointTypes&&-1!==G.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(G.excludedConnectionPointTypes&&-1!==G.excludedConnectionPointTypes.indexOf(this.type))return 1;let J=W,R=V;return 0===this.direction&&(J=V,R=W),J.isAnAncestorOf(R)?2:0}connectTo(G){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(G))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${G.ownerBlock.name}".${G.name}`;return this._endpoints.push(G),G._connectedPoint=this,this.onConnectionObservable.notifyObservers(G),G.onConnectionObservable.notifyObservers(this),this}disconnectFrom(G){const V=this._endpoints.indexOf(G);return-1===V||(this._endpoints.splice(V,1),G._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(G),G.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(G){let V=1;for(;V<wV.All;)G&V||this.excludedConnectionPointTypes.push(V),V<<=1}serialize(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const V={};return V.name=this.name,V.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Bd?(V.valueType="BABYLON."+this.value.getClassName(),V.value=this.value.Bd()):(V.valueType="number",V.value=this.value)),G&&this.connectedPoint&&(V.inputName=this.name,V.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,V.targetConnectionName=this.connectedPoint.name,V.isExposedOnFrame=!0,V.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(V.isExposedOnFrame=!0,V.exposedPortPosition=this.exposedPortPosition),V}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class EV{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(G){this._name=G}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(G){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new c.b,this.Md=new c.b,this.onInputChangedObservable=new c.b,this.visibleOnFrame=!1,this._name=G,this.uniqueId=m.e.UniqueId}_inputRename(G){return G}_outputRename(G){return G}isAnAncestorOf(G){for(const V of this._outputs)if(V.hasEndpoints)for(const W of V.endpoints){if(W.ownerBlock===G)return!0;if(W.ownerBlock.isAnAncestorOf(G))return!0}return!1}isAnAncestorOfType(G){if(this.getClassName()===G)return!0;for(const V of this._outputs)if(V.hasEndpoints)for(const W of V.endpoints)if(W.ownerBlock.isAnAncestorOfType(G))return!0;return!1}getInputByName(G){const V=this._inputs.filter((V=>V.name===G));return V.length?V[0]:null}_linkConnectionTypes(G,V){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[V]._acceptedConnectionPointType=this._inputs[G]:(this._inputs[G]._linkedConnectionSource=this._inputs[V],this._inputs[G]._isMainLinkSource=!0),this._inputs[V]._linkedConnectionSource=this._inputs[G]}registerInput(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;const k=new ZV(G,this,0);return k.type=V,k.isOptional=W,k.defaultValue=J,k.value=J,k.valueMin=R,k.valueMax=d,this._inputs.push(k),this.onInputChangedObservable.notifyObservers(k),this}registerOutput(G,V,W){return(W=W??new ZV(G,this,1)).type=V,this._outputs.push(W),this}_build(G){}_customBuildStep(G){}build(G){if(this._buildId===G.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((G=>G.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=G.buildId;for(const V of this._inputs){if(!V.connectedPoint){V.isOptional||G.notConnectedNonOptionalInputs.push(V);continue}const W=V.connectedPoint.ownerBlock;W&&W!==this&&!W.isSystem&&W.build(G)}return this._customBuildStep(G),G.verbose&&w.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(G),this.onBuildObservable.notifyObservers(this),!1}serialize(){const G={};G.customType="BABYLON."+this.getClassName(),G.id=this.uniqueId,G.name=this.name,G.visibleOnFrame=this.visibleOnFrame,G.inputs=[],G.outputs=[];for(const V of this.inputs)G.inputs.push(V.serialize());for(const V of this.outputs)G.outputs.push(V.serialize(!1));return G}_deserialize(G){this._name=G.name,this.comments=G.comments,this.visibleOnFrame=!!G.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(G)}_deserializePortDisplayNamesAndExposedOnFrame(G){const V=G.inputs,W=G.outputs;if(V)for(const J of V){const G=this.inputs.find((G=>G.name===J.name));if(!G)return;if(J.displayName&&(G.displayName=J.displayName),J.isExposedOnFrame&&(G.isExposedOnFrame=J.isExposedOnFrame,G.exposedPortPosition=J.exposedPortPosition),void 0!==J.value&&null!==J.value)if("number"===J.valueType)G.value=J.value;else{const V=(0,z.c)(J.valueType);V&&(G.value=V.ld(J.value))}}if(W)for(let J=0;J<W.length;J++){const G=W[J];G.displayName&&(this.outputs[J].displayName=G.displayName),G.isExposedOnFrame&&(this.outputs[J].isExposedOnFrame=G.isExposedOnFrame,this.outputs[J].exposedPortPosition=G.exposedPortPosition)}}clone(){const G=this.serialize(),V=(0,z.c)(G.customType);if(V){const W=new V;return W._deserialize(G),W}return null}dispose(){this.Md.notifyObservers(this),this.Md.clear();for(const G of this.inputs)G.dispose();for(const G of this.outputs)G.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function hV(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",J=arguments.length>3?arguments[3]:void 0;return(R,d)=>{let k=R._propStore;k||(k=[],R._propStore=k),k.push({propertyName:d,displayName:G,type:V,groupName:W,options:J??{},className:R.getClassName()})}}(0,f.e)([(0,v.I)("comment")],EV.prototype,"comments",void 0),function(G){G[G.Boolean=0]="Boolean",G[G.Float=1]="Float",G[G.Int=2]="Int",G[G.Vector2=3]="Vector2",G[G.List=4]="List",G[G.nz=5]="nz",G[G.SamplingMode=6]="SamplingMode",G[G.TextureFormat=7]="TextureFormat",G[G.TextureType=8]="TextureType"}(aV||(aV={})),function(G){G[G.None=0]="None",G[G.Position=1]="Position",G[G.Direction=2]="Direction",G[G.Age=3]="Age",G[G.Lifetime=4]="Lifetime",G[G.Color=5]="Color",G[G.ScaledDirection=6]="ScaledDirection",G[G.Scale=7]="Scale",G[G.AgeGradient=8]="AgeGradient",G[G.Angle=9]="Angle",G[G.SpriteCellIndex=16]="SpriteCellIndex",G[G.SpriteCellStart=17]="SpriteCellStart",G[G.SpriteCellEnd=18]="SpriteCellEnd"}(MV||(MV={})),function(G){G[G.None=0]="None",G[G.Time=1]="Time",G[G.Delta=2]="Delta",G[G.Emitter=3]="Emitter"}(TV||(TV={}));class oV{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let G="";for(const V of this.notConnectedNonOptionalInputs)G+=`input ${V.name} from block ${V.ownerBlock.name}[${V.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(G)throw"Build of Node Particle System Set failed:\n"+G}adapt(G,V){const W=G.getConnectedValue(this)||0;if(G.type===V)return W;switch(V){case wV.Vector2:return new J.k(W,W);case wV.ed:return new J.o(W,W,W);case wV.nz:return new k.h(W,W,W,W)}return null}getContextualValue(G){if(!this.particleContext||!this.systemContext)return null;switch(G){case MV.Position:return this.particleContext.position;case MV.Direction:return this.particleContext.direction;case MV.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case MV.Color:return this.particleContext.color;case MV.Age:return this.particleContext.age;case MV.Lifetime:return this.particleContext.lifeTime;case MV.Angle:return this.particleContext.angle;case MV.Scale:return this.particleContext.scale;case MV.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case MV.SpriteCellEnd:return this.systemContext.endSpriteCellID;case MV.SpriteCellIndex:return this.particleContext.cellIndex;case MV.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(G){if(!this.particleContext||!this.systemContext)return null;switch(G){case TV.Time:return this.systemContext._actualFrame;case TV.Delta:return this.systemContext._scaledUpdateSpeed;case TV.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function cV(G,V,W){const J=new oV;J.tV=V;const R=G.createSystem(J);return R.canStart=()=>!0,R.j=W.clone(),R.disposeOnStop=!0,R.start(),R}class jV extends EV{constructor(G){super(G),this.blendMode=X.BLENDMODE_ONEONE,this.DV=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",wV.Particle),this.registerInput("texture",wV.Texture),this.registerInput("onStart",wV.System,!0),this.registerInput("onEnd",wV.System,!0),this.registerOutput("system",wV.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(G){G.DV=this.DV,G.buildId=this._buildId++,this.build(G);const V=this.particle.getConnectedValue(G);return V.particleTexture=this.texture.getConnectedValue(G),V.emitRate=this.emitRate,V.blendMode=this.blendMode,V.name=this.name,V._nodeGenerated=!0,V._targetStopDuration=this.targetStopDuration,V.startDelay=this.startDelay,this.system._storedValue=this,V.canStart=()=>!this.doNoStart,V.onStartedObservable.add((W=>{const J=this.onStart.getConnectedValue(G);J&&W.onStartedObservable.addOnce((()=>{G.systemContext=V;const W=cV(J,G.tV,G.emitterPosition);this.Md.addOnce((()=>{W.dispose()}))}));const R=this.onEnd.getConnectedValue(G);R&&W.onStoppedObservable.addOnce((()=>{G.systemContext=V;const W=cV(R,G.tV,G.emitterPosition);this.Md.addOnce((()=>{W.dispose()}))}))})),this.Md.addOnce((()=>{V.dispose()})),V}serialize(){const G=super.serialize();return G.DV=this.DV,G.emitRate=this.emitRate,G.blendMode=this.blendMode,G.doNoStart=this.doNoStart,G.targetStopDuration=this.targetStopDuration,G.startDelay=this.startDelay,G}_deserialize(G){super._deserialize(G),this.DV=G.DV,this.emitRate=G.emitRate,this.doNoStart=!!G.doNoStart,void 0!==G.blendMode&&(this.blendMode=G.blendMode),void 0!==G.targetStopDuration&&(this.targetStopDuration=G.targetStopDuration),void 0!==G.startDelay&&(this.startDelay=G.startDelay)}}(0,f.e)([hV("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:X.BLENDMODE_ONEONE},{label:"Standard",value:X.BLENDMODE_STANDARD},{label:"Add",value:X.BLENDMODE_ADD},{label:"Multiply",value:X.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:X.BLENDMODE_MULTIPLYADD}]})],jV.prototype,"blendMode",void 0),(0,f.e)([hV("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],jV.prototype,"DV",void 0),(0,f.e)([hV("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jV.prototype,"emitRate",void 0),(0,f.e)([hV("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jV.prototype,"targetStopDuration",void 0),(0,f.e)([hV("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jV.prototype,"startDelay",void 0),(0,f.e)([hV("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jV.prototype,"doNoStart",void 0),(0,z.d)("BABYLON.SystemBlock",jV);class IV extends EV{get type(){if(this._type===wV.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=wV.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=wV.Vector2,this._type;case"ed":return this._type=wV.ed,this._type;case"nz":return this._type=wV.nz,this._type;case"Matrix":return this._type=wV.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===MV.None&&this._systemSource!==TV.None}get systemSource(){return this._systemSource}set systemSource(G){if(this._systemSource=G,G!==TV.None){switch(this._contextualSource=MV.None,this._type=wV.Float,G){case TV.Time:case TV.Delta:this._type=wV.Float;break;case TV.Emitter:this._type=wV.ed}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==MV.None}get contextualValue(){return this._contextualSource}set contextualValue(G){if(this._contextualSource=G,G!==MV.None){switch(this._systemSource=TV.None,G){case MV.Scale:this._type=wV.Vector2;break;case MV.Position:case MV.Direction:case MV.ScaledDirection:this._type=wV.ed;break;case MV.Color:this._type=wV.nz;break;case MV.Age:case MV.Lifetime:case MV.Angle:case MV.AgeGradient:this._type=wV.Float;break;case MV.SpriteCellEnd:case MV.SpriteCellStart:case MV.SpriteCellIndex:this._type=wV.Int}this.output&&(this.output.type=this._type)}}constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wV.AutoDetect;super(G),this._type=wV.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new c.b,this._systemSource=TV.None,this._contextualSource=MV.None,this._type=V,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",V)}get value(){return this._storedValue}set value(G){this.type===wV.Float&&this.min!==this.max&&(G=Math.max(this.min,G),G=Math.min(this.max,G)),this._storedValue=G,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(G){this._valueCallback=G}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case wV.Int:case wV.Float:this.value=0;break;case wV.Vector2:this.value=J.k.Zero();break;case wV.ed:this.value=J.o.Zero();break;case wV.nz:this.value=new k.h(1,1,1,1);break;case wV.Matrix:this.value=J.c.Identity()}}_build(G){super._build(G),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=G=>G.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=G=>G.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const G=super.serialize();return G.type=this.type,G.contextualValue=this.contextualValue,G.systemSource=this.systemSource,G.min=this.min,G.max=this.max,G.groupInInspector=this.groupInInspector,G.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Bd?(G.valueType="BABYLON."+this._storedValue.getClassName(),G.value=this._storedValue.Bd()):(G.valueType="number",G.value=this._storedValue)),G}_deserialize(G){if(super._deserialize(G),this._type=G.type,this.contextualValue=G.contextualValue,this.systemSource=G.systemSource||TV.None,this.min=G.min||0,this.max=G.max||0,this.groupInInspector=G.groupInInspector||"",void 0!==G.displayInInspector&&(this.displayInInspector=G.displayInInspector),G.valueType)if("number"===G.valueType)this._storedValue=G.value;else{const V=(0,z.c)(G.valueType);V&&(this._storedValue=V.ld(G.value))}}}(0,z.d)("BABYLON.ParticleInputBlock",IV);class OV extends EV{get url(){return this._url}set url(G){this._url!==G&&(this._cachedData=null,this._url=G,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(G){this._textureDataUrl!==G&&(this._cachedData=null,this._textureDataUrl=G,this._url="",this._sourceTexture=null)}set sourceTexture(G){this._sourceTexture!==G&&(this._cachedData=null,this._sourceTexture=G,this._url="",this._textureDataUrl="")}constructor(G){super(G),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",wV.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const G=this.texture._storedValue;return await new Promise(((V,W)=>{if(!G.isReady())return void G.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),V(this._cachedData)}catch(G){W(G)}}));const J=G.getSize();fV.n.GetTextureDataAsync(G,J.width,J.height).then((W=>{this._cachedData={width:J.width,height:J.height,data:new Uint8ClampedArray(W)},G.dispose(),V(this._cachedData)})).catch(W)}))}_build(G){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new l.d(this._textureDataUrl,G.tV):this.texture._storedValue=new l.d(this._url,G.tV):this.texture._storedValue=null}serialize(){const G=super.serialize();return G.url=this.url,G.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(G.textureDataUrl=this.textureDataUrl),G}_deserialize(G){super._deserialize(G),this.url=G.url,this.serializedCachedData=!!G.serializedCachedData,G.textureDataUrl&&(this.textureDataUrl=G.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,z.d)("BABYLON.ParticleTextureSourceBlock",OV);class GW extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("position",wV.ed),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(G){const V=this.particle.getConnectedValue(G);if(this.output._storedValue=V,!this.position.isConnected)return;const W={process:W=>{G.particleContext=W,G.systemContext=V,W.position.J(this.position.getConnectedValue(G))},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W}}(0,z.d)("BABYLON.UpdatePositionBlock",GW),function(G){G[G.Add=0]="Add",G[G.Subtract=1]="Subtract",G[G.Multiply=2]="Multiply",G[G.Divide=3]="Divide",G[G.Max=4]="Max",G[G.Min=5]="Min"}(KV||(KV={}));class VW extends EV{constructor(G){super(G),this.operation=KV.Add,this.registerInput("left",wV.AutoDetect),this.registerInput("right",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this.output._typeConnectionSource=this.left;const V=[wV.Matrix,wV.Particle,wV.Texture,wV.System,wV.FloatGradient,wV.Color4Gradient,wV.Vector2Gradient,wV.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...V),this.right.excludedConnectionPointTypes.push(...V),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(G){let V;const W=this.left,R=this.right;if(!W.isConnected||!R.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const d=W.type===wV.Float||W.type===wV.Int,z=R.type===wV.Float||R.type===wV.Int,X=d&&z;switch(this.operation){case KV.Add:V=X?G=>W.getConnectedValue(G)+R.getConnectedValue(G):d?G=>G.adapt(W,R.type).add(R.getConnectedValue(G)):G=>W.getConnectedValue(G).add(G.adapt(R,W.type));break;case KV.Subtract:V=X?G=>W.getConnectedValue(G)-R.getConnectedValue(G):d?G=>G.adapt(W,R.type).zW(R.getConnectedValue(G)):G=>W.getConnectedValue(G).zW(G.adapt(R,W.type));break;case KV.Multiply:V=X?G=>W.getConnectedValue(G)*R.getConnectedValue(G):d?G=>G.adapt(W,R.type).multiply(R.getConnectedValue(G)):G=>W.getConnectedValue(G).multiply(G.adapt(R,W.type));break;case KV.Divide:V=X?G=>W.getConnectedValue(G)/R.getConnectedValue(G):d?G=>G.adapt(W,R.type).divide(R.getConnectedValue(G)):G=>W.getConnectedValue(G).divide(G.adapt(R,W.type));break;case KV.Min:if(X)V=G=>Math.min(W.getConnectedValue(G),R.getConnectedValue(G));else{const[G,z]=d?[R,W]:[W,R];switch(G.type){case wV.Vector2:V=V=>J.k.Minimize(G.getConnectedValue(V),V.adapt(z,G.type));break;case wV.ed:V=V=>J.o.Minimize(G.getConnectedValue(V),V.adapt(z,G.type));break;case wV.nz:V=V=>{const W=G.getConnectedValue(V),{r:J,g:R,b:d,a:X}=V.adapt(z,G.type);return new k.h(Math.min(W.r,J),Math.min(W.g,R),Math.min(W.b,d),Math.min(W.a,X))}}}break;case KV.Max:if(!X){const[G,z]=d?[R,W]:[W,R];switch(G.type){case wV.Vector2:V=V=>J.k.Maximize(G.getConnectedValue(V),V.adapt(z,G.type));break;case wV.ed:V=V=>J.o.Maximize(G.getConnectedValue(V),V.adapt(z,G.type));break;case wV.nz:V=V=>{const W=G.getConnectedValue(V),{r:J,g:R,b:d,a:X}=V.adapt(z,G.type);return new k.h(Math.max(W.r,J),Math.min(W.g,R),Math.min(W.b,d),Math.min(W.a,X))}}break}V=G=>Math.max(W.getConnectedValue(G),R.getConnectedValue(G))}this.output._storedFunction=G=>W.type===wV.Int?0|V(G):V(G)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===wV.Int||this.left.type===wV.Float&&this.right.type!==wV.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[G,V]of[[this.left,this.right],[this.right,this.left]])G.acceptedConnectionPointTypes=[wV.Int,wV.Float],V.isConnected&&(G.acceptedConnectionPointTypes.push(V.type),V.type!==wV.Int&&V.type!==wV.Float||G.acceptedConnectionPointTypes.push(wV.Vector2,wV.ed,wV.nz))}dispose(){super.dispose();for(const G of this._connectionObservers)G.remove();this._connectionObservers.length=0}serialize(){const G=super.serialize();return G.operation=this.operation,G}_deserialize(G){super._deserialize(G),this.operation=G.operation}}(0,f.e)([hV("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:KV.Add},{label:"Subtract",value:KV.Subtract},{label:"Multiply",value:KV.Multiply},{label:"Divide",value:KV.Divide},{label:"Max",value:KV.Max},{label:"Min",value:KV.Min}]})],VW.prototype,"operation",void 0),(0,z.d)("BABYLON.ParticleMathBlock",VW);class WW extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("direction1",wV.ed,!0,new J.o(0,1,0)),this.registerInput("direction2",wV.ed,!0,new J.o(0,1,0)),this.registerInput("minEmitBox",wV.ed,!0,new J.o(-.5,-.5,-.5)),this.registerInput("maxEmitBox",wV.ed,!0,new J.o(.5,.5,.5)),this.registerOutput("output",wV.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(G){const V=this.particle.getConnectedValue(G);V._directionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.direction1.getConnectedValue(G),d=this.direction2.getConnectedValue(G),k=(0,P.RandomRange)(R.x,d.x),z=(0,P.RandomRange)(R.y,d.y),X=(0,P.RandomRange)(R.z,d.z);G.isEmitterTransformNode?J.o.TransformNormalFromFloatsToRef(k,z,X,G.emitterWorldMatrix,W.direction):W.direction.rd(k,z,X)},V._positionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.minEmitBox.getConnectedValue(G),d=this.maxEmitBox.getConnectedValue(G),k=(0,P.RandomRange)(R.x,d.x),z=(0,P.RandomRange)(R.y,d.y),X=(0,P.RandomRange)(R.z,d.z);G.isEmitterTransformNode?J.o.TransformCoordinatesFromFloatsToRef(k,z,X,G.emitterWorldMatrix,W.position):(W.position.rd(k,z,X),W.position.addInPlace(G.emitterPosition))},this.output._storedValue=V}}(0,z.d)("BABYLON.BoxShapeBlock",WW);class JW extends EV{constructor(G){super(G),this.registerInput("emitPower",wV.Float,!0,1),this.registerInput("lifeTime",wV.Float,!0,1),this.registerInput("color",wV.nz,!0,new k.h(1,1,1,1)),this.registerInput("scale",wV.Vector2,!0,new J.k(1,1)),this.registerInput("angle",wV.Float,!0,0),this.registerOutput("particle",wV.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(G){const V=new zV(this.name,G.DV,G.tV,null,!1,void 0,!0);V.particleEmitterType=new B,V._lifeTimeCreation.process=(V,W)=>{G.particleContext=V,V.lifeTime=this.lifeTime.getConnectedValue(G),W._emitPower=this.emitPower.getConnectedValue(G)},V._colorCreation.process=V=>{G.particleContext=V,V.color.J(this.color.getConnectedValue(G))},V._sizeCreation.process=V=>{G.particleContext=V,V.size=1,V.scale.J(this.scale.getConnectedValue(G))},V._angleCreation.process=V=>{G.particleContext=V,V.angle=this.angle.getConnectedValue(G)},this.particle._storedValue=V}}(0,z.d)("BABYLON.CreateParticleBlock",JW);class RW{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const G=[];for(const V of this.attachedBlocks)V.isInput&&G.push(V);return G}constructor(G){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new c.b,this.name=G}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(G)&&this.attachedBlocks.push(G);for(const W of G.inputs){const J=W.connectedPoint;if(J){const W=J.ownerBlock;W!==G&&this._initializeBlock(W,V)}}}async buildAsync(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((W=>{const J=new uV;for(const G of this._systemBlocks)this._initializeBlock(G);for(const R of this.systemBlocks){const W=new oV;W.buildId=this._buildId++,W.tV=G,W.verbose=V;const d=R.createSystem(W);W.emitErrors(),J.systems.push(d)}this.onBuildObservable.notifyObservers(this),W(J)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const G=new jV("Particle system"),V=new GW("Update position");V.output.connectTo(G.particle);const W=new IV("Position");W.contextualValue=MV.Position;const J=new IV("Scaled direction");J.contextualValue=MV.ScaledDirection;const R=new VW("Add");R.operation=KV.Add,W.output.connectTo(R.left),J.output.connectTo(R.right),R.output.connectTo(V.position);const d=new JW("Create particle"),k=new WW("Box shape");d.particle.connectTo(k.particle),k.output.connectTo(V.particle);const z=new OV("Texture");z.texture.connectTo(G.texture),z.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(G)}removeBlock(G){const V=this.attachedBlocks.indexOf(G);if(V>-1&&this.attachedBlocks.splice(V,1),G.isSystem){const V=this._systemBlocks.indexOf(G);V>-1&&this._systemBlocks.splice(V,1)}}parseSerializedObject(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V||this.clear();const W={};for(const J of G.EP){const G=(0,z.c)(J.customType);if(G){const V=new G;V._deserialize(J),W[J.id]=V,this.attachedBlocks.push(V),V.isSystem&&this._systemBlocks.push(V)}}for(const J of this.attachedBlocks)if(J.isTeleportOut){const G=J,V=G._tempEntryPointUniqueId;if(V){const J=W[V];J&&J.attachToEndpoint(G)}}for(let J=0;J<G.EP.length;J++){const R=G.EP[J],d=W[R.id];d&&(d.inputs.length&&R.inputs.some((G=>G.targetConnectionName))&&!V||this._restoreConnections(d,G,W))}if(G.locations||G.editorData&&G.editorData.locations){const J=G.locations||G.editorData.locations;for(const G of J)W[G.EW]&&(G.EW=W[G.EW].uniqueId);V&&this.editorData&&this.editorData.locations&&J.concat(this.editorData.locations),G.locations?this.editorData={locations:J}:(this.editorData=G.editorData,this.editorData.locations=J);const R=[];for(const G in W)R[G]=W[G].uniqueId;this.editorData.map=R}this.comment=G.comment}_restoreConnections(G,V,W){for(const J of G.outputs)for(const R of V.EP){const d=W[R.id];if(d)for(const k of R.inputs)if(W[k.targetBlockId]!==G||k.targetConnectionName!==J.name);else{const G=d.getInputByName(k.inputName);if(!G||G.isConnected)continue;J.connectTo(G,!0),this._restoreConnections(d,V,W)}}}serialize(G){const V=G?{}:C.e.Serialize(this);V.editorData=JSON.parse(JSON.stringify(this.editorData));let W=[];G?W=G:V.customType="BABYLON.NodeParticleSystemSet",V.EP=[];for(const J of W)V.EP.push(J.serialize());if(!G)for(const J of this.attachedBlocks)-1===W.indexOf(J)&&V.EP.push(J.serialize());return V}dispose(){for(const G of this.attachedBlocks)G.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(G){const V=new RW(G);return V.setToDefault(),V}static Parse(G){const V=C.e.Parse((()=>new RW(G.name)),G,null);return V.parseSerializedObject(G),V}static ParseFromSnippetAsync(G,V){return"_BLANK"===G?Promise.resolve(RW.CreateDefault("blank")):new Promise(((W,J)=>{const R=new HV.b;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const k=JSON.parse(JSON.parse(R.responseText).jsonPayload),z=JSON.parse(k.nodeParticle);V||(V=C.e.Parse((()=>new RW(G)),z,null)),V.parseSerializedObject(z),V.snippetId=G;try{W(V)}catch(d){J(d)}}else J("Unable to load the snippet "+G)})),R.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),R.send()}))}}RW.EditorURL=`${bV.h._DefaultCdnUrl}/v${hG.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,RW.SnippetUrl="https://snippet.babylonjs.com",(0,f.e)([(0,v.I)()],RW.prototype,"name",void 0),(0,f.e)([(0,v.I)("comment")],RW.prototype,"comment",void 0),function(G){G[G.None=0]="None",G[G.PerParticle=1]="PerParticle",G[G.PerSystem=2]="PerSystem"}(sV||(sV={}));class dW extends EV{constructor(G){super(G),this._currentLockId=-2,this.lockMode=sV.PerParticle,this.registerInput("min",wV.AutoDetect,!0,0),this.registerInput("max",wV.AutoDetect,!0,1),this.registerOutput("output",wV.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wV.Float|wV.Int|wV.Vector2|wV.ed|wV.nz),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wV.Float|wV.Int|wV.Vector2|wV.ed|wV.nz),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=wV.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let G=null;switch(this._currentLockId=-2,this.min.type){case wV.AutoDetect:case wV.Int:case wV.Float:G=G=>{const V=this.min.getConnectedValue(G)||0,W=this.max.getConnectedValue(G)||1;return V+Math.random()*(W-V)};break;case wV.Vector2:G=G=>{const V=this.min.getConnectedValue(G)||J.k.Zero(),W=this.max.getConnectedValue(G)||J.k.One();return new J.k(V.x+Math.random()*(W.x-V.x),V.y+Math.random()*(W.y-V.y))};break;case wV.ed:G=G=>{const V=this.min.getConnectedValue(G)||J.o.Zero(),W=this.max.getConnectedValue(G)||J.o.One();return new J.o(V.x+Math.random()*(W.x-V.x),V.y+Math.random()*(W.y-V.y),V.z+Math.random()*(W.z-V.z))};break;case wV.nz:G=G=>{const V=this.min.getConnectedValue(G)||new k.h(0,0,0,0),W=this.max.getConnectedValue(G)||new k.h(1,1,1,1);return new k.h(V.x+Math.random()*(W.x-V.x),V.y+Math.random()*(W.y-V.y),V.z+Math.random()*(W.z-V.z),V.w+Math.random()*(W.w-V.w))}}this.output._storedFunction=V=>{var W;let J=0;switch(this.lockMode){case sV.PerParticle:J=(null===(W=V.particleContext)||void 0===W?void 0:W.id)||-1;break;case sV.PerSystem:J=V.buildId||0}return this._currentLockId!==J&&(this.lockMode!==sV.None&&(this._currentLockId=J),this.output._storedValue=G(V)),this.output._storedValue}}serialize(){const G=super.serialize();return G.lockMode=this.lockMode,G}_deserialize(G){super._deserialize(G),this.lockMode=G.lockMode}}(0,f.e)([hV("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:sV.None},{label:"Per particle",value:sV.PerParticle},{label:"Per system",value:sV.PerSystem}]})],dW.prototype,"lockMode",void 0),(0,z.d)("BABYLON.ParticleRandomBlock",dW);class kW extends EV{constructor(G){super(G),this._currentLockId=-2,this.lockMode=sV.PerParticle,this.registerInput("min",wV.AutoDetect),this.registerInput("max",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const V=[wV.Matrix,wV.Particle,wV.Texture,wV.System,wV.FloatGradient,wV.Color4Gradient,wV.Vector2Gradient,wV.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...V),this.max.excludedConnectionPointTypes.push(...V)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let G=null;switch(this._currentLockId=-2,this.min.type){case wV.Float:case wV.Int:G=G=>{const V=this.min.getConnectedValue(G),W=this.max.getConnectedValue(G);return Math.random()*(W-V)+V};break;case wV.Vector2:G=G=>{const V=this.min.getConnectedValue(G),W=this.max.getConnectedValue(G);return new J.k(Math.random()*(W.x-V.x)+V.x,Math.random()*(W.y-V.y)+V.y)};break;case wV.ed:G=G=>{const V=this.min.getConnectedValue(G),W=this.max.getConnectedValue(G);return new J.o(Math.random()*(W.x-V.x)+V.x,Math.random()*(W.y-V.y)+V.y,Math.random()*(W.z-V.z)+V.z)};break;case wV.nz:G=G=>{const V=this.min.getConnectedValue(G),W=this.max.getConnectedValue(G);return new k.h(Math.random()*(W.r-V.r)+V.r,Math.random()*(W.g-V.g)+V.g,Math.random()*(W.b-V.b)+V.b,Math.random()*(W.a-V.a)+V.a)}}this.output._storedFunction=V=>{var W;let J=0;switch(this.lockMode){case sV.PerParticle:J=(null===(W=V.particleContext)||void 0===W?void 0:W.id)||-1;break;case sV.PerSystem:J=V.buildId||0}return this._currentLockId!==J&&(this.lockMode!==sV.None&&(this._currentLockId=J),this.output._storedValue=G(V)),this.output._storedValue}}serialize(){const G=super.serialize();return G.lockMode=this.lockMode,G}_deserialize(G){super._deserialize(G),void 0!==G.lockMode&&(this.lockMode=G.lockMode)}}(0,f.e)([hV("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:sV.None},{label:"Per particle",value:sV.PerParticle},{label:"Per system",value:sV.PerSystem}]})],kW.prototype,"lockMode",void 0),(0,z.d)("BABYLON.RandomRangeBlock",kW);(0,z.d)("BABYLON.ParticleLerpBlock",class extends EV{constructor(G){super(G),this.registerInput("left",wV.AutoDetect),this.registerInput("right",wV.AutoDetect),this.registerInput("gradient",wV.Float,!0,0,0,1),this.registerOutput("output",wV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wV.Float|wV.Int|wV.Vector2|wV.ed|wV.nz)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const G=(G,V,W)=>(1-G)*V+G*W;this.output._storedFunction=V=>{const W=this.left.getConnectedValue(V),R=this.right.getConnectedValue(V),d=this.gradient.getConnectedValue(V);switch(this.left.type){case wV.Int:case wV.Float:return G(d,W,R);case wV.Vector2:return new J.k(G(d,W.x,R.x),G(d,W.y,R.y));case wV.ed:return new J.o(G(d,W.x,R.x),G(d,W.y,R.y),G(d,W.z,R.z));case wV.nz:return new k.h(G(d,W.r,R.r),G(d,W.g,R.g),G(d,W.b,R.b),G(d,W.a,R.a))}return 0}}});(0,z.d)("BABYLON.UpdateDirectionBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("direction",wV.ed),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(G){const V=this.particle.getConnectedValue(G);if(this.output._storedValue=V,!this.direction.isConnected)return;const W={process:W=>{G.particleContext=W,G.systemContext=V,W.direction.J(this.direction.getConnectedValue(G))},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W}});(0,z.d)("BABYLON.UpdateColorBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("color",wV.nz),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(G){const V=this.particle.getConnectedValue(G);if(this.output._storedValue=V,!this.color.isConnected)return;const W={process:W=>{G.particleContext=W,G.systemContext=V,W.color.J(this.color.getConnectedValue(G))},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W}});(0,z.d)("BABYLON.UpdateScaleBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("scale",wV.Vector2),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(G){const V=this.particle.getConnectedValue(G);if(this.output._storedValue=V,!this.scale.isConnected)return;const W={process:W=>{G.particleContext=W,G.systemContext=V,W.scale.J(this.scale.getConnectedValue(G))},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W}});(0,z.d)("BABYLON.UpdateAngleBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("angle",wV.Float),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(G){const V=this.particle.getConnectedValue(G);if(this.output._storedValue=V,!this.angle.isConnected)return;const W={process:W=>{G.particleContext=W,G.systemContext=V,W.angle=this.angle.getConnectedValue(G)},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W}});(0,z.d)("BABYLON.BasicPositionUpdateBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(G){const V=this.particle.getConnectedValue(G),W={process:W=>{G.particleContext=W,G.systemContext=V,W.direction.scaleToRef(V._directionScale,V._scaledDirection),W.position.addInPlace(V._scaledDirection)},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W,this.output._storedValue=V}});(0,z.d)("BABYLON.BasicSpriteUpdateBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(G){const V=this.particle.getConnectedValue(G),W={process:W=>{G.particleContext=W,G.systemContext=V,W.updateCellIndex()},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W,this.output._storedValue=V}});(0,z.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("cellIndex",wV.Int),this.registerOutput("output",wV.Particle),this.cellIndex.acceptedConnectionPointTypes=[wV.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(G){const V=this.particle.getConnectedValue(G);if(this.output._storedValue=V,!this.cellIndex.isConnected)return;const W={process:W=>{G.particleContext=W,G.systemContext=V,W.cellIndex=Math.floor(this.cellIndex.getConnectedValue(G))},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W}});class zW extends EV{constructor(G){super(G),this.strength=1,this.registerInput("particle",wV.Particle),this.registerInput("flowMap",wV.Texture),this.registerOutput("output",wV.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(G){var V;const W=this.particle.getConnectedValue(G),J=G.tV;let R;(null===(V=this.flowMap.connectedPoint)||void 0===V?void 0:V.ownerBlock).extractTextureContentAsync().then((G=>{G&&(R=new mV(G.width,G.height,G.data))}));const d={process:G=>{const V=J.getTransformMatrix();R&&R._processParticle(G,this.strength*W._tempScaledUpdateSpeed,V)},previousItem:null,nextItem:null};W._updateQueueStart?TG(d,W._updateQueueStart):W._updateQueueStart=d,this.output._storedValue=W}serialize(){const G=super.serialize();return G.strength=this.strength,G}_deserialize(G){super._deserialize(G),this.strength=G.strength}}(0,f.e)([hV("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zW.prototype,"strength",void 0),(0,z.d)("BABYLON.UpdateFlowMapBlock",zW);(0,z.d)("BABYLON.SphereShapeBlock",class extends EV{constructor(G){super(G),this.registerInput("input",wV.Particle),this.registerInput("radius",wV.Float,!0,1),this.registerInput("radiusRange",wV.Float,!0,1,0,1),this.registerInput("directionRandomizer",wV.Float,!0,0,0,1),this.registerOutput("output",wV.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(G){const V=this.input.getConnectedValue(G);V._directionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.directionRandomizer.getConnectedValue(G),d=W.position.zW(G.emitterPosition).normalize(),k=(0,P.RandomRange)(0,R),z=(0,P.RandomRange)(0,R),X=(0,P.RandomRange)(0,R);d.x+=k,d.y+=z,d.z+=X,d.normalize(),G.isEmitterTransformNode?J.o.TransformNormalFromFloatsToRef(k,z,X,G.emitterWorldMatrix,W.direction):W.direction.rd(k,z,X)},V._positionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.radius.getConnectedValue(G),d=this.radiusRange.getConnectedValue(G),k=R-(0,P.RandomRange)(0,R*d),z=(0,P.RandomRange)(0,1),X=(0,P.RandomRange)(0,2*Math.PI),A=Math.acos(2*z-1),x=k*Math.cos(X)*Math.sin(A),q=k*Math.cos(A),L=k*Math.sin(X)*Math.sin(A);G.isEmitterTransformNode?J.o.TransformCoordinatesFromFloatsToRef(x,q,L,G.emitterWorldMatrix,W.position):(W.position.rd(x,q,L),W.position.addInPlace(G.emitterPosition))},this.output._storedValue=V}});(0,z.d)("BABYLON.PointShapeBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("direction1",wV.ed,!0,new J.o(0,1,0)),this.registerInput("direction2",wV.ed,!0,new J.o(0,1,0)),this.registerOutput("output",wV.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(G){const V=this.particle.getConnectedValue(G);V._directionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.direction1.getConnectedValue(G),d=this.direction2.getConnectedValue(G),k=(0,P.RandomRange)(R.x,d.x),z=(0,P.RandomRange)(R.y,d.y),X=(0,P.RandomRange)(R.z,d.z);G.isEmitterTransformNode?J.o.TransformNormalFromFloatsToRef(k,z,X,G.emitterWorldMatrix,W.direction):W.direction.rd(k,z,X)},V._positionCreation.process=W=>{G.systemContext=V,G.isEmitterTransformNode?J.o.TransformCoordinatesFromFloatsToRef(0,0,0,G.emitterWorldMatrix,W.position):W.position.J(G.emitterPosition)},this.output._storedValue=V}});(0,z.d)("BABYLON.CustomShapeBlock",class extends EV{constructor(G){super(G),this.registerInput("particle",wV.Particle),this.registerInput("position",wV.ed,!0,new J.o(0,0,0)),this.registerInput("direction",wV.ed,!0,new J.o(0,1,0)),this.registerOutput("output",wV.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(G){const V=this.particle.getConnectedValue(G);V._directionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.direction.getConnectedValue(G);G.isEmitterTransformNode?J.o.TransformNormalToRef(R,G.emitterWorldMatrix,W.direction):W.direction.J(R)},V._positionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.position.getConnectedValue(G);G.isEmitterTransformNode?J.o.TransformCoordinatesToRef(R,G.emitterWorldMatrix,W.position):(W.position.J(R),W.position.addInPlace(G.emitterPosition))},this.output._storedValue=V}});(0,z.d)("BABYLON.CylinderShapeBlock",class extends EV{constructor(G){super(G),this._tempVector=J.o.Zero(),this.registerInput("particle",wV.Particle),this.registerInput("radius",wV.Float,!0,1),this.registerInput("height",wV.Float,!0,1,0),this.registerInput("radiusRange",wV.Float,!0,1,0,1),this.registerInput("directionRandomizer",wV.Float,!0,0,0,1),this.registerOutput("output",wV.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(G){const V=this.particle.getConnectedValue(G);V._directionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.directionRandomizer.getConnectedValue(G);W.position.subtractToRef(G.emitterPosition,this._tempVector),this._tempVector.normalize(),G.isEmitterTransformNode&&J.o.TransformNormalToRef(this._tempVector,G.emitterInverseWorldMatrix,this._tempVector);const d=(0,P.RandomRange)(-R/2,R/2);let k=Math.atan2(this._tempVector.x,this._tempVector.z);k+=(0,P.RandomRange)(-Math.PI/2,Math.PI/2)*R,this._tempVector.y=d,this._tempVector.x=Math.sin(k),this._tempVector.z=Math.cos(k),this._tempVector.normalize(),G.isEmitterTransformNode?J.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,G.emitterWorldMatrix,W.direction):W.direction.J(this._tempVector)},V._positionCreation.process=W=>{G.particleContext=W,G.systemContext=V;const R=this.height.getConnectedValue(G),d=this.radiusRange.getConnectedValue(G),k=this.radius.getConnectedValue(G),z=(0,P.RandomRange)(-R/2,R/2),X=(0,P.RandomRange)(0,2*Math.PI),A=(0,P.RandomRange)((1-d)*(1-d),1),x=Math.sqrt(A)*k,q=x*Math.cos(X),L=x*Math.sin(X);G.isEmitterTransformNode?J.o.TransformCoordinatesFromFloatsToRef(q,z,L,G.emitterWorldMatrix,W.position):(W.position.rd(q,z,L),W.position.addInPlace(G.emitterPosition))},this.output._storedValue=V}});class XW extends EV{constructor(G){super(G),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",wV.Particle),this.registerOutput("output",wV.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){super._build(G);const V=this.particle.getConnectedValue(G);V._isAnimationSheetEnabled=!0,V.spriteCellWidth=this.width,V.spriteCellHeight=this.height,V.startSpriteCellID=this.start,V.endSpriteCellID=this.end,V.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=V}serialize(){const G=super.serialize();return G.width=this.width,G.height=this.height,G.start=this.start,G.end=this.end,G.randomStartCell=this.randomStartCell,G}_deserialize(G){super._deserialize(G),this.width=G.width,this.height=G.height,this.start=G.start,this.end=G.end,this.randomStartCell=G.randomStartCell}}(0,f.e)([hV("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XW.prototype,"start",void 0),(0,f.e)([hV("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XW.prototype,"end",void 0),(0,f.e)([hV("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XW.prototype,"width",void 0),(0,f.e)([hV("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XW.prototype,"height",void 0),(0,f.e)([hV("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],XW.prototype,"loop",void 0),(0,f.e)([hV("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],XW.prototype,"randomStartCell",void 0),(0,z.d)("BABYLON.SetupSpriteSheetBlock",XW);class PW extends EV{constructor(G){super(G),this.reference=0,this.registerInput("value",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=G=>{switch(G){case wV.Float:return wV.FloatGradient;case wV.Vector2:return wV.Vector2Gradient;case wV.ed:return wV.Vector3Gradient;case wV.nz:return wV.Color4Gradient}return G},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wV.Float|wV.Vector2|wV.ed|wV.nz)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=G=>null}serialize(){const G=super.serialize();return G.reference=this.reference,G}_deserialize(G){super._deserialize(G),this.reference=G.reference}}(0,f.e)([hV("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],PW.prototype,"reference",void 0),(0,z.d)("BABYLON.ParticleGradientValueBlock",PW);(0,z.d)("BABYLON.ParticleGradientBlock",class extends EV{constructor(G){super(G),this._entryCount=1,this.registerInput("gradient",wV.Float,!0,1,0,1),this.registerInput("value0",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=G=>{switch(G){case wV.FloatGradient:return wV.Float;case wV.Vector2Gradient:return wV.Vector2;case wV.Vector3Gradient:return wV.ed;case wV.Color4Gradient:return wV.nz}return G},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wV.FloatGradient|wV.Vector2Gradient|wV.Vector3Gradient|wV.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(G){this._inputs[G].onConnectionObservable.add((()=>{this._entryCount>G||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),wV.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const G=[];for(let W=1;W<this._inputs.length;W++){var V;if(this._inputs[W].isConnected)G.push(null===(V=this._inputs[W].connectedPoint)||void 0===V?void 0:V.ownerBlock)}G.sort(((G,V)=>G.reference-V.reference)),this.output._storedFunction=V=>{const W=this.gradient.getConnectedValue(V);if(1===G.length)return G[0].value.getConnectedValue(V);let R=null;for(let d=G.length-1;d>=0;d--){const z=G[d];if(z.reference<=W){const G=z.value.getConnectedValue(V);if(R){const d=R.value.getConnectedValue(V),X=R.reference,A=z.reference,x=Math.max(0,Math.min(1,(W-A)/(X-A)));switch(this.output.type){case wV.Float:return(0,P.Lerp)(G,d,x);case wV.Vector2:return J.k.Lerp(G,d,x);case wV.ed:return J.o.Lerp(G,d,x);case wV.nz:return k.h.Lerp(G,d,x)}}return G}R=z}return 0}}});(0,z.d)("BABYLON.ParticleConverterBlock",class extends EV{constructor(G){super(G),this.registerInput("color ",wV.nz,!0),this.registerInput("xyz ",wV.ed,!0),this.registerInput("xy ",wV.Vector2,!0),this.registerInput("zw ",wV.Vector2,!0),this.registerInput("x ",wV.Float,!0),this.registerInput("y ",wV.Float,!0),this.registerInput("z ",wV.Float,!0),this.registerInput("w ",wV.Float,!0),this.registerOutput("color",wV.nz),this.registerOutput("xyz",wV.ed),this.registerOutput("xy",wV.Vector2),this.registerOutput("zw",wV.Vector2),this.registerOutput("x",wV.Float),this.registerOutput("y",wV.Float),this.registerOutput("z",wV.Float),this.registerOutput("w",wV.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(G){return"color "===G?"colorIn":"xyz "===G?"xyzIn":"xy "===G?"xyIn":"zw "===G?"zwIn":"x "===G?"xIn":"y "===G?"yIn":"z "===G?"zIn":"w "===G?"wIn":G}_outputRename(G){switch(G){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return G}}_build(G){super._build(G);const V=this.xIn,W=this.yIn,R=this.zIn,d=this.wIn,z=this.xyIn,X=this.zwIn,P=this.xyzIn,A=this.colorIn,x=this.colorOut,q=this.xyzOut,L=this.xyOut,t=this.zwOut,Y=this.xOut,g=this.yOut,B=this.zOut,S=this.wOut,p=G=>{if(A.isConnected)return A.getConnectedValue(G);let J=0,x=0,q=0,L=0;if(V.isConnected&&(J=V.getConnectedValue(G)),W.isConnected&&(x=W.getConnectedValue(G)),R.isConnected&&(q=R.getConnectedValue(G)),d.isConnected&&(L=d.getConnectedValue(G)),z.isConnected){const V=z.getConnectedValue(G);V&&(J=V.x,x=V.y)}if(X.isConnected){const V=X.getConnectedValue(G);V&&(q=V.x,L=V.y)}if(P.isConnected){const V=P.getConnectedValue(G);V&&(J=V.x,x=V.y,q=V.z)}return new k.h(J,x,q,L)};x._storedFunction=G=>p(G),q._storedFunction=G=>{const V=p(G);return new J.o(V.r,V.g,V.b)},L._storedFunction=G=>{const V=p(G);return new J.k(V.r,V.g)},t._storedFunction=G=>{const V=p(G);return new J.k(V.b,V.a)},Y._storedFunction=G=>p(G).r,g._storedFunction=G=>p(G).g,B._storedFunction=G=>p(G).b,S._storedFunction=G=>p(G).a}}),function(G){G[G.Cos=0]="Cos",G[G.Sin=1]="Sin",G[G.Abs=2]="Abs",G[G.Exp=3]="Exp",G[G.Exp2=4]="Exp2",G[G.Round=5]="Round",G[G.Floor=6]="Floor",G[G.Ceiling=7]="Ceiling",G[G.Sqrt=8]="Sqrt",G[G.Log=9]="Log",G[G.Tan=10]="Tan",G[G.ArcTan=11]="ArcTan",G[G.ArcCos=12]="ArcCos",G[G.ArcSin=13]="ArcSin",G[G.Sign=14]="Sign",G[G.Negate=15]="Negate",G[G.OneMinus=16]="OneMinus",G[G.Reciprocal=17]="Reciprocal",G[G.ToDegrees=18]="ToDegrees",G[G.ToRadians=19]="ToRadians",G[G.Fract=20]="Fract"}(QV||(QV={}));class AW extends EV{constructor(G){super(G),this.operation=QV.Cos,this.registerInput("input",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wV.Float|wV.Int|wV.Vector2|wV.ed|wV.nz)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){super._build(G);let V=null;switch(this.operation){case QV.Cos:V=G=>Math.cos(G);break;case QV.Sin:V=G=>Math.sin(G);break;case QV.Abs:V=G=>Math.abs(G);break;case QV.Exp:V=G=>Math.exp(G);break;case QV.Exp2:V=G=>Math.pow(2,G);break;case QV.Round:V=G=>Math.round(G);break;case QV.Floor:V=G=>Math.floor(G);break;case QV.Ceiling:V=G=>Math.ceil(G);break;case QV.Sqrt:V=G=>Math.sqrt(G);break;case QV.Log:V=G=>Math.log(G);break;case QV.Tan:V=G=>Math.tan(G);break;case QV.ArcTan:V=G=>Math.atan(G);break;case QV.ArcCos:V=G=>Math.acos(G);break;case QV.ArcSin:V=G=>Math.asin(G);break;case QV.Sign:V=G=>Math.sign(G);break;case QV.Negate:V=G=>-G;break;case QV.OneMinus:V=G=>1-G;break;case QV.Reciprocal:V=G=>1/G;break;case QV.ToRadians:V=G=>G*Math.PI/180;break;case QV.ToDegrees:V=G=>180*G/Math.PI;break;case QV.Fract:V=G=>G>=0?G-Math.floor(G):G-Math.ceil(G)}if(!V)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case wV.Int:case wV.Float:this.output._storedFunction=G=>{const W=this.input.getConnectedValue(G);return V(W)};break;case wV.Vector2:this.output._storedFunction=G=>{const W=this.input.getConnectedValue(G);return new J.k(V(W.x),V(W.y))};break;case wV.ed:this.output._storedFunction=G=>{const W=this.input.getConnectedValue(G);return new J.o(V(W.x),V(W.y),V(W.z))};break;case wV.nz:this.output._storedFunction=G=>{const W=this.input.getConnectedValue(G);return new k.h(V(W.r),V(W.g),V(W.b),V(W.a))}}return this}serialize(){const G=super.serialize();return G.operation=this.operation,G}_deserialize(G){super._deserialize(G),this.operation=G.operation}}(0,f.e)([hV("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:QV.Cos},{label:"Sin",value:QV.Sin},{label:"Abs",value:QV.Abs},{label:"Exp",value:QV.Exp},{label:"Exp2",value:QV.Exp2},{label:"Round",value:QV.Round},{label:"Floor",value:QV.Floor},{label:"Ceiling",value:QV.Ceiling},{label:"Sqrt",value:QV.Sqrt},{label:"Log",value:QV.Log},{label:"Tan",value:QV.Tan},{label:"ArcTan",value:QV.ArcTan},{label:"ArcCos",value:QV.ArcCos},{label:"ArcSin",value:QV.ArcSin},{label:"Sign",value:QV.Sign},{label:"Negate",value:QV.Negate},{label:"OneMinus",value:QV.OneMinus},{label:"Reciprocal",value:QV.Reciprocal},{label:"ToDegrees",value:QV.ToDegrees},{label:"ToRadians",value:QV.ToRadians},{label:"Fract",value:QV.Fract}]})],AW.prototype,"operation",void 0),(0,z.d)("BABYLON.ParticleTrigonometryBlock",AW);var xW,qW=W(12752);class LW extends EV{constructor(G){super(G),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(wV.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(wV.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(wV.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(wV.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(wV.System),this._inputs[0].excludedConnectionPointTypes.push(wV.Particle),this._inputs[0].excludedConnectionPointTypes.push(wV.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const V=G=>{const V=this.input.getConnectedValue(G);if(this.log.length>=this.stackSize)return V;if(null===V||void 0===V)return this.log.push(["null",""]),V;switch(this.input.type){case wV.Vector2:this.log.push([(0,qW.j)(V,4),V.toString()]);break;case wV.ed:this.log.push([(0,qW.n)(V,4),V.toString()]);break;case wV.nz:this.log.push([`{R: ${V.r.toFixed(4)} G: ${V.g.toFixed(4)} B: ${V.b.toFixed(4)} A: ${V.a.toFixed(4)}}`,V.toString()]);break;default:this.log.push([V.toString(),V.toString()])}return V};this.output.isConnected?this.output._storedFunction=V:this.output._storedValue=V(G)}serialize(){const G=super.serialize();return G.stackSize=this.stackSize,G}_deserialize(G){super._deserialize(G),this.stackSize=G.stackSize}}(0,f.e)([hV("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],LW.prototype,"stackSize",void 0),(0,z.d)("BABYLON.ParticleDebugBlock",LW);(0,z.d)("BABYLON.ParticleElbowBlock",class extends EV{constructor(G){super(G),this.registerInput("input",wV.AutoDetect),this.registerOutput("output",wV.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){super._build(G);const V=this._outputs[0],W=this._inputs[0];V._storedFunction=G=>W.getConnectedValue(G)}});(0,z.d)("BABYLON.ParticleTeleportInBlock",class extends EV{get endpoints(){return this._endpoints}constructor(G){super(G),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",wV.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(G){if(this.getClassName()===G)return!0;for(const V of this.endpoints)if(V.isAnAncestorOfType(G))return!0;return!1}isAnAncestorOf(G){for(const V of this.endpoints){if(V===G)return!0;if(V.isAnAncestorOf(G))return!0}return!1}attachToEndpoint(G){G.detach(),this._endpoints.push(G),G._entryPoint=this,G._outputs[0]._typeConnectionSource=this._inputs[0],G._tempEntryPointUniqueId=null,G.name="> "+this.name}detachFromEndpoint(G){const V=this._endpoints.indexOf(G);-1!==V&&(this._endpoints.splice(V,1),G._outputs[0]._typeConnectionSource=null,G._entryPoint=null)}_build(){for(const G of this._endpoints)G.output._storedFunction=G=>this.input.getConnectedValue(G)}});(0,z.d)("BABYLON.ParticleTeleportOutBlock",class extends EV{constructor(G){super(G),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",wV.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(G){this.entryPoint&&this.entryPoint.build(G)}clone(){const G=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(G),G}serialize(){var G;const V=super.serialize();return V.entryPoint=(null===(G=this.entryPoint)||void 0===G?void 0:G.uniqueId)??"",V}_deserialize(G){super._deserialize(G),this._tempEntryPointUniqueId=G.entryPoint}}),function(G){G[G.Equal=0]="Equal",G[G.NotEqual=1]="NotEqual",G[G.LessThan=2]="LessThan",G[G.GreaterThan=3]="GreaterThan",G[G.LessOrEqual=4]="LessOrEqual",G[G.GreaterOrEqual=5]="GreaterOrEqual",G[G.Xor=6]="Xor",G[G.Or=7]="Or",G[G.And=8]="And"}(xW||(xW={}));class tW extends EV{constructor(G){super(G),this.test=xW.Equal,this.epsilon=0,this.registerInput("left",wV.Float),this.registerInput("right",wV.Float,!0,0),this.registerInput("ifTrue",wV.AutoDetect,!0,1),this.registerInput("ifFalse",wV.AutoDetect,!0,0),this.registerOutput("output",wV.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=wV.Float,this._inputs[0].acceptedConnectionPointTypes.push(wV.Int),this._inputs[1].acceptedConnectionPointTypes.push(wV.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const G=G=>{const V=this.left.getConnectedValue(G),W=this.right.getConnectedValue(G);let J=!1;switch(this.test){case xW.Equal:J=(0,P.WithinEpsilon)(V,W,this.epsilon);break;case xW.NotEqual:J=!(0,P.WithinEpsilon)(V,W,this.epsilon);break;case xW.LessThan:J=V<W+this.epsilon;break;case xW.GreaterThan:J=V>W-this.epsilon;break;case xW.LessOrEqual:J=V<=W+this.epsilon;break;case xW.GreaterOrEqual:J=V>=W-this.epsilon;break;case xW.Xor:J=!!V&&!W||!V&&!!W;break;case xW.Or:J=!!V||!!W;break;case xW.And:J=!!V&&!!W}return J};this.output._storedFunction=V=>G(V)?this.ifTrue.getConnectedValue(V):this.ifFalse.getConnectedValue(V)}serialize(){const G=super.serialize();return G.test=this.test,G.epsilon=this.epsilon,G}_deserialize(G){super._deserialize(G),this.test=G.test,void 0!==G.epsilon&&(this.epsilon=G.epsilon)}}(0,f.e)([hV("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:xW.Equal},{label:"NotEqual",value:xW.NotEqual},{label:"LessThan",value:xW.LessThan},{label:"GreaterThan",value:xW.GreaterThan},{label:"LessOrEqual",value:xW.LessOrEqual},{label:"GreaterOrEqual",value:xW.GreaterOrEqual},{label:"Xor",value:xW.Xor},{label:"Or",value:xW.Or},{label:"And",value:xW.And}]})],tW.prototype,"test",void 0),(0,f.e)([hV("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tW.prototype,"epsilon",void 0),(0,z.d)("BABYLON.ParticleConditionBlock",tW);class YW extends EV{constructor(G){super(G),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",wV.Particle),this.registerInput("condition",wV.Float,!0,0),this.registerInput("system",wV.System),this.registerOutput("output",wV.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(G){this._triggerCount=0;const V=this.input.getConnectedValue(G),W={process:W=>{if(G.particleContext=W,G.systemContext=V,0!==this.condition.getConnectedValue(G)&&(0===this.limit||this._triggerCount<this.limit)){const J=(new Date).getTime();if(this._previousOne&&J-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=J;const R=this.system.getConnectedValue(G);if(R){const J=cV(R,G.tV,W.position);J.Md.addOnce((()=>{this._triggerCount--})),V.Md.addOnce((()=>{J.dispose()}))}}},previousItem:null,nextItem:null};V._updateQueueStart?TG(W,V._updateQueueStart):V._updateQueueStart=W,this.output._storedValue=V}serialize(){const G=super.serialize();return G.limit=this.limit,G.delay=this.delay,G}_deserialize(G){super._deserialize(G),void 0!==G.limit&&(this.limit=G.limit),void 0!==G.delay&&(this.delay=G.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,f.e)([hV("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],YW.prototype,"limit",void 0),(0,f.e)([hV("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],YW.prototype,"delay",void 0),(0,z.d)("BABYLON.ParticleTriggerBlock",YW);W(12756),W(12763),W(12772),W(12828)},12803:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12779:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12852:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneVertex",d="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12837:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12819:(G,V,W)=>{"use strict";var J=W(11270);const R="fogFragment",d="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12801:(G,V,W)=>{"use strict";var J=W(11270);const R="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12861:(G,V,W)=>{"use strict";var J=W(11270);const R="fogVertex",d="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12846:(G,V,W)=>{"use strict";var J=W(11270);const R="fogVertexDeclaration",d="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12791:(G,V,W)=>{"use strict";var J=W(11270);const R="helperFunctions",d="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12782:(G,V,W)=>{"use strict";var J=W(11270);const R="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12796:(G,V,W)=>{"use strict";var J=W(11270);const R="imageProcessingFunctions",d="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12788:(G,V,W)=>{"use strict";var J=W(11270);const R="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12812:(G,V,W)=>{"use strict";var J=W(11270);const R="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12870:(G,V,W)=>{"use strict";var J=W(11270);const R="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";J.d.IncludesShadersStoreWGSL[R]||(J.d.IncludesShadersStoreWGSL[R]=d)},12772:(G,V,W)=>{"use strict";W.r(V),W.d(V,{particlesPixelShaderWGSL:()=>k});var J=W(11270);W(12779),W(12782),W(12788),W(12791),W(12796),W(12801),W(12803),W(12812),W(12819);const R="particlesPixelShader",d="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.d.ShadersStoreWGSL[R]||(J.d.ShadersStoreWGSL[R]=d);const k={name:R,shader:d}},12828:(G,V,W)=>{"use strict";W.r(V),W.d(V,{particlesVertexShaderWGSL:()=>k});var J=W(11270);W(12837),W(12846),W(12788),W(12852),W(12861),W(12870);const R="particlesVertexShader",d="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStoreWGSL[R]||(J.d.ShadersStoreWGSL[R]=d);const k={name:R,shader:d}},12693:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12759:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12715:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneVertex",d="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12767:(G,V,W)=>{"use strict";var J=W(11270);const R="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12706:(G,V,W)=>{"use strict";var J=W(11270);const R="fogFragment",d="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12690:(G,V,W)=>{"use strict";var J=W(11270);const R="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12722:(G,V,W)=>{"use strict";var J=W(11270);const R="fogVertex",d="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12708:(G,V,W)=>{"use strict";var J=W(11270);const R="fogVertexDeclaration",d="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12679:(G,V,W)=>{"use strict";var J=W(11270);const R="helperFunctions",d="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12671:(G,V,W)=>{"use strict";var J=W(11270);const R="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12684:(G,V,W)=>{"use strict";var J=W(11270);const R="imageProcessingFunctions",d="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12677:(G,V,W)=>{"use strict";var J=W(11270);const R="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12697:(G,V,W)=>{"use strict";var J=W(11270);const R="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12725:(G,V,W)=>{"use strict";var J=W(11270);const R="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";J.d.IncludesShadersStore[R]||(J.d.IncludesShadersStore[R]=d)},12756:(G,V,W)=>{"use strict";W.r(V),W.d(V,{particlesPixelShader:()=>k});var J=W(11270);W(12759),W(12671),W(12677),W(12679),W(12684),W(12690),W(12693),W(12697),W(12706);const R="particlesPixelShader",d="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.d.ShadersStore[R]||(J.d.ShadersStore[R]=d);const k={name:R,shader:d}},12763:(G,V,W)=>{"use strict";W.r(V),W.d(V,{particlesVertexShader:()=>k});var J=W(11270);W(12767),W(12708),W(12677),W(12715),W(12722),W(12725);const R="particlesVertexShader",d="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStore[R]||(J.d.ShadersStore[R]=d);const k={name:R,shader:d}},13124:(G,V,W)=>{"use strict";W.r(V),W.d(V,{FlowGraphGLTFDataProvider:()=>d});var J=W(13093),R=W(13071);class d extends J.c{constructor(G){var V,W;super();const J=G.glTF,d=(null===(V=J.animations)||void 0===V?void 0:V.map((G=>G._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",R.b,d);const k=(null===(W=J.nodes)||void 0===W?void 0:W.map((G=>G._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",R.b,k)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13008:(G,V,W)=>{"use strict";W.d(V,{b:()=>g,d:()=>t,h:()=>L,l:()=>Y});var J=W(11136),R=W(11705),d=W(11424),k=W(13015);const z=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class X{constructor(G,V){this._gltf=G,this._infoTree=V}convert(G){let V,W=this._gltf,J=this._infoTree;if(!G.startsWith("/"))throw new Error("Path must start with a /");const R=G.split("/");if(R.shift(),R[R.length-1].includes(".length")){const G=R[R.length-1].split(".");R.pop(),R.push(...G)}let d=!1;for(const X of R){const R="length"===X;if(R&&!J.__array__)throw new Error(`Path ${G} is invalid`);if(J.__ignoreObjectTree__&&(d=!0),J.__array__&&!R)J=J.__array__;else if(J=J[X],!J)throw new Error(`Path ${G} is invalid`);if(!d)if(void 0===W){if(!z.find((V=>V.regex.test(G))))throw new Error(`Path ${G} is invalid`)}else if(!R){var k;W=null===(k=W)||void 0===k?void 0:k[X]}(J.__target__||R)&&(V=W)}return{object:V,info:J}}}function P(G,V,W,J){const R=A(G,V);return J?R[W][J]:R[W]}function A(G,V,W){var J,d;return null===(J=G._data)||void 0===J||null===(d=J[(null===W||void 0===W?void 0:W.fillMode)??R.d.MATERIAL_TriangleFillMode])||void 0===d?void 0:d.babylonMaterial}function x(G,V){return{offset:{componentsCount:2,type:"Vector2",get:(W,R,d)=>{const k=P(W,d,G,V);return new J.k(null===k||void 0===k?void 0:k.uOffset,null===k||void 0===k?void 0:k.vOffset)},getTarget:A,set:(W,J,R,d)=>{const k=P(J,d,G,V);k.uOffset=W.x,k.vOffset=W.y},getPropertyName:[()=>`${G}${V?"."+V:""}.uOffset`,()=>`${G}${V?"."+V:""}.vOffset`]},rotation:{type:"number",get:(W,J,R)=>{var d;return null===(d=P(W,R,G,V))||void 0===d?void 0:d.wAng},getTarget:A,set:(W,J,R,d)=>P(J,d,G,V).wAng=W,getPropertyName:[()=>`${G}${V?"."+V:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(W,R,d)=>{const k=P(W,d,G,V);return new J.k(null===k||void 0===k?void 0:k.uScale,null===k||void 0===k?void 0:k.vScale)},getTarget:A,set:(W,J,R,d)=>{const k=P(J,d,G,V);k.uScale=W.x,k.vScale=W.y},getPropertyName:[()=>`${G}${V?"."+V:""}.uScale`,()=>`${G}${V?"."+V:""}.vScale`]}}}const q={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:G=>{var V,W;return new J.k((null===(V=G._babylonCamera)||void 0===V?void 0:V.orthoLeft)??0,(null===(W=G._babylonCamera)||void 0===W?void 0:W.orthoRight)??0)},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.orthoLeft=G.x,V._babylonCamera.orthoRight=G.y)},getTarget:G=>G,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:G=>{var V,W;return new J.k((null===(V=G._babylonCamera)||void 0===V?void 0:V.orthoBottom)??0,(null===(W=G._babylonCamera)||void 0===W?void 0:W.orthoTop)??0)},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.orthoBottom=G.x,V._babylonCamera.orthoTop=G.y)},getTarget:G=>G,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:G=>{var V;return null===(V=G._babylonCamera)||void 0===V?void 0:V.maxZ},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.maxZ=G)},getTarget:G=>G,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:G=>{var V;return null===(V=G._babylonCamera)||void 0===V?void 0:V.Zd},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.Zd=G)},getTarget:G=>G,getPropertyName:[()=>"Zd"]}},perspective:{aspectRatio:{type:"number",get:G=>{var V;return null===(V=G._babylonCamera)||void 0===V?void 0:V.getEngine().getAspectRatio(G._babylonCamera)},getTarget:G=>G,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:G=>{var V;return null===(V=G._babylonCamera)||void 0===V?void 0:V.fov},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.fov=G)},getTarget:G=>G,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:G=>{var V;return null===(V=G._babylonCamera)||void 0===V?void 0:V.maxZ},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.maxZ=G)},getTarget:G=>G,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:G=>{var V;return null===(V=G._babylonCamera)||void 0===V?void 0:V.Zd},set:(G,V)=>{V._babylonCamera&&(V._babylonCamera.Zd=G)},getTarget:G=>G,getPropertyName:[()=>"Zd"]}}}},nodes:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ed",get:G=>{var V;return null===(V=G._babylonTransformNode)||void 0===V?void 0:V.position},set:(G,V)=>{var W;return null===(W=V._babylonTransformNode)||void 0===W?void 0:W.position.J(G)},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:G=>{var V;return null===(V=G._babylonTransformNode)||void 0===V?void 0:V.rotationQuaternion},set:(G,V)=>{var W,J;return null===(W=V._babylonTransformNode)||void 0===W||null===(J=W.rotationQuaternion)||void 0===J?void 0:J.J(G)},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ed",get:G=>{var V;return null===(V=G._babylonTransformNode)||void 0===V?void 0:V.vd},set:(G,V)=>{var W;return null===(W=V._babylonTransformNode)||void 0===W?void 0:W.vd.J(G)},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"vd"]},weights:{length:{type:"number",get:G=>G._numMorphTargets,getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(G,V)=>{var W,J;return void 0!==V?null===(W=G._primitiveBabylonMeshes)||void 0===W||null===(J=W[0].morphTargetManager)||void 0===J?void 0:J.getTarget(V).influence:void 0},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(G,V)=>[0],getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:G=>{var V,W,R;return J.c.Compose(null===(V=G._babylonTransformNode)||void 0===V?void 0:V.vd,null===(W=G._babylonTransformNode)||void 0===W?void 0:W.rotationQuaternion,null===(R=G._babylonTransformNode)||void 0===R?void 0:R.position)},getTarget:G=>G._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:G=>{var V,W,R,d;const k=J.c.Identity();let z=G.parent;for(;z&&z.parent;)z=z.parent;const X=(null===(V=G._babylonTransformNode)||void 0===V?void 0:V.position._isDirty)||(null===(W=G._babylonTransformNode)||void 0===W||null===(R=W.rotationQuaternion)||void 0===R?void 0:R._isDirty)||(null===(d=G._babylonTransformNode)||void 0===d?void 0:d.vd._isDirty);if(z){var P;const V=null===(P=z._babylonTransformNode)||void 0===P?void 0:P.kd(!0).invert();var A,x;if(V)null===(A=G._babylonTransformNode)||void 0===A||null===(x=A.kd(X))||void 0===x||x.multiplyToRef(V,k)}else G._babylonTransformNode&&k.J(G._babylonTransformNode.kd(X));return k},getTarget:G=>G._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:G=>{var V,W;return null===(V=G._babylonTransformNode)||void 0===V||null===(W=V.getChildren((G=>G instanceof k.d),!0)[0])||void 0===W?void 0:W.Xz},getTarget:G=>{var V;return null===(V=G._babylonTransformNode)||void 0===V?void 0:V.getChildren((G=>G instanceof k.d),!0)[0]},set:(G,V)=>{if(V._babylonTransformNode){const W=V._babylonTransformNode.getChildren((G=>G instanceof k.d),!0)[0];W&&(W.Xz=G)}}},color:{type:"pz",get:G=>{var V,W;return null===(V=G._babylonTransformNode)||void 0===V||null===(W=V.getChildren((G=>G instanceof k.d),!0)[0])||void 0===W?void 0:W.Pz},getTarget:G=>{var V;return null===(V=G._babylonTransformNode)||void 0===V?void 0:V.getChildren((G=>G instanceof k.d),!0)[0]},set:(G,V)=>{if(V._babylonTransformNode){const W=V._babylonTransformNode.getChildren((G=>G instanceof k.d),!0)[0];W&&(W.Pz=G)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"pz",get:(G,V,W)=>A(G,V,W).emissiveColor,set:(G,V,W,J)=>A(V,W,J).emissiveColor.J(G),getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:x("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(G,V,W)=>{var J;return null===(J=P(G,W,"bumpTexture"))||void 0===J?void 0:J.level},set:(G,V,W,J)=>{const R=P(V,J,"bumpTexture");R&&(R.level=G)},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:x("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(G,V,W)=>A(G,V,W).ambientTextureStrength,set:(G,V,W,J)=>{const R=A(V,W,J);R&&(R.ambientTextureStrength=G)},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:x("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"nz",get:(G,V,W)=>{const J=A(G,V,W);return d.h.FromColor3(J.albedoColor,J.alpha)},set:(G,V,W,J)=>{const R=A(V,W,J);R.albedoColor.set(G.r,G.g,G.b),R.alpha=G.a},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:x("albedoTexture")}},metallicFactor:{type:"number",get:(G,V,W)=>A(G,V,W).metallic,set:(G,V,W,J)=>{const R=A(V,W,J);R&&(R.metallic=G)},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(G,V,W)=>A(G,V,W).roughness,set:(G,V,W,J)=>{const R=A(V,W,J);R&&(R.roughness=G)},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:x("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(G,V,W)=>A(G,V,W).anisotropy.Xz,set:(G,V,W,J)=>{A(V,W,J).anisotropy.Xz=G},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(G,V,W)=>A(G,V,W).anisotropy.angle,set:(G,V,W,J)=>{A(V,W,J).anisotropy.angle=G},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:x("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(G,V,W)=>A(G,V,W).clearCoat.Xz,set:(G,V,W,J)=>{A(V,W,J).clearCoat.Xz=G},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(G,V,W)=>A(G,V,W).clearCoat.roughness,set:(G,V,W,J)=>{A(V,W,J).clearCoat.roughness=G},getTarget:(G,V,W)=>A(G,V,W),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:x("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(G,V,W)=>{var J;return null===(J=A(G,V,W).clearCoat.bumpTexture)||void 0===J?void 0:J.level},getTarget:A,set:(G,V,W,J)=>A(V,W,J).clearCoat.bumpTexture.level=G},extensions:{KHR_texture_transform:x("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:x("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(G,V,W)=>A(G,V,W).subSurface.dispersion,getTarget:A,set:(G,V,W,J)=>A(V,W,J).subSurface.dispersion=G}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(G,V,W)=>A(G,V,W).emissiveIntensity,getTarget:A,set:(G,V,W,J)=>A(V,W,J).emissiveIntensity=G}},KHR_materials_ior:{ior:{type:"number",get:(G,V,W)=>A(G,V,W).indexOfRefraction,getTarget:A,set:(G,V,W,J)=>A(V,W,J).indexOfRefraction=G}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(G,V,W)=>A(G,V,W).iridescence.Xz,getTarget:A,set:(G,V,W,J)=>A(V,W,J).iridescence.Xz=G},iridescenceIor:{type:"number",get:(G,V,W)=>A(G,V,W).iridescence.indexOfRefraction,getTarget:A,set:(G,V,W,J)=>A(V,W,J).iridescence.indexOfRefraction=G},iridescenceTexture:{extensions:{KHR_texture_transform:x("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(G,V,W)=>A(G,V,W).iridescence.maximumThickness,getTarget:A,set:(G,V,W,J)=>A(V,W,J).iridescence.maximumThickness=G},iridescenceThicknessMinimum:{type:"number",get:(G,V,W)=>A(G,V,W).iridescence.minimumThickness,getTarget:A,set:(G,V,W,J)=>A(V,W,J).iridescence.minimumThickness=G},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:x("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"pz",get:(G,V,W)=>A(G,V,W).sheen.color,getTarget:A,set:(G,V,W,J)=>A(V,W,J).sheen.color.J(G)},sheenColorTexture:{extensions:{KHR_texture_transform:x("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(G,V,W)=>A(G,V,W).sheen.Xz,getTarget:A,set:(G,V,W,J)=>A(V,W,J).sheen.Xz=G},sheenRoughnessTexture:{extensions:{KHR_texture_transform:x("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(G,V,W)=>A(G,V,W).metallicF0Factor,getTarget:A,set:(G,V,W,J)=>A(V,W,J).metallicF0Factor=G,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"pz",get:(G,V,W)=>A(G,V,W).metallicReflectanceColor,getTarget:A,set:(G,V,W,J)=>A(V,W,J).metallicReflectanceColor.J(G),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:x("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:x("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(G,V,W)=>A(G,V,W).subSurface.refractionIntensity,getTarget:A,set:(G,V,W,J)=>A(V,W,J).subSurface.refractionIntensity=G,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:x("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(G,V,W)=>A(G,V,W).subSurface.translucencyIntensity,getTarget:A,set:(G,V,W,J)=>A(V,W,J).subSurface.translucencyIntensity=G},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:x("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"pz",get:(G,V,W)=>A(G,V,W).subSurface.translucencyColor,getTarget:A,set:(G,V,W,J)=>{var R;return G&&(null===(R=A(V,W,J).subSurface.translucencyColor)||void 0===R?void 0:R.J(G))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:x("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"pz",get:(G,V,W)=>A(G,V,W).subSurface.tintColor,getTarget:A,set:(G,V,W,J)=>A(V,W,J).subSurface.tintColor.J(G)},attenuationDistance:{type:"number",get:(G,V,W)=>A(G,V,W).subSurface.tintColorAtDistance,getTarget:A,set:(G,V,W,J)=>A(V,W,J).subSurface.tintColorAtDistance=G},thicknessFactor:{type:"number",get:(G,V,W)=>A(G,V,W).subSurface.maximumThickness,getTarget:A,set:(G,V,W,J)=>A(V,W,J).subSurface.maximumThickness=G},thicknessTexture:{extensions:{KHR_texture_transform:x("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonLight)),getPropertyName:[G=>"length"]},__array__:{__target__:!0,color:{type:"pz",get:G=>{var V;return null===(V=G._babylonLight)||void 0===V?void 0:V.Pz},set:(G,V)=>{var W;return null===(W=V._babylonLight)||void 0===W?void 0:W.Pz.J(G)},getTarget:G=>G._babylonLight,getPropertyName:[G=>"diffuse"]},Xz:{type:"number",get:G=>{var V;return null===(V=G._babylonLight)||void 0===V?void 0:V.Xz},set:(G,V)=>V._babylonLight?V._babylonLight.Xz=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"intensity"]},range:{type:"number",get:G=>{var V;return null===(V=G._babylonLight)||void 0===V?void 0:V.range},set:(G,V)=>V._babylonLight?V._babylonLight.range=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"range"]},spot:{innerConeAngle:{type:"number",get:G=>{var V;return null===(V=G._babylonLight)||void 0===V?void 0:V.innerAngle},set:(G,V)=>V._babylonLight?V._babylonLight.innerAngle=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"innerConeAngle"]},outerConeAngle:{type:"number",get:G=>{var V;return null===(V=G._babylonLight)||void 0===V?void 0:V.angle},set:(G,V)=>V._babylonLight?V._babylonLight.angle=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonLight)),getPropertyName:[G=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonTexture)),getPropertyName:[G=>"length"]},__array__:{__target__:!0,Xz:{type:"number",get:G=>{var V;return null===(V=G._babylonTexture)||void 0===V?void 0:V.level},set:(G,V)=>{V._babylonTexture&&(V._babylonTexture.level=G)},getTarget:G=>G._babylonTexture},rotation:{type:"Quaternion",get:G=>{var V;return G._babylonTexture&&J.g.FromRotationMatrix(null===(V=G._babylonTexture)||void 0===V?void 0:V.getReflectionTextureMatrix())},set:(G,V)=>{var W;V._babylonTexture&&(null!==(W=V._babylonTexture.HG())&&void 0!==W&&W.useRightHandedSystem||(G=J.g.Inverse(G)),J.c.FromQuaternionToRef(G,V._babylonTexture.getReflectionTextureMatrix()))},getTarget:G=>G._babylonTexture}}}}},animations:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>{var V;return null===(V=G.primitives[0]._instanceData)||void 0===V?void 0:V.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function L(G){return new X(G,q)}function t(G){const V=G.split("/").map((G=>G.replace(/{}/g,"__array__")));let W=q;for(const J of V)J&&(W=W[J]);if(W&&W.type&&W.get)return W}function Y(G,V){const W=G.split("/").map((G=>G.replace(/{}/g,"__array__")));let J=q;for(const R of W)R&&(J=J[R]);J&&J.type&&J.get&&(J.interpolation=V)}function g(G,V){const W=G.split("/").map((G=>G.replace(/{}/g,"__array__")));let J=q;for(const R of W)if(R){if(!J[R]){if("?"===R){J.__ignoreObjectTree__=!0;continue}J[R]={},"__array__"===R&&(J[R].__target__=!0)}J=J[R]}Object.assign(J,V)}},13022:(G,V,W)=>{"use strict";W.r(V),W.d(V,{AnimationPropertyInfo:()=>P,TransformNodeAnimationPropertyInfo:()=>A,WeightAnimationPropertyInfo:()=>x,getQuaternion:()=>z,getVector3:()=>k,getWeights:()=>X});var J=W(11847),R=W(11136),d=W(13008);function k(G,V,W,J){return R.o.ld(V,W).scaleInPlace(J)}function z(G,V,W,J){return R.g.ld(V,W).scaleInPlace(J)}function X(G,V,W,J){const R=new Array(G._numMorphTargets);for(let d=0;d<R.length;d++)R[d]=V[W++]*J;return R}class P{constructor(G,V,W,J){this.type=G,this.name=V,this.getValue=W,this.getStride=J}_buildAnimation(G,V,W){const R=new J.e(G,this.name,V,this.type);return R.setKeys(W),R}}class A extends P{buildAnimations(G,V,W,J){const R=[];return R.push({babylonAnimatable:G._babylonTransformNode,babylonAnimation:this._buildAnimation(V,W,J)}),R}}class x extends P{buildAnimations(G,V,W,R){const d=[];if(G._numMorphTargets)for(let k=0;k<G._numMorphTargets;k++){const z=new J.e(`${V}_${k}`,this.name,W,this.type);if(z.setKeys(R.map((G=>({frame:G.frame,inTangent:G.inTangent?G.inTangent[k]:void 0,value:G.value[k],outTangent:G.outTangent?G.outTangent[k]:void 0,interpolation:G.interpolation})))),G._primitiveBabylonMeshes)for(const V of G._primitiveBabylonMeshes)if(V.morphTargetManager){const G=V.morphTargetManager.getTarget(k),W=z.clone();G.animations.push(W),d.push({babylonAnimatable:G,babylonAnimation:W})}}return d}}(0,d.l)("/nodes/{}/translation",[new A(J.e.ANIMATIONTYPE_VECTOR3,"position",k,(()=>3))]),(0,d.l)("/nodes/{}/rotation",[new A(J.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",z,(()=>4))]),(0,d.l)("/nodes/{}/scale",[new A(J.e.ANIMATIONTYPE_VECTOR3,"vd",k,(()=>3))]),(0,d.l)("/nodes/{}/weights",[new x(J.e.ANIMATIONTYPE_FLOAT,"influence",X,(G=>G._numMorphTargets))])},12965:(G,V,W)=>{"use strict";class J{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((G,V)=>{this._resolve=G,this._reject=V}))}}var R=W(11136),d=W(11424),k=W(11189),z=W(11516),X=W(12973),P=W(12987),A=W(11176),x=W(11701),q=W(11847),L=W(11855),t=W(11169),Y=W(11201),g=W(11204);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(G){this._useTextureToStoreBoneMatrices=G,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(G,V,W){this.name=G,this.id=V,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=R.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new A.b,this.bones=[],this._scene=W||t.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const J=this._scene.getEngine().getCaps();this._canUseTextureForBones=J.textureFloat&&J.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((G=>!G.getParent()))}getTransformMatrices(G){if(this.needInitialSkinMatrix){if(!G)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return G._bonesTransformMatrices||this.prepare(!0),G._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(G){return this.needInitialSkinMatrix&&G._transformMatrixTexture?G._transformMatrixTexture:this._transformMatrixTexture}HG(){return this._scene}toString(G){let V=`Name: ${this.name}, nBones: ${this.bones.length}`;if(V+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,G){V+=", Ranges: {";let G=!0;for(const W in this._ranges)G&&(V+=", ",G=!1),V+=W;V+="}"}return V}getBoneIndexByName(G){for(let V=0,W=this.bones.length;V<W;V++)if(this.bones[V].name===G)return V;return-1}createAnimationRange(G,V,W){if(!this._ranges[G]){this._ranges[G]=new L.d(G,V,W);for(let J=0,R=this.bones.length;J<R;J++)this.bones[J].animations[0]&&this.bones[J].animations[0].createRange(G,V,W)}}deleteAnimationRange(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,J=this.bones.length;W<J;W++)this.bones[W].animations[0]&&this.bones[W].animations[0].deleteRange(G,V);this._ranges[G]=null}getAnimationRange(G){return this._ranges[G]||null}getAnimationRanges(){const G=[];let V;for(V in this._ranges)G.push(this._ranges[V]);return G}copyAnimationRange(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[V]||!G.getAnimationRange(V))return!1;let J=!0;const R=this._getHighestAnimationFrame()+1,d={},k=G.bones;let z,X;for(X=0,z=k.length;X<z;X++)d[k[X].name]=k[X];this.bones.length!==k.length&&(Y.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${k.length}`),J=!1);const P=W&&this.dimensionsAtRest&&G.dimensionsAtRest?this.dimensionsAtRest.divide(G.dimensionsAtRest):null;for(X=0,z=this.bones.length;X<z;X++){const G=this.bones[X].name,k=d[G];k?J=J&&this.bones[X].copyAnimationRange(k,V,R,W,P):(Y.c.Warn("copyAnimationRange: not same rig, missing source bone "+G),J=!1)}const A=G.getAnimationRange(V);return A&&(this._ranges[V]=new L.d(V,A.from+R,A.to+R)),J}returnToRest(){for(const G of this.bones)-1!==G._index&&G.returnToRest()}_getHighestAnimationFrame(){let G=0;for(let V=0,W=this.bones.length;V<W;V++)if(this.bones[V].animations[0]){const W=this.bones[V].animations[0].getHighestFrame();G<W&&(G=W)}return G}beginAnimation(G,V,W,J){const R=this.getAnimationRange(G);return R?this._scene.beginAnimation(this,R.from,R.to,V,W,J):null}static MakeAnimationAdditive(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const J=G.getAnimationRange(W);if(!J)return null;const R=G._scene.getAllAnimatablesByTarget(G);let d=null;for(let z=0;z<R.length;z++){const G=R[z];if(G.fromFrame===(null===J||void 0===J?void 0:J.from)&&G.toFrame===(null===J||void 0===J?void 0:J.to)){d=G;break}}const k=G.getAnimatables();for(let z=0;z<k.length;z++){const G=k[z].animations;if(G)for(let J=0;J<G.length;J++)q.e.MakeAnimationAdditive(G[J],V,W)}return d&&(d.isAdditive=!0),G}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(G){this._meshesWithPoseMatrix.push(G)}_unregisterMeshWithPoseMatrix(G){const V=this._meshesWithPoseMatrix.indexOf(G);V>-1&&this._meshesWithPoseMatrix.splice(V,1)}_computeTransformMatrices(G,V){this.onBeforeComputeObservable.notifyObservers(this);for(let W=0;W<this.bones.length;W++){const J=this.bones[W];J._childUpdateId++;const R=J.getParent();if(R?J.getLocalMatrix().multiplyToRef(R.getFinalMatrix(),J.getFinalMatrix()):V?J.getLocalMatrix().multiplyToRef(V,J.getFinalMatrix()):J.getFinalMatrix().J(J.getLocalMatrix()),-1!==J._index){const V=null===J._index?W:J._index;J.getAbsoluteInverseBindMatrix().multiplyToArray(J.getFinalMatrix(),G,16*V)}}this._identity.copyToArray(G,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const G=this.HG().getRenderId();if(this._currentRenderId===G)return;this._currentRenderId=G}if(this._numBonesWithLinkedTransformNode>0)for(const G of this.bones)if(G._linkedTransformNode){const V=G._linkedTransformNode;G.position=V.position,V.rotationQuaternion?G.rotationQuaternion=V.rotationQuaternion:G.rotation=V.rotation,G.vd=V.vd}if(this.needInitialSkinMatrix)for(const G of this._meshesWithPoseMatrix){const V=G.getPoseMatrix();let W=this._isDirty;if(G._bonesTransformMatrices&&G._bonesTransformMatrices.length===16*(this.bones.length+1)||(G._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),W=!0),W){if(this._synchronizedWithMesh!==G){this._synchronizedWithMesh=G;for(const G of this.bones)if(!G.getParent()){G.getBindMatrix().multiplyToRef(V,R.h.Matrix[1]),G._updateAbsoluteBindMatrices(R.h.Matrix[1])}if(this.isUsingTextureForMatrices){const V=4*(this.bones.length+1);G._transformMatrixTexture&&G._transformMatrixTexture.getSize().width===V||(G._transformMatrixTexture&&G._transformMatrixTexture.dispose(),G._transformMatrixTexture=x.b.CreateRGBATexture(G._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(G._bonesTransformMatrices,V),this.isUsingTextureForMatrices&&G._transformMatrixTexture&&G._transformMatrixTexture.update(G._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=x.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let G=0;G<this.bones.length;G++)this._animatables.push(this.bones[G])}return this._animatables}clone(G,V){const W=new B(G,V||G,this._scene);W.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let J=0;J<this.bones.length;J++){const G=this.bones[J];let V=null;const R=G.getParent();if(R){const G=this.bones.indexOf(R);V=W.bones[G]}const d=new P.b(G.name,W,V,G.getBindMatrix().clone(),G.getRestMatrix().clone());d._index=G._index,G._linkedTransformNode&&d.linkTransformNode(G._linkedTransformNode),g.d.DeepCopy(G.animations,d.animations)}if(this._ranges){W._ranges={};for(const G in this._ranges){const V=this._ranges[G];V&&(W._ranges[G]=V.clone())}}return this._isDirty=!0,W.prepare(!0),W}enableBlending(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const V of this.bones)for(const W of V.animations)W.enableBlending=!0,W.blendingSpeed=G}dispose(){if(this._meshesWithPoseMatrix.length=0,this.HG().stopAnimation(this),this.HG().removeSkeleton(this),this._parentContainer){const G=this._parentContainer.skeletons.indexOf(this);G>-1&&this._parentContainer.skeletons.splice(G,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const G={};G.name=this.name,G.id=this.id,this.dimensionsAtRest&&(G.dimensionsAtRest=this.dimensionsAtRest.Bd()),G.bones=[],G.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let W=0;W<this.bones.length;W++){var V;const J=this.bones[W],R=J.getParent(),d={parentBoneIndex:R?this.bones.indexOf(R):-1,index:J.getIndex(),name:J.name,id:J.id,matrix:J.getBindMatrix().Bd(),rest:J.getRestMatrix().Bd(),linkedTransformNodeId:null===(V=J.getTransformNode())||void 0===V?void 0:V.id};G.bones.push(d),J.length&&(d.length=J.length),J.metadata&&(d.metadata=J.metadata),J.animations&&J.animations.length>0&&(d.animation=J.animations[0].serialize()),G.ranges=[];for(const V in this._ranges){const W=this._ranges[V];if(!W)continue;const J={};J.name=V,J.from=W.from,J.to=W.to,G.ranges.push(J)}}return G}static Parse(G,V){const W=new B(G.name,G.id,V);let J;for(G.dimensionsAtRest&&(W.dimensionsAtRest=R.o.ld(G.dimensionsAtRest)),W.needInitialSkinMatrix=G.needInitialSkinMatrix,J=0;J<G.bones.length;J++){const V=G.bones[J],d=G.bones[J].index;let k=null;V.parentBoneIndex>-1&&(k=W.bones[V.parentBoneIndex]);const z=V.rest?R.c.ld(V.rest):null,X=new P.b(V.name,W,k,R.c.ld(V.matrix),z,null,d);void 0!==V.id&&null!==V.id&&(X.id=V.id),V.length&&(X.length=V.length),V.metadata&&(X.metadata=V.metadata),V.animation&&X.animations.push(q.e.Parse(V.animation)),void 0!==V.linkedTransformNodeId&&null!==V.linkedTransformNodeId&&(W._hasWaitingData=!0,X._waitingTransformNodeId=V.linkedTransformNodeId)}if(G.ranges)for(J=0;J<G.ranges.length;J++){const V=G.ranges[J];W.createAnimationRange(V.name,V.from,V.to)}return W}computeAbsoluteMatrices(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||G)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(G)}getPoseMatrix(){let G=null;return this._meshesWithPoseMatrix.length>0&&(G=this._meshesWithPoseMatrix[0].getPoseMatrix()),G}sortBones(){const G=[],V=new Array(this.bones.length);for(let W=0;W<this.bones.length;W++)this._sortBones(W,G,V);this.bones=G}_sortBones(G,V,W){if(W[G])return;W[G]=!0;const J=this.bones[G];if(!J)return;void 0===J._index&&(J._index=G);const R=J.getParent();R&&this._sortBones(this.bones.indexOf(R),V,W),V.push(J)}setCurrentPoseAsRest(){for(const G of this.bones)G.setCurrentPoseAsRest()}}var S=W(11313),p=W(11720),b=W(11666),r=W(11457),y=W(11345),u=W(11538),H=W(11473),n=W(11510),D=W(11864),i=W(11525),e=W(12942);class F{set areUpdatesFrozen(G){G?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,G||(G=t.c.LastCreatedScene),this._scene=G,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const G=this._scene.getEngine().getCaps();this._canUseTextureForTargets=G.canUseGLVertexID&&G.textureFloat&&G.maxVertexTextureImageUnits>0&&G.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return F.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?F.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(G){this._numMaxInfluencers!==G&&(this._numMaxInfluencers=G,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(G){this._useTextureToStoreTargets!==G&&(this._useTextureToStoreTargets=G,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var G;return F.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(G=this._scene)&&void 0!==G&&G.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(G){return this._activeTargets.data[G]}getTarget(G){return this._targets[G]}getTargetByName(G){for(const V of this._targets)if(V.name===G)return V;return null}addTarget(G){this._targets.push(G),this._targetInfluenceChangedObservers.push(G.onInfluenceChanged.add((G=>{this.areUpdatesFrozen&&G&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(G)}))),this._targetDataLayoutChangedObservers.push(G._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(G){const V=this._targets.indexOf(G);V>=0&&(this._targets.splice(V,1),G.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(V,1)[0]),G._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(V,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(G)}_bind(G){G.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),G.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),G.setTexture("morphTargets",this._targetStoreTexture),G.setInt("morphTargetCount",this.numInfluencers)}clone(){const G=new F(this._scene);for(const V of this._targets)G.addTarget(V.clone());return G.enablePositionMorphing=this.enablePositionMorphing,G.enableNormalMorphing=this.enableNormalMorphing,G.enableTangentMorphing=this.enableTangentMorphing,G.enableUVMorphing=this.enableUVMorphing,G.enableUV2Morphing=this.enableUV2Morphing,G.enableColorMorphing=this.enableColorMorphing,G}serialize(){const G={};G.id=this.uniqueId,G.targets=[];for(const V of this._targets)G.targets.push(V.serialize());return G}_syncActiveTargets(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const V=!!this._targetStoreTexture,W=this.isUsingTextureForTargets;(this._mustSynchronize||V!==W)&&(this._mustSynchronize=!1,this.synchronize());let J=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let R=-1;for(const d of this._targets)if(R++,0!==d.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=F.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(d),this._morphTargetTextureIndices[J]=R,this._tempInfluences[J++]=d.influence}this._morphTargetTextureIndices.length!==J&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,J)),this._influences&&this._influences.length===J||(this._influences=new Float32Array(J));for(let d=0;d<J;d++)this._influences[d]=this._tempInfluences[d];if(G&&this._scene)for(const d of this._scene.meshes)d.morphTargetManager===this&&(W?d._markSubMeshesAsAttributesDirty():d._syncGeometryWithMorphTargetManager())}synchronize(){var G;if(!this._scene||this.areUpdatesFrozen)return;const V=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(G=this._targetStoreTexture)||void 0===G||G.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>V.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const W of this._targets){this._supportsPositions=this._supportsPositions&&W.hasPositions,this._supportsNormals=this._supportsNormals&&W.hasNormals,this._supportsTangents=this._supportsTangents&&W.hasTangents,this._supportsUVs=this._supportsUVs&&W.hasUVs,this._supportsUV2s=this._supportsUV2s&&W.hasUV2s,this._supportsColors=this._supportsColors&&W.hasColors;const G=W.vertexCount;if(0===this._vertexCount)this._vertexCount=G;else if(this._vertexCount!==G)return void Y.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${W.name}": ${G}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const G=V.getCaps().maxTextureSize;this._textureWidth>G&&(this._textureHeight=Math.ceil(this._textureWidth/G),this._textureWidth=G);const W=this._targets.length,J=new Float32Array(W*this._textureWidth*this._textureHeight*4);let R=0;for(let V=0;V<W;V++){const G=this._targets[V],W=G.getPositions(),d=G.getNormals(),k=G.getUVs(),z=G.getTangents(),X=G.getUV2s(),P=G.getColors();R=V*this._textureWidth*this._textureHeight*4;for(let V=0;V<this._vertexCount;V++)this._supportsPositions&&W&&(J[R]=W[3*V],J[R+1]=W[3*V+1],J[R+2]=W[3*V+2],R+=4),this._supportsNormals&&d&&(J[R]=d[3*V],J[R+1]=d[3*V+1],J[R+2]=d[3*V+2],R+=4),this._supportsUVs&&k&&(J[R]=k[2*V],J[R+1]=k[2*V+1],R+=4),this._supportsTangents&&z&&(J[R]=z[3*V],J[R+1]=z[3*V+1],J[R+2]=z[3*V+2],R+=4),this._supportsUV2s&&X&&(J[R]=X[2*V],J[R+1]=X[2*V+1],R+=4),this._supportsColors&&P&&(J[R]=P[4*V],J[R+1]=P[4*V+1],J[R+2]=P[4*V+2],J[R+3]=P[4*V+3],R+=4)}this._targetStoreTexture=e.c.CreateRGBATexture(J,this._textureWidth,this._textureHeight,W,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const W of this._scene.meshes)W.morphTargetManager===this&&W._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const G=this._parentContainer.morphTargetManagers.indexOf(this);G>-1&&this._parentContainer.morphTargetManagers.splice(G,1),this._parentContainer=null}for(const G of this._targets)this._scene.stopAnimation(G)}}static Parse(G,V){const W=new F(V);for(const J of G.targets)W.addTarget(D.d.Parse(J,V));return W}}F.EnableTextureStorage=!0,F.MaxActiveMorphTargetsInVertexAttributeMode=8,F.ConstantTargetCountForTextureMode=0;var f=W(12995),v=W(11227),C=W(11368);const l=new Map,m=l;function w(G,V,W){N(G)&&Y.c.Warn(`Extension with the name '${G}' already exists`),l.set(G,{isGLTFExtension:V,factory:W})}function N(G){return l.delete(G)}var U=W(13008),a=W(11935),M=W(11358);class T{static Get(G,V,W){if(!V||void 0==W||!V[W])throw new Error(`${G}: Failed to find index (${W})`);return V[W]}static TryGet(G,V){return G&&void 0!=V&&G[V]?G[V]:null}static Assign(G){if(G)for(let V=0;V<G.length;V++)G[V].index=V}}function K(G){if(G.min&&G.max){const V=G.min,W=G.max,J=R.h.ed[0].rd(V[0],V[1],V[2]),d=R.h.ed[1].rd(W[0],W[1],W[2]);if(G.normalized&&5126!==G.componentType){let V=1;switch(G.componentType){case 5120:V=127;break;case 5121:V=255;break;case 5122:V=32767;break;case 5123:V=65535}const W=1/V;J.scaleInPlace(W),d.scaleInPlace(W)}return new C.d(J,d)}return null}class s{static RegisterExtension(G,V){w(G,!1,V)}static UnregisterExtension(G){return N(G)}get sd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(G){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=G}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((G=>G.dispose&&G.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(G,V,W,J,R,d){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=V,this._assetContainer=W,this._loadData(J);let d=null;if(G){const V={};if(this._gltf.nodes)for(const G of this._gltf.nodes)G.name&&(V[G.name]=G.index);d=(G instanceof Array?G:[G]).map((G=>{const W=V[G];if(void 0===W)throw new Error(`Failed to find node '${G}'`);return W}))}return await this._loadAsync(R,k,d,(()=>({meshes:this._getMeshes(),mx:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=G,this._loadData(V),await this._loadAsync(W,R,null,(()=>{}))}async _loadAsync(G,V,W,J){return await Promise.resolve().then((async()=>{this._rootUrl=G,this._uniqueRootUrl=!G.startsWith("file:")&&V?G:`${G}${Date.now()}/`,this._fileName=V,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const R=`${f.n[f.n.LOADING]} => ${f.n[f.n.READY]}`,d=`${f.n[f.n.LOADING]} => ${f.n[f.n.COMPLETE]}`;this._parent._startPerformanceCounter(R),this._parent._startPerformanceCounter(d),this._parent._setState(f.n.LOADING),this._extensionsOnLoading();const z=new Array;if(!this.parent.loadOnlyMaterials)if(W)z.push(this.loadSceneAsync("/nodes",{nodes:W,index:-1}));else if(void 0!=this._gltf.tV||this._gltf.scenes&&this._gltf.scenes[0]){const G=T.Get("/scene",this._gltf.scenes,this._gltf.tV||0);z.push(this.loadSceneAsync(`/scenes/${G.index}`,G))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let G=0;G<this._gltf.materials.length;++G){const V=this._gltf.materials[G],W="/materials/"+G,J=S.e.TriangleFillMode;z.push(this._loadMaterialAsync(W,V,null,J,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&z.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&z.push(this._compileShadowGeneratorsAsync());const X=Promise.all(z).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.rz(!0);for(const G of this._babylonScene.materials){const V=G;void 0!==V.maxSimultaneousLights&&(V.maxSimultaneousLights=Math.max(V.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(f.n.READY),this._skipStartAnimationStep||this._startAnimations(),J()}));return await X.then((G=>(this._parent._endPerformanceCounter(R),k.h.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(d),this._parent._setState(f.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(G=>{this._parent.onErrorObservable.notifyObservers(G),this._parent.onErrorObservable.clear(),this.dispose()}))})),G)))})).catch((G=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(G),this._parent.onErrorObservable.clear(),this.dispose()),G}))}_loadData(G){if(this._gltf=G.json,this._setupData(),G.bin){const V=this._gltf.buffers;if(V&&V[0]&&!V[0].uri){const W=V[0];(W.byteLength<G.bin.byteLength-3||W.byteLength>G.bin.byteLength)&&Y.c.Warn(`Binary buffer length (${W.byteLength}) from JSON does not match chunk length (${G.bin.byteLength})`),this._bin=G.bin}else Y.c.Warn("Unexpected BIN chunk")}}_setupData(){if(T.Assign(this._gltf.accessors),T.Assign(this._gltf.animations),T.Assign(this._gltf.buffers),T.Assign(this._gltf.bufferViews),T.Assign(this._gltf.cameras),T.Assign(this._gltf.images),T.Assign(this._gltf.materials),T.Assign(this._gltf.meshes),T.Assign(this._gltf.nodes),T.Assign(this._gltf.samplers),T.Assign(this._gltf.scenes),T.Assign(this._gltf.skins),T.Assign(this._gltf.textures),this._gltf.nodes){const G={};for(const W of this._gltf.nodes)if(W.children)for(const V of W.children)G[V]=W.index;const V=this._createRootNode();for(const W of this._gltf.nodes){const J=G[W.index];W.parent=void 0===J?V:this._gltf.nodes[J]}}}async _loadExtensionsAsync(){const G=[];if(m.forEach(((V,W)=>{var J;!1===(null===(J=this.parent.extensionOptions[W])||void 0===J?void 0:J.enabled)?V.isGLTFExtension&&this.isExtensionUsed(W)&&Y.c.Warn(`Extension ${W} is used but has been explicitly disabled.`):V.isGLTFExtension&&!this.isExtensionUsed(W)||G.push((async()=>{const G=await V.factory(this);return G.name!==W&&Y.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${G.name} !== ${W}`),this._parent.onExtensionLoadedObservable.notifyObservers(G),G})())})),this._extensions.push(...await Promise.all(G)),this._extensions.sort(((G,V)=>(G.order||Number.MAX_VALUE)-(V.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const W of this._gltf.extensionsRequired){if(!this._extensions.some((G=>G.name===W&&G.enabled))){var V;if(!1===(null===(V=this.parent.extensionOptions[W])||void 0===V?void 0:V.enabled))throw new Error(`Required extension ${W} is disabled`);throw new Error(`Required extension ${W} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new n.b("__root__",this._babylonScene);this._rootBabylonMesh=G,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.rz(!1);const V={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case f.j.AUTO:this._babylonScene.useRightHandedSystem||(V.rotation=[0,1,0,0],V.scale=[1,1,-1],s._LoadTransform(V,this._rootBabylonMesh));break;case f.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(G),V}loadSceneAsync(G,V){const W=this._extensionsLoadSceneAsync(G,V);if(W)return W;const J=new Array;if(this.logOpen(`${G} ${V.name||""}`),V.nodes)for(const R of V.nodes){const V=T.Get(`${G}/nodes/${R}`,this._gltf.nodes,R);J.push(this.loadNodeAsync(`/nodes/${V.index}`,V,(G=>{G.parent=this._rootBabylonMesh})))}for(const R of this._postSceneLoadActions)R();return J.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(J).then((()=>{}))}_forEachPrimitive(G,V){if(G._primitiveBabylonMeshes)for(const W of G._primitiveBabylonMeshes)V(W)}_getGeometries(){const G=[],V=this._gltf.nodes;if(V)for(const W of V)this._forEachPrimitive(W,(V=>{const W=V.zd;W&&-1===G.indexOf(W)&&G.push(W)}));return G}_getMeshes(){const G=[];this._rootBabylonMesh instanceof H.b&&G.push(this._rootBabylonMesh);const V=this._gltf.nodes;if(V)for(const W of V)this._forEachPrimitive(W,(V=>{G.push(V)}));return G}_getTransformNodes(){const G=[],V=this._gltf.nodes;if(V)for(const W of V)W._babylonTransformNode&&"dX"===W._babylonTransformNode.getClassName()&&G.push(W._babylonTransformNode),W._babylonTransformNodeForSkin&&G.push(W._babylonTransformNodeForSkin);return G}_getSkeletons(){const G=[],V=this._gltf.skins;if(V)for(const W of V)W._data&&G.push(W._data.babylonSkeleton);return G}_getAnimationGroups(){const G=[],V=this._gltf.animations;if(V)for(const W of V)W._babylonAnimationGroup&&G.push(W._babylonAnimationGroup);return G}_startAnimations(){switch(this._parent.animationStartMode){case f.f.NONE:break;case f.f.FIRST:{const G=this._getAnimationGroups();0!==G.length&&G[0].start(!0);break}case f.f.ALL:{const G=this._getAnimationGroups();for(const V of G)V.start(!0);break}default:return void Y.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadNodeAsync(G,V,W);if(J)return J;if(V._babylonTransformNode)throw new Error(`${G}: Invalid recursive node hierarchy`);const R=new Array;this.logOpen(`${G} ${V.name||""}`);const d=J=>{if(s.AddPointerMetadata(J,G),s._LoadTransform(V,J),void 0!=V.camera){const W=T.Get(`${G}/camera`,this._gltf.cameras,V.camera);R.push(this.loadCameraAsync(`/cameras/${W.index}`,W,(G=>{G.parent=J,this._babylonScene.useRightHandedSystem||(J.vd.x=-1)})))}if(V.children)for(const W of V.children){const V=T.Get(`${G}/children/${W}`,this._gltf.nodes,W);R.push(this.loadNodeAsync(`/nodes/${V.index}`,V,(G=>{G.parent=J})))}W(J)},k=void 0!=V.mesh,z=this._parent.loadSkins&&void 0!=V.skin;if(!k||z){const G=V.name||`node${V.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new r.b(G,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==V.mesh?V._babylonTransformNode=W:V._babylonTransformNodeForSkin=W,d(W)}if(k)if(z){const W=T.Get(`${G}/mesh`,this._gltf.meshes,V.mesh);R.push(this._loadMeshAsync(`/meshes/${W.index}`,V,W,(W=>{const J=V._babylonTransformNodeForSkin;W.metadata=(0,a.d)(J.metadata,W.metadata||{});const d=T.Get(`${G}/skin`,this._gltf.skins,V.skin);R.push(this._loadSkinAsync(`/skins/${d.index}`,V,d,(G=>{this._forEachPrimitive(V,(V=>{V.skeleton=G})),this._postSceneLoadActions.push((()=>{if(void 0!=d.skeleton){const G=T.Get(`/skins/${d.index}/skeleton`,this._gltf.nodes,d.skeleton).parent;V.index===G.index?W.parent=J.parent:W.parent=G._babylonTransformNode}else W.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:J,skinnedNode:W})}))})))})))}else{const W=T.Get(`${G}/mesh`,this._gltf.meshes,V.mesh);R.push(this._loadMeshAsync(`/meshes/${W.index}`,V,W,d))}return this.logClose(),Promise.all(R).then((()=>(this._forEachPrimitive(V,(G=>{const V=G;!V.isAnInstance&&V.zd&&V.zd.useBoundingInfoFromGeometry?G.lG():G.refreshBoundingInfo(!0,!0)})),V._babylonTransformNode)))}_loadMeshAsync(G,V,W,J){const R=W.primitives;if(!R||!R.length)throw new Error(`${G}: Primitives are missing`);void 0==R[0].index&&T.Assign(R);const d=new Array;this.logOpen(`${G} ${W.name||""}`);const k=V.name||`node${V.index}`;if(1===R.length){const J=W.primitives[0];d.push(this._loadMeshPrimitiveAsync(`${G}/primitives/${J.index}`,k,V,W,J,(G=>{V._babylonTransformNode=G,V._primitiveBabylonMeshes=[G]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,V._babylonTransformNode=new r.b(k,this._babylonScene),V._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V._primitiveBabylonMeshes=[];for(const J of R)d.push(this._loadMeshPrimitiveAsync(`${G}/primitives/${J.index}`,`${k}_primitive${J.index}`,V,W,J,(G=>{G.parent=V._babylonTransformNode,V._primitiveBabylonMeshes.push(G)})))}return J(V._babylonTransformNode),this.logClose(),Promise.all(d).then((()=>V._babylonTransformNode))}_loadMeshPrimitiveAsync(G,V,W,J,R,d){const k=this._extensionsLoadMeshPrimitiveAsync(G,V,W,J,R,d);if(k)return k;this.logOpen(`${G}`);const z=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==W.skin&&!J.primitives[0].targets;let X,P;if(z&&R._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,X=R._instanceData.babylonSourceMesh.createInstance(V),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P=R._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new n.b(V,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.sideOrientation=this._babylonScene.useRightHandedSystem?S.e.CounterClockWiseSideOrientation:S.e.ClockWiseSideOrientation,this._createMorphTargets(G,W,J,R,k),d.push(this._loadVertexDataAsync(G,R,k).then((async V=>await this._loadMorphTargetsAsync(G,R,k,V).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,V.vG(k),V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const A=s._GetDrawMode(G,R.mode);if(void 0==R.material){let G=this._defaultBabylonMaterialData[A];G||(G=this._createDefaultMaterial("__GLTFLoader._default",A),this._parent.onMaterialLoadedObservable.notifyObservers(G),this._defaultBabylonMaterialData[A]=G),k.material=G}else if(!this.parent.skipMaterials){const V=T.Get(`${G}/material`,this._gltf.materials,R.material);d.push(this._loadMaterialAsync(`/materials/${V.index}`,V,k,A,(G=>{k.material=G})))}P=Promise.all(d),z&&(R._instanceData={babylonSourceMesh:k,promise:P}),X=k}return s.AddPointerMetadata(X,G),this._parent.onMeshLoadedObservable.notifyObservers(X),d(X),this.logClose(),P.then((()=>X))}_loadVertexDataAsync(G,V,W){const J=this._extensionsLoadVertexDataAsync(G,V,W);if(J)return J;const R=V.attributes;if(!R)throw new Error(`${G}: Attributes are missing`);const d=new Array,k=new u.d(W.name,this._babylonScene);if(void 0==V.indices)W.isUnIndexed=!0;else{const W=T.Get(`${G}/indices`,this._gltf.accessors,V.indices);d.push(this._loadIndicesAccessorAsync(`/accessors/${W.index}`,W).then((G=>{k.setIndices(G)})))}const z=(V,J,z)=>{if(void 0==R[V])return;W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(J)&&W._delayInfo.push(J);const X=T.Get(`${G}/attributes/${V}`,this._gltf.accessors,R[V]);d.push(this._loadVertexAccessorAsync(`/accessors/${X.index}`,X,J).then((G=>{if(G.getKind()===y.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!W.skeleton){const G=K(X);G&&(k._boundingInfo=G,k.useBoundingInfoFromGeometry=!0)}k.setVerticesBuffer(G,X.count)}))),J==y.c.MatricesIndicesExtraKind&&(W.numBoneInfluencers=8),z&&z(X)};return z("POSITION",y.c.PositionKind),z("NORMAL",y.c.NormalKind),z("TANGENT",y.c.TangentKind),z("TEXCOORD_0",y.c.UVKind),z("TEXCOORD_1",y.c.UV2Kind),z("TEXCOORD_2",y.c.UV3Kind),z("TEXCOORD_3",y.c.UV4Kind),z("TEXCOORD_4",y.c.UV5Kind),z("TEXCOORD_5",y.c.UV6Kind),z("JOINTS_0",y.c.MatricesIndicesKind),z("WEIGHTS_0",y.c.MatricesWeightsKind),z("JOINTS_1",y.c.MatricesIndicesExtraKind),z("WEIGHTS_1",y.c.MatricesWeightsExtraKind),z("COLOR_0",y.c.ColorKind,(G=>{"VEC4"===G.type&&(W.hasVertexAlpha=!0)})),Promise.all(d).then((()=>k))}_createMorphTargets(G,V,W,J,R){if(!J.targets||!this._parent.loadMorphTargets)return;if(void 0==V._numMorphTargets)V._numMorphTargets=J.targets.length;else if(J.targets.length!==V._numMorphTargets)throw new Error(`${G}: Primitives do not have the same number of targets`);const d=W.extras?W.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,R.morphTargetManager=new F(this._babylonScene),R.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R.morphTargetManager.areUpdatesFrozen=!0;for(let k=0;k<J.targets.length;k++){const G=V.weights?V.weights[k]:W.weights?W.weights[k]:0,J=d?d[k]:`morphTarget${k}`;R.morphTargetManager.addTarget(new D.d(J,G,R.HG()))}}_loadMorphTargetsAsync(G,V,W,J){if(!V.targets||!this._parent.loadMorphTargets)return Promise.resolve();const R=new Array,d=W.morphTargetManager;for(let k=0;k<d.numTargets;k++){const W=d.getTarget(k);R.push(this._loadMorphTargetVertexDataAsync(`${G}/targets/${k}`,J,V.targets[k],W))}return Promise.all(R).then((()=>{d.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(G,V,W,J){const R=new Array,d=(J,d,k)=>{if(void 0==W[J])return;const z=V.getVertexBuffer(d);if(!z)return;const X=T.Get(`${G}/${J}`,this._gltf.accessors,W[J]);R.push(this._loadFloatAccessorAsync(`/accessors/${X.index}`,X).then((G=>{k(z,G)})))};return d("POSITION",y.c.PositionKind,((G,V)=>{const W=new Float32Array(V.length);G.forEach(V.length,((G,J)=>{W[J]=V[J]+G})),J.setPositions(W)})),d("NORMAL",y.c.NormalKind,((G,V)=>{const W=new Float32Array(V.length);G.forEach(W.length,((G,J)=>{W[J]=V[J]+G})),J.setNormals(W)})),d("TANGENT",y.c.TangentKind,((G,V)=>{const W=new Float32Array(V.length/3*4);let R=0;G.forEach(V.length/3*4,((G,J)=>{(J+1)%4!==0&&(W[R]=V[R]+G,R++)})),J.setTangents(W)})),d("TEXCOORD_0",y.c.UVKind,((G,V)=>{const W=new Float32Array(V.length);G.forEach(V.length,((G,J)=>{W[J]=V[J]+G})),J.setUVs(W)})),d("TEXCOORD_1",y.c.UV2Kind,((G,V)=>{const W=new Float32Array(V.length);G.forEach(V.length,((G,J)=>{W[J]=V[J]+G})),J.setUV2s(W)})),d("COLOR_0",y.c.ColorKind,((V,W)=>{let R=null;const d=V.getSize();if(3===d){R=new Float32Array(W.length/3*4),V.forEach(W.length,((G,V)=>{const J=Math.floor(V/3),d=V%3;R[4*J+d]=W[3*J+d]+G}));for(let G=0;G<W.length/3;++G)R[4*G+3]=1}else{if(4!==d)throw new Error(`${G}: Invalid number of components (${d}) for COLOR_0 attribute`);R=new Float32Array(W.length),V.forEach(W.length,((G,V)=>{R[V]=W[V]+G}))}J.setColors(R)})),await Promise.all(R).then((()=>{}))}static _LoadTransform(G,V){if(void 0!=G.skin)return;let W=R.o.Zero(),J=R.g.Identity(),d=R.o.One();if(G.matrix){R.c.ld(G.matrix).decompose(d,J,W)}else G.translation&&(W=R.o.ld(G.translation)),G.rotation&&(J=R.g.ld(G.rotation)),G.scale&&(d=R.o.ld(G.scale));V.position=W,V.rotationQuaternion=J,V.vd=d}_loadSkinAsync(G,V,W,J){if(!this._parent.loadSkins)return Promise.resolve();const R=this._extensionsLoadSkinAsync(G,V,W);if(R)return R;if(W._data)return J(W._data.babylonSkeleton),W._data.promise;const d=`skeleton${W.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new B(W.name||d,d,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(G,W,k);const z=this._loadSkinInverseBindMatricesDataAsync(G,W).then((G=>{this._updateBoneMatrices(k,G)}));return W._data={babylonSkeleton:k,promise:z},J(k),z}_loadBones(G,V,W){if(void 0==V.skeleton||this._parent.alwaysComputeSkeletonRootNode){const W=this._findSkeletonRootNode(`${G}/joints`,V.joints);if(W)if(void 0===V.skeleton)V.skeleton=W.index;else{const J=(G,V)=>{for(;V.parent;V=V.parent)if(V.parent===G)return!0;return!1},R=T.Get(`${G}/skeleton`,this._gltf.nodes,V.skeleton);R===W||J(R,W)||(Y.c.Warn(`${G}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),V.skeleton=W.index)}else Y.c.Warn(`${G}: Failed to find common root`)}const J={};for(const R of V.joints){const d=T.Get(`${G}/joints/${R}`,this._gltf.nodes,R);this._loadBone(d,V,W,J)}}_findSkeletonRootNode(G,V){if(0===V.length)return null;const W={};for(const R of V){const V=[];let J=T.Get(`${G}/${R}`,this._gltf.nodes,R);for(;-1!==J.index;)V.unshift(J),J=J.parent;W[R]=V}let J=null;for(let R=0;;++R){let G=W[V[0]];if(R>=G.length)return J;const d=G[R];for(let k=1;k<V.length;++k)if(G=W[V[k]],R>=G.length||d!==G[R])return J;J=d}}_loadBone(G,V,W,J){G._isJoint=!0;let R=J[G.index];if(R)return R;let d=null;G.index!==V.skeleton&&(G.parent&&-1!==G.parent.index?d=this._loadBone(G.parent,V,W,J):void 0!==V.skeleton&&Y.c.Warn(`/skins/${V.index}/skeleton: Skeleton node is not a common root`));const k=V.joints.indexOf(G.index);return R=new P.b(G.name||`joint${G.index}`,W,d,this._getNodeMatrix(G),null,null,k),J[G.index]=R,this._postSceneLoadActions.push((()=>{R.linkTransformNode(G._babylonTransformNode)})),R}_loadSkinInverseBindMatricesDataAsync(G,V){if(void 0==V.inverseBindMatrices)return Promise.resolve(null);const W=T.Get(`${G}/inverseBindMatrices`,this._gltf.accessors,V.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${W.index}`,W)}_updateBoneMatrices(G,V){for(const W of G.bones){const G=R.c.Identity(),J=W._index;V&&-1!==J&&(R.c.FromArrayToRef(V,16*J,G),G.invertToRef(G));const d=W.getParent();d&&G.multiplyToRef(d.getAbsoluteInverseBindMatrix(),G),W.Td(G,!1,!1),W._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(G){return G.matrix?R.c.ld(G.matrix):R.c.Compose(G.scale?R.o.ld(G.scale):R.o.One(),G.rotation?R.g.ld(G.rotation):R.g.Identity(),G.translation?R.o.ld(G.translation):R.o.Zero())}loadCameraAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadCameraAsync(G,V,W);if(J)return J;const d=new Array;this.logOpen(`${G} ${V.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new X.b(V.name||`camera${V.index}`,R.o.Zero(),this._babylonScene,!1);switch(k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V._babylonCamera=k,k.setTarget(new R.o(0,0,-1)),V.type){case"perspective":{const W=V.perspective;if(!W)throw new Error(`${G}: Camera perspective properties are missing`);k.fov=W.yfov,k.Zd=W.znear,k.maxZ=W.zfar||0;break}case"orthographic":if(!V.orthographic)throw new Error(`${G}: Camera orthographic properties are missing`);k.mode=z.c.ORTHOGRAPHIC_CAMERA,k.orthoLeft=-V.orthographic.xmag,k.orthoRight=V.orthographic.xmag,k.orthoBottom=-V.orthographic.ymag,k.orthoTop=V.orthographic.ymag,k.Zd=V.orthographic.znear,k.maxZ=V.orthographic.zfar;break;default:throw new Error(`${G}: Invalid camera type (${V.type})`)}return s.AddPointerMetadata(k,G),this._parent.onCameraLoadedObservable.notifyObservers(k),W(k),this.logClose(),Promise.all(d).then((()=>k))}_loadAnimationsAsync(){const G=this._gltf.animations;if(!G)return Promise.resolve();const V=new Array;for(let W=0;W<G.length;W++){const J=G[W];V.push(this.loadAnimationAsync(`/animations/${J.index}`,J).then((G=>{0===G.targetedAnimations.length&&G.dispose()})))}return Promise.all(V).then((()=>{}))}loadAnimationAsync(G,V){const J=this._extensionsLoadAnimationAsync(G,V);return J||W.e(58).then(W.bind(W,14477)).then((W=>{let{AnimationGroup:J}=W;this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new J(V.name||`animation${V.index}`,this._babylonScene);R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V._babylonAnimationGroup=R;const d=new Array;T.Assign(V.channels),T.Assign(V.samplers);for(const k of V.channels)d.push(this._loadAnimationChannelAsync(`${G}/channels/${k.index}`,G,V,k,((G,V)=>{G.animations=G.animations||[],G.animations.push(V),R.addTargetedAnimation(V,G)})));return Promise.all(d).then((()=>(R.normalize(0),R)))}))}async _loadAnimationChannelAsync(G,V,J,R,d){const k=this._extensionsLoadAnimationChannelAsync(G,V,J,R,d);if(k)return await k;if(void 0==R.target.node)return await Promise.resolve();const z=T.Get(`${G}/target/node`,this._gltf.nodes,R.target.node),X=R.target.path,P="weights"===X;if(P&&!z._numMorphTargets||!P&&!z._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!P&&!z._isJoint)return await Promise.resolve();let A;switch(await Promise.resolve().then(W.bind(W,13022)),X){case"translation":var x;A=null===(x=(0,U.d)("/nodes/{}/translation"))||void 0===x?void 0:x.interpolation;break;case"rotation":var q;A=null===(q=(0,U.d)("/nodes/{}/rotation"))||void 0===q?void 0:q.interpolation;break;case"scale":var L;A=null===(L=(0,U.d)("/nodes/{}/scale"))||void 0===L?void 0:L.interpolation;break;case"weights":var t;A=null===(t=(0,U.d)("/nodes/{}/weights"))||void 0===t?void 0:t.interpolation;break;default:throw new Error(`${G}/target/path: Invalid value (${R.target.path})`)}if(!A)throw new Error(`${G}/target/path: Could not find interpolation properties for target path (${R.target.path})`);const Y={object:z,info:A};return await this._loadAnimationChannelFromTargetInfoAsync(G,V,J,R,Y,d)}_loadAnimationChannelFromTargetInfoAsync(G,V,W,J,R,d){const k=this.parent.targetFps,z=1/k,X=T.Get(`${G}/sampler`,W.samplers,J.sampler);return this._loadAnimationSamplerAsync(`${V}/samplers/${J.sampler}`,X).then((G=>{let V=0;const X=R.object,P=R.info;for(const R of P){const P=R.getStride(X),A=G.input,x=G.output,q=new Array(A.length);let L=0;switch(G.interpolation){case"STEP":for(let G=0;G<A.length;G++){const V=R.getValue(X,x,L,1);L+=P,q[G]={frame:A[G]*k,value:V,interpolation:1}}break;case"CUBICSPLINE":for(let G=0;G<A.length;G++){const V=R.getValue(X,x,L,z);L+=P;const W=R.getValue(X,x,L,1);L+=P;const J=R.getValue(X,x,L,z);L+=P,q[G]={frame:A[G]*k,inTangent:V,value:W,outTangent:J}}break;case"LINEAR":for(let G=0;G<A.length;G++){const V=R.getValue(X,x,L,1);L+=P,q[G]={frame:A[G]*k,value:V}}}if(L>0){const G=`${W.name||`animation${W.index}`}_channel${J.index}_${V}`,z=R.buildAnimations(X,G,k,q);for(const W of z)V++,d(W.babylonAnimatable,W.babylonAnimation)}}}))}_loadAnimationSamplerAsync(G,V){if(V._data)return V._data;const W=V.interpolation||"LINEAR";switch(W){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${G}/interpolation: Invalid value (${V.interpolation})`)}const J=T.Get(`${G}/input`,this._gltf.accessors,V.input),R=T.Get(`${G}/output`,this._gltf.accessors,V.output);return V._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${J.index}`,J),this._loadFloatAccessorAsync(`/accessors/${R.index}`,R)]).then((G=>{let[V,J]=G;return{input:V,interpolation:W,output:J}})),V._data}loadBufferAsync(G,V,W,J){const R=this._extensionsLoadBufferAsync(G,V,W,J);if(R)return R;if(!V._data)if(V.uri)V._data=this.loadUriAsync(`${G}/uri`,V,V.uri);else{if(!this._bin)throw new Error(`${G}: Uri is missing or the binary glTF is missing its binary chunk`);V._data=this._bin.readAsync(0,V.byteLength)}return V._data.then((V=>{try{return new Uint8Array(V.buffer,V.byteOffset+W,J)}catch(R){throw new Error(`${G}: ${R.message}`)}}))}loadBufferViewAsync(G,V){const W=this._extensionsLoadBufferViewAsync(G,V);if(W)return W;if(V._data)return V._data;const J=T.Get(`${G}/buffer`,this._gltf.buffers,V.buffer);return V._data=this.loadBufferAsync(`/buffers/${J.index}`,J,V.byteOffset||0,V.byteLength),V._data}_loadAccessorAsync(G,V,W){if(V._data)return V._data;const J=s._GetNumComponents(G,V.type),R=J*y.c.GetTypeByteLength(V.componentType),d=J*V.count;if(void 0==V.bufferView)V._data=Promise.resolve(new W(d));else{const k=T.Get(`${G}/bufferView`,this._gltf.bufferViews,V.bufferView);V._data=this.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((z=>{if(5126!==V.componentType||V.normalized||k.byteStride&&k.byteStride!==R){const G=new W(d);return y.c.ForEach(z,V.byteOffset||0,k.byteStride||R,J,V.componentType,G.length,V.normalized||!1,((V,W)=>{G[W]=V})),G}return s._GetTypedArray(G,V.componentType,z,V.byteOffset,d)}))}if(V.sparse){const d=V.sparse;V._data=V._data.then((k=>{const z=k,X=T.Get(`${G}/sparse/indices/bufferView`,this._gltf.bufferViews,d.indices.bufferView),P=T.Get(`${G}/sparse/values/bufferView`,this._gltf.bufferViews,d.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${X.index}`,X),this.loadBufferViewAsync(`/bufferViews/${P.index}`,P)]).then((k=>{let[X,P]=k;const A=s._GetTypedArray(`${G}/sparse/indices`,d.indices.componentType,X,d.indices.byteOffset,d.count),x=J*d.count;let q;if(5126!==V.componentType||V.normalized){const k=s._GetTypedArray(`${G}/sparse/values`,V.componentType,P,d.values.byteOffset,x);q=new W(x),y.c.ForEach(k,0,R,J,V.componentType,q.length,V.normalized||!1,((G,V)=>{q[V]=G}))}else q=s._GetTypedArray(`${G}/sparse/values`,V.componentType,P,d.values.byteOffset,x);let L=0;for(let G=0;G<A.length;G++){let V=A[G]*J;for(let G=0;G<J;G++)z[V++]=q[L++]}return z}))}))}return V._data}_loadFloatAccessorAsync(G,V){return this._loadAccessorAsync(G,V,Float32Array)}_loadIndicesAccessorAsync(G,V){if("SCALAR"!==V.type)throw new Error(`${G}/type: Invalid value ${V.type}`);if(5121!==V.componentType&&5123!==V.componentType&&5125!==V.componentType)throw new Error(`${G}/componentType: Invalid value ${V.componentType}`);if(V._data)return V._data;if(V.sparse){const W=s._GetTypedArrayConstructor(`${G}/componentType`,V.componentType);V._data=this._loadAccessorAsync(G,V,W)}else{const W=T.Get(`${G}/bufferView`,this._gltf.bufferViews,V.bufferView);V._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((W=>s._GetTypedArray(G,V.componentType,W,V.byteOffset,V.count)))}return V._data}_loadVertexBufferViewAsync(G){if(G._babylonBuffer)return G._babylonBuffer;const V=this._babylonScene.getEngine();return G._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((G=>new y.b(V,G,!1))),G._babylonBuffer}_loadVertexAccessorAsync(G,V,W){var J;if(null!==(J=V._babylonVertexBuffer)&&void 0!==J&&J[W])return V._babylonVertexBuffer[W];V._babylonVertexBuffer||(V._babylonVertexBuffer={});const R=this._babylonScene.getEngine();if(V.sparse||void 0==V.bufferView)V._babylonVertexBuffer[W]=this._loadFloatAccessorAsync(G,V).then((G=>new y.c(R,G,W,!1)));else{const J=T.Get(`${G}/bufferView`,this._gltf.bufferViews,V.bufferView);V._babylonVertexBuffer[W]=this._loadVertexBufferViewAsync(J).then((d=>{const k=s._GetNumComponents(G,V.type);return new y.c(R,d,W,!1,void 0,J.byteStride,void 0,V.byteOffset,k,V.componentType,V.normalized,!0,void 0,!0)}))}return V._babylonVertexBuffer[W]}_loadMaterialMetallicRoughnessPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return V&&(V.baseColorFactor?(W.albedoColor=d.d.ld(V.baseColorFactor),W.alpha=V.baseColorFactor[3]):W.albedoColor=d.d.White(),W.metallic=void 0==V.metallicFactor?1:V.metallicFactor,W.roughness=void 0==V.roughnessFactor?1:V.roughnessFactor,V.baseColorTexture&&J.push(this.loadTextureInfoAsync(`${G}/baseColorTexture`,V.baseColorTexture,(G=>{G.name=`${W.name} (Base Color)`,W.albedoTexture=G}))),V.metallicRoughnessTexture&&(V.metallicRoughnessTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${G}/metallicRoughnessTexture`,V.metallicRoughnessTexture,(G=>{G.name=`${W.name} (Metallic Roughness)`,W.metallicTexture=G}))),W.useMetallnessFromMetallicTextureBlue=!0,W.useRoughnessFromMetallicTextureGreen=!0,W.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(J).then((()=>{}))}_loadMaterialAsync(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const d=this._extensionsLoadMaterialAsync(G,V,W,J,R);if(d)return d;V._data=V._data||{};let k=V._data[J];if(!k){this.logOpen(`${G} ${V.name||""}`);const W=this.createMaterial(G,V,J);k={babylonMaterial:W,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(G,V,W)},V._data[J]=k,s.AddPointerMetadata(W,G),this._parent.onMaterialLoadedObservable.notifyObservers(W),this.logClose()}return W&&(k.babylonMeshes.push(W),W.Md.addOnce((()=>{const G=k.babylonMeshes.indexOf(W);-1!==G&&k.babylonMeshes.splice(G,1)}))),R(k.babylonMaterial),k.promise.then((()=>k.babylonMaterial))}_createDefaultMaterial(G,V){this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new p.d(G,this._babylonScene);return W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.fillMode=V,W.enableSpecularAntiAliasing=!0,W.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,W.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,W.transparencyMode=p.d.PBRMATERIAL_OPAQUE,W.metallic=1,W.roughness=1,W}createMaterial(G,V,W){const J=this._extensionsCreateMaterial(G,V,W);if(J)return J;const R=V.name||`material${V.index}`;return this._createDefaultMaterial(R,W)}loadMaterialPropertiesAsync(G,V,W){const J=this._extensionsLoadMaterialPropertiesAsync(G,V,W);if(J)return J;const R=new Array;return R.push(this.loadMaterialBasePropertiesAsync(G,V,W)),V.pbrMetallicRoughness&&R.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${G}/pbrMetallicRoughness`,V.pbrMetallicRoughness,W)),this.loadMaterialAlphaProperties(G,V,W),Promise.all(R).then((()=>{}))}loadMaterialBasePropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return W.emissiveColor=V.emissiveFactor?d.d.ld(V.emissiveFactor):new d.d(0,0,0),V.doubleSided&&(W.gd=!1,W.twoSidedLighting=!0),V.normalTexture&&(V.normalTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${G}/normalTexture`,V.normalTexture,(G=>{G.name=`${W.name} (Normal)`,W.bumpTexture=G}))),W.invertNormalMapX=!this._babylonScene.useRightHandedSystem,W.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=V.normalTexture.scale&&W.bumpTexture&&(W.bumpTexture.level=V.normalTexture.scale),W.forceIrradianceInFragment=!0),V.occlusionTexture&&(V.occlusionTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${G}/occlusionTexture`,V.occlusionTexture,(G=>{G.name=`${W.name} (Occlusion)`,W.ambientTexture=G}))),W.useAmbientInGrayScale=!0,void 0!=V.occlusionTexture.strength&&(W.ambientTextureStrength=V.occlusionTexture.strength)),V.emissiveTexture&&J.push(this.loadTextureInfoAsync(`${G}/emissiveTexture`,V.emissiveTexture,(G=>{G.name=`${W.name} (Emissive)`,W.emissiveTexture=G}))),Promise.all(J).then((()=>{}))}loadMaterialAlphaProperties(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);switch(V.alphaMode||"OPAQUE"){case"OPAQUE":W.transparencyMode=p.d.PBRMATERIAL_OPAQUE,W.alpha=1;break;case"MASK":W.transparencyMode=p.d.PBRMATERIAL_ALPHATEST,W.alphaCutOff=void 0==V.alphaCutoff?.5:V.alphaCutoff,W.albedoTexture&&(W.albedoTexture.bd=!0);break;case"BLEND":W.transparencyMode=p.d.PBRMATERIAL_ALPHABLEND,W.albedoTexture&&(W.albedoTexture.bd=!0,W.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${G}/alphaMode: Invalid value (${V.alphaMode})`)}}loadTextureInfoAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureInfoAsync(G,V,W);if(J)return J;if(this.logOpen(`${G}`),V.texCoord>=6)throw new Error(`${G}/texCoord: Invalid value (${V.texCoord})`);const R=T.Get(`${G}/index`,this._gltf.textures,V.index);R._textureInfo=V;const d=this._loadTextureAsync(`/textures/${V.index}`,R,(J=>{J.coordinatesIndex=V.texCoord||0,s.AddPointerMetadata(J,G),this._parent.onTextureLoadedObservable.notifyObservers(J),W(J)}));return this.logClose(),d}_loadTextureAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureAsync(G,V,W);if(J)return J;this.logOpen(`${G} ${V.name||""}`);const R=void 0==V.sampler?s.DefaultSampler:T.Get(`${G}/sampler`,this._gltf.samplers,V.sampler),d=T.Get(`${G}/source`,this._gltf.images,V.source),k=this._createTextureAsync(G,R,d,W,void 0,!V._textureInfo.nonColorData);return this.logClose(),k}_createTextureAsync(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},d=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;const z=this._loadSampler(`/samplers/${V.index}`,V),X=new Array,P=new J;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A={noMipmap:z.noMipMaps,invertY:!1,samplingMode:z.samplingMode,h:()=>{this._disposed||P.resolve()},onError:(V,W)=>{this._disposed||P.reject(new Error(`${G}: ${W&&W.message?W.message:V||"Failed to load texture"}`))},mimeType:W.mimeType??(0,v.g)(W.uri??""),loaderOptions:d,useSRGBBuffer:!!k&&this._parent.useSRGBBuffers},x=new b.d(null,this._babylonScene,A);return x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.push(P.promise),X.push(this.loadImageAsync(`/images/${W.index}`,W).then((G=>{const V=W.uri||`${this._fileName}#image${W.index}`,J=`data:${this._uniqueRootUrl}${V}`;x.updateURL(J,G);const R=x.getInternalTexture();R&&(R.label=W.name)}))),x.wrapU=z.wrapU,x.wrapV=z.wrapV,R(x),this._parent.useGltfTextureNames&&(x.name=W.name||W.uri||`image${W.index}`),Promise.all(X).then((()=>x))}_loadSampler(G,V){return V._data||(V._data={noMipMaps:9728===V.minFilter||9729===V.minFilter,samplingMode:s._GetTextureSamplingMode(G,V),wrapU:s._GetTextureWrapMode(`${G}/wrapS`,V.wrapS),wrapV:s._GetTextureWrapMode(`${G}/wrapT`,V.wrapT)}),V._data}loadImageAsync(G,V){if(!V._data){if(this.logOpen(`${G} ${V.name||""}`),V.uri)V._data=this.loadUriAsync(`${G}/uri`,V,V.uri);else{const W=T.Get(`${G}/bufferView`,this._gltf.bufferViews,V.bufferView);V._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)}this.logClose()}return V._data}loadUriAsync(G,V,W){const J=this._extensionsLoadUriAsync(G,V,W);if(J)return J;if(!s._ValidateUri(W))throw new Error(`${G}: '${W}' is invalid`);if((0,v.h)(W)){const V=new Uint8Array((0,v.e)(W));return this.log(`${G}: Decoded ${W.substring(0,64)}... (${V.length} bytes)`),Promise.resolve(V)}return this.log(`${G}: Loading ${W}`),this._parent.preprocessUrlAsync(this._rootUrl+W).then((V=>new Promise(((J,R)=>{this._parent._loadFile(this._babylonScene,V,(V=>{this._disposed||(this.log(`${G}: Loaded ${W} (${V.byteLength} bytes)`),J(new Uint8Array(V)))}),!0,(V=>{R(new v.j(`${G}: Failed to load '${W}'${V?": "+V.status+" "+V.statusText:""}`,V))}))}))))}static AddPointerMetadata(G,V){G.metadata=G.metadata||{};const W=G._internalMetadata=G._internalMetadata||{},J=W.sd=W.sd||{};(J.pointers=J.pointers||[]).push(V)}static _GetTextureWrapMode(G,V){switch(V=void 0==V?10497:V){case 33071:return b.d.CLAMP_ADDRESSMODE;case 33648:return b.d.MIRROR_ADDRESSMODE;case 10497:return b.d.WRAP_ADDRESSMODE;default:return Y.c.Warn(`${G}: Invalid value (${V})`),b.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(G,V){const W=void 0==V.magFilter?9729:V.magFilter,J=void 0==V.minFilter?9987:V.minFilter;if(9729===W)switch(J){case 9728:return b.d.LINEAR_NEAREST;case 9729:return b.d.LINEAR_LINEAR;case 9984:return b.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return b.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return b.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return b.d.LINEAR_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${G}/minFilter: Invalid value (${J})`),b.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==W&&Y.c.Warn(`${G}/magFilter: Invalid value (${W})`),J){case 9728:return b.d.NEAREST_NEAREST;case 9729:return b.d.NEAREST_LINEAR;case 9984:return b.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return b.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return b.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return b.d.NEAREST_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${G}/minFilter: Invalid value (${J})`),b.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(G,V){try{return(0,M.o)(V)}catch(W){throw new Error(`${G}: ${W.message}`)}}static _GetTypedArray(G,V,W,J,R){const d=W.buffer;J=W.byteOffset+(J||0);const k=s._GetTypedArrayConstructor(`${G}/componentType`,V),z=y.c.GetTypeByteLength(V);return J%z!==0?(Y.c.Warn(`${G}: Copying buffer as byte offset (${J}) is not a multiple of component type byte length (${z})`),new k(d.slice(J,J+R*z),0)):new k(d,J,R)}static _GetNumComponents(G,V){switch(V){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${G}: Invalid type (${V})`)}static _ValidateUri(G){return k.h.IsBase64(G)||-1===G.indexOf("..")}static _GetDrawMode(G,V){switch(void 0==V&&(V=4),V){case 0:return S.e.PointListDrawMode;case 1:return S.e.LineListDrawMode;case 2:return S.e.LineLoopDrawMode;case 3:return S.e.LineStripDrawMode;case 4:return S.e.TriangleFillMode;case 5:return S.e.TriangleStripDrawMode;case 6:return S.e.TriangleFanDrawMode}throw new Error(`${G}: Invalid mesh primitive mode (${V})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const G=new Array;if(this._gltf.materials)for(const V of this._gltf.materials)if(V._data)for(const W in V._data){const J=V._data[W];for(const V of J.babylonMeshes){V.kd(!0);const W=J.babylonMaterial;G.push(W.forceCompilationAsync(V)),G.push(W.forceCompilationAsync(V,{useInstances:!0})),this._parent.useClipPlane&&(G.push(W.forceCompilationAsync(V,{clipPlane:!0})),G.push(W.forceCompilationAsync(V,{clipPlane:!0,useInstances:!0})))}}return Promise.all(G).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const G=new Array,V=this._babylonScene.lights;for(const W of V){const V=W.getShadowGenerator();V&&G.push(V.forceCompilationAsync())}return Promise.all(G).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(G){for(const V of this._extensions)V.enabled&&G(V)}_applyExtensions(G,V,W){for(const J of this._extensions)if(J.enabled){const R=`${J.name}.${V}`,d=G;d._activeLoaderExtensionFunctions=d._activeLoaderExtensionFunctions||{};const k=d._activeLoaderExtensionFunctions;if(!k[R]){k[R]=!0;try{const G=W(J);if(G)return G}finally{delete k[R]}}}return null}_extensionsOnLoading(){this._forEachExtensions((G=>G.onLoading&&G.onLoading()))}_extensionsOnReady(){this._forEachExtensions((G=>G.onReady&&G.onReady()))}_extensionsLoadSceneAsync(G,V){return this._applyExtensions(V,"loadScene",(W=>W.loadSceneAsync&&W.loadSceneAsync(G,V)))}_extensionsLoadNodeAsync(G,V,W){return this._applyExtensions(V,"loadNode",(J=>J.loadNodeAsync&&J.loadNodeAsync(G,V,W)))}_extensionsLoadCameraAsync(G,V,W){return this._applyExtensions(V,"loadCamera",(J=>J.loadCameraAsync&&J.loadCameraAsync(G,V,W)))}_extensionsLoadVertexDataAsync(G,V,W){return this._applyExtensions(V,"loadVertexData",(J=>J._loadVertexDataAsync&&J._loadVertexDataAsync(G,V,W)))}_extensionsLoadMeshPrimitiveAsync(G,V,W,J,R,d){return this._applyExtensions(R,"loadMeshPrimitive",(k=>k._loadMeshPrimitiveAsync&&k._loadMeshPrimitiveAsync(G,V,W,J,R,d)))}_extensionsLoadMaterialAsync(G,V,W,J,R){return this._applyExtensions(V,"loadMaterial",(d=>d._loadMaterialAsync&&d._loadMaterialAsync(G,V,W,J,R)))}_extensionsCreateMaterial(G,V,W){return this._applyExtensions(V,"createMaterial",(J=>J.createMaterial&&J.createMaterial(G,V,W)))}_extensionsLoadMaterialPropertiesAsync(G,V,W){return this._applyExtensions(V,"loadMaterialProperties",(J=>J.loadMaterialPropertiesAsync&&J.loadMaterialPropertiesAsync(G,V,W)))}_extensionsLoadTextureInfoAsync(G,V,W){return this._applyExtensions(V,"loadTextureInfo",(J=>J.loadTextureInfoAsync&&J.loadTextureInfoAsync(G,V,W)))}_extensionsLoadTextureAsync(G,V,W){return this._applyExtensions(V,"loadTexture",(J=>J._loadTextureAsync&&J._loadTextureAsync(G,V,W)))}_extensionsLoadAnimationAsync(G,V){return this._applyExtensions(V,"loadAnimation",(W=>W.loadAnimationAsync&&W.loadAnimationAsync(G,V)))}_extensionsLoadAnimationChannelAsync(G,V,W,J,R){return this._applyExtensions(W,"loadAnimationChannel",(d=>d._loadAnimationChannelAsync&&d._loadAnimationChannelAsync(G,V,W,J,R)))}_extensionsLoadSkinAsync(G,V,W){return this._applyExtensions(W,"loadSkin",(J=>J._loadSkinAsync&&J._loadSkinAsync(G,V,W)))}_extensionsLoadUriAsync(G,V,W){return this._applyExtensions(V,"loadUri",(J=>J._loadUriAsync&&J._loadUriAsync(G,V,W)))}_extensionsLoadBufferViewAsync(G,V){return this._applyExtensions(V,"loadBufferView",(W=>W.loadBufferViewAsync&&W.loadBufferViewAsync(G,V)))}_extensionsLoadBufferAsync(G,V,W,J){return this._applyExtensions(V,"loadBuffer",(R=>R.loadBufferAsync&&R.loadBufferAsync(G,V,W,J)))}static LoadExtensionAsync(G,V,W,J){if(!V.extensions)return null;const R=V.extensions[W];return R?J(`${G}/extensions/${W}`,R):null}static LoadExtraAsync(G,V,W,J){if(!V.extras)return null;const R=V.extras[W];return R?J(`${G}/extras/${W}`,R):null}isExtensionUsed(G){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(G)}logOpen(G){this._parent._logOpen(G)}logClose(){this._parent._logClose()}log(G){this._parent._log(G)}startPerformanceCounter(G){this._parent._startPerformanceCounter(G)}endPerformanceCounter(G){this._parent._endPerformanceCounter(G)}}s.DefaultSampler={index:-1},f.e._CreateGLTF2Loader=G=>new s(G);var Q=W(13022),Z=W(11620),E=W(11411),h=W(13031),o=W(13034);class c extends o.e{constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",G),this._texture=G.getEngine().createRawCubeTexture(V,W,J,R,d,k,z,X)}update(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,G,V,W,J,R)}updateRGBDAsync(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.j)(this._texture,G,V,W,J).then((()=>{}))}clone(){return E.e.Clone((()=>{const G=this.HG(),V=this._texture,W=new c(G,V._bufferViewArray,V.width,V.format,V.type,V.generateMipMaps,V.invertY,V.samplingMode,V._compression);return 13===V.source&&W.updateRGBDAsync(V._bufferViewArrayArray,V._sphericalPolynomial,V._lodGenerationScale,V._lodGenerationOffset),W}),this)}}const j="EXT_lights_image_based";class I{constructor(G){this.name=j,this._loader=G,this.enabled=this._loader.isExtensionUsed(j)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.sd.extensions;if(G&&G[this.name]){const V=G[this.name];this._lights=V.lights}}loadSceneAsync(G,V){return s.LoadExtensionAsync(G,V,this.name,(async(W,J)=>{this._loader._allMaterialsDirtyRequired=!0;const R=new Array;R.push(this._loader.loadSceneAsync(G,V)),this._loader.logOpen(`${W}`);const d=T.Get(`${W}/light`,this._lights,J.Rd);return R.push(this._loadLightAsync(`/extensions/${this.name}/lights/${J.Rd}`,d).then((G=>{this._loader.babylonScene.environmentTexture=G}))),this._loader.logClose(),await Promise.all(R).then((()=>{}))}))}_loadLightAsync(G,V){if(!V._loaded){const W=new Array;this._loader.logOpen(`${G}`);const J=new Array(V.specularImages.length);for(let R=0;R<V.specularImages.length;R++){const d=V.specularImages[R];J[R]=new Array(d.length);for(let V=0;V<d.length;V++){const k=`${G}/specularImages/${R}/${V}`;this._loader.logOpen(`${k}`);const z=d[V],X=T.Get(k,this._loader.sd.images,z);W.push(this._loader.loadImageAsync(`/images/${z}`,X).then((G=>{J[R][V]=G}))),this._loader.logClose()}}this._loader.logClose(),V._loaded=Promise.all(W).then((async()=>{const W=new c(this._loader.babylonScene,null,V.specularImageSize);if(W.name=V.name||"environment",V._babylonTexture=W,void 0!=V.Xz&&(W.level=V.Xz),V.rotation){let G=R.g.ld(V.rotation);this._loader.babylonScene.useRightHandedSystem||(G=R.g.Inverse(G)),R.c.FromQuaternionToRef(G,W.getReflectionTextureMatrix())}if(!V.irradianceCoefficients)throw new Error(`${G}: Irradiance coefficients are missing`);const d=Z.e.ld(V.irradianceCoefficients);d.scaleInPlace(V.Xz),d.convertIrradianceToLambertianRadiance();const k=Z.g.FromHarmonics(d),z=(J.length-1)/Math.log2(V.specularImageSize);return await W.updateRGBDAsync(J,k,z)}))}return V._loaded.then((()=>V._babylonTexture))}}N(j),w(j,!0,(G=>new I(G)));W(11901);const O="EXT_mesh_gpu_instancing";class GG{constructor(G){this.name=O,this._loader=G,this.enabled=this._loader.isExtensionUsed(O)}dispose(){this._loader=null}loadNodeAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(G,J)=>{this._loader._disableInstancedMesh++;const d=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,W);if(this._loader._disableInstancedMesh--,!V._primitiveBabylonMeshes)return await d;const k=new Array;let z=0;const X=V=>{if(void 0==J.attributes[V])return void k.push(Promise.resolve(null));const W=T.Get(`${G}/attributes/${V}`,this._loader.sd.accessors,J.attributes[V]);if(k.push(this._loader._loadFloatAccessorAsync(`/accessors/${W.bufferView}`,W)),0===z)z=W.count;else if(z!==W.count)throw new Error(`${G}/attributes: Instance buffer accessors do not have the same count.`)};return X("TRANSLATION"),X("ROTATION"),X("SCALE"),await d.then((async G=>{const[W,J,d]=await Promise.all(k),X=new Float32Array(16*z);R.h.ed[0].rd(0,0,0),R.h.Quaternion[0].rd(0,0,0,1),R.h.ed[1].rd(1,1,1);for(let V=0;V<z;++V)W&&R.o.FromArrayToRef(W,3*V,R.h.ed[0]),J&&R.g.FromArrayToRef(J,4*V,R.h.Quaternion[0]),d&&R.o.FromArrayToRef(d,3*V,R.h.ed[1]),R.c.ComposeToRef(R.h.ed[1],R.h.Quaternion[0],R.h.ed[0],R.h.Matrix[0]),R.h.Matrix[0].copyToArray(X,16*V);for(const R of V._primitiveBabylonMeshes)R.EA("matrix",X,16,!0);return G}))}))}}N(O),w(O,!0,(G=>new GG(G)));let VG=0,WG=null;class JG{static get Default(){return JG._Default||(JG._Default=new JG),JG._Default}constructor(){const G=JG.Configuration.decoder;this._decoderModulePromise=k.h.LoadBabylonScriptAsync(G.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(G,V,W,J,R){await this._decoderModulePromise,0===VG&&(MeshoptDecoder.useWorkers(1),VG=1);const d=await MeshoptDecoder.decodeGltfBufferAsync(V,W,G,J,R);return null!==WG&&clearTimeout(WG),WG=setTimeout((()=>{MeshoptDecoder.useWorkers(0),VG=0,WG=null}),1e3),d}}JG.Configuration={decoder:{url:`${k.h._DefaultCdnUrl}/meshopt_decoder.js`}},JG._Default=null;const RG="EXT_meshopt_compression";class dG{constructor(G){this.name=RG,this.enabled=G.isExtensionUsed(RG),this._loader=G}dispose(){this._loader=null}loadBufferViewAsync(G,V){return s.LoadExtensionAsync(G,V,this.name,(async(W,J)=>{const R=V;if(R._meshOptData)return await R._meshOptData;const d=T.Get(`${G}/buffer`,this._loader.sd.buffers,J.buffer);return R._meshOptData=this._loader.loadBufferAsync(`/buffers/${d.index}`,d,J.byteOffset||0,J.byteLength).then((async G=>await JG.Default.decodeGltfBufferAsync(G,J.count,J.byteStride,J.mode,J.filter))),await R._meshOptData}))}}N(RG),w(RG,!0,(G=>new dG(G)));const kG="EXT_texture_webp";class zG{constructor(G){this.name=kG,this._loader=G,this.enabled=G.isExtensionUsed(kG)}dispose(){this._loader=null}_loadTextureAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=void 0==V.sampler?s.DefaultSampler:T.Get(`${G}/sampler`,this._loader.sd.samplers,V.sampler),k=T.Get(`${J}/source`,this._loader.sd.images,R.source);return await this._loader._createTextureAsync(G,d,k,(G=>{W(G)}),void 0,!V._textureInfo.nonColorData)}))}}N(kG),w(kG,!0,(G=>new zG(G)));const XG="EXT_texture_avif";class PG{constructor(G){this.name=XG,this._loader=G,this.enabled=G.isExtensionUsed(XG)}dispose(){this._loader=null}_loadTextureAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=void 0==V.sampler?s.DefaultSampler:T.Get(`${G}/sampler`,this._loader.sd.samplers,V.sampler),k=T.Get(`${J}/source`,this._loader.sd.images,R.source);return await this._loader._createTextureAsync(G,d,k,(G=>{W(G)}),void 0,!V._textureInfo.nonColorData)}))}}N(XG),w(XG,!0,(G=>new PG(G)));var AG=W(13015),xG=W(11868);const qG="EXT_lights_ies";class LG{constructor(G){this.name=qG,this._loader=G,this.enabled=this._loader.isExtensionUsed(qG)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.sd.extensions;if(G&&G[this.name]){const V=G[this.name];this._lights=V.lights,T.Assign(this._lights)}}loadNodeAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,k)=>{let z,X;this._loader._allMaterialsDirtyRequired=!0;const P=await this._loader.loadNodeAsync(G,V,(G=>{X=T.Get(J,this._lights,k.Rd);const V=X.name||G.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z=new AG.d(V,R.o.Zero(),R.o.Backward(),0,1,this._loader.babylonScene),z.angle=Math.PI/2,z.innerAngle=0,z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=z,z.falloffType=xG.e.FALLOFF_GLTF,z.Pz=k.color?d.d.ld(k.color):d.d.White(),z.Xz=k.multiplier||1,z.range=Number.MAX_VALUE,z.parent=G,this._loader._babylonLights.push(z),s.AddPointerMetadata(z,J),W(G)}));let A;if(X.uri)A=await this._loader.loadUriAsync(G,X,X.uri);else{const V=T.Get(`${G}/bufferView`,this._loader.sd.bufferViews,X.bufferView);A=await this._loader.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}return z.iesProfileTexture=new b.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,A,!0,void 0,void 0,void 0,void 0,".ies"),P}))}}N(qG),w(qG,!0,(G=>new LG(G)));var tG=W(13042);const YG="KHR_draco_mesh_compression";class gG{constructor(G){this.name=YG,this.useNormalizedFlagFromAccessor=!0,this._loader=G,this.enabled=tG.b.DefaultAvailable&&this._loader.isExtensionUsed(YG)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{if(void 0!=V.mode&&4!==V.mode&&5!==V.mode)throw new Error(`${G}: Unsupported mode ${V.mode}`);const d={},k={},z=(G,J)=>{const z=R.attributes[G];if(void 0!=z&&(W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(J)&&W._delayInfo.push(J),d[J]=z,this.useNormalizedFlagFromAccessor)){const W=T.TryGet(this._loader.sd.accessors,V.attributes[G]);W&&(k[J]=W.normalized||!1)}};z("POSITION",y.c.PositionKind),z("NORMAL",y.c.NormalKind),z("TANGENT",y.c.TangentKind),z("TEXCOORD_0",y.c.UVKind),z("TEXCOORD_1",y.c.UV2Kind),z("TEXCOORD_2",y.c.UV3Kind),z("TEXCOORD_3",y.c.UV4Kind),z("TEXCOORD_4",y.c.UV5Kind),z("TEXCOORD_5",y.c.UV6Kind),z("JOINTS_0",y.c.MatricesIndicesKind),z("WEIGHTS_0",y.c.MatricesWeightsKind),z("COLOR_0",y.c.ColorKind);const X=T.Get(J,this._loader.sd.bufferViews,R.bufferView);return X._dracoBabylonGeometry||(X._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X).then((async J=>{const R=this.dracoDecoder||tG.b.Default,z=T.TryGet(this._loader.sd.accessors,V.attributes.POSITION),X=this._loader.parent.alwaysComputeBoundingBox||W.skeleton||!z?null:K(z);return await R._decodeMeshToGeometryForGltfAsync(W.name,this._loader.babylonScene,J,d,k,X).catch((V=>{throw new Error(`${G}: ${V.message}`)}))}))),await X._dracoBabylonGeometry}))}}N(YG),w(YG,!0,(G=>new gG(G)));var BG=W(13045),SG=W(11317),pG=W(11324),bG=W(11465),rG=W(11939),yG=W(11159);bG.d.AddNodeConstructor("Light_Type_0",((G,V)=>()=>new uG(G,R.o.Zero(),V)));class uG extends rG.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(G){this._shadowAngle=G,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(G){const V=this.needCube();if(this._direction=G,this.needCube()!==V&&this._shadowGenerators){const G=this._shadowGenerators.values();for(let V=G.next();!0!==V.done;V=G.next()){V.value.recreateShadowMap()}}}constructor(G,V,W){super(G,W),this._shadowAngle=Math.PI/2,this.position=V}getClassName(){return"PointLight"}getTypeID(){return xG.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(G){if(this.direction)return super.getShadowDirection(G);switch(G){case 0:return new R.o(1,0,0);case 1:return new R.o(-1,0,0);case 2:return new R.o(0,-1,0);case 3:return new R.o(0,1,0);case 4:return new R.o(0,0,1);case 5:return new R.o(0,0,-1)}return R.o.Zero()}_setDefaultShadowProjectionMatrix(G,V,W){const J=this.HG().activeCamera;if(!J)return;const d=void 0!==this.shadowMinZ?this.shadowMinZ:J.Zd,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,z=this.HG().getEngine().useReverseDepthBuffer;R.c.PerspectiveFovLHToRef(this.shadowAngle,1,z?k:d,z?d:k,G,!0,this._scene.getEngine().isNDCHalfZRange,void 0,z)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(G,V){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,V):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,V),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,V),this}transferToNodeMaterialEffect(G,V){return this.computeTransformedInformation()?G.setFloat3(V,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):G.setFloat3(V,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(G,V){G["POINTLIGHT"+V]=!0}}(0,SG.e)([(0,pG.I)()],uG.prototype,"shadowAngle",null),(0,yG.d)("BABYLON.PointLight",uG);const HG="KHR_lights_punctual";class nG{constructor(G){this.name=HG,this._loader=G,this.enabled=this._loader.isExtensionUsed(HG)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.sd.extensions;if(G&&G[this.name]){const V=G[this.name];this._lights=V.lights,T.Assign(this._lights)}}loadNodeAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,k)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(G,V,(G=>{let V;const z=T.Get(J,this._lights,k.Rd),X=z.name||G.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z.type){case"directional":{const G=new BG.c(X,R.o.Backward(),this._loader.babylonScene);G.position.Ud(0),V=G;break}case"point":V=new uG(X,R.o.Zero(),this._loader.babylonScene);break;case"spot":{const G=new AG.d(X,R.o.Zero(),R.o.Backward(),0,1,this._loader.babylonScene);G.angle=2*(z.spot&&z.spot.outerConeAngle||Math.PI/4),G.innerAngle=2*(z.spot&&z.spot.innerConeAngle||0),V=G;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${J}: Invalid light type (${z.type})`)}V._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,z._babylonLight=V,V.falloffType=xG.e.FALLOFF_GLTF,V.Pz=z.color?d.d.ld(z.color):d.d.White(),V.Xz=void 0==z.Xz?1:z.Xz,V.range=void 0==z.range?Number.MAX_VALUE:z.range,V.parent=G,this._loader._babylonLights.push(V),s.AddPointerMetadata(V,J),W(G)})))))}}N(HG),w(HG,!0,(G=>new nG(G)));const DG="KHR_materials_pbrSpecularGlossiness";class iG{constructor(G){this.name=DG,this.order=200,this._loader=G,this.enabled=this._loader.isExtensionUsed(DG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialBasePropertiesAsync(G,V,W)),d.push(this._loadSpecularGlossinessPropertiesAsync(J,R,W)),this._loader.loadMaterialAlphaProperties(G,V,W),await Promise.all(d).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return W.metallic=null,W.roughness=null,V.diffuseFactor?(W.albedoColor=d.d.ld(V.diffuseFactor),W.alpha=V.diffuseFactor[3]):W.albedoColor=d.d.White(),W.reflectivityColor=V.specularFactor?d.d.ld(V.specularFactor):d.d.White(),W.microSurface=void 0==V.glossinessFactor?1:V.glossinessFactor,V.diffuseTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTexture`,V.diffuseTexture,(G=>{G.name=`${W.name} (Diffuse)`,W.albedoTexture=G}))),V.specularGlossinessTexture&&(J.push(this._loader.loadTextureInfoAsync(`${G}/specularGlossinessTexture`,V.specularGlossinessTexture,(G=>{G.name=`${W.name} (Specular Glossiness)`,W.reflectivityTexture=G,W.reflectivityTexture.bd=!0}))),W.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(J).then((()=>{}))}}N(DG),w(DG,!0,(G=>new iG(G)));const eG="KHR_materials_unlit";class FG{constructor(G){this.name=eG,this.order=210,this._loader=G,this.enabled=this._loader.isExtensionUsed(eG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async()=>await this._loadUnlitPropertiesAsync(G,V,W)))}_loadUnlitPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;W.unlit=!0;const R=V.pbrMetallicRoughness;return R&&(R.baseColorFactor?(W.albedoColor=d.d.ld(R.baseColorFactor),W.alpha=R.baseColorFactor[3]):W.albedoColor=d.d.White(),R.baseColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/baseColorTexture`,R.baseColorTexture,(G=>{G.name=`${W.name} (Base Color)`,W.albedoTexture=G})))),V.doubleSided&&(W.gd=!1,W.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(G,V,W),Promise.all(J).then((()=>{}))}}N(eG),w(eG,!0,(G=>new FG(G)));const fG="KHR_materials_clearcoat";class vG{constructor(G){this.name=fG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(fG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadClearCoatPropertiesAsync(J,R,W)),await Promise.all(d)}))}_loadClearCoatPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return W.clearCoat.isEnabled=!0,W.clearCoat.useRoughnessFromMainTexture=!1,W.clearCoat.remapF0OnInterfaceChange=!1,void 0!=V.clearcoatFactor?W.clearCoat.Xz=V.clearcoatFactor:W.clearCoat.Xz=0,V.clearcoatTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatTexture`,V.clearcoatTexture,(G=>{G.name=`${W.name} (ClearCoat)`,W.clearCoat.texture=G}))),void 0!=V.clearcoatRoughnessFactor?W.clearCoat.roughness=V.clearcoatRoughnessFactor:W.clearCoat.roughness=0,V.clearcoatRoughnessTexture&&(V.clearcoatRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatRoughnessTexture`,V.clearcoatRoughnessTexture,(G=>{G.name=`${W.name} (ClearCoat Roughness)`,W.clearCoat.textureRoughness=G})))),V.clearcoatNormalTexture&&(V.clearcoatNormalTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatNormalTexture`,V.clearcoatNormalTexture,(G=>{G.name=`${W.name} (ClearCoat Normal)`,W.clearCoat.bumpTexture=G}))),W.invertNormalMapX=!W.HG().useRightHandedSystem,W.invertNormalMapY=W.HG().useRightHandedSystem,void 0!=V.clearcoatNormalTexture.scale&&(W.clearCoat.bumpTexture.level=V.clearcoatNormalTexture.scale)),Promise.all(J).then((()=>{}))}}N(fG),w(fG,!0,(G=>new vG(G)));const CG="KHR_materials_iridescence";class lG{constructor(G){this.name=CG,this.order=195,this._loader=G,this.enabled=this._loader.isExtensionUsed(CG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadIridescencePropertiesAsync(J,R,W)),await Promise.all(d).then((()=>{}))}))}_loadIridescencePropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return W.iridescence.isEnabled=!0,W.iridescence.Xz=V.iridescenceFactor??0,W.iridescence.indexOfRefraction=V.iridescenceIor??V.iridescenceIOR??1.3,W.iridescence.minimumThickness=V.iridescenceThicknessMinimum??100,W.iridescence.maximumThickness=V.iridescenceThicknessMaximum??400,V.iridescenceTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/iridescenceTexture`,V.iridescenceTexture,(G=>{G.name=`${W.name} (Iridescence)`,W.iridescence.texture=G}))),V.iridescenceThicknessTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/iridescenceThicknessTexture`,V.iridescenceThicknessTexture,(G=>{G.name=`${W.name} (Iridescence Thickness)`,W.iridescence.thicknessTexture=G}))),Promise.all(J).then((()=>{}))}}N(CG),w(CG,!0,(G=>new lG(G)));const mG="KHR_materials_anisotropy";class wG{constructor(G){this.name=mG,this.order=195,this._loader=G,this.enabled=this._loader.isExtensionUsed(mG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadIridescencePropertiesAsync(J,R,W)),await Promise.all(d)}))}async _loadIridescencePropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;W.anisotropy.isEnabled=!0,W.anisotropy.Xz=V.anisotropyStrength??0,W.anisotropy.angle=V.anisotropyRotation??0,V.anisotropyTexture&&(V.anisotropyTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${G}/anisotropyTexture`,V.anisotropyTexture,(G=>{G.name=`${W.name} (Anisotropy Intensity)`,W.anisotropy.texture=G})))),await Promise.all(J)}}N(mG),w(mG,!0,(G=>new wG(G)));const NG="KHR_materials_emissive_strength";class UG{constructor(G){this.name=NG,this.order=170,this._loader=G,this.enabled=this._loader.isExtensionUsed(NG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>await this._loader.loadMaterialPropertiesAsync(G,V,W).then((()=>{this._loadEmissiveProperties(J,R,W)}))))}_loadEmissiveProperties(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);void 0!==V.emissiveStrength&&(W.emissiveIntensity=V.emissiveStrength)}}N(NG),w(NG,!0,(G=>new UG(G)));const aG="KHR_materials_sheen";class MG{constructor(G){this.name=aG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(aG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadSheenPropertiesAsync(J,R,W)),await Promise.all(d).then((()=>{}))}))}_loadSheenPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return W.sheen.isEnabled=!0,W.sheen.Xz=1,void 0!=V.sheenColorFactor?W.sheen.color=d.d.ld(V.sheenColorFactor):W.sheen.color=d.d.Black(),V.sheenColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/sheenColorTexture`,V.sheenColorTexture,(G=>{G.name=`${W.name} (Sheen Color)`,W.sheen.texture=G}))),void 0!==V.sheenRoughnessFactor?W.sheen.roughness=V.sheenRoughnessFactor:W.sheen.roughness=0,V.sheenRoughnessTexture&&(V.sheenRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${G}/sheenRoughnessTexture`,V.sheenRoughnessTexture,(G=>{G.name=`${W.name} (Sheen Roughness)`,W.sheen.textureRoughness=G})))),W.sheen.albedoScaling=!0,W.sheen.useRoughnessFromMainTexture=!1,Promise.all(J).then((()=>{}))}}N(aG),w(aG,!0,(G=>new MG(G)));var TG=W(11705);const KG="KHR_materials_specular";class sG{constructor(G){this.name=KG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(KG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;if(d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadSpecularPropertiesAsync(J,R,W)),R.extensions&&R.extensions.EXT_materials_specular_edge_color&&W instanceof p.d){R.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(W.brdf.dielectricSpecularModel=TG.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,W.brdf.conductorSpecularModel=TG.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(d).then((()=>{}))}))}_loadSpecularPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return void 0!==V.specularFactor&&(W.metallicF0Factor=V.specularFactor),void 0!==V.specularColorFactor&&(W.metallicReflectanceColor=d.d.ld(V.specularColorFactor)),V.specularTexture&&(V.specularTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${G}/specularTexture`,V.specularTexture,(G=>{G.name=`${W.name} (Specular)`,W.metallicReflectanceTexture=G,W.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),V.specularColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/specularColorTexture`,V.specularColorTexture,(G=>{G.name=`${W.name} (Specular Color)`,W.reflectanceTexture=G}))),Promise.all(J).then((()=>{}))}}N(KG),w(KG,!0,(G=>new sG(G)));const QG="KHR_materials_ior";class ZG{constructor(G){this.name=QG,this.order=180,this._loader=G,this.enabled=this._loader.isExtensionUsed(QG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadIorPropertiesAsync(J,R,W)),await Promise.all(d).then((()=>{}))}))}_loadIorPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);return void 0!==V.ior?W.indexOfRefraction=V.ior:W.indexOfRefraction=ZG._DEFAULT_IOR,Promise.resolve()}}ZG._DEFAULT_IOR=1.5,N(QG),w(QG,!0,(G=>new ZG(G)));const EG="KHR_materials_variants";class hG{constructor(G){this.name=EG,this._loader=G,this.enabled=this._loader.isExtensionUsed(EG)}dispose(){this._loader=null}static GetAvailableVariants(G){const V=this._GetExtensionMetadata(G);return V?Object.keys(V.variants):[]}getAvailableVariants(G){return hG.GetAvailableVariants(G)}static SelectVariant(G,V){const W=this._GetExtensionMetadata(G);if(!W)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${EG} extension`);const J=G=>{const V=W.variants[G];if(V)for(const W of V)W.mesh.material=W.material};if(V instanceof Array)for(const R of V)J(R);else J(V);W.lastSelected=V}selectVariant(G,V){hG.SelectVariant(G,V)}static Reset(G){const V=this._GetExtensionMetadata(G);if(!V)throw new Error(`Cannot reset on a glTF mesh that does not have the ${EG} extension`);for(const W of V.original)W.mesh.material=W.material;V.lastSelected=null}reset(G){hG.Reset(G)}static GetLastSelectedVariant(G){const V=this._GetExtensionMetadata(G);if(!V)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${EG} extension`);return V.lastSelected}getLastSelectedVariant(G){return hG.GetLastSelectedVariant(G)}static _GetExtensionMetadata(G){var V,W;return(null===G||void 0===G||null===(V=G._internalMetadata)||void 0===V||null===(W=V.sd)||void 0===W?void 0:W[EG])||null}onLoading(){const G=this._loader.sd.extensions;if(G&&G[this.name]){const V=G[this.name];this._variants=V.variants}}onReady(){const G=this._loader.rootBabylonMesh;if(G){var V;const W=this._loader.parent.extensionOptions[EG];null!==W&&void 0!==W&&W.defaultVariant&&hG.SelectVariant(G,W.defaultVariant),null===W||void 0===W||null===(V=W.onLoaded)||void 0===V||V.call(W,{get variants(){return hG.GetAvailableVariants(G)},get selectedVariant(){const V=hG.GetLastSelectedVariant(G);return V?Array.isArray(V)?V[0]:V:hG.GetAvailableVariants(G)[0]},set selectedVariant(V){hG.SelectVariant(G,V)}})}}_loadMeshPrimitiveAsync(G,V,W,J,R,d){return s.LoadExtensionAsync(G,R,this.name,(async(k,z)=>{const X=new Array;return X.push(this._loader._loadMeshPrimitiveAsync(G,V,W,J,R,(V=>{if(d(V),V instanceof n.b){const W=s._GetDrawMode(G,R.mode),J=this._loader.rootBabylonMesh,d=J?J._internalMetadata=J._internalMetadata||{}:{},P=d.sd=d.sd||{},A=P[EG]=P[EG]||{lastSelected:null,original:[],variants:{}};A.original.push({mesh:V,material:V.material});for(let G=0;G<z.mappings.length;++G){const R=z.mappings[G],d=T.Get(`${k}/mappings/${G}/material`,this._loader.sd.materials,R.material);X.push(this._loader._loadMaterialAsync(`#/materials/${R.material}`,d,V,W,(G=>{for(let W=0;W<R.variants.length;++W){const d=R.variants[W],k=T.Get(`/extensions/${EG}/variants/${d}`,this._variants,d);A.variants[k.name]=A.variants[k.name]||[],A.variants[k.name].push({mesh:V,material:G}),V.onClonedObservable.add((G=>{const W=G;let R=null,d=W;do{if(d=d.parent,!d)return;R=hG._GetExtensionMetadata(d)}while(null===R);if(J&&R===hG._GetExtensionMetadata(J)){d._internalMetadata={};for(const G in J._internalMetadata)d._internalMetadata[G]=J._internalMetadata[G];d._internalMetadata.sd=[];for(const G in J._internalMetadata.sd)d._internalMetadata.sd[G]=J._internalMetadata.sd[G];d._internalMetadata.sd[EG]={lastSelected:null,original:[],variants:{}};for(const G of R.original)d._internalMetadata.sd[EG].original.push({mesh:G.mesh,material:G.material});for(const G in R.variants)if(Object.prototype.hasOwnProperty.call(R.variants,G)){d._internalMetadata.sd[EG].variants[G]=[];for(const V of R.variants[G])d._internalMetadata.sd[EG].variants[G].push({mesh:V.mesh,material:V.material})}R=d._internalMetadata.sd[EG]}for(const J of R.original)J.mesh===V&&(J.mesh=W);for(const J of R.variants[k.name])J.mesh===V&&(J.mesh=W)}))}})))}}}))),await Promise.all(X).then((G=>{let[V]=G;return V}))}))}}N(EG),w(EG,!0,(G=>new hG(G)));var oG=W(11670);class cG{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:TG.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(G,V){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...cG._GetDefaultOptions(),...G},this._scene=V,this._scene._transmissionHelper=this,this.onErrorObservable=new A.b,this._scene.Md.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(G){if(!Object.keys(G).filter((V=>this._options[V]!==G[V])).length)return;const V={...this._options,...G},W=this._options;this._options=V,V.renderSize===W.renderSize&&V.renderTargetTextureType===W.renderTargetTextureType&&V.generateMipmaps===W.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=V.samples,this._opaqueRenderTarget.lodGenerationScale=V.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=V.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(G){return!!G&&!!(G instanceof p.d&&G.subSurface.isRefractionEnabled)}_addMesh(G){this._materialObservers[G.uniqueId]=G.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),k.h.SetImmediate((()=>{this._shouldRenderAsTransmission(G.material)?(G.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(G)&&this._transparentMeshesCache.push(G)):-1===this._opaqueMeshesCache.indexOf(G)&&this._opaqueMeshesCache.push(G)}))}_removeMesh(G){G.onMaterialChangedObservable.remove(this._materialObservers[G.uniqueId]),delete this._materialObservers[G.uniqueId];let V=this._transparentMeshesCache.indexOf(G);-1!==V&&this._transparentMeshesCache.splice(V,1),V=this._opaqueMeshesCache.indexOf(G),-1!==V&&this._opaqueMeshesCache.splice(V,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(G){const V=this._transparentMeshesCache.indexOf(G),W=this._opaqueMeshesCache.indexOf(G);this._shouldRenderAsTransmission(G.material)?(G.material instanceof p.d&&(G.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==W?(this._opaqueMeshesCache.splice(W,1),this._transparentMeshesCache.push(G)):-1===V&&this._transparentMeshesCache.push(G)):-1!==V?(this._transparentMeshesCache.splice(V,1),this._opaqueMeshesCache.push(G)):-1===W&&this._opaqueMeshesCache.push(G)}_isRenderTargetValid(){var G;return null!==(null===(G=this._opaqueRenderTarget)||void 0===G?void 0:G.getInternalTexture())}_setupRenderTargets(){var G;let V;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new oG.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(G=this._options.clearColor)||void 0===G?void 0:G.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((G=>{V=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?G.clearColor.J(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(G.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=V}));for(const W of this._transparentMeshesCache)this._shouldRenderAsTransmission(W.material)&&(W.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const jG="KHR_materials_transmission";class IG{constructor(G){this.name=jG,this.order=175,this._loader=G,this.enabled=this._loader.isExtensionUsed(jG),this.enabled&&(G.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadTransparentPropertiesAsync(J,V,W,R)),await Promise.all(d).then((()=>{}))}))}_loadTransparentPropertiesAsync(G,V,W,J){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const R=W;if(R.subSurface.isRefractionEnabled=!0,R.subSurface.volumeIndexOfRefraction=1,R.subSurface.useAlbedoToTintRefraction=!0,void 0===J.transmissionFactor)return R.subSurface.refractionIntensity=0,R.subSurface.isRefractionEnabled=!1,Promise.resolve();{var d;R.subSurface.refractionIntensity=J.transmissionFactor;const G=R.HG();if(R.subSurface.refractionIntensity&&!G._transmissionHelper)new cG({},R.HG());else if(R.subSurface.refractionIntensity&&(null===(d=G._transmissionHelper)||void 0===d||!d._isRenderTargetValid())){var k;null===(k=G._transmissionHelper)||void 0===k||k._setupRenderTargets()}}return R.subSurface.minimumThickness=0,R.subSurface.maximumThickness=0,J.transmissionTexture?(J.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${G}/transmissionTexture`,J.transmissionTexture,void 0).then((G=>{G.name=`${W.name} (Transmission)`,R.subSurface.refractionIntensityTexture=G,R.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(jG),w(jG,!0,(G=>new IG(G)));const OG="KHR_materials_diffuse_transmission";class GV{constructor(G){this.name=OG,this.order=174,this._loader=G,this.enabled=this._loader.isExtensionUsed(OG),this.enabled&&(G.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadTranslucentPropertiesAsync(J,V,W,R)),await Promise.all(d).then((()=>{}))}))}_loadTranslucentPropertiesAsync(G,V,W,J){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const R=W;if(R.subSurface.isTranslucencyEnabled=!0,R.subSurface.volumeIndexOfRefraction=1,R.subSurface.minimumThickness=0,R.subSurface.maximumThickness=0,R.subSurface.useAlbedoToTintTranslucency=!1,void 0===J.diffuseTransmissionFactor)return R.subSurface.translucencyIntensity=0,R.subSurface.isTranslucencyEnabled=!1,Promise.resolve();R.subSurface.translucencyIntensity=J.diffuseTransmissionFactor;const k=new Array;return R.subSurface.useGltfStyleTextures=!0,J.diffuseTransmissionTexture&&(J.diffuseTransmissionTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTransmissionTexture`,J.diffuseTransmissionTexture).then((G=>{G.name=`${W.name} (Diffuse Transmission)`,R.subSurface.translucencyIntensityTexture=G})))),void 0!==J.diffuseTransmissionColorFactor?R.subSurface.translucencyColor=d.d.ld(J.diffuseTransmissionColorFactor):R.subSurface.translucencyColor=d.d.White(),J.diffuseTransmissionColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTransmissionColorTexture`,J.diffuseTransmissionColorTexture).then((G=>{G.name=`${W.name} (Diffuse Transmission Color)`,R.subSurface.translucencyColorTexture=G}))),Promise.all(k).then((()=>{}))}}N(OG),w(OG,!0,(G=>new GV(G)));const VV="KHR_materials_volume";class WV{constructor(G){this.name=VV,this.order=173,this._loader=G,this.enabled=this._loader.isExtensionUsed(VV),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadVolumePropertiesAsync(J,V,W,R)),await Promise.all(d).then((()=>{}))}))}_loadVolumePropertiesAsync(G,V,W,J){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);if(!W.subSurface.isRefractionEnabled&&!W.subSurface.isTranslucencyEnabled||!J.thicknessFactor)return Promise.resolve();W.subSurface.volumeIndexOfRefraction=W.indexOfRefraction;const R=void 0!==J.attenuationDistance?J.attenuationDistance:Number.MAX_VALUE;return W.subSurface.tintColorAtDistance=R,void 0!==J.attenuationColor&&3==J.attenuationColor.length&&W.subSurface.tintColor.rd(J.attenuationColor[0],J.attenuationColor[1],J.attenuationColor[2]),W.subSurface.minimumThickness=0,W.subSurface.maximumThickness=J.thicknessFactor,W.subSurface.useThicknessAsDepth=!0,J.thicknessTexture?(J.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${G}/thicknessTexture`,J.thicknessTexture).then((G=>{G.name=`${W.name} (Thickness)`,W.subSurface.thicknessTexture=G,W.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(VV),w(VV,!0,(G=>new WV(G)));const JV="KHR_materials_dispersion";class RV{constructor(G){this.name=JV,this.order=174,this._loader=G,this.enabled=this._loader.isExtensionUsed(JV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadDispersionPropertiesAsync(J,V,W,R)),await Promise.all(d).then((()=>{}))}))}_loadDispersionPropertiesAsync(G,V,W,J){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);return W.subSurface.isRefractionEnabled&&J.dispersion?(W.subSurface.isDispersionEnabled=!0,W.subSurface.dispersion=J.dispersion,Promise.resolve()):Promise.resolve()}}N(JV),w(JV,!0,(G=>new RV(G)));const dV="EXT_materials_diffuse_roughness";class kV{constructor(G){this.name=dV,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(dV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(G,V,W)),d.push(this._loadDiffuseRoughnessPropertiesAsync(J,R,W)),await Promise.all(d).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(G,V,W){if(!(W instanceof p.d))throw new Error(`${G}: Material type not supported`);const J=new Array;return W.brdf.baseDiffuseModel=TG.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=V.diffuseRoughnessFactor?W.baseDiffuseRoughness=V.diffuseRoughnessFactor:W.baseDiffuseRoughness=0,V.diffuseRoughnessTexture&&J.push(this._loader.loadTextureInfoAsync(`${G}/diffuseRoughnessTexture`,V.diffuseRoughnessTexture,(G=>{G.name=`${W.name} (Diffuse Roughness)`,W.baseDiffuseRoughnessTexture=G}))),Promise.all(J).then((()=>{}))}}N(dV),w(dV,!0,(G=>new kV(G)));const zV="KHR_mesh_quantization";class XV{constructor(G){this.name=zV,this.enabled=G.isExtensionUsed(zV)}dispose(){}}N(zV),w(zV,!0,(G=>new XV(G)));const PV="KHR_texture_basisu";class AV{constructor(G){this.name=PV,this._loader=G,this.enabled=G.isExtensionUsed(PV)}dispose(){this._loader=null}_loadTextureAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>{const d=void 0==V.sampler?s.DefaultSampler:T.Get(`${G}/sampler`,this._loader.sd.samplers,V.sampler),k=T.Get(`${J}/source`,this._loader.sd.images,R.source);return await this._loader._createTextureAsync(G,d,k,(G=>{W(G)}),V._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!V._textureInfo.nonColorData)}))}}N(PV),w(PV,!0,(G=>new AV(G)));const xV="KHR_texture_transform";class qV{constructor(G){this.name=xV,this._loader=G,this.enabled=this._loader.isExtensionUsed(xV)}dispose(){this._loader=null}loadTextureInfoAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(J,R)=>await this._loader.loadTextureInfoAsync(G,V,(G=>{if(!(G instanceof b.d))throw new Error(`${J}: Texture type not supported`);R.offset&&(G.uOffset=R.offset[0],G.vOffset=R.offset[1]),G.uRotationCenter=0,G.vRotationCenter=0,R.rotation&&(G.wAng=-R.rotation),R.scale&&(G.uScale=R.scale[0],G.vScale=R.scale[1]),void 0!=R.texCoord&&(G.coordinatesIndex=R.texCoord),W(G)}))))}}N(xV),w(xV,!0,(G=>new qV(G)));const LV="KHR_xmp_json_ld";class tV{constructor(G){this.name=LV,this.order=100,this._loader=G,this.enabled=this._loader.isExtensionUsed(LV)}dispose(){this._loader=null}onLoading(){var G,V,W;if(null===this._loader.rootBabylonMesh)return;const J=null===(G=this._loader.sd.extensions)||void 0===G?void 0:G.KHR_xmp_json_ld,R=null===(V=this._loader.sd.asset)||void 0===V||null===(W=V.extensions)||void 0===W?void 0:W.KHR_xmp_json_ld;if(J&&R){const G=+R.packet;J.packets&&G<J.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=J.packets[G])}}}function YV(G,V,W,J){return d.d.ld(V,W).scale(J)}function gV(G,V,W,J){return V[W]*J}function BV(G,V,W,J){return-V[W]*J}function SV(G,V,W,J){return V[W+1]*J}function pV(G,V,W,J){return V[W]*J*2}function bV(G){return{scale:[new yV(q.e.ANIMATIONTYPE_FLOAT,`${G}.uScale`,gV,(()=>2)),new yV(q.e.ANIMATIONTYPE_FLOAT,`${G}.vScale`,SV,(()=>2))],offset:[new yV(q.e.ANIMATIONTYPE_FLOAT,`${G}.uOffset`,gV,(()=>2)),new yV(q.e.ANIMATIONTYPE_FLOAT,`${G}.vOffset`,SV,(()=>2))],rotation:[new yV(q.e.ANIMATIONTYPE_FLOAT,`${G}.wAng`,BV,(()=>1))]}}N(LV),w(LV,!0,(G=>new tV(G)));class rV extends Q.AnimationPropertyInfo{buildAnimations(G,V,W,J){return[{babylonAnimatable:G._babylonCamera,babylonAnimation:this._buildAnimation(V,W,J)}]}}class yV extends Q.AnimationPropertyInfo{buildAnimations(G,V,W,J){const R=[];for(const d in G._data)R.push({babylonAnimatable:G._data[d].babylonMaterial,babylonAnimation:this._buildAnimation(V,W,J)});return R}}class uV extends Q.AnimationPropertyInfo{buildAnimations(G,V,W,J){return[{babylonAnimatable:G._babylonLight,babylonAnimation:this._buildAnimation(V,W,J)}]}}(0,U.l)("/cameras/{}/orthographic/xmag",[new rV(q.e.ANIMATIONTYPE_FLOAT,"orthoLeft",BV,(()=>1)),new rV(q.e.ANIMATIONTYPE_FLOAT,"orthoRight",SV,(()=>1))]),(0,U.l)("/cameras/{}/orthographic/ymag",[new rV(q.e.ANIMATIONTYPE_FLOAT,"orthoBottom",BV,(()=>1)),new rV(q.e.ANIMATIONTYPE_FLOAT,"orthoTop",SV,(()=>1))]),(0,U.l)("/cameras/{}/orthographic/zfar",[new rV(q.e.ANIMATIONTYPE_FLOAT,"maxZ",gV,(()=>1))]),(0,U.l)("/cameras/{}/orthographic/znear",[new rV(q.e.ANIMATIONTYPE_FLOAT,"Zd",gV,(()=>1))]),(0,U.l)("/cameras/{}/perspective/yfov",[new rV(q.e.ANIMATIONTYPE_FLOAT,"fov",gV,(()=>1))]),(0,U.l)("/cameras/{}/perspective/zfar",[new rV(q.e.ANIMATIONTYPE_FLOAT,"maxZ",gV,(()=>1))]),(0,U.l)("/cameras/{}/perspective/znear",[new rV(q.e.ANIMATIONTYPE_FLOAT,"Zd",gV,(()=>1))]),(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new yV(q.e.ANIMATIONTYPE_COLOR3,"albedoColor",YV,(()=>4)),new yV(q.e.ANIMATIONTYPE_FLOAT,"alpha",(function(G,V,W,J){return V[W+3]*J}),(()=>4))]),(0,U.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"metallic",gV,(()=>1))]),(0,U.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"roughness",gV,(()=>1))]);const HV=bV("albedoTexture");(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",HV.scale),(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",HV.offset),(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",HV.rotation);const nV=bV("metallicTexture");(0,U.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",nV.scale),(0,U.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",nV.offset),(0,U.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",nV.rotation),(0,U.l)("/materials/{}/emissiveFactor",[new yV(q.e.ANIMATIONTYPE_COLOR3,"emissiveColor",YV,(()=>3))]);const DV=bV("bumpTexture");(0,U.l)("/materials/{}/normalTexture/scale",[new yV(q.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",gV,(()=>1))]),(0,U.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",DV.scale),(0,U.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",DV.offset),(0,U.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",DV.rotation),(0,U.l)("/materials/{}/occlusionTexture/strength",[new yV(q.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",gV,(()=>1))]);const iV=bV("ambientTexture");(0,U.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",iV.scale),(0,U.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",iV.offset),(0,U.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",iV.rotation);const eV=bV("emissiveTexture");(0,U.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",eV.scale),(0,U.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",eV.offset),(0,U.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",eV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new yV(q.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new yV(q.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",gV,(()=>1))]);const FV=bV("anisotropy.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",FV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",FV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",FV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",gV,(()=>1))]);const fV=bV("clearCoat.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",fV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",fV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",fV.rotation);const vV=bV("clearCoat.bumpTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new yV(q.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",vV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",vV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",vV.rotation);const CV=bV("clearCoat.textureRoughness");(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",CV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",CV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",CV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new yV(q.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new yV(q.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new yV(q.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new yV(q.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",gV,(()=>1))]);const lV=bV("iridescence.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",lV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",lV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",lV.rotation);const mV=bV("iridescence.thicknessTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",mV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",mV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",mV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new yV(q.e.ANIMATIONTYPE_COLOR3,"sheen.color",YV,(()=>3))]),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",gV,(()=>1))]);const wV=bV("sheen.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",wV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",wV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",wV.rotation);const NV=bV("sheen.textureRoughness");(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",NV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",NV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",NV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new yV(q.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",YV,(()=>3))]);const UV=bV("metallicReflectanceTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",UV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",UV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",UV.rotation);const aV=bV("reflectanceTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",aV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",aV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",aV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",gV,(()=>1))]);const MV=bV("subSurface.refractionIntensityTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",MV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",MV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",MV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new yV(q.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",YV,(()=>3))]),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new yV(q.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",gV,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",gV,(()=>1))]);const TV=bV("subSurface.thicknessTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",TV.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",TV.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",TV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new yV(q.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",gV,(()=>1))]);const KV=bV("subSurface.translucencyIntensityTexture");(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",KV.scale),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",KV.offset),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",KV.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new yV(q.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",YV,(()=>3))]);const sV=bV("subSurface.translucencyColorTexture");(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",sV.scale),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",sV.offset),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",sV.rotation),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new uV(q.e.ANIMATIONTYPE_COLOR3,"diffuse",YV,(()=>3))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new uV(q.e.ANIMATIONTYPE_FLOAT,"intensity",gV,(()=>1))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new uV(q.e.ANIMATIONTYPE_FLOAT,"range",gV,(()=>1))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new uV(q.e.ANIMATIONTYPE_FLOAT,"innerAngle",pV,(()=>1))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new uV(q.e.ANIMATIONTYPE_FLOAT,"angle",pV,(()=>1))]),(0,U.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new uV(q.e.ANIMATIONTYPE_COLOR3,"diffuse",YV,(()=>3))]),(0,U.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new uV(q.e.ANIMATIONTYPE_FLOAT,"intensity",gV,(()=>1))]);const QV="KHR_animation_pointer";class ZV{constructor(G){this.name=QV,this._loader=G,this._pathToObjectConverter=(0,U.h)(this._loader.sd)}get enabled(){return this._loader.isExtensionUsed(QV)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(G,V,W,J,R){var d;const k=null===(d=J.target.extensions)||void 0===d?void 0:d.KHR_animation_pointer;if(!k||!this._pathToObjectConverter)return null;"pointer"!==J.target.path&&Y.c.Warn(`${G}/target/path: Value (${J.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=J.target.node&&Y.c.Warn(`${G}/target/node: Value (${J.target.node}) must not be present when using the ${this.name} extension`);const z=`${G}/extensions/${this.name}`,X=k.pointer;if(!X)throw new Error(`${z}: Pointer is missing`);try{const d=this._pathToObjectConverter.convert(X);if(!d.info.interpolation)throw new Error(`${z}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(G,V,W,J,{object:d.object,info:d.info.interpolation},R)}catch(P){return Y.c.Warn(`${z}/pointer: Invalid pointer (${X}) skipped`),null}}}N(QV),w(QV,!0,(G=>new ZV(G)));class EV{constructor(G,V,W){this.frame=G,this.action=V,this.onlyOnce=W,this.isDone=!1}_clone(){return new EV(this.frame,this.action,this.onlyOnce)}}var hV=W(11218),oV=W(11262),cV=W(11254);class jV{get loop(){return this._loop}set loop(G){G!==this._loop&&(this._loop=G,this.updateOptions({loop:G}))}get currentTime(){var G;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(G=oV.b.audioEngine)&&void 0!==G&&G.audioContext&&(this.isPlaying||this.isPaused)){const G=this.isPaused?0:oV.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+G}return 0}get spatialSound(){return this._spatialSound}set spatialSound(G){if(G==this._spatialSound)return;const V=this.isPlaying;this.pause(),G?(this._spatialSound=G,this._updateSpatialParameters()):this._disableSpatialSound(),V&&this.play()}constructor(G,V,W){var J;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new A.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=R.o.Zero(),this._localDirection=new R.o(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=G,W=W||t.c.LastCreatedScene)if(this._scene=W,jV._SceneComponentInitialization(W),this._readyToPlayCallback=d,this._customAttenuationFunction=(G,V,W,J,R)=>V<W?G*(1-V/W):0,z&&(this.autoplay=z.autoplay||!1,this._loop=z.loop||!1,void 0!==z.volume&&(this._volume=z.volume),this._spatialSound=z.spatialSound??!1,this.maxDistance=z.maxDistance??100,this.useCustomAttenuation=z.useCustomAttenuation??!1,this.rolloffFactor=z.rolloffFactor||1,this.refDistance=z.refDistance||1,this.distanceModel=z.distanceModel||"linear",this._playbackRate=z.playbackRate||1,this._streaming=z.streaming??!1,this._length=z.length,this._offset=z.offset),null!==(J=oV.b.audioEngine)&&void 0!==J&&J.canUseWebAudio&&oV.b.audioEngine.audioContext){this._soundGain=oV.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let G=!0;if(V)try{"string"===typeof V?(this._urlType="String",this._url=V):V instanceof ArrayBuffer?this._urlType="ArrayBuffer":V instanceof HTMLMediaElement?this._urlType="MediaElement":V instanceof MediaStream?this._urlType="MediaStream":V instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(V)&&(this._urlType="Array");let W=[],J=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=oV.b.audioEngine.audioContext.createMediaElementSource(V),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=oV.b.audioEngine.audioContext.createMediaStreamSource(V),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":V.byteLength>0&&(J=!0,this._soundLoaded(V));break;case"AudioBuffer":this._audioBufferLoaded(V);break;case"String":W.push(V);case"Array":0===W.length&&(W=V);for(let G=0;G<W.length;G++){const V=W[G];if(J=z&&z.skipCodecCheck||-1!==V.indexOf(".mp3",V.length-4)&&oV.b.audioEngine.isMP3supported||-1!==V.indexOf(".ogg",V.length-4)&&oV.b.audioEngine.isOGGsupported||-1!==V.indexOf(".wav",V.length-4)||-1!==V.indexOf(".m4a",V.length-4)||-1!==V.indexOf(".mp4",V.length-4)||-1!==V.indexOf("blob:"),J){this._streaming?(this._htmlAudioElement=new Audio(V),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,k.h.SetCorsBehavior(V,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(V,(G=>{this._soundLoaded(G)}),void 0,!0,!0,(G=>{G&&Y.c.Error("XHR "+G.status+" error on: "+V+"."),Y.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:G=!1}G?J||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Y.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(X){Y.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),oV.b.audioEngine&&!oV.b.audioEngine.WarnedWebAudioUnsupported&&(Y.c.Error("Web Audio is not supported by your browser."),oV.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var G;null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(G){var V;null!==(V=oV.b.audioEngine)&&void 0!==V&&V.audioContext&&(this._audioBuffer=G,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(G){var V;null!==(V=oV.b.audioEngine)&&void 0!==V&&V.audioContext&&oV.b.audioEngine.audioContext.decodeAudioData(G,(G=>{this._audioBufferLoaded(G)}),(G=>{Y.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+G)}))}setAudioBuffer(G){var V;null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this._audioBuffer=G,this._isReadyToPlay=!0)}updateOptions(G){G&&(this.loop=G.loop??this.loop,this.maxDistance=G.maxDistance??this.maxDistance,this.useCustomAttenuation=G.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=G.rolloffFactor??this.rolloffFactor,this.refDistance=G.refDistance??this.refDistance,this.distanceModel=G.distanceModel??this.distanceModel,this._playbackRate=G.playbackRate??this._playbackRate,this._length=G.length??void 0,this.spatialSound=G.spatialSound??this._spatialSound,this._setOffset(G.offset??void 0),this.setVolume(G.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var G;null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&oV.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??oV.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var G;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(G=this._soundPanner)||void 0===G||G.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var G;null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(G){var V;null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(G),this._isOutputConnected=!0)}setDirectionalCone(G,V,W){V<G?Y.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=G,this._coneOuterAngle=V,this._coneOuterGain=W,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(G){if(G!=this._coneInnerAngle){var V;if(this._coneOuterAngle<G)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=G,null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(G){if(G!=this._coneOuterAngle){var V;if(G<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=G,null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(G){var V;G.equals(this._position)||(this._position.J(G),null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(G){var V;this._localDirection=G,null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const G=this._connectedTransformNode.getWorldMatrix(),V=R.o.TransformNormal(this._localDirection,G);V.normalize(),this._soundPanner.orientationX.value=V.x,this._soundPanner.orientationY.value=V.y,this._soundPanner.orientationZ.value=V.z}updateDistanceFromListener(){var G;if(null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const G=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.zW(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,G,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(G){this._customAttenuationFunction=G}play(G,V,W){var J;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(J=oV.b.audioEngine)&&void 0!==J&&J.audioContext)try{var R,d;this._clearTimeoutsAndObservers();let J=G?(null===(R=oV.b.audioEngine)||void 0===R?void 0:R.audioContext.currentTime)+G:null===(d=oV.b.audioEngine)||void 0===d?void 0:d.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=oV.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const G=()=>{var W;if(null!==(W=oV.b.audioEngine)&&void 0!==W&&W.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=V??0;const W=this._htmlAudioElement.play();void 0!==W&&W.catch((()=>{var V,W;(null===(V=oV.b.audioEngine)||void 0===V||V.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(W=oV.b.audioEngine)||void 0===W?void 0:W.onAudioUnlockedObservable.addOnce((()=>{G()})))}))}else{var J;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(J=oV.b.audioEngine)||void 0===J?void 0:J.onAudioUnlockedObservable.addOnce((()=>{G()}))}};G()}}else{var k;const R=()=>{var R;if(null!==(R=oV.b.audioEngine)&&void 0!==R&&R.audioContext){var d;if(W=W||this._length,void 0!==V&&this._setOffset(V),this._soundSource){const G=this._soundSource;G.onended=()=>{G.disconnect()}}if(this._soundSource=null===(d=oV.b.audioEngine)||void 0===d?void 0:d.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var k;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==V&&(this._soundSource.loopStart=V),void 0!==W&&(this._soundSource.loopEnd=(0|V)+W),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},J=G?(null===(k=oV.b.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+G:oV.b.audioEngine.audioContext.currentTime;const R=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(J,R,this.loop?void 0:W)}}};"suspended"===(null===(k=oV.b.audioEngine)||void 0===k?void 0:k.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var G;"suspended"===(null===(G=oV.b.audioEngine)||void 0===G?void 0:G.audioContext.state)?(oV.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=oV.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{R()})))):R()}),500):R()}this._startTime=J,this.isPlaying=!0,this.isPaused=!1}catch(z){Y.c.Error("Error while trying to play audio: "+this.name+", "+z.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(G){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var W;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(W=this._streamingSource)||void 0===W||W.disconnect();this.isPlaying=!1}else if(null!==(V=oV.b.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource){const V=G?oV.b.audioEngine.audioContext.currentTime+G:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(V)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var G;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var V;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(V=this._streamingSource)||void 0===V||V.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(G=oV.b.audioEngine)&&void 0!==G&&G.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=oV.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(G,V){var W;null!==(W=oV.b.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._soundGain&&(V&&oV.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(oV.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,oV.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(G,oV.b.audioEngine.audioContext.currentTime+V)):this._soundGain.gain.value=G),this._volume=G}setPlaybackRate(G){this._playbackRate=G,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(G){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=G,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=G=>this._onRegisterAfterWorldMatrixUpdate(G),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(G){var V;if(G.getBoundingInfo){const V=G.getBoundingInfo();this.setPosition(V.boundingSphere.centerWorld)}else this.setPosition(G.absolutePosition);null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const G=()=>{(0,cV.f)((()=>this._isReadyToPlay),(()=>{W._audioBuffer=this.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,this._offset,this._length)}),void 0,300)},V={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},W=new jV(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,V);return this.useCustomAttenuation&&W.setAttenuationFunction(this._customAttenuationFunction),W.setPosition(this._position),W.setPlaybackRate(this._playbackRate),G(),W}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const G={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(G.connectedMeshId=this._connectedTransformNode.id),G.position=this._position.Bd(),G.refDistance=this.refDistance,G.distanceModel=this.distanceModel,G.isDirectional=this._isDirectional,G.localDirectionToMesh=this._localDirection.Bd(),G.coneInnerAngle=this._coneInnerAngle,G.coneOuterAngle=this._coneOuterAngle,G.coneOuterGain=this._coneOuterGain),G}static Parse(G,V,W,J){const d=G.name;let k;k=G.url?W+G.url:W+d;const z={autoplay:G.autoplay,loop:G.loop,volume:G.volume,spatialSound:G.spatialSound,maxDistance:G.maxDistance,rolloffFactor:G.rolloffFactor,refDistance:G.refDistance,distanceModel:G.distanceModel,playbackRate:G.playbackRate};let X;if(J){const G=()=>{(0,cV.f)((()=>J._isReadyToPlay),(()=>{X._audioBuffer=J.getAudioBuffer(),X._isReadyToPlay=!0,X.autoplay&&X.play(0,X._offset,X._length)}),void 0,300)};X=new jV(d,new ArrayBuffer(0),V,null,z),G()}else X=new jV(d,k,V,(()=>{V.removePendingData(X)}),z),V.addPendingData(X);if(G.position){const V=R.o.ld(G.position);X.setPosition(V)}if(G.isDirectional&&(X.setDirectionalCone(G.coneInnerAngle||360,G.coneOuterAngle||360,G.coneOuterGain||0),G.localDirectionToMesh)){const V=R.o.ld(G.localDirectionToMesh);X.setLocalDirectionToMesh(V)}if(G.connectedMeshId){const W=V.getMeshById(G.connectedMeshId);W&&X.attachToMesh(W)}return G.metadata&&(X.metadata=G.metadata),X}_setOffset(G){this._offset!==G&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=G)}_clearTimeoutsAndObservers(){var G;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(G=oV.b.audioEngine)||void 0===G||G.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}jV._SceneComponentInitialization=G=>{throw(0,hV.e)("AudioSceneComponent")},(0,yG.d)("BABYLON.Sound",jV);class IV{constructor(G,V,W){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],V.length!==W.length)throw new Error("Sounds length does not equal weights length");this.loop=G,this._weights=W;let J=0;for(const d of W)J+=d;const R=J>0?1/J:0;for(let d=0;d<this._weights.length;d++)this._weights[d]*=R;this._sounds=V;for(const d of this._sounds)d.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(G){if(G!==this._coneInnerAngle){if(this._coneOuterAngle<G)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=G;for(const V of this._sounds)V.directionalConeInnerAngle=G}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(G){if(G!==this._coneOuterAngle){if(G<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=G;for(const V of this._sounds)V.directionalConeOuterAngle=G}}get volume(){return this._volume}set volume(G){if(G!==this._volume)for(const V of this._sounds)V.setVolume(G)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(G){if(!this.isPaused){this.stop();const G=Math.random();let V=0;for(let W=0;W<this._weights.length;W++)if(V+=this._weights[W],G<=V){this._currentIndex=W;break}}const V=this._sounds[this._currentIndex??0];V.isReady()?V.play(0,this.isPaused?void 0:G):V.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class OV{constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(G=G||t.c.LastCreatedScene)&&(this._scene=G,this.soundCollection=[],this._options=V,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var G;null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&oV.b.audioEngine.audioContext&&(this._outputAudioNode=oV.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(oV.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(oV.b.audioEngine&&oV.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(G){var V;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&G.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==G.soundTrackId&&(-1===G.soundTrackId?this._scene.mainSoundTrack.removeSound(G):this._scene.soundTracks&&this._scene.soundTracks[G.soundTrackId].removeSound(G)),this.soundCollection.push(G),G.soundTrackId=this.id}removeSound(G){const V=this.soundCollection.indexOf(G);-1!==V&&this.soundCollection.splice(V,1)}setVolume(G){var V;null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=G)}switchPanningModelToHRTF(){var G;if(null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio)for(let V=0;V<this.soundCollection.length;V++)this.soundCollection[V].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var G;if(null!==(G=oV.b.audioEngine)&&void 0!==G&&G.canUseWebAudio)for(let V=0;V<this.soundCollection.length;V++)this.soundCollection[V].switchPanningModelToEqualPower()}connectToAnalyser(G){var V;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=G,null!==(V=oV.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,oV.b.audioEngine.masterGain))}}var GW=W(11561),VW=W(11737),WW=W(11196);oV.b.AudioEngineFactory=(G,V,W)=>new JW(G,V,W);class JW{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new A.b,this.onAudioLockedObservable=new A.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,WW.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const J=document.createElement("audio");this._hostElement=G,this._audioContext=V,this._audioDestination=W;try{J&&J.canPlayType&&(J.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||J.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(R){}try{J&&J.canPlayType&&J.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(R){}}lock(){this._triggerSuspendedState()}unlock(){var G,V;if("running"===(null===(G=this._audioContext)||void 0===G?void 0:G.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(V=this._audioContext)||void 0===V||V.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Y.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var G;null===(G=this._audioContext)||void 0===G||G.addEventListener("statechange",(()=>{var G;this.unlocked&&"running"!==(null===(G=this._audioContext)||void 0===G?void 0:G.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var G;return null!==(G=this._audioContext)&&void 0!==G&&G.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(G){this.canUseWebAudio=!1,Y.c.Error("Web Audio: "+G.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(G){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const G=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",V=document.createElement("style");V.appendChild(document.createTextNode(G)),document.getElementsByTagName("head")[0].appendChild(V),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var G;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(G=this._audioContext)||void 0===G||G.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(G){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=G)}connectToAnalyser(G){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=G,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var RW=W(11211);(0,W(12737).c)(GW.b.NAME_AUDIO,((G,V,W,J)=>{let R,d=[];if(W.Sq=W.Sq||[],void 0!==G.Sq&&null!==G.Sq)for(let z=0,X=G.Sq.length;z<X;z++){var k;const X=G.Sq[z];null!==(k=oV.b.audioEngine)&&void 0!==k&&k.canUseWebAudio?(X.url||(X.url=X.name),d[X.url]?W.Sq.push(jV.Parse(X,V,J,d[X.url])):(R=jV.Parse(X,V,J),d[X.url]=R,W.Sq.push(R))):W.Sq.push(new jV(X.name,null,V))}d=[]})),Object.defineProperty(VW.e.prototype,"mainSoundTrack",{get:function(){let G=this._getComponent(GW.b.NAME_AUDIO);return G||(G=new dW(this),this.o(G)),this._mainSoundTrack||(this._mainSoundTrack=new OV(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),VW.e.prototype.getSoundByName=function(G){let V;for(V=0;V<this.mainSoundTrack.soundCollection.length;V++)if(this.mainSoundTrack.soundCollection[V].name===G)return this.mainSoundTrack.soundCollection[V];if(this.soundTracks)for(let W=0;W<this.soundTracks.length;W++)for(V=0;V<this.soundTracks[W].soundCollection.length;V++)if(this.soundTracks[W].soundCollection[V].name===G)return this.soundTracks[W].soundCollection[V];return null},Object.defineProperty(VW.e.prototype,"audioEnabled",{get:function(){let G=this._getComponent(GW.b.NAME_AUDIO);return G||(G=new dW(this),this.o(G)),G.audioEnabled},set:function(G){let V=this._getComponent(GW.b.NAME_AUDIO);V||(V=new dW(this),this.o(V)),G?V.enableAudio():V.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(VW.e.prototype,"headphone",{get:function(){let G=this._getComponent(GW.b.NAME_AUDIO);return G||(G=new dW(this),this.o(G)),G.headphone},set:function(G){let V=this._getComponent(GW.b.NAME_AUDIO);V||(V=new dW(this),this.o(V)),G?V.switchAudioModeForHeadphones():V.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(VW.e.prototype,"audioListenerPositionProvider",{get:function(){let G=this._getComponent(GW.b.NAME_AUDIO);return G||(G=new dW(this),this.o(G)),G.audioListenerPositionProvider},set:function(G){let V=this._getComponent(GW.b.NAME_AUDIO);if(V||(V=new dW(this),this.o(V)),G&&"function"!==typeof G)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");V.audioListenerPositionProvider=G},enumerable:!0,configurable:!0}),Object.defineProperty(VW.e.prototype,"audioListenerRotationProvider",{get:function(){let G=this._getComponent(GW.b.NAME_AUDIO);return G||(G=new dW(this),this.o(G)),G.audioListenerRotationProvider},set:function(G){let V=this._getComponent(GW.b.NAME_AUDIO);if(V||(V=new dW(this),this.o(V)),G&&"function"!==typeof G)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");V.audioListenerRotationProvider=G},enumerable:!0,configurable:!0}),Object.defineProperty(VW.e.prototype,"audioPositioningRefreshRate",{get:function(){let G=this._getComponent(GW.b.NAME_AUDIO);return G||(G=new dW(this),this.o(G)),G.audioPositioningRefreshRate},set:function(G){let V=this._getComponent(GW.b.NAME_AUDIO);V||(V=new dW(this),this.o(V)),V.audioPositioningRefreshRate=G},enumerable:!0,configurable:!0});class dW{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(G){this.name=GW.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new R.o,this._cachedCameraPosition=new R.o,this._lastCheck=0,this._invertMatrixTemp=new R.c,this._cameraDirectionTemp=new R.o,(G=G||t.c.LastCreatedScene)&&(this.tV=G,G.soundTracks=[],G.Sq=[])}register(){this.tV._afterRenderStage.registerStep(GW.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(G){if(G.Sq=[],this.tV.soundTracks)for(let V=0;V<this.tV.soundTracks.length;V++){const W=this.tV.soundTracks[V];for(let V=0;V<W.soundCollection.length;V++)G.Sq.push(W.soundCollection[V].serialize())}}addFromContainer(G){if(G.Sq)for(const V of G.Sq)V.play(),V.autoplay=!0,this.tV.mainSoundTrack.addSound(V)}removeFromContainer(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(G.Sq)for(const W of G.Sq)W.stop(),W.autoplay=!1,this.tV.mainSoundTrack.removeSound(W),V&&W.dispose()}dispose(){const G=this.tV;if(G._mainSoundTrack&&G.mainSoundTrack.dispose(),G.soundTracks)for(let V=0;V<G.soundTracks.length;V++)G.soundTracks[V].dispose()}disableAudio(){const G=this.tV;let V;for(this._audioEnabled=!1,oV.b.audioEngine&&oV.b.audioEngine.audioContext&&oV.b.audioEngine.audioContext.suspend(),V=0;V<G.mainSoundTrack.soundCollection.length;V++)G.mainSoundTrack.soundCollection[V].pause();if(G.soundTracks)for(V=0;V<G.soundTracks.length;V++)for(let W=0;W<G.soundTracks[V].soundCollection.length;W++)G.soundTracks[V].soundCollection[W].pause()}enableAudio(){const G=this.tV;let V;for(this._audioEnabled=!0,oV.b.audioEngine&&oV.b.audioEngine.audioContext&&oV.b.audioEngine.audioContext.resume(),V=0;V<G.mainSoundTrack.soundCollection.length;V++)G.mainSoundTrack.soundCollection[V].isPaused&&G.mainSoundTrack.soundCollection[V].play();if(G.soundTracks)for(V=0;V<G.soundTracks.length;V++)for(let W=0;W<G.soundTracks[V].soundCollection.length;W++)G.soundTracks[V].soundCollection[W].isPaused&&G.soundTracks[V].soundCollection[W].play()}switchAudioModeForHeadphones(){const G=this.tV;if(this._headphone=!0,G.mainSoundTrack.switchPanningModelToHRTF(),G.soundTracks)for(let V=0;V<G.soundTracks.length;V++)G.soundTracks[V].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const G=this.tV;if(this._headphone=!1,G.mainSoundTrack.switchPanningModelToEqualPower(),G.soundTracks)for(let V=0;V<G.soundTracks.length;V++)G.soundTracks[V].switchPanningModelToEqualPower()}_afterRender(){const G=RW.e.Now;if(this._lastCheck&&G-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=G;const V=this.tV;if(!this._audioEnabled||!V._mainSoundTrack||!V.soundTracks||0===V._mainSoundTrack.soundCollection.length&&1===V.soundTracks.length)return;const W=oV.b.audioEngine;if(W&&W.audioContext){let G,J=V.activeCamera;if(V.activeCameras&&V.activeCameras.length>0&&(J=V.activeCameras[0]),this.audioListenerPositionProvider){const G=this.audioListenerPositionProvider();W.audioContext.listener.setPosition(G.x||0,G.y||0,G.z||0)}else J?this._cachedCameraPosition.equals(J.globalPosition)||(this._cachedCameraPosition.J(J.globalPosition),W.audioContext.listener.setPosition(J.globalPosition.x,J.globalPosition.y,J.globalPosition.z)):W.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const G=this.audioListenerRotationProvider();W.audioContext.listener.setOrientation(G.x||0,G.y||0,G.z||0,0,1,0)}else J?(J.rigCameras&&J.rigCameras.length>0&&(J=J.rigCameras[0]),J.getViewMatrix().invertToRef(this._invertMatrixTemp),R.o.TransformNormalToRef(dW._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.J(this._cameraDirectionTemp),W.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):W.audioContext.listener.setOrientation(0,0,0,0,1,0);for(G=0;G<V.mainSoundTrack.soundCollection.length;G++){const W=V.mainSoundTrack.soundCollection[G];W.useCustomAttenuation&&W.updateDistanceFromListener()}if(V.soundTracks)for(G=0;G<V.soundTracks.length;G++)for(let W=0;W<V.soundTracks[G].soundCollection.length;W++){const J=V.soundTracks[G].soundCollection[W];J.useCustomAttenuation&&J.updateDistanceFromListener()}}}}dW._CameraDirection=new R.o(0,0,-1),jV._SceneComponentInitialization=G=>{let V=G._getComponent(GW.b.NAME_AUDIO);V||(V=new dW(G),G.o(V))};const kW="MSFT_audio_emitter";class zW{constructor(G){this.name=kW,this._loader=G,this.enabled=this._loader.isExtensionUsed(kW)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const G=this._loader.sd.extensions;if(G&&G[this.name]){const V=G[this.name];this._clips=V.clips,this._emitters=V.emitters,T.Assign(this._clips),T.Assign(this._emitters)}}loadSceneAsync(G,V){return s.LoadExtensionAsync(G,V,this.name,(async(W,J)=>{const R=new Array;R.push(this._loader.loadSceneAsync(G,V));for(const G of J.emitters){const V=T.Get(`${W}/emitters`,this._emitters,G);if(void 0!=V.refDistance||void 0!=V.maxDistance||void 0!=V.rolloffFactor||void 0!=V.distanceModel||void 0!=V.innerAngle||void 0!=V.outerAngle)throw new Error(`${W}: Direction or Distance properties are not allowed on emitters attached to a scene`);R.push(this._loadEmitterAsync(`${W}/emitters/${V.index}`,V))}await Promise.all(R)}))}loadNodeAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(G,J)=>{const d=new Array,z=await this._loader.loadNodeAsync(G,V,(V=>{for(const W of J.emitters){const J=T.Get(`${G}/emitters`,this._emitters,W);d.push(this._loadEmitterAsync(`${G}/emitters/${J.index}`,J).then((()=>{for(const G of J._babylonSounds)G.attachToMesh(V),void 0==J.innerAngle&&void 0==J.outerAngle||(G.setLocalDirectionToMesh(R.o.Forward()),G.setDirectionalCone(2*k.h.ToDegrees(void 0==J.innerAngle?Math.PI:J.innerAngle),2*k.h.ToDegrees(void 0==J.outerAngle?Math.PI:J.outerAngle),0))})))}W(V)}));return await Promise.all(d),z}))}loadAnimationAsync(G,V){return s.LoadExtensionAsync(G,V,this.name,(async(W,J)=>{const R=await this._loader.loadAnimationAsync(G,V),d=new Array;T.Assign(J.events);for(const k of J.events)d.push(this._loadAnimationEventAsync(`${W}/events/${k.index}`,G,V,k,R));return await Promise.all(d),R}))}_loadClipAsync(G,V){if(V._objectURL)return V._objectURL;let W;if(V.uri)W=this._loader.loadUriAsync(G,V,V.uri);else{const J=T.Get(`${G}/bufferView`,this._loader.sd.bufferViews,V.bufferView);W=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J)}return V._objectURL=W.then((G=>URL.createObjectURL(new Blob([G],{type:V.mimeType})))),V._objectURL}_loadEmitterAsync(G,V){if(V._babylonSounds=V._babylonSounds||[],!V._babylonData){const G=new Array,W=V.name||`emitter${V.index}`,J={loop:!1,autoplay:!1,volume:void 0==V.volume?1:V.volume};for(let d=0;d<V.clips.length;d++){const R=`/extensions/${this.name}/clips`,k=T.Get(R,this._clips,V.clips[d].clip);G.push(this._loadClipAsync(`${R}/${V.clips[d].clip}`,k).then((G=>{const R=V._babylonSounds[d]=new jV(W,G,this._loader.babylonScene,null,J);R.refDistance=V.refDistance||1,R.maxDistance=V.maxDistance||256,R.rolloffFactor=V.rolloffFactor||1,R.distanceModel=V.distanceModel||"exponential"})))}const R=Promise.all(G).then((()=>{const G=V.clips.map((G=>G.weight||1)),W=new IV(V.loop||!1,V._babylonSounds,G);V.innerAngle&&(W.directionalConeInnerAngle=2*k.h.ToDegrees(V.innerAngle)),V.outerAngle&&(W.directionalConeOuterAngle=2*k.h.ToDegrees(V.outerAngle)),V.volume&&(W.volume=V.volume),V._babylonData.sound=W}));V._babylonData={loaded:R}}return V._babylonData.loaded}_getEventAction(G,V,W,J,R){switch(W){case"play":return G=>{const W=(R||0)+(G-J);V.play(W)};case"stop":return()=>{V.stop()};case"pause":return()=>{V.pause()};default:throw new Error(`${G}: Unsupported action ${W}`)}}_loadAnimationEventAsync(G,V,W,J,R){if(0==R.targetedAnimations.length)return Promise.resolve();const d=R.targetedAnimations[0],k=J.j,z=T.Get(`/extensions/${this.name}/emitters`,this._emitters,k);return this._loadEmitterAsync(G,z).then((()=>{const V=z._babylonData.sound;if(V){const W=new EV(J.time,this._getEventAction(G,V,J.action,J.time,J.startOffset));d.animation.addEvent(W),R.onAnimationGroupEndObservable.add((()=>{V.stop()})),R.onAnimationGroupPauseObservable.add((()=>{V.pause()}))}}))}}N(kW),w(kW,!0,(G=>new zW(G)));const XW="MSFT_lod";class PW{constructor(G){var V;this.name=XW,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new A.b,this.onMaterialLODsLoadedObservable=new A.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=G,this.maxLODsToLoad=(null===(V=this._loader.parent.extensionOptions[XW])||void 0===V?void 0:V.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(XW)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let G=0;G<this._nodePromiseLODs.length;G++){const V=Promise.all(this._nodePromiseLODs[G]).then((()=>{0!==G&&(this._loader.endPerformanceCounter(`Node LOD ${G}`),this._loader.log(`Loaded node LOD ${G}`)),this.onNodeLODsLoadedObservable.notifyObservers(G),G!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${G+1}`),this._loadBufferLOD(this._nodeBufferLODs,G+1),this._nodeSignalLODs[G]&&this._nodeSignalLODs[G].resolve())}));this._loader._completePromises.push(V)}for(let G=0;G<this._materialPromiseLODs.length;G++){const V=Promise.all(this._materialPromiseLODs[G]).then((()=>{0!==G&&(this._loader.endPerformanceCounter(`Material LOD ${G}`),this._loader.log(`Loaded material LOD ${G}`)),this.onMaterialLODsLoadedObservable.notifyObservers(G),G!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${G+1}`),this._loadBufferLOD(this._materialBufferLODs,G+1),this._materialSignalLODs[G]&&this._materialSignalLODs[G].resolve())}));this._loader._completePromises.push(V)}}loadSceneAsync(G,V){const W=this._loader.loadSceneAsync(G,V);return this._loadBufferLOD(this._bufferLODs,0),W}loadNodeAsync(G,V,W){return s.LoadExtensionAsync(G,V,this.name,(async(G,R)=>{let d;const k=this._getLODs(G,V,this._loader.sd.nodes,R.ids);this._loader.logOpen(`${G}`);for(let V=0;V<k.length;V++){const G=k[V];0!==V&&(this._nodeIndexLOD=V,this._nodeSignalLODs[V]=this._nodeSignalLODs[V]||new J);const R=G=>{W(G),G.rz(!1)},z=this._loader.loadNodeAsync(`/nodes/${G.index}`,G,R).then((G=>{if(0!==V){const G=k[V-1];G._babylonTransformNode&&(this._disposeTransformNode(G._babylonTransformNode),delete G._babylonTransformNode)}return G.rz(!0),G}));this._nodePromiseLODs[V]=this._nodePromiseLODs[V]||[],0===V?d=z:(this._nodeIndexLOD=null,this._nodePromiseLODs[V].push(z))}return this._loader.logClose(),await d}))}_loadMaterialAsync(G,V,W,J,R){return this._nodeIndexLOD?null:s.LoadExtensionAsync(G,V,this.name,(async(G,d)=>{let k;const z=this._getLODs(G,V,this._loader.sd.materials,d.ids);this._loader.logOpen(`${G}`);for(let V=0;V<z.length;V++){const G=z[V];0!==V&&(this._materialIndexLOD=V);const d=this._loader._loadMaterialAsync(`/materials/${G.index}`,G,W,J,(G=>{0===V&&R(G)})).then((G=>{if(0!==V){R(G);const W=z[V-1]._data;W[J]&&(this._disposeMaterials([W[J].babylonMaterial]),delete W[J])}return G}));this._materialPromiseLODs[V]=this._materialPromiseLODs[V]||[],0===V?k=d:(this._materialIndexLOD=null,this._materialPromiseLODs[V].push(d))}return this._loader.logClose(),await k}))}_loadUriAsync(G,V,W){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const R=this._nodeIndexLOD-1;return this._nodeSignalLODs[R]=this._nodeSignalLODs[R]||new J,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(G,V,W)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const R=this._materialIndexLOD-1;return this._materialSignalLODs[R]=this._materialSignalLODs[R]||new J,this._materialSignalLODs[R].promise.then((async()=>await this._loader.loadUriAsync(G,V,W)))}return null}loadBufferAsync(G,V,W,R){if(this._loader.parent.useRangeRequests&&!V.uri){if(!this._loader.bin)throw new Error(`${G}: Uri is missing or the binary glTF is missing its binary chunk`);const V=async(G,V)=>{const d=W,k=d+R-1;let z=G[V];return z?(z.start=Math.min(z.start,d),z.end=Math.max(z.end,k)):(z={start:d,end:k,loaded:new J},G[V]=z),await z.loaded.promise.then((G=>new Uint8Array(G.buffer,G.byteOffset+W-z.start,R)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?V(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?V(this._materialBufferLODs,this._materialIndexLOD):V(this._bufferLODs,0)}return null}_loadBufferLOD(G,V){const W=G[V];W&&(this._loader.log(`Loading buffer range [${W.start}-${W.end}]`),this._loader.bin.readAsync(W.start,W.end-W.start+1).then((G=>{W.loaded.resolve(G)}),(G=>{W.loaded.reject(G)})))}_getLODs(G,V,W,J){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const R=[];for(let d=J.length-1;d>=0;d--)if(R.push(T.Get(`${G}/ids/${J[d]}`,W,J[d])),R.length===this.maxLODsToLoad)return R;return R.push(V),R}_disposeTransformNode(G){const V=[],W=G.material;W&&V.push(W);for(const R of G.getChildMeshes())R.material&&V.push(R.material);G.dispose();const J=V.filter((G=>this._loader.babylonScene.meshes.every((V=>V.material!=G))));this._disposeMaterials(J)}_disposeMaterials(G){const V={};for(const W of G){for(const G of W.getActiveTextures())V[G.uniqueId]=G;W.dispose()}for(const W in V)for(const G of this._loader.babylonScene.materials)G.hasTexture(V[W])&&delete V[W];for(const W in V)V[W].dispose()}}N(XW),w(XW,!0,(G=>new PW(G)));const AW="MSFT_minecraftMesh";class xW{constructor(G){this.name=AW,this._loader=G,this.enabled=this._loader.isExtensionUsed(AW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtraAsync(G,V,this.name,(async(J,R)=>{if(R){if(!(W instanceof p.d))throw new Error(`${J}: Material type not supported`);const R=this._loader.loadMaterialPropertiesAsync(G,V,W);return W.needAlphaBlending()&&(W.forceDepthWrite=!0,W.separateCullingPass=!0),W.gd=W.forceDepthWrite,W.twoSidedLighting=!0,await R}}))}}N(AW),w(AW,!0,(G=>new xW(G)));const qW="MSFT_sRGBFactors";class LW{constructor(G){this.name=qW,this._loader=G,this.enabled=this._loader.isExtensionUsed(qW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,V,W){return s.LoadExtraAsync(G,V,this.name,(async(J,R)=>{if(R){if(!(W instanceof p.d))throw new Error(`${J}: Material type not supported`);const R=this._loader.loadMaterialPropertiesAsync(G,V,W),d=W.HG().getEngine().useExactSrgbConversions;return W.albedoTexture||W.albedoColor.toLinearSpaceToRef(W.albedoColor,d),W.reflectivityTexture||W.reflectivityColor.toLinearSpaceToRef(W.reflectivityColor,d),await R}}))}}N(qW),w(qW,!0,(G=>new LW(G)));var tW=W(13053);const YW={};var gW=W(13106),BW=W(13084),SW=W(13061),pW=W(13071);function bW(G,V){for(const W of G)for(const G of W.dataOutputs)if(G.uniqueId===V)return G;throw new Error("Could not find data out connection with unique id "+V)}function rW(G,V){for(const W of G)if(W instanceof BW.b)for(const G of W.signalInputs)if(G.uniqueId===V)return G;throw new Error("Could not find signal in connection with unique id "+V)}async function yW(G,V){const J=await Promise.all(G.allBlocks.map((async G=>{const V=function(G){switch(G){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([W.e(58),W.e(59)]).then(W.bind(W,14482))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await W.e(60).then(W.bind(W,14485))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await W.e(61).then(W.bind(W,14487))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await W.e(62).then(W.bind(W,14493))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await W.e(63).then(W.bind(W,14498))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await W.e(64).then(W.bind(W,14503))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await W.e(65).then(W.bind(W,14509))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await W.e(66).then(W.bind(W,14515))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await W.e(67).then(W.bind(W,14519))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await W.e(70).then(W.bind(W,14554))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await W.e(70).then(W.bind(W,14554))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await W.e(70).then(W.bind(W,14554))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await W.e(70).then(W.bind(W,14554))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await W.e(75).then(W.bind(W,14563))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await W.e(76).then(W.bind(W,14567))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await W.e(77).then(W.bind(W,14572))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await W.e(78).then(W.bind(W,14577))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await W.e(79).then(W.bind(W,14579))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await W.e(80).then(W.bind(W,14586))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await W.e(81).then(W.bind(W,14589))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await W.e(82).then(W.bind(W,14598))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await W.e(83).then(W.bind(W,14600))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await W.e(84).then(W.bind(W,14609))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await W.e(85).then(W.bind(W,14614))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await W.e(86).then(W.bind(W,14617))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await W.e(87).then(W.bind(W,14622))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await W.e(88).then(W.bind(W,14630))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await W.e(89).then(W.bind(W,14639))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await W.e(90).then(W.bind(W,14647))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await W.e(91).then(W.bind(W,14650))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await W.e(92).then(W.bind(W,14657))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await W.e(93).then(W.bind(W,14663))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await W.e(72).then(W.bind(W,14666))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await W.e(94).then(W.bind(W,14671))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await W.e(95).then(W.bind(W,14679))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await W.e(96).then(W.bind(W,14682))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await W.e(73).then(W.bind(W,14685))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await W.e(68).then(W.bind(W,14528))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await W.e(74).then(W.bind(W,14694))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await W.e(69).then(W.bind(W,14550))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await W.e(70).then(W.bind(W,14554))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await W.e(70).then(W.bind(W,14554))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await W.e(71).then(W.bind(W,14698))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await W.e(71).then(W.bind(W,14698))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await W.e(71).then(W.bind(W,14698))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await W.e(71).then(W.bind(W,14698))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await W.e(71).then(W.bind(W,14698))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await W.e(71).then(W.bind(W,14698))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await W.e(97).then(W.bind(W,14702))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await W.e(98).then(W.bind(W,14710))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await W.e(99).then(W.bind(W,14713))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await W.e(100).then(W.bind(W,14719))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await W.e(101).then(W.bind(W,14725))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await W.e(102).then(W.bind(W,14730))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await W.e(103).then(W.bind(W,14732))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await W.e(104).then(W.bind(W,14736))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await W.e(105).then(W.bind(W,14740))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await W.e(106).then(W.bind(W,14749))).FlowGraphDataSwitchBlock;default:if(YW[G])return YW[G];throw new Error(`Unknown block name ${G}`)}}(G.className);return await V()})));return function(G,V,W){const J=V.coordinator.createGraph(),R=[],d=V.valueParseFunction??SW.c;for(let k=0;k<G.allBlocks.length;k++){const z=HW(G.allBlocks[k],{tV:V.coordinator.config.tV,pathConverter:V.pathConverter,assetsContainer:V.coordinator.config.tV,valueParseFunction:d},W[k]);R.push(z),z instanceof gW.d&&J.addEventBlock(z)}for(const k of R){for(const G of k.dataInputs)for(const V of G.connectedPointIds){const W=bW(R,V);G.connectTo(W)}if(k instanceof BW.b)for(const G of k.signalOutputs)for(const V of G.connectedPointIds){const W=rW(R,V);G.connectTo(W)}}for(const k of G.executionContexts)uW(k,{graph:J,valueParseFunction:d},G.rightHanded);return J}(G,V,J)}function uW(G,V,W){const J=V.graph.createContext();G.enableLogging&&(J.enableLogging=!0),J.treatDataAsRightHanded=W||!1;const R=V.valueParseFunction??SW.c;J.uniqueId=G.uniqueId;const d=J.HG();if(G._assetsContext){var k,z,X,P,A,x,q,L,t,Y;const V=G._assetsContext,W={meshes:null===(k=V.meshes)||void 0===k?void 0:k.map((G=>d.getMeshById(G))),lights:null===(z=V.lights)||void 0===z?void 0:z.map((G=>d.getLightByName(G))),cameras:null===(X=V.cameras)||void 0===X?void 0:X.map((G=>d.getCameraByName(G))),materials:null===(P=V.materials)||void 0===P?void 0:P.map((G=>d.getMaterialById(G))),textures:null===(A=V.textures)||void 0===A?void 0:A.map((G=>d.getTextureByName(G))),animations:null===(x=V.animations)||void 0===x?void 0:x.map((G=>d.animations.find((V=>V.name===G)))),skeletons:null===(q=V.skeletons)||void 0===q?void 0:q.map((G=>d.getSkeletonByName(G))),mx:null===(L=V.mx)||void 0===L?void 0:L.map((G=>d.getParticleSystemById(G))),animationGroups:null===(t=V.animationGroups)||void 0===t?void 0:t.map((G=>d.getAnimationGroupByName(G))),transformNodes:null===(Y=V.transformNodes)||void 0===Y?void 0:Y.map((G=>d.getTransformNodeById(G))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Sq:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};J.assetsContext=W}for(const g in G._userVariables){const V=R(g,G._userVariables,J.assetsContext,d);J.userVariables[g]=V}for(const g in G._connectionValues){const V=R(g,G._connectionValues,J.assetsContext,d);J._setConnectionValueByKey(g,V)}return J}function HW(G,V,W){const J={},R=V.valueParseFunction??SW.c;if(G.config)for(const k in G.config)J[k]=R(k,G.config,V.assetsContainer||V.tV,V.tV);if((0,SW.i)(G.className)){if(!V.pathConverter)throw new Error("Path converter is required for this block");J.pathConverter=V.pathConverter}const d=new W(J);d.uniqueId=G.uniqueId;for(let k=0;k<G.dataInputs.length;k++){const V=d.getDataInput(G.dataInputs[k].name);if(!V)throw new Error("Could not find data input with name "+G.dataInputs[k].name+" in block "+G.className);V.deserialize(G.dataInputs[k])}for(let k=0;k<G.dataOutputs.length;k++){const V=d.getDataOutput(G.dataOutputs[k].name);if(!V)throw new Error("Could not find data output with name "+G.dataOutputs[k].name+" in block "+G.className);V.deserialize(G.dataOutputs[k])}return d.metadata=G.metadata,d.deserialize&&d.deserialize(G),d}function nW(G){const[V,W]=G.split(":");return DW({op:V,extension:W})}function DW(G){var V;let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const J=G.extension?null===(V=eW[G.extension])||void 0===V?void 0:V[G.op]:FW[G.op];if(!J&&(Y.c.Warn(`No mapping found for operation ${G.op} and extension ${G.extension||"KHR_interactivity"}`),W)){const V={},W={flows:{}};if(G.inputValueSockets){V.values={};for(const W in G.inputValueSockets)V.values[W]={name:W}}return G.outputValueSockets&&(W.values={},Object.keys(G.outputValueSockets).forEach((G=>{W.values[G]={name:G}}))),{EP:[],inputs:V,outputs:W}}return J}function iW(G,V,W){eW[V]||(eW[V]={}),eW[V][G]=W}const eW={BABYLON:{"flow/log":{EP:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},FW={"event/onStart":{EP:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{EP:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{EP:["FlowGraphSendCustomEventBlock"],extraProcessor(G,V,W,J,R){if("event/send"!==V.op||!G.configuration||1!==Object.keys(G.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=G.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const k=J.arrays.events[d],z=R[0];return z.config||(z.config={}),z.config.eventId=k.eventId,z.config.eventData=k.eventData,R}},"event/receive":{EP:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(G,V){var W;if(!G.configuration)return Y.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const J=G.configuration.event;if(!J)return Y.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const R=J.value[0];if("number"!==typeof R)return Y.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(W=V.events)||void 0===W?void 0:W[R])?{valid:!0}:(Y.c.Error(`Event with id ${R} not found`),{valid:!1,error:`Event with id ${R} not found`})},extraProcessor(G,V,W,J,R){if("event/receive"!==V.op||!G.configuration||1!==Object.keys(G.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=G.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const k=J.arrays.events[d],z=R[0];return z.config||(z.config={}),z.config.eventId=k.eventId,z.config.eventData=k.eventData,R}},"math/e":fW("FlowGraphEBlock"),"math/pi":fW("FlowGraphPIBlock"),"math/inf":fW("FlowGraphInfBlock"),"math/nan":fW("FlowGraphNaNBlock"),"math/abs":fW("FlowGraphAbsBlock"),"math/sign":fW("FlowGraphSignBlock"),"math/trunc":fW("FlowGraphTruncBlock"),"math/floor":fW("FlowGraphFloorBlock"),"math/ceil":fW("FlowGraphCeilBlock"),"math/round":{EP:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R){var d;return(d=R[0]).config||(d.config={}),R[0].config.roundHalfAwayFromZero=!0,R}},"math/fract":fW("FlowGraphFractBlock"),"math/neg":fW("FlowGraphNegationBlock"),"math/add":fW("FlowGraphAddBlock",["a","b"],!0),"math/sub":fW("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{EP:["FlowGraphMultiplyBlock"],extraProcessor(G,V,W,J,R){var d;(d=R[0]).config||(d.config={}),R[0].config.useMatrixPerComponent=!0,R[0].config.preventIntegerFloatArithmetic=!0;let k=-1;return Object.keys(G.values||{}).find((V=>{var W;return void 0!==(null===(W=G.values)||void 0===W?void 0:W[V].type)&&(k=G.values[V].type,!0)})),-1!==k&&(R[0].config.type=J.arrays.types[k].flowGraphType),R},validation:G=>G.values?vW(G):{valid:!0}},"math/div":fW("FlowGraphDivideBlock",["a","b"],!0),"math/rem":fW("FlowGraphModuloBlock",["a","b"]),"math/min":fW("FlowGraphMinBlock",["a","b"]),"math/max":fW("FlowGraphMaxBlock",["a","b"]),"math/clamp":fW("FlowGraphClampBlock",["a","b","c"]),"math/saturate":fW("FlowGraphSaturateBlock"),"math/mix":fW("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":fW("FlowGraphEqualityBlock",["a","b"]),"math/lt":fW("FlowGraphLessThanBlock",["a","b"]),"math/le":fW("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":fW("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":fW("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":fW("FlowGraphIsNaNBlock"),"math/isinf":fW("FlowGraphIsInfBlock"),"math/select":{EP:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{EP:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":fW("FlowGraphSinBlock"),"math/cos":fW("FlowGraphCosBlock"),"math/tan":fW("FlowGraphTanBlock"),"math/asin":fW("FlowGraphASinBlock"),"math/acos":fW("FlowGraphACosBlock"),"math/atan":fW("FlowGraphATanBlock"),"math/atan2":fW("FlowGraphATan2Block",["a","b"]),"math/sinh":fW("FlowGraphSinhBlock"),"math/cosh":fW("FlowGraphCoshBlock"),"math/tanh":fW("FlowGraphTanhBlock"),"math/asinh":fW("FlowGraphASinhBlock"),"math/acosh":fW("FlowGraphACoshBlock"),"math/atanh":fW("FlowGraphATanhBlock"),"math/exp":fW("FlowGraphExponentialBlock"),"math/log":fW("FlowGraphLogBlock"),"math/log2":fW("FlowGraphLog2Block"),"math/log10":fW("FlowGraphLog10Block"),"math/sqrt":fW("FlowGraphSquareRootBlock"),"math/cbrt":fW("FlowGraphCubeRootBlock"),"math/pow":fW("FlowGraphPowerBlock",["a","b"]),"math/length":fW("FlowGraphLengthBlock"),"math/normalize":fW("FlowGraphNormalizeBlock"),"math/dot":fW("FlowGraphDotBlock",["a","b"]),"math/cross":fW("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":fW("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":fW("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{EP:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{EP:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{EP:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{EP:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{EP:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{EP:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{EP:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":fW("FlowGraphTransposeBlock"),"math/determinant":fW("FlowGraphDeterminantBlock"),"math/inverse":fW("FlowGraphInvertMatrixBlock"),"math/matmul":fW("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{EP:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"vd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R,d){const k=R[0].dataInputs.find((G=>"rotationQuaternion"===G.name));if(!k)throw new Error("Rotation quaternion input not found");return d._connectionValues[k.uniqueId]&&(d._connectionValues[k.uniqueId].type="Quaternion"),R}},"math/matDecompose":{EP:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"vd"}}}},"math/quatConjugate":fW("FlowGraphConjugateBlock",["a"]),"math/quatMul":{EP:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R){var d;return(d=R[0]).config||(d.config={}),R[0].config.type="Quaternion",R}},"math/quatAngleBetween":fW("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{EP:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":fW("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":fW("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{EP:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R){var d;return(d=R[0]).config||(d.config={}),R[0].config.inputIsColumnMajor=!0,R}},"math/extract2x2":{EP:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{EP:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R){var d;return(d=R[0]).config||(d.config={}),R[0].config.inputIsColumnMajor=!0,R}},"math/extract3x3":{EP:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{EP:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R){var d;return(d=R[0]).config||(d.config={}),R[0].config.inputIsColumnMajor=!0,R}},"math/extract4x4":{EP:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{EP:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R,d){var k,z;(z=R[0]).config||(z.config={});const X=R[0].dataInputs[0];return R[0].config.valueType=(null===(k=d._connectionValues[X.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",R}},"math/and":{EP:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R,d){var k,z,X;(X=R[0]).config||(X.config={});const P=R[0].dataInputs[0],A=R[0].dataInputs[1];return R[0].config.valueType=(null===(k=d._connectionValues[P.uniqueId])||void 0===k?void 0:k.type)??(null===(z=d._connectionValues[A.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",R}},"math/or":{EP:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R,d){var k,z,X;(X=R[0]).config||(X.config={});const P=R[0].dataInputs[0],A=R[0].dataInputs[1];return R[0].config.valueType=(null===(k=d._connectionValues[P.uniqueId])||void 0===k?void 0:k.type)??(null===(z=d._connectionValues[A.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",R}},"math/xor":{EP:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,V,W,J,R,d){var k,z,X;(X=R[0]).config||(X.config={});const P=R[0].dataInputs[0],A=R[0].dataInputs[1];return R[0].config.valueType=(null===(k=d._connectionValues[P.uniqueId])||void 0===k?void 0:k.type)??(null===(z=d._connectionValues[A.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",R}},"math/asr":fW("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":fW("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":fW("FlowGraphLeadingZerosBlock"),"math/ctz":fW("FlowGraphTrailingZerosBlock"),"math/popcnt":fW("FlowGraphOneBitsCounterBlock"),"math/rad":fW("FlowGraphDegToRadBlock"),"math/deg":fW("FlowGraphRadToDegBlock"),"type/boolToInt":fW("FlowGraphBooleanToInt"),"type/boolToFloat":fW("FlowGraphBooleanToFloat"),"type/intToBool":fW("FlowGraphIntToBoolean"),"type/intToFloat":fW("FlowGraphIntToFloat"),"type/floatToInt":fW("FlowGraphFloatToInt"),"type/floatToBool":fW("FlowGraphFloatToBoolean"),"flow/sequence":{EP:["FlowGraphSequenceBlock"],extraProcessor(G,V,W,J,R){const d=R[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(G.flows||[]).length,d.signalOutputs.forEach(((G,V)=>{G.name="out_"+V})),R}},"flow/branch":{EP:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{EP:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(G){if(G.configuration&&G.configuration.cases){const V=G.configuration.cases.value;if(!V.every((G=>"number"===typeof G&&/^-?\d+$/.test(G.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),G.configuration.cases.value=[],{valid:!0};const W=new Set(V);G.configuration.cases.value=Array.from(W)}return{valid:!0}},extraProcessor(G,V,W,J,R){if("flow/switch"!==V.op||!G.flows||0===Object.keys(G.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return R[0].signalOutputs.forEach((G=>{"default"!==G.name&&(G.name="out_"+G.name)})),R}},"flow/while":{EP:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{EP:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(G,V,W,J,R){const d=R[0];return d.config||(d.config={}),d.config.incrementIndexWhenLoopDone=!0,R}},"flow/doN":{EP:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{EP:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(G,V,W,J,R){if("flow/multiGate"!==V.op||!G.flows||0===Object.keys(G.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const d=R[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(G.flows).length,d.signalOutputs.forEach(((G,V)=>{G.name="out_"+V})),R}},"flow/waitAll":{EP:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(G){var V,W;return"number"!==typeof(null===(V=G.configuration)||void 0===V||null===(W=V.inputFlows)||void 0===W?void 0:W.value[0])&&(G.configuration=G.configuration||{inputFlows:{value:[0]}},G.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{EP:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{EP:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{EP:["FlowGraphCancelDelayBlock"]},"variable/get":{EP:["FlowGraphGetVariableBlock"],validation(G){var V,W;return null!==(V=G.configuration)&&void 0!==V&&null!==(W=V.variable)&&void 0!==W&&W.value?{valid:!0}:(Y.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(G,V)=>[V.getVariableName(G[0])]}}},"variable/set":{EP:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(G,V)=>[V.getVariableName(G[0])]}}},"variable/setMultiple":{EP:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(G,V)=>[G[0].map((G=>V.getVariableName(G)))]}},extraProcessor:(G,V,W,J,R)=>(R[0].dataInputs.forEach((G=>{G.name=J.getVariableName(+G.name)})),R)},"variable/interpolate":{EP:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(G,V)=>[V.getVariableName(G[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:G=>!0===G[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",YW:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",YW:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",YW:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",YW:"FlowGraphPlayAnimationBlock"},out:{name:"out",YW:"FlowGraphPlayAnimationBlock"},done:{name:"done",YW:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(G,V,W,J,R){var d,k,z;const X=R[0],P=null===(d=G.configuration)||void 0===d?void 0:d.variable.value[0];if("number"!==typeof P)throw Y.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const A=J.arrays.staticVariables[P];"undefined"===typeof X.config.animationType.value&&(J.arrays.staticVariables,X.config.animationType.value=(0,pW.C)(A.type));const x=R[4];return x.config||(x.config={}),(k=x.config).variable||(k.variable={}),x.config.variable.value=J.getVariableName(P),(z=R[3]).config||(z.config={}),R}},"pointer/get":{EP:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",YW:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",YW:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(G,V,W,J,R)=>(R.forEach((G=>{"FlowGraphJsonPointerParserBlock"===G.className&&(G.config||(G.config={}),G.config.outputValue=!0)})),R)},"pointer/set":{EP:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",YW:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",YW:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(G,V,W,J,R)=>(R.forEach((G=>{"FlowGraphJsonPointerParserBlock"===G.className&&(G.config||(G.config={}),G.config.outputValue=!0)})),R)},"pointer/interpolate":{EP:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",YW:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",YW:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",YW:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",YW:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",YW:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",YW:"FlowGraphPlayAnimationBlock"},out:{name:"out",YW:"FlowGraphPlayAnimationBlock"},done:{name:"done",YW:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(G,V,W,J,R)=>(R.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className?(V.config||(V.config={}),V.config.outputValue=!0):"FlowGraphInterpolationBlock"===V.className&&(V.config||(V.config={}),Object.keys(G.values||[]).forEach((W=>{var R;const d=null===(R=G.values)||void 0===R?void 0:R[W];if("value"===W&&d){const G=d.type;void 0!==G&&(V.config.animationType=J.arrays.types[G].flowGraphType)}})))})),R)},"animation/start":{EP:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",YW:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(G,V)=>[G[0]*V._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(G,V)=>[G[0]*V._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(G,V,W,J,R,d,k){const z=R[R.length-1];return z.config||(z.config={}),z.config.glTF=k,R}},"animation/stop":{EP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",YW:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(G,V,W,J,R,d,k){const z=R[R.length-1];return z.config||(z.config={}),z.config.glTF=k,R}},"animation/stopAt":{EP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",YW:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(G,V)=>[G[0]*V._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(G,V,W,J,R,d,k){const z=R[R.length-1];return z.config||(z.config={}),z.config.glTF=k,R}},"math/switch":{EP:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(G){if(G.configuration&&G.configuration.cases){const V=G.configuration.cases.value;if(!V.every((G=>"number"===typeof G&&/^-?\d+$/.test(G.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),G.configuration.cases.value=[],{valid:!0};const W=new Set(V);G.configuration.cases.value=Array.from(W)}return{valid:!0}},extraProcessor(G,V,W,J,R){const d=R[0];return d.dataInputs.forEach((G=>{"default"!==G.name&&"case"!==G.name&&(G.name="in_"+G.name)})),d.config||(d.config={}),d.config.treatCasesAsIntegers=!0,R}},"debug/log":{EP:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function fW(G){let V=arguments.length>2?arguments[2]:void 0;return{EP:[G],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((G,V)=>(G[V]={name:V},G)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(G,W,J,R,d){var k;if(V){(k=d[0]).config||(k.config={}),d[0].config.preventIntegerFloatArithmetic=!0;let V=-1;Object.keys(G.values||{}).find((W=>{var J;return void 0!==(null===(J=G.values)||void 0===J?void 0:J[W].type)&&(V=G.values[W].type,!0)})),-1!==V&&(d[0].config.type=R.arrays.types[V].flowGraphType)}return d},validation:G=>V?vW(G):{valid:!0}}}function vW(G){if(G.values){const V=Object.keys(G.values).map((V=>G.values[V].type)).filter((G=>void 0!==G));if(!V.every((G=>G===V[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}FW["math/compose"]=FW["math/matCompose"],FW["math/decompose"]=FW["math/matDecompose"];var CW=W(11304);const lW={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ed",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class mW{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=G,this._gltf=V,this._animationTargetFps=W,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const G of this._interactivityGraph.types)this._types.push(lW[G.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const G of this._interactivityGraph.declarations){const V=DW(G);if(!V)throw Y.c.Error(["No mapping found for declaration",G]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:V,fullOperationName:G.extension?G.op+":"+G.extension:G.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const G of this._interactivityGraph.variables){const V=this._parseVariable(G);this._staticVariables.push(V)}}_parseVariable(G,V){const W=this._types[G.type];if(!W)throw Y.c.Error(["No type found for variable",G]),new Error("Error parsing variables");if(G.value&&G.value.length!==W.length)throw Y.c.Error(["Invalid value length for variable",G,W]),new Error("Error parsing variables");const J=G.value||[];if(!J.length)switch(W.flowGraphType){case"boolean":J.push(!1);break;case"FlowGraphInteger":J.push(0);break;case"number":J.push(NaN);break;case"Vector2":J.push(NaN,NaN);break;case"ed":J.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":J.fill(NaN,0,4);break;case"Matrix":J.fill(NaN,0,16);break;case"Matrix3D":J.fill(NaN,0,9)}return"number"===W.elementType&&"string"===typeof J[0]&&(J[0]=parseFloat(J[0])),{type:W.flowGraphType,value:V?V(J,this):J}}_parseEvents(){if(this._interactivityGraph.events)for(const G of this._interactivityGraph.events){const V={eventId:G.id||"internalEvent_"+this._internalEventsCounter++};G.values&&(V.eventData=Object.keys(G.values).map((V=>{var W;const J=null===(W=G.values)||void 0===W?void 0:W[V];if(!J)throw Y.c.Error(["No value found for event key",V]),new Error("Error parsing events");const R=this._types[J.type];if(!R)throw Y.c.Error(["No type found for event value",J]),new Error("Error parsing events");const d="undefined"!==typeof J.value?this._parseVariable(J):void 0;return{id:V,type:R.flowGraphType,eventData:!0,value:d}}))),this._events.push(V)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const V of this._interactivityGraph.nodes){if("number"!==typeof V.declaration)throw Y.c.Error(["No declaration found for node",V]),new Error("Error parsing nodes");const W=this._mappings[V.declaration];if(!W)throw Y.c.Error(["No mapping found for node",V]),new Error("Error parsing nodes");if(W.flowGraphMapping.validation){const J=W.flowGraphMapping.validation(V,this._interactivityGraph,this._gltf);var G;if(!J.valid)throw new Error(`Error validating interactivity node ${null===(G=this._interactivityGraph.declarations)||void 0===G?void 0:G[V.declaration].op} - ${J.error}`)}const J=[];for(const G of W.flowGraphMapping.EP){const R=this._getEmptyBlock(G,W.fullOperationName);this._parseNodeConfiguration(V,R,W.flowGraphMapping,G),J.push(R)}this._nodes.push({EP:J,fullOperationName:W.fullOperationName})}}_getEmptyBlock(G,V){return{uniqueId:(0,CW.b)(),className:G,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:V,metadata:{}}}_parseNodeConfiguration(G,V,W,J){const R=V.config;if(G.configuration){const V=Object.keys(G.configuration);for(const z of V){var d,k;const V=null===(d=G.configuration)||void 0===d?void 0:d[z];if(!V)throw Y.c.Error(["No value found for node configuration",z]),new Error("Error parsing node configuration");const X=null===(k=W.configuration)||void 0===k?void 0:k[z];if(X&&X.YW?X.YW===J:0===W.EP.indexOf(J)){const G=(null===X||void 0===X?void 0:X.name)||z;V&&"undefined"!==typeof V.value||"undefined"===typeof(null===X||void 0===X?void 0:X.defaultValue)?V.value.length>=0?R[G]={value:1===V.value.length?V.value[0]:V.value}:Y.c.Warn(["Invalid value for node configuration",V]):R[G]={value:X.defaultValue},X&&X.dataTransformer&&(R[G].value=X.dataTransformer([R[G].value],this)[0])}}}}_parseNodeConnections(G){for(let y=0;y<this._nodes.length;y++){var V;const u=null===(V=this._interactivityGraph.nodes)||void 0===V?void 0:V[y];if(!u)throw Y.c.Error(["No node found for interactivity node",this._nodes[y]]),new Error("Error parsing node connections");const H=this._nodes[y],n=this._mappings[u.declaration];if(!n)throw Y.c.Error(["No mapping found for node",u]),new Error("Error parsing node connections");const D=u.flows||{},i=Object.keys(D).sort();for(const G of i){var W,J,R,d;const V=D[G],P=null===(W=n.flowGraphMapping.outputs)||void 0===W||null===(J=W.flows)||void 0===J?void 0:J[G],A=(null===P||void 0===P?void 0:P.name)||G,x=this._createNewSocketConnection(A,!0);(P&&P.YW&&H.EP.find((G=>G.className===P.YW))||H.EP[0]).signalOutputs.push(x);const q=V.node,L=this._nodes[q];if(!L)throw Y.c.Error(["No node found for input node id",q]),new Error("Error parsing node connections");const t=nW(L.fullOperationName);if(!t)throw Y.c.Error(["No mapping found for input node",L]),new Error("Error parsing node connections");let g=null===(R=t.inputs)||void 0===R||null===(d=R.flows)||void 0===d?void 0:d[V.socket||"in"],B=!1;if(!g)for(const G in null===(k=t.inputs)||void 0===k?void 0:k.flows){var k,z,X;if(G.startsWith("[")&&G.endsWith("]"))B=!0,g=null===(z=t.inputs)||void 0===z||null===(X=z.flows)||void 0===X?void 0:X[G]}const S=g?B?g.name.replace("$1",V.socket||""):g.name:V.socket||"in",p=g&&g.YW&&L.EP.find((G=>G.className===g.YW))||L.EP[0];let b=p.signalInputs.find((G=>G.name===S));b||(b=this._createNewSocketConnection(S),p.signalInputs.push(b)),b.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(b.uniqueId)}const e=u.values||{},F=Object.keys(e);for(const V of F){var P,A;const W=e[V];let J=null===(P=n.flowGraphMapping.inputs)||void 0===P||null===(A=P.values)||void 0===A?void 0:A[V],R=!1;if(!J)for(const G in null===(x=n.flowGraphMapping.inputs)||void 0===x?void 0:x.values){var x,q,L;if(G.startsWith("[")&&G.endsWith("]"))R=!0,J=null===(q=n.flowGraphMapping.inputs)||void 0===q||null===(L=q.values)||void 0===L?void 0:L[G]}const d=J?R?J.name.replace("$1",V):J.name:V,k=this._createNewSocketConnection(d);if((J&&J.YW&&H.EP.find((G=>G.className===J.YW))||H.EP[0]).dataInputs.push(k),void 0!==W.value){const V=this._parseVariable(W,J&&J.dataTransformer);G._connectionValues[k.uniqueId]=V}else{if("undefined"===typeof W.node)throw Y.c.Error(["Invalid value for value connection",W]),new Error("Error parsing node connections");{var t,g,B;const G=W.node,V=W.socket||"value",J=this._nodes[G];if(!J)throw Y.c.Error(["No node found for output socket reference",W]),new Error("Error parsing node connections");const R=nW(J.fullOperationName);if(!R)throw Y.c.Error(["No mapping found for output socket reference",W]),new Error("Error parsing node connections");let d=null===(t=R.outputs)||void 0===t||null===(g=t.values)||void 0===g?void 0:g[V],z=!1;if(!d)for(const W in null===(S=R.outputs)||void 0===S?void 0:S.values){var S,p,b;if(W.startsWith("[")&&W.endsWith("]"))z=!0,d=null===(p=R.outputs)||void 0===p||null===(b=p.values)||void 0===b?void 0:b[W]}const X=d?z?d.name.replace("$1",V):null===(B=d)||void 0===B?void 0:B.name:V,P=d&&d.YW&&J.EP.find((G=>G.className===d.YW))||J.EP[0];let A=P.dataOutputs.find((G=>G.name===X));A||(A=this._createNewSocketConnection(X,!0),P.dataOutputs.push(A)),k.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(k.uniqueId)}}}if(n.flowGraphMapping.interBlockConnectors)for(const G of n.flowGraphMapping.interBlockConnectors){const V=G.input,W=G.output,J=G.isVariable;this._connectFlowGraphNodes(V,W,H.EP[G.inputBlockIndex],H.EP[G.outputBlockIndex],J)}if(n.flowGraphMapping.extraProcessor){var r;const V=null===(r=this._interactivityGraph.declarations)||void 0===r?void 0:r[u.declaration];if(!V)throw Y.c.Error(["No declaration found for extra processor",u]),new Error("Error parsing node connections");H.EP=n.flowGraphMapping.extraProcessor(u,V,n.flowGraphMapping,this,H.EP,G,this._gltf)}}}_createNewSocketConnection(G,V){return{uniqueId:(0,CW.b)(),name:G,_connectionType:V?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(G,V,W,J,R){const d=R?W.dataInputs:W.signalInputs,k=R?J.dataOutputs:J.signalOutputs,z=d.find((V=>V.name===G))||this._createNewSocketConnection(G),X=k.find((G=>G.name===V))||this._createNewSocketConnection(V,!0);d.find((V=>V.name===G))||d.push(z),k.find((G=>G.name===V))||k.push(X),z.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(z.uniqueId)}getVariableName(G){return"staticVariable_"+G}serializeToFlowGraph(){const G={uniqueId:(0,CW.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(G);for(let V=0;V<this._staticVariables.length;V++){const W=this._staticVariables[V];G._userVariables[this.getVariableName(V)]=W}return{rightHanded:!0,allBlocks:this._nodes.reduce(((G,V)=>G.concat(V.EP)),[]),executionContexts:[G]}}}const wW="KHR_interactivity";class NW{constructor(G){this._loader=G,this.name=wW,this.enabled=this._loader.isExtensionUsed(wW),this._pathConverter=(0,U.h)(this._loader.sd),G._skipStartAnimationStep=!0;const V=G.babylonScene;V&&function(G){(0,U.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!G.activeCamera)return new R.g(NaN,NaN,NaN,NaN);const V=R.g.FromRotationMatrix(G.activeCamera.getWorldMatrix()).normalize();return G.useRightHandedSystem||(V.w*=-1,V.x*=-1),V},type:"Quaternion",getTarget:()=>G.activeCamera}),(0,U.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!G.activeCamera)return new R.o(NaN,NaN,NaN);const V=G.activeCamera.getWorldMatrix().getTranslation();return G.useRightHandedSystem||(V.x*=-1),V},type:"ed",getTarget:()=>G.activeCamera}),(0,U.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:G=>{var V;return(null===(V=G._babylonAnimationGroup)||void 0===V?void 0:V.isPlaying)??!1},type:"boolean",getTarget:G=>G._babylonAnimationGroup}),(0,U.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:G=>{var V;return((null===(V=G._babylonAnimationGroup)||void 0===V?void 0:V.from)??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup}),(0,U.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:G=>{var V;return((null===(V=G._babylonAnimationGroup)||void 0===V?void 0:V.to)??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup}),(0,U.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:G=>{var V;return((null===(V=G._babylonAnimationGroup)||void 0===V?void 0:V.getCurrentFrame())??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup}),(0,U.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:G=>{var V;return((null===(V=G._babylonAnimationGroup)||void 0===V?void 0:V.getCurrentFrame())??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup})}(V)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var G;if(!this._loader.babylonScene||!this._pathConverter)return;const V=this._loader.babylonScene,W=null===(G=this._loader.sd.extensions)||void 0===G?void 0:G.KHR_interactivity;if(!W)return;const J=new tW.c({tV:V});J.dispatchEventsSynchronously=!1;const R=W.graphs.map((G=>new mW(G,this._loader.sd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(R.map((async G=>await yW(G,{coordinator:J,pathConverter:this._pathConverter})))),J.start()}}var UW;UW=async()=>(await Promise.resolve().then(W.bind(W,13124))).FlowGraphGLTFDataProvider,YW[`${wW}/${"FlowGraphGLTFDataProvider"}`]=UW,N(wW),w(wW,!0,(G=>new NW(G)));const aW="KHR_node_visibility";(0,U.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:G=>{const V=G._babylonTransformNode;return!V||void 0===V.isVisible||V.isVisible},set:(G,V)=>{var W,J;null===(W=V._primitiveBabylonMeshes)||void 0===W||W.forEach((G=>{G.inheritVisibility=!0})),V._babylonTransformNode&&(V._babylonTransformNode.isVisible=G),null===(J=V._primitiveBabylonMeshes)||void 0===J||J.forEach((V=>{V.isVisible=G}))},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class MW{constructor(G){this.name=aW,this._loader=G,this.enabled=G.isExtensionUsed(aW)}async onReady(){var G;null===(G=this._loader.sd.nodes)||void 0===G||G.forEach((G=>{var V,W,J,R;(null===(V=G._primitiveBabylonMeshes)||void 0===V||V.forEach((G=>{G.inheritVisibility=!0})),null!==(W=G.extensions)&&void 0!==W&&W.KHR_node_visibility)&&(!1===(null===(J=G.extensions)||void 0===J?void 0:J.KHR_node_visibility.visible)&&(G._babylonTransformNode&&(G._babylonTransformNode.isVisible=!1),null===(R=G._primitiveBabylonMeshes)||void 0===R||R.forEach((G=>{G.isVisible=!1}))))}))}dispose(){this._loader=null}}N(aW),w(aW,!0,(G=>new MW(G)));const TW="KHR_node_selectability";iW("event/onSelect",TW,{EP:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",YW:"FlowGraphGetVariableBlock",dataTransformer:G=>["pickedMesh_"+G[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",YW:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(G,V,W,J,R,d,k){var z,X,P,A,x,q;const L=R[R.length-1];L.config=L.config||{},L.config.glTF=k;const t=null===(z=G.configuration)||void 0===z||null===(X=z.nodeIndex)||void 0===X?void 0:X.value[0];if(void 0===t||"number"!==typeof t)throw new Error("nodeIndex not found in configuration");const Y="pickedMesh_"+t;return R[1].config.variable=Y,d._userVariables[Y]={className:"Mesh",id:null===k||void 0===k||null===(P=k.nodes)||void 0===P||null===(A=P[t]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===k||void 0===k||null===(x=k.nodes)||void 0===x||null===(q=x[t]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},R}}),(0,U.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:G=>{const V=G._babylonTransformNode;return!V||void 0===V.bX||V.bX},set:(G,V)=>{var W;null===(W=V._primitiveBabylonMeshes)||void 0===W||W.forEach((V=>{V.bX=G}))},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"bX"],type:"boolean"});class KW{constructor(G){this.name=TW,this._loader=G,this.enabled=G.isExtensionUsed(TW)}async onReady(){var G;null===(G=this._loader.sd.nodes)||void 0===G||G.forEach((G=>{var V,W,J;null!==(V=G.extensions)&&void 0!==V&&V.KHR_node_selectability&&!1===(null===(W=G.extensions)||void 0===W?void 0:W.KHR_node_selectability.selectable)&&(null===(J=G._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((G=>{G.bX=!1})))}))}dispose(){this._loader=null}}N(TW),w(TW,!0,(G=>new KW(G)));const sW="KHR_node_hoverability",QW="targetMeshPointerOver_";iW("event/onHoverIn",sW,{EP:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",YW:"FlowGraphGetVariableBlock",dataTransformer:G=>[QW+G[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",YW:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(G,V,W,J,R,d,k){var z,X,P,A,x,q;const L=R[R.length-1];L.config=L.config||{},L.config.glTF=k;const t=null===(z=G.configuration)||void 0===z||null===(X=z.nodeIndex)||void 0===X?void 0:X.value[0];if(void 0===t||"number"!==typeof t)throw new Error("nodeIndex not found in configuration");const Y=QW+t;return R[1].config.variable=Y,d._userVariables[Y]={className:"Mesh",id:null===k||void 0===k||null===(P=k.nodes)||void 0===P||null===(A=P[t]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===k||void 0===k||null===(x=k.nodes)||void 0===x||null===(q=x[t]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},R}});const ZW="targetMeshPointerOut_";iW("event/onHoverOut",sW,{EP:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",YW:"FlowGraphGetVariableBlock",dataTransformer:G=>[ZW+G[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",YW:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(G,V,W,J,R,d,k){var z,X,P,A,x,q;const L=R[R.length-1];L.config=L.config||{},L.config.glTF=k;const t=null===(z=G.configuration)||void 0===z||null===(X=z.nodeIndex)||void 0===X?void 0:X.value[0];if(void 0===t||"number"!==typeof t)throw new Error("nodeIndex not found in configuration");const Y=ZW+t;return R[1].config.variable=Y,d._userVariables[Y]={className:"Mesh",id:null===k||void 0===k||null===(P=k.nodes)||void 0===P||null===(A=P[t]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===k||void 0===k||null===(x=k.nodes)||void 0===x||null===(q=x[t]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},R}}),(0,U.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:G=>{const V=G._babylonTransformNode;return!V||void 0===V.pointerOverDisableMeshTesting||V.pointerOverDisableMeshTesting},set:(G,V)=>{var W;null===(W=V._primitiveBabylonMeshes)||void 0===W||W.forEach((V=>{V.pointerOverDisableMeshTesting=!G}))},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class EW{constructor(G){this.name=sW,this._loader=G,this.enabled=G.isExtensionUsed(sW)}async onReady(){var G;null===(G=this._loader.sd.nodes)||void 0===G||G.forEach((G=>{var V,W,J;null!==(V=G.extensions)&&void 0!==V&&V.KHR_node_hoverability&&!1===(null===(W=G.extensions)||void 0===W?void 0:W.KHR_node_hoverability.hoverable)&&(null===(J=G._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((G=>{G.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}N(sW),w(sW,!0,(G=>new EW(G)));const hW="ExtrasAsMetadata";class oW{_assignExtras(G,V){if(V.extras&&Object.keys(V.extras).length>0){const W=G.metadata=G.metadata||{};(W.sd=W.sd||{}).extras=V.extras}}constructor(G){this.name=hW,this.enabled=!0,this._loader=G}dispose(){this._loader=null}loadNodeAsync(G,V,W){return this._loader.loadNodeAsync(G,V,(G=>{this._assignExtras(G,V),W(G)}))}loadCameraAsync(G,V,W){return this._loader.loadCameraAsync(G,V,(G=>{this._assignExtras(G,V),W(G)}))}createMaterial(G,V,W){const J=this._loader.createMaterial(G,V,W);return this._assignExtras(J,V),J}}N(hW),w(hW,!1,(G=>new oW(G)));W(13124)},12995:(G,V,W)=>{"use strict";W.d(V,{e:()=>v,f:()=>n,j:()=>H,n:()=>D});var J=W(11176),R=W(11189),d=W(12643),k=W(11510),z=W(11457),X=W(11473),P=W(11201),A=W(11169),x=W(11501),q=W(11868),L=W(11516),t=W(11416);class Y{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.mx=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Sq=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(G){this._environmentTexture=G}getNodes(){let G=[];G=G.concat(this.meshes),G=G.concat(this.lights),G=G.concat(this.cameras),G=G.concat(this.transformNodes);for(const V of this.skeletons)G=G.concat(V.bones);return G}}class g extends Y{}class B{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const G=this.rootNodes;for(const J of G)J.dispose();G.length=0;const V=this.skeletons;for(const J of V)J.dispose();V.length=0;const W=this.animationGroups;for(const J of W)J.dispose();W.length=0}}class S extends Y{constructor(G){super(),this._wasAddedToScene=!1,(G=G||A.c.LastCreatedScene)&&(this.tV=G,this.proceduralTextures=[],G.Md.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=G.getEngine().onContextRestoredObservable.add((()=>{for(const G of this.geometries)G._rebuild();for(const G of this.meshes)G._rebuild();for(const G of this.mx)G.rebuild();for(const G of this.textures)G._rebuild()})))}_topologicalSort(G){const V=new Map;for(const k of G)V.set(k.uniqueId,k);const W={dependsOn:new Map,dependedBy:new Map};for(const k of G){const G=k.uniqueId;W.dependsOn.set(G,new Set),W.dependedBy.set(G,new Set)}for(const k of G){const G=k.uniqueId,J=W.dependsOn.get(G);if(k instanceof x.c){const R=k.sourceMesh;V.has(R.uniqueId)&&(J.add(R.uniqueId),W.dependedBy.get(R.uniqueId).add(G))}const R=W.dependedBy.get(G);for(const d of k.getDescendants()){const J=d.uniqueId;if(V.has(J)){R.add(J);W.dependsOn.get(J).add(G)}}}const J=[],R=[];for(const k of G){const G=k.uniqueId;0===W.dependsOn.get(G).size&&(R.push(k),V.delete(G))}const d=R;for(;d.length>0;){const G=d.shift();J.push(G);const R=W.dependedBy.get(G.uniqueId);for(const J of Array.from(R.values())){const R=W.dependsOn.get(J);R.delete(G.uniqueId),0===R.size&&V.get(J)&&(d.push(V.get(J)),V.delete(J))}}return V.size>0&&(P.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),V.forEach((G=>{P.c.Error(G.name)}))),J}_addNodeAndDescendantsToList(G,V,W,J){if(W&&(!J||J(W))&&!V.has(W.uniqueId)){G.push(W),V.add(W.uniqueId);for(const R of W.getDescendants(!0))this._addNodeAndDescendantsToList(G,V,R,J)}}_isNodeInContainer(G){return G instanceof X.b&&-1!==this.meshes.indexOf(G)||(G instanceof z.b&&-1!==this.transformNodes.indexOf(G)||(G instanceof q.e&&-1!==this.lights.indexOf(G)||G instanceof L.c&&-1!==this.cameras.indexOf(G)))}_isValidHierarchy(){for(const G of this.meshes)if(G.parent&&!this._isNodeInContainer(G.parent))return P.c.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.transformNodes)if(G.parent&&!this._isNodeInContainer(G.parent))return P.c.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.lights)if(G.parent&&!this._isNodeInContainer(G.parent))return P.c.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.cameras)if(G.parent&&!this._isNodeInContainer(G.parent))return P.c.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||R.h.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const J={},d={},z=new B,X=[],P=[],A={doNotInstantiate:!0,...W},x=[],q=new Set;for(const R of this.transformNodes)null===R.parent&&this._addNodeAndDescendantsToList(x,q,R,A.predicate);for(const R of this.meshes)null===R.parent&&this._addNodeAndDescendantsToList(x,q,R,A.predicate);const L=this._topologicalSort(x),t=(W,R)=>{if(((V,W)=>{if(J[V.uniqueId]=W.uniqueId,d[W.uniqueId]=W,G&&(W.name=G(V.name)),W instanceof k.b){const G=W;if(G.morphTargetManager){const W=V.morphTargetManager;G.morphTargetManager=W.clone();for(let V=0;V<W.numTargets;V++){const R=W.getTarget(V),k=G.morphTargetManager.getTarget(V);J[R.uniqueId]=k.uniqueId,d[k.uniqueId]=k}}}})(W,R),W.parent){const G=J[W.parent.uniqueId],V=d[G];R.parent=V||W.parent}if(R.position&&W.position&&R.position.J(W.position),R.rotationQuaternion&&W.rotationQuaternion&&R.rotationQuaternion.J(W.rotationQuaternion),R.rotation&&W.rotation&&R.rotation.J(W.rotation),R.vd&&W.vd&&R.vd.J(W.vd),R.material){const k=R;if(k.material)if(V){const V=W.material;if(-1===P.indexOf(V)){let W=V.clone(G?G(V.name):"Clone of "+V.name);if(P.push(V),J[V.uniqueId]=W.uniqueId,d[W.uniqueId]=W,"MultiMaterial"===V.getClassName()){const R=V;for(const V of R.od)V&&(W=V.clone(G?G(V.name):"Clone of "+V.name),P.push(V),J[V.uniqueId]=W.uniqueId,d[W.uniqueId]=W);R.od=R.od.map((G=>G&&d[J[G.uniqueId]]))}}"InstancedMesh"!==k.getClassName()&&(k.material=d[J[V.uniqueId]])}else"MultiMaterial"===k.material.getClassName()?-1===this.tV.multiMaterials.indexOf(k.material)&&this.tV.addMultiMaterial(k.material):-1===this.tV.materials.indexOf(k.material)&&this.tV.addMaterial(k.material)}null===R.parent&&z.rootNodes.push(R)};for(const R of L)if("InstancedMesh"===R.getClassName()){const G=R,V=G.sourceMesh,W=J[V.uniqueId];t(G,("number"===typeof W?d[W]:V).createInstance(G.name))}else{let G=!0;"dX"===R.getClassName()||"Node"===R.getClassName()||R.skeleton||!R.getTotalVertices||0===R.getTotalVertices()?G=!1:A.doNotInstantiate&&(G="function"===typeof A.doNotInstantiate?!A.doNotInstantiate(R):!A.doNotInstantiate);const V=G?R.createInstance(`instance of ${R.name}`):R.clone(`Clone of ${R.name}`,null,!0);if(!V)throw new Error(`Could not clone or instantiate node on Asset Container ${R.name}`);t(R,V)}for(const R of this.skeletons){if(A.predicate&&!A.predicate(R))continue;const V=R.clone(G?G(R.name):"Clone of "+R.name);for(const G of this.meshes)if(G.skeleton===R&&!G.isAnInstance){const W=d[J[G.uniqueId]];if(!W||W.isAnInstance)continue;if(W.skeleton=V,-1!==X.indexOf(V))continue;X.push(V);for(const G of V.bones)G._linkedTransformNode&&(G._linkedTransformNode=d[J[G._linkedTransformNode.uniqueId]])}z.skeletons.push(V)}for(const R of this.animationGroups){if(A.predicate&&!A.predicate(R))continue;const V=R.clone(G?G(R.name):"Clone of "+R.name,(G=>d[J[G.uniqueId]]||G));z.animationGroups.push(V)}return z}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||R.h.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.tV.environmentTexture=this.environmentTexture);for(const G of this.tV._serializableComponents)G.addFromContainer(this);this.tV.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const V=[];for(const W of this.cameras)G&&!G(W)||(this.tV.addCamera(W),V.push(W));for(const W of this.lights)G&&!G(W)||(this.tV.addLight(W),V.push(W));for(const W of this.meshes)G&&!G(W)||(this.tV.CP(W),V.push(W));for(const W of this.skeletons)G&&!G(W)||this.tV.addSkeleton(W);for(const W of this.animations)G&&!G(W)||this.tV.addAnimation(W);for(const W of this.animationGroups)G&&!G(W)||this.tV.addAnimationGroup(W);for(const W of this.multiMaterials)G&&!G(W)||this.tV.addMultiMaterial(W);for(const W of this.materials)G&&!G(W)||this.tV.addMaterial(W);for(const W of this.morphTargetManagers)G&&!G(W)||this.tV.addMorphTargetManager(W);for(const W of this.geometries)G&&!G(W)||this.tV.addGeometry(W);for(const W of this.transformNodes)G&&!G(W)||(this.tV.addTransformNode(W),V.push(W));for(const W of this.actionManagers)G&&!G(W)||this.tV.addActionManager(W);for(const W of this.textures)G&&!G(W)||this.tV.addTexture(W);for(const W of this.reflectionProbes)G&&!G(W)||this.tV.addReflectionProbe(W);for(const W of V)W.parent&&-1===this.tV.getNodes().indexOf(W.parent)&&(W.setParent?W.setParent(null):W.parent=null)}removeAllFromScene(){this._isValidHierarchy()||R.h.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.tV.environmentTexture&&(this.tV.environmentTexture=null);for(const G of this.tV._serializableComponents)G.removeFromContainer(this)}removeFromScene(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const V of this.cameras)G&&!G(V)||this.tV.removeCamera(V);for(const V of this.lights)G&&!G(V)||this.tV.removeLight(V);for(const V of this.meshes)G&&!G(V)||this.tV.vP(V,!0);for(const V of this.skeletons)G&&!G(V)||this.tV.removeSkeleton(V);for(const V of this.animations)G&&!G(V)||this.tV.removeAnimation(V);for(const V of this.animationGroups)G&&!G(V)||this.tV.removeAnimationGroup(V);for(const V of this.multiMaterials)G&&!G(V)||this.tV.removeMultiMaterial(V);for(const V of this.materials)G&&!G(V)||this.tV.removeMaterial(V);for(const V of this.morphTargetManagers)G&&!G(V)||this.tV.removeMorphTargetManager(V);for(const V of this.geometries)G&&!G(V)||this.tV.removeGeometry(V);for(const V of this.transformNodes)G&&!G(V)||this.tV.removeTransformNode(V);for(const V of this.actionManagers)G&&!G(V)||this.tV.removeActionManager(V);for(const V of this.textures)G&&!G(V)||this.tV.removeTexture(V);for(const V of this.reflectionProbes)G&&!G(V)||this.tV.removeReflectionProbe(V)}dispose(){const G=this.cameras.slice(0);for(const L of G)L.dispose();this.cameras.length=0;const V=this.lights.slice(0);for(const L of V)L.dispose();this.lights.length=0;const W=this.meshes.slice(0);for(const L of W)L.dispose();this.meshes.length=0;const J=this.skeletons.slice(0);for(const L of J)L.dispose();this.skeletons.length=0;const R=this.animationGroups.slice(0);for(const L of R)L.dispose();this.animationGroups.length=0;const d=this.multiMaterials.slice(0);for(const L of d)L.dispose();this.multiMaterials.length=0;const k=this.materials.slice(0);for(const L of k)L.dispose();this.materials.length=0;const z=this.geometries.slice(0);for(const L of z)L.dispose();this.geometries.length=0;const X=this.transformNodes.slice(0);for(const L of X)L.dispose();this.transformNodes.length=0;const P=this.actionManagers.slice(0);for(const L of P)L.dispose();this.actionManagers.length=0;const A=this.textures.slice(0);for(const L of A)L.dispose();this.textures.length=0;const x=this.reflectionProbes.slice(0);for(const L of x)L.dispose();this.reflectionProbes.length=0;const q=this.morphTargetManagers.slice(0);for(const L of q)L.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const L of this.tV._serializableComponents)L.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.tV.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(G,V,W){if(G&&V)for(const J of G){let G=!0;if(W)for(const V of W)if(J===V){G=!1;break}G&&(V.push(J),J._parentContainer=this)}}moveAllFromScene(G){this._wasAddedToScene=!1,void 0===G&&(G=new g);for(const V in this)Object.prototype.hasOwnProperty.call(this,V)&&(this[V]=this[V]||("_environmentTexture"===V?null:[]),this._moveAssets(this.tV[V],this[V],G[V]));this.environmentTexture=this.tV.environmentTexture,this.removeAllFromScene()}createRootMesh(){const G=new k.b("assetContainerRootMesh",this.tV);for(const V of this.meshes)V.parent||G.addChild(V);return this.meshes.unshift(G),G}mergeAnimationsTo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.c.LastCreatedScene,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!G)return P.c.Error("No scene available to merge animations to"),[];const J=W||(V=>{let W=null;const J=V.animations.length?V.animations[0].targetProperty:"",R=V.name.split(".").join("").split("_primitive")[0];switch(J){case"position":case"rotationQuaternion":W=G.getTransformNodeByName(V.name)||G.getTransformNodeByName(R);break;case"influence":W=G.getMorphTargetByName(V.name)||G.getMorphTargetByName(R);break;default:W=G.getNodeByName(V.name)||G.getNodeByName(R)}return W}),R=this.getNodes();for(const z of R){const G=J(z);if(null!==G){for(const V of z.animations){const W=G.animations.filter((G=>G.targetProperty===V.targetProperty));for(const V of W){const W=G.animations.indexOf(V,0);W>-1&&G.animations.splice(W,1)}}G.animations=G.animations.concat(z.animations)}}const d=[],k=this.animationGroups.slice();for(const z of k){d.push(z.clone(z.name,J));for(const G of z.animatables)G.stop()}for(const z of V){const V=J(z.target);V&&(G.beginAnimation(V,z.fromFrame,z.toFrame,z.loopAnimation,z.speedRatio,z.onAnimationEnd?z.onAnimationEnd:void 0,void 0,!0,void 0,z.onAnimationLoop?z.onAnimationLoop:void 0),G.stopAnimation(z.target))}return d}populateRootNodes(){this.rootNodes.length=0;for(const G of this.meshes)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G);for(const G of this.transformNodes)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G);for(const G of this.lights)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G);for(const G of this.cameras)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G)}addAllAssetsToContainer(G){if(!G)return;const V=[],W=new Set;for(V.push(G);V.length>0;){const G=V.pop();if(G instanceof k.b?(G.zd&&-1===this.geometries.indexOf(G.zd)&&this.geometries.push(G.zd),this.meshes.push(G)):G instanceof x.c?this.meshes.push(G):G instanceof z.b?this.transformNodes.push(G):G instanceof q.e?this.lights.push(G):G instanceof L.c&&this.cameras.push(G),G instanceof X.b){if(G.material&&-1===this.materials.indexOf(G.material)){this.materials.push(G.material);for(const V of G.material.getActiveTextures())-1===this.textures.indexOf(V)&&this.textures.push(V)}G.skeleton&&-1===this.skeletons.indexOf(G.skeleton)&&this.skeletons.push(G.skeleton),G.morphTargetManager&&-1===this.morphTargetManagers.indexOf(G.morphTargetManager)&&this.morphTargetManagers.push(G.morphTargetManager)}for(const J of G.getChildren())W.has(J)||V.push(J);W.add(G)}this.populateRootNodes()}_getByTags(G,V,W){if(void 0===V)return G;const J=[];for(const R in G){const d=G[R];t.c&&t.c.MatchesQuery(d,V)&&(!W||W(d))&&J.push(d)}return J}getMeshesByTags(G,V){return this._getByTags(this.meshes,G,V)}getCamerasByTags(G,V){return this._getByTags(this.cameras,G,V)}getLightsByTags(G,V){return this._getByTags(this.lights,G,V)}getMaterialsByTags(G,V){return this._getByTags(this.materials,G,V).concat(this._getByTags(this.multiMaterials,G,V))}getTransformNodesByTags(G,V){return this._getByTags(this.transformNodes,G,V)}}var p=W(11236);class b{constructor(G){this.byteOffset=0,this.buffer=G}async loadAsync(G){const V=await this.buffer.readAsync(this.byteOffset,G);this._dataView=new DataView(V.buffer,V.byteOffset,V.byteLength),this._dataByteOffset=0}readUint32(){const G=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,G}readUint8Array(G){const V=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,G);return this._dataByteOffset+=G,this.byteOffset+=G,V}readString(G){return(0,p.j)(this.readUint8Array(G))}skipBytes(G){this._dataByteOffset+=G,this.byteOffset+=G}}var r=W(12999);const y="Z2xURg",u={name:"sd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:G=>-1!==G.indexOf("asset")&&-1!==G.indexOf("version")||G.startsWith("data:base64,"+y)||G.startsWith("data:;base64,"+y)||G.startsWith("data:application/octet-stream;base64,"+y)||G.startsWith("data:model/gltf-binary;base64,"+y)};var H,n,D,i=W(11227),e=W(11234);function F(G,V,W){try{return Promise.resolve(new Uint8Array(G,V,W))}catch(J){return Promise.reject(J)}}!function(G){G[G.AUTO=0]="AUTO",G[G.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(H||(H={})),function(G){G[G.NONE=0]="NONE",G[G.FIRST=1]="FIRST",G[G.ALL=2]="ALL"}(n||(n={})),function(G){G[G.LOADING=0]="LOADING",G[G.READY=1]="READY",G[G.COMPLETE=2]="COMPLETE"}(D||(D={}));class f{constructor(){this.coordinateSystemMode=H.AUTO,this.animationStartMode=n.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=G=>Promise.resolve(G),this.extensionOptions={}}J(G){G&&(this.onParsed=G.onParsed,this.coordinateSystemMode=G.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=G.animationStartMode??this.animationStartMode,this.loadNodeAnimations=G.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=G.loadSkins??this.loadSkins,this.loadMorphTargets=G.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=G.compileMaterials??this.compileMaterials,this.useClipPlane=G.useClipPlane??this.useClipPlane,this.compileShadowGenerators=G.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=G.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=G.useRangeRequests??this.useRangeRequests,this.createInstances=G.createInstances??this.createInstances,this.alwaysComputeBoundingBox=G.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=G.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=G.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=G.skipMaterials??this.skipMaterials,this.useSRGBBuffers=G.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=G.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=G.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=G.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=G.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=G.customRootNode,this.onMeshLoaded=G.onMeshLoaded,this.onSkinLoaded=G.onSkinLoaded,this.onTextureLoaded=G.onTextureLoaded,this.onMaterialLoaded=G.onMaterialLoaded,this.onCameraLoaded=G.onCameraLoaded,this.extensionOptions=G.extensionOptions??this.extensionOptions)}}class v extends f{constructor(G){super(),this.onParsedObservable=new J.b,this.onMeshLoadedObservable=new J.b,this.onSkinLoadedObservable=new J.b,this.onTextureLoadedObservable=new J.b,this.onMaterialLoadedObservable=new J.b,this.onCameraLoadedObservable=new J.b,this.onCompleteObservable=new J.b,this.onErrorObservable=new J.b,this.Md=new J.b,this.onExtensionLoadedObservable=new J.b,this.validate=!1,this.onValidatedObservable=new J.b,this._loader=null,this._state=null,this._requests=new Array,this.name=u.name,this.extensions=u.extensions,this.onLoaderStateChangedObservable=new J.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.J(G)}set onParsed(G){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),G&&(this._onParsedObserver=this.onParsedObservable.add(G))}set onMeshLoaded(G){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),G&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(G))}set onSkinLoaded(G){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),G&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((V=>G(V.node,V.skinnedNode))))}set onTextureLoaded(G){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),G&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(G))}set onMaterialLoaded(G){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),G&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(G))}set onCameraLoaded(G){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),G&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(G))}set onComplete(G){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(G)}set onError(G){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(G)}set onDispose(G){this._onDisposeObserver&&this.Md.remove(this._onDisposeObserver),this._onDisposeObserver=this.Md.add(G)}set onExtensionLoaded(G){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(G)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(G){this._loggingEnabled!==G&&(this._loggingEnabled=G,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(G){this._capturePerformanceCounters!==G&&(this._capturePerformanceCounters=G,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(G){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(G)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const G of this._requests)G.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=G=>Promise.resolve(G),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Md.notifyObservers(void 0),this.Md.clear()}loadFile(G,V,W,d,k,z,X,A){if(ArrayBuffer.isView(V))return this._loadBinary(G,V,W,d,X,A),null;this._progressCallback=k;const x=V.name||R.h.GetFilename(V);if(z){if(this.useRangeRequests){this.validate&&P.c.Warn("glTF validation is not supported when range requests are enabled");const W={abort:()=>{},onCompleteObservable:new J.b},R={readAsync:(W,J)=>new Promise(((R,d)=>{this._loadFile(G,V,(G=>{R(new Uint8Array(G))}),!0,(G=>{d(G)}),(G=>{G.setRequestHeader("Range",`bytes=${W}-${W+J-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new b(R)).then((G=>{W.onCompleteObservable.notifyObservers(W),d(G)}),X?G=>X(void 0,G):void 0),W}return this._loadFile(G,V,(V=>{this._validate(G,new Uint8Array(V,0,V.byteLength),W,x),this._unpackBinaryAsync(new b({readAsync:(G,W)=>F(V,G,W),byteLength:V.byteLength})).then((G=>{d(G)}),X?G=>X(void 0,G):void 0)}),!0,X)}return this._loadFile(G,V,(V=>{try{this._validate(G,V,W,x),d({json:this._parseJson(V)})}catch{X&&X()}}),!1,X)}_loadBinary(G,V,W,J,R,d){this._validate(G,new Uint8Array(V.buffer,V.byteOffset,V.byteLength),W,d),this._unpackBinaryAsync(new b({readAsync:(G,W)=>function(G,V,W){try{if(V<0||V>=G.byteLength)throw new RangeError("Offset is out of range.");if(V+W>G.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(G.buffer,G.byteOffset+V,W))}catch(J){return Promise.reject(J)}}(V,G,W),byteLength:V.byteLength})).then((G=>{J(G)}),R?G=>R(void 0,G):void 0)}importMeshAsync(G,V,W,J,R,d){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(W),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(W),this._loader.importMeshAsync(G,V,null,W,J,R,d))))}loadAsync(G,V,W,J,R){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${R||""}`),this._loader=this._getLoader(V),this._loader.loadAsync(G,V,W,J,R))))}loadAssetContainerAsync(G,V,W,J,R){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${R||""}`),this._loader=this._getLoader(V);const d=new S(G),k=[];this.onMaterialLoadedObservable.add((G=>{k.push(G)}));const z=[];this.onTextureLoadedObservable.add((G=>{z.push(G)}));const X=[];this.onCameraLoadedObservable.add((G=>{X.push(G)}));const P=[];return this.onMeshLoadedObservable.add((G=>{G.morphTargetManager&&P.push(G.morphTargetManager)})),this._loader.importMeshAsync(null,G,d,V,W,J,R).then((G=>(Array.prototype.push.apply(d.geometries,G.geometries),Array.prototype.push.apply(d.meshes,G.meshes),Array.prototype.push.apply(d.mx,G.mx),Array.prototype.push.apply(d.skeletons,G.skeletons),Array.prototype.push.apply(d.animationGroups,G.animationGroups),Array.prototype.push.apply(d.materials,k),Array.prototype.push.apply(d.textures,z),Array.prototype.push.apply(d.lights,G.lights),Array.prototype.push.apply(d.transformNodes,G.transformNodes),Array.prototype.push.apply(d.cameras,X),Array.prototype.push.apply(d.morphTargetManagers,P),d)))}))}canDirectLoad(G){return u.canDirectLoad(G)}directLoad(G,V){if(V.startsWith("base64,"+y)||V.startsWith(";base64,"+y)||V.startsWith("application/octet-stream;base64,"+y)||V.startsWith("model/gltf-binary;base64,"+y)){const W=(0,i.e)(V);return this._validate(G,new Uint8Array(W,0,W.byteLength)),this._unpackBinaryAsync(new b({readAsync:(G,V)=>F(W,G,V),byteLength:W.byteLength}))}return this._validate(G,V),Promise.resolve({json:this._parseJson(V)})}createPlugin(G){return new v(G[u.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((G,V)=>{this.onCompleteObservable.addOnce((()=>{G()})),this.onErrorObservable.addOnce((G=>{V(G)}))}))}_setState(G){this._state!==G&&(this._state=G,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(D[this._state]))}_loadFile(G,V,W,J,R,d){const k=G._loadFile(V,W,(G=>{this._onProgress(G,k)}),!0,J,R,d);return k.onCompleteObservable.add((()=>{k._lengthComputable=!0,k._total=k._loaded})),this._requests.push(k),k}_onProgress(G,V){if(!this._progressCallback)return;V._lengthComputable=G.lengthComputable,V._loaded=G.loaded,V._total=G.total;let W=!0,J=0,R=0;for(const d of this._requests){if(void 0===d._lengthComputable||void 0===d._loaded||void 0===d._total)return;W=W&&d._lengthComputable,J+=d._loaded,R+=d._total}this._progressCallback({lengthComputable:W,loaded:J,total:W?R:0})}_validate(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),r.d.ValidateAsync(V,W,J,(V=>this.preprocessUrlAsync(W+V).then((V=>G._loadFileAsync(V,void 0,!0,!0).then((G=>new Uint8Array(G,0,G.byteLength))))))).then((G=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(G),this.onValidatedObservable.clear()}),(G=>{this._endPerformanceCounter("Validate JSON"),R.h.Warn(`Failed to validate: ${G.message}`),this.onValidatedObservable.clear()})))}_getLoader(G){const V=G.json.asset||{};this._log(`Asset version: ${V.version}`),V.minVersion&&this._log(`Asset minimum version: ${V.minVersion}`),V.generator&&this._log(`Asset generator: ${V.generator}`);const W=v._parseVersion(V.version);if(!W)throw new Error("Invalid version: "+V.version);if(void 0!==V.minVersion){const G=v._parseVersion(V.minVersion);if(!G)throw new Error("Invalid minimum version: "+V.minVersion);if(v._compareVersion(G,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+V.minVersion)}const J={1:v._CreateGLTF1Loader,2:v._CreateGLTF2Loader}[W.major];if(!J)throw new Error("Unsupported version: "+V.version);return J(this)}_parseJson(G){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${G.length}`);const V=JSON.parse(G);return this._endPerformanceCounter("Parse JSON"),V}_unpackBinaryAsync(G){return this._startPerformanceCounter("Unpack Binary"),G.loadAsync(20).then((()=>{const V=G.readUint32();if(1179937895!==V)throw new e.f("Unexpected magic: "+V,e.d.GLTFLoaderUnexpectedMagicError);const W=G.readUint32();this.loggingEnabled&&this._log(`Binary version: ${W}`);const J=G.readUint32();let R;switch(this.useRangeRequests||J===G.buffer.byteLength||P.c.Warn(`Length in header does not match actual data length: ${J} != ${G.buffer.byteLength}`),W){case 1:R=this._unpackBinaryV1Async(G,J);break;case 2:R=this._unpackBinaryV2Async(G,J);break;default:throw new Error("Unsupported version: "+W)}return this._endPerformanceCounter("Unpack Binary"),R}))}_unpackBinaryV1Async(G,V){const W=G.readUint32(),J=G.readUint32();if(0!==J)throw new Error(`Unexpected content format: ${J}`);const R=V-G.byteOffset,d={json:this._parseJson(G.readString(W)),bin:null};if(0!==R){const V=G.byteOffset;d.bin={readAsync:(W,J)=>G.buffer.readAsync(V+W,J),byteLength:R}}return Promise.resolve(d)}_unpackBinaryV2Async(G,V){const W=1313821514,J=5130562,R=G.readUint32();if(G.readUint32()!==W)throw new Error("First chunk format is not JSON");return G.byteOffset+R===V?G.loadAsync(R).then((()=>({json:this._parseJson(G.readString(R)),bin:null}))):G.loadAsync(R+8).then((()=>{const d={json:this._parseJson(G.readString(R)),bin:null},k=()=>{const R=G.readUint32();switch(G.readUint32()){case W:throw new Error("Unexpected JSON chunk");case J:{const V=G.byteOffset;d.bin={readAsync:(W,J)=>G.buffer.readAsync(V+W,J),byteLength:R},G.skipBytes(R);break}default:G.skipBytes(R)}return G.byteOffset!==V?G.loadAsync(8).then(k):Promise.resolve(d)};return k()}))}static _parseVersion(G){if("1.0"===G||"1.0.1"===G)return{major:1,minor:0};const V=(G+"").match(/^(\d+)\.(\d+)/);return V?{major:parseInt(V[1]),minor:parseInt(V[2])}:null}static _compareVersion(G,V){return G.major>V.major?1:G.major<V.major?-1:G.minor>V.minor?1:G.minor<V.minor?-1:0}_logOpen(G){this._log(G),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(G){const V=v._logSpaces.substring(0,2*this._logIndentLevel);P.c.Log(`${V}${G}`)}_logDisabled(G){}_startPerformanceCounterEnabled(G){R.h.StartPerformanceCounter(G)}_startPerformanceCounterDisabled(G){}_endPerformanceCounterEnabled(G){R.h.EndPerformanceCounter(G)}_endPerformanceCounterDisabled(G){}}v.IncrementalLoading=!0,v.HomogeneousCoordinates=!1,v._logSpaces="                                ",(0,d.c)(new v)},12999:(G,V,W)=>{"use strict";W.d(V,{d:()=>k});var J=W(11189);function R(G,V,W,J){const R={externalResourceFunction:J};return W&&(R.uri="file:"===V?W:V+W),ArrayBuffer.isView(G)?GLTFValidator.validateBytes(G,R):GLTFValidator.validateString(G,R)}function d(){const G=[];onmessage=V=>{const W=V.data;switch(W.id){case"init":importScripts(W.url);break;case"validate":R(W.data,W.rootUrl,W.fileName,(V=>new Promise(((W,J)=>{const R=G.length;G.push({resolve:W,reject:J}),postMessage({id:"getExternalResource",index:R,uri:V})})))).then((G=>{postMessage({id:"validate.resolve",value:G})}),(G=>{postMessage({id:"validate.reject",reason:G})}));break;case"getExternalResource.resolve":G[W.index].resolve(W.value);break;case"getExternalResource.reject":G[W.index].reject(W.reason)}}}class k{static ValidateAsync(G,V,W,k){return"function"===typeof Worker?new Promise(((z,X)=>{const P=`${R}(${d})()`,A=URL.createObjectURL(new Blob([P],{type:"application/javascript"})),x=new Worker(A),q=G=>{x.removeEventListener("error",q),x.removeEventListener("message",L),X(G)},L=G=>{const V=G.data;switch(V.id){case"getExternalResource":k(V.uri).then((G=>{x.postMessage({id:"getExternalResource.resolve",index:V.index,value:G},[G.buffer])}),(G=>{x.postMessage({id:"getExternalResource.reject",index:V.index,reason:G})}));break;case"validate.resolve":x.removeEventListener("error",q),x.removeEventListener("message",L),z(V.value),x.terminate();break;case"validate.reject":x.removeEventListener("error",q),x.removeEventListener("message",L),X(V.reason),x.terminate()}};if(x.addEventListener("error",q),x.addEventListener("message",L),x.postMessage({id:"init",url:J.h.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(G)){const J=G.slice();x.postMessage({id:"validate",data:J,rootUrl:V,fileName:W},[J.buffer])}else x.postMessage({id:"validate",data:G,rootUrl:V,fileName:W})})):(this._LoadScriptPromise||(this._LoadScriptPromise=J.h.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>R(G,V,W,k))))}}k.Configuration={url:`${J.h._DefaultCdnUrl}/gltf_validator.js`}},13517:(G,V,W)=>{"use strict";W.d(V,{c:()=>u});var J=W(11317),R=W(11324),d=W(11411),k=W(11136),z=W(11794),X=W(11811),P=W(11345),A=W(11737),x=W(11159),q=W(11270);W(12759),W(12677),W(12690),W(12679),W(12693),W(12697),W(12706);const L="imageProcessingCompatibility",t="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";q.d.IncludesShadersStore[L]||(q.d.IncludesShadersStore[L]=t);const Y="skyPixelShader",g="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";q.d.ShadersStore[Y]||(q.d.ShadersStore[Y]=g);W(12767),W(12708),W(12715),W(12725),W(12722);const B="skyVertexShader",S="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";q.d.ShadersStore[B]||(q.d.ShadersStore[B]=S);var p=W(11832),b=W(11449),r=W(11432);class y extends z.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class u extends X.d{constructor(G,V){super(G,V),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new k.o(0,100,0),this.useSunPosition=!1,this.cameraOffset=k.o.Zero(),this.up=k.o.Up(),this.dithering=!1,this._cameraPosition=k.o.Zero(),this._skyOrientation=new k.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(G,V){const W=V._drawWrapper;if(this.isFrozen&&W.effect&&W._wasPreviouslyReady)return!0;V.materialDefines||(V.materialDefines=new y);const J=V.materialDefines,R=this.HG();if(this._isReadyForSubMesh(V))return!0;if((0,r.U)(G,R,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,J),(0,r.M)(G,J,!0,!1),J.IMAGEPROCESSINGPOSTPROCESS!==R.imageProcessingConfiguration.applyByPostProcess&&J.markAsMiscDirty(),J.DITHER!==this.dithering&&J.markAsMiscDirty(),J.isDirty){J.markAsProcessed(),R.resetCachedMaterial();const G=new p.b;J.FOG&&G.addFallback(1,"FOG"),J.IMAGEPROCESSINGPOSTPROCESS=R.imageProcessingConfiguration.applyByPostProcess,J.DITHER=this.dithering;const W=[P.c.PositionKind];J.VERTEXCOLOR&&W.push(P.c.ColorKind);const d="sky",k=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,b.c)(k);const z=J.toString();V.setEffect(R.getEngine().createEffect(d,W,k,[],z,G,this.onCompiled,this.onError),J,this._materialContext)}return!(!V.effect||!V.effect.isReady())&&(J._renderId=R.getRenderId(),W._wasPreviouslyReady=!0,!0)}bindForSubMesh(G,V,W){const J=this.HG(),R=W.materialDefines;if(!R)return;const d=W.effect;if(!d)return;this._activeEffect=d,this.bindOnlyWorldMatrix(G),this._activeEffect.setMatrix("viewProjection",J.getTransformMatrix()),this._mustRebind(J,d,W)&&((0,b.f)(d,this,J),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,r.j)(R,d,J)),J.fogEnabled&&V.applyFog&&J.fogMode!==A.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",J.getViewMatrix()),(0,r.f)(J,V,this._activeEffect);const z=J.activeCamera;if(z){const G=z.getWorldMatrix();this._cameraPosition.x=G.m[12],this._cameraPosition.y=G.m[13],this._cameraPosition.z=G.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const G=Math.PI*(this.inclination-.5),V=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(V)*Math.cos(G),this.sunPosition.y=this.distance*Math.sin(-G),this.sunPosition.z=this.distance*Math.sin(V)*Math.cos(G),k.g.FromUnitVectorsToRef(k.o.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(V,this._activeEffect,W)}getAnimatables(){return[]}dispose(G){super.dispose(G)}clone(G){return d.e.Clone((()=>new u(G,this.HG())),this)}serialize(){const G=super.serialize();return G.customType="BABYLON.SkyMaterial",G}getClassName(){return"SkyMaterial"}static Parse(G,V,W){return d.e.Parse((()=>new u(G.name,V)),G,V,W)}}(0,J.e)([(0,R.I)()],u.prototype,"luminance",void 0),(0,J.e)([(0,R.I)()],u.prototype,"turbidity",void 0),(0,J.e)([(0,R.I)()],u.prototype,"rayleigh",void 0),(0,J.e)([(0,R.I)()],u.prototype,"mieCoefficient",void 0),(0,J.e)([(0,R.I)()],u.prototype,"mieDirectionalG",void 0),(0,J.e)([(0,R.I)()],u.prototype,"distance",void 0),(0,J.e)([(0,R.I)()],u.prototype,"inclination",void 0),(0,J.e)([(0,R.I)()],u.prototype,"azimuth",void 0),(0,J.e)([(0,R.F)()],u.prototype,"sunPosition",void 0),(0,J.e)([(0,R.I)()],u.prototype,"useSunPosition",void 0),(0,J.e)([(0,R.F)()],u.prototype,"cameraOffset",void 0),(0,J.e)([(0,R.F)()],u.prototype,"up",void 0),(0,J.e)([(0,R.I)()],u.prototype,"dithering",void 0),(0,x.d)("BABYLON.SkyMaterial",u)},11972:(G,V,W)=>{"use strict";function J(G,V){V.headers=G.headers||{},V.statusMessage=G.statusText,V.statusCode=G.status,V.data=G.response}function R(G,V,W){return new Promise((function(R,d){W=W||{};var k,z,X,P=new XMLHttpRequest,A=W.body,x=W.headers||{};for(k in W.timeout&&(P.timeout=W.timeout),P.ontimeout=P.onerror=function(G){G.timeout="timeout"==G.type,d(G)},P.open(G,V.href||V),P.onload=function(){for(X=P.getAllResponseHeaders().trim().split(/[\r\n]+/),J(P,P);z=X.shift();)z=z.split(": "),P.headers[z.shift().toLowerCase()]=z.join(": ");if((z=P.headers["content-type"])&&~z.indexOf("application/json"))try{P.data=JSON.parse(P.data,W.reviver)}catch(G){return J(P,G),d(G)}(P.status>=400?d:R)(P)},typeof FormData<"u"&&A instanceof FormData||A&&"object"==typeof A&&(x["content-type"]="application/json",A=JSON.stringify(A)),P.withCredentials=!!W.withCredentials,x)P.setRequestHeader(k,x[k]);P.send(A)}))}W.r(V),W.d(V,{del:()=>X,get:()=>d,patch:()=>z,post:()=>k,put:()=>P,send:()=>R});var d=R.bind(R,"GET"),k=R.bind(R,"POST"),z=R.bind(R,"PATCH"),X=R.bind(R,"DELETE"),P=R.bind(R,"PUT")},13641:(G,V,W)=>{"use strict";W.d(V,{d:()=>x});const J=.5*(Math.sqrt(3)-1),R=(3-Math.sqrt(3))/6,d=1/3,k=1/6,z=(Math.sqrt(5)-1)/4,X=(5-Math.sqrt(5))/20,P=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),A=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const x=class{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const V="function"==typeof G?G:function(G){let V=0,W=0,J=0,R=1;const d=function(){let G=4022871197;return function(V){V=V.toString();for(let W=0;W<V.length;W++){G+=V.charCodeAt(W);let J=.02519603282416938*G;G=J>>>0,J-=G,J*=G,G=J>>>0,J-=G,G+=4294967296*J}return 2.3283064365386963e-10*(G>>>0)}}();V=d(" "),W=d(" "),J=d(" "),V-=d(G),V<0&&(V+=1);W-=d(G),W<0&&(W+=1);J-=d(G),J<0&&(J+=1);return function(){const G=2091639*V+2.3283064365386963e-10*R;return V=W,W=J,J=G-(R=0|G)}}(G);this.p=function(G){const V=new Uint8Array(256);for(let W=0;W<256;W++)V[W]=W;for(let W=0;W<255;W++){const J=W+~~(G()*(256-W)),R=V[W];V[W]=V[J],V[J]=R}return V}(V),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let W=0;W<512;W++)this.perm[W]=this.p[255&W],this.permMod12[W]=this.perm[W]%12}noise2D(G,V){const W=this.permMod12,d=this.perm;let k=0,z=0,X=0;const A=(G+V)*J,x=Math.floor(G+A),q=Math.floor(V+A),L=(x+q)*R,t=G-(x-L),Y=V-(q-L);let g,B;t>Y?(g=1,B=0):(g=0,B=1);const S=t-g+R,p=Y-B+R,b=t-1+2*R,r=Y-1+2*R,y=255&x,u=255&q;let H=.5-t*t-Y*Y;if(H>=0){const G=3*W[y+d[u]];H*=H,k=H*H*(P[G]*t+P[G+1]*Y)}let n=.5-S*S-p*p;if(n>=0){const G=3*W[y+g+d[u+B]];n*=n,z=n*n*(P[G]*S+P[G+1]*p)}let D=.5-b*b-r*r;if(D>=0){const G=3*W[y+1+d[u+1]];D*=D,X=D*D*(P[G]*b+P[G+1]*r)}return 70*(k+z+X)}noise3D(G,V,W){const J=this.permMod12,R=this.perm;let z,X,A,x;const q=(G+V+W)*d,L=Math.floor(G+q),t=Math.floor(V+q),Y=Math.floor(W+q),g=(L+t+Y)*k,B=G-(L-g),S=V-(t-g),p=W-(Y-g);let b,r,y,u,H,n;B>=S?S>=p?(b=1,r=0,y=0,u=1,H=1,n=0):B>=p?(b=1,r=0,y=0,u=1,H=0,n=1):(b=0,r=0,y=1,u=1,H=0,n=1):S<p?(b=0,r=0,y=1,u=0,H=1,n=1):B<p?(b=0,r=1,y=0,u=0,H=1,n=1):(b=0,r=1,y=0,u=1,H=1,n=0);const D=B-b+k,i=S-r+k,e=p-y+k,F=B-u+2*k,f=S-H+2*k,v=p-n+2*k,C=B-1+.5,l=S-1+.5,m=p-1+.5,w=255&L,N=255&t,U=255&Y;let a=.6-B*B-S*S-p*p;if(a<0)z=0;else{const G=3*J[w+R[N+R[U]]];a*=a,z=a*a*(P[G]*B+P[G+1]*S+P[G+2]*p)}let M=.6-D*D-i*i-e*e;if(M<0)X=0;else{const G=3*J[w+b+R[N+r+R[U+y]]];M*=M,X=M*M*(P[G]*D+P[G+1]*i+P[G+2]*e)}let T=.6-F*F-f*f-v*v;if(T<0)A=0;else{const G=3*J[w+u+R[N+H+R[U+n]]];T*=T,A=T*T*(P[G]*F+P[G+1]*f+P[G+2]*v)}let K=.6-C*C-l*l-m*m;if(K<0)x=0;else{const G=3*J[w+1+R[N+1+R[U+1]]];K*=K,x=K*K*(P[G]*C+P[G+1]*l+P[G+2]*m)}return 32*(z+X+A+x)}noise4D(G,V,W,J){const R=this.perm;let d,k,P,x,q;const L=(G+V+W+J)*z,t=Math.floor(G+L),Y=Math.floor(V+L),g=Math.floor(W+L),B=Math.floor(J+L),S=(t+Y+g+B)*X,p=G-(t-S),b=V-(Y-S),r=W-(g-S),y=J-(B-S);let u=0,H=0,n=0,D=0;p>b?u++:H++,p>r?u++:n++,p>y?u++:D++,b>r?H++:n++,b>y?H++:D++,r>y?n++:D++;const i=u>=3?1:0,e=H>=3?1:0,F=n>=3?1:0,f=D>=3?1:0,v=u>=2?1:0,C=H>=2?1:0,l=n>=2?1:0,m=D>=2?1:0,w=u>=1?1:0,N=H>=1?1:0,U=n>=1?1:0,a=D>=1?1:0,M=p-i+X,T=b-e+X,K=r-F+X,s=y-f+X,Q=p-v+2*X,Z=b-C+2*X,E=r-l+2*X,h=y-m+2*X,o=p-w+3*X,c=b-N+3*X,j=r-U+3*X,I=y-a+3*X,O=p-1+4*X,GG=b-1+4*X,VG=r-1+4*X,WG=y-1+4*X,JG=255&t,RG=255&Y,dG=255&g,kG=255&B;let zG=.6-p*p-b*b-r*r-y*y;if(zG<0)d=0;else{const G=R[JG+R[RG+R[dG+R[kG]]]]%32*4;zG*=zG,d=zG*zG*(A[G]*p+A[G+1]*b+A[G+2]*r+A[G+3]*y)}let XG=.6-M*M-T*T-K*K-s*s;if(XG<0)k=0;else{const G=R[JG+i+R[RG+e+R[dG+F+R[kG+f]]]]%32*4;XG*=XG,k=XG*XG*(A[G]*M+A[G+1]*T+A[G+2]*K+A[G+3]*s)}let PG=.6-Q*Q-Z*Z-E*E-h*h;if(PG<0)P=0;else{const G=R[JG+v+R[RG+C+R[dG+l+R[kG+m]]]]%32*4;PG*=PG,P=PG*PG*(A[G]*Q+A[G+1]*Z+A[G+2]*E+A[G+3]*h)}let AG=.6-o*o-c*c-j*j-I*I;if(AG<0)x=0;else{const G=R[JG+w+R[RG+N+R[dG+U+R[kG+a]]]]%32*4;AG*=AG,x=AG*AG*(A[G]*o+A[G+1]*c+A[G+2]*j+A[G+3]*I)}let xG=.6-O*O-GG*GG-VG*VG-WG*WG;if(xG<0)q=0;else{const G=R[JG+1+R[RG+1+R[dG+1+R[kG+1]]]]%32*4;xG*=xG,q=xG*xG*(A[G]*O+A[G+1]*GG+A[G+2]*VG+A[G+3]*WG)}return 27*(d+k+P+x+q)}}}}]);