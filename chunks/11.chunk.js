/*! For license information please see tnmf9a.11.5abd139c.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{13191:(V,I,m)=>{"use strict";var C=m(13197),l=m(13200),s=m(13202);m.g.__TYPEDARRAY_POOL||(m.g.__TYPEDARRAY_POOL={UINT8:l([32,0]),UINT16:l([32,0]),UINT32:l([32,0]),INT8:l([32,0]),INT16:l([32,0]),INT32:l([32,0]),FLOAT:l([32,0]),DOUBLE:l([32,0]),DATA:l([32,0]),UINT8C:l([32,0]),BUFFER:l([32,0])});var F="undefined"!==typeof Uint8ClampedArray,k=m.g.__TYPEDARRAY_POOL;k.UINT8C||(k.UINT8C=l([32,0])),k.BUFFER||(k.BUFFER=l([32,0]));var j=k.DATA,E=k.BUFFER;function K(V){if(V){var I=V.length||V.byteLength,m=C.log2(I);j[m].push(V)}}function Y(V){V=C.nextPow2(V);var I=C.log2(V),m=j[I];return m.length>0?m.pop():new ArrayBuffer(V)}function X(V){return new Uint8Array(Y(V),0,V)}function O(V){return new Uint16Array(Y(2*V),0,V)}function v(V){return new Uint32Array(Y(4*V),0,V)}function N(V){return new Int8Array(Y(V),0,V)}function t(V){return new Int16Array(Y(2*V),0,V)}function D(V){return new Int32Array(Y(4*V),0,V)}function b(V){return new Float32Array(Y(4*V),0,V)}function T(V){return new Float64Array(Y(8*V),0,V)}function n(V){return F?new Uint8ClampedArray(Y(V),0,V):X(V)}function x(V){return new DataView(Y(V),0,V)}I.free=function(V){if(s(V))E[C.log2(V.length)].push(V);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(V)&&(V=V.buffer),!V)return;var I=V.length||V.byteLength,m=0|C.log2(I);j[m].push(V)}},I.freeUint8=I.freeUint16=I.freeUint32=I.freeInt8=I.freeInt16=I.freeInt32=I.freeFloat32=I.freeFloat=I.freeFloat64=I.freeDouble=I.freeUint8Clamped=I.freeDataView=function(V){K(V.buffer)},I.freeArrayBuffer=K,I.freeBuffer=function(V){E[C.log2(V.length)].push(V)},I.malloc=function(V,I){if(void 0===I||"arraybuffer"===I)return Y(V);switch(I){case"uint8":return X(V);case"uint16":return O(V);case"uint32":return v(V);case"int8":return N(V);case"int16":return t(V);case"int32":return D(V);case"float":case"float32":return b(V);case"double":case"float64":return T(V);case"uint8_clamped":return n(V);case"buffer":throw"Buffer not supported";case"data":case"dataview":return x(V);default:return null}return null},I.mallocArrayBuffer=Y,I.mallocUint8=X,I.mallocUint16=O,I.mallocUint32=v,I.mallocInt8=N,I.mallocInt16=t,I.mallocInt32=D,I.mallocFloat32=I.mallocFloat=b,I.mallocFloat64=I.mallocDouble=T,I.mallocUint8Clamped=n,I.mallocDataView=x,I.clearCache=function(){for(var V=0;V<32;++V)k.UINT8[V].length=0,k.UINT16[V].length=0,k.UINT32[V].length=0,k.INT8[V].length=0,k.INT16[V].length=0,k.INT32[V].length=0,k.FLOAT[V].length=0,k.DOUBLE[V].length=0,k.UINT8C[V].length=0,j[V].length=0,E[V].length=0}},13271:(V,I,m)=>{V.exports=l;var C=m(11987);function l(V,I){if(!(this instanceof l))return new l(V,I);var m=C.create();C.add(m,V,I),this.base=C.min(C.create(),V,m),this.zE=C.clone(I),this.max=C.max(C.create(),V,m),this.mag=C.length(this.zE)}var s=l.prototype;s.width=function(){return this.zE[0]},s.height=function(){return this.zE[1]},s.depth=function(){return this.zE[2]},s.x0=function(){return this.base[0]},s.y0=function(){return this.base[1]},s.z0=function(){return this.base[2]},s.x1=function(){return this.max[0]},s.y1=function(){return this.max[1]},s.z1=function(){return this.max[2]},s.translate=function(V){return C.add(this.max,this.max,V),C.add(this.base,this.base,V),this},s.setPosition=function(V){return C.add(this.max,V,this.zE),C.j(this.base,V),this},s.expand=function(V){var I=C.create(),m=C.create();return C.max(I,V.max,this.max),C.min(m,V.base,this.base),C.Fm(I,I,m),new l(m,I)},s.intersects=function(V){return!(V.base[0]>this.max[0])&&(!(V.base[1]>this.max[1])&&(!(V.base[2]>this.max[2])&&(!(V.max[0]<this.base[0])&&(!(V.max[1]<this.base[1])&&!(V.max[2]<this.base[2])))))},s.touches=function(V){var I=this.union(V);return null!==I&&(0==I.width()||0==I.height()||0==I.depth())},s.union=function(V){if(!this.intersects(V))return null;var I=Math.max(V.base[0],this.base[0]),m=Math.max(V.base[1],this.base[1]),C=Math.max(V.base[2],this.base[2]);return new l([I,m,C],[Math.min(V.max[0],this.max[0])-I,Math.min(V.max[1],this.max[1])-m,Math.min(V.max[2],this.max[2])-C])}},13197:(V,I)=>{"use strict";function m(V){var I=32;return(V&=-V)&&I--,65535&V&&(I-=16),16711935&V&&(I-=8),252645135&V&&(I-=4),858993459&V&&(I-=2),1431655765&V&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(V){return(V>0)-(V<0)},I.abs=function(V){var I=V>>31;return(V^I)-I},I.min=function(V,I){return I^(V^I)&-(V<I)},I.max=function(V,I){return V^(V^I)&-(V<I)},I.isPow2=function(V){return!(V&V-1)&&!!V},I.log2=function(V){var I,m;return I=(V>65535)<<4,I|=m=((V>>>=I)>255)<<3,I|=m=((V>>>=m)>15)<<2,(I|=m=((V>>>=m)>3)<<1)|(V>>>=m)>>1},I.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},I.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},I.countTrailingZeros=m,I.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},I.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},I.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var C=new Array(256);!function(V){for(var I=0;I<256;++I){var m=I,C=I,l=7;for(m>>>=1;m;m>>>=1)C<<=1,C|=1&m,--l;V[I]=C<<l&255}}(C),I.reverse=function(V){return C[255&V]<<24|C[V>>>8&255]<<16|C[V>>>16&255]<<8|C[V>>>24&255]},I.interleave2=function(V,I){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(V,I){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>I&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},I.interleave3=function(V,I,m){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(m=1227133513&((m=3272356035&((m=251719695&((m=4278190335&((m&=1023)|m<<16))|m<<8))|m<<4))|m<<2))<<2},I.deinterleave3=function(V,I){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>I&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},I.nextCombination=function(V){var I=V|V-1;return I+1|(~I&-~I)-1>>>m(V)+1}},13186:(V,I,m)=>{"use strict";V.exports=function(V,I,m){switch(arguments.length){case 1:return C=[],E(l=V,l,K,!0),C;case 2:return"function"===typeof I?E(V,V,I,!0):function(V,I){return C=[],E(V,I,K,!1),C}(V,I);case 3:return E(V,I,m,!1);default:throw new Error("box-intersect: Invalid arguments")}var l};var C,l=m(13191),s=m(13209),F=m(13220);function k(V,I){for(var m=0;m<V;++m)if(!(I[m]<=I[m+V]))return!0;return!1}function j(V,I,m,C){for(var l=0,s=0,F=0,j=V.length;F<j;++F){var E=V[F];if(!k(I,E)){for(var K=0;K<2*I;++K)m[l++]=E[K];C[s++]=F}}return s}function E(V,I,m,C){var k=V.length,E=I.length;if(!(k<=0||E<=0)){var K=V[0].length>>>1;if(!(K<=0)){var Y,X=l.mallocDouble(2*K*k),O=l.mallocInt32(k);if((k=j(V,K,X,O))>0){if(1===K&&C)s.init(k),Y=s.sweepComplete(K,m,0,k,X,O,0,k,X,O);else{var v=l.mallocDouble(2*K*E),N=l.mallocInt32(E);(E=j(I,K,v,N))>0&&(s.init(k+E),Y=1===K?s.sweepBipartite(K,m,0,k,X,O,0,E,v,N):F(K,m,C,k,X,O,E,v,N),l.free(v),l.free(N))}l.free(X),l.free(O)}return Y}}}function K(V,I){C.push([V,I])}},13227:(V,I)=>{"use strict";var m="d",C="ax",l="fp",s="es",F="rs",k="re",j="rb",E="bs",K="be",Y="bb",X=[m,C,"vv",F,k,j,"ri",E,K,Y,"bi"];function O(V){var I="bruteForce"+(V?"Full":"Partial"),C=[],F=X.slice();V||F.splice(3,0,l);var k=["function "+I+"("+F.join()+"){"];function j(I,l){var F=function(V,I,C){var l="bruteForce"+(V?"Red":"Blue")+(I?"Flip":"")+(C?"Full":""),F=["function ",l,"(",X.join(),"){","var ",s,"=2*",m,";"],k="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",j="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(C?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return V?F.push(k,"Q",":",j):F.push(j,"Q",":",k),C?F.push("if(y1<x0||x1<y0)continue;"):I?F.push("if(y0<=x0||x1<y0)continue;"):F.push("if(y0<x0||x1<y0)continue;"),F.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),I?F.push("yi,xi"):F.push("xi,yi"),F.push(");if(rv!==void 0)return rv;}}}"),{name:l,code:F.join("")}}(I,l,V);C.push(F.code),k.push("return "+F.name+"("+X.join()+");")}k.push("if(re-rs>be-bs){"),V?(j(!0,!1),k.push("}else{"),j(!1,!1)):(k.push("if(fp){"),j(!0,!0),k.push("}else{"),j(!0,!1),k.push("}}else{if(fp){"),j(!1,!0),k.push("}else{"),j(!1,!1),k.push("}")),k.push("}}return "+I);var E=C.join("")+k.join("");return new Function(E)()}I.partial=O(!1),I.full=O(!0)},13220:(V,I,m)=>{"use strict";V.exports=function(V,I,m,s,K,Z,B,W,Q){!function(V,I){var m=8*l.log2(I+1)*(V+1)|0,s=l.nextPow2(n*m);S.length<s&&(C.free(S),S=C.mallocInt32(s));var F=l.nextPow2(x*m);c.length<F&&(C.free(c),c=C.mallocDouble(F))}(V,s+B);var G,r=0,g=2*V;H(r++,0,0,s,0,B,m?16:0,-1/0,1/0),m||H(r++,0,0,B,0,s,1,-1/0,1/0);for(;r>0;){var h=(r-=1)*n,d=S[h],R=S[h+1],i=S[h+2],q=S[h+3],P=S[h+4],u=S[h+5],o=r*x,p=c[o],M=c[o+1],f=1&u,w=!!(16&u),A=K,J=Z,U=W,e=Q;if(f&&(A=W,J=Q,U=K,e=Z),!(2&u&&R>=(i=t(V,d,R,i,A,J,M)))&&!(4&u&&(R=D(V,d,R,i,A,J,p))>=i)){var a=i-R,L=P-q;if(w){if(V*a*(a+L)<O){if(void 0!==(G=j.scanComplete(V,d,I,R,i,A,J,q,P,U,e)))return G;continue}}else{if(V*Math.min(a,L)<Y){if(void 0!==(G=F(V,d,I,f,R,i,A,J,q,P,U,e)))return G;continue}if(V*a*L<X){if(void 0!==(G=j.scanBipartite(V,d,I,f,R,i,A,J,q,P,U,e)))return G;continue}}var VV=v(V,d,R,i,A,J,p,M);if(R<VV)if(V*(VV-R)<Y){if(void 0!==(G=k(V,d+1,I,R,VV,A,J,q,P,U,e)))return G}else if(d===V-2){if(void 0!==(G=f?j.sweepBipartite(V,I,q,P,U,e,R,VV,A,J):j.sweepBipartite(V,I,R,VV,A,J,q,P,U,e)))return G}else H(r++,d+1,R,VV,q,P,f,-1/0,1/0),H(r++,d+1,q,P,R,VV,1^f,-1/0,1/0);if(VV<i){var IV=E(V,d,q,P,U,e),mV=U[g*IV+d],CV=N(V,d,IV,P,U,e,mV);if(CV<P&&H(r++,d,VV,i,CV,P,(4|f)+(w?16:0),mV,M),q<IV&&H(r++,d,VV,i,q,IV,(2|f)+(w?16:0),p,mV),IV+1===CV){if(void 0!==(G=w?z(V,d,I,VV,i,A,J,IV,U,e[IV]):y(V,d,I,f,VV,i,A,J,IV,U,e[IV])))return G}else if(IV<CV){var lV;if(w){if(VV<(lV=b(V,d,VV,i,A,J,mV))){var sV=N(V,d,VV,lV,A,J,mV);if(d===V-2){if(VV<sV&&void 0!==(G=j.sweepComplete(V,I,VV,sV,A,J,IV,CV,U,e)))return G;if(sV<lV&&void 0!==(G=j.sweepBipartite(V,I,sV,lV,A,J,IV,CV,U,e)))return G}else VV<sV&&H(r++,d+1,VV,sV,IV,CV,16,-1/0,1/0),sV<lV&&(H(r++,d+1,sV,lV,IV,CV,0,-1/0,1/0),H(r++,d+1,IV,CV,sV,lV,1,-1/0,1/0))}}else VV<(lV=f?T(V,d,VV,i,A,J,mV):b(V,d,VV,i,A,J,mV))&&(d===V-2?G=f?j.sweepBipartite(V,I,IV,CV,U,e,VV,lV,A,J):j.sweepBipartite(V,I,VV,lV,A,J,IV,CV,U,e):(H(r++,d+1,VV,lV,IV,CV,f,-1/0,1/0),H(r++,d+1,IV,CV,VV,lV,1^f,-1/0,1/0)))}}}}};var C=m(13191),l=m(13197),s=m(13227),F=s.partial,k=s.full,j=m(13209),E=m(13232),K=m(13234),Y=128,X=1<<22,O=1<<22,v=K("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),N=K("lo===p0",["p0"]),t=K("lo<p0",["p0"]),D=K("hi<=p0",["p0"]),b=K("lo<=p0&&p0<=hi",["p0"]),T=K("lo<p0&&p0<=hi",["p0"]),n=6,x=2,S=C.mallocInt32(1024),c=C.mallocDouble(1024);function H(V,I,m,C,l,s,F,k,j){var E=n*V;S[E]=I,S[E+1]=m,S[E+2]=C,S[E+3]=l,S[E+4]=s,S[E+5]=F;var K=x*V;c[K]=k,c[K+1]=j}function y(V,I,m,C,l,s,F,k,j,E,K){var Y=2*V,X=j*Y,O=E[X+I];V:for(var v=l,N=l*Y;v<s;++v,N+=Y){var t=F[N+I],D=F[N+I+V];if(!(O<t||D<O)&&(!C||O!==t)){for(var b,T=k[v],n=I+1;n<V;++n){t=F[N+n],D=F[N+n+V];var x=E[X+n],S=E[X+n+V];if(D<x||S<t)continue V}if(void 0!==(b=C?m(K,T):m(T,K)))return b}}}function z(V,I,m,C,l,s,F,k,j,E){var K=2*V,Y=k*K,X=j[Y+I];V:for(var O=C,v=C*K;O<l;++O,v+=K){var N=F[O];if(N!==E){var t=s[v+I],D=s[v+I+V];if(!(X<t||D<X)){for(var b=I+1;b<V;++b){t=s[v+b],D=s[v+b+V];var T=j[Y+b],n=j[Y+b+V];if(D<T||n<t)continue V}var x=m(N,E);if(void 0!==x)return x}}}}},13232:(V,I,m)=>{"use strict";V.exports=function(V,I,m,F,k,j){if(F<=m+1)return m;var E=m,K=F,Y=F+m>>>1,X=2*V,O=Y,v=k[X*Y+I];for(;E<K;){if(K-E<l){s(V,I,E,K,k,j),v=k[X*Y+I];break}var N=K-E,t=Math.random()*N+E|0,D=k[X*t+I],b=Math.random()*N+E|0,T=k[X*b+I],n=Math.random()*N+E|0,x=k[X*n+I];D<=T?x>=T?(O=b,v=T):D>=x?(O=t,v=D):(O=n,v=x):T>=x?(O=b,v=T):x>=D?(O=t,v=D):(O=n,v=x);for(var S=X*(K-1),c=X*O,H=0;H<X;++H,++S,++c){var y=k[S];k[S]=k[c],k[c]=y}var z=j[K-1];j[K-1]=j[O],j[O]=z;for(S=X*(K-1),c=X*(O=C(V,I,E,K-1,k,j,v)),H=0;H<X;++H,++S,++c){y=k[S];k[S]=k[c],k[c]=y}z=j[K-1];if(j[K-1]=j[O],j[O]=z,Y<O){for(K=O-1;E<K&&k[X*(K-1)+I]===v;)K-=1;K+=1}else{if(!(O<Y))break;for(E=O+1;E<K&&k[X*E+I]===v;)E+=1}}return C(V,I,m,Y,k,j,k[X*Y+I])};var C=m(13234)("lo<p0",["p0"]),l=8;function s(V,I,m,C,l,s){for(var F=2*V,k=F*(m+1)+I,j=m+1;j<C;++j,k+=F)for(var E=l[k],K=j,Y=F*(j-1);K>m&&l[Y+I]>E;--K,Y-=F){for(var X=Y,O=Y+F,v=0;v<F;++v,++X,++O){var N=l[X];l[X]=l[O],l[O]=N}var t=s[K];s[K]=s[K-1],s[K-1]=t}}},13234:V=>{"use strict";V.exports=function(V,m){var C="abcdef".split("").concat(m),l=[];V.indexOf("lo")>=0&&l.push("lo=e[k+n]");V.indexOf("hi")>=0&&l.push("hi=e[k+o]");return C.push(I.replace("_",l.join()).replace("$",V)),Function.apply(void 0,C)};var I="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13217:V=>{"use strict";V.exports=function(V,C){C<=4*I?m(0,C-1,V):E(0,C-1,V)};var I=32;function m(V,I,m){for(var C=2*(V+1),l=V+1;l<=I;++l){for(var s=m[C++],F=m[C++],k=l,j=C-2;k-- >V;){var E=m[j-2],K=m[j-1];if(E<s)break;if(E===s&&K<F)break;m[j]=E,m[j+1]=K,j-=2}m[j]=s,m[j+1]=F}}function C(V,I,m){I*=2;var C=m[V*=2],l=m[V+1];m[V]=m[I],m[V+1]=m[I+1],m[I]=C,m[I+1]=l}function l(V,I,m){I*=2,m[V*=2]=m[I],m[V+1]=m[I+1]}function s(V,I,m,C){I*=2,m*=2;var l=C[V*=2],s=C[V+1];C[V]=C[I],C[V+1]=C[I+1],C[I]=C[m],C[I+1]=C[m+1],C[m]=l,C[m+1]=s}function F(V,I,m,C,l){I*=2,l[V*=2]=l[I],l[I]=m,l[V+1]=l[I+1],l[I+1]=C}function k(V,I,m){I*=2;var C=m[V*=2],l=m[I];return!(C<l)&&(C!==l||m[V+1]>m[I+1])}function j(V,I,m,C){var l=C[V*=2];return l<I||l===I&&C[V+1]<m}function E(V,K,Y){var X=(K-V+1)/6|0,O=V+X,v=K-X,N=V+K>>1,t=N-X,D=N+X,b=O,T=t,n=N,x=D,S=v,c=V+1,H=K-1,y=0;k(b,T,Y)&&(y=b,b=T,T=y),k(x,S,Y)&&(y=x,x=S,S=y),k(b,n,Y)&&(y=b,b=n,n=y),k(T,n,Y)&&(y=T,T=n,n=y),k(b,x,Y)&&(y=b,b=x,x=y),k(n,x,Y)&&(y=n,n=x,x=y),k(T,S,Y)&&(y=T,T=S,S=y),k(T,n,Y)&&(y=T,T=n,n=y),k(x,S,Y)&&(y=x,x=S,S=y);for(var z=Y[2*T],Z=Y[2*T+1],B=Y[2*x],W=Y[2*x+1],Q=2*b,G=2*n,r=2*S,g=2*O,h=2*N,d=2*v,R=0;R<2;++R){var i=Y[Q+R],q=Y[G+R],P=Y[r+R];Y[g+R]=i,Y[h+R]=q,Y[d+R]=P}l(t,V,Y),l(D,K,Y);for(var u=c;u<=H;++u)if(j(u,z,Z,Y))u!==c&&C(u,c,Y),++c;else if(!j(u,B,W,Y))for(;;){if(j(H,B,W,Y)){j(H,z,Z,Y)?(s(u,c,H,Y),++c,--H):(C(u,H,Y),--H);break}if(--H<u)break}F(V,c-1,z,Z,Y),F(K,H+1,B,W,Y),c-2-V<=I?m(V,c-2,Y):E(V,c-2,Y),K-(H+2)<=I?m(H+2,K,Y):E(H+2,K,Y),H-c<=I?m(c,H,Y):E(c,H,Y)}},13209:(V,I,m)=>{"use strict";V.exports={init:function(V){var I=l.nextPow2(V);j.length<I&&(C.free(j),j=C.mallocInt32(I));E.length<I&&(C.free(E),E=C.mallocInt32(I));K.length<I&&(C.free(K),K=C.mallocInt32(I));Y.length<I&&(C.free(Y),Y=C.mallocInt32(I));X.length<I&&(C.free(X),X=C.mallocInt32(I));O.length<I&&(C.free(O),O=C.mallocInt32(I));var m=8*I;v.length<m&&(C.free(v),v=C.mallocDouble(m))},sweepBipartite:function(V,I,m,C,l,k,X,O,D,b){for(var T=0,n=2*V,x=V-1,S=n-1,c=m;c<C;++c){var H=k[c],y=n*c;v[T++]=l[y+x],v[T++]=-(H+1),v[T++]=l[y+S],v[T++]=H}for(c=X;c<O;++c){H=b[c]+F;var z=n*c;v[T++]=D[z+x],v[T++]=-H,v[T++]=D[z+S],v[T++]=H}var Z=T>>>1;s(v,Z);var B=0,W=0;for(c=0;c<Z;++c){var Q=0|v[2*c+1];if(Q>=F)N(K,Y,W--,Q=Q-F|0);else if(Q>=0)N(j,E,B--,Q);else if(Q<=-F){Q=-Q-F|0;for(var G=0;G<B;++G){if(void 0!==(r=I(j[G],Q)))return r}t(K,Y,W++,Q)}else{Q=-Q-1|0;for(G=0;G<W;++G){var r;if(void 0!==(r=I(Q,K[G])))return r}t(j,E,B++,Q)}}},sweepComplete:function(V,I,m,C,l,F,k,D,b,T){for(var n=0,x=2*V,S=V-1,c=x-1,H=m;H<C;++H){var y=F[H]+1<<1,z=x*H;v[n++]=l[z+S],v[n++]=-y,v[n++]=l[z+c],v[n++]=y}for(H=k;H<D;++H){y=T[H]+1<<1;var Z=x*H;v[n++]=b[Z+S],v[n++]=1|-y,v[n++]=b[Z+c],v[n++]=1|y}var B=n>>>1;s(v,B);var W=0,Q=0,G=0;for(H=0;H<B;++H){var r=0|v[2*H+1],g=1&r;if(H<B-1&&r>>1===v[2*H+3]>>1&&(g=2,H+=1),r<0){for(var h=-(r>>1)-1,d=0;d<G;++d){if(void 0!==(R=I(X[d],h)))return R}if(0!==g)for(d=0;d<W;++d){if(void 0!==(R=I(j[d],h)))return R}if(1!==g)for(d=0;d<Q;++d){var R;if(void 0!==(R=I(K[d],h)))return R}0===g?t(j,E,W++,h):1===g?t(K,Y,Q++,h):2===g&&t(X,O,G++,h)}else{h=(r>>1)-1;0===g?N(j,E,W--,h):1===g?N(K,Y,Q--,h):2===g&&N(X,O,G--,h)}}},scanBipartite:function(V,I,m,C,l,k,K,Y,X,O,D,b){var T=0,n=2*V,x=I,S=I+V,c=1,H=1;C?H=F:c=F;for(var y=l;y<k;++y){var z=y+c,Z=n*y;v[T++]=K[Z+x],v[T++]=-z,v[T++]=K[Z+S],v[T++]=z}for(y=X;y<O;++y){z=y+H;var B=n*y;v[T++]=D[B+x],v[T++]=-z}var W=T>>>1;s(v,W);var Q=0;for(y=0;y<W;++y){var G=0|v[2*y+1];if(G<0){var r=!1;if((z=-G)>=F?(r=!C,z-=F):(r=!!C,z-=1),r)t(j,E,Q++,z);else{var g=b[z],h=n*z,d=D[h+I+1],R=D[h+I+1+V];V:for(var i=0;i<Q;++i){var q=j[i],P=n*q;if(!(R<K[P+I+1]||K[P+I+1+V]<d)){for(var u=I+2;u<V;++u)if(D[h+u+V]<K[P+u]||K[P+u+V]<D[h+u])continue V;var o,p=Y[q];if(void 0!==(o=C?m(g,p):m(p,g)))return o}}}}else N(j,E,Q--,G-c)}},scanComplete:function(V,I,m,C,l,k,E,K,Y,X,O){for(var N=0,t=2*V,D=I,b=I+V,T=C;T<l;++T){var n=T+F,x=t*T;v[N++]=k[x+D],v[N++]=-n,v[N++]=k[x+b],v[N++]=n}for(T=K;T<Y;++T){n=T+1;var S=t*T;v[N++]=X[S+D],v[N++]=-n}var c=N>>>1;s(v,c);var H=0;for(T=0;T<c;++T){var y=0|v[2*T+1];if(y<0){if((n=-y)>=F)j[H++]=n-F;else{var z=O[n-=1],Z=t*n,B=X[Z+I+1],W=X[Z+I+1+V];V:for(var Q=0;Q<H;++Q){var G=j[Q],r=E[G];if(r===z)break;var g=t*G;if(!(W<k[g+I+1]||k[g+I+1+V]<B)){for(var h=I+2;h<V;++h)if(X[Z+h+V]<k[g+h]||k[g+h+V]<X[Z+h])continue V;var d=m(r,z);if(void 0!==d)return d}}}}else{for(n=y-F,Q=H-1;Q>=0;--Q)if(j[Q]===n){for(h=Q+1;h<H;++h)j[h-1]=j[h];break}--H}}}};var C=m(13191),l=m(13197),s=m(13217),F=1<<28,k=1024,j=C.mallocInt32(k),E=C.mallocInt32(k),K=C.mallocInt32(k),Y=C.mallocInt32(k),X=C.mallocInt32(k),O=C.mallocInt32(k),v=C.mallocDouble(8192);function N(V,I,m,C){var l=I[C],s=V[m-1];V[l]=s,I[s]=l}function t(V,I,m,C){V[m]=C,I[C]=m}},13200:V=>{"use strict";function I(V,m,C){var l=0|V[C];if(l<=0)return[];var s,F=new Array(l);if(C===V.length-1)for(s=0;s<l;++s)F[s]=m;else for(s=0;s<l;++s)F[s]=I(V,m,C+1);return F}V.exports=function(V,m){switch("undefined"===typeof m&&(m=0),typeof V){case"number":if(V>0)return function(V,I){var m,C;for(m=new Array(V),C=0;C<V;++C)m[C]=I;return m}(0|V,m);break;case"object":if("number"===typeof V.length)return I(V,m,0)}return[]}},13152:(V,I,m)=>{V.exports=function(){var V=this;this.components={},this.comps=this.components;var I=this.components,m=1,l={},s=[],F=[],k={timeout:!1,removals:[],multiComps:[]};function j(V,m){var C=I[m],s=l[m],F=s.hash[V];F&&(s.remove(V),C.os&&(C.multi?(F.forEach((I=>{I&&C.os(V,I)})),F.length=0):C.os(V,F)),k.removals.push(s),E())}function E(){k.timeout||(k.timeout=!0,setTimeout(K,1))}function K(){k.timeout=!1,Y()}function Y(){k.multiComps.length&&function(V){for(var I=0;I<V.length;I++){var{entID:m,data:C}=V[I],l=C.hash[m];if(l){for(var s=0;s<l.length;s++)l[s]||(l.splice(s,1),s--);0===l.length&&(C.remove(m),k.removals.push(C))}}V.length=0}(k.multiComps),k.removals.length&&function(V){for(var I=0;I<V.length;I++){V[I].flush()}V.length=0}(k.removals)}this.oK=l,this._systems=s,this._renderSystems=F,this.WE=function(I){var C=m++;return Array.isArray(I)&&I.forEach((I=>V.Dj(C,I))),C},this.deleteEntity=function(I){return Object.keys(l).forEach((V=>{l[V].hash[I]&&j(I,V)})),V},this.wE=function(V){if(!V)throw new Error("Missing component definition");var m=V.name;if(!m)throw new Error("Component definition must have a name property.");if("string"!==typeof m)throw new Error("Component name must be a string.");if(""===m)throw new Error("Component name must be a non-empty string.");if(l[m])throw new Error(`Component ${m} already exists.`);var k={};return k.name=m,k.multi=!!V.multi,k.order=isNaN(V.order)?99:V.order,k.stateConstructor=V.stateConstructor||null,k.state=V.state||{},k.nk=V.nk||null,k.os=V.os||null,k.system=V.system||null,k.Bk=V.Bk||null,I[m]=k,l[m]=new C,l[m]._pendingMultiCleanup=!1,l[m]._multiCleanupIDs=k.multi?[]:null,k.system&&(s.push(m),s.sort(((V,m)=>I[V].order-I[m].order))),k.Bk&&(F.push(m),F.sort(((V,m)=>I[V].order-I[m].order))),m},this.overwriteComponent=function(V,m){var C=I[V];if(!C)throw new Error(`Unknown component: ${V}`);if(!m)throw new Error("Missing component definition");if(C.name!==m.name)throw new Error("Overwriting component must use the same name property.");var k={};k.name=V,k.multi=!!m.multi,k.order=isNaN(m.order)?99:m.order,k.state=m.state||{},k.nk=m.nk||null,k.os=m.os||null,k.system=m.system||null,k.Bk=m.Bk||null,I[V]=k,l[V]._pendingMultiCleanup=!1,l[V]._multiCleanupIDs=k.multi?[]:null;var j=s.indexOf(V);k.system&&j<0&&s.push(V),!k.system&&j>=0&&s.splice(j,1),s.sort(((V,m)=>I[V].order-I[m].order));var E=F.indexOf(V);k.Bk&&E<0&&F.push(V),!k.Bk&&E>=0&&F.splice(E,1),F.sort(((V,m)=>I[V].order-I[m].order));var K=k.state;return this.OE(V).forEach((V=>{for(var I in K)I in V||(V[I]=K[I]);k.nk&&k.nk(V.zk,V)})),V},this.deleteComponent=function(m){var C=l[m];if(!C)throw new Error(`Unknown component: ${m}`);C.flush(),C.list.forEach((V=>{V&&j(V.zk||V[0].zk,m)}));var k=s.indexOf(m),E=F.indexOf(m);return k>-1&&s.splice(k,1),E>-1&&F.splice(E,1),l[m].dispose(),delete l[m],delete I[m],V},this.Dj=function(V,m,C){var s,F=I[m],k=l[m];if(!k)throw new Error(`Unknown component: ${m}.`);if(k.hash[V]&&!F.multi)throw new Error(`Entity ${V} already has component: ${m}.`);if(F.stateConstructor){if(!(s=new F.stateConstructor).hasOwnProperty("zk"))throw new Error(`Component ${F.name} stateConstructor type does not have property __id`)}else s=Object.assign({},{zk:V},F.state,C);if(s.zk=V,F.multi){var j=k.hash[V];j||(j=[],k.add(V,j)),j.push(s)}else k.add(V,s);return F.nk&&F.nk(V,s),this},this.zj=function(V,I){var m=l[I];if(!m)throw new Error(`Unknown component: ${I}.`);return!!m.hash[V]},this.xj=function(I,m){if(!l[m])throw new Error(`Unknown component: ${m}.`);return j(I,m),V},this.getState=function(V,I){var m=l[I];if(!m)throw new Error(`Unknown component: ${I}.`);return m.hash[V]},this.OE=function(V){var I=l[V];if(!I)throw new Error(`Unknown component: ${V}.`);return Y(),I.list},this.gX=function(V){if(!l[V])throw new Error(`Unknown component: ${V}.`);var I=l[V].hash;return V=>I[V]},this.iX=function(V){if(!l[V])throw new Error(`Unknown component: ${V}.`);var I=l[V].hash;return V=>!!I[V]},this.oF=function(m){Y();for(var C=0;C<s.length;C++){var F=s[C],k=I[F],j=l[F];k.system(m,j.list),Y()}return V},this.render=function(m){Y();for(var C=0;C<F.length;C++){var s=F[C],k=I[s],j=l[s];k.Bk(m,j.list),Y()}return V},this.removeMultiComponent=function(m,C,s){var F=I[C],j=l[C];if(!j)throw new Error(`Unknown component: ${C}.`);if(!F.multi)throw new Error("removeMultiComponent called on non-multi component");return function(V,I,m,C){var l=m.hash[V];if(l){var s=l[C];s&&(l[C]=null,I.os&&I.os(V,s),k.multiComps.push({entID:V,data:m}),E())}}(m,F,j,s),V}};var C=m(13156)},13156:V=>{function I(V,I){var m=V._map[I];if(delete V.hash[I],delete V._map[I],m===V.list.length-1)V.list.pop();else{var C=V.list.pop();if(V.list[m]=C,null===C||null===C[0]){var l=V.list.length;for(var s in V._map)if(V._map[s]===l)return void(V._map[s]=m)}else{var F=C.zk||C[0].zk;V._map[F]=m}}}V.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(V,I){if("number"===typeof this._map[V]){var m=this._map[V];this.hash[V]=I,this.list[m]=I}else this._map[V]=this.list.length,this.hash[V]=I,this.list.push(I)}remove(V){var I=this._map[V];this.hash[V]=null,this.list[I]=null,this._pendingRemovals.push(V)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var V=0;V<this._pendingRemovals.length;V++){var m=this._pendingRemovals[V];null===this.hash[m]&&I(this,m)}this._pendingRemovals.length=0}}},13107:V=>{"use strict";var I,m="object"===typeof Reflect?Reflect:null,C=function(V,I,m){return Function.prototype.apply.call(V,I,m)};I=m&&"function"===typeof m.ownKeys?m.ownKeys:Object.getOwnPropertySymbols?function(V){return Object.getOwnPropertyNames(V).concat(Object.getOwnPropertySymbols(V))}:function(V){return Object.getOwnPropertyNames(V)};var l=Number.isNaN||function(V){return V!==V};function s(){s.init.call(this)}V.exports=s,V.exports.once=function(V,I){return new Promise((function(m,C){function l(m){V.removeListener(I,s),C(m)}function s(){"function"===typeof V.removeListener&&V.removeListener("error",l),m([].slice.call(arguments))}N(V,I,s,{once:!0}),"error"!==I&&function(V,I,m){"function"===typeof V.on&&N(V,"error",I,m)}(V,l,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var F=10;function k(V){if("function"!==typeof V)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof V)}function j(V){return void 0===V._maxListeners?s.defaultMaxListeners:V._maxListeners}function E(V,I,m,C){var l,s,F,E;if(k(m),void 0===(s=V._events)?(s=V._events=Object.create(null),V._eventsCount=0):(void 0!==s.newListener&&(V.emit("newListener",I,m.listener?m.listener:m),s=V._events),F=s[I]),void 0===F)F=s[I]=m,++V._eventsCount;else if("function"===typeof F?F=s[I]=C?[m,F]:[F,m]:C?F.unshift(m):F.push(m),(l=j(V))>0&&F.length>l&&!F.warned){F.warned=!0;var K=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");K.name="MaxListenersExceededWarning",K.i=V,K.type=I,K.count=F.length,E=K,console&&console.warn&&console.warn(E)}return V}function K(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Y(V,I,m){var C={fired:!1,wrapFn:void 0,target:V,type:I,listener:m},l=K.bind(C);return l.listener=m,C.wrapFn=l,l}function X(V,I,m){var C=V._events;if(void 0===C)return[];var l=C[I];return void 0===l?[]:"function"===typeof l?m?[l.listener||l]:[l]:m?function(V){for(var I=new Array(V.length),m=0;m<I.length;++m)I[m]=V[m].listener||V[m];return I}(l):v(l,l.length)}function O(V){var I=this._events;if(void 0!==I){var m=I[V];if("function"===typeof m)return 1;if(void 0!==m)return m.length}return 0}function v(V,I){for(var m=new Array(I),C=0;C<I;++C)m[C]=V[C];return m}function N(V,I,m,C){if("function"===typeof V.on)C.once?V.once(I,m):V.on(I,m);else{if("function"!==typeof V.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof V);V.addEventListener(I,(function l(s){C.once&&V.removeEventListener(I,l),m(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return F},set:function(V){if("number"!==typeof V||V<0||l(V))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+V+".");F=V}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(V){if("number"!==typeof V||V<0||l(V))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+V+".");return this._maxListeners=V,this},s.prototype.getMaxListeners=function(){return j(this)},s.prototype.emit=function(V){for(var I=[],m=1;m<arguments.length;m++)I.push(arguments[m]);var l="error"===V,s=this._events;if(void 0!==s)l=l&&void 0===s.error;else if(!l)return!1;if(l){var F;if(I.length>0&&(F=I[0]),F instanceof Error)throw F;var k=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw k.context=F,k}var j=s[V];if(void 0===j)return!1;if("function"===typeof j)C(j,this,I);else{var E=j.length,K=v(j,E);for(m=0;m<E;++m)C(K[m],this,I)}return!0},s.prototype.addListener=function(V,I){return E(this,V,I,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(V,I){return E(this,V,I,!0)},s.prototype.once=function(V,I){return k(I),this.on(V,Y(this,V,I)),this},s.prototype.prependOnceListener=function(V,I){return k(I),this.prependListener(V,Y(this,V,I)),this},s.prototype.removeListener=function(V,I){var m,C,l,s,F;if(k(I),void 0===(C=this._events))return this;if(void 0===(m=C[V]))return this;if(m===I||m.listener===I)0===--this._eventsCount?this._events=Object.create(null):(delete C[V],C.removeListener&&this.emit("removeListener",V,m.listener||I));else if("function"!==typeof m){for(l=-1,s=m.length-1;s>=0;s--)if(m[s]===I||m[s].listener===I){F=m[s].listener,l=s;break}if(l<0)return this;0===l?m.shift():function(V,I){for(;I+1<V.length;I++)V[I]=V[I+1];V.pop()}(m,l),1===m.length&&(C[V]=m[0]),void 0!==C.removeListener&&this.emit("removeListener",V,F||I)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(V){var I,m,C;if(void 0===(m=this._events))return this;if(void 0===m.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==m[V]&&(0===--this._eventsCount?this._events=Object.create(null):delete m[V]),this;if(0===arguments.length){var l,s=Object.keys(m);for(C=0;C<s.length;++C)"removeListener"!==(l=s[C])&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(I=m[V]))this.removeListener(V,I);else if(void 0!==I)for(C=I.length-1;C>=0;C--)this.removeListener(V,I[C]);return this},s.prototype.listeners=function(V){return X(this,V,!0)},s.prototype.rawListeners=function(V){return X(this,V,!1)},s.listenerCount=function(V,I){return"function"===typeof V.listenerCount?V.listenerCount(I):O.call(V,I)},s.prototype.listenerCount=O,s.prototype.eventNames=function(){return this._eventsCount>0?I(this._events):[]}},13410:V=>{"use strict";V.exports=function(V,I,m,C,l,s){var F=+I[0],k=+I[1],j=+I[2],E=+m[0],K=+m[1],Y=+m[2],X=Math.sqrt(E*E+K*K+Y*Y);if(0===X)throw new Error("Can't raycast along a zero vector");return function(V,I,m,C,l,s,F,k,j,E){for(var K=0,Y=Math.floor,X=0|Y(I),O=0|Y(m),v=0|Y(C),N=l>0?1:-1,t=s>0?1:-1,D=F>0?1:-1,b=Math.abs(1/l),T=Math.abs(1/s),n=Math.abs(1/F),x=b<1/0?b*(N>0?X+1-I:I-X):1/0,S=T<1/0?T*(t>0?O+1-m:m-O):1/0,c=n<1/0?n*(D>0?v+1-C:C-v):1/0,H=-1;K<=k;){var y=V(X,O,v);if(y)return j&&(j[0]=I+K*l,j[1]=m+K*s,j[2]=C+K*F),E&&(E[0]=E[1]=E[2]=0,0===H&&(E[0]=-N),1===H&&(E[1]=-t),2===H&&(E[2]=-D)),y;x<S?x<c?(X+=N,K=x,x+=b,H=0):(v+=D,K=c,c+=n,H=2):S<c?(O+=t,K=S,S+=T,H=1):(v+=D,K=c,c+=n,H=2)}return j&&(j[0]=I+K*l,j[1]=m+K*s,j[2]=C+K*F),E&&(E[0]=E[1]=E[2]=0),0}(V,F,k,j,E/=X,K/=X,Y/=X,C="undefined"===typeof C?64:+C,l,s)}},13443:(V,I,m)=>{"use strict";m.d(I,{c:()=>s});var C=m(13107);function l(){this.rY=!1,this.stopPropagation=!1,this.gY=!1,this.disabled=!1}class s{constructor(V,I){this.version="0.7.0";var m=Object.assign({},new l,I||{});this.element=V||document,this.rY=!!m.rY,this.stopPropagation=!!m.stopPropagation,this.gY=!!m.gY,this.disabled=!!m.disabled,this.filterEvents=(V,I)=>!0,this.down=new C.EventEmitter,this.up=new C.EventEmitter,this.state={},this.kE={dx:0,dy:0,HX:0,FE:0,yX:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?k(this):document.addEventListener("DOMContentLoaded",(V=>{k(this)}),{once:!0})}bind(V){for(var I=arguments.length,m=new Array(I>1?I-1:0),C=1;C<I;C++)m[C-1]=arguments[C];m.forEach((I=>{var m=this._keyBindmap[I]||[];m.includes(V)||(m.push(V),this._keyBindmap[I]=m)})),this.state[V]=!!this.state[V],this.pressCount[V]=this.pressCount[V]||0,this.releaseCount[V]=this.releaseCount[V]||0}unbind(V){for(var I in this._keyBindmap){var m=this._keyBindmap[I],C=m.indexOf(V);C>-1&&m.splice(C,1)}}getBindings(){var V={};for(var I in this._keyBindmap){this._keyBindmap[I].forEach((m=>{V[m]=V[m]||[],V[m].push(I)}))}return V}oF(){F(this.kE),F(this.pressCount),F(this.releaseCount)}}function F(V){for(var I in V)V[I]=0}function k(V){window.addEventListener("keydown",v.bind(null,V,!0),!1),window.addEventListener("keyup",v.bind(null,V,!1),!1);var I={passive:!0};V.element.addEventListener("touchstart",Y.bind(void 0,V),{passive:!1}),V.element.addEventListener("touchend",O.bind(void 0,V),I),V.element.addEventListener("mousedown",N.bind(null,V,!0),I),window.document.addEventListener("mouseup",N.bind(null,V,!1),I),V.element.addEventListener("touchmove",t.bind(null,V),I),V.element.addEventListener("mousemove",t.bind(null,V),I),window.PointerEvent,V.element.addEventListener("wheel",D.bind(null,V),I),V.element.addEventListener("contextmenu",b.bind(null,V),!1),window.addEventListener("blur",T.bind(null,V),!1)}var j=0,E=0,K=null;function Y(V,I){I.preventDefault(),X(I)}function X(V){let I=!1;for(let m=0;m<V.touches.length;++m)if(V.touches[m].identifier===K){I=!0;break}if(!I){const I=V.changedTouches[0];j=I.clientX,E=I.clientY,K=I.identifier}}function O(V,I){for(var m=I.changedTouches,C=0;C<m.length;++C)m[C].identifier===K&&(K=null)}function v(V,I,m){n(m.code,I,V,m)}function N(V,I,m){if("pointerId"in m)if(I){if(null!==V._touches.currID)return;V._touches.currID=m.pointerId}else{if(V._touches.currID!==m.pointerId)return;V._touches.currID=null}return n("Mouse"+("button"in m?m.button+1:1),I,V,m),!1}function t(V,I){var m=I.movementX||I.mozMovementX||0,C=I.movementY||I.mozMovementY||0;if(I.touches&&0===(m|C)){var l=function(V){X(V);for(let I=0;I<V.changedTouches.length;++I)if(V.changedTouches[I].identifier==K){const m=V.changedTouches[I],C=[m.clientX-j,m.clientY-E];return j=m.clientX,E=m.clientY,C}return console.error(`Did not find touch id ${K}`),[0,0]}(I);m=l[0],C=l[1]}V.kE.dx+=m,V.kE.dy+=C}function D(V,I){var m=1;switch(I.deltaMode){case 0:m=1;break;case 1:m=12;break;case 2:m=V.element.clientHeight||window.innerHeight}V.kE.HX+=(I.deltaX||0)*m,V.kE.FE+=(I.deltaY||0)*m,V.kE.yX+=(I.deltaZ||0)*m}function b(V,I){if(!V.gY)return I.preventDefault(),!1}function T(V){for(var I in V._keyStates)V._keyStates[I]&&(/^Mouse\d/.test(I)||n(I,!1,V,{code:I,note:"20jr8erjzbt",preventDefault:()=>{},stopPropagation:()=>{}}))}function n(V,I,m,C){var l=m._keyBindmap[V];l&&(x(m._keyStates[V],I)&&(m._keyStates[V]=I,l.forEach((V=>{(!m.filterEvents||m.filterEvents(C,V))&&function(V,I,m,C){var l=I?m.pressCount:m.releaseCount;l[V]=(l[V]||0)+1;var s=m._bindPressCount[V]||0;(s+=I?1:-1)<0&&(s=0);m._bindPressCount[V]=s;var F=m.state[V];if(x(F,s)){m.state[V]=s>0;var k=I?m.down:m.up;m.disabled||k.emit(V,C)}}(V,I,m,C)}))),"button"in C||(m.rY&&!C.defaultPrevented&&C.preventDefault(),m.stopPropagation&&C.stopPropagation()))}function x(V,I){return V?!I:I}},12067:V=>{V.exports=function(V,I,m){return V[0]=I[0]+m[0],V[1]=I[1]+m[1],V[2]=I[2]+m[2],V}},12014:(V,I,m)=>{V.exports=function(V,I){var m=C(V[0],V[1],V[2]),F=C(I[0],I[1],I[2]);l(m,m),l(F,F);var k=s(m,F);return k>1?0:Math.acos(k)};var C=m(12020),l=m(12029),s=m(12037)},12117:V=>{V.exports=function(V,I){return V[0]=Math.ceil(I[0]),V[1]=Math.ceil(I[1]),V[2]=Math.ceil(I[2]),V}},12007:V=>{V.exports=function(V){var I=new Float32Array(3);return I[0]=V[0],I[1]=V[1],I[2]=V[2],I}},12046:V=>{V.exports=function(V,I){return V[0]=I[0],V[1]=I[1],V[2]=I[2],V}},12001:V=>{V.exports=function(){var V=new Float32Array(3);return V[0]=0,V[1]=0,V[2]=0,V}},12183:V=>{V.exports=function(V,I,m){var C=I[0],l=I[1],s=I[2],F=m[0],k=m[1],j=m[2];return V[0]=l*j-s*k,V[1]=s*F-C*j,V[2]=C*k-l*F,V}},12145:(V,I,m)=>{V.exports=m(12138)},12138:V=>{V.exports=function(V,I){var m=I[0]-V[0],C=I[1]-V[1],l=I[2]-V[2];return Math.sqrt(m*m+C*C+l*l)}},12097:(V,I,m)=>{V.exports=m(12093)},12093:V=>{V.exports=function(V,I,m){return V[0]=I[0]/m[0],V[1]=I[1]/m[1],V[2]=I[2]/m[2],V}},12037:V=>{V.exports=function(V,I){return V[0]*I[0]+V[1]*I[1]+V[2]*I[2]}},11994:V=>{V.exports=1e-6},12056:(V,I,m)=>{V.exports=function(V,I){var m=V[0],l=V[1],s=V[2],F=I[0],k=I[1],j=I[2];return Math.abs(m-F)<=C*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(l-k)<=C*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(s-j)<=C*Math.max(1,Math.abs(s),Math.abs(j))};var C=m(11994)},12062:V=>{V.exports=function(V,I){return V[0]===I[0]&&V[1]===I[1]&&V[2]===I[2]}},12111:V=>{V.exports=function(V,I){return V[0]=Math.floor(I[0]),V[1]=Math.floor(I[1]),V[2]=Math.floor(I[2]),V}},12227:(V,I,m)=>{V.exports=function(V,I,m,l,s,F){var k,j;I||(I=3);m||(m=0);j=l?Math.min(l*I+m,V.length):V.length;for(k=m;k<j;k+=I)C[0]=V[k],C[1]=V[k+1],C[2]=V[k+2],s(C,C,F),V[k]=C[0],V[k+1]=C[1],V[k+2]=C[2];return V};var C=m(12001)()},12020:V=>{V.exports=function(V,I,m){var C=new Float32Array(3);return C[0]=V,C[1]=I,C[2]=m,C}},11987:(V,I,m)=>{V.exports={EPSILON:m(11994),create:m(12001),clone:m(12007),angle:m(12014),gF:m(12020),j:m(12046),set:m(12052),equals:m(12056),exactEquals:m(12062),add:m(12067),Fm:m(12070),sub:m(12079),multiply:m(12082),mul:m(12085),divide:m(12093),div:m(12097),min:m(12105),max:m(12108),floor:m(12111),ceil:m(12117),round:m(12126),scale:m(12131),hF:m(12135),distance:m(12138),k:m(12145),squaredDistance:m(12147),sqrDist:m(12152),length:m(12155),len:m(12159),squaredLength:m(12161),dF:m(12165),negate:m(12173),inverse:m(12177),normalize:m(12029),dot:m(12037),cross:m(12183),WF:m(12185),random:m(12194),transformMat4:m(12200),transformMat3:m(12204),transformQuat:m(12208),RF:m(12214),iF:m(12217),qF:m(12221),forEach:m(12227)}},12177:V=>{V.exports=function(V,I){return V[0]=1/I[0],V[1]=1/I[1],V[2]=1/I[2],V}},12159:(V,I,m)=>{V.exports=m(12155)},12155:V=>{V.exports=function(V){var I=V[0],m=V[1],C=V[2];return Math.sqrt(I*I+m*m+C*C)}},12185:V=>{V.exports=function(V,I,m,C){var l=I[0],s=I[1],F=I[2];return V[0]=l+C*(m[0]-l),V[1]=s+C*(m[1]-s),V[2]=F+C*(m[2]-F),V}},12108:V=>{V.exports=function(V,I,m){return V[0]=Math.max(I[0],m[0]),V[1]=Math.max(I[1],m[1]),V[2]=Math.max(I[2],m[2]),V}},12105:V=>{V.exports=function(V,I,m){return V[0]=Math.min(I[0],m[0]),V[1]=Math.min(I[1],m[1]),V[2]=Math.min(I[2],m[2]),V}},12085:(V,I,m)=>{V.exports=m(12082)},12082:V=>{V.exports=function(V,I,m){return V[0]=I[0]*m[0],V[1]=I[1]*m[1],V[2]=I[2]*m[2],V}},12173:V=>{V.exports=function(V,I){return V[0]=-I[0],V[1]=-I[1],V[2]=-I[2],V}},12029:V=>{V.exports=function(V,I){var m=I[0],C=I[1],l=I[2],s=m*m+C*C+l*l;s>0&&(s=1/Math.sqrt(s),V[0]=I[0]*s,V[1]=I[1]*s,V[2]=I[2]*s);return V}},12194:V=>{V.exports=function(V,I){I=I||1;var m=2*Math.random()*Math.PI,C=2*Math.random()-1,l=Math.sqrt(1-C*C)*I;return V[0]=Math.cos(m)*l,V[1]=Math.sin(m)*l,V[2]=C*I,V}},12214:V=>{V.exports=function(V,I,m,C){var l=m[1],s=m[2],F=I[1]-l,k=I[2]-s,j=Math.sin(C),E=Math.cos(C);return V[0]=I[0],V[1]=l+F*E-k*j,V[2]=s+F*j+k*E,V}},12217:V=>{V.exports=function(V,I,m,C){var l=m[0],s=m[2],F=I[0]-l,k=I[2]-s,j=Math.sin(C),E=Math.cos(C);return V[0]=l+k*j+F*E,V[1]=I[1],V[2]=s+k*E-F*j,V}},12221:V=>{V.exports=function(V,I,m,C){var l=m[0],s=m[1],F=I[0]-l,k=I[1]-s,j=Math.sin(C),E=Math.cos(C);return V[0]=l+F*E-k*j,V[1]=s+F*j+k*E,V[2]=I[2],V}},12126:V=>{V.exports=function(V,I){return V[0]=Math.round(I[0]),V[1]=Math.round(I[1]),V[2]=Math.round(I[2]),V}},12131:V=>{V.exports=function(V,I,m){return V[0]=I[0]*m,V[1]=I[1]*m,V[2]=I[2]*m,V}},12135:V=>{V.exports=function(V,I,m,C){return V[0]=I[0]+m[0]*C,V[1]=I[1]+m[1]*C,V[2]=I[2]+m[2]*C,V}},12052:V=>{V.exports=function(V,I,m,C){return V[0]=I,V[1]=m,V[2]=C,V}},12152:(V,I,m)=>{V.exports=m(12147)},12165:(V,I,m)=>{V.exports=m(12161)},12147:V=>{V.exports=function(V,I){var m=I[0]-V[0],C=I[1]-V[1],l=I[2]-V[2];return m*m+C*C+l*l}},12161:V=>{V.exports=function(V){var I=V[0],m=V[1],C=V[2];return I*I+m*m+C*C}},12079:(V,I,m)=>{V.exports=m(12070)},12070:V=>{V.exports=function(V,I,m){return V[0]=I[0]-m[0],V[1]=I[1]-m[1],V[2]=I[2]-m[2],V}},12204:V=>{V.exports=function(V,I,m){var C=I[0],l=I[1],s=I[2];return V[0]=C*m[0]+l*m[3]+s*m[6],V[1]=C*m[1]+l*m[4]+s*m[7],V[2]=C*m[2]+l*m[5]+s*m[8],V}},12200:V=>{V.exports=function(V,I,m){var C=I[0],l=I[1],s=I[2],F=m[3]*C+m[7]*l+m[11]*s+m[15];return F=F||1,V[0]=(m[0]*C+m[4]*l+m[8]*s+m[12])/F,V[1]=(m[1]*C+m[5]*l+m[9]*s+m[13])/F,V[2]=(m[2]*C+m[6]*l+m[10]*s+m[14])/F,V}},12208:V=>{V.exports=function(V,I,m){var C=I[0],l=I[1],s=I[2],F=m[0],k=m[1],j=m[2],E=m[3],K=E*C+k*s-j*l,Y=E*l+j*C-F*s,X=E*s+F*l-k*C,O=-F*C-k*l-j*s;return V[0]=K*E+O*-F+Y*-j-X*-k,V[1]=Y*E+O*-k+X*-F-K*-j,V[2]=X*E+O*-j+K*-k-Y*-F,V}},13134:V=>{"use strict";V.exports=function(V){for(var I=new Array(V),m=0;m<V;++m)I[m]=m;return I}},13202:V=>{V.exports=function(V){return null!=V&&null!=V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}},13412:(V,I,m)=>{"use strict";m.d(I,{e:()=>C});class C{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.vK=!1,this.NK=!1,this.YK=30,this.XK=0,this.cK=!1,this.fullscreen=!1,this.DK=function(V){},this.bK=function(){},this.xK=function(){},this.Ls=function(){},this.TK=function(V){},this.onFullscreenChanged=function(V){},E((()=>{!function(V,I){V._nowObject=performance||Date,V._lastTick=0,V._renderAccum=0,V._rt=0,V._frameCB=k.bind(null,V),requestAnimationFrame(V._frameCB),I>0&&(V._intervalCB=F.bind(null,V),V._interval=setInterval(V._intervalCB,Math.max(I,1e3/V.YK/2)))}(this,I),function(V,I){if(!I)return;var m=!1,C=!1;document.addEventListener("pointerlockchange",(C=>{m=document.pointerLockElement===I,V.TK(m)})),document.addEventListener("fullscreenchange",(m=>{C=document.fullscreenElement===I,V.onFullscreenChanged(C)})),Object.defineProperty(V,"cK",{get:()=>m,set:V=>{V&&!m?j(I):m&&!V&&function(V){V.exitPointerLock&&V.exitPointerLock()}(document)}}),Object.defineProperty(V,"fullscreen",{get:()=>C,set:V=>{V&&!C?I.requestFullscreen():C&&!V&&document.exitFullscreen()}}),I.addEventListener("click",(l=>{V.vK&&!m&&j(I),V.NK&&!C&&I.requestFullscreen()}));var l=()=>V.Ls();if(window.ResizeObserver){new ResizeObserver(l).observe(I)}else window.addEventListener("resize",l)}(this,V),this.xK()}))}}var l=3,s=20;function F(V){for(var I=1e3/V.YK,m=V._nowObject.now()+s,C=0;V._nowObject.now()>=V._lastTick+I&&V._nowObject.now()<m&&++C<=l;)V.DK(I),V._lastTick+=I;var F=5*(I+5),k=V._nowObject.now();if(k-V._lastTick>F)for(;k>=V._lastTick+I;)V._lastTick+=I}function k(V){requestAnimationFrame(V._frameCB),F(V);var I=V._nowObject.now(),m=I-V._rt;if(V._rt=I,V.XK>0){V._renderAccum+=m;var C=1e3/V.XK;if(V._renderAccum<C)return;V._renderAccum=Math.min(V._renderAccum-C,C)}var l=1e3/V.YK,s=(I-V._lastTick)/l;V.bK(m,s,l)}function j(V){V.requestPointerLock&&V.requestPointerLock()}var E=V=>{if("loading"===document.readyState){var I=()=>{document.removeEventListener("readystatechange",I),V()};document.addEventListener("readystatechange",I)}else setTimeout(V,1)}},13126:(V,I,m)=>{var C=m(13134),l=m(13140),s="undefined"!==typeof Float64Array;function F(V,I){return V[0]-I[0]}function k(){var V,I=this.stride,m=new Array(I.length);for(V=0;V<m.length;++V)m[V]=[Math.abs(I[V]),V];m.sort(F);var C=new Array(m.length);for(V=0;V<C.length;++V)C[V]=m[V][1];return C}function j(V,I){var m=["View",I,"d",V].join("");I<0&&(m="View_Nil"+V);var l="generic"===V;if(-1===I){var s="function "+m+"(a){this.data=a;};var proto="+m+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+m+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+m+"(a){return new "+m+"(a);}";return new Function(s)()}if(0===I){s="function "+m+"(a,d) {this.data = a;this.offset = d};var proto="+m+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+m+"_copy() {return new "+m+"(this.data,this.offset)};proto.pick=function "+m+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+m+"_get(){return "+(l?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+m+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+m+"(a,b,c,d){return new "+m+"(a,d)}";return new Function("TrivialArray",s)(E[V][0])}s=["'use strict'"];var F=C(I),j=F.map((function(V){return"i"+V})),K="this.offset+"+F.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),Y=F.map((function(V){return"b"+V})).join(","),X=F.map((function(V){return"c"+V})).join(",");s.push("function "+m+"(a,"+Y+","+X+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+X+"]","this.offset=d|0}","var proto="+m+".prototype","proto.dtype='"+V+"'","proto.dimension="+I),s.push("Object.defineProperty(proto,'size',{get:function "+m+"_size(){return "+F.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===I?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),I<4?(s.push("function "+m+"_order(){"),2===I?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+m+"_set("+j.join(",")+",v){"),l?s.push("return this.data.set("+K+",v)}"):s.push("return this.data["+K+"]=v}"),s.push("proto.get=function "+m+"_get("+j.join(",")+"){"),l?s.push("return this.data.get("+K+")}"):s.push("return this.data["+K+"]}"),s.push("proto.index=function "+m+"_index(",j.join(),"){return "+K+"}"),s.push("proto.hi=function "+m+"_hi("+j.join(",")+"){return new "+m+"(this.data,"+F.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+F.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var O=F.map((function(V){return"a"+V+"=this.shape["+V+"]"})),v=F.map((function(V){return"c"+V+"=this.stride["+V+"]"}));s.push("proto.lo=function "+m+"_lo("+j.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+v.join(","));for(var N=0;N<I;++N)s.push("if(typeof i"+N+"==='number'&&i"+N+">=0){d=i"+N+"|0;b+=c"+N+"*d;a"+N+"-=d}");s.push("return new "+m+"(this.data,"+F.map((function(V){return"a"+V})).join(",")+","+F.map((function(V){return"c"+V})).join(",")+",b)}"),s.push("proto.step=function "+m+"_step("+j.join(",")+"){var "+F.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+F.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(N=0;N<I;++N)s.push("if(typeof i"+N+"==='number'){d=i"+N+"|0;if(d<0){c+=b"+N+"*(a"+N+"-1);a"+N+"=ceil(-a"+N+"/d)}else{a"+N+"=ceil(a"+N+"/d)}b"+N+"*=d}");s.push("return new "+m+"(this.data,"+F.map((function(V){return"a"+V})).join(",")+","+F.map((function(V){return"b"+V})).join(",")+",c)}");var t=new Array(I),D=new Array(I);for(N=0;N<I;++N)t[N]="a[i"+N+"]",D[N]="b[i"+N+"]";s.push("proto.transpose=function "+m+"_transpose("+j+"){"+j.map((function(V,I){return V+"=("+V+"===undefined?"+I+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+m+"(this.data,"+t.join(",")+","+D.join(",")+",this.offset)}"),s.push("proto.pick=function "+m+"_pick("+j+"){var a=[],b=[],c=this.offset");for(N=0;N<I;++N)s.push("if(typeof i"+N+"==='number'&&i"+N+">=0){c=(c+this.stride["+N+"]*i"+N+")|0}else{a.push(this.shape["+N+"]);b.push(this.stride["+N+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+m+"(data,shape,stride,offset){return new "+m+"(data,"+F.map((function(V){return"shape["+V+"]"})).join(",")+","+F.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(E[V],k)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,I,m,C){if(void 0===V)return(0,E.array[0])([]);"number"===typeof V&&(V=[V]),void 0===I&&(I=[V.length]);var F=I.length;if(void 0===m){m=new Array(F);for(var k=F-1,K=1;k>=0;--k)m[k]=K,K*=I[k]}if(void 0===C){C=0;for(k=0;k<F;++k)m[k]<0&&(C-=(I[k]-1)*m[k])}for(var Y=function(V){if(l(V))return"buffer";if(s)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),X=E[Y];X.length<=F+1;)X.push(j(Y,X.length-1));return(0,X[F+1])(V,I,m,C)}},13140:V=>{function I(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(I(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&I(V.slice(0,0))}(V)||!!V._isBuffer)}},13273:V=>{"use strict";var I=[],m=[],C=[],l=[],s=[],F=[],k=[],j=[],E=[],K=[],Y=[],X=[];V.exports=function(V,O,v,N,t,D){for(var b=k,T=E,n=K,x=X,S=0;S<3;S++)b[S]=+v[S],n[S]=+O.max[S],T[S]=+O.base[S];D||(D=1e-10);var c=function(V,k,E,K,X,O){var v=I,N=m,t=C,D=l,b=s,T=F,n=j,x=Math.floor,S=0,c=0,H=0,y=0,z=0;if(Z(),0===H)return 0;for(y=Q();c<=H;){if(B(y)&&W())return S;y=Q()}for(S+=H,z=0;z<3;z++)K[z]+=E[z],X[z]+=E[z];return S;function Z(){if(c=0,0!==(H=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])))for(var V=0;V<3;V++){var I=E[V]>=0;D[V]=I?1:-1;var m=I?X[V]:K[V];v[V]=I?K[V]:X[V],N[V]=G(m,D[V]),t[V]=r(v[V],D[V]),n[V]=E[V]/H,b[V]=Math.abs(1/n[V]);var C=I?N[V]+1-m:m-N[V];T[V]=b[V]<1/0?b[V]*C:1/0}}function B(I){for(var m=D[0],C=0===I?N[0]:t[0],l=N[0]+m,s=D[1],F=1===I?N[1]:t[1],k=N[1]+s,j=D[2],E=2===I?N[2]:t[2],K=N[2]+j,Y=C;Y!=l;Y+=m)for(var X=F;X!=k;X+=s)for(var O=E;O!=K;O+=j)if(V(Y,X,O))return!0;return!1}function W(){S+=c;var V=D[y],I=c/H,m=Y;for(z=0;z<3;z++){var C=E[z]*I;K[z]+=C,X[z]+=C,m[z]=E[z]-C}if(V>0?X[y]=Math.round(X[y]):K[y]=Math.round(K[y]),k(S,y,V,m))return!0;for(z=0;z<3;z++)E[z]=m[z];return Z(),0===H}function Q(){var V=T[0]<T[1]?T[0]<T[2]?0:2:T[1]<T[2]?1:2,I=T[V]-c;for(c=T[V],N[V]+=D[V],T[V]+=b[V],z=0;z<3;z++)v[z]+=I*n[z],t[z]=r(v[z],D[z]);return V}function G(V,I){return x(V-I*O)}function r(V,I){return x(V+I*O)}}(V,N,b,T,n,D);if(!t){for(S=0;S<3;S++)x[S]=v[S]>0?n[S]-O.max[S]:T[S]-O.base[S];O.translate(x)}return c}},13449:(V,I,m)=>{"use strict";m.d(I,{d:()=>Y});var C=m(13271),l=m(11987);class s{constructor(V,I,m,s,F,k,j){this.XE=new C(V.base,V.zE),this.QC=I,this.friction=m,this.restitution=s,this.SF=F,this.wX=k,this.cF=!!j,this.yE=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.rO=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.oj=l.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=l.create(),this._impulses=l.create(),this._sleepFrameCount=10}loadFromCopy(V){l.j(this.XE.base,V.XE.base),l.j(this.XE.zE,V.XE.zE),l.j(this.XE.max,V.XE.max),this.XE.mag=V.XE.mag,this.QC=V.QC,this.friction=V.friction,this.restitution=V.restitution,this.SF=V.SF,this.wX=V.wX,this.cF=V.cF,this.yE=V.yE,this.fluidDrag=V.fluidDrag,this.rO=V.rO,this.preventFallOffEdge=V.preventFallOffEdge,this.rolledBackLastTick=V.rolledBackLastTick,l.j(this.oj,V.oj),l.j(this.resting,V.resting),this.inFluid=V.inFluid,this._ratioInFluid=V._ratioInFluid,l.j(this._forces,V._forces),l.j(this._impulses,V._impulses),this._sleepFrameCount=V._sleepFrameCount}setPosition(V){F(V),l.Fm(V,V,this.XE.base),this.XE.translate(V),this.fj()}pF(){return l.clone(this.XE.base)}applyForce(V){F(V),l.add(this._forces,this._forces,V),this.fj()}applyImpulse(V){F(V),l.add(this._impulses,this._impulses,V),this.fj()}fj(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var F=V=>{};var k=m(13271),j=m(11987),E=m(13273);function K(){this.yE=.1,this.fluidDrag=.4,this.BF=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Y(V,I,m){V=Object.assign(new K,V),this.gravity=V.gravity||[0,-10,0],this.yE=V.yE||.1,this.BF=V.BF||2,this.fluidDrag=V.fluidDrag||.4,this.minBounceImpulse=V.minBounceImpulse,this.bodies=[],this.vX=V.vX,this.testSolid=I,this.testFluid=m}Y.prototype.VO=function(V,I,m,C,l,F){V=V||new k([0,0,0],[1,1,1]),"undefined"==typeof I&&(I=1),"undefined"==typeof m&&(m=1),"undefined"==typeof C&&(C=0),"undefined"==typeof l&&(l=1);var j=new s(V,I,m,C,l,F);return this.bodies.push(j),j},Y.prototype.IO=function(V){var I=this.bodies.indexOf(V);I<0||(this.bodies.splice(I,1),V.XE=V.wX=null)};var X=j.create(),O=j.create(),v=j.create(),N=j.create(),t=j.create(),D=j.create(),b=j.create(),T=new k([0,0,0],[1,1,1]),n=new s(T,1,1,0,1,(()=>{}),!1);function x(V,I,m){return I=m,I*=1-(1-V.ratioInFluid)**2}Y.prototype.oF=function(V){V/=1e3;var I=i(0,j.squaredLength(this.gravity));this.bodies.forEach((m=>function(V,I,m,C){j.j(t,I.resting),V.vX&&n.loadFromCopy(I);if(I.QC<=0)return j.set(I.oj,0,0,0),j.set(I._forces,0,0,0),void j.set(I._impulses,0,0,0);var l=C||0===I.SF;if(function(V,I,m,C){if(I._sleepFrameCount>0)return!1;if(C)return!0;var l=!1,s=.5*m*m*I.SF;return j.scale(R,V.gravity,s),E(V.testSolid,I.XE,R,(function(){return l=!0,!0}),!0),l}(V,I,m,l))return;I._sleepFrameCount--,function(V,I){var m=I.XE,C=Math.floor(m.base[0]),l=Math.floor(m.base[2]),s=Math.floor(m.base[1]),F=Math.floor(m.max[1]);if(!V.testFluid(C,s,l))return I.inFluid=!1,void(I.ratioInFluid=0);var k=1,E=s+1;for(;E<=F&&V.testFluid(C,E,l);)k++,E++;var K=(s+k-m.base[1])/m.zE[1];K>1&&(K=1);var Y=m.zE[0]*m.zE[1]*m.zE[2]*K,X=c;j.scale(X,V.gravity,-V.BF*Y*I.SF),I.applyForce(X),I.inFluid=!0,I.ratioInFluid=K}(V,I),P(I._forces),P(I._impulses),P(I.oj),P(I.resting),j.scale(X,I._forces,1/I.QC),j.hF(X,X,V.gravity,I.SF),j.scale(O,I._impulses,1/I.QC),j.hF(O,O,X,m),j.add(I.oj,I.oj,O),I.friction&&(H(V,0,I,O,m),H(V,1,I,O,m),H(V,2,I,O,m));var s=I.fluidDrag>=0?I.fluidDrag:V.fluidDrag,F=I.yE>=0?I.yE:V.yE,k=F,K=F;I.inFluid&&(k=x(I,k,I.fluidDragHoriz>=0?I.fluidDragHoriz:s),K=x(I,K,I.fluidDragVert>=0?I.fluidDragVert:s));k=Math.max(1-k*m/I.QC,0),K=Math.max(1-K*m/I.QC,0),j.set(S,k,K,k),j.multiply(I.oj,I.oj,S),j.scale(v,I.oj,m),j.set(I._forces,0,0,0),j.set(I._impulses,0,0,0),I.cF&&q(Z,I.XE);j.j(D,v),j.set(b,0,0,0),I.preventFallOffEdge&&function(V,I,m,C){if(!I.resting[1]||m[1]>0)return;var l=g;q(l,I.XE);for(var s=0;s<3;s+=2){j.set(r,0,0,0),r[s]=m[s];var F=!0;(F=(F=(F=(F=F&&!d(V,l.base[0]+r[0]+1e-5,l.base[1],l.base[2]+r[2]+1e-5))&&!d(V,l.max[0]+r[0]-1e-5,l.base[1],l.base[2]+r[2]+1e-5))&&!d(V,l.base[0]+r[0]+1e-5,l.base[1],l.max[2]+r[2]-1e-5))&&!d(V,l.max[0]+r[0]-1e-5,l.base[1],l.max[2]+r[2]-1e-5))?(C[s]=m[s]>0?1:-1,m[s]=0):0===s&&(j.set(h,m[0],0,0),z(V,l,h,C,I.slideOnCollision))}}(V,I,v,b);z(V,I.XE,v,I.resting,I.slideOnCollision),I.cF&&function(V,I,m,C){if(I.resting[1]>=0&&!I.inFluid)return;var l=0!==I.resting[0],s=0!==I.resting[2];if(!l&&!s)return;var F=Math.abs(C[0]/C[2]),k=4;if(!l&&F>k)return;if(!s&&F<1/k)return;j.add(W,m.base,C);var K=V.testSolid;E(K,m,C,(function(V,I,m,C){if(1!==I)return!0;C[I]=0}));var Y=m.base[1],X=I.inFluid?1.951:1.001,O=Math.floor(Y+X)-Y;j.set(Q,0,O,0);var v=!1;if(E(K,m,Q,(function(V,I,m,C){return v=!0,!0})),v)return;j.Fm(G,W,m.base),G[1]=0,z(V,m,G,B,!0);var N=i(m.base[0],W[0]),t=i(m.base[2],W[2]);if(l&&!N&&(!t||!s))return;if(s&&(!N||!l)&&!t)return;var D=!0;if(D=D&&!d(V,m.base[0]+1e-5,m.base[1],m.base[2]+1e-5),D=D&&!d(V,m.max[0]-1e-5,m.base[1],m.base[2]+1e-5),D=D&&!d(V,m.base[0]+1e-5,m.base[1],m.max[2]-1e-5),D=D&&!d(V,m.max[0]-1e-5,m.base[1],m.max[2]-1e-5),D)return;q(I.XE,m),I.resting[0]=B[0],I.resting[2]=B[2],I.rO&&I.rO()}(V,I,Z,D);for(var Y=0;Y<3;++Y)I.resting[Y]=I.resting[Y]||b[Y],N[Y]=0,I.resting[Y]&&(t[Y]||(N[Y]=-I.oj[Y]),I.oj[Y]=0);var T=j.length(N);T>.001&&(j.scale(N,N,I.QC),I.wX&&I.wX(N),I.restitution>0&&T>V.minBounceImpulse&&(j.scale(N,N,I.restitution),I.applyImpulse(N)));var y=j.squaredLength(I.oj);y>1e-5&&I.fj();V.vX&&V.vX(I)?(I.loadFromCopy(n),I.rolledBackLastTick=!0):I.rolledBackLastTick=!1}(this,m,V,I)))};var S=j.create([0,0,0]);var c=j.create();function H(V,I,m,C,l){var s=m.resting[I],F=C[I];if(!m.alwaysApplyHorizFriction||1!==I){if(0===s)return;if(s*F<=0)return}j.j(y,m.oj),y[I]=0;var k=j.length(y);if(!i(k,0)){var E=Math.abs(m.friction*V.gravity[I]*l),K=k>E?(k-E)/k:0;m.oj[(I+1)%3]*=K,m.oj[(I+2)%3]*=K}}var y=j.create();function z(V,I,m,C,l){return j.set(C,0,0,0),E(V.testSolid,I,m,(function(V,I,m,s){C[I]=m,s[I]=0,l||(s[0]=0,s[1]=0,s[2]=0)}))}var Z=new k([],[]),B=j.create(),W=j.create(),Q=j.create(),G=j.create();var r=j.create(),g=new k([],[]),h=j.create();function d(V,I,m,C){return V.testSolid(Math.floor(I),Math.floor(m-1),Math.floor(C))}var R=j.create();function i(V,I){return Math.abs(V-I)<1e-5}function q(V,I){for(var m=0;m<3;m++)V.base[m]=I.base[m],V.max[m]=I.max[m],V.zE[m]=I.zE[m]}var P=function(V){}},11862:function(V,I){!function(V){"use strict";var I=function(V,m){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,I){V.__proto__=I}||function(V,I){for(var m in I)Object.prototype.hasOwnProperty.call(I,m)&&(V[m]=I[m])},I(V,m)};function m(V,m){if("function"!==typeof m&&null!==m)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function C(){this.constructor=V}I(V,m),V.prototype=null===m?Object.create(m):(C.prototype=m.prototype,new C)}function C(V,I,m,C){var l,s=arguments.length,F=s<3?I:null===C?C=Object.getOwnPropertyDescriptor(I,m):C;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)F=Reflect.decorate(V,I,m,C);else for(var k=V.length-1;k>=0;k--)(l=V[k])&&(F=(s<3?l(F):s>3?l(I,m,F):l(I,m))||F);return s>3&&F&&Object.defineProperty(I,m,F),F}function l(V,I,m){if(m||2===arguments.length)for(var C,l=0,s=I.length;l<s;l++)!C&&l in I||(C||(C=Array.prototype.slice.call(I,0,l)),C[l]=I[l]);return V.concat(C||Array.prototype.slice.call(I))}var s,F=255,k=213;V.OPERATION=void 0,(s=V.OPERATION||(V.OPERATION={}))[s.ADD=128]="ADD",s[s.REPLACE=0]="REPLACE",s[s.DELETE=64]="DELETE",s[s.DELETE_AND_ADD=192]="DELETE_AND_ADD",s[s.TOUCH=1]="TOUCH",s[s.CLEAR=10]="CLEAR";var j=function(){function I(V,I,m){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=V,this.setParent(I,m)}return I.prototype.setParent=function(V,I,m){var C=this;if(this.indexes||(this.indexes=this.ref instanceof GV?this.ref._definition.indexes:{}),this.parent=V,this.parentIndex=m,I)if(this.root=I,this.ref instanceof GV){var l=this.ref._definition;for(var s in l.schema){var F=this.ref[s];if(F&&F.$changes){var k=l.indexes[s];F.$changes.setParent(this.ref,I,k)}}}else"object"===typeof this.ref&&this.ref.forEach((function(V,I){if(V instanceof GV){var m=V.$changes,l=C.ref.$changes.indexes[I];m.setParent(C.ref,C.root,l)}}))},I.prototype.operation=function(V){this.changes.set(--this.currentCustomOperation,V)},I.prototype.change=function(I,m){void 0===m&&(m=V.OPERATION.ADD);var C="number"===typeof I?I:this.indexes[I];this.assertValidIndex(C,I);var l=this.changes.get(C);l&&l.op!==V.OPERATION.DELETE&&l.op!==V.OPERATION.TOUCH||this.changes.set(C,{op:l&&l.op===V.OPERATION.DELETE?V.OPERATION.DELETE_AND_ADD:m,index:C}),this.allChanges.add(C),this.changed=!0,this.touchParents()},I.prototype.touch=function(I){var m="number"===typeof I?I:this.indexes[I];this.assertValidIndex(m,I),this.changes.has(m)||this.changes.set(m,{op:V.OPERATION.TOUCH,index:m}),this.allChanges.add(m),this.touchParents()},I.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},I.prototype.getType=function(V){if(this.ref._definition)return(I=this.ref._definition).schema[I.fieldsByIndex[V]];var I,m=(I=this.parent._definition).schema[I.fieldsByIndex[this.parentIndex]];return Object.values(m)[0]},I.prototype.getChildrenFilter=function(){var V=this.parent._definition.childFilters;return V&&V[this.parentIndex]},I.prototype.getValue=function(V){return this.ref.getByIndex(V)},I.prototype.delete=function(I){var m="number"===typeof I?I:this.indexes[I];if(void 0!==m){var C=this.getValue(m);this.changes.set(m,{op:V.OPERATION.DELETE,index:m}),this.allChanges.delete(m),delete this.caches[m],C&&C.$changes&&(C.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(I," (").concat(m,")"))},I.prototype.discard=function(I,m){var C=this;void 0===I&&(I=!1),void 0===m&&(m=!1),this.ref instanceof GV||this.changes.forEach((function(I){if(I.op===V.OPERATION.DELETE){var m=C.ref.getIndex(I.index);delete C.indexes[m]}})),this.changes.clear(),this.changed=I,m&&this.allChanges.clear(),this.currentCustomOperation=0},I.prototype.discardAll=function(){var V=this;this.changes.forEach((function(I){var m=V.getValue(I.index);m&&m.$changes&&m.$changes.discardAll()})),this.discard()},I.prototype.cache=function(V,I){this.caches[V]=I},I.prototype.clone=function(){return new I(this.ref,this.parent,this.root)},I.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},I.prototype.assertValidIndex=function(V,I){if(void 0===V)throw new Error('ChangeTree: missing index for field "'.concat(I,'"'))},I}();function E(V,I,m,C){return V[I]||(V[I]=[]),V[I].push(m),null===C||void 0===C||C.forEach((function(V,I){return m(V,I)})),function(){return Y(V[I],V[I].indexOf(m))}}function K(I){var m=this,C="string"!==typeof this.$changes.getType();this.$items.forEach((function(l,s){I.push({refId:m.$changes.refId,op:V.OPERATION.DELETE,field:s,value:void 0,previousValue:l}),C&&m.$changes.root.removeRef(l.$changes.refId)}))}function Y(V,I){if(-1===I||I>=V.length)return!1;for(var m=V.length-1,C=I;C<m;C++)V[C]=V[C+1];return V.length=m,!0}var X=function(V,I){var m=V.toString(),C=I.toString();return m<C?-1:m>C?1:0};function O(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,I){return"symbol"===typeof I||isNaN(I)?V[I]:V.at(I)},set:function(V,I,m){if("symbol"===typeof I||isNaN(I))V[I]=m;else{var C=Array.from(V.$items.keys()),l=parseInt(C[I]||I);void 0===m||null===m?V.deleteAt(l):V.setAt(l,m)}return!0},deleteProperty:function(V,I){return"number"===typeof I?V.deleteAt(I):delete V[I],!0}})}var v=function(){function I(){for(var V=[],I=0;I<arguments.length;I++)V[I]=arguments[I];this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,V)}return I.prototype.nk=function(I,m){return void 0===m&&(m=!0),E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,m?this.$items:void 0)},I.prototype.os=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return Array.isArray(V)||void 0!==V.array},Object.defineProperty(I.prototype,"length",{get:function(){return this.$items.size},set:function(V){0===V?this.clear():this.splice(V,this.length-V)},enumerable:!1,configurable:!0}),I.prototype.push=function(){for(var V,I=this,m=[],C=0;C<arguments.length;C++)m[C]=arguments[C];return m.forEach((function(m){V=I.$refId++,I.setAt(V,m)})),V},I.prototype.pop=function(){var V=Array.from(this.$indexes.values()).pop();if(void 0!==V){this.$changes.delete(V),this.$indexes.delete(V);var I=this.$items.get(V);return this.$items.delete(V),I}},I.prototype.at=function(V){var I=Array.from(this.$items.keys())[V];return this.$items.get(I)},I.prototype.setAt=function(I,m){var C,l;if(void 0!==m&&null!==m){if(this.$items.get(I)!==m){void 0!==m.$changes&&m.$changes.setParent(this,this.$changes.root,I);var s=null!==(l=null===(C=this.$changes.indexes[I])||void 0===C?void 0:C.op)&&void 0!==l?l:V.OPERATION.ADD;this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,m),this.$changes.change(I,s)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},I.prototype.deleteAt=function(V){var I=Array.from(this.$items.keys())[V];return void 0!==I&&this.$deleteAt(I)},I.prototype.$deleteAt=function(V){return this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&K.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.concat=function(){for(var V,m=[],C=0;C<arguments.length;C++)m[C]=arguments[C];return new(I.bind.apply(I,l([void 0],(V=Array.from(this.$items.values())).concat.apply(V,m),!1)))},I.prototype.join=function(V){return Array.from(this.$items.values()).join(V)},I.prototype.reverse=function(){var V=this,I=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(m,C){V.setAt(I[C],m)})),this},I.prototype.shift=function(){var V=Array.from(this.$items.keys()).shift();if(void 0!==V){var I=this.$items.get(V);return this.$deleteAt(V),I}},I.prototype.slice=function(V,m){var C=new I;return C.push.apply(C,Array.from(this.$items.values()).slice(V,m)),C},I.prototype.sort=function(V){var I=this;void 0===V&&(V=X);var m=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(V).forEach((function(V,C){I.setAt(m[C],V)})),this},I.prototype.splice=function(V,I){void 0===I&&(I=this.length-V);for(var m=Array.from(this.$items.keys()),C=[],l=V;l<V+I;l++)C.push(this.$items.get(m[l])),this.$deleteAt(m[l]);return C},I.prototype.unshift=function(){for(var V=this,I=[],m=0;m<arguments.length;m++)I[m]=arguments[m];var C=this.length,l=I.length,s=Array.from(this.$items.values());return I.forEach((function(I,m){V.setAt(m,I)})),s.forEach((function(I,m){V.setAt(l+m,I)})),C+l},I.prototype.indexOf=function(V,I){return Array.from(this.$items.values()).indexOf(V,I)},I.prototype.lastIndexOf=function(V,I){return void 0===I&&(I=this.length-1),Array.from(this.$items.values()).lastIndexOf(V,I)},I.prototype.every=function(V,I){return Array.from(this.$items.values()).every(V,I)},I.prototype.some=function(V,I){return Array.from(this.$items.values()).some(V,I)},I.prototype.forEach=function(V,I){Array.from(this.$items.values()).forEach(V,I)},I.prototype.map=function(V,I){return Array.from(this.$items.values()).map(V,I)},I.prototype.filter=function(V,I){return Array.from(this.$items.values()).filter(V,I)},I.prototype.reduce=function(V,I){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},I.prototype.reduceRight=function(V,I){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},I.prototype.find=function(V,I){return Array.from(this.$items.values()).find(V,I)},I.prototype.findIndex=function(V,I){return Array.from(this.$items.values()).findIndex(V,I)},I.prototype.fill=function(V,I,m){throw new Error("ArraySchema#fill() not implemented")},I.prototype.copyWithin=function(V,I,m){throw new Error("ArraySchema#copyWithin() not implemented")},I.prototype.toString=function(){return this.$items.toString()},I.prototype.toLocaleString=function(){return this.$items.toLocaleString()},I.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},I.prototype.includes=function(V,I){return Array.from(this.$items.values()).includes(V,I)},I.prototype.flatMap=function(V,I){throw new Error("ArraySchema#flatMap() is not supported.")},I.prototype.flat=function(V){throw new Error("ArraySchema#flat() is not supported.")},I.prototype.findLast=function(){var V=Array.from(this.$items.values());return V.findLast.apply(V,arguments)},I.prototype.findLastIndex=function(){var V=Array.from(this.$items.values());return V.findLastIndex.apply(V,arguments)},I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){return this.toArray().map((function(V){return"function"===typeof V.toJSON?V.toJSON():V}))},I.prototype.clone=function(V){return V?new(I.bind.apply(I,l([void 0],Array.from(this.$items.values()),!1))):new(I.bind.apply(I,l([void 0],this.map((function(V){return V.$changes?V.clone():V})),!1)))},I}();function N(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,I){return"symbol"!==typeof I&&"undefined"===typeof V[I]?V.get(I):V[I]},set:function(V,I,m){return"symbol"!==typeof I&&-1===I.indexOf("$")&&"nk"!==I&&"os"!==I&&"onChange"!==I?V.set(I,m):V[I]=m,!0},deleteProperty:function(V,I){return V.delete(I),!0}})}var t=function(){function I(V){var m=this;if(this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V)if(V instanceof Map||V instanceof I)V.forEach((function(V,I){return m.set(I,V)}));else for(var C in V)this.set(C,V[C])}return I.prototype.nk=function(I,m){return void 0===m&&(m=!0),E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,m?this.$items:void 0)},I.prototype.os=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return void 0!==V.map},I.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(I.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.set=function(I,m){if(void 0===m||null===m)throw new Error("MapSchema#set('".concat(I,"', ").concat(m,"): trying to set ").concat(m," value on '").concat(I,"'."));I=I.toString();var C="undefined"!==typeof this.$changes.indexes[I],l=C?this.$changes.indexes[I]:this.$refId++,s=C?V.OPERATION.REPLACE:V.OPERATION.ADD,F=void 0!==m.$changes;if(F&&m.$changes.setParent(this,this.$changes.root,l),C){if(!F&&this.$items.get(I)===m)return;F&&this.$items.get(I)!==m&&(s=V.OPERATION.ADD)}else this.$changes.indexes[I]=l,this.$indexes.set(l,I);return this.$items.set(I,m),this.$changes.change(I,s),this},I.prototype.get=function(V){return this.$items.get(V)},I.prototype.delete=function(V){return this.$changes.delete(V),this.$items.delete(V)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&K.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(V){return this.$items.has(V)},I.prototype.forEach=function(V){this.$items.forEach(V)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toJSON=function(){var V={};return this.forEach((function(I,m){V[m]="function"===typeof I.toJSON?I.toJSON():I})),V},I.prototype.clone=function(V){var m;return V?m=Object.assign(new I,this):(m=new I,this.forEach((function(V,I){V.$changes?m.set(I,V.clone()):m.set(I,V)}))),m},I}(),D={};function b(V,I){D[V]=I}function T(V){return D[V]}var n=function(){function V(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return V.create=function(I){var m=new V;return m.schema=Object.assign({},I&&I.schema||{}),m.indexes=Object.assign({},I&&I.indexes||{}),m.fieldsByIndex=Object.assign({},I&&I.fieldsByIndex||{}),m.descriptors=Object.assign({},I&&I.descriptors||{}),m.deprecated=Object.assign({},I&&I.deprecated||{}),m},V.prototype.addField=function(V,I){var m=this.getNextFieldIndex();this.fieldsByIndex[m]=V,this.indexes[V]=m,this.schema[V]=Array.isArray(I)?{array:I[0]}:I},V.prototype.hasField=function(V){return void 0!==this.indexes[V]},V.prototype.addFilter=function(V,I){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[V]]=I,this.indexesWithFilters.push(this.indexes[V]),!0},V.prototype.addChildrenFilter=function(V,I){var m=this.indexes[V],C=this.schema[V];if(T(Object.keys(C)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[m]=I,!0;console.warn("@filterChildren: field '".concat(V,"' can't have children. Ignoring filter."))},V.prototype.getChildrenFilter=function(V){return this.childFilters&&this.childFilters[this.indexes[V]]},V.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},V}();function x(V){return V._context&&V._context.useFilters}var S=function(){function V(){this.types={},this.schemas=new Map,this.useFilters=!1}return V.prototype.has=function(V){return this.schemas.has(V)},V.prototype.get=function(V){return this.types[V]},V.prototype.add=function(V,I){void 0===I&&(I=this.schemas.size),V._definition=n.create(V._definition),V._typeid=I,this.types[I]=V,this.schemas.set(V,I)},V.create=function(I){return void 0===I&&(I={}),function(m){return I.context||(I.context=new V),H(m,I)}},V}(),c=new S;function H(V,I){return void 0===I&&(I={}),function(m,C){var s=I.context||c,F=m.constructor;if(F._context=s,!V)throw new Error("".concat(F.name,': @type() reference provided for "').concat(C,"\" is undefined. Make sure you don't have any circular dependencies."));s.has(F)||s.add(F);var k=F._definition;if(k.addField(C,V),k.descriptors[C]){if(k.deprecated[C])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(C,"' definition on '").concat(F.name,"'.\nCheck @type() annotation"))}catch(D){var j=D.stack.split("\n")[4].trim();throw new Error("".concat(D.message," ").concat(j))}}var E=v.is(V),K=!E&&t.is(V);if("string"!==typeof V&&!GV.is(V)){var Y=Object.values(V)[0];"string"===typeof Y||s.has(Y)||s.add(Y)}if(I.manual)k.descriptors[C]={enumerable:!0,configurable:!0,writable:!0};else{var X="_".concat(C);k.descriptors[X]={enumerable:!1,configurable:!1,writable:!0},k.descriptors[C]={get:function(){return this[X]},set:function(V){V!==this[X]&&(void 0!==V&&null!==V?(!E||V instanceof v||(V=new(v.bind.apply(v,l([void 0],V,!1)))),!K||V instanceof t||(V=new t(V)),void 0===V.$proxy&&(K?V=N(V):E&&(V=O(V))),this.$changes.change(C),V.$changes&&V.$changes.setParent(this,this.$changes.root,this._definition.indexes[C])):this[X]&&this.$changes.delete(C),this[X]=V)},enumerable:!0,configurable:!0}}}}function y(V){return function(I,m){var C=I.constructor;C._definition.addFilter(m,V)&&(C._context.useFilters=!0)}}function z(V){return function(I,m){var C=I.constructor;C._definition.addChildrenFilter(m,V)&&(C._context.useFilters=!0)}}function Z(V){return void 0===V&&(V=!0),function(I,m){var C=I.constructor._definition;C.deprecated[m]=!0,V&&(C.descriptors[m]={get:function(){throw new Error("".concat(m," is deprecated."))},set:function(V){},enumerable:!1,configurable:!0})}}function B(V,I,m){for(var C in void 0===m&&(m={}),m.context||(m.context=V._context||m.context||c),I)H(I[C],m)(V.prototype,C);return V}function W(V){for(var I=0,m=0,C=0,l=V.length;C<l;C++)(I=V.charCodeAt(C))<128?m+=1:I<2048?m+=2:I<55296||I>=57344?m+=3:(C++,m+=4);return m}function Q(V,I,m){for(var C=0,l=0,s=m.length;l<s;l++)(C=m.charCodeAt(l))<128?V[I++]=C:C<2048?(V[I++]=192|C>>6,V[I++]=128|63&C):C<55296||C>=57344?(V[I++]=224|C>>12,V[I++]=128|C>>6&63,V[I++]=128|63&C):(l++,C=65536+((1023&C)<<10|1023&m.charCodeAt(l)),V[I++]=240|C>>18,V[I++]=128|C>>12&63,V[I++]=128|C>>6&63,V[I++]=128|63&C)}function G(V,I){V.push(255&I)}function r(V,I){V.push(255&I)}function g(V,I){V.push(255&I),V.push(I>>8&255)}function h(V,I){V.push(255&I),V.push(I>>8&255)}function d(V,I){V.push(255&I),V.push(I>>8&255),V.push(I>>16&255),V.push(I>>24&255)}function R(V,I){var m=I>>24,C=I>>16,l=I>>8,s=I;V.push(255&s),V.push(255&l),V.push(255&C),V.push(255&m)}function i(V,I){var m=Math.floor(I/Math.pow(2,32));R(V,I>>>0),R(V,m)}function q(V,I){var m=I/Math.pow(2,32)|0;R(V,I>>>0),R(V,m)}function P(V,I){f(V,I)}function u(V,I){w(V,I)}var o=new Int32Array(2),p=new Float32Array(o.buffer),M=new Float64Array(o.buffer);function f(V,I){p[0]=I,d(V,o[0])}function w(V,I){M[0]=I,d(V,o[0]),d(V,o[1])}function A(V,I){return r(V,I?1:0)}function J(V,I){I||(I="");var m=W(I),C=0;if(m<32)V.push(160|m),C=1;else if(m<256)V.push(217),r(V,m),C=2;else if(m<65536)V.push(218),h(V,m),C=3;else{if(!(m<4294967296))throw new Error("String too long");V.push(219),R(V,m),C=5}return Q(V,V.length,I),C+m}function U(V,I){return isNaN(I)?U(V,0):isFinite(I)?I!==(0|I)?(V.push(203),w(V,I),9):I>=0?I<128?(r(V,I),1):I<256?(V.push(204),r(V,I),2):I<65536?(V.push(205),h(V,I),3):I<4294967296?(V.push(206),R(V,I),5):(V.push(207),q(V,I),9):I>=-32?(V.push(224|I+32),1):I>=-128?(V.push(208),G(V,I),2):I>=-32768?(V.push(209),g(V,I),3):I>=-2147483648?(V.push(210),d(V,I),5):(V.push(211),i(V,I),9):U(V,I>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var e=Object.freeze({__proto__:null,utf8Write:Q,int8:G,uint8:r,int16:g,uint16:h,int32:d,uint32:R,int64:i,uint64:q,float32:P,float64:u,writeFloat32:f,writeFloat64:w,boolean:A,string:J,number:U});function a(V,I,m){for(var C="",l=0,s=I,F=I+m;s<F;s++){var k=V[s];0!==(128&k)?192!==(224&k)?224!==(240&k)?240!==(248&k)?console.error("Invalid byte "+k.toString(16)):(l=(7&k)<<18|(63&V[++s])<<12|(63&V[++s])<<6|63&V[++s])>=65536?(l-=65536,C+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):C+=String.fromCharCode(l):C+=String.fromCharCode((15&k)<<12|(63&V[++s])<<6|63&V[++s]):C+=String.fromCharCode((31&k)<<6|63&V[++s]):C+=String.fromCharCode(k)}return C}function L(V,I){return VV(V,I)<<24>>24}function VV(V,I){return V[I.offset++]}function IV(V,I){return mV(V,I)<<16>>16}function mV(V,I){return V[I.offset++]|V[I.offset++]<<8}function CV(V,I){return V[I.offset++]|V[I.offset++]<<8|V[I.offset++]<<16|V[I.offset++]<<24}function lV(V,I){return CV(V,I)>>>0}function sV(V,I){return XV(V,I)}function FV(V,I){return OV(V,I)}function kV(V,I){var m=lV(V,I);return CV(V,I)*Math.pow(2,32)+m}function jV(V,I){var m=lV(V,I);return lV(V,I)*Math.pow(2,32)+m}var EV=new Int32Array(2),KV=new Float32Array(EV.buffer),YV=new Float64Array(EV.buffer);function XV(V,I){return EV[0]=CV(V,I),KV[0]}function OV(V,I){return EV[0]=CV(V,I),EV[1]=CV(V,I),YV[0]}function vV(V,I){return VV(V,I)>0}function NV(V,I){var m,C=V[I.offset++];C<192?m=31&C:217===C?m=VV(V,I):218===C?m=mV(V,I):219===C&&(m=lV(V,I));var l=a(V,I.offset,m);return I.offset+=m,l}function tV(V,I){var m=V[I.offset];return m<192&&m>160||217===m||218===m||219===m}function DV(V,I){var m=V[I.offset++];return m<128?m:202===m?XV(V,I):203===m?OV(V,I):204===m?VV(V,I):205===m?mV(V,I):206===m?lV(V,I):207===m?jV(V,I):208===m?L(V,I):209===m?IV(V,I):210===m?CV(V,I):211===m?kV(V,I):m>223?-1*(255-m+1):void 0}function bV(V,I){var m=V[I.offset];return m<128||m>=202&&m<=211}function TV(V,I){return V[I.offset]<160}function nV(V,I){return V[I.offset-1]===F&&(V[I.offset]<128||V[I.offset]>=202&&V[I.offset]<=211)}var xV=Object.freeze({__proto__:null,int8:L,uint8:VV,int16:IV,uint16:mV,int32:CV,uint32:lV,float32:sV,float64:FV,int64:kV,uint64:jV,readFloat32:XV,readFloat64:OV,boolean:vV,string:NV,stringCheck:tV,number:DV,numberCheck:bV,arrayCheck:TV,switchStructureCheck:nV}),SV=function(){function I(V){var I=this;this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return I.add(V)}))}return I.prototype.nk=function(I,m){return void 0===m&&(m=!0),E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,m?this.$items:void 0)},I.prototype.os=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return void 0!==V.collection},I.prototype.add=function(V){var I=this.$refId++;return void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,I),this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,V),this.$changes.change(I),I},I.prototype.at=function(V){var I=Array.from(this.$items.keys())[V];return this.$items.get(I)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(V){for(var I,m,C=this.$items.entries();(m=C.next())&&!m.done;)if(V===m.value[1]){I=m.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&K.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(V){return Array.from(this.$items.values()).some((function(I){return I===V}))},I.prototype.forEach=function(V){var I=this;this.$items.forEach((function(m,C,l){return V(m,C,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var V=[];return this.forEach((function(I,m){V.push("function"===typeof I.toJSON?I.toJSON():I)})),V},I.prototype.clone=function(V){var m;return V?m=Object.assign(new I,this):(m=new I,this.forEach((function(V){V.$changes?m.add(V.clone()):m.add(V)}))),m},I}(),cV=function(){function I(V){var I=this;this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return I.add(V)}))}return I.prototype.nk=function(I,m){return void 0===m&&(m=!0),E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,m?this.$items:void 0)},I.prototype.os=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return void 0!==V.set},I.prototype.add=function(I){var m,C;if(this.has(I))return!1;var l=this.$refId++;void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,l);var s=null!==(C=null===(m=this.$changes.indexes[l])||void 0===m?void 0:m.op)&&void 0!==C?C:V.OPERATION.ADD;return this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,I),this.$changes.change(l,s),l},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(V){for(var I,m,C=this.$items.entries();(m=C.next())&&!m.done;)if(V===m.value[1]){I=m.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&K.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(V){for(var I,m=this.$items.values(),C=!1;(I=m.next())&&!I.done;)if(V===I.value){C=!0;break}return C},I.prototype.forEach=function(V){var I=this;this.$items.forEach((function(m,C,l){return V(m,C,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var V=[];return this.forEach((function(I,m){V.push("function"===typeof I.toJSON?I.toJSON():I)})),V},I.prototype.clone=function(V){var m;return V?m=Object.assign(new I,this):(m=new I,this.forEach((function(V){V.$changes?m.add(V.clone()):m.add(V)}))),m},I}(),HV=function(){function V(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return V.prototype.addRefId=function(V){this.refIds.has(V)||(this.refIds.add(V),this.containerIndexes.set(V,new Set))},V.get=function(I){return void 0===I.$filterState&&(I.$filterState=new V),I.$filterState},V}(),yV=function(){function V(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return V.prototype.getNextUniqueId=function(){return this.nextUniqueId++},V.prototype.addRef=function(V,I,m){void 0===m&&(m=!0),this.refs.set(V,I),m&&(this.refCounts[V]=(this.refCounts[V]||0)+1)},V.prototype.removeRef=function(V){this.refCounts[V]=this.refCounts[V]-1,this.deletedRefs.add(V)},V.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},V.prototype.garbageCollectDeletedRefs=function(){var V=this;this.deletedRefs.forEach((function(I){if(!(V.refCounts[I]>0)){var m=V.refs.get(I);if(m instanceof GV)for(var C in m._definition.schema)"string"!==typeof m._definition.schema[C]&&m[C]&&m[C].$changes&&V.removeRef(m[C].$changes.refId);else{var l=m.$changes.parent._definition,s=l.schema[l.fieldsByIndex[m.$changes.parentIndex]];"function"===typeof Object.values(s)[0]&&Array.from(m.values()).forEach((function(I){return V.removeRef(I.$changes.refId)}))}V.refs.delete(I),delete V.refCounts[I]}})),this.deletedRefs.clear()},V}(),zV=function(V){function I(){return null!==V&&V.apply(this,arguments)||this}return m(I,V),I}(Error);function ZV(V,I,m,C){var l,s=!1;switch(I){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":l="number",isNaN(V)&&console.log('trying to encode "NaN" in '.concat(m.constructor.name,"#").concat(C));break;case"string":l="string",s=!0;break;case"boolean":return}if(typeof V!==l&&(!s||s&&null!==V)){var F="'".concat(JSON.stringify(V),"'").concat(V&&V.constructor&&" (".concat(V.constructor.name,")")||"");throw new zV("a '".concat(l,"' was expected, but ").concat(F," was provided in ").concat(m.constructor.name,"#").concat(C))}}function BV(V,I,m,C){if(!(V instanceof I))throw new zV("a '".concat(I.name,"' was expected, but '").concat(V.constructor.name,"' was provided in ").concat(m.constructor.name,"#").concat(C))}function WV(V,I,m,C,l){ZV(m,V,C,l);var s=e[V];if(!s)throw new zV("a '".concat(V,"' was expected, but ").concat(m," was provided in ").concat(C.constructor.name,"#").concat(l));s(I,m)}function QV(V,I,m){return xV[V](I,m)}var GV=function(){function I(){for(var V=[],I=0;I<arguments.length;I++)V[I]=arguments[I];Object.defineProperties(this,{$changes:{value:new j(this,void 0,new yV),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var m=this._definition.descriptors;m&&Object.defineProperties(this,m),V[0]&&this.assign(V[0])}return I.onError=function(V){console.error(V)},I.is=function(V){return V._definition&&void 0!==V._definition.schema},I.prototype.onChange=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.prototype.os=function(I){return E(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.assign=function(V){return Object.assign(this,V),this},Object.defineProperty(I.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),I.prototype.setDirty=function(V,I){this.$changes.change(V,I)},I.prototype.listen=function(V,I,m){var C=this;return void 0===m&&(m=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[V]||(this.$callbacks[V]=[]),this.$callbacks[V].push(I),m&&void 0!==this[V]&&I(this[V],void 0),function(){return Y(C.$callbacks[V],C.$callbacks[V].indexOf(I))}},I.prototype.decode=function(m,C,l){var s;void 0===C&&(C={offset:0}),void 0===l&&(l=this);var k=[],j=this.$changes.root,E=m.length,K=0;for(j.refs.set(K,this);C.offset<E;){var Y=m[C.offset++];if(Y!=F){var X=l.$changes,O=void 0!==l._definition,N=O?Y>>6<<6:Y;if(N!==V.OPERATION.CLEAR){var D=O?Y%(N||255):DV(m,C),b=O?l._definition.fieldsByIndex[D]:"",n=X.getType(D),x=void 0,S=void 0,c=void 0;if(O?S=l["_".concat(b)]:(S=l.getByIndex(D),(N&V.OPERATION.ADD)===V.OPERATION.ADD?(c=l instanceof t?NV(m,C):D,l.setIndex(D,c)):c=l.getIndex(D)),(N&V.OPERATION.DELETE)===V.OPERATION.DELETE&&(N!==V.OPERATION.DELETE_AND_ADD&&l.deleteByIndex(D),S&&S.$changes&&j.removeRef(S.$changes.refId),x=null),void 0!==b){if(N===V.OPERATION.DELETE);else if(I.is(n)){var H=DV(m,C);if(x=j.refs.get(H),N!==V.OPERATION.REPLACE){var y=this.getSchemaType(m,C,n);x||((x=this.createTypeInstance(y)).$changes.refId=H,S&&(x.$callbacks=S.$callbacks,S.$changes.refId&&H!==S.$changes.refId&&j.removeRef(S.$changes.refId))),j.addRef(H,x,x!==S)}}else if("string"===typeof n)x=QV(n,m,C);else{var z=T(Object.keys(n)[0]),Z=DV(m,C),B=j.refs.has(Z)?S||j.refs.get(Z):new z.constructor;if((x=B.clone(!0)).$changes.refId=Z,S&&(x.$callbacks=S.$callbacks,S.$changes.refId&&Z!==S.$changes.refId)){j.removeRef(S.$changes.refId);for(var W=S.entries(),Q=void 0;(Q=W.next())&&!Q.done;){var G=(s=Q.value)[0],r=s[1];k.push({refId:Z,op:V.OPERATION.DELETE,field:G,value:void 0,previousValue:r})}}j.addRef(Z,x,B!==S)}if(null!==x&&void 0!==x)if(x.$changes&&x.$changes.setParent(X.ref,X.root,D),l instanceof I)l[b]=x;else if(l instanceof t)G=c,l.$items.set(G,x),l.$changes.allChanges.add(D);else if(l instanceof v)l.setAt(D,x);else if(l instanceof SV){var g=l.add(x);l.setIndex(D,g)}else l instanceof cV&&!1!==(g=l.add(x))&&l.setIndex(D,g);S!==x&&k.push({refId:K,op:N,field:b,dynamicIndex:c,value:x,previousValue:S})}else{console.warn("@colyseus/schema: definition mismatch");for(var h={offset:C.offset};C.offset<E&&(!nV(m,C)||(h.offset=C.offset+1,!j.refs.has(DV(m,h))));)C.offset++}}else l.clear(k)}else{K=DV(m,C);var d=j.refs.get(K);if(!d)throw new Error('"refId" not found: '.concat(K));l=d}}return this._triggerChanges(k),j.garbageCollectDeletedRefs(),k},I.prototype.encode=function(m,C,l){void 0===m&&(m=!1),void 0===C&&(C=[]),void 0===l&&(l=!1);for(var s=this.$changes,k=new WeakSet,j=[s],E=1,K=0;K<E;K++){var Y=j[K],X=Y.ref,O=X instanceof I;Y.ensureRefId(),k.add(Y),Y!==s&&(Y.changed||m)&&(r(C,F),U(C,Y.refId));for(var v=m?Array.from(Y.allChanges):Array.from(Y.changes.values()),N=0,D=v.length;N<D;N++){var b=m?{op:V.OPERATION.ADD,index:v[N]}:v[N],n=b.index,x=O?X._definition.fieldsByIndex&&X._definition.fieldsByIndex[n]:n,S=C.length;if(b.op!==V.OPERATION.TOUCH)if(O)r(C,n|b.op);else{if(r(C,b.op),b.op===V.OPERATION.CLEAR)continue;U(C,n)}if(O||(b.op&V.OPERATION.ADD)!=V.OPERATION.ADD||X instanceof t&&J(C,Y.ref.$indexes.get(n)),b.op!==V.OPERATION.DELETE){var c=Y.getType(n),H=Y.getValue(n);if(H&&H.$changes&&!k.has(H.$changes)&&(j.push(H.$changes),H.$changes.ensureRefId(),E++),b.op!==V.OPERATION.TOUCH){if(I.is(c))BV(H,c,X,x),U(C,H.$changes.refId),(b.op&V.OPERATION.ADD)===V.OPERATION.ADD&&this.tryEncodeTypeId(C,c,H.constructor);else if("string"===typeof c)WV(c,C,H,X,x);else{var y=T(Object.keys(c)[0]);BV(X["_".concat(x)],y.constructor,X,x),U(C,H.$changes.refId)}l&&Y.cache(n,C.slice(S))}}}m||l||Y.discard()}return C},I.prototype.encodeAll=function(V){return this.encode(!0,[],V)},I.prototype.applyFilters=function(m,C){var l,s;void 0===C&&(C=!1);for(var k=this,j=new Set,E=HV.get(m),K=[this.$changes],Y=1,X=[],O=function(O){var v=K[O];if(j.has(v.refId))return"continue";var N=v.ref,D=N instanceof I;r(X,F),U(X,v.refId);var b=E.refIds.has(v),T=C||!b;E.addRefId(v);var n=E.containerIndexes.get(v),x=T?Array.from(v.allChanges):Array.from(v.changes.values());!C&&D&&N._definition.indexesWithFilters&&N._definition.indexesWithFilters.forEach((function(I){!n.has(I)&&v.allChanges.has(I)&&(T?x.push(I):x.push({op:V.OPERATION.ADD,index:I}))}));for(var S=0,c=x.length;S<c;S++){var H=T?{op:V.OPERATION.ADD,index:x[S]}:x[S];if(H.op!==V.OPERATION.CLEAR){var y=H.index;if(H.op!==V.OPERATION.DELETE){var z=v.getValue(y),Z=v.getType(y);if(D){if((B=N._definition.filters&&N._definition.filters[y])&&!B.call(N,m,z,k)){z&&z.$changes&&j.add(z.$changes.refId);continue}}else{var B,W=v.parent;if((B=v.getChildrenFilter())&&!B.call(W,m,N.$indexes.get(y),z,k)){z&&z.$changes&&j.add(z.$changes.refId);continue}}if(z.$changes&&(K.push(z.$changes),Y++),H.op!==V.OPERATION.TOUCH)if(H.op===V.OPERATION.ADD||D)X.push.apply(X,null!==(l=v.caches[y])&&void 0!==l?l:[]),n.add(y);else if(n.has(y))X.push.apply(X,null!==(s=v.caches[y])&&void 0!==s?s:[]);else{if(n.add(y),r(X,V.OPERATION.ADD),U(X,y),N instanceof t){var Q=v.ref.$indexes.get(y);J(X,Q)}z.$changes?U(X,z.$changes.refId):e[Z](X,z)}else z.$changes&&!D&&(r(X,V.OPERATION.ADD),U(X,y),N instanceof t&&(Q=v.ref.$indexes.get(y),J(X,Q)),U(X,z.$changes.refId))}else D?r(X,H.op|y):(r(X,H.op),U(X,y))}else r(X,H.op)}},v=0;v<Y;v++)O(v);return X},I.prototype.clone=function(){var V,I=new this.constructor,m=this._definition.schema;for(var C in m)"object"===typeof this[C]&&"function"===typeof(null===(V=this[C])||void 0===V?void 0:V.clone)?I[C]=this[C].clone():I[C]=this[C];return I},I.prototype.toJSON=function(){var V=this._definition.schema,I=this._definition.deprecated,m={};for(var C in V)I[C]||null===this[C]||"undefined"===typeof this[C]||(m[C]="function"===typeof this[C].toJSON?this[C].toJSON():this["_".concat(C)]);return m},I.prototype.discardAllChanges=function(){this.$changes.discardAll()},I.prototype.getByIndex=function(V){return this[this._definition.fieldsByIndex[V]]},I.prototype.deleteByIndex=function(V){this[this._definition.fieldsByIndex[V]]=void 0},I.prototype.tryEncodeTypeId=function(V,I,m){I._typeid!==m._typeid&&(r(V,k),U(V,m._typeid))},I.prototype.getSchemaType=function(V,I,m){var C;return V[I.offset]===k&&(I.offset++,C=this.constructor._context.get(DV(V,I))),C||m},I.prototype.createTypeInstance=function(V){var I=new V;return I.$changes.root=this.$changes.root,I},I.prototype._triggerChanges=function(m){for(var C,l,s,F,k,j,E,K,Y,X=new Set,O=this.$changes.root.refs,v=function(v){var N=m[v],t=N.refId,D=O.get(t),b=D.$callbacks;if((N.op&V.OPERATION.DELETE)===V.OPERATION.DELETE&&N.previousValue instanceof I&&(null===(l=null===(C=N.previousValue.$callbacks)||void 0===C?void 0:C[V.OPERATION.DELETE])||void 0===l||l.forEach((function(V){return V()}))),!b)return"continue";if(D instanceof I){if(!X.has(t))try{null===(s=null===b||void 0===b?void 0:b[V.OPERATION.REPLACE])||void 0===s||s.forEach((function(V){return V()}))}catch(T){I.onError(T)}try{b.hasOwnProperty(N.field)&&(null===(F=b[N.field])||void 0===F||F.forEach((function(V){return V(N.value,N.previousValue)})))}catch(T){I.onError(T)}}else N.op===V.OPERATION.ADD&&void 0===N.previousValue?null===(k=b[V.OPERATION.ADD])||void 0===k||k.forEach((function(V){var I;return V(N.value,null!==(I=N.dynamicIndex)&&void 0!==I?I:N.field)})):N.op===V.OPERATION.DELETE?void 0!==N.previousValue&&(null===(j=b[V.OPERATION.DELETE])||void 0===j||j.forEach((function(V){var I;return V(N.previousValue,null!==(I=N.dynamicIndex)&&void 0!==I?I:N.field)}))):N.op===V.OPERATION.DELETE_AND_ADD&&(void 0!==N.previousValue&&(null===(E=b[V.OPERATION.DELETE])||void 0===E||E.forEach((function(V){var I;return V(N.previousValue,null!==(I=N.dynamicIndex)&&void 0!==I?I:N.field)}))),null===(K=b[V.OPERATION.ADD])||void 0===K||K.forEach((function(V){var I;return V(N.value,null!==(I=N.dynamicIndex)&&void 0!==I?I:N.field)}))),N.value!==N.previousValue&&(null===(Y=b[V.OPERATION.REPLACE])||void 0===Y||Y.forEach((function(V){var I;return V(N.value,null!==(I=N.dynamicIndex)&&void 0!==I?I:N.field)})));X.add(t)},N=0;N<m.length;N++)v(N)},I._definition=n.create(),I}();function rV(V){for(var I=[V.$changes],m=1,C={},l=C,s=function(V){var m=I[V];m.changes.forEach((function(V){var I=m.ref,C=V.index,s=I._definition?I._definition.fieldsByIndex[C]:I.$indexes.get(C);l[s]=m.getValue(C)}))},F=0;F<m;F++)s(F);return C}var gV={context:new S},hV=function(V){function I(){return null!==V&&V.apply(this,arguments)||this}return m(I,V),C([H("string",gV)],I.prototype,"name",void 0),C([H("string",gV)],I.prototype,"type",void 0),C([H("number",gV)],I.prototype,"referencedType",void 0),I}(GV),dV=function(V){function I(){var I=null!==V&&V.apply(this,arguments)||this;return I.fields=new v,I}return m(I,V),C([H("number",gV)],I.prototype,"id",void 0),C([H([hV],gV)],I.prototype,"fields",void 0),I}(GV),RV=function(V){function I(){var I=null!==V&&V.apply(this,arguments)||this;return I.types=new v,I}return m(I,V),I.encode=function(V){var m=V.constructor,C=new I;C.rootType=m._typeid;var l=function(V,I){for(var m in I){var l=new hV;l.name=m;var s=void 0;if("string"===typeof I[m])s=I[m];else{var F=I[m],k=void 0;GV.is(F)?(s="ref",k=I[m]):"string"===typeof F[s=Object.keys(F)[0]]?s+=":"+F[s]:k=F[s],l.referencedType=k?k._typeid:-1}l.type=s,V.fields.push(l)}C.types.push(V)},s=m._context.types;for(var F in s){var k=new dV;k.id=Number(F),l(k,s[F]._definition.schema)}return C.encodeAll()},I.decode=function(V,C){var l=new S,s=new I;s.decode(V,C);var F=s.types.reduce((function(V,I){var C=function(V){function I(){return null!==V&&V.apply(this,arguments)||this}return m(I,V),I}(GV),s=I.id;return V[s]=C,l.add(C,s),V}),{});s.types.forEach((function(V){var I=F[V.id];V.fields.forEach((function(V){var m;if(void 0!==V.referencedType){var C=V.type,s=F[V.referencedType];if(!s){var k=V.type.split(":");C=k[0],s=k[1]}"ref"===C?H(s,{context:l})(I.prototype,V.name):H(((m={})[C]=s,m),{context:l})(I.prototype,V.name)}else H(V.type,{context:l})(I.prototype,V.name)}))}));var k=F[s.rootType],j=new k;for(var E in k._definition.schema){var K=k._definition.schema[E];"string"!==typeof K&&(j[E]="function"===typeof K?new K:new(T(Object.keys(K)[0]).constructor))}return j},C([H([dV],gV)],I.prototype,"types",void 0),C([H("number",gV)],I.prototype,"rootType",void 0),I}(GV);b("map",{constructor:t}),b("array",{constructor:v}),b("set",{constructor:cV}),b("collection",{constructor:SV}),V.ArraySchema=v,V.CollectionSchema=SV,V.Context=S,V.MapSchema=t,V.Reflection=RV,V.ReflectionField=hV,V.ReflectionType=dV,V.Schema=GV,V.SchemaDefinition=n,V.SetSchema=cV,V.decode=xV,V.defineTypes=B,V.deprecated=Z,V.dumpChanges=rV,V.encode=e,V.filter=y,V.filterChildren=z,V.hasFilter=x,V.registerType=b,V.type=H,Object.defineProperty(V,"__esModule",{value:!0})}(I)},13316:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13308:(V,I,m)=>{var C=m(13316),l=m(13324),s=Object.hasOwnProperty,F=Object.create(null);for(var k in C)s.call(C,k)&&(F[C[k]]=k);var j=V.exports={to:{},get:{}};function E(V,I,m){return Math.min(Math.max(I,V),m)}function K(V){var I=Math.round(V).toString(16).toUpperCase();return I.length<2?"0"+I:I}j.get=function(V){var I,m;switch(V.substring(0,3).toLowerCase()){case"hsl":I=j.get.hsl(V),m="hsl";break;case"hwb":I=j.get.hwb(V),m="hwb";break;default:I=j.get.rgb(V),m="rgb"}return I?{model:m,value:I}:null},j.get.rgb=function(V){if(!V)return null;var I,m,l,F=[0,0,0,1];if(I=V.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(l=I[2],I=I[1],m=0;m<3;m++){var k=2*m;F[m]=parseInt(I.slice(k,k+2),16)}l&&(F[3]=parseInt(l,16)/255)}else if(I=V.match(/^#([a-f0-9]{3,4})$/i)){for(l=(I=I[1])[3],m=0;m<3;m++)F[m]=parseInt(I[m]+I[m],16);l&&(F[3]=parseInt(l+l,16)/255)}else if(I=V.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(m=0;m<3;m++)F[m]=parseInt(I[m+1],0);I[4]&&(I[5]?F[3]=.01*parseFloat(I[4]):F[3]=parseFloat(I[4]))}else{if(!(I=V.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(I=V.match(/^(\w+)$/))?"transparent"===I[1]?[0,0,0,0]:s.call(C,I[1])?((F=C[I[1]])[3]=1,F):null:null;for(m=0;m<3;m++)F[m]=Math.round(2.55*parseFloat(I[m+1]));I[4]&&(I[5]?F[3]=.01*parseFloat(I[4]):F[3]=parseFloat(I[4]))}for(m=0;m<3;m++)F[m]=E(F[m],0,255);return F[3]=E(F[3],0,1),F},j.get.hsl=function(V){if(!V)return null;var I=V.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var m=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,E(parseFloat(I[2]),0,100),E(parseFloat(I[3]),0,100),E(isNaN(m)?1:m,0,1)]}return null},j.get.hwb=function(V){if(!V)return null;var I=V.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var m=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,E(parseFloat(I[2]),0,100),E(parseFloat(I[3]),0,100),E(isNaN(m)?1:m,0,1)]}return null},j.to.hex=function(){var V=l(arguments);return"#"+K(V[0])+K(V[1])+K(V[2])+(V[3]<1?K(Math.round(255*V[3])):"")},j.to.rgb=function(){var V=l(arguments);return V.length<4||1===V[3]?"rgb("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+")":"rgba("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+", "+V[3]+")"},j.to.rgb.percent=function(){var V=l(arguments),I=Math.round(V[0]/255*100),m=Math.round(V[1]/255*100),C=Math.round(V[2]/255*100);return V.length<4||1===V[3]?"rgb("+I+"%, "+m+"%, "+C+"%)":"rgba("+I+"%, "+m+"%, "+C+"%, "+V[3]+")"},j.to.hsl=function(){var V=l(arguments);return V.length<4||1===V[3]?"hsl("+V[0]+", "+V[1]+"%, "+V[2]+"%)":"hsla("+V[0]+", "+V[1]+"%, "+V[2]+"%, "+V[3]+")"},j.to.hwb=function(){var V=l(arguments),I="";return V.length>=4&&1!==V[3]&&(I=", "+V[3]),"hwb("+V[0]+", "+V[1]+"%, "+V[2]+"%"+I+")"},j.to.keyword=function(V){return F[V.slice(0,3)]}},13303:(V,I,m)=>{const C=m(13308),l=m(13341),s=["keyword","gray","hex"],F={};for(const O of Object.keys(l))F[[...l[O].labels].sort().join("")]=O;const k={};function j(V,I){if(!(this instanceof j))return new j(V,I);if(I&&I in s&&(I=null),I&&!(I in l))throw new Error("Unknown model: "+I);let m,E;if(null==V)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(V instanceof j)this.model=V.model,this.color=[...V.color],this.valpha=V.valpha;else if("string"===typeof V){const I=C.get(V);if(null===I)throw new Error("Unable to parse color from string: "+V);this.model=I.model,E=l[this.model].channels,this.color=I.value.slice(0,E),this.valpha="number"===typeof I.value[E]?I.value[E]:1}else if(V.length>0){this.model=I||"rgb",E=l[this.model].channels;const m=Array.prototype.slice.call(V,0,E);this.color=X(m,E),this.valpha="number"===typeof V[E]?V[E]:1}else if("number"===typeof V)this.model="rgb",this.color=[V>>16&255,V>>8&255,255&V],this.valpha=1;else{this.valpha=1;const I=Object.keys(V);"alpha"in V&&(I.splice(I.indexOf("alpha"),1),this.valpha="number"===typeof V.alpha?V.alpha:0);const C=I.sort().join("");if(!(C in F))throw new Error("Unable to parse color from object: "+JSON.stringify(V));this.model=F[C];const{labels:s}=l[this.model],k=[];for(m=0;m<s.length;m++)k.push(V[s[m]]);this.color=X(k)}if(k[this.model])for(E=l[this.model].channels,m=0;m<E;m++){const V=k[this.model][m];V&&(this.color[m]=V(this.color[m]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}j.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(V){let I=this.model in C.to?this:this.rgb();I=I.round("number"===typeof V?V:1);const m=1===I.valpha?I.color:[...I.color,this.valpha];return C.to[I.model](m)},percentString(V){const I=this.rgb().round("number"===typeof V?V:1),m=1===I.valpha?I.color:[...I.color,this.valpha];return C.to.rgb.percent(m)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const V={},{channels:I}=l[this.model],{labels:m}=l[this.model];for(let C=0;C<I;C++)V[m[C]]=this.color[C];return 1!==this.valpha&&(V.alpha=this.valpha),V},unitArray(){const V=this.rgb().color;return V[0]/=255,V[1]/=255,V[2]/=255,1!==this.valpha&&V.push(this.valpha),V},unitObject(){const V=this.rgb().object();return V.r/=255,V.g/=255,V.b/=255,1!==this.valpha&&(V.alpha=this.valpha),V},round(V){return V=Math.max(V||0,0),new j([...this.color.map(E(V)),this.valpha],this.model)},alpha(V){return void 0!==V?new j([...this.color,Math.max(0,Math.min(1,V))],this.model):this.valpha},red:K("rgb",0,Y(255)),green:K("rgb",1,Y(255)),blue:K("rgb",2,Y(255)),hue:K(["hsl","hsv","hsl","hwb","hcg"],0,(V=>(V%360+360)%360)),saturationl:K("hsl",1,Y(100)),lightness:K("hsl",2,Y(100)),saturationv:K("hsv",1,Y(100)),value:K("hsv",2,Y(100)),chroma:K("hcg",1,Y(100)),gray:K("hcg",2,Y(100)),white:K("hwb",1,Y(100)),wblack:K("hwb",2,Y(100)),cyan:K("cmyk",0,Y(100)),magenta:K("cmyk",1,Y(100)),yellow:K("cmyk",2,Y(100)),black:K("cmyk",3,Y(100)),x:K("xyz",0,Y(95.047)),y:K("xyz",1,Y(100)),z:K("xyz",2,Y(108.833)),l:K("lab",0,Y(100)),a:K("lab",1),b:K("lab",2),keyword(V){return void 0!==V?new j(V):l[this.model].keyword(this.color)},hex(V){return void 0!==V?new j(V):C.to.hex(this.rgb().round().color)},hexa(V){if(void 0!==V)return new j(V);const I=this.rgb().round().color;let m=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===m.length&&(m="0"+m),C.to.hex(I)+m},rgbNumber(){const V=this.rgb().color;return(255&V[0])<<16|(255&V[1])<<8|255&V[2]},luminosity(){const V=this.rgb().color,I=[];for(const[m,C]of V.entries()){const V=C/255;I[m]=V<=.04045?V/12.92:((V+.055)/1.055)**2.4}return.2126*I[0]+.7152*I[1]+.0722*I[2]},contrast(V){const I=this.luminosity(),m=V.luminosity();return I>m?(I+.05)/(m+.05):(m+.05)/(I+.05)},level(V){const I=this.contrast(V);return I>=7?"AAA":I>=4.5?"AA":""},isDark(){const V=this.rgb().color;return(2126*V[0]+7152*V[1]+722*V[2])/1e4<128},isLight(){return!this.isDark()},negate(){const V=this.rgb();for(let I=0;I<3;I++)V.color[I]=255-V.color[I];return V},lighten(V){const I=this.hsl();return I.color[2]+=I.color[2]*V,I},darken(V){const I=this.hsl();return I.color[2]-=I.color[2]*V,I},saturate(V){const I=this.hsl();return I.color[1]+=I.color[1]*V,I},desaturate(V){const I=this.hsl();return I.color[1]-=I.color[1]*V,I},whiten(V){const I=this.hwb();return I.color[1]+=I.color[1]*V,I},blacken(V){const I=this.hwb();return I.color[2]+=I.color[2]*V,I},grayscale(){const V=this.rgb().color,I=.3*V[0]+.59*V[1]+.11*V[2];return j.rgb(I,I,I)},fade(V){return this.alpha(this.valpha-this.valpha*V)},opaquer(V){return this.alpha(this.valpha+this.valpha*V)},rotate(V){const I=this.hsl();let m=I.color[0];return m=(m+V)%360,m=m<0?360+m:m,I.color[0]=m,I},mix(V,I){if(!V||!V.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof V);const m=V.rgb(),C=this.rgb(),l=void 0===I?.5:I,s=2*l-1,F=m.alpha()-C.alpha(),k=((s*F===-1?s:(s+F)/(1+s*F))+1)/2,E=1-k;return j.rgb(k*m.red()+E*C.red(),k*m.green()+E*C.green(),k*m.blue()+E*C.blue(),m.alpha()*l+C.alpha()*(1-l))}};for(const O of Object.keys(l)){if(s.includes(O))continue;const{channels:V}=l[O];j.prototype[O]=function(){if(this.model===O)return new j(this);for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];return I.length>0?new j(I,O):new j([...(C=l[this.model][O].raw(this.color),Array.isArray(C)?C:[C]),this.valpha],O);var C},j[O]=function(){for(var I=arguments.length,m=new Array(I),C=0;C<I;C++)m[C]=arguments[C];let l=m[0];return"number"===typeof l&&(l=X(m,V)),new j(l,O)}}function E(V){return function(I){return function(V,I){return Number(V.toFixed(I))}(I,V)}}function K(V,I,m){V=Array.isArray(V)?V:[V];for(const C of V)(k[C]||(k[C]=[]))[I]=m;return V=V[0],function(C){let l;return void 0!==C?(m&&(C=m(C)),l=this[V](),l.color[I]=C,l):(l=this[V]().color[I],m&&(l=m(l)),l)}}function Y(V){return function(I){return Math.max(0,Math.min(V,I))}}function X(V,I){for(let m=0;m<I;m++)"number"!==typeof V[m]&&(V[m]=0);return V}V.exports=j},13344:(V,I,m)=>{const C=m(13346),l={};for(const F of Object.keys(C))l[C[F]]=F;const s={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};V.exports=s;for(const F of Object.keys(s)){if(!("channels"in s[F]))throw new Error("missing channels property: "+F);if(!("labels"in s[F]))throw new Error("missing channel labels property: "+F);if(s[F].labels.length!==s[F].channels)throw new Error("channel and label counts mismatch: "+F);const{channels:V,labels:I}=s[F];delete s[F].channels,delete s[F].labels,Object.defineProperty(s[F],"channels",{value:V}),Object.defineProperty(s[F],"labels",{value:I})}s.rgb.hsl=function(V){const I=V[0]/255,m=V[1]/255,C=V[2]/255,l=Math.min(I,m,C),s=Math.max(I,m,C),F=s-l;let k,j;s===l?k=0:I===s?k=(m-C)/F:m===s?k=2+(C-I)/F:C===s&&(k=4+(I-m)/F),k=Math.min(60*k,360),k<0&&(k+=360);const E=(l+s)/2;return j=s===l?0:E<=.5?F/(s+l):F/(2-s-l),[k,100*j,100*E]},s.rgb.hsv=function(V){let I,m,C,l,s;const F=V[0]/255,k=V[1]/255,j=V[2]/255,E=Math.max(F,k,j),K=E-Math.min(F,k,j),Y=function(V){return(E-V)/6/K+.5};return 0===K?(l=0,s=0):(s=K/E,I=Y(F),m=Y(k),C=Y(j),F===E?l=C-m:k===E?l=1/3+I-C:j===E&&(l=2/3+m-I),l<0?l+=1:l>1&&(l-=1)),[360*l,100*s,100*E]},s.rgb.hwb=function(V){const I=V[0],m=V[1];let C=V[2];const l=s.rgb.hsl(V)[0],F=1/255*Math.min(I,Math.min(m,C));return C=1-1/255*Math.max(I,Math.max(m,C)),[l,100*F,100*C]},s.rgb.cmyk=function(V){const I=V[0]/255,m=V[1]/255,C=V[2]/255,l=Math.min(1-I,1-m,1-C);return[100*((1-I-l)/(1-l)||0),100*((1-m-l)/(1-l)||0),100*((1-C-l)/(1-l)||0),100*l]},s.rgb.keyword=function(V){const I=l[V];if(I)return I;let m,s=1/0;for(const l of Object.keys(C)){const I=C[l],j=(k=I,((F=V)[0]-k[0])**2+(F[1]-k[1])**2+(F[2]-k[2])**2);j<s&&(s=j,m=l)}var F,k;return m},s.keyword.rgb=function(V){return C[V]},s.rgb.xyz=function(V){let I=V[0]/255,m=V[1]/255,C=V[2]/255;I=I>.04045?((I+.055)/1.055)**2.4:I/12.92,m=m>.04045?((m+.055)/1.055)**2.4:m/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92;return[100*(.4124*I+.3576*m+.1805*C),100*(.2126*I+.7152*m+.0722*C),100*(.0193*I+.1192*m+.9505*C)]},s.rgb.lab=function(V){const I=s.rgb.xyz(V);let m=I[0],C=I[1],l=I[2];m/=95.047,C/=100,l/=108.883,m=m>.008856?m**(1/3):7.787*m+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;return[116*C-16,500*(m-C),200*(C-l)]},s.hsl.rgb=function(V){const I=V[0]/360,m=V[1]/100,C=V[2]/100;let l,s,F;if(0===m)return F=255*C,[F,F,F];l=C<.5?C*(1+m):C+m-C*m;const k=2*C-l,j=[0,0,0];for(let E=0;E<3;E++)s=I+1/3*-(E-1),s<0&&s++,s>1&&s--,F=6*s<1?k+6*(l-k)*s:2*s<1?l:3*s<2?k+(l-k)*(2/3-s)*6:k,j[E]=255*F;return j},s.hsl.hsv=function(V){const I=V[0];let m=V[1]/100,C=V[2]/100,l=m;const s=Math.max(C,.01);C*=2,m*=C<=1?C:2-C,l*=s<=1?s:2-s;return[I,100*(0===C?2*l/(s+l):2*m/(C+m)),100*((C+m)/2)]},s.hsv.rgb=function(V){const I=V[0]/60,m=V[1]/100;let C=V[2]/100;const l=Math.floor(I)%6,s=I-Math.floor(I),F=255*C*(1-m),k=255*C*(1-m*s),j=255*C*(1-m*(1-s));switch(C*=255,l){case 0:return[C,j,F];case 1:return[k,C,F];case 2:return[F,C,j];case 3:return[F,k,C];case 4:return[j,F,C];case 5:return[C,F,k]}},s.hsv.hsl=function(V){const I=V[0],m=V[1]/100,C=V[2]/100,l=Math.max(C,.01);let s,F;F=(2-m)*C;const k=(2-m)*l;return s=m*l,s/=k<=1?k:2-k,s=s||0,F/=2,[I,100*s,100*F]},s.hwb.rgb=function(V){const I=V[0]/360;let m=V[1]/100,C=V[2]/100;const l=m+C;let s;l>1&&(m/=l,C/=l);const F=Math.floor(6*I),k=1-C;s=6*I-F,0!==(1&F)&&(s=1-s);const j=m+s*(k-m);let E,K,Y;switch(F){default:case 6:case 0:E=k,K=j,Y=m;break;case 1:E=j,K=k,Y=m;break;case 2:E=m,K=k,Y=j;break;case 3:E=m,K=j,Y=k;break;case 4:E=j,K=m,Y=k;break;case 5:E=k,K=m,Y=j}return[255*E,255*K,255*Y]},s.cmyk.rgb=function(V){const I=V[0]/100,m=V[1]/100,C=V[2]/100,l=V[3]/100;return[255*(1-Math.min(1,I*(1-l)+l)),255*(1-Math.min(1,m*(1-l)+l)),255*(1-Math.min(1,C*(1-l)+l))]},s.xyz.rgb=function(V){const I=V[0]/100,m=V[1]/100,C=V[2]/100;let l,s,F;return l=3.2406*I+-1.5372*m+-.4986*C,s=-.9689*I+1.8758*m+.0415*C,F=.0557*I+-.204*m+1.057*C,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,l=Math.min(Math.max(0,l),1),s=Math.min(Math.max(0,s),1),F=Math.min(Math.max(0,F),1),[255*l,255*s,255*F]},s.xyz.lab=function(V){let I=V[0],m=V[1],C=V[2];I/=95.047,m/=100,C/=108.883,I=I>.008856?I**(1/3):7.787*I+16/116,m=m>.008856?m**(1/3):7.787*m+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*m-16,500*(I-m),200*(m-C)]},s.lab.xyz=function(V){let I,m,C;m=(V[0]+16)/116,I=V[1]/500+m,C=m-V[2]/200;const l=m**3,s=I**3,F=C**3;return m=l>.008856?l:(m-16/116)/7.787,I=s>.008856?s:(I-16/116)/7.787,C=F>.008856?F:(C-16/116)/7.787,I*=95.047,m*=100,C*=108.883,[I,m,C]},s.lab.lch=function(V){const I=V[0],m=V[1],C=V[2];let l;l=360*Math.atan2(C,m)/2/Math.PI,l<0&&(l+=360);return[I,Math.sqrt(m*m+C*C),l]},s.lch.lab=function(V){const I=V[0],m=V[1],C=V[2]/360*2*Math.PI;return[I,m*Math.cos(C),m*Math.sin(C)]},s.rgb.ansi16=function(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[m,C,l]=V;let F=null===I?s.rgb.hsv(V)[2]:I;if(F=Math.round(F/50),0===F)return 30;let k=30+(Math.round(l/255)<<2|Math.round(C/255)<<1|Math.round(m/255));return 2===F&&(k+=60),k},s.hsv.ansi16=function(V){return s.rgb.ansi16(s.hsv.rgb(V),V[2])},s.rgb.ansi256=function(V){const I=V[0],m=V[1],C=V[2];if(I===m&&m===C)return I<8?16:I>248?231:Math.round((I-8)/247*24)+232;return 16+36*Math.round(I/255*5)+6*Math.round(m/255*5)+Math.round(C/255*5)},s.ansi16.rgb=function(V){let I=V%10;if(0===I||7===I)return V>50&&(I+=3.5),I=I/10.5*255,[I,I,I];const m=.5*(1+~~(V>50));return[(1&I)*m*255,(I>>1&1)*m*255,(I>>2&1)*m*255]},s.ansi256.rgb=function(V){if(V>=232){const I=10*(V-232)+8;return[I,I,I]}let I;V-=16;return[Math.floor(V/36)/5*255,Math.floor((I=V%36)/6)/5*255,I%6/5*255]},s.rgb.hex=function(V){const I=(((255&Math.round(V[0]))<<16)+((255&Math.round(V[1]))<<8)+(255&Math.round(V[2]))).toString(16).toUpperCase();return"000000".substring(I.length)+I},s.hex.rgb=function(V){const I=V.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!I)return[0,0,0];let m=I[0];3===I[0].length&&(m=m.split("").map((V=>V+V)).join(""));const C=parseInt(m,16);return[C>>16&255,C>>8&255,255&C]},s.rgb.hcg=function(V){const I=V[0]/255,m=V[1]/255,C=V[2]/255,l=Math.max(Math.max(I,m),C),s=Math.min(Math.min(I,m),C),F=l-s;let k,j;return k=F<1?s/(1-F):0,j=F<=0?0:l===I?(m-C)/F%6:l===m?2+(C-I)/F:4+(I-m)/F,j/=6,j%=1,[360*j,100*F,100*k]},s.hsl.hcg=function(V){const I=V[1]/100,m=V[2]/100,C=m<.5?2*I*m:2*I*(1-m);let l=0;return C<1&&(l=(m-.5*C)/(1-C)),[V[0],100*C,100*l]},s.hsv.hcg=function(V){const I=V[1]/100,m=V[2]/100,C=I*m;let l=0;return C<1&&(l=(m-C)/(1-C)),[V[0],100*C,100*l]},s.hcg.rgb=function(V){const I=V[0]/360,m=V[1]/100,C=V[2]/100;if(0===m)return[255*C,255*C,255*C];const l=[0,0,0],s=I%1*6,F=s%1,k=1-F;let j=0;switch(Math.floor(s)){case 0:l[0]=1,l[1]=F,l[2]=0;break;case 1:l[0]=k,l[1]=1,l[2]=0;break;case 2:l[0]=0,l[1]=1,l[2]=F;break;case 3:l[0]=0,l[1]=k,l[2]=1;break;case 4:l[0]=F,l[1]=0,l[2]=1;break;default:l[0]=1,l[1]=0,l[2]=k}return j=(1-m)*C,[255*(m*l[0]+j),255*(m*l[1]+j),255*(m*l[2]+j)]},s.hcg.hsv=function(V){const I=V[1]/100,m=I+V[2]/100*(1-I);let C=0;return m>0&&(C=I/m),[V[0],100*C,100*m]},s.hcg.hsl=function(V){const I=V[1]/100,m=V[2]/100*(1-I)+.5*I;let C=0;return m>0&&m<.5?C=I/(2*m):m>=.5&&m<1&&(C=I/(2*(1-m))),[V[0],100*C,100*m]},s.hcg.hwb=function(V){const I=V[1]/100,m=I+V[2]/100*(1-I);return[V[0],100*(m-I),100*(1-m)]},s.hwb.hcg=function(V){const I=V[1]/100,m=1-V[2]/100,C=m-I;let l=0;return C<1&&(l=(m-C)/(1-C)),[V[0],100*C,100*l]},s.apple.rgb=function(V){return[V[0]/65535*255,V[1]/65535*255,V[2]/65535*255]},s.rgb.apple=function(V){return[V[0]/255*65535,V[1]/255*65535,V[2]/255*65535]},s.gray.rgb=function(V){return[V[0]/100*255,V[0]/100*255,V[0]/100*255]},s.gray.hsl=function(V){return[0,0,V[0]]},s.gray.hsv=s.gray.hsl,s.gray.hwb=function(V){return[0,100,V[0]]},s.gray.cmyk=function(V){return[0,0,0,V[0]]},s.gray.lab=function(V){return[V[0],0,0]},s.gray.hex=function(V){const I=255&Math.round(V[0]/100*255),m=((I<<16)+(I<<8)+I).toString(16).toUpperCase();return"000000".substring(m.length)+m},s.rgb.gray=function(V){return[(V[0]+V[1]+V[2])/3/255*100]}},13341:(V,I,m)=>{const C=m(13344),l=m(13349),s={};Object.keys(C).forEach((V=>{s[V]={},Object.defineProperty(s[V],"channels",{value:C[V].channels}),Object.defineProperty(s[V],"labels",{value:C[V].labels});const I=l(V);Object.keys(I).forEach((m=>{const C=I[m];s[V][m]=function(V){const I=function(){for(var I=arguments.length,m=new Array(I),C=0;C<I;C++)m[C]=arguments[C];const l=m[0];if(void 0===l||null===l)return l;l.length>1&&(m=l);const s=V(m);if("object"===typeof s)for(let V=s.length,F=0;F<V;F++)s[F]=Math.round(s[F]);return s};return"conversion"in V&&(I.conversion=V.conversion),I}(C),s[V][m].raw=function(V){const I=function(){for(var I=arguments.length,m=new Array(I),C=0;C<I;C++)m[C]=arguments[C];const l=m[0];return void 0===l||null===l?l:(l.length>1&&(m=l),V(m))};return"conversion"in V&&(I.conversion=V.conversion),I}(C)}))})),V.exports=s},13349:(V,I,m)=>{const C=m(13344);function l(V){const I=function(){const V={},I=Object.keys(C);for(let m=I.length,C=0;C<m;C++)V[I[C]]={distance:-1,parent:null};return V}(),m=[V];for(I[V].distance=0;m.length;){const V=m.pop(),l=Object.keys(C[V]);for(let C=l.length,s=0;s<C;s++){const C=l[s],F=I[C];-1===F.distance&&(F.distance=I[V].distance+1,F.parent=V,m.unshift(C))}}return I}function s(V,I){return function(m){return I(V(m))}}function F(V,I){const m=[I[V].parent,V];let l=C[I[V].parent][V],F=I[V].parent;for(;I[F].parent;)m.unshift(I[F].parent),l=s(C[I[F].parent][F],l),F=I[F].parent;return l.conversion=m,l}V.exports=function(V){const I=l(V),m={},C=Object.keys(I);for(let l=C.length,s=0;s<l;s++){const V=C[s];null!==I[V].parent&&(m[V]=F(V,I))}return m}},13346:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11869:function(V,I,m){"use strict";var C=this&&this.__createBinding||(Object.create?function(V,I,m,C){void 0===C&&(C=m);var l=Object.getOwnPropertyDescriptor(I,m);l&&!("get"in l?!I.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return I[m]}}),Object.defineProperty(V,C,l)}:function(V,I,m,C){void 0===C&&(C=m),V[C]=I[m]}),l=this&&this.__setModuleDefault||(Object.create?function(V,I){Object.defineProperty(V,"default",{enumerable:!0,value:I})}:function(V,I){V.default=I}),s=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var I={};if(null!=V)for(var m in V)"default"!==m&&Object.prototype.hasOwnProperty.call(V,m)&&C(I,V,m);return l(I,V),I},F=this&&this.__awaiter||function(V,I,m,C){return new(m||(m=Promise))((function(l,s){function F(V){try{j(C.next(V))}catch(I){s(I)}}function k(V){try{j(C.throw(V))}catch(I){s(I)}}function j(V){var I;V.done?l(V.value):(I=V.value,I instanceof m?I:new m((function(V){V(I)}))).then(F,k)}j((C=C.apply(V,I||[])).next())}))};Object.defineProperty(I,"__esModule",{value:!0}),I.Auth=I.Platform=void 0;const k=s(m(11807)),j=m(11878),E="colyseus-auth-token";!function(V){V.ios="ios",V.android="android"}(I.Platform||(I.Platform={}));I.Auth=class{constructor(V){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=V.replace("ws","http"),(0,j.getItem)(E,(V=>this.token=V))}get hasToken(){return!!this.token}login(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F(this,void 0,void 0,(function*(){const I=Object.assign({},V);this.hasToken&&(I.token=this.token);const m=yield this.request("post","/auth",I);this.token=m.token,(0,j.setItem)(E,this.token);for(let V in m)this.hasOwnProperty(V)&&(this[V]=m[V]);return this.registerPingService(),this}))}save(){return F(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(V){return F(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:V})}))}acceptFriendRequest(V){return F(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:V})}))}declineFriendRequest(V){return F(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:V})}))}blockUser(V){return F(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:V})}))}unblockUser(V){return F(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:V})}))}request(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return F(this,void 0,void 0,(function*(){l.Accept="application/json",this.hasToken&&(l.Authorization="Bearer "+this.token);const s=[];for(const V in m)s.push(`${V}=${m[V]}`);const F=s.length>0?`?${s.join("&")}`:"",j={headers:l};return C&&(j.body=C),(yield k[V](`${this.endpoint}${I}${F}`,j)).data}))}logout(){this.token=void 0,(0,j.removeItem)(E),this.unregisterPingService()}registerPingService(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),V)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11800:function(V,I,m){"use strict";var C,l=this&&this.__awaiter||function(V,I,m,C){return new(m||(m=Promise))((function(l,s){function F(V){try{j(C.next(V))}catch(I){s(I)}}function k(V){try{j(C.throw(V))}catch(I){s(I)}}function j(V){var I;V.done?l(V.value):(I=V.value,I instanceof m?I:new m((function(V){V(I)}))).then(F,k)}j((C=C.apply(V,I||[])).next())}))};Object.defineProperty(I,"__esModule",{value:!0}),I.Client=I.MatchMakeError=void 0;const s=m(11807),F=m(11814),k=m(11816);class j extends Error{constructor(V,I){super(V),this.code=I,Object.setPrototypeOf(this,j.prototype)}}I.MatchMakeError=j;const E="undefined"!==typeof window&&"undefined"!==typeof(null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";I.Client=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;if("string"===typeof V){const I=new URL(V),m="https:"===I.protocol||"wss:"===I.protocol,C=Number(I.port||(m?443:80));this.settings={hostname:I.hostname,pathname:"/"!==I.pathname?I.pathname:"",port:C,secure:m}}else void 0===V.port&&(V.port=V.secure?443:80),void 0===V.pathname&&(V.pathname=""),this.settings=V}joinOrCreate(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",V,I,m)}))}create(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",V,I,m)}))}join(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",V,I,m)}))}joinById(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",V,I,m)}))}reconnect(V,I){return l(this,void 0,void 0,(function*(){if("string"===typeof V&&"string"===typeof I)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[m,C]=V.split(":");return yield this.createMatchMakeRequest("reconnect",m,{reconnectionToken:C},I)}))}getAvailableRooms(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return l(this,void 0,void 0,(function*(){return(yield(0,s.get)(this.getHttpEndpoint(`${V}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(V,I,m){return l(this,void 0,void 0,(function*(){const C=this.createRoom(V.room.name,I);C.roomId=V.room.roomId,C.sessionId=V.sessionId;const s={sessionId:C.sessionId};V.reconnectionToken&&(s.reconnectionToken=V.reconnectionToken);const k=m||C;return C.connect(this.buildEndpoint(V.room,s),V.devMode&&(()=>l(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${C.roomId}'...`);let m=0;const s=()=>l(this,void 0,void 0,(function*(){m++;try{yield this.consumeSeatReservation(V,I,k),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${C.roomId}'`)}catch(l){m<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${m} out of 8)`),setTimeout(s,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(s,2e3)}))),k),new Promise(((V,I)=>{const m=(V,m)=>I(new F.ServerError(V,m));k.onError.once(m),k.onJoin.once((()=>{k.onError.remove(m),V(k)}))}))}))}createMatchMakeRequest(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;return l(this,void 0,void 0,(function*(){const l=(yield(0,s.post)(this.getHttpEndpoint(`${V}/${I}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(m)})).data;if(l.error)throw new j(l.error,l.code);return"reconnect"===V&&(l.reconnectionToken=m.reconnectionToken),yield this.consumeSeatReservation(l,C,F)}))}createRoom(V,I){return new k.Room(V,I)}buildEndpoint(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const m=[];for(const l in I)I.hasOwnProperty(l)&&m.push(`${l}=${I[l]}`);let C=this.settings.secure?"wss://":"ws://";return V.publicAddress?C+=`${V.publicAddress}`:C+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${C}/${V.processId}/${V.roomId}?${m.join("&")}`}getHttpEndpoint(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${V}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11825:(V,I,m)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Connection=void 0;const C=m(11828);I.Connection=class{constructor(){this.events={},this.transport=new C.WebSocketTransport(this.events)}send(V){this.transport.send(V)}connect(V){this.transport.connect(V)}close(V,I){this.transport.close(V,I)}get isOpen(){return this.transport.isOpen}}},11835:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.utf8Length=I.utf8Read=I.ErrorCode=I.Protocol=void 0,function(V){V[V.HANDSHAKE=9]="HANDSHAKE",V[V.JOIN_ROOM=10]="JOIN_ROOM",V[V.ERROR=11]="ERROR",V[V.LEAVE_ROOM=12]="LEAVE_ROOM",V[V.ROOM_DATA=13]="ROOM_DATA",V[V.ROOM_STATE=14]="ROOM_STATE",V[V.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",V[V.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",V[V.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(I.Protocol||(I.Protocol={})),function(V){V[V.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",V[V.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",V[V.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",V[V.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",V[V.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",V[V.AUTH_FAILED=4215]="AUTH_FAILED",V[V.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(I.ErrorCode||(I.ErrorCode={})),I.utf8Read=function(V,I){const m=V[I++];for(var C="",l=0,s=I,F=I+m;s<F;s++){var k=V[s];if(0!==(128&k))if(192!==(224&k))if(224!==(240&k)){if(240!==(248&k))throw new Error("Invalid byte "+k.toString(16));(l=(7&k)<<18|(63&V[++s])<<12|(63&V[++s])<<6|63&V[++s])>=65536?(l-=65536,C+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):C+=String.fromCharCode(l)}else C+=String.fromCharCode((15&k)<<12|(63&V[++s])<<6|63&V[++s]);else C+=String.fromCharCode((31&k)<<6|63&V[++s]);else C+=String.fromCharCode(k)}return C},I.utf8Length=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",I=0,m=0;for(let C=0,l=V.length;C<l;C++)I=V.charCodeAt(C),I<128?m+=1:I<2048?m+=2:I<55296||I>=57344?m+=3:(C++,m+=4);return m+1}},11816:function(V,I,m){"use strict";var C=this&&this.__createBinding||(Object.create?function(V,I,m,C){void 0===C&&(C=m);var l=Object.getOwnPropertyDescriptor(I,m);l&&!("get"in l?!I.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return I[m]}}),Object.defineProperty(V,C,l)}:function(V,I,m,C){void 0===C&&(C=m),V[C]=I[m]}),l=this&&this.__setModuleDefault||(Object.create?function(V,I){Object.defineProperty(V,"default",{enumerable:!0,value:I})}:function(V,I){V.default=I}),s=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var I={};if(null!=V)for(var m in V)"default"!==m&&Object.prototype.hasOwnProperty.call(V,m)&&C(I,V,m);return l(I,V),I};Object.defineProperty(I,"__esModule",{value:!0}),I.Room=void 0;const F=s(m(11822)),k=m(11825),j=m(11835),E=m(11844),K=m(11850),Y=m(11858),X=m(11862),O=m(11814);class v{constructor(V,I){this.onStateChange=(0,Y.createSignal)(),this.onError=(0,Y.createSignal)(),this.onLeave=(0,Y.createSignal)(),this.onJoin=(0,Y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,K.createNanoEvents)(),this.roomId=null,this.name=V,I&&(this.serializer=new((0,E.getSerializer)("schema")),this.rootSchema=I,this.serializer.state=new I),this.onError(((V,I)=>{var m;return null===(m=console.warn)||void 0===m?void 0:m.call(console,`colyseus.js - onError => (${V}) ${I}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const C=new k.Connection;m.connection=C,C.events.onmessage=v.prototype.onMessageCallback.bind(m),C.events.onclose=function(V){var C;if(!m.hasJoined)return null===(C=console.warn)||void 0===C||C.call(console,`Room connection was closed unexpectedly (${V.code}): ${V.reason}`),void m.onError.invoke(V.code,V.reason);V.code===O.CloseCode.DEVMODE_RESTART&&I?I():(m.onLeave.invoke(V.code),m.destroy())},C.events.onerror=function(V){var I;null===(I=console.warn)||void 0===I||I.call(console,`Room, onError (${V.code}): ${V.reason}`),m.onError.invoke(V.code,V.reason)},C.connect(V)}leave(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((I=>{this.onLeave((V=>I(V))),this.connection?V?this.connection.send([j.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(O.CloseCode.CONSENTED)}))}onMessage(V,I){return this.onMessageHandlers.on(this.getMessageHandlerKey(V),I)}send(V,I){const m=[j.Protocol.ROOM_DATA];let C;if("string"===typeof V?X.encode.string(m,V):X.encode.number(m,V),void 0!==I){const V=F.encode(I);C=new Uint8Array(m.length+V.byteLength),C.set(new Uint8Array(m),0),C.set(new Uint8Array(V),m.length)}else C=new Uint8Array(m);this.connection.send(C.buffer)}sendBytes(V,I){const m=[j.Protocol.ROOM_DATA_BYTES];let C;"string"===typeof V?X.encode.string(m,V):X.encode.number(m,V),C=new Uint8Array(m.length+(I.byteLength||I.length)),C.set(new Uint8Array(m),0),C.set(new Uint8Array(I),m.length),this.connection.send(C.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(V){const I=Array.from(new Uint8Array(V.data)),m=I[0];if(m===j.Protocol.JOIN_ROOM){let V=1;const m=(0,j.utf8Read)(I,V);if(V+=(0,j.utf8Length)(m),this.serializerId=(0,j.utf8Read)(I,V),V+=(0,j.utf8Length)(this.serializerId),!this.serializer){const V=(0,E.getSerializer)(this.serializerId);this.serializer=new V}I.length>V&&this.serializer.handshake&&this.serializer.handshake(I,{offset:V}),this.reconnectionToken=`${this.roomId}:${m}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([j.Protocol.JOIN_ROOM])}else if(m===j.Protocol.ERROR){const V={offset:1},m=X.decode.number(I,V),C=X.decode.string(I,V);this.onError.invoke(m,C)}else if(m===j.Protocol.LEAVE_ROOM)this.leave();else if(m===j.Protocol.ROOM_DATA_SCHEMA){const V={offset:1},m=this.serializer.getState().constructor._context.get(X.decode.number(I,V)),C=new m;C.decode(I,V),this.dispatchMessage(m,C)}else if(m===j.Protocol.ROOM_STATE)I.shift(),this.setState(I);else if(m===j.Protocol.ROOM_STATE_PATCH)I.shift(),this.patch(I);else if(m===j.Protocol.ROOM_DATA){const m={offset:1},C=X.decode.stringCheck(I,m)?X.decode.string(I,m):X.decode.number(I,m),l=I.length>m.offset?F.decode(V.data,m.offset):void 0;this.dispatchMessage(C,l)}else if(m===j.Protocol.ROOM_DATA_BYTES){const V={offset:1},m=X.decode.stringCheck(I,V)?X.decode.string(I,V):X.decode.number(I,V);this.dispatchMessage(m,new Uint8Array(I.slice(V.offset)))}}setState(V){this.serializer.setState(V),this.onStateChange.invoke(this.serializer.getState())}patch(V){this.serializer.patch(V),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(V,I){var m;const C=this.getMessageHandlerKey(V);this.onMessageHandlers.events[C]?this.onMessageHandlers.emit(C,I):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",V,I):null===(m=console.warn)||void 0===m||m.call(console,`colyseus.js: onMessage() not registered for type '${V}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(V){switch(typeof V){case"function":return`$${V._typeid}`;case"string":return V;case"number":return`i${V}`;default:throw new Error("invalid message type.")}}}I.Room=v},11878:(V,I)=>{"use strict";let m;function C(){return m||(m="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(V,I){this.cache[V]=I},getItem:function(V){this.cache[V]},removeItem:function(V){delete this.cache[V]}}),m}Object.defineProperty(I,"__esModule",{value:!0}),I.getItem=I.removeItem=I.setItem=void 0,I.setItem=function(V,I){C().setItem(V,I)},I.removeItem=function(V){C().removeItem(V)},I.getItem=function(V,I){const m=C().getItem(V);"undefined"!==typeof Promise&&m instanceof Promise?m.then((V=>I(V))):I(m)}},11850:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createNanoEvents=void 0;I.createNanoEvents=()=>({emit(V){let I=this.events[V]||[];for(var m=arguments.length,C=new Array(m>1?m-1:0),l=1;l<m;l++)C[l-1]=arguments[l];for(let s=0,F=I.length;s<F;s++)I[s](...C)},events:{},on(V,I){var m;return(null===(m=this.events[V])||void 0===m?void 0:m.push(I))||(this.events[V]=[I]),()=>{var m;this.events[V]=null===(m=this.events[V])||void 0===m?void 0:m.filter((V=>I!==V))}}})},11858:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createSignal=I.EventEmitter=void 0;class m{constructor(){this.handlers=[]}register(V){return this.handlers.push(V),this}invoke(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];this.handlers.forEach((V=>V.apply(this,I)))}invokeAsync(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];return Promise.all(this.handlers.map((V=>V.apply(this,I))))}remove(V){const I=this.handlers.indexOf(V);this.handlers[I]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}I.EventEmitter=m,I.createSignal=function(){const V=new m;function I(I){return V.register(I,null===this)}return I.once=I=>{const m=function(){for(var C=arguments.length,l=new Array(C),s=0;s<C;s++)l[s]=arguments[s];I.apply(this,l),V.remove(m)};V.register(m)},I.remove=I=>V.remove(I),I.invoke=function(){return V.invoke(...arguments)},I.invokeAsync=function(){return V.invokeAsync(...arguments)},I.clear=()=>V.clear(),I}},11814:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ServerError=I.CloseCode=void 0,function(V){V[V.CONSENTED=4e3]="CONSENTED",V[V.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(I.CloseCode||(I.CloseCode={}));class m extends Error{constructor(V,I){super(I),this.name="ServerError",this.code=V}}I.ServerError=m},11789:(V,I,m)=>{"use strict";I.e=void 0,m(11795);var C=m(11800);Object.defineProperty(I,"e",{enumerable:!0,get:function(){return C.Client}});var l=m(11835);var s=m(11816);var F=m(11869);const k=m(11882);const j=m(11885),E=m(11844);(0,E.registerSerializer)("schema",k.SchemaSerializer),(0,E.registerSerializer)("none",j.NoneSerializer)},11795:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=V=>null!==V&&"object"===typeof V&&V.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11822:(V,I)=>{"use strict";function m(V,I){if(this._offset=I,V instanceof ArrayBuffer)this._buffer=V,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(V))throw new Error("Invalid argument");this._buffer=V.buffer,this._view=new DataView(this._buffer,V.byteOffset,V.byteLength)}}Object.defineProperty(I,"__esModule",{value:!0}),I.decode=I.encode=void 0,m.prototype._array=function(V){for(var I=new Array(V),m=0;m<V;m++)I[m]=this._parse();return I},m.prototype._map=function(V){for(var I={},m=0;m<V;m++)I[this._parse()]=this._parse();return I},m.prototype._str=function(V){var I=function(V,I,m){for(var C="",l=0,s=I,F=I+m;s<F;s++){var k=V.getUint8(s);if(0!==(128&k))if(192!==(224&k))if(224!==(240&k)){if(240!==(248&k))throw new Error("Invalid byte "+k.toString(16));(l=(7&k)<<18|(63&V.getUint8(++s))<<12|(63&V.getUint8(++s))<<6|63&V.getUint8(++s))>=65536?(l-=65536,C+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):C+=String.fromCharCode(l)}else C+=String.fromCharCode((15&k)<<12|(63&V.getUint8(++s))<<6|63&V.getUint8(++s));else C+=String.fromCharCode((31&k)<<6|63&V.getUint8(++s));else C+=String.fromCharCode(k)}return C}(this._view,this._offset,V);return this._offset+=V,I},m.prototype._bin=function(V){var I=this._buffer.slice(this._offset,this._offset+V);return this._offset+=V,I},m.prototype._parse=function(){var V,I=this._view.getUint8(this._offset++),m=0,C=0,l=0,s=0;if(I<192)return I<128?I:I<144?this._map(15&I):I<160?this._array(15&I):this._str(31&I);if(I>223)return-1*(255-I+1);switch(I){case 192:return null;case 194:return!1;case 195:return!0;case 196:return m=this._view.getUint8(this._offset),this._offset+=1,this._bin(m);case 197:return m=this._view.getUint16(this._offset),this._offset+=2,this._bin(m);case 198:return m=this._view.getUint32(this._offset),this._offset+=4,this._bin(m);case 199:if(m=this._view.getUint8(this._offset),C=this._view.getInt8(this._offset+1),this._offset+=2,-1===C){var F=this._view.getUint32(this._offset);return l=this._view.getInt32(this._offset+4),s=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*l+s)+F/1e6)}return[C,this._bin(m)];case 200:return m=this._view.getUint16(this._offset),C=this._view.getInt8(this._offset+2),this._offset+=3,[C,this._bin(m)];case 201:return m=this._view.getUint32(this._offset),C=this._view.getInt8(this._offset+4),this._offset+=5,[C,this._bin(m)];case 202:return V=this._view.getFloat32(this._offset),this._offset+=4,V;case 203:return V=this._view.getFloat64(this._offset),this._offset+=8,V;case 204:return V=this._view.getUint8(this._offset),this._offset+=1,V;case 205:return V=this._view.getUint16(this._offset),this._offset+=2,V;case 206:return V=this._view.getUint32(this._offset),this._offset+=4,V;case 207:return l=this._view.getUint32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,l+s;case 208:return V=this._view.getInt8(this._offset),this._offset+=1,V;case 209:return V=this._view.getInt16(this._offset),this._offset+=2,V;case 210:return V=this._view.getInt32(this._offset),this._offset+=4,V;case 211:return l=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,l+s;case 212:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?void(this._offset+=1):[C,this._bin(1)];case 213:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(2)];case 214:return C=this._view.getInt8(this._offset),this._offset+=1,-1===C?(V=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*V)):[C,this._bin(4)];case 215:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?(l=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(l+s)):-1===C?(l=this._view.getUint32(this._offset),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&l)+s)+(l>>>2)/1e6)):[C,this._bin(8)];case 216:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(16)];case 217:return m=this._view.getUint8(this._offset),this._offset+=1,this._str(m);case 218:return m=this._view.getUint16(this._offset),this._offset+=2,this._str(m);case 219:return m=this._view.getUint32(this._offset),this._offset+=4,this._str(m);case 220:return m=this._view.getUint16(this._offset),this._offset+=2,this._array(m);case 221:return m=this._view.getUint32(this._offset),this._offset+=4,this._array(m);case 222:return m=this._view.getUint16(this._offset),this._offset+=2,this._map(m);case 223:return m=this._view.getUint32(this._offset),this._offset+=4,this._map(m)}throw new Error("Could not parse")},I.decode=function(V){var I=new m(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),C=I._parse();if(I._offset!==V.byteLength)throw new Error(V.byteLength-I._offset+" trailing bytes");return C};function C(V,I,m){for(var C=0,l=0,s=m.length;l<s;l++)(C=m.charCodeAt(l))<128?V.setUint8(I++,C):C<2048?(V.setUint8(I++,192|C>>6),V.setUint8(I++,128|63&C)):C<55296||C>=57344?(V.setUint8(I++,224|C>>12),V.setUint8(I++,128|C>>6&63),V.setUint8(I++,128|63&C)):(l++,C=65536+((1023&C)<<10|1023&m.charCodeAt(l)),V.setUint8(I++,240|C>>18),V.setUint8(I++,128|C>>12&63),V.setUint8(I++,128|C>>6&63),V.setUint8(I++,128|63&C))}function l(V,I,m){var C=typeof m,s=0,F=0,k=0,j=0,E=0,K=0;if("string"===C){if(E=function(V){for(var I=0,m=0,C=0,l=V.length;C<l;C++)(I=V.charCodeAt(C))<128?m+=1:I<2048?m+=2:I<55296||I>=57344?m+=3:(C++,m+=4);return m}(m),E<32)V.push(160|E),K=1;else if(E<256)V.push(217,E),K=2;else if(E<65536)V.push(218,E>>8,E),K=3;else{if(!(E<4294967296))throw new Error("String too long");V.push(219,E>>24,E>>16,E>>8,E),K=5}return I.push({_str:m,_length:E,_offset:V.length}),K+E}if("number"===C)return Math.floor(m)===m&&isFinite(m)?m>=0?m<128?(V.push(m),1):m<256?(V.push(204,m),2):m<65536?(V.push(205,m>>8,m),3):m<4294967296?(V.push(206,m>>24,m>>16,m>>8,m),5):(k=m/Math.pow(2,32)|0,j=m>>>0,V.push(207,k>>24,k>>16,k>>8,k,j>>24,j>>16,j>>8,j),9):m>=-32?(V.push(m),1):m>=-128?(V.push(208,m),2):m>=-32768?(V.push(209,m>>8,m),3):m>=-2147483648?(V.push(210,m>>24,m>>16,m>>8,m),5):(k=Math.floor(m/Math.pow(2,32)),j=m>>>0,V.push(211,k>>24,k>>16,k>>8,k,j>>24,j>>16,j>>8,j),9):(V.push(203),I.push({_float:m,_length:8,_offset:V.length}),9);if("object"===C){if(null===m)return V.push(192),1;if(Array.isArray(m)){if((E=m.length)<16)V.push(144|E),K=1;else if(E<65536)V.push(220,E>>8,E),K=3;else{if(!(E<4294967296))throw new Error("Array too large");V.push(221,E>>24,E>>16,E>>8,E),K=5}for(s=0;s<E;s++)K+=l(V,I,m[s]);return K}if(m instanceof Date){var Y=m.getTime(),X=Math.floor(Y/1e3),O=1e6*(Y-1e3*X);return X>=0&&O>=0&&X<=17179869183?0===O&&X<=4294967295?(V.push(214,255,X>>24,X>>16,X>>8,X),6):(k=X/4294967296,j=4294967295&X,V.push(215,255,O>>22,O>>14,O>>6,k,j>>24,j>>16,j>>8,j),10):(k=Math.floor(X/4294967296),j=X>>>0,V.push(199,12,255,O>>24,O>>16,O>>8,O,k>>24,k>>16,k>>8,k,j>>24,j>>16,j>>8,j),15)}if(m instanceof ArrayBuffer){if((E=m.byteLength)<256)V.push(196,E),K=2;else if(E<65536)V.push(197,E>>8,E),K=3;else{if(!(E<4294967296))throw new Error("Buffer too large");V.push(198,E>>24,E>>16,E>>8,E),K=5}return I.push({_bin:m,_length:E,_offset:V.length}),K+E}if("function"===typeof m.toJSON)return l(V,I,m.toJSON());var v=[],N="",t=Object.keys(m);for(s=0,F=t.length;s<F;s++)void 0!==m[N=t[s]]&&"function"!==typeof m[N]&&v.push(N);if((E=v.length)<16)V.push(128|E),K=1;else if(E<65536)V.push(222,E>>8,E),K=3;else{if(!(E<4294967296))throw new Error("Object too large");V.push(223,E>>24,E>>16,E>>8,E),K=5}for(s=0;s<E;s++)K+=l(V,I,N=v[s]),K+=l(V,I,m[N]);return K}if("boolean"===C)return V.push(m?195:194),1;if("undefined"===C)return V.push(192),1;if("function"===typeof m.toJSON)return l(V,I,m.toJSON());throw new Error("Could not encode")}I.encode=function(V){var I=[],m=[],s=l(I,m,V),F=new ArrayBuffer(s),k=new DataView(F),j=0,E=0,K=-1;m.length>0&&(K=m[0]._offset);for(var Y,X=0,O=0,v=0,N=I.length;v<N;v++)if(k.setUint8(E+v,I[v]),v+1===K){if(X=(Y=m[j])._length,O=E+K,Y._bin)for(var t=new Uint8Array(Y._bin),D=0;D<X;D++)k.setUint8(O+D,t[D]);else Y._str?C(k,O,Y._str):void 0!==Y._float&&k.setFloat64(O,Y._float);E+=X,m[++j]&&(K=m[j]._offset)}return F}},11885:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.NoneSerializer=void 0;I.NoneSerializer=class{setState(V){}getState(){return null}patch(V){}teardown(){}handshake(V){}}},11882:(V,I,m)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.SchemaSerializer=void 0;const C=m(11862);I.SchemaSerializer=class{setState(V){return this.state.decode(V)}getState(){return this.state}patch(V){return this.state.decode(V)}teardown(){var V,I;null===(I=null===(V=this.state)||void 0===V?void 0:V.$changes)||void 0===I||I.root.clearRefs()}handshake(V,I){if(this.state){(new C.Reflection).decode(V,I)}else this.state=C.Reflection.decode(V,I)}}},11844:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.getSerializer=I.registerSerializer=void 0;const m={};I.registerSerializer=function(V,I){m[V]=I},I.getSerializer=function(V){const I=m[V];if(!I)throw new Error("missing serializer: "+V);return I}},11828:function(V,I,m){"use strict";var C=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(I,"__esModule",{value:!0}),I.WebSocketTransport=void 0;const l=C(m(11833)),s=globalThis.WebSocket||l.default;I.WebSocketTransport=class{constructor(V){this.events=V}send(V){V instanceof ArrayBuffer?this.ws.send(V):Array.isArray(V)&&this.ws.send(new Uint8Array(V).buffer)}connect(V){this.ws=new s(V,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(V,I){this.ws.close(V,I)}get isOpen(){return this.ws.readyState===s.OPEN}}},11833:V=>{"use strict";V.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12257:V=>{"use strict";V.exports=function(V){for(var I=new Array(V),m=0;m<V;++m)I[m]=m;return I}},12264:V=>{function I(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(I(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&I(V.slice(0,0))}(V)||!!V._isBuffer)}},12248:(V,I,m)=>{var C=m(12257),l=m(12264),s="undefined"!==typeof Float64Array;function F(V,I){return V[0]-I[0]}function k(){var V,I=this.stride,m=new Array(I.length);for(V=0;V<m.length;++V)m[V]=[Math.abs(I[V]),V];m.sort(F);var C=new Array(m.length);for(V=0;V<C.length;++V)C[V]=m[V][1];return C}function j(V,I){var m=["View",I,"d",V].join("");I<0&&(m="View_Nil"+V);var l="generic"===V;if(-1===I){var s="function "+m+"(a){this.data=a;};var proto="+m+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+m+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+m+"(a){return new "+m+"(a);}";return new Function(s)()}if(0===I){s="function "+m+"(a,d) {this.data = a;this.offset = d};var proto="+m+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+m+"_copy() {return new "+m+"(this.data,this.offset)};proto.pick=function "+m+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+m+"_get(){return "+(l?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+m+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+m+"(a,b,c,d){return new "+m+"(a,d)}";return new Function("TrivialArray",s)(E[V][0])}s=["'use strict'"];var F=C(I),j=F.map((function(V){return"i"+V})),K="this.offset+"+F.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),Y=F.map((function(V){return"b"+V})).join(","),X=F.map((function(V){return"c"+V})).join(",");s.push("function "+m+"(a,"+Y+","+X+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+X+"]","this.offset=d|0}","var proto="+m+".prototype","proto.dtype='"+V+"'","proto.dimension="+I),s.push("Object.defineProperty(proto,'size',{get:function "+m+"_size(){return "+F.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===I?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),I<4?(s.push("function "+m+"_order(){"),2===I?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+m+"_set("+j.join(",")+",v){"),l?s.push("return this.data.set("+K+",v)}"):s.push("return this.data["+K+"]=v}"),s.push("proto.get=function "+m+"_get("+j.join(",")+"){"),l?s.push("return this.data.get("+K+")}"):s.push("return this.data["+K+"]}"),s.push("proto.index=function "+m+"_index(",j.join(),"){return "+K+"}"),s.push("proto.hi=function "+m+"_hi("+j.join(",")+"){return new "+m+"(this.data,"+F.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+F.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var O=F.map((function(V){return"a"+V+"=this.shape["+V+"]"})),v=F.map((function(V){return"c"+V+"=this.stride["+V+"]"}));s.push("proto.lo=function "+m+"_lo("+j.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+v.join(","));for(var N=0;N<I;++N)s.push("if(typeof i"+N+"==='number'&&i"+N+">=0){d=i"+N+"|0;b+=c"+N+"*d;a"+N+"-=d}");s.push("return new "+m+"(this.data,"+F.map((function(V){return"a"+V})).join(",")+","+F.map((function(V){return"c"+V})).join(",")+",b)}"),s.push("proto.step=function "+m+"_step("+j.join(",")+"){var "+F.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+F.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(N=0;N<I;++N)s.push("if(typeof i"+N+"==='number'){d=i"+N+"|0;if(d<0){c+=b"+N+"*(a"+N+"-1);a"+N+"=ceil(-a"+N+"/d)}else{a"+N+"=ceil(a"+N+"/d)}b"+N+"*=d}");s.push("return new "+m+"(this.data,"+F.map((function(V){return"a"+V})).join(",")+","+F.map((function(V){return"b"+V})).join(",")+",c)}");var t=new Array(I),D=new Array(I);for(N=0;N<I;++N)t[N]="a[i"+N+"]",D[N]="b[i"+N+"]";s.push("proto.transpose=function "+m+"_transpose("+j+"){"+j.map((function(V,I){return V+"=("+V+"===undefined?"+I+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+m+"(this.data,"+t.join(",")+","+D.join(",")+",this.offset)}"),s.push("proto.pick=function "+m+"_pick("+j+"){var a=[],b=[],c=this.offset");for(N=0;N<I;++N)s.push("if(typeof i"+N+"==='number'&&i"+N+">=0){c=(c+this.stride["+N+"]*i"+N+")|0}else{a.push(this.shape["+N+"]);b.push(this.stride["+N+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+m+"(data,shape,stride,offset){return new "+m+"(data,"+F.map((function(V){return"shape["+V+"]"})).join(",")+","+F.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(E[V],k)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,I,m,C){if(void 0===V)return(0,E.array[0])([]);"number"===typeof V&&(V=[V]),void 0===I&&(I=[V.length]);var F=I.length;if(void 0===m){m=new Array(F);for(var k=F-1,K=1;k>=0;--k)m[k]=K,K*=I[k]}if(void 0===C){C=0;for(k=0;k<F;++k)m[k]<0&&(C-=(I[k]-1)*m[k])}for(var Y=function(V){if(l(V))return"buffer";if(s)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),X=E[Y];X.length<=F+1;)X.push(j(Y,X.length-1));return(0,X[F+1])(V,I,m,C)}},13286:V=>{var I;self,I=()=>(()=>{"use strict";var V={d:(I,m)=>{for(var C in m)V.o(m,C)&&!V.o(I,C)&&Object.defineProperty(I,C,{enumerable:!0,get:m[C]})},o:(V,I)=>Object.prototype.hasOwnProperty.call(V,I)},I={};V.d(I,{default:()=>r});var m,C=function(V,I){var m=I.x-V.x,C=I.y-V.y;return Math.sqrt(m*m+C*C)},l=function(V){return V*(Math.PI/180)},s=new Map,F=function(V){s.has(V)&&clearTimeout(s.get(V)),s.set(V,setTimeout(V,100))},k=function(V,I,m){for(var C,l=I.split(/[ ,]+/g),s=0;s<l.length;s+=1)C=l[s],V.addEventListener?V.addEventListener(C,m,!1):V.attachEvent&&V.attachEvent(C,m)},j=function(V,I,m){for(var C,l=I.split(/[ ,]+/g),s=0;s<l.length;s+=1)C=l[s],V.removeEventListener?V.removeEventListener(C,m):V.detachEvent&&V.detachEvent(C,m)},E=function(V){return V.preventDefault(),V.type.match(/^touch/)?V.changedTouches:V},K=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Y=function(V,I){I.top||I.right||I.bottom||I.left?(V.style.top=I.top,V.style.right=I.right,V.style.bottom=I.bottom,V.style.left=I.left):(V.style.left=I.x+"px",V.style.top=I.y+"px")},X=function(V,I,m){var C=O(V);for(var l in C)if(C.hasOwnProperty(l))if("string"==typeof I)C[l]=I+" "+m;else{for(var s="",F=0,k=I.length;F<k;F+=1)s+=I[F]+" "+m+", ";C[l]=s.slice(0,-2)}return C},O=function(V){var I={};return I[V]="",["webkit","Moz","o"].forEach((function(m){I[m+V.charAt(0).toUpperCase()+V.slice(1)]=""})),I},v=function(V,I){for(var m in I)I.hasOwnProperty(m)&&(V[m]=I[m]);return V},N=function(V,I){if(V.length)for(var m=0,C=V.length;m<C;m+=1)I(V[m]);else I(V)},t="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,D=window.matchMedia("(any-hover: none)").matches,b=!!("ontouchstart"in window),T=!!window.PointerEvent,n=!!window.MSPointerEvent,x={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},S={start:"mousedown",move:"mousemove",end:"mouseup"},c={};function H(){}t&&!D?m=x:T?m={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:n?m={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:b?(m=x,c=S):m=S,H.prototype.on=function(V,I){var m,C=this,l=V.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var s=0;s<l.length;s+=1)m=l[s],C._handlers_[m]=C._handlers_[m]||[],C._handlers_[m].push(I);return C},H.prototype.off=function(V,I){var m=this;return m._handlers_=m._handlers_||{},void 0===V?m._handlers_={}:void 0===I?m._handlers_[V]=null:m._handlers_[V]&&m._handlers_[V].indexOf(I)>=0&&m._handlers_[V].splice(m._handlers_[V].indexOf(I),1),m},H.prototype.trigger=function(V,I){var m,C=this,l=V.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var s=0;s<l.length;s+=1)m=l[s],C._handlers_[m]&&C._handlers_[m].length&&C._handlers_[m].forEach((function(V){V.call(C,{type:m,target:C},I)}))},H.prototype.config=function(V){var I=this;I.options=I.defaults||{},V&&(I.options=function(V,I){var m={};for(var C in V)V.hasOwnProperty(C)&&I.hasOwnProperty(C)?m[C]=I[C]:V.hasOwnProperty(C)&&(m[C]=V[C]);return m}(I.options,V))},H.prototype.bindEvt=function(V,I){var C=this;return C._domHandlers_=C._domHandlers_||{},C._domHandlers_[I]=function(){"function"==typeof C["on"+I]?C["on"+I].apply(C,arguments):console.warn('[WARNING] : Missing "on'+I+'" handler.')},k(V,m[I],C._domHandlers_[I]),c[I]&&k(V,c[I],C._domHandlers_[I]),C},H.prototype.unbindEvt=function(V,I){var C=this;return C._domHandlers_=C._domHandlers_||{},j(V,m[I],C._domHandlers_[I]),c[I]&&j(V,c[I],C._domHandlers_[I]),delete C._domHandlers_[I],this};const y=H;function z(V,I){return this.identifier=I.identifier,this.position=I.position,this.frontPosition=I.frontPosition,this.collection=V,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(I),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=z.id,z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}z.prototype=new y,z.constructor=z,z.id=0,z.prototype.buildEl=function(V){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},z.prototype.stylize=function(){if(this.options.dataOnly)return this;var V=this.options.fadeTime+"ms",I=function(){var V=O("borderRadius");for(var I in V)V.hasOwnProperty(I)&&(V[I]="50%");return V}(),m=X("transition","opacity",V),C={};return C.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},C.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},C.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},v(C.el,m),"circle"===this.options.shape&&v(C.back,I),v(C.front,I),this.applyStyles(C),this},z.prototype.applyStyles=function(V){for(var I in this.ui)if(this.ui.hasOwnProperty(I))for(var m in V[I])this.ui[I].style[m]=V[I][m];return this},z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},z.prototype.show=function(V){var I=this;return I.options.dataOnly||(clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.addToDom(),I.restCallback(),setTimeout((function(){I.ui.el.style.opacity=1}),0),I.showTimeout=setTimeout((function(){I.trigger("shown",I.instance),"function"==typeof V&&V.call(this)}),I.options.fadeTime)),I},z.prototype.hide=function(V){var I=this;if(I.options.dataOnly)return I;if(I.ui.el.style.opacity=I.options.restOpacity,clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.removeTimeout=setTimeout((function(){var m="dynamic"===I.options.mode?"none":"block";I.ui.el.style.display=m,"function"==typeof V&&V.call(I),I.trigger("hidden",I.instance)}),I.options.fadeTime),I.options.restJoystick){var m=I.options.restJoystick,C={};C.x=!0===m||!1!==m.x?0:I.instance.frontPosition.x,C.y=!0===m||!1!==m.y?0:I.instance.frontPosition.y,I.setPosition(V,C)}return I},z.prototype.setPosition=function(V,I){var m=this;m.frontPosition={x:I.x,y:I.y};var C=m.options.fadeTime+"ms",l={};l.front=X("transition",["transform"],C);var s={front:{}};s.front={transform:"translate("+m.frontPosition.x+"px,"+m.frontPosition.y+"px)"},m.applyStyles(l),m.applyStyles(s),m.restTimeout=setTimeout((function(){"function"==typeof V&&V.call(m),m.restCallback()}),m.options.fadeTime)},z.prototype.restCallback=function(){var V=this,I={};I.front=X("transition","none",""),V.applyStyles(I),V.trigger("rested",V.instance)},z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},z.prototype.computeDirection=function(V){var I,m,C,l=V.angle.radian,s=Math.PI/4,F=Math.PI/2;if(l>s&&l<3*s&&!V.lockX?I="up":l>-s&&l<=s&&!V.lockY?I="left":l>3*-s&&l<=-s&&!V.lockX?I="down":V.lockY||(I="right"),V.lockY||(m=l>-F&&l<F?"left":"right"),V.lockX||(C=l>0?"up":"down"),V.force>this.options.threshold){var k,j={};for(k in this.direction)this.direction.hasOwnProperty(k)&&(j[k]=this.direction[k]);var E={};for(k in this.direction={x:m,y:C,angle:I},V.direction=this.direction,j)j[k]===this.direction[k]&&(E[k]=!0);if(E.x&&E.y&&E.angle)return V;E.x&&E.y||this.trigger("plain",V),E.x||this.trigger("plain:"+m,V),E.y||this.trigger("plain:"+C,V),E.angle||this.trigger("dir dir:"+I,V)}else this.resetDirection();return V};const Z=z;function B(V,I){var m=this;m.nipples=[],m.idles=[],m.actives=[],m.ids=[],m.pressureIntervals={},m.manager=V,m.id=B.id,B.id+=1,m.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},m.config(I),"static"!==m.options.mode&&"semi"!==m.options.mode||(m.options.multitouch=!1),m.options.multitouch||(m.options.maxNumberOfNipples=1);var C=getComputedStyle(m.options.zone.parentElement);return C&&"flex"===C.display&&(m.parentIsFlex=!0),m.updateBox(),m.prepareNipples(),m.hY(),m.begin(),m.nipples}B.prototype=new y,B.constructor=B,B.id=0,B.prototype.prepareNipples=function(){var V=this,I=V.nipples;I.on=V.on.bind(V),I.off=V.off.bind(V),I.options=V.options,I.destroy=V.destroy.bind(V),I.ids=V.ids,I.id=V.id,I.processOnMove=V.processOnMove.bind(V),I.processOnEnd=V.processOnEnd.bind(V),I.get=function(V){if(void 0===V)return I[0];for(var m=0,C=I.length;m<C;m+=1)if(I[m].identifier===V)return I[m];return!1}},B.prototype.hY=function(){var V=this;V.bindEvt(V.options.zone,"start"),V.options.zone.style.touchAction="none",V.options.zone.style.msTouchAction="none"},B.prototype.begin=function(){var V=this,I=V.options;if("static"===I.mode){var m=V.createNipple(I.position,V.manager.getIdentifier());m.add(),V.idles.push(m)}},B.prototype.createNipple=function(V,I){var m=this,C=m.manager.scroll,l={},s=m.options,F=m.parentIsFlex?C.x:C.x+m.box.left,k=m.parentIsFlex?C.y:C.y+m.box.top;if(V.x&&V.y)l={x:V.x-F,y:V.y-k};else if(V.top||V.right||V.bottom||V.left){var j=document.createElement("DIV");j.style.display="hidden",j.style.top=V.top,j.style.right=V.right,j.style.bottom=V.bottom,j.style.left=V.left,j.style.position="absolute",s.zone.appendChild(j);var E=j.getBoundingClientRect();s.zone.removeChild(j),l=V,V={x:E.left+C.x,y:E.top+C.y}}var K=new Z(m,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:I,position:V,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(Y(K.ui.el,l),Y(K.ui.front,K.frontPosition)),m.nipples.push(K),m.trigger("added "+K.identifier+":added",K),m.manager.trigger("added "+K.identifier+":added",K),m.bindNipple(K),K},B.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},B.prototype.bindNipple=function(V){var I,m=this,C=function(V,C){I=V.type+" "+C.id+":"+V.type,m.trigger(I,C)};V.on("destroyed",m.onDestroyed.bind(m)),V.on("shown hidden rested dir plain",C),V.on("dir:up dir:right dir:down dir:left",C),V.on("plain:up plain:right plain:down plain:left",C)},B.prototype.pressureFn=function(V,I,m){var C=this,l=0;clearInterval(C.pressureIntervals[m]),C.pressureIntervals[m]=setInterval(function(){var m=V.force||V.pressure||V.webkitForce||0;m!==l&&(I.trigger("pressure",m),C.trigger("pressure "+I.identifier+":pressure",m),l=m)}.bind(C),100)},B.prototype.onstart=function(V){var I=this,m=I.options,C=V;return V=E(V),I.updateBox(),N(V,(function(l){I.actives.length<m.maxNumberOfNipples?I.processOnStart(l):C.type.match(/^touch/)&&(Object.keys(I.manager.ids).forEach((function(m){if(Object.values(C.touches).findIndex((function(V){return V.identifier===m}))<0){var l=[V[0]];l.identifier=m,I.processOnEnd(l)}})),I.actives.length<m.maxNumberOfNipples&&I.processOnStart(l))})),I.manager.bindDocument(),!1},B.prototype.processOnStart=function(V){var I,m=this,l=m.options,s=m.manager.getIdentifier(V),F=V.force||V.pressure||V.webkitForce||0,k={x:V.pageX,y:V.pageY},j=m.getOrCreate(s,k);j.identifier!==s&&m.manager.removeIdentifier(j.identifier),j.identifier=s;var E=function(I){I.trigger("start",I),m.trigger("start "+I.id+":start",I),I.show(),F>0&&m.pressureFn(V,I,I.identifier),m.processOnMove(V)};if((I=m.idles.indexOf(j))>=0&&m.idles.splice(I,1),m.actives.push(j),m.ids.push(j.identifier),"semi"!==l.mode)E(j);else{if(!(C(k,j.position)<=l.catchDistance))return j.destroy(),void m.processOnStart(V);E(j)}return j},B.prototype.getOrCreate=function(V,I){var m,C=this,l=C.options;return/(semi|static)/.test(l.mode)?(m=C.idles[0])?(C.idles.splice(0,1),m):"semi"===l.mode?C.createNipple(I,V):(console.warn("Coudln't find the needed nipple."),!1):m=C.createNipple(I,V)},B.prototype.processOnMove=function(V){var I=this,m=I.options,s=I.manager.getIdentifier(V),F=I.nipples.get(s),k=I.manager.scroll;if(function(V){return isNaN(V.buttons)?0!==V.pressure:0!==V.buttons}(V)){if(!F)return console.error("Found zombie joystick with ID "+s),void I.manager.removeIdentifier(s);if(m.dynamicPage){var j=F.el.getBoundingClientRect();F.position={x:k.x+j.left,y:k.y+j.top}}F.identifier=s;var E=F.options.size/2,K={x:V.pageX,y:V.pageY};m.lockX&&(K.y=F.position.y),m.lockY&&(K.x=F.position.x);var Y,X,O,v,N,t,D,b,T,n,x=C(K,F.position),S=(Y=K,O=(X=F.position).x-Y.x,v=X.y-Y.y,function(V){return V*(180/Math.PI)}(Math.atan2(v,O))),c=l(S),H=x/E,y={distance:x,position:K};if("circle"===F.options.shape?(N=Math.min(x,E),D=F.position,b=N,n={x:0,y:0},T=l(T=S),n.x=D.x-b*Math.cos(T),n.y=D.y-b*Math.sin(T),t=n):(t=function(V,I,m){return{x:Math.min(Math.max(V.x,I.x-m),I.x+m),y:Math.min(Math.max(V.y,I.y-m),I.y+m)}}(K,F.position,E),N=C(t,F.position)),m.follow){if(x>E){var z=K.x-t.x,Z=K.y-t.y;F.position.x+=z,F.position.y+=Z,F.el.style.top=F.position.y-(I.box.top+k.y)+"px",F.el.style.left=F.position.x-(I.box.left+k.x)+"px",x=C(K,F.position)}}else K=t,x=N;var B=K.x-F.position.x,W=K.y-F.position.y;F.frontPosition={x:B,y:W},m.dataOnly||(F.ui.front.style.transform="translate("+B+"px,"+W+"px)");var Q={identifier:F.identifier,position:K,force:H,pressure:V.force||V.pressure||V.webkitForce||0,distance:x,angle:{radian:c,degree:S},vector:{x:B/E,y:-W/E},raw:y,instance:F,lockX:m.lockX,lockY:m.lockY};(Q=F.computeDirection(Q)).angle={radian:l(180-S),degree:180-S},F.trigger("move",Q),I.trigger("move "+F.id+":move",Q)}else this.processOnEnd(V)},B.prototype.processOnEnd=function(V){var I=this,m=I.options,C=I.manager.getIdentifier(V),l=I.nipples.get(C),s=I.manager.removeIdentifier(l.identifier);l&&(m.dataOnly||l.hide((function(){"dynamic"===m.mode&&(l.trigger("removed",l),I.trigger("removed "+l.id+":removed",l),I.manager.trigger("removed "+l.id+":removed",l),l.destroy())})),clearInterval(I.pressureIntervals[l.identifier]),l.resetDirection(),l.trigger("end",l),I.trigger("end "+l.id+":end",l),I.ids.indexOf(l.identifier)>=0&&I.ids.splice(I.ids.indexOf(l.identifier),1),I.actives.indexOf(l)>=0&&I.actives.splice(I.actives.indexOf(l),1),/(semi|static)/.test(m.mode)?I.idles.push(l):I.nipples.indexOf(l)>=0&&I.nipples.splice(I.nipples.indexOf(l),1),I.manager.unbindDocument(),/(semi|static)/.test(m.mode)&&(I.manager.ids[s.id]=s.identifier))},B.prototype.onDestroyed=function(V,I){var m=this;m.nipples.indexOf(I)>=0&&m.nipples.splice(m.nipples.indexOf(I),1),m.actives.indexOf(I)>=0&&m.actives.splice(m.actives.indexOf(I),1),m.idles.indexOf(I)>=0&&m.idles.splice(m.idles.indexOf(I),1),m.ids.indexOf(I.identifier)>=0&&m.ids.splice(m.ids.indexOf(I.identifier),1),m.manager.removeIdentifier(I.identifier),m.manager.unbindDocument()},B.prototype.destroy=function(){var V=this;for(var I in V.unbindEvt(V.options.zone,"start"),V.nipples.forEach((function(V){V.destroy()})),V.pressureIntervals)V.pressureIntervals.hasOwnProperty(I)&&clearInterval(V.pressureIntervals[I]);V.trigger("destroyed",V.nipples),V.manager.unbindDocument(),V.off()};const W=B;function Q(V){var I=this;I.ids={},I.index=0,I.collections=[],I.scroll=K(),I.config(V),I.prepareCollections();var m=function(){var V;I.collections.forEach((function(m){m.forEach((function(m){V=m.el.getBoundingClientRect(),m.position={x:I.scroll.x+V.left,y:I.scroll.y+V.top}}))}))};k(window,"resize",(function(){F(m)}));var C=function(){I.scroll=K()};return k(window,"scroll",(function(){F(C)})),I.collections}Q.prototype=new y,Q.constructor=Q,Q.prototype.prepareCollections=function(){var V=this;V.collections.create=V.create.bind(V),V.collections.on=V.on.bind(V),V.collections.off=V.off.bind(V),V.collections.destroy=V.destroy.bind(V),V.collections.get=function(I){var m;return V.collections.every((function(V){return!(m=V.get(I))})),m}},Q.prototype.create=function(V){return this.createCollection(V)},Q.prototype.createCollection=function(V){var I=this,m=new W(I,V);return I.bindCollection(m),I.collections.push(m),m},Q.prototype.bindCollection=function(V){var I,m=this,C=function(V,C){I=V.type+" "+C.id+":"+V.type,m.trigger(I,C)};V.on("destroyed",m.onDestroyed.bind(m)),V.on("shown hidden rested dir plain",C),V.on("dir:up dir:right dir:down dir:left",C),V.on("plain:up plain:right plain:down plain:left",C)},Q.prototype.bindDocument=function(){var V=this;V.binded||(V.bindEvt(document,"move").bindEvt(document,"end"),V.binded=!0)},Q.prototype.unbindDocument=function(V){var I=this;Object.keys(I.ids).length&&!0!==V||(I.unbindEvt(document,"move").unbindEvt(document,"end"),I.binded=!1)},Q.prototype.getIdentifier=function(V){var I;return V?void 0===(I=void 0===V.identifier?V.pointerId:V.identifier)&&(I=this.latest||0):I=this.index,void 0===this.ids[I]&&(this.ids[I]=this.index,this.index+=1),this.latest=I,this.ids[I]},Q.prototype.removeIdentifier=function(V){var I={};for(var m in this.ids)if(this.ids[m]===V){I.id=m,I.identifier=this.ids[m],delete this.ids[m];break}return I},Q.prototype.onmove=function(V){return this.onAny("move",V),!1},Q.prototype.onend=function(V){return this.onAny("end",V),!1},Q.prototype.oncancel=function(V){return this.onAny("end",V),!1},Q.prototype.onAny=function(V,I){var m,C=this,l="processOn"+V.charAt(0).toUpperCase()+V.slice(1);I=E(I);var s=function(V,I,m){m.ids.indexOf(I)>=0&&(m[l](V),V._found_=!0)};return N(I,(function(V){m=C.getIdentifier(V),N(C.collections,s.bind(null,V,m)),V._found_||C.removeIdentifier(m)})),!1},Q.prototype.destroy=function(){var V=this;V.unbindDocument(!0),V.ids={},V.index=0,V.collections.forEach((function(V){V.destroy()})),V.off()},Q.prototype.onDestroyed=function(V,I){var m=this;if(m.collections.indexOf(I)<0)return!1;m.collections.splice(m.collections.indexOf(I),1)};var G=new Q;const r={create:function(V){return G.create(V)},factory:G};return I.default})(),V.exports=I()},12278:(V,I,m)=>{"use strict";const{Deflate:C,deflate:l,deflateRaw:s,gzip:F}=m(12287),{Inflate:k,inflate:j,inflateRaw:E,ungzip:K}=m(12347),Y=m(12323);V.exports.Deflate=C,V.exports.deflate=l,V.exports.deflateRaw=s,V.exports.gzip=F,V.exports.Inflate=k,V.exports.inflate=j,V.exports.inflateRaw=E,V.exports.ungzip=K,V.exports.constants=Y},12287:(V,I,m)=>{"use strict";const C=m(12296),l=m(12330),s=m(12337),F=m(12315),k=m(12344),j=Object.prototype.toString,{Z_NO_FLUSH:E,Z_SYNC_FLUSH:K,Z_FULL_FLUSH:Y,Z_FINISH:X,Z_OK:O,Z_STREAM_END:v,Z_DEFAULT_COMPRESSION:N,Z_DEFAULT_STRATEGY:t,Z_DEFLATED:D}=m(12323);function b(V){this.options=l.assign({level:N,method:D,iV:16384,windowBits:15,memLevel:8,strategy:t},V||{});let I=this.options;I.raw&&I.windowBits>0?I.windowBits=-I.windowBits:I.gzip&&I.windowBits>0&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.kI="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;let m=C.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(m!==O)throw new Error(F[m]);if(I.header&&C.deflateSetHeader(this.strm,I.header),I.dictionary){let V;if(V="string"===typeof I.dictionary?s.string2buf(I.dictionary):"[object ArrayBuffer]"===j.call(I.dictionary)?new Uint8Array(I.dictionary):I.dictionary,m=C.deflateSetDictionary(this.strm,V),m!==O)throw new Error(F[m]);this._dict_set=!0}}function T(V,I){const m=new b(I);if(m.push(V,!0),m.err)throw m.kI||F[m.err];return m.result}b.prototype.push=function(V,I){const m=this.strm,l=this.options.iV;let F,k;if(this.ended)return!1;for(k=I===~~I?I:!0===I?X:E,"string"===typeof V?m.input=s.string2buf(V):"[object ArrayBuffer]"===j.call(V)?m.input=new Uint8Array(V):m.input=V,m.next_in=0,m.avail_in=m.input.length;;)if(0===m.avail_out&&(m.output=new Uint8Array(l),m.next_out=0,m.avail_out=l),(k===K||k===Y)&&m.avail_out<=6)this.onData(m.output.subarray(0,m.next_out)),m.avail_out=0;else{if(F=C.deflate(m,k),F===v)return m.next_out>0&&this.onData(m.output.subarray(0,m.next_out)),F=C.deflateEnd(this.strm),this.onEnd(F),this.ended=!0,F===O;if(0!==m.avail_out){if(k>0&&m.next_out>0)this.onData(m.output.subarray(0,m.next_out)),m.avail_out=0;else if(0===m.avail_in)break}else this.onData(m.output)}return!0},b.prototype.onData=function(V){this.chunks.push(V)},b.prototype.onEnd=function(V){V===O&&(this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.kI=this.strm.kI},V.exports.Deflate=b,V.exports.deflate=T,V.exports.deflateRaw=function(V,I){return(I=I||{}).raw=!0,T(V,I)},V.exports.gzip=function(V,I){return(I=I||{}).gzip=!0,T(V,I)},V.exports.constants=m(12323)},12347:(V,I,m)=>{"use strict";const C=m(12352),l=m(12330),s=m(12337),F=m(12315),k=m(12344),j=m(12374),E=Object.prototype.toString,{Z_NO_FLUSH:K,Z_FINISH:Y,Z_OK:X,Z_STREAM_END:O,Z_NEED_DICT:v,Z_STREAM_ERROR:N,Z_DATA_ERROR:t,Z_MEM_ERROR:D}=m(12323);function b(V){this.options=l.assign({iV:65536,windowBits:15,to:""},V||{});const I=this.options;I.raw&&I.windowBits>=0&&I.windowBits<16&&(I.windowBits=-I.windowBits,0===I.windowBits&&(I.windowBits=-15)),!(I.windowBits>=0&&I.windowBits<16)||V&&V.windowBits||(I.windowBits+=32),I.windowBits>15&&I.windowBits<48&&0===(15&I.windowBits)&&(I.windowBits|=15),this.err=0,this.kI="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;let m=C.inflateInit2(this.strm,I.windowBits);if(m!==X)throw new Error(F[m]);if(this.header=new j,C.inflateGetHeader(this.strm,this.header),I.dictionary&&("string"===typeof I.dictionary?I.dictionary=s.string2buf(I.dictionary):"[object ArrayBuffer]"===E.call(I.dictionary)&&(I.dictionary=new Uint8Array(I.dictionary)),I.raw&&(m=C.inflateSetDictionary(this.strm,I.dictionary),m!==X)))throw new Error(F[m])}function T(V,I){const m=new b(I);if(m.push(V),m.err)throw m.kI||F[m.err];return m.result}b.prototype.push=function(V,I){const m=this.strm,l=this.options.iV,F=this.options.dictionary;let k,j,b;if(this.ended)return!1;for(j=I===~~I?I:!0===I?Y:K,"[object ArrayBuffer]"===E.call(V)?m.input=new Uint8Array(V):m.input=V,m.next_in=0,m.avail_in=m.input.length;;){for(0===m.avail_out&&(m.output=new Uint8Array(l),m.next_out=0,m.avail_out=l),k=C.inflate(m,j),k===v&&F&&(k=C.inflateSetDictionary(m,F),k===X?k=C.inflate(m,j):k===t&&(k=v));m.avail_in>0&&k===O&&m.state.wrap>0&&0!==V[m.next_in];)C.inflateReset(m),k=C.inflate(m,j);switch(k){case N:case t:case v:case D:return this.onEnd(k),this.ended=!0,!1}if(b=m.avail_out,m.next_out&&(0===m.avail_out||k===O))if("string"===this.options.to){let V=s.utf8border(m.output,m.next_out),I=m.next_out-V,C=s.buf2string(m.output,V);m.next_out=I,m.avail_out=l-I,I&&m.output.set(m.output.subarray(V,V+I),0),this.onData(C)}else this.onData(m.output.length===m.next_out?m.output:m.output.subarray(0,m.next_out));if(k!==X||0!==b){if(k===O)return k=C.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,!0;if(0===m.avail_in)break}}return!0},b.prototype.onData=function(V){this.chunks.push(V)},b.prototype.onEnd=function(V){V===X&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.kI=this.strm.kI},V.exports.Inflate=b,V.exports.inflate=T,V.exports.inflateRaw=function(V,I){return(I=I||{}).raw=!0,T(V,I)},V.exports.ungzip=T,V.exports.constants=m(12323)},12330:V=>{"use strict";const I=(V,I)=>Object.prototype.hasOwnProperty.call(V,I);V.exports.assign=function(V){const m=Array.prototype.slice.call(arguments,1);for(;m.length;){const C=m.shift();if(C){if("object"!==typeof C)throw new TypeError(C+"must be non-object");for(const m in C)I(C,m)&&(V[m]=C[m])}}return V},V.exports.flattenChunks=V=>{let I=0;for(let C=0,l=V.length;C<l;C++)I+=V[C].length;const m=new Uint8Array(I);for(let C=0,l=0,s=V.length;C<s;C++){let I=V[C];m.set(I,l),l+=I.length}return m}},12337:V=>{"use strict";let I=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(C){I=!1}const m=new Uint8Array(256);for(let l=0;l<256;l++)m[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;m[254]=m[254]=1,V.exports.string2buf=V=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(V);let I,m,C,l,s,F=V.length,k=0;for(l=0;l<F;l++)m=V.charCodeAt(l),55296===(64512&m)&&l+1<F&&(C=V.charCodeAt(l+1),56320===(64512&C)&&(m=65536+(m-55296<<10)+(C-56320),l++)),k+=m<128?1:m<2048?2:m<65536?3:4;for(I=new Uint8Array(k),s=0,l=0;s<k;l++)m=V.charCodeAt(l),55296===(64512&m)&&l+1<F&&(C=V.charCodeAt(l+1),56320===(64512&C)&&(m=65536+(m-55296<<10)+(C-56320),l++)),m<128?I[s++]=m:m<2048?(I[s++]=192|m>>>6,I[s++]=128|63&m):m<65536?(I[s++]=224|m>>>12,I[s++]=128|m>>>6&63,I[s++]=128|63&m):(I[s++]=240|m>>>18,I[s++]=128|m>>>12&63,I[s++]=128|m>>>6&63,I[s++]=128|63&m);return I};V.exports.buf2string=(V,C)=>{const l=C||V.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(V.subarray(0,C));let s,F;const k=new Array(2*l);for(F=0,s=0;s<l;){let I=V[s++];if(I<128){k[F++]=I;continue}let C=m[I];if(C>4)k[F++]=65533,s+=C-1;else{for(I&=2===C?31:3===C?15:7;C>1&&s<l;)I=I<<6|63&V[s++],C--;C>1?k[F++]=65533:I<65536?k[F++]=I:(I-=65536,k[F++]=55296|I>>10&1023,k[F++]=56320|1023&I)}}return((V,m)=>{if(m<65534&&V.subarray&&I)return String.fromCharCode.apply(null,V.length===m?V:V.subarray(0,m));let C="";for(let I=0;I<m;I++)C+=String.fromCharCode(V[I]);return C})(k,F)},V.exports.utf8border=(V,I)=>{(I=I||V.length)>V.length&&(I=V.length);let C=I-1;for(;C>=0&&128===(192&V[C]);)C--;return C<0||0===C?I:C+m[V[C]]>I?C:I}},12301:V=>{"use strict";V.exports=(V,I,m,C)=>{let l=65535&V,s=V>>>16&65535,F=0;for(;0!==m;){F=m>2e3?2e3:m,m-=F;do{l=l+I[C++]|0,s=s+l|0}while(--F);l%=65521,s%=65521}return l|s<<16}},12323:V=>{"use strict";V.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12309:V=>{"use strict";const I=new Uint32Array((()=>{let V,I=[];for(var m=0;m<256;m++){V=m;for(var C=0;C<8;C++)V=1&V?3988292384^V>>>1:V>>>1;I[m]=V}return I})());V.exports=(V,m,C,l)=>{const s=I,F=l+C;V^=-1;for(let I=l;I<F;I++)V=V>>>8^s[255&(V^m[I])];return~V}},12296:(V,I,m)=>{"use strict";const{_tr_init:C,_tr_stored_block:l,_tr_flush_block:s,_tr_tally:F,_tr_align:k}=m(12299),j=m(12301),E=m(12309),K=m(12315),{Z_NO_FLUSH:Y,Z_PARTIAL_FLUSH:X,Z_FULL_FLUSH:O,Z_FINISH:v,Z_BLOCK:N,Z_OK:t,Z_STREAM_END:D,Z_STREAM_ERROR:b,Z_DATA_ERROR:T,Z_BUF_ERROR:n,Z_DEFAULT_COMPRESSION:x,Z_FILTERED:S,Z_HUFFMAN_ONLY:c,Z_RLE:H,Z_FIXED:y,Z_DEFAULT_STRATEGY:z,Z_UNKNOWN:Z,Z_DEFLATED:B}=m(12323),W=258,Q=262,G=103,r=113,g=666,h=(V,I)=>(V.kI=K[I],I),d=V=>(V<<1)-(V>4?9:0),R=V=>{let I=V.length;for(;--I>=0;)V[I]=0};let i=(V,I,m)=>(I<<V.hash_shift^m)&V.hash_mask;const q=V=>{const I=V.state;let m=I.pending;m>V.avail_out&&(m=V.avail_out),0!==m&&(V.output.set(I.pending_buf.subarray(I.pending_out,I.pending_out+m),V.next_out),V.next_out+=m,I.pending_out+=m,V.total_out+=m,V.avail_out-=m,I.pending-=m,0===I.pending&&(I.pending_out=0))},P=(V,I)=>{s(V,V.block_start>=0?V.block_start:-1,V.strstart-V.block_start,I),V.block_start=V.strstart,q(V.strm)},u=(V,I)=>{V.pending_buf[V.pending++]=I},o=(V,I)=>{V.pending_buf[V.pending++]=I>>>8&255,V.pending_buf[V.pending++]=255&I},p=(V,I,m,C)=>{let l=V.avail_in;return l>C&&(l=C),0===l?0:(V.avail_in-=l,I.set(V.input.subarray(V.next_in,V.next_in+l),m),1===V.state.wrap?V.adler=j(V.adler,I,l,m):2===V.state.wrap&&(V.adler=E(V.adler,I,l,m)),V.next_in+=l,V.total_in+=l,l)},M=(V,I)=>{let m,C,l=V.max_chain_length,s=V.strstart,F=V.prev_length,k=V.nice_match;const j=V.strstart>V.w_size-Q?V.strstart-(V.w_size-Q):0,E=V.window,K=V.w_mask,Y=V.prev,X=V.strstart+W;let O=E[s+F-1],v=E[s+F];V.prev_length>=V.good_match&&(l>>=2),k>V.lookahead&&(k=V.lookahead);do{if(m=I,E[m+F]===v&&E[m+F-1]===O&&E[m]===E[s]&&E[++m]===E[s+1]){s+=2,m++;do{}while(E[++s]===E[++m]&&E[++s]===E[++m]&&E[++s]===E[++m]&&E[++s]===E[++m]&&E[++s]===E[++m]&&E[++s]===E[++m]&&E[++s]===E[++m]&&E[++s]===E[++m]&&s<X);if(C=W-(X-s),s=X-W,C>F){if(V.match_start=I,F=C,C>=k)break;O=E[s+F-1],v=E[s+F]}}}while((I=Y[I&K])>j&&0!==--l);return F<=V.lookahead?F:V.lookahead},f=V=>{const I=V.w_size;let m,C,l,s,F;do{if(s=V.window_size-V.lookahead-V.strstart,V.strstart>=I+(I-Q)){V.window.set(V.window.subarray(I,I+I),0),V.match_start-=I,V.strstart-=I,V.block_start-=I,C=V.hash_size,m=C;do{l=V.head[--m],V.head[m]=l>=I?l-I:0}while(--C);C=I,m=C;do{l=V.prev[--m],V.prev[m]=l>=I?l-I:0}while(--C);s+=I}if(0===V.strm.avail_in)break;if(C=p(V.strm,V.window,V.strstart+V.lookahead,s),V.lookahead+=C,V.lookahead+V.insert>=3)for(F=V.strstart-V.insert,V.ins_h=V.window[F],V.ins_h=i(V,V.ins_h,V.window[F+1]);V.insert&&(V.ins_h=i(V,V.ins_h,V.window[F+3-1]),V.prev[F&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=F,F++,V.insert--,!(V.lookahead+V.insert<3)););}while(V.lookahead<Q&&0!==V.strm.avail_in)},w=(V,I)=>{let m,C;for(;;){if(V.lookahead<Q){if(f(V),V.lookahead<Q&&I===Y)return 1;if(0===V.lookahead)break}if(m=0,V.lookahead>=3&&(V.ins_h=i(V,V.ins_h,V.window[V.strstart+3-1]),m=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),0!==m&&V.strstart-m<=V.w_size-Q&&(V.match_length=M(V,m)),V.match_length>=3)if(C=F(V,V.strstart-V.match_start,V.match_length-3),V.lookahead-=V.match_length,V.match_length<=V.max_lazy_match&&V.lookahead>=3){V.match_length--;do{V.strstart++,V.ins_h=i(V,V.ins_h,V.window[V.strstart+3-1]),m=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart}while(0!==--V.match_length);V.strstart++}else V.strstart+=V.match_length,V.match_length=0,V.ins_h=V.window[V.strstart],V.ins_h=i(V,V.ins_h,V.window[V.strstart+1]);else C=F(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++;if(C&&(P(V,!1),0===V.strm.avail_out))return 1}return V.insert=V.strstart<2?V.strstart:2,I===v?(P(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(P(V,!1),0===V.strm.avail_out)?1:2},A=(V,I)=>{let m,C,l;for(;;){if(V.lookahead<Q){if(f(V),V.lookahead<Q&&I===Y)return 1;if(0===V.lookahead)break}if(m=0,V.lookahead>=3&&(V.ins_h=i(V,V.ins_h,V.window[V.strstart+3-1]),m=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),V.prev_length=V.match_length,V.prev_match=V.match_start,V.match_length=2,0!==m&&V.prev_length<V.max_lazy_match&&V.strstart-m<=V.w_size-Q&&(V.match_length=M(V,m),V.match_length<=5&&(V.strategy===S||3===V.match_length&&V.strstart-V.match_start>4096)&&(V.match_length=2)),V.prev_length>=3&&V.match_length<=V.prev_length){l=V.strstart+V.lookahead-3,C=F(V,V.strstart-1-V.prev_match,V.prev_length-3),V.lookahead-=V.prev_length-1,V.prev_length-=2;do{++V.strstart<=l&&(V.ins_h=i(V,V.ins_h,V.window[V.strstart+3-1]),m=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart)}while(0!==--V.prev_length);if(V.match_available=0,V.match_length=2,V.strstart++,C&&(P(V,!1),0===V.strm.avail_out))return 1}else if(V.match_available){if(C=F(V,0,V.window[V.strstart-1]),C&&P(V,!1),V.strstart++,V.lookahead--,0===V.strm.avail_out)return 1}else V.match_available=1,V.strstart++,V.lookahead--}return V.match_available&&(C=F(V,0,V.window[V.strstart-1]),V.match_available=0),V.insert=V.strstart<2?V.strstart:2,I===v?(P(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(P(V,!1),0===V.strm.avail_out)?1:2};function J(V,I,m,C,l){this.good_length=V,this.max_lazy=I,this.nice_length=m,this.max_chain=C,this.func=l}const U=[new J(0,0,0,0,((V,I)=>{let m=65535;for(m>V.pending_buf_size-5&&(m=V.pending_buf_size-5);;){if(V.lookahead<=1){if(f(V),0===V.lookahead&&I===Y)return 1;if(0===V.lookahead)break}V.strstart+=V.lookahead,V.lookahead=0;const C=V.block_start+m;if((0===V.strstart||V.strstart>=C)&&(V.lookahead=V.strstart-C,V.strstart=C,P(V,!1),0===V.strm.avail_out))return 1;if(V.strstart-V.block_start>=V.w_size-Q&&(P(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,I===v?(P(V,!0),0===V.strm.avail_out?3:4):(V.strstart>V.block_start&&(P(V,!1),V.strm.avail_out),1)})),new J(4,4,8,4,w),new J(4,5,16,8,w),new J(4,6,32,32,w),new J(4,4,16,16,A),new J(8,16,32,32,A),new J(8,16,128,128,A),new J(8,32,128,256,A),new J(32,128,258,1024,A),new J(32,258,258,4096,A)];function e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=B,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),R(this.dyn_ltree),R(this.dyn_dtree),R(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),R(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),R(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const a=V=>{if(!V||!V.state)return h(V,b);V.total_in=V.total_out=0,V.data_type=Z;const I=V.state;return I.pending=0,I.pending_out=0,I.wrap<0&&(I.wrap=-I.wrap),I.status=I.wrap?42:r,V.adler=2===I.wrap?0:1,I.last_flush=Y,C(I),t},L=V=>{const I=a(V);var m;return I===t&&((m=V.state).window_size=2*m.w_size,R(m.head),m.max_lazy_match=U[m.level].max_lazy,m.good_match=U[m.level].good_length,m.nice_match=U[m.level].nice_length,m.max_chain_length=U[m.level].max_chain,m.strstart=0,m.block_start=0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,m.match_available=0,m.ins_h=0),I},VV=(V,I,m,C,l,s)=>{if(!V)return b;let F=1;if(I===x&&(I=6),C<0?(F=0,C=-C):C>15&&(F=2,C-=16),l<1||l>9||m!==B||C<8||C>15||I<0||I>9||s<0||s>y)return h(V,b);8===C&&(C=9);const k=new e;return V.state=k,k.strm=V,k.wrap=F,k.gzhead=null,k.w_bits=C,k.w_size=1<<k.w_bits,k.w_mask=k.w_size-1,k.hash_bits=l+7,k.hash_size=1<<k.hash_bits,k.hash_mask=k.hash_size-1,k.hash_shift=~~((k.hash_bits+3-1)/3),k.window=new Uint8Array(2*k.w_size),k.head=new Uint16Array(k.hash_size),k.prev=new Uint16Array(k.w_size),k.lit_bufsize=1<<l+6,k.pending_buf_size=4*k.lit_bufsize,k.pending_buf=new Uint8Array(k.pending_buf_size),k.d_buf=1*k.lit_bufsize,k.l_buf=3*k.lit_bufsize,k.level=I,k.strategy=s,k.method=m,L(V)};V.exports.deflateInit=(V,I)=>VV(V,I,B,15,8,z),V.exports.deflateInit2=VV,V.exports.deflateReset=L,V.exports.deflateResetKeep=a,V.exports.deflateSetHeader=(V,I)=>V&&V.state?2!==V.state.wrap?b:(V.state.gzhead=I,t):b,V.exports.deflate=(V,I)=>{let m,C;if(!V||!V.state||I>N||I<0)return V?h(V,b):b;const s=V.state;if(!V.output||!V.input&&0!==V.avail_in||s.status===g&&I!==v)return h(V,0===V.avail_out?n:b);s.strm=V;const j=s.last_flush;if(s.last_flush=I,42===s.status)if(2===s.wrap)V.adler=0,u(s,31),u(s,139),u(s,8),s.gzhead?(u(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),u(s,255&s.gzhead.time),u(s,s.gzhead.time>>8&255),u(s,s.gzhead.time>>16&255),u(s,s.gzhead.time>>24&255),u(s,9===s.level?2:s.strategy>=c||s.level<2?4:0),u(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(u(s,255&s.gzhead.extra.length),u(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(V.adler=E(V.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(u(s,0),u(s,0),u(s,0),u(s,0),u(s,0),u(s,9===s.level?2:s.strategy>=c||s.level<2?4:0),u(s,3),s.status=r);else{let I=B+(s.w_bits-8<<4)<<8,m=-1;m=s.strategy>=c||s.level<2?0:s.level<6?1:6===s.level?2:3,I|=m<<6,0!==s.strstart&&(I|=32),I+=31-I%31,s.status=r,o(s,I),0!==s.strstart&&(o(s,V.adler>>>16),o(s,65535&V.adler)),V.adler=1}if(69===s.status)if(s.gzhead.extra){for(m=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>m&&(V.adler=E(V.adler,s.pending_buf,s.pending-m,m)),q(V),m=s.pending,s.pending!==s.pending_buf_size));)u(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>m&&(V.adler=E(V.adler,s.pending_buf,s.pending-m,m)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){m=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>m&&(V.adler=E(V.adler,s.pending_buf,s.pending-m,m)),q(V),m=s.pending,s.pending===s.pending_buf_size)){C=1;break}C=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,u(s,C)}while(0!==C);s.gzhead.hcrc&&s.pending>m&&(V.adler=E(V.adler,s.pending_buf,s.pending-m,m)),0===C&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){m=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>m&&(V.adler=E(V.adler,s.pending_buf,s.pending-m,m)),q(V),m=s.pending,s.pending===s.pending_buf_size)){C=1;break}C=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,u(s,C)}while(0!==C);s.gzhead.hcrc&&s.pending>m&&(V.adler=E(V.adler,s.pending_buf,s.pending-m,m)),0===C&&(s.status=G)}else s.status=G;if(s.status===G&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&q(V),s.pending+2<=s.pending_buf_size&&(u(s,255&V.adler),u(s,V.adler>>8&255),V.adler=0,s.status=r)):s.status=r),0!==s.pending){if(q(V),0===V.avail_out)return s.last_flush=-1,t}else if(0===V.avail_in&&d(I)<=d(j)&&I!==v)return h(V,n);if(s.status===g&&0!==V.avail_in)return h(V,n);if(0!==V.avail_in||0!==s.lookahead||I!==Y&&s.status!==g){let m=s.strategy===c?((V,I)=>{let m;for(;;){if(0===V.lookahead&&(f(V),0===V.lookahead)){if(I===Y)return 1;break}if(V.match_length=0,m=F(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,m&&(P(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,I===v?(P(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(P(V,!1),0===V.strm.avail_out)?1:2})(s,I):s.strategy===H?((V,I)=>{let m,C,l,s;const k=V.window;for(;;){if(V.lookahead<=W){if(f(V),V.lookahead<=W&&I===Y)return 1;if(0===V.lookahead)break}if(V.match_length=0,V.lookahead>=3&&V.strstart>0&&(l=V.strstart-1,C=k[l],C===k[++l]&&C===k[++l]&&C===k[++l])){s=V.strstart+W;do{}while(C===k[++l]&&C===k[++l]&&C===k[++l]&&C===k[++l]&&C===k[++l]&&C===k[++l]&&C===k[++l]&&C===k[++l]&&l<s);V.match_length=W-(s-l),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=3?(m=F(V,1,V.match_length-3),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(m=F(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),m&&(P(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,I===v?(P(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(P(V,!1),0===V.strm.avail_out)?1:2})(s,I):U[s.level].func(s,I);if(3!==m&&4!==m||(s.status=g),1===m||3===m)return 0===V.avail_out&&(s.last_flush=-1),t;if(2===m&&(I===X?k(s):I!==N&&(l(s,0,0,!1),I===O&&(R(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),q(V),0===V.avail_out))return s.last_flush=-1,t}return I!==v?t:s.wrap<=0?D:(2===s.wrap?(u(s,255&V.adler),u(s,V.adler>>8&255),u(s,V.adler>>16&255),u(s,V.adler>>24&255),u(s,255&V.total_in),u(s,V.total_in>>8&255),u(s,V.total_in>>16&255),u(s,V.total_in>>24&255)):(o(s,V.adler>>>16),o(s,65535&V.adler)),q(V),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?t:D)},V.exports.deflateEnd=V=>{if(!V||!V.state)return b;const I=V.state.status;return 42!==I&&69!==I&&73!==I&&91!==I&&I!==G&&I!==r&&I!==g?h(V,b):(V.state=null,I===r?h(V,T):t)},V.exports.deflateSetDictionary=(V,I)=>{let m=I.length;if(!V||!V.state)return b;const C=V.state,l=C.wrap;if(2===l||1===l&&42!==C.status||C.lookahead)return b;if(1===l&&(V.adler=j(V.adler,I,m,0)),C.wrap=0,m>=C.w_size){0===l&&(R(C.head),C.strstart=0,C.block_start=0,C.insert=0);let V=new Uint8Array(C.w_size);V.set(I.subarray(m-C.w_size,m),0),I=V,m=C.w_size}const s=V.avail_in,F=V.next_in,k=V.input;for(V.avail_in=m,V.next_in=0,V.input=I,f(C);C.lookahead>=3;){let V=C.strstart,I=C.lookahead-2;do{C.ins_h=i(C,C.ins_h,C.window[V+3-1]),C.prev[V&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=V,V++}while(--I);C.strstart=V,C.lookahead=2,f(C)}return C.strstart+=C.lookahead,C.block_start=C.strstart,C.insert=C.lookahead,C.lookahead=0,C.match_length=C.prev_length=2,C.match_available=0,V.next_in=F,V.input=k,V.avail_in=s,C.wrap=l,t},V.exports.deflateInfo="pako deflate (from Nodeca project)"},12374:V=>{"use strict";V.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12361:V=>{"use strict";V.exports=function(V,I){let m,C,l,s,F,k,j,E,K,Y,X,O,v,N,t,D,b,T,n,x,S,c,H,y;const z=V.state;m=V.next_in,H=V.input,C=m+(V.avail_in-5),l=V.next_out,y=V.output,s=l-(I-V.avail_out),F=l+(V.avail_out-257),k=z.dmax,j=z.wsize,E=z.whave,K=z.wnext,Y=z.window,X=z.hold,O=z.bits,v=z.lencode,N=z.distcode,t=(1<<z.lenbits)-1,D=(1<<z.distbits)-1;V:do{O<15&&(X+=H[m++]<<O,O+=8,X+=H[m++]<<O,O+=8),b=v[X&t];I:for(;;){if(T=b>>>24,X>>>=T,O-=T,T=b>>>16&255,0===T)y[l++]=65535&b;else{if(!(16&T)){if(0===(64&T)){b=v[(65535&b)+(X&(1<<T)-1)];continue I}if(32&T){z.mode=12;break V}V.kI="invalid literal/length code",z.mode=30;break V}n=65535&b,T&=15,T&&(O<T&&(X+=H[m++]<<O,O+=8),n+=X&(1<<T)-1,X>>>=T,O-=T),O<15&&(X+=H[m++]<<O,O+=8,X+=H[m++]<<O,O+=8),b=N[X&D];m:for(;;){if(T=b>>>24,X>>>=T,O-=T,T=b>>>16&255,!(16&T)){if(0===(64&T)){b=N[(65535&b)+(X&(1<<T)-1)];continue m}V.kI="invalid distance code",z.mode=30;break V}if(x=65535&b,T&=15,O<T&&(X+=H[m++]<<O,O+=8,O<T&&(X+=H[m++]<<O,O+=8)),x+=X&(1<<T)-1,x>k){V.kI="invalid distance too far back",z.mode=30;break V}if(X>>>=T,O-=T,T=l-s,x>T){if(T=x-T,T>E&&z.sane){V.kI="invalid distance too far back",z.mode=30;break V}if(S=0,c=Y,0===K){if(S+=j-T,T<n){n-=T;do{y[l++]=Y[S++]}while(--T);S=l-x,c=y}}else if(K<T){if(S+=j+K-T,T-=K,T<n){n-=T;do{y[l++]=Y[S++]}while(--T);if(S=0,K<n){T=K,n-=T;do{y[l++]=Y[S++]}while(--T);S=l-x,c=y}}}else if(S+=K-T,T<n){n-=T;do{y[l++]=Y[S++]}while(--T);S=l-x,c=y}for(;n>2;)y[l++]=c[S++],y[l++]=c[S++],y[l++]=c[S++],n-=3;n&&(y[l++]=c[S++],n>1&&(y[l++]=c[S++]))}else{S=l-x;do{y[l++]=y[S++],y[l++]=y[S++],y[l++]=y[S++],n-=3}while(n>2);n&&(y[l++]=y[S++],n>1&&(y[l++]=y[S++]))}break}}break}}while(m<C&&l<F);n=O>>3,m-=n,O-=n<<3,X&=(1<<O)-1,V.next_in=m,V.next_out=l,V.avail_in=m<C?C-m+5:5-(m-C),V.avail_out=l<F?F-l+257:257-(l-F),z.hold=X,z.bits=O}},12352:(V,I,m)=>{"use strict";const C=m(12301),l=m(12309),s=m(12361),F=m(12365),{Z_FINISH:k,Z_BLOCK:j,Z_TREES:E,Z_OK:K,Z_STREAM_END:Y,Z_NEED_DICT:X,Z_STREAM_ERROR:O,Z_DATA_ERROR:v,Z_MEM_ERROR:N,Z_BUF_ERROR:t,Z_DEFLATED:D}=m(12323),b=12,T=30,n=V=>(V>>>24&255)+(V>>>8&65280)+((65280&V)<<8)+((255&V)<<24);function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const S=V=>{if(!V||!V.state)return O;const I=V.state;return V.total_in=V.total_out=I.total=0,V.kI="",I.wrap&&(V.adler=1&I.wrap),I.mode=1,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new Int32Array(852),I.distcode=I.distdyn=new Int32Array(592),I.sane=1,I.back=-1,K},c=V=>{if(!V||!V.state)return O;const I=V.state;return I.wsize=0,I.whave=0,I.wnext=0,S(V)},H=(V,I)=>{let m;if(!V||!V.state)return O;const C=V.state;return I<0?(m=0,I=-I):(m=1+(I>>4),I<48&&(I&=15)),I&&(I<8||I>15)?O:(null!==C.window&&C.wbits!==I&&(C.window=null),C.wrap=m,C.wbits=I,c(V))},y=(V,I)=>{if(!V)return O;const m=new x;V.state=m,m.window=null;const C=H(V,I);return C!==K&&(V.state=null),C};let z,Z,B=!0;const W=V=>{if(B){z=new Int32Array(512),Z=new Int32Array(32);let I=0;for(;I<144;)V.lens[I++]=8;for(;I<256;)V.lens[I++]=9;for(;I<280;)V.lens[I++]=7;for(;I<288;)V.lens[I++]=8;for(F(1,V.lens,0,288,z,0,V.work,{bits:9}),I=0;I<32;)V.lens[I++]=5;F(2,V.lens,0,32,Z,0,V.work,{bits:5}),B=!1}V.lencode=z,V.lenbits=9,V.distcode=Z,V.distbits=5},Q=(V,I,m,C)=>{let l;const s=V.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),C>=s.wsize?(s.window.set(I.subarray(m-s.wsize,m),0),s.wnext=0,s.whave=s.wsize):(l=s.wsize-s.wnext,l>C&&(l=C),s.window.set(I.subarray(m-C,m-C+l),s.wnext),(C-=l)?(s.window.set(I.subarray(m-C,m),0),s.wnext=C,s.whave=s.wsize):(s.wnext+=l,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=l))),0};V.exports.inflateReset=c,V.exports.inflateReset2=H,V.exports.inflateResetKeep=S,V.exports.inflateInit=V=>y(V,15),V.exports.inflateInit2=y,V.exports.inflate=(V,I)=>{let m,x,S,c,H,y,z,Z,B,G,r,g,h,d,R,i,q,P,u,o,p,M,f=0;const w=new Uint8Array(4);let A,J;const U=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!V||!V.state||!V.output||!V.input&&0!==V.avail_in)return O;m=V.state,m.mode===b&&(m.mode=13),H=V.next_out,S=V.output,z=V.avail_out,c=V.next_in,x=V.input,y=V.avail_in,Z=m.hold,B=m.bits,G=y,r=z,M=K;V:for(;;)switch(m.mode){case 1:if(0===m.wrap){m.mode=13;break}for(;B<16;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(2&m.wrap&&35615===Z){m.check=0,w[0]=255&Z,w[1]=Z>>>8&255,m.check=l(m.check,w,2,0),Z=0,B=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&Z)<<8)+(Z>>8))%31){V.kI="incorrect header check",m.mode=T;break}if((15&Z)!==D){V.kI="unknown compression method",m.mode=T;break}if(Z>>>=4,B-=4,p=8+(15&Z),0===m.wbits)m.wbits=p;else if(p>m.wbits){V.kI="invalid window size",m.mode=T;break}m.dmax=1<<m.wbits,V.adler=m.check=1,m.mode=512&Z?10:b,Z=0,B=0;break;case 2:for(;B<16;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(m.flags=Z,(255&m.flags)!==D){V.kI="unknown compression method",m.mode=T;break}if(57344&m.flags){V.kI="unknown header flags set",m.mode=T;break}m.head&&(m.head.text=Z>>8&1),512&m.flags&&(w[0]=255&Z,w[1]=Z>>>8&255,m.check=l(m.check,w,2,0)),Z=0,B=0,m.mode=3;case 3:for(;B<32;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}m.head&&(m.head.time=Z),512&m.flags&&(w[0]=255&Z,w[1]=Z>>>8&255,w[2]=Z>>>16&255,w[3]=Z>>>24&255,m.check=l(m.check,w,4,0)),Z=0,B=0,m.mode=4;case 4:for(;B<16;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}m.head&&(m.head.xflags=255&Z,m.head.os=Z>>8),512&m.flags&&(w[0]=255&Z,w[1]=Z>>>8&255,m.check=l(m.check,w,2,0)),Z=0,B=0,m.mode=5;case 5:if(1024&m.flags){for(;B<16;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}m.length=Z,m.head&&(m.head.extra_len=Z),512&m.flags&&(w[0]=255&Z,w[1]=Z>>>8&255,m.check=l(m.check,w,2,0)),Z=0,B=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&(g=m.length,g>y&&(g=y),g&&(m.head&&(p=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Uint8Array(m.head.extra_len)),m.head.extra.set(x.subarray(c,c+g),p)),512&m.flags&&(m.check=l(m.check,x,g,c)),y-=g,c+=g,m.length-=g),m.length))break V;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(0===y)break V;g=0;do{p=x[c+g++],m.head&&p&&m.length<65536&&(m.head.name+=String.fromCharCode(p))}while(p&&g<y);if(512&m.flags&&(m.check=l(m.check,x,g,c)),y-=g,c+=g,p)break V}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(0===y)break V;g=0;do{p=x[c+g++],m.head&&p&&m.length<65536&&(m.head.comment+=String.fromCharCode(p))}while(p&&g<y);if(512&m.flags&&(m.check=l(m.check,x,g,c)),y-=g,c+=g,p)break V}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;B<16;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(Z!==(65535&m.check)){V.kI="header crc mismatch",m.mode=T;break}Z=0,B=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),V.adler=m.check=0,m.mode=b;break;case 10:for(;B<32;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}V.adler=m.check=n(Z),Z=0,B=0,m.mode=11;case 11:if(0===m.havedict)return V.next_out=H,V.avail_out=z,V.next_in=c,V.avail_in=y,m.hold=Z,m.bits=B,X;V.adler=m.check=1,m.mode=b;case b:if(I===j||I===E)break V;case 13:if(m.last){Z>>>=7&B,B-=7&B,m.mode=27;break}for(;B<3;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}switch(m.last=1&Z,Z>>>=1,B-=1,3&Z){case 0:m.mode=14;break;case 1:if(W(m),m.mode=20,I===E){Z>>>=2,B-=2;break V}break;case 2:m.mode=17;break;case 3:V.kI="invalid block type",m.mode=T}Z>>>=2,B-=2;break;case 14:for(Z>>>=7&B,B-=7&B;B<32;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if((65535&Z)!==(Z>>>16^65535)){V.kI="invalid stored block lengths",m.mode=T;break}if(m.length=65535&Z,Z=0,B=0,m.mode=15,I===E)break V;case 15:m.mode=16;case 16:if(g=m.length,g){if(g>y&&(g=y),g>z&&(g=z),0===g)break V;S.set(x.subarray(c,c+g),H),y-=g,c+=g,z-=g,H+=g,m.length-=g;break}m.mode=b;break;case 17:for(;B<14;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(m.nlen=257+(31&Z),Z>>>=5,B-=5,m.ndist=1+(31&Z),Z>>>=5,B-=5,m.ncode=4+(15&Z),Z>>>=4,B-=4,m.nlen>286||m.ndist>30){V.kI="too many length or distance symbols",m.mode=T;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;B<3;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}m.lens[U[m.have++]]=7&Z,Z>>>=3,B-=3}for(;m.have<19;)m.lens[U[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,A={bits:m.lenbits},M=F(0,m.lens,0,19,m.lencode,0,m.work,A),m.lenbits=A.bits,M){V.kI="invalid code lengths set",m.mode=T;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;f=m.lencode[Z&(1<<m.lenbits)-1],R=f>>>24,i=f>>>16&255,q=65535&f,!(R<=B);){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(q<16)Z>>>=R,B-=R,m.lens[m.have++]=q;else{if(16===q){for(J=R+2;B<J;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(Z>>>=R,B-=R,0===m.have){V.kI="invalid bit length repeat",m.mode=T;break}p=m.lens[m.have-1],g=3+(3&Z),Z>>>=2,B-=2}else if(17===q){for(J=R+3;B<J;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}Z>>>=R,B-=R,p=0,g=3+(7&Z),Z>>>=3,B-=3}else{for(J=R+7;B<J;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}Z>>>=R,B-=R,p=0,g=11+(127&Z),Z>>>=7,B-=7}if(m.have+g>m.nlen+m.ndist){V.kI="invalid bit length repeat",m.mode=T;break}for(;g--;)m.lens[m.have++]=p}}if(m.mode===T)break;if(0===m.lens[256]){V.kI="invalid code -- missing end-of-block",m.mode=T;break}if(m.lenbits=9,A={bits:m.lenbits},M=F(1,m.lens,0,m.nlen,m.lencode,0,m.work,A),m.lenbits=A.bits,M){V.kI="invalid literal/lengths set",m.mode=T;break}if(m.distbits=6,m.distcode=m.distdyn,A={bits:m.distbits},M=F(2,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,A),m.distbits=A.bits,M){V.kI="invalid distances set",m.mode=T;break}if(m.mode=20,I===E)break V;case 20:m.mode=21;case 21:if(y>=6&&z>=258){V.next_out=H,V.avail_out=z,V.next_in=c,V.avail_in=y,m.hold=Z,m.bits=B,s(V,r),H=V.next_out,S=V.output,z=V.avail_out,c=V.next_in,x=V.input,y=V.avail_in,Z=m.hold,B=m.bits,m.mode===b&&(m.back=-1);break}for(m.back=0;f=m.lencode[Z&(1<<m.lenbits)-1],R=f>>>24,i=f>>>16&255,q=65535&f,!(R<=B);){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(i&&0===(240&i)){for(P=R,u=i,o=q;f=m.lencode[o+((Z&(1<<P+u)-1)>>P)],R=f>>>24,i=f>>>16&255,q=65535&f,!(P+R<=B);){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}Z>>>=P,B-=P,m.back+=P}if(Z>>>=R,B-=R,m.back+=R,m.length=q,0===i){m.mode=26;break}if(32&i){m.back=-1,m.mode=b;break}if(64&i){V.kI="invalid literal/length code",m.mode=T;break}m.extra=15&i,m.mode=22;case 22:if(m.extra){for(J=m.extra;B<J;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}m.length+=Z&(1<<m.extra)-1,Z>>>=m.extra,B-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;f=m.distcode[Z&(1<<m.distbits)-1],R=f>>>24,i=f>>>16&255,q=65535&f,!(R<=B);){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(0===(240&i)){for(P=R,u=i,o=q;f=m.distcode[o+((Z&(1<<P+u)-1)>>P)],R=f>>>24,i=f>>>16&255,q=65535&f,!(P+R<=B);){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}Z>>>=P,B-=P,m.back+=P}if(Z>>>=R,B-=R,m.back+=R,64&i){V.kI="invalid distance code",m.mode=T;break}m.offset=q,m.extra=15&i,m.mode=24;case 24:if(m.extra){for(J=m.extra;B<J;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}m.offset+=Z&(1<<m.extra)-1,Z>>>=m.extra,B-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){V.kI="invalid distance too far back",m.mode=T;break}m.mode=25;case 25:if(0===z)break V;if(g=r-z,m.offset>g){if(g=m.offset-g,g>m.whave&&m.sane){V.kI="invalid distance too far back",m.mode=T;break}g>m.wnext?(g-=m.wnext,h=m.wsize-g):h=m.wnext-g,g>m.length&&(g=m.length),d=m.window}else d=S,h=H-m.offset,g=m.length;g>z&&(g=z),z-=g,m.length-=g;do{S[H++]=d[h++]}while(--g);0===m.length&&(m.mode=21);break;case 26:if(0===z)break V;S[H++]=m.length,z--,m.mode=21;break;case 27:if(m.wrap){for(;B<32;){if(0===y)break V;y--,Z|=x[c++]<<B,B+=8}if(r-=z,V.total_out+=r,m.total+=r,r&&(V.adler=m.check=m.flags?l(m.check,S,r,H-r):C(m.check,S,r,H-r)),r=z,(m.flags?Z:n(Z))!==m.check){V.kI="incorrect data check",m.mode=T;break}Z=0,B=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;B<32;){if(0===y)break V;y--,Z+=x[c++]<<B,B+=8}if(Z!==(4294967295&m.total)){V.kI="incorrect length check",m.mode=T;break}Z=0,B=0}m.mode=29;case 29:M=Y;break V;case T:M=v;break V;case 31:return N;default:return O}return V.next_out=H,V.avail_out=z,V.next_in=c,V.avail_in=y,m.hold=Z,m.bits=B,(m.wsize||r!==V.avail_out&&m.mode<T&&(m.mode<27||I!==k))&&Q(V,V.output,V.next_out,r-V.avail_out)?(m.mode=31,N):(G-=V.avail_in,r-=V.avail_out,V.total_in+=G,V.total_out+=r,m.total+=r,m.wrap&&r&&(V.adler=m.check=m.flags?l(m.check,S,r,V.next_out-r):C(m.check,S,r,V.next_out-r)),V.data_type=m.bits+(m.last?64:0)+(m.mode===b?128:0)+(20===m.mode||15===m.mode?256:0),(0===G&&0===r||I===k)&&M===K&&(M=t),M)},V.exports.inflateEnd=V=>{if(!V||!V.state)return O;let I=V.state;return I.window&&(I.window=null),V.state=null,K},V.exports.inflateGetHeader=(V,I)=>{if(!V||!V.state)return O;const m=V.state;return 0===(2&m.wrap)?O:(m.head=I,I.done=!1,K)},V.exports.inflateSetDictionary=(V,I)=>{const m=I.length;let l,s,F;return V&&V.state?(l=V.state,0!==l.wrap&&11!==l.mode?O:11===l.mode&&(s=1,s=C(s,I,m,0),s!==l.check)?v:(F=Q(V,I,m,m),F?(l.mode=31,N):(l.havedict=1,K))):O},V.exports.inflateInfo="pako inflate (from Nodeca project)"},12365:V=>{"use strict";const I=15,m=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),C=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),l=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),s=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);V.exports=(V,F,k,j,E,K,Y,X)=>{const O=X.bits;let v,N,t,D,b,T,n=0,x=0,S=0,c=0,H=0,y=0,z=0,Z=0,B=0,W=0,Q=null,G=0;const r=new Uint16Array(16),g=new Uint16Array(16);let h,d,R,i=null,q=0;for(n=0;n<=I;n++)r[n]=0;for(x=0;x<j;x++)r[F[k+x]]++;for(H=O,c=I;c>=1&&0===r[c];c--);if(H>c&&(H=c),0===c)return E[K++]=20971520,E[K++]=20971520,X.bits=1,0;for(S=1;S<c&&0===r[S];S++);for(H<S&&(H=S),Z=1,n=1;n<=I;n++)if(Z<<=1,Z-=r[n],Z<0)return-1;if(Z>0&&(0===V||1!==c))return-1;for(g[1]=0,n=1;n<I;n++)g[n+1]=g[n]+r[n];for(x=0;x<j;x++)0!==F[k+x]&&(Y[g[F[k+x]]++]=x);if(0===V?(Q=i=Y,T=19):1===V?(Q=m,G-=257,i=C,q-=257,T=256):(Q=l,i=s,T=-1),W=0,x=0,n=S,b=K,y=H,z=0,t=-1,B=1<<H,D=B-1,1===V&&B>852||2===V&&B>592)return 1;for(;;){h=n-z,Y[x]<T?(d=0,R=Y[x]):Y[x]>T?(d=i[q+Y[x]],R=Q[G+Y[x]]):(d=96,R=0),v=1<<n-z,N=1<<y,S=N;do{N-=v,E[b+(W>>z)+N]=h<<24|d<<16|R}while(0!==N);for(v=1<<n-1;W&v;)v>>=1;if(0!==v?(W&=v-1,W+=v):W=0,x++,0===--r[n]){if(n===c)break;n=F[k+Y[x]]}if(n>H&&(W&D)!==t){for(0===z&&(z=H),b+=S,y=n-z,Z=1<<y;y+z<c&&(Z-=r[y+z],!(Z<=0));)y++,Z<<=1;if(B+=1<<y,1===V&&B>852||2===V&&B>592)return 1;t=W&D,E[t]=H<<24|y<<16|b-K}}return 0!==W&&(E[b+W]=n-z<<24|64<<16),X.bits=H,0}},12315:V=>{"use strict";V.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12299:V=>{"use strict";function I(V){let I=V.length;for(;--I>=0;)V[I]=0}const m=256,C=286,l=30,s=15,F=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),k=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),j=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),K=new Array(576);I(K);const Y=new Array(60);I(Y);const X=new Array(512);I(X);const O=new Array(256);I(O);const v=new Array(29);I(v);const N=new Array(l);function t(V,I,m,C,l){this.static_tree=V,this.extra_bits=I,this.extra_base=m,this.elems=C,this.max_length=l,this.has_stree=V&&V.length}let D,b,T;function n(V,I){this.dyn_tree=V,this.max_code=0,this.stat_desc=I}I(N);const x=V=>V<256?X[V]:X[256+(V>>>7)],S=(V,I)=>{V.pending_buf[V.pending++]=255&I,V.pending_buf[V.pending++]=I>>>8&255},c=(V,I,m)=>{V.bi_valid>16-m?(V.bi_buf|=I<<V.bi_valid&65535,S(V,V.bi_buf),V.bi_buf=I>>16-V.bi_valid,V.bi_valid+=m-16):(V.bi_buf|=I<<V.bi_valid&65535,V.bi_valid+=m)},H=(V,I,m)=>{c(V,m[2*I],m[2*I+1])},y=(V,I)=>{let m=0;do{m|=1&V,V>>>=1,m<<=1}while(--I>0);return m>>>1},z=(V,I,m)=>{const C=new Array(16);let l,F,k=0;for(l=1;l<=s;l++)C[l]=k=k+m[l-1]<<1;for(F=0;F<=I;F++){let I=V[2*F+1];0!==I&&(V[2*F]=y(C[I]++,I))}},Z=V=>{let I;for(I=0;I<C;I++)V.dyn_ltree[2*I]=0;for(I=0;I<l;I++)V.dyn_dtree[2*I]=0;for(I=0;I<19;I++)V.bl_tree[2*I]=0;V.dyn_ltree[512]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0},B=V=>{V.bi_valid>8?S(V,V.bi_buf):V.bi_valid>0&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0},W=(V,I,m,C)=>{const l=2*I,s=2*m;return V[l]<V[s]||V[l]===V[s]&&C[I]<=C[m]},Q=(V,I,m)=>{const C=V.heap[m];let l=m<<1;for(;l<=V.heap_len&&(l<V.heap_len&&W(I,V.heap[l+1],V.heap[l],V.depth)&&l++,!W(I,C,V.heap[l],V.depth));)V.heap[m]=V.heap[l],m=l,l<<=1;V.heap[m]=C},G=(V,I,C)=>{let l,s,j,E,K=0;if(0!==V.last_lit)do{l=V.pending_buf[V.d_buf+2*K]<<8|V.pending_buf[V.d_buf+2*K+1],s=V.pending_buf[V.l_buf+K],K++,0===l?H(V,s,I):(j=O[s],H(V,j+m+1,I),E=F[j],0!==E&&(s-=v[j],c(V,s,E)),l--,j=x(l),H(V,j,C),E=k[j],0!==E&&(l-=N[j],c(V,l,E)))}while(K<V.last_lit);H(V,256,I)},r=(V,I)=>{const m=I.dyn_tree,C=I.stat_desc.static_tree,l=I.stat_desc.has_stree,F=I.stat_desc.elems;let k,j,E,K=-1;for(V.heap_len=0,V.heap_max=573,k=0;k<F;k++)0!==m[2*k]?(V.heap[++V.heap_len]=K=k,V.depth[k]=0):m[2*k+1]=0;for(;V.heap_len<2;)E=V.heap[++V.heap_len]=K<2?++K:0,m[2*E]=1,V.depth[E]=0,V.opt_len--,l&&(V.static_len-=C[2*E+1]);for(I.max_code=K,k=V.heap_len>>1;k>=1;k--)Q(V,m,k);E=F;do{k=V.heap[1],V.heap[1]=V.heap[V.heap_len--],Q(V,m,1),j=V.heap[1],V.heap[--V.heap_max]=k,V.heap[--V.heap_max]=j,m[2*E]=m[2*k]+m[2*j],V.depth[E]=(V.depth[k]>=V.depth[j]?V.depth[k]:V.depth[j])+1,m[2*k+1]=m[2*j+1]=E,V.heap[1]=E++,Q(V,m,1)}while(V.heap_len>=2);V.heap[--V.heap_max]=V.heap[1],((V,I)=>{const m=I.dyn_tree,C=I.max_code,l=I.stat_desc.static_tree,F=I.stat_desc.has_stree,k=I.stat_desc.extra_bits,j=I.stat_desc.extra_base,E=I.stat_desc.max_length;let K,Y,X,O,v,N,t=0;for(O=0;O<=s;O++)V.bl_count[O]=0;for(m[2*V.heap[V.heap_max]+1]=0,K=V.heap_max+1;K<573;K++)Y=V.heap[K],O=m[2*m[2*Y+1]+1]+1,O>E&&(O=E,t++),m[2*Y+1]=O,Y>C||(V.bl_count[O]++,v=0,Y>=j&&(v=k[Y-j]),N=m[2*Y],V.opt_len+=N*(O+v),F&&(V.static_len+=N*(l[2*Y+1]+v)));if(0!==t){do{for(O=E-1;0===V.bl_count[O];)O--;V.bl_count[O]--,V.bl_count[O+1]+=2,V.bl_count[E]--,t-=2}while(t>0);for(O=E;0!==O;O--)for(Y=V.bl_count[O];0!==Y;)X=V.heap[--K],X>C||(m[2*X+1]!==O&&(V.opt_len+=(O-m[2*X+1])*m[2*X],m[2*X+1]=O),Y--)}})(V,I),z(m,K,V.bl_count)},g=(V,I,m)=>{let C,l,s=-1,F=I[1],k=0,j=7,E=4;for(0===F&&(j=138,E=3),I[2*(m+1)+1]=65535,C=0;C<=m;C++)l=F,F=I[2*(C+1)+1],++k<j&&l===F||(k<E?V.bl_tree[2*l]+=k:0!==l?(l!==s&&V.bl_tree[2*l]++,V.bl_tree[32]++):k<=10?V.bl_tree[34]++:V.bl_tree[36]++,k=0,s=l,0===F?(j=138,E=3):l===F?(j=6,E=3):(j=7,E=4))},h=(V,I,m)=>{let C,l,s=-1,F=I[1],k=0,j=7,E=4;for(0===F&&(j=138,E=3),C=0;C<=m;C++)if(l=F,F=I[2*(C+1)+1],!(++k<j&&l===F)){if(k<E)do{H(V,l,V.bl_tree)}while(0!==--k);else 0!==l?(l!==s&&(H(V,l,V.bl_tree),k--),H(V,16,V.bl_tree),c(V,k-3,2)):k<=10?(H(V,17,V.bl_tree),c(V,k-3,3)):(H(V,18,V.bl_tree),c(V,k-11,7));k=0,s=l,0===F?(j=138,E=3):l===F?(j=6,E=3):(j=7,E=4)}};let d=!1;const R=(V,I,m,C)=>{c(V,0+(C?1:0),3),((V,I,m,C)=>{B(V),C&&(S(V,m),S(V,~m)),V.pending_buf.set(V.window.subarray(I,I+m),V.pending),V.pending+=m})(V,I,m,!0)};V.exports._tr_init=V=>{d||((()=>{let V,I,m,E,n;const x=new Array(16);for(m=0,E=0;E<28;E++)for(v[E]=m,V=0;V<1<<F[E];V++)O[m++]=E;for(O[m-1]=E,n=0,E=0;E<16;E++)for(N[E]=n,V=0;V<1<<k[E];V++)X[n++]=E;for(n>>=7;E<l;E++)for(N[E]=n<<7,V=0;V<1<<k[E]-7;V++)X[256+n++]=E;for(I=0;I<=s;I++)x[I]=0;for(V=0;V<=143;)K[2*V+1]=8,V++,x[8]++;for(;V<=255;)K[2*V+1]=9,V++,x[9]++;for(;V<=279;)K[2*V+1]=7,V++,x[7]++;for(;V<=287;)K[2*V+1]=8,V++,x[8]++;for(z(K,287,x),V=0;V<l;V++)Y[2*V+1]=5,Y[2*V]=y(V,5);D=new t(K,F,257,C,s),b=new t(Y,k,0,l,s),T=new t(new Array(0),j,0,19,7)})(),d=!0),V.l_desc=new n(V.dyn_ltree,D),V.d_desc=new n(V.dyn_dtree,b),V.bl_desc=new n(V.bl_tree,T),V.bi_buf=0,V.bi_valid=0,Z(V)},V.exports._tr_stored_block=R,V.exports._tr_flush_block=(V,I,C,l)=>{let s,F,k=0;V.level>0?(2===V.strm.data_type&&(V.strm.data_type=(V=>{let I,C=4093624447;for(I=0;I<=31;I++,C>>>=1)if(1&C&&0!==V.dyn_ltree[2*I])return 0;if(0!==V.dyn_ltree[18]||0!==V.dyn_ltree[20]||0!==V.dyn_ltree[26])return 1;for(I=32;I<m;I++)if(0!==V.dyn_ltree[2*I])return 1;return 0})(V)),r(V,V.l_desc),r(V,V.d_desc),k=(V=>{let I;for(g(V,V.dyn_ltree,V.l_desc.max_code),g(V,V.dyn_dtree,V.d_desc.max_code),r(V,V.bl_desc),I=18;I>=3&&0===V.bl_tree[2*E[I]+1];I--);return V.opt_len+=3*(I+1)+5+5+4,I})(V),s=V.opt_len+3+7>>>3,F=V.static_len+3+7>>>3,F<=s&&(s=F)):s=F=C+5,C+4<=s&&-1!==I?R(V,I,C,l):4===V.strategy||F===s?(c(V,2+(l?1:0),3),G(V,K,Y)):(c(V,4+(l?1:0),3),((V,I,m,C)=>{let l;for(c(V,I-257,5),c(V,m-1,5),c(V,C-4,4),l=0;l<C;l++)c(V,V.bl_tree[2*E[l]+1],3);h(V,V.dyn_ltree,I-1),h(V,V.dyn_dtree,m-1)})(V,V.l_desc.max_code+1,V.d_desc.max_code+1,k+1),G(V,V.dyn_ltree,V.dyn_dtree)),Z(V),l&&B(V)},V.exports._tr_tally=(V,I,C)=>(V.pending_buf[V.d_buf+2*V.last_lit]=I>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&I,V.pending_buf[V.l_buf+V.last_lit]=255&C,V.last_lit++,0===I?V.dyn_ltree[2*C]++:(V.matches++,I--,V.dyn_ltree[2*(O[C]+m+1)]++,V.dyn_dtree[2*x(I)]++),V.last_lit===V.lit_bufsize-1),V.exports._tr_align=V=>{c(V,2,3),H(V,256,K),(V=>{16===V.bi_valid?(S(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):V.bi_valid>=8&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)})(V)}},12344:V=>{"use strict";V.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.kI="",this.state=null,this.data_type=2,this.adler=0}},11976:V=>{function I(V,I,m){for(var C=V.length,l=-1/0,s=1/0,F=0;F<C;F++){var k=(m[0][F]-V[F])/I[F],j=(m[1][F]-V[F])/I[F];if(k>j){var E=k;k=j,j=E}if(j<l||k>s)return 1/0;k>l&&(l=k),j<s&&(s=j)}return l>s?1/0:l}V.exports=function(V,m,C,l){var s=I(m,C,l);if(s===1/0)V=null;else{V=V||[];for(var F=0;F<m.length;F++)V[F]=m[F]+C[F]*s}return V},V.exports.distance=I},13369:(V,I,m)=>{"use strict";m.d(I,{d:()=>F});var C=m(38);const l=C.useLayoutEffect;const s=function(V){var I=(0,C.useRef)(V);return l((function(){I.current=V})),I};var F=function(V){var I=s(V);(0,C.lI)((function(){var V=function(V){var m;if(null!=I.current&&(m=I.current(V)),V.defaultPrevented&&(V.returnValue=""),"string"===typeof m)return V.returnValue=m,m};return window.addEventListener("beforeunload",V),function(){window.removeEventListener("beforeunload",V)}}),[])}},13324:(V,I,m)=>{"use strict";var C=m(13332),l=Array.prototype.concat,s=Array.prototype.slice,F=V.exports=function(V){for(var I=[],m=0,F=V.length;m<F;m++){var k=V[m];C(k)?I=l.call(I,s.call(k)):I.push(k)}return I};F.wrap=function(V){return function(){return V(F(arguments))}}},13332:V=>{V.exports=function(V){return!(!V||"string"===typeof V)&&(V instanceof Array||Array.isArray(V)||V.length>=0&&(V.splice instanceof Function||Object.getOwnPropertyDescriptor(V,V.length-1)&&"String"!==V.constructor.name))}},12238:(V,I,m)=>{var C=m(12240);function l(V){for(var I,m,l=0,s=V.length,F=0;F<V.length;){for(I=V[F],m=0;F<s&&V[F]===I;)++F,++m;l+=C.log2(m)/7|0,l+=C.log2(I>>>0)/7|0,l+=2}return l}I.size=l,I.encode=function(V,I){I||(I=new Uint8Array(l(V)));for(var m,C,s=0,F=I.length,k=0;k<V.length;){for(m=V[k],C=0;k<V.length&&V[k]===m;)++k,++C;for(;s<F&&C>=128;)I[s++]=128+(127&C),C>>>=7;if(s>=F)throw new Error("RLE buffer overflow");for(I[s++]=C,m>>>=0;s<F&&m>=128;)I[s++]=128+(127&m),m>>>=7;if(s>=F)throw new Error("RLE buffer overflow");I[s++]=m}return I},I.decode=function(V,I){for(var m,C,l,s,F=I.length,k=V.length,j=0,E=0;E<k;){for(m=0,C=0;E<k&&V[E]>=128;)m+=(127&V[E++])<<C,C+=7;if(m+=V[E++]<<C,E>=k)throw new Error("RLE buffer underrun");if(j+m>F)throw new Error("Chunk buffer overflow");for(l=0,C=0;E<k&&V[E]>=128;)l+=(127&V[E++])<<C,C+=7;if(E>=k)throw new Error("RLE buffer underrun");for(l+=V[E++]<<C,s=0;s<m;++s)I[j++]=l}return I}},12240:(V,I)=>{"use strict";function m(V){var I=32;return(V&=-V)&&I--,65535&V&&(I-=16),16711935&V&&(I-=8),252645135&V&&(I-=4),858993459&V&&(I-=2),1431655765&V&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(V){return(V>0)-(V<0)},I.abs=function(V){var I=V>>31;return(V^I)-I},I.min=function(V,I){return I^(V^I)&-(V<I)},I.max=function(V,I){return V^(V^I)&-(V<I)},I.isPow2=function(V){return!(V&V-1)&&!!V},I.log2=function(V){var I,m;return I=(V>65535)<<4,I|=m=((V>>>=I)>255)<<3,I|=m=((V>>>=m)>15)<<2,(I|=m=((V>>>=m)>3)<<1)|(V>>>=m)>>1},I.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},I.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},I.countTrailingZeros=m,I.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},I.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},I.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var C=new Array(256);!function(V){for(var I=0;I<256;++I){var m=I,C=I,l=7;for(m>>>=1;m;m>>>=1)C<<=1,C|=1&m,--l;V[I]=C<<l&255}}(C),I.reverse=function(V){return C[255&V]<<24|C[V>>>8&255]<<16|C[V>>>16&255]<<8|C[V>>>24&255]},I.interleave2=function(V,I){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(V,I){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>I&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},I.interleave3=function(V,I,m){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(m=1227133513&((m=3272356035&((m=251719695&((m=4278190335&((m&=1023)|m<<16))|m<<8))|m<<4))|m<<2))<<2},I.deinterleave3=function(V,I){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>I&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},I.nextCombination=function(V){var I=V|V-1;return I+1|(~I&-~I)-1>>>m(V)+1}},12272:V=>{"use strict";V.exports=function(V,I,m,C){var l=self||window;try{try{var s;try{s=new l.Blob([V])}catch(E){(s=new(l.BlobBuilder||l.WebKitBlobBuilder||l.MozBlobBuilder||l.MSBlobBuilder)).append(V),s=s.getBlob()}var F=l.URL||l.webkitURL,k=F.createObjectURL(s),j=new l[I](k,m);return F.revokeObjectURL(k),j}catch(E){return new l[I]("data:application/javascript,".concat(encodeURIComponent(V)),m)}}catch(E){if(!C)throw Error("Inline worker is not supported");return new l[I](C,m)}}},11955:(V,I,m)=>{"use strict";function C(V,I,m,C,l){var s={};return Object.keys(C).forEach((function(V){s[V]=C[V]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=m.slice().reverse().reduce((function(m,C){return C(V,I,m)||m}),s),l&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(l):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(V,I,s),s=null),s}m.d(I,{e:()=>C})},11951:(V,I,m)=>{"use strict";function C(V,I,m,C){m&&Object.defineProperty(V,I,{enumerable:m.enumerable,configurable:m.configurable,writable:m.writable,value:m.initializer?m.initializer.call(C):void 0})}m.d(I,{c:()=>C})},13362:(V,I,m)=>{"use strict";m.d(I,{e:()=>F,f:()=>Y,i:()=>k,j:()=>s,m:()=>j,q:()=>l,u:()=>E,x:()=>K});var C=m(11498);class l{constructor(){this._easingMode=l.EASINGMODE_EASEIN}setEasingMode(V){const I=Math.min(Math.max(V,0),2);this._easingMode=I}getEasingMode(){return this._easingMode}easeInCore(V){throw new Error("You must implement this method")}ease(V){switch(this._easingMode){case l.EASINGMODE_EASEIN:return this.easeInCore(V);case l.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-V)}return V>=.5?.5*(1-this.easeInCore(2*(1-V)))+.5:.5*this.easeInCore(2*V)}}l.EASINGMODE_EASEIN=0,l.EASINGMODE_EASEOUT=1,l.EASINGMODE_EASEINOUT=2;class s extends l{easeInCore(V){return V=Math.max(0,Math.min(1,V)),1-Math.sqrt(1-V*V)}}class F extends l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=V}easeInCore(V){const I=Math.max(0,this.amplitude);return Math.pow(V,3)-V*I*Math.sin(3.141592653589793*V)}}class k extends l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=V,this.bounciness=I}easeInCore(V){const I=Math.max(0,this.bounces);let m=this.bounciness;m<=1&&(m=1.001);const C=Math.pow(m,I),l=1-m,s=(1-C)/l+.5*C,F=V*s,k=Math.log(-F*(1-m)+1)/Math.log(m),j=Math.floor(k),E=j+1,K=(1-Math.pow(m,j))/(l*s),Y=.5*(K+(1-Math.pow(m,E))/(l*s)),X=V-Y,O=Y-K;return-Math.pow(1/m,I-j)/(O*O)*(X-O)*(X+O)}}class j extends l{easeInCore(V){return V*V*V}}class E extends l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=V,this.springiness=I}easeInCore(V){let I;const m=Math.max(0,this.oscillations),C=Math.max(0,this.springiness);return I=0==C?V:(Math.exp(C*V)-1)/(Math.exp(C)-1),I*Math.sin((6.283185307179586*m+1.5707963267948966)*V)}}class K extends l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=V}easeInCore(V){return this.exponent<=0?V:(Math.exp(this.exponent*V)-1)/(Math.exp(this.exponent)-1)}}class Y extends l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=V,this.y1=I,this.x2=m,this.y2=C}easeInCore(V){return C.d.Interpolate(V,this.x1,this.y1,this.x2,this.y2)}}},12821:(V,I,m)=>{"use strict";m.d(I,{b:()=>F});var C=m(11040),l=m(11046),s=m(11337);class F extends s.c{get _matrix(){return this._compose(),this.LY}set _matrix(V){(V.updateFlag!==this.LY.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.LY.C(V),this._markAsDirtyAndDecompose())}constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(V,I.cV(),!1),this.name=V,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=I,this.LY=(null===l||void 0===l?void 0:l.clone())??C.b.Identity(),this._restMatrix=s??this.LY.clone(),this._bindMatrix=F??this.LY.clone(),this._index=k,this._absoluteMatrix=new C.b,this._absoluteBindMatrix=new C.b,this._absoluteInverseBindMatrix=new C.b,this._finalMatrix=new C.b,I.bones.push(this),this.setParent(m,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(V){this.setParent(V)}setParent(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==V){if(this.parent){const V=this.parent.children.indexOf(this);-1!==V&&this.parent.children.splice(V,1)}this._parentNode=V,this.parent&&this.parent.children.push(this),I&&this._updateAbsoluteBindMatrices(),this.bE()}}getLocalMatrix(){return this._compose(),this.LY}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(V){this._restMatrix.C(V)}setRestPose(V){this.setRestMatrix(V)}getBindPose(){return this.getBindMatrix()}setBindMatrix(V){this.lk(V)}setBindPose(V){this.setBindMatrix(V)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const V=C.g.LF[0],I=C.g.Quaternion[0],m=C.g.LF[1];this.getRestMatrix().decompose(V,I,m),this._linkedTransformNode.position.C(m),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??C.e.Identity(),this._linkedTransformNode.rotationQuaternion.C(I),this._linkedTransformNode.Vk.C(V)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(V){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=V,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.hk}set position(V){this._decompose(),this.hk.C(V),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(V){this.setRotation(V)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(V){this.setRotationQuaternion(V)}get Vk(){return this.getScale()}set Vk(V){this.setScale(V)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=C.m.Zero(),this._localRotation=C.e.Zero(),this.hk=C.m.Zero()),this.LY.decompose(this._localScaling,this._localRotation,this.hk))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,C.b.ComposeToRef(this._localScaling,this._localRotation,this.hk,this.LY)):this._needToCompose=!1)}lk(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.C(V),I&&this._updateAbsoluteBindMatrices(),m?this._matrix=V:this.bE()}_updateAbsoluteBindMatrices(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V||(V=this._bindMatrix),this.parent?V.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.C(V),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),I)for(let m=0;m<this.children.length;m++)this.children[m]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}bE(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.bE(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.bE(),this._needToDecompose=!0}_updatePosition(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=this.getLocalMatrix();if(0==I)l?(s.addAtIndex(12,V.x),s.addAtIndex(13,V.y),s.addAtIndex(14,V.z)):s.setTranslationFromFloats(V.x,V.y,V.z);else{let I=null;m&&(I=m.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=F._TmpMats[0],j=F._TmpVecs[0];this.parent?m&&I?(k.C(this.parent.getAbsoluteMatrix()),k.multiplyToRef(I,k)):k.C(this.parent.getAbsoluteMatrix()):C.b.IdentityToRef(k),l&&k.setTranslationFromFloats(0,0,0),k.invert(),C.m.TransformCoordinatesToRef(V,k,j),l?(s.addAtIndex(12,j.x),s.addAtIndex(13,j.y),s.addAtIndex(14,j.z)):s.setTranslationFromFloats(j.x,j.y,j.z)}this._markAsDirtyAndDecompose()}translate(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,I,m,!0)}setPosition(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,I,m,!1)}setAbsolutePosition(V,I){this.setPosition(V,1,I)}scale(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.getLocalMatrix(),k=F._TmpMats[0];C.b.ScalingToRef(V,I,m,k),k.multiplyToRef(s,s),k.invert();for(const C of this.children){const l=C.getLocalMatrix();l.multiplyToRef(k,l),l.multiplyAtIndex(12,V),l.multiplyAtIndex(13,I),l.multiplyAtIndex(14,m),C._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),l)for(const C of this.children)C.scale(V,I,m,l)}setScale(V){this._decompose(),this._localScaling.C(V),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(V){this._decompose(),V.C(this._localScaling)}setYawPitchRoll(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;if(0===l){const k=F._TmpQuat;return C.e.RotationYawPitchRollToRef(V,I,m,k),void this.setRotationQuaternion(k,l,s)}const k=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,s))return;const j=F._TmpMats[1];C.b.RotationYawPitchRollToRef(V,I,m,j),k.multiplyToRef(j,j),this._rotateWithMatrix(j,l,s)}rotate(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0;const s=F._TmpMats[0];s.setTranslationFromFloats(0,0,0),C.b.RotationAxisToRef(V,I,s),this._rotateWithMatrix(s,m,l)}setAxisAngle(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0;if(0===m){const s=F._TmpQuat;return C.e.RotationAxisToRef(V,I,s),void this.setRotationQuaternion(s,m,l)}const s=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,l))return;const k=F._TmpMats[1];C.b.RotationAxisToRef(V,I,k),s.multiplyToRef(k,k),this._rotateWithMatrix(k,m,l)}setRotation(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(V.y,V.x,V.z,I,m)}setRotationQuaternion(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;if(0===I)return this._decompose(),this._localRotation.C(V),void this._markAsDirtyAndCompose();const l=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,m))return;const s=F._TmpMats[1];C.b.FromQuaternionToRef(V,s),l.multiplyToRef(s,s),this._rotateWithMatrix(s,I,m)}setRotationMatrix(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;if(0===I){const l=F._TmpQuat;return C.e.FromRotationMatrixToRef(V,l),void this.setRotationQuaternion(l,I,m)}const l=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,m))return;const s=F._TmpMats[1];s.C(V),l.multiplyToRef(V,s),this._rotateWithMatrix(s,I,m)}_rotateWithMatrix(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;const C=this.getLocalMatrix(),l=C.m[12],s=C.m[13],k=C.m[14],j=this.getParent(),E=F._TmpMats[3],K=F._TmpMats[4];j&&1==I?(m?(E.C(m.getWorldMatrix()),j.getAbsoluteMatrix().multiplyToRef(E,E)):E.C(j.getAbsoluteMatrix()),K.C(E),K.invert(),C.multiplyToRef(E,C),C.multiplyToRef(V,C),C.multiplyToRef(K,C)):1==I&&m?(E.C(m.getWorldMatrix()),K.C(E),K.invert(),C.multiplyToRef(E,C),C.multiplyToRef(V,C),C.multiplyToRef(K,C)):C.multiplyToRef(V,C),C.setTranslationFromFloats(l,s,k),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(V,I){const m=F._TmpMats[2];return V.C(this.getAbsoluteMatrix()),I?(V.multiplyToRef(I.getWorldMatrix(),V),C.b.ScalingToRef(I.Vk.x,I.Vk.y,I.Vk.z,m)):C.b.IdentityToRef(m),V.invert(),!isNaN(V.m[0])&&(m.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyToRef(m,V),!0)}pF(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=C.m.Zero();return this.getPositionToRef(V,I,m),m}getPositionToRef(){let V=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const V=this.getLocalMatrix();I.x=V.m[12],I.y=V.m[13],I.z=V.m[14]}else{let m=null;V&&(m=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let C=F._TmpMats[0];V&&m?(C.C(this.getAbsoluteMatrix()),C.multiplyToRef(m,C)):C=this.getAbsoluteMatrix(),I.x=C.m[12],I.y=C.m[13],I.z=C.m[14]}}getAbsolutePosition(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=C.m.Zero();return this.getPositionToRef(1,V,I),I}getAbsolutePositionToRef(V,I){this.getPositionToRef(1,V,I)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.LY.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.C(this.LY);const V=this._skeleton.getPoseMatrix();V&&this._absoluteMatrix.multiplyToRef(V,this._absoluteMatrix)}const V=this.children,I=V.length;for(let m=0;m<I;m++)V[m].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Kj(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=C.m.Zero();return this.getDirectionToRef(V,I,m),m}getDirectionToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,l=null;I&&(l=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=F._TmpMats[0];s.C(this.getAbsoluteMatrix()),I&&l&&s.multiplyToRef(l,s),C.m.TransformNormalToRef(V,s,m),m.normalize()}getRotation(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=C.m.Zero();return this.getRotationToRef(V,I,m),m}getRotationToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;const C=F._TmpQuat;this.getRotationQuaternionToRef(V,I,C),C.toEulerAnglesToRef(m)}getRotationQuaternion(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=C.e.Identity();return this.getRotationQuaternionToRef(V,I,m),m}getRotationQuaternionToRef(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),I.C(this._localRotation);else{const m=F._TmpMats[0],C=this.getAbsoluteMatrix();V?C.multiplyToRef(V.getWorldMatrix(),m):m.C(C),m.multiplyAtIndex(0,this._scalingDeterminant),m.multiplyAtIndex(1,this._scalingDeterminant),m.multiplyAtIndex(2,this._scalingDeterminant),m.decompose(void 0,I,void 0)}}getRotationMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1?arguments[1]:void 0;const m=C.b.Identity();return this.getRotationMatrixToRef(V,I,m),m}getRotationMatrixToRef(){let V=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(I);else{const m=F._TmpMats[0],C=this.getAbsoluteMatrix();V?C.multiplyToRef(V.getWorldMatrix(),m):m.C(C),m.multiplyAtIndex(0,this._scalingDeterminant),m.multiplyAtIndex(1,this._scalingDeterminant),m.multiplyAtIndex(2,this._scalingDeterminant),m.getRotationMatrixToRef(I)}}getAbsolutePositionFromLocal(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=C.m.Zero();return this.getAbsolutePositionFromLocalToRef(V,I,m),m}getAbsolutePositionFromLocalToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,l=null;I&&(l=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=F._TmpMats[0];s.C(this.getAbsoluteMatrix()),I&&l&&s.multiplyToRef(l,s),C.m.TransformCoordinatesToRef(V,s,m)}getLocalPositionFromAbsolute(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=C.m.Zero();return this.getLocalPositionFromAbsoluteToRef(V,I,m),m}getLocalPositionFromAbsoluteToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,l=null;I&&(l=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=F._TmpMats[0];s.C(this.getAbsoluteMatrix()),I&&l&&s.multiplyToRef(l,s),s.invert(),C.m.TransformCoordinatesToRef(V,s,m)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const V=this._skeleton.bones.indexOf(this);if(-1!==V&&this._skeleton.bones.splice(V,1),this._parentNode&&this._parentNode.children){const V=this._parentNode.children,I=V.indexOf(this);-1!==I&&V.splice(I,1)}super.dispose()}}F._TmpVecs=(0,l.d)(2,C.m.Zero),F._TmpQuat=C.e.Identity(),F._TmpMats=(0,l.d)(5,C.b.Identity)},13355:(V,I,m)=>{"use strict";m.d(I,{e:()=>r});var C=m(11206),l=m(11214),s=m(11067),F=m(11040),k=m(11074),j=m(11337),E=m(11384),K=m(11616),Y=m(11091),X=m(11044);class O{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(V){this._idleRotationSpeed=V}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(V){this._idleRotationWaitTime=V}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(V){this._idleRotationSpinupTime=V}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(V){this._attachedCamera=V;const I=this._attachedCamera.cV();this._onPrePointerObservableObserver=I.onPrePointerObservable.add((V=>{V.type!==K.c.POINTERDOWN?V.type===K.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const V=Y.d.Now;let I=0;null!=this._lastFrameTime&&(I=V-this._lastFrameTime),this._lastFrameTime=V,this._applyUserInteraction();const m=V-this._lastInteractionTime-this._idleRotationWaitTime,C=Math.max(Math.min(m/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*C,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(I/1e3))}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.cV();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(V){this._lastInteractionTime=V??Y.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<X.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let V=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(V=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?V:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Y.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var v=m(13362),N=m(11700);class t{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(V){if(this._autoTransitionRange===V)return;this._autoTransitionRange=V;const I=this._attachedCamera;I&&(V?this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((V=>{if(V&&(V.fF(!0),V.getBoundingInfo)){const I=V.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*I,this.upperRadiusTransitionRange=.05*I}})):this._onMeshTargetChangedObserver&&I.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(V){this._attachedCamera=V,this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(V){return!!this._attachedCamera&&(this._attachedCamera.radius===V&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(V){if(!this._attachedCamera)return;this._radiusBounceTransition||(t.EasingFunction.setEasingMode(t.EasingMode),this._radiusBounceTransition=N.c.CreateAnimation("radius",N.c.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const I=N.c.TransitionTo("radius",this._attachedCamera.radius+V,this._attachedCamera,this._attachedCamera.cV(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));I&&this._animatables.push(I)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}t.EasingFunction=new v.e(.3),t.EasingMode=v.q.EASINGMODE_EASEOUT;class D{constructor(){this.onTargetFramingAnimationEndObservable=new s.e,this._mode=D.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(V){this._mode=V}get mode(){return this._mode}set radiusScale(V){this._radiusScale=V}get radiusScale(){return this._radiusScale}set positionScale(V){this._positionScale=V}get positionScale(){return this._positionScale}set defaultElevation(V){this._defaultElevation=V}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(V){this._elevationReturnTime=V}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(V){this._elevationReturnWaitTime=V}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(V){this._framingTime=V}get framingTime(){return this._framingTime}init(){}attach(V){this._attachedCamera=V;const I=this._attachedCamera.cV();D.EasingFunction.setEasingMode(D.EasingMode),this._onPrePointerObservableObserver=I.onPrePointerObservable.add((V=>{V.type!==K.c.POINTERDOWN?V.type===K.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((V=>{V&&V.getBoundingInfo&&this.zoomOnMesh(V,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.cV();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.fF(!0);const C=V.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(C.minimumWorld,C.maximumWorld,I,m)}zoomOnMeshHierarchy(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.fF(!0);const C=V.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(C.min,C.max,I,m)}zoomOnMeshesHierarchy(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new F.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let s=0;s<V.length;s++){const I=V[s].getHierarchyBoundingVectors(!0);F.m.CheckExtends(I.min,C,l),F.m.CheckExtends(I.max,C,l)}this.zoomOnBoundingInfo(C,l,I,m)}zoomOnBoundingInfo(V,I){let m,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const s=V.y,k=s+(I.y-s)*this._positionScale,j=I.Fm(V).scale(.5);if(!isFinite(k))return!1;if(C)m=new F.m(0,k,0);else{const I=V.add(j);m=new F.m(I.x,k,I.z)}this._vectorTransition||(this._vectorTransition=N.c.CreateAnimation("target",N.c.ANIMATIONTYPE_VECTOR3,60,D.EasingFunction)),this._betaIsAnimating=!0;let E=N.c.TransitionTo("target",m,this._attachedCamera,this._attachedCamera.cV(),60,this._vectorTransition,this._framingTime);E&&this._animatables.push(E);let K=0;if(this._mode===D.FitFrustumSidesMode){const m=this._calculateLowerRadiusFromModelBoundingSphere(V,I);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=j.length()+this._attachedCamera.Fk),K=m}else this._mode===D.IgnoreBoundsSizeMode&&(K=this._calculateLowerRadiusFromModelBoundingSphere(V,I),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Fk));if(this.autoCorrectCameraLimitsAndSensibility){const m=I.Fm(V).length();this._attachedCamera.panningSensibility=5e3/m,this._attachedCamera.wheelPrecision=100/K}return this._radiusTransition||(this._radiusTransition=N.c.CreateAnimation("radius",N.c.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),E=N.c.TransitionTo("radius",K,this._attachedCamera,this._attachedCamera.cV(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),l&&l(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),E&&this._animatables.push(E),!0}_calculateLowerRadiusFromModelBoundingSphere(V,I){const m=this._attachedCamera;if(!m)return 0;let C=m._calculateLowerRadiusFromModelBoundingSphere(V,I,this._radiusScale);return m.lowerRadiusLimit&&this._mode===D.IgnoreBoundsSizeMode&&(C=C<m.lowerRadiusLimit?m.lowerRadiusLimit:C),m.upperRadiusLimit&&(C=C>m.upperRadiusLimit?m.upperRadiusLimit:C),C}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const V=Y.d.Now-this._lastInteractionTime,I=.5*Math.PI-this._defaultElevation,m=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>m&&V>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=N.c.CreateAnimation("beta",N.c.ANIMATIONTYPE_FLOAT,60,D.EasingFunction));const V=N.c.TransitionTo("beta",I,this._attachedCamera,this._attachedCamera.cV(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));V&&this._animatables.push(V)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Y.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}D.EasingFunction=new v.x,D.EasingMode=v.q.EASINGMODE_EASEINOUT,D.IgnoreBoundsSizeMode=0,D.FitFrustumSidesMode=1;var b=m(11386),T=m(11564),n=m(12816),x=m(11076);class S{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(V){V=x.d.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),m=I.getInputElement();let C=0,l=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=s=>{var F,k;const j=s.event,E="touch"===j.pointerType;if(s.type!==K.c.POINTERMOVE&&-1===this.buttons.indexOf(j.button))return;const Y=j.target;if(this._altKey=j.altKey,this._ctrlKey=j.ctrlKey,this._metaKey=j.metaKey,this._shiftKey=j.shiftKey,this._buttonsPressed=j.buttons,I.isPointerLock){const V=j.movementX,I=j.movementY;this.onTouch(null,V,I),this._pointA=null,this._pointB=null}else{if(s.type!==K.c.POINTERDOWN&&s.type!==K.c.POINTERDOUBLETAP&&E&&(null===(F=this._pointA)||void 0===F?void 0:F.pointerId)!==j.pointerId&&(null===(k=this._pointB)||void 0===k?void 0:k.pointerId)!==j.pointerId)return;if(s.type!==K.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!E)if(s.type===K.c.POINTERDOUBLETAP)this.onDoubleTap(j.pointerType);else if(s.type!==K.c.POINTERUP||this._currentMousePointerIdDown!==j.pointerId&&!E){if(s.type===K.c.POINTERMOVE)if(V||j.preventDefault(),this._pointA&&null===this._pointB){const V=j.clientX-this._pointA.x,I=j.clientY-this._pointA.y;this._pointA.x=j.clientX,this._pointA.y=j.clientY,this.onTouch(this._pointA,V,I)}else if(this._pointA&&this._pointB){const V=this._pointA.pointerId===j.pointerId?this._pointA:this._pointB;V.x=j.clientX,V.y=j.clientY;const I=this._pointA.x-this._pointB.x,m=this._pointA.y-this._pointB.y,F=I*I+m*m,k={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:j.pointerId,type:s.type};this.onMultiTouch(this._pointA,this._pointB,C,F,l,k),l=k,C=F}}else{try{null===Y||void 0===Y||Y.releasePointerCapture(j.pointerId)}catch(X){}E||(this._pointB=null),I._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==j.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==j.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==C||l)&&(this.onMultiTouch(this._pointA,this._pointB,C,0,l,null),C=0,l=null),this._currentMousePointerIdDown=-1,this.onButtonUp(j),V||j.preventDefault()}else{try{null===Y||void 0===Y||Y.setPointerCapture(j.pointerId)}catch(X){}if(null===this._pointA)this._pointA={x:j.clientX,y:j.clientY,pointerId:j.pointerId,type:j.pointerType};else{if(null!==this._pointB)return;this._pointB={x:j.clientX,y:j.clientY,pointerId:j.pointerId,type:j.pointerType}}-1!==this._currentMousePointerIdDown||E||(this._currentMousePointerIdDown=j.pointerId),this.onButtonDown(j),V||(j.preventDefault(),m&&m.focus())}}},this._observer=this.camera.cV()._inputManager._addCameraPointerObserver(this._pointerInput,K.c.POINTERDOWN|K.c.POINTERUP|K.c.POINTERMOVE|K.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,C=0,l=null,this.onLostFocus()},this._contextMenuBind=V=>this.onContextMenu(V),m&&m.addEventListener("contextmenu",this._contextMenuBind,!1);const s=this.camera.cV().getEngine().getHostWindow();s&&x.d.RegisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}sY(){if(this._onLostFocus){const V=this.camera.cV().getEngine().getHostWindow();V&&x.d.UnregisterTopRootEvents(V,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.cV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const V=this.camera.cV().getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(V){}onTouch(V,I,m){}onMultiTouch(V,I,m,C,l,s){}onContextMenu(V){V.preventDefault()}onButtonDown(V){}onButtonUp(V){}onLostFocus(){}}(0,C.d)([(0,l.B)()],S.prototype,"buttons",void 0);class c extends S{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(V,I){if(0!==this.panningSensibility&&V&&I){const m=I.x-V.x,C=I.y-V.y;this.camera.inertialPanningX+=-m/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility}}_computePinchZoom(V,I){const m=this.camera.radius||c.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=m*Math.sqrt(V)/Math.sqrt(I):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(I-V)*m*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(I-V)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(V,I,m){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=m/this.panningSensibility):(this.camera.inertialAlphaOffset-=I/this.angularSensibilityX,this.camera.inertialBetaOffset-=m/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(V,I,m,C,l,s){0===m&&null===l||0===C&&null===s||(this.multiTouchPanAndZoom?(this._computePinchZoom(m,C),this._computeMultiTouchPanning(l,s)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(C)-Math.sqrt(m))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(m,C),this._isPinching=!0):this._computeMultiTouchPanning(l,s)):this.multiTouchPanning?this._computeMultiTouchPanning(l,s):this.pinchZoom&&this._computePinchZoom(m,C))}onButtonDown(V){this._isPanClick=V.button===this.camera._panningMouseButton}onButtonUp(V){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}c.MinimumRadiusForPinch=.001,(0,C.d)([(0,l.B)()],c.prototype,"buttons",void 0),(0,C.d)([(0,l.B)()],c.prototype,"angularSensibilityX",void 0),(0,C.d)([(0,l.B)()],c.prototype,"angularSensibilityY",void 0),(0,C.d)([(0,l.B)()],c.prototype,"pinchPrecision",void 0),(0,C.d)([(0,l.B)()],c.prototype,"pinchDeltaPercentage",void 0),(0,C.d)([(0,l.B)()],c.prototype,"useNaturalPinchZoom",void 0),(0,C.d)([(0,l.B)()],c.prototype,"pinchZoom",void 0),(0,C.d)([(0,l.B)()],c.prototype,"panningSensibility",void 0),(0,C.d)([(0,l.B)()],c.prototype,"multiTouchPanning",void 0),(0,C.d)([(0,l.B)()],c.prototype,"multiTouchPanAndZoom",void 0),n.d.ArcRotateCameraPointersInput=c;var H=m(11624);class y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(V){V=x.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.cV(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const m=I.event;if(!m.metaKey)if(I.type===H.c.KEYDOWN){if(this._ctrlPressed=m.ctrlKey,this._altPressed=m.altKey,-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysReset.indexOf(m.keyCode)){-1===this._keys.indexOf(m.keyCode)&&this._keys.push(m.keyCode),m.preventDefault&&(V||m.preventDefault())}}else if(-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysReset.indexOf(m.keyCode)){const I=this._keys.indexOf(m.keyCode);I>=0&&this._keys.splice(I,1),m.preventDefault&&(V||m.preventDefault())}})))}sY(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let I=0;I<this._keys.length;I++){const m=this._keys[I];-1!==this.keysLeft.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX-=1/this.panningSensibility:V.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset+=1/this.zoomingSensibility:V.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX+=1/this.panningSensibility:V.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset-=1/this.zoomingSensibility:V.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(m)&&V.useInputToRestoreState&&V.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,C.d)([(0,l.B)()],y.prototype,"keysUp",void 0),(0,C.d)([(0,l.B)()],y.prototype,"keysDown",void 0),(0,C.d)([(0,l.B)()],y.prototype,"keysLeft",void 0),(0,C.d)([(0,l.B)()],y.prototype,"keysRight",void 0),(0,C.d)([(0,l.B)()],y.prototype,"keysReset",void 0),(0,C.d)([(0,l.B)()],y.prototype,"panningSensibility",void 0),(0,C.d)([(0,l.B)()],y.prototype,"zoomingSensibility",void 0),(0,C.d)([(0,l.B)()],y.prototype,"useAltToZoom",void 0),(0,C.d)([(0,l.B)()],y.prototype,"angularSpeed",void 0),n.d.ArcRotateCameraKeyboardMoveInput=y;var z=m(11289),Z=m(11626);class B{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new F.m(0,0,0),this._globalOffset=new F.m(0,0,0),this._inertialPanning=F.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(V,I){let m=0;const C=.01*V*this.wheelDeltaPercentage*I;return m=V>0?C/(1+this.wheelDeltaPercentage):C*(1+this.wheelDeltaPercentage),m}attachControl(V){V=x.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==K.c.POINTERWHEEL)return;const m=I.event;let C=0;const l=m.deltaMode===Z.c.DOM_DELTA_LINE?40:1,s=-m.deltaY*l;if(this.customComputeDeltaFromMouseWheel)C=this.customComputeDeltaFromMouseWheel(s,this,m);else if(this.wheelDeltaPercentage){if(C=this._computeDeltaFromMouseWheelLegacyEvent(s,this.camera.radius),C>0){let V=this.camera.radius,I=this.camera.inertialRadiusOffset+C;for(let m=0;m<20&&!(V<=I)&&!(Math.abs(I*this.camera.inertia)<.001);m++)V-=I,I*=this.camera.inertia;V=(0,k.Clamp)(V,0,Number.MAX_VALUE),C=this._computeDeltaFromMouseWheelLegacyEvent(s,V)}}else C=s/(40*this.wheelPrecision);C&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(C)):this.camera.inertialRadiusOffset+=C),m.preventDefault&&(V||m.preventDefault())},this._observer=this.camera.cV()._inputManager._addCameraPointerObserver(this._wheel,K.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.mk(0)}sY(){this._observer&&(this.camera.cV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const V=this.camera;0+V.inertialAlphaOffset+V.inertialBetaOffset+V.inertialRadiusOffset&&(this._updateHitPlane(),V.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(V.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const V=this.camera,I=V.target.Fm(V.position);this._hitPlane=z.e.FromPositionAndNormal(V.target,I)}_getPosition(){const V=this.camera,I=V.cV(),m=I.createPickingRay(I.pointerX,I.pointerY,F.b.Identity(),V,!1);0===V.targetScreenOffset.x&&0===V.targetScreenOffset.y||(this._viewOffset.set(V.targetScreenOffset.x,V.targetScreenOffset.y,0),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),this._globalOffset=F.m.TransformNormal(this._viewOffset,V._cameraTransformMatrix),m.origin.addInPlace(this._globalOffset));let C=0;return this._hitPlane&&(C=m.intersectsPlane(this._hitPlane)??0),m.origin.addInPlace(m.direction.scaleInPlace(C))}_zoomToMouse(V){const I=this.camera,m=1-I.inertia;if(I.lowerRadiusLimit){const C=I.lowerRadiusLimit??0;I.radius-(I.inertialRadiusOffset+V)/m<C&&(V=(I.radius-C)*m-I.inertialRadiusOffset)}if(I.upperRadiusLimit){const C=I.upperRadiusLimit??0;I.radius-(I.inertialRadiusOffset+V)/m>C&&(V=(I.radius-C)*m-I.inertialRadiusOffset)}const C=V/m/I.radius,l=this._getPosition(),s=F.g.LF[6];l.subtractToRef(I.target,s),s.scaleInPlace(C),s.scaleInPlace(m),this._inertialPanning.addInPlace(s),I.inertialRadiusOffset+=V}_zeroIfClose(V){Math.abs(V.x)<X.c&&(V.x=0),Math.abs(V.y)<X.c&&(V.y=0),Math.abs(V.z)<X.c&&(V.z=0)}}(0,C.d)([(0,l.B)()],B.prototype,"wheelPrecision",void 0),(0,C.d)([(0,l.B)()],B.prototype,"zoomToMouseLocation",void 0),(0,C.d)([(0,l.B)()],B.prototype,"wheelDeltaPercentage",void 0),n.d.ArcRotateCameraMouseWheelInput=B;class W extends n.h{constructor(V){super(V)}addMouseWheel(){return this.add(new B),this}addPointers(){return this.add(new c),this}addKeyboard(){return this.add(new y),this}}var Q=m(11048);function G(V,I){return isNaN(V)?I:V}j.c.AddNodeConstructor("ArcRotateCamera",((V,I)=>()=>new r(V,0,0,1,F.m.Zero(),I)));class r extends T.e{get target(){return this._target}set target(V){this.setTarget(V)}get targetHost(){return this._targetHost}set targetHost(V){V&&this.setTarget(V)}getTarget(){return this.target}get position(){return this._position}set position(V){this.setPosition(V)}set upVector(V){this._upToYMatrix||(this._yToUpMatrix=new F.b,this._upToYMatrix=new F.b,this._upVector=F.m.Zero()),V.normalize(),this._upVector.C(V),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){F.b.RotationAlignToRef(F.m.UpReadOnly,this._upVector,this._yToUpMatrix),F.b.RotationAlignToRef(this._upVector,F.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityX:0}set angularSensibilityX(V){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityX=V)}get angularSensibilityY(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityY:0}set angularSensibilityY(V){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityY=V)}get pinchPrecision(){const V=this.inputs.attached.pointers;return V?V.pinchPrecision:0}set pinchPrecision(V){const I=this.inputs.attached.pointers;I&&(I.pinchPrecision=V)}get pinchDeltaPercentage(){const V=this.inputs.attached.pointers;return V?V.pinchDeltaPercentage:0}set pinchDeltaPercentage(V){const I=this.inputs.attached.pointers;I&&(I.pinchDeltaPercentage=V)}get useNaturalPinchZoom(){const V=this.inputs.attached.pointers;return!!V&&V.useNaturalPinchZoom}set useNaturalPinchZoom(V){const I=this.inputs.attached.pointers;I&&(I.useNaturalPinchZoom=V)}get panningSensibility(){const V=this.inputs.attached.pointers;return V?V.panningSensibility:0}set panningSensibility(V){const I=this.inputs.attached.pointers;I&&(I.panningSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const I=this.inputs.attached.keyboard;I&&(I.keysUp=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const I=this.inputs.attached.keyboard;I&&(I.keysDown=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const I=this.inputs.attached.keyboard;I&&(I.keysRight=V)}get wheelPrecision(){const V=this.inputs.attached.mousewheel;return V?V.wheelPrecision:0}set wheelPrecision(V){const I=this.inputs.attached.mousewheel;I&&(I.wheelPrecision=V)}get zoomToMouseLocation(){const V=this.inputs.attached.mousewheel;return!!V&&V.zoomToMouseLocation}set zoomToMouseLocation(V){const I=this.inputs.attached.mousewheel;I&&(I.zoomToMouseLocation=V)}get wheelDeltaPercentage(){const V=this.inputs.attached.mousewheel;return V?V.wheelDeltaPercentage:0}set wheelDeltaPercentage(V){const I=this.inputs.attached.mousewheel;I&&(I.wheelDeltaPercentage=V)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(V){V!==this.useBouncingBehavior&&(V?(this._bouncingBehavior=new t,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(V){V!==this.useFramingBehavior&&(V?(this._framingBehavior=new D,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(V){V!==this.useAutoRotationBehavior&&(V?(this._autoRotationBehavior=new O,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(V,I,m,C,l,k){var j;let E=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(V,F.m.Zero(),k,E),j=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=F.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=F.k.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new F.b,this.panningAxis=new F.m(1,1,0),this._transformedDirection=new F.m,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new s.e,this.checkCollisions=!1,this.collisionRadius=new F.m(.5,.5,.5),this._previousPosition=F.m.Zero(),this._collisionVelocity=F.m.Zero(),this._newPosition=F.m.Zero(),this._computationVector=F.m.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new F.m(NaN,NaN,NaN),this._goalTargetScreenOffset=new F.k(NaN,NaN),this._onCollisionPositionChange=function(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m?(j.setPosition(I),j.wX&&j.wX(m)):j._previousPosition.C(j._position);const C=Math.cos(j.alpha),l=Math.sin(j.alpha),s=Math.cos(j.beta);let F=Math.sin(j.beta);0===F&&(F=1e-4);const k=j._getTargetPosition();j._computationVector.aF(j.radius*C*F,j.radius*s,j.radius*l*F),k.addToRef(j._computationVector,j._newPosition),j._position.C(j._newPosition);let E=j.upVector;j.allowUpsideDown&&j.beta<0&&(E=E.clone(),E=E.negate()),j._computeViewMatrix(j._position,k,E),j._viewMatrix.addAtIndex(12,j.targetScreenOffset.x),j._viewMatrix.addAtIndex(13,j.targetScreenOffset.y),j._collisionTriggered=!1},this._target=F.m.Zero(),l&&this.setTarget(l),this.alpha=I,this.beta=m,this.radius=C,this.getViewMatrix(),this.inputs=new W(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=F.k.Zero()}_updateCache(V){V||super._updateCache(),this._cache._target.C(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.C(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const V=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?V.addToRef(this._targetBoundingCenter,this._target):this._target.C(V)}const V=this._getLockedTargetPosition();return V||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>X.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,s=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=s?this._currentInterpolationFactor=s:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=G(V,this._goalAlpha),this._goalBeta=G(I,this._goalBeta),this._goalRadius=G(m,this._goalRadius),this._goalTarget.set(G(C.x,this._goalTarget.x),G(C.y,this._goalTarget.y),G(C.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(G(l.x,this._goalTargetScreenOffset.x),G(l.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,k.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,k.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,k.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,k.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const l=arguments;I=x.d.BackCompatCameraNoPreventDefault(l),this._useCtrlForPanning=m,this._panningMouseButton=C,"boolean"===typeof l[0]&&(l.length>1&&(this._useCtrlForPanning=l[1]),l.length>2&&(this._panningMouseButton=l[2])),this.inputs.attachElement(I),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}sY(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let V=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){V=!0;const I=this.invertRotation?-1:1,m=this._calculateHandednessMultiplier();let C=this.inertialAlphaOffset*m;this.beta<0&&(C*=-1),this.alpha+=C*I,this.beta+=this.inertialBetaOffset*I,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<X.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<X.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*X.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){V=!0;const I=new F.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),I.multiplyInPlace(this.panningAxis),F.m.TransformNormalToRef(I,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const V=this.upVector,I=F.m.CrossToRef(this._transformedDirection,V,this._transformedDirection);F.m.CrossToRef(V,I,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);F.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.C(this._transformedDirection)}else{if(this.parent){const V=F.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.transposeToRef(V),F.m.TransformCoordinatesToRef(this._transformedDirection,V,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*X.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*X.c&&(this.inertialPanningY=0)}if(V)this.stopInterpolation();else if(this._isInterpolating){let V=!1;const I=this._scene.getEngine().getDeltaTime()/1e3,m=1-Math.pow(2,-I/this._currentInterpolationFactor),C=G(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const I=F.g.LF[0].set(G(this._goalTarget.x,this._target.x),G(this._goalTarget.y,this._target.y),G(this._goalTarget.z,this._target.z));F.m.LerpToRef(this.target,I,m,this._target),10*F.m.Distance(this.target,I)/C<X.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.C(I),this.setTarget(this.target,!1,!0,!0)):V=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const I=F.e.RotationAlphaBetaGammaToRef(G(this._goalAlpha,this.alpha),G(this._goalBeta,this.beta),0,F.g.Quaternion[0]),C=F.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,F.g.Quaternion[1]),l=F.e.SlerpToRef(C,I,m,F.g.Quaternion[2]);l.normalize();const s=l.toAlphaBetaGammaToRef(F.g.LF[0]);if(this.alpha=s.x,this.beta=s.y,l.isApprox(I,X.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const V=I.toAlphaBetaGammaToRef(F.g.LF[0]);this.alpha=V.x,this.beta=V.y}else V=!0}if(isNaN(this._goalRadius)||(this.radius+=(C-this.radius)*m,Math.abs(C/this.radius-1)<X.c?(this._goalRadius=NaN,this.radius=C):V=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const I=F.g.Vector2[0].set(G(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),G(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));F.k.LerpToRef(this.targetScreenOffset,I,m,this.targetScreenOffset),F.k.Distance(this.targetScreenOffset,I)<X.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.C(I)):V=!0}this._isInterpolating=V}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const V=this.alpha;var I,m;this.alpha=function(V){let I=Math.PI/2;return 0===V.x&&0===V.z||(I=Math.acos(V.x/Math.sqrt(Math.pow(V.x,2)+Math.pow(V.z,2)))),V.z<0&&(I=2*Math.PI-I),I}(this._computationVector),this.beta=(I=this._computationVector.y,m=this.radius,Math.acos(I/m));const C=Math.round((V-this.alpha)/(2*Math.PI));this.alpha+=2*C*Math.PI,this._checkLimits()}setPosition(V){this._position.equals(V)||(this._position.C(V),this.rebuildAnglesAndRadius())}setTarget(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(C=this.overrideCloneAlphaBetaRadius??C,V.fF)I&&V.getBoundingInfo?this._targetBoundingCenter=V.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,V.fF(),this._targetHost=V,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const I=V,C=this._getTargetPosition();if(C&&!m&&C.equals(I))return;this._targetHost=null,this._target=I,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}C||this.rebuildAnglesAndRadius()}_getViewMatrix(){const V=Math.cos(this.alpha),I=Math.sin(this.alpha),m=Math.cos(this.beta);let C=Math.sin(this.beta);0===C&&(C=1e-4),0===this.radius&&(this.radius=1e-4);const l=this._getTargetPosition();if(this._computationVector.aF(this.radius*V*C,this.radius*m,this.radius*I*C),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),l.addToRef(this._computationVector,this._newPosition),this.cV().collisionsEnabled&&this.checkCollisions){const V=this.cV().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,V.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.C(this._newPosition);let V=this.upVector;this.allowUpsideDown&&C<0&&(V=V.negate()),this._computeViewMatrix(this._position,l,V),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.C(l),this._viewMatrix}zoomOn(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V||this.cV().meshes;const m=E.c.MinMax(V);let C=this._calculateLowerRadiusFromModelBoundingSphere(m.min,m.max);if(C=Math.max(Math.min(C,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=C*this.zoomOnFactor,this.mode===b.c.ORTHOGRAPHIC_CAMERA){const V=this.cV().getEngine().getAspectRatio(this),I=C*this.zoomOnFactor/2;this.orthoLeft=-I*V,this.orthoRight=I*V,this.orthoBottom=-I,this.orthoTop=I}this.focusOn({min:m.min,max:m.max,distance:C},I)}focusOn(V){let I,m,C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===V.min){const C=V||this.cV().meshes;I=E.c.MinMax(C),m=F.m.Distance(I.min,I.max)}else{I=V,m=V.distance}this._target=E.c.Center(I),C||(this.maxZ=2*m)}createRigCamera(V,I){let m=0;switch(this.cameraRigMode){case b.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case b.c.RIG_MODE_VR:m=this._cameraRigParams.stereoHalfAngle*(0===I?1:-1);break;case b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:m=this._cameraRigParams.stereoHalfAngle*(0===I?-1:1)}const C=new r(V,this.alpha+m,this.beta,this.radius,this._target,this.cV());return C._cameraRigParams={},C.isRigCamera=!0,C.rigParent=this,C.upVector=this.upVector,C.mode=this.mode,C.orthoLeft=this.orthoLeft,C.orthoRight=this.orthoRight,C.orthoBottom=this.orthoBottom,C.orthoTop=this.orthoTop,C}_updateRigCameras(){const V=this._rigCameras[0],I=this._rigCameras[1];switch(V.beta=I.beta=this.beta,this.cameraRigMode){case b.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case b.c.RIG_MODE_VR:V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const C=F.m.Distance(V,I),l=this.cV().getEngine().getAspectRatio(this),s=Math.tan(this.fov/2),k=s*l,j=.5*C*m,E=j*Math.sqrt(1+1/(k*k)),K=j*Math.sqrt(1+1/(s*s));return Math.max(E,K)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,C.d)([(0,l.B)()],r.prototype,"alpha",void 0),(0,C.d)([(0,l.B)()],r.prototype,"beta",void 0),(0,C.d)([(0,l.B)()],r.prototype,"radius",void 0),(0,C.d)([(0,l.B)()],r.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,C.d)([(0,l.x)("target")],r.prototype,"_target",void 0),(0,C.d)([(0,l.m)("targetHost")],r.prototype,"_targetHost",void 0),(0,C.d)([(0,l.B)()],r.prototype,"inertialAlphaOffset",void 0),(0,C.d)([(0,l.B)()],r.prototype,"inertialBetaOffset",void 0),(0,C.d)([(0,l.B)()],r.prototype,"inertialRadiusOffset",void 0),(0,C.d)([(0,l.B)()],r.prototype,"lowerAlphaLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"upperAlphaLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"lowerBetaLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"upperBetaLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"lowerRadiusLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"upperRadiusLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"lowerTargetYLimit",void 0),(0,C.d)([(0,l.B)()],r.prototype,"inertialPanningX",void 0),(0,C.d)([(0,l.B)()],r.prototype,"inertialPanningY",void 0),(0,C.d)([(0,l.B)()],r.prototype,"pinchToPanMaxDistance",void 0),(0,C.d)([(0,l.B)()],r.prototype,"panningDistanceLimit",void 0),(0,C.d)([(0,l.x)()],r.prototype,"panningOriginTarget",void 0),(0,C.d)([(0,l.B)()],r.prototype,"panningInertia",void 0),(0,C.d)([(0,l.B)()],r.prototype,"zoomToMouseLocation",null),(0,C.d)([(0,l.B)()],r.prototype,"zoomOnFactor",void 0),(0,C.d)([(0,l.w)()],r.prototype,"targetScreenOffset",void 0),(0,C.d)([(0,l.B)()],r.prototype,"allowUpsideDown",void 0),(0,C.d)([(0,l.B)()],r.prototype,"useInputToRestoreState",void 0),(0,C.d)([(0,l.B)()],r.prototype,"restoreStateInterpolationFactor",void 0),(0,Q.h)("BABYLON.ArcRotateCamera",r)},12816:(V,I,m)=>{"use strict";m.d(I,{d:()=>F,h:()=>k});var C=m(11085),l=m(11297),s=m(11386),F={};class k{constructor(V){this.attachedToElement=!1,this.attached={},this.camera=V,this.checkInputs=()=>{}}add(V){const I=V.getSimpleName();this.attached[I]?C.d.Warn("camera input of type "+I+" already exists on camera"):(this.attached[I]=V,V.camera=this.camera,V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V))),this.attachedToElement&&V.attachControl(this.noPreventDefault))}remove(V){for(const I in this.attached){const m=this.attached[I];if(m===V)return m.sY(),m.camera=null,delete this.attached[I],void this.rebuildInputCheck()}}removeByType(V){for(const I in this.attached){const m=this.attached[I];m.getClassName()===V&&(m.sY(),m.camera=null,delete this.attached[I],this.rebuildInputCheck())}}_addCheckInputs(V){const I=this.checkInputs;return()=>{I(),V()}}attachInput(V){this.attachedToElement&&V.attachControl(this.noPreventDefault)}attachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){V=!s.c.ForceAttachControlToAlwaysPreventDefault&&V,this.attachedToElement=!0,this.noPreventDefault=V;for(const I in this.attached)this.attached[I].attachControl(V)}}detachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const I in this.attached)this.attached[I].sY(),V&&(this.attached[I].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const V in this.attached){const I=this.attached[V];I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(V){const I={};for(const m in this.attached){const V=this.attached[m],C=l.d.Serialize(V);I[V.getClassName()]=C}V.inputsmgr=I}parse(V){const I=V.inputsmgr;if(I){this.clear();for(const V in I){const m=F[V];if(m){const C=I[V],s=l.d.Parse((()=>new m),C,null);this.add(s)}}}else for(const m in this.attached){const I=F[this.attached[m].getClassName()];if(I){const C=l.d.Parse((()=>new I),V,null);this.remove(this.attached[m]),this.add(C)}}}}},12813:(V,I,m)=>{"use strict";m.d(I,{b:()=>S});var C=m(11206),l=m(11214),s=m(11040),F=m(11564),k=m(12816),j=m(11624),E=m(11076);class K{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(V){V=E.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.cV(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const m=I.event;if(!m.metaKey)if(I.type===j.c.KEYDOWN){if(-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysUpward.indexOf(m.keyCode)||-1!==this.keysDownward.indexOf(m.keyCode)||-1!==this.keysRotateLeft.indexOf(m.keyCode)||-1!==this.keysRotateRight.indexOf(m.keyCode)||-1!==this.keysRotateUp.indexOf(m.keyCode)||-1!==this.keysRotateDown.indexOf(m.keyCode)){-1===this._keys.indexOf(m.keyCode)&&this._keys.push(m.keyCode),V||m.preventDefault()}}else if(-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysUpward.indexOf(m.keyCode)||-1!==this.keysDownward.indexOf(m.keyCode)||-1!==this.keysRotateLeft.indexOf(m.keyCode)||-1!==this.keysRotateRight.indexOf(m.keyCode)||-1!==this.keysRotateUp.indexOf(m.keyCode)||-1!==this.keysRotateDown.indexOf(m.keyCode)){const I=this._keys.indexOf(m.keyCode);I>=0&&this._keys.splice(I,1),V||m.preventDefault()}})))}sY(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let I=0;I<this._keys.length;I++){const m=this._keys[I],C=V._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(m)?V._localDirection.aF(-C,0,0):-1!==this.keysUp.indexOf(m)?V._localDirection.aF(0,0,C):-1!==this.keysRight.indexOf(m)?V._localDirection.aF(C,0,0):-1!==this.keysDown.indexOf(m)?V._localDirection.aF(0,0,-C):-1!==this.keysUpward.indexOf(m)?V._localDirection.aF(0,C,0):-1!==this.keysDownward.indexOf(m)?V._localDirection.aF(0,-C,0):-1!==this.keysRotateLeft.indexOf(m)?(V._localDirection.aF(0,0,0),V.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(m)?(V._localDirection.aF(0,0,0),V.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(m)?(V._localDirection.aF(0,0,0),V.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(m)&&(V._localDirection.aF(0,0,0),V.cameraRotation.x+=this._getLocalRotation()),V.cV().useRightHandedSystem&&(V._localDirection.z*=-1),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),s.m.TransformNormalToRef(V._localDirection,V._cameraTransformMatrix,V._transformedDirection),V.cameraDirection.addInPlace(V._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const V=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*V}}(0,C.d)([(0,l.B)()],K.prototype,"keysUp",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysUpward",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysDown",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysDownward",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysLeft",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysRight",void 0),(0,C.d)([(0,l.B)()],K.prototype,"rotationSpeed",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysRotateLeft",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysRotateRight",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysRotateUp",void 0),(0,C.d)([(0,l.B)()],K.prototype,"keysRotateDown",void 0),k.d.FreeCameraKeyboardMoveInput=K;var Y=m(11067),X=m(11616);class O{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=V,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Y.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(V){V=E.d.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),m=I.getInputElement();this._pointerInput||(this._pointerInput=C=>{const l=C.event,s="touch"===l.pointerType;if(!this.touchEnabled&&s)return;if(C.type!==X.c.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const F=l.target;if(C.type===X.c.POINTERDOWN){if(s&&-1!==this._activePointerId||!s&&-1!==this._currentActiveButton)return;this._activePointerId=l.pointerId;try{null===F||void 0===F||F.setPointerCapture(l.pointerId)}catch(k){}-1===this._currentActiveButton&&(this._currentActiveButton=l.button),this._previousPosition={x:l.clientX,y:l.clientY},V||(l.preventDefault(),m&&m.focus()),I.isPointerLock&&this._onMouseMove&&this._onMouseMove(C.event)}else if(C.type===X.c.POINTERUP){if(s&&this._activePointerId!==l.pointerId||!s&&this._currentActiveButton!==l.button)return;try{null===F||void 0===F||F.releasePointerCapture(l.pointerId)}catch(k){}this._currentActiveButton=-1,this._previousPosition=null,V||l.preventDefault(),this._activePointerId=-1}else if(C.type===X.c.POINTERMOVE&&(this._activePointerId===l.pointerId||!s))if(I.isPointerLock&&this._onMouseMove)this._onMouseMove(C.event);else if(this._previousPosition){const I=this.camera._calculateHandednessMultiplier(),m=(l.clientX-this._previousPosition.x)*I,C=l.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=m/this.angularSensibility,this.camera.cameraRotation.x+=C/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:m,offsetY:C}),this._previousPosition={x:l.clientX,y:l.clientY},V||l.preventDefault()}}),this._onMouseMove=m=>{if(!I.isPointerLock)return;const C=this.camera._calculateHandednessMultiplier(),l=m.movementX*C;this.camera.cameraRotation.y+=l/this.angularSensibility;const s=m.movementY;this.camera.cameraRotation.x+=s/this.angularSensibility,this._previousPosition=null,V||m.preventDefault()},this._observer=this.camera.cV()._inputManager._addCameraPointerObserver(this._pointerInput,X.c.POINTERDOWN|X.c.POINTERUP|X.c.POINTERMOVE),m&&(this._contextMenuBind=V=>this.onContextMenu(V),m.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(V){V.preventDefault()}sY(){if(this._observer){if(this.camera.cV()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,C.d)([(0,l.B)()],O.prototype,"buttons",void 0),(0,C.d)([(0,l.B)()],O.prototype,"angularSensibility",void 0),k.d.FreeCameraMouseInput=O;var v,N=m(11626);class t{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Y.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(V){V=E.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==X.c.POINTERWHEEL)return;const m=I.event,C=m.deltaMode===N.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*C*m.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*C*m.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*C*m.deltaZ/this._normalize,m.preventDefault&&(V||m.preventDefault())},this._observer=this.camera.cV()._inputManager._addCameraPointerObserver(this._wheel,X.c.POINTERWHEEL)}sY(){this._observer&&(this.camera.cV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,C.d)([(0,l.B)()],t.prototype,"wheelPrecisionX",void 0),(0,C.d)([(0,l.B)()],t.prototype,"wheelPrecisionY",void 0),(0,C.d)([(0,l.B)()],t.prototype,"wheelPrecisionZ",void 0),function(V){V[V.MoveRelative=0]="MoveRelative",V[V.RotateRelative=1]="RotateRelative",V[V.MoveScene=2]="MoveScene"}(v||(v={}));class D extends t{constructor(){super(...arguments),this._moveRelative=s.m.Zero(),this._rotateRelative=s.m.Zero(),this._moveScene=s.m.Zero(),this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(V){null===V&&this._wheelXAction!==v.MoveRelative||(this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=V)}get wheelXMoveRelative(){return this._wheelXAction!==v.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(V){null===V&&this._wheelYAction!==v.MoveRelative||(this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=V)}get wheelYMoveRelative(){return this._wheelYAction!==v.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(V){null===V&&this._wheelZAction!==v.MoveRelative||(this._wheelZAction=v.MoveRelative,this._wheelZActionCoordinate=V)}get wheelZMoveRelative(){return this._wheelZAction!==v.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(V){null===V&&this._wheelXAction!==v.RotateRelative||(this._wheelXAction=v.RotateRelative,this._wheelXActionCoordinate=V)}get wheelXRotateRelative(){return this._wheelXAction!==v.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(V){null===V&&this._wheelYAction!==v.RotateRelative||(this._wheelYAction=v.RotateRelative,this._wheelYActionCoordinate=V)}get wheelYRotateRelative(){return this._wheelYAction!==v.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(V){null===V&&this._wheelZAction!==v.RotateRelative||(this._wheelZAction=v.RotateRelative,this._wheelZActionCoordinate=V)}get wheelZRotateRelative(){return this._wheelZAction!==v.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(V){null===V&&this._wheelXAction!==v.MoveScene||(this._wheelXAction=v.MoveScene,this._wheelXActionCoordinate=V)}get wheelXMoveScene(){return this._wheelXAction!==v.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(V){null===V&&this._wheelYAction!==v.MoveScene||(this._wheelYAction=v.MoveScene,this._wheelYActionCoordinate=V)}get wheelYMoveScene(){return this._wheelYAction!==v.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(V){null===V&&this._wheelZAction!==v.MoveScene||(this._wheelZAction=v.MoveScene,this._wheelZActionCoordinate=V)}get wheelZMoveScene(){return this._wheelZAction!==v.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.mk(0),this._rotateRelative.mk(0),this._moveScene.mk(0),this._updateCamera(),this.camera.cV().useRightHandedSystem&&(this._moveRelative.z*=-1);const V=s.b.Zero();this.camera.getViewMatrix().invertToRef(V);const I=s.m.Zero();s.m.TransformNormalToRef(this._moveRelative,V,I),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(I),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(V,I,m){if(0===V)return;if(null===I||null===m)return;let C=null;switch(I){case v.MoveRelative:C=this._moveRelative;break;case v.RotateRelative:C=this._rotateRelative;break;case v.MoveScene:C=this._moveScene}switch(m){case 0:C.set(V,0,0);break;case 1:C.set(0,V,0);break;case 2:C.set(0,0,V)}}}(0,C.d)([(0,l.B)()],D.prototype,"wheelXMoveRelative",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelYMoveRelative",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelZMoveRelative",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelXRotateRelative",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelYRotateRelative",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelZRotateRelative",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelXMoveScene",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelYMoveScene",null),(0,C.d)([(0,l.B)()],D.prototype,"wheelZMoveScene",null),k.d.FreeCameraMouseWheelInput=D;class b{constructor(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=V,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=E.d.IsSafari()}attachControl(V){V=E.d.BackCompatCameraNoPreventDefault(arguments);let I=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=m=>{const C=m.event,l="mouse"===C.pointerType||this._isSafari&&"undefined"===typeof C.pointerType;if(this.allowMouse||!l)if(m.type===X.c.POINTERDOWN){if(V||C.preventDefault(),this._pointerPressed.push(C.pointerId),1!==this._pointerPressed.length)return;I={x:C.clientX,y:C.clientY}}else if(m.type===X.c.POINTERUP){V||C.preventDefault();const m=this._pointerPressed.indexOf(C.pointerId);if(-1===m)return;if(this._pointerPressed.splice(m,1),0!=m)return;I=null,this._offsetX=null,this._offsetY=null}else if(m.type===X.c.POINTERMOVE){if(V||C.preventDefault(),!I)return;if(0!=this._pointerPressed.indexOf(C.pointerId))return;this._offsetX=C.clientX-I.x,this._offsetY=-(C.clientY-I.y)}}),this._observer=this.camera.cV()._inputManager._addCameraPointerObserver(this._pointerInput,X.c.POINTERDOWN|X.c.POINTERUP|X.c.POINTERMOVE),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.addEventListener("blur",this._onLostFocus)}}sY(){if(this._pointerInput){if(this._observer&&(this.camera.cV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const V=this.camera,I=V._calculateHandednessMultiplier();V.cameraRotation.y=I*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)V.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const I=V._computeLocalCameraSpeed(),m=new s.m(0,0,0!==this.touchMoveSensibility?I*this._offsetY/this.touchMoveSensibility:0);s.b.RotationYawPitchRollToRef(V.rotation.y,V.rotation.x,0,V._cameraRotationMatrix),V.cameraDirection.addInPlace(s.m.TransformCoordinates(m,V._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,C.d)([(0,l.B)()],b.prototype,"touchAngularSensibility",void 0),(0,C.d)([(0,l.B)()],b.prototype,"touchMoveSensibility",void 0),k.d.FreeCameraTouchInput=b;class T extends k.h{constructor(V){super(V),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new K),this}addMouse(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new O(V),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new D,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new b),this}clear(){super.clear(),this._mouseInput=null}}var n=m(11048),x=m(11136);class S extends F.e{get angularSensibility(){const V=this.inputs.attached.mouse;return V?V.angularSensibility:0}set angularSensibility(V){const I=this.inputs.attached.mouse;I&&(I.angularSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const I=this.inputs.attached.keyboard;I&&(I.keysUp=V)}get keysUpward(){const V=this.inputs.attached.keyboard;return V?V.keysUpward:[]}set keysUpward(V){const I=this.inputs.attached.keyboard;I&&(I.keysUpward=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const I=this.inputs.attached.keyboard;I&&(I.keysDown=V)}get keysDownward(){const V=this.inputs.attached.keyboard;return V?V.keysDownward:[]}set keysDownward(V){const I=this.inputs.attached.keyboard;I&&(I.keysDownward=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const I=this.inputs.attached.keyboard;I&&(I.keysRight=V)}get keysRotateLeft(){const V=this.inputs.attached.keyboard;return V?V.keysRotateLeft:[]}set keysRotateLeft(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateLeft=V)}get keysRotateRight(){const V=this.inputs.attached.keyboard;return V?V.keysRotateRight:[]}set keysRotateRight(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateRight=V)}get keysRotateUp(){const V=this.inputs.attached.keyboard;return V?V.keysRotateUp:[]}set keysRotateUp(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateUp=V)}get keysRotateDown(){const V=this.inputs.attached.keyboard;return V?V.keysRotateDown:[]}set keysRotateDown(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateDown=V)}constructor(V,I,m){var C;super(V,I,m,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),C=this,this.ellipsoid=new s.m(.5,1,.5),this.ellipsoidOffset=new s.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=s.m.Zero(),this._diffPosition=s.m.Zero(),this._newPosition=s.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C._newPosition.C(I),C._newPosition.subtractToRef(C._oldPosition,C._diffPosition),C._diffPosition.length()>x.b.CollisionsEpsilon&&(C.position.addToRef(C._diffPosition,C._deferredPositionUpdate),C._deferOnly?C._deferredUpdated=!0:C.position.C(C._deferredPositionUpdate),C.wX&&m&&C.wX(m))},this.inputs=new T(this),this.inputs.addKeyboard().addMouse()}attachControl(V,I){I=E.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(I)}sY(){this.inputs.detachElement(),this.cameraDirection=new s.m(0,0,0),this.cameraRotation=new s.k(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(V){this._collisionMask=isNaN(V)?-1:V}_collideWithWorld(V){let I;I=this.parent?s.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,I.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const m=this.cV().collisionCoordinator;this._collider||(this._collider=m.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let C=V;this.applyGravity&&(C=V.add(this.cV().gravity)),m.getNewPosition(this._oldPosition,C,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=s.m.Zero(),this._transformedDirection=s.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(V){this._needMoveForGravity=V}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.cV().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"yv"}}(0,C.d)([(0,l.x)()],S.prototype,"ellipsoid",void 0),(0,C.d)([(0,l.x)()],S.prototype,"ellipsoidOffset",void 0),(0,C.d)([(0,l.B)()],S.prototype,"checkCollisions",void 0),(0,C.d)([(0,l.B)()],S.prototype,"applyGravity",void 0),(0,n.h)("BABYLON.FreeCamera",S)},13416:(V,I,m)=>{"use strict";m.d(I,{e:()=>s});var C=m(11389),l=m(13423);class s{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=m,this.zK=[],this._maxBlockCapacity=I||64,this._selectionContent=new C.c(1024),this._creationFunc=V}update(V,I,m){l.c._CreateBlocks(V,I,m,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}GE(V){for(let I=0;I<this.fE.length;I++){this.fE[I].addEntry(V)}}QE(V){for(let I=0;I<this.fE.length;I++){this.fE[I].removeEntry(V)}}select(V,I){this._selectionContent.reset();for(let m=0;m<this.fE.length;m++){this.fE[m].select(V,this._selectionContent,I)}return I?this._selectionContent.concat(this.zK):this._selectionContent.concatWithNoDuplicate(this.zK),this._selectionContent}intersects(V,I,m){this._selectionContent.reset();for(let C=0;C<this.fE.length;C++){this.fE[C].intersects(V,I,this._selectionContent,m)}return m?this._selectionContent.concat(this.zK):this._selectionContent.concatWithNoDuplicate(this.zK),this._selectionContent}intersectsRay(V){this._selectionContent.reset();for(let I=0;I<this.fE.length;I++){this.fE[I].intersectsRay(V,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.zK),this._selectionContent}}s.CreationFuncForMeshes=(V,I)=>{const m=V.getBoundingInfo();!V.isBlocked&&m.boundingBox.intersectsMinMax(I.QK,I.GK)&&I.entries.push(V)},s.CreationFuncForSubMeshes=(V,I)=>{V.getBoundingInfo().boundingBox.intersectsMinMax(I.QK,I.GK)&&I.entries.push(V)}},13423:(V,I,m)=>{"use strict";m.d(I,{c:()=>s});var C=m(11040),l=m(11260);class s{constructor(V,I,m,C,l,s){this.entries=[],this.rK=new Array,this._capacity=m,this._depth=C,this._maxDepth=l,this._creationFunc=s,this._minPoint=V,this._maxPoint=I,this.rK.push(V.clone()),this.rK.push(I.clone()),this.rK.push(V.clone()),this.rK[2].x=I.x,this.rK.push(V.clone()),this.rK[3].y=I.y,this.rK.push(V.clone()),this.rK[4].z=I.z,this.rK.push(I.clone()),this.rK[5].z=V.z,this.rK.push(I.clone()),this.rK[6].x=V.x,this.rK.push(I.clone()),this.rK[7].y=V.y}get xF(){return this._capacity}get QK(){return this._minPoint}get GK(){return this._maxPoint}addEntry(V){if(this.fE)for(let I=0;I<this.fE.length;I++){this.fE[I].addEntry(V)}else this._creationFunc(V,this),this.entries.length>this.xF&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(V){if(this.fE){for(let I=0;I<this.fE.length;I++){this.fE[I].removeEntry(V)}return}const I=this.entries.indexOf(V);I>-1&&this.entries.splice(I,1)}addEntries(V){for(let I=0;I<V.length;I++){const m=V[I];this.addEntry(m)}}select(V,I,m){if(l.b.IsInFrustum(this.rK,V)){if(this.fE){for(let C=0;C<this.fE.length;C++){this.fE[C].select(V,I,m)}return}m?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}}intersects(V,I,m,C){if(l.b.IntersectsSphere(this._minPoint,this._maxPoint,V,I)){if(this.fE){for(let l=0;l<this.fE.length;l++){this.fE[l].intersects(V,I,m,C)}return}C?m.concat(this.entries):m.concatWithNoDuplicate(this.entries)}}intersectsRay(V,I){if(V.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.fE){for(let m=0;m<this.fE.length;m++){this.fE[m].intersectsRay(V,I)}return}I.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){s._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(V,I,m,l,F,k,j,E){j.fE=new Array;const K=new C.m((I.x-V.x)/2,(I.y-V.y)/2,(I.z-V.z)/2);for(let C=0;C<2;C++)for(let I=0;I<2;I++)for(let Y=0;Y<2;Y++){const X=V.add(K.multiplyByFloats(C,I,Y)),O=V.add(K.multiplyByFloats(C+1,I+1,Y+1)),v=new s(X,O,l,F+1,k,E);v.addEntries(m),j.fE.push(v)}}}},13428:(V,I,m)=>{"use strict";m.d(I,{e:()=>K});var C=m(11596),l=m(11040),s=m(11342),F=m(12564),k=m(11421),j=m(13416),E=m(11061);C.e.prototype.createOrUpdateSelectionOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,m=this._getComponent(k.c.NAME_OCTREE);m||(m=new K(this),this.o(m)),this.HK||(this.HK=new j.e(j.e.CreationFuncForMeshes,V,I));const C=this.getWorldExtends();return this.HK.update(C.min,C.max,this.meshes),this.HK},Object.defineProperty(C.e.prototype,"selectionOctree",{get:function(){return this.HK},enumerable:!0,configurable:!0}),s.e.prototype.createOrUpdateSubmeshesOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const m=this.cV();let C=m._getComponent(k.c.NAME_OCTREE);C||(C=new K(m),m.o(C)),this._submeshesOctree||(this._submeshesOctree=new j.e(j.e.CreationFuncForSubMeshes,V,I)),this.fF(!0);const l=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(l.minimumWorld,l.maximumWorld,this.kk),this._submeshesOctree};class K{constructor(V){this.name=k.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new F.d(l.m.Zero(),new l.m(1,1,1)),(V=V||E.c.LastCreatedScene)&&(this.OI=V,this.OI.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.OI.getActiveSubMeshCandidates=V=>this.getActiveSubMeshCandidates(V),this.OI.getCollidingSubMeshCandidates=(V,I)=>this.getCollidingSubMeshCandidates(V,I),this.OI.getIntersectingSubMeshCandidates=(V,I)=>this.getIntersectingSubMeshCandidates(V,I))}register(){this.OI.onMeshRemovedObservable.add((V=>{const I=this.OI.selectionOctree;if(void 0!==I&&null!==I){const m=I.zK.indexOf(V);-1!==m&&I.zK.splice(m,1)}})),this.OI.onMeshImportedObservable.add((V=>{const I=this.OI.selectionOctree;void 0!==I&&null!==I&&I.GE(V)}))}getActiveMeshCandidates(){var V;return(null===(V=this.OI.HK)||void 0===V?void 0:V.select(this.OI.frustumPlanes))||this.OI._getDefaultMeshCandidates()}getActiveSubMeshCandidates(V){if(V._submeshesOctree&&V.useOctreeForRenderingSelection){return V._submeshesOctree.select(this.OI.frustumPlanes)}return this.OI._getDefaultSubMeshCandidates(V)}getIntersectingSubMeshCandidates(V,I){if(V._submeshesOctree&&V.useOctreeForPicking){F.d.TransformToRef(I,V.getWorldMatrix(),this._tempRay);return V._submeshesOctree.intersectsRay(this._tempRay)}return this.OI._getDefaultSubMeshCandidates(V)}getCollidingSubMeshCandidates(V,I){if(V._submeshesOctree&&V.useOctreeForCollisions){const m=I._velocityWorldLength+Math.max(I._radius.x,I._radius.y,I._radius.z);return V._submeshesOctree.intersects(I._basePointWorld,m)}return this.OI._getDefaultSubMeshCandidates(V)}rebuild(){}dispose(){}}},12564:(V,I,m)=>{"use strict";m.d(I,{d:()=>O});var C=m(11596),l=m(11386),s=m(11044),F=m(11040),k=m(11046),j=m(11246),E=m(11366),K=m(11061),Y=m(11633);const X={internalPickerForMesh:void 0};class O{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.c;this.origin=V,this.direction=I,this.length=m,this.epsilon=C}clone(){return new O(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=O._TmpVector3[0].aF(V.x-m,V.y-m,V.z-m),l=O._TmpVector3[1].aF(I.x+m,I.y+m,I.z+m);let s,F,k,j,E=0,K=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<C.x||this.origin.x>l.x)return!1}else if(s=1/this.direction.x,F=(C.x-this.origin.x)*s,k=(l.x-this.origin.x)*s,k===-1/0&&(k=1/0),F>k&&(j=F,F=k,k=j),E=Math.max(F,E),K=Math.min(k,K),E>K)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<C.y||this.origin.y>l.y)return!1}else if(s=1/this.direction.y,F=(C.y-this.origin.y)*s,k=(l.y-this.origin.y)*s,k===-1/0&&(k=1/0),F>k&&(j=F,F=k,k=j),E=Math.max(F,E),K=Math.min(k,K),E>K)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<C.z||this.origin.z>l.z)return!1}else if(s=1/this.direction.z,F=(C.z-this.origin.z)*s,k=(l.z-this.origin.z)*s,k===-1/0&&(k=1/0),F>k&&(j=F,F=k,k=j),E=Math.max(F,E),K=Math.min(k,K),E>K)return!1;return!0}intersectsBox(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(V.minimum,V.maximum,I)}intersectsSphere(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=V.center.x-this.origin.x,C=V.center.y-this.origin.y,l=V.center.z-this.origin.z,s=m*m+C*C+l*l,F=V.radius+I,k=F*F;if(s<=k)return!0;const j=m*this.direction.x+C*this.direction.y+l*this.direction.z;if(j<0)return!1;return s-j*j<=k}intersectsTriangle(V,I,m){const C=O._TmpVector3[0],l=O._TmpVector3[1],s=O._TmpVector3[2],k=O._TmpVector3[3],E=O._TmpVector3[4];I.subtractToRef(V,C),m.subtractToRef(V,l),F.m.CrossToRef(this.direction,l,s);const K=F.m.Dot(C,s);if(0===K)return null;const Y=1/K;this.origin.subtractToRef(V,k);const X=F.m.Dot(k,s)*Y;if(X<-this.epsilon||X>1+this.epsilon)return null;F.m.CrossToRef(k,C,E);const v=F.m.Dot(this.direction,E)*Y;if(v<-this.epsilon||X+v>1+this.epsilon)return null;const N=F.m.Dot(l,E)*Y;return N>this.length?null:new j.d(1-X-v,X,N)}intersectsPlane(V){let I;const m=F.m.Dot(V.XC,this.direction);if(Math.abs(m)<9.99999997475243e-7)return null;{const C=F.m.Dot(V.XC,this.origin);return I=(-V.d-C)/m,I<0?I<-9.99999997475243e-7?null:0:I}}intersectsAxis(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(V){case"y":{const V=(this.origin.y-I)/this.direction.y;return V>0?null:new F.m(this.origin.x+this.direction.x*-V,I,this.origin.z+this.direction.z*-V)}case"x":{const V=(this.origin.x-I)/this.direction.x;return V>0?null:new F.m(I,this.origin.y+this.direction.y*-V,this.origin.z+this.direction.z*-V)}case"z":{const V=(this.origin.z-I)/this.direction.z;return V>0?null:new F.m(this.origin.x+this.direction.x*-V,this.origin.y+this.direction.y*-V,I)}default:return null}}intersectsMesh(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=F.g.Matrix[0];return V.getWorldMatrix().invertToRef(k),this._tmpRay?O.TransformToRef(this,k,this._tmpRay):this._tmpRay=O.Transform(this,k),V.intersects(this._tmpRay,I,m,C,l,s)}intersectsMeshes(V,I,m){m?m.length=0:m=[];for(let C=0;C<V.length;C++){const l=this.intersectsMesh(V[C],I);l.hit&&m.push(l)}return m.sort(this._comparePickingInfo),m}_comparePickingInfo(V,I){return V.distance<I.distance?-1:V.distance>I.distance?1:0}intersectionSegment(V,I,m){const C=this.origin,l=F.g.LF[0],s=F.g.LF[1],k=F.g.LF[2],j=F.g.LF[3];I.subtractToRef(V,l),this.direction.scaleToRef(O._Rayl,k),C.addToRef(k,s),V.subtractToRef(C,j);const E=F.m.Dot(l,l),K=F.m.Dot(l,k),Y=F.m.Dot(k,k),X=F.m.Dot(l,j),v=F.m.Dot(k,j),N=E*Y-K*K;let t,D,b=N,T=N;N<O._Smallnum?(t=0,b=1,D=v,T=Y):(t=K*v-Y*X,D=E*v-K*X,t<0?(t=0,D=v,T=Y):t>b&&(t=b,D=v+K,T=Y)),D<0?(D=0,-X<0?t=0:-X>E?t=b:(t=-X,b=E)):D>T&&(D=T,-X+K<0?t=0:-X+K>E?t=b:(t=-X+K,b=E));const n=Math.abs(t)<O._Smallnum?0:t/b,x=Math.abs(D)<O._Smallnum?0:D/T,S=F.g.LF[4];k.scaleToRef(x,S);const c=F.g.LF[5];l.scaleToRef(n,c),c.addInPlace(j);const H=F.g.LF[6];c.subtractToRef(S,H);return x>0&&x<=this.length&&H.lengthSquared()<m*m?c.length():-1}update(V,I,m,C,l,s,k){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){O._RayDistant||(O._RayDistant=O.Zero()),O._RayDistant.unprojectRayToRef(V,I,m,C,F.b.IdentityReadOnly,s,k);const j=F.g.Matrix[0];l.invertToRef(j),O.TransformToRef(O._RayDistant,j,this)}else this.unprojectRayToRef(V,I,m,C,l,s,k);return this}static Zero(){return new O(F.m.Zero(),F.m.Zero())}static CreateNew(V,I,m,C,l,s,F){return O.Zero().update(V,I,m,C,l,s,F)}static CreateNewFromTo(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.IdentityReadOnly;const C=new O(new F.m(0,0,0),new F.m(0,0,0));return O.CreateFromToToRef(V,I,C,m)}static CreateFromToToRef(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.b.IdentityReadOnly;m.origin.C(V);const l=I.subtractToRef(V,m.direction),s=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z);return m.length=s,m.direction.normalize(),O.TransformToRef(m,C,m)}static Transform(V,I){const m=new O(new F.m(0,0,0),new F.m(0,0,0));return O.TransformToRef(V,I,m),m}static TransformToRef(V,I,m){F.m.TransformCoordinatesToRef(V.origin,I,m.origin),F.m.TransformNormalToRef(V.direction,I,m.direction),m.length=V.length,m.epsilon=V.epsilon;const C=m.direction,l=C.length();if(0!==l&&1!==l){const V=1/l;C.x*=V,C.y*=V,C.z*=V,m.length*=l}return m}unprojectRayToRef(V,I,m,C,l,s,k){const j=F.g.Matrix[0];l.multiplyToRef(s,j),j.multiplyToRef(k,j),j.invert();const E=K.c.LastCreatedEngine,Y=F.g.LF[0];Y.x=V/m*2-1,Y.y=-(I/C*2-1),Y.z=null!==E&&void 0!==E&&E.useReverseDepthBuffer?1:null!==E&&void 0!==E&&E.isNDCHalfZRange?0:-1;const X=F.g.LF[1].aF(Y.x,Y.y,1-1e-8),O=F.g.LF[2],v=F.g.LF[3];F.m._UnprojectFromInvertedMatrixToRef(Y,j,O),F.m._UnprojectFromInvertedMatrixToRef(X,j,v),this.origin.C(O),v.subtractToRef(O,this.direction),this.direction.normalize()}}function v(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=O.Zero();return N(V,I,m,C,F,l,s),F}function N(V,I,m,C,l,s){let k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const E=V.getEngine();if(!s&&!(s=V.activeCamera))return V;const K=s.viewport,Y=E.getRenderHeight(),{x:X,y:O,width:v,height:N}=K.toGlobal(E.getRenderWidth(),Y),t=1/E.getHardwareScalingLevel();return I=I*t-X,m=m*t-(Y-O-N),l.update(I,m,v,N,C||F.b.IdentityReadOnly,k?F.b.IdentityReadOnly:s.getViewMatrix(),s.getProjectionMatrix(),j),V}function t(V,I,m,C,l){if(!E.b)return V;const s=V.getEngine();if(!l&&!(l=V.activeCamera))throw new Error("Active camera not set");const k=l.viewport,j=s.getRenderHeight(),{x:K,y:Y,width:X,height:O}=k.toGlobal(s.getRenderWidth(),j),v=F.b.Identity(),N=1/s.getHardwareScalingLevel();return I=I*N-K,m=m*N-(j-Y-O),C.update(I,m,X,O,v,v,l.getProjectionMatrix()),V}function D(V,I,m,C,l,s,F,k){const j=I(C,m.enableDistantPicking),E=m.intersects(j,l,F,s,C,k);return E&&E.hit?!l&&null!=V&&E.distance>=V.distance?null:E:null}function b(V,I,m,C,l,s){let k=null;const j=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),K=V.cameraToUseForPointers||V.activeCamera,Y=X.internalPickerForMesh||D;for(let E=0;E<V.meshes.length;E++){const X=V.meshes[E];if(m){if(!m(X,-1))continue}else if(!X.isEnabled()||!X.isVisible||!X.Tj)continue;const O=j&&X.isWorldMatrixCameraDependent(),v=X.fF(O,K);if(X.hasThinInstances&&X.thinInstanceEnablePicking){const V=Y(k,I,X,v,!0,!0,s);if(V){if(l)return V;const j=F.g.Matrix[1],E=X.thinInstanceGetWorldMatrices();for(let V=0;V<E.length;V++){if(m&&!m(X,V))continue;E[V].multiplyToRef(v,j);const F=Y(k,I,X,j,C,l,s,!0);if(F&&(k=F,k.thinInstanceIndex=V,C))return k}}}else{const V=Y(k,I,X,v,C,l,s);if(V&&(k=V,C))return k}}return k||new E.b}function T(V,I,m,C){if(!E.b)return null;const l=[],s=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),k=V.cameraToUseForPointers||V.activeCamera,j=X.internalPickerForMesh||D;for(let E=0;E<V.meshes.length;E++){const K=V.meshes[E];if(m){if(!m(K,-1))continue}else if(!K.isEnabled()||!K.isVisible||!K.Tj)continue;const Y=s&&K.isWorldMatrixCameraDependent(),X=K.fF(Y,k);if(K.hasThinInstances&&K.thinInstanceEnablePicking){if(j(null,I,K,X,!0,!0,C)){const V=F.g.Matrix[1],s=K.thinInstanceGetWorldMatrices();for(let F=0;F<s.length;F++){if(m&&!m(K,F))continue;s[F].multiplyToRef(X,V);const k=j(null,I,K,V,!1,!1,C,!0);k&&(k.thinInstanceIndex=F,l.push(k))}}}else{const V=j(null,I,K,X,!1,!1,C);V&&l.push(V)}}return l}function n(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;C||(C=V.getWorldMatrix()),I.length=m,l?I.origin.C(l):I.origin.C(V.position);const s=F.g.LF[2];s.set(0,0,V._scene.useRightHandedSystem?-1:1);const k=F.g.LF[3];return F.m.TransformNormalToRef(s,C,k),F.m.NormalizeToRef(k,I.direction),I}var x,S;O._TmpVector3=(0,k.d)(6,F.m.Zero),O._RayDistant=O.Zero(),O._Smallnum=1e-8,O._Rayl=1e9,x=C.e,(S=l.c)&&(S.prototype.getForwardRay=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;return n(this,new O(F.m.Zero(),F.m.Zero(),V),V,I,m)},S.prototype.getForwardRayToRef=function(V){return n(this,V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),x&&(Y.d._IsPickingAvailable=!0,x.prototype.createPickingRay=function(V,I,m,C){return v(this,V,I,m,C,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),C.e.prototype.createPickingRayToRef=function(V,I,m,C,l){return N(this,V,I,m,C,l,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},C.e.prototype.createPickingRayInCameraSpace=function(V,I,m){return function(V,I,m,C){const l=O.Zero();return t(V,I,m,l,C),l}(this,V,I,m)},C.e.prototype.createPickingRayInCameraSpaceToRef=function(V,I,m,C){return t(this,V,I,m,C)},C.e.prototype.pickWithBoundingInfo=function(V,I,m,C,l){return function(V,I,m,C,l,s){if(!E.b)return null;const k=b(V,(C=>(V._tempPickingRay||(V._tempPickingRay=O.Zero()),N(V,I,m,C,V._tempPickingRay,s||null),V._tempPickingRay)),C,l,!0);return k&&(k.ray=v(V,I,m,F.b.Identity(),s||null)),k}(this,V,I,m,C,l)},C.e.prototype.sm=function(V,I,m,C,l,s){return function(V,I,m,C,l,s,k){const j=b(V,((C,l)=>(V._tempPickingRay||(V._tempPickingRay=O.Zero()),N(V,I,m,C,V._tempPickingRay,s||null,!1,l),V._tempPickingRay)),C,l,!1,k);return j&&(j.ray=v(V,I,m,F.b.Identity(),s||null)),j}(this,V,I,m,C,l,s)},C.e.prototype.pickWithRay=function(V,I,m,C){return function(V,I,m,C,l){const s=b(V,(m=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=F.b.Identity()),m.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=O.Zero()),O.TransformToRef(I,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),m,C,!1,l);return s&&(s.ray=I),s}(this,V,I,m,C)},C.e.prototype.multiPick=function(V,I,m,C,l){return function(V,I,m,C,l,s){return T(V,(C=>v(V,I,m,C,l||null)),C,s)}(this,V,I,m,C,l)},C.e.prototype.multiPickWithRay=function(V,I,m){return function(V,I,m,C){return T(V,(m=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=F.b.Identity()),m.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=O.Zero()),O.TransformToRef(I,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),m,C)}(this,V,I,m)}},12872:(V,I,m)=>{"use strict";var C=m(11161),l=m(11085),s=m(11102),F=m(11188),k=m(11136),j=m(11177);k.b.prototype._partialLoadFile=function(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(V,(V=>{m[I]=V,m._internalCount++,6===m._internalCount&&C(m)}),void 0,void 0,!0,((V,I)=>{l&&V&&l(V.status+" "+V.statusText,I)}))},k.b.prototype._cascadeLoadFiles=function(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=[];l._internalCount=0;for(let s=0;s<6;s++)this._partialLoadFile(m[s],s,l,I,C)},k.b.prototype._cascadeLoadImgs=function(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0;const F=[];F._internalCount=0;for(let k=0;k<6;k++)this._partialLoadImg(C[k],k,F,V,I,m,l,s)},k.b.prototype._partialLoadImg=function(V,I,m,C,l,k){let j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0;const K=(0,F.d)();(0,s.u)(V,(V=>{m[I]=V,m._internalCount++,C&&C.removePendingData(K),6===m._internalCount&&k&&k(l,m)}),((V,I)=>{C&&C.removePendingData(K),j&&j(V,I)}),C?C.offlineProvider:null,E),C&&C.addPendingData(K)},k.b.prototype.createCubeTextureBase=function(V,I,m,s){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6?arguments[6]:void 0,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,N=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,t=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,D=arguments.length>14&&void 0!==arguments[14]&&arguments[14],b=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const T=v||new C.e(this,7);T.isCube=!0,T.url=V,T.generateMipMaps=!s,T._lodGenerationScale=X,T._lodGenerationOffset=O,T._useSRGBBuffer=!!D&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!s),T!==v&&(T.label=V.substring(0,60)),this._doNotHandleContextLost||(T._extension=K,T._files=m,T._buffer=b);const n=V;this._transformTextureUrl&&!v&&(V=this._transformTextureUrl(V));const x=K??function(V){const I=V.split("?")[0],m=I.lastIndexOf(".");return m>-1?I.substring(m).toLowerCase():""}(V),S=(0,j.c)(x),c=(V,I)=>{T.dispose(),k?k(V,I):V&&l.d.Warn(V)},H=(C,k)=>{V===n?C&&c(C.status+" "+C.statusText,k):(l.d.Warn(`Failed to load ${V}, falling back to the ${n}`),this.createCubeTextureBase(n,I,m,!!s,F,c,E,K,Y,X,O,T,N,t,D,b))};if(S)S.then((C=>{const l=V=>{N&&N(T,V),C.loadCubeData(V,T,Y,F,((V,I)=>{c(V,I)}))};b?l(b):m&&6===m.length?C.supportCascades?this._cascadeLoadFiles(I,(V=>l(V.map((V=>new Uint8Array(V))))),m,c):c("Textures type does not support cascades."):this._loadFile(V,(V=>l(new Uint8Array(V))),void 0,void 0,!0,H)}));else{if(!m||0===m.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(I,T,((V,I)=>{t&&t(V,I)}),m,c)}return this._internalTexturesCache.push(T),T}},13434:(V,I,m)=>{"use strict";m(11085);var C=m(11428);m(11161),m(11238),m(11055),m(11482),m(11442);C.c},12896:(V,I,m)=>{"use strict";m.d(I,{b:()=>l});var C=m(11048);class l{constructor(V){this.value=this._toInt(V)}_toInt(V){return 0|V}add(V){return new l(this.value+V.value)}Fm(V){return new l(this.value-V.value)}multiply(V){return new l(Math.imul(this.value,V.value))}divide(V){return new l(this.value/V.value)}getClassName(){return l.ClassName}equals(V){return this.value===V.value}static FromValue(V){return new l(V)}toString(){return this.value.toString()}}l.ClassName="FlowGraphInteger",(0,C.h)("FlowGraphInteger",l)},12901:(V,I,m)=>{"use strict";m.d(I,{d:()=>l,f:()=>s});var C=m(11040);class l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.aY=V}get m(){return this.aY}transformVector(V){return this.transformVectorToRef(V,new C.k)}transformVectorToRef(V,I){return I.x=V.x*this.aY[0]+V.y*this.aY[1],I.y=V.x*this.aY[2]+V.y*this.aY[3],I}UF(){return this.toArray()}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<4;I++)V[I]=this.aY[I];return V}km(V){for(let I=0;I<4;I++)this.aY[I]=V[I];return this}multiplyToRef(V,I){const m=V.aY,C=this.aY,l=I.aY;return l[0]=m[0]*C[0]+m[1]*C[2],l[1]=m[0]*C[1]+m[1]*C[3],l[2]=m[2]*C[0]+m[3]*C[2],l[3]=m[2]*C[1]+m[3]*C[3],I}multiply(V){return this.multiplyToRef(V,new l)}divideToRef(V,I){const m=this.aY,C=V.aY,l=I.aY;return l[0]=m[0]/C[0],l[1]=m[1]/C[1],l[2]=m[2]/C[2],l[3]=m[3]/C[3],I}divide(V){return this.divideToRef(V,new l)}addToRef(V,I){const m=this.aY,C=V.m,l=I.m;return l[0]=m[0]+C[0],l[1]=m[1]+C[1],l[2]=m[2]+C[2],l[3]=m[3]+C[3],I}add(V){return this.addToRef(V,new l)}subtractToRef(V,I){const m=this.aY,C=V.m,l=I.m;return l[0]=m[0]-C[0],l[1]=m[1]-C[1],l[2]=m[2]-C[2],l[3]=m[3]-C[3],I}Fm(V){return this.subtractToRef(V,new l)}transpose(){const V=this.aY;return new l([V[0],V[2],V[1],V[3]])}determinant(){const V=this.aY;return V[0]*V[3]-V[1]*V[2]}inverse(){const V=this.determinant();if(0===V)throw new Error("Matrix is not invertible");const I=this.aY,m=1/V;return new l([I[3]*m,-I[1]*m,-I[2]*m,I[0]*m])}equals(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.aY,C=V.m;return 0===I?m[0]===C[0]&&m[1]===C[1]&&m[2]===C[2]&&m[3]===C[3]:Math.abs(m[0]-C[0])<I&&Math.abs(m[1]-C[1])<I&&Math.abs(m[2]-C[2])<I&&Math.abs(m[3]-C[3])<I}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.aY.join(", ")})`}}class s{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.aY=V}get m(){return this.aY}transformVector(V){return this.transformVectorToRef(V,new C.m)}transformVectorToRef(V,I){const m=this.aY;return I.x=V.x*m[0]+V.y*m[1]+V.z*m[2],I.y=V.x*m[3]+V.y*m[4]+V.z*m[5],I.z=V.x*m[6]+V.y*m[7]+V.z*m[8],I}multiplyToRef(V,I){const m=V.aY,C=this.aY,l=I.m;return l[0]=m[0]*C[0]+m[1]*C[3]+m[2]*C[6],l[1]=m[0]*C[1]+m[1]*C[4]+m[2]*C[7],l[2]=m[0]*C[2]+m[1]*C[5]+m[2]*C[8],l[3]=m[3]*C[0]+m[4]*C[3]+m[5]*C[6],l[4]=m[3]*C[1]+m[4]*C[4]+m[5]*C[7],l[5]=m[3]*C[2]+m[4]*C[5]+m[5]*C[8],l[6]=m[6]*C[0]+m[7]*C[3]+m[8]*C[6],l[7]=m[6]*C[1]+m[7]*C[4]+m[8]*C[7],l[8]=m[6]*C[2]+m[7]*C[5]+m[8]*C[8],I}multiply(V){return this.multiplyToRef(V,new s)}divideToRef(V,I){const m=this.aY,C=V.m,l=I.m;return l[0]=m[0]/C[0],l[1]=m[1]/C[1],l[2]=m[2]/C[2],l[3]=m[3]/C[3],l[4]=m[4]/C[4],l[5]=m[5]/C[5],l[6]=m[6]/C[6],l[7]=m[7]/C[7],l[8]=m[8]/C[8],I}divide(V){return this.divideToRef(V,new s)}addToRef(V,I){const m=this.aY,C=V.m,l=I.m;return l[0]=m[0]+C[0],l[1]=m[1]+C[1],l[2]=m[2]+C[2],l[3]=m[3]+C[3],l[4]=m[4]+C[4],l[5]=m[5]+C[5],l[6]=m[6]+C[6],l[7]=m[7]+C[7],l[8]=m[8]+C[8],I}add(V){return this.addToRef(V,new s)}subtractToRef(V,I){const m=this.aY,C=V.m,l=I.m;return l[0]=m[0]-C[0],l[1]=m[1]-C[1],l[2]=m[2]-C[2],l[3]=m[3]-C[3],l[4]=m[4]-C[4],l[5]=m[5]-C[5],l[6]=m[6]-C[6],l[7]=m[7]-C[7],l[8]=m[8]-C[8],I}Fm(V){return this.subtractToRef(V,new s)}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<9;I++)V[I]=this.aY[I];return V}UF(){return this.toArray()}km(V){for(let I=0;I<9;I++)this.aY[I]=V[I];return this}transpose(){const V=this.aY;return new s([V[0],V[3],V[6],V[1],V[4],V[7],V[2],V[5],V[8]])}determinant(){const V=this.aY;return V[0]*(V[4]*V[8]-V[5]*V[7])-V[1]*(V[3]*V[8]-V[5]*V[6])+V[2]*(V[3]*V[7]-V[4]*V[6])}inverse(){const V=this.determinant();if(0===V)throw new Error("Matrix is not invertible");const I=this.aY,m=1/V;return new s([(I[4]*I[8]-I[5]*I[7])*m,(I[2]*I[7]-I[1]*I[8])*m,(I[1]*I[5]-I[2]*I[4])*m,(I[5]*I[6]-I[3]*I[8])*m,(I[0]*I[8]-I[2]*I[6])*m,(I[2]*I[3]-I[0]*I[5])*m,(I[3]*I[7]-I[4]*I[6])*m,(I[1]*I[6]-I[0]*I[7])*m,(I[0]*I[4]-I[1]*I[3])*m])}equals(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.aY,C=V.m;return 0===I?m[0]===C[0]&&m[1]===C[1]&&m[2]===C[2]&&m[3]===C[3]&&m[4]===C[4]&&m[5]===C[5]&&m[6]===C[6]&&m[7]===C[7]&&m[8]===C[8]:Math.abs(m[0]-C[0])<I&&Math.abs(m[1]-C[1])<I&&Math.abs(m[2]-C[2])<I&&Math.abs(m[3]-C[3])<I&&Math.abs(m[4]-C[4])<I&&Math.abs(m[5]-C[5])<I&&Math.abs(m[6]-C[6])<I&&Math.abs(m[7]-C[7])<I&&Math.abs(m[8]-C[8])<I}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.aY.join(", ")})`}}},12908:(V,I,m)=>{"use strict";var C;function l(V,I,m,C){switch(I){case"Animation":return C?V.animations.find((V=>V.uniqueId===m))??null:V.animations[m]??null;case"AnimationGroup":return C?V.animationGroups.find((V=>V.uniqueId===m))??null:V.animationGroups[m]??null;case"Mesh":return C?V.meshes.find((V=>V.uniqueId===m))??null:V.meshes[m]??null;case"Material":return C?V.materials.find((V=>V.uniqueId===m))??null:V.materials[m]??null;case"uE":return C?V.cameras.find((V=>V.uniqueId===m))??null:V.cameras[m]??null;case"Light":return C?V.lights.find((V=>V.uniqueId===m))??null:V.lights[m]??null;default:return null}}m.d(I,{e:()=>l}),function(V){V.Animation="Animation",V.AnimationGroup="AnimationGroup",V.Mesh="Mesh",V.Material="Material",V.uE="uE",V.Light="Light"}(C||(C={}))},12932:(V,I,m)=>{"use strict";m.d(I,{c:()=>l});var C=m(12934);class l extends C.d{constructor(V,I){if(super(V),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),I)for(const m of I)this._eventsSignalOutputs[m]=this._registerSignalOutput(m+"Event")}_executeOnTick(V){}_startPendingTasks(V){V._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(V),this._resetAfterCanceled(V)),this._preparePendingTasks(V),V._addPendingBlock(this),this.out._activateSignal(V),V._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(V){V._deleteExecutionVariable(this,"_initialized"),V._removePendingBlock(this)}}},12921:(V,I,m)=>{"use strict";m.d(I,{e:()=>E});var C=m(11188),l=m(11048),s=m(12923),F=m(11067),k=m(12893);class j extends s.b{constructor(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.defaultValue,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(V,I,m),this.richType=C,this._defaultValue=l,this._optional=s,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new F.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(V){this._isDisabled!==V&&(this._isDisabled=V,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(V,I){I._getConnectionValue(this)!==V&&(I._setConnectionValue(this,V),this.onValueChangedObservable.notifyObservers(V))}resetToDefaultValue(V){V._setConnectionValue(this,this._defaultValue)}connectTo(V){this._isDisabled||super.connectTo(V)}_getValueOrDefault(V){const I=V._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(I):I}getValue(V){if(1===this.connectionType){V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(V);const I=this._getValueOrDefault(V);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}const I=this.isConnected()?this._connectedPoint[0].getValue(V):this._getValueOrDefault(V);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.richType={},this.richType.serialize(V.richType),V.optional=this._optional,(0,k.f)("defaultValue",this._defaultValue,V)}}(0,l.h)("FlowGraphDataConnection",j);class E{constructor(V){var I;this.config=V,this.uniqueId=(0,C.d)(),this.name=(null===(I=this.config)||void 0===I?void 0:I.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(V){}registerDataInput(V,I,m){const C=new j(V,0,this,I,m);return this.dataInputs.push(C),C}registerDataOutput(V,I,m){const C=new j(V,1,this,I,m);return this.dataOutputs.push(C),C}getDataInput(V){return this.dataInputs.find((I=>I.name===V))}getDataOutput(V){return this.dataOutputs.find((I=>I.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.f;if(V.uniqueId=this.uniqueId,V.config={},this.config){const m=this.config,C=Object.keys(m);for(const l of C)I(l,m[l],V.config)}V.dataInputs=[],V.dataOutputs=[],V.className=this.getClassName();for(const m of this.dataInputs){const I={};m.serialize(I),V.dataInputs.push(I)}for(const m of this.dataOutputs){const I={};m.serialize(I),V.dataOutputs.push(I)}}deserialize(V){}_log(V,I,m){var C;null===(C=V.logger)||void 0===C||C.addLogItem({action:I,payload:m,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12923:(V,I,m)=>{"use strict";m.d(I,{b:()=>s});var C,l=m(11188);!function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(C||(C={}));class s{constructor(V,I,m){this._ownerBlock=m,this._connectedPoint=[],this.uniqueId=(0,l.d)(),this.connectedPointIds=[],this.name=V,this._connectionType=I}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(V){if(this._connectionType===V._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||V._isSingularConnection()&&V._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(V),V._connectedPoint.push(this)}disconnectFrom(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this._connectedPoint.indexOf(V),C=V._connectedPoint.indexOf(this);-1!==m&&-1!==C&&(I&&this._connectedPoint.splice(m,1),V._connectedPoint.splice(C,1))}disconnectFromAll(){for(const V of this._connectedPoint)this.disconnectFrom(V,!1);this._connectedPoint.length=0}dispose(){for(const V of this._connectedPoint)this.disconnectFrom(V)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.name=this.name,V._connectionType=this._connectionType,V.connectedPointIds=[],V.className=this.getClassName();for(const I of this._connectedPoint)V.connectedPointIds.push(I.uniqueId)}getClassName(){return"FGConnection"}deserialize(V){this.uniqueId=V.uniqueId,this.name=V.name,this._connectionType=V._connectionType,this.connectedPointIds=V.connectedPointIds}}},12891:(V,I,m)=>{"use strict";m.d(I,{c:()=>T});var C,l=m(11067),s=m(11206),F=m(11214),k=m(11188),j=m(12893),E=m(12908),K=m(11085);!function(V){V.ExecuteBlock="ExecuteBlock",V.ExecuteEvent="ExecuteEvent",V.TriggerConnection="TriggerConnection",V.ContextVariableSet="ContextVariableSet",V.GlobalVariableSet="GlobalVariableSet",V.GlobalVariableDelete="GlobalVariableDelete",V.GlobalVariableGet="GlobalVariableGet",V.AddConnection="AddConnection",V.GetConnectionValue="GetConnectionValue",V.SetConnectionValue="SetConnectionValue",V.ActivateSignal="ActivateSignal",V.ContextVariableGet="ContextVariableGet"}(C||(C={}));class Y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(V){if(V.time||(V.time=Date.now()),this.log.push(V),this.logToConsole){var I;const m=null===(I=V.payload)||void 0===I?void 0:I.value;"object"===typeof m&&m.getClassName?K.d.Log(`[FGLog] ${V.className}:${V.uniqueId.split("-")[0]} ${V.action} - ${JSON.stringify(m.getClassName())}: ${m.toString()}`):K.d.Log(`[FGLog] ${V.className}:${V.uniqueId.split("-")[0]} ${V.action} - ${JSON.stringify(V.payload)}`)}}getItemsOfType(V){return this.log.filter((I=>I.action===V))}}class X{get enableLogging(){return this._enableLogging}set enableLogging(V){this._enableLogging!==V&&(this._enableLogging=V,this._enableLogging?(this.logger=new Y,this.logger.logToConsole=!0):this.logger=null)}constructor(V){this.uniqueId=(0,k.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new l.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=V,this.assetsContext=V.assetsContext??V.OI}hasVariable(V){return V in this._userVariables}setVariable(V,I){var m;this._userVariables[V]=I,null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:V,value:I}})}getAsset(V,I){return(0,E.e)(this.assetsContext,V,I)}getVariable(V){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:V,value:this._userVariables[V]}}),this._userVariables[V]}get userVariables(){return this._userVariables}cV(){return this._configuration.OI}_getUniqueIdPrefixedName(V,I){return`${V.uniqueId}_${I}`}_getGlobalContextVariable(V,I){var m;return null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:V,defaultValue:I,possibleValue:this._globalContextVariables[V]}}),this._hasGlobalContextVariable(V)?this._globalContextVariables[V]:I}_setGlobalContextVariable(V,I){var m;null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:V,value:I}}),this._globalContextVariables[V]=I}_deleteGlobalContextVariable(V){var I;null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:V}}),delete this._globalContextVariables[V]}_hasGlobalContextVariable(V){return V in this._globalContextVariables}_setExecutionVariable(V,I,m){this._executionVariables[this._getUniqueIdPrefixedName(V,I)]=m}_getExecutionVariable(V,I,m){return this._hasExecutionVariable(V,I)?this._executionVariables[this._getUniqueIdPrefixedName(V,I)]:m}_deleteExecutionVariable(V,I){delete this._executionVariables[this._getUniqueIdPrefixedName(V,I)]}_hasExecutionVariable(V,I){return this._getUniqueIdPrefixedName(V,I)in this._executionVariables}_hasConnectionValue(V){return V.uniqueId in this._connectionValues}_setConnectionValue(V,I){var m;this._connectionValues[V.uniqueId]=I,null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:V.uniqueId,value:I}})}_setConnectionValueByKey(V,I){this._connectionValues[V]=I}_getConnectionValue(V){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:V.uniqueId,value:this._connectionValues[V.uniqueId]}}),this._connectionValues[V.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(V){this._pendingBlocks.includes(V)||(this._pendingBlocks.push(V),this._pendingBlocks.sort(((V,I)=>V.priority-I.priority)))}_removePendingBlock(V){const I=this._pendingBlocks.indexOf(V);-1!==I&&this._pendingBlocks.splice(I,1)}_clearPendingBlocks(){for(const V of this._pendingBlocks)V._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(V){var I;this.onNodeExecutedObservable.notifyObservers(V),null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:V.getClassName(),uniqueId:V.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(V){this._setGlobalContextVariable("timeSinceStart",V.timeSinceStart),this._setGlobalContextVariable("deltaTime",V.deltaTime);for(const m of this._pendingBlocks){var I;null===(I=m._executeOnTick)||void 0===I||I.call(m,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.f;V.uniqueId=this.uniqueId,V._userVariables={};for(const C in this._userVariables)I(C,this._userVariables[C],V._userVariables);V._connectionValues={};for(const C in this._connectionValues)I(C,this._connectionValues[C],V._connectionValues);var m;this.assetsContext!==this.cV()&&(V._assetsContext={meshes:this.assetsContext.meshes.map((V=>V.id)),materials:this.assetsContext.materials.map((V=>V.id)),textures:this.assetsContext.textures.map((V=>V.name)),animations:this.assetsContext.animations.map((V=>V.name)),lights:this.assetsContext.lights.map((V=>V.id)),cameras:this.assetsContext.cameras.map((V=>V.id)),KX:null===(m=this.assetsContext.KX)||void 0===m?void 0:m.map((V=>V.name)),skeletons:this.assetsContext.skeletons.map((V=>V.id)),ZY:this.assetsContext.ZY.map((V=>V.name)),geometries:this.assetsContext.geometries.map((V=>V.id)),multiMaterials:this.assetsContext.multiMaterials.map((V=>V.id)),transformNodes:this.assetsContext.transformNodes.map((V=>V.id))})}getClassName(){return"FlowGraphContext"}}(0,s.d)([(0,F.B)()],X.prototype,"uniqueId",void 0);var O=m(12914),v=m(11616);class N{constructor(V){this.onEventTriggeredObservable=new l.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=V,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ck.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const V=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:V}}),this._startingTime+=V})),this._meshPickedObserver=this._scene.onPointerObservable.add((V=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:V})}),v.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((V=>{const I=V.pointerId,m=V.mesh,C=this._pointerUnderMeshState[I];!C&&m?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:I,mesh:m}}):C&&!m?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:I,mesh:C}}):C&&m&&C!==m&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:I,mesh:C,over:m}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:I,mesh:m,out:C}})),this._pointerUnderMeshState[I]=m}),v.c.POINTERMOVE)}dispose(){var V,I,m,C,l;null===(V=this._sceneDisposeObserver)||void 0===V||V.remove(),null===(I=this._sceneReadyObserver)||void 0===I||I.remove(),null===(m=this._sceneOnBeforeRenderObserver)||void 0===m||m.remove(),null===(C=this._meshPickedObserver)||void 0===C||C.remove(),null===(l=this._meshUnderPointerObserver)||void 0===l||l.remove(),this.onEventTriggeredObservable.clear()}}var t,D=m(12926);!function(V){V[V.Stopped=0]="Stopped",V[V.Started=1]="Started"}(t||(t={}));class b{get state(){return this._state}set state(V){this._state=V,this.onStateChangedObservable.notifyObservers(V)}constructor(V){this.onStateChangedObservable=new l.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=V.OI,this._sceneEventCoordinator=new N(this._scene),this._coordinator=V.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((V=>{for(const I of this._executionContexts){const m=this._getContextualOrder(V.type,I);for(const C of m)if(!C._executeEvent(I,V.payload))break}switch(V.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const I of this._executionContexts)I._notifyOnTick(V.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const V=new X({OI:this._scene,coordinator:this._coordinator});return this._executionContexts.push(V),V}getContext(V){return this._executionContexts[V]}addEventBlock(V){if("PointerOver"!==V.type&&"PointerOut"!==V.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==V.type&&this._eventBlocks[V.type].push(V),1===this.state)for(const I of this._executionContexts)V._startPendingTasks(I);else this.onStateChangedObservable.addOnce((I=>{if(1===I)for(const m of this._executionContexts)V._startPendingTasks(m)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((V=>{1===V&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const V of this._executionContexts)for(const I in this._eventBlocks){const m=this._getContextualOrder(I,V);for(const I of m)I._startPendingTasks(V)}}_getContextualOrder(V,I){const m=this._eventBlocks[V].sort(((V,I)=>I.initPriority-V.initPriority));if("MeshPick"===V){const V=[];for(const C of m){const l=C.asset.getValue(I);let s=0;for(;s<m.length;s++){const V=m[s].asset.getValue(I);if(l&&V&&(0,D.i)(l,V))break}V.splice(s,0,C)}return V}return m}dispose(){var V;if(0!==this.state){this.state=0;for(const V of this._executionContexts)V._clearPendingBlocks();this._executionContexts.length=0;for(const V in this._eventBlocks)this._eventBlocks[V].length=0;null===(V=this._eventObserver)||void 0===V||V.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(V){const I=[],m=new Set;for(const C in this._eventBlocks)for(const V of this._eventBlocks[C])I.push(V),m.add(V.uniqueId);for(;I.length>0;){const C=I.pop();V(C);for(const V of C.dataInputs)for(const C of V._connectedPoint)m.has(C._ownerBlock.uniqueId)||(I.push(C._ownerBlock),m.add(C._ownerBlock.uniqueId));if(C instanceof O.b)for(const V of C.signalOutputs)for(const C of V._connectedPoint)m.has(C._ownerBlock.uniqueId)||(I.push(C._ownerBlock),m.add(C._ownerBlock.uniqueId))}}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1?arguments[1]:void 0;V.allBlocks=[],this.visitAllBlocks((I=>{const m={};I.serialize(m),V.allBlocks.push(m)})),V.executionContexts=[];for(const m of this._executionContexts){const C={};m.serialize(C,I),V.executionContexts.push(C)}}}class T{constructor(V){this.config=V,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.OI.Ck.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.OI.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const V=this._executeOnNextFrame.slice(0);if(V.length)for(const I of V){this.notifyCustomEvent(I.id,I.data,!1);const V=this._executeOnNextFrame.findIndex((V=>V.uniqueId===I.uniqueId));-1!==V&&this._executeOnNextFrame.splice(V,1)}}));(T.SceneCoordinators.get(this.config.OI)??[]).push(this)}createGraph(){const V=new b({OI:this.config.OI,coordinator:this});return this._flowGraphs.push(V),V}removeGraph(V){const I=this._flowGraphs.indexOf(V);-1!==I&&(V.dispose(),this._flowGraphs.splice(I,1))}start(){for(const V of this._flowGraphs)V.start()}dispose(){var V,I;for(const l of this._flowGraphs)l.dispose();this._flowGraphs.length=0,null===(V=this._disposeObserver)||void 0===V||V.remove(),null===(I=this._onBeforeRenderObserver)||void 0===I||I.remove();const m=T.SceneCoordinators.get(this.config.OI)??[],C=m.indexOf(this);-1!==C&&m.splice(C,1)}serialize(V,I){V._flowGraphs=[];for(const m of this._flowGraphs){const C={};m.serialize(C,I),V._flowGraphs.push(C)}V.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(V){let I=this._customEventsMap.get(V);return I||(I=new l.e,this._customEventsMap.set(V,I)),I}notifyCustomEvent(V,I){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:V,data:I,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(V)){const I=this._eventExecutionCounter.get(V);if(this._eventExecutionCounter.set(V,I+1),I>=T.MaxEventTypeExecutionPerFrame)return void(I===T.MaxEventTypeExecutionPerFrame&&K.d.Warn(`FlowGraphCoordinator: Too many executions of event "${V}".`))}else this._eventExecutionCounter.set(V,1);const m=this._customEventsMap.get(V);m&&m.notifyObservers(I)}}T.MaxEventsPerType=30,T.MaxEventTypeExecutionPerFrame=30,T.SceneCoordinators=new Map},12930:(V,I,m)=>{"use strict";m.d(I,{b:()=>l});var C=m(12932);class l extends C.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(V){V._notifyExecuteNode(this),this.done._activateSignal(V)}}},12914:(V,I,m)=>{"use strict";m.d(I,{b:()=>k});var C=m(12921),l=m(12923),s=m(11048);class F extends l.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(V){super.connectTo(V),this._connectedPoint.sort(((V,I)=>I.priority-V.priority))}_activateSignal(V){var I;if(null===(I=V.logger)||void 0===I||I.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(V,this),V._increaseExecutionId();else for(const m of this._connectedPoint)m._activateSignal(V)}}(0,s.h)("FlowGraphSignalConnection",F);class k extends C.e{constructor(V){super(V),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(V){const I=new F(V,0,this);return this.signalInputs.push(I),I}_registerSignalOutput(V){const I=new F(V,1,this);return this.signalOutputs.push(I),I}_unregisterSignalInput(V){const I=this.signalInputs.findIndex((I=>I.name===V));-1!==I&&(this.signalInputs[I].dispose(),this.signalInputs.splice(I,1))}_unregisterSignalOutput(V){const I=this.signalOutputs.findIndex((I=>I.name===V));-1!==I&&(this.signalOutputs[I].dispose(),this.signalOutputs.splice(I,1))}_reportError(V,I){this.error.payload="string"===typeof I?new Error(I):I,this.error._activateSignal(V)}getSignalInput(V){return this.signalInputs.find((I=>I.name===V))}getSignalOutput(V){return this.signalOutputs.find((I=>I.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.signalInputs=[],V.signalOutputs=[];for(const I of this.signalInputs){const m={};I.serialize(m),V.signalInputs.push(m)}for(const I of this.signalOutputs){const m={};I.serialize(m),V.signalOutputs.push(m)}}deserialize(V){for(let I=0;I<V.signalInputs.length;I++){const m=this.getSignalInput(V.signalInputs[I].name);if(!m)throw new Error("Could not find signal input with name "+V.signalInputs[I].name+" in block "+V.className);m.deserialize(V.signalInputs[I])}for(let I=0;I<V.signalOutputs.length;I++){const m=this.getSignalOutput(V.signalOutputs[I].name);if(!m)throw new Error("Could not find signal output with name "+V.signalOutputs[I].name+" in block "+V.className);m.deserialize(V.signalOutputs[I])}}getClassName(){return"FlowGraphExecutionBlock"}}},12934:(V,I,m)=>{"use strict";m.d(I,{d:()=>l});var C=m(12914);class l extends C.b{constructor(V){super(V),this.out=this._registerSignalOutput("out")}}},12899:(V,I,m)=>{"use strict";m.d(I,{B:()=>v,C:()=>N,F:()=>y,G:()=>z,I:()=>H,M:()=>c,b:()=>E,d:()=>X,h:()=>S,j:()=>t,m:()=>D,p:()=>b,r:()=>Y,s:()=>x,t:()=>K,x:()=>O});var C,l=m(11040),s=m(11312),F=m(12896),k=m(12901);!function(V){V.Any="any",V.String="string",V.Number="number",V.Boolean="boolean",V.Object="object",V.Integer="FlowGraphInteger",V.Vector2="Vector2",V.LF="LF",V.Vector4="Vector4",V.Quaternion="Quaternion",V.Matrix="Matrix",V.Matrix2D="Matrix2D",V.Matrix3D="Matrix3D",V.dY="dY",V.dX="dX"}(C||(C={}));class j{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=V,this.defaultValue=I,this.animationType=m}serialize(V){V.typeName=this.typeName,V.defaultValue=this.defaultValue}}const E=new j("any",void 0),K=new j("string",""),Y=new j("number",0,0),X=new j("boolean",!1),O=new j("Vector2",l.k.Zero(),5),v=new j("LF",l.m.Zero(),1),N=new j("Vector4",l.n.Zero()),t=new j("Matrix",l.b.Identity(),3),D=new j("Matrix2D",new k.d),b=new j("Matrix3D",new k.f),T=new j("dY",s.c.Black(),4),n=new j("dX",new s.d(0,0,0,0),7),x=new j("Quaternion",l.e.Identity(),2);x.typeTransformer=V=>{if(V.getClassName){if("Vector4"===V.getClassName())return l.e.Ik(V.UF());if("LF"===V.getClassName())return l.e.FromEulerVector(V);if("Matrix"===V.getClassName())return l.e.FromRotationMatrix(V)}return V};const S=new j("FlowGraphInteger",new F.b(0),0);function c(V){const I=V;switch(typeof V){case"string":return K;case"number":return Y;case"boolean":return X;case"object":if(I.getClassName)switch(I.getClassName()){case"Vector2":return O;case"LF":return v;case"Vector4":return N;case"Matrix":return t;case"dY":return T;case"dX":return n;case"Quaternion":return x;case"FlowGraphInteger":return S;case"Matrix2D":return D;case"Matrix3D":return b}return E;default:return E}}function H(V){switch(V){case"string":return K;case"number":return Y;case"boolean":return X;case"Vector2":return O;case"LF":return v;case"Vector4":return N;case"Matrix":return t;case"dY":return T;case"dX":return n;case"Quaternion":return x;case"FlowGraphInteger":return S;case"Matrix2D":return D;case"Matrix3D":return b;default:return E}}function y(V){switch(V){case"number":default:return 0;case"Vector2":return 5;case"LF":return 1;case"Matrix":return 3;case"dY":return 4;case"dX":return 7;case"Quaternion":return 2}}function z(V){switch(V){case 0:return Y;case 5:return O;case 1:return v;case 3:return t;case 4:return T;case 7:return n;case 2:return x;default:return E}}},12893:(V,I,m)=>{"use strict";m.d(I,{e:()=>K,f:()=>E,j:()=>Y});var C=m(11312),l=m(11040),s=m(12896),F=m(12899),k=m(12901);function j(V){return"Vector2"===V||"LF"===V||"Vector4"===V||"Quaternion"===V||"dY"===V||"dX"===V}function E(V,I,m){var C;const l=(null===I||void 0===I||null===(C=I.getClassName)||void 0===C?void 0:C.call(I))??"";if(j(l)||function(V){return"Matrix"===V||"Matrix2D"===V||"Matrix3D"===V}(l))m[V]={value:I.UF(),className:l};else if("FlowGraphInteger"===l)m[V]={value:I.value,className:l};else if(l&&(I.id||I.name))m[V]={id:I.id,name:I.name,className:l};else{if("object"===typeof I)throw new Error(`Could not serialize value ${I}`);m[V]=I}}function K(V,I,m,E){const Y=I[V];let X;const O=(null===Y||void 0===Y?void 0:Y.type)??(null===Y||void 0===Y?void 0:Y.className);if(function(V){return"Mesh"===V||"AbstractMesh"===V||"GroundMesh"===V||"InstanceMesh"===V||"LinesMesh"===V||"GoldbergMesh"===V||"GreasedLineMesh"===V||"TrailMesh"===V}(O)){let V=E.meshes.filter((V=>Y.id?V.id===Y.id:V.name===Y.name));0===V.length&&(V=E.transformNodes.filter((V=>Y.id?V.id===Y.id:V.name===Y.name))),X=Y.uniqueId?V.find((V=>V.uniqueId===Y.uniqueId)):V[0]}else if(j(O))X=function(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===V)return l.k.Ik(I);if("LF"===V)return m&&(I[2]*=-1),l.m.Ik(I);if("Vector4"===V)return l.n.Ik(I);if("Quaternion"===V)return m&&(I[2]*=-1,I[3]*=-1),l.e.Ik(I);if("dY"===V)return new C.c(I[0],I[1],I[2]);if("dX"===V)return new C.d(I[0],I[1],I[2],I[3]);throw new Error(`Unknown vector class name ${V}`)}(O,Y.value);else if(function(V){return"AnimationGroup"===V}(O)){const V=E.animationGroups.filter((V=>V.name===Y.name));X=1===V.length?V[0]:V.find((V=>V.uniqueId===Y.uniqueId))}else X="Matrix"===O?l.b.Ik(Y.value):"Matrix2D"===O?new k.d(Y.value):"Matrix3D"===O?new k.f(Y.value):"FlowGraphInteger"===O?s.b.FromValue(Y.value):"number"===O||"string"===O||"boolean"===O?Y.value[0]:Y&&void 0!==Y.value?Y.value:Array.isArray(Y)?Y.reduce(((V,I)=>I.eventData?(V[I.id]={type:(0,F.I)(I.type)},"undefined"!==typeof I.value&&(V[I.id].value=K("value",I,m,E)),V):V),{}):Y;return X}function Y(V){return"FlowGraphJsonPointerParserBlock"===V}},12926:(V,I,m)=>{"use strict";function C(V,I){return!(!V.parent||V.parent!==I&&!C(V.parent,I))}function l(V){if(V.getClassName)return V.getClassName()}function s(V,I){return V===I&&("Vector2"===V||"LF"===V||"Vector4"===V||"Quaternion"===V)}function F(V,I){return V===I&&("Matrix"===V||"Matrix2D"===V||"Matrix3D"===V)}function k(V,I){return"FlowGraphInteger"===V&&"FlowGraphInteger"===I}function j(V,I){const m="number"===typeof V||"number"===typeof(null===V||void 0===V?void 0:V.value);return m&&!I?!isNaN(E(V)):m}function E(V){return"number"===typeof V?V:V.value}m.d(I,{d:()=>k,f:()=>F,g:()=>s,h:()=>l,i:()=>C,l:()=>E,p:()=>j})},12269:(V,I,m)=>{"use strict";m.r(I),m.d(I,{SceneInstrumentation:()=>s});var C=m(11076),l=m(11510);class s{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(V){V!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=V,V?(this._onBeforeActiveMeshesEvaluationObserver=this.OI.onBeforeActiveMeshesEvaluationObservable.add((()=>{C.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.OI.onAfterActiveMeshesEvaluationObservable.add((()=>{C.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.OI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.OI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(V){V!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=V,V?(this._onBeforeRenderTargetsRenderObserver=this.OI.onBeforeRenderTargetsRenderObservable.add((()=>{C.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.OI.onAfterRenderTargetsRenderObservable.add((()=>{C.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.OI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.OI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(V){V!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=V,V?(this._onBeforeParticlesRenderingObserver=this.OI.onBeforeParticlesRenderingObservable.add((()=>{C.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.OI.onAfterParticlesRenderingObservable.add((()=>{C.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.OI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.OI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(V){V!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=V,this.OI.spriteManagers&&(V?(this._onBeforeSpritesRenderingObserver=this.OI.onBeforeSpritesRenderingObservable.add((()=>{C.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.OI.onAfterSpritesRenderingObservable.add((()=>{C.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.OI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.OI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(V){V!==this._capturePhysicsTime&&this.OI.onBeforePhysicsObservable&&(this._capturePhysicsTime=V,V?(this._onBeforePhysicsObserver=this.OI.onBeforePhysicsObservable.add((()=>{C.d.StartPerformanceCounter("zv"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.OI.onAfterPhysicsObservable.add((()=>{C.d.EndPerformanceCounter("zv"),this._physicsTime.endMonitoring()}))):(this.OI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.OI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(V){V!==this._captureAnimationsTime&&(this._captureAnimationsTime=V,V?this._onAfterAnimationsObserver=this.OI.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.OI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(V){this._captureFrameTime=V}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(V){this._captureInterFrameTime=V}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(V){V!==this._captureRenderTime&&(this._captureRenderTime=V,V?(this._onBeforeDrawPhaseObserver=this.OI.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),C.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.OI.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),C.d.EndPerformanceCounter("Main render")}))):(this.OI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.OI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(V){V!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=V,V?(this._onBeforeCameraRenderObserver=this.OI.onBeforeCameraRenderObservable.add((V=>{this._cameraRenderTime.beginMonitoring(),C.d.StartPerformanceCounter(`Rendering camera ${V.name}`)})),this._onAfterCameraRenderObserver=this.OI.onAfterCameraRenderObservable.add((V=>{this._cameraRenderTime.endMonitoring(!1),C.d.EndPerformanceCounter(`Rendering camera ${V.name}`)}))):(this.OI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.OI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.OI.getEngine()._drawCalls}constructor(V){this.OI=V,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new l.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new l.e,this._captureFrameTime=!1,this._frameTime=new l.e,this._captureRenderTime=!1,this._renderTime=new l.e,this._captureInterFrameTime=!1,this._interFrameTime=new l.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new l.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new l.e,this._capturePhysicsTime=!1,this._physicsTime=new l.e,this._captureAnimationsTime=!1,this._animationsTime=new l.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new l.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=V.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(C.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.OI.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=V.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(C.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.bY(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.bY(),this._captureParticlesRenderTime&&this._particlesRenderTime.bY(),this._captureSpritesRenderTime&&this._spritesRenderTime.bY(),this._captureRenderTime&&this._renderTime.bY(),this._captureCameraRenderTime&&this._cameraRenderTime.bY()}))}dispose(){this._disposed||(this.OI.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.OI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.OI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.OI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.OI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.OI.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.OI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.OI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.OI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.OI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.OI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.OI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.OI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.OI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.OI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.OI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.OI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.OI=null,this._disposed=!0)}}},12887:(V,I,m)=>{"use strict";m.d(I,{e:()=>K});var C=m(11206),l=m(11214),s=m(11040),F=m(11337),k=m(11708),j=m(11776),E=m(11048);F.c.AddNodeConstructor("Light_Type_1",((V,I)=>()=>new K(V,s.m.Zero(),I)));class K extends j.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(V){this._shadowFrustumSize=V,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(V){this._shadowOrthoScale=V,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(V){this._orthoLeft=V}get orthoRight(){return this._orthoRight}set orthoRight(V){this._orthoRight=V}get orthoTop(){return this._orthoTop}set orthoTop(V){this._orthoTop=V}get orthoBottom(){return this._orthoBottom}set orthoBottom(V){this._orthoBottom=V}constructor(V,I,m){super(V,m),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=I.scale(-1),this.direction=I}getClassName(){return"Zv"}getTypeID(){return k.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(V,I,m){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(V):this._setDefaultAutoExtendShadowProjectionMatrix(V,I,m)}_setDefaultFixedFrustumShadowProjectionMatrix(V){const I=this.cV().activeCamera;I&&s.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:I.Fk,void 0!==this.shadowMaxZ?this.shadowMaxZ:I.maxZ,V,this.cV().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(V,I,m){const C=this.cV().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const V=s.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let C=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let F=0;F<m.length;F++){const k=m[F];if(!k)continue;const j=k.getBoundingInfo().boundingBox;for(let m=0;m<j.vectorsWorld.length;m++)s.m.TransformCoordinatesToRef(j.vectorsWorld[m],I,V),V.x<this._orthoLeft&&(this._orthoLeft=V.x),V.y<this._orthoBottom&&(this._orthoBottom=V.y),V.x>this._orthoRight&&(this._orthoRight=V.x),V.y>this._orthoTop&&(this._orthoTop=V.y),this.autoCalcShadowZBounds&&(V.z<C&&(C=V.z),V.z>l&&(l=V.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=C,this._shadowMaxZ=l)}const l=this._orthoRight-this._orthoLeft,F=this._orthoTop-this._orthoBottom,k=void 0!==this.shadowMinZ?this.shadowMinZ:(null===C||void 0===C?void 0:C.Fk)||0,j=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===C||void 0===C?void 0:C.maxZ)||1e4,E=this.cV().getEngine().useReverseDepthBuffer;s.b.OrthoOffCenterLHToRef(this._orthoLeft-l*this.shadowOrthoScale,this._orthoRight+l*this.shadowOrthoScale,this._orthoBottom-F*this.shadowOrthoScale,this._orthoTop+F*this.shadowOrthoScale,E?j:k,E?k:j,V,this.cV().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,I){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,I),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,I),this)}transferToNodeMaterialEffect(V,I){return this.computeTransformedInformation()?(V.setFloat3(I,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(V.setFloat3(I,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(V){const I=this._scene.getEngine();return!I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:1}getDepthMaxZ(V){const I=this._scene.getEngine();return I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:1}prepareLightSpecificDefines(V,I){V["DIRLIGHT"+I]=!0}}(0,C.d)([(0,l.B)()],K.prototype,"shadowFrustumSize",null),(0,C.d)([(0,l.B)()],K.prototype,"shadowOrthoScale",null),(0,C.d)([(0,l.B)()],K.prototype,"autoUpdateExtends",void 0),(0,C.d)([(0,l.B)()],K.prototype,"autoCalcShadowZBounds",void 0),(0,C.d)([(0,l.B)("orthoLeft")],K.prototype,"_orthoLeft",void 0),(0,C.d)([(0,l.B)("orthoRight")],K.prototype,"_orthoRight",void 0),(0,C.d)([(0,l.B)("orthoTop")],K.prototype,"_orthoTop",void 0),(0,C.d)([(0,l.B)("orthoBottom")],K.prototype,"_orthoBottom",void 0),(0,E.h)("BABYLON.DirectionalLight",K)},13367:(V,I,m)=>{"use strict";m.d(I,{c:()=>K});var C=m(11206),l=m(11214),s=m(11040),F=m(11312),k=m(11337),j=m(11708),E=m(11048);k.c.AddNodeConstructor("Light_Type_3",((V,I)=>()=>new K(V,s.m.Zero(),I)));class K extends j.d{constructor(V,I,m){super(V,m),this.groundColor=new F.c(0,0,0),this.direction=I||s.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Bv"}setDirectionToTarget(V){return this.direction=s.m.Normalize(V.Fm(s.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(V,I){const m=s.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",m.x,m.y,m.z,0,I),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Kk),I),this}transferToNodeMaterialEffect(V,I){const m=s.m.Normalize(this.direction);return V.setFloat3(I,m.x,m.y,m.z),this}fF(){return this._worldMatrix||(this._worldMatrix=s.b.Identity()),this._worldMatrix}getTypeID(){return j.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(V,I){V["HEMILIGHT"+I]=!0}}(0,C.d)([(0,l.e)()],K.prototype,"groundColor",void 0),(0,C.d)([(0,l.x)()],K.prototype,"direction",void 0),(0,E.h)("BABYLON.HemisphericLight",K)},12848:(V,I,m)=>{"use strict";m.d(I,{c:()=>Y});var C=m(11206),l=m(11214),s=m(11040),F=m(11337),k=m(11708),j=m(11776),E=m(11518),K=m(11048);F.c.AddNodeConstructor("Light_Type_2",((V,I)=>()=>new Y(V,s.m.Zero(),s.m.Zero(),0,0,I)));class Y extends j.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(V){this._iesProfileTexture!==V&&(this._iesProfileTexture=V,this._iesProfileTexture&&Y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(V){this._angle=V,this._cosHalfAngle=Math.cos(.5*V),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(V){this._innerAngle=V,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(V){this._shadowAngleScale=V,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(V){this._projectionTextureLightNear=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(V){this._projectionTextureLightFar=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(V){this._projectionTextureUpDirection=V,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(V){this._projectionTexture!==V&&(this._projectionTexture=V,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(V){return void 0!==V.onGeneratedObservable}static _IsTexture(V){return void 0!==V.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(V){this._projectionTextureProjectionLightMatrix=V,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(V,I,m,C,l,F){super(V,F),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=s.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=s.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=s.m.Zero(),this._projectionTextureViewLightMatrix=s.b.Zero(),this._projectionTextureProjectionLightMatrix=s.b.Zero(),this._projectionTextureScalingMatrix=s.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=I,this.direction=m,this.angle=C,this.exponent=l}getClassName(){return"SpotLight"}getTypeID(){return k.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(V){super._setDirection(V),this._projectionTextureViewLightDirty=!0}_setPosition(V){super._setPosition(V),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(V,I,m){const C=this.cV().activeCamera;if(!C)return;this._shadowAngleScale=this._shadowAngleScale||1;const l=this._shadowAngleScale*this._angle,F=void 0!==this.shadowMinZ?this.shadowMinZ:C.Fk,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,j=this.cV().getEngine().useReverseDepthBuffer;s.b.PerspectiveFovLHToRef(l,1,j?k:F,j?F:k,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,j)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),s.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const V=this.projectionTextureLightFar,I=this.projectionTextureLightNear,m=V/(V-I),C=-m*I,l=1/Math.tan(this._angle/2);s.b.FromValuesToRef(l/1,0,0,0,0,l,0,0,0,0,m,1,0,0,C,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof E.e){const V=this._projectionTexture.uScale/2,I=this._projectionTexture.vScale/2;s.b.FromValuesToRef(V,0,0,0,0,I,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(V,I){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),V.setMatrix("textureProjectionMatrix"+I,this._projectionTextureMatrix),V.setTexture("projectionLightTexture"+I,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&V.setTexture("iesLightTexture"+I,this._iesProfileTexture),this}transferToEffect(V,I){let m;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,I),m=s.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,I),m=s.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",m.x,m.y,m.z,this._cosHalfAngle,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,I),this}transferToNodeMaterialEffect(V,I){let m;return m=this.computeTransformedInformation()?s.m.Normalize(this.transformedDirection):s.m.Normalize(this.direction),this.cV().useRightHandedSystem?V.setFloat3(I,-m.x,-m.y,-m.z):V.setFloat3(I,m.x,m.y,m.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(V){const I=this._scene.getEngine(),m=void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.Fk)??0;return I.useReverseDepthBuffer&&I.isNDCHalfZRange?m:this._scene.getEngine().isNDCHalfZRange?0:m}getDepthMaxZ(V){const I=this._scene.getEngine(),m=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)??1e4;return I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:m}prepareLightSpecificDefines(V,I){V["SPOTLIGHT"+I]=!0,V["PROJECTEDLIGHTTEXTURE"+I]=!(!this.projectionTexture||!this.projectionTexture.isReady()),V["IESLIGHTTEXTURE"+I]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,C.d)([(0,l.B)()],Y.prototype,"angle",null),(0,C.d)([(0,l.B)()],Y.prototype,"innerAngle",null),(0,C.d)([(0,l.B)()],Y.prototype,"shadowAngleScale",null),(0,C.d)([(0,l.B)()],Y.prototype,"exponent",void 0),(0,C.d)([(0,l.B)()],Y.prototype,"projectionTextureLightNear",null),(0,C.d)([(0,l.B)()],Y.prototype,"projectionTextureLightFar",null),(0,C.d)([(0,l.B)()],Y.prototype,"projectionTextureUpDirection",null),(0,C.d)([(0,l.s)("projectedLightTexture")],Y.prototype,"_projectionTexture",void 0),(0,K.h)("BABYLON.SpotLight",Y)},12555:(V,I,m)=>{"use strict";m.d(I,{b:()=>F,e:()=>s,i:()=>k});const C={},l={};function s(V,I){C[V]=I}function F(V,I){l[V]=I}function k(V){return l[V]?l[V]:null}},12443:(V,I,m)=>{"use strict";m.d(I,{c:()=>c,g:()=>h});var C,l=m(11076),s=m(11067),F=m(11596),k=m(11061),j=m(11085),E=m(11409),K=m(11102),Y=m(11111),X=m(11188),O=m(11136),v=m(11099);!function(V){V[V.Clean=0]="Clean",V[V.Stop=1]="Stop",V[V.Sync=2]="Sync",V[V.NoSync=3]="NoSync"}(C||(C={}));const N=new s.e,t={};let D=!1;function b(){return t[".babylon"]}function T(V,I){const m=t[V];return m||(j.d.Warn("Unable to find a plugin to load "+V+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),I?b():void 0)}function n(V,I,m){let C="Unable to load from "+(V.rawData?"binary data":V.url);return I?C+=`: ${I}`:m&&(C+=`: ${m}`),C}async function x(V,I,m,C,l,s,F,k,j){var E;const Y="data:"===(X=V.url).substring(0,5)?X.substring(5):null;var X;if(V.rawData&&!F)throw"When using ArrayBufferView to load data the file extension must be provided.";const D=Y||F?"":function(V){const I=V.indexOf("?");-1!==I&&(V=V.substring(0,I));const m=V.lastIndexOf(".");return V.substring(m,V.length).toLowerCase()}(V.url);let n=F?T(F,!0):Y?function(V){for(const I in t){const m=t[I].plugin;if(m.canDirectLoad&&m.canDirectLoad(V))return t[I]}return b()}(V.url):T(D,!1);if(!n&&D){if(V.url&&!V.url.startsWith("blob:")){const I=await async function(V,I){const m=I.method||"GET";return await new Promise(((C,l)=>{const s=new v.c;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const V={};if(I.responseHeaders)for(const m of I.responseHeaders)V[m]=s.getResponseHeader(m)||"";C({response:s.response,headerValues:V})}else l(`Unable to fetch data from ${V}. Error code: ${s.status}`)})),s.open(m,V),s.send()}))}(V.url,{method:"HEAD",responseHeaders:["Content-Type"]}),m=I.headerValues?I.headerValues["Content-Type"]:"";m&&(n=function(V){for(const I in t){const m=t[I];if(m.mimeType===V)return m}}(m))}n||(n=b())}if(!n)throw new Error(`No plugin or fallback for ${F??V.url}`);if(!1===(null===j||void 0===j||null===(E=j[n.plugin.name])||void 0===E?void 0:E.enabled))throw new Error(`The '${n.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(V.rawData&&!n.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(V=>{if(n.plugin.createPlugin){const I=n.plugin.createPlugin(j??{});return I instanceof Promise?(I.then(V).catch((V=>{l("Error instantiating plugin.",V)})),null):(V(I),I)}return V(n.plugin),n.plugin})((j=>{var E;if(!j)throw`The loader plugin corresponding to the '${F}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(N.notifyObservers(j),Y&&(j.canDirectLoad&&j.canDirectLoad(V.url)||!(0,K.l)(V.url))){if(j.directLoad){const V=j.directLoad(I,Y);V instanceof Promise?V.then((V=>{m(j,V)})).catch((V=>{l("Error in directLoad of _loadData: "+V,V)})):m(j,V)}else m(j,Y);return}const X=n.isBinary,v=(V,C)=>{I.K?l("Scene has been disposed"):m(j,V,C)};let t=null,D=!1;null===(E=j.Ck)||void 0===E||E.add((()=>{D=!0,t&&(t.abort(),t=null),s()}));const b=()=>{if(D)return;const m=(V,I)=>{l(null===V||void 0===V?void 0:V.statusText,I)};if(!j.loadFile&&V.rawData)throw"Plugin does not support loading ArrayBufferView.";t=j.loadFile?j.loadFile(I,V.rawData||V.file||V.url,V.rootUrl,v,C,X,m,k):I._loadFile(V.file||V.url,v,C,!0,X,m)},T=I.getEngine();let x=T.enableOfflineSupport;if(x){let m=!1;for(const C of I.disableOfflineSupportExceptionRules)if(C.test(V.url)){m=!0;break}x=!m}x&&O.b.OfflineProviderFactory?I.offlineProvider=O.b.OfflineProviderFactory(V.url,b,T.disableManifestCheck):b()}))}function S(V,I){let m,C,s=null,F=null;if(I)if(I.name)m=`file:${I.name}`,C=I.name,s=I;else if(ArrayBuffer.isView(I))m="",C=(0,X.d)(),F=I;else if(I.startsWith("data:"))m=I,C="";else if(V){const s=I;if("/"===s.substring(0,1))return l.d.Error("Wrong sceneFilename parameter"),null;m=V+s,C=s}else m=I,C=l.d.GetFilename(I),V=l.d.GetFolderPath(I);else m=V,C=l.d.GetFilename(V),V=l.d.GetFolderPath(V);return{url:m,rootUrl:V,name:C,file:s,rawData:F}}function c(V){if("string"===typeof V.extensions){const I=V.extensions;t[I.toLowerCase()]={plugin:V,isBinary:!1}}else{const I=V.extensions,m=Object.keys(I);for(const C of m)t[C.toLowerCase()]={plugin:V,isBinary:I[C].isBinary,mimeType:I[C].mimeType}}}async function H(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.c.LastCreatedScene,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!C)return j.d.Error("No scene available to import mesh to"),null;const O=S(I,m);if(!O)return null;const v={};C.addPendingData(v);const N=()=>{C.removePendingData(v)},t=(V,I)=>{const m=n(O,V,I);F?F(C,m,new Y.g(m,Y.e.SceneLoaderError,I)):j.d.Error(m),N()},D=s?V=>{try{s(V)}catch(I){t("Error in onProgress callback: "+I,I)}}:void 0,b=(V,I,m,s,F,k,j,E)=>{if(C.importedMeshesFiles.push(O.url),l)try{l(V,I,m,s,F,k,j,E)}catch(K){t("Error in onSuccess callback: "+K,K)}C.removePendingData(v)};return await x(O,C,((I,m,l)=>{if(I.rewriteRootURL&&(O.rootUrl=I.rewriteRootURL(O.rootUrl,l)),I.importMesh){const l=[],s=[],F=[];if(!I.importMesh(V,C,m,O.rootUrl,l,s,F,t))return;C.loadingPluginName=I.name,b(l,s,F,[],[],[],[],[])}else{I.importMeshAsync(V,C,m,O.rootUrl,D,O.name).then((V=>{C.loadingPluginName=I.name,b(V.meshes,V.ZY,V.skeletons,V.animationGroups,V.transformNodes,V.geometries,V.lights,V.spriteManagers)})).catch((V=>{t(V.message,V)}))}}),D,t,N,E,K,X)}async function y(V,I,m,C,l,s,F,k){return await new Promise(((j,E)=>{try{H(V,I,m,C,((V,I,m,C,l,s,F,k)=>{j({meshes:V,ZY:I,skeletons:m,animationGroups:C,transformNodes:l,geometries:s,lights:F,spriteManagers:k})}),l,((V,I,m)=>{E(m||new Error(I))}),s,F,k).catch(E)}catch(Y){E(Y)}}))}async function z(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedEngine,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};m?await B(V,I,new F.e(m),C,s,j,E,K,Y):l.d.Error("No engine available")}async function Z(V,I,m,C,l,s,F){return await new Promise(((k,j)=>{z(V,I,m,(V=>{k(V)}),C,((V,I,m)=>{j(m||new Error(I))}),l,s,F)}))}async function B(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!m)return j.d.Error("No scene available to append to"),null;const O=S(V,I);if(!O)return null;const v={};m.addPendingData(v);const N=()=>{m.removePendingData(v)};E.d.ShowLoadingScreen&&!D&&(D=!0,m.getEngine().displayLoadingUI(),m.executeWhenReady((()=>{m.getEngine().hideLoadingUI(),D=!1})));const t=(V,I)=>{const C=n(O,V,I);s?s(m,C,new Y.g(C,Y.e.SceneLoaderError,I)):j.d.Error(C),N()},b=l?V=>{try{l(V)}catch(I){t("Error in onProgress callback",I)}}:void 0,T=()=>{if(C)try{C(m)}catch(V){t("Error in onSuccess callback",V)}m.removePendingData(v)};return await x(O,m,((V,I)=>{if(V.load){if(!V.load(m,I,O.rootUrl,t))return;m.loadingPluginName=V.name,T()}else{V.loadAsync(m,I,O.rootUrl,b,O.name).then((()=>{m.loadingPluginName=V.name,T()})).catch((V=>{t(V.message,V)}))}}),b,t,N,F,K,X)}async function W(V,I,m,C,l,s,F){return await new Promise(((k,j)=>{try{B(V,I,m,(V=>{k(V)}),C,((V,I,m)=>{j(m||new Error(I))}),l,s,F).catch(j)}catch(Y){j(Y)}}))}async function Q(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!m)return j.d.Error("No scene available to load asset container to"),null;const X=S(V,I);if(!X)return null;const O={};m.addPendingData(O);const v=()=>{m.removePendingData(O)},N=(V,I)=>{const C=n(X,V,I);s?s(m,C,new Y.g(C,Y.e.SceneLoaderError,I)):j.d.Error(C),v()},t=l?V=>{try{l(V)}catch(I){N("Error in onProgress callback",I)}}:void 0,D=V=>{if(C)try{C(V)}catch(I){N("Error in onSuccess callback",I)}m.removePendingData(O)};return await x(X,m,((V,I)=>{if(V.loadAssetContainer){const C=V.loadAssetContainer(m,I,X.rootUrl,N);if(!C)return;C.populateRootNodes(),m.loadingPluginName=V.name,D(C)}else if(V.loadAssetContainerAsync){V.loadAssetContainerAsync(m,I,X.rootUrl,t,X.name).then((I=>{I.populateRootNodes(),m.loadingPluginName=V.name,D(I)})).catch((V=>{N(V.message,V)}))}else N("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),t,N,v,F,E,K)}async function G(V,I,m,C,l,s,F){return await new Promise(((k,j)=>{try{Q(V,I,m,(V=>{k(V)}),C,((V,I,m)=>{j(m||new Error(I))}),l,s,F).catch(j)}catch(Y){j(Y)}}))}async function r(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.LastCreatedScene,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!m)return void j.d.Error("No scene available to load animations to");if(C){for(const C of m.animatables)C.reset();m.stopAllAnimations();const V=m.animationGroups.slice();for(const m of V)m.dispose();const I=m.getNodes();for(const m of I)m.animations&&(m.animations=[])}else switch(l){case 0:const V=m.animationGroups.slice();for(const I of V)I.dispose();break;case 1:for(const I of m.animationGroups)I.stop();break;case 2:for(const I of m.animationGroups)I.reset(),I.restart();break;case 3:break;default:return void j.d.Error("Unknown animation group loading mode value '"+l+"'")}const v=m.animatables.length;await Q(V,I,m,(V=>{V.mergeAnimationsTo(m,m.animatables.slice(v),s),V.dispose(),m.onAnimationFileImportedObservable.notifyObservers(m),F&&F(m)}),E,K,Y,X,O)}async function g(V,I,m,C,l,s,F,k,j,E){return await new Promise(((K,X)=>{try{r(V,I,m,C,l,s,(V=>{K(V)}),F,((V,I,m)=>{X(m||new Error(I))}),k,j,E).catch(X)}catch(Y){X(Y)}}))}class h{static get ForceFullSceneLoadingForIncremental(){return E.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){E.d.ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return E.d.ShowLoadingScreen}static set ShowLoadingScreen(V){E.d.ShowLoadingScreen=V}static get loggingLevel(){return E.d.loggingLevel}static set loggingLevel(V){E.d.loggingLevel=V}static get CleanBoneMatrixWeights(){return E.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){E.d.CleanBoneMatrixWeights=V}static GetDefaultPlugin(){return b()}static GetPluginForExtension(V){var I;return null===(I=T(V,!0))||void 0===I?void 0:I.plugin}static IsPluginForExtensionAvailable(V){return function(V){return!!t[V]}(V)}static RegisterPlugin(V){c(V)}static ImportMesh(V,I,m,C,l,s,F,j,E){H(V,I,m,C,l,s,F,j,E).catch((V=>null===F||void 0===F?void 0:F(k.c.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async ImportMeshAsync(V,I,m,C,l,s,F){return await y(V,I,m,C,l,s,F)}static Load(V,I,m,C,l,s,F,j){z(V,I,m,C,l,s,F,j).catch((V=>null===s||void 0===s?void 0:s(k.c.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async LoadAsync(V,I,m,C,l,s){return await Z(V,I,m,C,l,s)}static Append(V,I,m,C,l,s,F,j){B(V,I,m,C,l,s,F,j).catch((V=>null===s||void 0===s?void 0:s(m??k.c.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async AppendAsync(V,I,m,C,l,s){return await W(V,I,m,C,l,s)}static LoadAssetContainer(V,I,m,C,l,s,F,j){Q(V,I,m,C,l,s,F,j).catch((V=>null===s||void 0===s?void 0:s(m??k.c.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async LoadAssetContainerAsync(V,I,m,C,l,s){return await G(V,I,m,C,l,s)}static ImportAnimations(V,I,m,C,l,s,F,j,E,K,Y){r(V,I,m,C,l,s,F,j,E,K,Y).catch((V=>null===E||void 0===E?void 0:E(m??k.c.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async ImportAnimationsAsync(V,I,m,C,l,s,F,k,j,E,K){return await g(V,I,m,C,l,s,k,E,K)}}h.NO_LOGGING=0,h.MINIMAL_LOGGING=1,h.SUMMARY_LOGGING=2,h.DETAILED_LOGGING=3,h.OnPluginActivatedObservable=N},12868:(V,I,m)=>{"use strict";m.d(I,{b:()=>X});var C=m(11206),l=m(11214),s=m(11076),F=m(11040),k=m(11507),j=m(11518),E=m(11048),K=m(11067),Y=m(11297);m(12872);class X extends k.b{set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const I=this.cV();I&&I.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(V){this._rotationY=V,this.setReflectionTextureMatrix(F.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(V,I,m){let C="";for(const l of V)C+=l;return new X(C,I,null,m,V)}static CreateFromPrefilteredData(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=I.useDelayedTextureLoading;I.useDelayedTextureLoading=!1;const s=new X(V,I,null,!1,null,null,null,void 0,!0,m,C);return I.useDelayedTextureLoading=l,s}constructor(V,I){var m;let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,v=arguments.length>10&&void 0!==arguments[10]&&arguments[10],N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,D=arguments.length>13?arguments[13]:void 0,b=arguments.length>14?arguments[14]:void 0;super(I),this.onLoadObservable=new K.e,this.boundingBoxPosition=F.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new F.b,this._buffer=null,this.name=V,this.url=V,this._noMipmap=l,this.eF=!1,this.isCube=!0,this._textureMatrix=F.b.Identity(),this.coordinatesMode=j.e.CUBIC_MODE;let T=null,n=null;null===C||Array.isArray(C)?(this._noMipmap=l,this._format=Y,this._createPolynomials=v,T=C,this._loaderOptions=D,this._useSRGBBuffer=b,this._lodScale=N,this._lodOffset=t):(T=C.extensions??null,this._noMipmap=C.noMipmap??!1,s=C.files??null,n=C.buffer??null,this._format=C.format??5,X=C.prefiltered??!1,O=C.forcedExtension??null,this._createPolynomials=C.createPolynomials??!1,this._lodScale=C.lodScale??.8,this._lodOffset=C.lodOffset??0,this._loaderOptions=C.loaderOptions,this._useSRGBBuffer=C.useSRGBBuffer,k=C.J??null,E=C.onError??null),(V||s)&&this.updateURL(V,O,k,X,E,T,null===(m=this.cV())||void 0===m?void 0:m.useDelayedTextureLoading,s,n)}getClassName(){return"CubeTexture"}updateURL(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,I&&(this._forcedExtension=I);const E=V.lastIndexOf("."),K=I||(E>-1?V.substring(E).toLowerCase():""),Y=0===K.indexOf(".dds"),X=0===K.indexOf(".env"),O=0===K.indexOf(".basis");if(X?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=C,C&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),k)this._files=k;else if(O||X||Y||s||(s=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,s){for(let I=0;I<s.length;I++)this._files.push(V+s[I]);this._extensions=s}this._buffer=j,F?(this.delayLoadState=4,this._delayedOnLoad=m,this._delayedOnError=l):this._loadTexture(m,l)}delayLoad(V){4===this.delayLoadState&&(V&&(this._forcedExtension=V),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(V){var I,m;if(V.updateFlag===this._textureMatrix.updateFlag)return;V.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(m=this.cV())||void 0===m||m.markAllMaterialsAsDirty(1,(V=>-1!==V.getActiveTextures().indexOf(this))));if(this._textureMatrix=V,null===(I=this.cV())||void 0===I||!I.useRightHandedSystem)return;const C=F.g.LF[0],l=F.g.Quaternion[0],s=F.g.LF[1];this._textureMatrix.decompose(C,l,s),l.z*=-1,l.w*=-1,F.b.ComposeToRef(C,l,s,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var V;return null!==(V=this.cV())&&void 0!==V&&V.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=this.cV(),C=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const l=()=>{var I;(this.onLoadObservable.notifyObservers(this),C)&&(C.dispose(),null===(I=this.cV())||void 0===I||I.markAllMaterialsAsDirty(1));V&&V()},F=(V,m)=>{this._loadingError=!0,this._errorObject={message:V,exception:m},I&&I(V,m),j.e.OnTextureLoadErrorObservable.notifyObservers(this)};var k;this._texture?this._texture.isReady?s.d.SetImmediate((()=>l())):this._texture.onLoadedObservable.add((()=>l())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,m,this._lodScale,this._lodOffset,V,F,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,m,this._files,this._noMipmap,V,F,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(k=this._texture)||void 0===k||k.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(V,I,m){const C=Y.d.Parse((()=>{let C=!1;return V.prefiltered&&(C=V.prefiltered),new X(m+(V.url??V.name),I,V.extensions,!1,V.files||null,null,null,void 0,C,V.forcedExtension)}),V,I);if(V.boundingBoxPosition&&(C.boundingBoxPosition=F.m.Ik(V.boundingBoxPosition)),V.boundingBoxSize&&(C.boundingBoxSize=F.m.Ik(V.boundingBoxSize)),V.animations)for(let l=0;l<V.animations.length;l++){const I=V.animations[l],m=(0,E.d)("BABYLON.Animation");m&&C.animations.push(m.Parse(I))}return C}clone(){let V=0;const I=Y.d.Clone((()=>{const I=new X(this.url,this.cV()||this._getEngine(),this._extensions,this._noMipmap,this._files);return V=I.uniqueId,I}),this);return I.uniqueId=V,I}}(0,C.d)([(0,l.B)()],X.prototype,"url",void 0),(0,C.d)([(0,l.x)()],X.prototype,"boundingBoxPosition",void 0),(0,C.d)([(0,l.x)()],X.prototype,"boundingBoxSize",null),(0,C.d)([(0,l.B)("rotationY")],X.prototype,"rotationY",null),(0,C.d)([(0,l.B)("files")],X.prototype,"_files",void 0),(0,C.d)([(0,l.B)("forcedExtension")],X.prototype,"_forcedExtension",void 0),(0,C.d)([(0,l.B)("extensions")],X.prototype,"_extensions",void 0),(0,C.d)([(0,l.l)("textureMatrix")],X.prototype,"_textureMatrix",void 0),(0,C.d)([(0,l.l)("textureMatrixRefraction")],X.prototype,"_textureMatrixRefraction",void 0),j.e._CubeTextureParser=X.Parse,(0,E.h)("BABYLON.CubeTexture",X)},13378:(V,I,m)=>{"use strict";m.d(I,{e:()=>j});var C=m(11085),l=m(11518),s=m(11193),F=m(11433),k=m(11161);F.ThinEngine.prototype.createDynamicTexture=function(V,I,m,C){const l=new k.e(this,4);return l.baseWidth=V,l.baseHeight=I,m&&(V=this.needPOTTextures?(0,s.h)(V,this._caps.maxTextureSize):V,I=this.needPOTTextures?(0,s.h)(I,this._caps.maxTextureSize):I),l.width=V,l.height=I,l.isReady=!1,l.generateMipMaps=m,l.samplingMode=C,this.updateTextureSamplingMode(C,l),this._internalTexturesCache.push(l),l},F.ThinEngine.prototype.updateDynamicTexture=function(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V)return;const F=this._gl,k=F.TEXTURE_2D,j=this._bindTextureDirectly(k,V,!0,s);this._unpackFlipY(void 0===m?V.invertY:m),C&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const E=this._getWebGLTextureType(V.type),K=this._getInternalFormat(l||V.format),Y=this._getRGBABufferInternalSizedFormat(V.type,K);F.texImage2D(k,0,Y,K,E,I),V.generateMipMaps&&F.generateMipmap(k),j||this._bindTextureDirectly(k,null),C&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),l&&(V.format=l),V._dynamicTextureSource=I,V._premulAlpha=C,V.invertY=m||!1,V.isReady=!0};class j extends l.e{constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,k=arguments.length>6?arguments[6]:void 0;const j=!m||m._isScene;super(null,j?m:null===m||void 0===m?void 0:m.OI,j?!C:m,k,s,void 0,void 0,void 0,void 0,F),this.name=V,this.wrapU=l.e.CLAMP_ADDRESSMODE,this.wrapV=l.e.CLAMP_ADDRESSMODE,this._generateMipMaps=C;const E=this._getEngine();if(!E)return;if(I.getContext)this._canvas=I,this._ownCanvas=!1,this._texture=E.createDynamicTexture(this._canvas.width,this._canvas.height,C,s);else{this._canvas=E.createCanvas(1,1),this._ownCanvas=!0;const V=I;V.width||0===V.width?this._texture=E.createDynamicTexture(V.width,V.height,C,s):this._texture=E.createDynamicTexture(I,I,C,s)}const K=this.getSize();this._canvas.width!==K.width&&(this._canvas.width=K.width),this._canvas.height!==K.height&&(this._canvas.height=K.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(V){this._canvas.width=V.width,this._canvas.height=V.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(V.width,V.height,this._generateMipMaps,this.samplingMode)}scale(V){const I=this.getSize();I.width*=V,I.height*=V,this._recreate(I)}scaleTo(V,I){const m=this.getSize();m.width=V,m.height=I,this._recreate(m)}getContext(){return this._context}clear(V){const I=this.getSize();V&&(this._context.fillStyle=V),this._context.clearRect(0,0,I.width,I.height)}update(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===V||V,I,this._format||void 0,void 0,m)}drawText(V,I,m,C,l,s,F){let k=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const j=this.getSize();if(s&&(this._context.fillStyle=s,this._context.fillRect(0,0,j.width,j.height)),this._context.font=C,null===I||void 0===I){const m=this._context.measureText(V);I=(j.width-m.width)/2}if(null===m||void 0===m){const V=parseInt(C.replace(/\D/g,""));m=j.height/2+V/3.65}this._context.fillStyle=l||"",this._context.fillText(V,I,m),k&&this.update(F)}dispose(){var V,I;(super.dispose(),this._ownCanvas)&&(null===(V=this._canvas)||void 0===V||null===(I=V.remove)||void 0===I||I.call(V));this._canvas=null,this._context=null}clone(){const V=this.cV();if(!V)return this;const I=this.getSize(),m=new j(this.name,I,V,this._generateMipMaps);return m.eF=this.eF,m.level=this.level,m.wrapU=this.wrapU,m.wrapV=this.wrapV,m}serialize(){const V=this.cV();V&&!V.isReady()&&C.d.Warn("The scene must be ready before serializing the dynamic texture");const I=super.serialize();return j._IsCanvasElement(this._canvas)&&(I.base64String=this._canvas.toDataURL()),I.invertY=this._invertY,I.samplingMode=this.samplingMode,I}static _IsCanvasElement(V){return void 0!==V.toDataURL}_rebuild(){this.update()}}},12771:(V,I,m)=>{"use strict";m.d(I,{c:()=>l});var C=m(11518);class l extends C.e{get depth(){return this._depth}constructor(V,I,m,l,s,F){let k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:C.e.TRILINEAR_SAMPLINGMODE,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10?arguments[10]:void 0;super(null,F,!k,j),this.format=s,this._texture=F.getEngine().createRawTexture2DArray(V,I,m,l,s,k,j,E,null,K,Y),this._depth=l,this.is2DArray=!0}update(V){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(V,I,m,C,s){return new l(V,I,m,C,5,s,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12573:(V,I,m)=>{"use strict";m.d(I,{d:()=>k,e:()=>j,h:()=>s,l:()=>F});var C=m(11074),l=m(11040);function s(V,I){return`{X: ${V.x.toFixed(I)} Y: ${V.y.toFixed(I)}}`}function F(V,I){return`{X: ${V._x.toFixed(I)} Y: ${V._y.toFixed(I)} Z: ${V._z.toFixed(I)}}`}function k(V,I){return 2*Math.acos((0,C.Clamp)(l.e.Dot(V,I)))}function j(V,I){const m=new l.e;return function(V,I,m){const s=l.m.Cross(V,I),F=Math.acos((0,C.Clamp)(l.m.Dot(V,I),-1,1));l.e.RotationAxisToRef(s,F,m)}(V,I,m),m}},12403:(V,I,m)=>{"use strict";m.d(I,{c:()=>E});var C=m(11040),l=m(11312),s=m(11384),F=m(11350),k=m(11415);m(12408);function j(V){let I=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const m=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],s=[];let j=[];const E=V.width||V.size||1,K=V.height||V.size||1,Y=V.depth||V.size||1,X=V.wrap||!1;let O=void 0===V.topBaseAt?1:V.topBaseAt,v=void 0===V.bottomBaseAt?0:V.bottomBaseAt;O=(O+4)%4,v=(v+4)%4;let N=[2,0,3,1][O],t=[2,0,1,3][v],D=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(X){I=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],D=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let V=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],m=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const C=[17,18,19,16],l=[22,23,20,21];for(;N>0;)V.unshift(V.pop()),C.unshift(C.pop()),N--;for(;t>0;)m.unshift(m.pop()),l.unshift(l.pop()),t--;V=V.flat(),m=m.flat(),D=D.concat(V).concat(m),I.push(C[0],C[2],C[3],C[0],C[1],C[2]),I.push(l[0],l[2],l[3],l[0],l[1],l[2])}const b=[E/2,K/2,Y/2];j=D.reduce(((V,I,m)=>V.concat(I*b[m%3])),[]);const T=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,n=V.faceUV||new Array(6),x=V.faceColors,S=[];for(let F=0;F<6;F++)void 0===n[F]&&(n[F]=new C.n(0,0,1,1)),x&&void 0===x[F]&&(x[F]=new l.d(1,1,1,1));for(let C=0;C<6;C++)if(s.push(n[C].z,k.e?1-n[C].w:n[C].w),s.push(n[C].x,k.e?1-n[C].w:n[C].w),s.push(n[C].x,k.e?1-n[C].y:n[C].y),s.push(n[C].z,k.e?1-n[C].y:n[C].y),x)for(let V=0;V<4;V++)S.push(x[C].r,x[C].g,x[C].b,x[C].a);F.c._ComputeSides(T,j,I,m,s,V.frontUVs,V.backUVs);const c=new F.c;if(c.indices=I,c.yV=j,c.zV=m,c.BV=s,x){const V=T===F.c.DOUBLESIDE?S.concat(S):S;c.ZV=V}return c}function E(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new s.c(V,m);I.sideOrientation=s.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return j(I).QV(C,I.updatable),C}F.c.CreateBox=j,s.c.CreateBox=function(V,I){return E(V,{size:I,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12560:(V,I,m)=>{"use strict";m.d(I,{e:()=>k});var C=m(11384),l=m(11350),s=m(11415);function F(V){const I=[],m=[],C=[],F=[],k=V.radius||.5,j=V.tessellation||64,E=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,K=0===V.sideOrientation?0:V.sideOrientation||l.c.DEFAULTSIDE;I.push(0,0,0),F.push(.5,.5);const Y=2*Math.PI*E,X=1===E?Y/j:Y/(j-1);let O=0;for(let l=0;l<j;l++){const V=Math.cos(O),m=Math.sin(O),C=(V+1)/2,l=(1-m)/2;I.push(k*V,k*m,0),F.push(C,s.e?1-l:l),O+=X}1===E&&(I.push(I[3],I[4],I[5]),F.push(F[2],s.e?1-F[3]:F[3]));const v=I.length/3;for(let l=1;l<v-1;l++)m.push(l+1,0,l);l.c.ComputeNormals(I,m,C),l.c._ComputeSides(K,I,m,C,F,V.frontUVs,V.backUVs);const N=new l.c;return N.indices=m,N.yV=I,N.zV=C,N.BV=F,N}function k(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new C.c(V,m);I.sideOrientation=C.c._GetDefaultSideOrientation(I.sideOrientation),l._originalBuilderSideOrientation=I.sideOrientation;return F(I).QV(l,I.updatable),l}l.c.CreateDisc=F,C.c.CreateDisc=function(V,I,m){return k(V,{radius:I,tessellation:m,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12408:(V,I,m)=>{"use strict";m.d(I,{f:()=>t,d:()=>b,i:()=>D});var C=m(11040),l=m(11312),s=m(11384),F=m(11350),k=m(11233);s.c._GroundMeshParser=(V,I)=>j.Parse(V,I);class j extends s.c{constructor(V,I){super(V,I),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=V,this._subdivisionsY=V,this.subdivide(V);const m=this;m.createOrUpdateSubmeshesOctree&&m.createOrUpdateSubmeshesOctree(I)}getHeightAtCoordinates(V,I){const m=this.getWorldMatrix(),l=C.g.Matrix[5];m.invertToRef(l);const s=C.g.LF[8];if(C.m.TransformCoordinatesFromFloatsToRef(V,0,I,l,s),V=s.x,I=s.z,V<this._minX||V>=this._maxX||I<=this._minZ||I>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(V,I),k=-(F.x*V+F.z*I+F.w)/F.y;return C.m.TransformCoordinatesFromFloatsToRef(0,k,0,m,s),s.y}getNormalAtCoordinates(V,I){const m=new C.m(0,1,0);return this.getNormalAtCoordinatesToRef(V,I,m),m}getNormalAtCoordinatesToRef(V,I,m){const l=this.getWorldMatrix(),s=C.g.Matrix[5];l.invertToRef(s);const F=C.g.LF[8];if(C.m.TransformCoordinatesFromFloatsToRef(V,0,I,s,F),V=F.x,I=F.z,V<this._minX||V>this._maxX||I<this._minZ||I>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const k=this._getFacetAt(V,I);return C.m.TransformNormalFromFloatsToRef(k.x,k.y,k.z,l,m),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(V,I){const m=Math.floor((V+this._maxX)*this._subdivisionsX/this._width),C=Math.floor(-(I+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),l=this._heightQuads[C*this._subdivisionsX+m];let s;return s=I<l.slope.x*V+l.slope.y?l.facet1:l.facet2,s}_initHeightQuads(){const V=this._subdivisionsX,I=this._subdivisionsY;this._heightQuads=[];for(let m=0;m<I;m++)for(let I=0;I<V;I++){const l={slope:C.k.Zero(),facet1:new C.n(0,0,0,0),facet2:new C.n(0,0,0,0)};this._heightQuads[m*V+I]=l}return this}_computeHeightQuads(){const V=this.getVerticesData(k.e.PositionKind);if(!V)return this;const I=C.g.LF[3],m=C.g.LF[2],l=C.g.LF[1],s=C.g.LF[0],F=C.g.LF[4],j=C.g.LF[5],E=C.g.LF[6],K=C.g.LF[7],Y=C.g.LF[8];let X=0,O=0,v=0,N=0,t=0,D=0,b=0;const T=this._subdivisionsX,n=this._subdivisionsY;for(let k=0;k<n;k++)for(let n=0;n<T;n++){X=3*n,O=k*(T+1)*3,v=(k+1)*(T+1)*3,I.x=V[O+X],I.y=V[O+X+1],I.z=V[O+X+2],m.x=V[O+X+3],m.y=V[O+X+4],m.z=V[O+X+5],l.x=V[v+X],l.y=V[v+X+1],l.z=V[v+X+2],s.x=V[v+X+3],s.y=V[v+X+4],s.z=V[v+X+5],N=(s.z-I.z)/(s.x-I.x),t=I.z-N*I.x,m.subtractToRef(I,F),l.subtractToRef(I,j),s.subtractToRef(I,E),C.m.CrossToRef(E,j,K),C.m.CrossToRef(F,E,Y),K.normalize(),Y.normalize(),D=-(K.x*I.x+K.y*I.y+K.z*I.z),b=-(Y.x*m.x+Y.y*m.y+Y.z*m.z);const x=this._heightQuads[k*T+n];x.slope.aF(N,t),x.facet1.aF(K.x,K.y,K.z,D),x.facet2.aF(Y.x,Y.y,Y.z,b)}return this}serialize(V){super.serialize(V),V.subdivisionsX=this._subdivisionsX,V.subdivisionsY=this._subdivisionsY,V.minX=this._minX,V.maxX=this._maxX,V.Fk=this._minZ,V.maxZ=this._maxZ,V.width=this._width,V.height=this._height}static Parse(V,I){const m=new j(V.name,I);return m._subdivisionsX=V.subdivisionsX||1,m._subdivisionsY=V.subdivisionsY||1,m._minX=V.minX,m._maxX=V.maxX,m._minZ=V.Fk,m._maxZ=V.maxZ,m._width=V.width,m._height=V.height,m}}var E=m(11076),K=m(11061),Y=m(11044),X=m(11415);function O(V){const I=[],m=[],l=[],s=[];let k,j;const E=V.width||V.size||1,K=V.height||V.size||1,Y=0|(V.subdivisionsX||V.subdivisions||1),O=0|(V.subdivisionsY||V.subdivisions||1);for(k=0;k<=O;k++)for(j=0;j<=Y;j++){const V=new C.m(j*E/Y-E/2,0,(O-k)*K/O-K/2),I=new C.m(0,1,0);m.push(V.x,V.y,V.z),l.push(I.x,I.y,I.z),s.push(j/Y,X.e?k/O:1-k/O)}for(k=0;k<O;k++)for(j=0;j<Y;j++)I.push(j+1+(k+1)*(Y+1)),I.push(j+1+k*(Y+1)),I.push(j+k*(Y+1)),I.push(j+(k+1)*(Y+1)),I.push(j+1+(k+1)*(Y+1)),I.push(j+k*(Y+1));const v=new F.c;return v.indices=I,v.yV=m,v.zV=l,v.BV=s,v}function v(V){const I=void 0!==V.xmin&&null!==V.xmin?V.xmin:-1,m=void 0!==V.zmin&&null!==V.zmin?V.zmin:-1,l=void 0!==V.xmax&&null!==V.xmax?V.xmax:1,s=void 0!==V.zmax&&null!==V.zmax?V.zmax:1,k=V.subdivisions||{w:1,h:1},j=V.precision||{w:1,h:1},E=[],K=[],Y=[],X=[];let O,v,N,t;k.h=k.h<1?1:k.h,k.w=k.w<1?1:k.w,j.w=j.w<1?1:j.w,j.h=j.h<1?1:j.h;const D=(l-I)/k.w,b=(s-m)/k.h;function T(V,I,m,l){const s=K.length/3,F=j.w+1;for(O=0;O<j.h;O++)for(v=0;v<j.w;v++){const V=[s+v+O*F,s+(v+1)+O*F,s+(v+1)+(O+1)*F,s+v+(O+1)*F];E.push(V[1]),E.push(V[2]),E.push(V[3]),E.push(V[0]),E.push(V[1]),E.push(V[3])}const k=C.m.Zero(),N=new C.m(0,1,0);for(O=0;O<=j.h;O++)for(k.z=O*(l-I)/j.h+I,v=0;v<=j.w;v++)k.x=v*(m-V)/j.w+V,k.y=0,K.push(k.x,k.y,k.z),Y.push(N.x,N.y,N.z),X.push(v/j.w,O/j.h)}for(N=0;N<k.h;N++)for(t=0;t<k.w;t++)T(I+t*D,m+N*b,I+(t+1)*D,m+(N+1)*b);const n=new F.c;return n.indices=E,n.yV=K,n.zV=Y,n.BV=X,n}function N(V){const I=[],m=[],s=[],k=[];let j,E;const K=V.colorFilter||new l.c(.3,.59,.11),X=V.alphaFilter||0;let O=!1;if(V.minHeight>V.maxHeight){O=!0;const I=V.maxHeight;V.maxHeight=V.minHeight,V.minHeight=I}for(j=0;j<=V.subdivisions;j++)for(E=0;E<=V.subdivisions;E++){const I=new C.m(E*V.width/V.subdivisions-V.width/2,0,(V.subdivisions-j)*V.height/V.subdivisions-V.height/2),l=4*(((I.x+V.width/2)/V.width*(V.bufferWidth-1)|0)+((1-(I.z+V.height/2)/V.height)*(V.bufferHeight-1)|0)*V.bufferWidth);let F=V.buffer[l]/255,v=V.buffer[l+1]/255,N=V.buffer[l+2]/255;const t=V.buffer[l+3]/255;O&&(F=1-F,v=1-v,N=1-N);const D=F*K.r+v*K.g+N*K.b;I.y=t>=X?V.minHeight+(V.maxHeight-V.minHeight)*D:V.minHeight-Y.c,V.heightBuffer&&(V.heightBuffer[j*(V.subdivisions+1)+E]=I.y),m.push(I.x,I.y,I.z),s.push(0,0,0),k.push(E/V.subdivisions,1-j/V.subdivisions)}for(j=0;j<V.subdivisions;j++)for(E=0;E<V.subdivisions;E++){const C=E+1+(j+1)*(V.subdivisions+1),l=E+1+j*(V.subdivisions+1),s=E+j*(V.subdivisions+1),F=E+(j+1)*(V.subdivisions+1),k=m[3*C+1]>=V.minHeight,K=m[3*l+1]>=V.minHeight,Y=m[3*s+1]>=V.minHeight;k&&K&&Y&&(I.push(C),I.push(l),I.push(s));m[3*F+1]>=V.minHeight&&k&&Y&&(I.push(F),I.push(C),I.push(s))}F.c.ComputeNormals(m,I,s);const v=new F.c;return v.indices=I,v.yV=m,v.zV=s,v.BV=k,v}function t(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const m=new j(V,arguments.length>2?arguments[2]:void 0);m._setReady(!1),m._subdivisionsX=I.subdivisionsX||I.subdivisions||1,m._subdivisionsY=I.subdivisionsY||I.subdivisions||1,m._width=I.width||1,m._height=I.height||1,m._maxX=m._width/2,m._maxZ=m._height/2,m._minX=-m._maxX,m._minZ=-m._maxZ;return O(I).QV(m,I.updatable),m._setReady(!0),m}function D(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new s.c(V,m);return v(I).QV(C,I.updatable),C}function b(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=m.width||10,F=m.height||10,k=m.subdivisions||1,Y=m.minHeight||0,X=m.maxHeight||1,O=m.colorFilter||new l.c(.3,.59,.11),v=m.alphaFilter||0,t=m.updatable,D=m.onReady;C=C||K.c.LastCreatedScene;const b=new j(V,C);let T;b._subdivisionsX=k,b._subdivisionsY=k,b._width=s,b._height=F,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ,b._setReady(!1),m.passHeightBufferInCallback&&(T=new Float32Array((k+1)*(k+1)));const n=(V,I,m)=>{N({width:s,height:F,subdivisions:k,minHeight:Y,maxHeight:X,colorFilter:O,buffer:V,bufferWidth:I,bufferHeight:m,alphaFilter:v,heightBuffer:T}).QV(b,t),D&&D(b,T),b._setReady(!0)};if("string"===typeof I){const V=V=>{var I;const m=V.width,l=V.height;if(C.K)return;const s=null===(I=C)||void 0===I?void 0:I.getEngine().resizeImageBitmap(V,m,l);n(s,m,l)};E.d.LoadImage(I,V,m.onError?m.onError:()=>{},C.offlineProvider)}else n(I.data,I.width,I.height);return b}F.c.CreateGround=O,F.c.CreateTiledGround=v,F.c.CreateGroundFromHeightMap=N,s.c.CreateGround=(V,I,m,C,l,s)=>t(V,{width:I,height:m,subdivisions:C,updatable:s},l),s.c.CreateTiledGround=(V,I,m,C,l,s,F,k,j)=>D(V,{xmin:I,zmin:m,xmax:C,zmax:l,subdivisions:s,precision:F,updatable:j},k),s.c.CreateGroundFromHeightMap=(V,I,m,C,l,s,F,k,j,E,K)=>b(V,I,{width:m,height:C,subdivisions:l,minHeight:s,maxHeight:F,updatable:j,onReady:E,alphaFilter:K},k)},13082:(V,I,m)=>{"use strict";m.d(I,{b:()=>O,c:()=>Y,d:()=>X});var C=m(11040),l=m(11384),s=m(11350),F=m(11715),k=m(11233),j=m(11085);function E(V){const I=[],m=[],C=V.lines,l=V.ZV,F=[];let k=0;for(let s=0;s<C.length;s++){const V=C[s];for(let C=0;C<V.length;C++){const{x:j,y:E,z:K}=V[C];if(m.push(j,E,K),l){const V=l[s],{r:I,g:m,b:k,a:j}=V[C];F.push(I,m,k,j)}C>0&&(I.push(k-1),I.push(k)),k++}}const j=new s.c;return j.indices=I,j.yV=m,l&&(j.ZV=F),j}function K(V){const I=V.dashSize||3,m=V.gapSize||1,l=V.dashNb||200,F=V.points,k=[],j=[],E=C.m.Zero();let K=0,Y=0,X=0,O=0,v=0,N=0,t=0;for(t=0;t<F.length-1;t++)F[t+1].subtractToRef(F[t],E),K+=E.length();for(X=K/l,O=I*X/(I+m),t=0;t<F.length-1;t++){F[t+1].subtractToRef(F[t],E),Y=Math.floor(E.length()/X),E.normalize();for(let V=0;V<Y;V++)v=X*V,k.push(F[t].x+v*E.x,F[t].y+v*E.y,F[t].z+v*E.z),k.push(F[t].x+(v+O)*E.x,F[t].y+(v+O)*E.y,F[t].z+(v+O)*E.z),j.push(N,N+1),N+=2}const D=new s.c;return D.yV=k,D.indices=j,D}function Y(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=I.instance,l=I.lines,s=I.ZV;if(C){const V=C.getVerticesData(k.e.PositionKind);let I,m;s&&(I=C.getVerticesData(k.e.ColorKind));let F=0,j=0;for(let C=0;C<l.length;C++){const k=l[C];for(let l=0;l<k.length;l++)V[F]=k[l].x,V[F+1]=k[l].y,V[F+2]=k[l].z,s&&I&&(m=s[C],I[j]=m[l].r,I[j+1]=m[l].g,I[j+2]=m[l].b,I[j+3]=m[l].a,j+=4),F+=3}return C.updateVerticesData(k.e.PositionKind,V,!1,!1),s&&I&&C.updateVerticesData(k.e.ColorKind,I,!1,!1),C.refreshBoundingInfo(),C}const j=!!s,K=new F.e(V,m,null,void 0,void 0,j,I.useVertexAlpha,I.material);return E(I).QV(K,I.updatable),K}function X(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=I.ZV?[I.ZV]:null;return Y(V,{lines:[I.points],updatable:I.updatable,instance:I.instance,ZV:C,useVertexAlpha:I.useVertexAlpha,material:I.material},m)}function O(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=I.points,k=I.instance,E=I.gapSize||1,Y=I.dashSize||3;if(k){const V=V=>{const I=C.m.Zero(),m=V.length/6;let l=0,F=0,j=0,E=0,K=0,Y=0,X=0,O=0;for(X=0;X<s.length-1;X++)s[X+1].subtractToRef(s[X],I),l+=I.length();j=l/m;const v=k._creationDataStorage.dashSize;for(E=v*j/(v+k._creationDataStorage.gapSize),X=0;X<s.length-1;X++)for(s[X+1].subtractToRef(s[X],I),F=Math.floor(I.length()/j),I.normalize(),O=0;O<F&&Y<V.length;)K=j*O,V[Y]=s[X].x+K*I.x,V[Y+1]=s[X].y+K*I.y,V[Y+2]=s[X].z+K*I.z,V[Y+3]=s[X].x+(K+E)*I.x,V[Y+4]=s[X].y+(K+E)*I.y,V[Y+5]=s[X].z+(K+E)*I.z,Y+=6,O++;for(;Y<V.length;)V[Y]=s[X].x,V[Y+1]=s[X].y,V[Y+2]=s[X].z,Y+=3};return(I.dashNb||I.dashSize||I.gapSize||I.useVertexAlpha||I.material)&&j.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),k.updateMeshPositions(V,!1),k}const X=new F.e(V,m,null,void 0,void 0,void 0,I.useVertexAlpha,I.material);return K(I).QV(X,I.updatable),X._creationDataStorage=new l.g,X._creationDataStorage.dashSize=Y,X._creationDataStorage.gapSize=E,X}s.c.CreateLineSystem=E,s.c.CreateDashedLines=K,l.c.ej=function(V,I){return X(V,{points:I,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},l.c.CreateDashedLines=function(V,I,m,C,l){return O(V,{points:I,dashSize:m,gapSize:C,dashNb:l,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12448:(V,I,m)=>{"use strict";m.d(I,{e:()=>k,g:()=>j});var C=m(11384),l=m(11350),s=m(11415);function F(V){const I=[],m=[],C=[],F=[],k=void 0!==V.width?V.width:void 0!==V.size?V.size:1,j=void 0!==V.height?V.height:void 0!==V.size?V.size:1,E=0===V.sideOrientation?0:V.sideOrientation||l.c.DEFAULTSIDE,K=k/2,Y=j/2;m.push(-K,-Y,0),C.push(0,0,-1),F.push(0,s.e?1:0),m.push(K,-Y,0),C.push(0,0,-1),F.push(1,s.e?1:0),m.push(K,Y,0),C.push(0,0,-1),F.push(1,s.e?0:1),m.push(-K,Y,0),C.push(0,0,-1),F.push(0,s.e?0:1),I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),l.c._ComputeSides(E,m,I,C,F,V.frontUVs,V.backUVs);const X=new l.c;return X.indices=I,X.yV=m,X.zV=C,X.BV=F,X}function k(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new C.c(V,m);I.sideOrientation=C.c._GetDefaultSideOrientation(I.sideOrientation),l._originalBuilderSideOrientation=I.sideOrientation;return F(I).QV(l,I.updatable),I.sourcePlane&&(l.translate(I.sourcePlane.XC,-I.sourcePlane.d),l.setDirection(I.sourcePlane.XC.scale(-1))),l}const j={Lj:k};l.c.Lj=F,C.c.Lj=(V,I,m,C,l)=>k(V,{size:I,width:I,height:I,sideOrientation:l,updatable:C},m)},12548:(V,I,m)=>{"use strict";m.d(I,{c:()=>j});var C=m(11040),l=m(11384),s=m(11350),F=m(11415);function k(V){const I=0|(V.segments||32),m=V.diameterX||V.diameter||1,l=V.diameterY||V.diameter||1,k=V.diameterZ||V.diameter||1,j=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,E=V.slice&&V.slice<=0?1:V.slice||1,K=0===V.sideOrientation?0:V.sideOrientation||s.c.DEFAULTSIDE,Y=!!V.dedupTopBottomIndices,X=new C.m(m/2,l/2,k/2),O=2+I,v=2*O,N=[],t=[],D=[],b=[];for(let s=0;s<=O;s++){const V=s/O,I=V*Math.PI*E;for(let m=0;m<=v;m++){const l=m/v,s=l*Math.PI*2*j,k=C.b.RotationZ(-I),E=C.b.RotationY(s),K=C.m.TransformCoordinates(C.m.Up(),k),Y=C.m.TransformCoordinates(K,E),O=Y.multiply(X),N=Y.divide(X).normalize();t.push(O.x,O.y,O.z),D.push(N.x,N.y,N.z),b.push(l,F.e?1-V:V)}if(s>0){const V=t.length/3;for(let I=V-2*(v+1);I+v+2<V;I++)Y?(s>1&&(N.push(I),N.push(I+1),N.push(I+v+1)),(s<O||E<1)&&(N.push(I+v+1),N.push(I+1),N.push(I+v+2))):(N.push(I),N.push(I+1),N.push(I+v+1),N.push(I+v+1),N.push(I+1),N.push(I+v+2))}}s.c._ComputeSides(K,t,N,D,b,V.frontUVs,V.backUVs);const T=new s.c;return T.indices=N,T.yV=t,T.zV=D,T.BV=b,T}function j(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return k(I).QV(C,I.updatable),C}s.c.CreateSphere=k,l.c.CreateSphere=(V,I,m,C,l,s)=>j(V,{segments:I,diameterX:m,diameterY:m,diameterZ:m,sideOrientation:s,updatable:l},C)},13394:(V,I,m)=>{"use strict";m.d(I,{d:()=>k});var C=m(11748),l=m(12881),s=m(11765),F=m(11350);class k{static get Configuration(){return{get decoder(){return l.d.DefaultConfiguration},set decoder(V){l.d.DefaultConfiguration=V}}}static set Configuration(V){l.d.DefaultConfiguration=V.decoder}static get DecoderAvailable(){return(0,C.k)(l.d.DefaultConfiguration)}static get Default(){return k._Default??(k._Default=new k),k._Default}static ResetDefault(V){k._Default&&(V||k._Default.dispose(),k._Default=null)}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.DefaultNumWorkers;const I="number"===typeof V?{...l.d.DefaultConfiguration,numWorkers:V}:{...l.d.DefaultConfiguration,...V};this._decoder=new l.d(I)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(V,I,m){return this._decoder.decodeMeshToMeshDataAsync(V,I,m)}async decodeMeshToGeometryAsync(V,I,m,C){return await this._decoder.decodeMeshToGeometryAsync(V,I,m,C)}async _decodeMeshToGeometryForGltfAsync(V,I,m,C,l,s){return await this._decoder._decodeMeshToGeometryForGltfAsync(V,I,m,C,l,s)}async decodeMeshAsync(V,I){const m=await this._decoder.decodeMeshToMeshDataAsync(V,I),C=new F.c;m.indices&&(C.indices=m.indices);for(const l of m.attributes){const V=s.e.GetFloatData(l.data,l.size,s.e.GetDataType(l.data),l.byteOffset,l.byteStride,l.normalized,m.totalVertices);C.set(V,l.kind)}return C}}k.DefaultNumWorkers=(0,C.i)(),k._Default=null},12881:(V,I,m)=>{"use strict";m.d(I,{d:()=>E});var C=m(11748),l=m(11076),s=m(11406),F=m(11765),k=m(11085),j=m(11760);class E extends C.e{static get DefaultAvailable(){return(0,C.k)(E.DefaultConfiguration)}static get Default(){return E._Default??(E._Default=new E),E._Default}static ResetDefault(V){E._Default&&(V||E._Default.dispose(),E._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(V,I){return{module:await(I||DracoDecoderModule)({wasmBinary:V})}}_getWorkerContent(){return`${j.c}(${j.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.DefaultConfiguration)}decodeMeshToMeshDataAsync(V,I,m){const C=V instanceof ArrayBuffer?new Int8Array(V):new Int8Array(V.buffer,V.byteOffset,V.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async V=>await new Promise(((l,s)=>{V.push(((V,F)=>{let j=null;const E=[],K=I=>{V.removeEventListener("error",K),V.removeEventListener("message",Y),s(I),F()},Y=I=>{const C=I.data;switch(C.id){case"indices":j=C.data;break;case"attribute":E.push({kind:C.kind,data:C.data,size:C.size,byteOffset:C.byteOffset,byteStride:C.byteStride,normalized:(s=C.kind,X=C.normalized,m&&void 0!==m[s]?(X!==m[s]&&k.d.Warn(`Normalized flag from Draco data (${X}) does not match normalized flag from glTF accessor (${m[s]}). Using flag from glTF accessor.`),m[s]):X)});break;case"decodeMeshDone":V.removeEventListener("error",K),V.removeEventListener("message",Y),l({indices:j,attributes:E,totalVertices:C.totalVertices}),F()}var s,X};V.addEventListener("error",K),V.addEventListener("message",Y);const X=C.slice();V.postMessage({id:"decodeMesh",dataView:X,attributes:I},[X.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((V=>{let m=null;const l=[],s=(0,j.c)(V.module,C,I,(V=>{m=V}),((V,I,m,C,s,F)=>{l.push({kind:V,data:I,size:m,byteOffset:C,byteStride:s,normalized:F})}));return{indices:m,attributes:l,totalVertices:s}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(V,I,m,C){const l=await this.decodeMeshToMeshDataAsync(m,C),k=new s.e(V,I);l.indices&&k.setIndices(l.indices);for(const s of l.attributes)k.setVerticesBuffer(new F.e(I.getEngine(),s.data,s.kind,!1,void 0,s.byteStride,void 0,s.byteOffset,s.size,void 0,s.normalized,!0),l.totalVertices);return k}async _decodeMeshToGeometryForGltfAsync(V,I,m,C,l,k){const j=await this.decodeMeshToMeshDataAsync(m,C,l),E=new s.e(V,I);k&&(E._boundingInfo=k,E.useBoundingInfoFromGeometry=!0),j.indices&&E.setIndices(j.indices);for(const s of j.attributes)E.setVerticesBuffer(new F.e(I.getEngine(),s.data,s.kind,!1,void 0,s.byteStride,void 0,s.byteOffset,s.size,void 0,s.normalized,!0),j.totalVertices);return E}}E.DefaultConfiguration={wasmUrl:`${l.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${l.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${l.d._DefaultCdnUrl}/draco_decoder_gltf.js`},E._Default=null},13073:(V,I,m)=>{"use strict";m.d(I,{e:()=>kV});var C=m(11040),l=m(11384),s=m(11233),F=m(11350),k=m(11415);function j(V){let I=V.pathArray;const m=V.closeArray||!1,C=V.closePath||!1,l=V.invertUV||!1,j=Math.floor(I[0].length/2);let E=V.offset||j;E=E>j?j:Math.floor(E);const K=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,Y=V.BV,X=V.ZV,O=[],v=[],N=[],t=[],D=[],b=[],T=[],n=[];let x;const S=[],c=[];let H,y,z;if(I.length<2){const V=[],m=[];for(y=0;y<I[0].length-E;y++)V.push(I[0][y]),m.push(I[0][y+E]);I=[V,m]}let Z=0;const B=C?1:0,W=m?1:0;let Q,G,r,g,h,d;for(x=I[0].length,H=0;H<I.length+W;H++){for(T[H]=0,D[H]=[0],Q=H===I.length?I[0]:I[H],G=Q.length,x=x<G?x:G,z=0;z<G;)O.push(Q[z].x,Q[z].y,Q[z].z),z>0&&(r=Q[z].Fm(Q[z-1]).length(),g=r+T[H],D[H].push(g),T[H]=g),z++;C&&(z--,O.push(Q[0].x,Q[0].y,Q[0].z),r=Q[z].Fm(Q[0]).length(),g=r+T[H],D[H].push(g),T[H]=g),S[H]=G+B,c[H]=Z,Z+=G+B}let R,i,q=null,P=null;for(y=0;y<x+B;y++)for(n[y]=0,b[y]=[0],H=0;H<I.length-1+W;H++)h=I[H],d=H===I.length-1?I[0]:I[H+1],y===x?(q=h[0],P=d[0]):(q=h[y],P=d[y]),r=P.Fm(q).length(),g=r+n[y],b[y].push(g),n[y]=g;if(Y)for(H=0;H<Y.length;H++)t.push(Y[H].x,k.e?1-Y[H].y:Y[H].y);else for(H=0;H<I.length+W;H++)for(y=0;y<x+B;y++)R=0!=T[H]?D[H][y]/T[H]:0,i=0!=n[y]?b[y][H]/n[y]:0,l?t.push(i,R):t.push(R,k.e?1-i:i);H=0;let u=0,o=S[H]-1,p=S[H+1]-1,M=o<p?o:p,f=c[1]-c[0];const w=S.length-1;for(;u<=M&&H<w;)v.push(u,u+f,u+1),v.push(u+f+1,u+1,u+f),u+=1,u===M&&(H++,f=c[H+1]-c[H],o=S[H]-1,p=S[H+1]-1,u=c[H],M=o<p?o+u:p+u);if(F.c.ComputeNormals(O,v,N),C){let V=0,m=0;for(H=0;H<I.length;H++){V=3*c[H],m=H+1<I.length?3*(c[H+1]-1):N.length-3,N[V]=.5*(N[V]+N[m]),N[V+1]=.5*(N[V+1]+N[m+1]),N[V+2]=.5*(N[V+2]+N[m+2]);const C=Math.sqrt(N[V]*N[V]+N[V+1]*N[V+1]+N[V+2]*N[V+2]);N[V]/=C,N[V+1]/=C,N[V+2]/=C,N[m]=N[V],N[m+1]=N[V+1],N[m+2]=N[V+2]}}if(m){let V=3*c[0],m=3*c[I.length];for(y=0;y<x+B;y++){N[V]=.5*(N[V]+N[m]),N[V+1]=.5*(N[V+1]+N[m+1]),N[V+2]=.5*(N[V+2]+N[m+2]);const I=Math.sqrt(N[V]*N[V]+N[V+1]*N[V+1]+N[V+2]*N[V+2]);N[V]/=I,N[V+1]/=I,N[V+2]/=I,N[m]=N[V],N[m+1]=N[V+1],N[m+2]=N[V+2],V+=3,m+=3}}F.c._ComputeSides(K,O,v,N,t,V.frontUVs,V.backUVs);let A=null;if(X){A=new Float32Array(4*X.length);for(let V=0;V<X.length;V++)A[4*V]=X[V].r,A[4*V+1]=X[V].g,A[4*V+2]=X[V].b,A[4*V+3]=X[V].a}const J=new F.c,U=new Float32Array(O),e=new Float32Array(N),a=new Float32Array(t);return J.indices=v,J.yV=U,J.zV=e,J.BV=a,A&&J.set(A,s.e.ColorKind),C&&(J._idx=c),J}function E(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=I.pathArray,K=I.closeArray,Y=I.closePath,X=l.c._GetDefaultSideOrientation(I.sideOrientation),O=I.instance,v=I.updatable;if(O){const V=C.g.LF[0].mk(Number.MAX_VALUE),m=C.g.LF[1].mk(-Number.MAX_VALUE),j=I=>{let C=E[0].length;const s=O;let F=0;const k=s._originalBuilderSideOrientation===l.c.DOUBLESIDE?2:1;for(let l=1;l<=k;++l)for(let k=0;k<E.length;++k){const l=E[k],j=l.length;C=C<j?C:j;for(let s=0;s<C;++s){const C=l[s];I[F]=C.x,I[F+1]=C.y,I[F+2]=C.z,V.minimizeInPlaceFromFloats(C.x,C.y,C.z),m.maximizeInPlaceFromFloats(C.x,C.y,C.z),F+=3}if(s._creationDataStorage&&s._creationDataStorage.closePath){const V=l[0];I[F]=V.x,I[F+1]=V.y,I[F+2]=V.z,F+=3}}},K=O.getVerticesData(s.e.PositionKind);if(j(K),O.hasBoundingInfo?O.getBoundingInfo().reConstruct(V,m,O._worldMatrix):O.buildBoundingInfo(V,m,O._worldMatrix),O.updateVerticesData(s.e.PositionKind,K,!1,!1),I.ZV){const V=O.getVerticesData(s.e.ColorKind);for(let m=0,C=0;m<I.ZV.length;m++,C+=4){const l=I.ZV[m];V[C]=l.r,V[C+1]=l.g,V[C+2]=l.b,V[C+3]=l.a}O.updateVerticesData(s.e.ColorKind,V,!1,!1)}if(I.BV){const V=O.getVerticesData(s.e.UVKind);for(let m=0;m<I.BV.length;m++)V[2*m]=I.BV[m].x,V[2*m+1]=k.e?1-I.BV[m].y:I.BV[m].y;O.updateVerticesData(s.e.UVKind,V,!1,!1)}if(!O.areNormalsFrozen||O.isFacetDataEnabled){const V=O.AF(),I=O.getVerticesData(s.e.NormalKind),m=O.isFacetDataEnabled?O.getFacetDataParameters():null;if(F.c.ComputeNormals(K,V,I,m),O._creationDataStorage&&O._creationDataStorage.closePath){let V=0,m=0;for(let C=0;C<E.length;C++)V=3*O._creationDataStorage.idx[C],m=C+1<E.length?3*(O._creationDataStorage.idx[C+1]-1):I.length-3,I[V]=.5*(I[V]+I[m]),I[V+1]=.5*(I[V+1]+I[m+1]),I[V+2]=.5*(I[V+2]+I[m+2]),I[m]=I[V],I[m+1]=I[V+1],I[m+2]=I[V+2]}O.areNormalsFrozen||O.updateVerticesData(s.e.NormalKind,I,!1,!1)}return O}{const C=new l.c(V,m);C._originalBuilderSideOrientation=X,C._creationDataStorage=new l.g;const s=j(I);return Y&&(C._creationDataStorage.idx=s._idx),C._creationDataStorage.closePath=Y,C._creationDataStorage.closeArray=K,s.QV(C,v),C}}F.c.CreateRibbon=j,l.c.CreateRibbon=function(V,I){return E(V,{pathArray:I,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var K=m(12560),Y=m(12403),X=m(11312);function O(V){const I=V.pattern||l.c.NO_FLIP,m=V.tileWidth||V.tileSize||1,C=V.tileHeight||V.tileSize||1,s=V.alignHorizontal||0,k=V.alignVertical||0,j=V.width||V.size||1,E=Math.floor(j/m);let K=j-E*m;const Y=V.height||V.size||1,X=Math.floor(Y/C);let O=Y-X*C;const v=m*E/2,N=C*X/2;let t=0,D=0,b=0,T=0,n=0,x=0;if(K>0||O>0){switch(b=-v,T=-N,n=v,x=N,s){case l.c.CENTER:K/=2,b-=K,n+=K;break;case l.c.LEFT:n+=K,t=-K/2;break;case l.c.RIGHT:b-=K,t=K/2}switch(k){case l.c.CENTER:O/=2,T-=O,x+=O;break;case l.c.BOTTOM:x+=O,D=-O/2;break;case l.c.TOP:T-=O,D=O/2}}const S=[],c=[],H=[];H[0]=[0,0,1,0,1,1,0,1],H[1]=[0,0,1,0,1,1,0,1],I!==l.c.ROTATE_TILE&&I!==l.c.ROTATE_ROW||(H[1]=[1,1,0,1,0,0,1,0]),I!==l.c.FLIP_TILE&&I!==l.c.FLIP_ROW||(H[1]=[1,0,0,0,0,1,1,1]),I!==l.c.FLIP_N_ROTATE_TILE&&I!==l.c.FLIP_N_ROTATE_ROW||(H[1]=[0,1,1,1,1,0,0,0]);let y=[];const z=[],Z=[];let B=0;for(let F=0;F<X;F++)for(let V=0;V<E;V++)S.push(V*m-v+t,F*C-N+D,0),S.push((V+1)*m-v+t,F*C-N+D,0),S.push((V+1)*m-v+t,(F+1)*C-N+D,0),S.push(V*m-v+t,(F+1)*C-N+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),y=I===l.c.FLIP_TILE||I===l.c.ROTATE_TILE||I===l.c.FLIP_N_ROTATE_TILE?y.concat(H[(V%2+F%2)%2]):I===l.c.FLIP_ROW||I===l.c.ROTATE_ROW||I===l.c.FLIP_N_ROTATE_ROW?y.concat(H[F%2]):y.concat(H[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),B+=4;if(K>0||O>0){const V=O>0&&(k===l.c.CENTER||k===l.c.TOP),F=O>0&&(k===l.c.CENTER||k===l.c.BOTTOM),j=K>0&&(s===l.c.CENTER||s===l.c.RIGHT),Y=K>0&&(s===l.c.CENTER||s===l.c.LEFT);let H,W,Q,G,r=[];if(V&&j&&(S.push(b+t,T+D,0),S.push(-v+t,T+D,0),S.push(-v+t,T+O+D,0),S.push(b+t,T+O+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,H=1-K/m,W=1-O/C,Q=1,G=1,r=[H,W,Q,W,Q,G,H,G],I===l.c.ROTATE_ROW&&(r=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),I===l.c.FLIP_ROW&&(r=[1-H,W,1-Q,W,1-Q,G,1-H,G]),I===l.c.FLIP_N_ROTATE_ROW&&(r=[H,1-W,Q,1-W,Q,1-G,H,1-G]),y=y.concat(r),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&Y&&(S.push(v+t,T+D,0),S.push(n+t,T+D,0),S.push(n+t,T+O+D,0),S.push(v+t,T+O+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,H=0,W=1-O/C,Q=K/m,G=1,r=[H,W,Q,W,Q,G,H,G],(I===l.c.ROTATE_ROW||I===l.c.ROTATE_TILE&&E%2===0)&&(r=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),(I===l.c.FLIP_ROW||I===l.c.FLIP_TILE&&E%2===0)&&(r=[1-H,W,1-Q,W,1-Q,G,1-H,G]),(I===l.c.FLIP_N_ROTATE_ROW||I===l.c.FLIP_N_ROTATE_TILE&&E%2===0)&&(r=[H,1-W,Q,1-W,Q,1-G,H,1-G]),y=y.concat(r),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&j&&(S.push(b+t,N+D,0),S.push(-v+t,N+D,0),S.push(-v+t,x+D,0),S.push(b+t,x+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,H=1-K/m,W=0,Q=1,G=O/C,r=[H,W,Q,W,Q,G,H,G],(I===l.c.ROTATE_ROW&&X%2===1||I===l.c.ROTATE_TILE&&X%1===0)&&(r=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),(I===l.c.FLIP_ROW&&X%2===1||I===l.c.FLIP_TILE&&X%2===0)&&(r=[1-H,W,1-Q,W,1-Q,G,1-H,G]),(I===l.c.FLIP_N_ROTATE_ROW&&X%2===1||I===l.c.FLIP_N_ROTATE_TILE&&X%2===0)&&(r=[H,1-W,Q,1-W,Q,1-G,H,1-G]),y=y.concat(r),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&Y&&(S.push(v+t,N+D,0),S.push(n+t,N+D,0),S.push(n+t,x+D,0),S.push(v+t,x+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,H=0,W=0,Q=K/m,G=O/C,r=[H,W,Q,W,Q,G,H,G],(I===l.c.ROTATE_ROW&&X%2===1||I===l.c.ROTATE_TILE&&(X+E)%2===1)&&(r=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),(I===l.c.FLIP_ROW&&X%2===1||I===l.c.FLIP_TILE&&(X+E)%2===1)&&(r=[1-H,W,1-Q,W,1-Q,G,1-H,G]),(I===l.c.FLIP_N_ROTATE_ROW&&X%2===1||I===l.c.FLIP_N_ROTATE_TILE&&(X+E)%2===1)&&(r=[H,1-W,Q,1-W,Q,1-G,H,1-G]),y=y.concat(r),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V){const V=[];H=0,W=1-O/C,Q=1,G=1,V[0]=[H,W,Q,W,Q,G,H,G],V[1]=[H,W,Q,W,Q,G,H,G],I!==l.c.ROTATE_TILE&&I!==l.c.ROTATE_ROW||(V[1]=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),I!==l.c.FLIP_TILE&&I!==l.c.FLIP_ROW||(V[1]=[1-H,W,1-Q,W,1-Q,G,1-H,G]),I!==l.c.FLIP_N_ROTATE_TILE&&I!==l.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-W,Q,1-W,Q,1-G,H,1-G]);for(let C=0;C<E;C++)S.push(C*m-v+t,T+D,0),S.push((C+1)*m-v+t,T+D,0),S.push((C+1)*m-v+t,T+O+D,0),S.push(C*m-v+t,T+O+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,y=I===l.c.FLIP_TILE||I===l.c.ROTATE_TILE||I===l.c.FLIP_N_ROTATE_TILE?y.concat(V[(C+1)%2]):I===l.c.FLIP_ROW||I===l.c.ROTATE_ROW||I===l.c.FLIP_N_ROTATE_ROW?y.concat(V[1]):y.concat(V[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const V=[];H=0,W=0,Q=1,G=O/C,V[0]=[H,W,Q,W,Q,G,H,G],V[1]=[H,W,Q,W,Q,G,H,G],I!==l.c.ROTATE_TILE&&I!==l.c.ROTATE_ROW||(V[1]=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),I!==l.c.FLIP_TILE&&I!==l.c.FLIP_ROW||(V[1]=[1-H,W,1-Q,W,1-Q,G,1-H,G]),I!==l.c.FLIP_N_ROTATE_TILE&&I!==l.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-W,Q,1-W,Q,1-G,H,1-G]);for(let C=0;C<E;C++)S.push(C*m-v+t,x-O+D,0),S.push((C+1)*m-v+t,x-O+D,0),S.push((C+1)*m-v+t,x+D,0),S.push(C*m-v+t,x+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,y=I===l.c.FLIP_TILE||I===l.c.ROTATE_TILE||I===l.c.FLIP_N_ROTATE_TILE?y.concat(V[(C+X)%2]):I===l.c.FLIP_ROW||I===l.c.ROTATE_ROW||I===l.c.FLIP_N_ROTATE_ROW?y.concat(V[X%2]):y.concat(V[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(j){const V=[];H=1-K/m,W=0,Q=1,G=1,V[0]=[H,W,Q,W,Q,G,H,G],V[1]=[H,W,Q,W,Q,G,H,G],I!==l.c.ROTATE_TILE&&I!==l.c.ROTATE_ROW||(V[1]=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),I!==l.c.FLIP_TILE&&I!==l.c.FLIP_ROW||(V[1]=[1-H,W,1-Q,W,1-Q,G,1-H,G]),I!==l.c.FLIP_N_ROTATE_TILE&&I!==l.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-W,Q,1-W,Q,1-G,H,1-G]);for(let m=0;m<X;m++)S.push(b+t,m*C-N+D,0),S.push(b+K+t,m*C-N+D,0),S.push(b+K+t,(m+1)*C-N+D,0),S.push(b+t,(m+1)*C-N+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,y=I===l.c.FLIP_TILE||I===l.c.ROTATE_TILE||I===l.c.FLIP_N_ROTATE_TILE?y.concat(V[(m+1)%2]):I===l.c.FLIP_ROW||I===l.c.ROTATE_ROW||I===l.c.FLIP_N_ROTATE_ROW?y.concat(V[m%2]):y.concat(V[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const V=[];H=0,W=0,Q=K/C,G=1,V[0]=[H,W,Q,W,Q,G,H,G],V[1]=[H,W,Q,W,Q,G,H,G],I!==l.c.ROTATE_TILE&&I!==l.c.ROTATE_ROW||(V[1]=[1-H,1-W,1-Q,1-W,1-Q,1-G,1-H,1-G]),I!==l.c.FLIP_TILE&&I!==l.c.FLIP_ROW||(V[1]=[1-H,W,1-Q,W,1-Q,G,1-H,G]),I!==l.c.FLIP_N_ROTATE_TILE&&I!==l.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-W,Q,1-W,Q,1-G,H,1-G]);for(let m=0;m<X;m++)S.push(n-K+t,m*C-N+D,0),S.push(n+t,m*C-N+D,0),S.push(n+t,(m+1)*C-N+D,0),S.push(n-K+t,(m+1)*C-N+D,0),Z.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,y=I===l.c.FLIP_TILE||I===l.c.ROTATE_TILE||I===l.c.FLIP_N_ROTATE_TILE?y.concat(V[(m+E)%2]):I===l.c.FLIP_ROW||I===l.c.ROTATE_ROW||I===l.c.FLIP_N_ROTATE_ROW?y.concat(V[m%2]):y.concat(V[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const W=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE;F.c._ComputeSides(W,S,Z,c,y,V.frontUVs,V.backUVs);const Q=new F.c;Q.indices=Z,Q.yV=S,Q.zV=c,Q.BV=y;const G=W===F.c.DOUBLESIDE?z.concat(z):z;return Q.ZV=G,Q}function v(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return O(I).QV(C,I.updatable),C}function N(V){const I=V.faceUV||new Array(6),m=V.faceColors,s=V.pattern||l.c.NO_FLIP,j=V.width||V.size||1,E=V.height||V.size||1,K=V.depth||V.size||1,Y=V.tileWidth||V.tileSize||1,v=V.tileHeight||V.tileSize||1,N=V.alignHorizontal||0,t=V.alignVertical||0,D=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE;for(let l=0;l<6;l++)void 0===I[l]&&(I[l]=new C.n(0,0,1,1)),m&&void 0===m[l]&&(m[l]=new X.d(1,1,1,1));const b=j/2,T=E/2,n=K/2,x=[];for(let C=0;C<2;C++)x[C]=O({pattern:s,tileWidth:Y,tileHeight:v,width:j,height:E,alignVertical:t,alignHorizontal:N,sideOrientation:D});for(let C=2;C<4;C++)x[C]=O({pattern:s,tileWidth:Y,tileHeight:v,width:K,height:E,alignVertical:t,alignHorizontal:N,sideOrientation:D});let S=t;t===l.c.BOTTOM?S=l.c.TOP:t===l.c.TOP&&(S=l.c.BOTTOM);for(let C=4;C<6;C++)x[C]=O({pattern:s,tileWidth:Y,tileHeight:v,width:j,height:K,alignVertical:S,alignHorizontal:N,sideOrientation:D});let c=[],H=[],y=[],z=[];const Z=[],B=[],W=[],Q=[];let G=0,r=0;for(let l=0;l<6;l++){const V=x[l].yV.length;B[l]=[],W[l]=[];for(let I=0;I<V/3;I++)B[l].push(new C.m(x[l].yV[3*I],x[l].yV[3*I+1],x[l].yV[3*I+2])),W[l].push(new C.m(x[l].zV[3*I],x[l].zV[3*I+1],x[l].zV[3*I+2]));G=x[l].BV.length,Q[l]=[];for(let m=0;m<G;m+=2)Q[l][m]=I[l].x+(I[l].z-I[l].x)*x[l].BV[m],Q[l][m+1]=I[l].y+(I[l].w-I[l].y)*x[l].BV[m+1],k.e&&(Q[l][m+1]=1-Q[l][m+1]);if(y=y.concat(Q[l]),z=z.concat(x[l].indices.map((V=>V+r))),r+=B[l].length,m)for(let I=0;I<4;I++)Z.push(m[l].r,m[l].g,m[l].b,m[l].a)}const g=new C.m(0,0,n),h=C.b.RotationY(Math.PI);c=B[0].map((V=>C.m.TransformNormal(V,h).add(g))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]),H=W[0].map((V=>C.m.TransformNormal(V,h))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]),c=c.concat(B[1].map((V=>V.Fm(g))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),H=H.concat(W[1].map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const d=new C.m(b,0,0),R=C.b.RotationY(-Math.PI/2);c=c.concat(B[2].map((V=>C.m.TransformNormal(V,R).add(d))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),H=H.concat(W[2].map((V=>C.m.TransformNormal(V,R))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const i=C.b.RotationY(Math.PI/2);c=c.concat(B[3].map((V=>C.m.TransformNormal(V,i).Fm(d))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),H=H.concat(W[3].map((V=>C.m.TransformNormal(V,i))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const q=new C.m(0,T,0),P=C.b.RotationX(Math.PI/2);c=c.concat(B[4].map((V=>C.m.TransformNormal(V,P).add(q))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),H=H.concat(W[4].map((V=>C.m.TransformNormal(V,P))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const u=C.b.RotationX(-Math.PI/2);c=c.concat(B[5].map((V=>C.m.TransformNormal(V,u).Fm(q))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),H=H.concat(W[5].map((V=>C.m.TransformNormal(V,u))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),F.c._ComputeSides(D,c,z,H,y);const o=new F.c;if(o.indices=z,o.yV=c,o.zV=H,o.BV=y,m){const V=D===F.c.DOUBLESIDE?Z.concat(Z):Z;o.ZV=V}return o}function t(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return N(I).QV(C,I.updatable),C}F.c.CreateTiledPlane=O;F.c.CreateTiledBox=N;var D=m(12548),b=m(11596),T=m(11372);function n(V){const I=V.height||2;let m=0===V.diameterTop?0:V.diameterTop||V.diameter||1,s=0===V.diameterBottom?0:V.diameterBottom||V.diameter||1;m=m||1e-5,s=s||1e-5;const j=0|(V.tessellation||24),E=0|(V.subdivisions||1),K=!!V.hasRings,Y=!!V.enclose,O=0===V.cap?0:V.cap||l.c.CAP_ALL,v=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,N=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,t=V.faceUV||new Array(3),D=V.faceColors,b=2+(1+(1!==v&&Y?2:0))*(K?E:1);let n;for(n=0;n<b;n++)D&&void 0===D[n]&&(D[n]=new X.d(1,1,1,1));for(n=0;n<b;n++)t&&void 0===t[n]&&(t[n]=new C.n(0,0,1,1));const x=[],S=[],c=[],H=[],y=[],z=2*Math.PI*v/j;let Z,B,W;const Q=(s-m)/2/I,G=C.m.Zero(),r=C.m.Zero(),g=C.m.Zero(),h=C.m.Zero(),d=C.m.Zero(),R=T.c.Y;let i,q,P,u=1,o=1,p=0,M=0;for(i=0;i<=E;i++)for(B=i/E,W=(B*(m-s)+s)/2,u=K&&0!==i&&i!==E?2:1,P=0;P<u;P++){for(K&&(o+=P),Y&&(o+=2*P),q=0;q<=j;q++)Z=q*z,G.x=Math.cos(-Z)*W,G.y=-I/2+B*I,G.z=Math.sin(-Z)*W,0===m&&i===E?(r.x=c[c.length-3*(j+1)],r.y=c[c.length-3*(j+1)+1],r.z=c[c.length-3*(j+1)+2]):(r.x=G.x,r.z=G.z,r.y=Math.sqrt(r.x*r.x+r.z*r.z)*Q,r.normalize()),0===q&&(g.C(G),h.C(r)),S.push(G.x,G.y,G.z),c.push(r.x,r.y,r.z),M=K?p!==o?t[o].y:t[o].w:t[o].y+(t[o].w-t[o].y)*B,H.push(t[o].x+(t[o].z-t[o].x)*q/j,k.e?1-M:M),D&&y.push(D[o].r,D[o].g,D[o].b,D[o].a);1!==v&&Y&&(S.push(G.x,G.y,G.z),S.push(0,G.y,0),S.push(0,G.y,0),S.push(g.x,g.y,g.z),C.m.CrossToRef(R,r,d),d.normalize(),c.push(d.x,d.y,d.z,d.x,d.y,d.z),C.m.CrossToRef(h,R,d),d.normalize(),c.push(d.x,d.y,d.z,d.x,d.y,d.z),M=K?p!==o?t[o+1].y:t[o+1].w:t[o+1].y+(t[o+1].w-t[o+1].y)*B,H.push(t[o+1].x,k.e?1-M:M),H.push(t[o+1].z,k.e?1-M:M),M=K?p!==o?t[o+2].y:t[o+2].w:t[o+2].y+(t[o+2].w-t[o+2].y)*B,H.push(t[o+2].x,k.e?1-M:M),H.push(t[o+2].z,k.e?1-M:M),D&&(y.push(D[o+1].r,D[o+1].g,D[o+1].b,D[o+1].a),y.push(D[o+1].r,D[o+1].g,D[o+1].b,D[o+1].a),y.push(D[o+2].r,D[o+2].g,D[o+2].b,D[o+2].a),y.push(D[o+2].r,D[o+2].g,D[o+2].b,D[o+2].a))),p!==o&&(p=o)}const f=1!==v&&Y?j+4:j;for(i=0,o=0;o<E;o++){let V=0,I=0,m=0,C=0;for(q=0;q<j;q++)V=i*(f+1)+q,I=(i+1)*(f+1)+q,m=i*(f+1)+(q+1),C=(i+1)*(f+1)+(q+1),x.push(V,I,m),x.push(C,m,I);1!==v&&Y&&(x.push(V+2,I+2,m+2),x.push(C+2,m+2,I+2),x.push(V+4,I+4,m+4),x.push(C+4,m+4,I+4)),i=K?i+2:i+1}const w=V=>{const l=V?m/2:s/2;if(0===l)return;let F,E,K;const Y=V?t[b-1]:t[0];let X=null;D&&(X=V?D[b-1]:D[0]);const O=S.length/3,N=V?I/2:-I/2,T=new C.m(0,N,0);S.push(T.x,T.y,T.z),c.push(0,V?1:-1,0);const n=Y.y+.5*(Y.w-Y.y);H.push(Y.x+.5*(Y.z-Y.x),k.e?1-n:n),X&&y.push(X.r,X.g,X.b,X.a);const z=new C.k(.5,.5);for(K=0;K<=j;K++){F=2*Math.PI*K*v/j;const I=Math.cos(-F),m=Math.sin(-F);E=new C.m(I*l,N,m*l);const s=new C.k(I*z.x+.5,m*z.y+.5);S.push(E.x,E.y,E.z),c.push(0,V?1:-1,0);const O=Y.y+(Y.w-Y.y)*s.y;H.push(Y.x+(Y.z-Y.x)*s.x,k.e?1-O:O),X&&y.push(X.r,X.g,X.b,X.a)}for(K=0;K<j;K++)V?(x.push(O),x.push(O+(K+2)),x.push(O+(K+1))):(x.push(O),x.push(O+(K+1)),x.push(O+(K+2)))};O!==l.c.CAP_START&&O!==l.c.CAP_ALL||w(!1),O!==l.c.CAP_END&&O!==l.c.CAP_ALL||w(!0),F.c._ComputeSides(N,S,x,c,H,V.frontUVs,V.backUVs);const A=new F.c;return A.indices=x,A.yV=S,A.zV=c,A.BV=H,D&&(A.ZV=y),A}function x(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return n(I).QV(C,I.updatable),C}function S(V){const I=[],m=[],l=[],s=[],j=V.diameter||1,E=V.thickness||.5,K=0|(V.tessellation||16),Y=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,X=K+1;for(let F=0;F<=K;F++){const V=F/K,Y=F*Math.PI*2/K-Math.PI/2,O=C.b.Translation(j/2,0,0).multiply(C.b.RotationY(Y));for(let j=0;j<=K;j++){const Y=1-j/K,v=j*Math.PI*2/K+Math.PI,N=Math.cos(v),t=Math.sin(v);let D=new C.m(N,t,0),b=D.scale(E/2);const T=new C.k(V,Y);b=C.m.TransformCoordinates(b,O),D=C.m.TransformNormal(D,O),m.push(b.x,b.y,b.z),l.push(D.x,D.y,D.z),s.push(T.x,k.e?1-T.y:T.y);const n=(F+1)%X,x=(j+1)%X;I.push(F*X+j),I.push(F*X+x),I.push(n*X+j),I.push(F*X+x),I.push(n*X+x),I.push(n*X+j)}}F.c._ComputeSides(Y,m,I,l,s,V.frontUVs,V.backUVs);const O=new F.c;return O.indices=I,O.yV=m,O.zV=l,O.BV=s,O}function c(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return S(I).QV(C,I.updatable),C}F.c.CreateCylinder=n,l.c.CreateCylinder=(V,I,m,C,s,F,k,j,E)=>{void 0!==k&&k instanceof b.e||(void 0!==k&&(E=j||l.c.DEFAULTSIDE,j=k),k=F,F=1);return x(V,{height:I,diameterTop:m,diameterBottom:C,tessellation:s,subdivisions:F,sideOrientation:E,updatable:j},k)};function H(V){const I=[],m=[],l=[],s=[],j=V.radius||2,E=V.tube||.5,K=V.radialSegments||32,Y=V.tubularSegments||32,X=V.p||2,O=V.q||3,v=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,N=V=>{const I=Math.cos(V),m=Math.sin(V),l=O/X*V,s=Math.cos(l),F=j*(2+s)*.5*I,k=j*(2+s)*m*.5,E=j*Math.sin(l)*.5;return new C.m(F,k,E)};let t,D;for(t=0;t<=K;t++){const V=t%K/K*2*X*Math.PI,I=N(V),l=N(V+.01),F=l.Fm(I);let j=l.add(I);const O=C.m.Cross(F,j);for(j=C.m.Cross(O,F),O.normalize(),j.normalize(),D=0;D<Y;D++){const V=D%Y/Y*2*Math.PI,C=-E*Math.cos(V),l=E*Math.sin(V);m.push(I.x+C*j.x+l*O.x),m.push(I.y+C*j.y+l*O.y),m.push(I.z+C*j.z+l*O.z),s.push(t/K),s.push(k.e?1-D/Y:D/Y)}}for(t=0;t<K;t++)for(D=0;D<Y;D++){const V=(D+1)%Y,m=t*Y+D,C=(t+1)*Y+D,l=(t+1)*Y+V,s=t*Y+V;I.push(s),I.push(C),I.push(m),I.push(s),I.push(l),I.push(C)}F.c.ComputeNormals(m,I,l),F.c._ComputeSides(v,m,I,l,s,V.frontUVs,V.backUVs);const b=new F.c;return b.indices=I,b.yV=m,b.zV=l,b.BV=s,b}function y(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return H(I).QV(C,I.updatable),C}F.c.CreateTorus=S,l.c.CreateTorus=(V,I,m,C,l,s,F)=>c(V,{diameter:I,thickness:m,tessellation:C,sideOrientation:F,updatable:s},l);F.c.CreateTorusKnot=H,l.c.CreateTorusKnot=(V,I,m,C,l,s,F,k,j,E)=>y(V,{radius:I,tube:m,radialSegments:C,tubularSegments:l,p:s,q:F,sideOrientation:E,updatable:j},k);var z=m(13082),Z=m(11736),B=m(11498);function W(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=I.path,s=I.shape,F=I.scale||1,k=I.rotation||0,j=0===I.cap?0:I.cap||l.c.NO_CAP,E=I.updatable,K=l.c._GetDefaultSideOrientation(I.sideOrientation),Y=I.instance||null,X=I.invertUV||!1,O=I.closeShape||!1,v=I.closePath||!1,N=I.capFunction||null;return G(V,s,C,F,k,null,null,v,O,j,!1,m,!!E,K,Y,X,I.frontUVs||null,I.backUVs||null,I.firstNormal||null,!!I.adjustFrame,N)}function Q(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=I.path,s=I.shape,F=I.scaleFunction||(()=>1),k=I.rotationFunction||(()=>0),j=I.closePath||I.ribbonCloseArray||!1,E=I.closeShape||I.ribbonClosePath||!1,K=0===I.cap?0:I.cap||l.c.NO_CAP,Y=I.updatable,X=I.firstNormal||null,O=I.adjustFrame||!1,v=l.c._GetDefaultSideOrientation(I.sideOrientation),N=I.instance,t=I.invertUV||!1,D=I.capFunction||null;return G(V,s,C,null,null,F,k,j,E,K,!0,m,!!Y,v,N||null,t,I.frontUVs||null,I.backUVs||null,X,O,D||null)}function G(V,I,m,s,F,k,j,K,Y,X,O,v,N,t,D,b,T,n,x,S,c){const H=(V,I,m,s,F,k,j,E,K,Y,X)=>{const O=m.getTangents(),v=m.getNormals(),N=m.getBinormals(),t=m.getDistances();if(X)for(let l=0;l<O.length;l++)if(0==O[l].x&&0==O[l].y&&0==O[l].z&&O[l].C(O[l-1]),0==v[l].x&&0==v[l].y&&0==v[l].z&&v[l].C(v[l-1]),0==N[l].x&&0==N[l].y&&0==N[l].z&&N[l].C(N[l-1]),l>0){let V=O[l-1];C.m.Dot(V,O[l])<0&&O[l].scaleInPlace(-1),V=v[l-1],C.m.Dot(V,v[l])<0&&v[l].scaleInPlace(-1),V=N[l-1],C.m.Dot(V,N[l])<0&&N[l].scaleInPlace(-1)}let D=0;const b=Y&&E?E:()=>null!==k?k:0,T=Y&&j?j:()=>null!==F?F:1;let n=K===l.c.NO_CAP||K===l.c.CAP_END?0:2;const x=C.g.Matrix[0];for(let l=0;l<I.length;l++){const m=[],F=b(l,t[l]),k=T(l,t[l]);C.b.RotationAxisToRef(O[l],D,x);for(let s=0;s<V.length;s++){const F=O[l].scale(V[s].z).add(v[l].scale(V[s].x)).add(N[l].scale(V[s].y)),j=C.m.Zero();C.m.TransformCoordinatesToRef(F,x,j),j.scaleInPlace(k).addInPlace(I[l]),m[s]=j}s[n]=m,D+=F,n++}const S=c||(V=>{const I=Array(),m=C.m.Zero();let l;for(l=0;l<V.length;l++)m.addInPlace(V[l]);for(m.scaleInPlace(1/V.length),l=0;l<V.length;l++)I.push(m);return I});switch(K){case l.c.NO_CAP:break;case l.c.CAP_START:s[0]=S(s[2]),s[1]=s[2];break;case l.c.CAP_END:s[n]=s[n-1],s[n+1]=S(s[n-1]);break;case l.c.CAP_ALL:s[0]=S(s[2]),s[1]=s[2],s[n]=s[n-1],s[n+1]=S(s[n-1])}return s};let y,z;if(D){const V=D._creationDataStorage;return y=x?V.path3D.update(m,x):V.path3D.update(m),z=H(I,m,V.path3D,V.pathArray,s,F,k,j,V.cap,O,S),D=E("",{pathArray:z,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:D},v||void 0)}y=x?new B.j(m,x):new B.j(m);z=H(I,m,y,new Array,s,F,k,j,X=X<0||X>3?0:X,O,S);const Z=E(V,{pathArray:z,closeArray:K,closePath:Y,updatable:N,sideOrientation:t,invertUV:b,frontUVs:T||void 0,backUVs:n||void 0},v);return Z._creationDataStorage.pathArray=z,Z._creationDataStorage.path3D=y,Z._creationDataStorage.cap=X,Z}function r(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=I.arc?I.arc<=0||I.arc>1?1:I.arc:1,F=void 0===I.closed||I.closed,k=I.shape,j=I.radius||1,K=I.tessellation||64,Y=I.clip||0,X=I.updatable,O=l.c._GetDefaultSideOrientation(I.sideOrientation),v=I.cap||l.c.NO_CAP,N=2*Math.PI,t=[],D=I.invertUV||!1;let b=0,T=0;const n=N/K*s;let x,S;for(b=0;b<=K-Y;b++){for(S=[],v!=l.c.CAP_START&&v!=l.c.CAP_ALL||(S.push(new C.m(0,k[0].y,0)),S.push(new C.m(Math.cos(b*n)*k[0].x*j,k[0].y,Math.sin(b*n)*k[0].x*j))),T=0;T<k.length;T++)x=new C.m(Math.cos(b*n)*k[T].x*j,k[T].y,Math.sin(b*n)*k[T].x*j),S.push(x);v!=l.c.CAP_END&&v!=l.c.CAP_ALL||(S.push(new C.m(Math.cos(b*n)*k[k.length-1].x*j,k[k.length-1].y,Math.sin(b*n)*k[k.length-1].x*j)),S.push(new C.m(0,k[k.length-1].y,0))),t.push(S)}return E(V,{pathArray:t,closeArray:F,sideOrientation:O,updatable:X,invertUV:D,frontUVs:I.frontUVs,backUVs:I.backUVs},m)}l.c.ExtrudeShape=function(V,I,m,C,s,F){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,K=arguments.length>9?arguments[9]:void 0;return W(V,{shape:I,path:m,scale:C,rotation:s,cap:0===F?0:F||l.c.NO_CAP,sideOrientation:E,instance:K,updatable:j},k)},l.c.ExtrudeShapeCustom=(V,I,m,C,s,F,k,j,E,K,Y,X)=>Q(V,{shape:I,path:m,scaleFunction:C,rotationFunction:s,ribbonCloseArray:F,ribbonClosePath:k,cap:0===j?0:j||l.c.NO_CAP,sideOrientation:Y,instance:X,updatable:K},E);l.c.CreateLathe=(V,I,m,C,l,s,F)=>r(V,{shape:I,radius:m,tessellation:C,sideOrientation:F,updatable:s},l);var g=m(12448),h=m(12408);function d(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=I.path;let F=I.instance,k=1;void 0!==I.radius?k=I.radius:F&&(k=F._creationDataStorage.radius);const j=I.tessellation||64,K=I.radiusFunction||null;let Y=I.cap||l.c.NO_CAP;const X=I.invertUV||!1,O=I.updatable,v=l.c._GetDefaultSideOrientation(I.sideOrientation);I.arc=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1;const N=(V,I,m,s,F,k,j,E)=>{const K=I.getTangents(),Y=I.getNormals(),X=I.getDistances(),O=2*Math.PI/F*E,v=k||(()=>s);let N,t,D,b;const T=C.g.Matrix[0];let n=j===l.c.NO_CAP||j===l.c.CAP_END?0:2;for(let l=0;l<V.length;l++){t=v(l,X[l]),N=Array(),D=Y[l];for(let I=0;I<F;I++)C.b.RotationAxisToRef(K[l],O*I,T),b=N[I]?N[I]:C.m.Zero(),C.m.TransformCoordinatesToRef(D,T,b),b.scaleInPlace(t).addInPlace(V[l]),N[I]=b;m[n]=N,n++}const x=(I,m)=>{const C=Array();for(let l=0;l<I;l++)C.push(V[m]);return C};switch(j){case l.c.NO_CAP:break;case l.c.CAP_START:m[0]=x(F,0),m[1]=m[2].slice(0);break;case l.c.CAP_END:m[n]=m[n-1].slice(0),m[n+1]=x(F,V.length-1);break;case l.c.CAP_ALL:m[0]=x(F,0),m[1]=m[2].slice(0),m[n]=m[n-1].slice(0),m[n+1]=x(F,V.length-1)}return m};let t,D;if(F){const V=F._creationDataStorage,m=I.arc||V.arc;return t=V.path3D.update(s),D=N(s,t,V.pathArray,k,V.tessellation,K,V.cap,m),F=E("",{pathArray:D,instance:F}),V.path3D=t,V.pathArray=D,V.arc=m,V.radius=k,F}t=new B.j(s);Y=Y<0||Y>3?0:Y,D=N(s,t,new Array,k,j,K,Y,I.arc);const b=E(V,{pathArray:D,closePath:!0,closeArray:!1,updatable:O,sideOrientation:v,invertUV:X,frontUVs:I.frontUVs,backUVs:I.backUVs},m);return b._creationDataStorage.pathArray=D,b._creationDataStorage.path3D=t,b._creationDataStorage.tessellation=j,b._creationDataStorage.cap=Y,b._creationDataStorage.arc=I.arc,b._creationDataStorage.radius=k,b}function R(V){const I=[];I[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},I[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},I[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},I[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},I[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},I[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},I[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},I[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},I[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},I[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},I[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},I[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},I[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},I[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},I[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const m=V.type&&(V.type<0||V.type>=I.length)?0:V.type||0,l=V.size,s=V.sizeX||l||1,j=V.sizeY||l||1,E=V.sizeZ||l||1,K=V.custom||I[m],Y=K.face.length,O=V.faceUV||new Array(Y),v=V.faceColors,N=void 0===V.flat||V.flat,t=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,D=[],b=[],T=[],n=[],x=[];let S=0,c=0;const H=[];let y,z,Z,B,W,Q,G=0,r=0;if(N)for(r=0;r<Y;r++)v&&void 0===v[r]&&(v[r]=new X.d(1,1,1,1)),O&&void 0===O[r]&&(O[r]=new C.n(0,0,1,1));if(N)for(r=0;r<Y;r++){const V=K.face[r].length;for(Z=2*Math.PI/V,B=.5*Math.tan(Z/2),W=.5,G=0;G<V;G++)D.push(K.vertex[K.face[r][G]][0]*s,K.vertex[K.face[r][G]][1]*j,K.vertex[K.face[r][G]][2]*E),H.push(S),S++,y=O[r].x+(O[r].z-O[r].x)*(.5+B),z=O[r].y+(O[r].w-O[r].y)*(W-.5),n.push(y,k.e?1-z:z),Q=B*Math.cos(Z)-W*Math.sin(Z),W=B*Math.sin(Z)+W*Math.cos(Z),B=Q,v&&x.push(v[r].r,v[r].g,v[r].b,v[r].a);for(G=0;G<V-2;G++)b.push(H[0+c],H[G+2+c],H[G+1+c]);c+=V}else{for(G=0;G<K.vertex.length;G++)D.push(K.vertex[G][0]*s,K.vertex[G][1]*j,K.vertex[G][2]*E),n.push(0,k.e?1:0);for(r=0;r<Y;r++)for(G=0;G<K.face[r].length-2;G++)b.push(K.face[r][0],K.face[r][G+2],K.face[r][G+1])}F.c.ComputeNormals(D,b,T),F.c._ComputeSides(t,D,b,T,n,V.frontUVs,V.backUVs);const g=new F.c;return g.yV=D,g.indices=b,g.zV=T,g.BV=n,v&&N&&(g.ZV=x),g}function i(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return R(I).QV(C,I.updatable),C}l.c.CreateTube=(V,I,m,C,l,s,F,k,j,E)=>d(V,{path:I,radius:m,tessellation:C,radiusFunction:l,arc:1,cap:s,updatable:k,sideOrientation:j,instance:E},F);function q(V){const I=V.sideOrientation||F.c.DEFAULTSIDE,m=V.radius||1,l=void 0===V.flat||V.flat,s=0|(V.subdivisions||4),j=V.radiusX||m,E=V.radiusY||m,K=V.radiusZ||m,Y=(1+Math.sqrt(5))/2,X=[-1,Y,-0,1,Y,0,-1,-Y,0,1,-Y,0,0,-1,-Y,0,1,-Y,0,-1,Y,0,1,Y,Y,0,1,Y,0,-1,-Y,0,1,-Y,0,-1],O=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],N=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],t=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],D=[],b=[],T=[],n=[];let x=0;const S=new Array(3),c=new Array(3);let H;for(H=0;H<3;H++)S[H]=C.m.Zero(),c[H]=C.k.Zero();for(let F=0;F<20;F++){for(H=0;H<3;H++){const V=O[3*F+H];S[H].aF(X[3*v[V]],X[3*v[V]+1],X[3*v[V]+2]),S[H].normalize(),c[H].aF(.134765625*N[2*V]+.05859375+-.0390625*t[F],.2333984375*N[2*V+1]+.025390625+.01953125*t[F])}const V=(V,I,m,F)=>{const Y=C.m.Lerp(S[0],S[2],I/s),X=C.m.Lerp(S[1],S[2],I/s),O=s===I?S[2]:C.m.Lerp(Y,X,V/(s-I));let v;if(O.normalize(),l){const V=C.m.Lerp(S[0],S[2],F/s),I=C.m.Lerp(S[1],S[2],F/s);v=C.m.Lerp(V,I,m/(s-F))}else v=new C.m(O.x,O.y,O.z);v.x/=j,v.y/=E,v.z/=K,v.normalize();const N=C.k.Lerp(c[0],c[2],I/s),t=C.k.Lerp(c[1],c[2],I/s),H=s===I?c[2]:C.k.Lerp(N,t,V/(s-I));b.push(O.x*j,O.y*E,O.z*K),T.push(v.x,v.y,v.z),n.push(H.x,k.e?1-H.y:H.y),D.push(x),x++};for(let I=0;I<s;I++)for(let m=0;m+I<s;m++)V(m,I,m+1/3,I+1/3),V(m+1,I,m+1/3,I+1/3),V(m,I+1,m+1/3,I+1/3),m+I+1<s&&(V(m+1,I,m+2/3,I+2/3),V(m+1,I+1,m+2/3,I+2/3),V(m,I+1,m+2/3,I+2/3))}F.c._ComputeSides(I,b,D,T,n,V.frontUVs,V.backUVs);const y=new F.c;return y.indices=D,y.yV=b,y.zV=T,y.BV=n,y}function P(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new l.c(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),C._originalBuilderSideOrientation=I.sideOrientation;return q(I).QV(C,I.updatable),C}F.c.CreatePolyhedron=R,l.c.CreatePolyhedron=(V,I,m)=>i(V,I,m);F.c.CreateIcoSphere=q,l.c.CreateIcoSphere=(V,I,m)=>P(V,I,m);var u=m(11074);const o=new C.m(1,0,0),p=new C.m(-1,0,0),M=new C.m(0,1,0),f=new C.m(0,-1,0),w=new C.m(0,0,1),A=new C.m(0,0,-1);class J{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.m.Zero(),I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.m.Up(),m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.k.Zero(),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=V,this.XC=I,this.uv=m,this.vertexIdx=l,this.vertexIdxForBones=s,this.localPositionOverride=F,this.localNormalOverride=k,this.matrixIndicesOverride=j,this.matrixWeightsOverride=E}clone(){var V,I,m,C;return new J(this.position.clone(),this.XC.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(V=this.localPositionOverride)||void 0===V?void 0:V.slice(),null===(I=this.localNormalOverride)||void 0===I?void 0:I.slice(),null===(m=this.matrixIndicesOverride)||void 0===m?void 0:m.slice(),null===(C=this.matrixWeightsOverride)||void 0===C?void 0:C.slice())}}function U(V,I,m){var j,E,K,Y,X;const O=!!I.skeleton,v=!(null===(j=I.morphTargetManager)||void 0===j||!j.numTargets),N=m.localMode||O,t=I.AF(),D=O||v?I.Hk(!0,!0):I.getVerticesData(s.e.PositionKind),b=O||v?I.getNormalsData(!0,!0):I.getVerticesData(s.e.NormalKind),T=N?O?I.getVerticesData(s.e.PositionKind):D:null,n=N?O?I.getVerticesData(s.e.NormalKind):b:null,x=I.getVerticesData(s.e.UVKind),S=O?I.getVerticesData(s.e.MatricesIndicesKind):null,c=O?I.getVerticesData(s.e.MatricesWeightsKind):null,H=O?I.getVerticesData(s.e.MatricesIndicesExtraKind):null,y=O?I.getVerticesData(s.e.MatricesWeightsExtraKind):null,z=m.position||C.m.Zero();let Z=m.XC||C.m.Up();const B=m.size||C.m.One(),W=m.angle||0;if(!Z){const V=new C.m(0,0,1),m=I.cV().activeCamera,l=C.m.TransformCoordinates(V,m.getWorldMatrix());Z=m.globalPosition.Fm(l)}const Q=-Math.atan2(Z.z,Z.x)-Math.PI/2,G=Math.sqrt(Z.x*Z.x+Z.z*Z.z),r=Math.atan2(Z.y,G),g=new F.c;g.indices=[],g.yV=[],g.zV=[],g.BV=[],g.matricesIndices=O?[]:null,g.matricesWeights=O?[]:null,g.matricesIndicesExtra=H?[]:null,g.matricesWeightsExtra=y?[]:null;let h=0;const d=(V,I)=>{const l=new J;if(!t||!D||!b)return l;const s=t[V];if(l.vertexIdx=3*s,l.vertexIdxForBones=4*s,l.position=new C.m(D[3*s],D[3*s+1],D[3*s+2]),C.m.TransformCoordinatesToRef(l.position,I,l.position),l.XC=new C.m(b[3*s],b[3*s+1],b[3*s+2]),C.m.TransformNormalToRef(l.XC,I,l.XC),m.captureUVS&&x){const V=x[2*s+1];l.uv=new C.k(x[2*s],k.e?1-V:V)}return l},R=[0,0,0,0],i=(V,I)=>{if(0===V.length)return V;const m=.5*Math.abs(C.m.Dot(B,I)),l=(V,I,m,C)=>{for(let l=0;l<C;++l)if(V[m+l]===I)return m+l;return-1},s=(V,s)=>{const F=C.m.GetClipFactor(V.position,s.position,I,m);let k=R,j=R;if(S&&c){const I=V.matrixIndicesOverride?0:V.vertexIdxForBones,m=V.matrixIndicesOverride??S,C=V.matrixWeightsOverride??c,E=s.matrixIndicesOverride?0:s.vertexIdxForBones,K=s.matrixIndicesOverride??S,Y=s.matrixWeightsOverride??c;k=[0,0,0,0],j=[0,0,0,0];let X=0;for(let V=0;V<4;++V)if(C[I+V]>0){const s=l(K,m[I+V],E,4);k[X]=m[I+V],j[X]=(0,u.Lerp)(C[I+V],s>=0?Y[s]:0,F),X++}for(let V=0;V<4&&X<4;++V){const C=K[E+V];-1===l(m,C,I,4)&&(k[X]=C,j[X]=(0,u.Lerp)(0,Y[E+V],F),X++)}const O=j[0]+j[1]+j[2]+j[3];j[0]/=O,j[1]/=O,j[2]/=O,j[3]/=O}const E=V.localPositionOverride?V.localPositionOverride[0]:(null===T||void 0===T?void 0:T[V.vertexIdx])??0,K=V.localPositionOverride?V.localPositionOverride[1]:(null===T||void 0===T?void 0:T[V.vertexIdx+1])??0,Y=V.localPositionOverride?V.localPositionOverride[2]:(null===T||void 0===T?void 0:T[V.vertexIdx+2])??0,X=s.localPositionOverride?s.localPositionOverride[0]:(null===T||void 0===T?void 0:T[s.vertexIdx])??0,O=s.localPositionOverride?s.localPositionOverride[1]:(null===T||void 0===T?void 0:T[s.vertexIdx+1])??0,v=s.localPositionOverride?s.localPositionOverride[2]:(null===T||void 0===T?void 0:T[s.vertexIdx+2])??0,N=V.localNormalOverride?V.localNormalOverride[0]:(null===n||void 0===n?void 0:n[V.vertexIdx])??0,t=V.localNormalOverride?V.localNormalOverride[1]:(null===n||void 0===n?void 0:n[V.vertexIdx+1])??0,D=V.localNormalOverride?V.localNormalOverride[2]:(null===n||void 0===n?void 0:n[V.vertexIdx+2])??0,b=N+((s.localNormalOverride?s.localNormalOverride[0]:(null===n||void 0===n?void 0:n[s.vertexIdx])??0)-N)*F,x=t+((s.localNormalOverride?s.localNormalOverride[1]:(null===n||void 0===n?void 0:n[s.vertexIdx+1])??0)-t)*F,H=D+((s.localNormalOverride?s.localNormalOverride[2]:(null===n||void 0===n?void 0:n[s.vertexIdx+2])??0)-D)*F,y=Math.sqrt(b*b+x*x+H*H);return new J(C.m.Lerp(V.position,s.position,F),C.m.Lerp(V.XC,s.XC,F).normalize(),C.k.Lerp(V.uv,s.uv,F),-1,-1,T?[E+(X-E)*F,K+(O-K)*F,Y+(v-Y)*F]:null,n?[b/y,x/y,H/y]:null,k,j)};let F=null;V.length>3&&(F=[]);for(let k=0;k<V.length;k+=3){let l=0,j=null,E=null,K=null,Y=null;const X=C.m.Dot(V[k].position,I)-m>0,O=C.m.Dot(V[k+1].position,I)-m>0,v=C.m.Dot(V[k+2].position,I)-m>0;switch(l=(X?1:0)+(O?1:0)+(v?1:0),l){case 0:V.length>3?(F.push(V[k]),F.push(V[k+1]),F.push(V[k+2])):F=V;break;case 1:if(F=F??new Array,X&&(j=V[k+1],E=V[k+2],K=s(V[k],j),Y=s(V[k],E)),O){j=V[k],E=V[k+2],K=s(V[k+1],j),Y=s(V[k+1],E),F.push(K),F.push(E.clone()),F.push(j.clone()),F.push(E.clone()),F.push(K.clone()),F.push(Y);break}v&&(j=V[k],E=V[k+1],K=s(V[k+2],j),Y=s(V[k+2],E)),j&&E&&K&&Y&&(F.push(j.clone()),F.push(E.clone()),F.push(K),F.push(Y),F.push(K.clone()),F.push(E.clone()));break;case 2:F=F??new Array,X||(j=V[k].clone(),E=s(j,V[k+1]),K=s(j,V[k+2]),F.push(j),F.push(E),F.push(K)),O||(j=V[k+1].clone(),E=s(j,V[k+2]),K=s(j,V[k]),F.push(j),F.push(E),F.push(K)),v||(j=V[k+2].clone(),E=s(j,V[k]),K=s(j,V[k+1]),F.push(j),F.push(E),F.push(K))}}return F},q=I instanceof l.c?I:null,P=null===q||void 0===q?void 0:q._thinInstanceDataStorage.matrixData,U=(null===q||void 0===q?void 0:q.Ek)||1,e=C.g.Matrix[0];e.C(C.b.IdentityReadOnly);for(let l=0;l<U;++l){if(null!==q&&void 0!==q&&q.hasThinInstances&&P){const V=16*l;e.setRowFromFloats(0,P[V+0],P[V+1],P[V+2],P[V+3]),e.setRowFromFloats(1,P[V+4],P[V+5],P[V+6],P[V+7]),e.setRowFromFloats(2,P[V+8],P[V+9],P[V+10],P[V+11]),e.setRowFromFloats(3,P[V+12],P[V+13],P[V+14],P[V+15])}const V=C.b.RotationYawPitchRoll(Q,r,W).multiply(C.b.Translation(z.x,z.y,z.z)),s=C.b.Invert(V),F=I.getWorldMatrix(),j=e.multiply(F).multiply(s),E=new Array(3);for(let I=0;I<t.length;I+=3){let V=E;if(V[0]=d(I,j),V[1]=d(I+1,j),V[2]=d(I+2,j),!(m.cullBackFaces&&-V[0].XC.z<=0&&-V[1].XC.z<=0&&-V[2].XC.z<=0)&&(V=i(V,o),V&&(V=i(V,p),V&&(V=i(V,M),V&&(V=i(V,f),V&&(V=i(V,w),V&&(V=i(V,A),V)))))))for(let I=0;I<V.length;I++){const C=V[I];if(g.indices.push(h),N?(C.localPositionOverride?(g.yV[3*h]=C.localPositionOverride[0],g.yV[3*h+1]=C.localPositionOverride[1],g.yV[3*h+2]=C.localPositionOverride[2]):T&&(g.yV[3*h]=T[C.vertexIdx],g.yV[3*h+1]=T[C.vertexIdx+1],g.yV[3*h+2]=T[C.vertexIdx+2]),C.localNormalOverride?(g.zV[3*h]=C.localNormalOverride[0],g.zV[3*h+1]=C.localNormalOverride[1],g.zV[3*h+2]=C.localNormalOverride[2]):n&&(g.zV[3*h]=n[C.vertexIdx],g.zV[3*h+1]=n[C.vertexIdx+1],g.zV[3*h+2]=n[C.vertexIdx+2])):(C.position.toArray(g.yV,3*h),C.XC.toArray(g.zV,3*h)),g.matricesIndices&&g.matricesWeights&&(C.matrixIndicesOverride?(g.matricesIndices[4*h]=C.matrixIndicesOverride[0],g.matricesIndices[4*h+1]=C.matrixIndicesOverride[1],g.matricesIndices[4*h+2]=C.matrixIndicesOverride[2],g.matricesIndices[4*h+3]=C.matrixIndicesOverride[3]):(S&&(g.matricesIndices[4*h]=S[C.vertexIdxForBones],g.matricesIndices[4*h+1]=S[C.vertexIdxForBones+1],g.matricesIndices[4*h+2]=S[C.vertexIdxForBones+2],g.matricesIndices[4*h+3]=S[C.vertexIdxForBones+3]),H&&g.matricesIndicesExtra&&(g.matricesIndicesExtra[4*h]=H[C.vertexIdxForBones],g.matricesIndicesExtra[4*h+1]=H[C.vertexIdxForBones+1],g.matricesIndicesExtra[4*h+2]=H[C.vertexIdxForBones+2],g.matricesIndicesExtra[4*h+3]=H[C.vertexIdxForBones+3])),C.matrixWeightsOverride?(g.matricesWeights[4*h]=C.matrixWeightsOverride[0],g.matricesWeights[4*h+1]=C.matrixWeightsOverride[1],g.matricesWeights[4*h+2]=C.matrixWeightsOverride[2],g.matricesWeights[4*h+3]=C.matrixWeightsOverride[3]):(c&&(g.matricesWeights[4*h]=c[C.vertexIdxForBones],g.matricesWeights[4*h+1]=c[C.vertexIdxForBones+1],g.matricesWeights[4*h+2]=c[C.vertexIdxForBones+2],g.matricesWeights[4*h+3]=c[C.vertexIdxForBones+3]),y&&g.matricesWeightsExtra&&(g.matricesWeightsExtra[4*h]=y[C.vertexIdxForBones],g.matricesWeightsExtra[4*h+1]=y[C.vertexIdxForBones+1],g.matricesWeightsExtra[4*h+2]=y[C.vertexIdxForBones+2],g.matricesWeightsExtra[4*h+3]=y[C.vertexIdxForBones+3]))),m.captureUVS)C.uv.toArray(g.BV,2*h);else{g.BV.push(.5+C.position.x/B.x);const V=.5+C.position.y/B.y;g.BV.push(k.e?1-V:V)}h++}}}0===g.indices.length&&(g.indices=null),0===g.yV.length&&(g.yV=null),0===g.zV.length&&(g.zV=null),0===g.BV.length&&(g.BV=null),0===(null===(E=g.matricesIndices)||void 0===E?void 0:E.length)&&(g.matricesIndices=null),0===(null===(K=g.matricesWeights)||void 0===K?void 0:K.length)&&(g.matricesWeights=null),0===(null===(Y=g.matricesIndicesExtra)||void 0===Y?void 0:Y.length)&&(g.matricesIndicesExtra=null),0===(null===(X=g.matricesWeightsExtra)||void 0===X?void 0:X.length)&&(g.matricesWeightsExtra=null);const a=new l.c(V,I.cV());return g.QV(a),N?(a.skeleton=I.skeleton,a.parent=I):(a.position=z.clone(),a.rotation=new C.m(r,Q,W)),a.fF(!0),a.refreshBoundingInfo(!0,!0),a}function e(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const I=0|Math.max(V.subdivisions?V.subdivisions:2,1),m=0|Math.max(V.tessellation?V.tessellation:16,3),l=Math.max(V.height?V.height:1,0),s=Math.max(V.radius?V.radius:.25,0),j=0|Math.max(V.capSubdivisions?V.capSubdivisions:6,1),E=m,K=I,Y=Math.max(V.radiusTop?V.radiusTop:s,0),X=Math.max(V.radiusBottom?V.radiusBottom:s,0),O=l-(Y+X),v=2*Math.PI,N=Math.max(V.topCapSubdivisions?V.topCapSubdivisions:j,1),t=Math.max(V.bottomCapSubdivisions?V.bottomCapSubdivisions:j,1),D=Math.acos((X-Y)/l);let b=[];const T=[],n=[],x=[];let S=0;const c=[],H=.5*O,y=.5*Math.PI;let z,Z;const B=C.m.Zero(),W=C.m.Zero(),Q=Math.cos(D),G=Math.sin(D),r=new C.k(Y*G,H+Y*Q).Fm(new C.k(X*G,X*Q-H)).length(),g=Y*D+r+X*(y-D);let h=0;for(Z=0;Z<=N;Z++){const V=[],I=y-D*(Z/N);h+=Y*D/N;const m=Math.cos(I),C=Math.sin(I),l=m*Y;for(z=0;z<=E;z++){const I=z/E,s=I*v+0,F=Math.sin(s),j=Math.cos(s);W.x=l*F,W.y=H+C*Y,W.z=l*j,T.push(W.x,W.y,W.z),B.set(m*F,C,m*j),n.push(B.x,B.y,B.z),x.push(I,k.e?h/g:1-h/g),V.push(S),S++}c.push(V)}const d=l-Y-X+Q*Y-Q*X,R=G*(X-Y)/d;for(Z=1;Z<=K;Z++){const V=[];h+=r/K;const I=G*(Z*(X-Y)/K+Y);for(z=0;z<=E;z++){const m=z/E,C=m*v+0,l=Math.sin(C),s=Math.cos(C);W.x=I*l,W.y=H+Q*Y-Z*d/K,W.z=I*s,T.push(W.x,W.y,W.z),B.set(l,R,s).normalize(),n.push(B.x,B.y,B.z),x.push(m,k.e?h/g:1-h/g),V.push(S),S++}c.push(V)}for(Z=1;Z<=t;Z++){const V=[],I=y-D-(Math.PI-D)*(Z/t);h+=X*D/t;const m=Math.cos(I),C=Math.sin(I),l=m*X;for(z=0;z<=E;z++){const I=z/E,s=I*v+0,F=Math.sin(s),j=Math.cos(s);W.x=l*F,W.y=C*X-H,W.z=l*j,T.push(W.x,W.y,W.z),B.set(m*F,C,m*j),n.push(B.x,B.y,B.z),x.push(I,k.e?h/g:1-h/g),V.push(S),S++}c.push(V)}for(z=0;z<E;z++)for(Z=0;Z<N+K+t;Z++){const V=c[Z][z],I=c[Z+1][z],m=c[Z+1][z+1],C=c[Z][z+1];b.push(V),b.push(I),b.push(C),b.push(I),b.push(m),b.push(C)}if(b=b.reverse(),V.orientation&&!V.orientation.equals(C.m.Up())){const I=new C.b;V.orientation.clone().scale(.5*Math.PI).cross(C.m.Up()).toQuaternion().toRotationMatrix(I);const m=C.m.Zero();for(let V=0;V<T.length;V+=3)m.set(T[V],T[V+1],T[V+2]),C.m.TransformCoordinatesToRef(m.clone(),I,m),T[V]=m.x,T[V+1]=m.y,T[V+2]=m.z}const i=new F.c;return i.yV=T,i.zV=n,i.BV=x,i.indices=b,i}function a(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:C.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new l.c(V,m);return e(I).QV(s,I.updatable),s}l.c.CreateDecal=(V,I,m,C,l,s)=>U(V,I,{position:m,XC:C,size:l,angle:s});l.c.CreateCapsule=(V,I,m)=>a(V,I,m),F.c.CreateCapsule=e;var L=m(11085),VV=m(11044);class IV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=I,V!==Math.floor(V)&&(V=Math.floor(V),L.d.Warn("x is not an integer, floor(x) used")),I!==Math.floor(I)&&(I=Math.floor(I),L.d.Warn("y is not an integer, floor(y) used"))}clone(){return new IV(this.x,this.y)}rotate60About(V){const I=this.x;return this.x=V.x+V.y-this.y,this.y=I+this.y-V.x,this}rotateNeg60About(V){const I=this.x;return this.x=I+this.y-V.y,this.y=V.x+V.y-I,this}rotate120(V,I){V!==Math.floor(V)&&(V=Math.floor(V),L.d.Warn("m not an integer only floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),L.d.Warn("n not an integer only floor(n) used"));const m=this.x;return this.x=V-m-this.y,this.y=I+m,this}rotateNeg120(V,I){V!==Math.floor(V)&&(V=Math.floor(V),L.d.Warn("m is not an integer, floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),L.d.Warn("n is not an integer,   floor(n) used"));const m=this.x;return this.x=this.y-I,this.y=V+I-m-this.y,this}toCartesianOrigin(V,I){const m=C.m.Zero();return m.x=V.x+2*this.x*I+this.y*I,m.y=V.y+Math.sqrt(3)*this.y*I,m}static Zero(){return new IV(0,0)}}class mV{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new CV("icosahedron","Regular",[[0,VV.g,-1],[-VV.g,1,0],[-1,0,-VV.g],[1,0,-VV.g],[VV.g,1,0],[0,VV.g,1],[-1,0,VV.g],[-VV.g,-1,0],[0,-VV.g,-1],[VV.g,-1,0],[1,0,VV.g],[0,-VV.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let V=12;const I={},m=this.m,C=this.n;let l,s,F,k,j,E=m,K=1,Y=0;0!==C&&(E=(0,u.HighestCommonFactor)(m,C)),K=m/E,Y=C/E;const X=IV.Zero(),O=new IV(m,C),v=new IV(-C,m+C),N=IV.Zero(),t=IV.Zero(),D=IV.Zero();let b,T,n,x,S=[];const c=[],H=this.vertByDist,y=(m,C,l,s)=>{b=m+"|"+l,T=C+"|"+s,b in I||T in I?b in I&&!(T in I)?I[T]=I[b]:T in I&&!(b in I)&&(I[b]=I[T]):(I[b]=V,I[T]=V,V++),H[l][0]>2?c[I[b]]=[-H[l][0],H[l][1],I[b]]:c[I[b]]=[S[H[l][0]],H[l][1],I[b]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let z=0;z<20;z++){if(S=this.IDATA.face[z],F=S[2],k=S[1],j=S[0],n=X.x+"|"+X.y,b=z+"|"+n,b in I||(I[b]=F,c[F]=[S[H[n][0]],H[n][1]]),n=O.x+"|"+O.y,b=z+"|"+n,b in I||(I[b]=k,c[k]=[S[H[n][0]],H[n][1]]),n=v.x+"|"+v.y,b=z+"|"+n,b in I||(I[b]=j,c[j]=[S[H[n][0]],H[n][1]]),l=this.IDATA.edgematch[z][0],s=this.IDATA.edgematch[z][1],"B"===s)for(let V=1;V<E;V++)t.x=m-V*(K+Y),t.y=C+V*K,D.x=-V*Y,D.y=V*(K+Y),n=t.x+"|"+t.y,x=D.x+"|"+D.y,y(z,l,n,x);if("O"===s)for(let V=1;V<E;V++)D.x=-V*Y,D.y=V*(K+Y),N.x=V*K,N.y=V*Y,n=D.x+"|"+D.y,x=N.x+"|"+N.y,y(z,l,n,x);if(l=this.IDATA.edgematch[z][2],s=this.IDATA.edgematch[z][3],s&&"A"===s)for(let V=1;V<E;V++)N.x=V*K,N.y=V*Y,t.x=m-(E-V)*(K+Y),t.y=C+(E-V)*K,n=N.x+"|"+N.y,x=t.x+"|"+t.y,y(z,l,n,x);for(let m=0;m<this.vertices.length;m++)n=this.vertices[m].x+"|"+this.vertices[m].y,b=z+"|"+n,b in I||(I[b]=V++,H[n][0]>2?c[I[b]]=[-H[n][0],H[n][1],I[b]]:c[I[b]]=[S[H[n][0]],H[n][1],I[b]])}this.closestTo=c,this.vecToidx=I}calcCoeffs(){const V=this.m,I=this.n,m=Math.sqrt(3)/3,C=V*V+I*I+V*I;this.coau=(V+I)/C,this.cobu=-I/C,this.coav=-m*(V-I)/C,this.cobv=m*(2*V+I)/C}createInnerFacets(){const V=this.m,I=this.n;for(let m=0;m<I+V+1;m++)for(let V=this.min[m];V<this.max[m]+1;V++)V<this.max[m]&&V<this.max[m+1]+1&&this.innerFacets.push(["|"+V+"|"+m,"|"+V+"|"+(m+1),"|"+(V+1)+"|"+m]),m>0&&V<this.max[m-1]&&V+1<this.max[m]+1&&this.innerFacets.push(["|"+V+"|"+m,"|"+(V+1)+"|"+m,"|"+(V+1)+"|"+(m-1)])}edgeVecsABOB(){const V=this.m,I=this.n,m=new IV(-I,V+I);for(let C=1;C<V+I;C++){const V=new IV(this.min[C],C),I=new IV(this.min[C-1],C-1),l=new IV(this.min[C+1],C+1),s=V.clone(),F=I.clone(),k=l.clone();s.rotate60About(m),F.rotate60About(m),k.rotate60About(m);const j=new IV(this.max[s.y],s.y),E=new IV(this.max[s.y-1],s.y-1),K=new IV(this.max[s.y-1]-1,s.y-1);s.x===j.x&&s.y===j.y||(s.x!==E.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,E,K]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,K,j])):s.y===k.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,I,E]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([V,E,l])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,I,E]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,E,j])))}}mapABOBtoOBOA(){const V=new IV(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const m=[];for(let C=0;C<3;C++)V.x=this.isoVecsABOB[I][C].x,V.y=this.isoVecsABOB[I][C].y,0===this.vertexTypes[I][C]&&V.rotateNeg120(this.m,this.n),m.push(V.clone());this.isoVecsOBOA.push(m)}}mapABOBtoBAOA(){const V=new IV(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const m=[];for(let C=0;C<3;C++)V.x=this.isoVecsABOB[I][C].x,V.y=this.isoVecsABOB[I][C].y,1===this.vertexTypes[I][C]&&V.rotate120(this.m,this.n),m.push(V.clone());this.isoVecsBAOA.push(m)}}MapToFace(V,I){const m=this.IDATA.face[V],l=m[2],s=m[1],F=m[0],k=C.m.Ik(this.IDATA.vertex[l]),j=C.m.Ik(this.IDATA.vertex[s]),E=C.m.Ik(this.IDATA.vertex[F]),K=j.Fm(k),Y=E.Fm(k),X=K.scale(this.coau).add(Y.scale(this.cobu)),O=K.scale(this.coav).add(Y.scale(this.cobv)),v=[];let N,t=C.g.LF[0];for(let C=0;C<this.cartesian.length;C++)t=X.scale(this.cartesian[C].x).add(O.scale(this.cartesian[C].y)).add(k),v[C]=[t.x,t.y,t.z],N=V+"|"+this.vertices[C].x+"|"+this.vertices[C].y,I.vertex[this.vecToidx[N]]=[t.x,t.y,t.z]}build(V,I){const m=[],C=IV.Zero(),l=new IV(V,I),s=new IV(-I,V+I);m.push(C,l,s);for(let n=I;n<V+1;n++)for(let I=0;I<V+1-n;I++)m.push(new IV(I,n));if(I>0){const C=(0,u.HighestCommonFactor)(V,I),l=V/C,s=I/C;for(let k=1;k<C;k++)m.push(new IV(k*l,k*s)),m.push(new IV(-k*s,k*(l+s))),m.push(new IV(V-k*(l+s),I+k*l));const F=V/I;for(let k=1;k<I;k++)for(let C=0;C<k*F;C++)m.push(new IV(C,k)),m.push(new IV(C,k).rotate120(V,I)),m.push(new IV(C,k).rotateNeg120(V,I))}m.sort(((V,I)=>V.x-I.x)),m.sort(((V,I)=>V.y-I.y));const F=new Array(V+I+1),k=new Array(V+I+1);for(let n=0;n<F.length;n++)F[n]=1/0,k[n]=-1/0;let j=0,E=0;const K=m.length;for(let n=0;n<K;n++)E=m[n].x,j=m[n].y,F[j]=Math.min(E,F[j]),k[j]=Math.max(E,k[j]);const Y=(m,C)=>{const l=m.clone();return"A"===C&&l.rotateNeg120(V,I),"B"===C&&l.rotate120(V,I),l.x<0?l.y:l.x+l.y},X=[],O=[],v=[],N=[],t={},D=[];let b=-1,T=-1;for(let n=0;n<K;n++)X[n]=m[n].toCartesianOrigin(new IV(0,0),.5),O[n]=Y(m[n],"O"),v[n]=Y(m[n],"A"),N[n]=Y(m[n],"B"),O[n]===v[n]&&v[n]===N[n]?(b=3,T=O[n]):O[n]===v[n]?(b=4,T=O[n]):v[n]===N[n]?(b=5,T=v[n]):N[n]===O[n]&&(b=6,T=O[n]),O[n]<v[n]&&O[n]<N[n]&&(b=2,T=O[n]),v[n]<O[n]&&v[n]<N[n]&&(b=1,T=v[n]),N[n]<v[n]&&N[n]<O[n]&&(b=0,T=N[n]),D.push([b,T,m[n].x,m[n].y]);D.sort(((V,I)=>V[2]-I[2])),D.sort(((V,I)=>V[3]-I[3])),D.sort(((V,I)=>V[1]-I[1])),D.sort(((V,I)=>V[0]-I[0]));for(let n=0;n<D.length;n++)t[D[n][2]+"|"+D[n][3]]=[D[n][0],D[n][1],n];return this.m=V,this.n=I,this.vertices=m,this.vertByDist=t,this.cartesian=X,this.min=F,this.max=k,this}}class CV{constructor(V,I,m,C){this.name=V,this.category=I,this.vertex=m,this.face=C}}class lV extends CV{innerToData(V,I){for(let m=0;m<I.innerFacets.length;m++)this.face.push(I.innerFacets[m].map((m=>I.vecToidx[V+m])))}mapABOBtoDATA(V,I){const m=I.IDATA.edgematch[V][0];for(let C=0;C<I.isoVecsABOB.length;C++){const l=[];for(let s=0;s<3;s++)0===I.vertexTypes[C][s]?l.push(V+"|"+I.isoVecsABOB[C][s].x+"|"+I.isoVecsABOB[C][s].y):l.push(m+"|"+I.isoVecsABOB[C][s].x+"|"+I.isoVecsABOB[C][s].y);this.face.push([I.vecToidx[l[0]],I.vecToidx[l[1]],I.vecToidx[l[2]]])}}mapOBOAtoDATA(V,I){const m=I.IDATA.edgematch[V][0];for(let C=0;C<I.isoVecsOBOA.length;C++){const l=[];for(let s=0;s<3;s++)1===I.vertexTypes[C][s]?l.push(V+"|"+I.isoVecsOBOA[C][s].x+"|"+I.isoVecsOBOA[C][s].y):l.push(m+"|"+I.isoVecsOBOA[C][s].x+"|"+I.isoVecsOBOA[C][s].y);this.face.push([I.vecToidx[l[0]],I.vecToidx[l[1]],I.vecToidx[l[2]]])}}mapBAOAtoDATA(V,I){const m=I.IDATA.edgematch[V][2];for(let C=0;C<I.isoVecsBAOA.length;C++){const l=[];for(let s=0;s<3;s++)1===I.vertexTypes[C][s]?l.push(V+"|"+I.isoVecsBAOA[C][s].x+"|"+I.isoVecsBAOA[C][s].y):l.push(m+"|"+I.isoVecsBAOA[C][s].x+"|"+I.isoVecsBAOA[C][s].y);this.face.push([I.vecToidx[l[0]],I.vecToidx[l[1]],I.vecToidx[l[2]]])}}orderData(V){const I=[];for(let s=0;s<13;s++)I[s]=[];const m=V.closestTo;for(let s=0;s<m.length;s++)m[s][0]>-1?m[s][1]>0&&I[m[s][0]].push([s,m[s][1]]):I[12].push([s,m[s][0]]);const C=[];for(let s=0;s<12;s++)C[s]=s;let l=12;for(let s=0;s<12;s++){I[s].sort(((V,I)=>V[1]-I[1]));for(let V=0;V<I[s].length;V++)C[I[s][V][0]]=l++}for(let s=0;s<I[12].length;s++)C[I[12][s][0]]=l++;for(let s=0;s<this.vertex.length;s++)this.vertex[s].push(C[s]);this.vertex.sort(((V,I)=>V[3]-I[3]));for(let s=0;s<this.vertex.length;s++)this.vertex[s].pop();for(let s=0;s<this.face.length;s++)for(let V=0;V<this.face[s].length;V++)this.face[s][V]=C[this.face[s][V]];this.sharedNodes=I[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(V,I){const m=[],C=[];let l=I.pop();C.push(l);let s=this.face[l].indexOf(V);s=(s+2)%3;let F=this.face[l][s];m.push(F);let k=0;for(;I.length>0;)l=I[k],this.face[l].indexOf(F)>-1?(s=(this.face[l].indexOf(F)+1)%3,F=this.face[l][s],m.push(F),C.push(l),I.splice(k,1),k=0):k++;return this.adjacentFaces.push(m),C}toGoldbergPolyhedronData(){const V=new CV("GeoDual","Goldberg",[],[]);V.name="GD dual";const I=this.vertex.length,m=new Array(I);for(let j=0;j<I;j++)m[j]=[];for(let j=0;j<this.face.length;j++)for(let V=0;V<3;V++)m[this.face[j][V]].push(j);let C=0,l=0,s=0,F=[],k=[];this.adjacentFaces=[];for(let j=0;j<m.length;j++){V.face[j]=this.setOrder(j,m[j].concat([]));for(const I of m[j]){C=0,l=0,s=0,F=this.face[I];for(let V=0;V<3;V++)k=this.vertex[F[V]],C+=k[0],l+=k[1],s+=k[2];V.vertex[I]=[C/3,l/3,s/3]}}return V}static BuildGeodesicData(V){const I=new lV("Geodesic-m-n","Geodesic",[[0,VV.g,-1],[-VV.g,1,0],[-1,0,-VV.g],[1,0,-VV.g],[VV.g,1,0],[0,VV.g,1],[-1,0,VV.g],[-VV.g,-1,0],[0,-VV.g,-1],[VV.g,-1,0],[1,0,VV.g],[0,-VV.g,1]],[]);V.setIndices(),V.calcCoeffs(),V.createInnerFacets(),V.edgeVecsABOB(),V.mapABOBtoOBOA(),V.mapABOBtoBAOA();for(let m=0;m<V.IDATA.face.length;m++)V.MapToFace(m,I),I.innerToData(m,V),"B"===V.IDATA.edgematch[m][1]&&I.mapABOBtoDATA(m,V),"O"===V.IDATA.edgematch[m][1]&&I.mapOBOAtoDATA(m,V),"A"===V.IDATA.edgematch[m][3]&&I.mapBAOAtoDATA(m,V);I.orderData(V);return I.vertex=I.vertex.map((function(V){const I=V[0],m=V[1],C=V[2],l=Math.sqrt(I*I+m*m+C*C);return V[0]*=1/l,V[1]*=1/l,V[2]*=1/l,V})),I}}l.c._GoldbergMeshParser=(V,I)=>sV.Parse(V,I);class sV extends l.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(V,I){return void 0===I?(V>this.goldbergData.nbUnsharedFaces-1&&(L.d.Warn("Maximum number of unshared faces used"),V=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+V):(V>11&&(L.d.Warn("Last pole used"),V=11),I>this.goldbergData.nbFacesAtPole-1&&(L.d.Warn("Maximum number of faces at a pole used"),I=this.goldbergData.nbFacesAtPole-1),12+V*this.goldbergData.nbFacesAtPole+I)}_changeGoldbergFaceColors(V){for(let m=0;m<V.length;m++){const I=V[m][0],C=V[m][1],l=V[m][2];for(let V=I;V<C+1;V++)this.goldbergData.faceColors[V]=l}const I=[];for(let m=0;m<12;m++)for(let V=0;V<5;V++)I.push(this.goldbergData.faceColors[m].r,this.goldbergData.faceColors[m].g,this.goldbergData.faceColors[m].b,this.goldbergData.faceColors[m].a);for(let m=12;m<this.goldbergData.faceColors.length;m++)for(let V=0;V<6;V++)I.push(this.goldbergData.faceColors[m].r,this.goldbergData.faceColors[m].g,this.goldbergData.faceColors[m].b,this.goldbergData.faceColors[m].a);return I}setGoldbergFaceColors(V){const I=this._changeGoldbergFaceColors(V);this.hV(s.e.ColorKind,I)}updateGoldbergFaceColors(V){const I=this._changeGoldbergFaceColors(V);this.updateVerticesData(s.e.ColorKind,I)}_changeGoldbergFaceUVs(V){const I=this.getVerticesData(s.e.UVKind);for(let m=0;m<V.length;m++){const C=V[m][0],l=V[m][1],s=V[m][2],F=V[m][3],k=V[m][4],j=[],E=[];let K,Y;for(let V=0;V<5;V++)K=s.x+F*Math.cos(k+V*Math.PI/2.5),Y=s.y+F*Math.sin(k+V*Math.PI/2.5),K<0&&(K=0),K>1&&(K=1),j.push(K,Y);for(let V=0;V<6;V++)K=s.x+F*Math.cos(k+V*Math.PI/3),Y=s.y+F*Math.sin(k+V*Math.PI/3),K<0&&(K=0),K>1&&(K=1),E.push(K,Y);for(let V=C;V<Math.min(12,l+1);V++)for(let m=0;m<5;m++)I[10*V+2*m]=j[2*m],I[10*V+2*m+1]=j[2*m+1];for(let V=Math.max(12,C);V<l+1;V++)for(let m=0;m<6;m++)I[12*V-24+2*m]=E[2*m],I[12*V-23+2*m]=E[2*m+1]}return I}setGoldbergFaceUVs(V){const I=this._changeGoldbergFaceUVs(V);this.hV(s.e.UVKind,I)}updateGoldbergFaceUVs(V){const I=this._changeGoldbergFaceUVs(V);this.updateVerticesData(s.e.UVKind,I)}placeOnGoldbergFaceAt(V,I,m){const l=C.m.RotationFromAxis(this.goldbergData.faceXaxis[I],this.goldbergData.faceYaxis[I],this.goldbergData.faceZaxis[I]);V.rotation=l,V.position=this.goldbergData.faceCenters[I].add(this.goldbergData.faceXaxis[I].scale(m.x)).add(this.goldbergData.faceYaxis[I].scale(m.y)).add(this.goldbergData.faceZaxis[I].scale(m.z))}serialize(V){super.serialize(V),V.type="GoldbergMesh";const I={};if(I.adjacentFaces=this.goldbergData.adjacentFaces,I.nbSharedFaces=this.goldbergData.nbSharedFaces,I.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,I.nbFaces=this.goldbergData.nbFaces,I.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){I.faceColors=[];for(const V of this.goldbergData.faceColors)I.faceColors.push(V.UF())}if(this.goldbergData.faceCenters){I.faceCenters=[];for(const V of this.goldbergData.faceCenters)I.faceCenters.push(V.UF())}if(this.goldbergData.faceZaxis){I.faceZaxis=[];for(const V of this.goldbergData.faceZaxis)I.faceZaxis.push(V.UF())}if(this.goldbergData.faceYaxis){I.faceYaxis=[];for(const V of this.goldbergData.faceYaxis)I.faceYaxis.push(V.UF())}if(this.goldbergData.faceXaxis){I.faceXaxis=[];for(const V of this.goldbergData.faceXaxis)I.faceXaxis.push(V.UF())}V.goldbergData=I}static Parse(V,I){const m=V.goldbergData;m.faceColors=m.faceColors.map((V=>X.d.Ik(V))),m.faceCenters=m.faceCenters.map((V=>C.m.Ik(V))),m.faceZaxis=m.faceZaxis.map((V=>C.m.Ik(V))),m.faceXaxis=m.faceXaxis.map((V=>C.m.Ik(V))),m.faceYaxis=m.faceYaxis.map((V=>C.m.Ik(V)));const l=new sV(V.name,I);return l.goldbergData=m,l}}var FV=m(11731);const kV={CreateBox:Y.c,CreateTiledBox:t,CreateSphere:D.c,CreateDisc:K.e,CreateIcoSphere:P,CreateRibbon:E,CreateCylinder:x,CreateTorus:c,CreateTorusKnot:y,CreateLineSystem:z.c,ej:z.d,CreateDashedLines:z.b,ExtrudeShape:W,ExtrudeShapeCustom:Q,CreateLathe:r,CreateTiledPlane:v,Lj:g.e,CreateGround:h.f,CreateTiledGround:h.i,CreateGroundFromHeightMap:h.d,CreatePolygon:Z.c,ExtrudePolygon:Z.f,CreateTube:d,CreatePolyhedron:i,CreateGeodesic:function(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=I.m||1;C!==Math.floor(C)&&(C=Math.floor(C),L.d.Warn("m not an integer only floor(m) used"));let l=I.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),L.d.Warn("n not an integer only floor(n) used")),l>C){const V=l;l=C,C=V,L.d.Warn("n > m therefore m and n swapped")}const s=new mV;return s.build(C,l),i(V,{custom:lV.BuildGeodesicData(s),size:I.size,sizeX:I.sizeX,sizeY:I.sizeY,sizeZ:I.sizeZ,faceUV:I.faceUV,faceColors:I.faceColors,flat:I.flat,updatable:I.updatable,sideOrientation:I.sideOrientation,frontUVs:I.frontUVs,backUVs:I.backUVs},m)},CreateGoldberg:function(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=I.size,j=I.sizeX||s||1,E=I.sizeY||s||1,K=I.sizeZ||s||1;let Y=I.m||1;Y!==Math.floor(Y)&&(Y=Math.floor(Y),L.d.Warn("m not an integer only floor(m) used"));let O=I.n||0;if(O!==Math.floor(O)&&(O=Math.floor(O),L.d.Warn("n not an integer only floor(n) used")),O>Y){const V=O;O=Y,Y=V,L.d.Warn("n > m therefore m and n swapped")}const v=new mV;v.build(Y,O);const N=lV.BuildGeodesicData(v),t=N.toGoldbergPolyhedronData(),D=new sV(V,m);I.sideOrientation=l.c._GetDefaultSideOrientation(I.sideOrientation),D._originalBuilderSideOrientation=I.sideOrientation;(function(V,I){const m=V.size,l=V.sizeX||m||1,s=V.sizeY||m||1,j=V.sizeZ||m||1,E=0===V.sideOrientation?0:V.sideOrientation||F.c.DEFAULTSIDE,K=[],Y=[],X=[],O=[];let v=1/0,N=-1/0,t=1/0,D=-1/0;for(let C=0;C<I.vertex.length;C++)v=Math.min(v,I.vertex[C][0]*l),N=Math.max(N,I.vertex[C][0]*l),t=Math.min(t,I.vertex[C][1]*s),D=Math.max(D,I.vertex[C][1]*s);let b=0;for(let F=0;F<I.face.length;F++){const V=I.face[F],m=C.m.Ik(I.vertex[V[0]]),E=C.m.Ik(I.vertex[V[2]]),T=C.m.Ik(I.vertex[V[1]]),n=E.Fm(m),x=T.Fm(m),S=C.m.Cross(x,n).normalize();for(let C=0;C<V.length;C++){X.push(S.x,S.y,S.z);const m=I.vertex[V[C]];K.push(m[0]*l,m[1]*s,m[2]*j);const F=(m[1]*s-t)/(D-t);O.push((m[0]*l-v)/(N-v),k.e?1-F:F)}for(let I=0;I<V.length-2;I++)Y.push(b,b+I+2,b+I+1);b+=V.length}F.c._ComputeSides(E,K,Y,X,O);const T=new F.c;return T.yV=K,T.indices=Y,T.zV=X,T.BV=O,T})(I,t).QV(D,I.updatable),D.goldbergData.nbSharedFaces=N.sharedNodes,D.goldbergData.nbUnsharedFaces=N.poleNodes,D.goldbergData.adjacentFaces=N.adjacentFaces,D.goldbergData.nbFaces=D.goldbergData.nbSharedFaces+D.goldbergData.nbUnsharedFaces,D.goldbergData.nbFacesAtPole=(D.goldbergData.nbUnsharedFaces-12)/12;for(let l=0;l<N.vertex.length;l++)D.goldbergData.faceCenters.push(C.m.Ik(N.vertex[l])),D.goldbergData.faceCenters[l].x*=j,D.goldbergData.faceCenters[l].y*=E,D.goldbergData.faceCenters[l].z*=K,D.goldbergData.faceColors.push(new X.d(1,1,1,1));for(let l=0;l<t.face.length;l++){const V=t.face[l],I=C.m.Ik(t.vertex[V[0]]),m=C.m.Ik(t.vertex[V[2]]),s=C.m.Ik(t.vertex[V[1]]),F=m.Fm(I),k=s.Fm(I),j=C.m.Cross(k,F).normalize(),E=C.m.Cross(k,j).normalize();D.goldbergData.faceXaxis.push(k.normalize()),D.goldbergData.faceYaxis.push(j),D.goldbergData.faceZaxis.push(E)}return D},CreateDecal:U,CreateCapsule:a,CreateText:FV.h}},12468:(V,I,m)=>{"use strict";m.d(I,{c:()=>kI});var C=m(11040),l=m(11642);class s extends l.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var F=m(11312),k=(m(11469),m(11048));class j{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(V){this._targetStopDuration!==V&&(this._targetStopDuration=V)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(V){this._noiseTexture!==V&&(this._noiseTexture=V,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(V){this._animationSheetEnabled!==V&&(this._animationSheetEnabled=V)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(V){this._isAnimationSheetEnabled!=V&&(this._isAnimationSheetEnabled=V,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){this._useLogarithmicDepth=V&&this.cV().getEngine().getCaps().fragmentDepthSupported}cV(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(V){switch(V){case j.BLENDMODE_MULTIPLYADD:return;case j.BLENDMODE_ADD:V=1;break;case j.BLENDMODE_ONEONE:V=6;break;case j.BLENDMODE_STANDARD:V=2;break;case j.BLENDMODE_MULTIPLY:V=4;break;case j.BLENDMODE_SUBTRACT:V=3}this._engine.setAlphaMode(V)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:C.m.Zero()}set direction1(V){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=V)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:C.m.Zero()}set direction2(V){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=V)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:C.m.Zero()}set minEmitBox(V){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=V)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:C.m.Zero()}set maxEmitBox(V){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=V)}get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(V){this._isBillboardBased!==V&&(this._isBillboardBased=V,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V)}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(!V&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=V)}_reset(){}_removeGradientAndTexture(V,I,m){if(!I)return this;let C=0;for(const l of I){if(l.gradient===V){I.splice(C,1);break}C++}return m&&m.dispose(),this}constructor(V){this.animations=[],this.renderingGroupId=0,this.i=C.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new C.m(10,10,10),this.onAnimationEnd=null,this.blendMode=j.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new C.k(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.wj=new C.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=C.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new F.d(1,1,1,1),this.color2=new F.d(1,1,1,1),this.colorDead=new F.d(0,0,0,1),this.textureMask=new F.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new s,this.id=V,this.name=V}createPointEmitter(V,I){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new C.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new C.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new C.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new C.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new C.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new C.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(V,I,m,C){throw new Error("Method not implemented.")}}j.BLENDMODE_ONEONE=0,j.BLENDMODE_STANDARD=1,j.BLENDMODE_ADD=2,j.BLENDMODE_MULTIPLY=3,j.BLENDMODE_MULTIPLYADD=4,j.BLENDMODE_SUBTRACT=-1,(0,k.h)("BABYLON.BaseParticleSystem",j);var E=m(11074),K=m(11089);class Y{constructor(){this.direction1=new C.m(0,1,0),this.direction2=new C.m(0,1,0),this.minEmitBox=new C.m(-.5,-.5,-.5),this.maxEmitBox=new C.m(.5,.5,.5)}startDirectionFunction(V,I,m,l){const s=(0,E.RandomRange)(this.direction1.x,this.direction2.x),F=(0,E.RandomRange)(this.direction1.y,this.direction2.y),k=(0,E.RandomRange)(this.direction1.z,this.direction2.z);if(l)return I.x=s,I.y=F,void(I.z=k);C.m.TransformNormalFromFloatsToRef(s,F,k,V,I)}startPositionFunction(V,I,m,l){const s=(0,E.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),F=(0,E.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),k=(0,E.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(l)return I.x=s,I.y=F,void(I.z=k);C.m.TransformCoordinatesFromFloatsToRef(s,F,k,V,I)}clone(){const V=new Y;return K.e.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2),V.setVector3("minEmitBox",this.minEmitBox),V.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3),V.addUniform("minEmitBox",3),V.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.UF(),V.direction2=this.direction2.UF(),V.minEmitBox=this.minEmitBox.UF(),V.maxEmitBox=this.maxEmitBox.UF(),V}parse(V){C.m.FromArrayToRef(V.direction1,0,this.direction1),C.m.FromArrayToRef(V.direction2,0,this.direction2),C.m.FromArrayToRef(V.minEmitBox,0,this.minEmitBox),C.m.FromArrayToRef(V.maxEmitBox,0,this.maxEmitBox)}}class X{get radius(){return this._radius}set radius(V){this._radius=V,this._buildHeight()}get angle(){return this._angle}set angle(V){this._angle=V,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=m,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=I,this.radius=V}startDirectionFunction(V,I,m,l){l?C.g.LF[0].C(m.hk).normalize():m.position.subtractToRef(V.getTranslation(),C.g.LF[0]).normalize();const s=(0,E.RandomRange)(0,this.directionRandomizer),F=(0,E.RandomRange)(0,this.directionRandomizer),k=(0,E.RandomRange)(0,this.directionRandomizer);I.x=C.g.LF[0].x+s,I.y=C.g.LF[0].y+F,I.z=C.g.LF[0].z+k,I.normalize()}startPositionFunction(V,I,m,l){const s=(0,E.RandomRange)(0,2*Math.PI);let F;this.emitFromSpawnPointOnly?F=1e-4:(F=(0,E.RandomRange)(0,this.heightRange),F=1-F*F);let k=this._radius-(0,E.RandomRange)(0,this._radius*this.radiusRange);k*=F;const j=k*Math.sin(s),K=k*Math.cos(s),Y=F*this._height;if(l)return I.x=j,I.y=Y,void(I.z=K);C.m.TransformCoordinatesFromFloatsToRef(j,Y,K,V,I)}clone(){const V=new X(this._radius,this._angle,this.directionRandomizer);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat2("radius",this._radius,this.radiusRange),V.setFloat("coneAngle",this._angle),V.setFloat2("height",this._height,this.heightRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",2),V.addUniform("coneAngle",1),V.addUniform("height",2),V.addUniform("directionRandomizer",1)}getEffectDefines(){let V="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(V+="\n#define CONEEMITTERSPAWNPOINT"),V}getClassName(){return"ConeParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this._radius,V.angle=this._angle,V.directionRandomizer=this.directionRandomizer,V.radiusRange=this.radiusRange,V.heightRange=this.heightRange,V.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,V}parse(V){this.radius=V.radius,this.angle=V.angle,this.directionRandomizer=V.directionRandomizer,this.radiusRange=void 0!==V.radiusRange?V.radiusRange:1,this.heightRange=void 0!==V.radiusRange?V.heightRange:1,this.emitFromSpawnPointOnly=void 0!==V.emitFromSpawnPointOnly&&V.emitFromSpawnPointOnly}}class O extends X{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0);super(V,I),this.direction1=m,this.direction2=l}startDirectionFunction(V,I){const m=(0,E.RandomRange)(this.direction1.x,this.direction2.x),l=(0,E.RandomRange)(this.direction1.y,this.direction2.y),s=(0,E.RandomRange)(this.direction1.z,this.direction2.z);C.m.TransformNormalFromFloatsToRef(m,l,s,V,I)}clone(){const V=new O(this.radius,this.angle,this.direction1,this.direction2);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.UF(),V.direction2=this.direction2.UF(),V}parse(V){super.parse(V),this.direction1.C(V.direction1),this.direction2.C(V.direction2)}}class v{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=V,this.height=I,this.radiusRange=m,this.directionRandomizer=l,this._tempVector=C.m.Zero()}startDirectionFunction(V,I,m,l,s){m.position.subtractToRef(V.getTranslation(),this._tempVector),this._tempVector.normalize(),C.m.TransformNormalToRef(this._tempVector,s,this._tempVector);const F=(0,E.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let k=Math.atan2(this._tempVector.x,this._tempVector.z);k+=(0,E.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=F,this._tempVector.x=Math.sin(k),this._tempVector.z=Math.cos(k),this._tempVector.normalize(),l?I.C(this._tempVector):C.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V,I)}startPositionFunction(V,I,m,l){const s=(0,E.RandomRange)(-this.height/2,this.height/2),F=(0,E.RandomRange)(0,2*Math.PI),k=(0,E.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),j=Math.sqrt(k)*this.radius,K=j*Math.cos(F),Y=j*Math.sin(F);l?I.aF(K,s,Y):C.m.TransformCoordinatesFromFloatsToRef(K,s,Y,V,I)}clone(){const V=new v(this.radius,this.directionRandomizer);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.height=this.height,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.height=V.height,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class N extends v{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.m(0,1,0);super(V,I,m),this.direction1=l,this.direction2=s}startDirectionFunction(V,I,m,l){const s=(0,E.RandomRange)(this.direction1.x,this.direction2.x),F=(0,E.RandomRange)(this.direction1.y,this.direction2.y),k=(0,E.RandomRange)(this.direction1.z,this.direction2.z);l?I.aF(s,F,k):C.m.TransformNormalFromFloatsToRef(s,F,k,V,I)}clone(){const V=new N(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.UF(),V.direction2=this.direction2.UF(),V}parse(V){super.parse(V),C.m.FromArrayToRef(V.direction1,0,this.direction1),C.m.FromArrayToRef(V.direction2,0,this.direction2)}}class t{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=I,this.directionRandomizer=m}startDirectionFunction(V,I,m,l){const s=m.position.Fm(V.getTranslation()).normalize(),F=(0,E.RandomRange)(0,this.directionRandomizer),k=(0,E.RandomRange)(0,this.directionRandomizer),j=(0,E.RandomRange)(0,this.directionRandomizer);s.x+=F,s.y+=k,s.z+=j,s.normalize(),l?I.C(s):C.m.TransformNormalFromFloatsToRef(s.x,s.y,s.z,V,I)}startPositionFunction(V,I,m,l){const s=this.radius-(0,E.RandomRange)(0,this.radius*this.radiusRange),F=(0,E.RandomRange)(0,1),k=(0,E.RandomRange)(0,2*Math.PI),j=Math.acos(2*F-1),K=s*Math.cos(k)*Math.sin(j),Y=s*Math.cos(j),X=s*Math.sin(k)*Math.sin(j);l?I.aF(K,Math.abs(Y),X):C.m.TransformCoordinatesFromFloatsToRef(K,Math.abs(Y),X,V,I)}clone(){const V=new t(this.radius,this.directionRandomizer);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class D{constructor(){this.direction1=new C.m(0,1,0),this.direction2=new C.m(0,1,0)}startDirectionFunction(V,I,m,l){const s=(0,E.RandomRange)(this.direction1.x,this.direction2.x),F=(0,E.RandomRange)(this.direction1.y,this.direction2.y),k=(0,E.RandomRange)(this.direction1.z,this.direction2.z);l?I.aF(s,F,k):C.m.TransformNormalFromFloatsToRef(s,F,k,V,I)}startPositionFunction(V,I,m,l){l?I.aF(0,0,0):C.m.TransformCoordinatesFromFloatsToRef(0,0,0,V,I)}clone(){const V=new D;return K.e.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.UF(),V.direction2=this.direction2.UF(),V}parse(V){C.m.FromArrayToRef(V.direction1,0,this.direction1),C.m.FromArrayToRef(V.direction2,0,this.direction2)}}class b{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=I,this.directionRandomizer=m}startDirectionFunction(V,I,m,l){const s=m.position.Fm(V.getTranslation()).normalize(),F=(0,E.RandomRange)(0,this.directionRandomizer),k=(0,E.RandomRange)(0,this.directionRandomizer),j=(0,E.RandomRange)(0,this.directionRandomizer);s.x+=F,s.y+=k,s.z+=j,s.normalize(),l?I.C(s):C.m.TransformNormalFromFloatsToRef(s.x,s.y,s.z,V,I)}startPositionFunction(V,I,m,l){const s=this.radius-(0,E.RandomRange)(0,this.radius*this.radiusRange),F=(0,E.RandomRange)(0,1),k=(0,E.RandomRange)(0,2*Math.PI),j=Math.acos(2*F-1),K=s*Math.cos(k)*Math.sin(j),Y=s*Math.cos(j),X=s*Math.sin(k)*Math.sin(j);l?I.aF(K,Y,X):C.m.TransformCoordinatesFromFloatsToRef(K,Y,X,V,I)}clone(){const V=new b(this.radius,this.directionRandomizer);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class T extends b{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.m(0,1,0),m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0);super(V),this.direction1=I,this.direction2=m}startDirectionFunction(V,I){const m=(0,E.RandomRange)(this.direction1.x,this.direction2.x),l=(0,E.RandomRange)(this.direction1.y,this.direction2.y),s=(0,E.RandomRange)(this.direction1.z,this.direction2.z);C.m.TransformNormalFromFloatsToRef(m,l,s,V,I)}clone(){const V=new T(this.radius,this.direction1,this.direction2);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.UF(),V.direction2=this.direction2.UF(),V}parse(V){super.parse(V),this.direction1.C(V.direction1),this.direction2.C(V.direction2)}}class n{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(V,I,m,l){const s=C.g.LF[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,m,s);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,m,s);const V=C.g.LF[1];s.subtractToRef(m.position,V),V.scaleToRef(1/m.lifeTime,s)}else s.set(0,0,0);l?I.C(s):C.m.TransformNormalToRef(s,V,I)}startPositionFunction(V,I,m,l){const s=C.g.LF[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,m,s):s.set(0,0,0),l?I.C(s):C.m.TransformCoordinatesToRef(s,V,I)}clone(){const V=new n;return K.e.DeepCopy(this,V),V}applyToShader(V){}buildUniformLayout(V){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.particlePositionGenerator=this.particlePositionGenerator,V.particleDestinationGenerator=this.particleDestinationGenerator,V}parse(V){V.particlePositionGenerator&&(this.particlePositionGenerator=V.particlePositionGenerator),V.particleDestinationGenerator&&(this.particleDestinationGenerator=V.particleDestinationGenerator)}}var x=m(11233);class S{get mesh(){return this._mesh}set mesh(V){this._mesh!==V&&(this._mesh=V,V?(this._indices=V.AF(),this._positions=V.getVerticesData(x.e.PositionKind),this._normals=V.getVerticesData(x.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=C.m.Zero(),this._mesh=null,this.direction1=new C.m(0,1,0),this.direction2=new C.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=V}startDirectionFunction(V,I,m,l){if(this.useMeshNormalsForDirection&&this._normals)return void C.m.TransformNormalToRef(this._storedNormal,V,I);const s=(0,E.RandomRange)(this.direction1.x,this.direction2.x),F=(0,E.RandomRange)(this.direction1.y,this.direction2.y),k=(0,E.RandomRange)(this.direction1.z,this.direction2.z);l?I.aF(s,F,k):C.m.TransformNormalFromFloatsToRef(s,F,k,V,I)}startPositionFunction(V,I,m,l){if(!this._indices||!this._positions)return;const s=3*(Math.random()*(this._indices.length/3)|0),F=Math.random(),k=Math.random()*(1-F),j=1-F-k,E=this._indices[s],K=this._indices[s+1],Y=this._indices[s+2],X=C.g.LF[0],O=C.g.LF[1],v=C.g.LF[2],N=C.g.LF[3];C.m.FromArrayToRef(this._positions,3*E,X),C.m.FromArrayToRef(this._positions,3*K,O),C.m.FromArrayToRef(this._positions,3*Y,v),N.x=F*X.x+k*O.x+j*v.x,N.y=F*X.y+k*O.y+j*v.y,N.z=F*X.z+k*O.z+j*v.z,l?I.aF(N.x,N.y,N.z):C.m.TransformCoordinatesFromFloatsToRef(N.x,N.y,N.z,V,I),this.useMeshNormalsForDirection&&this._normals&&(C.m.FromArrayToRef(this._normals,3*E,X),C.m.FromArrayToRef(this._normals,3*K,O),C.m.FromArrayToRef(this._normals,3*Y,v),this._storedNormal.x=F*X.x+k*O.x+j*v.x,this._storedNormal.y=F*X.y+k*O.y+j*v.y,this._storedNormal.z=F*X.z+k*O.z+j*v.z)}clone(){const V=new S(this.mesh);return K.e.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var V;const I={};return I.type=this.getClassName(),I.direction1=this.direction1.UF(),I.direction2=this.direction2.UF(),I.meshId=null===(V=this.mesh)||void 0===V?void 0:V.id,I.useMeshNormalsForDirection=this.useMeshNormalsForDirection,I}parse(V,I){C.m.FromArrayToRef(V.direction1,0,this.direction1),C.m.FromArrayToRef(V.direction2,0,this.direction2),V.meshId&&I&&(this.mesh=I.getLastMeshById(V.meshId)),this.useMeshNormalsForDirection=V.useMeshNormalsForDirection}}class c{_isUbo(V){return void 0!==V.addUniform}constructor(V){this._isUbo(V)?(this.setMatrix3x3=V.updateMatrix3x3.bind(V),this.setMatrix2x2=V.updateMatrix2x2.bind(V),this.setFloat=V.updateFloat.bind(V),this.setFloat2=V.updateFloat2.bind(V),this.setFloat3=V.updateFloat3.bind(V),this.setFloat4=V.updateFloat4.bind(V),this.setFloatArray=V.updateFloatArray.bind(V),this.setArray=V.updateArray.bind(V),this.setIntArray=V.updateIntArray.bind(V),this.setMatrix=V.lk.bind(V),this.setMatrices=V.updateMatrices.bind(V),this.setVector3=V.updateVector3.bind(V),this.setVector4=V.updateVector4.bind(V),this.setColor3=V.updateColor3.bind(V),this.setColor4=V.updateColor4.bind(V),this.setDirectColor4=V.updateDirectColor4.bind(V),this.setInt=V.updateInt.bind(V),this.setInt2=V.updateInt2.bind(V),this.setInt3=V.updateInt3.bind(V),this.setInt4=V.updateInt4.bind(V)):(this.setMatrix3x3=V.setMatrix3x3.bind(V),this.setMatrix2x2=V.setMatrix2x2.bind(V),this.setFloat=V.setFloat.bind(V),this.setFloat2=V.setFloat2.bind(V),this.setFloat3=V.setFloat3.bind(V),this.setFloat4=V.setFloat4.bind(V),this.setFloatArray=V.setFloatArray.bind(V),this.setArray=V.setArray.bind(V),this.setIntArray=V.setIntArray.bind(V),this.setMatrix=V.setMatrix.bind(V),this.setMatrices=V.setMatrices.bind(V),this.setVector3=V.setVector3.bind(V),this.setVector4=V.setVector4.bind(V),this.setColor3=V.setColor3.bind(V),this.setColor4=V.setColor4.bind(V),this.setDirectColor4=V.setDirectColor4.bind(V),this.setInt=V.setInt.bind(V),this.setInt2=V.setInt2.bind(V),this.setInt3=V.setInt3.bind(V),this.setInt4=V.setInt4.bind(V))}}var H=m(11150);const y="gpuUpdateParticlesPixelShader",z="#version 300 es\nvoid main() {discard;}\n";H.e.ShadersStore[y]||(H.e.ShadersStore[y]=z);const Z="gpuUpdateParticlesVertexShader",B="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";H.e.ShadersStore[Z]||(H.e.ShadersStore[Z]=B);(0,k.h)("BABYLON.WebGL2ParticleSystem",class{constructor(V,I){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=V,this._engine=I,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var V;return(null===(V=this._updateEffect)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof n&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=V,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new c(this._updateEffect)}createVertexBuffers(V,I){this._updateVAO.push(this._createUpdateVAO(V)),this._renderVAO.push(this._engine.recordVertexArrayObject(I,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=I}createParticleBuffer(V){return V}bindDrawBuffers(V,I,m){m?this._engine.bindBuffers(this._renderVertexBuffers,m,I):this._engine.bindVertexArrayObject(this._renderVAO[V],null)}preUpdateParticleBuffer(){const V=this._engine;if(this._engine.enableEffect(this._updateEffect),!V.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(V,I,m){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[V],null);const C=this._engine;C.bindTransformFeedbackBuffer(I.getBuffer()),C.setRasterizerState(!1),C.beginTransformFeedback(!0),C.drawArraysType(3,0,m),C.endTransformFeedback(),C.setRasterizerState(!0),C.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let V=0;V<this._updateVAO.length;V++)this._engine.releaseVertexArrayObject(this._updateVAO[V]);this._updateVAO.length=0;for(let V=0;V<this._renderVAO.length;V++)this._engine.releaseVertexArrayObject(this._renderVAO[V]);this._renderVAO.length=0}_createUpdateVAO(V){const I={};I.position=V.createVertexBuffer("position",0,3);let m=3;I.age=V.createVertexBuffer("age",m,1),m+=1,I.size=V.createVertexBuffer("size",m,3),m+=3,I.life=V.createVertexBuffer("life",m,1),m+=1,I.seed=V.createVertexBuffer("seed",m,4),m+=4,I.direction=V.createVertexBuffer("direction",m,3),m+=3,this._parent.particleEmitterType instanceof n&&(I.initialPosition=V.createVertexBuffer("initialPosition",m,3),m+=3),this._parent._colorGradientsTexture||(I.color=V.createVertexBuffer("color",m,4),m+=4),this._parent._isBillboardBased||(I.initialDirection=V.createVertexBuffer("initialDirection",m,3),m+=3),this._parent.noiseTexture&&(I.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",m,3),m+=3,I.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",m,3),m+=3),this._parent._angularSpeedGradientsTexture?(I.angle=V.createVertexBuffer("angle",m,1),m+=1):(I.angle=V.createVertexBuffer("angle",m,2),m+=2),this._parent._isAnimationSheetEnabled&&(I.cellIndex=V.createVertexBuffer("cellIndex",m,1),m+=1,this._parent.spriteRandomStartCell&&(I.cellStartOffset=V.createVertexBuffer("cellStartOffset",m,1),m+=1));const C=this._engine.recordVertexArrayObject(I,null,this._updateEffect);return this._engine.bindArrayBuffer(null),C}});class W{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,C=arguments.length>3?arguments[3]:void 0;this._engine=V,this._label=C,this._engine._storageBuffers.push(this),this._create(I,m)}_create(V,I){this._bufferSize=V,this._creationFlags=I,this._buffer=this._engine.createStorageBuffer(V,I,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(V,I,m){this._buffer&&this._engine.updateStorageBuffer(this._buffer,V,I,m)}async read(V,I,m,C){return await this._engine.readFromStorageBuffer(this._buffer,V,I,m,C)}dispose(){const V=this._engine._storageBuffers,I=V.indexOf(this);-1!==I&&(V[I]=V[V.length-1],V.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Q=m(11206),G=m(11214),r=m(11297),g=m(11518),h=m(11639),d=m(11085),R=m(11170),i=m(11510);class q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new i.e}_addDuration(V,I){V<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==V?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(I,!1),this._gpuTimeInFrameId=V):this.counter.addCount(I,!1))}}var P=m(11129);class u{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=V,this._engine=I,this.uniqueId=h.d.UniqueId,I.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new q),this._engine.getCaps().supportComputeShaders?C.bindingsMapping?(this._context=I.createComputeContext(),this._shaderPath=m,this._options={bindingsMapping:{},defines:[],...C}):d.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):d.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=this._bindings[V];this._bindings[V]={type:m?0:4,object:I,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!C||C.object!==I||C.type!==this._bindings[V].type)}setStorageTexture(V,I){const m=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==I),this._bindings[V]={type:1,object:I,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setExternalTexture(V,I){const m=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==I),this._bindings[V]={type:6,object:I,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setVideoTexture(V,I){return!!I.externalTexture&&(this.setExternalTexture(V,I.externalTexture),!0)}setUniformBuffer(V,I){const m=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==I),this._bindings[V]={type:u._BufferIsDataBuffer(I)?7:2,object:I,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setStorageBuffer(V,I){const m=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==I),this._bindings[V]={type:u._BufferIsDataBuffer(I)?7:3,object:I,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setTextureSampler(V,I){const m=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!m||!I.compareSampler(m.object)),this._bindings[V]={type:5,object:I,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}isReady(){let V=this._effect;for(const l in this._bindings){const V=this._bindings[l],I=V.type,m=V.object;switch(I){case 0:case 4:case 1:if(!m.isReady())return!1;break;case 6:if(!m.isReady())return!1;break}}const I=[],m=this._shaderPath;if(this._options.defines)for(let l=0;l<this._options.defines.length;l++)I.push(this._options.defines[l]);const C=I.join("\n");return this._cachedDefines!==C&&(this._cachedDefines=C,V=this._engine.createComputeEffect(m,{defines:C,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=V),!!V.isReady()}dispatch(V,I,m){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,V,I,m,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const m=u._BufferIsDataBuffer(V)?V:V.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,m,I,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const I in this._bindings){const m=this._bindings[I];if(!this._options.bindingsMapping[I])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+I+"'");switch(m.type){case 0:{const C=this._samplers[I],l=m.object;var V;if(!C||!l._texture||!C.compareSampler(l._texture))this._samplers[I]=(new R.c).setParameters(l.wrapU,l.wrapV,l.wrapR,l.anisotropicFilteringLevel,l._texture.samplingMode,null===(V=l._texture)||void 0===V?void 0:V._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const V=m.object;V.getBuffer()!==m.buffer&&(m.buffer=V.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((l=>{(0,P.i)((()=>this.dispatch(V,I,m)),l,void 0,C)}))}serialize(){const V=r.d.Serialize(this);V.options=this._options,V.shaderPath=this._shaderPath,V.hY={},V.textures={};for(const I in this._bindings){const m=this._bindings[I],C=m.object;switch(m.type){case 0:case 4:case 1:{const l=C.serialize();l&&(V.textures[I]=l,V.hY[I]={type:m.type});break}}}return V}static Parse(V,I,m){const C=r.d.Parse((()=>new u(V.name,I.getEngine(),V.shaderPath,V.options)),V,I,m);for(const l in V.textures){const s=V.hY[l],F=g.e.Parse(V.textures[l],I,m);0===s.type?C.setTexture(l,F):4===s.type?C.setTexture(l,F,!1):C.setStorageTexture(l,F)}return C}static _BufferIsDataBuffer(V){return void 0!==V.underlyingResource}}(0,Q.d)([(0,G.B)()],u.prototype,"name",void 0),(0,Q.d)([(0,G.B)()],u.prototype,"fastMode",void 0),(0,k.h)("BABYLON.ComputeShader",u);var o=m(11283);const p="gpuUpdateParticlesComputeShader",M="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";H.e.ShadersStoreWGSL[p]||(H.e.ShadersStoreWGSL[p]=M);(0,k.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(V,I){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=V,this._engine=I}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var V;return(null===(V=this._updateComputeShader)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){var I;const m={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(m.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(m.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(m.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(m.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(m.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(m.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(m.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new u("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:m,defines:V.split("\n")}),null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=new o.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new c(this._simParamsComputeShader)}createVertexBuffers(V,I){this._renderVertexBuffers.push(I)}createParticleBuffer(V){const I=new W(this._engine,4*V.length,11,"ComputeShaderParticleSystemBuffer");return I.update(V),this._bufferComputeShader.push(I),I.getBuffer()}bindDrawBuffers(V,I,m){this._engine.bindBuffers(this._renderVertexBuffers[V],m,I)}preUpdateParticleBuffer(){}updateParticleBuffer(V,I,m){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[V]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^V]),this._updateComputeShader.dispatch(Math.ceil(m/64))}releaseBuffers(){var V;for(let I=0;I<this._bufferComputeShader.length;++I)this._bufferComputeShader[I].dispose();this._bufferComputeShader.length=0,null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class f{constructor(V,I,m){this.gradient=V,this.color1=I,this.color2=m}getColorToRef(V){this.color2?F.d.LerpToRef(this.color1,this.color2,Math.random(),V):V.C(this.color1)}}class w{constructor(V,I){this.gradient=V,this.color=I}}class A{constructor(V,I,m){this.gradient=V,this.factor1=I,this.factor2=m}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class J{static GetCurrentGradient(V,I,m){if(I[0].gradient>V)return void m(I[0],I[0],1);for(let l=0;l<I.length-1;l++){const C=I[l],s=I[l+1];if(V>=C.gradient&&V<=s.gradient){return void m(C,s,(V-C.gradient)/(s.gradient-C.gradient))}}const C=I.length-1;m(I[C],I[C],1)}}var U=m(11067),e=m(11543),a=m(11061);class L{constructor(V){this.particleSystem=V,this.position=C.m.Zero(),this.direction=C.m.Zero(),this.color=new F.d(0,0,0,0),this.colorStep=new F.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new C.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new F.d(0,0,0,0),this._currentColor2=new F.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=L._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let V=this.age,I=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===I?(I=1,V=this._randomCellOffset):V+=this._randomCellOffset);const m=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let C;C=this._initialSpriteCellLoop?(0,E.Clamp)(V*I%this.lifeTime/this.lifeTime):(0,E.Clamp)(V*I/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+C*m|0}_inheritParticleInfoToSubEmitter(V){if(V.particleSystem.i.position){const I=V.particleSystem.i;if(I.position.C(this.position),V.inheritDirection){const V=C.g.LF[0];this.direction.normalizeToRef(V),I.setDirection(V,0,Math.PI/2)}}else{V.particleSystem.i.C(this.position)}this.direction.scaleToRef(V.inheritedVelocityAmount/2,C.g.LF[0]),V.particleSystem._inheritedVelocityOffset.C(C.g.LF[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const V of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(V)}_reset(){this.age=0,this.id=L._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(V){V.position.C(this.position),this._initialDirection?V._initialDirection?V._initialDirection.C(this._initialDirection):V._initialDirection=this._initialDirection.clone():V._initialDirection=null,V.direction.C(this.direction),this.hk&&(V.hk?V.hk.C(this.hk):V.hk=this.hk.clone()),V.color.C(this.color),V.colorStep.C(this.colorStep),V.lifeTime=this.lifeTime,V.age=this.age,V._randomCellOffset=this._randomCellOffset,V.size=this.size,V.scale.C(this.scale),V.angle=this.angle,V.angularSpeed=this.angularSpeed,V.particleSystem=this.particleSystem,V.cellIndex=this.cellIndex,V.id=this.id,V._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(V._currentColorGradient=this._currentColorGradient,V._currentColor1.C(this._currentColor1),V._currentColor2.C(this._currentColor2)),this._currentSizeGradient&&(V._currentSizeGradient=this._currentSizeGradient,V._currentSize1=this._currentSize1,V._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(V._currentAngularSpeedGradient=this._currentAngularSpeedGradient,V._currentAngularSpeed1=this._currentAngularSpeed1,V._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(V._currentVelocityGradient=this._currentVelocityGradient,V._currentVelocity1=this._currentVelocity1,V._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(V._currentLimitVelocityGradient=this._currentLimitVelocityGradient,V._currentLimitVelocity1=this._currentLimitVelocity1,V._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(V._currentDragGradient=this._currentDragGradient,V._currentDrag1=this._currentDrag1,V._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(V._initialStartSpriteCellId=this._initialStartSpriteCellId,V._initialEndSpriteCellId=this._initialEndSpriteCellId,V._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(V.remapData&&this.remapData?V.remapData.C(this.remapData):V.remapData=new C.n(0,0,0,0)),this._randomNoiseCoordinates1&&(V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.C(this._randomNoiseCoordinates1),V._randomNoiseCoordinates2.C(this._randomNoiseCoordinates2)):(V._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),V._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}L._Count=0;var VV=m(11274),IV=(m(11467),m(11327)),mV=m(11316),CV=m(11614);function lV(V,I){const m=(0,E.RandomRange)(0,1);F.d.LerpToRef(I.color1,I.color2,m,V.color),I.colorDead.subtractToRef(V.color,I._colorDiff),I._colorDiff.scaleToRef(1/V.lifeTime,V.colorStep)}function sV(V,I){V._currentColorGradient=I._colorGradients[0],V._currentColorGradient.getColorToRef(V.color),V._currentColor1.C(V.color),I._colorGradients.length>1?I._colorGradients[1].getColorToRef(V._currentColor2):V._currentColor2.C(V.color)}function FV(V,I){const m=I._colorGradients;J.GetCurrentGradient(I._ratio,m,((I,m,C)=>{I!==V._currentColorGradient&&(V._currentColor1.C(V._currentColor2),m.getColorToRef(V._currentColor2),V._currentColorGradient=I),F.d.LerpToRef(V._currentColor1,V._currentColor2,C,V.color)}))}function kV(V,I){V.colorStep.scaleToRef(I._scaledUpdateSpeed,I._scaledColorStep),V.color.addInPlace(I._scaledColorStep),V.color.a<0&&(V.color.a=0)}function jV(V,I){J.GetCurrentGradient(I._ratio,I._angularSpeedGradients,((I,m,C)=>{I!==V._currentAngularSpeedGradient&&(V._currentAngularSpeed1=V._currentAngularSpeed2,V._currentAngularSpeed2=m.getFactor(),V._currentAngularSpeedGradient=I),V.angularSpeed=(0,E.Lerp)(V._currentAngularSpeed1,V._currentAngularSpeed2,C)}))}function EV(V,I){V.angle+=V.angularSpeed*I._scaledUpdateSpeed}function KV(V,I){I.particleEmitterType.startDirectionFunction(I._emitterWorldMatrix,V.direction,V,I.isLocal,I._emitterInverseWorldMatrix)}function YV(V,I){I.startDirectionFunction(I._emitterWorldMatrix,V.direction,V,I.isLocal)}function XV(V,I){V._currentVelocityGradient=I._velocityGradients[0],V._currentVelocity1=V._currentVelocityGradient.getFactor(),I._velocityGradients.length>1?V._currentVelocity2=I._velocityGradients[1].getFactor():V._currentVelocity2=V._currentVelocity1}function OV(V,I){V._currentLimitVelocityGradient=I._limitVelocityGradients[0],V._currentLimitVelocity1=V._currentLimitVelocityGradient.getFactor(),I._limitVelocityGradients.length>1?V._currentLimitVelocity2=I._limitVelocityGradients[1].getFactor():V._currentLimitVelocity2=V._currentLimitVelocity1}function vV(V,I){J.GetCurrentGradient(I._ratio,I._velocityGradients,((m,C,l)=>{m!==V._currentVelocityGradient&&(V._currentVelocity1=V._currentVelocity2,V._currentVelocity2=C.getFactor(),V._currentVelocityGradient=m),I._directionScale*=(0,E.Lerp)(V._currentVelocity1,V._currentVelocity2,l)}))}function NV(V,I){J.GetCurrentGradient(I._ratio,I._limitVelocityGradients,((m,C,l)=>{m!==V._currentLimitVelocityGradient&&(V._currentLimitVelocity1=V._currentLimitVelocity2,V._currentLimitVelocity2=C.getFactor(),V._currentLimitVelocityGradient=m);const s=(0,E.Lerp)(V._currentLimitVelocity1,V._currentLimitVelocity2,l);V.direction.length()>s&&V.direction.scaleInPlace(I.limitVelocityDamping)}))}function tV(V,I){V.direction.scaleToRef(I._directionScale,I._scaledDirection)}function DV(V,I){I.particleEmitterType.startPositionFunction(I._emitterWorldMatrix,V.position,V,I.isLocal)}function bV(V,I){I.startPositionFunction(I._emitterWorldMatrix,V.position,V,I.isLocal)}function TV(V,I){V.hk?V.hk.C(V.position):V.hk=V.position.clone(),C.m.TransformCoordinatesToRef(V.hk,I._emitterWorldMatrix,V.position)}function nV(V,I){I.isLocal&&V.hk?(V.hk.addInPlace(I._scaledDirection),C.m.TransformCoordinatesToRef(V.hk,I._emitterWorldMatrix,V.position)):V.position.addInPlace(I._scaledDirection)}function xV(V,I){V._currentDragGradient=I._dragGradients[0],V._currentDrag1=V._currentDragGradient.getFactor(),I._dragGradients.length>1?V._currentDrag2=I._dragGradients[1].getFactor():V._currentDrag2=V._currentDrag1}function SV(V,I){J.GetCurrentGradient(I._ratio,I._dragGradients,((m,C,l)=>{m!==V._currentDragGradient&&(V._currentDrag1=V._currentDrag2,V._currentDrag2=C.getFactor(),V._currentDragGradient=m);const s=(0,E.Lerp)(V._currentDrag1,V._currentDrag2,l);I._scaledDirection.scaleInPlace(1-s)}))}function cV(V,I){V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.aF(Math.random(),Math.random(),Math.random()),V._randomNoiseCoordinates2.aF(Math.random(),Math.random(),Math.random())):(V._randomNoiseCoordinates1=new C.m(Math.random(),Math.random(),Math.random()),V._randomNoiseCoordinates2=new C.m(Math.random(),Math.random(),Math.random()))}function HV(V,I){const m=I._noiseTextureData,l=I._noiseTextureSize;if(m&&l&&V._randomNoiseCoordinates1){const s=I._fetchR(V._randomNoiseCoordinates1.x,V._randomNoiseCoordinates1.y,l.width,l.height,m),F=I._fetchR(V._randomNoiseCoordinates1.z,V._randomNoiseCoordinates2.x,l.width,l.height,m),k=I._fetchR(V._randomNoiseCoordinates2.y,V._randomNoiseCoordinates2.z,l.width,l.height,m),j=C.g.LF[0],E=C.g.LF[1];j.aF((2*s-1)*I.noiseStrength.x,(2*F-1)*I.noiseStrength.y,(2*k-1)*I.noiseStrength.z),j.scaleToRef(I._tempScaledUpdateSpeed,E),V.direction.addInPlace(E)}}function yV(V,I){I.gravity.scaleToRef(I._tempScaledUpdateSpeed,I._scaledGravity),V.direction.addInPlace(I._scaledGravity)}function zV(V,I){V.size=(0,E.RandomRange)(I.minSize,I.maxSize),V.scale.aF((0,E.RandomRange)(I.minScaleX,I.maxScaleX),(0,E.RandomRange)(I.minScaleY,I.maxScaleY))}function ZV(V,I){V._currentSizeGradient=I._sizeGradients[0],V._currentSize1=V._currentSizeGradient.getFactor(),V.size=V._currentSize1,I._sizeGradients.length>1?V._currentSize2=I._sizeGradients[1].getFactor():V._currentSize2=V._currentSize1,V.scale.aF((0,E.RandomRange)(I.minScaleX,I.maxScaleX),(0,E.RandomRange)(I.minScaleY,I.maxScaleY))}function BV(V,I){const m=I._actualFrame/I.targetStopDuration;J.GetCurrentGradient(m,I._startSizeGradients,((m,C,l)=>{m!==I._currentStartSizeGradient&&(I._currentStartSize1=I._currentStartSize2,I._currentStartSize2=C.getFactor(),I._currentStartSizeGradient=m);const s=(0,E.Lerp)(I._currentStartSize1,I._currentStartSize2,l);V.scale.scaleInPlace(s)}))}function WV(V,I){J.GetCurrentGradient(I._ratio,I._sizeGradients,((I,m,C)=>{I!==V._currentSizeGradient&&(V._currentSize1=V._currentSize2,V._currentSize2=m.getFactor(),V._currentSizeGradient=I),V.size=(0,E.Lerp)(V._currentSize1,V._currentSize2,C)}))}function QV(V,I){V.remapData=new C.n(0,1,0,1)}function GV(V,I){I._colorRemapGradients&&I._colorRemapGradients.length>0&&J.GetCurrentGradient(I._ratio,I._colorRemapGradients,((I,m,C)=>{const l=(0,E.Lerp)(I.factor1,m.factor1,C),s=(0,E.Lerp)(I.factor2,m.factor2,C);V.remapData.x=l,V.remapData.y=s-l})),I._alphaRemapGradients&&I._alphaRemapGradients.length>0&&J.GetCurrentGradient(I._ratio,I._alphaRemapGradients,((I,m,C)=>{const l=(0,E.Lerp)(I.factor1,m.factor1,C),s=(0,E.Lerp)(I.factor2,m.factor2,C);V.remapData.z=l,V.remapData.w=s-l}))}function rV(V,I){const m=(0,E.Clamp)(I._actualFrame/I.targetStopDuration);J.GetCurrentGradient(m,I._lifeTimeGradients,((I,C)=>{const l=I,s=C,F=l.getFactor(),k=s.getFactor(),j=(m-l.gradient)/(s.gradient-l.gradient);V.lifeTime=(0,E.Lerp)(F,k,j)})),I._emitPower=(0,E.RandomRange)(I.minEmitPower,I.maxEmitPower)}function gV(V,I){V.lifeTime=(0,E.RandomRange)(I.minLifeTime,I.maxLifeTime),I._emitPower=(0,E.RandomRange)(I.minEmitPower,I.maxEmitPower)}function hV(V,I){0===I._emitPower?(V._initialDirection?V._initialDirection.C(V.direction):V._initialDirection=V.direction.clone(),V.direction.set(0,0,0)):(V._initialDirection=null,V.direction.scaleInPlace(I._emitPower)),V.direction.addInPlace(I._inheritedVelocityOffset)}function dV(V,I){V.angularSpeed=(0,E.RandomRange)(I.minAngularSpeed,I.maxAngularSpeed),V.angle=(0,E.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function RV(V,I){V._currentAngularSpeedGradient=I._angularSpeedGradients[0],V.angularSpeed=V._currentAngularSpeedGradient.getFactor(),V._currentAngularSpeed1=V.angularSpeed,I._angularSpeedGradients.length>1?V._currentAngularSpeed2=I._angularSpeedGradients[1].getFactor():V._currentAngularSpeed2=V._currentAngularSpeed1,V.angle=(0,E.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function iV(V,I){V._initialStartSpriteCellId=I.startSpriteCellID,V._initialEndSpriteCellId=I.endSpriteCellID,V._initialSpriteCellLoop=I.spriteCellLoop}function qV(V,I){V.previousItem=I.previousItem,V.nextItem=I,I.previousItem&&(I.previousItem.nextItem=V),I.previousItem=V}function PV(V,I){V.previousItem=I,V.nextItem=I.nextItem,I.nextItem&&(I.nextItem.previousItem=V),I.nextItem=V}function uV(V,I){let m=I;for(;m.nextItem;)m=m.nextItem;V.previousItem=m,V.nextItem=m.nextItem,m.nextItem=V}function oV(V){V.previousItem&&(V.previousItem.nextItem=V.nextItem),V.nextItem&&(V.nextItem.previousItem=V.previousItem)}class pV extends j{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(V){this._startDirectionFunction!==V&&(this._startDirectionFunction=V,this._directionProcessing.process=V?YV:KV)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(V){this._startPositionFunction!==V&&(this._startPositionFunction=V,this._positionCreation.process=V?bV:DV)}set onDispose(V){this._onDisposeObserver&&this.Ck.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ck.add(V)}get K(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(V){this._useRampGradients!==V&&(this._useRampGradients=V,this._resetEffect(),V?(this._rampCreation={process:QV,previousItem:null,nextItem:null},PV(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:GV,previousItem:null,nextItem:null},PV(this._remapGradientProcessing,this._gravityProcessing)):(oV(this._rampCreation),oV(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(V){this._isLocal!==V&&(this._isLocal=V,V?(this._isLocalCreation={process:TV,previousItem:null,nextItem:null},PV(this._isLocalCreation,this._positionCreation)):oV(this._isLocalCreation))}get particles(){return this.WY}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(V){this._animationSheetEnabled!==V&&(this._animationSheetEnabled=V,V?(this._sheetCreation={process:iV,previousItem:null,nextItem:null},PV(this._sheetCreation,this._colorCreation)):oV(this._sheetCreation),this._reset())}getActiveCount(){return this.WY.length}getClassName(){return"cv"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[I])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new VV.b(this._engine),this._customWrappers[I].effect=V,this._customWrappers[I].drawContext&&(this._customWrappers[I].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new U.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(V){if(this.noiseTexture!==V){if(this._noiseTexture=V,!V)return oV(this._noiseCreation),void oV(this._noiseProcessing);this._noiseCreation={process:cV,previousItem:null,nextItem:null},PV(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:HV,previousItem:null,nextItem:null},PV(this._noiseProcessing,this._positionProcessing)}}constructor(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(V),this._emitterInverseWorldMatrix=C.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new C.m,this.Ck=new U.e,this.onStoppedObservable=new U.e,this.onStartedObservable=new U.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.WY=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new F.d(0,0,0,0),this._colorDiff=new F.d(0,0,0,0),this._scaledDirection=C.m.Zero(),this._scaledGravity=C.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=V=>{},this.recycleParticle=V=>{const I=this.WY.pop();I!==V&&I.copyTo(V),this._stockParticles.push(I)},this._createParticle=()=>{let V;return 0!==this._stockParticles.length?(V=this._stockParticles.pop(),V._reset()):V=new L(this),this._prepareParticle(V),V},this.paused=!1,this._shadersLoaded=!1,this._capacity=I,this._epsilon=k,m&&"Scene"!==m.getClassName()?(this._engine=m,this.defaultProjectionMatrix=C.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=m||a.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ZY.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:gV,previousItem:null,nextItem:null},this._positionCreation={process:DV,previousItem:null,nextItem:null},PV(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:KV,previousItem:null,nextItem:null},PV(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:hV,previousItem:null,nextItem:null},PV(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:zV,previousItem:null,nextItem:null},PV(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:dV,previousItem:null,nextItem:null},PV(this._angleCreation,this._sizeCreation),this._colorCreation={process:lV,previousItem:null,nextItem:null},PV(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,j||(this._colorProcessing={process:kV,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:EV,previousItem:null,nextItem:null},PV(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:tV,previousItem:null,nextItem:null},PV(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:nV,previousItem:null,nextItem:null},PV(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:yV,previousItem:null,nextItem:null},PV(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=s,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new VV.b(this._engine)},this._customWrappers[0].effect=l,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Y,this.updateFunction=V=>{var I;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(I=this.noiseTexture.getContent())||void 0===I||I.then((V=>{this._noiseTextureData=V})));const m=V===this.WY;for(let C=0;C<V.length;C++){const I=V[C];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const l=I.age;if(I.age+=this._tempScaledUpdateSpeed,I.age>I.lifeTime){const V=I.age-l,m=I.lifeTime-l;this._tempScaledUpdateSpeed=m*this._tempScaledUpdateSpeed/V,I.age=I.lifeTime}this._ratio=I.age/I.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let s=this._updateQueueStart;for(;s;)s.process(I,this),s=s.nextItem;if(this._isAnimationSheetEnabled&&!j&&I.updateCellIndex(),I._inheritParticleInfoToSubEmitters(),I.age>=I.lifeTime){if(this._emitFromParticle(I),I._attachedSubEmitters){for(const V of I._attachedSubEmitters)V.particleSystem.disposeOnStop=!0,V.particleSystem.stop();I._attachedSubEmitters=null}this.recycleParticle(I),m&&C--}else;}}}serialize(V){throw new Error("Method not implemented.")}clone(V,I){throw new Error("Method not implemented.")}_addFactorGradient(V,I,m,C){const l=new A(I,m,C);V.push(l),V.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0))}_removeFactorGradient(V,I){if(!V)return;let m=0;for(const C of V){if(C.gradient===I){V.splice(m,1);break}m++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=rV:this._lifeTimeCreation.process=gV}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:BV,previousItem:null,nextItem:null},PV(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(oV(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(V){this.targetStopDuration!==V&&(this._targetStopDuration=V,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(V,I,m){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,V,I,m),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(V){return this._removeFactorGradient(this._lifeTimeGradients,V),this._syncLifeTimeCreation(),this}addSizeGradient(V,I,m){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=ZV,this._sizeGradientProcessing={process:WV,previousItem:null,nextItem:null},qV(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,V,I,m),this}removeSizeGradient(V){var I;return this._removeFactorGradient(this._sizeGradients,V),0===(null===(I=this._sizeGradients)||void 0===I?void 0:I.length)&&(oV(this._sizeGradientProcessing),this._sizeCreation.process=zV),this}addColorRemapGradient(V,I,m){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,V,I,m),this}removeColorRemapGradient(V){return this._removeFactorGradient(this._colorRemapGradients,V),this}addAlphaRemapGradient(V,I,m){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,V,I,m),this}removeAlphaRemapGradient(V){return this._removeFactorGradient(this._alphaRemapGradients,V),this}addAngularSpeedGradient(V,I,m){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=RV,this._angularSpeedGradientProcessing={process:jV,previousItem:null,nextItem:null},qV(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,V,I,m),this}removeAngularSpeedGradient(V){var I;return this._removeFactorGradient(this._angularSpeedGradients,V),0===(null===(I=this._angularSpeedGradients)||void 0===I?void 0:I.length)&&(this._angleCreation.process=dV,oV(this._angularSpeedGradientProcessing)),this}addVelocityGradient(V,I,m){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:XV,previousItem:null,nextItem:null},PV(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:vV,previousItem:null,nextItem:null},qV(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,V,I,m),this}removeVelocityGradient(V){var I;return this._removeFactorGradient(this._velocityGradients,V),0===(null===(I=this._velocityGradients)||void 0===I?void 0:I.length)&&(oV(this._velocityCreation),oV(this._velocityGradientProcessing)),this}addLimitVelocityGradient(V,I,m){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:OV,previousItem:null,nextItem:null},PV(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:NV,previousItem:null,nextItem:null},PV(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,V,I,m),this}removeLimitVelocityGradient(V){var I;return this._removeFactorGradient(this._limitVelocityGradients,V),0===(null===(I=this._limitVelocityGradients)||void 0===I?void 0:I.length)&&(oV(this._limitVelocityCreation),oV(this._limitVelocityGradientProcessing)),this}addDragGradient(V,I,m){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:xV,previousItem:null,nextItem:null},qV(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:SV,previousItem:null,nextItem:null},qV(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,V,I,m),this}removeDragGradient(V){var I;return this._removeFactorGradient(this._dragGradients,V),0===(null===(I=this._dragGradients)||void 0===I?void 0:I.length)&&(oV(this._dragCreation),oV(this._dragGradientProcessing)),this}addEmitRateGradient(V,I,m){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,V,I,m),this}removeEmitRateGradient(V){return this._removeFactorGradient(this._emitRateGradients,V),this}addStartSizeGradient(V,I,m){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,V,I,m),this._syncStartSizeCreation(),this}removeStartSizeGradient(V){return this._removeFactorGradient(this._startSizeGradients,V),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const V=new Uint8Array(4*this._rawTextureWidth),I=F.f.dY[0];for(let m=0;m<this._rawTextureWidth;m++){const C=m/this._rawTextureWidth;J.GetCurrentGradient(C,this._rampGradients,((C,l,s)=>{F.c.LerpToRef(C.color,l.color,s,I),V[4*m]=255*I.r,V[4*m+1]=255*I.g,V[4*m+2]=255*I.b,V[4*m+3]=255}))}this._rampGradientsTexture=e.d.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(V,I){this._rampGradients||(this._rampGradients=[]);const m=new w(V,I);return this._rampGradients.push(m),this._syncRampGradientTexture(),this}removeRampGradient(V){return this._removeGradientAndTexture(V,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(V,I,m){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=sV,this._colorProcessing.process=FV);const C=new f(V,I,m);return this._colorGradients.push(C),this._colorGradients.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0)),this}removeColorGradient(V){if(!this._colorGradients)return this;let I=0;for(const m of this._colorGradients){if(m.gradient===V){this._colorGradients.splice(I,1);break}I++}return 0===this._colorGradients.length&&(this._colorCreation.process=lV,this._colorProcessing.process=kV),this}resetDrawCache(){if(this._drawWrappers){for(const V of this._drawWrappers)if(V)for(const I of V)null===I||void 0===I||I.dispose();this._drawWrappers=[]}}_fetchR(V,I,m,C,l){return l[4*(((V=.5*Math.abs(V)+.5)*m%m|0)+((I=.5*Math.abs(I)+.5)*C%C|0)*m)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const V=this._engine,I=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*I),this._vertexBuffer=new x.c(V,this._vertexData,!0,I);let m=0;const C=this._vertexBuffer.createVertexBuffer(x.e.PositionKind,m,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[x.e.PositionKind]=C,m+=3;const l=this._vertexBuffer.createVertexBuffer(x.e.ColorKind,m,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[x.e.ColorKind]=l,m+=4;const s=this._vertexBuffer.createVertexBuffer("angle",m,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=s,m+=1;const F=this._vertexBuffer.createVertexBuffer("size",m,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=F,m+=2,this._isAnimationSheetEnabled){const V=this._vertexBuffer.createVertexBuffer("cellIndex",m,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=V,m+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const V=this._vertexBuffer.createVertexBuffer("direction",m,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=V,m+=3}if(this._useRampGradients){const V=this._vertexBuffer.createVertexBuffer("remapData",m,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=V,m+=4}let k;if(this._useInstancing){const I=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new x.c(V,I,!1,2),k=this._spriteBuffer.createVertexBuffer("offset",0,2)}else k=this._vertexBuffer.createVertexBuffer("offset",m,2,this._vertexBufferSize,this._useInstancing),m+=2;this._vertexBuffers.offset=k,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const V=[],I=[];let m=0;for(let C=0;C<this._capacity;C++)V.push(m),V.push(m+1),V.push(m+2),V.push(m),V.push(m+2),V.push(m+3),I.push(m,m+1,m+1,m+2,m+2,m+3,m+3,m,m,m+3),m+=4;this._indexBuffer=this._engine.createIndexBuffer(V),this._linesIndexBuffer=this._engine.createIndexBuffer(I)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(V)setTimeout((()=>{this.start(0)}),V);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var I;-1!==(null===(I=this.i)||void 0===I?void 0:I.getClassName().indexOf("Mesh"))&&this.i.fF(!0);const V=this.noiseTexture;if(V&&V.onGeneratedObservable)V.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),V.render()}))}));else for(let I=0;I<this.preWarmCycles;I++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(V))}_postStop(V){}reset(){this._stockParticles.length=0,this.WY.length=0}_appendParticleVertex(V,I,m,l){let s=V*this._vertexBufferSize;if(this._vertexData[s++]=I.position.x+this.wj.x,this._vertexData[s++]=I.position.y+this.wj.y,this._vertexData[s++]=I.position.z+this.wj.z,this._vertexData[s++]=I.color.r,this._vertexData[s++]=I.color.g,this._vertexData[s++]=I.color.b,this._vertexData[s++]=I.color.a,this._vertexData[s++]=I.angle,this._vertexData[s++]=I.scale.x*I.size,this._vertexData[s++]=I.scale.y*I.size,this._isAnimationSheetEnabled&&(this._vertexData[s++]=I.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[s++]=I.direction.x,this._vertexData[s++]=I.direction.y,this._vertexData[s++]=I.direction.z);else if(I._initialDirection){let V=I._initialDirection;this.isLocal&&(C.m.TransformNormalToRef(V,this._emitterWorldMatrix,C.g.LF[0]),V=C.g.LF[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[s++]=V.x,this._vertexData[s++]=V.y,this._vertexData[s++]=V.z}else{let V=I.direction;this.isLocal&&(C.m.TransformNormalToRef(V,this._emitterWorldMatrix,C.g.LF[0]),V=C.g.LF[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[s++]=V.x,this._vertexData[s++]=V.y,this._vertexData[s++]=V.z}this._useRampGradients&&I.remapData&&(this._vertexData[s++]=I.remapData.x,this._vertexData[s++]=I.remapData.y,this._vertexData[s++]=I.remapData.z,this._vertexData[s++]=I.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===m?m=this._epsilon:1===m&&(m=1-this._epsilon),0===l?l=this._epsilon:1===l&&(l=1-this._epsilon)),this._vertexData[s++]=m,this._vertexData[s++]=l)}_prepareParticle(V){}_createNewOnes(V){let I;for(let m=0;m<V&&this.WY.length!==this._capacity;m++){I=this._createParticle(),this.WY.push(I);let V=this._createQueueStart;for(;V;)V.process(I,this),V=V.nextItem;I._inheritParticleInfoToSubEmitters()}}_update(V){if(this._alive=this.WY.length>0,this.i.position){const V=this.i;this._emitterWorldMatrix=V.getWorldMatrix()}else{const V=this.i;this._emitterWorldMatrix=C.b.Translation(V.x,V.y,V.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.WY),this._createNewOnes(V)}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=[x.e.PositionKind,x.e.ColorKind,"angle","offset","size"];return V&&C.push("cellIndex"),I||C.push("direction"),m&&C.push("remapData"),C}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,IV.b)(C),V&&C.push("particlesInfos"),I&&C.push("logarithmicDepthConstant"),m&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,IV.i)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&V.push("#define FOG")),this._isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),I===j.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&V.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case 2:V.push("#define BILLBOARDY");break;case 8:case 9:V.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&V.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:V.push("#define BILLBOARDMODE_ALL")}m&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,I,m){I.push(...pV._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),V.push(...pV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),m.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,CV.g)(V,this._imageProcessingConfigurationDefines),(0,CV.c)(m,this._imageProcessingConfigurationDefines))}_getWrapper(V){const I=this._getCustomDrawWrapper(V);if(null!==I&&void 0!==I&&I.effect)return I;const m=[];this.fillDefines(m,V);const C=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let l=this._drawWrappers[C];l||(l=this._drawWrappers[C]=[]);let s=l[V];s||(s=new VV.b(this._engine),s.drawContext&&(s.drawContext.useInstancing=this._useInstancing),l[V]=s);const F=m.join("\n");if(s.defines!==F){const V=[],I=[],m=[];this.fillUniformsAttributesAndSamplerNames(I,V,m),s.setEffect(this._engine.createEffect("particles",V,I,m,F,void 0,void 0,void 0,void 0,this._shaderLanguage),F)}return s}animate(){var V;let I,m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!m&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(m?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this.manualEmitCount>-1)I=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let V=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const I=this._actualFrame/this.targetStopDuration;J.GetCurrentGradient(I,this._emitRateGradients,((I,m,C)=>{I!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=m.getFactor(),this._currentEmitRateGradient=I),V=(0,E.Lerp)(this._currentEmitRate1,this._currentEmitRate2,C)}))}I=V*this._scaledUpdateSpeed|0,this._newPartsExcess+=V*this._scaledUpdateSpeed-I}if(this._newPartsExcess>1&&(I+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?I=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(I),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!m){let V=0;for(let I=0;I<this.WY.length;I++){const m=this.WY[I];this._appendParticleVertices(V,m),V+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.WY.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(V,I){this._appendParticleVertex(V++,I,0,0),this._useInstancing||(this._appendParticleVertex(V++,I,1,0),this._appendParticleVertex(V++,I,1,1),this._appendParticleVertex(V++,I,0,1))}rebuild(){var V;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(V=this._spriteBuffer)||void 0===V||V._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!pV.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(m.bind(m,12655)),Promise.resolve().then(m.bind(m,12601))])):await Promise.all([Promise.resolve().then(m.bind(m,12589)),Promise.resolve().then(m.bind(m,12579))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==j.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(j.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(j.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(V){const I=this._getWrapper(V),m=I.effect,l=this._engine;l.enableEffect(I);const s=this.defaultViewMatrix??this._scene.getViewMatrix();if(m.setTexture("diffuseSampler",this.particleTexture),m.setMatrix("view",s),m.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();m.setFloat3("particlesInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,this.spriteCellWidth/V.width)}if(m.setVector2("translationPivot",this.translationPivot),m.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;m.setVector3("eyePosition",V.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),m.setTexture("rampSampler",this._rampGradientsTexture));const F=m.defines;var k,j,E,K,Y,X;(this._scene&&((0,IV.d)(m,this,this._scene),this.applyFog&&(0,mV.f)(this._scene,void 0,m)),F.indexOf("#define BILLBOARDMODE_ALL")>=0&&(s.invertToRef(C.g.Matrix[0]),m.setMatrix("invView",C.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?l.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,m):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,m)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?l.bindBuffers(this._vertexBuffers,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBuffer:this._indexBuffer,m):l.bindBuffers(this._vertexBuffers,null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._linesIndexBufferUseInstancing:null,m);(this.useLogarithmicDepth&&this._scene&&(0,mV.n)(F,m,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(m),this._setEngineBasedOnBlendMode(V),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(m),this._useInstancing)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?l.drawElementsType(6,0,10,this.WY.length):l.drawArraysType(7,0,4,this.WY.length):null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?l.drawElementsType(1,0,10*this.WY.length):l.drawElementsType(0,0,6*this.WY.length);return this.WY.length}render(){if(!this.isReady()||!this.WY.length)return 0;const V=this._engine;V.setState&&(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0));let I=0;return I=this.blendMode===j.BLENDMODE_MULTIPLYADD?this._render(j.BLENDMODE_MULTIPLY)+this._render(j.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),I}_onDispose(){}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(I,m),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const V=this._scene.ZY.indexOf(this);V>-1&&this._scene.ZY.splice(V,1),this._scene._activeParticleSystems.dispose()}this.Ck.notifyObservers(this),this.Ck.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}pV.ForceGLSL=!1;var MV,fV=m(11095);!function(V){V[V.ATTACHED=0]="ATTACHED",V[V.END=1]="END"}(MV||(MV={}));class wV{constructor(V){if(this.particleSystem=V,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!V.i||!V.i.dispose){const I=(0,k.d)("BABYLON.AbstractMesh");V.i=new I("SubemitterSystemEmitter",V.cV()),V._disposeEmitterOnDispose=!0}}clone(){let V=this.particleSystem.i;if(V){if(V instanceof C.m)V=V.clone();else if(-1!==V.getClassName().indexOf("Mesh")){V=new((0,k.d)("BABYLON.Mesh"))("",V.cV()),V.isVisible=!1}}else V=new C.m;const I=new wV(this.particleSystem.clone(this.particleSystem.name,V));return I.particleSystem.name+="Clone",I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem._disposeEmitterOnDispose=!0,I.particleSystem.disposeOnStop=!0,I}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem=this.particleSystem.serialize(V),I}static _ParseParticleSystem(V,I,m){throw(0,fV.c)("ParseParticle")}static Parse(V,I,m){const C=V.particleSystem,l=new wV(wV._ParseParticleSystem(C,I,m,!0));return l.type=V.type,l.inheritDirection=V.inheritDirection,l.inheritedVelocityAmount=V.inheritedVelocityAmount,l.particleSystem._isSubEmitter=!0,l}dispose(){this.particleSystem.dispose()}}var AV=m(11136);function JV(V,I){const m=new D;return m.direction1=V,m.direction2=I,m}function UV(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function eV(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function aV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.m(0,1,0),m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0);return new T(V,I,m)}function LV(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function VI(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.m(0,1,0);return new N(V,I,m,l,s)}function II(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new X(V,I)}function mI(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0);return new O(V,I,m,l)}const CI=C.m.Zero(),lI=C.m.Zero(),sI=C.m.Zero();class FI{constructor(){this.strength=0,this.position=C.m.Zero()}_processParticle(V,I){this.position.subtractToRef(V.position,CI);const m=CI.lengthSquared()+1;CI.normalize().scaleToRef(this.strength/m,lI),lI.scaleToRef(I._tempScaledUpdateSpeed,sI),V.direction.addInPlace(sI)}serialize(){return{position:this.position.UF(),strength:this.strength}}}class kI extends pV{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=V=>{if(!this._subEmitters||0===this._subEmitters.length)return;const I=Math.floor(Math.random()*this._subEmitters.length);for(const m of this._subEmitters[I])if(1===m.type){const I=m.clone();V._inheritParticleInfoToSubEmitter(I),I.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(I.particleSystem),I.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(V,I){const m=JV(V,I);return this.particleEmitterType=m,m}get flowMap(){return this._flowMap}set flowMap(V){this._flowMap!==V&&(this._flowMap=V,this._flowMapUpdate&&(oV(this._flowMapUpdate),this._flowMapUpdate=null),V&&(this._flowMapUpdate={process:V=>{var I;const m=null===(I=this.cV())||void 0===I?void 0:I.getTransformMatrix();this._flowMap._processParticle(V,this.flowMapStrength*this._tempScaledUpdateSpeed,m)},previousItem:null,nextItem:null},PV(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(V){this._attractors.push(V),1===this._attractors.length&&(this._attractorUpdate={process:V=>{for(const I of this._attractors)I._processParticle(V,this)},previousItem:null,nextItem:null},PV(this._attractorUpdate,this._directionProcessing))}removeAttractor(V){const I=this._attractors.indexOf(V);-1!==I&&this._attractors.splice(I,1),0===this._attractors.length&&oV(this._attractorUpdate)}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(V)}createHemisphericEmitter(){const V=UV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=eV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=aV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=LV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=VI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.m(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=mI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,I,m,C){const l=new Y;return this.particleEmitterType=l,this.direction1=V,this.direction2=I,this.minEmitBox=m,this.maxEmitBox=C,l}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const V of this.subEmitters)V instanceof kI?this._subEmitters.push([new wV(V)]):V instanceof wV?this._subEmitters.push([V]):V instanceof Array&&this._subEmitters.push(V)}_stopSubEmitters(){if(this.activeSubSystems){for(const V of this.activeSubSystems)V.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const V=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==V&&this._rootParticleSystem.activeSubSystems.splice(V,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(V){V&&this._stopSubEmitters()}_prepareParticle(V){if(this._subEmitters&&this._subEmitters.length>0){const I=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];V._attachedSubEmitters=[];for(const m of I)if(0===m.type){const I=m.clone();V._attachedSubEmitters.push(I),I.particleSystem.start()}}}_onDispose(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),V&&this.particles)for(const m of this.particles)if(m._attachedSubEmitters)for(let V=m._attachedSubEmitters.length-1;V>=0;V-=1)m._attachedSubEmitters[V].dispose();if(I&&this.activeSubSystems)for(let m=this.activeSubSystems.length-1;m>=0;m-=1)this.activeSubSystems[m].dispose();if(this._subEmitters&&this._subEmitters.length){for(let V=0;V<this._subEmitters.length;V++)for(const I of this._subEmitters[V])I.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.i&&this.i.dispose&&this.i.dispose(!0)}static _Parse(V,I,m,l){let s;s=m instanceof AV.b?null:m;const j=(0,k.d)("BABYLON.Texture");if(j&&s&&(V.texture?I.particleTexture=j.Parse(V.texture,s,l):V.textureName&&(I.particleTexture=new j(l+V.textureName,s,!1,void 0===V.invertY||V.invertY),I.particleTexture.name=V.textureName)),V.emitterId||0===V.emitterId||void 0!==V.i?V.emitterId&&s?I.i=s.getLastMeshById(V.emitterId):I.i=C.m.Ik(V.i):I.i=C.m.Zero(),I.isLocal=!!V.isLocal,void 0!==V.renderingGroupId&&(I.renderingGroupId=V.renderingGroupId),void 0!==V.isBillboardBased&&(I.isBillboardBased=V.isBillboardBased),void 0!==V.billboardMode&&(I.billboardMode=V.billboardMode),void 0!==V.useLogarithmicDepth&&(I.useLogarithmicDepth=V.useLogarithmicDepth),V.animations){for(let m=0;m<V.animations.length;m++){const C=V.animations[m],l=(0,k.d)("BABYLON.Animation");l&&I.animations.push(l.Parse(C))}I.beginAnimationOnStart=V.beginAnimationOnStart,I.beginAnimationFrom=V.beginAnimationFrom,I.beginAnimationTo=V.beginAnimationTo,I.beginAnimationLoop=V.beginAnimationLoop}if(V.autoAnimate&&s&&s.beginAnimation(I,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),I.startDelay=0|V.startDelay,I.minAngularSpeed=V.minAngularSpeed,I.maxAngularSpeed=V.maxAngularSpeed,I.minSize=V.minSize,I.maxSize=V.maxSize,V.minScaleX&&(I.minScaleX=V.minScaleX,I.maxScaleX=V.maxScaleX,I.minScaleY=V.minScaleY,I.maxScaleY=V.maxScaleY),void 0!==V.preWarmCycles&&(I.preWarmCycles=V.preWarmCycles,I.preWarmStepOffset=V.preWarmStepOffset),void 0!==V.minInitialRotation&&(I.minInitialRotation=V.minInitialRotation,I.maxInitialRotation=V.maxInitialRotation),I.minLifeTime=V.minLifeTime,I.maxLifeTime=V.maxLifeTime,I.minEmitPower=V.minEmitPower,I.maxEmitPower=V.maxEmitPower,I.emitRate=V.emitRate,I.gravity=C.m.Ik(V.gravity),V.noiseStrength&&(I.noiseStrength=C.m.Ik(V.noiseStrength)),I.color1=F.d.Ik(V.color1),I.color2=F.d.Ik(V.color2),I.colorDead=F.d.Ik(V.colorDead),I.updateSpeed=V.updateSpeed,I.targetStopDuration=V.targetStopDuration,I.blendMode=V.blendMode,V.colorGradients)for(const C of V.colorGradients)I.addColorGradient(C.gradient,F.d.Ik(C.color1),C.color2?F.d.Ik(C.color2):void 0);if(V.rampGradients){for(const m of V.rampGradients)I.addRampGradient(m.gradient,F.c.Ik(m.color));I.useRampGradients=V.useRampGradients}if(V.colorRemapGradients)for(const C of V.colorRemapGradients)I.addColorRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.alphaRemapGradients)for(const C of V.alphaRemapGradients)I.addAlphaRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.sizeGradients)for(const C of V.sizeGradients)I.addSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.angularSpeedGradients)for(const C of V.angularSpeedGradients)I.addAngularSpeedGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.velocityGradients)for(const C of V.velocityGradients)I.addVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.dragGradients)for(const C of V.dragGradients)I.addDragGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.emitRateGradients)for(const C of V.emitRateGradients)I.addEmitRateGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.startSizeGradients)for(const C of V.startSizeGradients)I.addStartSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.lifeTimeGradients)for(const C of V.lifeTimeGradients)I.addLifeTimeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(V.limitVelocityGradients){for(const m of V.limitVelocityGradients)I.addLimitVelocityGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);I.limitVelocityDamping=V.limitVelocityDamping}if(V.noiseTexture&&s){const m=(0,k.d)("BABYLON.ProceduralTexture");I.noiseTexture=m.Parse(V.noiseTexture,s,l)}let E;if(V.particleEmitterType){switch(V.particleEmitterType.type){case"SphereParticleEmitter":E=new b;break;case"SphereDirectedParticleEmitter":E=new T;break;case"ConeEmitter":case"ConeParticleEmitter":E=new X;break;case"ConeDirectedParticleEmitter":E=new O;break;case"CylinderParticleEmitter":E=new v;break;case"CylinderDirectedParticleEmitter":E=new N;break;case"HemisphericParticleEmitter":E=new t;break;case"PointParticleEmitter":E=new D;break;case"MeshParticleEmitter":E=new S;break;case"CustomParticleEmitter":E=new n;break;default:E=new Y}E.parse(V.particleEmitterType,s)}else E=new Y,E.parse(V,s);I.particleEmitterType=E,I.startSpriteCellID=V.startSpriteCellID,I.endSpriteCellID=V.endSpriteCellID,I.spriteCellLoop=V.spriteCellLoop??!0,I.spriteCellWidth=V.spriteCellWidth,I.spriteCellHeight=V.spriteCellHeight,I.spriteCellChangeSpeed=V.spriteCellChangeSpeed,I.spriteRandomStartCell=V.spriteRandomStartCell,I.disposeOnStop=V.disposeOnStop??!1,I.manualEmitCount=V.manualEmitCount??-1}static Parse(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0;const k=V.name;let j,E,K=null,Y=null;if(I instanceof AV.b?j=I:(E=I,j=E.getEngine()),V.customShader&&j.createEffectForParticles){Y=V.customShader;const I=Y.shaderOptions.defines.length>0?Y.shaderOptions.defines.join("\n"):"";K=j.createEffectForParticles(Y.shaderPath.fragmentElement,Y.shaderOptions.uniforms,Y.shaderOptions.samplers,I)}const X=new kI(k,s||V.xF,I,K,V.isAnimationSheetEnabled);if(X.customShader=Y,X._rootUrl=m,V.id&&(X.id=V.id),V.subEmitters){X.subEmitters=[];for(const C of V.subEmitters){const V=[];for(const l of C)V.push(wV.Parse(l,I,m));X.subEmitters.push(V)}}if(V.attractors)for(const F of V.attractors){const V=new FI;V.position=C.m.Ik(F.position),V.strength=F.strength,X.addAttractor(V)}return kI._Parse(V,X,I,m),V.textureMask&&(X.textureMask=F.d.Ik(V.textureMask)),V.wj&&(X.wj=C.m.Ik(V.wj)),V.preventAutoStart&&(X.preventAutoStart=V.preventAutoStart),l||X.preventAutoStart||X.start(),X}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};if(kI._Serialize(I,this,V),I.textureMask=this.textureMask.UF(),I.customShader=this.customShader,I.preventAutoStart=this.preventAutoStart,I.wj=this.wj.UF(),this.subEmitters){I.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const m of this._subEmitters){const C=[];for(const I of m)C.push(I.serialize(V));I.subEmitters.push(C)}}if(this._attractors&&this._attractors.length){I.attractors=[];for(const V of this._attractors)I.attractors.push(V.serialize())}return I}static _Serialize(V,I,m){if(V.name=I.name,V.id=I.id,V.xF=I.getCapacity(),V.disposeOnStop=I.disposeOnStop,V.manualEmitCount=I.manualEmitCount,I.i.position){const m=I.i;V.emitterId=m.id}else{const m=I.i;V.i=m.UF()}I.particleEmitterType&&(V.particleEmitterType=I.particleEmitterType.serialize()),I.particleTexture&&(m?V.texture=I.particleTexture.serialize():(V.textureName=I.particleTexture.name,V.invertY=!!I.particleTexture._invertY)),V.isLocal=I.isLocal,r.d.AppendSerializedAnimations(I,V),V.beginAnimationOnStart=I.beginAnimationOnStart,V.beginAnimationFrom=I.beginAnimationFrom,V.beginAnimationTo=I.beginAnimationTo,V.beginAnimationLoop=I.beginAnimationLoop,V.startDelay=I.startDelay,V.renderingGroupId=I.renderingGroupId,V.isBillboardBased=I.isBillboardBased,V.billboardMode=I.billboardMode,V.minAngularSpeed=I.minAngularSpeed,V.maxAngularSpeed=I.maxAngularSpeed,V.minSize=I.minSize,V.maxSize=I.maxSize,V.minScaleX=I.minScaleX,V.maxScaleX=I.maxScaleX,V.minScaleY=I.minScaleY,V.maxScaleY=I.maxScaleY,V.minEmitPower=I.minEmitPower,V.maxEmitPower=I.maxEmitPower,V.minLifeTime=I.minLifeTime,V.maxLifeTime=I.maxLifeTime,V.emitRate=I.emitRate,V.gravity=I.gravity.UF(),V.noiseStrength=I.noiseStrength.UF(),V.color1=I.color1.UF(),V.color2=I.color2.UF(),V.colorDead=I.colorDead.UF(),V.updateSpeed=I.updateSpeed,V.targetStopDuration=I.targetStopDuration,V.blendMode=I.blendMode,V.preWarmCycles=I.preWarmCycles,V.preWarmStepOffset=I.preWarmStepOffset,V.minInitialRotation=I.minInitialRotation,V.maxInitialRotation=I.maxInitialRotation,V.startSpriteCellID=I.startSpriteCellID,V.spriteCellLoop=I.spriteCellLoop,V.endSpriteCellID=I.endSpriteCellID,V.spriteCellChangeSpeed=I.spriteCellChangeSpeed,V.spriteCellWidth=I.spriteCellWidth,V.spriteCellHeight=I.spriteCellHeight,V.spriteRandomStartCell=I.spriteRandomStartCell,V.isAnimationSheetEnabled=I.isAnimationSheetEnabled,V.useLogarithmicDepth=I.useLogarithmicDepth;const C=I.getColorGradients();if(C){V.colorGradients=[];for(const I of C){const m={gradient:I.gradient,color1:I.color1.UF()};I.color2?m.color2=I.color2.UF():m.color2=I.color1.UF(),V.colorGradients.push(m)}}const l=I.getRampGradients();if(l){V.rampGradients=[];for(const I of l){const m={gradient:I.gradient,color:I.color.UF()};V.rampGradients.push(m)}V.useRampGradients=I.useRampGradients}const s=I.getColorRemapGradients();if(s){V.colorRemapGradients=[];for(const I of s){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.colorRemapGradients.push(m)}}const F=I.getAlphaRemapGradients();if(F){V.alphaRemapGradients=[];for(const I of F){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.alphaRemapGradients.push(m)}}const k=I.getSizeGradients();if(k){V.sizeGradients=[];for(const I of k){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.sizeGradients.push(m)}}const j=I.getAngularSpeedGradients();if(j){V.angularSpeedGradients=[];for(const I of j){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.angularSpeedGradients.push(m)}}const E=I.getVelocityGradients();if(E){V.velocityGradients=[];for(const I of E){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.velocityGradients.push(m)}}const K=I.getDragGradients();if(K){V.dragGradients=[];for(const I of K){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.dragGradients.push(m)}}const Y=I.getEmitRateGradients();if(Y){V.emitRateGradients=[];for(const I of Y){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.emitRateGradients.push(m)}}const X=I.getStartSizeGradients();if(X){V.startSizeGradients=[];for(const I of X){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.startSizeGradients.push(m)}}const O=I.getLifeTimeGradients();if(O){V.lifeTimeGradients=[];for(const I of O){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.lifeTimeGradients.push(m)}}const v=I.getLimitVelocityGradients();if(v){V.limitVelocityGradients=[];for(const I of v){const m={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?m.factor2=I.factor2:m.factor2=I.factor1,V.limitVelocityGradients.push(m)}V.limitVelocityDamping=I.limitVelocityDamping}I.noiseTexture&&(V.noiseTexture=I.noiseTexture.serialize())}clone(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let l=null;const s=this._engine;if(s.createEffectForParticles&&null!=this.customShader){l=this.customShader;const V=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"",I=s.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,V);C[0]?C[0].effect=I:this.setCustomEffect(I,0)}const F=this.serialize(m),k=kI.Parse(F,this._scene||this._engine,this._rootUrl);return k.name=V,k.customShader=l,k._customWrappers=C,void 0===I&&(I=this.i),this.noiseTexture&&(k.noiseTexture=this.noiseTexture.clone()),k.i=I,this.preventAutoStart||k.start(),k}}kI.BILLBOARDMODE_Y=2,kI.BILLBOARDMODE_ALL=7,kI.BILLBOARDMODE_STRETCHED=8,kI.BILLBOARDMODE_STRETCHED_LOCAL=9,wV._ParseParticleSystem=kI.Parse;var jI=m(11605),EI=m(11596),KI=m(11428);KI.c.prototype.createTransformFeedback=function(){const V=this._gl.createTransformFeedback();if(!V)throw new Error("Unable to create Transform Feedback");return V},KI.c.prototype.deleteTransformFeedback=function(V){this._gl.deleteTransformFeedback(V)},KI.c.prototype.bindTransformFeedback=function(V){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,V)},KI.c.prototype.beginTransformFeedback=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(V?this._gl.POINTS:this._gl.TRIANGLES)},KI.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},KI.c.prototype.setTranformFeedbackVaryings=function(V,I){this._gl.transformFeedbackVaryings(V,I,this._gl.INTERLEAVED_ATTRIBS)},KI.c.prototype.bindTransformFeedbackBuffer=function(V){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V?V.underlyingResource:null)},KI.c.prototype.readTransformFeedbackBuffer=function(V){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V)};const YI="clipPlaneFragmentDeclaration2",XI="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";H.e.IncludesShadersStore[YI]||(H.e.IncludesShadersStore[YI]=XI);m(12471),m(12480),m(12488),m(12491),m(12499),m(12501),m(12510),m(12519);const OI="gpuRenderParticlesPixelShader",vI="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";H.e.ShadersStore[OI]||(H.e.ShadersStore[OI]=vI);const NI="clipPlaneVertexDeclaration2",tI="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";H.e.IncludesShadersStore[NI]||(H.e.IncludesShadersStore[NI]=tI);m(12525),m(12532),m(12534),m(12541);const DI="gpuRenderParticlesVertexShader",bI="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";H.e.ShadersStore[DI]||(H.e.ShadersStore[DI]=bI);class TI extends j{static get IsSupported(){if(!a.c.LastCreatedEngine)return!1;const V=a.c.LastCreatedEngine.getCaps();return V.supportTransformFeedbacks||V.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(V){this._maxActiveParticleCount=Math.min(V,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(V){this.maxActiveParticleCount=V}createPointEmitter(V,I){const m=JV(V,I);return this.particleEmitterType=m,m}createHemisphericEmitter(){const V=UV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=eV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=aV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=LV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=VI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.m(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=mI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.m(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,I,m,C){const l=new Y;return this.particleEmitterType=l,this.direction1=V,this.direction2=I,this.minEmitBox=m,this.maxEmitBox=C,l}get flowMap(){return this._flowMap}set flowMap(V){this._flowMap!==V&&(this._flowMap=V)}isReady(){if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==kI.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(kI.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(kI.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";V?setTimeout((()=>{this.start(0)}),V):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[I])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new VV.b(this._engine),this._customWrappers[I].effect=V}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new U.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(V,I,m){return super._removeGradientAndTexture(V,I,m),this._releaseBuffers(),this}addColorGradient(V,I){this._colorGradients||(this._colorGradients=[]);const m=new f(V,I);return this._colorGradients.push(m),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(V&&this._colorGradients.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(V){return this._removeGradientAndTexture(V,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const I in this._drawWrappers){var V;null===(V=this._drawWrappers[I].drawContext)||void 0===V||V.reset()}}_addFactorGradient(V,I,m){const C=new A(I,m);V.push(C),this._releaseBuffers()}addSizeGradient(V,I){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,I),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(V){return this._removeGradientAndTexture(V,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(V,I){if(!V)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&V.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0));const m=this;m[I]&&(m[I].dispose(),m[I]=null)}addAngularSpeedGradient(V,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,I),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(V){return this._removeGradientAndTexture(V,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(V,I){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,I),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(V){return this._removeGradientAndTexture(V,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(V,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,I),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(V){return this._removeGradientAndTexture(V,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(V,I){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,I),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(V){return this._removeGradientAndTexture(V,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(V){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(V),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ck=new U.e,this.onStoppedObservable=new U.e,this.onStartedObservable=new U.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,m&&"Scene"!==m.getClassName()?(this._engine=m,this.defaultProjectionMatrix=C.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=m||a.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ZY.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,k.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,k.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,k.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,k.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new VV.b(this._engine)},this._customWrappers[0].effect=l,this._drawWrappers={0:new VV.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(I=I??{}).randomTextureSize||delete I.randomTextureSize;const F={xF:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...I},j=I;isFinite(j)&&(F.xF=j),this._capacity=F.xF,this._maxActiveParticleCount=F.xF,this._currentActiveCount=0,this._isAnimationSheetEnabled=s,this.particleEmitterType=new Y;const E=Math.min(this._engine.getCaps().maxTextureSize,F.randomTextureSize);let K=[];for(let C=0;C<E;++C)K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),K.push(Math.random());this._randomTexture=new e.d(new Float32Array(K),E,1,5,m,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,K=[];for(let C=0;C<E;++C)K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),K.push(Math.random());this._randomTexture2=new e.d(new Float32Array(K),E,1,5,m,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=E}_reset(){this._releaseBuffers()}_createVertexBuffers(V,I,m){const C={};C.position=I.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let l=3;C.age=I.createVertexBuffer("age",l,1,this._attributesStrideSize,!0),l+=1,C.size=I.createVertexBuffer("size",l,3,this._attributesStrideSize,!0),l+=3,C.life=I.createVertexBuffer("life",l,1,this._attributesStrideSize,!0),l+=1,l+=4,this.billboardMode===kI.BILLBOARDMODE_STRETCHED&&(C.direction=I.createVertexBuffer("direction",l,3,this._attributesStrideSize,!0)),l+=3,this._platform.alignDataInBuffer&&(l+=1),this.particleEmitterType instanceof n&&(l+=3,this._platform.alignDataInBuffer&&(l+=1)),this._colorGradientsTexture||(C.color=I.createVertexBuffer("color",l,4,this._attributesStrideSize,!0),l+=4),this._isBillboardBased||(C.initialDirection=I.createVertexBuffer("initialDirection",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1)),this.noiseTexture&&(C.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1),C.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1)),C.angle=I.createVertexBuffer("angle",l,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?l++:l+=2,this._isAnimationSheetEnabled&&(C.cellIndex=I.createVertexBuffer("cellIndex",l,1,this._attributesStrideSize,!0),l+=1,this.spriteRandomStartCell&&(C.cellStartOffset=I.createVertexBuffer("cellStartOffset",l,1,this._attributesStrideSize,!0),l+=1)),C.offset=m.createVertexBuffer("offset",0,2),C.uv=m.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(C),this._platform.createVertexBuffers(V,C),this.resetDrawCache()}_initialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!V)return;const I=this._engine,m=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof n&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const l=this.particleEmitterType instanceof n,s=C.g.LF[0];let F=0;for(let C=0;C<this._capacity;C++)if(m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),l?(this.particleEmitterType.particleDestinationGenerator(C,null,s),m.push(s.x),m.push(s.y),m.push(s.z)):(m.push(0),m.push(0),m.push(0)),this._platform.alignDataInBuffer&&m.push(0),F+=16,l&&(this.particleEmitterType.particlePositionGenerator(C,null,s),m.push(s.x),m.push(s.y),m.push(s.z),this._platform.alignDataInBuffer&&m.push(0),F+=4),this._colorGradientsTexture||(m.push(0),m.push(0),m.push(0),m.push(0),F+=4),this.isBillboardBased||(m.push(0),m.push(0),m.push(0),this._platform.alignDataInBuffer&&m.push(0),F+=4),this.noiseTexture&&(m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),this._platform.alignDataInBuffer&&m.push(0),m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),this._platform.alignDataInBuffer&&m.push(0),F+=8),m.push(0),F+=1,this._angularSpeedGradientsTexture||(m.push(0),F+=1),this._isAnimationSheetEnabled&&(m.push(0),F+=1,this.spriteRandomStartCell&&(m.push(0),F+=1)),this._platform.alignDataInBuffer){let V=3-(F+3&3);for(F+=V;V-- >0;)m.push(0)}const k=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),j=this._platform.createParticleBuffer(m),E=this._platform.createParticleBuffer(m);this._buffer0=new x.c(I,j,!1,this._attributesStrideSize),this._buffer1=new x.c(I,E,!1,this._attributesStrideSize),this._spriteBuffer=new x.c(I,k,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let V=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(V+="\n#define BILLBOARD"),this._colorGradientsTexture&&(V+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(V+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(V+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(V+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(V+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(V+="\n#define DRAGGRADIENTS"),this._flowMap&&(V+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(V+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(V+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(V+="\n#define NOISE"),this.isLocal&&(V+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===V||(this._cachedUpdateDefines=V,this._updateBuffer=this._platform.createUpdateBuffer(V)),this._platform.isUpdateBufferReady()}_getWrapper(V){const I=this._getCustomDrawWrapper(V);if(null!==I&&void 0!==I&&I.effect)return I;const m=[];this.fillDefines(m,V);let C=this._drawWrappers[V];C||(C=new VV.b(this._engine),C.drawContext&&(C.drawContext.useInstancing=!0),this._drawWrappers[V]=C);const l=m.join("\n");if(C.defines!==l){const V=[],I=[],m=[];this.fillUniformsAttributesAndSamplerNames(I,V,m),C.setEffect(this._engine.createEffect("gpuRenderParticles",V,I,m,l),l)}return C}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=[x.e.PositionKind,"age","life","size","angle"];return V||l.push(x.e.ColorKind),I&&l.push("cellIndex"),m||l.push("initialDirection"),C&&l.push("direction"),l.push("offset",x.e.UVKind),l}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["emitterWM","wj","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,IV.b)(C),V&&C.push("sheetInfos"),I&&C.push("logarithmicDepthConstant"),m&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,IV.i)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==EI.e.FOGMODE_NONE&&V.push("#define FOG")),I===kI.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this.isLocal&&V.push("#define LOCAL"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case kI.BILLBOARDMODE_Y:V.push("#define BILLBOARDY");break;case kI.BILLBOARDMODE_STRETCHED:V.push("#define BILLBOARDSTRETCHED");break;case kI.BILLBOARDMODE_ALL:V.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&V.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),m&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,I,m){I.push(...TI._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===kI.BILLBOARDMODE_STRETCHED)),V.push(...TI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),m.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(jI.e.PrepareUniforms(V,this._imageProcessingConfigurationDefines),jI.e.PrepareSamplers(m,this._imageProcessingConfigurationDefines))}animate(){var V;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(I?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(V,I){const m=this[I];if(!V||!V.length||m)return;const C=new Float32Array(this._rawTextureWidth);for(let l=0;l<this._rawTextureWidth;l++){const I=l/this._rawTextureWidth;J.GetCurrentGradient(I,V,((V,I,m)=>{C[l]=(0,E.Lerp)(V.factor1,I.factor1,m)}))}this[I]=e.d.CreateRTexture(C,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[I].name=I.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const V=new Uint8Array(4*this._rawTextureWidth),I=F.f.dX[0];for(let m=0;m<this._rawTextureWidth;m++){const C=m/this._rawTextureWidth;J.GetCurrentGradient(C,this._colorGradients,((C,l,s)=>{F.d.LerpToRef(C.color1,l.color1,s,I),V[4*m]=255*I.r,V[4*m+1]=255*I.g,V[4*m+2]=255*I.b,V[4*m+3]=255*I.a}))}this._colorGradientsTexture=e.d.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(V,I){var m,l,s,F;const k=this._getWrapper(V),j=k.effect;this._engine.enableEffect(k);const E=(null===(m=this._scene)||void 0===m?void 0:m.getViewMatrix())||C.b.IdentityReadOnly;if(j.setMatrix("view",E),j.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),j.setTexture("diffuseSampler",this.particleTexture),j.setVector2("translationPivot",this.translationPivot),j.setVector3("wj",this.wj),this.isLocal&&j.setMatrix("emitterWM",I),this._colorGradientsTexture?j.setTexture("colorGradientSampler",this._colorGradientsTexture):j.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();j.setFloat3("sheetInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,V.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;j.setVector3("eyePosition",V.globalPosition)}const K=j.defines;if(this._scene&&((0,IV.d)(j,this,this._scene),this.applyFog&&(0,mV.f)(this._scene,void 0,j)),K.indexOf("#define BILLBOARDMODE_ALL")>=0){const V=E.clone();V.invert(),j.setMatrix("invView",V)}return this.useLogarithmicDepth&&this._scene&&(0,mV.n)(K,j,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(j),this._setEngineBasedOnBlendMode(V),this._platform.bindDrawBuffers(this._targetIndex,j,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(j),null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(F=this._scene)&&void 0!==F&&F.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(V){if(!this.i||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!V)if(this.i.position){V=this.i.getWorldMatrix()}else{const I=this.i;V=C.g.Matrix[0],C.b.TranslationToRef(I.x,I.y,I.z,V)}const I=this._engine,m=I.getDepthWrite();if(I.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const V=this.cV();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",V.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",V),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const l=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=l,I.setDepthWrite(m)}render(){let V,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!I&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const V=0|this._accumulatedCount;this._accumulatedCount-=V,this._currentActiveCount+=V}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.i.position){V=this.i.getWorldMatrix()}else{const I=this.i;V=C.g.Matrix[0],C.b.TranslationToRef(I.x,I.y,I.z,V)}const l=this._engine;this.updateInAnimate||this._update(V);let s=0;return I||m||(l.setState(!1),this.forceDepthWrite&&l.setDepthWrite(!0),s=this.blendMode===kI.BLENDMODE_MULTIPLYADD?this._render(kI.BLENDMODE_MULTIPLY,V)+this._render(kI.BLENDMODE_ADD,V):this._render(this.blendMode,V),this._engine.setAlphaMode(0)),s}rebuild(){const V=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(V,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,V()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const I in this._drawWrappers){this._drawWrappers[I].dispose()}if(this._drawWrappers={},this._scene){const V=this._scene.ZY.indexOf(this);V>-1&&this._scene.ZY.splice(V,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let I=0;I<this._renderVertexBuffers.length;++I){const V=this._renderVertexBuffers[I];for(const I in V)V[I].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ck.notifyObservers(this),this.Ck.clear()}clone(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let l=null;const s=this._engine;if(s.createEffectForParticles&&null!=this.customShader){l=this.customShader;const V=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";C[0]=s.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,V,void 0,void 0,void 0,this)}const F=this.serialize(m),k=TI.Parse(F,this._scene||this._engine,this._rootUrl);return k.name=V,k.customShader=l,k._customWrappers=C,void 0===I&&(I=this.i),this.noiseTexture&&(k.noiseTexture=this.noiseTexture.clone()),k.i=I,k}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return kI._Serialize(I,this,V),I.activeParticleCount=this.activeParticleCount,I.randomTextureSize=this._randomTextureSize,I.customShader=this.customShader,I}static Parse(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0;const s=V.name;let F,k;I instanceof AV.b?F=I:(k=I,F=k.getEngine());const j=new TI(s,{xF:l||V.xF,randomTextureSize:V.randomTextureSize},I,null,V.isAnimationSheetEnabled);if(j._rootUrl=m,V.customShader&&F.createEffectForParticles){const I=V.customShader,m=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",C=F.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,m,void 0,void 0,void 0,j);j.setCustomEffect(C,0),j.customShader=I}return V.id&&(j.id=V.id),V.activeParticleCount&&(j.activeParticleCount=V.activeParticleCount),kI._Parse(V,j,I,m),V.preventAutoStart&&(j.preventAutoStart=V.preventAutoStart),C||j.preventAutoStart||j.start(),j}}var nI=m(11076),xI=m(12548),SI=m(11691);class cI{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(V){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const I of this.systems)I.i=V;this._emitterNode=V}setEmitterAsSphere(V,I,m){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:V,renderingGroupId:I};const C=(0,xI.c)("emitterSphere",{diameter:V.diameter,segments:V.segments},m);C.renderingGroupId=I;const l=new SI.d("emitterSphereMaterial",m);l.emissiveColor=V.color,C.material=l;for(const s of this.systems)s.i=C;this._emitterNode=C}start(V){for(const I of this.systems)V&&(I.i=V),I.start()}dispose(){for(const V of this.systems)V.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={systems:[]};for(const m of this.systems)I.systems.push(m.serialize(V));return this._emitterNode&&(I.i=this._emitterCreationOptions),I}static Parse(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;const l=new cI,s=this.BaseAssetsUrl+"/textures/";I=I||a.c.LastCreatedScene;for(const F of V.systems)l.systems.push(m?TI.Parse(F,I,s,!0,C):kI.Parse(F,I,s,!0,C));if(V.i){const m=V.i.options;if("Sphere"===V.i.kind)l.setEmitterAsSphere({diameter:m.diameter,segments:m.segments,color:F.c.Ik(m.color)},V.i.renderingGroupId,I)}return l}}cI.BaseAssetsUrl="https://assets.babylonjs.com/particles";var HI=m(11099);class yI{static CreateDefault(V){let I,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,C=arguments.length>2?arguments[2]:void 0;I=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new TI("default system",{xF:m},C):new kI("default system",m,C),I.i=V;const l=nI.d.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return I.particleTexture=new g.e(l,I.cV()),I.createConeEmitter(.1,Math.PI/4),I.color1=new F.d(1,1,1,1),I.color2=new F.d(1,1,1,1),I.colorDead=new F.d(1,1,1,0),I.minSize=.1,I.maxSize=.1,I.minEmitPower=2,I.maxEmitPower=2,I.updateSpeed=1/60,I.emitRate=30,I}static CreateAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;I||(I=a.c.LastCreatedScene);const l={};return I.addPendingData(l),new Promise(((s,F)=>{if(m&&!TI.IsSupported)return I.removePendingData(l),F("Particle system with GPU is not supported.");nI.d.LoadFile(`${yI.BaseAssetsUrl}/systems/${V}.json`,(V=>{I.removePendingData(l);const F=JSON.parse(V.toString());return s(cI.Parse(F,I,m,C))}),void 0,void 0,void 0,(()=>(I.removePendingData(l),F(`An error occurred with the creation of your particle system. Check if your type '${V}' exists.`))))}))}static ExportSet(V){const I=new cI;for(const m of V)I.systems.push(m);return I}static ParseFromFileAsync(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5?arguments[5]:void 0;return new Promise(((F,k)=>{const j=new HI.c;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const I=JSON.parse(j.responseText);let k;k=C?TI.Parse(I,m,l,!1,s):kI.Parse(I,m,l,!1,s),V&&(k.name=V),F(k)}else k("Unable to load the particle system")})),j.open("GET",I),j.send()}))}static ParseFromSnippetAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4?arguments[4]:void 0;if("_BLANK"===V){const V=this.CreateDefault(null);return V.start(),Promise.resolve(V)}return new Promise(((s,F)=>{const k=new HI.c;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const F=JSON.parse(JSON.parse(k.responseText).jsonPayload),j=JSON.parse(F.particleSystem);let E;E=m?TI.Parse(j,I,C,!1,l):kI.Parse(j,I,C,!1,l),E.snippetId=V,s(E)}else F("Unable to load the snippet "+V)})),k.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),k.send()}))}}yI.BaseAssetsUrl=cI.BaseAssetsUrl,yI.SnippetUrl="https://snippet.babylonjs.com",yI.CreateFromSnippetAsync=yI.ParseFromSnippetAsync;var zI=m(11384),ZI=m(11421),BI=m(12555);(0,BI.e)(ZI.c.NAME_PARTICLESYSTEM,((V,I,m,C)=>{const l=(0,BI.i)(ZI.c.NAME_PARTICLESYSTEM);if(l&&void 0!==V.ZY&&null!==V.ZY)for(let s=0,F=V.ZY.length;s<F;s++){const F=V.ZY[s];m.ZY.push(l(F,I,C))}})),(0,BI.b)(ZI.c.NAME_PARTICLESYSTEM,((V,I,m)=>{if(V.activeParticleCount){return TI.Parse(V,I,m)}return kI.Parse(V,I,m)})),AV.b.prototype.createEffectForParticles=function(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,K=arguments.length>9?arguments[9]:void 0,Y=[],X=[];const O=[];return j?j.fillUniformsAttributesAndSamplerNames(X,Y,O):(Y=kI._GetAttributeNamesOrOptions(),X=kI._GetEffectCreationOptions()),-1===l.indexOf(" BILLBOARD")&&(l+="\n#define BILLBOARD\n"),null!==j&&void 0!==j&&j.isAnimationSheetEnabled&&-1===l.indexOf(" ANIMATESHEET")&&(l+="\n#define ANIMATESHEET\n"),-1===C.indexOf("diffuseSampler")&&C.push("diffuseSampler"),this.createEffect({vertex:K??(null===j||void 0===j?void 0:j.vertexShaderName)??"particles",fragmentElement:V},Y,X.concat(I),O.concat(C),l,s,F,k,void 0,E,(async()=>{0===E?await Promise.resolve().then(m.bind(m,12589)):await Promise.resolve().then(m.bind(m,12655))}))},zI.c.prototype.getEmittedParticleSystems=function(){const V=[];for(let I=0;I<this.cV().ZY.length;I++){const m=this.cV().ZY[I];m.i===this&&V.push(m)}return V},zI.c.prototype.getHierarchyEmittedParticleSystems=function(){const V=[],I=this.getDescendants();I.push(this);for(let m=0;m<this.cV().ZY.length;m++){const C=this.cV().ZY[m],l=C.i;l.position&&-1!==I.indexOf(l)&&V.push(C)}return V};m(11251),m(11263),m(11342);m(11350),m(12560),m(11372),m(11224),m(11419);m(11496);var WI;m(12564),m(11507);!function(V){V[V.Color=2]="Color",V[V.UV=1]="UV",V[V.Random=0]="Random",V[V.Stated=3]="Stated"}(WI||(WI={}));var QI=m(11514);const GI=new C.m(0,0,0),rI=new C.m(0,0,0),gI=new C.m(0,0,0);class hI{constructor(V,I,m){this.width=V,this.height=I,this.data=m}processFlowable(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;if(!m)return;m instanceof C.b?C.m.TransformCoordinatesToRef(V.position,m,gI):(gI.x=m.x,gI.y=m.y,gI.z=m.z);const l=.5*gI.x+.5,s=1-(.5*gI.y+.5),F=Math.floor(l*this.width),k=Math.floor(s*this.height);if(F<0||F>=this.width||k<0||k>=this.height)return;const j=4*(k*this.width+F),E=this.data[j]/255*2-1,K=this.data[j+1]/255*2-1,Y=this.data[j+2]/255*2-1,X=this.data[j+3]/255;GI.set(E,K,Y),GI.scaleToRef(I*X,rI),V.direction.addInPlace(rI)}_processParticle(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;this.processFlowable(V,I,m)}static async FromUrlAsync(V){return await new Promise(((I,m)=>{const C=document.createElement("canvas"),l=C.getContext("2d");let s=null;const F=new Image;F.crossOrigin="anonymous",F.src=V,F.onerror=I=>{m(new Error(`Failed to load image: ${V} : ${I}`))},F.onload=()=>{C.width=F.width,C.height=F.height,l.drawImage(F,0,0),s=l.getImageData(0,0,C.width,C.height),I(new hI(C.width,C.height,s.data))}}))}static async ExtractFromTextureAsync(V){return await new Promise(((I,m)=>{if(!V.isReady())return void V.onLoadObservable.addOnce((async()=>{try{const m=await this.ExtractFromTextureAsync(V);I(m)}catch(C){m(C)}}));const C=V.getSize();QI.j.GetTextureDataAsync(V,C.width,C.height).then((V=>{I(new hI(C.width,C.height,new Uint8ClampedArray(V)))})).catch(m)}))}}var dI,RI,iI,qI,PI,uI,oI,pI,MI;!function(V){V[V.Int=1]="Int",V[V.Float=2]="Float",V[V.Vector2=4]="Vector2",V[V.LF=8]="LF",V[V.Matrix=16]="Matrix",V[V.Particle=32]="Particle",V[V.Texture=64]="Texture",V[V.dX=128]="dX",V[V.FloatGradient=256]="FloatGradient",V[V.Vector2Gradient=512]="Vector2Gradient",V[V.Vector3Gradient=1024]="Vector3Gradient",V[V.Color4Gradient=2048]="Color4Gradient",V[V.System=4096]="System",V[V.AutoDetect=8192]="AutoDetect",V[V.BasedOnInput=16384]="BasedOnInput",V[V.Undefined=32768]="Undefined",V[V.All=65535]="All"}(dI||(dI={})),function(V){V[V.Compatible=0]="Compatible",V[V.TypeIncompatible=1]="TypeIncompatible",V[V.HierarchyIssue=2]="HierarchyIssue"}(RI||(RI={})),function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(iI||(iI={}));class fI{get direction(){return this._direction}get type(){if(this._type===dI.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===dI.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(V){this._type=V}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((V=>V.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(V,I,m){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=dI.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new U.e,this.onDisconnectionObservable=new U.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=I,this.name=V,this._direction=m}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(V){var I;return this.isConnected?null!==(I=this._connectedPoint)&&void 0!==I&&I._storedFunction?this._connectedPoint._storedFunction(V):this._connectedPoint._storedValue:this.value}canConnectTo(V){return 0===this.checkCompatibilityState(V)}checkCompatibilityState(V){const I=this._ownerBlock,m=V.ownerBlock;if(this.type!==V.type&&V.innerType!==dI.AutoDetect)return V.acceptedConnectionPointTypes&&-1!==V.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(V.excludedConnectionPointTypes&&-1!==V.excludedConnectionPointTypes.indexOf(this.type))return 1;let C=m,l=I;return 0===this.direction&&(C=I,l=m),C.isAnAncestorOf(l)?2:0}connectTo(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(V))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${V.ownerBlock.name}".${V.name}`;return this._endpoints.push(V),V._connectedPoint=this,this.onConnectionObservable.notifyObservers(V),V.onConnectionObservable.notifyObservers(this),this}disconnectFrom(V){const I=this._endpoints.indexOf(V);return-1===I||(this._endpoints.splice(I,1),V._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(V),V.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(V){let I=1;for(;I<dI.All;)V&I||this.excludedConnectionPointTypes.push(I),I<<=1}serialize(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const I={};return I.name=this.name,I.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.UF?(I.valueType="BABYLON."+this.value.getClassName(),I.value=this.value.UF()):(I.valueType="number",I.value=this.value)),V&&this.connectedPoint&&(I.inputName=this.name,I.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,I.targetConnectionName=this.connectedPoint.name,I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),I}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class wI{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(V){this._name=V}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(V){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new U.e,this.Ck=new U.e,this.onInputChangedObservable=new U.e,this.visibleOnFrame=!1,this._name=V,this.uniqueId=h.d.UniqueId}_inputRename(V){return V}_outputRename(V){return V}isAnAncestorOf(V){for(const I of this._outputs)if(I.hasEndpoints)for(const m of I.endpoints){if(m.ownerBlock===V)return!0;if(m.ownerBlock.isAnAncestorOf(V))return!0}return!1}isAnAncestorOfType(V){if(this.getClassName()===V)return!0;for(const I of this._outputs)if(I.hasEndpoints)for(const m of I.endpoints)if(m.ownerBlock.isAnAncestorOfType(V))return!0;return!1}getInputByName(V){const I=this._inputs.filter((I=>I.name===V));return I.length?I[0]:null}_linkConnectionTypes(V,I){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[I]._acceptedConnectionPointType=this._inputs[V]:(this._inputs[V]._linkedConnectionSource=this._inputs[I],this._inputs[V]._isMainLinkSource=!0),this._inputs[I]._linkedConnectionSource=this._inputs[V]}registerInput(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;const F=new fI(V,this,0);return F.type=I,F.isOptional=m,F.defaultValue=C,F.value=C,F.valueMin=l,F.valueMax=s,this._inputs.push(F),this.onInputChangedObservable.notifyObservers(F),this}registerOutput(V,I,m){return(m=m??new fI(V,this,1)).type=I,this._outputs.push(m),this}_build(V){}_customBuildStep(V){}build(V){if(this._buildId===V.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((V=>V.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=V.buildId;for(const I of this._inputs){if(!I.connectedPoint){I.isOptional||V.notConnectedNonOptionalInputs.push(I);continue}const m=I.connectedPoint.ownerBlock;m&&m!==this&&!m.isSystem&&m.build(V)}return this._customBuildStep(V),V.verbose&&d.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(V),this.onBuildObservable.notifyObservers(this),!1}serialize(){const V={};V.customType="BABYLON."+this.getClassName(),V.id=this.uniqueId,V.name=this.name,V.visibleOnFrame=this.visibleOnFrame,V.inputs=[],V.outputs=[];for(const I of this.inputs)V.inputs.push(I.serialize());for(const I of this.outputs)V.outputs.push(I.serialize(!1));return V}_deserialize(V){this._name=V.name,this.comments=V.comments,this.visibleOnFrame=!!V.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(V)}_deserializePortDisplayNamesAndExposedOnFrame(V){const I=V.inputs,m=V.outputs;if(I)for(const C of I){const V=this.inputs.find((V=>V.name===C.name));if(!V)return;if(C.displayName&&(V.displayName=C.displayName),C.isExposedOnFrame&&(V.isExposedOnFrame=C.isExposedOnFrame,V.exposedPortPosition=C.exposedPortPosition),void 0!==C.value&&null!==C.value)if("number"===C.valueType)V.value=C.value;else{const I=(0,k.d)(C.valueType);I&&(V.value=I.Ik(C.value))}}if(m)for(let C=0;C<m.length;C++){const V=m[C];V.displayName&&(this.outputs[C].displayName=V.displayName),V.isExposedOnFrame&&(this.outputs[C].isExposedOnFrame=V.isExposedOnFrame,this.outputs[C].exposedPortPosition=V.exposedPortPosition)}}clone(){const V=this.serialize(),I=(0,k.d)(V.customType);if(I){const m=new I;return m._deserialize(V),m}return null}dispose(){this.Ck.notifyObservers(this),this.Ck.clear();for(const V of this.inputs)V.dispose();for(const V of this.outputs)V.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function AI(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",C=arguments.length>3?arguments[3]:void 0;return(l,s)=>{let F=l._propStore;F||(F=[],l._propStore=F),F.push({propertyName:s,displayName:V,type:I,groupName:m,options:C??{},className:l.getClassName()})}}(0,Q.d)([(0,G.B)("comment")],wI.prototype,"comments",void 0),function(V){V[V.Boolean=0]="Boolean",V[V.Float=1]="Float",V[V.Int=2]="Int",V[V.Vector2=3]="Vector2",V[V.List=4]="List",V[V.dX=5]="dX",V[V.SamplingMode=6]="SamplingMode",V[V.TextureFormat=7]="TextureFormat",V[V.TextureType=8]="TextureType"}(qI||(qI={})),function(V){V[V.None=0]="None",V[V.Position=1]="Position",V[V.Direction=2]="Direction",V[V.Age=3]="Age",V[V.Lifetime=4]="Lifetime",V[V.Color=5]="Color",V[V.ScaledDirection=6]="ScaledDirection",V[V.Scale=7]="Scale",V[V.AgeGradient=8]="AgeGradient",V[V.Angle=9]="Angle",V[V.SpriteCellIndex=16]="SpriteCellIndex",V[V.SpriteCellStart=17]="SpriteCellStart",V[V.SpriteCellEnd=18]="SpriteCellEnd"}(PI||(PI={})),function(V){V[V.None=0]="None",V[V.Time=1]="Time",V[V.Delta=2]="Delta",V[V.Emitter=3]="Emitter"}(uI||(uI={}));class JI{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let V="";for(const I of this.notConnectedNonOptionalInputs)V+=`input ${I.name} from block ${I.ownerBlock.name}[${I.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(V)throw"Build of Node Particle System Set failed:\n"+V}adapt(V,I){const m=V.getConnectedValue(this)||0;if(V.type===I)return m;switch(I){case dI.Vector2:return new C.k(m,m);case dI.LF:return new C.m(m,m,m);case dI.dX:return new F.d(m,m,m,m)}return null}getContextualValue(V){if(!this.particleContext||!this.systemContext)return null;switch(V){case PI.Position:return this.particleContext.position;case PI.Direction:return this.particleContext.direction;case PI.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case PI.Color:return this.particleContext.color;case PI.Age:return this.particleContext.age;case PI.Lifetime:return this.particleContext.lifeTime;case PI.Angle:return this.particleContext.angle;case PI.Scale:return this.particleContext.scale;case PI.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case PI.SpriteCellEnd:return this.systemContext.endSpriteCellID;case PI.SpriteCellIndex:return this.particleContext.cellIndex;case PI.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.i.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.i.absolutePosition:this.systemContext.i:null}getSystemValue(V){if(!this.particleContext||!this.systemContext)return null;switch(V){case uI.Time:return this.systemContext._actualFrame;case uI.Delta:return this.systemContext._scaledUpdateSpeed;case uI.Emitter:if(this.isEmitterTransformNode){return this.systemContext.i.absolutePosition}return this.systemContext.i}return null}}function UI(V,I,m){const C=new JI;C.OI=I;const l=V.createSystem(C);return l.canStart=()=>!0,l.i=m.clone(),l.disposeOnStop=!0,l.start(),l}class eI extends wI{constructor(V){super(V),this.blendMode=j.BLENDMODE_ONEONE,this.xF=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",dI.Particle),this.registerInput("texture",dI.Texture),this.registerInput("onStart",dI.System,!0),this.registerInput("onEnd",dI.System,!0),this.registerOutput("system",dI.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(V){V.xF=this.xF,V.buildId=this._buildId++,this.build(V);const I=this.particle.getConnectedValue(V);return I.particleTexture=this.texture.getConnectedValue(V),I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.name=this.name,I._nodeGenerated=!0,I._targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,this.system._storedValue=this,I.canStart=()=>!this.doNoStart,I.onStartedObservable.add((m=>{const C=this.onStart.getConnectedValue(V);C&&m.onStartedObservable.addOnce((()=>{V.systemContext=I;const m=UI(C,V.OI,V.emitterPosition);this.Ck.addOnce((()=>{m.dispose()}))}));const l=this.onEnd.getConnectedValue(V);l&&m.onStoppedObservable.addOnce((()=>{V.systemContext=I;const m=UI(l,V.OI,V.emitterPosition);this.Ck.addOnce((()=>{m.dispose()}))}))})),this.Ck.addOnce((()=>{I.dispose()})),I}serialize(){const V=super.serialize();return V.xF=this.xF,V.emitRate=this.emitRate,V.blendMode=this.blendMode,V.doNoStart=this.doNoStart,V.targetStopDuration=this.targetStopDuration,V.startDelay=this.startDelay,V}_deserialize(V){super._deserialize(V),this.xF=V.xF,this.emitRate=V.emitRate,this.doNoStart=!!V.doNoStart,void 0!==V.blendMode&&(this.blendMode=V.blendMode),void 0!==V.targetStopDuration&&(this.targetStopDuration=V.targetStopDuration),void 0!==V.startDelay&&(this.startDelay=V.startDelay)}}(0,Q.d)([AI("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:j.BLENDMODE_ONEONE},{label:"Standard",value:j.BLENDMODE_STANDARD},{label:"Add",value:j.BLENDMODE_ADD},{label:"Multiply",value:j.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:j.BLENDMODE_MULTIPLYADD}]})],eI.prototype,"blendMode",void 0),(0,Q.d)([AI("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],eI.prototype,"xF",void 0),(0,Q.d)([AI("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eI.prototype,"emitRate",void 0),(0,Q.d)([AI("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eI.prototype,"targetStopDuration",void 0),(0,Q.d)([AI("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eI.prototype,"startDelay",void 0),(0,Q.d)([AI("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eI.prototype,"doNoStart",void 0),(0,k.h)("BABYLON.SystemBlock",eI);class aI extends wI{get type(){if(this._type===dI.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=dI.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=dI.Vector2,this._type;case"LF":return this._type=dI.LF,this._type;case"dX":return this._type=dI.dX,this._type;case"Matrix":return this._type=dI.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===PI.None&&this._systemSource!==uI.None}get systemSource(){return this._systemSource}set systemSource(V){if(this._systemSource=V,V!==uI.None){switch(this._contextualSource=PI.None,this._type=dI.Float,V){case uI.Time:case uI.Delta:this._type=dI.Float;break;case uI.Emitter:this._type=dI.LF}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==PI.None}get contextualValue(){return this._contextualSource}set contextualValue(V){if(this._contextualSource=V,V!==PI.None){switch(this._systemSource=uI.None,V){case PI.Scale:this._type=dI.Vector2;break;case PI.Position:case PI.Direction:case PI.ScaledDirection:this._type=dI.LF;break;case PI.Color:this._type=dI.dX;break;case PI.Age:case PI.Lifetime:case PI.Angle:case PI.AgeGradient:this._type=dI.Float;break;case PI.SpriteCellEnd:case PI.SpriteCellStart:case PI.SpriteCellIndex:this._type=dI.Int}this.output&&(this.output.type=this._type)}}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dI.AutoDetect;super(V),this._type=dI.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new U.e,this._systemSource=uI.None,this._contextualSource=PI.None,this._type=I,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",I)}get value(){return this._storedValue}set value(V){this.type===dI.Float&&this.min!==this.max&&(V=Math.max(this.min,V),V=Math.min(this.max,V)),this._storedValue=V,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(V){this._valueCallback=V}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case dI.Int:case dI.Float:this.value=0;break;case dI.Vector2:this.value=C.k.Zero();break;case dI.LF:this.value=C.m.Zero();break;case dI.dX:this.value=new F.d(1,1,1,1);break;case dI.Matrix:this.value=C.b.Identity()}}_build(V){super._build(V),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=V=>V.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=V=>V.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const V=super.serialize();return V.type=this.type,V.contextualValue=this.contextualValue,V.systemSource=this.systemSource,V.min=this.min,V.max=this.max,V.groupInInspector=this.groupInInspector,V.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.UF?(V.valueType="BABYLON."+this._storedValue.getClassName(),V.value=this._storedValue.UF()):(V.valueType="number",V.value=this._storedValue)),V}_deserialize(V){if(super._deserialize(V),this._type=V.type,this.contextualValue=V.contextualValue,this.systemSource=V.systemSource||uI.None,this.min=V.min||0,this.max=V.max||0,this.groupInInspector=V.groupInInspector||"",void 0!==V.displayInInspector&&(this.displayInInspector=V.displayInInspector),V.valueType)if("number"===V.valueType)this._storedValue=V.value;else{const I=(0,k.d)(V.valueType);I&&(this._storedValue=I.Ik(V.value))}}}(0,k.h)("BABYLON.ParticleInputBlock",aI);class LI extends wI{get url(){return this._url}set url(V){this._url!==V&&(this._cachedData=null,this._url=V,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(V){this._textureDataUrl!==V&&(this._cachedData=null,this._textureDataUrl=V,this._url="",this._sourceTexture=null)}set sourceTexture(V){this._sourceTexture!==V&&(this._cachedData=null,this._sourceTexture=V,this._url="",this._textureDataUrl="")}constructor(V){super(V),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",dI.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const V=this.texture._storedValue;return await new Promise(((I,m)=>{if(!V.isReady())return void V.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),I(this._cachedData)}catch(V){m(V)}}));const C=V.getSize();QI.j.GetTextureDataAsync(V,C.width,C.height).then((m=>{this._cachedData={width:C.width,height:C.height,data:new Uint8ClampedArray(m)},V.dispose(),I(this._cachedData)})).catch(m)}))}_build(V){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new g.e(this._textureDataUrl,V.OI):this.texture._storedValue=new g.e(this._url,V.OI):this.texture._storedValue=null}serialize(){const V=super.serialize();return V.url=this.url,V.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(V.textureDataUrl=this.textureDataUrl),V}_deserialize(V){super._deserialize(V),this.url=V.url,this.serializedCachedData=!!V.serializedCachedData,V.textureDataUrl&&(this.textureDataUrl=V.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,k.h)("BABYLON.ParticleTextureSourceBlock",LI);class Vm extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("position",dI.LF),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.position.isConnected)return;const m={process:m=>{V.particleContext=m,V.systemContext=I,m.position.C(this.position.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m}}(0,k.h)("BABYLON.UpdatePositionBlock",Vm),function(V){V[V.Add=0]="Add",V[V.Subtract=1]="Subtract",V[V.Multiply=2]="Multiply",V[V.Divide=3]="Divide",V[V.Max=4]="Max",V[V.Min=5]="Min"}(oI||(oI={}));class Im extends wI{constructor(V){super(V),this.operation=oI.Add,this.registerInput("left",dI.AutoDetect),this.registerInput("right",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this.output._typeConnectionSource=this.left;const I=[dI.Matrix,dI.Particle,dI.Texture,dI.System,dI.FloatGradient,dI.Color4Gradient,dI.Vector2Gradient,dI.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...I),this.right.excludedConnectionPointTypes.push(...I),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(V){let I;const m=this.left,l=this.right;if(!m.isConnected||!l.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const s=m.type===dI.Float||m.type===dI.Int,k=l.type===dI.Float||l.type===dI.Int,j=s&&k;switch(this.operation){case oI.Add:I=j?V=>m.getConnectedValue(V)+l.getConnectedValue(V):s?V=>V.adapt(m,l.type).add(l.getConnectedValue(V)):V=>m.getConnectedValue(V).add(V.adapt(l,m.type));break;case oI.Subtract:I=j?V=>m.getConnectedValue(V)-l.getConnectedValue(V):s?V=>V.adapt(m,l.type).Fm(l.getConnectedValue(V)):V=>m.getConnectedValue(V).Fm(V.adapt(l,m.type));break;case oI.Multiply:I=j?V=>m.getConnectedValue(V)*l.getConnectedValue(V):s?V=>V.adapt(m,l.type).multiply(l.getConnectedValue(V)):V=>m.getConnectedValue(V).multiply(V.adapt(l,m.type));break;case oI.Divide:I=j?V=>m.getConnectedValue(V)/l.getConnectedValue(V):s?V=>V.adapt(m,l.type).divide(l.getConnectedValue(V)):V=>m.getConnectedValue(V).divide(V.adapt(l,m.type));break;case oI.Min:if(j)I=V=>Math.min(m.getConnectedValue(V),l.getConnectedValue(V));else{const[V,k]=s?[l,m]:[m,l];switch(V.type){case dI.Vector2:I=I=>C.k.Minimize(V.getConnectedValue(I),I.adapt(k,V.type));break;case dI.LF:I=I=>C.m.Minimize(V.getConnectedValue(I),I.adapt(k,V.type));break;case dI.dX:I=I=>{const m=V.getConnectedValue(I),{r:C,g:l,b:s,a:j}=I.adapt(k,V.type);return new F.d(Math.min(m.r,C),Math.min(m.g,l),Math.min(m.b,s),Math.min(m.a,j))}}}break;case oI.Max:if(!j){const[V,k]=s?[l,m]:[m,l];switch(V.type){case dI.Vector2:I=I=>C.k.Maximize(V.getConnectedValue(I),I.adapt(k,V.type));break;case dI.LF:I=I=>C.m.Maximize(V.getConnectedValue(I),I.adapt(k,V.type));break;case dI.dX:I=I=>{const m=V.getConnectedValue(I),{r:C,g:l,b:s,a:j}=I.adapt(k,V.type);return new F.d(Math.max(m.r,C),Math.min(m.g,l),Math.min(m.b,s),Math.min(m.a,j))}}break}I=V=>Math.max(m.getConnectedValue(V),l.getConnectedValue(V))}this.output._storedFunction=V=>m.type===dI.Int?0|I(V):I(V)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===dI.Int||this.left.type===dI.Float&&this.right.type!==dI.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[V,I]of[[this.left,this.right],[this.right,this.left]])V.acceptedConnectionPointTypes=[dI.Int,dI.Float],I.isConnected&&(V.acceptedConnectionPointTypes.push(I.type),I.type!==dI.Int&&I.type!==dI.Float||V.acceptedConnectionPointTypes.push(dI.Vector2,dI.LF,dI.dX))}dispose(){super.dispose();for(const V of this._connectionObservers)V.remove();this._connectionObservers.length=0}serialize(){const V=super.serialize();return V.operation=this.operation,V}_deserialize(V){super._deserialize(V),this.operation=V.operation}}(0,Q.d)([AI("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:oI.Add},{label:"Subtract",value:oI.Subtract},{label:"Multiply",value:oI.Multiply},{label:"Divide",value:oI.Divide},{label:"Max",value:oI.Max},{label:"Min",value:oI.Min}]})],Im.prototype,"operation",void 0),(0,k.h)("BABYLON.ParticleMathBlock",Im);class mm extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("direction1",dI.LF,!0,new C.m(0,1,0)),this.registerInput("direction2",dI.LF,!0,new C.m(0,1,0)),this.registerInput("minEmitBox",dI.LF,!0,new C.m(-.5,-.5,-.5)),this.registerInput("maxEmitBox",dI.LF,!0,new C.m(.5,.5,.5)),this.registerOutput("output",dI.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.direction1.getConnectedValue(V),s=this.direction2.getConnectedValue(V),F=(0,E.RandomRange)(l.x,s.x),k=(0,E.RandomRange)(l.y,s.y),j=(0,E.RandomRange)(l.z,s.z);V.isEmitterTransformNode?C.m.TransformNormalFromFloatsToRef(F,k,j,V.emitterWorldMatrix,m.direction):m.direction.aF(F,k,j)},I._positionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.minEmitBox.getConnectedValue(V),s=this.maxEmitBox.getConnectedValue(V),F=(0,E.RandomRange)(l.x,s.x),k=(0,E.RandomRange)(l.y,s.y),j=(0,E.RandomRange)(l.z,s.z);V.isEmitterTransformNode?C.m.TransformCoordinatesFromFloatsToRef(F,k,j,V.emitterWorldMatrix,m.position):(m.position.aF(F,k,j),m.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}}(0,k.h)("BABYLON.BoxShapeBlock",mm);class Cm extends wI{constructor(V){super(V),this.registerInput("emitPower",dI.Float,!0,1),this.registerInput("lifeTime",dI.Float,!0,1),this.registerInput("color",dI.dX,!0,new F.d(1,1,1,1)),this.registerInput("scale",dI.Vector2,!0,new C.k(1,1)),this.registerInput("angle",dI.Float,!0,0),this.registerOutput("particle",dI.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(V){const I=new kI(this.name,V.xF,V.OI,null,!1,void 0,!0);I.particleEmitterType=new D,I._lifeTimeCreation.process=(I,m)=>{V.particleContext=I,I.lifeTime=this.lifeTime.getConnectedValue(V),m._emitPower=this.emitPower.getConnectedValue(V)},I._colorCreation.process=I=>{V.particleContext=I,I.color.C(this.color.getConnectedValue(V))},I._sizeCreation.process=I=>{V.particleContext=I,I.size=1,I.scale.C(this.scale.getConnectedValue(V))},I._angleCreation.process=I=>{V.particleContext=I,I.angle=this.angle.getConnectedValue(V)},this.particle._storedValue=I}}(0,k.h)("BABYLON.CreateParticleBlock",Cm);class lm{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const V=[];for(const I of this.attachedBlocks)I.isInput&&V.push(I);return V}constructor(V){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new U.e,this.name=V}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(V)&&this.attachedBlocks.push(V);for(const m of V.inputs){const C=m.connectedPoint;if(C){const m=C.ownerBlock;m!==V&&this._initializeBlock(m,I)}}}async buildAsync(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((m=>{const C=new cI;for(const V of this._systemBlocks)this._initializeBlock(V);for(const l of this.systemBlocks){const m=new JI;m.buildId=this._buildId++,m.OI=V,m.verbose=I;const s=l.createSystem(m);m.emitErrors(),C.systems.push(s)}this.onBuildObservable.notifyObservers(this),m(C)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const V=new eI("Particle system"),I=new Vm("Update position");I.output.connectTo(V.particle);const m=new aI("Position");m.contextualValue=PI.Position;const C=new aI("Scaled direction");C.contextualValue=PI.ScaledDirection;const l=new Im("Add");l.operation=oI.Add,m.output.connectTo(l.left),C.output.connectTo(l.right),l.output.connectTo(I.position);const s=new Cm("Create particle"),F=new mm("Box shape");s.particle.connectTo(F.particle),F.output.connectTo(I.particle);const k=new LI("Texture");k.texture.connectTo(V.texture),k.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(V)}removeBlock(V){const I=this.attachedBlocks.indexOf(V);if(I>-1&&this.attachedBlocks.splice(I,1),V.isSystem){const I=this._systemBlocks.indexOf(V);I>-1&&this._systemBlocks.splice(I,1)}}parseSerializedObject(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I||this.clear();const m={};for(const C of V.fE){const V=(0,k.d)(C.customType);if(V){const I=new V;I._deserialize(C),m[C.id]=I,this.attachedBlocks.push(I),I.isSystem&&this._systemBlocks.push(I)}}for(const C of this.attachedBlocks)if(C.isTeleportOut){const V=C,I=V._tempEntryPointUniqueId;if(I){const C=m[I];C&&C.attachToEndpoint(V)}}for(let C=0;C<V.fE.length;C++){const l=V.fE[C],s=m[l.id];s&&(s.inputs.length&&l.inputs.some((V=>V.targetConnectionName))&&!I||this._restoreConnections(s,V,m))}if(V.locations||V.editorData&&V.editorData.locations){const C=V.locations||V.editorData.locations;for(const V of C)m[V.kl]&&(V.kl=m[V.kl].uniqueId);I&&this.editorData&&this.editorData.locations&&C.concat(this.editorData.locations),V.locations?this.editorData={locations:C}:(this.editorData=V.editorData,this.editorData.locations=C);const l=[];for(const V in m)l[V]=m[V].uniqueId;this.editorData.map=l}this.comment=V.comment}_restoreConnections(V,I,m){for(const C of V.outputs)for(const l of I.fE){const s=m[l.id];if(s)for(const F of l.inputs)if(m[F.targetBlockId]!==V||F.targetConnectionName!==C.name);else{const V=s.getInputByName(F.inputName);if(!V||V.isConnected)continue;C.connectTo(V,!0),this._restoreConnections(s,I,m)}}}serialize(V){const I=V?{}:r.d.Serialize(this);I.editorData=JSON.parse(JSON.stringify(this.editorData));let m=[];V?m=V:I.customType="BABYLON.NodeParticleSystemSet",I.fE=[];for(const C of m)I.fE.push(C.serialize());if(!V)for(const C of this.attachedBlocks)-1===m.indexOf(C)&&I.fE.push(C.serialize());return I}dispose(){for(const V of this.attachedBlocks)V.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(V){const I=new lm(V);return I.setToDefault(),I}static Parse(V){const I=r.d.Parse((()=>new lm(V.name)),V,null);return I.parseSerializedObject(V),I}static ParseFromSnippetAsync(V,I){return"_BLANK"===V?Promise.resolve(lm.CreateDefault("blank")):new Promise(((m,C)=>{const l=new HI.c;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const F=JSON.parse(JSON.parse(l.responseText).jsonPayload),k=JSON.parse(F.nodeParticle);I||(I=r.d.Parse((()=>new lm(V)),k,null)),I.parseSerializedObject(k),I.snippetId=V;try{m(I)}catch(s){C(s)}}else C("Unable to load the snippet "+V)})),l.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),l.send()}))}}lm.EditorURL=`${nI.d._DefaultCdnUrl}/v${AV.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,lm.SnippetUrl="https://snippet.babylonjs.com",(0,Q.d)([(0,G.B)()],lm.prototype,"name",void 0),(0,Q.d)([(0,G.B)("comment")],lm.prototype,"comment",void 0),function(V){V[V.None=0]="None",V[V.PerParticle=1]="PerParticle",V[V.PerSystem=2]="PerSystem"}(pI||(pI={}));class sm extends wI{constructor(V){super(V),this._currentLockId=-2,this.lockMode=pI.PerParticle,this.registerInput("min",dI.AutoDetect,!0,0),this.registerInput("max",dI.AutoDetect,!0,1),this.registerOutput("output",dI.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dI.Float|dI.Int|dI.Vector2|dI.LF|dI.dX),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(dI.Float|dI.Int|dI.Vector2|dI.LF|dI.dX),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=dI.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let V=null;switch(this._currentLockId=-2,this.min.type){case dI.AutoDetect:case dI.Int:case dI.Float:V=V=>{const I=this.min.getConnectedValue(V)||0,m=this.max.getConnectedValue(V)||1;return I+Math.random()*(m-I)};break;case dI.Vector2:V=V=>{const I=this.min.getConnectedValue(V)||C.k.Zero(),m=this.max.getConnectedValue(V)||C.k.One();return new C.k(I.x+Math.random()*(m.x-I.x),I.y+Math.random()*(m.y-I.y))};break;case dI.LF:V=V=>{const I=this.min.getConnectedValue(V)||C.m.Zero(),m=this.max.getConnectedValue(V)||C.m.One();return new C.m(I.x+Math.random()*(m.x-I.x),I.y+Math.random()*(m.y-I.y),I.z+Math.random()*(m.z-I.z))};break;case dI.dX:V=V=>{const I=this.min.getConnectedValue(V)||new F.d(0,0,0,0),m=this.max.getConnectedValue(V)||new F.d(1,1,1,1);return new F.d(I.x+Math.random()*(m.x-I.x),I.y+Math.random()*(m.y-I.y),I.z+Math.random()*(m.z-I.z),I.w+Math.random()*(m.w-I.w))}}this.output._storedFunction=I=>{var m;let C=0;switch(this.lockMode){case pI.PerParticle:C=(null===(m=I.particleContext)||void 0===m?void 0:m.id)||-1;break;case pI.PerSystem:C=I.buildId||0}return this._currentLockId!==C&&(this.lockMode!==pI.None&&(this._currentLockId=C),this.output._storedValue=V(I)),this.output._storedValue}}serialize(){const V=super.serialize();return V.lockMode=this.lockMode,V}_deserialize(V){super._deserialize(V),this.lockMode=V.lockMode}}(0,Q.d)([AI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:pI.None},{label:"Per particle",value:pI.PerParticle},{label:"Per system",value:pI.PerSystem}]})],sm.prototype,"lockMode",void 0),(0,k.h)("BABYLON.ParticleRandomBlock",sm);class Fm extends wI{constructor(V){super(V),this._currentLockId=-2,this.lockMode=pI.PerParticle,this.registerInput("min",dI.AutoDetect),this.registerInput("max",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const I=[dI.Matrix,dI.Particle,dI.Texture,dI.System,dI.FloatGradient,dI.Color4Gradient,dI.Vector2Gradient,dI.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...I),this.max.excludedConnectionPointTypes.push(...I)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let V=null;switch(this._currentLockId=-2,this.min.type){case dI.Float:case dI.Int:V=V=>{const I=this.min.getConnectedValue(V),m=this.max.getConnectedValue(V);return Math.random()*(m-I)+I};break;case dI.Vector2:V=V=>{const I=this.min.getConnectedValue(V),m=this.max.getConnectedValue(V);return new C.k(Math.random()*(m.x-I.x)+I.x,Math.random()*(m.y-I.y)+I.y)};break;case dI.LF:V=V=>{const I=this.min.getConnectedValue(V),m=this.max.getConnectedValue(V);return new C.m(Math.random()*(m.x-I.x)+I.x,Math.random()*(m.y-I.y)+I.y,Math.random()*(m.z-I.z)+I.z)};break;case dI.dX:V=V=>{const I=this.min.getConnectedValue(V),m=this.max.getConnectedValue(V);return new F.d(Math.random()*(m.r-I.r)+I.r,Math.random()*(m.g-I.g)+I.g,Math.random()*(m.b-I.b)+I.b,Math.random()*(m.a-I.a)+I.a)}}this.output._storedFunction=I=>{var m;let C=0;switch(this.lockMode){case pI.PerParticle:C=(null===(m=I.particleContext)||void 0===m?void 0:m.id)||-1;break;case pI.PerSystem:C=I.buildId||0}return this._currentLockId!==C&&(this.lockMode!==pI.None&&(this._currentLockId=C),this.output._storedValue=V(I)),this.output._storedValue}}serialize(){const V=super.serialize();return V.lockMode=this.lockMode,V}_deserialize(V){super._deserialize(V),void 0!==V.lockMode&&(this.lockMode=V.lockMode)}}(0,Q.d)([AI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:pI.None},{label:"Per particle",value:pI.PerParticle},{label:"Per system",value:pI.PerSystem}]})],Fm.prototype,"lockMode",void 0),(0,k.h)("BABYLON.RandomRangeBlock",Fm);(0,k.h)("BABYLON.ParticleLerpBlock",class extends wI{constructor(V){super(V),this.registerInput("left",dI.AutoDetect),this.registerInput("right",dI.AutoDetect),this.registerInput("gradient",dI.Float,!0,0,0,1),this.registerOutput("output",dI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dI.Float|dI.Int|dI.Vector2|dI.LF|dI.dX)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const V=(V,I,m)=>(1-V)*I+V*m;this.output._storedFunction=I=>{const m=this.left.getConnectedValue(I),l=this.right.getConnectedValue(I),s=this.gradient.getConnectedValue(I);switch(this.left.type){case dI.Int:case dI.Float:return V(s,m,l);case dI.Vector2:return new C.k(V(s,m.x,l.x),V(s,m.y,l.y));case dI.LF:return new C.m(V(s,m.x,l.x),V(s,m.y,l.y),V(s,m.z,l.z));case dI.dX:return new F.d(V(s,m.r,l.r),V(s,m.g,l.g),V(s,m.b,l.b),V(s,m.a,l.a))}return 0}}});(0,k.h)("BABYLON.UpdateDirectionBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("direction",dI.LF),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.direction.isConnected)return;const m={process:m=>{V.particleContext=m,V.systemContext=I,m.direction.C(this.direction.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m}});(0,k.h)("BABYLON.UpdateColorBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("color",dI.dX),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.color.isConnected)return;const m={process:m=>{V.particleContext=m,V.systemContext=I,m.color.C(this.color.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m}});(0,k.h)("BABYLON.UpdateScaleBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("scale",dI.Vector2),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.scale.isConnected)return;const m={process:m=>{V.particleContext=m,V.systemContext=I,m.scale.C(this.scale.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m}});(0,k.h)("BABYLON.UpdateAngleBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("angle",dI.Float),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.angle.isConnected)return;const m={process:m=>{V.particleContext=m,V.systemContext=I,m.angle=this.angle.getConnectedValue(V)},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m}});(0,k.h)("BABYLON.BasicPositionUpdateBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(V){const I=this.particle.getConnectedValue(V),m={process:m=>{V.particleContext=m,V.systemContext=I,m.direction.scaleToRef(I._directionScale,I._scaledDirection),m.position.addInPlace(I._scaledDirection)},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m,this.output._storedValue=I}});(0,k.h)("BABYLON.BasicSpriteUpdateBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(V){const I=this.particle.getConnectedValue(V),m={process:m=>{V.particleContext=m,V.systemContext=I,m.updateCellIndex()},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m,this.output._storedValue=I}});(0,k.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("cellIndex",dI.Int),this.registerOutput("output",dI.Particle),this.cellIndex.acceptedConnectionPointTypes=[dI.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.cellIndex.isConnected)return;const m={process:m=>{V.particleContext=m,V.systemContext=I,m.cellIndex=Math.floor(this.cellIndex.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m}});class km extends wI{constructor(V){super(V),this.strength=1,this.registerInput("particle",dI.Particle),this.registerInput("flowMap",dI.Texture),this.registerOutput("output",dI.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(V){var I;const m=this.particle.getConnectedValue(V),C=V.OI;let l;(null===(I=this.flowMap.connectedPoint)||void 0===I?void 0:I.ownerBlock).extractTextureContentAsync().then((V=>{V&&(l=new hI(V.width,V.height,V.data))}));const s={process:V=>{const I=C.getTransformMatrix();l&&l._processParticle(V,this.strength*m._tempScaledUpdateSpeed,I)},previousItem:null,nextItem:null};m._updateQueueStart?uV(s,m._updateQueueStart):m._updateQueueStart=s,this.output._storedValue=m}serialize(){const V=super.serialize();return V.strength=this.strength,V}_deserialize(V){super._deserialize(V),this.strength=V.strength}}(0,Q.d)([AI("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],km.prototype,"strength",void 0),(0,k.h)("BABYLON.UpdateFlowMapBlock",km);(0,k.h)("BABYLON.SphereShapeBlock",class extends wI{constructor(V){super(V),this.registerInput("input",dI.Particle),this.registerInput("radius",dI.Float,!0,1),this.registerInput("radiusRange",dI.Float,!0,1,0,1),this.registerInput("directionRandomizer",dI.Float,!0,0,0,1),this.registerOutput("output",dI.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(V){const I=this.input.getConnectedValue(V);I._directionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.directionRandomizer.getConnectedValue(V),s=m.position.Fm(V.emitterPosition).normalize(),F=(0,E.RandomRange)(0,l),k=(0,E.RandomRange)(0,l),j=(0,E.RandomRange)(0,l);s.x+=F,s.y+=k,s.z+=j,s.normalize(),V.isEmitterTransformNode?C.m.TransformNormalFromFloatsToRef(F,k,j,V.emitterWorldMatrix,m.direction):m.direction.aF(F,k,j)},I._positionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.radius.getConnectedValue(V),s=this.radiusRange.getConnectedValue(V),F=l-(0,E.RandomRange)(0,l*s),k=(0,E.RandomRange)(0,1),j=(0,E.RandomRange)(0,2*Math.PI),K=Math.acos(2*k-1),Y=F*Math.cos(j)*Math.sin(K),X=F*Math.cos(K),O=F*Math.sin(j)*Math.sin(K);V.isEmitterTransformNode?C.m.TransformCoordinatesFromFloatsToRef(Y,X,O,V.emitterWorldMatrix,m.position):(m.position.aF(Y,X,O),m.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}});(0,k.h)("BABYLON.PointShapeBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("direction1",dI.LF,!0,new C.m(0,1,0)),this.registerInput("direction2",dI.LF,!0,new C.m(0,1,0)),this.registerOutput("output",dI.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.direction1.getConnectedValue(V),s=this.direction2.getConnectedValue(V),F=(0,E.RandomRange)(l.x,s.x),k=(0,E.RandomRange)(l.y,s.y),j=(0,E.RandomRange)(l.z,s.z);V.isEmitterTransformNode?C.m.TransformNormalFromFloatsToRef(F,k,j,V.emitterWorldMatrix,m.direction):m.direction.aF(F,k,j)},I._positionCreation.process=m=>{V.systemContext=I,V.isEmitterTransformNode?C.m.TransformCoordinatesFromFloatsToRef(0,0,0,V.emitterWorldMatrix,m.position):m.position.C(V.emitterPosition)},this.output._storedValue=I}});(0,k.h)("BABYLON.CustomShapeBlock",class extends wI{constructor(V){super(V),this.registerInput("particle",dI.Particle),this.registerInput("position",dI.LF,!0,new C.m(0,0,0)),this.registerInput("direction",dI.LF,!0,new C.m(0,1,0)),this.registerOutput("output",dI.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.direction.getConnectedValue(V);V.isEmitterTransformNode?C.m.TransformNormalToRef(l,V.emitterWorldMatrix,m.direction):m.direction.C(l)},I._positionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.position.getConnectedValue(V);V.isEmitterTransformNode?C.m.TransformCoordinatesToRef(l,V.emitterWorldMatrix,m.position):(m.position.C(l),m.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}});(0,k.h)("BABYLON.CylinderShapeBlock",class extends wI{constructor(V){super(V),this._tempVector=C.m.Zero(),this.registerInput("particle",dI.Particle),this.registerInput("radius",dI.Float,!0,1),this.registerInput("height",dI.Float,!0,1,0),this.registerInput("radiusRange",dI.Float,!0,1,0,1),this.registerInput("directionRandomizer",dI.Float,!0,0,0,1),this.registerOutput("output",dI.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.directionRandomizer.getConnectedValue(V);m.position.subtractToRef(V.emitterPosition,this._tempVector),this._tempVector.normalize(),V.isEmitterTransformNode&&C.m.TransformNormalToRef(this._tempVector,V.emitterInverseWorldMatrix,this._tempVector);const s=(0,E.RandomRange)(-l/2,l/2);let F=Math.atan2(this._tempVector.x,this._tempVector.z);F+=(0,E.RandomRange)(-Math.PI/2,Math.PI/2)*l,this._tempVector.y=s,this._tempVector.x=Math.sin(F),this._tempVector.z=Math.cos(F),this._tempVector.normalize(),V.isEmitterTransformNode?C.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V.emitterWorldMatrix,m.direction):m.direction.C(this._tempVector)},I._positionCreation.process=m=>{V.particleContext=m,V.systemContext=I;const l=this.height.getConnectedValue(V),s=this.radiusRange.getConnectedValue(V),F=this.radius.getConnectedValue(V),k=(0,E.RandomRange)(-l/2,l/2),j=(0,E.RandomRange)(0,2*Math.PI),K=(0,E.RandomRange)((1-s)*(1-s),1),Y=Math.sqrt(K)*F,X=Y*Math.cos(j),O=Y*Math.sin(j);V.isEmitterTransformNode?C.m.TransformCoordinatesFromFloatsToRef(X,k,O,V.emitterWorldMatrix,m.position):(m.position.aF(X,k,O),m.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}});class jm extends wI{constructor(V){super(V),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",dI.Particle),this.registerOutput("output",dI.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);const I=this.particle.getConnectedValue(V);I._isAnimationSheetEnabled=!0,I.spriteCellWidth=this.width,I.spriteCellHeight=this.height,I.startSpriteCellID=this.start,I.endSpriteCellID=this.end,I.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=I}serialize(){const V=super.serialize();return V.width=this.width,V.height=this.height,V.start=this.start,V.end=this.end,V.randomStartCell=this.randomStartCell,V}_deserialize(V){super._deserialize(V),this.width=V.width,this.height=V.height,this.start=V.start,this.end=V.end,this.randomStartCell=V.randomStartCell}}(0,Q.d)([AI("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jm.prototype,"start",void 0),(0,Q.d)([AI("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jm.prototype,"end",void 0),(0,Q.d)([AI("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jm.prototype,"width",void 0),(0,Q.d)([AI("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jm.prototype,"height",void 0),(0,Q.d)([AI("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jm.prototype,"loop",void 0),(0,Q.d)([AI("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jm.prototype,"randomStartCell",void 0),(0,k.h)("BABYLON.SetupSpriteSheetBlock",jm);class Em extends wI{constructor(V){super(V),this.reference=0,this.registerInput("value",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=V=>{switch(V){case dI.Float:return dI.FloatGradient;case dI.Vector2:return dI.Vector2Gradient;case dI.LF:return dI.Vector3Gradient;case dI.dX:return dI.Color4Gradient}return V},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dI.Float|dI.Vector2|dI.LF|dI.dX)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=V=>null}serialize(){const V=super.serialize();return V.reference=this.reference,V}_deserialize(V){super._deserialize(V),this.reference=V.reference}}(0,Q.d)([AI("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Em.prototype,"reference",void 0),(0,k.h)("BABYLON.ParticleGradientValueBlock",Em);(0,k.h)("BABYLON.ParticleGradientBlock",class extends wI{constructor(V){super(V),this._entryCount=1,this.registerInput("gradient",dI.Float,!0,1,0,1),this.registerInput("value0",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=V=>{switch(V){case dI.FloatGradient:return dI.Float;case dI.Vector2Gradient:return dI.Vector2;case dI.Vector3Gradient:return dI.LF;case dI.Color4Gradient:return dI.dX}return V},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(dI.FloatGradient|dI.Vector2Gradient|dI.Vector3Gradient|dI.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(V){this._inputs[V].onConnectionObservable.add((()=>{this._entryCount>V||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),dI.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const V=[];for(let m=1;m<this._inputs.length;m++){var I;if(this._inputs[m].isConnected)V.push(null===(I=this._inputs[m].connectedPoint)||void 0===I?void 0:I.ownerBlock)}V.sort(((V,I)=>V.reference-I.reference)),this.output._storedFunction=I=>{const m=this.gradient.getConnectedValue(I);if(1===V.length)return V[0].value.getConnectedValue(I);let l=null;for(let s=V.length-1;s>=0;s--){const k=V[s];if(k.reference<=m){const V=k.value.getConnectedValue(I);if(l){const s=l.value.getConnectedValue(I),j=l.reference,K=k.reference,Y=Math.max(0,Math.min(1,(m-K)/(j-K)));switch(this.output.type){case dI.Float:return(0,E.Lerp)(V,s,Y);case dI.Vector2:return C.k.Lerp(V,s,Y);case dI.LF:return C.m.Lerp(V,s,Y);case dI.dX:return F.d.Lerp(V,s,Y)}}return V}l=k}return 0}}});(0,k.h)("BABYLON.ParticleConverterBlock",class extends wI{constructor(V){super(V),this.registerInput("color ",dI.dX,!0),this.registerInput("xyz ",dI.LF,!0),this.registerInput("xy ",dI.Vector2,!0),this.registerInput("zw ",dI.Vector2,!0),this.registerInput("x ",dI.Float,!0),this.registerInput("y ",dI.Float,!0),this.registerInput("z ",dI.Float,!0),this.registerInput("w ",dI.Float,!0),this.registerOutput("color",dI.dX),this.registerOutput("xyz",dI.LF),this.registerOutput("xy",dI.Vector2),this.registerOutput("zw",dI.Vector2),this.registerOutput("x",dI.Float),this.registerOutput("y",dI.Float),this.registerOutput("z",dI.Float),this.registerOutput("w",dI.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(V){return"color "===V?"colorIn":"xyz "===V?"xyzIn":"xy "===V?"xyIn":"zw "===V?"zwIn":"x "===V?"xIn":"y "===V?"yIn":"z "===V?"zIn":"w "===V?"wIn":V}_outputRename(V){switch(V){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return V}}_build(V){super._build(V);const I=this.xIn,m=this.yIn,l=this.zIn,s=this.wIn,k=this.xyIn,j=this.zwIn,E=this.xyzIn,K=this.colorIn,Y=this.colorOut,X=this.xyzOut,O=this.xyOut,v=this.zwOut,N=this.xOut,t=this.yOut,D=this.zOut,b=this.wOut,T=V=>{if(K.isConnected)return K.getConnectedValue(V);let C=0,Y=0,X=0,O=0;if(I.isConnected&&(C=I.getConnectedValue(V)),m.isConnected&&(Y=m.getConnectedValue(V)),l.isConnected&&(X=l.getConnectedValue(V)),s.isConnected&&(O=s.getConnectedValue(V)),k.isConnected){const I=k.getConnectedValue(V);I&&(C=I.x,Y=I.y)}if(j.isConnected){const I=j.getConnectedValue(V);I&&(X=I.x,O=I.y)}if(E.isConnected){const I=E.getConnectedValue(V);I&&(C=I.x,Y=I.y,X=I.z)}return new F.d(C,Y,X,O)};Y._storedFunction=V=>T(V),X._storedFunction=V=>{const I=T(V);return new C.m(I.r,I.g,I.b)},O._storedFunction=V=>{const I=T(V);return new C.k(I.r,I.g)},v._storedFunction=V=>{const I=T(V);return new C.k(I.b,I.a)},N._storedFunction=V=>T(V).r,t._storedFunction=V=>T(V).g,D._storedFunction=V=>T(V).b,b._storedFunction=V=>T(V).a}}),function(V){V[V.Cos=0]="Cos",V[V.Sin=1]="Sin",V[V.Abs=2]="Abs",V[V.Exp=3]="Exp",V[V.Exp2=4]="Exp2",V[V.Round=5]="Round",V[V.Floor=6]="Floor",V[V.Ceiling=7]="Ceiling",V[V.Sqrt=8]="Sqrt",V[V.Log=9]="Log",V[V.Tan=10]="Tan",V[V.ArcTan=11]="ArcTan",V[V.ArcCos=12]="ArcCos",V[V.ArcSin=13]="ArcSin",V[V.Sign=14]="Sign",V[V.Negate=15]="Negate",V[V.OneMinus=16]="OneMinus",V[V.Reciprocal=17]="Reciprocal",V[V.ToDegrees=18]="ToDegrees",V[V.ToRadians=19]="ToRadians",V[V.Fract=20]="Fract"}(MI||(MI={}));class Km extends wI{constructor(V){super(V),this.operation=MI.Cos,this.registerInput("input",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dI.Float|dI.Int|dI.Vector2|dI.LF|dI.dX)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);let I=null;switch(this.operation){case MI.Cos:I=V=>Math.cos(V);break;case MI.Sin:I=V=>Math.sin(V);break;case MI.Abs:I=V=>Math.abs(V);break;case MI.Exp:I=V=>Math.exp(V);break;case MI.Exp2:I=V=>Math.pow(2,V);break;case MI.Round:I=V=>Math.round(V);break;case MI.Floor:I=V=>Math.floor(V);break;case MI.Ceiling:I=V=>Math.ceil(V);break;case MI.Sqrt:I=V=>Math.sqrt(V);break;case MI.Log:I=V=>Math.log(V);break;case MI.Tan:I=V=>Math.tan(V);break;case MI.ArcTan:I=V=>Math.atan(V);break;case MI.ArcCos:I=V=>Math.acos(V);break;case MI.ArcSin:I=V=>Math.asin(V);break;case MI.Sign:I=V=>Math.sign(V);break;case MI.Negate:I=V=>-V;break;case MI.OneMinus:I=V=>1-V;break;case MI.Reciprocal:I=V=>1/V;break;case MI.ToRadians:I=V=>V*Math.PI/180;break;case MI.ToDegrees:I=V=>180*V/Math.PI;break;case MI.Fract:I=V=>V>=0?V-Math.floor(V):V-Math.ceil(V)}if(!I)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case dI.Int:case dI.Float:this.output._storedFunction=V=>{const m=this.input.getConnectedValue(V);return I(m)};break;case dI.Vector2:this.output._storedFunction=V=>{const m=this.input.getConnectedValue(V);return new C.k(I(m.x),I(m.y))};break;case dI.LF:this.output._storedFunction=V=>{const m=this.input.getConnectedValue(V);return new C.m(I(m.x),I(m.y),I(m.z))};break;case dI.dX:this.output._storedFunction=V=>{const m=this.input.getConnectedValue(V);return new F.d(I(m.r),I(m.g),I(m.b),I(m.a))}}return this}serialize(){const V=super.serialize();return V.operation=this.operation,V}_deserialize(V){super._deserialize(V),this.operation=V.operation}}(0,Q.d)([AI("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:MI.Cos},{label:"Sin",value:MI.Sin},{label:"Abs",value:MI.Abs},{label:"Exp",value:MI.Exp},{label:"Exp2",value:MI.Exp2},{label:"Round",value:MI.Round},{label:"Floor",value:MI.Floor},{label:"Ceiling",value:MI.Ceiling},{label:"Sqrt",value:MI.Sqrt},{label:"Log",value:MI.Log},{label:"Tan",value:MI.Tan},{label:"ArcTan",value:MI.ArcTan},{label:"ArcCos",value:MI.ArcCos},{label:"ArcSin",value:MI.ArcSin},{label:"Sign",value:MI.Sign},{label:"Negate",value:MI.Negate},{label:"OneMinus",value:MI.OneMinus},{label:"Reciprocal",value:MI.Reciprocal},{label:"ToDegrees",value:MI.ToDegrees},{label:"ToRadians",value:MI.ToRadians},{label:"Fract",value:MI.Fract}]})],Km.prototype,"operation",void 0),(0,k.h)("BABYLON.ParticleTrigonometryBlock",Km);var Ym,Xm=m(12573);class Om extends wI{constructor(V){super(V),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(dI.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(dI.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(dI.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(dI.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(dI.System),this._inputs[0].excludedConnectionPointTypes.push(dI.Particle),this._inputs[0].excludedConnectionPointTypes.push(dI.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const I=V=>{const I=this.input.getConnectedValue(V);if(this.log.length>=this.stackSize)return I;if(null===I||void 0===I)return this.log.push(["null",""]),I;switch(this.input.type){case dI.Vector2:this.log.push([(0,Xm.h)(I,4),I.toString()]);break;case dI.LF:this.log.push([(0,Xm.l)(I,4),I.toString()]);break;case dI.dX:this.log.push([`{R: ${I.r.toFixed(4)} G: ${I.g.toFixed(4)} B: ${I.b.toFixed(4)} A: ${I.a.toFixed(4)}}`,I.toString()]);break;default:this.log.push([I.toString(),I.toString()])}return I};this.output.isConnected?this.output._storedFunction=I:this.output._storedValue=I(V)}serialize(){const V=super.serialize();return V.stackSize=this.stackSize,V}_deserialize(V){super._deserialize(V),this.stackSize=V.stackSize}}(0,Q.d)([AI("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Om.prototype,"stackSize",void 0),(0,k.h)("BABYLON.ParticleDebugBlock",Om);(0,k.h)("BABYLON.ParticleElbowBlock",class extends wI{constructor(V){super(V),this.registerInput("input",dI.AutoDetect),this.registerOutput("output",dI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);const I=this._outputs[0],m=this._inputs[0];I._storedFunction=V=>m.getConnectedValue(V)}});(0,k.h)("BABYLON.ParticleTeleportInBlock",class extends wI{get endpoints(){return this._endpoints}constructor(V){super(V),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",dI.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(V){if(this.getClassName()===V)return!0;for(const I of this.endpoints)if(I.isAnAncestorOfType(V))return!0;return!1}isAnAncestorOf(V){for(const I of this.endpoints){if(I===V)return!0;if(I.isAnAncestorOf(V))return!0}return!1}attachToEndpoint(V){V.detach(),this._endpoints.push(V),V._entryPoint=this,V._outputs[0]._typeConnectionSource=this._inputs[0],V._tempEntryPointUniqueId=null,V.name="> "+this.name}detachFromEndpoint(V){const I=this._endpoints.indexOf(V);-1!==I&&(this._endpoints.splice(I,1),V._outputs[0]._typeConnectionSource=null,V._entryPoint=null)}_build(){for(const V of this._endpoints)V.output._storedFunction=V=>this.input.getConnectedValue(V)}});(0,k.h)("BABYLON.ParticleTeleportOutBlock",class extends wI{constructor(V){super(V),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",dI.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(V){this.entryPoint&&this.entryPoint.build(V)}clone(){const V=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(V),V}serialize(){var V;const I=super.serialize();return I.entryPoint=(null===(V=this.entryPoint)||void 0===V?void 0:V.uniqueId)??"",I}_deserialize(V){super._deserialize(V),this._tempEntryPointUniqueId=V.entryPoint}}),function(V){V[V.Equal=0]="Equal",V[V.NotEqual=1]="NotEqual",V[V.LessThan=2]="LessThan",V[V.GreaterThan=3]="GreaterThan",V[V.LessOrEqual=4]="LessOrEqual",V[V.GreaterOrEqual=5]="GreaterOrEqual",V[V.Xor=6]="Xor",V[V.Or=7]="Or",V[V.And=8]="And"}(Ym||(Ym={}));class vm extends wI{constructor(V){super(V),this.test=Ym.Equal,this.epsilon=0,this.registerInput("left",dI.Float),this.registerInput("right",dI.Float,!0,0),this.registerInput("ifTrue",dI.AutoDetect,!0,1),this.registerInput("ifFalse",dI.AutoDetect,!0,0),this.registerOutput("output",dI.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=dI.Float,this._inputs[0].acceptedConnectionPointTypes.push(dI.Int),this._inputs[1].acceptedConnectionPointTypes.push(dI.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const V=V=>{const I=this.left.getConnectedValue(V),m=this.right.getConnectedValue(V);let C=!1;switch(this.test){case Ym.Equal:C=(0,E.WithinEpsilon)(I,m,this.epsilon);break;case Ym.NotEqual:C=!(0,E.WithinEpsilon)(I,m,this.epsilon);break;case Ym.LessThan:C=I<m+this.epsilon;break;case Ym.GreaterThan:C=I>m-this.epsilon;break;case Ym.LessOrEqual:C=I<=m+this.epsilon;break;case Ym.GreaterOrEqual:C=I>=m-this.epsilon;break;case Ym.Xor:C=!!I&&!m||!I&&!!m;break;case Ym.Or:C=!!I||!!m;break;case Ym.And:C=!!I&&!!m}return C};this.output._storedFunction=I=>V(I)?this.ifTrue.getConnectedValue(I):this.ifFalse.getConnectedValue(I)}serialize(){const V=super.serialize();return V.test=this.test,V.epsilon=this.epsilon,V}_deserialize(V){super._deserialize(V),this.test=V.test,void 0!==V.epsilon&&(this.epsilon=V.epsilon)}}(0,Q.d)([AI("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ym.Equal},{label:"NotEqual",value:Ym.NotEqual},{label:"LessThan",value:Ym.LessThan},{label:"GreaterThan",value:Ym.GreaterThan},{label:"LessOrEqual",value:Ym.LessOrEqual},{label:"GreaterOrEqual",value:Ym.GreaterOrEqual},{label:"Xor",value:Ym.Xor},{label:"Or",value:Ym.Or},{label:"And",value:Ym.And}]})],vm.prototype,"test",void 0),(0,Q.d)([AI("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],vm.prototype,"epsilon",void 0),(0,k.h)("BABYLON.ParticleConditionBlock",vm);class Nm extends wI{constructor(V){super(V),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",dI.Particle),this.registerInput("condition",dI.Float,!0,0),this.registerInput("system",dI.System),this.registerOutput("output",dI.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){this._triggerCount=0;const I=this.input.getConnectedValue(V),m={process:m=>{if(V.particleContext=m,V.systemContext=I,0!==this.condition.getConnectedValue(V)&&(0===this.limit||this._triggerCount<this.limit)){const C=(new Date).getTime();if(this._previousOne&&C-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=C;const l=this.system.getConnectedValue(V);if(l){const C=UI(l,V.OI,m.position);C.Ck.addOnce((()=>{this._triggerCount--})),I.Ck.addOnce((()=>{C.dispose()}))}}},previousItem:null,nextItem:null};I._updateQueueStart?uV(m,I._updateQueueStart):I._updateQueueStart=m,this.output._storedValue=I}serialize(){const V=super.serialize();return V.limit=this.limit,V.delay=this.delay,V}_deserialize(V){super._deserialize(V),void 0!==V.limit&&(this.limit=V.limit),void 0!==V.delay&&(this.delay=V.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,Q.d)([AI("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Nm.prototype,"limit",void 0),(0,Q.d)([AI("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Nm.prototype,"delay",void 0),(0,k.h)("BABYLON.ParticleTriggerBlock",Nm);m(12579),m(12589),m(12601),m(12655)},12632:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneFragment",s="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12604:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneFragmentDeclaration",s="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12674:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneVertex",s="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12658:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneVertexDeclaration",s="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12650:(V,I,m)=>{"use strict";var C=m(11150);const l="fogFragment",s="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12630:(V,I,m)=>{"use strict";var C=m(11150);const l="fogFragmentDeclaration",s="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12683:(V,I,m)=>{"use strict";var C=m(11150);const l="fogVertex",s="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12667:(V,I,m)=>{"use strict";var C=m(11150);const l="fogVertexDeclaration",s="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12620:(V,I,m)=>{"use strict";var C=m(11150);const l="helperFunctions",s="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12609:(V,I,m)=>{"use strict";var C=m(11150);const l="imageProcessingDeclaration",s="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12625:(V,I,m)=>{"use strict";var C=m(11150);const l="imageProcessingFunctions",s="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12614:(V,I,m)=>{"use strict";var C=m(11150);const l="logDepthDeclaration",s="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12641:(V,I,m)=>{"use strict";var C=m(11150);const l="logDepthFragment",s="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12687:(V,I,m)=>{"use strict";var C=m(11150);const l="logDepthVertex",s="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";C.e.IncludesShadersStoreWGSL[l]||(C.e.IncludesShadersStoreWGSL[l]=s)},12601:(V,I,m)=>{"use strict";m.r(I),m.d(I,{particlesPixelShaderWGSL:()=>F});var C=m(11150);m(12604),m(12609),m(12614),m(12620),m(12625),m(12630),m(12632),m(12641),m(12650);const l="particlesPixelShader",s="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.e.ShadersStoreWGSL[l]||(C.e.ShadersStoreWGSL[l]=s);const F={name:l,shader:s}},12655:(V,I,m)=>{"use strict";m.r(I),m.d(I,{particlesVertexShaderWGSL:()=>F});var C=m(11150);m(12658),m(12667),m(12614),m(12674),m(12683),m(12687);const l="particlesVertexShader",s="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStoreWGSL[l]||(C.e.ShadersStoreWGSL[l]=s);const F={name:l,shader:s}},12501:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneFragment",s="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12583:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneFragmentDeclaration",s="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12532:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneVertex",s="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12594:(V,I,m)=>{"use strict";var C=m(11150);const l="clipPlaneVertexDeclaration",s="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12519:(V,I,m)=>{"use strict";var C=m(11150);const l="fogFragment",s="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12499:(V,I,m)=>{"use strict";var C=m(11150);const l="fogFragmentDeclaration",s="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12534:(V,I,m)=>{"use strict";var C=m(11150);const l="fogVertex",s="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12525:(V,I,m)=>{"use strict";var C=m(11150);const l="fogVertexDeclaration",s="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12488:(V,I,m)=>{"use strict";var C=m(11150);const l="helperFunctions",s="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12471:(V,I,m)=>{"use strict";var C=m(11150);const l="imageProcessingDeclaration",s="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12491:(V,I,m)=>{"use strict";var C=m(11150);const l="imageProcessingFunctions",s="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12480:(V,I,m)=>{"use strict";var C=m(11150);const l="logDepthDeclaration",s="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12510:(V,I,m)=>{"use strict";var C=m(11150);const l="logDepthFragment",s="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12541:(V,I,m)=>{"use strict";var C=m(11150);const l="logDepthVertex",s="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";C.e.IncludesShadersStore[l]||(C.e.IncludesShadersStore[l]=s)},12579:(V,I,m)=>{"use strict";m.r(I),m.d(I,{particlesPixelShader:()=>F});var C=m(11150);m(12583),m(12471),m(12480),m(12488),m(12491),m(12499),m(12501),m(12510),m(12519);const l="particlesPixelShader",s="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.e.ShadersStore[l]||(C.e.ShadersStore[l]=s);const F={name:l,shader:s}},12589:(V,I,m)=>{"use strict";m.r(I),m.d(I,{particlesVertexShader:()=>F});var C=m(11150);m(12594),m(12525),m(12480),m(12532),m(12534),m(12541);const l="particlesVertexShader",s="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStore[l]||(C.e.ShadersStore[l]=s);const F={name:l,shader:s}},12942:(V,I,m)=>{"use strict";m.r(I),m.d(I,{FlowGraphGLTFDataProvider:()=>s});var C=m(12921),l=m(12899);class s extends C.e{constructor(V){var I,m;super();const C=V.glTF,s=(null===(I=C.animations)||void 0===I?void 0:I.map((V=>V._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",l.b,s);const F=(null===(m=C.nodes)||void 0===m?void 0:m.map((V=>V._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",l.b,F)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12839:(V,I,m)=>{"use strict";m.d(I,{b:()=>t,c:()=>v,d:()=>O,e:()=>N});var C=m(11040),l=m(11551),s=m(11312),F=m(12848);const k=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class j{constructor(V,I){this._gltf=V,this._infoTree=I}convert(V){let I,m=this._gltf,C=this._infoTree;if(!V.startsWith("/"))throw new Error("Path must start with a /");const l=V.split("/");if(l.shift(),l[l.length-1].includes(".length")){const V=l[l.length-1].split(".");l.pop(),l.push(...V)}let s=!1;for(const j of l){const l="length"===j;if(l&&!C.__array__)throw new Error(`Path ${V} is invalid`);if(C.__ignoreObjectTree__&&(s=!0),C.__array__&&!l)C=C.__array__;else if(C=C[j],!C)throw new Error(`Path ${V} is invalid`);if(!s)if(void 0===m){if(!k.find((I=>I.regex.test(V))))throw new Error(`Path ${V} is invalid`)}else if(!l){var F;m=null===(F=m)||void 0===F?void 0:F[j]}(C.__target__||l)&&(I=m)}return{object:I,info:C}}}function E(V,I,m,C){const l=K(V,I);return C?l[m][C]:l[m]}function K(V,I,m){var C,s;return null===(C=V._data)||void 0===C||null===(s=C[(null===m||void 0===m?void 0:m.fillMode)??l.d.MATERIAL_TriangleFillMode])||void 0===s?void 0:s.babylonMaterial}function Y(V,I){return{offset:{componentsCount:2,type:"Vector2",get:(m,l,s)=>{const F=E(m,s,V,I);return new C.k(null===F||void 0===F?void 0:F.uOffset,null===F||void 0===F?void 0:F.vOffset)},getTarget:K,set:(m,C,l,s)=>{const F=E(C,s,V,I);F.uOffset=m.x,F.vOffset=m.y},getPropertyName:[()=>`${V}${I?"."+I:""}.uOffset`,()=>`${V}${I?"."+I:""}.vOffset`]},rotation:{type:"number",get:(m,C,l)=>{var s;return null===(s=E(m,l,V,I))||void 0===s?void 0:s.wAng},getTarget:K,set:(m,C,l,s)=>E(C,s,V,I).wAng=m,getPropertyName:[()=>`${V}${I?"."+I:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(m,l,s)=>{const F=E(m,s,V,I);return new C.k(null===F||void 0===F?void 0:F.uScale,null===F||void 0===F?void 0:F.vScale)},getTarget:K,set:(m,C,l,s)=>{const F=E(C,s,V,I);F.uScale=m.x,F.vScale=m.y},getPropertyName:[()=>`${V}${I?"."+I:""}.uScale`,()=>`${V}${I?"."+I:""}.vScale`]}}}const X={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:V=>{var I,m;return new C.k((null===(I=V._babylonCamera)||void 0===I?void 0:I.orthoLeft)??0,(null===(m=V._babylonCamera)||void 0===m?void 0:m.orthoRight)??0)},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.orthoLeft=V.x,I._babylonCamera.orthoRight=V.y)},getTarget:V=>V,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:V=>{var I,m;return new C.k((null===(I=V._babylonCamera)||void 0===I?void 0:I.orthoBottom)??0,(null===(m=V._babylonCamera)||void 0===m?void 0:m.orthoTop)??0)},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.orthoBottom=V.x,I._babylonCamera.orthoTop=V.y)},getTarget:V=>V,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.maxZ},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=V)},getTarget:V=>V,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.Fk},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.Fk=V)},getTarget:V=>V,getPropertyName:[()=>"Fk"]}},perspective:{aspectRatio:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.getEngine().getAspectRatio(V._babylonCamera)},getTarget:V=>V,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.fov},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.fov=V)},getTarget:V=>V,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.maxZ},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=V)},getTarget:V=>V,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.Fk},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.Fk=V)},getTarget:V=>V,getPropertyName:[()=>"Fk"]}}}},nodes:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"LF",get:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.position},set:(V,I)=>{var m;return null===(m=I._babylonTransformNode)||void 0===m?void 0:m.position.C(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.rotationQuaternion},set:(V,I)=>{var m,C;return null===(m=I._babylonTransformNode)||void 0===m||null===(C=m.rotationQuaternion)||void 0===C?void 0:C.C(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"LF",get:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.Vk},set:(V,I)=>{var m;return null===(m=I._babylonTransformNode)||void 0===m?void 0:m.Vk.C(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"Vk"]},weights:{length:{type:"number",get:V=>V._numMorphTargets,getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(V,I)=>{var m,C;return void 0!==I?null===(m=V._primitiveBabylonMeshes)||void 0===m||null===(C=m[0].morphTargetManager)||void 0===C?void 0:C.getTarget(I).influence:void 0},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(V,I)=>[0],getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:V=>{var I,m,l;return C.b.Compose(null===(I=V._babylonTransformNode)||void 0===I?void 0:I.Vk,null===(m=V._babylonTransformNode)||void 0===m?void 0:m.rotationQuaternion,null===(l=V._babylonTransformNode)||void 0===l?void 0:l.position)},getTarget:V=>V._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:V=>{var I,m,l,s;const F=C.b.Identity();let k=V.parent;for(;k&&k.parent;)k=k.parent;const j=(null===(I=V._babylonTransformNode)||void 0===I?void 0:I.position._isDirty)||(null===(m=V._babylonTransformNode)||void 0===m||null===(l=m.rotationQuaternion)||void 0===l?void 0:l._isDirty)||(null===(s=V._babylonTransformNode)||void 0===s?void 0:s.Vk._isDirty);if(k){var E;const I=null===(E=k._babylonTransformNode)||void 0===E?void 0:E.fF(!0).invert();var K,Y;if(I)null===(K=V._babylonTransformNode)||void 0===K||null===(Y=K.fF(j))||void 0===Y||Y.multiplyToRef(I,F)}else V._babylonTransformNode&&F.C(V._babylonTransformNode.fF(j));return F},getTarget:V=>V._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:V=>{var I,m;return null===(I=V._babylonTransformNode)||void 0===I||null===(m=I.getChildren((V=>V instanceof F.c),!0)[0])||void 0===m?void 0:m.Kk},getTarget:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.getChildren((V=>V instanceof F.c),!0)[0]},set:(V,I)=>{if(I._babylonTransformNode){const m=I._babylonTransformNode.getChildren((V=>V instanceof F.c),!0)[0];m&&(m.Kk=V)}}},color:{type:"dY",get:V=>{var I,m;return null===(I=V._babylonTransformNode)||void 0===I||null===(m=I.getChildren((V=>V instanceof F.c),!0)[0])||void 0===m?void 0:m.Yk},getTarget:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.getChildren((V=>V instanceof F.c),!0)[0]},set:(V,I)=>{if(I._babylonTransformNode){const m=I._babylonTransformNode.getChildren((V=>V instanceof F.c),!0)[0];m&&(m.Yk=V)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"dY",get:(V,I,m)=>K(V,I,m).emissiveColor,set:(V,I,m,C)=>K(I,m,C).emissiveColor.C(V),getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(V,I,m)=>{var C;return null===(C=E(V,m,"bumpTexture"))||void 0===C?void 0:C.level},set:(V,I,m,C)=>{const l=E(I,C,"bumpTexture");l&&(l.level=V)},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(V,I,m)=>K(V,I,m).ambientTextureStrength,set:(V,I,m,C)=>{const l=K(I,m,C);l&&(l.ambientTextureStrength=V)},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"dX",get:(V,I,m)=>{const C=K(V,I,m);return s.d.FromColor3(C.albedoColor,C.alpha)},set:(V,I,m,C)=>{const l=K(I,m,C);l.albedoColor.set(V.r,V.g,V.b),l.alpha=V.a},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Y("albedoTexture")}},metallicFactor:{type:"number",get:(V,I,m)=>K(V,I,m).metallic,set:(V,I,m,C)=>{const l=K(I,m,C);l&&(l.metallic=V)},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(V,I,m)=>K(V,I,m).roughness,set:(V,I,m,C)=>{const l=K(I,m,C);l&&(l.roughness=V)},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(V,I,m)=>K(V,I,m).anisotropy.Kk,set:(V,I,m,C)=>{K(I,m,C).anisotropy.Kk=V},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(V,I,m)=>K(V,I,m).anisotropy.angle,set:(V,I,m,C)=>{K(I,m,C).anisotropy.angle=V},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(V,I,m)=>K(V,I,m).clearCoat.Kk,set:(V,I,m,C)=>{K(I,m,C).clearCoat.Kk=V},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(V,I,m)=>K(V,I,m).clearCoat.roughness,set:(V,I,m,C)=>{K(I,m,C).clearCoat.roughness=V},getTarget:(V,I,m)=>K(V,I,m),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(V,I,m)=>{var C;return null===(C=K(V,I,m).clearCoat.bumpTexture)||void 0===C?void 0:C.level},getTarget:K,set:(V,I,m,C)=>K(I,m,C).clearCoat.bumpTexture.level=V},extensions:{KHR_texture_transform:Y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(V,I,m)=>K(V,I,m).subSurface.dispersion,getTarget:K,set:(V,I,m,C)=>K(I,m,C).subSurface.dispersion=V}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(V,I,m)=>K(V,I,m).emissiveIntensity,getTarget:K,set:(V,I,m,C)=>K(I,m,C).emissiveIntensity=V}},KHR_materials_ior:{ior:{type:"number",get:(V,I,m)=>K(V,I,m).indexOfRefraction,getTarget:K,set:(V,I,m,C)=>K(I,m,C).indexOfRefraction=V}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(V,I,m)=>K(V,I,m).iridescence.Kk,getTarget:K,set:(V,I,m,C)=>K(I,m,C).iridescence.Kk=V},iridescenceIor:{type:"number",get:(V,I,m)=>K(V,I,m).iridescence.indexOfRefraction,getTarget:K,set:(V,I,m,C)=>K(I,m,C).iridescence.indexOfRefraction=V},iridescenceTexture:{extensions:{KHR_texture_transform:Y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(V,I,m)=>K(V,I,m).iridescence.maximumThickness,getTarget:K,set:(V,I,m,C)=>K(I,m,C).iridescence.maximumThickness=V},iridescenceThicknessMinimum:{type:"number",get:(V,I,m)=>K(V,I,m).iridescence.minimumThickness,getTarget:K,set:(V,I,m,C)=>K(I,m,C).iridescence.minimumThickness=V},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"dY",get:(V,I,m)=>K(V,I,m).sheen.color,getTarget:K,set:(V,I,m,C)=>K(I,m,C).sheen.color.C(V)},sheenColorTexture:{extensions:{KHR_texture_transform:Y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(V,I,m)=>K(V,I,m).sheen.Kk,getTarget:K,set:(V,I,m,C)=>K(I,m,C).sheen.Kk=V},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(V,I,m)=>K(V,I,m).metallicF0Factor,getTarget:K,set:(V,I,m,C)=>K(I,m,C).metallicF0Factor=V,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"dY",get:(V,I,m)=>K(V,I,m).metallicReflectanceColor,getTarget:K,set:(V,I,m,C)=>K(I,m,C).metallicReflectanceColor.C(V),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(V,I,m)=>K(V,I,m).subSurface.refractionIntensity,getTarget:K,set:(V,I,m,C)=>K(I,m,C).subSurface.refractionIntensity=V,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(V,I,m)=>K(V,I,m).subSurface.translucencyIntensity,getTarget:K,set:(V,I,m,C)=>K(I,m,C).subSurface.translucencyIntensity=V},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"dY",get:(V,I,m)=>K(V,I,m).subSurface.translucencyColor,getTarget:K,set:(V,I,m,C)=>{var l;return V&&(null===(l=K(I,m,C).subSurface.translucencyColor)||void 0===l?void 0:l.C(V))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"dY",get:(V,I,m)=>K(V,I,m).subSurface.tintColor,getTarget:K,set:(V,I,m,C)=>K(I,m,C).subSurface.tintColor.C(V)},attenuationDistance:{type:"number",get:(V,I,m)=>K(V,I,m).subSurface.tintColorAtDistance,getTarget:K,set:(V,I,m,C)=>K(I,m,C).subSurface.tintColorAtDistance=V},thicknessFactor:{type:"number",get:(V,I,m)=>K(V,I,m).subSurface.maximumThickness,getTarget:K,set:(V,I,m,C)=>K(I,m,C).subSurface.maximumThickness=V},thicknessTexture:{extensions:{KHR_texture_transform:Y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonLight)),getPropertyName:[V=>"length"]},__array__:{__target__:!0,color:{type:"dY",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.Yk},set:(V,I)=>{var m;return null===(m=I._babylonLight)||void 0===m?void 0:m.Yk.C(V)},getTarget:V=>V._babylonLight,getPropertyName:[V=>"diffuse"]},Kk:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.Kk},set:(V,I)=>I._babylonLight?I._babylonLight.Kk=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"intensity"]},range:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.range},set:(V,I)=>I._babylonLight?I._babylonLight.range=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"range"]},spot:{innerConeAngle:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.innerAngle},set:(V,I)=>I._babylonLight?I._babylonLight.innerAngle=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"innerConeAngle"]},outerConeAngle:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.angle},set:(V,I)=>I._babylonLight?I._babylonLight.angle=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonLight)),getPropertyName:[V=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonTexture)),getPropertyName:[V=>"length"]},__array__:{__target__:!0,Kk:{type:"number",get:V=>{var I;return null===(I=V._babylonTexture)||void 0===I?void 0:I.level},set:(V,I)=>{I._babylonTexture&&(I._babylonTexture.level=V)},getTarget:V=>V._babylonTexture},rotation:{type:"Quaternion",get:V=>{var I;return V._babylonTexture&&C.e.FromRotationMatrix(null===(I=V._babylonTexture)||void 0===I?void 0:I.getReflectionTextureMatrix())},set:(V,I)=>{var m;I._babylonTexture&&(null!==(m=I._babylonTexture.cV())&&void 0!==m&&m.useRightHandedSystem||(V=C.e.Inverse(V)),C.b.FromQuaternionToRef(V,I._babylonTexture.getReflectionTextureMatrix()))},getTarget:V=>V._babylonTexture}}}}},animations:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>{var I;return null===(I=V.primitives[0]._instanceData)||void 0===I?void 0:I.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function O(V){return new j(V,X)}function v(V){const I=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let m=X;for(const C of I)C&&(m=m[C]);if(m&&m.type&&m.get)return m}function N(V,I){const m=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let C=X;for(const l of m)l&&(C=C[l]);C&&C.type&&C.get&&(C.interpolation=I)}function t(V,I){const m=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let C=X;for(const l of m)if(l){if(!C[l]){if("?"===l){C.__ignoreObjectTree__=!0;continue}C[l]={},"__array__"===l&&(C[l].__target__=!0)}C=C[l]}Object.assign(C,I)}},12853:(V,I,m)=>{"use strict";m.r(I),m.d(I,{AnimationPropertyInfo:()=>E,TransformNodeAnimationPropertyInfo:()=>K,WeightAnimationPropertyInfo:()=>Y,getQuaternion:()=>k,getVector3:()=>F,getWeights:()=>j});var C=m(11700),l=m(11040),s=m(12839);function F(V,I,m,C){return l.m.Ik(I,m).scaleInPlace(C)}function k(V,I,m,C){return l.e.Ik(I,m).scaleInPlace(C)}function j(V,I,m,C){const l=new Array(V._numMorphTargets);for(let s=0;s<l.length;s++)l[s]=I[m++]*C;return l}class E{constructor(V,I,m,C){this.type=V,this.name=I,this.getValue=m,this.getStride=C}_buildAnimation(V,I,m){const l=new C.c(V,this.name,I,this.type);return l.setKeys(m),l}}class K extends E{buildAnimations(V,I,m,C){const l=[];return l.push({babylonAnimatable:V._babylonTransformNode,babylonAnimation:this._buildAnimation(I,m,C)}),l}}class Y extends E{buildAnimations(V,I,m,l){const s=[];if(V._numMorphTargets)for(let F=0;F<V._numMorphTargets;F++){const k=new C.c(`${I}_${F}`,this.name,m,this.type);if(k.setKeys(l.map((V=>({frame:V.frame,inTangent:V.inTangent?V.inTangent[F]:void 0,value:V.value[F],outTangent:V.outTangent?V.outTangent[F]:void 0,interpolation:V.interpolation})))),V._primitiveBabylonMeshes)for(const I of V._primitiveBabylonMeshes)if(I.morphTargetManager){const V=I.morphTargetManager.getTarget(F),m=k.clone();V.animations.push(m),s.push({babylonAnimatable:V,babylonAnimation:m})}}return s}}(0,s.e)("/nodes/{}/translation",[new K(C.c.ANIMATIONTYPE_VECTOR3,"position",F,(()=>3))]),(0,s.e)("/nodes/{}/rotation",[new K(C.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",k,(()=>4))]),(0,s.e)("/nodes/{}/scale",[new K(C.c.ANIMATIONTYPE_VECTOR3,"Vk",F,(()=>3))]),(0,s.e)("/nodes/{}/weights",[new Y(C.c.ANIMATIONTYPE_FLOAT,"influence",j,(V=>V._numMorphTargets))])},12810:(V,I,m)=>{"use strict";class C{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((V,I)=>{this._resolve=V,this._reject=I}))}}var l=m(11040),s=m(11312),F=m(11076),k=m(11386),j=m(12813),E=m(12821),K=m(11067),Y=m(11543),X=m(11700),O=m(11703),v=m(11061),N=m(11085),t=m(11089);class D{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(V){this._useTextureToStoreBoneMatrices=V,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(V,I,m){this.name=V,this.id=I,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=l.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new K.e,this.bones=[],this._scene=m||v.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const C=this._scene.getEngine().getCaps();this._canUseTextureForBones=C.textureFloat&&C.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((V=>!V.getParent()))}getTransformMatrices(V){if(this.needInitialSkinMatrix){if(!V)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return V._bonesTransformMatrices||this.prepare(!0),V._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(V){return this.needInitialSkinMatrix&&V._transformMatrixTexture?V._transformMatrixTexture:this._transformMatrixTexture}cV(){return this._scene}toString(V){let I=`Name: ${this.name}, nBones: ${this.bones.length}`;if(I+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,V){I+=", Ranges: {";let V=!0;for(const m in this._ranges)V&&(I+=", ",V=!1),I+=m;I+="}"}return I}getBoneIndexByName(V){for(let I=0,m=this.bones.length;I<m;I++)if(this.bones[I].name===V)return I;return-1}createAnimationRange(V,I,m){if(!this._ranges[V]){this._ranges[V]=new O.b(V,I,m);for(let C=0,l=this.bones.length;C<l;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].createRange(V,I,m)}}deleteAnimationRange(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let m=0,C=this.bones.length;m<C;m++)this.bones[m].animations[0]&&this.bones[m].animations[0].deleteRange(V,I);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}getAnimationRanges(){const V=[];let I;for(I in this._ranges)V.push(this._ranges[I]);return V}copyAnimationRange(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[I]||!V.getAnimationRange(I))return!1;let C=!0;const l=this._getHighestAnimationFrame()+1,s={},F=V.bones;let k,j;for(j=0,k=F.length;j<k;j++)s[F[j].name]=F[j];this.bones.length!==F.length&&(N.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${F.length}`),C=!1);const E=m&&this.dimensionsAtRest&&V.dimensionsAtRest?this.dimensionsAtRest.divide(V.dimensionsAtRest):null;for(j=0,k=this.bones.length;j<k;j++){const V=this.bones[j].name,F=s[V];F?C=C&&this.bones[j].copyAnimationRange(F,I,l,m,E):(N.d.Warn("copyAnimationRange: not same rig, missing source bone "+V),C=!1)}const K=V.getAnimationRange(I);return K&&(this._ranges[I]=new O.b(I,K.from+l,K.to+l)),C}returnToRest(){for(const V of this.bones)-1!==V._index&&V.returnToRest()}_getHighestAnimationFrame(){let V=0;for(let I=0,m=this.bones.length;I<m;I++)if(this.bones[I].animations[0]){const m=this.bones[I].animations[0].getHighestFrame();V<m&&(V=m)}return V}beginAnimation(V,I,m,C){const l=this.getAnimationRange(V);return l?this._scene.beginAnimation(this,l.from,l.to,I,m,C):null}static MakeAnimationAdditive(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;const C=V.getAnimationRange(m);if(!C)return null;const l=V._scene.getAllAnimatablesByTarget(V);let s=null;for(let k=0;k<l.length;k++){const V=l[k];if(V.fromFrame===(null===C||void 0===C?void 0:C.from)&&V.toFrame===(null===C||void 0===C?void 0:C.to)){s=V;break}}const F=V.getAnimatables();for(let k=0;k<F.length;k++){const V=F[k].animations;if(V)for(let C=0;C<V.length;C++)X.c.MakeAnimationAdditive(V[C],I,m)}return s&&(s.isAdditive=!0),V}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(V){this._meshesWithPoseMatrix.push(V)}_unregisterMeshWithPoseMatrix(V){const I=this._meshesWithPoseMatrix.indexOf(V);I>-1&&this._meshesWithPoseMatrix.splice(I,1)}_computeTransformMatrices(V,I){this.onBeforeComputeObservable.notifyObservers(this);for(let m=0;m<this.bones.length;m++){const C=this.bones[m];C._childUpdateId++;const l=C.getParent();if(l?C.getLocalMatrix().multiplyToRef(l.getFinalMatrix(),C.getFinalMatrix()):I?C.getLocalMatrix().multiplyToRef(I,C.getFinalMatrix()):C.getFinalMatrix().C(C.getLocalMatrix()),-1!==C._index){const I=null===C._index?m:C._index;C.getAbsoluteInverseBindMatrix().multiplyToArray(C.getFinalMatrix(),V,16*I)}}this._identity.copyToArray(V,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const V=this.cV().getRenderId();if(this._currentRenderId===V)return;this._currentRenderId=V}if(this._numBonesWithLinkedTransformNode>0)for(const V of this.bones)if(V._linkedTransformNode){const I=V._linkedTransformNode;V.position=I.position,I.rotationQuaternion?V.rotationQuaternion=I.rotationQuaternion:V.rotation=I.rotation,V.Vk=I.Vk}if(this.needInitialSkinMatrix)for(const V of this._meshesWithPoseMatrix){const I=V.getPoseMatrix();let m=this._isDirty;if(V._bonesTransformMatrices&&V._bonesTransformMatrices.length===16*(this.bones.length+1)||(V._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),m=!0),m){if(this._synchronizedWithMesh!==V){this._synchronizedWithMesh=V;for(const V of this.bones)if(!V.getParent()){V.getBindMatrix().multiplyToRef(I,l.g.Matrix[1]),V._updateAbsoluteBindMatrices(l.g.Matrix[1])}if(this.isUsingTextureForMatrices){const I=4*(this.bones.length+1);V._transformMatrixTexture&&V._transformMatrixTexture.getSize().width===I||(V._transformMatrixTexture&&V._transformMatrixTexture.dispose(),V._transformMatrixTexture=Y.d.CreateRGBATexture(V._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(V._bonesTransformMatrices,I),this.isUsingTextureForMatrices&&V._transformMatrixTexture&&V._transformMatrixTexture.update(V._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Y.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let V=0;V<this.bones.length;V++)this._animatables.push(this.bones[V])}return this._animatables}clone(V,I){const m=new D(V,I||V,this._scene);m.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){const V=this.bones[C];let I=null;const l=V.getParent();if(l){const V=this.bones.indexOf(l);I=m.bones[V]}const s=new E.b(V.name,m,I,V.getBindMatrix().clone(),V.getRestMatrix().clone());s._index=V._index,V._linkedTransformNode&&s.linkTransformNode(V._linkedTransformNode),t.e.DeepCopy(V.animations,s.animations)}if(this._ranges){m._ranges={};for(const V in this._ranges){const I=this._ranges[V];I&&(m._ranges[V]=I.clone())}}return this._isDirty=!0,m.prepare(!0),m}enableBlending(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const I of this.bones)for(const m of I.animations)m.enableBlending=!0,m.blendingSpeed=V}dispose(){if(this._meshesWithPoseMatrix.length=0,this.cV().stopAnimation(this),this.cV().removeSkeleton(this),this._parentContainer){const V=this._parentContainer.skeletons.indexOf(this);V>-1&&this._parentContainer.skeletons.splice(V,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const V={};V.name=this.name,V.id=this.id,this.dimensionsAtRest&&(V.dimensionsAtRest=this.dimensionsAtRest.UF()),V.bones=[],V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let m=0;m<this.bones.length;m++){var I;const C=this.bones[m],l=C.getParent(),s={parentBoneIndex:l?this.bones.indexOf(l):-1,index:C.getIndex(),name:C.name,id:C.id,matrix:C.getBindMatrix().UF(),rest:C.getRestMatrix().UF(),linkedTransformNodeId:null===(I=C.getTransformNode())||void 0===I?void 0:I.id};V.bones.push(s),C.length&&(s.length=C.length),C.metadata&&(s.metadata=C.metadata),C.animations&&C.animations.length>0&&(s.animation=C.animations[0].serialize()),V.ranges=[];for(const I in this._ranges){const m=this._ranges[I];if(!m)continue;const C={};C.name=I,C.from=m.from,C.to=m.to,V.ranges.push(C)}}return V}static Parse(V,I){const m=new D(V.name,V.id,I);let C;for(V.dimensionsAtRest&&(m.dimensionsAtRest=l.m.Ik(V.dimensionsAtRest)),m.needInitialSkinMatrix=V.needInitialSkinMatrix,C=0;C<V.bones.length;C++){const I=V.bones[C],s=V.bones[C].index;let F=null;I.parentBoneIndex>-1&&(F=m.bones[I.parentBoneIndex]);const k=I.rest?l.b.Ik(I.rest):null,j=new E.b(I.name,m,F,l.b.Ik(I.matrix),k,null,s);void 0!==I.id&&null!==I.id&&(j.id=I.id),I.length&&(j.length=I.length),I.metadata&&(j.metadata=I.metadata),I.animation&&j.animations.push(X.c.Parse(I.animation)),void 0!==I.linkedTransformNodeId&&null!==I.linkedTransformNodeId&&(m._hasWaitingData=!0,j._waitingTransformNodeId=I.linkedTransformNodeId)}if(V.ranges)for(C=0;C<V.ranges.length;C++){const I=V.ranges[C];m.createAnimationRange(I.name,I.from,I.to)}return m}computeAbsoluteMatrices(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||V)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(V)}getPoseMatrix(){let V=null;return this._meshesWithPoseMatrix.length>0&&(V=this._meshesWithPoseMatrix[0].getPoseMatrix()),V}sortBones(){const V=[],I=new Array(this.bones.length);for(let m=0;m<this.bones.length;m++)this._sortBones(m,V,I);this.bones=V}_sortBones(V,I,m){if(m[V])return;m[V]=!0;const C=this.bones[V];if(!C)return;void 0===C._index&&(C._index=V);const l=C.getParent();l&&this._sortBones(this.bones.indexOf(l),I,m),I.push(C)}setCurrentPoseAsRest(){for(const V of this.bones)V.setCurrentPoseAsRest()}}var b=m(11202),T=m(11570),n=m(11518),x=m(11332),S=m(11233),c=m(11406),H=m(11342),y=m(11384),z=m(11705),Z=m(11389),B=m(12771);class W{set areUpdatesFrozen(V){V?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Z.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,V||(V=v.c.LastCreatedScene),this._scene=V,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const V=this._scene.getEngine().getCaps();this._canUseTextureForTargets=V.canUseGLVertexID&&V.textureFloat&&V.maxVertexTextureImageUnits>0&&V.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return W.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?W.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(V){this._numMaxInfluencers!==V&&(this._numMaxInfluencers=V,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(V){this._useTextureToStoreTargets!==V&&(this._useTextureToStoreTargets=V,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var V;return W.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(V=this._scene)&&void 0!==V&&V.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(V){return this._activeTargets.data[V]}getTarget(V){return this._targets[V]}getTargetByName(V){for(const I of this._targets)if(I.name===V)return I;return null}addTarget(V){this._targets.push(V),this._targetInfluenceChangedObservers.push(V.onInfluenceChanged.add((V=>{this.areUpdatesFrozen&&V&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(V)}))),this._targetDataLayoutChangedObservers.push(V._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(V){const I=this._targets.indexOf(V);I>=0&&(this._targets.splice(I,1),V.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(I,1)[0]),V._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(I,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(V)}_bind(V){V.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),V.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),V.setTexture("morphTargets",this._targetStoreTexture),V.setInt("morphTargetCount",this.numInfluencers)}clone(){const V=new W(this._scene);for(const I of this._targets)V.addTarget(I.clone());return V.enablePositionMorphing=this.enablePositionMorphing,V.enableNormalMorphing=this.enableNormalMorphing,V.enableTangentMorphing=this.enableTangentMorphing,V.enableUVMorphing=this.enableUVMorphing,V.enableUV2Morphing=this.enableUV2Morphing,V.enableColorMorphing=this.enableColorMorphing,V}serialize(){const V={};V.id=this.uniqueId,V.targets=[];for(const I of this._targets)V.targets.push(I.serialize());return V}_syncActiveTargets(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const I=!!this._targetStoreTexture,m=this.isUsingTextureForTargets;(this._mustSynchronize||I!==m)&&(this._mustSynchronize=!1,this.synchronize());let C=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let l=-1;for(const s of this._targets)if(l++,0!==s.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=W.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(s),this._morphTargetTextureIndices[C]=l,this._tempInfluences[C++]=s.influence}this._morphTargetTextureIndices.length!==C&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,C)),this._influences&&this._influences.length===C||(this._influences=new Float32Array(C));for(let s=0;s<C;s++)this._influences[s]=this._tempInfluences[s];if(V&&this._scene)for(const s of this._scene.meshes)s.morphTargetManager===this&&(m?s._markSubMeshesAsAttributesDirty():s._syncGeometryWithMorphTargetManager())}synchronize(){var V;if(!this._scene||this.areUpdatesFrozen)return;const I=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(V=this._targetStoreTexture)||void 0===V||V.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>I.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const m of this._targets){this._supportsPositions=this._supportsPositions&&m.hasPositions,this._supportsNormals=this._supportsNormals&&m.hasNormals,this._supportsTangents=this._supportsTangents&&m.hasTangents,this._supportsUVs=this._supportsUVs&&m.hasUVs,this._supportsUV2s=this._supportsUV2s&&m.hasUV2s,this._supportsColors=this._supportsColors&&m.hasColors;const V=m.vertexCount;if(0===this._vertexCount)this._vertexCount=V;else if(this._vertexCount!==V)return void N.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${m.name}": ${V}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const V=I.getCaps().maxTextureSize;this._textureWidth>V&&(this._textureHeight=Math.ceil(this._textureWidth/V),this._textureWidth=V);const m=this._targets.length,C=new Float32Array(m*this._textureWidth*this._textureHeight*4);let l=0;for(let I=0;I<m;I++){const V=this._targets[I],m=V.getPositions(),s=V.getNormals(),F=V.getUVs(),k=V.getTangents(),j=V.getUV2s(),E=V.getColors();l=I*this._textureWidth*this._textureHeight*4;for(let I=0;I<this._vertexCount;I++)this._supportsPositions&&m&&(C[l]=m[3*I],C[l+1]=m[3*I+1],C[l+2]=m[3*I+2],l+=4),this._supportsNormals&&s&&(C[l]=s[3*I],C[l+1]=s[3*I+1],C[l+2]=s[3*I+2],l+=4),this._supportsUVs&&F&&(C[l]=F[2*I],C[l+1]=F[2*I+1],l+=4),this._supportsTangents&&k&&(C[l]=k[3*I],C[l+1]=k[3*I+1],C[l+2]=k[3*I+2],l+=4),this._supportsUV2s&&j&&(C[l]=j[2*I],C[l+1]=j[2*I+1],l+=4),this._supportsColors&&E&&(C[l]=E[4*I],C[l+1]=E[4*I+1],C[l+2]=E[4*I+2],C[l+3]=E[4*I+3],l+=4)}this._targetStoreTexture=B.c.CreateRGBATexture(C,this._textureWidth,this._textureHeight,m,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const m of this._scene.meshes)m.morphTargetManager===this&&m._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const V=this._parentContainer.morphTargetManagers.indexOf(this);V>-1&&this._parentContainer.morphTargetManagers.splice(V,1),this._parentContainer=null}for(const V of this._targets)this._scene.stopAnimation(V)}}static Parse(V,I){const m=new W(I);for(const C of V.targets)m.addTarget(z.e.Parse(C,I));return m}}W.EnableTextureStorage=!0,W.MaxActiveMorphTargetsInVertexAttributeMode=8,W.ConstantTargetCountForTextureMode=0;var Q=m(12828),G=m(11102),r=m(11251);const g=new Map,h=g;function d(V,I,m){R(V)&&N.d.Warn(`Extension with the name '${V}' already exists`),g.set(V,{isGLTFExtension:I,factory:m})}function R(V){return g.delete(V)}var i=m(12839),q=m(11769),P=m(11240);class u{static Get(V,I,m){if(!I||void 0==m||!I[m])throw new Error(`${V}: Failed to find index (${m})`);return I[m]}static TryGet(V,I){return V&&void 0!=I&&V[I]?V[I]:null}static Assign(V){if(V)for(let I=0;I<V.length;I++)V[I].index=I}}function o(V){if(V.min&&V.max){const I=V.min,m=V.max,C=l.g.LF[0].aF(I[0],I[1],I[2]),s=l.g.LF[1].aF(m[0],m[1],m[2]);if(V.normalized&&5126!==V.componentType){let I=1;switch(V.componentType){case 5120:I=127;break;case 5121:I=255;break;case 5122:I=32767;break;case 5123:I=65535}const m=1/I;C.scaleInPlace(m),s.scaleInPlace(m)}return new r.d(C,s)}return null}class p{static RegisterExtension(V,I){d(V,!1,I)}static UnregisterExtension(V){return R(V)}get sk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(V){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=V}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((V=>V.dispose&&V.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(V,I,m,C,l,s){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=I,this._assetContainer=m,this._loadData(C);let s=null;if(V){const I={};if(this._gltf.nodes)for(const V of this._gltf.nodes)V.name&&(I[V.name]=V.index);s=(V instanceof Array?V:[V]).map((V=>{const m=I[V];if(void 0===m)throw new Error(`Failed to find node '${V}'`);return m}))}return await this._loadAsync(l,F,s,(()=>({meshes:this._getMeshes(),ZY:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=V,this._loadData(I),await this._loadAsync(m,l,null,(()=>{}))}async _loadAsync(V,I,m,C){return await Promise.resolve().then((async()=>{this._rootUrl=V,this._uniqueRootUrl=!V.startsWith("file:")&&I?V:`${V}${Date.now()}/`,this._fileName=I,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const l=`${Q.h[Q.h.LOADING]} => ${Q.h[Q.h.READY]}`,s=`${Q.h[Q.h.LOADING]} => ${Q.h[Q.h.COMPLETE]}`;this._parent._startPerformanceCounter(l),this._parent._startPerformanceCounter(s),this._parent._setState(Q.h.LOADING),this._extensionsOnLoading();const k=new Array;if(!this.parent.loadOnlyMaterials)if(m)k.push(this.loadSceneAsync("/nodes",{nodes:m,index:-1}));else if(void 0!=this._gltf.OI||this._gltf.scenes&&this._gltf.scenes[0]){const V=u.Get("/scene",this._gltf.scenes,this._gltf.OI||0);k.push(this.loadSceneAsync(`/scenes/${V.index}`,V))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let V=0;V<this._gltf.materials.length;++V){const I=this._gltf.materials[V],m="/materials/"+V,C=b.d.TriangleFillMode;k.push(this._loadMaterialAsync(m,I,null,C,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&k.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&k.push(this._compileShadowGeneratorsAsync());const j=Promise.all(k).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Sk(!0);for(const V of this._babylonScene.materials){const I=V;void 0!==I.maxSimultaneousLights&&(I.maxSimultaneousLights=Math.max(I.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(Q.h.READY),this._skipStartAnimationStep||this._startAnimations(),C()}));return await j.then((V=>(this._parent._endPerformanceCounter(l),F.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(s),this._parent._setState(Q.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(V=>{this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()}))})),V)))})).catch((V=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()),V}))}_loadData(V){if(this._gltf=V.json,this._setupData(),V.bin){const I=this._gltf.buffers;if(I&&I[0]&&!I[0].uri){const m=I[0];(m.byteLength<V.bin.byteLength-3||m.byteLength>V.bin.byteLength)&&N.d.Warn(`Binary buffer length (${m.byteLength}) from JSON does not match chunk length (${V.bin.byteLength})`),this._bin=V.bin}else N.d.Warn("Unexpected BIN chunk")}}_setupData(){if(u.Assign(this._gltf.accessors),u.Assign(this._gltf.animations),u.Assign(this._gltf.buffers),u.Assign(this._gltf.bufferViews),u.Assign(this._gltf.cameras),u.Assign(this._gltf.images),u.Assign(this._gltf.materials),u.Assign(this._gltf.meshes),u.Assign(this._gltf.nodes),u.Assign(this._gltf.samplers),u.Assign(this._gltf.scenes),u.Assign(this._gltf.skins),u.Assign(this._gltf.textures),this._gltf.nodes){const V={};for(const m of this._gltf.nodes)if(m.children)for(const I of m.children)V[I]=m.index;const I=this._createRootNode();for(const m of this._gltf.nodes){const C=V[m.index];m.parent=void 0===C?I:this._gltf.nodes[C]}}}async _loadExtensionsAsync(){const V=[];if(h.forEach(((I,m)=>{var C;!1===(null===(C=this.parent.extensionOptions[m])||void 0===C?void 0:C.enabled)?I.isGLTFExtension&&this.isExtensionUsed(m)&&N.d.Warn(`Extension ${m} is used but has been explicitly disabled.`):I.isGLTFExtension&&!this.isExtensionUsed(m)||V.push((async()=>{const V=await I.factory(this);return V.name!==m&&N.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${V.name} !== ${m}`),this._parent.onExtensionLoadedObservable.notifyObservers(V),V})())})),this._extensions.push(...await Promise.all(V)),this._extensions.sort(((V,I)=>(V.order||Number.MAX_VALUE)-(I.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const m of this._gltf.extensionsRequired){if(!this._extensions.some((V=>V.name===m&&V.enabled))){var I;if(!1===(null===(I=this.parent.extensionOptions[m])||void 0===I?void 0:I.enabled))throw new Error(`Required extension ${m} is disabled`);throw new Error(`Required extension ${m} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new y.c("__root__",this._babylonScene);this._rootBabylonMesh=V,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Sk(!1);const I={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Q.g.AUTO:this._babylonScene.useRightHandedSystem||(I.rotation=[0,1,0,0],I.scale=[1,1,-1],p._LoadTransform(I,this._rootBabylonMesh));break;case Q.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(V),I}loadSceneAsync(V,I){const m=this._extensionsLoadSceneAsync(V,I);if(m)return m;const C=new Array;if(this.logOpen(`${V} ${I.name||""}`),I.nodes)for(const l of I.nodes){const I=u.Get(`${V}/nodes/${l}`,this._gltf.nodes,l);C.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(V=>{V.parent=this._rootBabylonMesh})))}for(const l of this._postSceneLoadActions)l();return C.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(C).then((()=>{}))}_forEachPrimitive(V,I){if(V._primitiveBabylonMeshes)for(const m of V._primitiveBabylonMeshes)I(m)}_getGeometries(){const V=[],I=this._gltf.nodes;if(I)for(const m of I)this._forEachPrimitive(m,(I=>{const m=I.wF;m&&-1===V.indexOf(m)&&V.push(m)}));return V}_getMeshes(){const V=[];this._rootBabylonMesh instanceof H.e&&V.push(this._rootBabylonMesh);const I=this._gltf.nodes;if(I)for(const m of I)this._forEachPrimitive(m,(I=>{V.push(I)}));return V}_getTransformNodes(){const V=[],I=this._gltf.nodes;if(I)for(const m of I)m._babylonTransformNode&&"Sv"===m._babylonTransformNode.getClassName()&&V.push(m._babylonTransformNode),m._babylonTransformNodeForSkin&&V.push(m._babylonTransformNodeForSkin);return V}_getSkeletons(){const V=[],I=this._gltf.skins;if(I)for(const m of I)m._data&&V.push(m._data.babylonSkeleton);return V}_getAnimationGroups(){const V=[],I=this._gltf.animations;if(I)for(const m of I)m._babylonAnimationGroup&&V.push(m._babylonAnimationGroup);return V}_startAnimations(){switch(this._parent.animationStartMode){case Q.f.NONE:break;case Q.f.FIRST:{const V=this._getAnimationGroups();0!==V.length&&V[0].start(!0);break}case Q.f.ALL:{const V=this._getAnimationGroups();for(const I of V)I.start(!0);break}default:return void N.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadNodeAsync(V,I,m);if(C)return C;if(I._babylonTransformNode)throw new Error(`${V}: Invalid recursive node hierarchy`);const l=new Array;this.logOpen(`${V} ${I.name||""}`);const s=C=>{if(p.AddPointerMetadata(C,V),p._LoadTransform(I,C),void 0!=I.camera){const m=u.Get(`${V}/camera`,this._gltf.cameras,I.camera);l.push(this.loadCameraAsync(`/cameras/${m.index}`,m,(V=>{V.parent=C,this._babylonScene.useRightHandedSystem||(C.Vk.x=-1)})))}if(I.children)for(const m of I.children){const I=u.Get(`${V}/children/${m}`,this._gltf.nodes,m);l.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(V=>{V.parent=C})))}m(C)},F=void 0!=I.mesh,k=this._parent.loadSkins&&void 0!=I.skin;if(!F||k){const V=I.name||`node${I.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new x.c(V,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==I.mesh?I._babylonTransformNode=m:I._babylonTransformNodeForSkin=m,s(m)}if(F)if(k){const m=u.Get(`${V}/mesh`,this._gltf.meshes,I.mesh);l.push(this._loadMeshAsync(`/meshes/${m.index}`,I,m,(m=>{const C=I._babylonTransformNodeForSkin;m.metadata=(0,q.c)(C.metadata,m.metadata||{});const s=u.Get(`${V}/skin`,this._gltf.skins,I.skin);l.push(this._loadSkinAsync(`/skins/${s.index}`,I,s,(V=>{this._forEachPrimitive(I,(I=>{I.skeleton=V})),this._postSceneLoadActions.push((()=>{if(void 0!=s.skeleton){const V=u.Get(`/skins/${s.index}/skeleton`,this._gltf.nodes,s.skeleton).parent;I.index===V.index?m.parent=C.parent:m.parent=V._babylonTransformNode}else m.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:C,skinnedNode:m})}))})))})))}else{const m=u.Get(`${V}/mesh`,this._gltf.meshes,I.mesh);l.push(this._loadMeshAsync(`/meshes/${m.index}`,I,m,s))}return this.logClose(),Promise.all(l).then((()=>(this._forEachPrimitive(I,(V=>{const I=V;!I.isAnInstance&&I.wF&&I.wF.useBoundingInfoFromGeometry?V.rV():V.refreshBoundingInfo(!0,!0)})),I._babylonTransformNode)))}_loadMeshAsync(V,I,m,C){const l=m.primitives;if(!l||!l.length)throw new Error(`${V}: Primitives are missing`);void 0==l[0].index&&u.Assign(l);const s=new Array;this.logOpen(`${V} ${m.name||""}`);const F=I.name||`node${I.index}`;if(1===l.length){const C=m.primitives[0];s.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${C.index}`,F,I,m,C,(V=>{I._babylonTransformNode=V,I._primitiveBabylonMeshes=[V]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,I._babylonTransformNode=new x.c(F,this._babylonScene),I._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._primitiveBabylonMeshes=[];for(const C of l)s.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${C.index}`,`${F}_primitive${C.index}`,I,m,C,(V=>{V.parent=I._babylonTransformNode,I._primitiveBabylonMeshes.push(V)})))}return C(I._babylonTransformNode),this.logClose(),Promise.all(s).then((()=>I._babylonTransformNode))}_loadMeshPrimitiveAsync(V,I,m,C,l,s){const F=this._extensionsLoadMeshPrimitiveAsync(V,I,m,C,l,s);if(F)return F;this.logOpen(`${V}`);const k=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==m.skin&&!C.primitives[0].targets;let j,E;if(k&&l._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,j=l._instanceData.babylonSourceMesh.createInstance(I),j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E=l._instanceData.promise;else{const s=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new y.c(I,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.sideOrientation=this._babylonScene.useRightHandedSystem?b.d.CounterClockWiseSideOrientation:b.d.ClockWiseSideOrientation,this._createMorphTargets(V,m,C,l,F),s.push(this._loadVertexDataAsync(V,l,F).then((async I=>await this._loadMorphTargetsAsync(V,l,F,I).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,I.QV(F),I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const K=p._GetDrawMode(V,l.mode);if(void 0==l.material){let V=this._defaultBabylonMaterialData[K];V||(V=this._createDefaultMaterial("__GLTFLoader._default",K),this._parent.onMaterialLoadedObservable.notifyObservers(V),this._defaultBabylonMaterialData[K]=V),F.material=V}else if(!this.parent.skipMaterials){const I=u.Get(`${V}/material`,this._gltf.materials,l.material);s.push(this._loadMaterialAsync(`/materials/${I.index}`,I,F,K,(V=>{F.material=V})))}E=Promise.all(s),k&&(l._instanceData={babylonSourceMesh:F,promise:E}),j=F}return p.AddPointerMetadata(j,V),this._parent.onMeshLoadedObservable.notifyObservers(j),s(j),this.logClose(),E.then((()=>j))}_loadVertexDataAsync(V,I,m){const C=this._extensionsLoadVertexDataAsync(V,I,m);if(C)return C;const l=I.attributes;if(!l)throw new Error(`${V}: Attributes are missing`);const s=new Array,F=new c.e(m.name,this._babylonScene);if(void 0==I.indices)m.isUnIndexed=!0;else{const m=u.Get(`${V}/indices`,this._gltf.accessors,I.indices);s.push(this._loadIndicesAccessorAsync(`/accessors/${m.index}`,m).then((V=>{F.setIndices(V)})))}const k=(I,C,k)=>{if(void 0==l[I])return;m._delayInfo=m._delayInfo||[],-1===m._delayInfo.indexOf(C)&&m._delayInfo.push(C);const j=u.Get(`${V}/attributes/${I}`,this._gltf.accessors,l[I]);s.push(this._loadVertexAccessorAsync(`/accessors/${j.index}`,j,C).then((V=>{if(V.getKind()===S.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!m.skeleton){const V=o(j);V&&(F._boundingInfo=V,F.useBoundingInfoFromGeometry=!0)}F.setVerticesBuffer(V,j.count)}))),C==S.e.MatricesIndicesExtraKind&&(m.numBoneInfluencers=8),k&&k(j)};return k("POSITION",S.e.PositionKind),k("NORMAL",S.e.NormalKind),k("TANGENT",S.e.TangentKind),k("TEXCOORD_0",S.e.UVKind),k("TEXCOORD_1",S.e.UV2Kind),k("TEXCOORD_2",S.e.UV3Kind),k("TEXCOORD_3",S.e.UV4Kind),k("TEXCOORD_4",S.e.UV5Kind),k("TEXCOORD_5",S.e.UV6Kind),k("JOINTS_0",S.e.MatricesIndicesKind),k("WEIGHTS_0",S.e.MatricesWeightsKind),k("JOINTS_1",S.e.MatricesIndicesExtraKind),k("WEIGHTS_1",S.e.MatricesWeightsExtraKind),k("COLOR_0",S.e.ColorKind,(V=>{"VEC4"===V.type&&(m.hasVertexAlpha=!0)})),Promise.all(s).then((()=>F))}_createMorphTargets(V,I,m,C,l){if(!C.targets||!this._parent.loadMorphTargets)return;if(void 0==I._numMorphTargets)I._numMorphTargets=C.targets.length;else if(C.targets.length!==I._numMorphTargets)throw new Error(`${V}: Primitives do not have the same number of targets`);const s=m.extras?m.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,l.morphTargetManager=new W(this._babylonScene),l.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.morphTargetManager.areUpdatesFrozen=!0;for(let F=0;F<C.targets.length;F++){const V=I.weights?I.weights[F]:m.weights?m.weights[F]:0,C=s?s[F]:`morphTarget${F}`;l.morphTargetManager.addTarget(new z.e(C,V,l.cV()))}}_loadMorphTargetsAsync(V,I,m,C){if(!I.targets||!this._parent.loadMorphTargets)return Promise.resolve();const l=new Array,s=m.morphTargetManager;for(let F=0;F<s.numTargets;F++){const m=s.getTarget(F);l.push(this._loadMorphTargetVertexDataAsync(`${V}/targets/${F}`,C,I.targets[F],m))}return Promise.all(l).then((()=>{s.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(V,I,m,C){const l=new Array,s=(C,s,F)=>{if(void 0==m[C])return;const k=I.getVertexBuffer(s);if(!k)return;const j=u.Get(`${V}/${C}`,this._gltf.accessors,m[C]);l.push(this._loadFloatAccessorAsync(`/accessors/${j.index}`,j).then((V=>{F(k,V)})))};return s("POSITION",S.e.PositionKind,((V,I)=>{const m=new Float32Array(I.length);V.forEach(I.length,((V,C)=>{m[C]=I[C]+V})),C.setPositions(m)})),s("NORMAL",S.e.NormalKind,((V,I)=>{const m=new Float32Array(I.length);V.forEach(m.length,((V,C)=>{m[C]=I[C]+V})),C.setNormals(m)})),s("TANGENT",S.e.TangentKind,((V,I)=>{const m=new Float32Array(I.length/3*4);let l=0;V.forEach(I.length/3*4,((V,C)=>{(C+1)%4!==0&&(m[l]=I[l]+V,l++)})),C.setTangents(m)})),s("TEXCOORD_0",S.e.UVKind,((V,I)=>{const m=new Float32Array(I.length);V.forEach(I.length,((V,C)=>{m[C]=I[C]+V})),C.setUVs(m)})),s("TEXCOORD_1",S.e.UV2Kind,((V,I)=>{const m=new Float32Array(I.length);V.forEach(I.length,((V,C)=>{m[C]=I[C]+V})),C.setUV2s(m)})),s("COLOR_0",S.e.ColorKind,((I,m)=>{let l=null;const s=I.getSize();if(3===s){l=new Float32Array(m.length/3*4),I.forEach(m.length,((V,I)=>{const C=Math.floor(I/3),s=I%3;l[4*C+s]=m[3*C+s]+V}));for(let V=0;V<m.length/3;++V)l[4*V+3]=1}else{if(4!==s)throw new Error(`${V}: Invalid number of components (${s}) for COLOR_0 attribute`);l=new Float32Array(m.length),I.forEach(m.length,((V,I)=>{l[I]=m[I]+V}))}C.setColors(l)})),await Promise.all(l).then((()=>{}))}static _LoadTransform(V,I){if(void 0!=V.skin)return;let m=l.m.Zero(),C=l.e.Identity(),s=l.m.One();if(V.matrix){l.b.Ik(V.matrix).decompose(s,C,m)}else V.translation&&(m=l.m.Ik(V.translation)),V.rotation&&(C=l.e.Ik(V.rotation)),V.scale&&(s=l.m.Ik(V.scale));I.position=m,I.rotationQuaternion=C,I.Vk=s}_loadSkinAsync(V,I,m,C){if(!this._parent.loadSkins)return Promise.resolve();const l=this._extensionsLoadSkinAsync(V,I,m);if(l)return l;if(m._data)return C(m._data.babylonSkeleton),m._data.promise;const s=`skeleton${m.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new D(m.name||s,s,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(V,m,F);const k=this._loadSkinInverseBindMatricesDataAsync(V,m).then((V=>{this._updateBoneMatrices(F,V)}));return m._data={babylonSkeleton:F,promise:k},C(F),k}_loadBones(V,I,m){if(void 0==I.skeleton||this._parent.alwaysComputeSkeletonRootNode){const m=this._findSkeletonRootNode(`${V}/joints`,I.joints);if(m)if(void 0===I.skeleton)I.skeleton=m.index;else{const C=(V,I)=>{for(;I.parent;I=I.parent)if(I.parent===V)return!0;return!1},l=u.Get(`${V}/skeleton`,this._gltf.nodes,I.skeleton);l===m||C(l,m)||(N.d.Warn(`${V}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),I.skeleton=m.index)}else N.d.Warn(`${V}: Failed to find common root`)}const C={};for(const l of I.joints){const s=u.Get(`${V}/joints/${l}`,this._gltf.nodes,l);this._loadBone(s,I,m,C)}}_findSkeletonRootNode(V,I){if(0===I.length)return null;const m={};for(const l of I){const I=[];let C=u.Get(`${V}/${l}`,this._gltf.nodes,l);for(;-1!==C.index;)I.unshift(C),C=C.parent;m[l]=I}let C=null;for(let l=0;;++l){let V=m[I[0]];if(l>=V.length)return C;const s=V[l];for(let F=1;F<I.length;++F)if(V=m[I[F]],l>=V.length||s!==V[l])return C;C=s}}_loadBone(V,I,m,C){V._isJoint=!0;let l=C[V.index];if(l)return l;let s=null;V.index!==I.skeleton&&(V.parent&&-1!==V.parent.index?s=this._loadBone(V.parent,I,m,C):void 0!==I.skeleton&&N.d.Warn(`/skins/${I.index}/skeleton: Skeleton node is not a common root`));const F=I.joints.indexOf(V.index);return l=new E.b(V.name||`joint${V.index}`,m,s,this._getNodeMatrix(V),null,null,F),C[V.index]=l,this._postSceneLoadActions.push((()=>{l.linkTransformNode(V._babylonTransformNode)})),l}_loadSkinInverseBindMatricesDataAsync(V,I){if(void 0==I.inverseBindMatrices)return Promise.resolve(null);const m=u.Get(`${V}/inverseBindMatrices`,this._gltf.accessors,I.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${m.index}`,m)}_updateBoneMatrices(V,I){for(const m of V.bones){const V=l.b.Identity(),C=m._index;I&&-1!==C&&(l.b.FromArrayToRef(I,16*C,V),V.invertToRef(V));const s=m.getParent();s&&V.multiplyToRef(s.getAbsoluteInverseBindMatrix(),V),m.lk(V,!1,!1),m._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(V){return V.matrix?l.b.Ik(V.matrix):l.b.Compose(V.scale?l.m.Ik(V.scale):l.m.One(),V.rotation?l.e.Ik(V.rotation):l.e.Identity(),V.translation?l.m.Ik(V.translation):l.m.Zero())}loadCameraAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadCameraAsync(V,I,m);if(C)return C;const s=new Array;this.logOpen(`${V} ${I.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new j.b(I.name||`camera${I.index}`,l.m.Zero(),this._babylonScene,!1);switch(F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonCamera=F,F.setTarget(new l.m(0,0,-1)),I.type){case"perspective":{const m=I.perspective;if(!m)throw new Error(`${V}: Camera perspective properties are missing`);F.fov=m.yfov,F.Fk=m.znear,F.maxZ=m.zfar||0;break}case"orthographic":if(!I.orthographic)throw new Error(`${V}: Camera orthographic properties are missing`);F.mode=k.c.ORTHOGRAPHIC_CAMERA,F.orthoLeft=-I.orthographic.xmag,F.orthoRight=I.orthographic.xmag,F.orthoBottom=-I.orthographic.ymag,F.orthoTop=I.orthographic.ymag,F.Fk=I.orthographic.znear,F.maxZ=I.orthographic.zfar;break;default:throw new Error(`${V}: Invalid camera type (${I.type})`)}return p.AddPointerMetadata(F,V),this._parent.onCameraLoadedObservable.notifyObservers(F),m(F),this.logClose(),Promise.all(s).then((()=>F))}_loadAnimationsAsync(){const V=this._gltf.animations;if(!V)return Promise.resolve();const I=new Array;for(let m=0;m<V.length;m++){const C=V[m];I.push(this.loadAnimationAsync(`/animations/${C.index}`,C).then((V=>{0===V.targetedAnimations.length&&V.dispose()})))}return Promise.all(I).then((()=>{}))}loadAnimationAsync(V,I){const C=this._extensionsLoadAnimationAsync(V,I);return C||m.e(58).then(m.bind(m,14376)).then((m=>{let{AnimationGroup:C}=m;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new C(I.name||`animation${I.index}`,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonAnimationGroup=l;const s=new Array;u.Assign(I.channels),u.Assign(I.samplers);for(const F of I.channels)s.push(this._loadAnimationChannelAsync(`${V}/channels/${F.index}`,V,I,F,((V,I)=>{V.animations=V.animations||[],V.animations.push(I),l.addTargetedAnimation(I,V)})));return Promise.all(s).then((()=>(l.normalize(0),l)))}))}async _loadAnimationChannelAsync(V,I,C,l,s){const F=this._extensionsLoadAnimationChannelAsync(V,I,C,l,s);if(F)return await F;if(void 0==l.target.node)return await Promise.resolve();const k=u.Get(`${V}/target/node`,this._gltf.nodes,l.target.node),j=l.target.path,E="weights"===j;if(E&&!k._numMorphTargets||!E&&!k._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!E&&!k._isJoint)return await Promise.resolve();let K;switch(await Promise.resolve().then(m.bind(m,12853)),j){case"translation":var Y;K=null===(Y=(0,i.c)("/nodes/{}/translation"))||void 0===Y?void 0:Y.interpolation;break;case"rotation":var X;K=null===(X=(0,i.c)("/nodes/{}/rotation"))||void 0===X?void 0:X.interpolation;break;case"scale":var O;K=null===(O=(0,i.c)("/nodes/{}/scale"))||void 0===O?void 0:O.interpolation;break;case"weights":var v;K=null===(v=(0,i.c)("/nodes/{}/weights"))||void 0===v?void 0:v.interpolation;break;default:throw new Error(`${V}/target/path: Invalid value (${l.target.path})`)}if(!K)throw new Error(`${V}/target/path: Could not find interpolation properties for target path (${l.target.path})`);const N={object:k,info:K};return await this._loadAnimationChannelFromTargetInfoAsync(V,I,C,l,N,s)}_loadAnimationChannelFromTargetInfoAsync(V,I,m,C,l,s){const F=this.parent.targetFps,k=1/F,j=u.Get(`${V}/sampler`,m.samplers,C.sampler);return this._loadAnimationSamplerAsync(`${I}/samplers/${C.sampler}`,j).then((V=>{let I=0;const j=l.object,E=l.info;for(const l of E){const E=l.getStride(j),K=V.input,Y=V.output,X=new Array(K.length);let O=0;switch(V.interpolation){case"STEP":for(let V=0;V<K.length;V++){const I=l.getValue(j,Y,O,1);O+=E,X[V]={frame:K[V]*F,value:I,interpolation:1}}break;case"CUBICSPLINE":for(let V=0;V<K.length;V++){const I=l.getValue(j,Y,O,k);O+=E;const m=l.getValue(j,Y,O,1);O+=E;const C=l.getValue(j,Y,O,k);O+=E,X[V]={frame:K[V]*F,inTangent:I,value:m,outTangent:C}}break;case"LINEAR":for(let V=0;V<K.length;V++){const I=l.getValue(j,Y,O,1);O+=E,X[V]={frame:K[V]*F,value:I}}}if(O>0){const V=`${m.name||`animation${m.index}`}_channel${C.index}_${I}`,k=l.buildAnimations(j,V,F,X);for(const m of k)I++,s(m.babylonAnimatable,m.babylonAnimation)}}}))}_loadAnimationSamplerAsync(V,I){if(I._data)return I._data;const m=I.interpolation||"LINEAR";switch(m){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${V}/interpolation: Invalid value (${I.interpolation})`)}const C=u.Get(`${V}/input`,this._gltf.accessors,I.input),l=u.Get(`${V}/output`,this._gltf.accessors,I.output);return I._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${C.index}`,C),this._loadFloatAccessorAsync(`/accessors/${l.index}`,l)]).then((V=>{let[I,C]=V;return{input:I,interpolation:m,output:C}})),I._data}loadBufferAsync(V,I,m,C){const l=this._extensionsLoadBufferAsync(V,I,m,C);if(l)return l;if(!I._data)if(I.uri)I._data=this.loadUriAsync(`${V}/uri`,I,I.uri);else{if(!this._bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);I._data=this._bin.readAsync(0,I.byteLength)}return I._data.then((I=>{try{return new Uint8Array(I.buffer,I.byteOffset+m,C)}catch(l){throw new Error(`${V}: ${l.message}`)}}))}loadBufferViewAsync(V,I){const m=this._extensionsLoadBufferViewAsync(V,I);if(m)return m;if(I._data)return I._data;const C=u.Get(`${V}/buffer`,this._gltf.buffers,I.buffer);return I._data=this.loadBufferAsync(`/buffers/${C.index}`,C,I.byteOffset||0,I.byteLength),I._data}_loadAccessorAsync(V,I,m){if(I._data)return I._data;const C=p._GetNumComponents(V,I.type),l=C*S.e.GetTypeByteLength(I.componentType),s=C*I.count;if(void 0==I.bufferView)I._data=Promise.resolve(new m(s));else{const F=u.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((k=>{if(5126!==I.componentType||I.normalized||F.byteStride&&F.byteStride!==l){const V=new m(s);return S.e.ForEach(k,I.byteOffset||0,F.byteStride||l,C,I.componentType,V.length,I.normalized||!1,((I,m)=>{V[m]=I})),V}return p._GetTypedArray(V,I.componentType,k,I.byteOffset,s)}))}if(I.sparse){const s=I.sparse;I._data=I._data.then((F=>{const k=F,j=u.Get(`${V}/sparse/indices/bufferView`,this._gltf.bufferViews,s.indices.bufferView),E=u.Get(`${V}/sparse/values/bufferView`,this._gltf.bufferViews,s.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${j.index}`,j),this.loadBufferViewAsync(`/bufferViews/${E.index}`,E)]).then((F=>{let[j,E]=F;const K=p._GetTypedArray(`${V}/sparse/indices`,s.indices.componentType,j,s.indices.byteOffset,s.count),Y=C*s.count;let X;if(5126!==I.componentType||I.normalized){const F=p._GetTypedArray(`${V}/sparse/values`,I.componentType,E,s.values.byteOffset,Y);X=new m(Y),S.e.ForEach(F,0,l,C,I.componentType,X.length,I.normalized||!1,((V,I)=>{X[I]=V}))}else X=p._GetTypedArray(`${V}/sparse/values`,I.componentType,E,s.values.byteOffset,Y);let O=0;for(let V=0;V<K.length;V++){let I=K[V]*C;for(let V=0;V<C;V++)k[I++]=X[O++]}return k}))}))}return I._data}_loadFloatAccessorAsync(V,I){return this._loadAccessorAsync(V,I,Float32Array)}_loadIndicesAccessorAsync(V,I){if("SCALAR"!==I.type)throw new Error(`${V}/type: Invalid value ${I.type}`);if(5121!==I.componentType&&5123!==I.componentType&&5125!==I.componentType)throw new Error(`${V}/componentType: Invalid value ${I.componentType}`);if(I._data)return I._data;if(I.sparse){const m=p._GetTypedArrayConstructor(`${V}/componentType`,I.componentType);I._data=this._loadAccessorAsync(V,I,m)}else{const m=u.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((m=>p._GetTypedArray(V,I.componentType,m,I.byteOffset,I.count)))}return I._data}_loadVertexBufferViewAsync(V){if(V._babylonBuffer)return V._babylonBuffer;const I=this._babylonScene.getEngine();return V._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>new S.c(I,V,!1))),V._babylonBuffer}_loadVertexAccessorAsync(V,I,m){var C;if(null!==(C=I._babylonVertexBuffer)&&void 0!==C&&C[m])return I._babylonVertexBuffer[m];I._babylonVertexBuffer||(I._babylonVertexBuffer={});const l=this._babylonScene.getEngine();if(I.sparse||void 0==I.bufferView)I._babylonVertexBuffer[m]=this._loadFloatAccessorAsync(V,I).then((V=>new S.e(l,V,m,!1)));else{const C=u.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._babylonVertexBuffer[m]=this._loadVertexBufferViewAsync(C).then((s=>{const F=p._GetNumComponents(V,I.type);return new S.e(l,s,m,!1,void 0,C.byteStride,void 0,I.byteOffset,F,I.componentType,I.normalized,!0,void 0,!0)}))}return I._babylonVertexBuffer[m]}_loadMaterialMetallicRoughnessPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return I&&(I.baseColorFactor?(m.albedoColor=s.c.Ik(I.baseColorFactor),m.alpha=I.baseColorFactor[3]):m.albedoColor=s.c.White(),m.metallic=void 0==I.metallicFactor?1:I.metallicFactor,m.roughness=void 0==I.roughnessFactor?1:I.roughnessFactor,I.baseColorTexture&&C.push(this.loadTextureInfoAsync(`${V}/baseColorTexture`,I.baseColorTexture,(V=>{V.name=`${m.name} (Base Color)`,m.albedoTexture=V}))),I.metallicRoughnessTexture&&(I.metallicRoughnessTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${V}/metallicRoughnessTexture`,I.metallicRoughnessTexture,(V=>{V.name=`${m.name} (Metallic Roughness)`,m.metallicTexture=V}))),m.useMetallnessFromMetallicTextureBlue=!0,m.useRoughnessFromMetallicTextureGreen=!0,m.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(C).then((()=>{}))}_loadMaterialAsync(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const s=this._extensionsLoadMaterialAsync(V,I,m,C,l);if(s)return s;I._data=I._data||{};let F=I._data[C];if(!F){this.logOpen(`${V} ${I.name||""}`);const m=this.createMaterial(V,I,C);F={babylonMaterial:m,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(V,I,m)},I._data[C]=F,p.AddPointerMetadata(m,V),this._parent.onMaterialLoadedObservable.notifyObservers(m),this.logClose()}return m&&(F.babylonMeshes.push(m),m.Ck.addOnce((()=>{const V=F.babylonMeshes.indexOf(m);-1!==V&&F.babylonMeshes.splice(V,1)}))),l(F.babylonMaterial),F.promise.then((()=>F.babylonMaterial))}_createDefaultMaterial(V,I){this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new T.c(V,this._babylonScene);return m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.fillMode=I,m.enableSpecularAntiAliasing=!0,m.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,m.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,m.transparencyMode=T.c.PBRMATERIAL_OPAQUE,m.metallic=1,m.roughness=1,m}createMaterial(V,I,m){const C=this._extensionsCreateMaterial(V,I,m);if(C)return C;const l=I.name||`material${I.index}`;return this._createDefaultMaterial(l,m)}loadMaterialPropertiesAsync(V,I,m){const C=this._extensionsLoadMaterialPropertiesAsync(V,I,m);if(C)return C;const l=new Array;return l.push(this.loadMaterialBasePropertiesAsync(V,I,m)),I.pbrMetallicRoughness&&l.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${V}/pbrMetallicRoughness`,I.pbrMetallicRoughness,m)),this.loadMaterialAlphaProperties(V,I,m),Promise.all(l).then((()=>{}))}loadMaterialBasePropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return m.emissiveColor=I.emissiveFactor?s.c.Ik(I.emissiveFactor):new s.c(0,0,0),I.doubleSided&&(m.JF=!1,m.twoSidedLighting=!0),I.normalTexture&&(I.normalTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${V}/normalTexture`,I.normalTexture,(V=>{V.name=`${m.name} (Normal)`,m.bumpTexture=V}))),m.invertNormalMapX=!this._babylonScene.useRightHandedSystem,m.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=I.normalTexture.scale&&m.bumpTexture&&(m.bumpTexture.level=I.normalTexture.scale),m.forceIrradianceInFragment=!0),I.occlusionTexture&&(I.occlusionTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${V}/occlusionTexture`,I.occlusionTexture,(V=>{V.name=`${m.name} (Occlusion)`,m.ambientTexture=V}))),m.useAmbientInGrayScale=!0,void 0!=I.occlusionTexture.strength&&(m.ambientTextureStrength=I.occlusionTexture.strength)),I.emissiveTexture&&C.push(this.loadTextureInfoAsync(`${V}/emissiveTexture`,I.emissiveTexture,(V=>{V.name=`${m.name} (Emissive)`,m.emissiveTexture=V}))),Promise.all(C).then((()=>{}))}loadMaterialAlphaProperties(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);switch(I.alphaMode||"OPAQUE"){case"OPAQUE":m.transparencyMode=T.c.PBRMATERIAL_OPAQUE,m.alpha=1;break;case"MASK":m.transparencyMode=T.c.PBRMATERIAL_ALPHATEST,m.alphaCutOff=void 0==I.alphaCutoff?.5:I.alphaCutoff,m.albedoTexture&&(m.albedoTexture.eF=!0);break;case"BLEND":m.transparencyMode=T.c.PBRMATERIAL_ALPHABLEND,m.albedoTexture&&(m.albedoTexture.eF=!0,m.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${V}/alphaMode: Invalid value (${I.alphaMode})`)}}loadTextureInfoAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureInfoAsync(V,I,m);if(C)return C;if(this.logOpen(`${V}`),I.texCoord>=6)throw new Error(`${V}/texCoord: Invalid value (${I.texCoord})`);const l=u.Get(`${V}/index`,this._gltf.textures,I.index);l._textureInfo=I;const s=this._loadTextureAsync(`/textures/${I.index}`,l,(C=>{C.coordinatesIndex=I.texCoord||0,p.AddPointerMetadata(C,V),this._parent.onTextureLoadedObservable.notifyObservers(C),m(C)}));return this.logClose(),s}_loadTextureAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureAsync(V,I,m);if(C)return C;this.logOpen(`${V} ${I.name||""}`);const l=void 0==I.sampler?p.DefaultSampler:u.Get(`${V}/sampler`,this._gltf.samplers,I.sampler),s=u.Get(`${V}/source`,this._gltf.images,I.source),F=this._createTextureAsync(V,l,s,m,void 0,!I._textureInfo.nonColorData);return this.logClose(),F}_createTextureAsync(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},s=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0;const k=this._loadSampler(`/samplers/${I.index}`,I),j=new Array,E=new C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K={noMipmap:k.noMipMaps,invertY:!1,samplingMode:k.samplingMode,J:()=>{this._disposed||E.resolve()},onError:(I,m)=>{this._disposed||E.reject(new Error(`${V}: ${m&&m.message?m.message:I||"Failed to load texture"}`))},mimeType:m.mimeType??(0,G.j)(m.uri??""),loaderOptions:s,useSRGBBuffer:!!F&&this._parent.useSRGBBuffers},Y=new n.e(null,this._babylonScene,K);return Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.push(E.promise),j.push(this.loadImageAsync(`/images/${m.index}`,m).then((V=>{const I=m.uri||`${this._fileName}#image${m.index}`,C=`data:${this._uniqueRootUrl}${I}`;Y.updateURL(C,V);const l=Y.getInternalTexture();l&&(l.label=m.name)}))),Y.wrapU=k.wrapU,Y.wrapV=k.wrapV,l(Y),this._parent.useGltfTextureNames&&(Y.name=m.name||m.uri||`image${m.index}`),Promise.all(j).then((()=>Y))}_loadSampler(V,I){return I._data||(I._data={noMipMaps:9728===I.minFilter||9729===I.minFilter,samplingMode:p._GetTextureSamplingMode(V,I),wrapU:p._GetTextureWrapMode(`${V}/wrapS`,I.wrapS),wrapV:p._GetTextureWrapMode(`${V}/wrapT`,I.wrapT)}),I._data}loadImageAsync(V,I){if(!I._data){if(this.logOpen(`${V} ${I.name||""}`),I.uri)I._data=this.loadUriAsync(`${V}/uri`,I,I.uri);else{const m=u.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m)}this.logClose()}return I._data}loadUriAsync(V,I,m){const C=this._extensionsLoadUriAsync(V,I,m);if(C)return C;if(!p._ValidateUri(m))throw new Error(`${V}: '${m}' is invalid`);if((0,G.l)(m)){const I=new Uint8Array((0,G.b)(m));return this.log(`${V}: Decoded ${m.substring(0,64)}... (${I.length} bytes)`),Promise.resolve(I)}return this.log(`${V}: Loading ${m}`),this._parent.preprocessUrlAsync(this._rootUrl+m).then((I=>new Promise(((C,l)=>{this._parent._loadFile(this._babylonScene,I,(I=>{this._disposed||(this.log(`${V}: Loaded ${m} (${I.byteLength} bytes)`),C(new Uint8Array(I)))}),!0,(I=>{l(new G.o(`${V}: Failed to load '${m}'${I?": "+I.status+" "+I.statusText:""}`,I))}))}))))}static AddPointerMetadata(V,I){V.metadata=V.metadata||{};const m=V._internalMetadata=V._internalMetadata||{},C=m.sk=m.sk||{};(C.pointers=C.pointers||[]).push(I)}static _GetTextureWrapMode(V,I){switch(I=void 0==I?10497:I){case 33071:return n.e.CLAMP_ADDRESSMODE;case 33648:return n.e.MIRROR_ADDRESSMODE;case 10497:return n.e.WRAP_ADDRESSMODE;default:return N.d.Warn(`${V}: Invalid value (${I})`),n.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(V,I){const m=void 0==I.magFilter?9729:I.magFilter,C=void 0==I.minFilter?9987:I.minFilter;if(9729===m)switch(C){case 9728:return n.e.LINEAR_NEAREST;case 9729:return n.e.LINEAR_LINEAR;case 9984:return n.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return n.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return n.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return n.e.LINEAR_LINEAR_MIPLINEAR;default:return N.d.Warn(`${V}/minFilter: Invalid value (${C})`),n.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==m&&N.d.Warn(`${V}/magFilter: Invalid value (${m})`),C){case 9728:return n.e.NEAREST_NEAREST;case 9729:return n.e.NEAREST_LINEAR;case 9984:return n.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return n.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return n.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return n.e.NEAREST_LINEAR_MIPLINEAR;default:return N.d.Warn(`${V}/minFilter: Invalid value (${C})`),n.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(V,I){try{return(0,P.s)(I)}catch(m){throw new Error(`${V}: ${m.message}`)}}static _GetTypedArray(V,I,m,C,l){const s=m.buffer;C=m.byteOffset+(C||0);const F=p._GetTypedArrayConstructor(`${V}/componentType`,I),k=S.e.GetTypeByteLength(I);return C%k!==0?(N.d.Warn(`${V}: Copying buffer as byte offset (${C}) is not a multiple of component type byte length (${k})`),new F(s.slice(C,C+l*k),0)):new F(s,C,l)}static _GetNumComponents(V,I){switch(I){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${V}: Invalid type (${I})`)}static _ValidateUri(V){return F.d.IsBase64(V)||-1===V.indexOf("..")}static _GetDrawMode(V,I){switch(void 0==I&&(I=4),I){case 0:return b.d.PointListDrawMode;case 1:return b.d.LineListDrawMode;case 2:return b.d.LineLoopDrawMode;case 3:return b.d.LineStripDrawMode;case 4:return b.d.TriangleFillMode;case 5:return b.d.TriangleStripDrawMode;case 6:return b.d.TriangleFanDrawMode}throw new Error(`${V}: Invalid mesh primitive mode (${I})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const V=new Array;if(this._gltf.materials)for(const I of this._gltf.materials)if(I._data)for(const m in I._data){const C=I._data[m];for(const I of C.babylonMeshes){I.fF(!0);const m=C.babylonMaterial;V.push(m.forceCompilationAsync(I)),V.push(m.forceCompilationAsync(I,{useInstances:!0})),this._parent.useClipPlane&&(V.push(m.forceCompilationAsync(I,{clipPlane:!0})),V.push(m.forceCompilationAsync(I,{clipPlane:!0,useInstances:!0})))}}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const V=new Array,I=this._babylonScene.lights;for(const m of I){const I=m.getShadowGenerator();I&&V.push(I.forceCompilationAsync())}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(V){for(const I of this._extensions)I.enabled&&V(I)}_applyExtensions(V,I,m){for(const C of this._extensions)if(C.enabled){const l=`${C.name}.${I}`,s=V;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};const F=s._activeLoaderExtensionFunctions;if(!F[l]){F[l]=!0;try{const V=m(C);if(V)return V}finally{delete F[l]}}}return null}_extensionsOnLoading(){this._forEachExtensions((V=>V.onLoading&&V.onLoading()))}_extensionsOnReady(){this._forEachExtensions((V=>V.onReady&&V.onReady()))}_extensionsLoadSceneAsync(V,I){return this._applyExtensions(I,"loadScene",(m=>m.loadSceneAsync&&m.loadSceneAsync(V,I)))}_extensionsLoadNodeAsync(V,I,m){return this._applyExtensions(I,"loadNode",(C=>C.loadNodeAsync&&C.loadNodeAsync(V,I,m)))}_extensionsLoadCameraAsync(V,I,m){return this._applyExtensions(I,"loadCamera",(C=>C.loadCameraAsync&&C.loadCameraAsync(V,I,m)))}_extensionsLoadVertexDataAsync(V,I,m){return this._applyExtensions(I,"loadVertexData",(C=>C._loadVertexDataAsync&&C._loadVertexDataAsync(V,I,m)))}_extensionsLoadMeshPrimitiveAsync(V,I,m,C,l,s){return this._applyExtensions(l,"loadMeshPrimitive",(F=>F._loadMeshPrimitiveAsync&&F._loadMeshPrimitiveAsync(V,I,m,C,l,s)))}_extensionsLoadMaterialAsync(V,I,m,C,l){return this._applyExtensions(I,"loadMaterial",(s=>s._loadMaterialAsync&&s._loadMaterialAsync(V,I,m,C,l)))}_extensionsCreateMaterial(V,I,m){return this._applyExtensions(I,"createMaterial",(C=>C.createMaterial&&C.createMaterial(V,I,m)))}_extensionsLoadMaterialPropertiesAsync(V,I,m){return this._applyExtensions(I,"loadMaterialProperties",(C=>C.loadMaterialPropertiesAsync&&C.loadMaterialPropertiesAsync(V,I,m)))}_extensionsLoadTextureInfoAsync(V,I,m){return this._applyExtensions(I,"loadTextureInfo",(C=>C.loadTextureInfoAsync&&C.loadTextureInfoAsync(V,I,m)))}_extensionsLoadTextureAsync(V,I,m){return this._applyExtensions(I,"loadTexture",(C=>C._loadTextureAsync&&C._loadTextureAsync(V,I,m)))}_extensionsLoadAnimationAsync(V,I){return this._applyExtensions(I,"loadAnimation",(m=>m.loadAnimationAsync&&m.loadAnimationAsync(V,I)))}_extensionsLoadAnimationChannelAsync(V,I,m,C,l){return this._applyExtensions(m,"loadAnimationChannel",(s=>s._loadAnimationChannelAsync&&s._loadAnimationChannelAsync(V,I,m,C,l)))}_extensionsLoadSkinAsync(V,I,m){return this._applyExtensions(m,"loadSkin",(C=>C._loadSkinAsync&&C._loadSkinAsync(V,I,m)))}_extensionsLoadUriAsync(V,I,m){return this._applyExtensions(I,"loadUri",(C=>C._loadUriAsync&&C._loadUriAsync(V,I,m)))}_extensionsLoadBufferViewAsync(V,I){return this._applyExtensions(I,"loadBufferView",(m=>m.loadBufferViewAsync&&m.loadBufferViewAsync(V,I)))}_extensionsLoadBufferAsync(V,I,m,C){return this._applyExtensions(I,"loadBuffer",(l=>l.loadBufferAsync&&l.loadBufferAsync(V,I,m,C)))}static LoadExtensionAsync(V,I,m,C){if(!I.extensions)return null;const l=I.extensions[m];return l?C(`${V}/extensions/${m}`,l):null}static LoadExtraAsync(V,I,m,C){if(!I.extras)return null;const l=I.extras[m];return l?C(`${V}/extras/${m}`,l):null}isExtensionUsed(V){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(V)}logOpen(V){this._parent._logOpen(V)}logClose(){this._parent._logClose()}log(V){this._parent._log(V)}startPerformanceCounter(V){this._parent._startPerformanceCounter(V)}endPerformanceCounter(V){this._parent._endPerformanceCounter(V)}}p.DefaultSampler={index:-1},Q.b._CreateGLTF2Loader=V=>new p(V);var M=m(12853),f=m(11488),w=m(11297),A=m(12861),J=m(12868);class U extends J.b{constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",V),this._texture=V.getEngine().createRawCubeTexture(I,m,C,l,s,F,k,j)}update(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,V,I,m,C,l)}updateRGBDAsync(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,A.l)(this._texture,V,I,m,C).then((()=>{}))}clone(){return w.d.Clone((()=>{const V=this.cV(),I=this._texture,m=new U(V,I._bufferViewArray,I.width,I.format,I.type,I.generateMipMaps,I.invertY,I.samplingMode,I._compression);return 13===I.source&&m.updateRGBDAsync(I._bufferViewArrayArray,I._sphericalPolynomial,I._lodGenerationScale,I._lodGenerationOffset),m}),this)}}const e="EXT_lights_image_based";class a{constructor(V){this.name=e,this._loader=V,this.enabled=this._loader.isExtensionUsed(e)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.sk.extensions;if(V&&V[this.name]){const I=V[this.name];this._lights=I.lights}}loadSceneAsync(V,I){return p.LoadExtensionAsync(V,I,this.name,(async(m,C)=>{this._loader._allMaterialsDirtyRequired=!0;const l=new Array;l.push(this._loader.loadSceneAsync(V,I)),this._loader.logOpen(`${m}`);const s=u.Get(`${m}/light`,this._lights,C.MF);return l.push(this._loadLightAsync(`/extensions/${this.name}/lights/${C.MF}`,s).then((V=>{this._loader.babylonScene.environmentTexture=V}))),this._loader.logClose(),await Promise.all(l).then((()=>{}))}))}_loadLightAsync(V,I){if(!I._loaded){const m=new Array;this._loader.logOpen(`${V}`);const C=new Array(I.specularImages.length);for(let l=0;l<I.specularImages.length;l++){const s=I.specularImages[l];C[l]=new Array(s.length);for(let I=0;I<s.length;I++){const F=`${V}/specularImages/${l}/${I}`;this._loader.logOpen(`${F}`);const k=s[I],j=u.Get(F,this._loader.sk.images,k);m.push(this._loader.loadImageAsync(`/images/${k}`,j).then((V=>{C[l][I]=V}))),this._loader.logClose()}}this._loader.logClose(),I._loaded=Promise.all(m).then((async()=>{const m=new U(this._loader.babylonScene,null,I.specularImageSize);if(m.name=I.name||"environment",I._babylonTexture=m,void 0!=I.Kk&&(m.level=I.Kk),I.rotation){let V=l.e.Ik(I.rotation);this._loader.babylonScene.useRightHandedSystem||(V=l.e.Inverse(V)),l.b.FromQuaternionToRef(V,m.getReflectionTextureMatrix())}if(!I.irradianceCoefficients)throw new Error(`${V}: Irradiance coefficients are missing`);const s=f.b.Ik(I.irradianceCoefficients);s.scaleInPlace(I.Kk),s.convertIrradianceToLambertianRadiance();const F=f.c.FromHarmonics(s),k=(C.length-1)/Math.log2(I.specularImageSize);return await m.updateRGBDAsync(C,F,k)}))}return I._loaded.then((()=>I._babylonTexture))}}R(e),d(e,!0,(V=>new a(V)));m(11744);const L="EXT_mesh_gpu_instancing";class VV{constructor(V){this.name=L,this._loader=V,this.enabled=this._loader.isExtensionUsed(L)}dispose(){this._loader=null}loadNodeAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(V,C)=>{this._loader._disableInstancedMesh++;const s=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,m);if(this._loader._disableInstancedMesh--,!I._primitiveBabylonMeshes)return await s;const F=new Array;let k=0;const j=I=>{if(void 0==C.attributes[I])return void F.push(Promise.resolve(null));const m=u.Get(`${V}/attributes/${I}`,this._loader.sk.accessors,C.attributes[I]);if(F.push(this._loader._loadFloatAccessorAsync(`/accessors/${m.bufferView}`,m)),0===k)k=m.count;else if(k!==m.count)throw new Error(`${V}/attributes: Instance buffer accessors do not have the same count.`)};return j("TRANSLATION"),j("ROTATION"),j("SCALE"),await s.then((async V=>{const[m,C,s]=await Promise.all(F),j=new Float32Array(16*k);l.g.LF[0].aF(0,0,0),l.g.Quaternion[0].aF(0,0,0,1),l.g.LF[1].aF(1,1,1);for(let I=0;I<k;++I)m&&l.m.FromArrayToRef(m,3*I,l.g.LF[0]),C&&l.e.FromArrayToRef(C,4*I,l.g.Quaternion[0]),s&&l.m.FromArrayToRef(s,3*I,l.g.LF[1]),l.b.ComposeToRef(l.g.LF[1],l.g.Quaternion[0],l.g.LF[0],l.g.Matrix[0]),l.g.Matrix[0].copyToArray(j,16*I);for(const l of I._primitiveBabylonMeshes)l.fK("matrix",j,16,!0);return V}))}))}}R(L),d(L,!0,(V=>new VV(V)));let IV=0,mV=null;class CV{static get Default(){return CV._Default||(CV._Default=new CV),CV._Default}constructor(){const V=CV.Configuration.decoder;this._decoderModulePromise=F.d.LoadBabylonScriptAsync(V.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(V,I,m,C,l){await this._decoderModulePromise,0===IV&&(MeshoptDecoder.useWorkers(1),IV=1);const s=await MeshoptDecoder.decodeGltfBufferAsync(I,m,V,C,l);return null!==mV&&clearTimeout(mV),mV=setTimeout((()=>{MeshoptDecoder.useWorkers(0),IV=0,mV=null}),1e3),s}}CV.Configuration={decoder:{url:`${F.d._DefaultCdnUrl}/meshopt_decoder.js`}},CV._Default=null;const lV="EXT_meshopt_compression";class sV{constructor(V){this.name=lV,this.enabled=V.isExtensionUsed(lV),this._loader=V}dispose(){this._loader=null}loadBufferViewAsync(V,I){return p.LoadExtensionAsync(V,I,this.name,(async(m,C)=>{const l=I;if(l._meshOptData)return await l._meshOptData;const s=u.Get(`${V}/buffer`,this._loader.sk.buffers,C.buffer);return l._meshOptData=this._loader.loadBufferAsync(`/buffers/${s.index}`,s,C.byteOffset||0,C.byteLength).then((async V=>await CV.Default.decodeGltfBufferAsync(V,C.count,C.byteStride,C.mode,C.filter))),await l._meshOptData}))}}R(lV),d(lV,!0,(V=>new sV(V)));const FV="EXT_texture_webp";class kV{constructor(V){this.name=FV,this._loader=V,this.enabled=V.isExtensionUsed(FV)}dispose(){this._loader=null}_loadTextureAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=void 0==I.sampler?p.DefaultSampler:u.Get(`${V}/sampler`,this._loader.sk.samplers,I.sampler),F=u.Get(`${C}/source`,this._loader.sk.images,l.source);return await this._loader._createTextureAsync(V,s,F,(V=>{m(V)}),void 0,!I._textureInfo.nonColorData)}))}}R(FV),d(FV,!0,(V=>new kV(V)));const jV="EXT_texture_avif";class EV{constructor(V){this.name=jV,this._loader=V,this.enabled=V.isExtensionUsed(jV)}dispose(){this._loader=null}_loadTextureAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=void 0==I.sampler?p.DefaultSampler:u.Get(`${V}/sampler`,this._loader.sk.samplers,I.sampler),F=u.Get(`${C}/source`,this._loader.sk.images,l.source);return await this._loader._createTextureAsync(V,s,F,(V=>{m(V)}),void 0,!I._textureInfo.nonColorData)}))}}R(jV),d(jV,!0,(V=>new EV(V)));var KV=m(12848),YV=m(11708);const XV="EXT_lights_ies";class OV{constructor(V){this.name=XV,this._loader=V,this.enabled=this._loader.isExtensionUsed(XV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.sk.extensions;if(V&&V[this.name]){const I=V[this.name];this._lights=I.lights,u.Assign(this._lights)}}loadNodeAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,F)=>{let k,j;this._loader._allMaterialsDirtyRequired=!0;const E=await this._loader.loadNodeAsync(V,I,(V=>{j=u.Get(C,this._lights,F.MF);const I=j.name||V.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,k=new KV.c(I,l.m.Zero(),l.m.Backward(),0,1,this._loader.babylonScene),k.angle=Math.PI/2,k.innerAngle=0,k._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,j._babylonLight=k,k.falloffType=YV.d.FALLOFF_GLTF,k.Yk=F.color?s.c.Ik(F.color):s.c.White(),k.Kk=F.multiplier||1,k.range=Number.MAX_VALUE,k.parent=V,this._loader._babylonLights.push(k),p.AddPointerMetadata(k,C),m(V)}));let K;if(j.uri)K=await this._loader.loadUriAsync(V,j,j.uri);else{const I=u.Get(`${V}/bufferView`,this._loader.sk.bufferViews,j.bufferView);K=await this._loader.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}return k.iesProfileTexture=new n.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,K,!0,void 0,void 0,void 0,void 0,".ies"),E}))}}R(XV),d(XV,!0,(V=>new OV(V)));var vV=m(12881);const NV="KHR_draco_mesh_compression";class tV{constructor(V){this.name=NV,this.useNormalizedFlagFromAccessor=!0,this._loader=V,this.enabled=vV.d.DefaultAvailable&&this._loader.isExtensionUsed(NV)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{if(void 0!=I.mode&&4!==I.mode&&5!==I.mode)throw new Error(`${V}: Unsupported mode ${I.mode}`);const s={},F={},k=(V,C)=>{const k=l.attributes[V];if(void 0!=k&&(m._delayInfo=m._delayInfo||[],-1===m._delayInfo.indexOf(C)&&m._delayInfo.push(C),s[C]=k,this.useNormalizedFlagFromAccessor)){const m=u.TryGet(this._loader.sk.accessors,I.attributes[V]);m&&(F[C]=m.normalized||!1)}};k("POSITION",S.e.PositionKind),k("NORMAL",S.e.NormalKind),k("TANGENT",S.e.TangentKind),k("TEXCOORD_0",S.e.UVKind),k("TEXCOORD_1",S.e.UV2Kind),k("TEXCOORD_2",S.e.UV3Kind),k("TEXCOORD_3",S.e.UV4Kind),k("TEXCOORD_4",S.e.UV5Kind),k("TEXCOORD_5",S.e.UV6Kind),k("JOINTS_0",S.e.MatricesIndicesKind),k("WEIGHTS_0",S.e.MatricesWeightsKind),k("COLOR_0",S.e.ColorKind);const j=u.Get(C,this._loader.sk.bufferViews,l.bufferView);return j._dracoBabylonGeometry||(j._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${j.index}`,j).then((async C=>{const l=this.dracoDecoder||vV.d.Default,k=u.TryGet(this._loader.sk.accessors,I.attributes.POSITION),j=this._loader.parent.alwaysComputeBoundingBox||m.skeleton||!k?null:o(k);return await l._decodeMeshToGeometryForGltfAsync(m.name,this._loader.babylonScene,C,s,F,j).catch((I=>{throw new Error(`${V}: ${I.message}`)}))}))),await j._dracoBabylonGeometry}))}}R(NV),d(NV,!0,(V=>new tV(V)));var DV=m(12887),bV=m(11206),TV=m(11214),nV=m(11337),xV=m(11776),SV=m(11048);nV.c.AddNodeConstructor("Light_Type_0",((V,I)=>()=>new cV(V,l.m.Zero(),I)));class cV extends xV.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(V){this._shadowAngle=V,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(V){const I=this.needCube();if(this._direction=V,this.needCube()!==I&&this._shadowGenerators){const V=this._shadowGenerators.values();for(let I=V.next();!0!==I.done;I=V.next()){I.value.recreateShadowMap()}}}constructor(V,I,m){super(V,m),this._shadowAngle=Math.PI/2,this.position=I}getClassName(){return"PointLight"}getTypeID(){return YV.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(V){if(this.direction)return super.getShadowDirection(V);switch(V){case 0:return new l.m(1,0,0);case 1:return new l.m(-1,0,0);case 2:return new l.m(0,-1,0);case 3:return new l.m(0,1,0);case 4:return new l.m(0,0,1);case 5:return new l.m(0,0,-1)}return l.m.Zero()}_setDefaultShadowProjectionMatrix(V,I,m){const C=this.cV().activeCamera;if(!C)return;const s=void 0!==this.shadowMinZ?this.shadowMinZ:C.Fk,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,k=this.cV().getEngine().useReverseDepthBuffer;l.b.PerspectiveFovLHToRef(this.shadowAngle,1,k?F:s,k?s:F,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,k)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,I){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,I):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,I),this}transferToNodeMaterialEffect(V,I){return this.computeTransformedInformation()?V.setFloat3(I,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):V.setFloat3(I,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(V,I){V["POINTLIGHT"+I]=!0}}(0,bV.d)([(0,TV.B)()],cV.prototype,"shadowAngle",null),(0,SV.h)("BABYLON.PointLight",cV);const HV="KHR_lights_punctual";class yV{constructor(V){this.name=HV,this._loader=V,this.enabled=this._loader.isExtensionUsed(HV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.sk.extensions;if(V&&V[this.name]){const I=V[this.name];this._lights=I.lights,u.Assign(this._lights)}}loadNodeAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,F)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(V,I,(V=>{let I;const k=u.Get(C,this._lights,F.MF),j=k.name||V.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,k.type){case"directional":{const V=new DV.e(j,l.m.Backward(),this._loader.babylonScene);V.position.mk(0),I=V;break}case"point":I=new cV(j,l.m.Zero(),this._loader.babylonScene);break;case"spot":{const V=new KV.c(j,l.m.Zero(),l.m.Backward(),0,1,this._loader.babylonScene);V.angle=2*(k.spot&&k.spot.outerConeAngle||Math.PI/4),V.innerAngle=2*(k.spot&&k.spot.innerConeAngle||0),I=V;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${C}: Invalid light type (${k.type})`)}I._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,k._babylonLight=I,I.falloffType=YV.d.FALLOFF_GLTF,I.Yk=k.color?s.c.Ik(k.color):s.c.White(),I.Kk=void 0==k.Kk?1:k.Kk,I.range=void 0==k.range?Number.MAX_VALUE:k.range,I.parent=V,this._loader._babylonLights.push(I),p.AddPointerMetadata(I,C),m(V)})))))}}R(HV),d(HV,!0,(V=>new yV(V)));const zV="KHR_materials_pbrSpecularGlossiness";class ZV{constructor(V){this.name=zV,this.order=200,this._loader=V,this.enabled=this._loader.isExtensionUsed(zV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(V,I,m)),s.push(this._loadSpecularGlossinessPropertiesAsync(C,l,m)),this._loader.loadMaterialAlphaProperties(V,I,m),await Promise.all(s).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return m.metallic=null,m.roughness=null,I.diffuseFactor?(m.albedoColor=s.c.Ik(I.diffuseFactor),m.alpha=I.diffuseFactor[3]):m.albedoColor=s.c.White(),m.reflectivityColor=I.specularFactor?s.c.Ik(I.specularFactor):s.c.White(),m.microSurface=void 0==I.glossinessFactor?1:I.glossinessFactor,I.diffuseTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTexture`,I.diffuseTexture,(V=>{V.name=`${m.name} (Diffuse)`,m.albedoTexture=V}))),I.specularGlossinessTexture&&(C.push(this._loader.loadTextureInfoAsync(`${V}/specularGlossinessTexture`,I.specularGlossinessTexture,(V=>{V.name=`${m.name} (Specular Glossiness)`,m.reflectivityTexture=V,m.reflectivityTexture.eF=!0}))),m.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(C).then((()=>{}))}}R(zV),d(zV,!0,(V=>new ZV(V)));const BV="KHR_materials_unlit";class WV{constructor(V){this.name=BV,this.order=210,this._loader=V,this.enabled=this._loader.isExtensionUsed(BV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async()=>await this._loadUnlitPropertiesAsync(V,I,m)))}_loadUnlitPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;m.unlit=!0;const l=I.pbrMetallicRoughness;return l&&(l.baseColorFactor?(m.albedoColor=s.c.Ik(l.baseColorFactor),m.alpha=l.baseColorFactor[3]):m.albedoColor=s.c.White(),l.baseColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/baseColorTexture`,l.baseColorTexture,(V=>{V.name=`${m.name} (Base Color)`,m.albedoTexture=V})))),I.doubleSided&&(m.JF=!1,m.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(V,I,m),Promise.all(C).then((()=>{}))}}R(BV),d(BV,!0,(V=>new WV(V)));const QV="KHR_materials_clearcoat";class GV{constructor(V){this.name=QV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(QV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadClearCoatPropertiesAsync(C,l,m)),await Promise.all(s)}))}_loadClearCoatPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return m.clearCoat.isEnabled=!0,m.clearCoat.useRoughnessFromMainTexture=!1,m.clearCoat.remapF0OnInterfaceChange=!1,void 0!=I.clearcoatFactor?m.clearCoat.Kk=I.clearcoatFactor:m.clearCoat.Kk=0,I.clearcoatTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatTexture`,I.clearcoatTexture,(V=>{V.name=`${m.name} (ClearCoat)`,m.clearCoat.texture=V}))),void 0!=I.clearcoatRoughnessFactor?m.clearCoat.roughness=I.clearcoatRoughnessFactor:m.clearCoat.roughness=0,I.clearcoatRoughnessTexture&&(I.clearcoatRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatRoughnessTexture`,I.clearcoatRoughnessTexture,(V=>{V.name=`${m.name} (ClearCoat Roughness)`,m.clearCoat.textureRoughness=V})))),I.clearcoatNormalTexture&&(I.clearcoatNormalTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatNormalTexture`,I.clearcoatNormalTexture,(V=>{V.name=`${m.name} (ClearCoat Normal)`,m.clearCoat.bumpTexture=V}))),m.invertNormalMapX=!m.cV().useRightHandedSystem,m.invertNormalMapY=m.cV().useRightHandedSystem,void 0!=I.clearcoatNormalTexture.scale&&(m.clearCoat.bumpTexture.level=I.clearcoatNormalTexture.scale)),Promise.all(C).then((()=>{}))}}R(QV),d(QV,!0,(V=>new GV(V)));const rV="KHR_materials_iridescence";class gV{constructor(V){this.name=rV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(rV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadIridescencePropertiesAsync(C,l,m)),await Promise.all(s).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return m.iridescence.isEnabled=!0,m.iridescence.Kk=I.iridescenceFactor??0,m.iridescence.indexOfRefraction=I.iridescenceIor??I.iridescenceIOR??1.3,m.iridescence.minimumThickness=I.iridescenceThicknessMinimum??100,m.iridescence.maximumThickness=I.iridescenceThicknessMaximum??400,I.iridescenceTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceTexture`,I.iridescenceTexture,(V=>{V.name=`${m.name} (Iridescence)`,m.iridescence.texture=V}))),I.iridescenceThicknessTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceThicknessTexture`,I.iridescenceThicknessTexture,(V=>{V.name=`${m.name} (Iridescence Thickness)`,m.iridescence.thicknessTexture=V}))),Promise.all(C).then((()=>{}))}}R(rV),d(rV,!0,(V=>new gV(V)));const hV="KHR_materials_anisotropy";class dV{constructor(V){this.name=hV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(hV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadIridescencePropertiesAsync(C,l,m)),await Promise.all(s)}))}async _loadIridescencePropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;m.anisotropy.isEnabled=!0,m.anisotropy.Kk=I.anisotropyStrength??0,m.anisotropy.angle=I.anisotropyRotation??0,I.anisotropyTexture&&(I.anisotropyTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${V}/anisotropyTexture`,I.anisotropyTexture,(V=>{V.name=`${m.name} (Anisotropy Intensity)`,m.anisotropy.texture=V})))),await Promise.all(C)}}R(hV),d(hV,!0,(V=>new dV(V)));const RV="KHR_materials_emissive_strength";class iV{constructor(V){this.name=RV,this.order=170,this._loader=V,this.enabled=this._loader.isExtensionUsed(RV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>await this._loader.loadMaterialPropertiesAsync(V,I,m).then((()=>{this._loadEmissiveProperties(C,l,m)}))))}_loadEmissiveProperties(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);void 0!==I.emissiveStrength&&(m.emissiveIntensity=I.emissiveStrength)}}R(RV),d(RV,!0,(V=>new iV(V)));const qV="KHR_materials_sheen";class PV{constructor(V){this.name=qV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(qV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadSheenPropertiesAsync(C,l,m)),await Promise.all(s).then((()=>{}))}))}_loadSheenPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return m.sheen.isEnabled=!0,m.sheen.Kk=1,void 0!=I.sheenColorFactor?m.sheen.color=s.c.Ik(I.sheenColorFactor):m.sheen.color=s.c.Black(),I.sheenColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/sheenColorTexture`,I.sheenColorTexture,(V=>{V.name=`${m.name} (Sheen Color)`,m.sheen.texture=V}))),void 0!==I.sheenRoughnessFactor?m.sheen.roughness=I.sheenRoughnessFactor:m.sheen.roughness=0,I.sheenRoughnessTexture&&(I.sheenRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${V}/sheenRoughnessTexture`,I.sheenRoughnessTexture,(V=>{V.name=`${m.name} (Sheen Roughness)`,m.sheen.textureRoughness=V})))),m.sheen.albedoScaling=!0,m.sheen.useRoughnessFromMainTexture=!1,Promise.all(C).then((()=>{}))}}R(qV),d(qV,!0,(V=>new PV(V)));var uV=m(11551);const oV="KHR_materials_specular";class pV{constructor(V){this.name=oV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(oV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;if(s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadSpecularPropertiesAsync(C,l,m)),l.extensions&&l.extensions.EXT_materials_specular_edge_color&&m instanceof T.c){l.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(m.brdf.dielectricSpecularModel=uV.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,m.brdf.conductorSpecularModel=uV.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(s).then((()=>{}))}))}_loadSpecularPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return void 0!==I.specularFactor&&(m.metallicF0Factor=I.specularFactor),void 0!==I.specularColorFactor&&(m.metallicReflectanceColor=s.c.Ik(I.specularColorFactor)),I.specularTexture&&(I.specularTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${V}/specularTexture`,I.specularTexture,(V=>{V.name=`${m.name} (Specular)`,m.metallicReflectanceTexture=V,m.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),I.specularColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/specularColorTexture`,I.specularColorTexture,(V=>{V.name=`${m.name} (Specular Color)`,m.reflectanceTexture=V}))),Promise.all(C).then((()=>{}))}}R(oV),d(oV,!0,(V=>new pV(V)));const MV="KHR_materials_ior";class fV{constructor(V){this.name=MV,this.order=180,this._loader=V,this.enabled=this._loader.isExtensionUsed(MV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadIorPropertiesAsync(C,l,m)),await Promise.all(s).then((()=>{}))}))}_loadIorPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);return void 0!==I.ior?m.indexOfRefraction=I.ior:m.indexOfRefraction=fV._DEFAULT_IOR,Promise.resolve()}}fV._DEFAULT_IOR=1.5,R(MV),d(MV,!0,(V=>new fV(V)));const wV="KHR_materials_variants";class AV{constructor(V){this.name=wV,this._loader=V,this.enabled=this._loader.isExtensionUsed(wV)}dispose(){this._loader=null}static GetAvailableVariants(V){const I=this._GetExtensionMetadata(V);return I?Object.keys(I.variants):[]}getAvailableVariants(V){return AV.GetAvailableVariants(V)}static SelectVariant(V,I){const m=this._GetExtensionMetadata(V);if(!m)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${wV} extension`);const C=V=>{const I=m.variants[V];if(I)for(const m of I)m.mesh.material=m.material};if(I instanceof Array)for(const l of I)C(l);else C(I);m.lastSelected=I}selectVariant(V,I){AV.SelectVariant(V,I)}static Reset(V){const I=this._GetExtensionMetadata(V);if(!I)throw new Error(`Cannot reset on a glTF mesh that does not have the ${wV} extension`);for(const m of I.original)m.mesh.material=m.material;I.lastSelected=null}reset(V){AV.Reset(V)}static GetLastSelectedVariant(V){const I=this._GetExtensionMetadata(V);if(!I)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${wV} extension`);return I.lastSelected}getLastSelectedVariant(V){return AV.GetLastSelectedVariant(V)}static _GetExtensionMetadata(V){var I,m;return(null===V||void 0===V||null===(I=V._internalMetadata)||void 0===I||null===(m=I.sk)||void 0===m?void 0:m[wV])||null}onLoading(){const V=this._loader.sk.extensions;if(V&&V[this.name]){const I=V[this.name];this._variants=I.variants}}onReady(){const V=this._loader.rootBabylonMesh;if(V){var I;const m=this._loader.parent.extensionOptions[wV];null!==m&&void 0!==m&&m.defaultVariant&&AV.SelectVariant(V,m.defaultVariant),null===m||void 0===m||null===(I=m.onLoaded)||void 0===I||I.call(m,{get variants(){return AV.GetAvailableVariants(V)},get selectedVariant(){const I=AV.GetLastSelectedVariant(V);return I?Array.isArray(I)?I[0]:I:AV.GetAvailableVariants(V)[0]},set selectedVariant(I){AV.SelectVariant(V,I)}})}}_loadMeshPrimitiveAsync(V,I,m,C,l,s){return p.LoadExtensionAsync(V,l,this.name,(async(F,k)=>{const j=new Array;return j.push(this._loader._loadMeshPrimitiveAsync(V,I,m,C,l,(I=>{if(s(I),I instanceof y.c){const m=p._GetDrawMode(V,l.mode),C=this._loader.rootBabylonMesh,s=C?C._internalMetadata=C._internalMetadata||{}:{},E=s.sk=s.sk||{},K=E[wV]=E[wV]||{lastSelected:null,original:[],variants:{}};K.original.push({mesh:I,material:I.material});for(let V=0;V<k.mappings.length;++V){const l=k.mappings[V],s=u.Get(`${F}/mappings/${V}/material`,this._loader.sk.materials,l.material);j.push(this._loader._loadMaterialAsync(`#/materials/${l.material}`,s,I,m,(V=>{for(let m=0;m<l.variants.length;++m){const s=l.variants[m],F=u.Get(`/extensions/${wV}/variants/${s}`,this._variants,s);K.variants[F.name]=K.variants[F.name]||[],K.variants[F.name].push({mesh:I,material:V}),I.onClonedObservable.add((V=>{const m=V;let l=null,s=m;do{if(s=s.parent,!s)return;l=AV._GetExtensionMetadata(s)}while(null===l);if(C&&l===AV._GetExtensionMetadata(C)){s._internalMetadata={};for(const V in C._internalMetadata)s._internalMetadata[V]=C._internalMetadata[V];s._internalMetadata.sk=[];for(const V in C._internalMetadata.sk)s._internalMetadata.sk[V]=C._internalMetadata.sk[V];s._internalMetadata.sk[wV]={lastSelected:null,original:[],variants:{}};for(const V of l.original)s._internalMetadata.sk[wV].original.push({mesh:V.mesh,material:V.material});for(const V in l.variants)if(Object.prototype.hasOwnProperty.call(l.variants,V)){s._internalMetadata.sk[wV].variants[V]=[];for(const I of l.variants[V])s._internalMetadata.sk[wV].variants[V].push({mesh:I.mesh,material:I.material})}l=s._internalMetadata.sk[wV]}for(const C of l.original)C.mesh===I&&(C.mesh=m);for(const C of l.variants[F.name])C.mesh===I&&(C.mesh=m)}))}})))}}}))),await Promise.all(j).then((V=>{let[I]=V;return I}))}))}}R(wV),d(wV,!0,(V=>new AV(V)));var JV=m(11520);class UV{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:uV.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(V,I){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...UV._GetDefaultOptions(),...V},this._scene=I,this._scene._transmissionHelper=this,this.onErrorObservable=new K.e,this._scene.Ck.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(V){if(!Object.keys(V).filter((I=>this._options[I]!==V[I])).length)return;const I={...this._options,...V},m=this._options;this._options=I,I.renderSize===m.renderSize&&I.renderTargetTextureType===m.renderTargetTextureType&&I.generateMipmaps===m.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=I.samples,this._opaqueRenderTarget.lodGenerationScale=I.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=I.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(V){return!!V&&!!(V instanceof T.c&&V.subSurface.isRefractionEnabled)}_addMesh(V){this._materialObservers[V.uniqueId]=V.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),F.d.SetImmediate((()=>{this._shouldRenderAsTransmission(V.material)?(V.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(V)&&this._transparentMeshesCache.push(V)):-1===this._opaqueMeshesCache.indexOf(V)&&this._opaqueMeshesCache.push(V)}))}_removeMesh(V){V.onMaterialChangedObservable.remove(this._materialObservers[V.uniqueId]),delete this._materialObservers[V.uniqueId];let I=this._transparentMeshesCache.indexOf(V);-1!==I&&this._transparentMeshesCache.splice(I,1),I=this._opaqueMeshesCache.indexOf(V),-1!==I&&this._opaqueMeshesCache.splice(I,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(V){const I=this._transparentMeshesCache.indexOf(V),m=this._opaqueMeshesCache.indexOf(V);this._shouldRenderAsTransmission(V.material)?(V.material instanceof T.c&&(V.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==m?(this._opaqueMeshesCache.splice(m,1),this._transparentMeshesCache.push(V)):-1===I&&this._transparentMeshesCache.push(V)):-1!==I?(this._transparentMeshesCache.splice(I,1),this._opaqueMeshesCache.push(V)):-1===m&&this._opaqueMeshesCache.push(V)}_isRenderTargetValid(){var V;return null!==(null===(V=this._opaqueRenderTarget)||void 0===V?void 0:V.getInternalTexture())}_setupRenderTargets(){var V;let I;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new JV.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(V=this._options.clearColor)||void 0===V?void 0:V.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((V=>{I=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?V.clearColor.C(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(V.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=I}));for(const m of this._transparentMeshesCache)this._shouldRenderAsTransmission(m.material)&&(m.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const eV="KHR_materials_transmission";class aV{constructor(V){this.name=eV,this.order=175,this._loader=V,this.enabled=this._loader.isExtensionUsed(eV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadTransparentPropertiesAsync(C,I,m,l)),await Promise.all(s).then((()=>{}))}))}_loadTransparentPropertiesAsync(V,I,m,C){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const l=m;if(l.subSurface.isRefractionEnabled=!0,l.subSurface.volumeIndexOfRefraction=1,l.subSurface.useAlbedoToTintRefraction=!0,void 0===C.transmissionFactor)return l.subSurface.refractionIntensity=0,l.subSurface.isRefractionEnabled=!1,Promise.resolve();{var s;l.subSurface.refractionIntensity=C.transmissionFactor;const V=l.cV();if(l.subSurface.refractionIntensity&&!V._transmissionHelper)new UV({},l.cV());else if(l.subSurface.refractionIntensity&&(null===(s=V._transmissionHelper)||void 0===s||!s._isRenderTargetValid())){var F;null===(F=V._transmissionHelper)||void 0===F||F._setupRenderTargets()}}return l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=0,C.transmissionTexture?(C.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/transmissionTexture`,C.transmissionTexture,void 0).then((V=>{V.name=`${m.name} (Transmission)`,l.subSurface.refractionIntensityTexture=V,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}R(eV),d(eV,!0,(V=>new aV(V)));const LV="KHR_materials_diffuse_transmission";class VI{constructor(V){this.name=LV,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(LV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadTranslucentPropertiesAsync(C,I,m,l)),await Promise.all(s).then((()=>{}))}))}_loadTranslucentPropertiesAsync(V,I,m,C){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const l=m;if(l.subSurface.isTranslucencyEnabled=!0,l.subSurface.volumeIndexOfRefraction=1,l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=0,l.subSurface.useAlbedoToTintTranslucency=!1,void 0===C.diffuseTransmissionFactor)return l.subSurface.translucencyIntensity=0,l.subSurface.isTranslucencyEnabled=!1,Promise.resolve();l.subSurface.translucencyIntensity=C.diffuseTransmissionFactor;const F=new Array;return l.subSurface.useGltfStyleTextures=!0,C.diffuseTransmissionTexture&&(C.diffuseTransmissionTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionTexture`,C.diffuseTransmissionTexture).then((V=>{V.name=`${m.name} (Diffuse Transmission)`,l.subSurface.translucencyIntensityTexture=V})))),void 0!==C.diffuseTransmissionColorFactor?l.subSurface.translucencyColor=s.c.Ik(C.diffuseTransmissionColorFactor):l.subSurface.translucencyColor=s.c.White(),C.diffuseTransmissionColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionColorTexture`,C.diffuseTransmissionColorTexture).then((V=>{V.name=`${m.name} (Diffuse Transmission Color)`,l.subSurface.translucencyColorTexture=V}))),Promise.all(F).then((()=>{}))}}R(LV),d(LV,!0,(V=>new VI(V)));const II="KHR_materials_volume";class mI{constructor(V){this.name=II,this.order=173,this._loader=V,this.enabled=this._loader.isExtensionUsed(II),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadVolumePropertiesAsync(C,I,m,l)),await Promise.all(s).then((()=>{}))}))}_loadVolumePropertiesAsync(V,I,m,C){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);if(!m.subSurface.isRefractionEnabled&&!m.subSurface.isTranslucencyEnabled||!C.thicknessFactor)return Promise.resolve();m.subSurface.volumeIndexOfRefraction=m.indexOfRefraction;const l=void 0!==C.attenuationDistance?C.attenuationDistance:Number.MAX_VALUE;return m.subSurface.tintColorAtDistance=l,void 0!==C.attenuationColor&&3==C.attenuationColor.length&&m.subSurface.tintColor.aF(C.attenuationColor[0],C.attenuationColor[1],C.attenuationColor[2]),m.subSurface.minimumThickness=0,m.subSurface.maximumThickness=C.thicknessFactor,m.subSurface.useThicknessAsDepth=!0,C.thicknessTexture?(C.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/thicknessTexture`,C.thicknessTexture).then((V=>{V.name=`${m.name} (Thickness)`,m.subSurface.thicknessTexture=V,m.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}R(II),d(II,!0,(V=>new mI(V)));const CI="KHR_materials_dispersion";class lI{constructor(V){this.name=CI,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(CI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadDispersionPropertiesAsync(C,I,m,l)),await Promise.all(s).then((()=>{}))}))}_loadDispersionPropertiesAsync(V,I,m,C){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);return m.subSurface.isRefractionEnabled&&C.dispersion?(m.subSurface.isDispersionEnabled=!0,m.subSurface.dispersion=C.dispersion,Promise.resolve()):Promise.resolve()}}R(CI),d(CI,!0,(V=>new lI(V)));const sI="EXT_materials_diffuse_roughness";class FI{constructor(V){this.name=sI,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(sI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(V,I,m)),s.push(this._loadDiffuseRoughnessPropertiesAsync(C,l,m)),await Promise.all(s).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(V,I,m){if(!(m instanceof T.c))throw new Error(`${V}: Material type not supported`);const C=new Array;return m.brdf.baseDiffuseModel=uV.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=I.diffuseRoughnessFactor?m.baseDiffuseRoughness=I.diffuseRoughnessFactor:m.baseDiffuseRoughness=0,I.diffuseRoughnessTexture&&C.push(this._loader.loadTextureInfoAsync(`${V}/diffuseRoughnessTexture`,I.diffuseRoughnessTexture,(V=>{V.name=`${m.name} (Diffuse Roughness)`,m.baseDiffuseRoughnessTexture=V}))),Promise.all(C).then((()=>{}))}}R(sI),d(sI,!0,(V=>new FI(V)));const kI="KHR_mesh_quantization";class jI{constructor(V){this.name=kI,this.enabled=V.isExtensionUsed(kI)}dispose(){}}R(kI),d(kI,!0,(V=>new jI(V)));const EI="KHR_texture_basisu";class KI{constructor(V){this.name=EI,this._loader=V,this.enabled=V.isExtensionUsed(EI)}dispose(){this._loader=null}_loadTextureAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>{const s=void 0==I.sampler?p.DefaultSampler:u.Get(`${V}/sampler`,this._loader.sk.samplers,I.sampler),F=u.Get(`${C}/source`,this._loader.sk.images,l.source);return await this._loader._createTextureAsync(V,s,F,(V=>{m(V)}),I._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!I._textureInfo.nonColorData)}))}}R(EI),d(EI,!0,(V=>new KI(V)));const YI="KHR_texture_transform";class XI{constructor(V){this.name=YI,this._loader=V,this.enabled=this._loader.isExtensionUsed(YI)}dispose(){this._loader=null}loadTextureInfoAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(C,l)=>await this._loader.loadTextureInfoAsync(V,I,(V=>{if(!(V instanceof n.e))throw new Error(`${C}: Texture type not supported`);l.offset&&(V.uOffset=l.offset[0],V.vOffset=l.offset[1]),V.uRotationCenter=0,V.vRotationCenter=0,l.rotation&&(V.wAng=-l.rotation),l.scale&&(V.uScale=l.scale[0],V.vScale=l.scale[1]),void 0!=l.texCoord&&(V.coordinatesIndex=l.texCoord),m(V)}))))}}R(YI),d(YI,!0,(V=>new XI(V)));const OI="KHR_xmp_json_ld";class vI{constructor(V){this.name=OI,this.order=100,this._loader=V,this.enabled=this._loader.isExtensionUsed(OI)}dispose(){this._loader=null}onLoading(){var V,I,m;if(null===this._loader.rootBabylonMesh)return;const C=null===(V=this._loader.sk.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld,l=null===(I=this._loader.sk.asset)||void 0===I||null===(m=I.extensions)||void 0===m?void 0:m.KHR_xmp_json_ld;if(C&&l){const V=+l.packet;C.packets&&V<C.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=C.packets[V])}}}function NI(V,I,m,C){return s.c.Ik(I,m).scale(C)}function tI(V,I,m,C){return I[m]*C}function DI(V,I,m,C){return-I[m]*C}function bI(V,I,m,C){return I[m+1]*C}function TI(V,I,m,C){return I[m]*C*2}function nI(V){return{scale:[new SI(X.c.ANIMATIONTYPE_FLOAT,`${V}.uScale`,tI,(()=>2)),new SI(X.c.ANIMATIONTYPE_FLOAT,`${V}.vScale`,bI,(()=>2))],offset:[new SI(X.c.ANIMATIONTYPE_FLOAT,`${V}.uOffset`,tI,(()=>2)),new SI(X.c.ANIMATIONTYPE_FLOAT,`${V}.vOffset`,bI,(()=>2))],rotation:[new SI(X.c.ANIMATIONTYPE_FLOAT,`${V}.wAng`,DI,(()=>1))]}}R(OI),d(OI,!0,(V=>new vI(V)));class xI extends M.AnimationPropertyInfo{buildAnimations(V,I,m,C){return[{babylonAnimatable:V._babylonCamera,babylonAnimation:this._buildAnimation(I,m,C)}]}}class SI extends M.AnimationPropertyInfo{buildAnimations(V,I,m,C){const l=[];for(const s in V._data)l.push({babylonAnimatable:V._data[s].babylonMaterial,babylonAnimation:this._buildAnimation(I,m,C)});return l}}class cI extends M.AnimationPropertyInfo{buildAnimations(V,I,m,C){return[{babylonAnimatable:V._babylonLight,babylonAnimation:this._buildAnimation(I,m,C)}]}}(0,i.e)("/cameras/{}/orthographic/xmag",[new xI(X.c.ANIMATIONTYPE_FLOAT,"orthoLeft",DI,(()=>1)),new xI(X.c.ANIMATIONTYPE_FLOAT,"orthoRight",bI,(()=>1))]),(0,i.e)("/cameras/{}/orthographic/ymag",[new xI(X.c.ANIMATIONTYPE_FLOAT,"orthoBottom",DI,(()=>1)),new xI(X.c.ANIMATIONTYPE_FLOAT,"orthoTop",bI,(()=>1))]),(0,i.e)("/cameras/{}/orthographic/zfar",[new xI(X.c.ANIMATIONTYPE_FLOAT,"maxZ",tI,(()=>1))]),(0,i.e)("/cameras/{}/orthographic/znear",[new xI(X.c.ANIMATIONTYPE_FLOAT,"Fk",tI,(()=>1))]),(0,i.e)("/cameras/{}/perspective/yfov",[new xI(X.c.ANIMATIONTYPE_FLOAT,"fov",tI,(()=>1))]),(0,i.e)("/cameras/{}/perspective/zfar",[new xI(X.c.ANIMATIONTYPE_FLOAT,"maxZ",tI,(()=>1))]),(0,i.e)("/cameras/{}/perspective/znear",[new xI(X.c.ANIMATIONTYPE_FLOAT,"Fk",tI,(()=>1))]),(0,i.e)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new SI(X.c.ANIMATIONTYPE_COLOR3,"albedoColor",NI,(()=>4)),new SI(X.c.ANIMATIONTYPE_FLOAT,"alpha",(function(V,I,m,C){return I[m+3]*C}),(()=>4))]),(0,i.e)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"metallic",tI,(()=>1))]),(0,i.e)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"roughness",tI,(()=>1))]);const HI=nI("albedoTexture");(0,i.e)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",HI.scale),(0,i.e)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",HI.offset),(0,i.e)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",HI.rotation);const yI=nI("metallicTexture");(0,i.e)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",yI.scale),(0,i.e)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",yI.offset),(0,i.e)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",yI.rotation),(0,i.e)("/materials/{}/emissiveFactor",[new SI(X.c.ANIMATIONTYPE_COLOR3,"emissiveColor",NI,(()=>3))]);const zI=nI("bumpTexture");(0,i.e)("/materials/{}/normalTexture/scale",[new SI(X.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",tI,(()=>1))]),(0,i.e)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",zI.scale),(0,i.e)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",zI.offset),(0,i.e)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",zI.rotation),(0,i.e)("/materials/{}/occlusionTexture/strength",[new SI(X.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",tI,(()=>1))]);const ZI=nI("ambientTexture");(0,i.e)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",ZI.scale),(0,i.e)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",ZI.offset),(0,i.e)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",ZI.rotation);const BI=nI("emissiveTexture");(0,i.e)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",BI.scale),(0,i.e)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",BI.offset),(0,i.e)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",BI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new SI(X.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new SI(X.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",tI,(()=>1))]);const WI=nI("anisotropy.texture");(0,i.e)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",WI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",WI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",WI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",tI,(()=>1))]);const QI=nI("clearCoat.texture");(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",QI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",QI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",QI.rotation);const GI=nI("clearCoat.bumpTexture");(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new SI(X.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",GI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",GI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",GI.rotation);const rI=nI("clearCoat.textureRoughness");(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",rI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",rI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",rI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new SI(X.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_ior/ior",[new SI(X.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new SI(X.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new SI(X.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",tI,(()=>1))]);const gI=nI("iridescence.texture");(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",gI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",gI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",gI.rotation);const hI=nI("iridescence.thicknessTexture");(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",hI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",hI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",hI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new SI(X.c.ANIMATIONTYPE_COLOR3,"sheen.color",NI,(()=>3))]),(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",tI,(()=>1))]);const dI=nI("sheen.texture");(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",dI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",dI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",dI.rotation);const RI=nI("sheen.textureRoughness");(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",RI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",RI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",RI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new SI(X.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",NI,(()=>3))]);const iI=nI("metallicReflectanceTexture");(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",iI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",iI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",iI.rotation);const qI=nI("reflectanceTexture");(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",qI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",qI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",qI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",tI,(()=>1))]);const PI=nI("subSurface.refractionIntensityTexture");(0,i.e)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",PI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",PI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",PI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new SI(X.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",NI,(()=>3))]),(0,i.e)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new SI(X.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",tI,(()=>1))]),(0,i.e)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",tI,(()=>1))]);const uI=nI("subSurface.thicknessTexture");(0,i.e)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",uI.scale),(0,i.e)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",uI.offset),(0,i.e)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",uI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new SI(X.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",tI,(()=>1))]);const oI=nI("subSurface.translucencyIntensityTexture");(0,i.e)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",oI.scale),(0,i.e)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",oI.offset),(0,i.e)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",oI.rotation),(0,i.e)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new SI(X.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",NI,(()=>3))]);const pI=nI("subSurface.translucencyColorTexture");(0,i.e)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",pI.scale),(0,i.e)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",pI.offset),(0,i.e)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",pI.rotation),(0,i.e)("/extensions/KHR_lights_punctual/lights/{}/color",[new cI(X.c.ANIMATIONTYPE_COLOR3,"diffuse",NI,(()=>3))]),(0,i.e)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new cI(X.c.ANIMATIONTYPE_FLOAT,"intensity",tI,(()=>1))]),(0,i.e)("/extensions/KHR_lights_punctual/lights/{}/range",[new cI(X.c.ANIMATIONTYPE_FLOAT,"range",tI,(()=>1))]),(0,i.e)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new cI(X.c.ANIMATIONTYPE_FLOAT,"innerAngle",TI,(()=>1))]),(0,i.e)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new cI(X.c.ANIMATIONTYPE_FLOAT,"angle",TI,(()=>1))]),(0,i.e)("/nodes/{}/extensions/EXT_lights_ies/color",[new cI(X.c.ANIMATIONTYPE_COLOR3,"diffuse",NI,(()=>3))]),(0,i.e)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new cI(X.c.ANIMATIONTYPE_FLOAT,"intensity",tI,(()=>1))]);const MI="KHR_animation_pointer";class fI{constructor(V){this.name=MI,this._loader=V,this._pathToObjectConverter=(0,i.d)(this._loader.sk)}get enabled(){return this._loader.isExtensionUsed(MI)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(V,I,m,C,l){var s;const F=null===(s=C.target.extensions)||void 0===s?void 0:s.KHR_animation_pointer;if(!F||!this._pathToObjectConverter)return null;"pointer"!==C.target.path&&N.d.Warn(`${V}/target/path: Value (${C.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=C.target.node&&N.d.Warn(`${V}/target/node: Value (${C.target.node}) must not be present when using the ${this.name} extension`);const k=`${V}/extensions/${this.name}`,j=F.pointer;if(!j)throw new Error(`${k}: Pointer is missing`);try{const s=this._pathToObjectConverter.convert(j);if(!s.info.interpolation)throw new Error(`${k}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(V,I,m,C,{object:s.object,info:s.info.interpolation},l)}catch(E){return N.d.Warn(`${k}/pointer: Invalid pointer (${j}) skipped`),null}}}R(MI),d(MI,!0,(V=>new fI(V)));class wI{constructor(V,I,m){this.frame=V,this.action=I,this.onlyOnce=m,this.isDone=!1}_clone(){return new wI(this.frame,this.action,this.onlyOnce)}}var AI=m(11095),JI=m(11136),UI=m(11129);class eI{get loop(){return this._loop}set loop(V){V!==this._loop&&(this._loop=V,this.updateOptions({loop:V}))}get currentTime(){var V;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(V=JI.b.audioEngine)&&void 0!==V&&V.audioContext&&(this.isPlaying||this.isPaused)){const V=this.isPaused?0:JI.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+V}return 0}get spatialSound(){return this._spatialSound}set spatialSound(V){if(V==this._spatialSound)return;const I=this.isPlaying;this.pause(),V?(this._spatialSound=V,this._updateSpatialParameters()):this._disableSpatialSound(),I&&this.play()}constructor(V,I,m){var C;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new K.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=l.m.Zero(),this._localDirection=new l.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=V,m=m||v.c.LastCreatedScene)if(this._scene=m,eI._SceneComponentInitialization(m),this._readyToPlayCallback=s,this._customAttenuationFunction=(V,I,m,C,l)=>I<m?V*(1-I/m):0,k&&(this.autoplay=k.autoplay||!1,this._loop=k.loop||!1,void 0!==k.volume&&(this._volume=k.volume),this._spatialSound=k.spatialSound??!1,this.maxDistance=k.maxDistance??100,this.useCustomAttenuation=k.useCustomAttenuation??!1,this.rolloffFactor=k.rolloffFactor||1,this.refDistance=k.refDistance||1,this.distanceModel=k.distanceModel||"linear",this._playbackRate=k.playbackRate||1,this._streaming=k.streaming??!1,this._length=k.length,this._offset=k.offset),null!==(C=JI.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&JI.b.audioEngine.audioContext){this._soundGain=JI.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let V=!0;if(I)try{"string"===typeof I?(this._urlType="String",this._url=I):I instanceof ArrayBuffer?this._urlType="ArrayBuffer":I instanceof HTMLMediaElement?this._urlType="MediaElement":I instanceof MediaStream?this._urlType="MediaStream":I instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(I)&&(this._urlType="Array");let m=[],C=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=JI.b.audioEngine.audioContext.createMediaElementSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=JI.b.audioEngine.audioContext.createMediaStreamSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":I.byteLength>0&&(C=!0,this._soundLoaded(I));break;case"AudioBuffer":this._audioBufferLoaded(I);break;case"String":m.push(I);case"Array":0===m.length&&(m=I);for(let V=0;V<m.length;V++){const I=m[V];if(C=k&&k.skipCodecCheck||-1!==I.indexOf(".mp3",I.length-4)&&JI.b.audioEngine.isMP3supported||-1!==I.indexOf(".ogg",I.length-4)&&JI.b.audioEngine.isOGGsupported||-1!==I.indexOf(".wav",I.length-4)||-1!==I.indexOf(".m4a",I.length-4)||-1!==I.indexOf(".mp4",I.length-4)||-1!==I.indexOf("blob:"),C){this._streaming?(this._htmlAudioElement=new Audio(I),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,F.d.SetCorsBehavior(I,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(I,(V=>{this._soundLoaded(V)}),void 0,!0,!0,(V=>{V&&N.d.Error("XHR "+V.status+" error on: "+I+"."),N.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:V=!1}V?C||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):N.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(j){N.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),JI.b.audioEngine&&!JI.b.audioEngine.WarnedWebAudioUnsupported&&(N.d.Error("Web Audio is not supported by your browser."),JI.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var V;null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(V){var I;null!==(I=JI.b.audioEngine)&&void 0!==I&&I.audioContext&&(this._audioBuffer=V,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(V){var I;null!==(I=JI.b.audioEngine)&&void 0!==I&&I.audioContext&&JI.b.audioEngine.audioContext.decodeAudioData(V,(V=>{this._audioBufferLoaded(V)}),(V=>{N.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+V)}))}setAudioBuffer(V){var I;null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this._audioBuffer=V,this._isReadyToPlay=!0)}updateOptions(V){V&&(this.loop=V.loop??this.loop,this.maxDistance=V.maxDistance??this.maxDistance,this.useCustomAttenuation=V.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=V.rolloffFactor??this.rolloffFactor,this.refDistance=V.refDistance??this.refDistance,this.distanceModel=V.distanceModel??this.distanceModel,this._playbackRate=V.playbackRate??this._playbackRate,this._length=V.length??void 0,this.spatialSound=V.spatialSound??this._spatialSound,this._setOffset(V.offset??void 0),this.setVolume(V.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var V;null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&JI.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??JI.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var V;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(V=this._soundPanner)||void 0===V||V.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var V;null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(V){var I;null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(V),this._isOutputConnected=!0)}setDirectionalCone(V,I,m){I<V?N.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=V,this._coneOuterAngle=I,this._coneOuterGain=m,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!=this._coneInnerAngle){var I;if(this._coneOuterAngle<V)return void N.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V,null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!=this._coneOuterAngle){var I;if(V<this._coneInnerAngle)return void N.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V,null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(V){var I;V.equals(this._position)||(this._position.C(V),null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(V){var I;this._localDirection=V,null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const V=this._connectedTransformNode.getWorldMatrix(),I=l.m.TransformNormal(this._localDirection,V);I.normalize(),this._soundPanner.orientationX.value=I.x,this._soundPanner.orientationY.value=I.y,this._soundPanner.orientationZ.value=I.z}updateDistanceFromListener(){var V;if(null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const V=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Fm(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,V,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(V){this._customAttenuationFunction=V}play(V,I,m){var C;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(C=JI.b.audioEngine)&&void 0!==C&&C.audioContext)try{var l,s;this._clearTimeoutsAndObservers();let C=V?(null===(l=JI.b.audioEngine)||void 0===l?void 0:l.audioContext.currentTime)+V:null===(s=JI.b.audioEngine)||void 0===s?void 0:s.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=JI.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const V=()=>{var m;if(null!==(m=JI.b.audioEngine)&&void 0!==m&&m.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=I??0;const m=this._htmlAudioElement.play();void 0!==m&&m.catch((()=>{var I,m;(null===(I=JI.b.audioEngine)||void 0===I||I.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(m=JI.b.audioEngine)||void 0===m?void 0:m.onAudioUnlockedObservable.addOnce((()=>{V()})))}))}else{var C;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(C=JI.b.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{V()}))}};V()}}else{var F;const l=()=>{var l;if(null!==(l=JI.b.audioEngine)&&void 0!==l&&l.audioContext){var s;if(m=m||this._length,void 0!==I&&this._setOffset(I),this._soundSource){const V=this._soundSource;V.onended=()=>{V.disconnect()}}if(this._soundSource=null===(s=JI.b.audioEngine)||void 0===s?void 0:s.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var F;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==I&&(this._soundSource.loopStart=I),void 0!==m&&(this._soundSource.loopEnd=(0|I)+m),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},C=V?(null===(F=JI.b.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+V:JI.b.audioEngine.audioContext.currentTime;const l=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(C,l,this.loop?void 0:m)}}};"suspended"===(null===(F=JI.b.audioEngine)||void 0===F?void 0:F.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var V;"suspended"===(null===(V=JI.b.audioEngine)||void 0===V?void 0:V.audioContext.state)?(JI.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=JI.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{l()})))):l()}),500):l()}this._startTime=C,this.isPlaying=!0,this.isPaused=!1}catch(k){N.d.Error("Error while trying to play audio: "+this.name+", "+k.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(V){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var m;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(m=this._streamingSource)||void 0===m||m.disconnect();this.isPlaying=!1}else if(null!==(I=JI.b.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource){const I=V?JI.b.audioEngine.audioContext.currentTime+V:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(I)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var I;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(I=this._streamingSource)||void 0===I||I.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(V=JI.b.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=JI.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(V,I){var m;null!==(m=JI.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&this._soundGain&&(I&&JI.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(JI.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,JI.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(V,JI.b.audioEngine.audioContext.currentTime+I)):this._soundGain.gain.value=V),this._volume=V}setPlaybackRate(V){this._playbackRate=V,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(V){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=V,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=V=>this._onRegisterAfterWorldMatrixUpdate(V),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(V){var I;if(V.getBoundingInfo){const I=V.getBoundingInfo();this.setPosition(I.boundingSphere.centerWorld)}else this.setPosition(V.absolutePosition);null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const V=()=>{(0,UI.i)((()=>this._isReadyToPlay),(()=>{m._audioBuffer=this.getAudioBuffer(),m._isReadyToPlay=!0,m.autoplay&&m.play(0,this._offset,this._length)}),void 0,300)},I={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},m=new eI(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,I);return this.useCustomAttenuation&&m.setAttenuationFunction(this._customAttenuationFunction),m.setPosition(this._position),m.setPlaybackRate(this._playbackRate),V(),m}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const V={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(V.connectedMeshId=this._connectedTransformNode.id),V.position=this._position.UF(),V.refDistance=this.refDistance,V.distanceModel=this.distanceModel,V.isDirectional=this._isDirectional,V.localDirectionToMesh=this._localDirection.UF(),V.coneInnerAngle=this._coneInnerAngle,V.coneOuterAngle=this._coneOuterAngle,V.coneOuterGain=this._coneOuterGain),V}static Parse(V,I,m,C){const s=V.name;let F;F=V.url?m+V.url:m+s;const k={autoplay:V.autoplay,loop:V.loop,volume:V.volume,spatialSound:V.spatialSound,maxDistance:V.maxDistance,rolloffFactor:V.rolloffFactor,refDistance:V.refDistance,distanceModel:V.distanceModel,playbackRate:V.playbackRate};let j;if(C){const V=()=>{(0,UI.i)((()=>C._isReadyToPlay),(()=>{j._audioBuffer=C.getAudioBuffer(),j._isReadyToPlay=!0,j.autoplay&&j.play(0,j._offset,j._length)}),void 0,300)};j=new eI(s,new ArrayBuffer(0),I,null,k),V()}else j=new eI(s,F,I,(()=>{I.removePendingData(j)}),k),I.addPendingData(j);if(V.position){const I=l.m.Ik(V.position);j.setPosition(I)}if(V.isDirectional&&(j.setDirectionalCone(V.coneInnerAngle||360,V.coneOuterAngle||360,V.coneOuterGain||0),V.localDirectionToMesh)){const I=l.m.Ik(V.localDirectionToMesh);j.setLocalDirectionToMesh(I)}if(V.connectedMeshId){const m=I.getMeshById(V.connectedMeshId);m&&j.attachToMesh(m)}return V.metadata&&(j.metadata=V.metadata),j}_setOffset(V){this._offset!==V&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=V)}_clearTimeoutsAndObservers(){var V;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(V=JI.b.audioEngine)||void 0===V||V.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}eI._SceneComponentInitialization=V=>{throw(0,AI.c)("AudioSceneComponent")},(0,SV.h)("BABYLON.Sound",eI);class aI{constructor(V,I,m){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],I.length!==m.length)throw new Error("Sounds length does not equal weights length");this.loop=V,this._weights=m;let C=0;for(const s of m)C+=s;const l=C>0?1/C:0;for(let s=0;s<this._weights.length;s++)this._weights[s]*=l;this._sounds=I;for(const s of this._sounds)s.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!==this._coneInnerAngle){if(this._coneOuterAngle<V)return void N.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V;for(const I of this._sounds)I.directionalConeInnerAngle=V}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!==this._coneOuterAngle){if(V<this._coneInnerAngle)return void N.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V;for(const I of this._sounds)I.directionalConeOuterAngle=V}}get volume(){return this._volume}set volume(V){if(V!==this._volume)for(const I of this._sounds)I.setVolume(V)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(V){if(!this.isPaused){this.stop();const V=Math.random();let I=0;for(let m=0;m<this._weights.length;m++)if(I+=this._weights[m],V<=I){this._currentIndex=m;break}}const I=this._sounds[this._currentIndex??0];I.isReady()?I.play(0,this.isPaused?void 0:V):I.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class LI{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(V=V||v.c.LastCreatedScene)&&(this._scene=V,this.soundCollection=[],this._options=I,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var V;null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&JI.b.audioEngine.audioContext&&(this._outputAudioNode=JI.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(JI.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(JI.b.audioEngine&&JI.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(V){var I;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&V.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==V.soundTrackId&&(-1===V.soundTrackId?this._scene.mainSoundTrack.removeSound(V):this._scene.soundTracks&&this._scene.soundTracks[V.soundTrackId].removeSound(V)),this.soundCollection.push(V),V.soundTrackId=this.id}removeSound(V){const I=this.soundCollection.indexOf(V);-1!==I&&this.soundCollection.splice(I,1)}setVolume(V){var I;null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=V)}switchPanningModelToHRTF(){var V;if(null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var V;if(null!==(V=JI.b.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToEqualPower()}connectToAnalyser(V){var I;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=V,null!==(I=JI.b.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,JI.b.audioEngine.masterGain))}}var Vm=m(11421),Im=m(11596),mm=m(11081);JI.b.AudioEngineFactory=(V,I,m)=>new Cm(V,I,m);class Cm{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new K.e,this.onAudioLockedObservable=new K.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,mm.o)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const C=document.createElement("audio");this._hostElement=V,this._audioContext=I,this._audioDestination=m;try{C&&C.canPlayType&&(C.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||C.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(l){}try{C&&C.canPlayType&&C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(l){}}lock(){this._triggerSuspendedState()}unlock(){var V,I;if("running"===(null===(V=this._audioContext)||void 0===V?void 0:V.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(I=this._audioContext)||void 0===I||I.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{N.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var V;null===(V=this._audioContext)||void 0===V||V.addEventListener("statechange",(()=>{var V;this.unlocked&&"running"!==(null===(V=this._audioContext)||void 0===V?void 0:V.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var V;return null!==(V=this._audioContext)&&void 0!==V&&V.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(V){this.canUseWebAudio=!1,N.d.Error("Web Audio: "+V.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(V){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const V=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",I=document.createElement("style");I.appendChild(document.createTextNode(V)),document.getElementsByTagName("head")[0].appendChild(I),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var V;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(V=this._audioContext)||void 0===V||V.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(V){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=V)}connectToAnalyser(V){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=V,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var lm=m(11091);(0,m(12555).e)(Vm.c.NAME_AUDIO,((V,I,m,C)=>{let l,s=[];if(m.KX=m.KX||[],void 0!==V.KX&&null!==V.KX)for(let k=0,j=V.KX.length;k<j;k++){var F;const j=V.KX[k];null!==(F=JI.b.audioEngine)&&void 0!==F&&F.canUseWebAudio?(j.url||(j.url=j.name),s[j.url]?m.KX.push(eI.Parse(j,I,C,s[j.url])):(l=eI.Parse(j,I,C),s[j.url]=l,m.KX.push(l))):m.KX.push(new eI(j.name,null,I))}s=[]})),Object.defineProperty(Im.e.prototype,"mainSoundTrack",{get:function(){let V=this._getComponent(Vm.c.NAME_AUDIO);return V||(V=new sm(this),this.o(V)),this._mainSoundTrack||(this._mainSoundTrack=new LI(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Im.e.prototype.getSoundByName=function(V){let I;for(I=0;I<this.mainSoundTrack.soundCollection.length;I++)if(this.mainSoundTrack.soundCollection[I].name===V)return this.mainSoundTrack.soundCollection[I];if(this.soundTracks)for(let m=0;m<this.soundTracks.length;m++)for(I=0;I<this.soundTracks[m].soundCollection.length;I++)if(this.soundTracks[m].soundCollection[I].name===V)return this.soundTracks[m].soundCollection[I];return null},Object.defineProperty(Im.e.prototype,"audioEnabled",{get:function(){let V=this._getComponent(Vm.c.NAME_AUDIO);return V||(V=new sm(this),this.o(V)),V.audioEnabled},set:function(V){let I=this._getComponent(Vm.c.NAME_AUDIO);I||(I=new sm(this),this.o(I)),V?I.enableAudio():I.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Im.e.prototype,"headphone",{get:function(){let V=this._getComponent(Vm.c.NAME_AUDIO);return V||(V=new sm(this),this.o(V)),V.headphone},set:function(V){let I=this._getComponent(Vm.c.NAME_AUDIO);I||(I=new sm(this),this.o(I)),V?I.switchAudioModeForHeadphones():I.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Im.e.prototype,"audioListenerPositionProvider",{get:function(){let V=this._getComponent(Vm.c.NAME_AUDIO);return V||(V=new sm(this),this.o(V)),V.audioListenerPositionProvider},set:function(V){let I=this._getComponent(Vm.c.NAME_AUDIO);if(I||(I=new sm(this),this.o(I)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");I.audioListenerPositionProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(Im.e.prototype,"audioListenerRotationProvider",{get:function(){let V=this._getComponent(Vm.c.NAME_AUDIO);return V||(V=new sm(this),this.o(V)),V.audioListenerRotationProvider},set:function(V){let I=this._getComponent(Vm.c.NAME_AUDIO);if(I||(I=new sm(this),this.o(I)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");I.audioListenerRotationProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(Im.e.prototype,"audioPositioningRefreshRate",{get:function(){let V=this._getComponent(Vm.c.NAME_AUDIO);return V||(V=new sm(this),this.o(V)),V.audioPositioningRefreshRate},set:function(V){let I=this._getComponent(Vm.c.NAME_AUDIO);I||(I=new sm(this),this.o(I)),I.audioPositioningRefreshRate=V},enumerable:!0,configurable:!0});class sm{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(V){this.name=Vm.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new l.m,this._cachedCameraPosition=new l.m,this._lastCheck=0,this._invertMatrixTemp=new l.b,this._cameraDirectionTemp=new l.m,(V=V||v.c.LastCreatedScene)&&(this.OI=V,V.soundTracks=[],V.KX=[])}register(){this.OI._afterRenderStage.registerStep(Vm.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(V){if(V.KX=[],this.OI.soundTracks)for(let I=0;I<this.OI.soundTracks.length;I++){const m=this.OI.soundTracks[I];for(let I=0;I<m.soundCollection.length;I++)V.KX.push(m.soundCollection[I].serialize())}}addFromContainer(V){if(V.KX)for(const I of V.KX)I.play(),I.autoplay=!0,this.OI.mainSoundTrack.addSound(I)}removeFromContainer(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(V.KX)for(const m of V.KX)m.stop(),m.autoplay=!1,this.OI.mainSoundTrack.removeSound(m),I&&m.dispose()}dispose(){const V=this.OI;if(V._mainSoundTrack&&V.mainSoundTrack.dispose(),V.soundTracks)for(let I=0;I<V.soundTracks.length;I++)V.soundTracks[I].dispose()}disableAudio(){const V=this.OI;let I;for(this._audioEnabled=!1,JI.b.audioEngine&&JI.b.audioEngine.audioContext&&JI.b.audioEngine.audioContext.suspend(),I=0;I<V.mainSoundTrack.soundCollection.length;I++)V.mainSoundTrack.soundCollection[I].pause();if(V.soundTracks)for(I=0;I<V.soundTracks.length;I++)for(let m=0;m<V.soundTracks[I].soundCollection.length;m++)V.soundTracks[I].soundCollection[m].pause()}enableAudio(){const V=this.OI;let I;for(this._audioEnabled=!0,JI.b.audioEngine&&JI.b.audioEngine.audioContext&&JI.b.audioEngine.audioContext.resume(),I=0;I<V.mainSoundTrack.soundCollection.length;I++)V.mainSoundTrack.soundCollection[I].isPaused&&V.mainSoundTrack.soundCollection[I].play();if(V.soundTracks)for(I=0;I<V.soundTracks.length;I++)for(let m=0;m<V.soundTracks[I].soundCollection.length;m++)V.soundTracks[I].soundCollection[m].isPaused&&V.soundTracks[I].soundCollection[m].play()}switchAudioModeForHeadphones(){const V=this.OI;if(this._headphone=!0,V.mainSoundTrack.switchPanningModelToHRTF(),V.soundTracks)for(let I=0;I<V.soundTracks.length;I++)V.soundTracks[I].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const V=this.OI;if(this._headphone=!1,V.mainSoundTrack.switchPanningModelToEqualPower(),V.soundTracks)for(let I=0;I<V.soundTracks.length;I++)V.soundTracks[I].switchPanningModelToEqualPower()}_afterRender(){const V=lm.d.Now;if(this._lastCheck&&V-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=V;const I=this.OI;if(!this._audioEnabled||!I._mainSoundTrack||!I.soundTracks||0===I._mainSoundTrack.soundCollection.length&&1===I.soundTracks.length)return;const m=JI.b.audioEngine;if(m&&m.audioContext){let V,C=I.activeCamera;if(I.activeCameras&&I.activeCameras.length>0&&(C=I.activeCameras[0]),this.audioListenerPositionProvider){const V=this.audioListenerPositionProvider();m.audioContext.listener.setPosition(V.x||0,V.y||0,V.z||0)}else C?this._cachedCameraPosition.equals(C.globalPosition)||(this._cachedCameraPosition.C(C.globalPosition),m.audioContext.listener.setPosition(C.globalPosition.x,C.globalPosition.y,C.globalPosition.z)):m.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const V=this.audioListenerRotationProvider();m.audioContext.listener.setOrientation(V.x||0,V.y||0,V.z||0,0,1,0)}else C?(C.rigCameras&&C.rigCameras.length>0&&(C=C.rigCameras[0]),C.getViewMatrix().invertToRef(this._invertMatrixTemp),l.m.TransformNormalToRef(sm._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.C(this._cameraDirectionTemp),m.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):m.audioContext.listener.setOrientation(0,0,0,0,1,0);for(V=0;V<I.mainSoundTrack.soundCollection.length;V++){const m=I.mainSoundTrack.soundCollection[V];m.useCustomAttenuation&&m.updateDistanceFromListener()}if(I.soundTracks)for(V=0;V<I.soundTracks.length;V++)for(let m=0;m<I.soundTracks[V].soundCollection.length;m++){const C=I.soundTracks[V].soundCollection[m];C.useCustomAttenuation&&C.updateDistanceFromListener()}}}}sm._CameraDirection=new l.m(0,0,-1),eI._SceneComponentInitialization=V=>{let I=V._getComponent(Vm.c.NAME_AUDIO);I||(I=new sm(V),V.o(I))};const Fm="MSFT_audio_emitter";class km{constructor(V){this.name=Fm,this._loader=V,this.enabled=this._loader.isExtensionUsed(Fm)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const V=this._loader.sk.extensions;if(V&&V[this.name]){const I=V[this.name];this._clips=I.clips,this._emitters=I.emitters,u.Assign(this._clips),u.Assign(this._emitters)}}loadSceneAsync(V,I){return p.LoadExtensionAsync(V,I,this.name,(async(m,C)=>{const l=new Array;l.push(this._loader.loadSceneAsync(V,I));for(const V of C.emitters){const I=u.Get(`${m}/emitters`,this._emitters,V);if(void 0!=I.refDistance||void 0!=I.maxDistance||void 0!=I.rolloffFactor||void 0!=I.distanceModel||void 0!=I.innerAngle||void 0!=I.outerAngle)throw new Error(`${m}: Direction or Distance properties are not allowed on emitters attached to a scene`);l.push(this._loadEmitterAsync(`${m}/emitters/${I.index}`,I))}await Promise.all(l)}))}loadNodeAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(V,C)=>{const s=new Array,k=await this._loader.loadNodeAsync(V,I,(I=>{for(const m of C.emitters){const C=u.Get(`${V}/emitters`,this._emitters,m);s.push(this._loadEmitterAsync(`${V}/emitters/${C.index}`,C).then((()=>{for(const V of C._babylonSounds)V.attachToMesh(I),void 0==C.innerAngle&&void 0==C.outerAngle||(V.setLocalDirectionToMesh(l.m.Forward()),V.setDirectionalCone(2*F.d.ToDegrees(void 0==C.innerAngle?Math.PI:C.innerAngle),2*F.d.ToDegrees(void 0==C.outerAngle?Math.PI:C.outerAngle),0))})))}m(I)}));return await Promise.all(s),k}))}loadAnimationAsync(V,I){return p.LoadExtensionAsync(V,I,this.name,(async(m,C)=>{const l=await this._loader.loadAnimationAsync(V,I),s=new Array;u.Assign(C.events);for(const F of C.events)s.push(this._loadAnimationEventAsync(`${m}/events/${F.index}`,V,I,F,l));return await Promise.all(s),l}))}_loadClipAsync(V,I){if(I._objectURL)return I._objectURL;let m;if(I.uri)m=this._loader.loadUriAsync(V,I,I.uri);else{const C=u.Get(`${V}/bufferView`,this._loader.sk.bufferViews,I.bufferView);m=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}return I._objectURL=m.then((V=>URL.createObjectURL(new Blob([V],{type:I.mimeType})))),I._objectURL}_loadEmitterAsync(V,I){if(I._babylonSounds=I._babylonSounds||[],!I._babylonData){const V=new Array,m=I.name||`emitter${I.index}`,C={loop:!1,autoplay:!1,volume:void 0==I.volume?1:I.volume};for(let s=0;s<I.clips.length;s++){const l=`/extensions/${this.name}/clips`,F=u.Get(l,this._clips,I.clips[s].clip);V.push(this._loadClipAsync(`${l}/${I.clips[s].clip}`,F).then((V=>{const l=I._babylonSounds[s]=new eI(m,V,this._loader.babylonScene,null,C);l.refDistance=I.refDistance||1,l.maxDistance=I.maxDistance||256,l.rolloffFactor=I.rolloffFactor||1,l.distanceModel=I.distanceModel||"exponential"})))}const l=Promise.all(V).then((()=>{const V=I.clips.map((V=>V.weight||1)),m=new aI(I.loop||!1,I._babylonSounds,V);I.innerAngle&&(m.directionalConeInnerAngle=2*F.d.ToDegrees(I.innerAngle)),I.outerAngle&&(m.directionalConeOuterAngle=2*F.d.ToDegrees(I.outerAngle)),I.volume&&(m.volume=I.volume),I._babylonData.sound=m}));I._babylonData={loaded:l}}return I._babylonData.loaded}_getEventAction(V,I,m,C,l){switch(m){case"play":return V=>{const m=(l||0)+(V-C);I.play(m)};case"stop":return()=>{I.stop()};case"pause":return()=>{I.pause()};default:throw new Error(`${V}: Unsupported action ${m}`)}}_loadAnimationEventAsync(V,I,m,C,l){if(0==l.targetedAnimations.length)return Promise.resolve();const s=l.targetedAnimations[0],F=C.i,k=u.Get(`/extensions/${this.name}/emitters`,this._emitters,F);return this._loadEmitterAsync(V,k).then((()=>{const I=k._babylonData.sound;if(I){const m=new wI(C.time,this._getEventAction(V,I,C.action,C.time,C.startOffset));s.animation.addEvent(m),l.onAnimationGroupEndObservable.add((()=>{I.stop()})),l.onAnimationGroupPauseObservable.add((()=>{I.pause()}))}}))}}R(Fm),d(Fm,!0,(V=>new km(V)));const jm="MSFT_lod";class Em{constructor(V){var I;this.name=jm,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new K.e,this.onMaterialLODsLoadedObservable=new K.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=V,this.maxLODsToLoad=(null===(I=this._loader.parent.extensionOptions[jm])||void 0===I?void 0:I.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(jm)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let V=0;V<this._nodePromiseLODs.length;V++){const I=Promise.all(this._nodePromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Node LOD ${V}`),this._loader.log(`Loaded node LOD ${V}`)),this.onNodeLODsLoadedObservable.notifyObservers(V),V!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${V+1}`),this._loadBufferLOD(this._nodeBufferLODs,V+1),this._nodeSignalLODs[V]&&this._nodeSignalLODs[V].resolve())}));this._loader._completePromises.push(I)}for(let V=0;V<this._materialPromiseLODs.length;V++){const I=Promise.all(this._materialPromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Material LOD ${V}`),this._loader.log(`Loaded material LOD ${V}`)),this.onMaterialLODsLoadedObservable.notifyObservers(V),V!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${V+1}`),this._loadBufferLOD(this._materialBufferLODs,V+1),this._materialSignalLODs[V]&&this._materialSignalLODs[V].resolve())}));this._loader._completePromises.push(I)}}loadSceneAsync(V,I){const m=this._loader.loadSceneAsync(V,I);return this._loadBufferLOD(this._bufferLODs,0),m}loadNodeAsync(V,I,m){return p.LoadExtensionAsync(V,I,this.name,(async(V,l)=>{let s;const F=this._getLODs(V,I,this._loader.sk.nodes,l.ids);this._loader.logOpen(`${V}`);for(let I=0;I<F.length;I++){const V=F[I];0!==I&&(this._nodeIndexLOD=I,this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new C);const l=V=>{m(V),V.Sk(!1)},k=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,l).then((V=>{if(0!==I){const V=F[I-1];V._babylonTransformNode&&(this._disposeTransformNode(V._babylonTransformNode),delete V._babylonTransformNode)}return V.Sk(!0),V}));this._nodePromiseLODs[I]=this._nodePromiseLODs[I]||[],0===I?s=k:(this._nodeIndexLOD=null,this._nodePromiseLODs[I].push(k))}return this._loader.logClose(),await s}))}_loadMaterialAsync(V,I,m,C,l){return this._nodeIndexLOD?null:p.LoadExtensionAsync(V,I,this.name,(async(V,s)=>{let F;const k=this._getLODs(V,I,this._loader.sk.materials,s.ids);this._loader.logOpen(`${V}`);for(let I=0;I<k.length;I++){const V=k[I];0!==I&&(this._materialIndexLOD=I);const s=this._loader._loadMaterialAsync(`/materials/${V.index}`,V,m,C,(V=>{0===I&&l(V)})).then((V=>{if(0!==I){l(V);const m=k[I-1]._data;m[C]&&(this._disposeMaterials([m[C].babylonMaterial]),delete m[C])}return V}));this._materialPromiseLODs[I]=this._materialPromiseLODs[I]||[],0===I?F=s:(this._materialIndexLOD=null,this._materialPromiseLODs[I].push(s))}return this._loader.logClose(),await F}))}_loadUriAsync(V,I,m){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const l=this._nodeIndexLOD-1;return this._nodeSignalLODs[l]=this._nodeSignalLODs[l]||new C,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(V,I,m)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const l=this._materialIndexLOD-1;return this._materialSignalLODs[l]=this._materialSignalLODs[l]||new C,this._materialSignalLODs[l].promise.then((async()=>await this._loader.loadUriAsync(V,I,m)))}return null}loadBufferAsync(V,I,m,l){if(this._loader.parent.useRangeRequests&&!I.uri){if(!this._loader.bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);const I=async(V,I)=>{const s=m,F=s+l-1;let k=V[I];return k?(k.start=Math.min(k.start,s),k.end=Math.max(k.end,F)):(k={start:s,end:F,loaded:new C},V[I]=k),await k.loaded.promise.then((V=>new Uint8Array(V.buffer,V.byteOffset+m-k.start,l)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?I(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?I(this._materialBufferLODs,this._materialIndexLOD):I(this._bufferLODs,0)}return null}_loadBufferLOD(V,I){const m=V[I];m&&(this._loader.log(`Loading buffer range [${m.start}-${m.end}]`),this._loader.bin.readAsync(m.start,m.end-m.start+1).then((V=>{m.loaded.resolve(V)}),(V=>{m.loaded.reject(V)})))}_getLODs(V,I,m,C){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const l=[];for(let s=C.length-1;s>=0;s--)if(l.push(u.Get(`${V}/ids/${C[s]}`,m,C[s])),l.length===this.maxLODsToLoad)return l;return l.push(I),l}_disposeTransformNode(V){const I=[],m=V.material;m&&I.push(m);for(const l of V.getChildMeshes())l.material&&I.push(l.material);V.dispose();const C=I.filter((V=>this._loader.babylonScene.meshes.every((I=>I.material!=V))));this._disposeMaterials(C)}_disposeMaterials(V){const I={};for(const m of V){for(const V of m.getActiveTextures())I[V.uniqueId]=V;m.dispose()}for(const m in I)for(const V of this._loader.babylonScene.materials)V.hasTexture(I[m])&&delete I[m];for(const m in I)I[m].dispose()}}R(jm),d(jm,!0,(V=>new Em(V)));const Km="MSFT_minecraftMesh";class Ym{constructor(V){this.name=Km,this._loader=V,this.enabled=this._loader.isExtensionUsed(Km)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtraAsync(V,I,this.name,(async(C,l)=>{if(l){if(!(m instanceof T.c))throw new Error(`${C}: Material type not supported`);const l=this._loader.loadMaterialPropertiesAsync(V,I,m);return m.needAlphaBlending()&&(m.forceDepthWrite=!0,m.separateCullingPass=!0),m.JF=m.forceDepthWrite,m.twoSidedLighting=!0,await l}}))}}R(Km),d(Km,!0,(V=>new Ym(V)));const Xm="MSFT_sRGBFactors";class Om{constructor(V){this.name=Xm,this._loader=V,this.enabled=this._loader.isExtensionUsed(Xm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,m){return p.LoadExtraAsync(V,I,this.name,(async(C,l)=>{if(l){if(!(m instanceof T.c))throw new Error(`${C}: Material type not supported`);const l=this._loader.loadMaterialPropertiesAsync(V,I,m),s=m.cV().getEngine().useExactSrgbConversions;return m.albedoTexture||m.albedoColor.toLinearSpaceToRef(m.albedoColor,s),m.reflectivityTexture||m.reflectivityColor.toLinearSpaceToRef(m.reflectivityColor,s),await l}}))}}R(Xm),d(Xm,!0,(V=>new Om(V)));var vm=m(12891);const Nm={};var tm=m(12930),Dm=m(12914),bm=m(12893),Tm=m(12899);function nm(V,I){for(const m of V)for(const V of m.dataOutputs)if(V.uniqueId===I)return V;throw new Error("Could not find data out connection with unique id "+I)}function xm(V,I){for(const m of V)if(m instanceof Dm.b)for(const V of m.signalInputs)if(V.uniqueId===I)return V;throw new Error("Could not find signal in connection with unique id "+I)}async function Sm(V,I){const C=await Promise.all(V.allBlocks.map((async V=>{const I=function(V){switch(V){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([m.e(58),m.e(59)]).then(m.bind(m,14383))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await m.e(60).then(m.bind(m,14385))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await m.e(61).then(m.bind(m,14388))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await m.e(62).then(m.bind(m,14392))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await m.e(63).then(m.bind(m,14399))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await m.e(64).then(m.bind(m,14402))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await m.e(65).then(m.bind(m,14405))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await m.e(66).then(m.bind(m,14409))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await m.e(67).then(m.bind(m,14413))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await m.e(70).then(m.bind(m,14441))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await m.e(70).then(m.bind(m,14441))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await m.e(70).then(m.bind(m,14441))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await m.e(70).then(m.bind(m,14441))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await m.e(75).then(m.bind(m,14444))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await m.e(76).then(m.bind(m,14450))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await m.e(77).then(m.bind(m,14454))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await m.e(78).then(m.bind(m,14461))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await m.e(79).then(m.bind(m,14469))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await m.e(80).then(m.bind(m,14473))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await m.e(81).then(m.bind(m,14475))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await m.e(82).then(m.bind(m,14484))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await m.e(83).then(m.bind(m,14486))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await m.e(84).then(m.bind(m,14490))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await m.e(85).then(m.bind(m,14492))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await m.e(86).then(m.bind(m,14494))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await m.e(87).then(m.bind(m,14503))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await m.e(88).then(m.bind(m,14507))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await m.e(89).then(m.bind(m,14516))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await m.e(90).then(m.bind(m,14519))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await m.e(91).then(m.bind(m,14526))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await m.e(92).then(m.bind(m,14528))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await m.e(93).then(m.bind(m,14530))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await m.e(72).then(m.bind(m,14537))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await m.e(94).then(m.bind(m,14542))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await m.e(95).then(m.bind(m,14544))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await m.e(96).then(m.bind(m,14547))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await m.e(73).then(m.bind(m,14555))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await m.e(68).then(m.bind(m,14418))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await m.e(74).then(m.bind(m,14563))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await m.e(69).then(m.bind(m,14438))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await m.e(70).then(m.bind(m,14441))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await m.e(70).then(m.bind(m,14441))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await m.e(71).then(m.bind(m,14568))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await m.e(71).then(m.bind(m,14568))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await m.e(71).then(m.bind(m,14568))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await m.e(71).then(m.bind(m,14568))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await m.e(71).then(m.bind(m,14568))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await m.e(71).then(m.bind(m,14568))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await m.e(97).then(m.bind(m,14570))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await m.e(98).then(m.bind(m,14578))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await m.e(99).then(m.bind(m,14583))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await m.e(100).then(m.bind(m,14592))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await m.e(101).then(m.bind(m,14600))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await m.e(102).then(m.bind(m,14605))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await m.e(103).then(m.bind(m,14610))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await m.e(104).then(m.bind(m,14617))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await m.e(105).then(m.bind(m,14623))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await m.e(106).then(m.bind(m,14629))).FlowGraphDataSwitchBlock;default:if(Nm[V])return Nm[V];throw new Error(`Unknown block name ${V}`)}}(V.className);return await I()})));return function(V,I,m){const C=I.coordinator.createGraph(),l=[],s=I.valueParseFunction??bm.e;for(let F=0;F<V.allBlocks.length;F++){const k=Hm(V.allBlocks[F],{OI:I.coordinator.config.OI,pathConverter:I.pathConverter,assetsContainer:I.coordinator.config.OI,valueParseFunction:s},m[F]);l.push(k),k instanceof tm.b&&C.addEventBlock(k)}for(const F of l){for(const V of F.dataInputs)for(const I of V.connectedPointIds){const m=nm(l,I);V.connectTo(m)}if(F instanceof Dm.b)for(const V of F.signalOutputs)for(const I of V.connectedPointIds){const m=xm(l,I);V.connectTo(m)}}for(const F of V.executionContexts)cm(F,{graph:C,valueParseFunction:s},V.rightHanded);return C}(V,I,C)}function cm(V,I,m){const C=I.graph.createContext();V.enableLogging&&(C.enableLogging=!0),C.treatDataAsRightHanded=m||!1;const l=I.valueParseFunction??bm.e;C.uniqueId=V.uniqueId;const s=C.cV();if(V._assetsContext){var F,k,j,E,K,Y,X,O,v,N;const I=V._assetsContext,m={meshes:null===(F=I.meshes)||void 0===F?void 0:F.map((V=>s.getMeshById(V))),lights:null===(k=I.lights)||void 0===k?void 0:k.map((V=>s.getLightByName(V))),cameras:null===(j=I.cameras)||void 0===j?void 0:j.map((V=>s.getCameraByName(V))),materials:null===(E=I.materials)||void 0===E?void 0:E.map((V=>s.getMaterialById(V))),textures:null===(K=I.textures)||void 0===K?void 0:K.map((V=>s.getTextureByName(V))),animations:null===(Y=I.animations)||void 0===Y?void 0:Y.map((V=>s.animations.find((I=>I.name===V)))),skeletons:null===(X=I.skeletons)||void 0===X?void 0:X.map((V=>s.getSkeletonByName(V))),ZY:null===(O=I.ZY)||void 0===O?void 0:O.map((V=>s.getParticleSystemById(V))),animationGroups:null===(v=I.animationGroups)||void 0===v?void 0:v.map((V=>s.getAnimationGroupByName(V))),transformNodes:null===(N=I.transformNodes)||void 0===N?void 0:N.map((V=>s.getTransformNodeById(V))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],KX:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};C.assetsContext=m}for(const t in V._userVariables){const I=l(t,V._userVariables,C.assetsContext,s);C.userVariables[t]=I}for(const t in V._connectionValues){const I=l(t,V._connectionValues,C.assetsContext,s);C._setConnectionValueByKey(t,I)}return C}function Hm(V,I,m){const C={},l=I.valueParseFunction??bm.e;if(V.config)for(const F in V.config)C[F]=l(F,V.config,I.assetsContainer||I.OI,I.OI);if((0,bm.j)(V.className)){if(!I.pathConverter)throw new Error("Path converter is required for this block");C.pathConverter=I.pathConverter}const s=new m(C);s.uniqueId=V.uniqueId;for(let F=0;F<V.dataInputs.length;F++){const I=s.getDataInput(V.dataInputs[F].name);if(!I)throw new Error("Could not find data input with name "+V.dataInputs[F].name+" in block "+V.className);I.deserialize(V.dataInputs[F])}for(let F=0;F<V.dataOutputs.length;F++){const I=s.getDataOutput(V.dataOutputs[F].name);if(!I)throw new Error("Could not find data output with name "+V.dataOutputs[F].name+" in block "+V.className);I.deserialize(V.dataOutputs[F])}return s.metadata=V.metadata,s.deserialize&&s.deserialize(V),s}function ym(V){const[I,m]=V.split(":");return zm({op:I,extension:m})}function zm(V){var I;let m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=V.extension?null===(I=Bm[V.extension])||void 0===I?void 0:I[V.op]:Wm[V.op];if(!C&&(N.d.Warn(`No mapping found for operation ${V.op} and extension ${V.extension||"KHR_interactivity"}`),m)){const I={},m={flows:{}};if(V.inputValueSockets){I.values={};for(const m in V.inputValueSockets)I.values[m]={name:m}}return V.outputValueSockets&&(m.values={},Object.keys(V.outputValueSockets).forEach((V=>{m.values[V]={name:V}}))),{fE:[],inputs:I,outputs:m}}return C}function Zm(V,I,m){Bm[I]||(Bm[I]={}),Bm[I][V]=m}const Bm={BABYLON:{"flow/log":{fE:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Wm={"event/onStart":{fE:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{fE:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{fE:["FlowGraphSendCustomEventBlock"],extraProcessor(V,I,m,C,l){if("event/send"!==I.op||!V.configuration||1!==Object.keys(V.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const s=V.configuration.event.value[0];if("number"!==typeof s)throw new Error("Event id should be a number");const F=C.arrays.events[s],k=l[0];return k.config||(k.config={}),k.config.eventId=F.eventId,k.config.eventData=F.eventData,l}},"event/receive":{fE:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(V,I){var m;if(!V.configuration)return N.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const C=V.configuration.event;if(!C)return N.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const l=C.value[0];if("number"!==typeof l)return N.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(m=I.events)||void 0===m?void 0:m[l])?{valid:!0}:(N.d.Error(`Event with id ${l} not found`),{valid:!1,error:`Event with id ${l} not found`})},extraProcessor(V,I,m,C,l){if("event/receive"!==I.op||!V.configuration||1!==Object.keys(V.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const s=V.configuration.event.value[0];if("number"!==typeof s)throw new Error("Event id should be a number");const F=C.arrays.events[s],k=l[0];return k.config||(k.config={}),k.config.eventId=F.eventId,k.config.eventData=F.eventData,l}},"math/e":Qm("FlowGraphEBlock"),"math/pi":Qm("FlowGraphPIBlock"),"math/inf":Qm("FlowGraphInfBlock"),"math/nan":Qm("FlowGraphNaNBlock"),"math/abs":Qm("FlowGraphAbsBlock"),"math/sign":Qm("FlowGraphSignBlock"),"math/trunc":Qm("FlowGraphTruncBlock"),"math/floor":Qm("FlowGraphFloorBlock"),"math/ceil":Qm("FlowGraphCeilBlock"),"math/round":{fE:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l){var s;return(s=l[0]).config||(s.config={}),l[0].config.roundHalfAwayFromZero=!0,l}},"math/fract":Qm("FlowGraphFractBlock"),"math/neg":Qm("FlowGraphNegationBlock"),"math/add":Qm("FlowGraphAddBlock",["a","b"],!0),"math/sub":Qm("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{fE:["FlowGraphMultiplyBlock"],extraProcessor(V,I,m,C,l){var s;(s=l[0]).config||(s.config={}),l[0].config.useMatrixPerComponent=!0,l[0].config.preventIntegerFloatArithmetic=!0;let F=-1;return Object.keys(V.values||{}).find((I=>{var m;return void 0!==(null===(m=V.values)||void 0===m?void 0:m[I].type)&&(F=V.values[I].type,!0)})),-1!==F&&(l[0].config.type=C.arrays.types[F].flowGraphType),l},validation:V=>V.values?Gm(V):{valid:!0}},"math/div":Qm("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Qm("FlowGraphModuloBlock",["a","b"]),"math/min":Qm("FlowGraphMinBlock",["a","b"]),"math/max":Qm("FlowGraphMaxBlock",["a","b"]),"math/clamp":Qm("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Qm("FlowGraphSaturateBlock"),"math/mix":Qm("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Qm("FlowGraphEqualityBlock",["a","b"]),"math/lt":Qm("FlowGraphLessThanBlock",["a","b"]),"math/le":Qm("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Qm("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Qm("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Qm("FlowGraphIsNaNBlock"),"math/isinf":Qm("FlowGraphIsInfBlock"),"math/select":{fE:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{fE:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Qm("FlowGraphSinBlock"),"math/cos":Qm("FlowGraphCosBlock"),"math/tan":Qm("FlowGraphTanBlock"),"math/asin":Qm("FlowGraphASinBlock"),"math/acos":Qm("FlowGraphACosBlock"),"math/atan":Qm("FlowGraphATanBlock"),"math/atan2":Qm("FlowGraphATan2Block",["a","b"]),"math/sinh":Qm("FlowGraphSinhBlock"),"math/cosh":Qm("FlowGraphCoshBlock"),"math/tanh":Qm("FlowGraphTanhBlock"),"math/asinh":Qm("FlowGraphASinhBlock"),"math/acosh":Qm("FlowGraphACoshBlock"),"math/atanh":Qm("FlowGraphATanhBlock"),"math/exp":Qm("FlowGraphExponentialBlock"),"math/log":Qm("FlowGraphLogBlock"),"math/log2":Qm("FlowGraphLog2Block"),"math/log10":Qm("FlowGraphLog10Block"),"math/sqrt":Qm("FlowGraphSquareRootBlock"),"math/cbrt":Qm("FlowGraphCubeRootBlock"),"math/pow":Qm("FlowGraphPowerBlock",["a","b"]),"math/length":Qm("FlowGraphLengthBlock"),"math/normalize":Qm("FlowGraphNormalizeBlock"),"math/dot":Qm("FlowGraphDotBlock",["a","b"]),"math/cross":Qm("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Qm("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Qm("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{fE:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{fE:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{fE:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{fE:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{fE:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{fE:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{fE:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Qm("FlowGraphTransposeBlock"),"math/determinant":Qm("FlowGraphDeterminantBlock"),"math/inverse":Qm("FlowGraphInvertMatrixBlock"),"math/matmul":Qm("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{fE:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Vk",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l,s){const F=l[0].dataInputs.find((V=>"rotationQuaternion"===V.name));if(!F)throw new Error("Rotation quaternion input not found");return s._connectionValues[F.uniqueId]&&(s._connectionValues[F.uniqueId].type="Quaternion"),l}},"math/matDecompose":{fE:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Vk"}}}},"math/quatConjugate":Qm("FlowGraphConjugateBlock",["a"]),"math/quatMul":{fE:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l){var s;return(s=l[0]).config||(s.config={}),l[0].config.type="Quaternion",l}},"math/quatAngleBetween":Qm("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{fE:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Qm("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Qm("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{fE:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l){var s;return(s=l[0]).config||(s.config={}),l[0].config.inputIsColumnMajor=!0,l}},"math/extract2x2":{fE:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{fE:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l){var s;return(s=l[0]).config||(s.config={}),l[0].config.inputIsColumnMajor=!0,l}},"math/extract3x3":{fE:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{fE:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l){var s;return(s=l[0]).config||(s.config={}),l[0].config.inputIsColumnMajor=!0,l}},"math/extract4x4":{fE:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{fE:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l,s){var F,k;(k=l[0]).config||(k.config={});const j=l[0].dataInputs[0];return l[0].config.valueType=(null===(F=s._connectionValues[j.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",l}},"math/and":{fE:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l,s){var F,k,j;(j=l[0]).config||(j.config={});const E=l[0].dataInputs[0],K=l[0].dataInputs[1];return l[0].config.valueType=(null===(F=s._connectionValues[E.uniqueId])||void 0===F?void 0:F.type)??(null===(k=s._connectionValues[K.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",l}},"math/or":{fE:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l,s){var F,k,j;(j=l[0]).config||(j.config={});const E=l[0].dataInputs[0],K=l[0].dataInputs[1];return l[0].config.valueType=(null===(F=s._connectionValues[E.uniqueId])||void 0===F?void 0:F.type)??(null===(k=s._connectionValues[K.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",l}},"math/xor":{fE:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,m,C,l,s){var F,k,j;(j=l[0]).config||(j.config={});const E=l[0].dataInputs[0],K=l[0].dataInputs[1];return l[0].config.valueType=(null===(F=s._connectionValues[E.uniqueId])||void 0===F?void 0:F.type)??(null===(k=s._connectionValues[K.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",l}},"math/asr":Qm("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Qm("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Qm("FlowGraphLeadingZerosBlock"),"math/ctz":Qm("FlowGraphTrailingZerosBlock"),"math/popcnt":Qm("FlowGraphOneBitsCounterBlock"),"math/rad":Qm("FlowGraphDegToRadBlock"),"math/deg":Qm("FlowGraphRadToDegBlock"),"type/boolToInt":Qm("FlowGraphBooleanToInt"),"type/boolToFloat":Qm("FlowGraphBooleanToFloat"),"type/intToBool":Qm("FlowGraphIntToBoolean"),"type/intToFloat":Qm("FlowGraphIntToFloat"),"type/floatToInt":Qm("FlowGraphFloatToInt"),"type/floatToBool":Qm("FlowGraphFloatToBoolean"),"flow/sequence":{fE:["FlowGraphSequenceBlock"],extraProcessor(V,I,m,C,l){const s=l[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(V.flows||[]).length,s.signalOutputs.forEach(((V,I)=>{V.name="out_"+I})),l}},"flow/branch":{fE:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{fE:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(V){if(V.configuration&&V.configuration.cases){const I=V.configuration.cases.value;if(!I.every((V=>"number"===typeof V&&/^-?\d+$/.test(V.toString()))))return N.d.Warn("Switch cases should be integers. Using empty array instead."),V.configuration.cases.value=[],{valid:!0};const m=new Set(I);V.configuration.cases.value=Array.from(m)}return{valid:!0}},extraProcessor(V,I,m,C,l){if("flow/switch"!==I.op||!V.flows||0===Object.keys(V.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return l[0].signalOutputs.forEach((V=>{"default"!==V.name&&(V.name="out_"+V.name)})),l}},"flow/while":{fE:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{fE:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(V,I,m,C,l){const s=l[0];return s.config||(s.config={}),s.config.incrementIndexWhenLoopDone=!0,l}},"flow/doN":{fE:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{fE:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(V,I,m,C,l){if("flow/multiGate"!==I.op||!V.flows||0===Object.keys(V.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const s=l[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(V.flows).length,s.signalOutputs.forEach(((V,I)=>{V.name="out_"+I})),l}},"flow/waitAll":{fE:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(V){var I,m;return"number"!==typeof(null===(I=V.configuration)||void 0===I||null===(m=I.inputFlows)||void 0===m?void 0:m.value[0])&&(V.configuration=V.configuration||{inputFlows:{value:[0]}},V.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{fE:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{fE:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{fE:["FlowGraphCancelDelayBlock"]},"variable/get":{fE:["FlowGraphGetVariableBlock"],validation(V){var I,m;return null!==(I=V.configuration)&&void 0!==I&&null!==(m=I.variable)&&void 0!==m&&m.value?{valid:!0}:(N.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(V,I)=>[I.getVariableName(V[0])]}}},"variable/set":{fE:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(V,I)=>[I.getVariableName(V[0])]}}},"variable/setMultiple":{fE:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(V,I)=>[V[0].map((V=>I.getVariableName(V)))]}},extraProcessor:(V,I,m,C,l)=>(l[0].dataInputs.forEach((V=>{V.name=C.getVariableName(+V.name)})),l)},"variable/interpolate":{fE:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(V,I)=>[I.getVariableName(V[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:V=>!0===V[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ym:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ym:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ym:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ym:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ym:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ym:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(V,I,m,C,l){var s,F,k;const j=l[0],E=null===(s=V.configuration)||void 0===s?void 0:s.variable.value[0];if("number"!==typeof E)throw N.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const K=C.arrays.staticVariables[E];"undefined"===typeof j.config.animationType.value&&(C.arrays.staticVariables,j.config.animationType.value=(0,Tm.F)(K.type));const Y=l[4];return Y.config||(Y.config={}),(F=Y.config).variable||(F.variable={}),Y.config.variable.value=C.getVariableName(E),(k=l[3]).config||(k.config={}),l}},"pointer/get":{fE:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ym:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Ym:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,I,m,C,l)=>(l.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className&&(V.config||(V.config={}),V.config.outputValue=!0)})),l)},"pointer/set":{fE:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ym:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Ym:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,I,m,C,l)=>(l.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className&&(V.config||(V.config={}),V.config.outputValue=!0)})),l)},"pointer/interpolate":{fE:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Ym:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Ym:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ym:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ym:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ym:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ym:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ym:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ym:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,I,m,C,l)=>(l.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className?(I.config||(I.config={}),I.config.outputValue=!0):"FlowGraphInterpolationBlock"===I.className&&(I.config||(I.config={}),Object.keys(V.values||[]).forEach((m=>{var l;const s=null===(l=V.values)||void 0===l?void 0:l[m];if("value"===m&&s){const V=s.type;void 0!==V&&(I.config.animationType=C.arrays.types[V].flowGraphType)}})))})),l)},"animation/start":{fE:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ym:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(V,I)=>[V[0]*I._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(V,I)=>[V[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,I,m,C,l,s,F){const k=l[l.length-1];return k.config||(k.config={}),k.config.glTF=F,l}},"animation/stop":{fE:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ym:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,I,m,C,l,s,F){const k=l[l.length-1];return k.config||(k.config={}),k.config.glTF=F,l}},"animation/stopAt":{fE:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Ym:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(V,I)=>[V[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,I,m,C,l,s,F){const k=l[l.length-1];return k.config||(k.config={}),k.config.glTF=F,l}},"math/switch":{fE:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(V){if(V.configuration&&V.configuration.cases){const I=V.configuration.cases.value;if(!I.every((V=>"number"===typeof V&&/^-?\d+$/.test(V.toString()))))return N.d.Warn("Switch cases should be integers. Using empty array instead."),V.configuration.cases.value=[],{valid:!0};const m=new Set(I);V.configuration.cases.value=Array.from(m)}return{valid:!0}},extraProcessor(V,I,m,C,l){const s=l[0];return s.dataInputs.forEach((V=>{"default"!==V.name&&"case"!==V.name&&(V.name="in_"+V.name)})),s.config||(s.config={}),s.config.treatCasesAsIntegers=!0,l}},"debug/log":{fE:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Qm(V){let I=arguments.length>2?arguments[2]:void 0;return{fE:[V],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((V,I)=>(V[I]={name:I},V)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(V,m,C,l,s){var F;if(I){(F=s[0]).config||(F.config={}),s[0].config.preventIntegerFloatArithmetic=!0;let I=-1;Object.keys(V.values||{}).find((m=>{var C;return void 0!==(null===(C=V.values)||void 0===C?void 0:C[m].type)&&(I=V.values[m].type,!0)})),-1!==I&&(s[0].config.type=l.arrays.types[I].flowGraphType)}return s},validation:V=>I?Gm(V):{valid:!0}}}function Gm(V){if(V.values){const I=Object.keys(V.values).map((I=>V.values[I].type)).filter((V=>void 0!==V));if(!I.every((V=>V===I[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Wm["math/compose"]=Wm["math/matCompose"],Wm["math/decompose"]=Wm["math/matDecompose"];var rm=m(11188);const gm={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"LF",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class hm{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=V,this._gltf=I,this._animationTargetFps=m,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const V of this._interactivityGraph.types)this._types.push(gm[V.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const V of this._interactivityGraph.declarations){const I=zm(V);if(!I)throw N.d.Error(["No mapping found for declaration",V]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:I,fullOperationName:V.extension?V.op+":"+V.extension:V.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const V of this._interactivityGraph.variables){const I=this._parseVariable(V);this._staticVariables.push(I)}}_parseVariable(V,I){const m=this._types[V.type];if(!m)throw N.d.Error(["No type found for variable",V]),new Error("Error parsing variables");if(V.value&&V.value.length!==m.length)throw N.d.Error(["Invalid value length for variable",V,m]),new Error("Error parsing variables");const C=V.value||[];if(!C.length)switch(m.flowGraphType){case"boolean":C.push(!1);break;case"FlowGraphInteger":C.push(0);break;case"number":C.push(NaN);break;case"Vector2":C.push(NaN,NaN);break;case"LF":C.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":C.fill(NaN,0,4);break;case"Matrix":C.fill(NaN,0,16);break;case"Matrix3D":C.fill(NaN,0,9)}return"number"===m.elementType&&"string"===typeof C[0]&&(C[0]=parseFloat(C[0])),{type:m.flowGraphType,value:I?I(C,this):C}}_parseEvents(){if(this._interactivityGraph.events)for(const V of this._interactivityGraph.events){const I={eventId:V.id||"internalEvent_"+this._internalEventsCounter++};V.values&&(I.eventData=Object.keys(V.values).map((I=>{var m;const C=null===(m=V.values)||void 0===m?void 0:m[I];if(!C)throw N.d.Error(["No value found for event key",I]),new Error("Error parsing events");const l=this._types[C.type];if(!l)throw N.d.Error(["No type found for event value",C]),new Error("Error parsing events");const s="undefined"!==typeof C.value?this._parseVariable(C):void 0;return{id:I,type:l.flowGraphType,eventData:!0,value:s}}))),this._events.push(I)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const I of this._interactivityGraph.nodes){if("number"!==typeof I.declaration)throw N.d.Error(["No declaration found for node",I]),new Error("Error parsing nodes");const m=this._mappings[I.declaration];if(!m)throw N.d.Error(["No mapping found for node",I]),new Error("Error parsing nodes");if(m.flowGraphMapping.validation){const C=m.flowGraphMapping.validation(I,this._interactivityGraph,this._gltf);var V;if(!C.valid)throw new Error(`Error validating interactivity node ${null===(V=this._interactivityGraph.declarations)||void 0===V?void 0:V[I.declaration].op} - ${C.error}`)}const C=[];for(const V of m.flowGraphMapping.fE){const l=this._getEmptyBlock(V,m.fullOperationName);this._parseNodeConfiguration(I,l,m.flowGraphMapping,V),C.push(l)}this._nodes.push({fE:C,fullOperationName:m.fullOperationName})}}_getEmptyBlock(V,I){return{uniqueId:(0,rm.d)(),className:V,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:I,metadata:{}}}_parseNodeConfiguration(V,I,m,C){const l=I.config;if(V.configuration){const I=Object.keys(V.configuration);for(const k of I){var s,F;const I=null===(s=V.configuration)||void 0===s?void 0:s[k];if(!I)throw N.d.Error(["No value found for node configuration",k]),new Error("Error parsing node configuration");const j=null===(F=m.configuration)||void 0===F?void 0:F[k];if(j&&j.Ym?j.Ym===C:0===m.fE.indexOf(C)){const V=(null===j||void 0===j?void 0:j.name)||k;I&&"undefined"!==typeof I.value||"undefined"===typeof(null===j||void 0===j?void 0:j.defaultValue)?I.value.length>=0?l[V]={value:1===I.value.length?I.value[0]:I.value}:N.d.Warn(["Invalid value for node configuration",I]):l[V]={value:j.defaultValue},j&&j.dataTransformer&&(l[V].value=j.dataTransformer([l[V].value],this)[0])}}}}_parseNodeConnections(V){for(let S=0;S<this._nodes.length;S++){var I;const c=null===(I=this._interactivityGraph.nodes)||void 0===I?void 0:I[S];if(!c)throw N.d.Error(["No node found for interactivity node",this._nodes[S]]),new Error("Error parsing node connections");const H=this._nodes[S],y=this._mappings[c.declaration];if(!y)throw N.d.Error(["No mapping found for node",c]),new Error("Error parsing node connections");const z=c.flows||{},Z=Object.keys(z).sort();for(const V of Z){var m,C,l,s;const I=z[V],E=null===(m=y.flowGraphMapping.outputs)||void 0===m||null===(C=m.flows)||void 0===C?void 0:C[V],K=(null===E||void 0===E?void 0:E.name)||V,Y=this._createNewSocketConnection(K,!0);(E&&E.Ym&&H.fE.find((V=>V.className===E.Ym))||H.fE[0]).signalOutputs.push(Y);const X=I.node,O=this._nodes[X];if(!O)throw N.d.Error(["No node found for input node id",X]),new Error("Error parsing node connections");const v=ym(O.fullOperationName);if(!v)throw N.d.Error(["No mapping found for input node",O]),new Error("Error parsing node connections");let t=null===(l=v.inputs)||void 0===l||null===(s=l.flows)||void 0===s?void 0:s[I.socket||"in"],D=!1;if(!t)for(const V in null===(F=v.inputs)||void 0===F?void 0:F.flows){var F,k,j;if(V.startsWith("[")&&V.endsWith("]"))D=!0,t=null===(k=v.inputs)||void 0===k||null===(j=k.flows)||void 0===j?void 0:j[V]}const b=t?D?t.name.replace("$1",I.socket||""):t.name:I.socket||"in",T=t&&t.Ym&&O.fE.find((V=>V.className===t.Ym))||O.fE[0];let n=T.signalInputs.find((V=>V.name===b));n||(n=this._createNewSocketConnection(b),T.signalInputs.push(n)),n.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(n.uniqueId)}const B=c.values||{},W=Object.keys(B);for(const I of W){var E,K;const m=B[I];let C=null===(E=y.flowGraphMapping.inputs)||void 0===E||null===(K=E.values)||void 0===K?void 0:K[I],l=!1;if(!C)for(const V in null===(Y=y.flowGraphMapping.inputs)||void 0===Y?void 0:Y.values){var Y,X,O;if(V.startsWith("[")&&V.endsWith("]"))l=!0,C=null===(X=y.flowGraphMapping.inputs)||void 0===X||null===(O=X.values)||void 0===O?void 0:O[V]}const s=C?l?C.name.replace("$1",I):C.name:I,F=this._createNewSocketConnection(s);if((C&&C.Ym&&H.fE.find((V=>V.className===C.Ym))||H.fE[0]).dataInputs.push(F),void 0!==m.value){const I=this._parseVariable(m,C&&C.dataTransformer);V._connectionValues[F.uniqueId]=I}else{if("undefined"===typeof m.node)throw N.d.Error(["Invalid value for value connection",m]),new Error("Error parsing node connections");{var v,t,D;const V=m.node,I=m.socket||"value",C=this._nodes[V];if(!C)throw N.d.Error(["No node found for output socket reference",m]),new Error("Error parsing node connections");const l=ym(C.fullOperationName);if(!l)throw N.d.Error(["No mapping found for output socket reference",m]),new Error("Error parsing node connections");let s=null===(v=l.outputs)||void 0===v||null===(t=v.values)||void 0===t?void 0:t[I],k=!1;if(!s)for(const m in null===(b=l.outputs)||void 0===b?void 0:b.values){var b,T,n;if(m.startsWith("[")&&m.endsWith("]"))k=!0,s=null===(T=l.outputs)||void 0===T||null===(n=T.values)||void 0===n?void 0:n[m]}const j=s?k?s.name.replace("$1",I):null===(D=s)||void 0===D?void 0:D.name:I,E=s&&s.Ym&&C.fE.find((V=>V.className===s.Ym))||C.fE[0];let K=E.dataOutputs.find((V=>V.name===j));K||(K=this._createNewSocketConnection(j,!0),E.dataOutputs.push(K)),F.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(F.uniqueId)}}}if(y.flowGraphMapping.interBlockConnectors)for(const V of y.flowGraphMapping.interBlockConnectors){const I=V.input,m=V.output,C=V.isVariable;this._connectFlowGraphNodes(I,m,H.fE[V.inputBlockIndex],H.fE[V.outputBlockIndex],C)}if(y.flowGraphMapping.extraProcessor){var x;const I=null===(x=this._interactivityGraph.declarations)||void 0===x?void 0:x[c.declaration];if(!I)throw N.d.Error(["No declaration found for extra processor",c]),new Error("Error parsing node connections");H.fE=y.flowGraphMapping.extraProcessor(c,I,y.flowGraphMapping,this,H.fE,V,this._gltf)}}}_createNewSocketConnection(V,I){return{uniqueId:(0,rm.d)(),name:V,_connectionType:I?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(V,I,m,C,l){const s=l?m.dataInputs:m.signalInputs,F=l?C.dataOutputs:C.signalOutputs,k=s.find((I=>I.name===V))||this._createNewSocketConnection(V),j=F.find((V=>V.name===I))||this._createNewSocketConnection(I,!0);s.find((I=>I.name===V))||s.push(k),F.find((V=>V.name===I))||F.push(j),k.connectedPointIds.push(j.uniqueId),j.connectedPointIds.push(k.uniqueId)}getVariableName(V){return"staticVariable_"+V}serializeToFlowGraph(){const V={uniqueId:(0,rm.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(V);for(let I=0;I<this._staticVariables.length;I++){const m=this._staticVariables[I];V._userVariables[this.getVariableName(I)]=m}return{rightHanded:!0,allBlocks:this._nodes.reduce(((V,I)=>V.concat(I.fE)),[]),executionContexts:[V]}}}const dm="KHR_interactivity";class Rm{constructor(V){this._loader=V,this.name=dm,this.enabled=this._loader.isExtensionUsed(dm),this._pathConverter=(0,i.d)(this._loader.sk),V._skipStartAnimationStep=!0;const I=V.babylonScene;I&&function(V){(0,i.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!V.activeCamera)return new l.e(NaN,NaN,NaN,NaN);const I=l.e.FromRotationMatrix(V.activeCamera.getWorldMatrix()).normalize();return V.useRightHandedSystem||(I.w*=-1,I.x*=-1),I},type:"Quaternion",getTarget:()=>V.activeCamera}),(0,i.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!V.activeCamera)return new l.m(NaN,NaN,NaN);const I=V.activeCamera.getWorldMatrix().getTranslation();return V.useRightHandedSystem||(I.x*=-1),I},type:"LF",getTarget:()=>V.activeCamera}),(0,i.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:V=>{var I;return(null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.isPlaying)??!1},type:"boolean",getTarget:V=>V._babylonAnimationGroup}),(0,i.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.from)??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,i.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.to)??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,i.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,i.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup})}(I)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var V;if(!this._loader.babylonScene||!this._pathConverter)return;const I=this._loader.babylonScene,m=null===(V=this._loader.sk.extensions)||void 0===V?void 0:V.KHR_interactivity;if(!m)return;const C=new vm.c({OI:I});C.dispatchEventsSynchronously=!1;const l=m.graphs.map((V=>new hm(V,this._loader.sk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(l.map((async V=>await Sm(V,{coordinator:C,pathConverter:this._pathConverter})))),C.start()}}var im;im=async()=>(await Promise.resolve().then(m.bind(m,12942))).FlowGraphGLTFDataProvider,Nm[`${dm}/${"FlowGraphGLTFDataProvider"}`]=im,R(dm),d(dm,!0,(V=>new Rm(V)));const qm="KHR_node_visibility";(0,i.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:V=>{const I=V._babylonTransformNode;return!I||void 0===I.isVisible||I.isVisible},set:(V,I)=>{var m,C;null===(m=I._primitiveBabylonMeshes)||void 0===m||m.forEach((V=>{V.inheritVisibility=!0})),I._babylonTransformNode&&(I._babylonTransformNode.isVisible=V),null===(C=I._primitiveBabylonMeshes)||void 0===C||C.forEach((I=>{I.isVisible=V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Pm{constructor(V){this.name=qm,this._loader=V,this.enabled=V.isExtensionUsed(qm)}async onReady(){var V;null===(V=this._loader.sk.nodes)||void 0===V||V.forEach((V=>{var I,m,C,l;(null===(I=V._primitiveBabylonMeshes)||void 0===I||I.forEach((V=>{V.inheritVisibility=!0})),null!==(m=V.extensions)&&void 0!==m&&m.KHR_node_visibility)&&(!1===(null===(C=V.extensions)||void 0===C?void 0:C.KHR_node_visibility.visible)&&(V._babylonTransformNode&&(V._babylonTransformNode.isVisible=!1),null===(l=V._primitiveBabylonMeshes)||void 0===l||l.forEach((V=>{V.isVisible=!1}))))}))}dispose(){this._loader=null}}R(qm),d(qm,!0,(V=>new Pm(V)));const um="KHR_node_selectability";Zm("event/onSelect",um,{fE:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ym:"FlowGraphGetVariableBlock",dataTransformer:V=>["pickedMesh_"+V[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Ym:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,I,m,C,l,s,F){var k,j,E,K,Y,X;const O=l[l.length-1];O.config=O.config||{},O.config.glTF=F;const v=null===(k=V.configuration)||void 0===k||null===(j=k.nodeIndex)||void 0===j?void 0:j.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const N="pickedMesh_"+v;return l[1].config.variable=N,s._userVariables[N]={className:"Mesh",id:null===F||void 0===F||null===(E=F.nodes)||void 0===E||null===(K=E[v]._babylonTransformNode)||void 0===K?void 0:K.id,uniqueId:null===F||void 0===F||null===(Y=F.nodes)||void 0===Y||null===(X=Y[v]._babylonTransformNode)||void 0===X?void 0:X.uniqueId},l}}),(0,i.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:V=>{const I=V._babylonTransformNode;return!I||void 0===I.Tj||I.Tj},set:(V,I)=>{var m;null===(m=I._primitiveBabylonMeshes)||void 0===m||m.forEach((I=>{I.Tj=V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"Tj"],type:"boolean"});class om{constructor(V){this.name=um,this._loader=V,this.enabled=V.isExtensionUsed(um)}async onReady(){var V;null===(V=this._loader.sk.nodes)||void 0===V||V.forEach((V=>{var I,m,C;null!==(I=V.extensions)&&void 0!==I&&I.KHR_node_selectability&&!1===(null===(m=V.extensions)||void 0===m?void 0:m.KHR_node_selectability.selectable)&&(null===(C=V._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((V=>{V.Tj=!1})))}))}dispose(){this._loader=null}}R(um),d(um,!0,(V=>new om(V)));const pm="KHR_node_hoverability",Mm="targetMeshPointerOver_";Zm("event/onHoverIn",pm,{fE:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ym:"FlowGraphGetVariableBlock",dataTransformer:V=>[Mm+V[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ym:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,I,m,C,l,s,F){var k,j,E,K,Y,X;const O=l[l.length-1];O.config=O.config||{},O.config.glTF=F;const v=null===(k=V.configuration)||void 0===k||null===(j=k.nodeIndex)||void 0===j?void 0:j.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const N=Mm+v;return l[1].config.variable=N,s._userVariables[N]={className:"Mesh",id:null===F||void 0===F||null===(E=F.nodes)||void 0===E||null===(K=E[v]._babylonTransformNode)||void 0===K?void 0:K.id,uniqueId:null===F||void 0===F||null===(Y=F.nodes)||void 0===Y||null===(X=Y[v]._babylonTransformNode)||void 0===X?void 0:X.uniqueId},l}});const fm="targetMeshPointerOut_";Zm("event/onHoverOut",pm,{fE:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ym:"FlowGraphGetVariableBlock",dataTransformer:V=>[fm+V[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ym:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,I,m,C,l,s,F){var k,j,E,K,Y,X;const O=l[l.length-1];O.config=O.config||{},O.config.glTF=F;const v=null===(k=V.configuration)||void 0===k||null===(j=k.nodeIndex)||void 0===j?void 0:j.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const N=fm+v;return l[1].config.variable=N,s._userVariables[N]={className:"Mesh",id:null===F||void 0===F||null===(E=F.nodes)||void 0===E||null===(K=E[v]._babylonTransformNode)||void 0===K?void 0:K.id,uniqueId:null===F||void 0===F||null===(Y=F.nodes)||void 0===Y||null===(X=Y[v]._babylonTransformNode)||void 0===X?void 0:X.uniqueId},l}}),(0,i.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:V=>{const I=V._babylonTransformNode;return!I||void 0===I.pointerOverDisableMeshTesting||I.pointerOverDisableMeshTesting},set:(V,I)=>{var m;null===(m=I._primitiveBabylonMeshes)||void 0===m||m.forEach((I=>{I.pointerOverDisableMeshTesting=!V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class wm{constructor(V){this.name=pm,this._loader=V,this.enabled=V.isExtensionUsed(pm)}async onReady(){var V;null===(V=this._loader.sk.nodes)||void 0===V||V.forEach((V=>{var I,m,C;null!==(I=V.extensions)&&void 0!==I&&I.KHR_node_hoverability&&!1===(null===(m=V.extensions)||void 0===m?void 0:m.KHR_node_hoverability.hoverable)&&(null===(C=V._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((V=>{V.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}R(pm),d(pm,!0,(V=>new wm(V)));const Am="ExtrasAsMetadata";class Jm{_assignExtras(V,I){if(I.extras&&Object.keys(I.extras).length>0){const m=V.metadata=V.metadata||{};(m.sk=m.sk||{}).extras=I.extras}}constructor(V){this.name=Am,this.enabled=!0,this._loader=V}dispose(){this._loader=null}loadNodeAsync(V,I,m){return this._loader.loadNodeAsync(V,I,(V=>{this._assignExtras(V,I),m(V)}))}loadCameraAsync(V,I,m){return this._loader.loadCameraAsync(V,I,(V=>{this._assignExtras(V,I),m(V)}))}createMaterial(V,I,m){const C=this._loader.createMaterial(V,I,m);return this._assignExtras(C,I),C}}R(Am),d(Am,!1,(V=>new Jm(V)));m(12942)},12828:(V,I,m)=>{"use strict";m.d(I,{b:()=>G,f:()=>y,g:()=>H,h:()=>z});var C=m(11067),l=m(11076),s=m(12443),F=m(11384),k=m(11332),j=m(11342),E=m(11085),K=m(11061),Y=m(11380),X=m(11708),O=m(11386),v=m(11305);class N{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ZY=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.KX=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture=V}getNodes(){let V=[];V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes);for(const I of this.skeletons)V=V.concat(I.bones);return V}}class t extends N{}class D{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const V=this.rootNodes;for(const C of V)C.dispose();V.length=0;const I=this.skeletons;for(const C of I)C.dispose();I.length=0;const m=this.animationGroups;for(const C of m)C.dispose();m.length=0}}class b extends N{constructor(V){super(),this._wasAddedToScene=!1,(V=V||K.c.LastCreatedScene)&&(this.OI=V,this.proceduralTextures=[],V.Ck.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=V.getEngine().onContextRestoredObservable.add((()=>{for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();for(const V of this.ZY)V.rebuild();for(const V of this.textures)V._rebuild()})))}_topologicalSort(V){const I=new Map;for(const F of V)I.set(F.uniqueId,F);const m={dependsOn:new Map,dependedBy:new Map};for(const F of V){const V=F.uniqueId;m.dependsOn.set(V,new Set),m.dependedBy.set(V,new Set)}for(const F of V){const V=F.uniqueId,C=m.dependsOn.get(V);if(F instanceof Y.c){const l=F.sourceMesh;I.has(l.uniqueId)&&(C.add(l.uniqueId),m.dependedBy.get(l.uniqueId).add(V))}const l=m.dependedBy.get(V);for(const s of F.getDescendants()){const C=s.uniqueId;if(I.has(C)){l.add(C);m.dependsOn.get(C).add(V)}}}const C=[],l=[];for(const F of V){const V=F.uniqueId;0===m.dependsOn.get(V).size&&(l.push(F),I.delete(V))}const s=l;for(;s.length>0;){const V=s.shift();C.push(V);const l=m.dependedBy.get(V.uniqueId);for(const C of Array.from(l.values())){const l=m.dependsOn.get(C);l.delete(V.uniqueId),0===l.size&&I.get(C)&&(s.push(I.get(C)),I.delete(C))}}return I.size>0&&(E.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),I.forEach((V=>{E.d.Error(V.name)}))),C}_addNodeAndDescendantsToList(V,I,m,C){if(m&&(!C||C(m))&&!I.has(m.uniqueId)){V.push(m),I.add(m.uniqueId);for(const l of m.getDescendants(!0))this._addNodeAndDescendantsToList(V,I,l,C)}}_isNodeInContainer(V){return V instanceof j.e&&-1!==this.meshes.indexOf(V)||(V instanceof k.c&&-1!==this.transformNodes.indexOf(V)||(V instanceof X.d&&-1!==this.lights.indexOf(V)||V instanceof O.c&&-1!==this.cameras.indexOf(V)))}_isValidHierarchy(){for(const V of this.meshes)if(V.parent&&!this._isNodeInContainer(V.parent))return E.d.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.transformNodes)if(V.parent&&!this._isNodeInContainer(V.parent))return E.d.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.lights)if(V.parent&&!this._isNodeInContainer(V.parent))return E.d.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.cameras)if(V.parent&&!this._isNodeInContainer(V.parent))return E.d.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||l.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const C={},s={},k=new D,j=[],E=[],K={doNotInstantiate:!0,...m},Y=[],X=new Set;for(const l of this.transformNodes)null===l.parent&&this._addNodeAndDescendantsToList(Y,X,l,K.predicate);for(const l of this.meshes)null===l.parent&&this._addNodeAndDescendantsToList(Y,X,l,K.predicate);const O=this._topologicalSort(Y),v=(m,l)=>{if(((I,m)=>{if(C[I.uniqueId]=m.uniqueId,s[m.uniqueId]=m,V&&(m.name=V(I.name)),m instanceof F.c){const V=m;if(V.morphTargetManager){const m=I.morphTargetManager;V.morphTargetManager=m.clone();for(let I=0;I<m.numTargets;I++){const l=m.getTarget(I),F=V.morphTargetManager.getTarget(I);C[l.uniqueId]=F.uniqueId,s[F.uniqueId]=F}}}})(m,l),m.parent){const V=C[m.parent.uniqueId],I=s[V];l.parent=I||m.parent}if(l.position&&m.position&&l.position.C(m.position),l.rotationQuaternion&&m.rotationQuaternion&&l.rotationQuaternion.C(m.rotationQuaternion),l.rotation&&m.rotation&&l.rotation.C(m.rotation),l.Vk&&m.Vk&&l.Vk.C(m.Vk),l.material){const F=l;if(F.material)if(I){const I=m.material;if(-1===E.indexOf(I)){let m=I.clone(V?V(I.name):"Clone of "+I.name);if(E.push(I),C[I.uniqueId]=m.uniqueId,s[m.uniqueId]=m,"MultiMaterial"===I.getClassName()){const l=I;for(const I of l.jk)I&&(m=I.clone(V?V(I.name):"Clone of "+I.name),E.push(I),C[I.uniqueId]=m.uniqueId,s[m.uniqueId]=m);l.jk=l.jk.map((V=>V&&s[C[V.uniqueId]]))}}"InstancedMesh"!==F.getClassName()&&(F.material=s[C[I.uniqueId]])}else"MultiMaterial"===F.material.getClassName()?-1===this.OI.multiMaterials.indexOf(F.material)&&this.OI.addMultiMaterial(F.material):-1===this.OI.materials.indexOf(F.material)&&this.OI.addMaterial(F.material)}null===l.parent&&k.rootNodes.push(l)};for(const l of O)if("InstancedMesh"===l.getClassName()){const V=l,I=V.sourceMesh,m=C[I.uniqueId];v(V,("number"===typeof m?s[m]:I).createInstance(V.name))}else{let V=!0;"Sv"===l.getClassName()||"Node"===l.getClassName()||l.skeleton||!l.getTotalVertices||0===l.getTotalVertices()?V=!1:K.doNotInstantiate&&(V="function"===typeof K.doNotInstantiate?!K.doNotInstantiate(l):!K.doNotInstantiate);const I=V?l.createInstance(`instance of ${l.name}`):l.clone(`Clone of ${l.name}`,null,!0);if(!I)throw new Error(`Could not clone or instantiate node on Asset Container ${l.name}`);v(l,I)}for(const l of this.skeletons){if(K.predicate&&!K.predicate(l))continue;const I=l.clone(V?V(l.name):"Clone of "+l.name);for(const V of this.meshes)if(V.skeleton===l&&!V.isAnInstance){const m=s[C[V.uniqueId]];if(!m||m.isAnInstance)continue;if(m.skeleton=I,-1!==j.indexOf(I))continue;j.push(I);for(const V of I.bones)V._linkedTransformNode&&(V._linkedTransformNode=s[C[V._linkedTransformNode.uniqueId]])}k.skeletons.push(I)}for(const l of this.animationGroups){if(K.predicate&&!K.predicate(l))continue;const I=l.clone(V?V(l.name):"Clone of "+l.name,(V=>s[C[V.uniqueId]]||V));k.animationGroups.push(I)}return k}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||l.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.OI.environmentTexture=this.environmentTexture);for(const V of this.OI._serializableComponents)V.addFromContainer(this);this.OI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=[];for(const m of this.cameras)V&&!V(m)||(this.OI.addCamera(m),I.push(m));for(const m of this.lights)V&&!V(m)||(this.OI.addLight(m),I.push(m));for(const m of this.meshes)V&&!V(m)||(this.OI.GE(m),I.push(m));for(const m of this.skeletons)V&&!V(m)||this.OI.addSkeleton(m);for(const m of this.animations)V&&!V(m)||this.OI.addAnimation(m);for(const m of this.animationGroups)V&&!V(m)||this.OI.addAnimationGroup(m);for(const m of this.multiMaterials)V&&!V(m)||this.OI.addMultiMaterial(m);for(const m of this.materials)V&&!V(m)||this.OI.addMaterial(m);for(const m of this.morphTargetManagers)V&&!V(m)||this.OI.addMorphTargetManager(m);for(const m of this.geometries)V&&!V(m)||this.OI.addGeometry(m);for(const m of this.transformNodes)V&&!V(m)||(this.OI.addTransformNode(m),I.push(m));for(const m of this.actionManagers)V&&!V(m)||this.OI.addActionManager(m);for(const m of this.textures)V&&!V(m)||this.OI.addTexture(m);for(const m of this.reflectionProbes)V&&!V(m)||this.OI.addReflectionProbe(m);for(const m of I)m.parent&&-1===this.OI.getNodes().indexOf(m.parent)&&(m.setParent?m.setParent(null):m.parent=null)}removeAllFromScene(){this._isValidHierarchy()||l.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.OI.environmentTexture&&(this.OI.environmentTexture=null);for(const V of this.OI._serializableComponents)V.removeFromContainer(this)}removeFromScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const I of this.cameras)V&&!V(I)||this.OI.removeCamera(I);for(const I of this.lights)V&&!V(I)||this.OI.removeLight(I);for(const I of this.meshes)V&&!V(I)||this.OI.QE(I,!0);for(const I of this.skeletons)V&&!V(I)||this.OI.removeSkeleton(I);for(const I of this.animations)V&&!V(I)||this.OI.removeAnimation(I);for(const I of this.animationGroups)V&&!V(I)||this.OI.removeAnimationGroup(I);for(const I of this.multiMaterials)V&&!V(I)||this.OI.removeMultiMaterial(I);for(const I of this.materials)V&&!V(I)||this.OI.removeMaterial(I);for(const I of this.morphTargetManagers)V&&!V(I)||this.OI.removeMorphTargetManager(I);for(const I of this.geometries)V&&!V(I)||this.OI.removeGeometry(I);for(const I of this.transformNodes)V&&!V(I)||this.OI.removeTransformNode(I);for(const I of this.actionManagers)V&&!V(I)||this.OI.removeActionManager(I);for(const I of this.textures)V&&!V(I)||this.OI.removeTexture(I);for(const I of this.reflectionProbes)V&&!V(I)||this.OI.removeReflectionProbe(I)}dispose(){const V=this.cameras.slice(0);for(const O of V)O.dispose();this.cameras.length=0;const I=this.lights.slice(0);for(const O of I)O.dispose();this.lights.length=0;const m=this.meshes.slice(0);for(const O of m)O.dispose();this.meshes.length=0;const C=this.skeletons.slice(0);for(const O of C)O.dispose();this.skeletons.length=0;const l=this.animationGroups.slice(0);for(const O of l)O.dispose();this.animationGroups.length=0;const s=this.multiMaterials.slice(0);for(const O of s)O.dispose();this.multiMaterials.length=0;const F=this.materials.slice(0);for(const O of F)O.dispose();this.materials.length=0;const k=this.geometries.slice(0);for(const O of k)O.dispose();this.geometries.length=0;const j=this.transformNodes.slice(0);for(const O of j)O.dispose();this.transformNodes.length=0;const E=this.actionManagers.slice(0);for(const O of E)O.dispose();this.actionManagers.length=0;const K=this.textures.slice(0);for(const O of K)O.dispose();this.textures.length=0;const Y=this.reflectionProbes.slice(0);for(const O of Y)O.dispose();this.reflectionProbes.length=0;const X=this.morphTargetManagers.slice(0);for(const O of X)O.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const O of this.OI._serializableComponents)O.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.OI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(V,I,m){if(V&&I)for(const C of V){let V=!0;if(m)for(const I of m)if(C===I){V=!1;break}V&&(I.push(C),C._parentContainer=this)}}moveAllFromScene(V){this._wasAddedToScene=!1,void 0===V&&(V=new t);for(const I in this)Object.prototype.hasOwnProperty.call(this,I)&&(this[I]=this[I]||("_environmentTexture"===I?null:[]),this._moveAssets(this.OI[I],this[I],V[I]));this.environmentTexture=this.OI.environmentTexture,this.removeAllFromScene()}createRootMesh(){const V=new F.c("assetContainerRootMesh",this.OI);for(const I of this.meshes)I.parent||V.addChild(I);return this.meshes.unshift(V),V}mergeAnimationsTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.c.LastCreatedScene,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!V)return E.d.Error("No scene available to merge animations to"),[];const C=m||(I=>{let m=null;const C=I.animations.length?I.animations[0].targetProperty:"",l=I.name.split(".").join("").split("_primitive")[0];switch(C){case"position":case"rotationQuaternion":m=V.getTransformNodeByName(I.name)||V.getTransformNodeByName(l);break;case"influence":m=V.getMorphTargetByName(I.name)||V.getMorphTargetByName(l);break;default:m=V.getNodeByName(I.name)||V.getNodeByName(l)}return m}),l=this.getNodes();for(const k of l){const V=C(k);if(null!==V){for(const I of k.animations){const m=V.animations.filter((V=>V.targetProperty===I.targetProperty));for(const I of m){const m=V.animations.indexOf(I,0);m>-1&&V.animations.splice(m,1)}}V.animations=V.animations.concat(k.animations)}}const s=[],F=this.animationGroups.slice();for(const k of F){s.push(k.clone(k.name,C));for(const V of k.animatables)V.stop()}for(const k of I){const I=C(k.target);I&&(V.beginAnimation(I,k.fromFrame,k.toFrame,k.loopAnimation,k.speedRatio,k.onAnimationEnd?k.onAnimationEnd:void 0,void 0,!0,void 0,k.onAnimationLoop?k.onAnimationLoop:void 0),V.stopAnimation(k.target))}return s}populateRootNodes(){this.rootNodes.length=0;for(const V of this.meshes)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.transformNodes)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.lights)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.cameras)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)}addAllAssetsToContainer(V){if(!V)return;const I=[],m=new Set;for(I.push(V);I.length>0;){const V=I.pop();if(V instanceof F.c?(V.wF&&-1===this.geometries.indexOf(V.wF)&&this.geometries.push(V.wF),this.meshes.push(V)):V instanceof Y.c?this.meshes.push(V):V instanceof k.c?this.transformNodes.push(V):V instanceof X.d?this.lights.push(V):V instanceof O.c&&this.cameras.push(V),V instanceof j.e){if(V.material&&-1===this.materials.indexOf(V.material)){this.materials.push(V.material);for(const I of V.material.getActiveTextures())-1===this.textures.indexOf(I)&&this.textures.push(I)}V.skeleton&&-1===this.skeletons.indexOf(V.skeleton)&&this.skeletons.push(V.skeleton),V.morphTargetManager&&-1===this.morphTargetManagers.indexOf(V.morphTargetManager)&&this.morphTargetManagers.push(V.morphTargetManager)}for(const C of V.getChildren())m.has(C)||I.push(C);m.add(V)}this.populateRootNodes()}_getByTags(V,I,m){if(void 0===I)return V;const C=[];for(const l in V){const s=V[l];v.b&&v.b.MatchesQuery(s,I)&&(!m||m(s))&&C.push(s)}return C}getMeshesByTags(V,I){return this._getByTags(this.meshes,V,I)}getCamerasByTags(V,I){return this._getByTags(this.cameras,V,I)}getLightsByTags(V,I){return this._getByTags(this.lights,V,I)}getMaterialsByTags(V,I){return this._getByTags(this.materials,V,I).concat(this._getByTags(this.multiMaterials,V,I))}getTransformNodesByTags(V,I){return this._getByTags(this.transformNodes,V,I)}}var T=m(11118);class n{constructor(V){this.byteOffset=0,this.buffer=V}async loadAsync(V){const I=await this.buffer.readAsync(this.byteOffset,V);this._dataView=new DataView(I.buffer,I.byteOffset,I.byteLength),this._dataByteOffset=0}readUint32(){const V=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,V}readUint8Array(V){const I=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,V);return this._dataByteOffset+=V,this.byteOffset+=V,I}readString(V){return(0,T.h)(this.readUint8Array(V))}skipBytes(V){this._dataByteOffset+=V,this.byteOffset+=V}}var x=m(12831);const S="Z2xURg",c={name:"sk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:V=>-1!==V.indexOf("asset")&&-1!==V.indexOf("version")||V.startsWith("data:base64,"+S)||V.startsWith("data:;base64,"+S)||V.startsWith("data:application/octet-stream;base64,"+S)||V.startsWith("data:model/gltf-binary;base64,"+S)};var H,y,z,Z=m(11102),B=m(11111);function W(V,I,m){try{return Promise.resolve(new Uint8Array(V,I,m))}catch(C){return Promise.reject(C)}}!function(V){V[V.AUTO=0]="AUTO",V[V.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(H||(H={})),function(V){V[V.NONE=0]="NONE",V[V.FIRST=1]="FIRST",V[V.ALL=2]="ALL"}(y||(y={})),function(V){V[V.LOADING=0]="LOADING",V[V.READY=1]="READY",V[V.COMPLETE=2]="COMPLETE"}(z||(z={}));class Q{constructor(){this.coordinateSystemMode=H.AUTO,this.animationStartMode=y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=V=>Promise.resolve(V),this.extensionOptions={}}C(V){V&&(this.onParsed=V.onParsed,this.coordinateSystemMode=V.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=V.animationStartMode??this.animationStartMode,this.loadNodeAnimations=V.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=V.loadSkins??this.loadSkins,this.loadMorphTargets=V.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=V.compileMaterials??this.compileMaterials,this.useClipPlane=V.useClipPlane??this.useClipPlane,this.compileShadowGenerators=V.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=V.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=V.useRangeRequests??this.useRangeRequests,this.createInstances=V.createInstances??this.createInstances,this.alwaysComputeBoundingBox=V.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=V.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=V.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=V.skipMaterials??this.skipMaterials,this.useSRGBBuffers=V.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=V.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=V.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=V.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=V.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=V.customRootNode,this.onMeshLoaded=V.onMeshLoaded,this.onSkinLoaded=V.onSkinLoaded,this.onTextureLoaded=V.onTextureLoaded,this.onMaterialLoaded=V.onMaterialLoaded,this.onCameraLoaded=V.onCameraLoaded,this.extensionOptions=V.extensionOptions??this.extensionOptions)}}class G extends Q{constructor(V){super(),this.onParsedObservable=new C.e,this.onMeshLoadedObservable=new C.e,this.onSkinLoadedObservable=new C.e,this.onTextureLoadedObservable=new C.e,this.onMaterialLoadedObservable=new C.e,this.onCameraLoadedObservable=new C.e,this.onCompleteObservable=new C.e,this.onErrorObservable=new C.e,this.Ck=new C.e,this.onExtensionLoadedObservable=new C.e,this.validate=!1,this.onValidatedObservable=new C.e,this._loader=null,this._state=null,this._requests=new Array,this.name=c.name,this.extensions=c.extensions,this.onLoaderStateChangedObservable=new C.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.C(V)}set onParsed(V){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),V&&(this._onParsedObserver=this.onParsedObservable.add(V))}set onMeshLoaded(V){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),V&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(V))}set onSkinLoaded(V){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),V&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((I=>V(I.node,I.skinnedNode))))}set onTextureLoaded(V){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),V&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(V))}set onMaterialLoaded(V){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),V&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(V))}set onCameraLoaded(V){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),V&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(V))}set onComplete(V){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(V)}set onError(V){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(V)}set onDispose(V){this._onDisposeObserver&&this.Ck.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ck.add(V)}set onExtensionLoaded(V){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(V)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(V){this._loggingEnabled!==V&&(this._loggingEnabled=V,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(V){this._capturePerformanceCounters!==V&&(this._capturePerformanceCounters=V,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(V){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(V)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const V of this._requests)V.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=V=>Promise.resolve(V),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ck.notifyObservers(void 0),this.Ck.clear()}loadFile(V,I,m,s,F,k,j,K){if(ArrayBuffer.isView(I))return this._loadBinary(V,I,m,s,j,K),null;this._progressCallback=F;const Y=I.name||l.d.GetFilename(I);if(k){if(this.useRangeRequests){this.validate&&E.d.Warn("glTF validation is not supported when range requests are enabled");const m={abort:()=>{},onCompleteObservable:new C.e},l={readAsync:(m,C)=>new Promise(((l,s)=>{this._loadFile(V,I,(V=>{l(new Uint8Array(V))}),!0,(V=>{s(V)}),(V=>{V.setRequestHeader("Range",`bytes=${m}-${m+C-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new n(l)).then((V=>{m.onCompleteObservable.notifyObservers(m),s(V)}),j?V=>j(void 0,V):void 0),m}return this._loadFile(V,I,(I=>{this._validate(V,new Uint8Array(I,0,I.byteLength),m,Y),this._unpackBinaryAsync(new n({readAsync:(V,m)=>W(I,V,m),byteLength:I.byteLength})).then((V=>{s(V)}),j?V=>j(void 0,V):void 0)}),!0,j)}return this._loadFile(V,I,(I=>{try{this._validate(V,I,m,Y),s({json:this._parseJson(I)})}catch{j&&j()}}),!1,j)}_loadBinary(V,I,m,C,l,s){this._validate(V,new Uint8Array(I.buffer,I.byteOffset,I.byteLength),m,s),this._unpackBinaryAsync(new n({readAsync:(V,m)=>function(V,I,m){try{if(I<0||I>=V.byteLength)throw new RangeError("Offset is out of range.");if(I+m>V.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(V.buffer,V.byteOffset+I,m))}catch(C){return Promise.reject(C)}}(I,V,m),byteLength:I.byteLength})).then((V=>{C(V)}),l?V=>l(void 0,V):void 0)}importMeshAsync(V,I,m,C,l,s){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(m),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(m),this._loader.importMeshAsync(V,I,null,m,C,l,s))))}loadAsync(V,I,m,C,l){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${l||""}`),this._loader=this._getLoader(I),this._loader.loadAsync(V,I,m,C,l))))}loadAssetContainerAsync(V,I,m,C,l){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${l||""}`),this._loader=this._getLoader(I);const s=new b(V),F=[];this.onMaterialLoadedObservable.add((V=>{F.push(V)}));const k=[];this.onTextureLoadedObservable.add((V=>{k.push(V)}));const j=[];this.onCameraLoadedObservable.add((V=>{j.push(V)}));const E=[];return this.onMeshLoadedObservable.add((V=>{V.morphTargetManager&&E.push(V.morphTargetManager)})),this._loader.importMeshAsync(null,V,s,I,m,C,l).then((V=>(Array.prototype.push.apply(s.geometries,V.geometries),Array.prototype.push.apply(s.meshes,V.meshes),Array.prototype.push.apply(s.ZY,V.ZY),Array.prototype.push.apply(s.skeletons,V.skeletons),Array.prototype.push.apply(s.animationGroups,V.animationGroups),Array.prototype.push.apply(s.materials,F),Array.prototype.push.apply(s.textures,k),Array.prototype.push.apply(s.lights,V.lights),Array.prototype.push.apply(s.transformNodes,V.transformNodes),Array.prototype.push.apply(s.cameras,j),Array.prototype.push.apply(s.morphTargetManagers,E),s)))}))}canDirectLoad(V){return c.canDirectLoad(V)}directLoad(V,I){if(I.startsWith("base64,"+S)||I.startsWith(";base64,"+S)||I.startsWith("application/octet-stream;base64,"+S)||I.startsWith("model/gltf-binary;base64,"+S)){const m=(0,Z.b)(I);return this._validate(V,new Uint8Array(m,0,m.byteLength)),this._unpackBinaryAsync(new n({readAsync:(V,I)=>W(m,V,I),byteLength:m.byteLength}))}return this._validate(V,I),Promise.resolve({json:this._parseJson(I)})}createPlugin(V){return new G(V[c.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((V,I)=>{this.onCompleteObservable.addOnce((()=>{V()})),this.onErrorObservable.addOnce((V=>{I(V)}))}))}_setState(V){this._state!==V&&(this._state=V,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(z[this._state]))}_loadFile(V,I,m,C,l,s){const F=V._loadFile(I,m,(V=>{this._onProgress(V,F)}),!0,C,l,s);return F.onCompleteObservable.add((()=>{F._lengthComputable=!0,F._total=F._loaded})),this._requests.push(F),F}_onProgress(V,I){if(!this._progressCallback)return;I._lengthComputable=V.lengthComputable,I._loaded=V.loaded,I._total=V.total;let m=!0,C=0,l=0;for(const s of this._requests){if(void 0===s._lengthComputable||void 0===s._loaded||void 0===s._total)return;m=m&&s._lengthComputable,C+=s._loaded,l+=s._total}this._progressCallback({lengthComputable:m,loaded:C,total:m?l:0})}_validate(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),x.b.ValidateAsync(I,m,C,(I=>this.preprocessUrlAsync(m+I).then((I=>V._loadFileAsync(I,void 0,!0,!0).then((V=>new Uint8Array(V,0,V.byteLength))))))).then((V=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(V),this.onValidatedObservable.clear()}),(V=>{this._endPerformanceCounter("Validate JSON"),l.d.Warn(`Failed to validate: ${V.message}`),this.onValidatedObservable.clear()})))}_getLoader(V){const I=V.json.asset||{};this._log(`Asset version: ${I.version}`),I.minVersion&&this._log(`Asset minimum version: ${I.minVersion}`),I.generator&&this._log(`Asset generator: ${I.generator}`);const m=G._parseVersion(I.version);if(!m)throw new Error("Invalid version: "+I.version);if(void 0!==I.minVersion){const V=G._parseVersion(I.minVersion);if(!V)throw new Error("Invalid minimum version: "+I.minVersion);if(G._compareVersion(V,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+I.minVersion)}const C={1:G._CreateGLTF1Loader,2:G._CreateGLTF2Loader}[m.major];if(!C)throw new Error("Unsupported version: "+I.version);return C(this)}_parseJson(V){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${V.length}`);const I=JSON.parse(V);return this._endPerformanceCounter("Parse JSON"),I}_unpackBinaryAsync(V){return this._startPerformanceCounter("Unpack Binary"),V.loadAsync(20).then((()=>{const I=V.readUint32();if(1179937895!==I)throw new B.g("Unexpected magic: "+I,B.e.GLTFLoaderUnexpectedMagicError);const m=V.readUint32();this.loggingEnabled&&this._log(`Binary version: ${m}`);const C=V.readUint32();let l;switch(this.useRangeRequests||C===V.buffer.byteLength||E.d.Warn(`Length in header does not match actual data length: ${C} != ${V.buffer.byteLength}`),m){case 1:l=this._unpackBinaryV1Async(V,C);break;case 2:l=this._unpackBinaryV2Async(V,C);break;default:throw new Error("Unsupported version: "+m)}return this._endPerformanceCounter("Unpack Binary"),l}))}_unpackBinaryV1Async(V,I){const m=V.readUint32(),C=V.readUint32();if(0!==C)throw new Error(`Unexpected content format: ${C}`);const l=I-V.byteOffset,s={json:this._parseJson(V.readString(m)),bin:null};if(0!==l){const I=V.byteOffset;s.bin={readAsync:(m,C)=>V.buffer.readAsync(I+m,C),byteLength:l}}return Promise.resolve(s)}_unpackBinaryV2Async(V,I){const m=1313821514,C=5130562,l=V.readUint32();if(V.readUint32()!==m)throw new Error("First chunk format is not JSON");return V.byteOffset+l===I?V.loadAsync(l).then((()=>({json:this._parseJson(V.readString(l)),bin:null}))):V.loadAsync(l+8).then((()=>{const s={json:this._parseJson(V.readString(l)),bin:null},F=()=>{const l=V.readUint32();switch(V.readUint32()){case m:throw new Error("Unexpected JSON chunk");case C:{const I=V.byteOffset;s.bin={readAsync:(m,C)=>V.buffer.readAsync(I+m,C),byteLength:l},V.skipBytes(l);break}default:V.skipBytes(l)}return V.byteOffset!==I?V.loadAsync(8).then(F):Promise.resolve(s)};return F()}))}static _parseVersion(V){if("1.0"===V||"1.0.1"===V)return{major:1,minor:0};const I=(V+"").match(/^(\d+)\.(\d+)/);return I?{major:parseInt(I[1]),minor:parseInt(I[2])}:null}static _compareVersion(V,I){return V.major>I.major?1:V.major<I.major?-1:V.minor>I.minor?1:V.minor<I.minor?-1:0}_logOpen(V){this._log(V),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(V){const I=G._logSpaces.substring(0,2*this._logIndentLevel);E.d.Log(`${I}${V}`)}_logDisabled(V){}_startPerformanceCounterEnabled(V){l.d.StartPerformanceCounter(V)}_startPerformanceCounterDisabled(V){}_endPerformanceCounterEnabled(V){l.d.EndPerformanceCounter(V)}_endPerformanceCounterDisabled(V){}}G.IncrementalLoading=!0,G.HomogeneousCoordinates=!1,G._logSpaces="                                ",(0,s.c)(new G)},12831:(V,I,m)=>{"use strict";m.d(I,{b:()=>F});var C=m(11076);function l(V,I,m,C){const l={externalResourceFunction:C};return m&&(l.uri="file:"===I?m:I+m),ArrayBuffer.isView(V)?GLTFValidator.validateBytes(V,l):GLTFValidator.validateString(V,l)}function s(){const V=[];onmessage=I=>{const m=I.data;switch(m.id){case"init":importScripts(m.url);break;case"validate":l(m.data,m.rootUrl,m.fileName,(I=>new Promise(((m,C)=>{const l=V.length;V.push({resolve:m,reject:C}),postMessage({id:"getExternalResource",index:l,uri:I})})))).then((V=>{postMessage({id:"validate.resolve",value:V})}),(V=>{postMessage({id:"validate.reject",reason:V})}));break;case"getExternalResource.resolve":V[m.index].resolve(m.value);break;case"getExternalResource.reject":V[m.index].reject(m.reason)}}}class F{static ValidateAsync(V,I,m,F){return"function"===typeof Worker?new Promise(((k,j)=>{const E=`${l}(${s})()`,K=URL.createObjectURL(new Blob([E],{type:"application/javascript"})),Y=new Worker(K),X=V=>{Y.removeEventListener("error",X),Y.removeEventListener("message",O),j(V)},O=V=>{const I=V.data;switch(I.id){case"getExternalResource":F(I.uri).then((V=>{Y.postMessage({id:"getExternalResource.resolve",index:I.index,value:V},[V.buffer])}),(V=>{Y.postMessage({id:"getExternalResource.reject",index:I.index,reason:V})}));break;case"validate.resolve":Y.removeEventListener("error",X),Y.removeEventListener("message",O),k(I.value),Y.terminate();break;case"validate.reject":Y.removeEventListener("error",X),Y.removeEventListener("message",O),j(I.reason),Y.terminate()}};if(Y.addEventListener("error",X),Y.addEventListener("message",O),Y.postMessage({id:"init",url:C.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(V)){const C=V.slice();Y.postMessage({id:"validate",data:C,rootUrl:I,fileName:m},[C.buffer])}else Y.postMessage({id:"validate",data:V,rootUrl:I,fileName:m})})):(this._LoadScriptPromise||(this._LoadScriptPromise=C.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>l(V,I,m,F))))}}F.Configuration={url:`${C.d._DefaultCdnUrl}/gltf_validator.js`}},13387:(V,I,m)=>{"use strict";m.d(I,{d:()=>c});var C=m(11206),l=m(11214),s=m(11297),F=m(11040),k=m(11642),j=m(11661),E=m(11233),K=m(11596),Y=m(11048),X=m(11150);m(12583),m(12480),m(12499),m(12488),m(12501),m(12510),m(12519);const O="imageProcessingCompatibility",v="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";X.e.IncludesShadersStore[O]||(X.e.IncludesShadersStore[O]=v);const N="skyPixelShader",t="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";X.e.ShadersStore[N]||(X.e.ShadersStore[N]=t);m(12594),m(12525),m(12532),m(12541),m(12534);const D="skyVertexShader",b="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";X.e.ShadersStore[D]||(X.e.ShadersStore[D]=b);var T=m(11681),n=m(11327),x=m(11316);class S extends k.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class c extends j.b{constructor(V,I){super(V,I),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new F.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=F.m.Zero(),this.up=F.m.Up(),this.dithering=!1,this._cameraPosition=F.m.Zero(),this._skyOrientation=new F.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(V,I){const m=I._drawWrapper;if(this.isFrozen&&m.effect&&m._wasPreviouslyReady)return!0;I.materialDefines||(I.materialDefines=new S);const C=I.materialDefines,l=this.cV();if(this._isReadyForSubMesh(I))return!0;if((0,x.S)(V,l,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,C),(0,x.K)(V,C,!0,!1),C.IMAGEPROCESSINGPOSTPROCESS!==l.imageProcessingConfiguration.applyByPostProcess&&C.markAsMiscDirty(),C.DITHER!==this.dithering&&C.markAsMiscDirty(),C.isDirty){C.markAsProcessed(),l.resetCachedMaterial();const V=new T.b;C.FOG&&V.addFallback(1,"FOG"),C.IMAGEPROCESSINGPOSTPROCESS=l.imageProcessingConfiguration.applyByPostProcess,C.DITHER=this.dithering;const m=[E.e.PositionKind];C.VERTEXCOLOR&&m.push(E.e.ColorKind);const s="sky",F=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,n.b)(F);const k=C.toString();I.setEffect(l.getEngine().createEffect(s,m,F,[],k,V,this.onCompiled,this.onError),C,this._materialContext)}return!(!I.effect||!I.effect.isReady())&&(C._renderId=l.getRenderId(),m._wasPreviouslyReady=!0,!0)}bindForSubMesh(V,I,m){const C=this.cV(),l=m.materialDefines;if(!l)return;const s=m.effect;if(!s)return;this._activeEffect=s,this.bindOnlyWorldMatrix(V),this._activeEffect.setMatrix("viewProjection",C.getTransformMatrix()),this._mustRebind(C,s,m)&&((0,n.d)(s,this,C),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.n)(l,s,C)),C.fogEnabled&&I.applyFog&&C.fogMode!==K.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",C.getViewMatrix()),(0,x.f)(C,I,this._activeEffect);const k=C.activeCamera;if(k){const V=k.getWorldMatrix();this._cameraPosition.x=V.m[12],this._cameraPosition.y=V.m[13],this._cameraPosition.z=V.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const V=Math.PI*(this.inclination-.5),I=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(I)*Math.cos(V),this.sunPosition.y=this.distance*Math.sin(-V),this.sunPosition.z=this.distance*Math.sin(I)*Math.cos(V),F.e.FromUnitVectorsToRef(F.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(I,this._activeEffect,m)}getAnimatables(){return[]}dispose(V){super.dispose(V)}clone(V){return s.d.Clone((()=>new c(V,this.cV())),this)}serialize(){const V=super.serialize();return V.customType="BABYLON.SkyMaterial",V}getClassName(){return"SkyMaterial"}static Parse(V,I,m){return s.d.Parse((()=>new c(V.name,I)),V,I,m)}}(0,C.d)([(0,l.B)()],c.prototype,"luminance",void 0),(0,C.d)([(0,l.B)()],c.prototype,"turbidity",void 0),(0,C.d)([(0,l.B)()],c.prototype,"rayleigh",void 0),(0,C.d)([(0,l.B)()],c.prototype,"mieCoefficient",void 0),(0,C.d)([(0,l.B)()],c.prototype,"mieDirectionalG",void 0),(0,C.d)([(0,l.B)()],c.prototype,"distance",void 0),(0,C.d)([(0,l.B)()],c.prototype,"inclination",void 0),(0,C.d)([(0,l.B)()],c.prototype,"azimuth",void 0),(0,C.d)([(0,l.x)()],c.prototype,"sunPosition",void 0),(0,C.d)([(0,l.B)()],c.prototype,"useSunPosition",void 0),(0,C.d)([(0,l.x)()],c.prototype,"cameraOffset",void 0),(0,C.d)([(0,l.x)()],c.prototype,"up",void 0),(0,C.d)([(0,l.B)()],c.prototype,"dithering",void 0),(0,Y.h)("BABYLON.SkyMaterial",c)},11807:(V,I,m)=>{"use strict";function C(V,I){I.headers=V.headers||{},I.statusMessage=V.statusText,I.statusCode=V.status,I.data=V.response}function l(V,I,m){return new Promise((function(l,s){m=m||{};var F,k,j,E=new XMLHttpRequest,K=m.body,Y=m.headers||{};for(F in m.timeout&&(E.timeout=m.timeout),E.ontimeout=E.onerror=function(V){V.timeout="timeout"==V.type,s(V)},E.open(V,I.href||I),E.onload=function(){for(j=E.getAllResponseHeaders().trim().split(/[\r\n]+/),C(E,E);k=j.shift();)k=k.split(": "),E.headers[k.shift().toLowerCase()]=k.join(": ");if((k=E.headers["content-type"])&&~k.indexOf("application/json"))try{E.data=JSON.parse(E.data,m.reviver)}catch(V){return C(E,V),s(V)}(E.status>=400?s:l)(E)},typeof FormData<"u"&&K instanceof FormData||K&&"object"==typeof K&&(Y["content-type"]="application/json",K=JSON.stringify(K)),E.withCredentials=!!m.withCredentials,Y)E.setRequestHeader(F,Y[F]);E.send(K)}))}m.r(I),m.d(I,{del:()=>j,get:()=>s,patch:()=>k,post:()=>F,put:()=>E,send:()=>l});var s=l.bind(l,"GET"),F=l.bind(l,"POST"),k=l.bind(l,"PATCH"),j=l.bind(l,"DELETE"),E=l.bind(l,"PUT")},13505:(V,I,m)=>{"use strict";m.d(I,{e:()=>Y});const C=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6,s=1/3,F=1/6,k=(Math.sqrt(5)-1)/4,j=(5-Math.sqrt(5))/20,E=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),K=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Y=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const I="function"==typeof V?V:function(V){let I=0,m=0,C=0,l=1;const s=function(){let V=4022871197;return function(I){I=I.toString();for(let m=0;m<I.length;m++){V+=I.charCodeAt(m);let C=.02519603282416938*V;V=C>>>0,C-=V,C*=V,V=C>>>0,C-=V,V+=4294967296*C}return 2.3283064365386963e-10*(V>>>0)}}();I=s(" "),m=s(" "),C=s(" "),I-=s(V),I<0&&(I+=1);m-=s(V),m<0&&(m+=1);C-=s(V),C<0&&(C+=1);return function(){const V=2091639*I+2.3283064365386963e-10*l;return I=m,m=C,C=V-(l=0|V)}}(V);this.p=function(V){const I=new Uint8Array(256);for(let m=0;m<256;m++)I[m]=m;for(let m=0;m<255;m++){const C=m+~~(V()*(256-m)),l=I[m];I[m]=I[C],I[C]=l}return I}(I),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let m=0;m<512;m++)this.perm[m]=this.p[255&m],this.permMod12[m]=this.perm[m]%12}noise2D(V,I){const m=this.permMod12,s=this.perm;let F=0,k=0,j=0;const K=(V+I)*C,Y=Math.floor(V+K),X=Math.floor(I+K),O=(Y+X)*l,v=V-(Y-O),N=I-(X-O);let t,D;v>N?(t=1,D=0):(t=0,D=1);const b=v-t+l,T=N-D+l,n=v-1+2*l,x=N-1+2*l,S=255&Y,c=255&X;let H=.5-v*v-N*N;if(H>=0){const V=3*m[S+s[c]];H*=H,F=H*H*(E[V]*v+E[V+1]*N)}let y=.5-b*b-T*T;if(y>=0){const V=3*m[S+t+s[c+D]];y*=y,k=y*y*(E[V]*b+E[V+1]*T)}let z=.5-n*n-x*x;if(z>=0){const V=3*m[S+1+s[c+1]];z*=z,j=z*z*(E[V]*n+E[V+1]*x)}return 70*(F+k+j)}noise3D(V,I,m){const C=this.permMod12,l=this.perm;let k,j,K,Y;const X=(V+I+m)*s,O=Math.floor(V+X),v=Math.floor(I+X),N=Math.floor(m+X),t=(O+v+N)*F,D=V-(O-t),b=I-(v-t),T=m-(N-t);let n,x,S,c,H,y;D>=b?b>=T?(n=1,x=0,S=0,c=1,H=1,y=0):D>=T?(n=1,x=0,S=0,c=1,H=0,y=1):(n=0,x=0,S=1,c=1,H=0,y=1):b<T?(n=0,x=0,S=1,c=0,H=1,y=1):D<T?(n=0,x=1,S=0,c=0,H=1,y=1):(n=0,x=1,S=0,c=1,H=1,y=0);const z=D-n+F,Z=b-x+F,B=T-S+F,W=D-c+2*F,Q=b-H+2*F,G=T-y+2*F,r=D-1+.5,g=b-1+.5,h=T-1+.5,d=255&O,R=255&v,i=255&N;let q=.6-D*D-b*b-T*T;if(q<0)k=0;else{const V=3*C[d+l[R+l[i]]];q*=q,k=q*q*(E[V]*D+E[V+1]*b+E[V+2]*T)}let P=.6-z*z-Z*Z-B*B;if(P<0)j=0;else{const V=3*C[d+n+l[R+x+l[i+S]]];P*=P,j=P*P*(E[V]*z+E[V+1]*Z+E[V+2]*B)}let u=.6-W*W-Q*Q-G*G;if(u<0)K=0;else{const V=3*C[d+c+l[R+H+l[i+y]]];u*=u,K=u*u*(E[V]*W+E[V+1]*Q+E[V+2]*G)}let o=.6-r*r-g*g-h*h;if(o<0)Y=0;else{const V=3*C[d+1+l[R+1+l[i+1]]];o*=o,Y=o*o*(E[V]*r+E[V+1]*g+E[V+2]*h)}return 32*(k+j+K+Y)}noise4D(V,I,m,C){const l=this.perm;let s,F,E,Y,X;const O=(V+I+m+C)*k,v=Math.floor(V+O),N=Math.floor(I+O),t=Math.floor(m+O),D=Math.floor(C+O),b=(v+N+t+D)*j,T=V-(v-b),n=I-(N-b),x=m-(t-b),S=C-(D-b);let c=0,H=0,y=0,z=0;T>n?c++:H++,T>x?c++:y++,T>S?c++:z++,n>x?H++:y++,n>S?H++:z++,x>S?y++:z++;const Z=c>=3?1:0,B=H>=3?1:0,W=y>=3?1:0,Q=z>=3?1:0,G=c>=2?1:0,r=H>=2?1:0,g=y>=2?1:0,h=z>=2?1:0,d=c>=1?1:0,R=H>=1?1:0,i=y>=1?1:0,q=z>=1?1:0,P=T-Z+j,u=n-B+j,o=x-W+j,p=S-Q+j,M=T-G+2*j,f=n-r+2*j,w=x-g+2*j,A=S-h+2*j,J=T-d+3*j,U=n-R+3*j,e=x-i+3*j,a=S-q+3*j,L=T-1+4*j,VV=n-1+4*j,IV=x-1+4*j,mV=S-1+4*j,CV=255&v,lV=255&N,sV=255&t,FV=255&D;let kV=.6-T*T-n*n-x*x-S*S;if(kV<0)s=0;else{const V=l[CV+l[lV+l[sV+l[FV]]]]%32*4;kV*=kV,s=kV*kV*(K[V]*T+K[V+1]*n+K[V+2]*x+K[V+3]*S)}let jV=.6-P*P-u*u-o*o-p*p;if(jV<0)F=0;else{const V=l[CV+Z+l[lV+B+l[sV+W+l[FV+Q]]]]%32*4;jV*=jV,F=jV*jV*(K[V]*P+K[V+1]*u+K[V+2]*o+K[V+3]*p)}let EV=.6-M*M-f*f-w*w-A*A;if(EV<0)E=0;else{const V=l[CV+G+l[lV+r+l[sV+g+l[FV+h]]]]%32*4;EV*=EV,E=EV*EV*(K[V]*M+K[V+1]*f+K[V+2]*w+K[V+3]*A)}let KV=.6-J*J-U*U-e*e-a*a;if(KV<0)Y=0;else{const V=l[CV+d+l[lV+R+l[sV+i+l[FV+q]]]]%32*4;KV*=KV,Y=KV*KV*(K[V]*J+K[V+1]*U+K[V+2]*e+K[V+3]*a)}let YV=.6-L*L-VV*VV-IV*IV-mV*mV;if(YV<0)X=0;else{const V=l[CV+1+l[lV+1+l[sV+1+l[FV+1]]]]%32*4;YV*=YV,X=YV*YV*(K[V]*L+K[V+1]*VV+K[V+2]*IV+K[V+3]*mV)}return 27*(s+F+E+Y+X)}}}}]);