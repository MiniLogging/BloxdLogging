/*! For license information please see srbgb5.11.a490475c.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{11905:function(h,d){!function(h){"use strict";var d=function(h,m){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,d){h.__proto__=d}||function(h,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(h[m]=d[m])},d(h,m)};function m(h,m){if("function"!==typeof m&&null!==m)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function j(){this.constructor=h}d(h,m),h.prototype=null===m?Object.create(m):(j.prototype=m.prototype,new j)}function j(h,d,m,j){var A,b=arguments.length,w=b<3?d:null===j?j=Object.getOwnPropertyDescriptor(d,m):j;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)w=Reflect.decorate(h,d,m,j);else for(var a=h.length-1;a>=0;a--)(A=h[a])&&(w=(b<3?A(w):b>3?A(d,m,w):A(d,m))||w);return b>3&&w&&Object.defineProperty(d,m,w),w}function A(h,d,m){if(m||2===arguments.length)for(var j,A=0,b=d.length;A<b;A++)!j&&A in d||(j||(j=Array.prototype.slice.call(d,0,A)),j[A]=d[A]);return h.concat(j||Array.prototype.slice.call(d))}var b,w=255,a=213;h.OPERATION=void 0,(b=h.OPERATION||(h.OPERATION={}))[b.ADD=128]="ADD",b[b.REPLACE=0]="REPLACE",b[b.DELETE=64]="DELETE",b[b.DELETE_AND_ADD=192]="DELETE_AND_ADD",b[b.TOUCH=1]="TOUCH",b[b.CLEAR=10]="CLEAR";var D=function(){function d(h,d,m){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=h,this.setParent(d,m)}return d.prototype.setParent=function(h,d,m){var j=this;if(this.indexes||(this.indexes=this.ref instanceof lh?this.ref._definition.indexes:{}),this.parent=h,this.parentIndex=m,d)if(this.root=d,this.ref instanceof lh){var A=this.ref._definition;for(var b in A.schema){var w=this.ref[b];if(w&&w.$changes){var a=A.indexes[b];w.$changes.setParent(this.ref,d,a)}}}else"object"===typeof this.ref&&this.ref.forEach((function(h,d){if(h instanceof lh){var m=h.$changes,A=j.ref.$changes.indexes[d];m.setParent(j.ref,j.root,A)}}))},d.prototype.operation=function(h){this.changes.set(--this.currentCustomOperation,h)},d.prototype.change=function(d,m){void 0===m&&(m=h.OPERATION.ADD);var j="number"===typeof d?d:this.indexes[d];this.assertValidIndex(j,d);var A=this.changes.get(j);A&&A.op!==h.OPERATION.DELETE&&A.op!==h.OPERATION.TOUCH||this.changes.set(j,{op:A&&A.op===h.OPERATION.DELETE?h.OPERATION.DELETE_AND_ADD:m,index:j}),this.allChanges.add(j),this.changed=!0,this.touchParents()},d.prototype.touch=function(d){var m="number"===typeof d?d:this.indexes[d];this.assertValidIndex(m,d),this.changes.has(m)||this.changes.set(m,{op:h.OPERATION.TOUCH,index:m}),this.allChanges.add(m),this.touchParents()},d.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},d.prototype.getType=function(h){if(this.ref._definition)return(d=this.ref._definition).schema[d.fieldsByIndex[h]];var d,m=(d=this.parent._definition).schema[d.fieldsByIndex[this.parentIndex]];return Object.values(m)[0]},d.prototype.getChildrenFilter=function(){var h=this.parent._definition.childFilters;return h&&h[this.parentIndex]},d.prototype.getValue=function(h){return this.ref.getByIndex(h)},d.prototype.delete=function(d){var m="number"===typeof d?d:this.indexes[d];if(void 0!==m){var j=this.getValue(m);this.changes.set(m,{op:h.OPERATION.DELETE,index:m}),this.allChanges.delete(m),delete this.caches[m],j&&j.$changes&&(j.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(d," (").concat(m,")"))},d.prototype.discard=function(d,m){var j=this;void 0===d&&(d=!1),void 0===m&&(m=!1),this.ref instanceof lh||this.changes.forEach((function(d){if(d.op===h.OPERATION.DELETE){var m=j.ref.getIndex(d.index);delete j.indexes[m]}})),this.changes.clear(),this.changed=d,m&&this.allChanges.clear(),this.currentCustomOperation=0},d.prototype.discardAll=function(){var h=this;this.changes.forEach((function(d){var m=h.getValue(d.index);m&&m.$changes&&m.$changes.discardAll()})),this.discard()},d.prototype.cache=function(h,d){this.caches[h]=d},d.prototype.clone=function(){return new d(this.ref,this.parent,this.root)},d.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},d.prototype.assertValidIndex=function(h,d){if(void 0===h)throw new Error('ChangeTree: missing index for field "'.concat(d,'"'))},d}();function S(h,d,m,j){return h[d]||(h[d]=[]),h[d].push(m),null===j||void 0===j||j.forEach((function(h,d){return m(h,d)})),function(){return q(h[d],h[d].indexOf(m))}}function M(d){var m=this,j="string"!==typeof this.$changes.getType();this.$items.forEach((function(A,b){d.push({refId:m.$changes.refId,op:h.OPERATION.DELETE,field:b,value:void 0,previousValue:A}),j&&m.$changes.root.removeRef(A.$changes.refId)}))}function q(h,d){if(-1===d||d>=h.length)return!1;for(var m=h.length-1,j=d;j<m;j++)h[j]=h[j+1];return h.length=m,!0}var E=function(h,d){var m=h.toString(),j=d.toString();return m<j?-1:m>j?1:0};function I(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,d){return"symbol"===typeof d||isNaN(d)?h[d]:h.at(d)},set:function(h,d,m){if("symbol"===typeof d||isNaN(d))h[d]=m;else{var j=Array.from(h.$items.keys()),A=parseInt(j[d]||d);void 0===m||null===m?h.deleteAt(A):h.setAt(A,m)}return!0},deleteProperty:function(h,d){return"number"===typeof d?h.deleteAt(d):delete h[d],!0}})}var R=function(){function d(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,h)}return d.prototype.dD=function(d,m){return void 0===m&&(m=!0),S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,m?this.$items:void 0)},d.prototype.Sd=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return Array.isArray(h)||void 0!==h.array},Object.defineProperty(d.prototype,"length",{get:function(){return this.$items.size},set:function(h){0===h?this.clear():this.splice(h,this.length-h)},enumerable:!1,configurable:!0}),d.prototype.push=function(){for(var h,d=this,m=[],j=0;j<arguments.length;j++)m[j]=arguments[j];return m.forEach((function(m){h=d.$refId++,d.setAt(h,m)})),h},d.prototype.pop=function(){var h=Array.from(this.$indexes.values()).pop();if(void 0!==h){this.$changes.delete(h),this.$indexes.delete(h);var d=this.$items.get(h);return this.$items.delete(h),d}},d.prototype.at=function(h){var d=Array.from(this.$items.keys())[h];return this.$items.get(d)},d.prototype.setAt=function(d,m){var j,A;if(void 0!==m&&null!==m){if(this.$items.get(d)!==m){void 0!==m.$changes&&m.$changes.setParent(this,this.$changes.root,d);var b=null!==(A=null===(j=this.$changes.indexes[d])||void 0===j?void 0:j.op)&&void 0!==A?A:h.OPERATION.ADD;this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,m),this.$changes.change(d,b)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},d.prototype.deleteAt=function(h){var d=Array.from(this.$items.keys())[h];return void 0!==d&&this.$deleteAt(d)},d.prototype.$deleteAt=function(h){return this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&M.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.concat=function(){for(var h,m=[],j=0;j<arguments.length;j++)m[j]=arguments[j];return new(d.bind.apply(d,A([void 0],(h=Array.from(this.$items.values())).concat.apply(h,m),!1)))},d.prototype.join=function(h){return Array.from(this.$items.values()).join(h)},d.prototype.reverse=function(){var h=this,d=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(m,j){h.setAt(d[j],m)})),this},d.prototype.shift=function(){var h=Array.from(this.$items.keys()).shift();if(void 0!==h){var d=this.$items.get(h);return this.$deleteAt(h),d}},d.prototype.slice=function(h,m){var j=new d;return j.push.apply(j,Array.from(this.$items.values()).slice(h,m)),j},d.prototype.sort=function(h){var d=this;void 0===h&&(h=E);var m=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(h).forEach((function(h,j){d.setAt(m[j],h)})),this},d.prototype.splice=function(h,d){void 0===d&&(d=this.length-h);for(var m=Array.from(this.$items.keys()),j=[],A=h;A<h+d;A++)j.push(this.$items.get(m[A])),this.$deleteAt(m[A]);return j},d.prototype.unshift=function(){for(var h=this,d=[],m=0;m<arguments.length;m++)d[m]=arguments[m];var j=this.length,A=d.length,b=Array.from(this.$items.values());return d.forEach((function(d,m){h.setAt(m,d)})),b.forEach((function(d,m){h.setAt(A+m,d)})),j+A},d.prototype.indexOf=function(h,d){return Array.from(this.$items.values()).indexOf(h,d)},d.prototype.lastIndexOf=function(h,d){return void 0===d&&(d=this.length-1),Array.from(this.$items.values()).lastIndexOf(h,d)},d.prototype.every=function(h,d){return Array.from(this.$items.values()).every(h,d)},d.prototype.some=function(h,d){return Array.from(this.$items.values()).some(h,d)},d.prototype.forEach=function(h,d){Array.from(this.$items.values()).forEach(h,d)},d.prototype.map=function(h,d){return Array.from(this.$items.values()).map(h,d)},d.prototype.filter=function(h,d){return Array.from(this.$items.values()).filter(h,d)},d.prototype.reduce=function(h,d){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},d.prototype.reduceRight=function(h,d){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},d.prototype.find=function(h,d){return Array.from(this.$items.values()).find(h,d)},d.prototype.findIndex=function(h,d){return Array.from(this.$items.values()).findIndex(h,d)},d.prototype.fill=function(h,d,m){throw new Error("ArraySchema#fill() not implemented")},d.prototype.copyWithin=function(h,d,m){throw new Error("ArraySchema#copyWithin() not implemented")},d.prototype.toString=function(){return this.$items.toString()},d.prototype.toLocaleString=function(){return this.$items.toLocaleString()},d.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},d.prototype.includes=function(h,d){return Array.from(this.$items.values()).includes(h,d)},d.prototype.flatMap=function(h,d){throw new Error("ArraySchema#flatMap() is not supported.")},d.prototype.flat=function(h){throw new Error("ArraySchema#flat() is not supported.")},d.prototype.findLast=function(){var h=Array.from(this.$items.values());return h.findLast.apply(h,arguments)},d.prototype.findLastIndex=function(){var h=Array.from(this.$items.values());return h.findLastIndex.apply(h,arguments)},d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){return this.toArray().map((function(h){return"function"===typeof h.toJSON?h.toJSON():h}))},d.prototype.clone=function(h){return h?new(d.bind.apply(d,A([void 0],Array.from(this.$items.values()),!1))):new(d.bind.apply(d,A([void 0],this.map((function(h){return h.$changes?h.clone():h})),!1)))},d}();function Z(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,d){return"symbol"!==typeof d&&"undefined"===typeof h[d]?h.get(d):h[d]},set:function(h,d,m){return"symbol"!==typeof d&&-1===d.indexOf("$")&&"dD"!==d&&"Sd"!==d&&"onChange"!==d?h.set(d,m):h[d]=m,!0},deleteProperty:function(h,d){return h.delete(d),!0}})}var L=function(){function d(h){var m=this;if(this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h)if(h instanceof Map||h instanceof d)h.forEach((function(h,d){return m.set(d,h)}));else for(var j in h)this.set(j,h[j])}return d.prototype.dD=function(d,m){return void 0===m&&(m=!0),S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,m?this.$items:void 0)},d.prototype.Sd=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return void 0!==h.map},d.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(d.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.set=function(d,m){if(void 0===m||null===m)throw new Error("MapSchema#set('".concat(d,"', ").concat(m,"): trying to set ").concat(m," value on '").concat(d,"'."));d=d.toString();var j="undefined"!==typeof this.$changes.indexes[d],A=j?this.$changes.indexes[d]:this.$refId++,b=j?h.OPERATION.REPLACE:h.OPERATION.ADD,w=void 0!==m.$changes;if(w&&m.$changes.setParent(this,this.$changes.root,A),j){if(!w&&this.$items.get(d)===m)return;w&&this.$items.get(d)!==m&&(b=h.OPERATION.ADD)}else this.$changes.indexes[d]=A,this.$indexes.set(A,d);return this.$items.set(d,m),this.$changes.change(d,b),this},d.prototype.get=function(h){return this.$items.get(h)},d.prototype.delete=function(h){return this.$changes.delete(h),this.$items.delete(h)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&M.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(h){return this.$items.has(h)},d.prototype.forEach=function(h){this.$items.forEach(h)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toJSON=function(){var h={};return this.forEach((function(d,m){h[m]="function"===typeof d.toJSON?d.toJSON():d})),h},d.prototype.clone=function(h){var m;return h?m=Object.assign(new d,this):(m=new d,this.forEach((function(h,d){h.$changes?m.set(d,h.clone()):m.set(d,h)}))),m},d}(),B={};function V(h,d){B[h]=d}function v(h){return B[h]}var C=function(){function h(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return h.create=function(d){var m=new h;return m.schema=Object.assign({},d&&d.schema||{}),m.indexes=Object.assign({},d&&d.indexes||{}),m.fieldsByIndex=Object.assign({},d&&d.fieldsByIndex||{}),m.descriptors=Object.assign({},d&&d.descriptors||{}),m.deprecated=Object.assign({},d&&d.deprecated||{}),m},h.prototype.addField=function(h,d){var m=this.getNextFieldIndex();this.fieldsByIndex[m]=h,this.indexes[h]=m,this.schema[h]=Array.isArray(d)?{array:d[0]}:d},h.prototype.hasField=function(h){return void 0!==this.indexes[h]},h.prototype.addFilter=function(h,d){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[h]]=d,this.indexesWithFilters.push(this.indexes[h]),!0},h.prototype.addChildrenFilter=function(h,d){var m=this.indexes[h],j=this.schema[h];if(v(Object.keys(j)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[m]=d,!0;console.warn("@filterChildren: field '".concat(h,"' can't have children. Ignoring filter."))},h.prototype.getChildrenFilter=function(h){return this.childFilters&&this.childFilters[this.indexes[h]]},h.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},h}();function T(h){return h._context&&h._context.useFilters}var o=function(){function h(){this.types={},this.schemas=new Map,this.useFilters=!1}return h.prototype.has=function(h){return this.schemas.has(h)},h.prototype.get=function(h){return this.types[h]},h.prototype.add=function(h,d){void 0===d&&(d=this.schemas.size),h._definition=C.create(h._definition),h._typeid=d,this.types[d]=h,this.schemas.set(h,d)},h.create=function(d){return void 0===d&&(d={}),function(m){return d.context||(d.context=new h),i(m,d)}},h}(),y=new o;function i(h,d){return void 0===d&&(d={}),function(m,j){var b=d.context||y,w=m.constructor;if(w._context=b,!h)throw new Error("".concat(w.name,': @type() reference provided for "').concat(j,"\" is undefined. Make sure you don't have any circular dependencies."));b.has(w)||b.add(w);var a=w._definition;if(a.addField(j,h),a.descriptors[j]){if(a.deprecated[j])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(j,"' definition on '").concat(w.name,"'.\nCheck @type() annotation"))}catch(B){var D=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(D))}}var S=R.is(h),M=!S&&L.is(h);if("string"!==typeof h&&!lh.is(h)){var q=Object.values(h)[0];"string"===typeof q||b.has(q)||b.add(q)}if(d.manual)a.descriptors[j]={enumerable:!0,configurable:!0,writable:!0};else{var E="_".concat(j);a.descriptors[E]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[j]={get:function(){return this[E]},set:function(h){h!==this[E]&&(void 0!==h&&null!==h?(!S||h instanceof R||(h=new(R.bind.apply(R,A([void 0],h,!1)))),!M||h instanceof L||(h=new L(h)),void 0===h.$proxy&&(M?h=Z(h):S&&(h=I(h))),this.$changes.change(j),h.$changes&&h.$changes.setParent(this,this.$changes.root,this._definition.indexes[j])):this[E]&&this.$changes.delete(j),this[E]=h)},enumerable:!0,configurable:!0}}}}function g(h){return function(d,m){var j=d.constructor;j._definition.addFilter(m,h)&&(j._context.useFilters=!0)}}function F(h){return function(d,m){var j=d.constructor;j._definition.addChildrenFilter(m,h)&&(j._context.useFilters=!0)}}function f(h){return void 0===h&&(h=!0),function(d,m){var j=d.constructor._definition;j.deprecated[m]=!0,h&&(j.descriptors[m]={get:function(){throw new Error("".concat(m," is deprecated."))},set:function(h){},enumerable:!1,configurable:!0})}}function H(h,d,m){for(var j in void 0===m&&(m={}),m.context||(m.context=h._context||m.context||y),d)i(d[j],m)(h.prototype,j);return h}function c(h){for(var d=0,m=0,j=0,A=h.length;j<A;j++)(d=h.charCodeAt(j))<128?m+=1:d<2048?m+=2:d<55296||d>=57344?m+=3:(j++,m+=4);return m}function k(h,d,m){for(var j=0,A=0,b=m.length;A<b;A++)(j=m.charCodeAt(A))<128?h[d++]=j:j<2048?(h[d++]=192|j>>6,h[d++]=128|63&j):j<55296||j>=57344?(h[d++]=224|j>>12,h[d++]=128|j>>6&63,h[d++]=128|63&j):(A++,j=65536+((1023&j)<<10|1023&m.charCodeAt(A)),h[d++]=240|j>>18,h[d++]=128|j>>12&63,h[d++]=128|j>>6&63,h[d++]=128|63&j)}function l(h,d){h.push(255&d)}function K(h,d){h.push(255&d)}function N(h,d){h.push(255&d),h.push(d>>8&255)}function W(h,d){h.push(255&d),h.push(d>>8&255)}function r(h,d){h.push(255&d),h.push(d>>8&255),h.push(d>>16&255),h.push(d>>24&255)}function Y(h,d){var m=d>>24,j=d>>16,A=d>>8,b=d;h.push(255&b),h.push(255&A),h.push(255&j),h.push(255&m)}function x(h,d){var m=Math.floor(d/Math.pow(2,32));Y(h,d>>>0),Y(h,m)}function Q(h,d){var m=d/Math.pow(2,32)|0;Y(h,d>>>0),Y(h,m)}function t(h,d){n(h,d)}function U(h,d){p(h,d)}var s=new Int32Array(2),J=new Float32Array(s.buffer),O=new Float64Array(s.buffer);function n(h,d){J[0]=d,r(h,s[0])}function p(h,d){O[0]=d,r(h,s[0]),r(h,s[1])}function e(h,d){return K(h,d?1:0)}function X(h,d){d||(d="");var m=c(d),j=0;if(m<32)h.push(160|m),j=1;else if(m<256)h.push(217),K(h,m),j=2;else if(m<65536)h.push(218),W(h,m),j=3;else{if(!(m<4294967296))throw new Error("String too long");h.push(219),Y(h,m),j=5}return k(h,h.length,d),j+m}function z(h,d){return isNaN(d)?z(h,0):isFinite(d)?d!==(0|d)?(h.push(203),p(h,d),9):d>=0?d<128?(K(h,d),1):d<256?(h.push(204),K(h,d),2):d<65536?(h.push(205),W(h,d),3):d<4294967296?(h.push(206),Y(h,d),5):(h.push(207),Q(h,d),9):d>=-32?(h.push(224|d+32),1):d>=-128?(h.push(208),l(h,d),2):d>=-32768?(h.push(209),N(h,d),3):d>=-2147483648?(h.push(210),r(h,d),5):(h.push(211),x(h,d),9):z(h,d>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var u=Object.freeze({__proto__:null,utf8Write:k,int8:l,uint8:K,int16:N,uint16:W,int32:r,uint32:Y,int64:x,uint64:Q,float32:t,float64:U,writeFloat32:n,writeFloat64:p,boolean:e,string:X,number:z});function P(h,d,m){for(var j="",A=0,b=d,w=d+m;b<w;b++){var a=h[b];0!==(128&a)?192!==(224&a)?224!==(240&a)?240!==(248&a)?console.error("Invalid byte "+a.toString(16)):(A=(7&a)<<18|(63&h[++b])<<12|(63&h[++b])<<6|63&h[++b])>=65536?(A-=65536,j+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):j+=String.fromCharCode(A):j+=String.fromCharCode((15&a)<<12|(63&h[++b])<<6|63&h[++b]):j+=String.fromCharCode((31&a)<<6|63&h[++b]):j+=String.fromCharCode(a)}return j}function G(h,d){return hh(h,d)<<24>>24}function hh(h,d){return h[d.offset++]}function dh(h,d){return mh(h,d)<<16>>16}function mh(h,d){return h[d.offset++]|h[d.offset++]<<8}function jh(h,d){return h[d.offset++]|h[d.offset++]<<8|h[d.offset++]<<16|h[d.offset++]<<24}function Ah(h,d){return jh(h,d)>>>0}function bh(h,d){return Eh(h,d)}function wh(h,d){return Ih(h,d)}function ah(h,d){var m=Ah(h,d);return jh(h,d)*Math.pow(2,32)+m}function Dh(h,d){var m=Ah(h,d);return Ah(h,d)*Math.pow(2,32)+m}var Sh=new Int32Array(2),Mh=new Float32Array(Sh.buffer),qh=new Float64Array(Sh.buffer);function Eh(h,d){return Sh[0]=jh(h,d),Mh[0]}function Ih(h,d){return Sh[0]=jh(h,d),Sh[1]=jh(h,d),qh[0]}function Rh(h,d){return hh(h,d)>0}function Zh(h,d){var m,j=h[d.offset++];j<192?m=31&j:217===j?m=hh(h,d):218===j?m=mh(h,d):219===j&&(m=Ah(h,d));var A=P(h,d.offset,m);return d.offset+=m,A}function Lh(h,d){var m=h[d.offset];return m<192&&m>160||217===m||218===m||219===m}function Bh(h,d){var m=h[d.offset++];return m<128?m:202===m?Eh(h,d):203===m?Ih(h,d):204===m?hh(h,d):205===m?mh(h,d):206===m?Ah(h,d):207===m?Dh(h,d):208===m?G(h,d):209===m?dh(h,d):210===m?jh(h,d):211===m?ah(h,d):m>223?-1*(255-m+1):void 0}function Vh(h,d){var m=h[d.offset];return m<128||m>=202&&m<=211}function vh(h,d){return h[d.offset]<160}function Ch(h,d){return h[d.offset-1]===w&&(h[d.offset]<128||h[d.offset]>=202&&h[d.offset]<=211)}var Th=Object.freeze({__proto__:null,int8:G,uint8:hh,int16:dh,uint16:mh,int32:jh,uint32:Ah,float32:bh,float64:wh,int64:ah,uint64:Dh,readFloat32:Eh,readFloat64:Ih,boolean:Rh,string:Zh,stringCheck:Lh,number:Bh,numberCheck:Vh,arrayCheck:vh,switchStructureCheck:Ch}),oh=function(){function d(h){var d=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return d.add(h)}))}return d.prototype.dD=function(d,m){return void 0===m&&(m=!0),S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,m?this.$items:void 0)},d.prototype.Sd=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return void 0!==h.collection},d.prototype.add=function(h){var d=this.$refId++;return void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,d),this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,h),this.$changes.change(d),d},d.prototype.at=function(h){var d=Array.from(this.$items.keys())[h];return this.$items.get(d)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(h){for(var d,m,j=this.$items.entries();(m=j.next())&&!m.done;)if(h===m.value[1]){d=m.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&M.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(h){return Array.from(this.$items.values()).some((function(d){return d===h}))},d.prototype.forEach=function(h){var d=this;this.$items.forEach((function(m,j,A){return h(m,j,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var h=[];return this.forEach((function(d,m){h.push("function"===typeof d.toJSON?d.toJSON():d)})),h},d.prototype.clone=function(h){var m;return h?m=Object.assign(new d,this):(m=new d,this.forEach((function(h){h.$changes?m.add(h.clone()):m.add(h)}))),m},d}(),yh=function(){function d(h){var d=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return d.add(h)}))}return d.prototype.dD=function(d,m){return void 0===m&&(m=!0),S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,m?this.$items:void 0)},d.prototype.Sd=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return void 0!==h.set},d.prototype.add=function(d){var m,j;if(this.has(d))return!1;var A=this.$refId++;void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,A);var b=null!==(j=null===(m=this.$changes.indexes[A])||void 0===m?void 0:m.op)&&void 0!==j?j:h.OPERATION.ADD;return this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,d),this.$changes.change(A,b),A},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(h){for(var d,m,j=this.$items.entries();(m=j.next())&&!m.done;)if(h===m.value[1]){d=m.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&M.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(h){for(var d,m=this.$items.values(),j=!1;(d=m.next())&&!d.done;)if(h===d.value){j=!0;break}return j},d.prototype.forEach=function(h){var d=this;this.$items.forEach((function(m,j,A){return h(m,j,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var h=[];return this.forEach((function(d,m){h.push("function"===typeof d.toJSON?d.toJSON():d)})),h},d.prototype.clone=function(h){var m;return h?m=Object.assign(new d,this):(m=new d,this.forEach((function(h){h.$changes?m.add(h.clone()):m.add(h)}))),m},d}(),ih=function(){function h(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return h.prototype.addRefId=function(h){this.refIds.has(h)||(this.refIds.add(h),this.containerIndexes.set(h,new Set))},h.get=function(d){return void 0===d.$filterState&&(d.$filterState=new h),d.$filterState},h}(),gh=function(){function h(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return h.prototype.getNextUniqueId=function(){return this.nextUniqueId++},h.prototype.addRef=function(h,d,m){void 0===m&&(m=!0),this.refs.set(h,d),m&&(this.refCounts[h]=(this.refCounts[h]||0)+1)},h.prototype.removeRef=function(h){this.refCounts[h]=this.refCounts[h]-1,this.deletedRefs.add(h)},h.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},h.prototype.garbageCollectDeletedRefs=function(){var h=this;this.deletedRefs.forEach((function(d){if(!(h.refCounts[d]>0)){var m=h.refs.get(d);if(m instanceof lh)for(var j in m._definition.schema)"string"!==typeof m._definition.schema[j]&&m[j]&&m[j].$changes&&h.removeRef(m[j].$changes.refId);else{var A=m.$changes.parent._definition,b=A.schema[A.fieldsByIndex[m.$changes.parentIndex]];"function"===typeof Object.values(b)[0]&&Array.from(m.values()).forEach((function(d){return h.removeRef(d.$changes.refId)}))}h.refs.delete(d),delete h.refCounts[d]}})),this.deletedRefs.clear()},h}(),Fh=function(h){function d(){return null!==h&&h.apply(this,arguments)||this}return m(d,h),d}(Error);function fh(h,d,m,j){var A,b=!1;switch(d){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":A="number",isNaN(h)&&console.log('trying to encode "NaN" in '.concat(m.constructor.name,"#").concat(j));break;case"string":A="string",b=!0;break;case"boolean":return}if(typeof h!==A&&(!b||b&&null!==h)){var w="'".concat(JSON.stringify(h),"'").concat(h&&h.constructor&&" (".concat(h.constructor.name,")")||"");throw new Fh("a '".concat(A,"' was expected, but ").concat(w," was provided in ").concat(m.constructor.name,"#").concat(j))}}function Hh(h,d,m,j){if(!(h instanceof d))throw new Fh("a '".concat(d.name,"' was expected, but '").concat(h.constructor.name,"' was provided in ").concat(m.constructor.name,"#").concat(j))}function ch(h,d,m,j,A){fh(m,h,j,A);var b=u[h];if(!b)throw new Fh("a '".concat(h,"' was expected, but ").concat(m," was provided in ").concat(j.constructor.name,"#").concat(A));b(d,m)}function kh(h,d,m){return Th[h](d,m)}var lh=function(){function d(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];Object.defineProperties(this,{$changes:{value:new D(this,void 0,new gh),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var m=this._definition.descriptors;m&&Object.defineProperties(this,m),h[0]&&this.assign(h[0])}return d.onError=function(h){console.error(h)},d.is=function(h){return h._definition&&void 0!==h._definition.schema},d.prototype.onChange=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.prototype.Sd=function(d){return S(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.assign=function(h){return Object.assign(this,h),this},Object.defineProperty(d.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),d.prototype.setDirty=function(h,d){this.$changes.change(h,d)},d.prototype.listen=function(h,d,m){var j=this;return void 0===m&&(m=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[h]||(this.$callbacks[h]=[]),this.$callbacks[h].push(d),m&&void 0!==this[h]&&d(this[h],void 0),function(){return q(j.$callbacks[h],j.$callbacks[h].indexOf(d))}},d.prototype.decode=function(m,j,A){var b;void 0===j&&(j={offset:0}),void 0===A&&(A=this);var a=[],D=this.$changes.root,S=m.length,M=0;for(D.refs.set(M,this);j.offset<S;){var q=m[j.offset++];if(q!=w){var E=A.$changes,I=void 0!==A._definition,Z=I?q>>6<<6:q;if(Z!==h.OPERATION.CLEAR){var B=I?q%(Z||255):Bh(m,j),V=I?A._definition.fieldsByIndex[B]:"",C=E.getType(B),T=void 0,o=void 0,y=void 0;if(I?o=A["_".concat(V)]:(o=A.getByIndex(B),(Z&h.OPERATION.ADD)===h.OPERATION.ADD?(y=A instanceof L?Zh(m,j):B,A.setIndex(B,y)):y=A.getIndex(B)),(Z&h.OPERATION.DELETE)===h.OPERATION.DELETE&&(Z!==h.OPERATION.DELETE_AND_ADD&&A.deleteByIndex(B),o&&o.$changes&&D.removeRef(o.$changes.refId),T=null),void 0!==V){if(Z===h.OPERATION.DELETE);else if(d.is(C)){var i=Bh(m,j);if(T=D.refs.get(i),Z!==h.OPERATION.REPLACE){var g=this.getSchemaType(m,j,C);T||((T=this.createTypeInstance(g)).$changes.refId=i,o&&(T.$callbacks=o.$callbacks,o.$changes.refId&&i!==o.$changes.refId&&D.removeRef(o.$changes.refId))),D.addRef(i,T,T!==o)}}else if("string"===typeof C)T=kh(C,m,j);else{var F=v(Object.keys(C)[0]),f=Bh(m,j),H=D.refs.has(f)?o||D.refs.get(f):new F.constructor;if((T=H.clone(!0)).$changes.refId=f,o&&(T.$callbacks=o.$callbacks,o.$changes.refId&&f!==o.$changes.refId)){D.removeRef(o.$changes.refId);for(var c=o.entries(),k=void 0;(k=c.next())&&!k.done;){var l=(b=k.value)[0],K=b[1];a.push({refId:f,op:h.OPERATION.DELETE,field:l,value:void 0,previousValue:K})}}D.addRef(f,T,H!==o)}if(null!==T&&void 0!==T)if(T.$changes&&T.$changes.setParent(E.ref,E.root,B),A instanceof d)A[V]=T;else if(A instanceof L)l=y,A.$items.set(l,T),A.$changes.allChanges.add(B);else if(A instanceof R)A.setAt(B,T);else if(A instanceof oh){var N=A.add(T);A.setIndex(B,N)}else A instanceof yh&&!1!==(N=A.add(T))&&A.setIndex(B,N);o!==T&&a.push({refId:M,op:Z,field:V,dynamicIndex:y,value:T,previousValue:o})}else{console.warn("@colyseus/schema: definition mismatch");for(var W={offset:j.offset};j.offset<S&&(!Ch(m,j)||(W.offset=j.offset+1,!D.refs.has(Bh(m,W))));)j.offset++}}else A.clear(a)}else{M=Bh(m,j);var r=D.refs.get(M);if(!r)throw new Error('"refId" not found: '.concat(M));A=r}}return this._triggerChanges(a),D.garbageCollectDeletedRefs(),a},d.prototype.encode=function(m,j,A){void 0===m&&(m=!1),void 0===j&&(j=[]),void 0===A&&(A=!1);for(var b=this.$changes,a=new WeakSet,D=[b],S=1,M=0;M<S;M++){var q=D[M],E=q.ref,I=E instanceof d;q.ensureRefId(),a.add(q),q!==b&&(q.changed||m)&&(K(j,w),z(j,q.refId));for(var R=m?Array.from(q.allChanges):Array.from(q.changes.values()),Z=0,B=R.length;Z<B;Z++){var V=m?{op:h.OPERATION.ADD,index:R[Z]}:R[Z],C=V.index,T=I?E._definition.fieldsByIndex&&E._definition.fieldsByIndex[C]:C,o=j.length;if(V.op!==h.OPERATION.TOUCH)if(I)K(j,C|V.op);else{if(K(j,V.op),V.op===h.OPERATION.CLEAR)continue;z(j,C)}if(I||(V.op&h.OPERATION.ADD)!=h.OPERATION.ADD||E instanceof L&&X(j,q.ref.$indexes.get(C)),V.op!==h.OPERATION.DELETE){var y=q.getType(C),i=q.getValue(C);if(i&&i.$changes&&!a.has(i.$changes)&&(D.push(i.$changes),i.$changes.ensureRefId(),S++),V.op!==h.OPERATION.TOUCH){if(d.is(y))Hh(i,y,E,T),z(j,i.$changes.refId),(V.op&h.OPERATION.ADD)===h.OPERATION.ADD&&this.tryEncodeTypeId(j,y,i.constructor);else if("string"===typeof y)ch(y,j,i,E,T);else{var g=v(Object.keys(y)[0]);Hh(E["_".concat(T)],g.constructor,E,T),z(j,i.$changes.refId)}A&&q.cache(C,j.slice(o))}}}m||A||q.discard()}return j},d.prototype.encodeAll=function(h){return this.encode(!0,[],h)},d.prototype.applyFilters=function(m,j){var A,b;void 0===j&&(j=!1);for(var a=this,D=new Set,S=ih.get(m),M=[this.$changes],q=1,E=[],I=function(I){var R=M[I];if(D.has(R.refId))return"continue";var Z=R.ref,B=Z instanceof d;K(E,w),z(E,R.refId);var V=S.refIds.has(R),v=j||!V;S.addRefId(R);var C=S.containerIndexes.get(R),T=v?Array.from(R.allChanges):Array.from(R.changes.values());!j&&B&&Z._definition.indexesWithFilters&&Z._definition.indexesWithFilters.forEach((function(d){!C.has(d)&&R.allChanges.has(d)&&(v?T.push(d):T.push({op:h.OPERATION.ADD,index:d}))}));for(var o=0,y=T.length;o<y;o++){var i=v?{op:h.OPERATION.ADD,index:T[o]}:T[o];if(i.op!==h.OPERATION.CLEAR){var g=i.index;if(i.op!==h.OPERATION.DELETE){var F=R.getValue(g),f=R.getType(g);if(B){if((H=Z._definition.filters&&Z._definition.filters[g])&&!H.call(Z,m,F,a)){F&&F.$changes&&D.add(F.$changes.refId);continue}}else{var H,c=R.parent;if((H=R.getChildrenFilter())&&!H.call(c,m,Z.$indexes.get(g),F,a)){F&&F.$changes&&D.add(F.$changes.refId);continue}}if(F.$changes&&(M.push(F.$changes),q++),i.op!==h.OPERATION.TOUCH)if(i.op===h.OPERATION.ADD||B)E.push.apply(E,null!==(A=R.caches[g])&&void 0!==A?A:[]),C.add(g);else if(C.has(g))E.push.apply(E,null!==(b=R.caches[g])&&void 0!==b?b:[]);else{if(C.add(g),K(E,h.OPERATION.ADD),z(E,g),Z instanceof L){var k=R.ref.$indexes.get(g);X(E,k)}F.$changes?z(E,F.$changes.refId):u[f](E,F)}else F.$changes&&!B&&(K(E,h.OPERATION.ADD),z(E,g),Z instanceof L&&(k=R.ref.$indexes.get(g),X(E,k)),z(E,F.$changes.refId))}else B?K(E,i.op|g):(K(E,i.op),z(E,g))}else K(E,i.op)}},R=0;R<q;R++)I(R);return E},d.prototype.clone=function(){var h,d=new this.constructor,m=this._definition.schema;for(var j in m)"object"===typeof this[j]&&"function"===typeof(null===(h=this[j])||void 0===h?void 0:h.clone)?d[j]=this[j].clone():d[j]=this[j];return d},d.prototype.toJSON=function(){var h=this._definition.schema,d=this._definition.deprecated,m={};for(var j in h)d[j]||null===this[j]||"undefined"===typeof this[j]||(m[j]="function"===typeof this[j].toJSON?this[j].toJSON():this["_".concat(j)]);return m},d.prototype.discardAllChanges=function(){this.$changes.discardAll()},d.prototype.getByIndex=function(h){return this[this._definition.fieldsByIndex[h]]},d.prototype.deleteByIndex=function(h){this[this._definition.fieldsByIndex[h]]=void 0},d.prototype.tryEncodeTypeId=function(h,d,m){d._typeid!==m._typeid&&(K(h,a),z(h,m._typeid))},d.prototype.getSchemaType=function(h,d,m){var j;return h[d.offset]===a&&(d.offset++,j=this.constructor._context.get(Bh(h,d))),j||m},d.prototype.createTypeInstance=function(h){var d=new h;return d.$changes.root=this.$changes.root,d},d.prototype._triggerChanges=function(m){for(var j,A,b,w,a,D,S,M,q,E=new Set,I=this.$changes.root.refs,R=function(R){var Z=m[R],L=Z.refId,B=I.get(L),V=B.$callbacks;if((Z.op&h.OPERATION.DELETE)===h.OPERATION.DELETE&&Z.previousValue instanceof d&&(null===(A=null===(j=Z.previousValue.$callbacks)||void 0===j?void 0:j[h.OPERATION.DELETE])||void 0===A||A.forEach((function(h){return h()}))),!V)return"continue";if(B instanceof d){if(!E.has(L))try{null===(b=null===V||void 0===V?void 0:V[h.OPERATION.REPLACE])||void 0===b||b.forEach((function(h){return h()}))}catch(v){d.onError(v)}try{V.hasOwnProperty(Z.field)&&(null===(w=V[Z.field])||void 0===w||w.forEach((function(h){return h(Z.value,Z.previousValue)})))}catch(v){d.onError(v)}}else Z.op===h.OPERATION.ADD&&void 0===Z.previousValue?null===(a=V[h.OPERATION.ADD])||void 0===a||a.forEach((function(h){var d;return h(Z.value,null!==(d=Z.dynamicIndex)&&void 0!==d?d:Z.field)})):Z.op===h.OPERATION.DELETE?void 0!==Z.previousValue&&(null===(D=V[h.OPERATION.DELETE])||void 0===D||D.forEach((function(h){var d;return h(Z.previousValue,null!==(d=Z.dynamicIndex)&&void 0!==d?d:Z.field)}))):Z.op===h.OPERATION.DELETE_AND_ADD&&(void 0!==Z.previousValue&&(null===(S=V[h.OPERATION.DELETE])||void 0===S||S.forEach((function(h){var d;return h(Z.previousValue,null!==(d=Z.dynamicIndex)&&void 0!==d?d:Z.field)}))),null===(M=V[h.OPERATION.ADD])||void 0===M||M.forEach((function(h){var d;return h(Z.value,null!==(d=Z.dynamicIndex)&&void 0!==d?d:Z.field)}))),Z.value!==Z.previousValue&&(null===(q=V[h.OPERATION.REPLACE])||void 0===q||q.forEach((function(h){var d;return h(Z.value,null!==(d=Z.dynamicIndex)&&void 0!==d?d:Z.field)})));E.add(L)},Z=0;Z<m.length;Z++)R(Z)},d._definition=C.create(),d}();function Kh(h){for(var d=[h.$changes],m=1,j={},A=j,b=function(h){var m=d[h];m.changes.forEach((function(h){var d=m.ref,j=h.index,b=d._definition?d._definition.fieldsByIndex[j]:d.$indexes.get(j);A[b]=m.getValue(j)}))},w=0;w<m;w++)b(w);return j}var Nh={context:new o},Wh=function(h){function d(){return null!==h&&h.apply(this,arguments)||this}return m(d,h),j([i("string",Nh)],d.prototype,"name",void 0),j([i("string",Nh)],d.prototype,"type",void 0),j([i("number",Nh)],d.prototype,"referencedType",void 0),d}(lh),rh=function(h){function d(){var d=null!==h&&h.apply(this,arguments)||this;return d.fields=new R,d}return m(d,h),j([i("number",Nh)],d.prototype,"id",void 0),j([i([Wh],Nh)],d.prototype,"fields",void 0),d}(lh),Yh=function(h){function d(){var d=null!==h&&h.apply(this,arguments)||this;return d.types=new R,d}return m(d,h),d.encode=function(h){var m=h.constructor,j=new d;j.rootType=m._typeid;var A=function(h,d){for(var m in d){var A=new Wh;A.name=m;var b=void 0;if("string"===typeof d[m])b=d[m];else{var w=d[m],a=void 0;lh.is(w)?(b="ref",a=d[m]):"string"===typeof w[b=Object.keys(w)[0]]?b+=":"+w[b]:a=w[b],A.referencedType=a?a._typeid:-1}A.type=b,h.fields.push(A)}j.types.push(h)},b=m._context.types;for(var w in b){var a=new rh;a.id=Number(w),A(a,b[w]._definition.schema)}return j.encodeAll()},d.decode=function(h,j){var A=new o,b=new d;b.decode(h,j);var w=b.types.reduce((function(h,d){var j=function(h){function d(){return null!==h&&h.apply(this,arguments)||this}return m(d,h),d}(lh),b=d.id;return h[b]=j,A.add(j,b),h}),{});b.types.forEach((function(h){var d=w[h.id];h.fields.forEach((function(h){var m;if(void 0!==h.referencedType){var j=h.type,b=w[h.referencedType];if(!b){var a=h.type.split(":");j=a[0],b=a[1]}"ref"===j?i(b,{context:A})(d.prototype,h.name):i(((m={})[j]=b,m),{context:A})(d.prototype,h.name)}else i(h.type,{context:A})(d.prototype,h.name)}))}));var a=w[b.rootType],D=new a;for(var S in a._definition.schema){var M=a._definition.schema[S];"string"!==typeof M&&(D[S]="function"===typeof M?new M:new(v(Object.keys(M)[0]).constructor))}return D},j([i([rh],Nh)],d.prototype,"types",void 0),j([i("number",Nh)],d.prototype,"rootType",void 0),d}(lh);V("map",{constructor:L}),V("array",{constructor:R}),V("set",{constructor:yh}),V("collection",{constructor:oh}),h.ArraySchema=R,h.CollectionSchema=oh,h.Context=o,h.MapSchema=L,h.Reflection=Yh,h.ReflectionField=Wh,h.ReflectionType=rh,h.Schema=lh,h.SchemaDefinition=C,h.SetSchema=yh,h.decode=Th,h.defineTypes=H,h.deprecated=f,h.dumpChanges=Kh,h.encode=u,h.filter=g,h.filterChildren=F,h.hasFilter=T,h.registerType=V,h.type=i,Object.defineProperty(h,"__esModule",{value:!0})}(d)},12923:h=>{h.exports=function(h){return null!=h&&null!=h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}},12912:(h,d,m)=>{"use strict";var j=m(12916),A=m(12921),b=m(12923);m.g.__TYPEDARRAY_POOL||(m.g.__TYPEDARRAY_POOL={UINT8:A([32,0]),UINT16:A([32,0]),UINT32:A([32,0]),INT8:A([32,0]),INT16:A([32,0]),INT32:A([32,0]),FLOAT:A([32,0]),DOUBLE:A([32,0]),DATA:A([32,0]),UINT8C:A([32,0]),BUFFER:A([32,0])});var w="undefined"!==typeof Uint8ClampedArray,a=m.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=A([32,0])),a.BUFFER||(a.BUFFER=A([32,0]));var D=a.DATA,S=a.BUFFER;function M(h){if(h){var d=h.length||h.byteLength,m=j.log2(d);D[m].push(h)}}function q(h){h=j.nextPow2(h);var d=j.log2(h),m=D[d];return m.length>0?m.pop():new ArrayBuffer(h)}function E(h){return new Uint8Array(q(h),0,h)}function I(h){return new Uint16Array(q(2*h),0,h)}function R(h){return new Uint32Array(q(4*h),0,h)}function Z(h){return new Int8Array(q(h),0,h)}function L(h){return new Int16Array(q(2*h),0,h)}function B(h){return new Int32Array(q(4*h),0,h)}function V(h){return new Float32Array(q(4*h),0,h)}function v(h){return new Float64Array(q(8*h),0,h)}function C(h){return w?new Uint8ClampedArray(q(h),0,h):E(h)}function T(h){return new DataView(q(h),0,h)}d.free=function(h){if(b(h))S[j.log2(h.length)].push(h);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(h)&&(h=h.buffer),!h)return;var d=h.length||h.byteLength,m=0|j.log2(d);D[m].push(h)}},d.freeUint8=d.freeUint16=d.freeUint32=d.freeInt8=d.freeInt16=d.freeInt32=d.freeFloat32=d.freeFloat=d.freeFloat64=d.freeDouble=d.freeUint8Clamped=d.freeDataView=function(h){M(h.buffer)},d.freeArrayBuffer=M,d.freeBuffer=function(h){S[j.log2(h.length)].push(h)},d.malloc=function(h,d){if(void 0===d||"arraybuffer"===d)return q(h);switch(d){case"uint8":return E(h);case"uint16":return I(h);case"uint32":return R(h);case"int8":return Z(h);case"int16":return L(h);case"int32":return B(h);case"float":case"float32":return V(h);case"double":case"float64":return v(h);case"uint8_clamped":return C(h);case"buffer":throw"Buffer not supported";case"data":case"dataview":return T(h);default:return null}return null},d.mallocArrayBuffer=q,d.mallocUint8=E,d.mallocUint16=I,d.mallocUint32=R,d.mallocInt8=Z,d.mallocInt16=L,d.mallocInt32=B,d.mallocFloat32=d.mallocFloat=V,d.mallocFloat64=d.mallocDouble=v,d.mallocUint8Clamped=C,d.mallocDataView=T,d.clearCache=function(){for(var h=0;h<32;++h)a.UINT8[h].length=0,a.UINT16[h].length=0,a.UINT32[h].length=0,a.INT8[h].length=0,a.INT16[h].length=0,a.INT32[h].length=0,a.FLOAT[h].length=0,a.DOUBLE[h].length=0,a.UINT8C[h].length=0,D[h].length=0,S[h].length=0}},13006:(h,d,m)=>{h.exports=A;var j=m(116);function A(h,d){if(!(this instanceof A))return new A(h,d);var m=j.create();j.add(m,h,d),this.base=j.min(j.create(),h,m),this.wM=j.clone(d),this.max=j.max(j.create(),h,m),this.mag=j.length(this.wM)}var b=A.prototype;b.width=function(){return this.wM[0]},b.height=function(){return this.wM[1]},b.depth=function(){return this.wM[2]},b.x0=function(){return this.base[0]},b.y0=function(){return this.base[1]},b.z0=function(){return this.base[2]},b.x1=function(){return this.max[0]},b.y1=function(){return this.max[1]},b.z1=function(){return this.max[2]},b.translate=function(h){return j.add(this.max,this.max,h),j.add(this.base,this.base,h),this},b.setPosition=function(h){return j.add(this.max,h,this.wM),j.i(this.base,h),this},b.expand=function(h){var d=j.create(),m=j.create();return j.max(d,h.max,this.max),j.min(m,h.base,this.base),j.fm(d,d,m),new A(m,d)},b.intersects=function(h){return!(h.base[0]>this.max[0])&&(!(h.base[1]>this.max[1])&&(!(h.base[2]>this.max[2])&&(!(h.max[0]<this.base[0])&&(!(h.max[1]<this.base[1])&&!(h.max[2]<this.base[2])))))},b.touches=function(h){var d=this.union(h);return null!==d&&(0==d.width()||0==d.height()||0==d.depth())},b.union=function(h){if(!this.intersects(h))return null;var d=Math.max(h.base[0],this.base[0]),m=Math.max(h.base[1],this.base[1]),j=Math.max(h.base[2],this.base[2]);return new A([d,m,j],[Math.min(h.max[0],this.max[0])-d,Math.min(h.max[1],this.max[1])-m,Math.min(h.max[2],this.max[2])-j])}},12916:(h,d)=>{"use strict";function m(h){var d=32;return(h&=-h)&&d--,65535&h&&(d-=16),16711935&h&&(d-=8),252645135&h&&(d-=4),858993459&h&&(d-=2),1431655765&h&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(h){return(h>0)-(h<0)},d.abs=function(h){var d=h>>31;return(h^d)-d},d.min=function(h,d){return d^(h^d)&-(h<d)},d.max=function(h,d){return h^(h^d)&-(h<d)},d.isPow2=function(h){return!(h&h-1)&&!!h},d.log2=function(h){var d,m;return d=(h>65535)<<4,d|=m=((h>>>=d)>255)<<3,d|=m=((h>>>=m)>15)<<2,(d|=m=((h>>>=m)>3)<<1)|(h>>>=m)>>1},d.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},d.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},d.countTrailingZeros=m,d.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},d.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},d.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var j=new Array(256);!function(h){for(var d=0;d<256;++d){var m=d,j=d,A=7;for(m>>>=1;m;m>>>=1)j<<=1,j|=1&m,--A;h[d]=j<<A&255}}(j),d.reverse=function(h){return j[255&h]<<24|j[h>>>8&255]<<16|j[h>>>16&255]<<8|j[h>>>24&255]},d.interleave2=function(h,d){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(h,d){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>d&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},d.interleave3=function(h,d,m){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(m=1227133513&((m=3272356035&((m=251719695&((m=4278190335&((m&=1023)|m<<16))|m<<8))|m<<4))|m<<2))<<2},d.deinterleave3=function(h,d){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>d&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},d.nextCombination=function(h){var d=h|h-1;return d+1|(~d&-~d)-1>>>m(h)+1}},12908:(h,d,m)=>{"use strict";h.exports=function(h,d,m){switch(arguments.length){case 1:return j=[],S(A=h,A,M,!0),j;case 2:return"function"===typeof d?S(h,h,d,!0):function(h,d){return j=[],S(h,d,M,!1),j}(h,d);case 3:return S(h,d,m,!1);default:throw new Error("box-intersect: Invalid arguments")}var A};var j,A=m(12912),b=m(12927),w=m(12940);function a(h,d){for(var m=0;m<h;++m)if(!(d[m]<=d[m+h]))return!0;return!1}function D(h,d,m,j){for(var A=0,b=0,w=0,D=h.length;w<D;++w){var S=h[w];if(!a(d,S)){for(var M=0;M<2*d;++M)m[A++]=S[M];j[b++]=w}}return b}function S(h,d,m,j){var a=h.length,S=d.length;if(!(a<=0||S<=0)){var M=h[0].length>>>1;if(!(M<=0)){var q,E=A.mallocDouble(2*M*a),I=A.mallocInt32(a);if((a=D(h,M,E,I))>0){if(1===M&&j)b.init(a),q=b.sweepComplete(M,m,0,a,E,I,0,a,E,I);else{var R=A.mallocDouble(2*M*S),Z=A.mallocInt32(S);(S=D(d,M,R,Z))>0&&(b.init(a+S),q=1===M?b.sweepBipartite(M,m,0,a,E,I,0,S,R,Z):w(M,m,j,a,E,I,S,R,Z),A.free(R),A.free(Z))}A.free(E),A.free(I)}return q}}}function M(h,d){j.push([h,d])}},12949:(h,d)=>{"use strict";var m="d",j="ax",A="fp",b="es",w="rs",a="re",D="rb",S="bs",M="be",q="bb",E=[m,j,"vv",w,a,D,"ri",S,M,q,"bi"];function I(h){var d="bruteForce"+(h?"Full":"Partial"),j=[],w=E.slice();h||w.splice(3,0,A);var a=["function "+d+"("+w.join()+"){"];function D(d,A){var w=function(h,d,j){var A="bruteForce"+(h?"Red":"Blue")+(d?"Flip":"")+(j?"Full":""),w=["function ",A,"(",E.join(),"){","var ",b,"=2*",m,";"],a="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",D="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(j?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return h?w.push(a,"Q",":",D):w.push(D,"Q",":",a),j?w.push("if(y1<x0||x1<y0)continue;"):d?w.push("if(y0<=x0||x1<y0)continue;"):w.push("if(y0<x0||x1<y0)continue;"),w.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),d?w.push("yi,xi"):w.push("xi,yi"),w.push(");if(rv!==void 0)return rv;}}}"),{name:A,code:w.join("")}}(d,A,h);j.push(w.code),a.push("return "+w.name+"("+E.join()+");")}a.push("if(re-rs>be-bs){"),h?(D(!0,!1),a.push("}else{"),D(!1,!1)):(a.push("if(fp){"),D(!0,!0),a.push("}else{"),D(!0,!1),a.push("}}else{if(fp){"),D(!1,!0),a.push("}else{"),D(!1,!1),a.push("}")),a.push("}}return "+d);var S=j.join("")+a.join("");return new Function(S)()}d.partial=I(!1),d.full=I(!0)},12940:(h,d,m)=>{"use strict";h.exports=function(h,d,m,b,M,f,H,c,k){!function(h,d){var m=8*A.log2(d+1)*(h+1)|0,b=A.nextPow2(C*m);o.length<b&&(j.free(o),o=j.mallocInt32(b));var w=A.nextPow2(T*m);y.length<w&&(j.free(y),y=j.mallocDouble(w))}(h,b+H);var l,K=0,N=2*h;i(K++,0,0,b,0,H,m?16:0,-1/0,1/0),m||i(K++,0,0,H,0,b,1,-1/0,1/0);for(;K>0;){var W=(K-=1)*C,r=o[W],Y=o[W+1],x=o[W+2],Q=o[W+3],t=o[W+4],U=o[W+5],s=K*T,J=y[s],O=y[s+1],n=1&U,p=!!(16&U),e=M,X=f,z=c,u=k;if(n&&(e=c,X=k,z=M,u=f),!(2&U&&Y>=(x=L(h,r,Y,x,e,X,O)))&&!(4&U&&(Y=B(h,r,Y,x,e,X,J))>=x)){var P=x-Y,G=t-Q;if(p){if(h*P*(P+G)<I){if(void 0!==(l=D.scanComplete(h,r,d,Y,x,e,X,Q,t,z,u)))return l;continue}}else{if(h*Math.min(P,G)<q){if(void 0!==(l=w(h,r,d,n,Y,x,e,X,Q,t,z,u)))return l;continue}if(h*P*G<E){if(void 0!==(l=D.scanBipartite(h,r,d,n,Y,x,e,X,Q,t,z,u)))return l;continue}}var hh=R(h,r,Y,x,e,X,J,O);if(Y<hh)if(h*(hh-Y)<q){if(void 0!==(l=a(h,r+1,d,Y,hh,e,X,Q,t,z,u)))return l}else if(r===h-2){if(void 0!==(l=n?D.sweepBipartite(h,d,Q,t,z,u,Y,hh,e,X):D.sweepBipartite(h,d,Y,hh,e,X,Q,t,z,u)))return l}else i(K++,r+1,Y,hh,Q,t,n,-1/0,1/0),i(K++,r+1,Q,t,Y,hh,1^n,-1/0,1/0);if(hh<x){var dh=S(h,r,Q,t,z,u),mh=z[N*dh+r],jh=Z(h,r,dh,t,z,u,mh);if(jh<t&&i(K++,r,hh,x,jh,t,(4|n)+(p?16:0),mh,O),Q<dh&&i(K++,r,hh,x,Q,dh,(2|n)+(p?16:0),J,mh),dh+1===jh){if(void 0!==(l=p?F(h,r,d,hh,x,e,X,dh,z,u[dh]):g(h,r,d,n,hh,x,e,X,dh,z,u[dh])))return l}else if(dh<jh){var Ah;if(p){if(hh<(Ah=V(h,r,hh,x,e,X,mh))){var bh=Z(h,r,hh,Ah,e,X,mh);if(r===h-2){if(hh<bh&&void 0!==(l=D.sweepComplete(h,d,hh,bh,e,X,dh,jh,z,u)))return l;if(bh<Ah&&void 0!==(l=D.sweepBipartite(h,d,bh,Ah,e,X,dh,jh,z,u)))return l}else hh<bh&&i(K++,r+1,hh,bh,dh,jh,16,-1/0,1/0),bh<Ah&&(i(K++,r+1,bh,Ah,dh,jh,0,-1/0,1/0),i(K++,r+1,dh,jh,bh,Ah,1,-1/0,1/0))}}else hh<(Ah=n?v(h,r,hh,x,e,X,mh):V(h,r,hh,x,e,X,mh))&&(r===h-2?l=n?D.sweepBipartite(h,d,dh,jh,z,u,hh,Ah,e,X):D.sweepBipartite(h,d,hh,Ah,e,X,dh,jh,z,u):(i(K++,r+1,hh,Ah,dh,jh,n,-1/0,1/0),i(K++,r+1,dh,jh,hh,Ah,1^n,-1/0,1/0)))}}}}};var j=m(12912),A=m(12916),b=m(12949),w=b.partial,a=b.full,D=m(12927),S=m(12954),M=m(12959),q=128,E=1<<22,I=1<<22,R=M("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Z=M("lo===p0",["p0"]),L=M("lo<p0",["p0"]),B=M("hi<=p0",["p0"]),V=M("lo<=p0&&p0<=hi",["p0"]),v=M("lo<p0&&p0<=hi",["p0"]),C=6,T=2,o=j.mallocInt32(1024),y=j.mallocDouble(1024);function i(h,d,m,j,A,b,w,a,D){var S=C*h;o[S]=d,o[S+1]=m,o[S+2]=j,o[S+3]=A,o[S+4]=b,o[S+5]=w;var M=T*h;y[M]=a,y[M+1]=D}function g(h,d,m,j,A,b,w,a,D,S,M){var q=2*h,E=D*q,I=S[E+d];h:for(var R=A,Z=A*q;R<b;++R,Z+=q){var L=w[Z+d],B=w[Z+d+h];if(!(I<L||B<I)&&(!j||I!==L)){for(var V,v=a[R],C=d+1;C<h;++C){L=w[Z+C],B=w[Z+C+h];var T=S[E+C],o=S[E+C+h];if(B<T||o<L)continue h}if(void 0!==(V=j?m(M,v):m(v,M)))return V}}}function F(h,d,m,j,A,b,w,a,D,S){var M=2*h,q=a*M,E=D[q+d];h:for(var I=j,R=j*M;I<A;++I,R+=M){var Z=w[I];if(Z!==S){var L=b[R+d],B=b[R+d+h];if(!(E<L||B<E)){for(var V=d+1;V<h;++V){L=b[R+V],B=b[R+V+h];var v=D[q+V],C=D[q+V+h];if(B<v||C<L)continue h}var T=m(Z,S);if(void 0!==T)return T}}}}},12954:(h,d,m)=>{"use strict";h.exports=function(h,d,m,w,a,D){if(w<=m+1)return m;var S=m,M=w,q=w+m>>>1,E=2*h,I=q,R=a[E*q+d];for(;S<M;){if(M-S<A){b(h,d,S,M,a,D),R=a[E*q+d];break}var Z=M-S,L=Math.random()*Z+S|0,B=a[E*L+d],V=Math.random()*Z+S|0,v=a[E*V+d],C=Math.random()*Z+S|0,T=a[E*C+d];B<=v?T>=v?(I=V,R=v):B>=T?(I=L,R=B):(I=C,R=T):v>=T?(I=V,R=v):T>=B?(I=L,R=B):(I=C,R=T);for(var o=E*(M-1),y=E*I,i=0;i<E;++i,++o,++y){var g=a[o];a[o]=a[y],a[y]=g}var F=D[M-1];D[M-1]=D[I],D[I]=F;for(o=E*(M-1),y=E*(I=j(h,d,S,M-1,a,D,R)),i=0;i<E;++i,++o,++y){g=a[o];a[o]=a[y],a[y]=g}F=D[M-1];if(D[M-1]=D[I],D[I]=F,q<I){for(M=I-1;S<M&&a[E*(M-1)+d]===R;)M-=1;M+=1}else{if(!(I<q))break;for(S=I+1;S<M&&a[E*S+d]===R;)S+=1}}return j(h,d,m,q,a,D,a[E*q+d])};var j=m(12959)("lo<p0",["p0"]),A=8;function b(h,d,m,j,A,b){for(var w=2*h,a=w*(m+1)+d,D=m+1;D<j;++D,a+=w)for(var S=A[a],M=D,q=w*(D-1);M>m&&A[q+d]>S;--M,q-=w){for(var E=q,I=q+w,R=0;R<w;++R,++E,++I){var Z=A[E];A[E]=A[I],A[I]=Z}var L=b[M];b[M]=b[M-1],b[M-1]=L}}},12959:h=>{"use strict";h.exports=function(h,m){var j="abcdef".split("").concat(m),A=[];h.indexOf("lo")>=0&&A.push("lo=e[k+n]");h.indexOf("hi")>=0&&A.push("hi=e[k+o]");return j.push(d.replace("_",A.join()).replace("$",h)),Function.apply(void 0,j)};var d="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12933:h=>{"use strict";h.exports=function(h,j){j<=4*d?m(0,j-1,h):S(0,j-1,h)};var d=32;function m(h,d,m){for(var j=2*(h+1),A=h+1;A<=d;++A){for(var b=m[j++],w=m[j++],a=A,D=j-2;a-- >h;){var S=m[D-2],M=m[D-1];if(S<b)break;if(S===b&&M<w)break;m[D]=S,m[D+1]=M,D-=2}m[D]=b,m[D+1]=w}}function j(h,d,m){d*=2;var j=m[h*=2],A=m[h+1];m[h]=m[d],m[h+1]=m[d+1],m[d]=j,m[d+1]=A}function A(h,d,m){d*=2,m[h*=2]=m[d],m[h+1]=m[d+1]}function b(h,d,m,j){d*=2,m*=2;var A=j[h*=2],b=j[h+1];j[h]=j[d],j[h+1]=j[d+1],j[d]=j[m],j[d+1]=j[m+1],j[m]=A,j[m+1]=b}function w(h,d,m,j,A){d*=2,A[h*=2]=A[d],A[d]=m,A[h+1]=A[d+1],A[d+1]=j}function a(h,d,m){d*=2;var j=m[h*=2],A=m[d];return!(j<A)&&(j!==A||m[h+1]>m[d+1])}function D(h,d,m,j){var A=j[h*=2];return A<d||A===d&&j[h+1]<m}function S(h,M,q){var E=(M-h+1)/6|0,I=h+E,R=M-E,Z=h+M>>1,L=Z-E,B=Z+E,V=I,v=L,C=Z,T=B,o=R,y=h+1,i=M-1,g=0;a(V,v,q)&&(g=V,V=v,v=g),a(T,o,q)&&(g=T,T=o,o=g),a(V,C,q)&&(g=V,V=C,C=g),a(v,C,q)&&(g=v,v=C,C=g),a(V,T,q)&&(g=V,V=T,T=g),a(C,T,q)&&(g=C,C=T,T=g),a(v,o,q)&&(g=v,v=o,o=g),a(v,C,q)&&(g=v,v=C,C=g),a(T,o,q)&&(g=T,T=o,o=g);for(var F=q[2*v],f=q[2*v+1],H=q[2*T],c=q[2*T+1],k=2*V,l=2*C,K=2*o,N=2*I,W=2*Z,r=2*R,Y=0;Y<2;++Y){var x=q[k+Y],Q=q[l+Y],t=q[K+Y];q[N+Y]=x,q[W+Y]=Q,q[r+Y]=t}A(L,h,q),A(B,M,q);for(var U=y;U<=i;++U)if(D(U,F,f,q))U!==y&&j(U,y,q),++y;else if(!D(U,H,c,q))for(;;){if(D(i,H,c,q)){D(i,F,f,q)?(b(U,y,i,q),++y,--i):(j(U,i,q),--i);break}if(--i<U)break}w(h,y-1,F,f,q),w(M,i+1,H,c,q),y-2-h<=d?m(h,y-2,q):S(h,y-2,q),M-(i+2)<=d?m(i+2,M,q):S(i+2,M,q),i-y<=d?m(y,i,q):S(y,i,q)}},12927:(h,d,m)=>{"use strict";h.exports={init:function(h){var d=A.nextPow2(h);D.length<d&&(j.free(D),D=j.mallocInt32(d));S.length<d&&(j.free(S),S=j.mallocInt32(d));M.length<d&&(j.free(M),M=j.mallocInt32(d));q.length<d&&(j.free(q),q=j.mallocInt32(d));E.length<d&&(j.free(E),E=j.mallocInt32(d));I.length<d&&(j.free(I),I=j.mallocInt32(d));var m=8*d;R.length<m&&(j.free(R),R=j.mallocDouble(m))},sweepBipartite:function(h,d,m,j,A,a,E,I,B,V){for(var v=0,C=2*h,T=h-1,o=C-1,y=m;y<j;++y){var i=a[y],g=C*y;R[v++]=A[g+T],R[v++]=-(i+1),R[v++]=A[g+o],R[v++]=i}for(y=E;y<I;++y){i=V[y]+w;var F=C*y;R[v++]=B[F+T],R[v++]=-i,R[v++]=B[F+o],R[v++]=i}var f=v>>>1;b(R,f);var H=0,c=0;for(y=0;y<f;++y){var k=0|R[2*y+1];if(k>=w)Z(M,q,c--,k=k-w|0);else if(k>=0)Z(D,S,H--,k);else if(k<=-w){k=-k-w|0;for(var l=0;l<H;++l){if(void 0!==(K=d(D[l],k)))return K}L(M,q,c++,k)}else{k=-k-1|0;for(l=0;l<c;++l){var K;if(void 0!==(K=d(k,M[l])))return K}L(D,S,H++,k)}}},sweepComplete:function(h,d,m,j,A,w,a,B,V,v){for(var C=0,T=2*h,o=h-1,y=T-1,i=m;i<j;++i){var g=w[i]+1<<1,F=T*i;R[C++]=A[F+o],R[C++]=-g,R[C++]=A[F+y],R[C++]=g}for(i=a;i<B;++i){g=v[i]+1<<1;var f=T*i;R[C++]=V[f+o],R[C++]=1|-g,R[C++]=V[f+y],R[C++]=1|g}var H=C>>>1;b(R,H);var c=0,k=0,l=0;for(i=0;i<H;++i){var K=0|R[2*i+1],N=1&K;if(i<H-1&&K>>1===R[2*i+3]>>1&&(N=2,i+=1),K<0){for(var W=-(K>>1)-1,r=0;r<l;++r){if(void 0!==(Y=d(E[r],W)))return Y}if(0!==N)for(r=0;r<c;++r){if(void 0!==(Y=d(D[r],W)))return Y}if(1!==N)for(r=0;r<k;++r){var Y;if(void 0!==(Y=d(M[r],W)))return Y}0===N?L(D,S,c++,W):1===N?L(M,q,k++,W):2===N&&L(E,I,l++,W)}else{W=(K>>1)-1;0===N?Z(D,S,c--,W):1===N?Z(M,q,k--,W):2===N&&Z(E,I,l--,W)}}},scanBipartite:function(h,d,m,j,A,a,M,q,E,I,B,V){var v=0,C=2*h,T=d,o=d+h,y=1,i=1;j?i=w:y=w;for(var g=A;g<a;++g){var F=g+y,f=C*g;R[v++]=M[f+T],R[v++]=-F,R[v++]=M[f+o],R[v++]=F}for(g=E;g<I;++g){F=g+i;var H=C*g;R[v++]=B[H+T],R[v++]=-F}var c=v>>>1;b(R,c);var k=0;for(g=0;g<c;++g){var l=0|R[2*g+1];if(l<0){var K=!1;if((F=-l)>=w?(K=!j,F-=w):(K=!!j,F-=1),K)L(D,S,k++,F);else{var N=V[F],W=C*F,r=B[W+d+1],Y=B[W+d+1+h];h:for(var x=0;x<k;++x){var Q=D[x],t=C*Q;if(!(Y<M[t+d+1]||M[t+d+1+h]<r)){for(var U=d+2;U<h;++U)if(B[W+U+h]<M[t+U]||M[t+U+h]<B[W+U])continue h;var s,J=q[Q];if(void 0!==(s=j?m(N,J):m(J,N)))return s}}}}else Z(D,S,k--,l-y)}},scanComplete:function(h,d,m,j,A,a,S,M,q,E,I){for(var Z=0,L=2*h,B=d,V=d+h,v=j;v<A;++v){var C=v+w,T=L*v;R[Z++]=a[T+B],R[Z++]=-C,R[Z++]=a[T+V],R[Z++]=C}for(v=M;v<q;++v){C=v+1;var o=L*v;R[Z++]=E[o+B],R[Z++]=-C}var y=Z>>>1;b(R,y);var i=0;for(v=0;v<y;++v){var g=0|R[2*v+1];if(g<0){if((C=-g)>=w)D[i++]=C-w;else{var F=I[C-=1],f=L*C,H=E[f+d+1],c=E[f+d+1+h];h:for(var k=0;k<i;++k){var l=D[k],K=S[l];if(K===F)break;var N=L*l;if(!(c<a[N+d+1]||a[N+d+1+h]<H)){for(var W=d+2;W<h;++W)if(E[f+W+h]<a[N+W]||a[N+W+h]<E[f+W])continue h;var r=m(K,F);if(void 0!==r)return r}}}}else{for(C=g-w,k=i-1;k>=0;--k)if(D[k]===C){for(W=k+1;W<i;++W)D[W-1]=D[W];break}--i}}}};var j=m(12912),A=m(12916),b=m(12933),w=1<<28,a=1024,D=j.mallocInt32(a),S=j.mallocInt32(a),M=j.mallocInt32(a),q=j.mallocInt32(a),E=j.mallocInt32(a),I=j.mallocInt32(a),R=j.mallocDouble(8192);function Z(h,d,m,j){var A=d[j],b=h[m-1];h[A]=b,d[b]=A}function L(h,d,m,j){h[m]=j,d[j]=m}},13057:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13049:(h,d,m)=>{var j=m(13057),A=m(13064),b=Object.hasOwnProperty,w=Object.create(null);for(var a in j)b.call(j,a)&&(w[j[a]]=a);var D=h.exports={to:{},get:{}};function S(h,d,m){return Math.min(Math.max(d,h),m)}function M(h){var d=Math.round(h).toString(16).toUpperCase();return d.length<2?"0"+d:d}D.get=function(h){var d,m;switch(h.substring(0,3).toLowerCase()){case"hsl":d=D.get.hsl(h),m="hsl";break;case"hwb":d=D.get.hwb(h),m="hwb";break;default:d=D.get.rgb(h),m="rgb"}return d?{model:m,value:d}:null},D.get.rgb=function(h){if(!h)return null;var d,m,A,w=[0,0,0,1];if(d=h.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(A=d[2],d=d[1],m=0;m<3;m++){var a=2*m;w[m]=parseInt(d.slice(a,a+2),16)}A&&(w[3]=parseInt(A,16)/255)}else if(d=h.match(/^#([a-f0-9]{3,4})$/i)){for(A=(d=d[1])[3],m=0;m<3;m++)w[m]=parseInt(d[m]+d[m],16);A&&(w[3]=parseInt(A+A,16)/255)}else if(d=h.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(m=0;m<3;m++)w[m]=parseInt(d[m+1],0);d[4]&&(d[5]?w[3]=.01*parseFloat(d[4]):w[3]=parseFloat(d[4]))}else{if(!(d=h.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(d=h.match(/^(\w+)$/))?"transparent"===d[1]?[0,0,0,0]:b.call(j,d[1])?((w=j[d[1]])[3]=1,w):null:null;for(m=0;m<3;m++)w[m]=Math.round(2.55*parseFloat(d[m+1]));d[4]&&(d[5]?w[3]=.01*parseFloat(d[4]):w[3]=parseFloat(d[4]))}for(m=0;m<3;m++)w[m]=S(w[m],0,255);return w[3]=S(w[3],0,1),w},D.get.hsl=function(h){if(!h)return null;var d=h.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var m=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,S(parseFloat(d[2]),0,100),S(parseFloat(d[3]),0,100),S(isNaN(m)?1:m,0,1)]}return null},D.get.hwb=function(h){if(!h)return null;var d=h.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var m=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,S(parseFloat(d[2]),0,100),S(parseFloat(d[3]),0,100),S(isNaN(m)?1:m,0,1)]}return null},D.to.hex=function(){var h=A(arguments);return"#"+M(h[0])+M(h[1])+M(h[2])+(h[3]<1?M(Math.round(255*h[3])):"")},D.to.rgb=function(){var h=A(arguments);return h.length<4||1===h[3]?"rgb("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+")":"rgba("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+", "+h[3]+")"},D.to.rgb.percent=function(){var h=A(arguments),d=Math.round(h[0]/255*100),m=Math.round(h[1]/255*100),j=Math.round(h[2]/255*100);return h.length<4||1===h[3]?"rgb("+d+"%, "+m+"%, "+j+"%)":"rgba("+d+"%, "+m+"%, "+j+"%, "+h[3]+")"},D.to.hsl=function(){var h=A(arguments);return h.length<4||1===h[3]?"hsl("+h[0]+", "+h[1]+"%, "+h[2]+"%)":"hsla("+h[0]+", "+h[1]+"%, "+h[2]+"%, "+h[3]+")"},D.to.hwb=function(){var h=A(arguments),d="";return h.length>=4&&1!==h[3]&&(d=", "+h[3]),"hwb("+h[0]+", "+h[1]+"%, "+h[2]+"%"+d+")"},D.to.keyword=function(h){return w[h.slice(0,3)]}},13045:(h,d,m)=>{const j=m(13049),A=m(13075),b=["keyword","gray","hex"],w={};for(const I of Object.keys(A))w[[...A[I].labels].sort().join("")]=I;const a={};function D(h,d){if(!(this instanceof D))return new D(h,d);if(d&&d in b&&(d=null),d&&!(d in A))throw new Error("Unknown model: "+d);let m,S;if(null==h)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(h instanceof D)this.model=h.model,this.color=[...h.color],this.valpha=h.valpha;else if("string"===typeof h){const d=j.get(h);if(null===d)throw new Error("Unable to parse color from string: "+h);this.model=d.model,S=A[this.model].channels,this.color=d.value.slice(0,S),this.valpha="number"===typeof d.value[S]?d.value[S]:1}else if(h.length>0){this.model=d||"rgb",S=A[this.model].channels;const m=Array.prototype.slice.call(h,0,S);this.color=E(m,S),this.valpha="number"===typeof h[S]?h[S]:1}else if("number"===typeof h)this.model="rgb",this.color=[h>>16&255,h>>8&255,255&h],this.valpha=1;else{this.valpha=1;const d=Object.keys(h);"alpha"in h&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"===typeof h.alpha?h.alpha:0);const j=d.sort().join("");if(!(j in w))throw new Error("Unable to parse color from object: "+JSON.stringify(h));this.model=w[j];const{labels:b}=A[this.model],a=[];for(m=0;m<b.length;m++)a.push(h[b[m]]);this.color=E(a)}if(a[this.model])for(S=A[this.model].channels,m=0;m<S;m++){const h=a[this.model][m];h&&(this.color[m]=h(this.color[m]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}D.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(h){let d=this.model in j.to?this:this.rgb();d=d.round("number"===typeof h?h:1);const m=1===d.valpha?d.color:[...d.color,this.valpha];return j.to[d.model](m)},percentString(h){const d=this.rgb().round("number"===typeof h?h:1),m=1===d.valpha?d.color:[...d.color,this.valpha];return j.to.rgb.percent(m)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const h={},{channels:d}=A[this.model],{labels:m}=A[this.model];for(let j=0;j<d;j++)h[m[j]]=this.color[j];return 1!==this.valpha&&(h.alpha=this.valpha),h},unitArray(){const h=this.rgb().color;return h[0]/=255,h[1]/=255,h[2]/=255,1!==this.valpha&&h.push(this.valpha),h},unitObject(){const h=this.rgb().object();return h.r/=255,h.g/=255,h.b/=255,1!==this.valpha&&(h.alpha=this.valpha),h},round(h){return h=Math.max(h||0,0),new D([...this.color.map(S(h)),this.valpha],this.model)},alpha(h){return void 0!==h?new D([...this.color,Math.max(0,Math.min(1,h))],this.model):this.valpha},red:M("rgb",0,q(255)),green:M("rgb",1,q(255)),blue:M("rgb",2,q(255)),hue:M(["hsl","hsv","hsl","hwb","hcg"],0,(h=>(h%360+360)%360)),saturationl:M("hsl",1,q(100)),lightness:M("hsl",2,q(100)),saturationv:M("hsv",1,q(100)),value:M("hsv",2,q(100)),chroma:M("hcg",1,q(100)),gray:M("hcg",2,q(100)),white:M("hwb",1,q(100)),wblack:M("hwb",2,q(100)),cyan:M("cmyk",0,q(100)),magenta:M("cmyk",1,q(100)),yellow:M("cmyk",2,q(100)),black:M("cmyk",3,q(100)),x:M("xyz",0,q(95.047)),y:M("xyz",1,q(100)),z:M("xyz",2,q(108.833)),l:M("lab",0,q(100)),a:M("lab",1),b:M("lab",2),keyword(h){return void 0!==h?new D(h):A[this.model].keyword(this.color)},hex(h){return void 0!==h?new D(h):j.to.hex(this.rgb().round().color)},hexa(h){if(void 0!==h)return new D(h);const d=this.rgb().round().color;let m=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===m.length&&(m="0"+m),j.to.hex(d)+m},rgbNumber(){const h=this.rgb().color;return(255&h[0])<<16|(255&h[1])<<8|255&h[2]},luminosity(){const h=this.rgb().color,d=[];for(const[m,j]of h.entries()){const h=j/255;d[m]=h<=.04045?h/12.92:((h+.055)/1.055)**2.4}return.2126*d[0]+.7152*d[1]+.0722*d[2]},contrast(h){const d=this.luminosity(),m=h.luminosity();return d>m?(d+.05)/(m+.05):(m+.05)/(d+.05)},level(h){const d=this.contrast(h);return d>=7?"AAA":d>=4.5?"AA":""},isDark(){const h=this.rgb().color;return(2126*h[0]+7152*h[1]+722*h[2])/1e4<128},isLight(){return!this.isDark()},negate(){const h=this.rgb();for(let d=0;d<3;d++)h.color[d]=255-h.color[d];return h},lighten(h){const d=this.hsl();return d.color[2]+=d.color[2]*h,d},darken(h){const d=this.hsl();return d.color[2]-=d.color[2]*h,d},saturate(h){const d=this.hsl();return d.color[1]+=d.color[1]*h,d},desaturate(h){const d=this.hsl();return d.color[1]-=d.color[1]*h,d},whiten(h){const d=this.hwb();return d.color[1]+=d.color[1]*h,d},blacken(h){const d=this.hwb();return d.color[2]+=d.color[2]*h,d},grayscale(){const h=this.rgb().color,d=.3*h[0]+.59*h[1]+.11*h[2];return D.rgb(d,d,d)},fade(h){return this.alpha(this.valpha-this.valpha*h)},opaquer(h){return this.alpha(this.valpha+this.valpha*h)},rotate(h){const d=this.hsl();let m=d.color[0];return m=(m+h)%360,m=m<0?360+m:m,d.color[0]=m,d},mix(h,d){if(!h||!h.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof h);const m=h.rgb(),j=this.rgb(),A=void 0===d?.5:d,b=2*A-1,w=m.alpha()-j.alpha(),a=((b*w===-1?b:(b+w)/(1+b*w))+1)/2,S=1-a;return D.rgb(a*m.red()+S*j.red(),a*m.green()+S*j.green(),a*m.blue()+S*j.blue(),m.alpha()*A+j.alpha()*(1-A))}};for(const I of Object.keys(A)){if(b.includes(I))continue;const{channels:h}=A[I];D.prototype[I]=function(){if(this.model===I)return new D(this);for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];return d.length>0?new D(d,I):new D([...(j=A[this.model][I].raw(this.color),Array.isArray(j)?j:[j]),this.valpha],I);var j},D[I]=function(){for(var d=arguments.length,m=new Array(d),j=0;j<d;j++)m[j]=arguments[j];let A=m[0];return"number"===typeof A&&(A=E(m,h)),new D(A,I)}}function S(h){return function(d){return function(h,d){return Number(h.toFixed(d))}(d,h)}}function M(h,d,m){h=Array.isArray(h)?h:[h];for(const j of h)(a[j]||(a[j]=[]))[d]=m;return h=h[0],function(j){let A;return void 0!==j?(m&&(j=m(j)),A=this[h](),A.color[d]=j,A):(A=this[h]().color[d],m&&(A=m(A)),A)}}function q(h){return function(d){return Math.max(0,Math.min(h,d))}}function E(h,d){for(let m=0;m<d;m++)"number"!==typeof h[m]&&(h[m]=0);return h}h.exports=D},13081:(h,d,m)=>{const j=m(13083),A={};for(const w of Object.keys(j))A[j[w]]=w;const b={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};h.exports=b;for(const w of Object.keys(b)){if(!("channels"in b[w]))throw new Error("missing channels property: "+w);if(!("labels"in b[w]))throw new Error("missing channel labels property: "+w);if(b[w].labels.length!==b[w].channels)throw new Error("channel and label counts mismatch: "+w);const{channels:h,labels:d}=b[w];delete b[w].channels,delete b[w].labels,Object.defineProperty(b[w],"channels",{value:h}),Object.defineProperty(b[w],"labels",{value:d})}b.rgb.hsl=function(h){const d=h[0]/255,m=h[1]/255,j=h[2]/255,A=Math.min(d,m,j),b=Math.max(d,m,j),w=b-A;let a,D;b===A?a=0:d===b?a=(m-j)/w:m===b?a=2+(j-d)/w:j===b&&(a=4+(d-m)/w),a=Math.min(60*a,360),a<0&&(a+=360);const S=(A+b)/2;return D=b===A?0:S<=.5?w/(b+A):w/(2-b-A),[a,100*D,100*S]},b.rgb.hsv=function(h){let d,m,j,A,b;const w=h[0]/255,a=h[1]/255,D=h[2]/255,S=Math.max(w,a,D),M=S-Math.min(w,a,D),q=function(h){return(S-h)/6/M+.5};return 0===M?(A=0,b=0):(b=M/S,d=q(w),m=q(a),j=q(D),w===S?A=j-m:a===S?A=1/3+d-j:D===S&&(A=2/3+m-d),A<0?A+=1:A>1&&(A-=1)),[360*A,100*b,100*S]},b.rgb.hwb=function(h){const d=h[0],m=h[1];let j=h[2];const A=b.rgb.hsl(h)[0],w=1/255*Math.min(d,Math.min(m,j));return j=1-1/255*Math.max(d,Math.max(m,j)),[A,100*w,100*j]},b.rgb.cmyk=function(h){const d=h[0]/255,m=h[1]/255,j=h[2]/255,A=Math.min(1-d,1-m,1-j);return[100*((1-d-A)/(1-A)||0),100*((1-m-A)/(1-A)||0),100*((1-j-A)/(1-A)||0),100*A]},b.rgb.keyword=function(h){const d=A[h];if(d)return d;let m,b=1/0;for(const A of Object.keys(j)){const d=j[A],D=(a=d,((w=h)[0]-a[0])**2+(w[1]-a[1])**2+(w[2]-a[2])**2);D<b&&(b=D,m=A)}var w,a;return m},b.keyword.rgb=function(h){return j[h]},b.rgb.xyz=function(h){let d=h[0]/255,m=h[1]/255,j=h[2]/255;d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,m=m>.04045?((m+.055)/1.055)**2.4:m/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92;return[100*(.4124*d+.3576*m+.1805*j),100*(.2126*d+.7152*m+.0722*j),100*(.0193*d+.1192*m+.9505*j)]},b.rgb.lab=function(h){const d=b.rgb.xyz(h);let m=d[0],j=d[1],A=d[2];m/=95.047,j/=100,A/=108.883,m=m>.008856?m**(1/3):7.787*m+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*j-16,500*(m-j),200*(j-A)]},b.hsl.rgb=function(h){const d=h[0]/360,m=h[1]/100,j=h[2]/100;let A,b,w;if(0===m)return w=255*j,[w,w,w];A=j<.5?j*(1+m):j+m-j*m;const a=2*j-A,D=[0,0,0];for(let S=0;S<3;S++)b=d+1/3*-(S-1),b<0&&b++,b>1&&b--,w=6*b<1?a+6*(A-a)*b:2*b<1?A:3*b<2?a+(A-a)*(2/3-b)*6:a,D[S]=255*w;return D},b.hsl.hsv=function(h){const d=h[0];let m=h[1]/100,j=h[2]/100,A=m;const b=Math.max(j,.01);j*=2,m*=j<=1?j:2-j,A*=b<=1?b:2-b;return[d,100*(0===j?2*A/(b+A):2*m/(j+m)),100*((j+m)/2)]},b.hsv.rgb=function(h){const d=h[0]/60,m=h[1]/100;let j=h[2]/100;const A=Math.floor(d)%6,b=d-Math.floor(d),w=255*j*(1-m),a=255*j*(1-m*b),D=255*j*(1-m*(1-b));switch(j*=255,A){case 0:return[j,D,w];case 1:return[a,j,w];case 2:return[w,j,D];case 3:return[w,a,j];case 4:return[D,w,j];case 5:return[j,w,a]}},b.hsv.hsl=function(h){const d=h[0],m=h[1]/100,j=h[2]/100,A=Math.max(j,.01);let b,w;w=(2-m)*j;const a=(2-m)*A;return b=m*A,b/=a<=1?a:2-a,b=b||0,w/=2,[d,100*b,100*w]},b.hwb.rgb=function(h){const d=h[0]/360;let m=h[1]/100,j=h[2]/100;const A=m+j;let b;A>1&&(m/=A,j/=A);const w=Math.floor(6*d),a=1-j;b=6*d-w,0!==(1&w)&&(b=1-b);const D=m+b*(a-m);let S,M,q;switch(w){default:case 6:case 0:S=a,M=D,q=m;break;case 1:S=D,M=a,q=m;break;case 2:S=m,M=a,q=D;break;case 3:S=m,M=D,q=a;break;case 4:S=D,M=m,q=a;break;case 5:S=a,M=m,q=D}return[255*S,255*M,255*q]},b.cmyk.rgb=function(h){const d=h[0]/100,m=h[1]/100,j=h[2]/100,A=h[3]/100;return[255*(1-Math.min(1,d*(1-A)+A)),255*(1-Math.min(1,m*(1-A)+A)),255*(1-Math.min(1,j*(1-A)+A))]},b.xyz.rgb=function(h){const d=h[0]/100,m=h[1]/100,j=h[2]/100;let A,b,w;return A=3.2406*d+-1.5372*m+-.4986*j,b=-.9689*d+1.8758*m+.0415*j,w=.0557*d+-.204*m+1.057*j,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,A=Math.min(Math.max(0,A),1),b=Math.min(Math.max(0,b),1),w=Math.min(Math.max(0,w),1),[255*A,255*b,255*w]},b.xyz.lab=function(h){let d=h[0],m=h[1],j=h[2];d/=95.047,m/=100,j/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,m=m>.008856?m**(1/3):7.787*m+16/116,j=j>.008856?j**(1/3):7.787*j+16/116;return[116*m-16,500*(d-m),200*(m-j)]},b.lab.xyz=function(h){let d,m,j;m=(h[0]+16)/116,d=h[1]/500+m,j=m-h[2]/200;const A=m**3,b=d**3,w=j**3;return m=A>.008856?A:(m-16/116)/7.787,d=b>.008856?b:(d-16/116)/7.787,j=w>.008856?w:(j-16/116)/7.787,d*=95.047,m*=100,j*=108.883,[d,m,j]},b.lab.lch=function(h){const d=h[0],m=h[1],j=h[2];let A;A=360*Math.atan2(j,m)/2/Math.PI,A<0&&(A+=360);return[d,Math.sqrt(m*m+j*j),A]},b.lch.lab=function(h){const d=h[0],m=h[1],j=h[2]/360*2*Math.PI;return[d,m*Math.cos(j),m*Math.sin(j)]},b.rgb.ansi16=function(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[m,j,A]=h;let w=null===d?b.rgb.hsv(h)[2]:d;if(w=Math.round(w/50),0===w)return 30;let a=30+(Math.round(A/255)<<2|Math.round(j/255)<<1|Math.round(m/255));return 2===w&&(a+=60),a},b.hsv.ansi16=function(h){return b.rgb.ansi16(b.hsv.rgb(h),h[2])},b.rgb.ansi256=function(h){const d=h[0],m=h[1],j=h[2];if(d===m&&m===j)return d<8?16:d>248?231:Math.round((d-8)/247*24)+232;return 16+36*Math.round(d/255*5)+6*Math.round(m/255*5)+Math.round(j/255*5)},b.ansi16.rgb=function(h){let d=h%10;if(0===d||7===d)return h>50&&(d+=3.5),d=d/10.5*255,[d,d,d];const m=.5*(1+~~(h>50));return[(1&d)*m*255,(d>>1&1)*m*255,(d>>2&1)*m*255]},b.ansi256.rgb=function(h){if(h>=232){const d=10*(h-232)+8;return[d,d,d]}let d;h-=16;return[Math.floor(h/36)/5*255,Math.floor((d=h%36)/6)/5*255,d%6/5*255]},b.rgb.hex=function(h){const d=(((255&Math.round(h[0]))<<16)+((255&Math.round(h[1]))<<8)+(255&Math.round(h[2]))).toString(16).toUpperCase();return"000000".substring(d.length)+d},b.hex.rgb=function(h){const d=h.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!d)return[0,0,0];let m=d[0];3===d[0].length&&(m=m.split("").map((h=>h+h)).join(""));const j=parseInt(m,16);return[j>>16&255,j>>8&255,255&j]},b.rgb.hcg=function(h){const d=h[0]/255,m=h[1]/255,j=h[2]/255,A=Math.max(Math.max(d,m),j),b=Math.min(Math.min(d,m),j),w=A-b;let a,D;return a=w<1?b/(1-w):0,D=w<=0?0:A===d?(m-j)/w%6:A===m?2+(j-d)/w:4+(d-m)/w,D/=6,D%=1,[360*D,100*w,100*a]},b.hsl.hcg=function(h){const d=h[1]/100,m=h[2]/100,j=m<.5?2*d*m:2*d*(1-m);let A=0;return j<1&&(A=(m-.5*j)/(1-j)),[h[0],100*j,100*A]},b.hsv.hcg=function(h){const d=h[1]/100,m=h[2]/100,j=d*m;let A=0;return j<1&&(A=(m-j)/(1-j)),[h[0],100*j,100*A]},b.hcg.rgb=function(h){const d=h[0]/360,m=h[1]/100,j=h[2]/100;if(0===m)return[255*j,255*j,255*j];const A=[0,0,0],b=d%1*6,w=b%1,a=1-w;let D=0;switch(Math.floor(b)){case 0:A[0]=1,A[1]=w,A[2]=0;break;case 1:A[0]=a,A[1]=1,A[2]=0;break;case 2:A[0]=0,A[1]=1,A[2]=w;break;case 3:A[0]=0,A[1]=a,A[2]=1;break;case 4:A[0]=w,A[1]=0,A[2]=1;break;default:A[0]=1,A[1]=0,A[2]=a}return D=(1-m)*j,[255*(m*A[0]+D),255*(m*A[1]+D),255*(m*A[2]+D)]},b.hcg.hsv=function(h){const d=h[1]/100,m=d+h[2]/100*(1-d);let j=0;return m>0&&(j=d/m),[h[0],100*j,100*m]},b.hcg.hsl=function(h){const d=h[1]/100,m=h[2]/100*(1-d)+.5*d;let j=0;return m>0&&m<.5?j=d/(2*m):m>=.5&&m<1&&(j=d/(2*(1-m))),[h[0],100*j,100*m]},b.hcg.hwb=function(h){const d=h[1]/100,m=d+h[2]/100*(1-d);return[h[0],100*(m-d),100*(1-m)]},b.hwb.hcg=function(h){const d=h[1]/100,m=1-h[2]/100,j=m-d;let A=0;return j<1&&(A=(m-j)/(1-j)),[h[0],100*j,100*A]},b.apple.rgb=function(h){return[h[0]/65535*255,h[1]/65535*255,h[2]/65535*255]},b.rgb.apple=function(h){return[h[0]/255*65535,h[1]/255*65535,h[2]/255*65535]},b.gray.rgb=function(h){return[h[0]/100*255,h[0]/100*255,h[0]/100*255]},b.gray.hsl=function(h){return[0,0,h[0]]},b.gray.hsv=b.gray.hsl,b.gray.hwb=function(h){return[0,100,h[0]]},b.gray.cmyk=function(h){return[0,0,0,h[0]]},b.gray.lab=function(h){return[h[0],0,0]},b.gray.hex=function(h){const d=255&Math.round(h[0]/100*255),m=((d<<16)+(d<<8)+d).toString(16).toUpperCase();return"000000".substring(m.length)+m},b.rgb.gray=function(h){return[(h[0]+h[1]+h[2])/3/255*100]}},13075:(h,d,m)=>{const j=m(13081),A=m(13090),b={};Object.keys(j).forEach((h=>{b[h]={},Object.defineProperty(b[h],"channels",{value:j[h].channels}),Object.defineProperty(b[h],"labels",{value:j[h].labels});const d=A(h);Object.keys(d).forEach((m=>{const j=d[m];b[h][m]=function(h){const d=function(){for(var d=arguments.length,m=new Array(d),j=0;j<d;j++)m[j]=arguments[j];const A=m[0];if(void 0===A||null===A)return A;A.length>1&&(m=A);const b=h(m);if("object"===typeof b)for(let h=b.length,w=0;w<h;w++)b[w]=Math.round(b[w]);return b};return"conversion"in h&&(d.conversion=h.conversion),d}(j),b[h][m].raw=function(h){const d=function(){for(var d=arguments.length,m=new Array(d),j=0;j<d;j++)m[j]=arguments[j];const A=m[0];return void 0===A||null===A?A:(A.length>1&&(m=A),h(m))};return"conversion"in h&&(d.conversion=h.conversion),d}(j)}))})),h.exports=b},13090:(h,d,m)=>{const j=m(13081);function A(h){const d=function(){const h={},d=Object.keys(j);for(let m=d.length,j=0;j<m;j++)h[d[j]]={distance:-1,parent:null};return h}(),m=[h];for(d[h].distance=0;m.length;){const h=m.pop(),A=Object.keys(j[h]);for(let j=A.length,b=0;b<j;b++){const j=A[b],w=d[j];-1===w.distance&&(w.distance=d[h].distance+1,w.parent=h,m.unshift(j))}}return d}function b(h,d){return function(m){return d(h(m))}}function w(h,d){const m=[d[h].parent,h];let A=j[d[h].parent][h],w=d[h].parent;for(;d[w].parent;)m.unshift(d[w].parent),A=b(j[d[w].parent][w],A),w=d[w].parent;return A.conversion=m,A}h.exports=function(h){const d=A(h),m={},j=Object.keys(d);for(let A=j.length,b=0;b<A;b++){const h=j[b];null!==d[h].parent&&(m[h]=w(h,d))}return m}},13083:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11909:function(h,d,m){"use strict";var j=this&&this.__createBinding||(Object.create?function(h,d,m,j){void 0===j&&(j=m);var A=Object.getOwnPropertyDescriptor(d,m);A&&!("get"in A?!d.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return d[m]}}),Object.defineProperty(h,j,A)}:function(h,d,m,j){void 0===j&&(j=m),h[j]=d[m]}),A=this&&this.__setModuleDefault||(Object.create?function(h,d){Object.defineProperty(h,"default",{enumerable:!0,value:d})}:function(h,d){h.default=d}),b=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var d={};if(null!=h)for(var m in h)"default"!==m&&Object.prototype.hasOwnProperty.call(h,m)&&j(d,h,m);return A(d,h),d},w=this&&this.__awaiter||function(h,d,m,j){return new(m||(m=Promise))((function(A,b){function w(h){try{D(j.next(h))}catch(d){b(d)}}function a(h){try{D(j.throw(h))}catch(d){b(d)}}function D(h){var d;h.done?A(h.value):(d=h.value,d instanceof m?d:new m((function(h){h(d)}))).then(w,a)}D((j=j.apply(h,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Auth=d.Platform=void 0;const a=b(m(11835)),D=m(11917),S="colyseus-auth-token";!function(h){h.ios="ios",h.android="android"}(d.Platform||(d.Platform={}));d.Auth=class{constructor(h){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=h.replace("ws","http"),(0,D.getItem)(S,(h=>this.token=h))}get hasToken(){return!!this.token}login(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return w(this,void 0,void 0,(function*(){const d=Object.assign({},h);this.hasToken&&(d.token=this.token);const m=yield this.request("post","/auth",d);this.token=m.token,(0,D.setItem)(S,this.token);for(let h in m)this.hasOwnProperty(h)&&(this[h]=m[h]);return this.registerPingService(),this}))}save(){return w(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return w(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return w(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return w(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(h){return w(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:h})}))}acceptFriendRequest(h){return w(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:h})}))}declineFriendRequest(h){return w(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:h})}))}blockUser(h){return w(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:h})}))}unblockUser(h){return w(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:h})}))}request(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return w(this,void 0,void 0,(function*(){A.Accept="application/json",this.hasToken&&(A.Authorization="Bearer "+this.token);const b=[];for(const h in m)b.push(`${h}=${m[h]}`);const w=b.length>0?`?${b.join("&")}`:"",D={headers:A};return j&&(D.body=j),(yield a[h](`${this.endpoint}${d}${w}`,D)).data}))}logout(){this.token=void 0,(0,D.removeItem)(S),this.unregisterPingService()}registerPingService(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),h)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11832:function(h,d,m){"use strict";var j,A=this&&this.__awaiter||function(h,d,m,j){return new(m||(m=Promise))((function(A,b){function w(h){try{D(j.next(h))}catch(d){b(d)}}function a(h){try{D(j.throw(h))}catch(d){b(d)}}function D(h){var d;h.done?A(h.value):(d=h.value,d instanceof m?d:new m((function(h){h(d)}))).then(w,a)}D((j=j.apply(h,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Client=d.MatchMakeError=void 0;const b=m(11835),w=m(11841),a=m(11846);class D extends Error{constructor(h,d){super(h),this.code=d,Object.setPrototypeOf(this,D.prototype)}}d.MatchMakeError=D;const S="undefined"!==typeof window&&"undefined"!==typeof(null===(j=null===window||void 0===window?void 0:window.location)||void 0===j?void 0:j.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";d.Client=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S;if("string"===typeof h){const d=new URL(h),m="https:"===d.protocol||"wss:"===d.protocol,j=Number(d.port||(m?443:80));this.settings={hostname:d.hostname,pathname:"/"!==d.pathname?d.pathname:"",port:j,secure:m}}else void 0===h.port&&(h.port=h.secure?443:80),void 0===h.pathname&&(h.pathname=""),this.settings=h}joinOrCreate(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",h,d,m)}))}create(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",h,d,m)}))}join(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",h,d,m)}))}joinById(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",h,d,m)}))}reconnect(h,d){return A(this,void 0,void 0,(function*(){if("string"===typeof h&&"string"===typeof d)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[m,j]=h.split(":");return yield this.createMatchMakeRequest("reconnect",m,{reconnectionToken:j},d)}))}getAvailableRooms(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return A(this,void 0,void 0,(function*(){return(yield(0,b.get)(this.getHttpEndpoint(`${h}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(h,d,m){return A(this,void 0,void 0,(function*(){const j=this.createRoom(h.room.name,d);j.roomId=h.room.roomId,j.sessionId=h.sessionId;const b={sessionId:j.sessionId};h.reconnectionToken&&(b.reconnectionToken=h.reconnectionToken);const a=m||j;return j.connect(this.buildEndpoint(h.room,b),h.devMode&&(()=>A(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${j.roomId}'...`);let m=0;const b=()=>A(this,void 0,void 0,(function*(){m++;try{yield this.consumeSeatReservation(h,d,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${j.roomId}'`)}catch(A){m<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${m} out of 8)`),setTimeout(b,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(b,2e3)}))),a),new Promise(((h,d)=>{const m=(h,m)=>d(new w.ServerError(h,m));a.onError.once(m),a.onJoin.once((()=>{a.onError.remove(m),h(a)}))}))}))}createMatchMakeRequest(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;return A(this,void 0,void 0,(function*(){const A=(yield(0,b.post)(this.getHttpEndpoint(`${h}/${d}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(m)})).data;if(A.error)throw new D(A.error,A.code);return"reconnect"===h&&(A.reconnectionToken=m.reconnectionToken),yield this.consumeSeatReservation(A,j,w)}))}createRoom(h,d){return new a.Room(h,d)}buildEndpoint(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const m=[];for(const A in d)d.hasOwnProperty(A)&&m.push(`${A}=${d[A]}`);let j=this.settings.secure?"wss://":"ws://";return h.publicAddress?j+=`${h.publicAddress}`:j+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${j}/${h.processId}/${h.roomId}?${m.join("&")}`}getHttpEndpoint(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${h}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11858:(h,d,m)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.Connection=void 0;const j=m(11863);d.Connection=class{constructor(){this.events={},this.transport=new j.WebSocketTransport(this.events)}send(h){this.transport.send(h)}connect(h){this.transport.connect(h)}close(h,d){this.transport.close(h,d)}get isOpen(){return this.transport.isOpen}}},11881:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.utf8Length=d.utf8Read=d.ErrorCode=d.Protocol=void 0,function(h){h[h.HANDSHAKE=9]="HANDSHAKE",h[h.JOIN_ROOM=10]="JOIN_ROOM",h[h.ERROR=11]="ERROR",h[h.LEAVE_ROOM=12]="LEAVE_ROOM",h[h.ROOM_DATA=13]="ROOM_DATA",h[h.ROOM_STATE=14]="ROOM_STATE",h[h.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",h[h.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",h[h.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(d.Protocol||(d.Protocol={})),function(h){h[h.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",h[h.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",h[h.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",h[h.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",h[h.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",h[h.AUTH_FAILED=4215]="AUTH_FAILED",h[h.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(d.ErrorCode||(d.ErrorCode={})),d.utf8Read=function(h,d){const m=h[d++];for(var j="",A=0,b=d,w=d+m;b<w;b++){var a=h[b];if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(A=(7&a)<<18|(63&h[++b])<<12|(63&h[++b])<<6|63&h[++b])>=65536?(A-=65536,j+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):j+=String.fromCharCode(A)}else j+=String.fromCharCode((15&a)<<12|(63&h[++b])<<6|63&h[++b]);else j+=String.fromCharCode((31&a)<<6|63&h[++b]);else j+=String.fromCharCode(a)}return j},d.utf8Length=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=0,m=0;for(let j=0,A=h.length;j<A;j++)d=h.charCodeAt(j),d<128?m+=1:d<2048?m+=2:d<55296||d>=57344?m+=3:(j++,m+=4);return m+1}},11846:function(h,d,m){"use strict";var j=this&&this.__createBinding||(Object.create?function(h,d,m,j){void 0===j&&(j=m);var A=Object.getOwnPropertyDescriptor(d,m);A&&!("get"in A?!d.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return d[m]}}),Object.defineProperty(h,j,A)}:function(h,d,m,j){void 0===j&&(j=m),h[j]=d[m]}),A=this&&this.__setModuleDefault||(Object.create?function(h,d){Object.defineProperty(h,"default",{enumerable:!0,value:d})}:function(h,d){h.default=d}),b=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var d={};if(null!=h)for(var m in h)"default"!==m&&Object.prototype.hasOwnProperty.call(h,m)&&j(d,h,m);return A(d,h),d};Object.defineProperty(d,"__esModule",{value:!0}),d.Room=void 0;const w=b(m(11854)),a=m(11858),D=m(11881),S=m(11889),M=m(11891),q=m(11898),E=m(11905),I=m(11841);class R{constructor(h,d){this.onStateChange=(0,q.createSignal)(),this.onError=(0,q.createSignal)(),this.onLeave=(0,q.createSignal)(),this.onJoin=(0,q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,M.createNanoEvents)(),this.roomId=null,this.name=h,d&&(this.serializer=new((0,S.getSerializer)("schema")),this.rootSchema=d,this.serializer.state=new d),this.onError(((h,d)=>{var m;return null===(m=console.warn)||void 0===m?void 0:m.call(console,`colyseus.js - onError => (${h}) ${d}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const j=new a.Connection;m.connection=j,j.events.onmessage=R.prototype.onMessageCallback.bind(m),j.events.onclose=function(h){var j;if(!m.hasJoined)return null===(j=console.warn)||void 0===j||j.call(console,`Room connection was closed unexpectedly (${h.code}): ${h.reason}`),void m.onError.invoke(h.code,h.reason);h.code===I.CloseCode.DEVMODE_RESTART&&d?d():(m.onLeave.invoke(h.code),m.destroy())},j.events.onerror=function(h){var d;null===(d=console.warn)||void 0===d||d.call(console,`Room, onError (${h.code}): ${h.reason}`),m.onError.invoke(h.code,h.reason)},j.connect(h)}leave(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((d=>{this.onLeave((h=>d(h))),this.connection?h?this.connection.send([D.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(I.CloseCode.CONSENTED)}))}onMessage(h,d){return this.onMessageHandlers.on(this.getMessageHandlerKey(h),d)}send(h,d){const m=[D.Protocol.ROOM_DATA];let j;if("string"===typeof h?E.encode.string(m,h):E.encode.number(m,h),void 0!==d){const h=w.encode(d);j=new Uint8Array(m.length+h.byteLength),j.set(new Uint8Array(m),0),j.set(new Uint8Array(h),m.length)}else j=new Uint8Array(m);this.connection.send(j.buffer)}sendBytes(h,d){const m=[D.Protocol.ROOM_DATA_BYTES];let j;"string"===typeof h?E.encode.string(m,h):E.encode.number(m,h),j=new Uint8Array(m.length+(d.byteLength||d.length)),j.set(new Uint8Array(m),0),j.set(new Uint8Array(d),m.length),this.connection.send(j.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(h){const d=Array.from(new Uint8Array(h.data)),m=d[0];if(m===D.Protocol.JOIN_ROOM){let h=1;const m=(0,D.utf8Read)(d,h);if(h+=(0,D.utf8Length)(m),this.serializerId=(0,D.utf8Read)(d,h),h+=(0,D.utf8Length)(this.serializerId),!this.serializer){const h=(0,S.getSerializer)(this.serializerId);this.serializer=new h}d.length>h&&this.serializer.handshake&&this.serializer.handshake(d,{offset:h}),this.reconnectionToken=`${this.roomId}:${m}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([D.Protocol.JOIN_ROOM])}else if(m===D.Protocol.ERROR){const h={offset:1},m=E.decode.number(d,h),j=E.decode.string(d,h);this.onError.invoke(m,j)}else if(m===D.Protocol.LEAVE_ROOM)this.leave();else if(m===D.Protocol.ROOM_DATA_SCHEMA){const h={offset:1},m=this.serializer.getState().constructor._context.get(E.decode.number(d,h)),j=new m;j.decode(d,h),this.dispatchMessage(m,j)}else if(m===D.Protocol.ROOM_STATE)d.shift(),this.setState(d);else if(m===D.Protocol.ROOM_STATE_PATCH)d.shift(),this.patch(d);else if(m===D.Protocol.ROOM_DATA){const m={offset:1},j=E.decode.stringCheck(d,m)?E.decode.string(d,m):E.decode.number(d,m),A=d.length>m.offset?w.decode(h.data,m.offset):void 0;this.dispatchMessage(j,A)}else if(m===D.Protocol.ROOM_DATA_BYTES){const h={offset:1},m=E.decode.stringCheck(d,h)?E.decode.string(d,h):E.decode.number(d,h);this.dispatchMessage(m,new Uint8Array(d.slice(h.offset)))}}setState(h){this.serializer.setState(h),this.onStateChange.invoke(this.serializer.getState())}patch(h){this.serializer.patch(h),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(h,d){var m;const j=this.getMessageHandlerKey(h);this.onMessageHandlers.events[j]?this.onMessageHandlers.emit(j,d):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",h,d):null===(m=console.warn)||void 0===m||m.call(console,`colyseus.js: onMessage() not registered for type '${h}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(h){switch(typeof h){case"function":return`$${h._typeid}`;case"string":return h;case"number":return`i${h}`;default:throw new Error("invalid message type.")}}}d.Room=R},11917:(h,d)=>{"use strict";let m;function j(){return m||(m="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(h,d){this.cache[h]=d},getItem:function(h){this.cache[h]},removeItem:function(h){delete this.cache[h]}}),m}Object.defineProperty(d,"__esModule",{value:!0}),d.getItem=d.removeItem=d.setItem=void 0,d.setItem=function(h,d){j().setItem(h,d)},d.removeItem=function(h){j().removeItem(h)},d.getItem=function(h,d){const m=j().getItem(h);"undefined"!==typeof Promise&&m instanceof Promise?m.then((h=>d(h))):d(m)}},11891:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createNanoEvents=void 0;d.createNanoEvents=()=>({emit(h){let d=this.events[h]||[];for(var m=arguments.length,j=new Array(m>1?m-1:0),A=1;A<m;A++)j[A-1]=arguments[A];for(let b=0,w=d.length;b<w;b++)d[b](...j)},events:{},on(h,d){var m;return(null===(m=this.events[h])||void 0===m?void 0:m.push(d))||(this.events[h]=[d]),()=>{var m;this.events[h]=null===(m=this.events[h])||void 0===m?void 0:m.filter((h=>d!==h))}}})},11898:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createSignal=d.EventEmitter=void 0;class m{constructor(){this.handlers=[]}register(h){return this.handlers.push(h),this}invoke(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];this.handlers.forEach((h=>h.apply(this,d)))}invokeAsync(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];return Promise.all(this.handlers.map((h=>h.apply(this,d))))}remove(h){const d=this.handlers.indexOf(h);this.handlers[d]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}d.EventEmitter=m,d.createSignal=function(){const h=new m;function d(d){return h.register(d,null===this)}return d.once=d=>{const m=function(){for(var j=arguments.length,A=new Array(j),b=0;b<j;b++)A[b]=arguments[b];d.apply(this,A),h.remove(m)};h.register(m)},d.remove=d=>h.remove(d),d.invoke=function(){return h.invoke(...arguments)},d.invokeAsync=function(){return h.invokeAsync(...arguments)},d.clear=()=>h.clear(),d}},11841:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.ServerError=d.CloseCode=void 0,function(h){h[h.CONSENTED=4e3]="CONSENTED",h[h.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(d.CloseCode||(d.CloseCode={}));class m extends Error{constructor(h,d){super(d),this.name="ServerError",this.code=h}}d.ServerError=m},11819:(h,d,m)=>{"use strict";d.b=void 0,m(11823);var j=m(11832);Object.defineProperty(d,"b",{enumerable:!0,get:function(){return j.Client}});var A=m(11881);var b=m(11846);var w=m(11909);const a=m(11926);const D=m(11929),S=m(11889);(0,S.registerSerializer)("schema",a.SchemaSerializer),(0,S.registerSerializer)("none",D.NoneSerializer)},11823:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=h=>null!==h&&"object"===typeof h&&h.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11854:(h,d)=>{"use strict";function m(h,d){if(this._offset=d,h instanceof ArrayBuffer)this._buffer=h,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(h))throw new Error("Invalid argument");this._buffer=h.buffer,this._view=new DataView(this._buffer,h.byteOffset,h.byteLength)}}Object.defineProperty(d,"__esModule",{value:!0}),d.decode=d.encode=void 0,m.prototype._array=function(h){for(var d=new Array(h),m=0;m<h;m++)d[m]=this._parse();return d},m.prototype._map=function(h){for(var d={},m=0;m<h;m++)d[this._parse()]=this._parse();return d},m.prototype._str=function(h){var d=function(h,d,m){for(var j="",A=0,b=d,w=d+m;b<w;b++){var a=h.getUint8(b);if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(A=(7&a)<<18|(63&h.getUint8(++b))<<12|(63&h.getUint8(++b))<<6|63&h.getUint8(++b))>=65536?(A-=65536,j+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):j+=String.fromCharCode(A)}else j+=String.fromCharCode((15&a)<<12|(63&h.getUint8(++b))<<6|63&h.getUint8(++b));else j+=String.fromCharCode((31&a)<<6|63&h.getUint8(++b));else j+=String.fromCharCode(a)}return j}(this._view,this._offset,h);return this._offset+=h,d},m.prototype._bin=function(h){var d=this._buffer.slice(this._offset,this._offset+h);return this._offset+=h,d},m.prototype._parse=function(){var h,d=this._view.getUint8(this._offset++),m=0,j=0,A=0,b=0;if(d<192)return d<128?d:d<144?this._map(15&d):d<160?this._array(15&d):this._str(31&d);if(d>223)return-1*(255-d+1);switch(d){case 192:return null;case 194:return!1;case 195:return!0;case 196:return m=this._view.getUint8(this._offset),this._offset+=1,this._bin(m);case 197:return m=this._view.getUint16(this._offset),this._offset+=2,this._bin(m);case 198:return m=this._view.getUint32(this._offset),this._offset+=4,this._bin(m);case 199:if(m=this._view.getUint8(this._offset),j=this._view.getInt8(this._offset+1),this._offset+=2,-1===j){var w=this._view.getUint32(this._offset);return A=this._view.getInt32(this._offset+4),b=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*A+b)+w/1e6)}return[j,this._bin(m)];case 200:return m=this._view.getUint16(this._offset),j=this._view.getInt8(this._offset+2),this._offset+=3,[j,this._bin(m)];case 201:return m=this._view.getUint32(this._offset),j=this._view.getInt8(this._offset+4),this._offset+=5,[j,this._bin(m)];case 202:return h=this._view.getFloat32(this._offset),this._offset+=4,h;case 203:return h=this._view.getFloat64(this._offset),this._offset+=8,h;case 204:return h=this._view.getUint8(this._offset),this._offset+=1,h;case 205:return h=this._view.getUint16(this._offset),this._offset+=2,h;case 206:return h=this._view.getUint32(this._offset),this._offset+=4,h;case 207:return A=this._view.getUint32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,A+b;case 208:return h=this._view.getInt8(this._offset),this._offset+=1,h;case 209:return h=this._view.getInt16(this._offset),this._offset+=2,h;case 210:return h=this._view.getInt32(this._offset),this._offset+=4,h;case 211:return A=this._view.getInt32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,A+b;case 212:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?void(this._offset+=1):[j,this._bin(1)];case 213:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(2)];case 214:return j=this._view.getInt8(this._offset),this._offset+=1,-1===j?(h=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*h)):[j,this._bin(4)];case 215:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?(A=this._view.getInt32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,new Date(A+b)):-1===j?(A=this._view.getUint32(this._offset),b=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&A)+b)+(A>>>2)/1e6)):[j,this._bin(8)];case 216:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(16)];case 217:return m=this._view.getUint8(this._offset),this._offset+=1,this._str(m);case 218:return m=this._view.getUint16(this._offset),this._offset+=2,this._str(m);case 219:return m=this._view.getUint32(this._offset),this._offset+=4,this._str(m);case 220:return m=this._view.getUint16(this._offset),this._offset+=2,this._array(m);case 221:return m=this._view.getUint32(this._offset),this._offset+=4,this._array(m);case 222:return m=this._view.getUint16(this._offset),this._offset+=2,this._map(m);case 223:return m=this._view.getUint32(this._offset),this._offset+=4,this._map(m)}throw new Error("Could not parse")},d.decode=function(h){var d=new m(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),j=d._parse();if(d._offset!==h.byteLength)throw new Error(h.byteLength-d._offset+" trailing bytes");return j};function j(h,d,m){for(var j=0,A=0,b=m.length;A<b;A++)(j=m.charCodeAt(A))<128?h.setUint8(d++,j):j<2048?(h.setUint8(d++,192|j>>6),h.setUint8(d++,128|63&j)):j<55296||j>=57344?(h.setUint8(d++,224|j>>12),h.setUint8(d++,128|j>>6&63),h.setUint8(d++,128|63&j)):(A++,j=65536+((1023&j)<<10|1023&m.charCodeAt(A)),h.setUint8(d++,240|j>>18),h.setUint8(d++,128|j>>12&63),h.setUint8(d++,128|j>>6&63),h.setUint8(d++,128|63&j))}function A(h,d,m){var j=typeof m,b=0,w=0,a=0,D=0,S=0,M=0;if("string"===j){if(S=function(h){for(var d=0,m=0,j=0,A=h.length;j<A;j++)(d=h.charCodeAt(j))<128?m+=1:d<2048?m+=2:d<55296||d>=57344?m+=3:(j++,m+=4);return m}(m),S<32)h.push(160|S),M=1;else if(S<256)h.push(217,S),M=2;else if(S<65536)h.push(218,S>>8,S),M=3;else{if(!(S<4294967296))throw new Error("String too long");h.push(219,S>>24,S>>16,S>>8,S),M=5}return d.push({_str:m,_length:S,_offset:h.length}),M+S}if("number"===j)return Math.floor(m)===m&&isFinite(m)?m>=0?m<128?(h.push(m),1):m<256?(h.push(204,m),2):m<65536?(h.push(205,m>>8,m),3):m<4294967296?(h.push(206,m>>24,m>>16,m>>8,m),5):(a=m/Math.pow(2,32)|0,D=m>>>0,h.push(207,a>>24,a>>16,a>>8,a,D>>24,D>>16,D>>8,D),9):m>=-32?(h.push(m),1):m>=-128?(h.push(208,m),2):m>=-32768?(h.push(209,m>>8,m),3):m>=-2147483648?(h.push(210,m>>24,m>>16,m>>8,m),5):(a=Math.floor(m/Math.pow(2,32)),D=m>>>0,h.push(211,a>>24,a>>16,a>>8,a,D>>24,D>>16,D>>8,D),9):(h.push(203),d.push({_float:m,_length:8,_offset:h.length}),9);if("object"===j){if(null===m)return h.push(192),1;if(Array.isArray(m)){if((S=m.length)<16)h.push(144|S),M=1;else if(S<65536)h.push(220,S>>8,S),M=3;else{if(!(S<4294967296))throw new Error("Array too large");h.push(221,S>>24,S>>16,S>>8,S),M=5}for(b=0;b<S;b++)M+=A(h,d,m[b]);return M}if(m instanceof Date){var q=m.getTime(),E=Math.floor(q/1e3),I=1e6*(q-1e3*E);return E>=0&&I>=0&&E<=17179869183?0===I&&E<=4294967295?(h.push(214,255,E>>24,E>>16,E>>8,E),6):(a=E/4294967296,D=4294967295&E,h.push(215,255,I>>22,I>>14,I>>6,a,D>>24,D>>16,D>>8,D),10):(a=Math.floor(E/4294967296),D=E>>>0,h.push(199,12,255,I>>24,I>>16,I>>8,I,a>>24,a>>16,a>>8,a,D>>24,D>>16,D>>8,D),15)}if(m instanceof ArrayBuffer){if((S=m.byteLength)<256)h.push(196,S),M=2;else if(S<65536)h.push(197,S>>8,S),M=3;else{if(!(S<4294967296))throw new Error("Buffer too large");h.push(198,S>>24,S>>16,S>>8,S),M=5}return d.push({_bin:m,_length:S,_offset:h.length}),M+S}if("function"===typeof m.toJSON)return A(h,d,m.toJSON());var R=[],Z="",L=Object.keys(m);for(b=0,w=L.length;b<w;b++)void 0!==m[Z=L[b]]&&"function"!==typeof m[Z]&&R.push(Z);if((S=R.length)<16)h.push(128|S),M=1;else if(S<65536)h.push(222,S>>8,S),M=3;else{if(!(S<4294967296))throw new Error("Object too large");h.push(223,S>>24,S>>16,S>>8,S),M=5}for(b=0;b<S;b++)M+=A(h,d,Z=R[b]),M+=A(h,d,m[Z]);return M}if("boolean"===j)return h.push(m?195:194),1;if("undefined"===j)return h.push(192),1;if("function"===typeof m.toJSON)return A(h,d,m.toJSON());throw new Error("Could not encode")}d.encode=function(h){var d=[],m=[],b=A(d,m,h),w=new ArrayBuffer(b),a=new DataView(w),D=0,S=0,M=-1;m.length>0&&(M=m[0]._offset);for(var q,E=0,I=0,R=0,Z=d.length;R<Z;R++)if(a.setUint8(S+R,d[R]),R+1===M){if(E=(q=m[D])._length,I=S+M,q._bin)for(var L=new Uint8Array(q._bin),B=0;B<E;B++)a.setUint8(I+B,L[B]);else q._str?j(a,I,q._str):void 0!==q._float&&a.setFloat64(I,q._float);S+=E,m[++D]&&(M=m[D]._offset)}return w}},11929:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.NoneSerializer=void 0;d.NoneSerializer=class{setState(h){}getState(){return null}patch(h){}teardown(){}handshake(h){}}},11926:(h,d,m)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.SchemaSerializer=void 0;const j=m(11905);d.SchemaSerializer=class{setState(h){return this.state.decode(h)}getState(){return this.state}patch(h){return this.state.decode(h)}teardown(){var h,d;null===(d=null===(h=this.state)||void 0===h?void 0:h.$changes)||void 0===d||d.root.clearRefs()}handshake(h,d){if(this.state){(new j.Reflection).decode(h,d)}else this.state=j.Reflection.decode(h,d)}}},11889:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.getSerializer=d.registerSerializer=void 0;const m={};d.registerSerializer=function(h,d){m[h]=d},d.getSerializer=function(h){const d=m[h];if(!d)throw new Error("missing serializer: "+h);return d}},11863:function(h,d,m){"use strict";var j=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(d,"__esModule",{value:!0}),d.WebSocketTransport=void 0;const A=j(m(11872)),b=globalThis.WebSocket||A.default;d.WebSocketTransport=class{constructor(h){this.events=h}send(h){h instanceof ArrayBuffer?this.ws.send(h):Array.isArray(h)&&this.ws.send(new Uint8Array(h).buffer)}connect(h){this.ws=new b(h,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(h,d){this.ws.close(h,d)}get isOpen(){return this.ws.readyState===b.OPEN}}},11872:h=>{"use strict";h.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12921:h=>{"use strict";function d(h,m,j){var A=0|h[j];if(A<=0)return[];var b,w=new Array(A);if(j===h.length-1)for(b=0;b<A;++b)w[b]=m;else for(b=0;b<A;++b)w[b]=d(h,m,j+1);return w}h.exports=function(h,m){switch("undefined"===typeof m&&(m=0),typeof h){case"number":if(h>0)return function(h,d){var m,j;for(m=new Array(h),j=0;j<h;++j)m[j]=d;return m}(0|h,m);break;case"object":if("number"===typeof h.length)return d(h,m,0)}return[]}},12879:(h,d,m)=>{h.exports=function(){var h=this;this.components={},this.comps=this.components;var d=this.components,m=1,A={},b=[],w=[],a={timeout:!1,removals:[],multiComps:[]};function D(h,m){var j=d[m],b=A[m],w=b.hash[h];w&&(b.remove(h),j.Sd&&(j.multi?(w.forEach((d=>{d&&j.Sd(h,d)})),w.length=0):j.Sd(h,w)),a.removals.push(b),S())}function S(){a.timeout||(a.timeout=!0,setTimeout(M,1))}function M(){a.timeout=!1,q()}function q(){a.multiComps.length&&function(h){for(var d=0;d<h.length;d++){var{entID:m,data:j}=h[d],A=j.hash[m];if(A){for(var b=0;b<A.length;b++)A[b]||(A.splice(b,1),b--);0===A.length&&(j.remove(m),a.removals.push(j))}}h.length=0}(a.multiComps),a.removals.length&&function(h){for(var d=0;d<h.length;d++){h[d].flush()}h.length=0}(a.removals)}this.Cq=A,this._systems=b,this._renderSystems=w,this.SM=function(d){var j=m++;return Array.isArray(d)&&d.forEach((d=>h.uD(j,d))),j},this.deleteEntity=function(d){return Object.keys(A).forEach((h=>{A[h].hash[d]&&D(d,h)})),h},this.gM=function(h){if(!h)throw new Error("Missing component definition");var m=h.name;if(!m)throw new Error("Component definition must have a name property.");if("string"!==typeof m)throw new Error("Component name must be a string.");if(""===m)throw new Error("Component name must be a non-empty string.");if(A[m])throw new Error(`Component ${m} already exists.`);var a={};return a.name=m,a.multi=!!h.multi,a.order=isNaN(h.order)?99:h.order,a.stateConstructor=h.stateConstructor||null,a.state=h.state||{},a.dD=h.dD||null,a.Sd=h.Sd||null,a.system=h.system||null,a.SD=h.SD||null,d[m]=a,A[m]=new j,A[m]._pendingMultiCleanup=!1,A[m]._multiCleanupIDs=a.multi?[]:null,a.system&&(b.push(m),b.sort(((h,m)=>d[h].order-d[m].order))),a.SD&&(w.push(m),w.sort(((h,m)=>d[h].order-d[m].order))),m},this.overwriteComponent=function(h,m){var j=d[h];if(!j)throw new Error(`Unknown component: ${h}`);if(!m)throw new Error("Missing component definition");if(j.name!==m.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=h,a.multi=!!m.multi,a.order=isNaN(m.order)?99:m.order,a.state=m.state||{},a.dD=m.dD||null,a.Sd=m.Sd||null,a.system=m.system||null,a.SD=m.SD||null,d[h]=a,A[h]._pendingMultiCleanup=!1,A[h]._multiCleanupIDs=a.multi?[]:null;var D=b.indexOf(h);a.system&&D<0&&b.push(h),!a.system&&D>=0&&b.splice(D,1),b.sort(((h,m)=>d[h].order-d[m].order));var S=w.indexOf(h);a.SD&&S<0&&w.push(h),!a.SD&&S>=0&&w.splice(S,1),w.sort(((h,m)=>d[h].order-d[m].order));var M=a.state;return this.pS(h).forEach((h=>{for(var d in M)d in h||(h[d]=M[d]);a.dD&&a.dD(h.aD,h)})),h},this.deleteComponent=function(m){var j=A[m];if(!j)throw new Error(`Unknown component: ${m}`);j.flush(),j.list.forEach((h=>{h&&D(h.aD||h[0].aD,m)}));var a=b.indexOf(m),S=w.indexOf(m);return a>-1&&b.splice(a,1),S>-1&&w.splice(S,1),A[m].dispose(),delete A[m],delete d[m],h},this.uD=function(h,m,j){var b,w=d[m],a=A[m];if(!a)throw new Error(`Unknown component: ${m}.`);if(a.hash[h]&&!w.multi)throw new Error(`Entity ${h} already has component: ${m}.`);if(w.stateConstructor){if(!(b=new w.stateConstructor).hasOwnProperty("aD"))throw new Error(`Component ${w.name} stateConstructor type does not have property __id`)}else b=Object.assign({},{aD:h},w.state,j);if(b.aD=h,w.multi){var D=a.hash[h];D||(D=[],a.add(h,D)),D.push(b)}else a.add(h,b);return w.dD&&w.dD(h,b),this},this.wS=function(h,d){var m=A[d];if(!m)throw new Error(`Unknown component: ${d}.`);return!!m.hash[h]},this.dS=function(d,m){if(!A[m])throw new Error(`Unknown component: ${m}.`);return D(d,m),h},this.getState=function(h,d){var m=A[d];if(!m)throw new Error(`Unknown component: ${d}.`);return m.hash[h]},this.pS=function(h){var d=A[h];if(!d)throw new Error(`Unknown component: ${h}.`);return q(),d.list},this.EI=function(h){if(!A[h])throw new Error(`Unknown component: ${h}.`);var d=A[h].hash;return h=>d[h]},this.ZI=function(h){if(!A[h])throw new Error(`Unknown component: ${h}.`);var d=A[h].hash;return h=>!!d[h]},this.Pa=function(m){q();for(var j=0;j<b.length;j++){var w=b[j],a=d[w],D=A[w];a.system(m,D.list),q()}return h},this.render=function(m){q();for(var j=0;j<w.length;j++){var b=w[j],a=d[b],D=A[b];a.SD(m,D.list),q()}return h},this.removeMultiComponent=function(m,j,b){var w=d[j],D=A[j];if(!D)throw new Error(`Unknown component: ${j}.`);if(!w.multi)throw new Error("removeMultiComponent called on non-multi component");return function(h,d,m,j){var A=m.hash[h];if(A){var b=A[j];b&&(A[j]=null,d.Sd&&d.Sd(h,b),a.multiComps.push({entID:h,data:m}),S())}}(m,w,D,b),h}};var j=m(12885)},12885:h=>{function d(h,d){var m=h._map[d];if(delete h.hash[d],delete h._map[d],m===h.list.length-1)h.list.pop();else{var j=h.list.pop();if(h.list[m]=j,null===j||null===j[0]){var A=h.list.length;for(var b in h._map)if(h._map[b]===A)return void(h._map[b]=m)}else{var w=j.aD||j[0].aD;h._map[w]=m}}}h.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(h,d){if("number"===typeof this._map[h]){var m=this._map[h];this.hash[h]=d,this.list[m]=d}else this._map[h]=this.list.length,this.hash[h]=d,this.list.push(d)}remove(h){var d=this._map[h];this.hash[h]=null,this.list[d]=null,this._pendingRemovals.push(h)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var h=0;h<this._pendingRemovals.length;h++){var m=this._pendingRemovals[h];null===this.hash[m]&&d(this,m)}this._pendingRemovals.length=0}}},13141:h=>{"use strict";h.exports=function(h,d,m,j,A,b){var w=+d[0],a=+d[1],D=+d[2],S=+m[0],M=+m[1],q=+m[2],E=Math.sqrt(S*S+M*M+q*q);if(0===E)throw new Error("Can't raycast along a zero vector");return function(h,d,m,j,A,b,w,a,D,S){for(var M=0,q=Math.floor,E=0|q(d),I=0|q(m),R=0|q(j),Z=A>0?1:-1,L=b>0?1:-1,B=w>0?1:-1,V=Math.abs(1/A),v=Math.abs(1/b),C=Math.abs(1/w),T=V<1/0?V*(Z>0?E+1-d:d-E):1/0,o=v<1/0?v*(L>0?I+1-m:m-I):1/0,y=C<1/0?C*(B>0?R+1-j:j-R):1/0,i=-1;M<=a;){var g=h(E,I,R);if(g)return D&&(D[0]=d+M*A,D[1]=m+M*b,D[2]=j+M*w),S&&(S[0]=S[1]=S[2]=0,0===i&&(S[0]=-Z),1===i&&(S[1]=-L),2===i&&(S[2]=-B)),g;T<o?T<y?(E+=Z,M=T,T+=V,i=0):(R+=B,M=y,y+=C,i=2):o<y?(I+=L,M=o,o+=v,i=1):(R+=B,M=y,y+=C,i=2)}return D&&(D[0]=d+M*A,D[1]=m+M*b,D[2]=j+M*w),S&&(S[0]=S[1]=S[2]=0),0}(h,w,a,D,S/=E,M/=E,q/=E,j="undefined"===typeof j?64:+j,A,b)}},13173:(h,d,m)=>{"use strict";m.d(d,{b:()=>b});var j=m(699);function A(){this.EE=!1,this.stopPropagation=!1,this.IE=!1,this.disabled=!1}class b{constructor(h,d){this.version="0.7.0";var m=Object.assign({},new A,d||{});this.element=h||document,this.EE=!!m.EE,this.stopPropagation=!!m.stopPropagation,this.IE=!!m.IE,this.disabled=!!m.disabled,this.filterEvents=(h,d)=>!0,this.down=new j.EventEmitter,this.up=new j.EventEmitter,this.state={},this.tS={dx:0,dy:0,jI:0,QS:0,AI:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?a(this):document.addEventListener("DOMContentLoaded",(h=>{a(this)}),{once:!0})}bind(h){for(var d=arguments.length,m=new Array(d>1?d-1:0),j=1;j<d;j++)m[j-1]=arguments[j];m.forEach((d=>{var m=this._keyBindmap[d]||[];m.includes(h)||(m.push(h),this._keyBindmap[d]=m)})),this.state[h]=!!this.state[h],this.pressCount[h]=this.pressCount[h]||0,this.releaseCount[h]=this.releaseCount[h]||0}unbind(h){for(var d in this._keyBindmap){var m=this._keyBindmap[d],j=m.indexOf(h);j>-1&&m.splice(j,1)}}getBindings(){var h={};for(var d in this._keyBindmap){this._keyBindmap[d].forEach((m=>{h[m]=h[m]||[],h[m].push(d)}))}return h}Pa(){w(this.tS),w(this.pressCount),w(this.releaseCount)}}function w(h){for(var d in h)h[d]=0}function a(h){window.addEventListener("keydown",R.bind(null,h,!0),!1),window.addEventListener("keyup",R.bind(null,h,!1),!1);var d={passive:!0};h.element.addEventListener("touchstart",q.bind(void 0,h),{passive:!1}),h.element.addEventListener("touchend",I.bind(void 0,h),d),h.element.addEventListener("mousedown",Z.bind(null,h,!0),d),window.document.addEventListener("mouseup",Z.bind(null,h,!1),d),h.element.addEventListener("touchmove",L.bind(null,h),d),h.element.addEventListener("mousemove",L.bind(null,h),d),window.PointerEvent,h.element.addEventListener("wheel",B.bind(null,h),d),h.element.addEventListener("contextmenu",V.bind(null,h),!1),window.addEventListener("blur",v.bind(null,h),!1)}var D=0,S=0,M=null;function q(h,d){d.preventDefault(),E(d)}function E(h){let d=!1;for(let m=0;m<h.touches.length;++m)if(h.touches[m].identifier===M){d=!0;break}if(!d){const d=h.changedTouches[0];D=d.clientX,S=d.clientY,M=d.identifier}}function I(h,d){for(var m=d.changedTouches,j=0;j<m.length;++j)m[j].identifier===M&&(M=null)}function R(h,d,m){C(m.code,d,h,m)}function Z(h,d,m){if("pointerId"in m)if(d){if(null!==h._touches.currID)return;h._touches.currID=m.pointerId}else{if(h._touches.currID!==m.pointerId)return;h._touches.currID=null}return C("Mouse"+("button"in m?m.button+1:1),d,h,m),!1}function L(h,d){var m=d.movementX||d.mozMovementX||0,j=d.movementY||d.mozMovementY||0;if(d.touches&&0===(m|j)){var A=function(h){E(h);for(let d=0;d<h.changedTouches.length;++d)if(h.changedTouches[d].identifier==M){const m=h.changedTouches[d],j=[m.clientX-D,m.clientY-S];return D=m.clientX,S=m.clientY,j}return console.error(`Did not find touch id ${M}`),[0,0]}(d);m=A[0],j=A[1]}h.tS.dx+=m,h.tS.dy+=j}function B(h,d){var m=1;switch(d.deltaMode){case 0:m=1;break;case 1:m=12;break;case 2:m=h.element.clientHeight||window.innerHeight}h.tS.jI+=(d.deltaX||0)*m,h.tS.QS+=(d.deltaY||0)*m,h.tS.AI+=(d.deltaZ||0)*m}function V(h,d){if(!h.IE)return d.preventDefault(),!1}function v(h){for(var d in h._keyStates)h._keyStates[d]&&(/^Mouse\d/.test(d)||C(d,!1,h,{code:d,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function C(h,d,m,j){var A=m._keyBindmap[h];A&&(T(m._keyStates[h],d)&&(m._keyStates[h]=d,A.forEach((h=>{(!m.filterEvents||m.filterEvents(j,h))&&function(h,d,m,j){var A=d?m.pressCount:m.releaseCount;A[h]=(A[h]||0)+1;var b=m._bindPressCount[h]||0;(b+=d?1:-1)<0&&(b=0);m._bindPressCount[h]=b;var w=m.state[h];if(T(w,b)){m.state[h]=b>0;var a=d?m.down:m.up;m.disabled||a.emit(h,j)}}(h,d,m,j)}))),"button"in j||(m.EE&&!j.defaultPrevented&&j.preventDefault(),m.stopPropagation&&j.stopPropagation()))}function T(h,d){return h?!d:d}},12052:h=>{"use strict";h.exports=function(h){for(var d=new Array(h),m=0;m<h;++m)d[m]=m;return d}},12056:h=>{function d(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(d(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&d(h.slice(0,0))}(h)||!!h._isBuffer)}},13150:(h,d,m)=>{"use strict";m.d(d,{c:()=>j});class j{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.pM=!1,this.eM=!1,this.OM=30,this.nM=0,this.mq=!1,this.fullscreen=!1,this.zM=function(h){},this.uM=function(){},this.hq=function(){},this.Ed=function(){},this.PM=function(h){},this.onFullscreenChanged=function(h){},S((()=>{!function(h,d){h._nowObject=performance||Date,h._lastTick=0,h._renderAccum=0,h._rt=0,h._frameCB=a.bind(null,h),requestAnimationFrame(h._frameCB),d>0&&(h._intervalCB=w.bind(null,h),h._interval=setInterval(h._intervalCB,Math.max(d,1e3/h.OM/2)))}(this,d),function(h,d){if(!d)return;var m=!1,j=!1;document.addEventListener("pointerlockchange",(j=>{m=document.pointerLockElement===d,h.PM(m)})),document.addEventListener("fullscreenchange",(m=>{j=document.fullscreenElement===d,h.onFullscreenChanged(j)})),Object.defineProperty(h,"mq",{get:()=>m,set:h=>{h&&!m?D(d):m&&!h&&function(h){h.exitPointerLock&&h.exitPointerLock()}(document)}}),Object.defineProperty(h,"fullscreen",{get:()=>j,set:h=>{h&&!j?d.requestFullscreen():j&&!h&&document.exitFullscreen()}}),d.addEventListener("click",(A=>{h.pM&&!m&&D(d),h.eM&&!j&&d.requestFullscreen()}));var A=()=>h.Ed();if(window.ResizeObserver){new ResizeObserver(A).observe(d)}else window.addEventListener("resize",A)}(this,h),this.hq()}))}}var A=3,b=20;function w(h){for(var d=1e3/h.OM,m=h._nowObject.now()+b,j=0;h._nowObject.now()>=h._lastTick+d&&h._nowObject.now()<m&&++j<=A;)h.zM(d),h._lastTick+=d;var w=5*(d+5),a=h._nowObject.now();if(a-h._lastTick>w)for(;a>=h._lastTick+d;)h._lastTick+=d}function a(h){requestAnimationFrame(h._frameCB),w(h);var d=h._nowObject.now(),m=d-h._rt;if(h._rt=d,h.nM>0){h._renderAccum+=m;var j=1e3/h.nM;if(h._renderAccum<j)return;h._renderAccum=Math.min(h._renderAccum-j,j)}var A=1e3/h.OM,b=(d-h._lastTick)/A;h.uM(m,b,A)}function D(h){h.requestPointerLock&&h.requestPointerLock()}var S=h=>{if("loading"===document.readyState){var d=()=>{document.removeEventListener("readystatechange",d),h()};document.addEventListener("readystatechange",d)}else setTimeout(h,1)}},12050:(h,d,m)=>{var j=m(12052),A=m(12056),b="undefined"!==typeof Float64Array;function w(h,d){return h[0]-d[0]}function a(){var h,d=this.stride,m=new Array(d.length);for(h=0;h<m.length;++h)m[h]=[Math.abs(d[h]),h];m.sort(w);var j=new Array(m.length);for(h=0;h<j.length;++h)j[h]=m[h][1];return j}function D(h,d){var m=["View",d,"d",h].join("");d<0&&(m="View_Nil"+h);var A="generic"===h;if(-1===d){var b="function "+m+"(a){this.data=a;};var proto="+m+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+m+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+m+"(a){return new "+m+"(a);}";return new Function(b)()}if(0===d){b="function "+m+"(a,d) {this.data = a;this.offset = d};var proto="+m+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+m+"_copy() {return new "+m+"(this.data,this.offset)};proto.pick=function "+m+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+m+"_get(){return "+(A?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+m+"_set(v){return "+(A?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+m+"(a,b,c,d){return new "+m+"(a,d)}";return new Function("TrivialArray",b)(S[h][0])}b=["'use strict'"];var w=j(d),D=w.map((function(h){return"i"+h})),M="this.offset+"+w.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),q=w.map((function(h){return"b"+h})).join(","),E=w.map((function(h){return"c"+h})).join(",");b.push("function "+m+"(a,"+q+","+E+",d){this.data=a","this.shape=["+q+"]","this.stride=["+E+"]","this.offset=d|0}","var proto="+m+".prototype","proto.dtype='"+h+"'","proto.dimension="+d),b.push("Object.defineProperty(proto,'size',{get:function "+m+"_size(){return "+w.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===d?b.push("proto.order=[0]"):(b.push("Object.defineProperty(proto,'order',{get:"),d<4?(b.push("function "+m+"_order(){"),2===d?b.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&b.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):b.push("ORDER})")),b.push("proto.set=function "+m+"_set("+D.join(",")+",v){"),A?b.push("return this.data.set("+M+",v)}"):b.push("return this.data["+M+"]=v}"),b.push("proto.get=function "+m+"_get("+D.join(",")+"){"),A?b.push("return this.data.get("+M+")}"):b.push("return this.data["+M+"]}"),b.push("proto.index=function "+m+"_index(",D.join(),"){return "+M+"}"),b.push("proto.hi=function "+m+"_hi("+D.join(",")+"){return new "+m+"(this.data,"+w.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+w.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var I=w.map((function(h){return"a"+h+"=this.shape["+h+"]"})),R=w.map((function(h){return"c"+h+"=this.stride["+h+"]"}));b.push("proto.lo=function "+m+"_lo("+D.join(",")+"){var b=this.offset,d=0,"+I.join(",")+","+R.join(","));for(var Z=0;Z<d;++Z)b.push("if(typeof i"+Z+"==='number'&&i"+Z+">=0){d=i"+Z+"|0;b+=c"+Z+"*d;a"+Z+"-=d}");b.push("return new "+m+"(this.data,"+w.map((function(h){return"a"+h})).join(",")+","+w.map((function(h){return"c"+h})).join(",")+",b)}"),b.push("proto.step=function "+m+"_step("+D.join(",")+"){var "+w.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+w.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Z=0;Z<d;++Z)b.push("if(typeof i"+Z+"==='number'){d=i"+Z+"|0;if(d<0){c+=b"+Z+"*(a"+Z+"-1);a"+Z+"=ceil(-a"+Z+"/d)}else{a"+Z+"=ceil(a"+Z+"/d)}b"+Z+"*=d}");b.push("return new "+m+"(this.data,"+w.map((function(h){return"a"+h})).join(",")+","+w.map((function(h){return"b"+h})).join(",")+",c)}");var L=new Array(d),B=new Array(d);for(Z=0;Z<d;++Z)L[Z]="a[i"+Z+"]",B[Z]="b[i"+Z+"]";b.push("proto.transpose=function "+m+"_transpose("+D+"){"+D.map((function(h,d){return h+"=("+h+"===undefined?"+d+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+m+"(this.data,"+L.join(",")+","+B.join(",")+",this.offset)}"),b.push("proto.pick=function "+m+"_pick("+D+"){var a=[],b=[],c=this.offset");for(Z=0;Z<d;++Z)b.push("if(typeof i"+Z+"==='number'&&i"+Z+">=0){c=(c+this.stride["+Z+"]*i"+Z+")|0}else{a.push(this.shape["+Z+"]);b.push(this.stride["+Z+"])}");return b.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),b.push("return function construct_"+m+"(data,shape,stride,offset){return new "+m+"(data,"+w.map((function(h){return"shape["+h+"]"})).join(",")+","+w.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",b.join("\n"))(S[h],a)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,d,m,j){if(void 0===h)return(0,S.array[0])([]);"number"===typeof h&&(h=[h]),void 0===d&&(d=[h.length]);var w=d.length;if(void 0===m){m=new Array(w);for(var a=w-1,M=1;a>=0;--a)m[a]=M,M*=d[a]}if(void 0===j){j=0;for(a=0;a<w;++a)m[a]<0&&(j-=(d[a]-1)*m[a])}for(var q=function(h){if(A(h))return"buffer";if(b)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),E=S[q];E.length<=w+1;)E.push(D(q,E.length-1));return(0,E[w+1])(h,d,m,j)}},13022:h=>{var d;self,d=()=>(()=>{"use strict";var h={d:(d,m)=>{for(var j in m)h.o(m,j)&&!h.o(d,j)&&Object.defineProperty(d,j,{enumerable:!0,get:m[j]})},o:(h,d)=>Object.prototype.hasOwnProperty.call(h,d)},d={};h.d(d,{default:()=>K});var m,j=function(h,d){var m=d.x-h.x,j=d.y-h.y;return Math.sqrt(m*m+j*j)},A=function(h){return h*(Math.PI/180)},b=new Map,w=function(h){b.has(h)&&clearTimeout(b.get(h)),b.set(h,setTimeout(h,100))},a=function(h,d,m){for(var j,A=d.split(/[ ,]+/g),b=0;b<A.length;b+=1)j=A[b],h.addEventListener?h.addEventListener(j,m,!1):h.attachEvent&&h.attachEvent(j,m)},D=function(h,d,m){for(var j,A=d.split(/[ ,]+/g),b=0;b<A.length;b+=1)j=A[b],h.removeEventListener?h.removeEventListener(j,m):h.detachEvent&&h.detachEvent(j,m)},S=function(h){return h.preventDefault(),h.type.match(/^touch/)?h.changedTouches:h},M=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},q=function(h,d){d.top||d.right||d.bottom||d.left?(h.style.top=d.top,h.style.right=d.right,h.style.bottom=d.bottom,h.style.left=d.left):(h.style.left=d.x+"px",h.style.top=d.y+"px")},E=function(h,d,m){var j=I(h);for(var A in j)if(j.hasOwnProperty(A))if("string"==typeof d)j[A]=d+" "+m;else{for(var b="",w=0,a=d.length;w<a;w+=1)b+=d[w]+" "+m+", ";j[A]=b.slice(0,-2)}return j},I=function(h){var d={};return d[h]="",["webkit","Moz","o"].forEach((function(m){d[m+h.charAt(0).toUpperCase()+h.slice(1)]=""})),d},R=function(h,d){for(var m in d)d.hasOwnProperty(m)&&(h[m]=d[m]);return h},Z=function(h,d){if(h.length)for(var m=0,j=h.length;m<j;m+=1)d(h[m]);else d(h)},L="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,V=!!("ontouchstart"in window),v=!!window.PointerEvent,C=!!window.MSPointerEvent,T={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},o={start:"mousedown",move:"mousemove",end:"mouseup"},y={};function i(){}L&&!B?m=T:v?m={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:C?m={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:V?(m=T,y=o):m=o,i.prototype.on=function(h,d){var m,j=this,A=h.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var b=0;b<A.length;b+=1)m=A[b],j._handlers_[m]=j._handlers_[m]||[],j._handlers_[m].push(d);return j},i.prototype.off=function(h,d){var m=this;return m._handlers_=m._handlers_||{},void 0===h?m._handlers_={}:void 0===d?m._handlers_[h]=null:m._handlers_[h]&&m._handlers_[h].indexOf(d)>=0&&m._handlers_[h].splice(m._handlers_[h].indexOf(d),1),m},i.prototype.trigger=function(h,d){var m,j=this,A=h.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var b=0;b<A.length;b+=1)m=A[b],j._handlers_[m]&&j._handlers_[m].length&&j._handlers_[m].forEach((function(h){h.call(j,{type:m,target:j},d)}))},i.prototype.config=function(h){var d=this;d.options=d.defaults||{},h&&(d.options=function(h,d){var m={};for(var j in h)h.hasOwnProperty(j)&&d.hasOwnProperty(j)?m[j]=d[j]:h.hasOwnProperty(j)&&(m[j]=h[j]);return m}(d.options,h))},i.prototype.bindEvt=function(h,d){var j=this;return j._domHandlers_=j._domHandlers_||{},j._domHandlers_[d]=function(){"function"==typeof j["on"+d]?j["on"+d].apply(j,arguments):console.warn('[WARNING] : Missing "on'+d+'" handler.')},a(h,m[d],j._domHandlers_[d]),y[d]&&a(h,y[d],j._domHandlers_[d]),j},i.prototype.unbindEvt=function(h,d){var j=this;return j._domHandlers_=j._domHandlers_||{},D(h,m[d],j._domHandlers_[d]),y[d]&&D(h,y[d],j._domHandlers_[d]),delete j._domHandlers_[d],this};const g=i;function F(h,d){return this.identifier=d.identifier,this.position=d.position,this.frontPosition=d.frontPosition,this.collection=h,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(d),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=F.id,F.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}F.prototype=new g,F.constructor=F,F.id=0,F.prototype.buildEl=function(h){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},F.prototype.stylize=function(){if(this.options.dataOnly)return this;var h=this.options.fadeTime+"ms",d=function(){var h=I("borderRadius");for(var d in h)h.hasOwnProperty(d)&&(h[d]="50%");return h}(),m=E("transition","opacity",h),j={};return j.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},j.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},j.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},R(j.el,m),"circle"===this.options.shape&&R(j.back,d),R(j.front,d),this.applyStyles(j),this},F.prototype.applyStyles=function(h){for(var d in this.ui)if(this.ui.hasOwnProperty(d))for(var m in h[d])this.ui[d].style[m]=h[d][m];return this},F.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},F.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},F.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},F.prototype.show=function(h){var d=this;return d.options.dataOnly||(clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.addToDom(),d.restCallback(),setTimeout((function(){d.ui.el.style.opacity=1}),0),d.showTimeout=setTimeout((function(){d.trigger("shown",d.instance),"function"==typeof h&&h.call(this)}),d.options.fadeTime)),d},F.prototype.hide=function(h){var d=this;if(d.options.dataOnly)return d;if(d.ui.el.style.opacity=d.options.restOpacity,clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.removeTimeout=setTimeout((function(){var m="dynamic"===d.options.mode?"none":"block";d.ui.el.style.display=m,"function"==typeof h&&h.call(d),d.trigger("hidden",d.instance)}),d.options.fadeTime),d.options.restJoystick){var m=d.options.restJoystick,j={};j.x=!0===m||!1!==m.x?0:d.instance.frontPosition.x,j.y=!0===m||!1!==m.y?0:d.instance.frontPosition.y,d.setPosition(h,j)}return d},F.prototype.setPosition=function(h,d){var m=this;m.frontPosition={x:d.x,y:d.y};var j=m.options.fadeTime+"ms",A={};A.front=E("transition",["transform"],j);var b={front:{}};b.front={transform:"translate("+m.frontPosition.x+"px,"+m.frontPosition.y+"px)"},m.applyStyles(A),m.applyStyles(b),m.restTimeout=setTimeout((function(){"function"==typeof h&&h.call(m),m.restCallback()}),m.options.fadeTime)},F.prototype.restCallback=function(){var h=this,d={};d.front=E("transition","none",""),h.applyStyles(d),h.trigger("rested",h.instance)},F.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},F.prototype.computeDirection=function(h){var d,m,j,A=h.angle.radian,b=Math.PI/4,w=Math.PI/2;if(A>b&&A<3*b&&!h.lockX?d="up":A>-b&&A<=b&&!h.lockY?d="left":A>3*-b&&A<=-b&&!h.lockX?d="down":h.lockY||(d="right"),h.lockY||(m=A>-w&&A<w?"left":"right"),h.lockX||(j=A>0?"up":"down"),h.force>this.options.threshold){var a,D={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(D[a]=this.direction[a]);var S={};for(a in this.direction={x:m,y:j,angle:d},h.direction=this.direction,D)D[a]===this.direction[a]&&(S[a]=!0);if(S.x&&S.y&&S.angle)return h;S.x&&S.y||this.trigger("plain",h),S.x||this.trigger("plain:"+m,h),S.y||this.trigger("plain:"+j,h),S.angle||this.trigger("dir dir:"+d,h)}else this.resetDirection();return h};const f=F;function H(h,d){var m=this;m.nipples=[],m.idles=[],m.actives=[],m.ids=[],m.pressureIntervals={},m.manager=h,m.id=H.id,H.id+=1,m.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},m.config(d),"static"!==m.options.mode&&"semi"!==m.options.mode||(m.options.multitouch=!1),m.options.multitouch||(m.options.maxNumberOfNipples=1);var j=getComputedStyle(m.options.zone.parentElement);return j&&"flex"===j.display&&(m.parentIsFlex=!0),m.updateBox(),m.prepareNipples(),m.RE(),m.begin(),m.nipples}H.prototype=new g,H.constructor=H,H.id=0,H.prototype.prepareNipples=function(){var h=this,d=h.nipples;d.on=h.on.bind(h),d.off=h.off.bind(h),d.options=h.options,d.destroy=h.destroy.bind(h),d.ids=h.ids,d.id=h.id,d.processOnMove=h.processOnMove.bind(h),d.processOnEnd=h.processOnEnd.bind(h),d.get=function(h){if(void 0===h)return d[0];for(var m=0,j=d.length;m<j;m+=1)if(d[m].identifier===h)return d[m];return!1}},H.prototype.RE=function(){var h=this;h.bindEvt(h.options.zone,"start"),h.options.zone.style.touchAction="none",h.options.zone.style.msTouchAction="none"},H.prototype.begin=function(){var h=this,d=h.options;if("static"===d.mode){var m=h.createNipple(d.position,h.manager.getIdentifier());m.add(),h.idles.push(m)}},H.prototype.createNipple=function(h,d){var m=this,j=m.manager.scroll,A={},b=m.options,w=m.parentIsFlex?j.x:j.x+m.box.left,a=m.parentIsFlex?j.y:j.y+m.box.top;if(h.x&&h.y)A={x:h.x-w,y:h.y-a};else if(h.top||h.right||h.bottom||h.left){var D=document.createElement("DIV");D.style.display="hidden",D.style.top=h.top,D.style.right=h.right,D.style.bottom=h.bottom,D.style.left=h.left,D.style.position="absolute",b.zone.appendChild(D);var S=D.getBoundingClientRect();b.zone.removeChild(D),A=h,h={x:S.left+j.x,y:S.top+j.y}}var M=new f(m,{color:b.color,size:b.size,threshold:b.threshold,fadeTime:b.fadeTime,dataOnly:b.dataOnly,restJoystick:b.restJoystick,restOpacity:b.restOpacity,mode:b.mode,identifier:d,position:h,zone:b.zone,frontPosition:{x:0,y:0},shape:b.shape});return b.dataOnly||(q(M.ui.el,A),q(M.ui.front,M.frontPosition)),m.nipples.push(M),m.trigger("added "+M.identifier+":added",M),m.manager.trigger("added "+M.identifier+":added",M),m.bindNipple(M),M},H.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},H.prototype.bindNipple=function(h){var d,m=this,j=function(h,j){d=h.type+" "+j.id+":"+h.type,m.trigger(d,j)};h.on("destroyed",m.onDestroyed.bind(m)),h.on("shown hidden rested dir plain",j),h.on("dir:up dir:right dir:down dir:left",j),h.on("plain:up plain:right plain:down plain:left",j)},H.prototype.pressureFn=function(h,d,m){var j=this,A=0;clearInterval(j.pressureIntervals[m]),j.pressureIntervals[m]=setInterval(function(){var m=h.force||h.pressure||h.webkitForce||0;m!==A&&(d.trigger("pressure",m),j.trigger("pressure "+d.identifier+":pressure",m),A=m)}.bind(j),100)},H.prototype.onstart=function(h){var d=this,m=d.options,j=h;return h=S(h),d.updateBox(),Z(h,(function(A){d.actives.length<m.maxNumberOfNipples?d.processOnStart(A):j.type.match(/^touch/)&&(Object.keys(d.manager.ids).forEach((function(m){if(Object.values(j.touches).findIndex((function(h){return h.identifier===m}))<0){var A=[h[0]];A.identifier=m,d.processOnEnd(A)}})),d.actives.length<m.maxNumberOfNipples&&d.processOnStart(A))})),d.manager.bindDocument(),!1},H.prototype.processOnStart=function(h){var d,m=this,A=m.options,b=m.manager.getIdentifier(h),w=h.force||h.pressure||h.webkitForce||0,a={x:h.pageX,y:h.pageY},D=m.getOrCreate(b,a);D.identifier!==b&&m.manager.removeIdentifier(D.identifier),D.identifier=b;var S=function(d){d.trigger("start",d),m.trigger("start "+d.id+":start",d),d.show(),w>0&&m.pressureFn(h,d,d.identifier),m.processOnMove(h)};if((d=m.idles.indexOf(D))>=0&&m.idles.splice(d,1),m.actives.push(D),m.ids.push(D.identifier),"semi"!==A.mode)S(D);else{if(!(j(a,D.position)<=A.catchDistance))return D.destroy(),void m.processOnStart(h);S(D)}return D},H.prototype.getOrCreate=function(h,d){var m,j=this,A=j.options;return/(semi|static)/.test(A.mode)?(m=j.idles[0])?(j.idles.splice(0,1),m):"semi"===A.mode?j.createNipple(d,h):(console.warn("Coudln't find the needed nipple."),!1):m=j.createNipple(d,h)},H.prototype.processOnMove=function(h){var d=this,m=d.options,b=d.manager.getIdentifier(h),w=d.nipples.get(b),a=d.manager.scroll;if(function(h){return isNaN(h.buttons)?0!==h.pressure:0!==h.buttons}(h)){if(!w)return console.error("Found zombie joystick with ID "+b),void d.manager.removeIdentifier(b);if(m.dynamicPage){var D=w.el.getBoundingClientRect();w.position={x:a.x+D.left,y:a.y+D.top}}w.identifier=b;var S=w.options.size/2,M={x:h.pageX,y:h.pageY};m.lockX&&(M.y=w.position.y),m.lockY&&(M.x=w.position.x);var q,E,I,R,Z,L,B,V,v,C,T=j(M,w.position),o=(q=M,I=(E=w.position).x-q.x,R=E.y-q.y,function(h){return h*(180/Math.PI)}(Math.atan2(R,I))),y=A(o),i=T/S,g={distance:T,position:M};if("circle"===w.options.shape?(Z=Math.min(T,S),B=w.position,V=Z,C={x:0,y:0},v=A(v=o),C.x=B.x-V*Math.cos(v),C.y=B.y-V*Math.sin(v),L=C):(L=function(h,d,m){return{x:Math.min(Math.max(h.x,d.x-m),d.x+m),y:Math.min(Math.max(h.y,d.y-m),d.y+m)}}(M,w.position,S),Z=j(L,w.position)),m.follow){if(T>S){var F=M.x-L.x,f=M.y-L.y;w.position.x+=F,w.position.y+=f,w.el.style.top=w.position.y-(d.box.top+a.y)+"px",w.el.style.left=w.position.x-(d.box.left+a.x)+"px",T=j(M,w.position)}}else M=L,T=Z;var H=M.x-w.position.x,c=M.y-w.position.y;w.frontPosition={x:H,y:c},m.dataOnly||(w.ui.front.style.transform="translate("+H+"px,"+c+"px)");var k={identifier:w.identifier,position:M,force:i,pressure:h.force||h.pressure||h.webkitForce||0,distance:T,angle:{radian:y,degree:o},vector:{x:H/S,y:-c/S},raw:g,instance:w,lockX:m.lockX,lockY:m.lockY};(k=w.computeDirection(k)).angle={radian:A(180-o),degree:180-o},w.trigger("move",k),d.trigger("move "+w.id+":move",k)}else this.processOnEnd(h)},H.prototype.processOnEnd=function(h){var d=this,m=d.options,j=d.manager.getIdentifier(h),A=d.nipples.get(j),b=d.manager.removeIdentifier(A.identifier);A&&(m.dataOnly||A.hide((function(){"dynamic"===m.mode&&(A.trigger("removed",A),d.trigger("removed "+A.id+":removed",A),d.manager.trigger("removed "+A.id+":removed",A),A.destroy())})),clearInterval(d.pressureIntervals[A.identifier]),A.resetDirection(),A.trigger("end",A),d.trigger("end "+A.id+":end",A),d.ids.indexOf(A.identifier)>=0&&d.ids.splice(d.ids.indexOf(A.identifier),1),d.actives.indexOf(A)>=0&&d.actives.splice(d.actives.indexOf(A),1),/(semi|static)/.test(m.mode)?d.idles.push(A):d.nipples.indexOf(A)>=0&&d.nipples.splice(d.nipples.indexOf(A),1),d.manager.unbindDocument(),/(semi|static)/.test(m.mode)&&(d.manager.ids[b.id]=b.identifier))},H.prototype.onDestroyed=function(h,d){var m=this;m.nipples.indexOf(d)>=0&&m.nipples.splice(m.nipples.indexOf(d),1),m.actives.indexOf(d)>=0&&m.actives.splice(m.actives.indexOf(d),1),m.idles.indexOf(d)>=0&&m.idles.splice(m.idles.indexOf(d),1),m.ids.indexOf(d.identifier)>=0&&m.ids.splice(m.ids.indexOf(d.identifier),1),m.manager.removeIdentifier(d.identifier),m.manager.unbindDocument()},H.prototype.destroy=function(){var h=this;for(var d in h.unbindEvt(h.options.zone,"start"),h.nipples.forEach((function(h){h.destroy()})),h.pressureIntervals)h.pressureIntervals.hasOwnProperty(d)&&clearInterval(h.pressureIntervals[d]);h.trigger("destroyed",h.nipples),h.manager.unbindDocument(),h.off()};const c=H;function k(h){var d=this;d.ids={},d.index=0,d.collections=[],d.scroll=M(),d.config(h),d.prepareCollections();var m=function(){var h;d.collections.forEach((function(m){m.forEach((function(m){h=m.el.getBoundingClientRect(),m.position={x:d.scroll.x+h.left,y:d.scroll.y+h.top}}))}))};a(window,"resize",(function(){w(m)}));var j=function(){d.scroll=M()};return a(window,"scroll",(function(){w(j)})),d.collections}k.prototype=new g,k.constructor=k,k.prototype.prepareCollections=function(){var h=this;h.collections.create=h.create.bind(h),h.collections.on=h.on.bind(h),h.collections.off=h.off.bind(h),h.collections.destroy=h.destroy.bind(h),h.collections.get=function(d){var m;return h.collections.every((function(h){return!(m=h.get(d))})),m}},k.prototype.create=function(h){return this.createCollection(h)},k.prototype.createCollection=function(h){var d=this,m=new c(d,h);return d.bindCollection(m),d.collections.push(m),m},k.prototype.bindCollection=function(h){var d,m=this,j=function(h,j){d=h.type+" "+j.id+":"+h.type,m.trigger(d,j)};h.on("destroyed",m.onDestroyed.bind(m)),h.on("shown hidden rested dir plain",j),h.on("dir:up dir:right dir:down dir:left",j),h.on("plain:up plain:right plain:down plain:left",j)},k.prototype.bindDocument=function(){var h=this;h.binded||(h.bindEvt(document,"move").bindEvt(document,"end"),h.binded=!0)},k.prototype.unbindDocument=function(h){var d=this;Object.keys(d.ids).length&&!0!==h||(d.unbindEvt(document,"move").unbindEvt(document,"end"),d.binded=!1)},k.prototype.getIdentifier=function(h){var d;return h?void 0===(d=void 0===h.identifier?h.pointerId:h.identifier)&&(d=this.latest||0):d=this.index,void 0===this.ids[d]&&(this.ids[d]=this.index,this.index+=1),this.latest=d,this.ids[d]},k.prototype.removeIdentifier=function(h){var d={};for(var m in this.ids)if(this.ids[m]===h){d.id=m,d.identifier=this.ids[m],delete this.ids[m];break}return d},k.prototype.onmove=function(h){return this.onAny("move",h),!1},k.prototype.onend=function(h){return this.onAny("end",h),!1},k.prototype.oncancel=function(h){return this.onAny("end",h),!1},k.prototype.onAny=function(h,d){var m,j=this,A="processOn"+h.charAt(0).toUpperCase()+h.slice(1);d=S(d);var b=function(h,d,m){m.ids.indexOf(d)>=0&&(m[A](h),h._found_=!0)};return Z(d,(function(h){m=j.getIdentifier(h),Z(j.collections,b.bind(null,h,m)),h._found_||j.removeIdentifier(m)})),!1},k.prototype.destroy=function(){var h=this;h.unbindDocument(!0),h.ids={},h.index=0,h.collections.forEach((function(h){h.destroy()})),h.off()},k.prototype.onDestroyed=function(h,d){var m=this;if(m.collections.indexOf(d)<0)return!1;m.collections.splice(m.collections.indexOf(d),1)};var l=new k;const K={create:function(h){return l.create(h)},factory:l};return d.default})(),h.exports=d()},12074:(h,d,m)=>{"use strict";const{Deflate:j,deflate:A,deflateRaw:b,gzip:w}=m(12078),{Inflate:a,inflate:D,inflateRaw:S,ungzip:M}=m(12128),q=m(12107);h.exports.Deflate=j,h.exports.deflate=A,h.exports.deflateRaw=b,h.exports.gzip=w,h.exports.Inflate=a,h.exports.inflate=D,h.exports.inflateRaw=S,h.exports.ungzip=M,h.exports.constants=q},12078:(h,d,m)=>{"use strict";const j=m(12085),A=m(12111),b=m(12120),w=m(12103),a=m(12125),D=Object.prototype.toString,{Z_NO_FLUSH:S,Z_SYNC_FLUSH:M,Z_FULL_FLUSH:q,Z_FINISH:E,Z_OK:I,Z_STREAM_END:R,Z_DEFAULT_COMPRESSION:Z,Z_DEFAULT_STRATEGY:L,Z_DEFLATED:B}=m(12107);function V(h){this.options=A.assign({level:Z,method:B,Uh:16384,windowBits:15,memLevel:8,strategy:L},h||{});let d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.Bd="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let m=j.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(m!==I)throw new Error(w[m]);if(d.header&&j.deflateSetHeader(this.strm,d.header),d.dictionary){let h;if(h="string"===typeof d.dictionary?b.string2buf(d.dictionary):"[object ArrayBuffer]"===D.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,m=j.deflateSetDictionary(this.strm,h),m!==I)throw new Error(w[m]);this._dict_set=!0}}function v(h,d){const m=new V(d);if(m.push(h,!0),m.err)throw m.Bd||w[m.err];return m.result}V.prototype.push=function(h,d){const m=this.strm,A=this.options.Uh;let w,a;if(this.ended)return!1;for(a=d===~~d?d:!0===d?E:S,"string"===typeof h?m.input=b.string2buf(h):"[object ArrayBuffer]"===D.call(h)?m.input=new Uint8Array(h):m.input=h,m.next_in=0,m.avail_in=m.input.length;;)if(0===m.avail_out&&(m.output=new Uint8Array(A),m.next_out=0,m.avail_out=A),(a===M||a===q)&&m.avail_out<=6)this.onData(m.output.subarray(0,m.next_out)),m.avail_out=0;else{if(w=j.deflate(m,a),w===R)return m.next_out>0&&this.onData(m.output.subarray(0,m.next_out)),w=j.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===I;if(0!==m.avail_out){if(a>0&&m.next_out>0)this.onData(m.output.subarray(0,m.next_out)),m.avail_out=0;else if(0===m.avail_in)break}else this.onData(m.output)}return!0},V.prototype.onData=function(h){this.chunks.push(h)},V.prototype.onEnd=function(h){h===I&&(this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.Bd=this.strm.Bd},h.exports.Deflate=V,h.exports.deflate=v,h.exports.deflateRaw=function(h,d){return(d=d||{}).raw=!0,v(h,d)},h.exports.gzip=function(h,d){return(d=d||{}).gzip=!0,v(h,d)},h.exports.constants=m(12107)},12128:(h,d,m)=>{"use strict";const j=m(12136),A=m(12111),b=m(12120),w=m(12103),a=m(12125),D=m(12161),S=Object.prototype.toString,{Z_NO_FLUSH:M,Z_FINISH:q,Z_OK:E,Z_STREAM_END:I,Z_NEED_DICT:R,Z_STREAM_ERROR:Z,Z_DATA_ERROR:L,Z_MEM_ERROR:B}=m(12107);function V(h){this.options=A.assign({Uh:65536,windowBits:15,to:""},h||{});const d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||h&&h.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0===(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.Bd="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let m=j.inflateInit2(this.strm,d.windowBits);if(m!==E)throw new Error(w[m]);if(this.header=new D,j.inflateGetHeader(this.strm,this.header),d.dictionary&&("string"===typeof d.dictionary?d.dictionary=b.string2buf(d.dictionary):"[object ArrayBuffer]"===S.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(m=j.inflateSetDictionary(this.strm,d.dictionary),m!==E)))throw new Error(w[m])}function v(h,d){const m=new V(d);if(m.push(h),m.err)throw m.Bd||w[m.err];return m.result}V.prototype.push=function(h,d){const m=this.strm,A=this.options.Uh,w=this.options.dictionary;let a,D,V;if(this.ended)return!1;for(D=d===~~d?d:!0===d?q:M,"[object ArrayBuffer]"===S.call(h)?m.input=new Uint8Array(h):m.input=h,m.next_in=0,m.avail_in=m.input.length;;){for(0===m.avail_out&&(m.output=new Uint8Array(A),m.next_out=0,m.avail_out=A),a=j.inflate(m,D),a===R&&w&&(a=j.inflateSetDictionary(m,w),a===E?a=j.inflate(m,D):a===L&&(a=R));m.avail_in>0&&a===I&&m.state.wrap>0&&0!==h[m.next_in];)j.inflateReset(m),a=j.inflate(m,D);switch(a){case Z:case L:case R:case B:return this.onEnd(a),this.ended=!0,!1}if(V=m.avail_out,m.next_out&&(0===m.avail_out||a===I))if("string"===this.options.to){let h=b.utf8border(m.output,m.next_out),d=m.next_out-h,j=b.buf2string(m.output,h);m.next_out=d,m.avail_out=A-d,d&&m.output.set(m.output.subarray(h,h+d),0),this.onData(j)}else this.onData(m.output.length===m.next_out?m.output:m.output.subarray(0,m.next_out));if(a!==E||0!==V){if(a===I)return a=j.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===m.avail_in)break}}return!0},V.prototype.onData=function(h){this.chunks.push(h)},V.prototype.onEnd=function(h){h===E&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.Bd=this.strm.Bd},h.exports.Inflate=V,h.exports.inflate=v,h.exports.inflateRaw=function(h,d){return(d=d||{}).raw=!0,v(h,d)},h.exports.ungzip=v,h.exports.constants=m(12107)},12111:h=>{"use strict";const d=(h,d)=>Object.prototype.hasOwnProperty.call(h,d);h.exports.assign=function(h){const m=Array.prototype.slice.call(arguments,1);for(;m.length;){const j=m.shift();if(j){if("object"!==typeof j)throw new TypeError(j+"must be non-object");for(const m in j)d(j,m)&&(h[m]=j[m])}}return h},h.exports.flattenChunks=h=>{let d=0;for(let j=0,A=h.length;j<A;j++)d+=h[j].length;const m=new Uint8Array(d);for(let j=0,A=0,b=h.length;j<b;j++){let d=h[j];m.set(d,A),A+=d.length}return m}},12120:h=>{"use strict";let d=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(j){d=!1}const m=new Uint8Array(256);for(let A=0;A<256;A++)m[A]=A>=252?6:A>=248?5:A>=240?4:A>=224?3:A>=192?2:1;m[254]=m[254]=1,h.exports.string2buf=h=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(h);let d,m,j,A,b,w=h.length,a=0;for(A=0;A<w;A++)m=h.charCodeAt(A),55296===(64512&m)&&A+1<w&&(j=h.charCodeAt(A+1),56320===(64512&j)&&(m=65536+(m-55296<<10)+(j-56320),A++)),a+=m<128?1:m<2048?2:m<65536?3:4;for(d=new Uint8Array(a),b=0,A=0;b<a;A++)m=h.charCodeAt(A),55296===(64512&m)&&A+1<w&&(j=h.charCodeAt(A+1),56320===(64512&j)&&(m=65536+(m-55296<<10)+(j-56320),A++)),m<128?d[b++]=m:m<2048?(d[b++]=192|m>>>6,d[b++]=128|63&m):m<65536?(d[b++]=224|m>>>12,d[b++]=128|m>>>6&63,d[b++]=128|63&m):(d[b++]=240|m>>>18,d[b++]=128|m>>>12&63,d[b++]=128|m>>>6&63,d[b++]=128|63&m);return d};h.exports.buf2string=(h,j)=>{const A=j||h.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(h.subarray(0,j));let b,w;const a=new Array(2*A);for(w=0,b=0;b<A;){let d=h[b++];if(d<128){a[w++]=d;continue}let j=m[d];if(j>4)a[w++]=65533,b+=j-1;else{for(d&=2===j?31:3===j?15:7;j>1&&b<A;)d=d<<6|63&h[b++],j--;j>1?a[w++]=65533:d<65536?a[w++]=d:(d-=65536,a[w++]=55296|d>>10&1023,a[w++]=56320|1023&d)}}return((h,m)=>{if(m<65534&&h.subarray&&d)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let j="";for(let d=0;d<m;d++)j+=String.fromCharCode(h[d]);return j})(a,w)},h.exports.utf8border=(h,d)=>{(d=d||h.length)>h.length&&(d=h.length);let j=d-1;for(;j>=0&&128===(192&h[j]);)j--;return j<0||0===j?d:j+m[h[j]]>d?j:d}},12091:h=>{"use strict";h.exports=(h,d,m,j)=>{let A=65535&h,b=h>>>16&65535,w=0;for(;0!==m;){w=m>2e3?2e3:m,m-=w;do{A=A+d[j++]|0,b=b+A|0}while(--w);A%=65521,b%=65521}return A|b<<16}},12107:h=>{"use strict";h.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12094:h=>{"use strict";const d=new Uint32Array((()=>{let h,d=[];for(var m=0;m<256;m++){h=m;for(var j=0;j<8;j++)h=1&h?3988292384^h>>>1:h>>>1;d[m]=h}return d})());h.exports=(h,m,j,A)=>{const b=d,w=A+j;h^=-1;for(let d=A;d<w;d++)h=h>>>8^b[255&(h^m[d])];return~h}},12085:(h,d,m)=>{"use strict";const{_tr_init:j,_tr_stored_block:A,_tr_flush_block:b,_tr_tally:w,_tr_align:a}=m(12087),D=m(12091),S=m(12094),M=m(12103),{Z_NO_FLUSH:q,Z_PARTIAL_FLUSH:E,Z_FULL_FLUSH:I,Z_FINISH:R,Z_BLOCK:Z,Z_OK:L,Z_STREAM_END:B,Z_STREAM_ERROR:V,Z_DATA_ERROR:v,Z_BUF_ERROR:C,Z_DEFAULT_COMPRESSION:T,Z_FILTERED:o,Z_HUFFMAN_ONLY:y,Z_RLE:i,Z_FIXED:g,Z_DEFAULT_STRATEGY:F,Z_UNKNOWN:f,Z_DEFLATED:H}=m(12107),c=258,k=262,l=103,K=113,N=666,W=(h,d)=>(h.Bd=M[d],d),r=h=>(h<<1)-(h>4?9:0),Y=h=>{let d=h.length;for(;--d>=0;)h[d]=0};let x=(h,d,m)=>(d<<h.hash_shift^m)&h.hash_mask;const Q=h=>{const d=h.state;let m=d.pending;m>h.avail_out&&(m=h.avail_out),0!==m&&(h.output.set(d.pending_buf.subarray(d.pending_out,d.pending_out+m),h.next_out),h.next_out+=m,d.pending_out+=m,h.total_out+=m,h.avail_out-=m,d.pending-=m,0===d.pending&&(d.pending_out=0))},t=(h,d)=>{b(h,h.block_start>=0?h.block_start:-1,h.strstart-h.block_start,d),h.block_start=h.strstart,Q(h.strm)},U=(h,d)=>{h.pending_buf[h.pending++]=d},s=(h,d)=>{h.pending_buf[h.pending++]=d>>>8&255,h.pending_buf[h.pending++]=255&d},J=(h,d,m,j)=>{let A=h.avail_in;return A>j&&(A=j),0===A?0:(h.avail_in-=A,d.set(h.input.subarray(h.next_in,h.next_in+A),m),1===h.state.wrap?h.adler=D(h.adler,d,A,m):2===h.state.wrap&&(h.adler=S(h.adler,d,A,m)),h.next_in+=A,h.total_in+=A,A)},O=(h,d)=>{let m,j,A=h.max_chain_length,b=h.strstart,w=h.prev_length,a=h.nice_match;const D=h.strstart>h.w_size-k?h.strstart-(h.w_size-k):0,S=h.window,M=h.w_mask,q=h.prev,E=h.strstart+c;let I=S[b+w-1],R=S[b+w];h.prev_length>=h.good_match&&(A>>=2),a>h.lookahead&&(a=h.lookahead);do{if(m=d,S[m+w]===R&&S[m+w-1]===I&&S[m]===S[b]&&S[++m]===S[b+1]){b+=2,m++;do{}while(S[++b]===S[++m]&&S[++b]===S[++m]&&S[++b]===S[++m]&&S[++b]===S[++m]&&S[++b]===S[++m]&&S[++b]===S[++m]&&S[++b]===S[++m]&&S[++b]===S[++m]&&b<E);if(j=c-(E-b),b=E-c,j>w){if(h.match_start=d,w=j,j>=a)break;I=S[b+w-1],R=S[b+w]}}}while((d=q[d&M])>D&&0!==--A);return w<=h.lookahead?w:h.lookahead},n=h=>{const d=h.w_size;let m,j,A,b,w;do{if(b=h.window_size-h.lookahead-h.strstart,h.strstart>=d+(d-k)){h.window.set(h.window.subarray(d,d+d),0),h.match_start-=d,h.strstart-=d,h.block_start-=d,j=h.hash_size,m=j;do{A=h.head[--m],h.head[m]=A>=d?A-d:0}while(--j);j=d,m=j;do{A=h.prev[--m],h.prev[m]=A>=d?A-d:0}while(--j);b+=d}if(0===h.strm.avail_in)break;if(j=J(h.strm,h.window,h.strstart+h.lookahead,b),h.lookahead+=j,h.lookahead+h.insert>=3)for(w=h.strstart-h.insert,h.ins_h=h.window[w],h.ins_h=x(h,h.ins_h,h.window[w+1]);h.insert&&(h.ins_h=x(h,h.ins_h,h.window[w+3-1]),h.prev[w&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=w,w++,h.insert--,!(h.lookahead+h.insert<3)););}while(h.lookahead<k&&0!==h.strm.avail_in)},p=(h,d)=>{let m,j;for(;;){if(h.lookahead<k){if(n(h),h.lookahead<k&&d===q)return 1;if(0===h.lookahead)break}if(m=0,h.lookahead>=3&&(h.ins_h=x(h,h.ins_h,h.window[h.strstart+3-1]),m=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),0!==m&&h.strstart-m<=h.w_size-k&&(h.match_length=O(h,m)),h.match_length>=3)if(j=w(h,h.strstart-h.match_start,h.match_length-3),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=3){h.match_length--;do{h.strstart++,h.ins_h=x(h,h.ins_h,h.window[h.strstart+3-1]),m=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart}while(0!==--h.match_length);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=x(h,h.ins_h,h.window[h.strstart+1]);else j=w(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(j&&(t(h,!1),0===h.strm.avail_out))return 1}return h.insert=h.strstart<2?h.strstart:2,d===R?(t(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(t(h,!1),0===h.strm.avail_out)?1:2},e=(h,d)=>{let m,j,A;for(;;){if(h.lookahead<k){if(n(h),h.lookahead<k&&d===q)return 1;if(0===h.lookahead)break}if(m=0,h.lookahead>=3&&(h.ins_h=x(h,h.ins_h,h.window[h.strstart+3-1]),m=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=2,0!==m&&h.prev_length<h.max_lazy_match&&h.strstart-m<=h.w_size-k&&(h.match_length=O(h,m),h.match_length<=5&&(h.strategy===o||3===h.match_length&&h.strstart-h.match_start>4096)&&(h.match_length=2)),h.prev_length>=3&&h.match_length<=h.prev_length){A=h.strstart+h.lookahead-3,j=w(h,h.strstart-1-h.prev_match,h.prev_length-3),h.lookahead-=h.prev_length-1,h.prev_length-=2;do{++h.strstart<=A&&(h.ins_h=x(h,h.ins_h,h.window[h.strstart+3-1]),m=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart)}while(0!==--h.prev_length);if(h.match_available=0,h.match_length=2,h.strstart++,j&&(t(h,!1),0===h.strm.avail_out))return 1}else if(h.match_available){if(j=w(h,0,h.window[h.strstart-1]),j&&t(h,!1),h.strstart++,h.lookahead--,0===h.strm.avail_out)return 1}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(j=w(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<2?h.strstart:2,d===R?(t(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(t(h,!1),0===h.strm.avail_out)?1:2};function X(h,d,m,j,A){this.good_length=h,this.max_lazy=d,this.nice_length=m,this.max_chain=j,this.func=A}const z=[new X(0,0,0,0,((h,d)=>{let m=65535;for(m>h.pending_buf_size-5&&(m=h.pending_buf_size-5);;){if(h.lookahead<=1){if(n(h),0===h.lookahead&&d===q)return 1;if(0===h.lookahead)break}h.strstart+=h.lookahead,h.lookahead=0;const j=h.block_start+m;if((0===h.strstart||h.strstart>=j)&&(h.lookahead=h.strstart-j,h.strstart=j,t(h,!1),0===h.strm.avail_out))return 1;if(h.strstart-h.block_start>=h.w_size-k&&(t(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,d===R?(t(h,!0),0===h.strm.avail_out?3:4):(h.strstart>h.block_start&&(t(h,!1),h.strm.avail_out),1)})),new X(4,4,8,4,p),new X(4,5,16,8,p),new X(4,6,32,32,p),new X(4,4,16,16,e),new X(8,16,32,32,e),new X(8,16,128,128,e),new X(8,32,128,256,e),new X(32,128,258,1024,e),new X(32,258,258,4096,e)];function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=H,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const P=h=>{if(!h||!h.state)return W(h,V);h.total_in=h.total_out=0,h.data_type=f;const d=h.state;return d.pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?42:K,h.adler=2===d.wrap?0:1,d.last_flush=q,j(d),L},G=h=>{const d=P(h);var m;return d===L&&((m=h.state).window_size=2*m.w_size,Y(m.head),m.max_lazy_match=z[m.level].max_lazy,m.good_match=z[m.level].good_length,m.nice_match=z[m.level].nice_length,m.max_chain_length=z[m.level].max_chain,m.strstart=0,m.block_start=0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,m.match_available=0,m.ins_h=0),d},hh=(h,d,m,j,A,b)=>{if(!h)return V;let w=1;if(d===T&&(d=6),j<0?(w=0,j=-j):j>15&&(w=2,j-=16),A<1||A>9||m!==H||j<8||j>15||d<0||d>9||b<0||b>g)return W(h,V);8===j&&(j=9);const a=new u;return h.state=a,a.strm=h,a.wrap=w,a.gzhead=null,a.w_bits=j,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=A+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<A+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=d,a.strategy=b,a.method=m,G(h)};h.exports.deflateInit=(h,d)=>hh(h,d,H,15,8,F),h.exports.deflateInit2=hh,h.exports.deflateReset=G,h.exports.deflateResetKeep=P,h.exports.deflateSetHeader=(h,d)=>h&&h.state?2!==h.state.wrap?V:(h.state.gzhead=d,L):V,h.exports.deflate=(h,d)=>{let m,j;if(!h||!h.state||d>Z||d<0)return h?W(h,V):V;const b=h.state;if(!h.output||!h.input&&0!==h.avail_in||b.status===N&&d!==R)return W(h,0===h.avail_out?C:V);b.strm=h;const D=b.last_flush;if(b.last_flush=d,42===b.status)if(2===b.wrap)h.adler=0,U(b,31),U(b,139),U(b,8),b.gzhead?(U(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),U(b,255&b.gzhead.time),U(b,b.gzhead.time>>8&255),U(b,b.gzhead.time>>16&255),U(b,b.gzhead.time>>24&255),U(b,9===b.level?2:b.strategy>=y||b.level<2?4:0),U(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(U(b,255&b.gzhead.extra.length),U(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(h.adler=S(h.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(U(b,0),U(b,0),U(b,0),U(b,0),U(b,0),U(b,9===b.level?2:b.strategy>=y||b.level<2?4:0),U(b,3),b.status=K);else{let d=H+(b.w_bits-8<<4)<<8,m=-1;m=b.strategy>=y||b.level<2?0:b.level<6?1:6===b.level?2:3,d|=m<<6,0!==b.strstart&&(d|=32),d+=31-d%31,b.status=K,s(b,d),0!==b.strstart&&(s(b,h.adler>>>16),s(b,65535&h.adler)),h.adler=1}if(69===b.status)if(b.gzhead.extra){for(m=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>m&&(h.adler=S(h.adler,b.pending_buf,b.pending-m,m)),Q(h),m=b.pending,b.pending!==b.pending_buf_size));)U(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>m&&(h.adler=S(h.adler,b.pending_buf,b.pending-m,m)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){m=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>m&&(h.adler=S(h.adler,b.pending_buf,b.pending-m,m)),Q(h),m=b.pending,b.pending===b.pending_buf_size)){j=1;break}j=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,U(b,j)}while(0!==j);b.gzhead.hcrc&&b.pending>m&&(h.adler=S(h.adler,b.pending_buf,b.pending-m,m)),0===j&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){m=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>m&&(h.adler=S(h.adler,b.pending_buf,b.pending-m,m)),Q(h),m=b.pending,b.pending===b.pending_buf_size)){j=1;break}j=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,U(b,j)}while(0!==j);b.gzhead.hcrc&&b.pending>m&&(h.adler=S(h.adler,b.pending_buf,b.pending-m,m)),0===j&&(b.status=l)}else b.status=l;if(b.status===l&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&Q(h),b.pending+2<=b.pending_buf_size&&(U(b,255&h.adler),U(b,h.adler>>8&255),h.adler=0,b.status=K)):b.status=K),0!==b.pending){if(Q(h),0===h.avail_out)return b.last_flush=-1,L}else if(0===h.avail_in&&r(d)<=r(D)&&d!==R)return W(h,C);if(b.status===N&&0!==h.avail_in)return W(h,C);if(0!==h.avail_in||0!==b.lookahead||d!==q&&b.status!==N){let m=b.strategy===y?((h,d)=>{let m;for(;;){if(0===h.lookahead&&(n(h),0===h.lookahead)){if(d===q)return 1;break}if(h.match_length=0,m=w(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++,m&&(t(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,d===R?(t(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(t(h,!1),0===h.strm.avail_out)?1:2})(b,d):b.strategy===i?((h,d)=>{let m,j,A,b;const a=h.window;for(;;){if(h.lookahead<=c){if(n(h),h.lookahead<=c&&d===q)return 1;if(0===h.lookahead)break}if(h.match_length=0,h.lookahead>=3&&h.strstart>0&&(A=h.strstart-1,j=a[A],j===a[++A]&&j===a[++A]&&j===a[++A])){b=h.strstart+c;do{}while(j===a[++A]&&j===a[++A]&&j===a[++A]&&j===a[++A]&&j===a[++A]&&j===a[++A]&&j===a[++A]&&j===a[++A]&&A<b);h.match_length=c-(b-A),h.match_length>h.lookahead&&(h.match_length=h.lookahead)}if(h.match_length>=3?(m=w(h,1,h.match_length-3),h.lookahead-=h.match_length,h.strstart+=h.match_length,h.match_length=0):(m=w(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++),m&&(t(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,d===R?(t(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(t(h,!1),0===h.strm.avail_out)?1:2})(b,d):z[b.level].func(b,d);if(3!==m&&4!==m||(b.status=N),1===m||3===m)return 0===h.avail_out&&(b.last_flush=-1),L;if(2===m&&(d===E?a(b):d!==Z&&(A(b,0,0,!1),d===I&&(Y(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),Q(h),0===h.avail_out))return b.last_flush=-1,L}return d!==R?L:b.wrap<=0?B:(2===b.wrap?(U(b,255&h.adler),U(b,h.adler>>8&255),U(b,h.adler>>16&255),U(b,h.adler>>24&255),U(b,255&h.total_in),U(b,h.total_in>>8&255),U(b,h.total_in>>16&255),U(b,h.total_in>>24&255)):(s(b,h.adler>>>16),s(b,65535&h.adler)),Q(h),b.wrap>0&&(b.wrap=-b.wrap),0!==b.pending?L:B)},h.exports.deflateEnd=h=>{if(!h||!h.state)return V;const d=h.state.status;return 42!==d&&69!==d&&73!==d&&91!==d&&d!==l&&d!==K&&d!==N?W(h,V):(h.state=null,d===K?W(h,v):L)},h.exports.deflateSetDictionary=(h,d)=>{let m=d.length;if(!h||!h.state)return V;const j=h.state,A=j.wrap;if(2===A||1===A&&42!==j.status||j.lookahead)return V;if(1===A&&(h.adler=D(h.adler,d,m,0)),j.wrap=0,m>=j.w_size){0===A&&(Y(j.head),j.strstart=0,j.block_start=0,j.insert=0);let h=new Uint8Array(j.w_size);h.set(d.subarray(m-j.w_size,m),0),d=h,m=j.w_size}const b=h.avail_in,w=h.next_in,a=h.input;for(h.avail_in=m,h.next_in=0,h.input=d,n(j);j.lookahead>=3;){let h=j.strstart,d=j.lookahead-2;do{j.ins_h=x(j,j.ins_h,j.window[h+3-1]),j.prev[h&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=h,h++}while(--d);j.strstart=h,j.lookahead=2,n(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=2,j.match_available=0,h.next_in=w,h.input=a,h.avail_in=b,j.wrap=A,L},h.exports.deflateInfo="pako deflate (from Nodeca project)"},12161:h=>{"use strict";h.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12145:h=>{"use strict";h.exports=function(h,d){let m,j,A,b,w,a,D,S,M,q,E,I,R,Z,L,B,V,v,C,T,o,y,i,g;const F=h.state;m=h.next_in,i=h.input,j=m+(h.avail_in-5),A=h.next_out,g=h.output,b=A-(d-h.avail_out),w=A+(h.avail_out-257),a=F.dmax,D=F.wsize,S=F.whave,M=F.wnext,q=F.window,E=F.hold,I=F.bits,R=F.lencode,Z=F.distcode,L=(1<<F.lenbits)-1,B=(1<<F.distbits)-1;h:do{I<15&&(E+=i[m++]<<I,I+=8,E+=i[m++]<<I,I+=8),V=R[E&L];d:for(;;){if(v=V>>>24,E>>>=v,I-=v,v=V>>>16&255,0===v)g[A++]=65535&V;else{if(!(16&v)){if(0===(64&v)){V=R[(65535&V)+(E&(1<<v)-1)];continue d}if(32&v){F.mode=12;break h}h.Bd="invalid literal/length code",F.mode=30;break h}C=65535&V,v&=15,v&&(I<v&&(E+=i[m++]<<I,I+=8),C+=E&(1<<v)-1,E>>>=v,I-=v),I<15&&(E+=i[m++]<<I,I+=8,E+=i[m++]<<I,I+=8),V=Z[E&B];m:for(;;){if(v=V>>>24,E>>>=v,I-=v,v=V>>>16&255,!(16&v)){if(0===(64&v)){V=Z[(65535&V)+(E&(1<<v)-1)];continue m}h.Bd="invalid distance code",F.mode=30;break h}if(T=65535&V,v&=15,I<v&&(E+=i[m++]<<I,I+=8,I<v&&(E+=i[m++]<<I,I+=8)),T+=E&(1<<v)-1,T>a){h.Bd="invalid distance too far back",F.mode=30;break h}if(E>>>=v,I-=v,v=A-b,T>v){if(v=T-v,v>S&&F.sane){h.Bd="invalid distance too far back",F.mode=30;break h}if(o=0,y=q,0===M){if(o+=D-v,v<C){C-=v;do{g[A++]=q[o++]}while(--v);o=A-T,y=g}}else if(M<v){if(o+=D+M-v,v-=M,v<C){C-=v;do{g[A++]=q[o++]}while(--v);if(o=0,M<C){v=M,C-=v;do{g[A++]=q[o++]}while(--v);o=A-T,y=g}}}else if(o+=M-v,v<C){C-=v;do{g[A++]=q[o++]}while(--v);o=A-T,y=g}for(;C>2;)g[A++]=y[o++],g[A++]=y[o++],g[A++]=y[o++],C-=3;C&&(g[A++]=y[o++],C>1&&(g[A++]=y[o++]))}else{o=A-T;do{g[A++]=g[o++],g[A++]=g[o++],g[A++]=g[o++],C-=3}while(C>2);C&&(g[A++]=g[o++],C>1&&(g[A++]=g[o++]))}break}}break}}while(m<j&&A<w);C=I>>3,m-=C,I-=C<<3,E&=(1<<I)-1,h.next_in=m,h.next_out=A,h.avail_in=m<j?j-m+5:5-(m-j),h.avail_out=A<w?w-A+257:257-(A-w),F.hold=E,F.bits=I}},12136:(h,d,m)=>{"use strict";const j=m(12091),A=m(12094),b=m(12145),w=m(12152),{Z_FINISH:a,Z_BLOCK:D,Z_TREES:S,Z_OK:M,Z_STREAM_END:q,Z_NEED_DICT:E,Z_STREAM_ERROR:I,Z_DATA_ERROR:R,Z_MEM_ERROR:Z,Z_BUF_ERROR:L,Z_DEFLATED:B}=m(12107),V=12,v=30,C=h=>(h>>>24&255)+(h>>>8&65280)+((65280&h)<<8)+((255&h)<<24);function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const o=h=>{if(!h||!h.state)return I;const d=h.state;return h.total_in=h.total_out=d.total=0,h.Bd="",d.wrap&&(h.adler=1&d.wrap),d.mode=1,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new Int32Array(852),d.distcode=d.distdyn=new Int32Array(592),d.sane=1,d.back=-1,M},y=h=>{if(!h||!h.state)return I;const d=h.state;return d.wsize=0,d.whave=0,d.wnext=0,o(h)},i=(h,d)=>{let m;if(!h||!h.state)return I;const j=h.state;return d<0?(m=0,d=-d):(m=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?I:(null!==j.window&&j.wbits!==d&&(j.window=null),j.wrap=m,j.wbits=d,y(h))},g=(h,d)=>{if(!h)return I;const m=new T;h.state=m,m.window=null;const j=i(h,d);return j!==M&&(h.state=null),j};let F,f,H=!0;const c=h=>{if(H){F=new Int32Array(512),f=new Int32Array(32);let d=0;for(;d<144;)h.lens[d++]=8;for(;d<256;)h.lens[d++]=9;for(;d<280;)h.lens[d++]=7;for(;d<288;)h.lens[d++]=8;for(w(1,h.lens,0,288,F,0,h.work,{bits:9}),d=0;d<32;)h.lens[d++]=5;w(2,h.lens,0,32,f,0,h.work,{bits:5}),H=!1}h.lencode=F,h.lenbits=9,h.distcode=f,h.distbits=5},k=(h,d,m,j)=>{let A;const b=h.state;return null===b.window&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new Uint8Array(b.wsize)),j>=b.wsize?(b.window.set(d.subarray(m-b.wsize,m),0),b.wnext=0,b.whave=b.wsize):(A=b.wsize-b.wnext,A>j&&(A=j),b.window.set(d.subarray(m-j,m-j+A),b.wnext),(j-=A)?(b.window.set(d.subarray(m-j,m),0),b.wnext=j,b.whave=b.wsize):(b.wnext+=A,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=A))),0};h.exports.inflateReset=y,h.exports.inflateReset2=i,h.exports.inflateResetKeep=o,h.exports.inflateInit=h=>g(h,15),h.exports.inflateInit2=g,h.exports.inflate=(h,d)=>{let m,T,o,y,i,g,F,f,H,l,K,N,W,r,Y,x,Q,t,U,s,J,O,n=0;const p=new Uint8Array(4);let e,X;const z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!h||!h.state||!h.output||!h.input&&0!==h.avail_in)return I;m=h.state,m.mode===V&&(m.mode=13),i=h.next_out,o=h.output,F=h.avail_out,y=h.next_in,T=h.input,g=h.avail_in,f=m.hold,H=m.bits,l=g,K=F,O=M;h:for(;;)switch(m.mode){case 1:if(0===m.wrap){m.mode=13;break}for(;H<16;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(2&m.wrap&&35615===f){m.check=0,p[0]=255&f,p[1]=f>>>8&255,m.check=A(m.check,p,2,0),f=0,H=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&f)<<8)+(f>>8))%31){h.Bd="incorrect header check",m.mode=v;break}if((15&f)!==B){h.Bd="unknown compression method",m.mode=v;break}if(f>>>=4,H-=4,J=8+(15&f),0===m.wbits)m.wbits=J;else if(J>m.wbits){h.Bd="invalid window size",m.mode=v;break}m.dmax=1<<m.wbits,h.adler=m.check=1,m.mode=512&f?10:V,f=0,H=0;break;case 2:for(;H<16;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(m.flags=f,(255&m.flags)!==B){h.Bd="unknown compression method",m.mode=v;break}if(57344&m.flags){h.Bd="unknown header flags set",m.mode=v;break}m.head&&(m.head.text=f>>8&1),512&m.flags&&(p[0]=255&f,p[1]=f>>>8&255,m.check=A(m.check,p,2,0)),f=0,H=0,m.mode=3;case 3:for(;H<32;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}m.head&&(m.head.time=f),512&m.flags&&(p[0]=255&f,p[1]=f>>>8&255,p[2]=f>>>16&255,p[3]=f>>>24&255,m.check=A(m.check,p,4,0)),f=0,H=0,m.mode=4;case 4:for(;H<16;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}m.head&&(m.head.xflags=255&f,m.head.os=f>>8),512&m.flags&&(p[0]=255&f,p[1]=f>>>8&255,m.check=A(m.check,p,2,0)),f=0,H=0,m.mode=5;case 5:if(1024&m.flags){for(;H<16;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}m.length=f,m.head&&(m.head.extra_len=f),512&m.flags&&(p[0]=255&f,p[1]=f>>>8&255,m.check=A(m.check,p,2,0)),f=0,H=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&(N=m.length,N>g&&(N=g),N&&(m.head&&(J=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Uint8Array(m.head.extra_len)),m.head.extra.set(T.subarray(y,y+N),J)),512&m.flags&&(m.check=A(m.check,T,N,y)),g-=N,y+=N,m.length-=N),m.length))break h;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(0===g)break h;N=0;do{J=T[y+N++],m.head&&J&&m.length<65536&&(m.head.name+=String.fromCharCode(J))}while(J&&N<g);if(512&m.flags&&(m.check=A(m.check,T,N,y)),g-=N,y+=N,J)break h}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(0===g)break h;N=0;do{J=T[y+N++],m.head&&J&&m.length<65536&&(m.head.comment+=String.fromCharCode(J))}while(J&&N<g);if(512&m.flags&&(m.check=A(m.check,T,N,y)),g-=N,y+=N,J)break h}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;H<16;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(f!==(65535&m.check)){h.Bd="header crc mismatch",m.mode=v;break}f=0,H=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),h.adler=m.check=0,m.mode=V;break;case 10:for(;H<32;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}h.adler=m.check=C(f),f=0,H=0,m.mode=11;case 11:if(0===m.havedict)return h.next_out=i,h.avail_out=F,h.next_in=y,h.avail_in=g,m.hold=f,m.bits=H,E;h.adler=m.check=1,m.mode=V;case V:if(d===D||d===S)break h;case 13:if(m.last){f>>>=7&H,H-=7&H,m.mode=27;break}for(;H<3;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}switch(m.last=1&f,f>>>=1,H-=1,3&f){case 0:m.mode=14;break;case 1:if(c(m),m.mode=20,d===S){f>>>=2,H-=2;break h}break;case 2:m.mode=17;break;case 3:h.Bd="invalid block type",m.mode=v}f>>>=2,H-=2;break;case 14:for(f>>>=7&H,H-=7&H;H<32;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if((65535&f)!==(f>>>16^65535)){h.Bd="invalid stored block lengths",m.mode=v;break}if(m.length=65535&f,f=0,H=0,m.mode=15,d===S)break h;case 15:m.mode=16;case 16:if(N=m.length,N){if(N>g&&(N=g),N>F&&(N=F),0===N)break h;o.set(T.subarray(y,y+N),i),g-=N,y+=N,F-=N,i+=N,m.length-=N;break}m.mode=V;break;case 17:for(;H<14;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(m.nlen=257+(31&f),f>>>=5,H-=5,m.ndist=1+(31&f),f>>>=5,H-=5,m.ncode=4+(15&f),f>>>=4,H-=4,m.nlen>286||m.ndist>30){h.Bd="too many length or distance symbols",m.mode=v;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;H<3;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}m.lens[z[m.have++]]=7&f,f>>>=3,H-=3}for(;m.have<19;)m.lens[z[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,e={bits:m.lenbits},O=w(0,m.lens,0,19,m.lencode,0,m.work,e),m.lenbits=e.bits,O){h.Bd="invalid code lengths set",m.mode=v;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;n=m.lencode[f&(1<<m.lenbits)-1],Y=n>>>24,x=n>>>16&255,Q=65535&n,!(Y<=H);){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(Q<16)f>>>=Y,H-=Y,m.lens[m.have++]=Q;else{if(16===Q){for(X=Y+2;H<X;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(f>>>=Y,H-=Y,0===m.have){h.Bd="invalid bit length repeat",m.mode=v;break}J=m.lens[m.have-1],N=3+(3&f),f>>>=2,H-=2}else if(17===Q){for(X=Y+3;H<X;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}f>>>=Y,H-=Y,J=0,N=3+(7&f),f>>>=3,H-=3}else{for(X=Y+7;H<X;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}f>>>=Y,H-=Y,J=0,N=11+(127&f),f>>>=7,H-=7}if(m.have+N>m.nlen+m.ndist){h.Bd="invalid bit length repeat",m.mode=v;break}for(;N--;)m.lens[m.have++]=J}}if(m.mode===v)break;if(0===m.lens[256]){h.Bd="invalid code -- missing end-of-block",m.mode=v;break}if(m.lenbits=9,e={bits:m.lenbits},O=w(1,m.lens,0,m.nlen,m.lencode,0,m.work,e),m.lenbits=e.bits,O){h.Bd="invalid literal/lengths set",m.mode=v;break}if(m.distbits=6,m.distcode=m.distdyn,e={bits:m.distbits},O=w(2,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,e),m.distbits=e.bits,O){h.Bd="invalid distances set",m.mode=v;break}if(m.mode=20,d===S)break h;case 20:m.mode=21;case 21:if(g>=6&&F>=258){h.next_out=i,h.avail_out=F,h.next_in=y,h.avail_in=g,m.hold=f,m.bits=H,b(h,K),i=h.next_out,o=h.output,F=h.avail_out,y=h.next_in,T=h.input,g=h.avail_in,f=m.hold,H=m.bits,m.mode===V&&(m.back=-1);break}for(m.back=0;n=m.lencode[f&(1<<m.lenbits)-1],Y=n>>>24,x=n>>>16&255,Q=65535&n,!(Y<=H);){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(x&&0===(240&x)){for(t=Y,U=x,s=Q;n=m.lencode[s+((f&(1<<t+U)-1)>>t)],Y=n>>>24,x=n>>>16&255,Q=65535&n,!(t+Y<=H);){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}f>>>=t,H-=t,m.back+=t}if(f>>>=Y,H-=Y,m.back+=Y,m.length=Q,0===x){m.mode=26;break}if(32&x){m.back=-1,m.mode=V;break}if(64&x){h.Bd="invalid literal/length code",m.mode=v;break}m.extra=15&x,m.mode=22;case 22:if(m.extra){for(X=m.extra;H<X;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}m.length+=f&(1<<m.extra)-1,f>>>=m.extra,H-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;n=m.distcode[f&(1<<m.distbits)-1],Y=n>>>24,x=n>>>16&255,Q=65535&n,!(Y<=H);){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(0===(240&x)){for(t=Y,U=x,s=Q;n=m.distcode[s+((f&(1<<t+U)-1)>>t)],Y=n>>>24,x=n>>>16&255,Q=65535&n,!(t+Y<=H);){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}f>>>=t,H-=t,m.back+=t}if(f>>>=Y,H-=Y,m.back+=Y,64&x){h.Bd="invalid distance code",m.mode=v;break}m.offset=Q,m.extra=15&x,m.mode=24;case 24:if(m.extra){for(X=m.extra;H<X;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}m.offset+=f&(1<<m.extra)-1,f>>>=m.extra,H-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){h.Bd="invalid distance too far back",m.mode=v;break}m.mode=25;case 25:if(0===F)break h;if(N=K-F,m.offset>N){if(N=m.offset-N,N>m.whave&&m.sane){h.Bd="invalid distance too far back",m.mode=v;break}N>m.wnext?(N-=m.wnext,W=m.wsize-N):W=m.wnext-N,N>m.length&&(N=m.length),r=m.window}else r=o,W=i-m.offset,N=m.length;N>F&&(N=F),F-=N,m.length-=N;do{o[i++]=r[W++]}while(--N);0===m.length&&(m.mode=21);break;case 26:if(0===F)break h;o[i++]=m.length,F--,m.mode=21;break;case 27:if(m.wrap){for(;H<32;){if(0===g)break h;g--,f|=T[y++]<<H,H+=8}if(K-=F,h.total_out+=K,m.total+=K,K&&(h.adler=m.check=m.flags?A(m.check,o,K,i-K):j(m.check,o,K,i-K)),K=F,(m.flags?f:C(f))!==m.check){h.Bd="incorrect data check",m.mode=v;break}f=0,H=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;H<32;){if(0===g)break h;g--,f+=T[y++]<<H,H+=8}if(f!==(4294967295&m.total)){h.Bd="incorrect length check",m.mode=v;break}f=0,H=0}m.mode=29;case 29:O=q;break h;case v:O=R;break h;case 31:return Z;default:return I}return h.next_out=i,h.avail_out=F,h.next_in=y,h.avail_in=g,m.hold=f,m.bits=H,(m.wsize||K!==h.avail_out&&m.mode<v&&(m.mode<27||d!==a))&&k(h,h.output,h.next_out,K-h.avail_out)?(m.mode=31,Z):(l-=h.avail_in,K-=h.avail_out,h.total_in+=l,h.total_out+=K,m.total+=K,m.wrap&&K&&(h.adler=m.check=m.flags?A(m.check,o,K,h.next_out-K):j(m.check,o,K,h.next_out-K)),h.data_type=m.bits+(m.last?64:0)+(m.mode===V?128:0)+(20===m.mode||15===m.mode?256:0),(0===l&&0===K||d===a)&&O===M&&(O=L),O)},h.exports.inflateEnd=h=>{if(!h||!h.state)return I;let d=h.state;return d.window&&(d.window=null),h.state=null,M},h.exports.inflateGetHeader=(h,d)=>{if(!h||!h.state)return I;const m=h.state;return 0===(2&m.wrap)?I:(m.head=d,d.done=!1,M)},h.exports.inflateSetDictionary=(h,d)=>{const m=d.length;let A,b,w;return h&&h.state?(A=h.state,0!==A.wrap&&11!==A.mode?I:11===A.mode&&(b=1,b=j(b,d,m,0),b!==A.check)?R:(w=k(h,d,m,m),w?(A.mode=31,Z):(A.havedict=1,M))):I},h.exports.inflateInfo="pako inflate (from Nodeca project)"},12152:h=>{"use strict";const d=15,m=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),j=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),A=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),b=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);h.exports=(h,w,a,D,S,M,q,E)=>{const I=E.bits;let R,Z,L,B,V,v,C=0,T=0,o=0,y=0,i=0,g=0,F=0,f=0,H=0,c=0,k=null,l=0;const K=new Uint16Array(16),N=new Uint16Array(16);let W,r,Y,x=null,Q=0;for(C=0;C<=d;C++)K[C]=0;for(T=0;T<D;T++)K[w[a+T]]++;for(i=I,y=d;y>=1&&0===K[y];y--);if(i>y&&(i=y),0===y)return S[M++]=20971520,S[M++]=20971520,E.bits=1,0;for(o=1;o<y&&0===K[o];o++);for(i<o&&(i=o),f=1,C=1;C<=d;C++)if(f<<=1,f-=K[C],f<0)return-1;if(f>0&&(0===h||1!==y))return-1;for(N[1]=0,C=1;C<d;C++)N[C+1]=N[C]+K[C];for(T=0;T<D;T++)0!==w[a+T]&&(q[N[w[a+T]]++]=T);if(0===h?(k=x=q,v=19):1===h?(k=m,l-=257,x=j,Q-=257,v=256):(k=A,x=b,v=-1),c=0,T=0,C=o,V=M,g=i,F=0,L=-1,H=1<<i,B=H-1,1===h&&H>852||2===h&&H>592)return 1;for(;;){W=C-F,q[T]<v?(r=0,Y=q[T]):q[T]>v?(r=x[Q+q[T]],Y=k[l+q[T]]):(r=96,Y=0),R=1<<C-F,Z=1<<g,o=Z;do{Z-=R,S[V+(c>>F)+Z]=W<<24|r<<16|Y}while(0!==Z);for(R=1<<C-1;c&R;)R>>=1;if(0!==R?(c&=R-1,c+=R):c=0,T++,0===--K[C]){if(C===y)break;C=w[a+q[T]]}if(C>i&&(c&B)!==L){for(0===F&&(F=i),V+=o,g=C-F,f=1<<g;g+F<y&&(f-=K[g+F],!(f<=0));)g++,f<<=1;if(H+=1<<g,1===h&&H>852||2===h&&H>592)return 1;L=c&B,S[L]=i<<24|g<<16|V-M}}return 0!==c&&(S[V+c]=C-F<<24|64<<16),E.bits=i,0}},12103:h=>{"use strict";h.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12087:h=>{"use strict";function d(h){let d=h.length;for(;--d>=0;)h[d]=0}const m=256,j=286,A=30,b=15,w=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),D=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=new Array(576);d(M);const q=new Array(60);d(q);const E=new Array(512);d(E);const I=new Array(256);d(I);const R=new Array(29);d(R);const Z=new Array(A);function L(h,d,m,j,A){this.static_tree=h,this.extra_bits=d,this.extra_base=m,this.elems=j,this.max_length=A,this.has_stree=h&&h.length}let B,V,v;function C(h,d){this.dyn_tree=h,this.max_code=0,this.stat_desc=d}d(Z);const T=h=>h<256?E[h]:E[256+(h>>>7)],o=(h,d)=>{h.pending_buf[h.pending++]=255&d,h.pending_buf[h.pending++]=d>>>8&255},y=(h,d,m)=>{h.bi_valid>16-m?(h.bi_buf|=d<<h.bi_valid&65535,o(h,h.bi_buf),h.bi_buf=d>>16-h.bi_valid,h.bi_valid+=m-16):(h.bi_buf|=d<<h.bi_valid&65535,h.bi_valid+=m)},i=(h,d,m)=>{y(h,m[2*d],m[2*d+1])},g=(h,d)=>{let m=0;do{m|=1&h,h>>>=1,m<<=1}while(--d>0);return m>>>1},F=(h,d,m)=>{const j=new Array(16);let A,w,a=0;for(A=1;A<=b;A++)j[A]=a=a+m[A-1]<<1;for(w=0;w<=d;w++){let d=h[2*w+1];0!==d&&(h[2*w]=g(j[d]++,d))}},f=h=>{let d;for(d=0;d<j;d++)h.dyn_ltree[2*d]=0;for(d=0;d<A;d++)h.dyn_dtree[2*d]=0;for(d=0;d<19;d++)h.bl_tree[2*d]=0;h.dyn_ltree[512]=1,h.opt_len=h.static_len=0,h.last_lit=h.matches=0},H=h=>{h.bi_valid>8?o(h,h.bi_buf):h.bi_valid>0&&(h.pending_buf[h.pending++]=h.bi_buf),h.bi_buf=0,h.bi_valid=0},c=(h,d,m,j)=>{const A=2*d,b=2*m;return h[A]<h[b]||h[A]===h[b]&&j[d]<=j[m]},k=(h,d,m)=>{const j=h.heap[m];let A=m<<1;for(;A<=h.heap_len&&(A<h.heap_len&&c(d,h.heap[A+1],h.heap[A],h.depth)&&A++,!c(d,j,h.heap[A],h.depth));)h.heap[m]=h.heap[A],m=A,A<<=1;h.heap[m]=j},l=(h,d,j)=>{let A,b,D,S,M=0;if(0!==h.last_lit)do{A=h.pending_buf[h.d_buf+2*M]<<8|h.pending_buf[h.d_buf+2*M+1],b=h.pending_buf[h.l_buf+M],M++,0===A?i(h,b,d):(D=I[b],i(h,D+m+1,d),S=w[D],0!==S&&(b-=R[D],y(h,b,S)),A--,D=T(A),i(h,D,j),S=a[D],0!==S&&(A-=Z[D],y(h,A,S)))}while(M<h.last_lit);i(h,256,d)},K=(h,d)=>{const m=d.dyn_tree,j=d.stat_desc.static_tree,A=d.stat_desc.has_stree,w=d.stat_desc.elems;let a,D,S,M=-1;for(h.heap_len=0,h.heap_max=573,a=0;a<w;a++)0!==m[2*a]?(h.heap[++h.heap_len]=M=a,h.depth[a]=0):m[2*a+1]=0;for(;h.heap_len<2;)S=h.heap[++h.heap_len]=M<2?++M:0,m[2*S]=1,h.depth[S]=0,h.opt_len--,A&&(h.static_len-=j[2*S+1]);for(d.max_code=M,a=h.heap_len>>1;a>=1;a--)k(h,m,a);S=w;do{a=h.heap[1],h.heap[1]=h.heap[h.heap_len--],k(h,m,1),D=h.heap[1],h.heap[--h.heap_max]=a,h.heap[--h.heap_max]=D,m[2*S]=m[2*a]+m[2*D],h.depth[S]=(h.depth[a]>=h.depth[D]?h.depth[a]:h.depth[D])+1,m[2*a+1]=m[2*D+1]=S,h.heap[1]=S++,k(h,m,1)}while(h.heap_len>=2);h.heap[--h.heap_max]=h.heap[1],((h,d)=>{const m=d.dyn_tree,j=d.max_code,A=d.stat_desc.static_tree,w=d.stat_desc.has_stree,a=d.stat_desc.extra_bits,D=d.stat_desc.extra_base,S=d.stat_desc.max_length;let M,q,E,I,R,Z,L=0;for(I=0;I<=b;I++)h.bl_count[I]=0;for(m[2*h.heap[h.heap_max]+1]=0,M=h.heap_max+1;M<573;M++)q=h.heap[M],I=m[2*m[2*q+1]+1]+1,I>S&&(I=S,L++),m[2*q+1]=I,q>j||(h.bl_count[I]++,R=0,q>=D&&(R=a[q-D]),Z=m[2*q],h.opt_len+=Z*(I+R),w&&(h.static_len+=Z*(A[2*q+1]+R)));if(0!==L){do{for(I=S-1;0===h.bl_count[I];)I--;h.bl_count[I]--,h.bl_count[I+1]+=2,h.bl_count[S]--,L-=2}while(L>0);for(I=S;0!==I;I--)for(q=h.bl_count[I];0!==q;)E=h.heap[--M],E>j||(m[2*E+1]!==I&&(h.opt_len+=(I-m[2*E+1])*m[2*E],m[2*E+1]=I),q--)}})(h,d),F(m,M,h.bl_count)},N=(h,d,m)=>{let j,A,b=-1,w=d[1],a=0,D=7,S=4;for(0===w&&(D=138,S=3),d[2*(m+1)+1]=65535,j=0;j<=m;j++)A=w,w=d[2*(j+1)+1],++a<D&&A===w||(a<S?h.bl_tree[2*A]+=a:0!==A?(A!==b&&h.bl_tree[2*A]++,h.bl_tree[32]++):a<=10?h.bl_tree[34]++:h.bl_tree[36]++,a=0,b=A,0===w?(D=138,S=3):A===w?(D=6,S=3):(D=7,S=4))},W=(h,d,m)=>{let j,A,b=-1,w=d[1],a=0,D=7,S=4;for(0===w&&(D=138,S=3),j=0;j<=m;j++)if(A=w,w=d[2*(j+1)+1],!(++a<D&&A===w)){if(a<S)do{i(h,A,h.bl_tree)}while(0!==--a);else 0!==A?(A!==b&&(i(h,A,h.bl_tree),a--),i(h,16,h.bl_tree),y(h,a-3,2)):a<=10?(i(h,17,h.bl_tree),y(h,a-3,3)):(i(h,18,h.bl_tree),y(h,a-11,7));a=0,b=A,0===w?(D=138,S=3):A===w?(D=6,S=3):(D=7,S=4)}};let r=!1;const Y=(h,d,m,j)=>{y(h,0+(j?1:0),3),((h,d,m,j)=>{H(h),j&&(o(h,m),o(h,~m)),h.pending_buf.set(h.window.subarray(d,d+m),h.pending),h.pending+=m})(h,d,m,!0)};h.exports._tr_init=h=>{r||((()=>{let h,d,m,S,C;const T=new Array(16);for(m=0,S=0;S<28;S++)for(R[S]=m,h=0;h<1<<w[S];h++)I[m++]=S;for(I[m-1]=S,C=0,S=0;S<16;S++)for(Z[S]=C,h=0;h<1<<a[S];h++)E[C++]=S;for(C>>=7;S<A;S++)for(Z[S]=C<<7,h=0;h<1<<a[S]-7;h++)E[256+C++]=S;for(d=0;d<=b;d++)T[d]=0;for(h=0;h<=143;)M[2*h+1]=8,h++,T[8]++;for(;h<=255;)M[2*h+1]=9,h++,T[9]++;for(;h<=279;)M[2*h+1]=7,h++,T[7]++;for(;h<=287;)M[2*h+1]=8,h++,T[8]++;for(F(M,287,T),h=0;h<A;h++)q[2*h+1]=5,q[2*h]=g(h,5);B=new L(M,w,257,j,b),V=new L(q,a,0,A,b),v=new L(new Array(0),D,0,19,7)})(),r=!0),h.l_desc=new C(h.dyn_ltree,B),h.d_desc=new C(h.dyn_dtree,V),h.bl_desc=new C(h.bl_tree,v),h.bi_buf=0,h.bi_valid=0,f(h)},h.exports._tr_stored_block=Y,h.exports._tr_flush_block=(h,d,j,A)=>{let b,w,a=0;h.level>0?(2===h.strm.data_type&&(h.strm.data_type=(h=>{let d,j=4093624447;for(d=0;d<=31;d++,j>>>=1)if(1&j&&0!==h.dyn_ltree[2*d])return 0;if(0!==h.dyn_ltree[18]||0!==h.dyn_ltree[20]||0!==h.dyn_ltree[26])return 1;for(d=32;d<m;d++)if(0!==h.dyn_ltree[2*d])return 1;return 0})(h)),K(h,h.l_desc),K(h,h.d_desc),a=(h=>{let d;for(N(h,h.dyn_ltree,h.l_desc.max_code),N(h,h.dyn_dtree,h.d_desc.max_code),K(h,h.bl_desc),d=18;d>=3&&0===h.bl_tree[2*S[d]+1];d--);return h.opt_len+=3*(d+1)+5+5+4,d})(h),b=h.opt_len+3+7>>>3,w=h.static_len+3+7>>>3,w<=b&&(b=w)):b=w=j+5,j+4<=b&&-1!==d?Y(h,d,j,A):4===h.strategy||w===b?(y(h,2+(A?1:0),3),l(h,M,q)):(y(h,4+(A?1:0),3),((h,d,m,j)=>{let A;for(y(h,d-257,5),y(h,m-1,5),y(h,j-4,4),A=0;A<j;A++)y(h,h.bl_tree[2*S[A]+1],3);W(h,h.dyn_ltree,d-1),W(h,h.dyn_dtree,m-1)})(h,h.l_desc.max_code+1,h.d_desc.max_code+1,a+1),l(h,h.dyn_ltree,h.dyn_dtree)),f(h),A&&H(h)},h.exports._tr_tally=(h,d,j)=>(h.pending_buf[h.d_buf+2*h.last_lit]=d>>>8&255,h.pending_buf[h.d_buf+2*h.last_lit+1]=255&d,h.pending_buf[h.l_buf+h.last_lit]=255&j,h.last_lit++,0===d?h.dyn_ltree[2*j]++:(h.matches++,d--,h.dyn_ltree[2*(I[j]+m+1)]++,h.dyn_dtree[2*T(d)]++),h.last_lit===h.lit_bufsize-1),h.exports._tr_align=h=>{y(h,2,3),i(h,256,M),(h=>{16===h.bi_valid?(o(h,h.bi_buf),h.bi_buf=0,h.bi_valid=0):h.bi_valid>=8&&(h.pending_buf[h.pending++]=255&h.bi_buf,h.bi_buf>>=8,h.bi_valid-=8)})(h)}},12125:h=>{"use strict";h.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Bd="",this.state=null,this.data_type=2,this.adler=0}},12020:h=>{function d(h,d,m){for(var j=h.length,A=-1/0,b=1/0,w=0;w<j;w++){var a=(m[0][w]-h[w])/d[w],D=(m[1][w]-h[w])/d[w];if(a>D){var S=a;a=D,D=S}if(D<A||a>b)return 1/0;a>A&&(A=a),D<b&&(b=D)}return A>b?1/0:A}h.exports=function(h,m,j,A){var b=d(m,j,A);if(b===1/0)h=null;else{h=h||[];for(var w=0;w<m.length;w++)h[w]=m[w]+j[w]*b}return h},h.exports.distance=d},13110:(h,d,m)=>{"use strict";m.d(d,{b:()=>w});var j=m(30);const A=j.useLayoutEffect;const b=function(h){var d=(0,j.useRef)(h);return A((function(){d.current=h})),d};var w=function(h){var d=b(h);(0,j.ad)((function(){var h=function(h){var m;if(null!=d.current&&(m=d.current(h)),h.defaultPrevented&&(h.returnValue=""),"string"===typeof m)return h.returnValue=m,m};return window.addEventListener("beforeunload",h),function(){window.removeEventListener("beforeunload",h)}}),[])}},13064:(h,d,m)=>{"use strict";var j=m(13069),A=Array.prototype.concat,b=Array.prototype.slice,w=h.exports=function(h){for(var d=[],m=0,w=h.length;m<w;m++){var a=h[m];j(a)?d=A.call(d,b.call(a)):d.push(a)}return d};w.wrap=function(h){return function(){return h(w(arguments))}}},13069:h=>{h.exports=function(h){return!(!h||"string"===typeof h)&&(h instanceof Array||Array.isArray(h)||h.length>=0&&(h.splice instanceof Function||Object.getOwnPropertyDescriptor(h,h.length-1)&&"String"!==h.constructor.name))}},13008:h=>{"use strict";var d=[],m=[],j=[],A=[],b=[],w=[],a=[],D=[],S=[],M=[],q=[],E=[];h.exports=function(h,I,R,Z,L,B){for(var V=a,v=S,C=M,T=E,o=0;o<3;o++)V[o]=+R[o],C[o]=+I.max[o],v[o]=+I.base[o];B||(B=1e-10);var y=function(h,a,S,M,E,I){var R=d,Z=m,L=j,B=A,V=b,v=w,C=D,T=Math.floor,o=0,y=0,i=0,g=0,F=0;if(f(),0===i)return 0;for(g=k();y<=i;){if(H(g)&&c())return o;g=k()}for(o+=i,F=0;F<3;F++)M[F]+=S[F],E[F]+=S[F];return o;function f(){if(y=0,0!==(i=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])))for(var h=0;h<3;h++){var d=S[h]>=0;B[h]=d?1:-1;var m=d?E[h]:M[h];R[h]=d?M[h]:E[h],Z[h]=l(m,B[h]),L[h]=K(R[h],B[h]),C[h]=S[h]/i,V[h]=Math.abs(1/C[h]);var j=d?Z[h]+1-m:m-Z[h];v[h]=V[h]<1/0?V[h]*j:1/0}}function H(d){for(var m=B[0],j=0===d?Z[0]:L[0],A=Z[0]+m,b=B[1],w=1===d?Z[1]:L[1],a=Z[1]+b,D=B[2],S=2===d?Z[2]:L[2],M=Z[2]+D,q=j;q!=A;q+=m)for(var E=w;E!=a;E+=b)for(var I=S;I!=M;I+=D)if(h(q,E,I))return!0;return!1}function c(){o+=y;var h=B[g],d=y/i,m=q;for(F=0;F<3;F++){var j=S[F]*d;M[F]+=j,E[F]+=j,m[F]=S[F]-j}if(h>0?E[g]=Math.round(E[g]):M[g]=Math.round(M[g]),a(o,g,h,m))return!0;for(F=0;F<3;F++)S[F]=m[F];return f(),0===i}function k(){var h=v[0]<v[1]?v[0]<v[2]?0:2:v[1]<v[2]?1:2,d=v[h]-y;for(y=v[h],Z[h]+=B[h],v[h]+=V[h],F=0;F<3;F++)R[F]+=d*C[F],L[F]=K(R[F],B[F]);return h}function l(h,d){return T(h-d*I)}function K(h,d){return T(h+d*I)}}(h,Z,V,v,C,B);if(!L){for(o=0;o<3;o++)T[o]=R[o]>0?C[o]-I.max[o]:v[o]-I.base[o];I.translate(T)}return y}},12044:(h,d,m)=>{var j=m(12046);function A(h){for(var d,m,A=0,b=h.length,w=0;w<h.length;){for(d=h[w],m=0;w<b&&h[w]===d;)++w,++m;A+=j.log2(m)/7|0,A+=j.log2(d>>>0)/7|0,A+=2}return A}d.size=A,d.encode=function(h,d){d||(d=new Uint8Array(A(h)));for(var m,j,b=0,w=d.length,a=0;a<h.length;){for(m=h[a],j=0;a<h.length&&h[a]===m;)++a,++j;for(;b<w&&j>=128;)d[b++]=128+(127&j),j>>>=7;if(b>=w)throw new Error("RLE buffer overflow");for(d[b++]=j,m>>>=0;b<w&&m>=128;)d[b++]=128+(127&m),m>>>=7;if(b>=w)throw new Error("RLE buffer overflow");d[b++]=m}return d},d.decode=function(h,d){for(var m,j,A,b,w=d.length,a=h.length,D=0,S=0;S<a;){for(m=0,j=0;S<a&&h[S]>=128;)m+=(127&h[S++])<<j,j+=7;if(m+=h[S++]<<j,S>=a)throw new Error("RLE buffer underrun");if(D+m>w)throw new Error("Chunk buffer overflow");for(A=0,j=0;S<a&&h[S]>=128;)A+=(127&h[S++])<<j,j+=7;if(S>=a)throw new Error("RLE buffer underrun");for(A+=h[S++]<<j,b=0;b<m;++b)d[D++]=A}return d}},12046:(h,d)=>{"use strict";function m(h){var d=32;return(h&=-h)&&d--,65535&h&&(d-=16),16711935&h&&(d-=8),252645135&h&&(d-=4),858993459&h&&(d-=2),1431655765&h&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(h){return(h>0)-(h<0)},d.abs=function(h){var d=h>>31;return(h^d)-d},d.min=function(h,d){return d^(h^d)&-(h<d)},d.max=function(h,d){return h^(h^d)&-(h<d)},d.isPow2=function(h){return!(h&h-1)&&!!h},d.log2=function(h){var d,m;return d=(h>65535)<<4,d|=m=((h>>>=d)>255)<<3,d|=m=((h>>>=m)>15)<<2,(d|=m=((h>>>=m)>3)<<1)|(h>>>=m)>>1},d.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},d.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},d.countTrailingZeros=m,d.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},d.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},d.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var j=new Array(256);!function(h){for(var d=0;d<256;++d){var m=d,j=d,A=7;for(m>>>=1;m;m>>>=1)j<<=1,j|=1&m,--A;h[d]=j<<A&255}}(j),d.reverse=function(h){return j[255&h]<<24|j[h>>>8&255]<<16|j[h>>>16&255]<<8|j[h>>>24&255]},d.interleave2=function(h,d){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(h,d){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>d&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},d.interleave3=function(h,d,m){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(m=1227133513&((m=3272356035&((m=251719695&((m=4278190335&((m&=1023)|m<<16))|m<<8))|m<<4))|m<<2))<<2},d.deinterleave3=function(h,d){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>d&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},d.nextCombination=function(h){var d=h|h-1;return d+1|(~d&-~d)-1>>>m(h)+1}},13176:(h,d,m)=>{"use strict";m.d(d,{b:()=>q});var j=m(13006),A=m(116);class b{constructor(h,d,m,b,w,a,D){this.nS=new j(h.base,h.wM),this.FA=d,this.friction=m,this.restitution=b,this.la=w,this.yI=a,this.Ka=!!D,this.bM=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.qR=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.TS=A.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=A.create(),this._impulses=A.create(),this._sleepFrameCount=10}loadFromCopy(h){A.i(this.nS.base,h.nS.base),A.i(this.nS.wM,h.nS.wM),A.i(this.nS.max,h.nS.max),this.nS.mag=h.nS.mag,this.FA=h.FA,this.friction=h.friction,this.restitution=h.restitution,this.la=h.la,this.yI=h.yI,this.Ka=h.Ka,this.bM=h.bM,this.fluidDrag=h.fluidDrag,this.qR=h.qR,this.preventFallOffEdge=h.preventFallOffEdge,this.rolledBackLastTick=h.rolledBackLastTick,A.i(this.TS,h.TS),A.i(this.resting,h.resting),this.inFluid=h.inFluid,this._ratioInFluid=h._ratioInFluid,A.i(this._forces,h._forces),A.i(this._impulses,h._impulses),this._sleepFrameCount=h._sleepFrameCount}setPosition(h){w(h),A.fm(h,h,this.nS.base),this.nS.translate(h),this.iS()}Id(){return A.clone(this.nS.base)}applyForce(h){w(h),A.add(this._forces,this._forces,h),this.iS()}applyImpulse(h){w(h),A.add(this._impulses,this._impulses,h),this.iS()}iS(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var w=h=>{};var a=m(13006),D=m(116),S=m(13008);function M(){this.bM=.1,this.fluidDrag=.4,this.xa=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function q(h,d,m){h=Object.assign(new M,h),this.gravity=h.gravity||[0,-10,0],this.bM=h.bM||.1,this.xa=h.xa||2,this.fluidDrag=h.fluidDrag||.4,this.minBounceImpulse=h.minBounceImpulse,this.bodies=[],this.pE=h.pE,this.testSolid=d,this.testFluid=m}q.prototype.kI=function(h,d,m,j,A,w){h=h||new a([0,0,0],[1,1,1]),"undefined"==typeof d&&(d=1),"undefined"==typeof m&&(m=1),"undefined"==typeof j&&(j=0),"undefined"==typeof A&&(A=1);var D=new b(h,d,m,j,A,w);return this.bodies.push(D),D},q.prototype.lI=function(h){var d=this.bodies.indexOf(h);d<0||(this.bodies.splice(d,1),h.nS=h.yI=null)};var E=D.create(),I=D.create(),R=D.create(),Z=D.create(),L=D.create(),B=D.create(),V=D.create(),v=new a([0,0,0],[1,1,1]),C=new b(v,1,1,0,1,(()=>{}),!1);function T(h,d,m){return d=m,d*=1-(1-h.ratioInFluid)**2}q.prototype.Pa=function(h){h/=1e3;var d=x(0,D.squaredLength(this.gravity));this.bodies.forEach((m=>function(h,d,m,j){D.i(L,d.resting),h.pE&&C.loadFromCopy(d);if(d.FA<=0)return D.set(d.TS,0,0,0),D.set(d._forces,0,0,0),void D.set(d._impulses,0,0,0);var A=j||0===d.la;if(function(h,d,m,j){if(d._sleepFrameCount>0)return!1;if(j)return!0;var A=!1,b=.5*m*m*d.la;return D.scale(Y,h.gravity,b),S(h.testSolid,d.nS,Y,(function(){return A=!0,!0}),!0),A}(h,d,m,A))return;d._sleepFrameCount--,function(h,d){var m=d.nS,j=Math.floor(m.base[0]),A=Math.floor(m.base[2]),b=Math.floor(m.base[1]),w=Math.floor(m.max[1]);if(!h.testFluid(j,b,A))return d.inFluid=!1,void(d.ratioInFluid=0);var a=1,S=b+1;for(;S<=w&&h.testFluid(j,S,A);)a++,S++;var M=(b+a-m.base[1])/m.wM[1];M>1&&(M=1);var q=m.wM[0]*m.wM[1]*m.wM[2]*M,E=y;D.scale(E,h.gravity,-h.xa*q*d.la),d.applyForce(E),d.inFluid=!0,d.ratioInFluid=M}(h,d),t(d._forces),t(d._impulses),t(d.TS),t(d.resting),D.scale(E,d._forces,1/d.FA),D.Oa(E,E,h.gravity,d.la),D.scale(I,d._impulses,1/d.FA),D.Oa(I,I,E,m),D.add(d.TS,d.TS,I),d.friction&&(i(h,0,d,I,m),i(h,1,d,I,m),i(h,2,d,I,m));var b=d.fluidDrag>=0?d.fluidDrag:h.fluidDrag,w=d.bM>=0?d.bM:h.bM,a=w,M=w;d.inFluid&&(a=T(d,a,d.fluidDragHoriz>=0?d.fluidDragHoriz:b),M=T(d,M,d.fluidDragVert>=0?d.fluidDragVert:b));a=Math.max(1-a*m/d.FA,0),M=Math.max(1-M*m/d.FA,0),D.set(o,a,M,a),D.multiply(d.TS,d.TS,o),D.scale(R,d.TS,m),D.set(d._forces,0,0,0),D.set(d._impulses,0,0,0),d.Ka&&Q(f,d.nS);D.i(B,R),D.set(V,0,0,0),d.preventFallOffEdge&&function(h,d,m,j){if(!d.resting[1]||m[1]>0)return;var A=N;Q(A,d.nS);for(var b=0;b<3;b+=2){D.set(K,0,0,0),K[b]=m[b];var w=!0;(w=(w=(w=(w=w&&!r(h,A.base[0]+K[0]+1e-5,A.base[1],A.base[2]+K[2]+1e-5))&&!r(h,A.max[0]+K[0]-1e-5,A.base[1],A.base[2]+K[2]+1e-5))&&!r(h,A.base[0]+K[0]+1e-5,A.base[1],A.max[2]+K[2]-1e-5))&&!r(h,A.max[0]+K[0]-1e-5,A.base[1],A.max[2]+K[2]-1e-5))?(j[b]=m[b]>0?1:-1,m[b]=0):0===b&&(D.set(W,m[0],0,0),F(h,A,W,j,d.slideOnCollision))}}(h,d,R,V);F(h,d.nS,R,d.resting,d.slideOnCollision),d.Ka&&function(h,d,m,j){if(d.resting[1]>=0&&!d.inFluid)return;var A=0!==d.resting[0],b=0!==d.resting[2];if(!A&&!b)return;var w=Math.abs(j[0]/j[2]),a=4;if(!A&&w>a)return;if(!b&&w<1/a)return;D.add(c,m.base,j);var M=h.testSolid;S(M,m,j,(function(h,d,m,j){if(1!==d)return!0;j[d]=0}));var q=m.base[1],E=d.inFluid?1.951:1.001,I=Math.floor(q+E)-q;D.set(k,0,I,0);var R=!1;if(S(M,m,k,(function(h,d,m,j){return R=!0,!0})),R)return;D.fm(l,c,m.base),l[1]=0,F(h,m,l,H,!0);var Z=x(m.base[0],c[0]),L=x(m.base[2],c[2]);if(A&&!Z&&(!L||!b))return;if(b&&(!Z||!A)&&!L)return;var B=!0;if(B=B&&!r(h,m.base[0]+1e-5,m.base[1],m.base[2]+1e-5),B=B&&!r(h,m.max[0]-1e-5,m.base[1],m.base[2]+1e-5),B=B&&!r(h,m.base[0]+1e-5,m.base[1],m.max[2]-1e-5),B=B&&!r(h,m.max[0]-1e-5,m.base[1],m.max[2]-1e-5),B)return;Q(d.nS,m),d.resting[0]=H[0],d.resting[2]=H[2],d.qR&&d.qR()}(h,d,f,B);for(var q=0;q<3;++q)d.resting[q]=d.resting[q]||V[q],Z[q]=0,d.resting[q]&&(L[q]||(Z[q]=-d.TS[q]),d.TS[q]=0);var v=D.length(Z);v>.001&&(D.scale(Z,Z,d.FA),d.yI&&d.yI(Z),d.restitution>0&&v>h.minBounceImpulse&&(D.scale(Z,Z,d.restitution),d.applyImpulse(Z)));var g=D.squaredLength(d.TS);g>1e-5&&d.iS();h.pE&&h.pE(d)?(d.loadFromCopy(C),d.rolledBackLastTick=!0):d.rolledBackLastTick=!1}(this,m,h,d)))};var o=D.create([0,0,0]);var y=D.create();function i(h,d,m,j,A){var b=m.resting[d],w=j[d];if(!m.alwaysApplyHorizFriction||1!==d){if(0===b)return;if(b*w<=0)return}D.i(g,m.TS),g[d]=0;var a=D.length(g);if(!x(a,0)){var S=Math.abs(m.friction*h.gravity[d]*A),M=a>S?(a-S)/a:0;m.TS[(d+1)%3]*=M,m.TS[(d+2)%3]*=M}}var g=D.create();function F(h,d,m,j,A){return D.set(j,0,0,0),S(h.testSolid,d,m,(function(h,d,m,b){j[d]=m,b[d]=0,A||(b[0]=0,b[1]=0,b[2]=0)}))}var f=new a([],[]),H=D.create(),c=D.create(),k=D.create(),l=D.create();var K=D.create(),N=new a([],[]),W=D.create();function r(h,d,m,j){return h.testSolid(Math.floor(d),Math.floor(m-1),Math.floor(j))}var Y=D.create();function x(h,d){return Math.abs(h-d)<1e-5}function Q(h,d){for(var m=0;m<3;m++)h.base[m]=d.base[m],h.max[m]=d.max[m],h.wM[m]=d.wM[m]}var t=function(h){}},12069:h=>{"use strict";h.exports=function(h,d,m,j){var A=self||window;try{try{var b;try{b=new A.Blob([h])}catch(S){(b=new(A.BlobBuilder||A.WebKitBlobBuilder||A.MozBlobBuilder||A.MSBlobBuilder)).append(h),b=b.getBlob()}var w=A.URL||A.webkitURL,a=w.createObjectURL(b),D=new A[d](a,m);return w.revokeObjectURL(a),D}catch(S){return new A[d]("data:application/javascript,".concat(encodeURIComponent(h)),m)}}catch(S){if(!j)throw Error("Inline worker is not supported");return new A[d](j,m)}}},11997:(h,d,m)=>{"use strict";function j(h,d,m,j,A){var b={};return Object.keys(j).forEach((function(h){b[h]=j[h]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=m.slice().reverse().reduce((function(m,j){return j(h,d,m)||m}),b),A&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(A):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(h,d,b),b=null),b}m.d(d,{e:()=>j})},11991:(h,d,m)=>{"use strict";function j(h,d,m,j){m&&Object.defineProperty(h,d,{enumerable:m.enumerable,configurable:m.configurable,writable:m.writable,value:m.initializer?m.initializer.call(j):void 0})}m.d(d,{c:()=>j})},13098:(h,d,m)=>{"use strict";m.d(d,{c:()=>w,g:()=>q,i:()=>a,j:()=>b,k:()=>D,m:()=>A,q:()=>S,t:()=>M});var j=m(11526);class A{constructor(){this._easingMode=A.EASINGMODE_EASEIN}setEasingMode(h){const d=Math.min(Math.max(h,0),2);this._easingMode=d}getEasingMode(){return this._easingMode}easeInCore(h){throw new Error("You must implement this method")}ease(h){switch(this._easingMode){case A.EASINGMODE_EASEIN:return this.easeInCore(h);case A.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-h)}return h>=.5?.5*(1-this.easeInCore(2*(1-h)))+.5:.5*this.easeInCore(2*h)}}A.EASINGMODE_EASEIN=0,A.EASINGMODE_EASEOUT=1,A.EASINGMODE_EASEINOUT=2;class b extends A{easeInCore(h){return h=Math.max(0,Math.min(1,h)),1-Math.sqrt(1-h*h)}}class w extends A{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=h}easeInCore(h){const d=Math.max(0,this.amplitude);return Math.pow(h,3)-h*d*Math.sin(3.141592653589793*h)}}class a extends A{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=h,this.bounciness=d}easeInCore(h){const d=Math.max(0,this.bounces);let m=this.bounciness;m<=1&&(m=1.001);const j=Math.pow(m,d),A=1-m,b=(1-j)/A+.5*j,w=h*b,a=Math.log(-w*(1-m)+1)/Math.log(m),D=Math.floor(a),S=D+1,M=(1-Math.pow(m,D))/(A*b),q=.5*(M+(1-Math.pow(m,S))/(A*b)),E=h-q,I=q-M;return-Math.pow(1/m,d-D)/(I*I)*(E-I)*(E+I)}}class D extends A{easeInCore(h){return h*h*h}}class S extends A{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=h,this.springiness=d}easeInCore(h){let d;const m=Math.max(0,this.oscillations),j=Math.max(0,this.springiness);return d=0==j?h:(Math.exp(j*h)-1)/(Math.exp(j)-1),d*Math.sin((6.283185307179586*m+1.5707963267948966)*h)}}class M extends A{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=h}easeInCore(h){return this.exponent<=0?h:(Math.exp(this.exponent*h)-1)/(Math.exp(this.exponent)-1)}}class q extends A{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=h,this.y1=d,this.x2=m,this.y2=j}easeInCore(h){return j.b.Interpolate(h,this.x1,this.y1,this.x2,this.y2)}}},12594:(h,d,m)=>{"use strict";m.d(d,{e:()=>w});var j=m(11058),A=m(11073),b=m(11374);class w extends b.b{get _matrix(){return this._compose(),this.kE}set _matrix(h){(h.updateFlag!==this.kE.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.kE.D(h),this._markAsDirtyAndDecompose())}constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(h,d.ih(),!1),this.name=h,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=d,this.kE=(null===A||void 0===A?void 0:A.clone())??j.b.Identity(),this._restMatrix=b??this.kE.clone(),this._bindMatrix=w??this.kE.clone(),this._index=a,this._absoluteMatrix=new j.b,this._absoluteBindMatrix=new j.b,this._absoluteInverseBindMatrix=new j.b,this._finalMatrix=new j.b,d.bones.push(this),this.setParent(m,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(h){this.setParent(h)}setParent(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==h){if(this.parent){const h=this.parent.children.indexOf(this);-1!==h&&this.parent.children.splice(h,1)}this._parentNode=h,this.parent&&this.parent.children.push(this),d&&this._updateAbsoluteBindMatrices(),this.PS()}}getLocalMatrix(){return this._compose(),this.kE}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(h){this._restMatrix.D(h)}setRestPose(h){this.setRestMatrix(h)}getBindPose(){return this.getBindMatrix()}setBindMatrix(h){this.hb(h)}setBindPose(h){this.setBindMatrix(h)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const h=j.d.Qd[0],d=j.d.Quaternion[0],m=j.d.Qd[1];this.getRestMatrix().decompose(h,d,m),this._linkedTransformNode.position.D(m),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??j.c.Identity(),this._linkedTransformNode.rotationQuaternion.D(d),this._linkedTransformNode.td.D(h)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(h){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=h,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ZD}set position(h){this._decompose(),this.ZD.D(h),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(h){this.setRotation(h)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(h){this.setRotationQuaternion(h)}get td(){return this.getScale()}set td(h){this.setScale(h)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=j.i.Zero(),this._localRotation=j.c.Zero(),this.ZD=j.i.Zero()),this.kE.decompose(this._localScaling,this._localRotation,this.ZD))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,j.b.ComposeToRef(this._localScaling,this._localRotation,this.ZD,this.kE)):this._needToCompose=!1)}hb(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.D(h),d&&this._updateAbsoluteBindMatrices(),m?this._matrix=h:this.PS()}_updateAbsoluteBindMatrices(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(h||(h=this._bindMatrix),this.parent?h.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.D(h),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),d)for(let m=0;m<this.children.length;m++)this.children[m]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}PS(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.PS(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.PS(),this._needToDecompose=!0}_updatePosition(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=this.getLocalMatrix();if(0==d)A?(b.addAtIndex(12,h.x),b.addAtIndex(13,h.y),b.addAtIndex(14,h.z)):b.setTranslationFromFloats(h.x,h.y,h.z);else{let d=null;m&&(d=m.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=w._TmpMats[0],D=w._TmpVecs[0];this.parent?m&&d?(a.D(this.parent.getAbsoluteMatrix()),a.multiplyToRef(d,a)):a.D(this.parent.getAbsoluteMatrix()):j.b.IdentityToRef(a),A&&a.setTranslationFromFloats(0,0,0),a.invert(),j.i.TransformCoordinatesToRef(h,a,D),A?(b.addAtIndex(12,D.x),b.addAtIndex(13,D.y),b.addAtIndex(14,D.z)):b.setTranslationFromFloats(D.x,D.y,D.z)}this._markAsDirtyAndDecompose()}translate(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,d,m,!0)}setPosition(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,d,m,!1)}setAbsolutePosition(h,d){this.setPosition(h,1,d)}scale(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=this.getLocalMatrix(),a=w._TmpMats[0];j.b.ScalingToRef(h,d,m,a),a.multiplyToRef(b,b),a.invert();for(const j of this.children){const A=j.getLocalMatrix();A.multiplyToRef(a,A),A.multiplyAtIndex(12,h),A.multiplyAtIndex(13,d),A.multiplyAtIndex(14,m),j._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),A)for(const j of this.children)j.scale(h,d,m,A)}setScale(h){this._decompose(),this._localScaling.D(h),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(h){this._decompose(),h.D(this._localScaling)}setYawPitchRoll(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4?arguments[4]:void 0;if(0===A){const a=w._TmpQuat;return j.c.RotationYawPitchRollToRef(h,d,m,a),void this.setRotationQuaternion(a,A,b)}const a=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,b))return;const D=w._TmpMats[1];j.b.RotationYawPitchRollToRef(h,d,m,D),a.multiplyToRef(D,D),this._rotateWithMatrix(D,A,b)}rotate(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;const b=w._TmpMats[0];b.setTranslationFromFloats(0,0,0),j.b.RotationAxisToRef(h,d,b),this._rotateWithMatrix(b,m,A)}setAxisAngle(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;if(0===m){const b=w._TmpQuat;return j.c.RotationAxisToRef(h,d,b),void this.setRotationQuaternion(b,m,A)}const b=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,A))return;const a=w._TmpMats[1];j.b.RotationAxisToRef(h,d,a),b.multiplyToRef(a,a),this._rotateWithMatrix(a,m,A)}setRotation(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(h.y,h.x,h.z,d,m)}setRotationQuaternion(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;if(0===d)return this._decompose(),this._localRotation.D(h),void this._markAsDirtyAndCompose();const A=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,m))return;const b=w._TmpMats[1];j.b.FromQuaternionToRef(h,b),A.multiplyToRef(b,b),this._rotateWithMatrix(b,d,m)}setRotationMatrix(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;if(0===d){const A=w._TmpQuat;return j.c.FromRotationMatrixToRef(h,A),void this.setRotationQuaternion(A,d,m)}const A=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,m))return;const b=w._TmpMats[1];b.D(h),A.multiplyToRef(h,b),this._rotateWithMatrix(b,d,m)}_rotateWithMatrix(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;const j=this.getLocalMatrix(),A=j.m[12],b=j.m[13],a=j.m[14],D=this.getParent(),S=w._TmpMats[3],M=w._TmpMats[4];D&&1==d?(m?(S.D(m.getWorldMatrix()),D.getAbsoluteMatrix().multiplyToRef(S,S)):S.D(D.getAbsoluteMatrix()),M.D(S),M.invert(),j.multiplyToRef(S,j),j.multiplyToRef(h,j),j.multiplyToRef(M,j)):1==d&&m?(S.D(m.getWorldMatrix()),M.D(S),M.invert(),j.multiplyToRef(S,j),j.multiplyToRef(h,j),j.multiplyToRef(M,j)):j.multiplyToRef(h,j),j.setTranslationFromFloats(A,b,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(h,d){const m=w._TmpMats[2];return h.D(this.getAbsoluteMatrix()),d?(h.multiplyToRef(d.getWorldMatrix(),h),j.b.ScalingToRef(d.td.x,d.td.y,d.td.z,m)):j.b.IdentityToRef(m),h.invert(),!isNaN(h.m[0])&&(m.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyToRef(m,h),!0)}Id(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=j.i.Zero();return this.getPositionToRef(h,d,m),m}getPositionToRef(){let h=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const h=this.getLocalMatrix();d.x=h.m[12],d.y=h.m[13],d.z=h.m[14]}else{let m=null;h&&(m=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let j=w._TmpMats[0];h&&m?(j.D(this.getAbsoluteMatrix()),j.multiplyToRef(m,j)):j=this.getAbsoluteMatrix(),d.x=j.m[12],d.y=j.m[13],d.z=j.m[14]}}getAbsolutePosition(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=j.i.Zero();return this.getPositionToRef(1,h,d),d}getAbsolutePositionToRef(h,d){this.getPositionToRef(1,h,d)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.kE.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.D(this.kE);const h=this._skeleton.getPoseMatrix();h&&this._absoluteMatrix.multiplyToRef(h,this._absoluteMatrix)}const h=this.children,d=h.length;for(let m=0;m<d;m++)h[m].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}JD(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=j.i.Zero();return this.getDirectionToRef(h,d,m),m}getDirectionToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,A=null;d&&(A=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=w._TmpMats[0];b.D(this.getAbsoluteMatrix()),d&&A&&b.multiplyToRef(A,b),j.i.TransformNormalToRef(h,b,m),m.normalize()}getRotation(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=j.i.Zero();return this.getRotationToRef(h,d,m),m}getRotationToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;const j=w._TmpQuat;this.getRotationQuaternionToRef(h,d,j),j.toEulerAnglesToRef(m)}getRotationQuaternion(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=j.c.Identity();return this.getRotationQuaternionToRef(h,d,m),m}getRotationQuaternionToRef(){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),d.D(this._localRotation);else{const m=w._TmpMats[0],j=this.getAbsoluteMatrix();h?j.multiplyToRef(h.getWorldMatrix(),m):m.D(j),m.multiplyAtIndex(0,this._scalingDeterminant),m.multiplyAtIndex(1,this._scalingDeterminant),m.multiplyAtIndex(2,this._scalingDeterminant),m.decompose(void 0,d,void 0)}}getRotationMatrix(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0;const m=j.b.Identity();return this.getRotationMatrixToRef(h,d,m),m}getRotationMatrixToRef(){let h=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(d);else{const m=w._TmpMats[0],j=this.getAbsoluteMatrix();h?j.multiplyToRef(h.getWorldMatrix(),m):m.D(j),m.multiplyAtIndex(0,this._scalingDeterminant),m.multiplyAtIndex(1,this._scalingDeterminant),m.multiplyAtIndex(2,this._scalingDeterminant),m.getRotationMatrixToRef(d)}}getAbsolutePositionFromLocal(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=j.i.Zero();return this.getAbsolutePositionFromLocalToRef(h,d,m),m}getAbsolutePositionFromLocalToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,A=null;d&&(A=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=w._TmpMats[0];b.D(this.getAbsoluteMatrix()),d&&A&&b.multiplyToRef(A,b),j.i.TransformCoordinatesToRef(h,b,m)}getLocalPositionFromAbsolute(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=j.i.Zero();return this.getLocalPositionFromAbsoluteToRef(h,d,m),m}getLocalPositionFromAbsoluteToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,A=null;d&&(A=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=w._TmpMats[0];b.D(this.getAbsoluteMatrix()),d&&A&&b.multiplyToRef(A,b),b.invert(),j.i.TransformCoordinatesToRef(h,b,m)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const h=this._skeleton.bones.indexOf(this);if(-1!==h&&this._skeleton.bones.splice(h,1),this._parentNode&&this._parentNode.children){const h=this._parentNode.children,d=h.indexOf(this);-1!==d&&h.splice(d,1)}super.dispose()}}w._TmpVecs=(0,A.c)(2,j.i.Zero),w._TmpQuat=j.c.Identity(),w._TmpMats=(0,A.c)(5,j.b.Identity)},13093:(h,d,m)=>{"use strict";m.d(d,{b:()=>K});var j=m(11258),A=m(11261),b=m(11097),w=m(11058),a=m(11099),D=m(11374),S=m(11419),M=m(11624),q=m(11132),E=m(11065);class I{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(h){this._idleRotationSpeed=h}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(h){this._idleRotationWaitTime=h}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(h){this._idleRotationSpinupTime=h}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(h){this._attachedCamera=h;const d=this._attachedCamera.ih();this._onPrePointerObservableObserver=d.onPrePointerObservable.add((h=>{h.type!==M.d.POINTERDOWN?h.type===M.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const h=q.b.Now;let d=0;null!=this._lastFrameTime&&(d=h-this._lastFrameTime),this._lastFrameTime=h,this._applyUserInteraction();const m=h-this._lastInteractionTime-this._idleRotationWaitTime,j=Math.max(Math.min(m/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*j,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(d/1e3))}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.ih();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(h){this._lastInteractionTime=h??q.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<E.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let h=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(h=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?h:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=q.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var R=m(13098),Z=m(11714);class L{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(h){if(this._autoTransitionRange===h)return;this._autoTransitionRange=h;const d=this._attachedCamera;d&&(h?this._onMeshTargetChangedObserver=d.onMeshTargetChangedObservable.add((h=>{if(h&&(h.Zd(!0),h.getBoundingInfo)){const d=h.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*d,this.upperRadiusTransitionRange=.05*d}})):this._onMeshTargetChangedObserver&&d.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(h){this._attachedCamera=h,this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(h){return!!this._attachedCamera&&(this._attachedCamera.radius===h&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(h){if(!this._attachedCamera)return;this._radiusBounceTransition||(L.EasingFunction.setEasingMode(L.EasingMode),this._radiusBounceTransition=Z.b.CreateAnimation("radius",Z.b.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const d=Z.b.TransitionTo("radius",this._attachedCamera.radius+h,this._attachedCamera,this._attachedCamera.ih(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));d&&this._animatables.push(d)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}L.EasingFunction=new R.c(.3),L.EasingMode=R.m.EASINGMODE_EASEOUT;class B{constructor(){this.onTargetFramingAnimationEndObservable=new b.e,this._mode=B.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(h){this._mode=h}get mode(){return this._mode}set radiusScale(h){this._radiusScale=h}get radiusScale(){return this._radiusScale}set positionScale(h){this._positionScale=h}get positionScale(){return this._positionScale}set defaultElevation(h){this._defaultElevation=h}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(h){this._elevationReturnTime=h}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(h){this._elevationReturnWaitTime=h}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(h){this._framingTime=h}get framingTime(){return this._framingTime}init(){}attach(h){this._attachedCamera=h;const d=this._attachedCamera.ih();B.EasingFunction.setEasingMode(B.EasingMode),this._onPrePointerObservableObserver=d.onPrePointerObservable.add((h=>{h.type!==M.d.POINTERDOWN?h.type===M.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((h=>{h&&h.getBoundingInfo&&this.zoomOnMesh(h,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.ih();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.Zd(!0);const j=h.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(j.minimumWorld,j.maximumWorld,d,m)}zoomOnMeshHierarchy(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.Zd(!0);const j=h.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(j.min,j.max,d,m)}zoomOnMeshesHierarchy(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new w.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new w.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let b=0;b<h.length;b++){const d=h[b].getHierarchyBoundingVectors(!0);w.i.CheckExtends(d.min,j,A),w.i.CheckExtends(d.max,j,A)}this.zoomOnBoundingInfo(j,A,d,m)}zoomOnBoundingInfo(h,d){let m,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const b=h.y,a=b+(d.y-b)*this._positionScale,D=d.fm(h).scale(.5);if(!isFinite(a))return!1;if(j)m=new w.i(0,a,0);else{const d=h.add(D);m=new w.i(d.x,a,d.z)}this._vectorTransition||(this._vectorTransition=Z.b.CreateAnimation("target",Z.b.ANIMATIONTYPE_VECTOR3,60,B.EasingFunction)),this._betaIsAnimating=!0;let S=Z.b.TransitionTo("target",m,this._attachedCamera,this._attachedCamera.ih(),60,this._vectorTransition,this._framingTime);S&&this._animatables.push(S);let M=0;if(this._mode===B.FitFrustumSidesMode){const m=this._calculateLowerRadiusFromModelBoundingSphere(h,d);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=D.length()+this._attachedCamera.jb),M=m}else this._mode===B.IgnoreBoundsSizeMode&&(M=this._calculateLowerRadiusFromModelBoundingSphere(h,d),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.jb));if(this.autoCorrectCameraLimitsAndSensibility){const m=d.fm(h).length();this._attachedCamera.panningSensibility=5e3/m,this._attachedCamera.wheelPrecision=100/M}return this._radiusTransition||(this._radiusTransition=Z.b.CreateAnimation("radius",Z.b.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),S=Z.b.TransitionTo("radius",M,this._attachedCamera,this._attachedCamera.ih(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),A&&A(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),S&&this._animatables.push(S),!0}_calculateLowerRadiusFromModelBoundingSphere(h,d){const m=this._attachedCamera;if(!m)return 0;let j=m._calculateLowerRadiusFromModelBoundingSphere(h,d,this._radiusScale);return m.lowerRadiusLimit&&this._mode===B.IgnoreBoundsSizeMode&&(j=j<m.lowerRadiusLimit?m.lowerRadiusLimit:j),m.upperRadiusLimit&&(j=j>m.upperRadiusLimit?m.upperRadiusLimit:j),j}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const h=q.b.Now-this._lastInteractionTime,d=.5*Math.PI-this._defaultElevation,m=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>m&&h>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Z.b.CreateAnimation("beta",Z.b.ANIMATIONTYPE_FLOAT,60,B.EasingFunction));const h=Z.b.TransitionTo("beta",d,this._attachedCamera,this._attachedCamera.ih(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));h&&this._animatables.push(h)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=q.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}B.EasingFunction=new R.t,B.EasingMode=R.m.EASINGMODE_EASEINOUT,B.IgnoreBoundsSizeMode=0,B.FitFrustumSidesMode=1;var V=m(11427),v=m(11587),C=m(12585),T=m(11107);class o{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(h){h=T.e.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),m=d.getInputElement();let j=0,A=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=b=>{var w,a;const D=b.event,S="touch"===D.pointerType;if(b.type!==M.d.POINTERMOVE&&-1===this.buttons.indexOf(D.button))return;const q=D.target;if(this._altKey=D.altKey,this._ctrlKey=D.ctrlKey,this._metaKey=D.metaKey,this._shiftKey=D.shiftKey,this._buttonsPressed=D.buttons,d.isPointerLock){const h=D.movementX,d=D.movementY;this.onTouch(null,h,d),this._pointA=null,this._pointB=null}else{if(b.type!==M.d.POINTERDOWN&&b.type!==M.d.POINTERDOUBLETAP&&S&&(null===(w=this._pointA)||void 0===w?void 0:w.pointerId)!==D.pointerId&&(null===(a=this._pointB)||void 0===a?void 0:a.pointerId)!==D.pointerId)return;if(b.type!==M.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!S)if(b.type===M.d.POINTERDOUBLETAP)this.onDoubleTap(D.pointerType);else if(b.type!==M.d.POINTERUP||this._currentMousePointerIdDown!==D.pointerId&&!S){if(b.type===M.d.POINTERMOVE)if(h||D.preventDefault(),this._pointA&&null===this._pointB){const h=D.clientX-this._pointA.x,d=D.clientY-this._pointA.y;this._pointA.x=D.clientX,this._pointA.y=D.clientY,this.onTouch(this._pointA,h,d)}else if(this._pointA&&this._pointB){const h=this._pointA.pointerId===D.pointerId?this._pointA:this._pointB;h.x=D.clientX,h.y=D.clientY;const d=this._pointA.x-this._pointB.x,m=this._pointA.y-this._pointB.y,w=d*d+m*m,a={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:D.pointerId,type:b.type};this.onMultiTouch(this._pointA,this._pointB,j,w,A,a),A=a,j=w}}else{try{null===q||void 0===q||q.releasePointerCapture(D.pointerId)}catch(E){}S||(this._pointB=null),d._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==D.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==D.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==j||A)&&(this.onMultiTouch(this._pointA,this._pointB,j,0,A,null),j=0,A=null),this._currentMousePointerIdDown=-1,this.onButtonUp(D),h||D.preventDefault()}else{try{null===q||void 0===q||q.setPointerCapture(D.pointerId)}catch(E){}if(null===this._pointA)this._pointA={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType};else{if(null!==this._pointB)return;this._pointB={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}}-1!==this._currentMousePointerIdDown||S||(this._currentMousePointerIdDown=D.pointerId),this.onButtonDown(D),h||(D.preventDefault(),m&&m.focus())}}},this._observer=this.camera.ih()._inputManager._addCameraPointerObserver(this._pointerInput,M.d.POINTERDOWN|M.d.POINTERUP|M.d.POINTERMOVE|M.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,j=0,A=null,this.onLostFocus()},this._contextMenuBind=h=>this.onContextMenu(h),m&&m.addEventListener("contextmenu",this._contextMenuBind,!1);const b=this.camera.ih().getEngine().getHostWindow();b&&T.e.RegisterTopRootEvents(b,[{name:"blur",handler:this._onLostFocus}])}xq(){if(this._onLostFocus){const h=this.camera.ih().getEngine().getHostWindow();h&&T.e.UnregisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.ih()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const h=this.camera.ih().getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(h){}onTouch(h,d,m){}onMultiTouch(h,d,m,j,A,b){}onContextMenu(h){h.preventDefault()}onButtonDown(h){}onButtonUp(h){}onLostFocus(){}}(0,j.d)([(0,A.M)()],o.prototype,"buttons",void 0);class y extends o{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(h,d){if(0!==this.panningSensibility&&h&&d){const m=d.x-h.x,j=d.y-h.y;this.camera.inertialPanningX+=-m/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility}}_computePinchZoom(h,d){const m=this.camera.radius||y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=m*Math.sqrt(h)/Math.sqrt(d):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(d-h)*m*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(d-h)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(h,d,m){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=m/this.panningSensibility):(this.camera.inertialAlphaOffset-=d/this.angularSensibilityX,this.camera.inertialBetaOffset-=m/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(h,d,m,j,A,b){0===m&&null===A||0===j&&null===b||(this.multiTouchPanAndZoom?(this._computePinchZoom(m,j),this._computeMultiTouchPanning(A,b)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(j)-Math.sqrt(m))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(m,j),this._isPinching=!0):this._computeMultiTouchPanning(A,b)):this.multiTouchPanning?this._computeMultiTouchPanning(A,b):this.pinchZoom&&this._computePinchZoom(m,j))}onButtonDown(h){this._isPanClick=h.button===this.camera._panningMouseButton}onButtonUp(h){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}y.MinimumRadiusForPinch=.001,(0,j.d)([(0,A.M)()],y.prototype,"buttons",void 0),(0,j.d)([(0,A.M)()],y.prototype,"angularSensibilityX",void 0),(0,j.d)([(0,A.M)()],y.prototype,"angularSensibilityY",void 0),(0,j.d)([(0,A.M)()],y.prototype,"pinchPrecision",void 0),(0,j.d)([(0,A.M)()],y.prototype,"pinchDeltaPercentage",void 0),(0,j.d)([(0,A.M)()],y.prototype,"useNaturalPinchZoom",void 0),(0,j.d)([(0,A.M)()],y.prototype,"pinchZoom",void 0),(0,j.d)([(0,A.M)()],y.prototype,"panningSensibility",void 0),(0,j.d)([(0,A.M)()],y.prototype,"multiTouchPanning",void 0),(0,j.d)([(0,A.M)()],y.prototype,"multiTouchPanAndZoom",void 0),C.d.ArcRotateCameraPointersInput=y;var i=m(11632);class g{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(h){h=T.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ih(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const m=d.event;if(!m.metaKey)if(d.type===i.b.KEYDOWN){if(this._ctrlPressed=m.ctrlKey,this._altPressed=m.altKey,-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysReset.indexOf(m.keyCode)){-1===this._keys.indexOf(m.keyCode)&&this._keys.push(m.keyCode),m.preventDefault&&(h||m.preventDefault())}}else if(-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysReset.indexOf(m.keyCode)){const d=this._keys.indexOf(m.keyCode);d>=0&&this._keys.splice(d,1),m.preventDefault&&(h||m.preventDefault())}})))}xq(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let d=0;d<this._keys.length;d++){const m=this._keys[d];-1!==this.keysLeft.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX-=1/this.panningSensibility:h.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset+=1/this.zoomingSensibility:h.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX+=1/this.panningSensibility:h.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(m)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset-=1/this.zoomingSensibility:h.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(m)&&h.useInputToRestoreState&&h.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,j.d)([(0,A.M)()],g.prototype,"keysUp",void 0),(0,j.d)([(0,A.M)()],g.prototype,"keysDown",void 0),(0,j.d)([(0,A.M)()],g.prototype,"keysLeft",void 0),(0,j.d)([(0,A.M)()],g.prototype,"keysRight",void 0),(0,j.d)([(0,A.M)()],g.prototype,"keysReset",void 0),(0,j.d)([(0,A.M)()],g.prototype,"panningSensibility",void 0),(0,j.d)([(0,A.M)()],g.prototype,"zoomingSensibility",void 0),(0,j.d)([(0,A.M)()],g.prototype,"useAltToZoom",void 0),(0,j.d)([(0,A.M)()],g.prototype,"angularSpeed",void 0),C.d.ArcRotateCameraKeyboardMoveInput=g;var F=m(11337),f=m(11635);class H{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new w.i(0,0,0),this._globalOffset=new w.i(0,0,0),this._inertialPanning=w.i.Zero()}_computeDeltaFromMouseWheelLegacyEvent(h,d){let m=0;const j=.01*h*this.wheelDeltaPercentage*d;return m=h>0?j/(1+this.wheelDeltaPercentage):j*(1+this.wheelDeltaPercentage),m}attachControl(h){h=T.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==M.d.POINTERWHEEL)return;const m=d.event;let j=0;const A=m.deltaMode===f.e.DOM_DELTA_LINE?40:1,b=-m.deltaY*A;if(this.customComputeDeltaFromMouseWheel)j=this.customComputeDeltaFromMouseWheel(b,this,m);else if(this.wheelDeltaPercentage){if(j=this._computeDeltaFromMouseWheelLegacyEvent(b,this.camera.radius),j>0){let h=this.camera.radius,d=this.camera.inertialRadiusOffset+j;for(let m=0;m<20&&!(h<=d)&&!(Math.abs(d*this.camera.inertia)<.001);m++)h-=d,d*=this.camera.inertia;h=(0,a.Clamp)(h,0,Number.MAX_VALUE),j=this._computeDeltaFromMouseWheelLegacyEvent(b,h)}}else j=b/(40*this.wheelPrecision);j&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(j)):this.camera.inertialRadiusOffset+=j),m.preventDefault&&(h||m.preventDefault())},this._observer=this.camera.ih()._inputManager._addCameraPointerObserver(this._wheel,M.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.sd(0)}xq(){this._observer&&(this.camera.ih()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const h=this.camera;0+h.inertialAlphaOffset+h.inertialBetaOffset+h.inertialRadiusOffset&&(this._updateHitPlane(),h.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(h.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const h=this.camera,d=h.target.fm(h.position);this._hitPlane=F.e.FromPositionAndNormal(h.target,d)}_getPosition(){const h=this.camera,d=h.ih(),m=d.createPickingRay(d.pointerX,d.pointerY,w.b.Identity(),h,!1);0===h.targetScreenOffset.x&&0===h.targetScreenOffset.y||(this._viewOffset.set(h.targetScreenOffset.x,h.targetScreenOffset.y,0),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),this._globalOffset=w.i.TransformNormal(this._viewOffset,h._cameraTransformMatrix),m.origin.addInPlace(this._globalOffset));let j=0;return this._hitPlane&&(j=m.intersectsPlane(this._hitPlane)??0),m.origin.addInPlace(m.direction.scaleInPlace(j))}_zoomToMouse(h){const d=this.camera,m=1-d.inertia;if(d.lowerRadiusLimit){const j=d.lowerRadiusLimit??0;d.radius-(d.inertialRadiusOffset+h)/m<j&&(h=(d.radius-j)*m-d.inertialRadiusOffset)}if(d.upperRadiusLimit){const j=d.upperRadiusLimit??0;d.radius-(d.inertialRadiusOffset+h)/m>j&&(h=(d.radius-j)*m-d.inertialRadiusOffset)}const j=h/m/d.radius,A=this._getPosition(),b=w.d.Qd[6];A.subtractToRef(d.target,b),b.scaleInPlace(j),b.scaleInPlace(m),this._inertialPanning.addInPlace(b),d.inertialRadiusOffset+=h}_zeroIfClose(h){Math.abs(h.x)<E.c&&(h.x=0),Math.abs(h.y)<E.c&&(h.y=0),Math.abs(h.z)<E.c&&(h.z=0)}}(0,j.d)([(0,A.M)()],H.prototype,"wheelPrecision",void 0),(0,j.d)([(0,A.M)()],H.prototype,"zoomToMouseLocation",void 0),(0,j.d)([(0,A.M)()],H.prototype,"wheelDeltaPercentage",void 0),C.d.ArcRotateCameraMouseWheelInput=H;class c extends C.g{constructor(h){super(h)}addMouseWheel(){return this.add(new H),this}addPointers(){return this.add(new y),this}addKeyboard(){return this.add(new g),this}}var k=m(11080);function l(h,d){return isNaN(h)?d:h}D.b.AddNodeConstructor("ArcRotateCamera",((h,d)=>()=>new K(h,0,0,1,w.i.Zero(),d)));class K extends v.e{get target(){return this._target}set target(h){this.setTarget(h)}get targetHost(){return this._targetHost}set targetHost(h){h&&this.setTarget(h)}getTarget(){return this.target}get position(){return this._position}set position(h){this.setPosition(h)}set upVector(h){this._upToYMatrix||(this._yToUpMatrix=new w.b,this._upToYMatrix=new w.b,this._upVector=w.i.Zero()),h.normalize(),this._upVector.D(h),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){w.b.RotationAlignToRef(w.i.UpReadOnly,this._upVector,this._yToUpMatrix),w.b.RotationAlignToRef(this._upVector,w.i.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityX:0}set angularSensibilityX(h){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityX=h)}get angularSensibilityY(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityY:0}set angularSensibilityY(h){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityY=h)}get pinchPrecision(){const h=this.inputs.attached.pointers;return h?h.pinchPrecision:0}set pinchPrecision(h){const d=this.inputs.attached.pointers;d&&(d.pinchPrecision=h)}get pinchDeltaPercentage(){const h=this.inputs.attached.pointers;return h?h.pinchDeltaPercentage:0}set pinchDeltaPercentage(h){const d=this.inputs.attached.pointers;d&&(d.pinchDeltaPercentage=h)}get useNaturalPinchZoom(){const h=this.inputs.attached.pointers;return!!h&&h.useNaturalPinchZoom}set useNaturalPinchZoom(h){const d=this.inputs.attached.pointers;d&&(d.useNaturalPinchZoom=h)}get panningSensibility(){const h=this.inputs.attached.pointers;return h?h.panningSensibility:0}set panningSensibility(h){const d=this.inputs.attached.pointers;d&&(d.panningSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const d=this.inputs.attached.keyboard;d&&(d.keysUp=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const d=this.inputs.attached.keyboard;d&&(d.keysDown=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const d=this.inputs.attached.keyboard;d&&(d.keysRight=h)}get wheelPrecision(){const h=this.inputs.attached.mousewheel;return h?h.wheelPrecision:0}set wheelPrecision(h){const d=this.inputs.attached.mousewheel;d&&(d.wheelPrecision=h)}get zoomToMouseLocation(){const h=this.inputs.attached.mousewheel;return!!h&&h.zoomToMouseLocation}set zoomToMouseLocation(h){const d=this.inputs.attached.mousewheel;d&&(d.zoomToMouseLocation=h)}get wheelDeltaPercentage(){const h=this.inputs.attached.mousewheel;return h?h.wheelDeltaPercentage:0}set wheelDeltaPercentage(h){const d=this.inputs.attached.mousewheel;d&&(d.wheelDeltaPercentage=h)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(h){h!==this.useBouncingBehavior&&(h?(this._bouncingBehavior=new L,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(h){h!==this.useFramingBehavior&&(h?(this._framingBehavior=new B,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(h){h!==this.useAutoRotationBehavior&&(h?(this._autoRotationBehavior=new I,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(h,d,m,j,A,a){var D;let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(h,w.i.Zero(),a,S),D=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=w.i.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=w.h.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new w.b,this.panningAxis=new w.i(1,1,0),this._transformedDirection=new w.i,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new b.e,this.checkCollisions=!1,this.collisionRadius=new w.i(.5,.5,.5),this._previousPosition=w.i.Zero(),this._collisionVelocity=w.i.Zero(),this._newPosition=w.i.Zero(),this._computationVector=w.i.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new w.i(NaN,NaN,NaN),this._goalTargetScreenOffset=new w.h(NaN,NaN),this._onCollisionPositionChange=function(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m?(D.setPosition(d),D.yI&&D.yI(m)):D._previousPosition.D(D._position);const j=Math.cos(D.alpha),A=Math.sin(D.alpha),b=Math.cos(D.beta);let w=Math.sin(D.beta);0===w&&(w=1e-4);const a=D._getTargetPosition();D._computationVector.xd(D.radius*j*w,D.radius*b,D.radius*A*w),a.addToRef(D._computationVector,D._newPosition),D._position.D(D._newPosition);let S=D.upVector;D.allowUpsideDown&&D.beta<0&&(S=S.clone(),S=S.negate()),D._computeViewMatrix(D._position,a,S),D._viewMatrix.addAtIndex(12,D.targetScreenOffset.x),D._viewMatrix.addAtIndex(13,D.targetScreenOffset.y),D._collisionTriggered=!1},this._target=w.i.Zero(),A&&this.setTarget(A),this.alpha=d,this.beta=m,this.radius=j,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new w.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=w.h.Zero()}_updateCache(h){h||super._updateCache(),this._cache._target.D(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.D(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const h=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?h.addToRef(this._targetBoundingCenter,this._target):this._target.D(h)}const h=this._getLockedTargetPosition();return h||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>E.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,b=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=b?this._currentInterpolationFactor=b:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=l(h,this._goalAlpha),this._goalBeta=l(d,this._goalBeta),this._goalRadius=l(m,this._goalRadius),this._goalTarget.set(l(j.x,this._goalTarget.x),l(j.y,this._goalTarget.y),l(j.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(l(A.x,this._goalTargetScreenOffset.x),l(A.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,a.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,a.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,a.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,a.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const A=arguments;d=T.e.BackCompatCameraNoPreventDefault(A),this._useCtrlForPanning=m,this._panningMouseButton=j,"boolean"===typeof A[0]&&(A.length>1&&(this._useCtrlForPanning=A[1]),A.length>2&&(this._panningMouseButton=A[2])),this.inputs.attachElement(d),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}xq(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let h=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){h=!0;const d=this.invertRotation?-1:1,m=this._calculateHandednessMultiplier();let j=this.inertialAlphaOffset*m;this.beta<0&&(j*=-1),this.alpha+=j*d,this.beta+=this.inertialBetaOffset*d,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<E.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<E.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*E.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){h=!0;const d=new w.i(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.multiplyInPlace(this.panningAxis),w.i.TransformNormalToRef(d,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const h=this.upVector,d=w.i.CrossToRef(this._transformedDirection,h,this._transformedDirection);w.i.CrossToRef(h,d,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);w.i.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.D(this._transformedDirection)}else{if(this.parent){const h=w.d.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.transposeToRef(h),w.i.TransformCoordinatesToRef(this._transformedDirection,h,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*E.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*E.c&&(this.inertialPanningY=0)}if(h)this.stopInterpolation();else if(this._isInterpolating){let h=!1;const d=this._scene.getEngine().getDeltaTime()/1e3,m=1-Math.pow(2,-d/this._currentInterpolationFactor),j=l(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const d=w.d.Qd[0].set(l(this._goalTarget.x,this._target.x),l(this._goalTarget.y,this._target.y),l(this._goalTarget.z,this._target.z));w.i.LerpToRef(this.target,d,m,this._target),10*w.i.Distance(this.target,d)/j<E.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.D(d),this.setTarget(this.target,!1,!0,!0)):h=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const d=w.c.RotationAlphaBetaGammaToRef(l(this._goalAlpha,this.alpha),l(this._goalBeta,this.beta),0,w.d.Quaternion[0]),j=w.c.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,w.d.Quaternion[1]),A=w.c.SlerpToRef(j,d,m,w.d.Quaternion[2]);A.normalize();const b=A.toAlphaBetaGammaToRef(w.d.Qd[0]);if(this.alpha=b.x,this.beta=b.y,A.isApprox(d,E.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const h=d.toAlphaBetaGammaToRef(w.d.Qd[0]);this.alpha=h.x,this.beta=h.y}else h=!0}if(isNaN(this._goalRadius)||(this.radius+=(j-this.radius)*m,Math.abs(j/this.radius-1)<E.c?(this._goalRadius=NaN,this.radius=j):h=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const d=w.d.Vector2[0].set(l(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),l(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));w.h.LerpToRef(this.targetScreenOffset,d,m,this.targetScreenOffset),w.h.Distance(this.targetScreenOffset,d)<E.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.D(d)):h=!0}this._isInterpolating=h}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||w.i.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const h=this.alpha;var d,m;this.alpha=function(h){let d=Math.PI/2;return 0===h.x&&0===h.z||(d=Math.acos(h.x/Math.sqrt(Math.pow(h.x,2)+Math.pow(h.z,2)))),h.z<0&&(d=2*Math.PI-d),d}(this._computationVector),this.beta=(d=this._computationVector.y,m=this.radius,Math.acos(d/m));const j=Math.round((h-this.alpha)/(2*Math.PI));this.alpha+=2*j*Math.PI,this._checkLimits()}setPosition(h){this._position.equals(h)||(this._position.D(h),this.rebuildAnglesAndRadius())}setTarget(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(j=this.overrideCloneAlphaBetaRadius??j,h.Zd)d&&h.getBoundingInfo?this._targetBoundingCenter=h.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,h.Zd(),this._targetHost=h,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const d=h,j=this._getTargetPosition();if(j&&!m&&j.equals(d))return;this._targetHost=null,this._target=d,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}j||this.rebuildAnglesAndRadius()}_getViewMatrix(){const h=Math.cos(this.alpha),d=Math.sin(this.alpha),m=Math.cos(this.beta);let j=Math.sin(this.beta);0===j&&(j=1e-4),0===this.radius&&(this.radius=1e-4);const A=this._getTargetPosition();if(this._computationVector.xd(this.radius*h*j,this.radius*m,this.radius*d*j),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||w.i.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),A.addToRef(this._computationVector,this._newPosition),this.ih().collisionsEnabled&&this.checkCollisions){const h=this.ih().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.D(this._newPosition);let h=this.upVector;this.allowUpsideDown&&j<0&&(h=h.negate()),this._computeViewMatrix(this._position,A,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.D(A),this._viewMatrix}zoomOn(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h||this.ih().meshes;const m=S.d.MinMax(h);let j=this._calculateLowerRadiusFromModelBoundingSphere(m.min,m.max);if(j=Math.max(Math.min(j,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=j*this.zoomOnFactor,this.mode===V.e.ORTHOGRAPHIC_CAMERA){const h=this.ih().getEngine().getAspectRatio(this),d=j*this.zoomOnFactor/2;this.orthoLeft=-d*h,this.orthoRight=d*h,this.orthoBottom=-d,this.orthoTop=d}this.focusOn({min:m.min,max:m.max,distance:j},d)}focusOn(h){let d,m,j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===h.min){const j=h||this.ih().meshes;d=S.d.MinMax(j),m=w.i.Distance(d.min,d.max)}else{d=h,m=h.distance}this._target=S.d.Center(d),j||(this.maxZ=2*m)}createRigCamera(h,d){let m=0;switch(this.cameraRigMode){case V.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.e.RIG_MODE_VR:m=this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:m=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}const j=new K(h,this.alpha+m,this.beta,this.radius,this._target,this.ih());return j._cameraRigParams={},j.isRigCamera=!0,j.rigParent=this,j.upVector=this.upVector,j.mode=this.mode,j.orthoLeft=this.orthoLeft,j.orthoRight=this.orthoRight,j.orthoBottom=this.orthoBottom,j.orthoTop=this.orthoTop,j}_updateRigCameras(){const h=this._rigCameras[0],d=this._rigCameras[1];switch(h.beta=d.beta=this.beta,this.cameraRigMode){case V.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.e.RIG_MODE_VR:h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const j=w.i.Distance(h,d),A=this.ih().getEngine().getAspectRatio(this),b=Math.tan(this.fov/2),a=b*A,D=.5*j*m,S=D*Math.sqrt(1+1/(a*a)),M=D*Math.sqrt(1+1/(b*b));return Math.max(S,M)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,j.d)([(0,A.M)()],K.prototype,"alpha",void 0),(0,j.d)([(0,A.M)()],K.prototype,"beta",void 0),(0,j.d)([(0,A.M)()],K.prototype,"radius",void 0),(0,j.d)([(0,A.M)()],K.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,j.d)([(0,A.K)("target")],K.prototype,"_target",void 0),(0,j.d)([(0,A.w)("targetHost")],K.prototype,"_targetHost",void 0),(0,j.d)([(0,A.M)()],K.prototype,"inertialAlphaOffset",void 0),(0,j.d)([(0,A.M)()],K.prototype,"inertialBetaOffset",void 0),(0,j.d)([(0,A.M)()],K.prototype,"inertialRadiusOffset",void 0),(0,j.d)([(0,A.M)()],K.prototype,"lowerAlphaLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"upperAlphaLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"lowerBetaLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"upperBetaLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"lowerRadiusLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"upperRadiusLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"lowerTargetYLimit",void 0),(0,j.d)([(0,A.M)()],K.prototype,"inertialPanningX",void 0),(0,j.d)([(0,A.M)()],K.prototype,"inertialPanningY",void 0),(0,j.d)([(0,A.M)()],K.prototype,"pinchToPanMaxDistance",void 0),(0,j.d)([(0,A.M)()],K.prototype,"panningDistanceLimit",void 0),(0,j.d)([(0,A.K)()],K.prototype,"panningOriginTarget",void 0),(0,j.d)([(0,A.M)()],K.prototype,"panningInertia",void 0),(0,j.d)([(0,A.M)()],K.prototype,"zoomToMouseLocation",null),(0,j.d)([(0,A.M)()],K.prototype,"zoomOnFactor",void 0),(0,j.d)([(0,A.G)()],K.prototype,"targetScreenOffset",void 0),(0,j.d)([(0,A.M)()],K.prototype,"allowUpsideDown",void 0),(0,j.d)([(0,A.M)()],K.prototype,"useInputToRestoreState",void 0),(0,j.d)([(0,A.M)()],K.prototype,"restoreStateInterpolationFactor",void 0),(0,k.i)("BABYLON.ArcRotateCamera",K)},12585:(h,d,m)=>{"use strict";m.d(d,{d:()=>w,g:()=>a});var j=m(11121),A=m(11341),b=m(11427),w={};class a{constructor(h){this.attachedToElement=!1,this.attached={},this.camera=h,this.checkInputs=()=>{}}add(h){const d=h.getSimpleName();this.attached[d]?j.c.Warn("camera input of type "+d+" already exists on camera"):(this.attached[d]=h,h.camera=this.camera,h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h))),this.attachedToElement&&h.attachControl(this.noPreventDefault))}remove(h){for(const d in this.attached){const m=this.attached[d];if(m===h)return m.xq(),m.camera=null,delete this.attached[d],void this.rebuildInputCheck()}}removeByType(h){for(const d in this.attached){const m=this.attached[d];m.getClassName()===h&&(m.xq(),m.camera=null,delete this.attached[d],this.rebuildInputCheck())}}_addCheckInputs(h){const d=this.checkInputs;return()=>{d(),h()}}attachInput(h){this.attachedToElement&&h.attachControl(this.noPreventDefault)}attachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){h=!b.e.ForceAttachControlToAlwaysPreventDefault&&h,this.attachedToElement=!0,this.noPreventDefault=h;for(const d in this.attached)this.attached[d].attachControl(h)}}detachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const d in this.attached)this.attached[d].xq(),h&&(this.attached[d].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const h in this.attached){const d=this.attached[h];d.checkInputs&&(this.checkInputs=this._addCheckInputs(d.checkInputs.bind(d)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(h){const d={};for(const m in this.attached){const h=this.attached[m],j=A.d.Serialize(h);d[h.getClassName()]=j}h.inputsmgr=d}parse(h){const d=h.inputsmgr;if(d){this.clear();for(const h in d){const m=w[h];if(m){const j=d[h],b=A.d.Parse((()=>new m),j,null);this.add(b)}}}else for(const m in this.attached){const d=w[this.attached[m].getClassName()];if(d){const j=A.d.Parse((()=>new d),h,null);this.remove(this.attached[m]),this.add(j)}}}}},12582:(h,d,m)=>{"use strict";m.d(d,{b:()=>o});var j=m(11258),A=m(11261),b=m(11058),w=m(11587),a=m(12585),D=m(11632),S=m(11107);class M{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(h){h=S.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ih(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const m=d.event;if(!m.metaKey)if(d.type===D.b.KEYDOWN){if(-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysUpward.indexOf(m.keyCode)||-1!==this.keysDownward.indexOf(m.keyCode)||-1!==this.keysRotateLeft.indexOf(m.keyCode)||-1!==this.keysRotateRight.indexOf(m.keyCode)||-1!==this.keysRotateUp.indexOf(m.keyCode)||-1!==this.keysRotateDown.indexOf(m.keyCode)){-1===this._keys.indexOf(m.keyCode)&&this._keys.push(m.keyCode),h||m.preventDefault()}}else if(-1!==this.keysUp.indexOf(m.keyCode)||-1!==this.keysDown.indexOf(m.keyCode)||-1!==this.keysLeft.indexOf(m.keyCode)||-1!==this.keysRight.indexOf(m.keyCode)||-1!==this.keysUpward.indexOf(m.keyCode)||-1!==this.keysDownward.indexOf(m.keyCode)||-1!==this.keysRotateLeft.indexOf(m.keyCode)||-1!==this.keysRotateRight.indexOf(m.keyCode)||-1!==this.keysRotateUp.indexOf(m.keyCode)||-1!==this.keysRotateDown.indexOf(m.keyCode)){const d=this._keys.indexOf(m.keyCode);d>=0&&this._keys.splice(d,1),h||m.preventDefault()}})))}xq(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let d=0;d<this._keys.length;d++){const m=this._keys[d],j=h._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(m)?h._localDirection.xd(-j,0,0):-1!==this.keysUp.indexOf(m)?h._localDirection.xd(0,0,j):-1!==this.keysRight.indexOf(m)?h._localDirection.xd(j,0,0):-1!==this.keysDown.indexOf(m)?h._localDirection.xd(0,0,-j):-1!==this.keysUpward.indexOf(m)?h._localDirection.xd(0,j,0):-1!==this.keysDownward.indexOf(m)?h._localDirection.xd(0,-j,0):-1!==this.keysRotateLeft.indexOf(m)?(h._localDirection.xd(0,0,0),h.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(m)?(h._localDirection.xd(0,0,0),h.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(m)?(h._localDirection.xd(0,0,0),h.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(m)&&(h._localDirection.xd(0,0,0),h.cameraRotation.x+=this._getLocalRotation()),h.ih().useRightHandedSystem&&(h._localDirection.z*=-1),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),b.i.TransformNormalToRef(h._localDirection,h._cameraTransformMatrix,h._transformedDirection),h.cameraDirection.addInPlace(h._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const h=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*h}}(0,j.d)([(0,A.M)()],M.prototype,"keysUp",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysUpward",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysDown",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysDownward",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysLeft",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysRight",void 0),(0,j.d)([(0,A.M)()],M.prototype,"rotationSpeed",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysRotateLeft",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysRotateRight",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysRotateUp",void 0),(0,j.d)([(0,A.M)()],M.prototype,"keysRotateDown",void 0),a.d.FreeCameraKeyboardMoveInput=M;var q=m(11097),E=m(11624);class I{constructor(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=h,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new q.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(h){h=S.e.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),m=d.getInputElement();this._pointerInput||(this._pointerInput=j=>{const A=j.event,b="touch"===A.pointerType;if(!this.touchEnabled&&b)return;if(j.type!==E.d.POINTERMOVE&&-1===this.buttons.indexOf(A.button))return;const w=A.target;if(j.type===E.d.POINTERDOWN){if(b&&-1!==this._activePointerId||!b&&-1!==this._currentActiveButton)return;this._activePointerId=A.pointerId;try{null===w||void 0===w||w.setPointerCapture(A.pointerId)}catch(a){}-1===this._currentActiveButton&&(this._currentActiveButton=A.button),this._previousPosition={x:A.clientX,y:A.clientY},h||(A.preventDefault(),m&&m.focus()),d.isPointerLock&&this._onMouseMove&&this._onMouseMove(j.event)}else if(j.type===E.d.POINTERUP){if(b&&this._activePointerId!==A.pointerId||!b&&this._currentActiveButton!==A.button)return;try{null===w||void 0===w||w.releasePointerCapture(A.pointerId)}catch(a){}this._currentActiveButton=-1,this._previousPosition=null,h||A.preventDefault(),this._activePointerId=-1}else if(j.type===E.d.POINTERMOVE&&(this._activePointerId===A.pointerId||!b))if(d.isPointerLock&&this._onMouseMove)this._onMouseMove(j.event);else if(this._previousPosition){const d=this.camera._calculateHandednessMultiplier(),m=(A.clientX-this._previousPosition.x)*d,j=A.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=m/this.angularSensibility,this.camera.cameraRotation.x+=j/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:m,offsetY:j}),this._previousPosition={x:A.clientX,y:A.clientY},h||A.preventDefault()}}),this._onMouseMove=m=>{if(!d.isPointerLock)return;const j=this.camera._calculateHandednessMultiplier(),A=m.movementX*j;this.camera.cameraRotation.y+=A/this.angularSensibility;const b=m.movementY;this.camera.cameraRotation.x+=b/this.angularSensibility,this._previousPosition=null,h||m.preventDefault()},this._observer=this.camera.ih()._inputManager._addCameraPointerObserver(this._pointerInput,E.d.POINTERDOWN|E.d.POINTERUP|E.d.POINTERMOVE),m&&(this._contextMenuBind=h=>this.onContextMenu(h),m.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(h){h.preventDefault()}xq(){if(this._observer){if(this.camera.ih()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,j.d)([(0,A.M)()],I.prototype,"buttons",void 0),(0,j.d)([(0,A.M)()],I.prototype,"angularSensibility",void 0),a.d.FreeCameraMouseInput=I;var R,Z=m(11635);class L{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new q.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(h){h=S.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==E.d.POINTERWHEEL)return;const m=d.event,j=m.deltaMode===Z.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*j*m.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*j*m.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*j*m.deltaZ/this._normalize,m.preventDefault&&(h||m.preventDefault())},this._observer=this.camera.ih()._inputManager._addCameraPointerObserver(this._wheel,E.d.POINTERWHEEL)}xq(){this._observer&&(this.camera.ih()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,j.d)([(0,A.M)()],L.prototype,"wheelPrecisionX",void 0),(0,j.d)([(0,A.M)()],L.prototype,"wheelPrecisionY",void 0),(0,j.d)([(0,A.M)()],L.prototype,"wheelPrecisionZ",void 0),function(h){h[h.MoveRelative=0]="MoveRelative",h[h.RotateRelative=1]="RotateRelative",h[h.MoveScene=2]="MoveScene"}(R||(R={}));class B extends L{constructor(){super(...arguments),this._moveRelative=b.i.Zero(),this._rotateRelative=b.i.Zero(),this._moveScene=b.i.Zero(),this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(h){null===h&&this._wheelXAction!==R.MoveRelative||(this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=h)}get wheelXMoveRelative(){return this._wheelXAction!==R.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(h){null===h&&this._wheelYAction!==R.MoveRelative||(this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=h)}get wheelYMoveRelative(){return this._wheelYAction!==R.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(h){null===h&&this._wheelZAction!==R.MoveRelative||(this._wheelZAction=R.MoveRelative,this._wheelZActionCoordinate=h)}get wheelZMoveRelative(){return this._wheelZAction!==R.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(h){null===h&&this._wheelXAction!==R.RotateRelative||(this._wheelXAction=R.RotateRelative,this._wheelXActionCoordinate=h)}get wheelXRotateRelative(){return this._wheelXAction!==R.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(h){null===h&&this._wheelYAction!==R.RotateRelative||(this._wheelYAction=R.RotateRelative,this._wheelYActionCoordinate=h)}get wheelYRotateRelative(){return this._wheelYAction!==R.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(h){null===h&&this._wheelZAction!==R.RotateRelative||(this._wheelZAction=R.RotateRelative,this._wheelZActionCoordinate=h)}get wheelZRotateRelative(){return this._wheelZAction!==R.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(h){null===h&&this._wheelXAction!==R.MoveScene||(this._wheelXAction=R.MoveScene,this._wheelXActionCoordinate=h)}get wheelXMoveScene(){return this._wheelXAction!==R.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(h){null===h&&this._wheelYAction!==R.MoveScene||(this._wheelYAction=R.MoveScene,this._wheelYActionCoordinate=h)}get wheelYMoveScene(){return this._wheelYAction!==R.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(h){null===h&&this._wheelZAction!==R.MoveScene||(this._wheelZAction=R.MoveScene,this._wheelZActionCoordinate=h)}get wheelZMoveScene(){return this._wheelZAction!==R.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.sd(0),this._rotateRelative.sd(0),this._moveScene.sd(0),this._updateCamera(),this.camera.ih().useRightHandedSystem&&(this._moveRelative.z*=-1);const h=b.b.Zero();this.camera.getViewMatrix().invertToRef(h);const d=b.i.Zero();b.i.TransformNormalToRef(this._moveRelative,h,d),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(d),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(h,d,m){if(0===h)return;if(null===d||null===m)return;let j=null;switch(d){case R.MoveRelative:j=this._moveRelative;break;case R.RotateRelative:j=this._rotateRelative;break;case R.MoveScene:j=this._moveScene}switch(m){case 0:j.set(h,0,0);break;case 1:j.set(0,h,0);break;case 2:j.set(0,0,h)}}}(0,j.d)([(0,A.M)()],B.prototype,"wheelXMoveRelative",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelYMoveRelative",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelZMoveRelative",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelXRotateRelative",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelYRotateRelative",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelZRotateRelative",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelXMoveScene",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelYMoveScene",null),(0,j.d)([(0,A.M)()],B.prototype,"wheelZMoveScene",null),a.d.FreeCameraMouseWheelInput=B;class V{constructor(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=h,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=S.e.IsSafari()}attachControl(h){h=S.e.BackCompatCameraNoPreventDefault(arguments);let d=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=m=>{const j=m.event,A="mouse"===j.pointerType||this._isSafari&&"undefined"===typeof j.pointerType;if(this.allowMouse||!A)if(m.type===E.d.POINTERDOWN){if(h||j.preventDefault(),this._pointerPressed.push(j.pointerId),1!==this._pointerPressed.length)return;d={x:j.clientX,y:j.clientY}}else if(m.type===E.d.POINTERUP){h||j.preventDefault();const m=this._pointerPressed.indexOf(j.pointerId);if(-1===m)return;if(this._pointerPressed.splice(m,1),0!=m)return;d=null,this._offsetX=null,this._offsetY=null}else if(m.type===E.d.POINTERMOVE){if(h||j.preventDefault(),!d)return;if(0!=this._pointerPressed.indexOf(j.pointerId))return;this._offsetX=j.clientX-d.x,this._offsetY=-(j.clientY-d.y)}}),this._observer=this.camera.ih()._inputManager._addCameraPointerObserver(this._pointerInput,E.d.POINTERDOWN|E.d.POINTERUP|E.d.POINTERMOVE),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.addEventListener("blur",this._onLostFocus)}}xq(){if(this._pointerInput){if(this._observer&&(this.camera.ih()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const h=this.camera,d=h._calculateHandednessMultiplier();h.cameraRotation.y=d*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)h.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const d=h._computeLocalCameraSpeed(),m=new b.i(0,0,0!==this.touchMoveSensibility?d*this._offsetY/this.touchMoveSensibility:0);b.b.RotationYawPitchRollToRef(h.rotation.y,h.rotation.x,0,h._cameraRotationMatrix),h.cameraDirection.addInPlace(b.i.TransformCoordinates(m,h._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,j.d)([(0,A.M)()],V.prototype,"touchAngularSensibility",void 0),(0,j.d)([(0,A.M)()],V.prototype,"touchMoveSensibility",void 0),a.d.FreeCameraTouchInput=V;class v extends a.g{constructor(h){super(h),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new M),this}addMouse(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new I(h),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new V),this}clear(){super.clear(),this._mouseInput=null}}var C=m(11080),T=m(11188);class o extends w.e{get angularSensibility(){const h=this.inputs.attached.mouse;return h?h.angularSensibility:0}set angularSensibility(h){const d=this.inputs.attached.mouse;d&&(d.angularSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const d=this.inputs.attached.keyboard;d&&(d.keysUp=h)}get keysUpward(){const h=this.inputs.attached.keyboard;return h?h.keysUpward:[]}set keysUpward(h){const d=this.inputs.attached.keyboard;d&&(d.keysUpward=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const d=this.inputs.attached.keyboard;d&&(d.keysDown=h)}get keysDownward(){const h=this.inputs.attached.keyboard;return h?h.keysDownward:[]}set keysDownward(h){const d=this.inputs.attached.keyboard;d&&(d.keysDownward=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const d=this.inputs.attached.keyboard;d&&(d.keysRight=h)}get keysRotateLeft(){const h=this.inputs.attached.keyboard;return h?h.keysRotateLeft:[]}set keysRotateLeft(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateLeft=h)}get keysRotateRight(){const h=this.inputs.attached.keyboard;return h?h.keysRotateRight:[]}set keysRotateRight(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateRight=h)}get keysRotateUp(){const h=this.inputs.attached.keyboard;return h?h.keysRotateUp:[]}set keysRotateUp(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateUp=h)}get keysRotateDown(){const h=this.inputs.attached.keyboard;return h?h.keysRotateDown:[]}set keysRotateDown(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateDown=h)}constructor(h,d,m){var j;super(h,d,m,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),j=this,this.ellipsoid=new b.i(.5,1,.5),this.ellipsoidOffset=new b.i(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=b.i.Zero(),this._diffPosition=b.i.Zero(),this._newPosition=b.i.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j._newPosition.D(d),j._newPosition.subtractToRef(j._oldPosition,j._diffPosition),j._diffPosition.length()>T.b.CollisionsEpsilon&&(j.position.addToRef(j._diffPosition,j._deferredPositionUpdate),j._deferOnly?j._deferredUpdated=!0:j.position.D(j._deferredPositionUpdate),j.yI&&m&&j.yI(m))},this.inputs=new v(this),this.inputs.addKeyboard().addMouse()}attachControl(h,d){d=S.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(d)}xq(){this.inputs.detachElement(),this.cameraDirection=new b.i(0,0,0),this.cameraRotation=new b.h(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(h){this._collisionMask=isNaN(h)?-1:h}_collideWithWorld(h){let d;d=this.parent?b.i.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,d.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const m=this.ih().collisionCoordinator;this._collider||(this._collider=m.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let j=h;this.applyGravity&&(j=h.add(this.ih().gravity)),m.getNewPosition(this._oldPosition,j,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=b.i.Zero(),this._transformedDirection=b.i.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(h){this._needMoveForGravity=h}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.ih().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Lb"}}(0,j.d)([(0,A.K)()],o.prototype,"ellipsoid",void 0),(0,j.d)([(0,A.K)()],o.prototype,"ellipsoidOffset",void 0),(0,j.d)([(0,A.M)()],o.prototype,"checkCollisions",void 0),(0,j.d)([(0,A.M)()],o.prototype,"applyGravity",void 0),(0,C.i)("BABYLON.FreeCamera",o)},13157:(h,d,m)=>{"use strict";m.d(d,{c:()=>b});var j=m(11430),A=m(13159);class b{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=m,this.bq=[],this._maxBlockCapacity=d||64,this._selectionContent=new j.c(1024),this._creationFunc=h}update(h,d,m){A.c._CreateBlocks(h,d,m,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}qM(h){for(let d=0;d<this.iM.length;d++){this.iM[d].addEntry(h)}}MM(h){for(let d=0;d<this.iM.length;d++){this.iM[d].removeEntry(h)}}select(h,d){this._selectionContent.reset();for(let m=0;m<this.iM.length;m++){this.iM[m].select(h,this._selectionContent,d)}return d?this._selectionContent.concat(this.bq):this._selectionContent.concatWithNoDuplicate(this.bq),this._selectionContent}intersects(h,d,m){this._selectionContent.reset();for(let j=0;j<this.iM.length;j++){this.iM[j].intersects(h,d,this._selectionContent,m)}return m?this._selectionContent.concat(this.bq):this._selectionContent.concatWithNoDuplicate(this.bq),this._selectionContent}intersectsRay(h){this._selectionContent.reset();for(let d=0;d<this.iM.length;d++){this.iM[d].intersectsRay(h,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bq),this._selectionContent}}b.CreationFuncForMeshes=(h,d)=>{const m=h.getBoundingInfo();!h.isBlocked&&m.boundingBox.intersectsMinMax(d.Sq,d.Mq)&&d.entries.push(h)},b.CreationFuncForSubMeshes=(h,d)=>{h.getBoundingInfo().boundingBox.intersectsMinMax(d.Sq,d.Mq)&&d.entries.push(h)}},13159:(h,d,m)=>{"use strict";m.d(d,{c:()=>b});var j=m(11058),A=m(11309);class b{constructor(h,d,m,j,A,b){this.entries=[],this.qq=new Array,this._capacity=m,this._depth=j,this._maxDepth=A,this._creationFunc=b,this._minPoint=h,this._maxPoint=d,this.qq.push(h.clone()),this.qq.push(d.clone()),this.qq.push(h.clone()),this.qq[2].x=d.x,this.qq.push(h.clone()),this.qq[3].y=d.y,this.qq.push(h.clone()),this.qq[4].z=d.z,this.qq.push(d.clone()),this.qq[5].z=h.z,this.qq.push(d.clone()),this.qq[6].x=h.x,this.qq.push(d.clone()),this.qq[7].y=h.y}get km(){return this._capacity}get Sq(){return this._minPoint}get Mq(){return this._maxPoint}addEntry(h){if(this.iM)for(let d=0;d<this.iM.length;d++){this.iM[d].addEntry(h)}else this._creationFunc(h,this),this.entries.length>this.km&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(h){if(this.iM){for(let d=0;d<this.iM.length;d++){this.iM[d].removeEntry(h)}return}const d=this.entries.indexOf(h);d>-1&&this.entries.splice(d,1)}addEntries(h){for(let d=0;d<h.length;d++){const m=h[d];this.addEntry(m)}}select(h,d,m){if(A.e.IsInFrustum(this.qq,h)){if(this.iM){for(let j=0;j<this.iM.length;j++){this.iM[j].select(h,d,m)}return}m?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersects(h,d,m,j){if(A.e.IntersectsSphere(this._minPoint,this._maxPoint,h,d)){if(this.iM){for(let A=0;A<this.iM.length;A++){this.iM[A].intersects(h,d,m,j)}return}j?m.concat(this.entries):m.concatWithNoDuplicate(this.entries)}}intersectsRay(h,d){if(h.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.iM){for(let m=0;m<this.iM.length;m++){this.iM[m].intersectsRay(h,d)}return}d.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){b._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(h,d,m,A,w,a,D,S){D.iM=new Array;const M=new j.i((d.x-h.x)/2,(d.y-h.y)/2,(d.z-h.z)/2);for(let j=0;j<2;j++)for(let d=0;d<2;d++)for(let q=0;q<2;q++){const E=h.add(M.multiplyByFloats(j,d,q)),I=h.add(M.multiplyByFloats(j+1,d+1,q+1)),R=new b(E,I,A,w+1,a,S);R.addEntries(m),D.iM.push(R)}}}},13162:(h,d,m)=>{"use strict";m.d(d,{b:()=>M});var j=m(11604),A=m(11058),b=m(11380),w=m(12348),a=m(11461),D=m(13157),S=m(11094);j.c.prototype.createOrUpdateSelectionOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,m=this._getComponent(a.b.NAME_OCTREE);m||(m=new M(this),this.o(m)),this.jq||(this.jq=new D.c(D.c.CreationFuncForMeshes,h,d));const j=this.getWorldExtends();return this.jq.update(j.min,j.max,this.meshes),this.jq},Object.defineProperty(j.c.prototype,"selectionOctree",{get:function(){return this.jq},enumerable:!0,configurable:!0}),b.b.prototype.createOrUpdateSubmeshesOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const m=this.ih();let j=m._getComponent(a.b.NAME_OCTREE);j||(j=new M(m),m.o(j)),this._submeshesOctree||(this._submeshesOctree=new D.c(D.c.CreationFuncForSubMeshes,h,d)),this.Zd(!0);const A=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(A.minimumWorld,A.maximumWorld,this.Ab),this._submeshesOctree};class M{constructor(h){this.name=a.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new w.e(A.i.Zero(),new A.i(1,1,1)),(h=h||S.b.LastCreatedScene)&&(this.Fd=h,this.Fd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Fd.getActiveSubMeshCandidates=h=>this.getActiveSubMeshCandidates(h),this.Fd.getCollidingSubMeshCandidates=(h,d)=>this.getCollidingSubMeshCandidates(h,d),this.Fd.getIntersectingSubMeshCandidates=(h,d)=>this.getIntersectingSubMeshCandidates(h,d))}register(){this.Fd.onMeshRemovedObservable.add((h=>{const d=this.Fd.selectionOctree;if(void 0!==d&&null!==d){const m=d.bq.indexOf(h);-1!==m&&d.bq.splice(m,1)}})),this.Fd.onMeshImportedObservable.add((h=>{const d=this.Fd.selectionOctree;void 0!==d&&null!==d&&d.qM(h)}))}getActiveMeshCandidates(){var h;return(null===(h=this.Fd.jq)||void 0===h?void 0:h.select(this.Fd.frustumPlanes))||this.Fd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(h){if(h._submeshesOctree&&h.useOctreeForRenderingSelection){return h._submeshesOctree.select(this.Fd.frustumPlanes)}return this.Fd._getDefaultSubMeshCandidates(h)}getIntersectingSubMeshCandidates(h,d){if(h._submeshesOctree&&h.useOctreeForPicking){w.e.TransformToRef(d,h.getWorldMatrix(),this._tempRay);return h._submeshesOctree.intersectsRay(this._tempRay)}return this.Fd._getDefaultSubMeshCandidates(h)}getCollidingSubMeshCandidates(h,d){if(h._submeshesOctree&&h.useOctreeForCollisions){const m=d._velocityWorldLength+Math.max(d._radius.x,d._radius.y,d._radius.z);return h._submeshesOctree.intersects(d._basePointWorld,m)}return this.Fd._getDefaultSubMeshCandidates(h)}rebuild(){}dispose(){}}},12348:(h,d,m)=>{"use strict";m.d(d,{e:()=>I});var j=m(11604),A=m(11427),b=m(11065),w=m(11058),a=m(11073),D=m(11299),S=m(11400),M=m(11094),q=m(11639);const E={internalPickerForMesh:void 0};class I{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.c;this.origin=h,this.direction=d,this.length=m,this.epsilon=j}clone(){return new I(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=I._TmpVector3[0].xd(h.x-m,h.y-m,h.z-m),A=I._TmpVector3[1].xd(d.x+m,d.y+m,d.z+m);let b,w,a,D,S=0,M=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<j.x||this.origin.x>A.x)return!1}else if(b=1/this.direction.x,w=(j.x-this.origin.x)*b,a=(A.x-this.origin.x)*b,a===-1/0&&(a=1/0),w>a&&(D=w,w=a,a=D),S=Math.max(w,S),M=Math.min(a,M),S>M)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<j.y||this.origin.y>A.y)return!1}else if(b=1/this.direction.y,w=(j.y-this.origin.y)*b,a=(A.y-this.origin.y)*b,a===-1/0&&(a=1/0),w>a&&(D=w,w=a,a=D),S=Math.max(w,S),M=Math.min(a,M),S>M)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<j.z||this.origin.z>A.z)return!1}else if(b=1/this.direction.z,w=(j.z-this.origin.z)*b,a=(A.z-this.origin.z)*b,a===-1/0&&(a=1/0),w>a&&(D=w,w=a,a=D),S=Math.max(w,S),M=Math.min(a,M),S>M)return!1;return!0}intersectsBox(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(h.minimum,h.maximum,d)}intersectsSphere(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=h.center.x-this.origin.x,j=h.center.y-this.origin.y,A=h.center.z-this.origin.z,b=m*m+j*j+A*A,w=h.radius+d,a=w*w;if(b<=a)return!0;const D=m*this.direction.x+j*this.direction.y+A*this.direction.z;if(D<0)return!1;return b-D*D<=a}intersectsTriangle(h,d,m){const j=I._TmpVector3[0],A=I._TmpVector3[1],b=I._TmpVector3[2],a=I._TmpVector3[3],S=I._TmpVector3[4];d.subtractToRef(h,j),m.subtractToRef(h,A),w.i.CrossToRef(this.direction,A,b);const M=w.i.Dot(j,b);if(0===M)return null;const q=1/M;this.origin.subtractToRef(h,a);const E=w.i.Dot(a,b)*q;if(E<-this.epsilon||E>1+this.epsilon)return null;w.i.CrossToRef(a,j,S);const R=w.i.Dot(this.direction,S)*q;if(R<-this.epsilon||E+R>1+this.epsilon)return null;const Z=w.i.Dot(A,S)*q;return Z>this.length?null:new D.d(1-E-R,E,Z)}intersectsPlane(h){let d;const m=w.i.Dot(h.Dd,this.direction);if(Math.abs(m)<9.99999997475243e-7)return null;{const j=w.i.Dot(h.Dd,this.origin);return d=(-h.d-j)/m,d<0?d<-9.99999997475243e-7?null:0:d}}intersectsAxis(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(h){case"y":{const h=(this.origin.y-d)/this.direction.y;return h>0?null:new w.i(this.origin.x+this.direction.x*-h,d,this.origin.z+this.direction.z*-h)}case"x":{const h=(this.origin.x-d)/this.direction.x;return h>0?null:new w.i(d,this.origin.y+this.direction.y*-h,this.origin.z+this.direction.z*-h)}case"z":{const h=(this.origin.z-d)/this.direction.z;return h>0?null:new w.i(this.origin.x+this.direction.x*-h,this.origin.y+this.direction.y*-h,d)}default:return null}}intersectsMesh(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=w.d.Matrix[0];return h.getWorldMatrix().invertToRef(a),this._tmpRay?I.TransformToRef(this,a,this._tmpRay):this._tmpRay=I.Transform(this,a),h.intersects(this._tmpRay,d,m,j,A,b)}intersectsMeshes(h,d,m){m?m.length=0:m=[];for(let j=0;j<h.length;j++){const A=this.intersectsMesh(h[j],d);A.hit&&m.push(A)}return m.sort(this._comparePickingInfo),m}_comparePickingInfo(h,d){return h.distance<d.distance?-1:h.distance>d.distance?1:0}intersectionSegment(h,d,m){const j=this.origin,A=w.d.Qd[0],b=w.d.Qd[1],a=w.d.Qd[2],D=w.d.Qd[3];d.subtractToRef(h,A),this.direction.scaleToRef(I._Rayl,a),j.addToRef(a,b),h.subtractToRef(j,D);const S=w.i.Dot(A,A),M=w.i.Dot(A,a),q=w.i.Dot(a,a),E=w.i.Dot(A,D),R=w.i.Dot(a,D),Z=S*q-M*M;let L,B,V=Z,v=Z;Z<I._Smallnum?(L=0,V=1,B=R,v=q):(L=M*R-q*E,B=S*R-M*E,L<0?(L=0,B=R,v=q):L>V&&(L=V,B=R+M,v=q)),B<0?(B=0,-E<0?L=0:-E>S?L=V:(L=-E,V=S)):B>v&&(B=v,-E+M<0?L=0:-E+M>S?L=V:(L=-E+M,V=S));const C=Math.abs(L)<I._Smallnum?0:L/V,T=Math.abs(B)<I._Smallnum?0:B/v,o=w.d.Qd[4];a.scaleToRef(T,o);const y=w.d.Qd[5];A.scaleToRef(C,y),y.addInPlace(D);const i=w.d.Qd[6];y.subtractToRef(o,i);return T>0&&T<=this.length&&i.lengthSquared()<m*m?y.length():-1}update(h,d,m,j,A,b,a){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){I._RayDistant||(I._RayDistant=I.Zero()),I._RayDistant.unprojectRayToRef(h,d,m,j,w.b.IdentityReadOnly,b,a);const D=w.d.Matrix[0];A.invertToRef(D),I.TransformToRef(I._RayDistant,D,this)}else this.unprojectRayToRef(h,d,m,j,A,b,a);return this}static Zero(){return new I(w.i.Zero(),w.i.Zero())}static CreateNew(h,d,m,j,A,b,w){return I.Zero().update(h,d,m,j,A,b,w)}static CreateNewFromTo(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.b.IdentityReadOnly;const j=new I(new w.i(0,0,0),new w.i(0,0,0));return I.CreateFromToToRef(h,d,j,m)}static CreateFromToToRef(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.b.IdentityReadOnly;m.origin.D(h);const A=d.subtractToRef(h,m.direction),b=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return m.length=b,m.direction.normalize(),I.TransformToRef(m,j,m)}static Transform(h,d){const m=new I(new w.i(0,0,0),new w.i(0,0,0));return I.TransformToRef(h,d,m),m}static TransformToRef(h,d,m){w.i.TransformCoordinatesToRef(h.origin,d,m.origin),w.i.TransformNormalToRef(h.direction,d,m.direction),m.length=h.length,m.epsilon=h.epsilon;const j=m.direction,A=j.length();if(0!==A&&1!==A){const h=1/A;j.x*=h,j.y*=h,j.z*=h,m.length*=A}return m}unprojectRayToRef(h,d,m,j,A,b,a){const D=w.d.Matrix[0];A.multiplyToRef(b,D),D.multiplyToRef(a,D),D.invert();const S=M.b.LastCreatedEngine,q=w.d.Qd[0];q.x=h/m*2-1,q.y=-(d/j*2-1),q.z=null!==S&&void 0!==S&&S.useReverseDepthBuffer?1:null!==S&&void 0!==S&&S.isNDCHalfZRange?0:-1;const E=w.d.Qd[1].xd(q.x,q.y,1-1e-8),I=w.d.Qd[2],R=w.d.Qd[3];w.i._UnprojectFromInvertedMatrixToRef(q,D,I),w.i._UnprojectFromInvertedMatrixToRef(E,D,R),this.origin.D(I),R.subtractToRef(I,this.direction),this.direction.normalize()}}function R(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=I.Zero();return Z(h,d,m,j,w,A,b),w}function Z(h,d,m,j,A,b){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const S=h.getEngine();if(!b&&!(b=h.activeCamera))return h;const M=b.viewport,q=S.getRenderHeight(),{x:E,y:I,width:R,height:Z}=M.toGlobal(S.getRenderWidth(),q),L=1/S.getHardwareScalingLevel();return d=d*L-E,m=m*L-(q-I-Z),A.update(d,m,R,Z,j||w.b.IdentityReadOnly,a?w.b.IdentityReadOnly:b.getViewMatrix(),b.getProjectionMatrix(),D),h}function L(h,d,m,j,A){if(!S.b)return h;const b=h.getEngine();if(!A&&!(A=h.activeCamera))throw new Error("Active camera not set");const a=A.viewport,D=b.getRenderHeight(),{x:M,y:q,width:E,height:I}=a.toGlobal(b.getRenderWidth(),D),R=w.b.Identity(),Z=1/b.getHardwareScalingLevel();return d=d*Z-M,m=m*Z-(D-q-I),j.update(d,m,E,I,R,R,A.getProjectionMatrix()),h}function B(h,d,m,j,A,b,w,a){const D=d(j,m.enableDistantPicking),S=m.intersects(D,A,w,b,j,a);return S&&S.hit?!A&&null!=h&&S.distance>=h.distance?null:S:null}function V(h,d,m,j,A,b){let a=null;const D=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),M=h.cameraToUseForPointers||h.activeCamera,q=E.internalPickerForMesh||B;for(let S=0;S<h.meshes.length;S++){const E=h.meshes[S];if(m){if(!m(E,-1))continue}else if(!E.isEnabled()||!E.isVisible||!E.GD)continue;const I=D&&E.isWorldMatrixCameraDependent(),R=E.Zd(I,M);if(E.hasThinInstances&&E.thinInstanceEnablePicking){const h=q(a,d,E,R,!0,!0,b);if(h){if(A)return h;const D=w.d.Matrix[1],S=E.thinInstanceGetWorldMatrices();for(let h=0;h<S.length;h++){if(m&&!m(E,h))continue;S[h].multiplyToRef(R,D);const w=q(a,d,E,D,j,A,b,!0);if(w&&(a=w,a.thinInstanceIndex=h,j))return a}}}else{const h=q(a,d,E,R,j,A,b);if(h&&(a=h,j))return a}}return a||new S.b}function v(h,d,m,j){if(!S.b)return null;const A=[],b=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),a=h.cameraToUseForPointers||h.activeCamera,D=E.internalPickerForMesh||B;for(let S=0;S<h.meshes.length;S++){const M=h.meshes[S];if(m){if(!m(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.GD)continue;const q=b&&M.isWorldMatrixCameraDependent(),E=M.Zd(q,a);if(M.hasThinInstances&&M.thinInstanceEnablePicking){if(D(null,d,M,E,!0,!0,j)){const h=w.d.Matrix[1],b=M.thinInstanceGetWorldMatrices();for(let w=0;w<b.length;w++){if(m&&!m(M,w))continue;b[w].multiplyToRef(E,h);const a=D(null,d,M,h,!1,!1,j,!0);a&&(a.thinInstanceIndex=w,A.push(a))}}}else{const h=D(null,d,M,E,!1,!1,j);h&&A.push(h)}}return A}function C(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;j||(j=h.getWorldMatrix()),d.length=m,A?d.origin.D(A):d.origin.D(h.position);const b=w.d.Qd[2];b.set(0,0,h._scene.useRightHandedSystem?-1:1);const a=w.d.Qd[3];return w.i.TransformNormalToRef(b,j,a),w.i.NormalizeToRef(a,d.direction),d}var T,o;I._TmpVector3=(0,a.c)(6,w.i.Zero),I._RayDistant=I.Zero(),I._Smallnum=1e-8,I._Rayl=1e9,T=j.c,(o=A.e)&&(o.prototype.getForwardRay=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;return C(this,new I(w.i.Zero(),w.i.Zero(),h),h,d,m)},o.prototype.getForwardRayToRef=function(h){return C(this,h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),T&&(q.b._IsPickingAvailable=!0,T.prototype.createPickingRay=function(h,d,m,j){return R(this,h,d,m,j,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),j.c.prototype.createPickingRayToRef=function(h,d,m,j,A){return Z(this,h,d,m,j,A,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},j.c.prototype.createPickingRayInCameraSpace=function(h,d,m){return function(h,d,m,j){const A=I.Zero();return L(h,d,m,A,j),A}(this,h,d,m)},j.c.prototype.createPickingRayInCameraSpaceToRef=function(h,d,m,j){return L(this,h,d,m,j)},j.c.prototype.pickWithBoundingInfo=function(h,d,m,j,A){return function(h,d,m,j,A,b){if(!S.b)return null;const a=V(h,(j=>(h._tempPickingRay||(h._tempPickingRay=I.Zero()),Z(h,d,m,j,h._tempPickingRay,b||null),h._tempPickingRay)),j,A,!0);return a&&(a.ray=R(h,d,m,w.b.Identity(),b||null)),a}(this,h,d,m,j,A)},j.c.prototype.Fm=function(h,d,m,j,A,b){return function(h,d,m,j,A,b,a){const D=V(h,((j,A)=>(h._tempPickingRay||(h._tempPickingRay=I.Zero()),Z(h,d,m,j,h._tempPickingRay,b||null,!1,A),h._tempPickingRay)),j,A,!1,a);return D&&(D.ray=R(h,d,m,w.b.Identity(),b||null)),D}(this,h,d,m,j,A,b)},j.c.prototype.pickWithRay=function(h,d,m,j){return function(h,d,m,j,A){const b=V(h,(m=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=w.b.Identity()),m.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=I.Zero()),I.TransformToRef(d,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),m,j,!1,A);return b&&(b.ray=d),b}(this,h,d,m,j)},j.c.prototype.multiPick=function(h,d,m,j,A){return function(h,d,m,j,A,b){return v(h,(j=>R(h,d,m,j,A||null)),j,b)}(this,h,d,m,j,A)},j.c.prototype.multiPickWithRay=function(h,d,m){return function(h,d,m,j){return v(h,(m=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=w.b.Identity()),m.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=I.Zero()),I.TransformToRef(d,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),m,j)}(this,h,d,m)}},12633:(h,d,m)=>{"use strict";var j=m(11216),A=m(11121),b=m(11150),w=m(11245),a=m(11188),D=m(11229);a.b.prototype._partialLoadFile=function(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(h,(h=>{m[d]=h,m._internalCount++,6===m._internalCount&&j(m)}),void 0,void 0,!0,((h,d)=>{A&&h&&A(h.status+" "+h.statusText,d)}))},a.b.prototype._cascadeLoadFiles=function(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=[];A._internalCount=0;for(let b=0;b<6;b++)this._partialLoadFile(m[b],b,A,d,j)},a.b.prototype._cascadeLoadImgs=function(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5?arguments[5]:void 0;const w=[];w._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(j[a],a,w,h,d,m,A,b)},a.b.prototype._partialLoadImg=function(h,d,m,j,A,a){let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0;const M=(0,w.d)();(0,b.y)(h,(h=>{m[d]=h,m._internalCount++,j&&j.removePendingData(M),6===m._internalCount&&a&&a(A,m)}),((h,d)=>{j&&j.removePendingData(M),D&&D(h,d)}),j?j.offlineProvider:null,S),j&&j.addPendingData(M)},a.b.prototype.createCubeTextureBase=function(h,d,m,b){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,I=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,L=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],V=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=R||new j.c(this,7);v.isCube=!0,v.url=h,v.generateMipMaps=!b,v._lodGenerationScale=E,v._lodGenerationOffset=I,v._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!b),v!==R&&(v.label=h.substring(0,60)),this._doNotHandleContextLost||(v._extension=M,v._files=m,v._buffer=V);const C=h;this._transformTextureUrl&&!R&&(h=this._transformTextureUrl(h));const T=M??function(h){const d=h.split("?")[0],m=d.lastIndexOf(".");return m>-1?d.substring(m).toLowerCase():""}(h),o=(0,D.c)(T),y=(h,d)=>{v.dispose(),a?a(h,d):h&&A.c.Warn(h)},i=(j,a)=>{h===C?j&&y(j.status+" "+j.statusText,a):(A.c.Warn(`Failed to load ${h}, falling back to the ${C}`),this.createCubeTextureBase(C,d,m,!!b,w,y,S,M,q,E,I,v,Z,L,B,V))};if(o)o.then((j=>{const A=h=>{Z&&Z(v,h),j.loadCubeData(h,v,q,w,((h,d)=>{y(h,d)}))};V?A(V):m&&6===m.length?j.supportCascades?this._cascadeLoadFiles(d,(h=>A(h.map((h=>new Uint8Array(h))))),m,y):y("Textures type does not support cascades."):this._loadFile(h,(h=>A(new Uint8Array(h))),void 0,void 0,!0,i)}));else{if(!m||0===m.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(d,v,((h,d)=>{L&&L(h,d)}),m,y)}return this._internalTexturesCache.push(v),v}},13164:(h,d,m)=>{"use strict";m(11121);var j=m(11463);m(11216),m(11286),m(11087),m(11504),m(11475);j.b},12668:(h,d,m)=>{"use strict";m.d(d,{b:()=>A});var j=m(11080);class A{constructor(h){this.value=this._toInt(h)}_toInt(h){return 0|h}add(h){return new A(this.value+h.value)}fm(h){return new A(this.value-h.value)}multiply(h){return new A(Math.imul(this.value,h.value))}divide(h){return new A(this.value/h.value)}getClassName(){return A.ClassName}equals(h){return this.value===h.value}static FromValue(h){return new A(h)}toString(){return this.value.toString()}}A.ClassName="FlowGraphInteger",(0,j.i)("FlowGraphInteger",A)},12674:(h,d,m)=>{"use strict";m.d(d,{e:()=>A,f:()=>b});var j=m(11058);class A{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.cE=h}get m(){return this.cE}transformVector(h){return this.transformVectorToRef(h,new j.h)}transformVectorToRef(h,d){return d.x=h.x*this.cE[0]+h.y*this.cE[1],d.y=h.x*this.cE[2]+h.y*this.cE[3],d}fd(){return this.toArray()}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<4;d++)h[d]=this.cE[d];return h}Hm(h){for(let d=0;d<4;d++)this.cE[d]=h[d];return this}multiplyToRef(h,d){const m=h.cE,j=this.cE,A=d.cE;return A[0]=m[0]*j[0]+m[1]*j[2],A[1]=m[0]*j[1]+m[1]*j[3],A[2]=m[2]*j[0]+m[3]*j[2],A[3]=m[2]*j[1]+m[3]*j[3],d}multiply(h){return this.multiplyToRef(h,new A)}divideToRef(h,d){const m=this.cE,j=h.cE,A=d.cE;return A[0]=m[0]/j[0],A[1]=m[1]/j[1],A[2]=m[2]/j[2],A[3]=m[3]/j[3],d}divide(h){return this.divideToRef(h,new A)}addToRef(h,d){const m=this.cE,j=h.m,A=d.m;return A[0]=m[0]+j[0],A[1]=m[1]+j[1],A[2]=m[2]+j[2],A[3]=m[3]+j[3],d}add(h){return this.addToRef(h,new A)}subtractToRef(h,d){const m=this.cE,j=h.m,A=d.m;return A[0]=m[0]-j[0],A[1]=m[1]-j[1],A[2]=m[2]-j[2],A[3]=m[3]-j[3],d}fm(h){return this.subtractToRef(h,new A)}transpose(){const h=this.cE;return new A([h[0],h[2],h[1],h[3]])}determinant(){const h=this.cE;return h[0]*h[3]-h[1]*h[2]}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const d=this.cE,m=1/h;return new A([d[3]*m,-d[1]*m,-d[2]*m,d[0]*m])}equals(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.cE,j=h.m;return 0===d?m[0]===j[0]&&m[1]===j[1]&&m[2]===j[2]&&m[3]===j[3]:Math.abs(m[0]-j[0])<d&&Math.abs(m[1]-j[1])<d&&Math.abs(m[2]-j[2])<d&&Math.abs(m[3]-j[3])<d}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.cE.join(", ")})`}}class b{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.cE=h}get m(){return this.cE}transformVector(h){return this.transformVectorToRef(h,new j.i)}transformVectorToRef(h,d){const m=this.cE;return d.x=h.x*m[0]+h.y*m[1]+h.z*m[2],d.y=h.x*m[3]+h.y*m[4]+h.z*m[5],d.z=h.x*m[6]+h.y*m[7]+h.z*m[8],d}multiplyToRef(h,d){const m=h.cE,j=this.cE,A=d.m;return A[0]=m[0]*j[0]+m[1]*j[3]+m[2]*j[6],A[1]=m[0]*j[1]+m[1]*j[4]+m[2]*j[7],A[2]=m[0]*j[2]+m[1]*j[5]+m[2]*j[8],A[3]=m[3]*j[0]+m[4]*j[3]+m[5]*j[6],A[4]=m[3]*j[1]+m[4]*j[4]+m[5]*j[7],A[5]=m[3]*j[2]+m[4]*j[5]+m[5]*j[8],A[6]=m[6]*j[0]+m[7]*j[3]+m[8]*j[6],A[7]=m[6]*j[1]+m[7]*j[4]+m[8]*j[7],A[8]=m[6]*j[2]+m[7]*j[5]+m[8]*j[8],d}multiply(h){return this.multiplyToRef(h,new b)}divideToRef(h,d){const m=this.cE,j=h.m,A=d.m;return A[0]=m[0]/j[0],A[1]=m[1]/j[1],A[2]=m[2]/j[2],A[3]=m[3]/j[3],A[4]=m[4]/j[4],A[5]=m[5]/j[5],A[6]=m[6]/j[6],A[7]=m[7]/j[7],A[8]=m[8]/j[8],d}divide(h){return this.divideToRef(h,new b)}addToRef(h,d){const m=this.cE,j=h.m,A=d.m;return A[0]=m[0]+j[0],A[1]=m[1]+j[1],A[2]=m[2]+j[2],A[3]=m[3]+j[3],A[4]=m[4]+j[4],A[5]=m[5]+j[5],A[6]=m[6]+j[6],A[7]=m[7]+j[7],A[8]=m[8]+j[8],d}add(h){return this.addToRef(h,new b)}subtractToRef(h,d){const m=this.cE,j=h.m,A=d.m;return A[0]=m[0]-j[0],A[1]=m[1]-j[1],A[2]=m[2]-j[2],A[3]=m[3]-j[3],A[4]=m[4]-j[4],A[5]=m[5]-j[5],A[6]=m[6]-j[6],A[7]=m[7]-j[7],A[8]=m[8]-j[8],d}fm(h){return this.subtractToRef(h,new b)}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<9;d++)h[d]=this.cE[d];return h}fd(){return this.toArray()}Hm(h){for(let d=0;d<9;d++)this.cE[d]=h[d];return this}transpose(){const h=this.cE;return new b([h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8]])}determinant(){const h=this.cE;return h[0]*(h[4]*h[8]-h[5]*h[7])-h[1]*(h[3]*h[8]-h[5]*h[6])+h[2]*(h[3]*h[7]-h[4]*h[6])}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const d=this.cE,m=1/h;return new b([(d[4]*d[8]-d[5]*d[7])*m,(d[2]*d[7]-d[1]*d[8])*m,(d[1]*d[5]-d[2]*d[4])*m,(d[5]*d[6]-d[3]*d[8])*m,(d[0]*d[8]-d[2]*d[6])*m,(d[2]*d[3]-d[0]*d[5])*m,(d[3]*d[7]-d[4]*d[6])*m,(d[1]*d[6]-d[0]*d[7])*m,(d[0]*d[4]-d[1]*d[3])*m])}equals(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.cE,j=h.m;return 0===d?m[0]===j[0]&&m[1]===j[1]&&m[2]===j[2]&&m[3]===j[3]&&m[4]===j[4]&&m[5]===j[5]&&m[6]===j[6]&&m[7]===j[7]&&m[8]===j[8]:Math.abs(m[0]-j[0])<d&&Math.abs(m[1]-j[1])<d&&Math.abs(m[2]-j[2])<d&&Math.abs(m[3]-j[3])<d&&Math.abs(m[4]-j[4])<d&&Math.abs(m[5]-j[5])<d&&Math.abs(m[6]-j[6])<d&&Math.abs(m[7]-j[7])<d&&Math.abs(m[8]-j[8])<d}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.cE.join(", ")})`}}},12677:(h,d,m)=>{"use strict";var j;function A(h,d,m,j){switch(d){case"Animation":return j?h.animations.find((h=>h.uniqueId===m))??null:h.animations[m]??null;case"AnimationGroup":return j?h.animationGroups.find((h=>h.uniqueId===m))??null:h.animationGroups[m]??null;case"Mesh":return j?h.meshes.find((h=>h.uniqueId===m))??null:h.meshes[m]??null;case"Material":return j?h.materials.find((h=>h.uniqueId===m))??null:h.materials[m]??null;case"CM":return j?h.cameras.find((h=>h.uniqueId===m))??null:h.cameras[m]??null;case"Light":return j?h.lights.find((h=>h.uniqueId===m))??null:h.lights[m]??null;default:return null}}m.d(d,{b:()=>A}),function(h){h.Animation="Animation",h.AnimationGroup="AnimationGroup",h.Mesh="Mesh",h.Material="Material",h.CM="CM",h.Light="Light"}(j||(j={}))},12708:(h,d,m)=>{"use strict";m.d(d,{d:()=>A});var j=m(12710);class A extends j.d{constructor(h,d){if(super(h),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),d)for(const m of d)this._eventsSignalOutputs[m]=this._registerSignalOutput(m+"Event")}_executeOnTick(h){}_startPendingTasks(h){h._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(h),this._resetAfterCanceled(h)),this._preparePendingTasks(h),h._addPendingBlock(this),this.out._activateSignal(h),h._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(h){h._deleteExecutionVariable(this,"_initialized"),h._removePendingBlock(this)}}},12687:(h,d,m)=>{"use strict";m.d(d,{d:()=>S});var j=m(11245),A=m(11080),b=m(12691),w=m(11097),a=m(12659);class D extends b.d{constructor(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:j.defaultValue,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(h,d,m),this.richType=j,this._defaultValue=A,this._optional=b,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new w.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(h){this._isDisabled!==h&&(this._isDisabled=h,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(h,d){d._getConnectionValue(this)!==h&&(d._setConnectionValue(this,h),this.onValueChangedObservable.notifyObservers(h))}resetToDefaultValue(h){h._setConnectionValue(this,this._defaultValue)}connectTo(h){this._isDisabled||super.connectTo(h)}_getValueOrDefault(h){const d=h._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(d):d}getValue(h){if(1===this.connectionType){h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(h);const d=this._getValueOrDefault(h);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}const d=this.isConnected()?this._connectedPoint[0].getValue(h):this._getValueOrDefault(h);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.richType={},this.richType.serialize(h.richType),h.optional=this._optional,(0,a.d)("defaultValue",this._defaultValue,h)}}(0,A.i)("FlowGraphDataConnection",D);class S{constructor(h){var d;this.config=h,this.uniqueId=(0,j.d)(),this.name=(null===(d=this.config)||void 0===d?void 0:d.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(h){}registerDataInput(h,d,m){const j=new D(h,0,this,d,m);return this.dataInputs.push(j),j}registerDataOutput(h,d,m){const j=new D(h,1,this,d,m);return this.dataOutputs.push(j),j}getDataInput(h){return this.dataInputs.find((d=>d.name===h))}getDataOutput(h){return this.dataOutputs.find((d=>d.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.d;if(h.uniqueId=this.uniqueId,h.config={},this.config){const m=this.config,j=Object.keys(m);for(const A of j)d(A,m[A],h.config)}h.dataInputs=[],h.dataOutputs=[],h.className=this.getClassName();for(const m of this.dataInputs){const d={};m.serialize(d),h.dataInputs.push(d)}for(const m of this.dataOutputs){const d={};m.serialize(d),h.dataOutputs.push(d)}}deserialize(h){}_log(h,d,m){var j;null===(j=h.logger)||void 0===j||j.addLogItem({action:d,payload:m,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12691:(h,d,m)=>{"use strict";m.d(d,{d:()=>b});var j,A=m(11245);!function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(j||(j={}));class b{constructor(h,d,m){this._ownerBlock=m,this._connectedPoint=[],this.uniqueId=(0,A.d)(),this.connectedPointIds=[],this.name=h,this._connectionType=d}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(h){if(this._connectionType===h._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||h._isSingularConnection()&&h._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(h),h._connectedPoint.push(this)}disconnectFrom(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this._connectedPoint.indexOf(h),j=h._connectedPoint.indexOf(this);-1!==m&&-1!==j&&(d&&this._connectedPoint.splice(m,1),h._connectedPoint.splice(j,1))}disconnectFromAll(){for(const h of this._connectedPoint)this.disconnectFrom(h,!1);this._connectedPoint.length=0}dispose(){for(const h of this._connectedPoint)this.disconnectFrom(h)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.uniqueId=this.uniqueId,h.name=this.name,h._connectionType=this._connectionType,h.connectedPointIds=[],h.className=this.getClassName();for(const d of this._connectedPoint)h.connectedPointIds.push(d.uniqueId)}getClassName(){return"FGConnection"}deserialize(h){this.uniqueId=h.uniqueId,this.name=h.name,this._connectionType=h._connectionType,this.connectedPointIds=h.connectedPointIds}}},12651:(h,d,m)=>{"use strict";m.d(d,{b:()=>v});var j,A=m(11097),b=m(11258),w=m(11261),a=m(11245),D=m(12659),S=m(12677),M=m(11121);!function(h){h.ExecuteBlock="ExecuteBlock",h.ExecuteEvent="ExecuteEvent",h.TriggerConnection="TriggerConnection",h.ContextVariableSet="ContextVariableSet",h.GlobalVariableSet="GlobalVariableSet",h.GlobalVariableDelete="GlobalVariableDelete",h.GlobalVariableGet="GlobalVariableGet",h.AddConnection="AddConnection",h.GetConnectionValue="GetConnectionValue",h.SetConnectionValue="SetConnectionValue",h.ActivateSignal="ActivateSignal",h.ContextVariableGet="ContextVariableGet"}(j||(j={}));class q{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(h){if(h.time||(h.time=Date.now()),this.log.push(h),this.logToConsole){var d;const m=null===(d=h.payload)||void 0===d?void 0:d.value;"object"===typeof m&&m.getClassName?M.c.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(m.getClassName())}: ${m.toString()}`):M.c.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(h.payload)}`)}}getItemsOfType(h){return this.log.filter((d=>d.action===h))}}class E{get enableLogging(){return this._enableLogging}set enableLogging(h){this._enableLogging!==h&&(this._enableLogging=h,this._enableLogging?(this.logger=new q,this.logger.logToConsole=!0):this.logger=null)}constructor(h){this.uniqueId=(0,a.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new A.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=h,this.assetsContext=h.assetsContext??h.Fd}hasVariable(h){return h in this._userVariables}setVariable(h,d){var m;this._userVariables[h]=d,null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:h,value:d}})}getAsset(h,d){return(0,S.b)(this.assetsContext,h,d)}getVariable(h){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:h,value:this._userVariables[h]}}),this._userVariables[h]}get userVariables(){return this._userVariables}ih(){return this._configuration.Fd}_getUniqueIdPrefixedName(h,d){return`${h.uniqueId}_${d}`}_getGlobalContextVariable(h,d){var m;return null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:h,defaultValue:d,possibleValue:this._globalContextVariables[h]}}),this._hasGlobalContextVariable(h)?this._globalContextVariables[h]:d}_setGlobalContextVariable(h,d){var m;null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:h,value:d}}),this._globalContextVariables[h]=d}_deleteGlobalContextVariable(h){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:h}}),delete this._globalContextVariables[h]}_hasGlobalContextVariable(h){return h in this._globalContextVariables}_setExecutionVariable(h,d,m){this._executionVariables[this._getUniqueIdPrefixedName(h,d)]=m}_getExecutionVariable(h,d,m){return this._hasExecutionVariable(h,d)?this._executionVariables[this._getUniqueIdPrefixedName(h,d)]:m}_deleteExecutionVariable(h,d){delete this._executionVariables[this._getUniqueIdPrefixedName(h,d)]}_hasExecutionVariable(h,d){return this._getUniqueIdPrefixedName(h,d)in this._executionVariables}_hasConnectionValue(h){return h.uniqueId in this._connectionValues}_setConnectionValue(h,d){var m;this._connectionValues[h.uniqueId]=d,null===(m=this.logger)||void 0===m||m.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:h.uniqueId,value:d}})}_setConnectionValueByKey(h,d){this._connectionValues[h]=d}_getConnectionValue(h){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:h.uniqueId,value:this._connectionValues[h.uniqueId]}}),this._connectionValues[h.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(h){this._pendingBlocks.includes(h)||(this._pendingBlocks.push(h),this._pendingBlocks.sort(((h,d)=>h.priority-d.priority)))}_removePendingBlock(h){const d=this._pendingBlocks.indexOf(h);-1!==d&&this._pendingBlocks.splice(d,1)}_clearPendingBlocks(){for(const h of this._pendingBlocks)h._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(h){var d;this.onNodeExecutedObservable.notifyObservers(h),null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:h.getClassName(),uniqueId:h.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(h){this._setGlobalContextVariable("timeSinceStart",h.timeSinceStart),this._setGlobalContextVariable("deltaTime",h.deltaTime);for(const m of this._pendingBlocks){var d;null===(d=m._executeOnTick)||void 0===d||d.call(m,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.d;h.uniqueId=this.uniqueId,h._userVariables={};for(const j in this._userVariables)d(j,this._userVariables[j],h._userVariables);h._connectionValues={};for(const j in this._connectionValues)d(j,this._connectionValues[j],h._connectionValues);var m;this.assetsContext!==this.ih()&&(h._assetsContext={meshes:this.assetsContext.meshes.map((h=>h.id)),materials:this.assetsContext.materials.map((h=>h.id)),textures:this.assetsContext.textures.map((h=>h.name)),animations:this.assetsContext.animations.map((h=>h.name)),lights:this.assetsContext.lights.map((h=>h.id)),cameras:this.assetsContext.cameras.map((h=>h.id)),sE:null===(m=this.assetsContext.sE)||void 0===m?void 0:m.map((h=>h.name)),skeletons:this.assetsContext.skeletons.map((h=>h.id)),aE:this.assetsContext.aE.map((h=>h.name)),geometries:this.assetsContext.geometries.map((h=>h.id)),multiMaterials:this.assetsContext.multiMaterials.map((h=>h.id)),transformNodes:this.assetsContext.transformNodes.map((h=>h.id))})}getClassName(){return"FlowGraphContext"}}(0,b.d)([(0,w.M)()],E.prototype,"uniqueId",void 0);var I=m(12681),R=m(11624);class Z{constructor(h){this.onEventTriggeredObservable=new A.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=h,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.pd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const h=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:h}}),this._startingTime+=h})),this._meshPickedObserver=this._scene.onPointerObservable.add((h=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:h})}),R.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((h=>{const d=h.pointerId,m=h.mesh,j=this._pointerUnderMeshState[d];!j&&m?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:d,mesh:m}}):j&&!m?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:d,mesh:j}}):j&&m&&j!==m&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:d,mesh:j,over:m}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:d,mesh:m,out:j}})),this._pointerUnderMeshState[d]=m}),R.d.POINTERMOVE)}dispose(){var h,d,m,j,A;null===(h=this._sceneDisposeObserver)||void 0===h||h.remove(),null===(d=this._sceneReadyObserver)||void 0===d||d.remove(),null===(m=this._sceneOnBeforeRenderObserver)||void 0===m||m.remove(),null===(j=this._meshPickedObserver)||void 0===j||j.remove(),null===(A=this._meshUnderPointerObserver)||void 0===A||A.remove(),this.onEventTriggeredObservable.clear()}}var L,B=m(12695);!function(h){h[h.Stopped=0]="Stopped",h[h.Started=1]="Started"}(L||(L={}));class V{get state(){return this._state}set state(h){this._state=h,this.onStateChangedObservable.notifyObservers(h)}constructor(h){this.onStateChangedObservable=new A.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=h.Fd,this._sceneEventCoordinator=new Z(this._scene),this._coordinator=h.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((h=>{for(const d of this._executionContexts){const m=this._getContextualOrder(h.type,d);for(const j of m)if(!j._executeEvent(d,h.payload))break}switch(h.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const d of this._executionContexts)d._notifyOnTick(h.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const h=new E({Fd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(h),h}getContext(h){return this._executionContexts[h]}addEventBlock(h){if("PointerOver"!==h.type&&"PointerOut"!==h.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==h.type&&this._eventBlocks[h.type].push(h),1===this.state)for(const d of this._executionContexts)h._startPendingTasks(d);else this.onStateChangedObservable.addOnce((d=>{if(1===d)for(const m of this._executionContexts)h._startPendingTasks(m)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((h=>{1===h&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const h of this._executionContexts)for(const d in this._eventBlocks){const m=this._getContextualOrder(d,h);for(const d of m)d._startPendingTasks(h)}}_getContextualOrder(h,d){const m=this._eventBlocks[h].sort(((h,d)=>d.initPriority-h.initPriority));if("MeshPick"===h){const h=[];for(const j of m){const A=j.asset.getValue(d);let b=0;for(;b<m.length;b++){const h=m[b].asset.getValue(d);if(A&&h&&(0,B.o)(A,h))break}h.splice(b,0,j)}return h}return m}dispose(){var h;if(0!==this.state){this.state=0;for(const h of this._executionContexts)h._clearPendingBlocks();this._executionContexts.length=0;for(const h in this._eventBlocks)this._eventBlocks[h].length=0;null===(h=this._eventObserver)||void 0===h||h.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(h){const d=[],m=new Set;for(const j in this._eventBlocks)for(const h of this._eventBlocks[j])d.push(h),m.add(h.uniqueId);for(;d.length>0;){const j=d.pop();h(j);for(const h of j.dataInputs)for(const j of h._connectedPoint)m.has(j._ownerBlock.uniqueId)||(d.push(j._ownerBlock),m.add(j._ownerBlock.uniqueId));if(j instanceof I.c)for(const h of j.signalOutputs)for(const j of h._connectedPoint)m.has(j._ownerBlock.uniqueId)||(d.push(j._ownerBlock),m.add(j._ownerBlock.uniqueId))}}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1?arguments[1]:void 0;h.allBlocks=[],this.visitAllBlocks((d=>{const m={};d.serialize(m),h.allBlocks.push(m)})),h.executionContexts=[];for(const m of this._executionContexts){const j={};m.serialize(j,d),h.executionContexts.push(j)}}}class v{constructor(h){this.config=h,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Fd.pd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Fd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const h=this._executeOnNextFrame.slice(0);if(h.length)for(const d of h){this.notifyCustomEvent(d.id,d.data,!1);const h=this._executeOnNextFrame.findIndex((h=>h.uniqueId===d.uniqueId));-1!==h&&this._executeOnNextFrame.splice(h,1)}}));(v.SceneCoordinators.get(this.config.Fd)??[]).push(this)}createGraph(){const h=new V({Fd:this.config.Fd,coordinator:this});return this._flowGraphs.push(h),h}removeGraph(h){const d=this._flowGraphs.indexOf(h);-1!==d&&(h.dispose(),this._flowGraphs.splice(d,1))}start(){for(const h of this._flowGraphs)h.start()}dispose(){var h,d;for(const A of this._flowGraphs)A.dispose();this._flowGraphs.length=0,null===(h=this._disposeObserver)||void 0===h||h.remove(),null===(d=this._onBeforeRenderObserver)||void 0===d||d.remove();const m=v.SceneCoordinators.get(this.config.Fd)??[],j=m.indexOf(this);-1!==j&&m.splice(j,1)}serialize(h,d){h._flowGraphs=[];for(const m of this._flowGraphs){const j={};m.serialize(j,d),h._flowGraphs.push(j)}h.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(h){let d=this._customEventsMap.get(h);return d||(d=new A.e,this._customEventsMap.set(h,d)),d}notifyCustomEvent(h,d){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:h,data:d,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(h)){const d=this._eventExecutionCounter.get(h);if(this._eventExecutionCounter.set(h,d+1),d>=v.MaxEventTypeExecutionPerFrame)return void(d===v.MaxEventTypeExecutionPerFrame&&M.c.Warn(`FlowGraphCoordinator: Too many executions of event "${h}".`))}else this._eventExecutionCounter.set(h,1);const m=this._customEventsMap.get(h);m&&m.notifyObservers(d)}}v.MaxEventsPerType=30,v.MaxEventTypeExecutionPerFrame=30,v.SceneCoordinators=new Map},12703:(h,d,m)=>{"use strict";m.d(d,{c:()=>A});var j=m(12708);class A extends j.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(h){h._notifyExecuteNode(this),this.done._activateSignal(h)}}},12681:(h,d,m)=>{"use strict";m.d(d,{c:()=>a});var j=m(12687),A=m(12691),b=m(11080);class w extends A.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(h){super.connectTo(h),this._connectedPoint.sort(((h,d)=>d.priority-h.priority))}_activateSignal(h){var d;if(null===(d=h.logger)||void 0===d||d.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(h,this),h._increaseExecutionId();else for(const m of this._connectedPoint)m._activateSignal(h)}}(0,b.i)("FlowGraphSignalConnection",w);class a extends j.d{constructor(h){super(h),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(h){const d=new w(h,0,this);return this.signalInputs.push(d),d}_registerSignalOutput(h){const d=new w(h,1,this);return this.signalOutputs.push(d),d}_unregisterSignalInput(h){const d=this.signalInputs.findIndex((d=>d.name===h));-1!==d&&(this.signalInputs[d].dispose(),this.signalInputs.splice(d,1))}_unregisterSignalOutput(h){const d=this.signalOutputs.findIndex((d=>d.name===h));-1!==d&&(this.signalOutputs[d].dispose(),this.signalOutputs.splice(d,1))}_reportError(h,d){this.error.payload="string"===typeof d?new Error(d):d,this.error._activateSignal(h)}getSignalInput(h){return this.signalInputs.find((d=>d.name===h))}getSignalOutput(h){return this.signalOutputs.find((d=>d.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.signalInputs=[],h.signalOutputs=[];for(const d of this.signalInputs){const m={};d.serialize(m),h.signalInputs.push(m)}for(const d of this.signalOutputs){const m={};d.serialize(m),h.signalOutputs.push(m)}}deserialize(h){for(let d=0;d<h.signalInputs.length;d++){const m=this.getSignalInput(h.signalInputs[d].name);if(!m)throw new Error("Could not find signal input with name "+h.signalInputs[d].name+" in block "+h.className);m.deserialize(h.signalInputs[d])}for(let d=0;d<h.signalOutputs.length;d++){const m=this.getSignalOutput(h.signalOutputs[d].name);if(!m)throw new Error("Could not find signal output with name "+h.signalOutputs[d].name+" in block "+h.className);m.deserialize(h.signalOutputs[d])}}getClassName(){return"FlowGraphExecutionBlock"}}},12710:(h,d,m)=>{"use strict";m.d(d,{d:()=>A});var j=m(12681);class A extends j.c{constructor(h){super(h),this.out=this._registerSignalOutput("out")}}},12671:(h,d,m)=>{"use strict";m.d(d,{A:()=>M,D:()=>I,E:()=>R,G:()=>Z,H:()=>g,I:()=>F,M:()=>i,Q:()=>y,e:()=>S,f:()=>E,i:()=>o,m:()=>L,q:()=>B,u:()=>V,y:()=>q,z:()=>T});var j,A=m(11058),b=m(11353),w=m(12668),a=m(12674);!function(h){h.Any="any",h.String="string",h.Number="number",h.Boolean="boolean",h.Object="object",h.Integer="FlowGraphInteger",h.Vector2="Vector2",h.Qd="Qd",h.Vector4="Vector4",h.Quaternion="Quaternion",h.Matrix="Matrix",h.Matrix2D="Matrix2D",h.Matrix3D="Matrix3D",h.qb="qb",h.Eb="Eb"}(j||(j={}));class D{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=h,this.defaultValue=d,this.animationType=m}serialize(h){h.typeName=this.typeName,h.defaultValue=this.defaultValue}}const S=new D("any",void 0),M=new D("string",""),q=new D("number",0,0),E=new D("boolean",!1),I=new D("Vector2",A.h.Zero(),5),R=new D("Qd",A.i.Zero(),1),Z=new D("Vector4",A.m.Zero()),L=new D("Matrix",A.b.Identity(),3),B=new D("Matrix2D",new a.e),V=new D("Matrix3D",new a.f),v=new D("qb",b.d.Black(),4),C=new D("Eb",new b.f(0,0,0,0),7),T=new D("Quaternion",A.c.Identity(),2);T.typeTransformer=h=>{if(h.getClassName){if("Vector4"===h.getClassName())return A.c.Ud(h.fd());if("Qd"===h.getClassName())return A.c.FromEulerVector(h);if("Matrix"===h.getClassName())return A.c.FromRotationMatrix(h)}return h};const o=new D("FlowGraphInteger",new w.b(0),0);function y(h){const d=h;switch(typeof h){case"string":return M;case"number":return q;case"boolean":return E;case"object":if(d.getClassName)switch(d.getClassName()){case"Vector2":return I;case"Qd":return R;case"Vector4":return Z;case"Matrix":return L;case"qb":return v;case"Eb":return C;case"Quaternion":return T;case"FlowGraphInteger":return o;case"Matrix2D":return B;case"Matrix3D":return V}return S;default:return S}}function i(h){switch(h){case"string":return M;case"number":return q;case"boolean":return E;case"Vector2":return I;case"Qd":return R;case"Vector4":return Z;case"Matrix":return L;case"qb":return v;case"Eb":return C;case"Quaternion":return T;case"FlowGraphInteger":return o;case"Matrix2D":return B;case"Matrix3D":return V;default:return S}}function g(h){switch(h){case"number":default:return 0;case"Vector2":return 5;case"Qd":return 1;case"Matrix":return 3;case"qb":return 4;case"Eb":return 7;case"Quaternion":return 2}}function F(h){switch(h){case 0:return q;case 5:return I;case 1:return R;case 3:return L;case 4:return v;case 7:return C;case 2:return T;default:return S}}},12659:(h,d,m)=>{"use strict";m.d(d,{b:()=>M,d:()=>S,g:()=>q});var j=m(11353),A=m(11058),b=m(12668),w=m(12671),a=m(12674);function D(h){return"Vector2"===h||"Qd"===h||"Vector4"===h||"Quaternion"===h||"qb"===h||"Eb"===h}function S(h,d,m){var j;const A=(null===d||void 0===d||null===(j=d.getClassName)||void 0===j?void 0:j.call(d))??"";if(D(A)||function(h){return"Matrix"===h||"Matrix2D"===h||"Matrix3D"===h}(A))m[h]={value:d.fd(),className:A};else if("FlowGraphInteger"===A)m[h]={value:d.value,className:A};else if(A&&(d.id||d.name))m[h]={id:d.id,name:d.name,className:A};else{if("object"===typeof d)throw new Error(`Could not serialize value ${d}`);m[h]=d}}function M(h,d,m,S){const q=d[h];let E;const I=(null===q||void 0===q?void 0:q.type)??(null===q||void 0===q?void 0:q.className);if(function(h){return"Mesh"===h||"AbstractMesh"===h||"GroundMesh"===h||"InstanceMesh"===h||"LinesMesh"===h||"GoldbergMesh"===h||"GreasedLineMesh"===h||"TrailMesh"===h}(I)){let h=S.meshes.filter((h=>q.id?h.id===q.id:h.name===q.name));0===h.length&&(h=S.transformNodes.filter((h=>q.id?h.id===q.id:h.name===q.name))),E=q.uniqueId?h.find((h=>h.uniqueId===q.uniqueId)):h[0]}else if(D(I))E=function(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===h)return A.h.Ud(d);if("Qd"===h)return m&&(d[2]*=-1),A.i.Ud(d);if("Vector4"===h)return A.m.Ud(d);if("Quaternion"===h)return m&&(d[2]*=-1,d[3]*=-1),A.c.Ud(d);if("qb"===h)return new j.d(d[0],d[1],d[2]);if("Eb"===h)return new j.f(d[0],d[1],d[2],d[3]);throw new Error(`Unknown vector class name ${h}`)}(I,q.value);else if(function(h){return"AnimationGroup"===h}(I)){const h=S.animationGroups.filter((h=>h.name===q.name));E=1===h.length?h[0]:h.find((h=>h.uniqueId===q.uniqueId))}else E="Matrix"===I?A.b.Ud(q.value):"Matrix2D"===I?new a.e(q.value):"Matrix3D"===I?new a.f(q.value):"FlowGraphInteger"===I?b.b.FromValue(q.value):"number"===I||"string"===I||"boolean"===I?q.value[0]:q&&void 0!==q.value?q.value:Array.isArray(q)?q.reduce(((h,d)=>d.eventData?(h[d.id]={type:(0,w.M)(d.type)},"undefined"!==typeof d.value&&(h[d.id].value=M("value",d,m,S)),h):h),{}):q;return E}function q(h){return"FlowGraphJsonPointerParserBlock"===h}},12695:(h,d,m)=>{"use strict";function j(h,d){return!(!h.parent||h.parent!==d&&!j(h.parent,d))}function A(h){if(h.getClassName)return h.getClassName()}function b(h,d){return h===d&&("Vector2"===h||"Qd"===h||"Vector4"===h||"Quaternion"===h)}function w(h,d){return h===d&&("Matrix"===h||"Matrix2D"===h||"Matrix3D"===h)}function a(h,d){return"FlowGraphInteger"===h&&"FlowGraphInteger"===d}function D(h,d){const m="number"===typeof h||"number"===typeof(null===h||void 0===h?void 0:h.value);return m&&!d?!isNaN(S(h)):m}function S(h){return"number"===typeof h?h:h.value}m.d(d,{e:()=>a,f:()=>w,i:()=>b,l:()=>A,o:()=>j,s:()=>S,t:()=>D})},12065:(h,d,m)=>{"use strict";m.r(d),m.d(d,{SceneInstrumentation:()=>b});var j=m(11107),A=m(11536);class b{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(h){h!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=h,h?(this._onBeforeActiveMeshesEvaluationObserver=this.Fd.onBeforeActiveMeshesEvaluationObservable.add((()=>{j.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Fd.onAfterActiveMeshesEvaluationObservable.add((()=>{j.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Fd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(h){h!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=h,h?(this._onBeforeRenderTargetsRenderObserver=this.Fd.onBeforeRenderTargetsRenderObservable.add((()=>{j.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Fd.onAfterRenderTargetsRenderObservable.add((()=>{j.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Fd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(h){h!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=h,h?(this._onBeforeParticlesRenderingObserver=this.Fd.onBeforeParticlesRenderingObservable.add((()=>{j.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Fd.onAfterParticlesRenderingObservable.add((()=>{j.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Fd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(h){h!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=h,this.Fd.spriteManagers&&(h?(this._onBeforeSpritesRenderingObserver=this.Fd.onBeforeSpritesRenderingObservable.add((()=>{j.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Fd.onAfterSpritesRenderingObservable.add((()=>{j.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Fd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Fd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(h){h!==this._capturePhysicsTime&&this.Fd.onBeforePhysicsObservable&&(this._capturePhysicsTime=h,h?(this._onBeforePhysicsObserver=this.Fd.onBeforePhysicsObservable.add((()=>{j.e.StartPerformanceCounter("Bb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Fd.onAfterPhysicsObservable.add((()=>{j.e.EndPerformanceCounter("Bb"),this._physicsTime.endMonitoring()}))):(this.Fd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Fd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(h){h!==this._captureAnimationsTime&&(this._captureAnimationsTime=h,h?this._onAfterAnimationsObserver=this.Fd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Fd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(h){this._captureFrameTime=h}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(h){this._captureInterFrameTime=h}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(h){h!==this._captureRenderTime&&(this._captureRenderTime=h,h?(this._onBeforeDrawPhaseObserver=this.Fd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),j.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Fd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),j.e.EndPerformanceCounter("Main render")}))):(this.Fd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(h){h!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=h,h?(this._onBeforeCameraRenderObserver=this.Fd.onBeforeCameraRenderObservable.add((h=>{this._cameraRenderTime.beginMonitoring(),j.e.StartPerformanceCounter(`Rendering camera ${h.name}`)})),this._onAfterCameraRenderObserver=this.Fd.onAfterCameraRenderObservable.add((h=>{this._cameraRenderTime.endMonitoring(!1),j.e.EndPerformanceCounter(`Rendering camera ${h.name}`)}))):(this.Fd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Fd.getEngine()._drawCalls}constructor(h){this.Fd=h,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new A.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new A.b,this._captureFrameTime=!1,this._frameTime=new A.b,this._captureRenderTime=!1,this._renderTime=new A.b,this._captureInterFrameTime=!1,this._interFrameTime=new A.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new A.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new A.b,this._capturePhysicsTime=!1,this._physicsTime=new A.b,this._captureAnimationsTime=!1,this._animationsTime=new A.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new A.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=h.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(j.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Fd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=h.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(j.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Pq(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Pq(),this._captureParticlesRenderTime&&this._particlesRenderTime.Pq(),this._captureSpritesRenderTime&&this._spritesRenderTime.Pq(),this._captureRenderTime&&this._renderTime.Pq(),this._captureCameraRenderTime&&this._cameraRenderTime.Pq()}))}dispose(){this._disposed||(this.Fd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Fd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Fd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Fd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Fd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Fd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Fd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Fd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Fd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Fd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Fd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Fd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Fd=null,this._disposed=!0)}}},12644:(h,d,m)=>{"use strict";m.d(d,{c:()=>M});var j=m(11258),A=m(11261),b=m(11058),w=m(11374),a=m(11736),D=m(11809),S=m(11080);w.b.AddNodeConstructor("Light_Type_1",((h,d)=>()=>new M(h,b.i.Zero(),d)));class M extends D.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(h){this._shadowFrustumSize=h,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(h){this._shadowOrthoScale=h,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(h){this._orthoLeft=h}get orthoRight(){return this._orthoRight}set orthoRight(h){this._orthoRight=h}get orthoTop(){return this._orthoTop}set orthoTop(h){this._orthoTop=h}get orthoBottom(){return this._orthoBottom}set orthoBottom(h){this._orthoBottom=h}constructor(h,d,m){super(h,m),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=d.scale(-1),this.direction=d}getClassName(){return"Vb"}getTypeID(){return a.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(h,d,m){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(h):this._setDefaultAutoExtendShadowProjectionMatrix(h,d,m)}_setDefaultFixedFrustumShadowProjectionMatrix(h){const d=this.ih().activeCamera;d&&b.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:d.jb,void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,h,this.ih().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(h,d,m){const j=this.ih().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const h=b.i.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let j=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let w=0;w<m.length;w++){const a=m[w];if(!a)continue;const D=a.getBoundingInfo().boundingBox;for(let m=0;m<D.vectorsWorld.length;m++)b.i.TransformCoordinatesToRef(D.vectorsWorld[m],d,h),h.x<this._orthoLeft&&(this._orthoLeft=h.x),h.y<this._orthoBottom&&(this._orthoBottom=h.y),h.x>this._orthoRight&&(this._orthoRight=h.x),h.y>this._orthoTop&&(this._orthoTop=h.y),this.autoCalcShadowZBounds&&(h.z<j&&(j=h.z),h.z>A&&(A=h.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=j,this._shadowMaxZ=A)}const A=this._orthoRight-this._orthoLeft,w=this._orthoTop-this._orthoBottom,a=void 0!==this.shadowMinZ?this.shadowMinZ:(null===j||void 0===j?void 0:j.jb)||0,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===j||void 0===j?void 0:j.maxZ)||1e4,S=this.ih().getEngine().useReverseDepthBuffer;b.b.OrthoOffCenterLHToRef(this._orthoLeft-A*this.shadowOrthoScale,this._orthoRight+A*this.shadowOrthoScale,this._orthoBottom-w*this.shadowOrthoScale,this._orthoTop+w*this.shadowOrthoScale,S?D:a,S?a:D,h,this.ih().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,d){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,d),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,d),this)}transferToNodeMaterialEffect(h,d){return this.computeTransformedInformation()?(h.setFloat3(d,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(h.setFloat3(d,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(h){const d=this._scene.getEngine();return!d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:1}getDepthMaxZ(h){const d=this._scene.getEngine();return d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:1}prepareLightSpecificDefines(h,d){h["DIRLIGHT"+d]=!0}}(0,j.d)([(0,A.M)()],M.prototype,"shadowFrustumSize",null),(0,j.d)([(0,A.M)()],M.prototype,"shadowOrthoScale",null),(0,j.d)([(0,A.M)()],M.prototype,"autoUpdateExtends",void 0),(0,j.d)([(0,A.M)()],M.prototype,"autoCalcShadowZBounds",void 0),(0,j.d)([(0,A.M)("orthoLeft")],M.prototype,"_orthoLeft",void 0),(0,j.d)([(0,A.M)("orthoRight")],M.prototype,"_orthoRight",void 0),(0,j.d)([(0,A.M)("orthoTop")],M.prototype,"_orthoTop",void 0),(0,j.d)([(0,A.M)("orthoBottom")],M.prototype,"_orthoBottom",void 0),(0,S.i)("BABYLON.DirectionalLight",M)},13104:(h,d,m)=>{"use strict";m.d(d,{d:()=>M});var j=m(11258),A=m(11261),b=m(11058),w=m(11353),a=m(11374),D=m(11736),S=m(11080);a.b.AddNodeConstructor("Light_Type_3",((h,d)=>()=>new M(h,b.i.Zero(),d)));class M extends D.d{constructor(h,d,m){super(h,m),this.groundColor=new w.d(0,0,0),this.direction=d||b.i.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Cb"}setDirectionToTarget(h){return this.direction=b.i.Normalize(h.fm(b.i.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(h,d){const m=b.i.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",m.x,m.y,m.z,0,d),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.ab),d),this}transferToNodeMaterialEffect(h,d){const m=b.i.Normalize(this.direction);return h.setFloat3(d,m.x,m.y,m.z),this}Zd(){return this._worldMatrix||(this._worldMatrix=b.b.Identity()),this._worldMatrix}getTypeID(){return D.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(h,d){h["HEMILIGHT"+d]=!0}}(0,j.d)([(0,A.j)()],M.prototype,"groundColor",void 0),(0,j.d)([(0,A.K)()],M.prototype,"direction",void 0),(0,S.i)("BABYLON.HemisphericLight",M)},12611:(h,d,m)=>{"use strict";m.d(d,{b:()=>q});var j=m(11258),A=m(11261),b=m(11058),w=m(11374),a=m(11736),D=m(11809),S=m(11543),M=m(11080);w.b.AddNodeConstructor("Light_Type_2",((h,d)=>()=>new q(h,b.i.Zero(),b.i.Zero(),0,0,d)));class q extends D.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(h){this._iesProfileTexture!==h&&(this._iesProfileTexture=h,this._iesProfileTexture&&q._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(h){this._angle=h,this._cosHalfAngle=Math.cos(.5*h),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(h){this._innerAngle=h,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(h){this._shadowAngleScale=h,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(h){this._projectionTextureLightNear=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(h){this._projectionTextureLightFar=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(h){this._projectionTextureUpDirection=h,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(h){this._projectionTexture!==h&&(this._projectionTexture=h,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(q._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):q._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(h){return void 0!==h.onGeneratedObservable}static _IsTexture(h){return void 0!==h.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(h){this._projectionTextureProjectionLightMatrix=h,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(h,d,m,j,A,w){super(h,w),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=b.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=b.i.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=b.i.Zero(),this._projectionTextureViewLightMatrix=b.b.Zero(),this._projectionTextureProjectionLightMatrix=b.b.Zero(),this._projectionTextureScalingMatrix=b.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=d,this.direction=m,this.angle=j,this.exponent=A}getClassName(){return"SpotLight"}getTypeID(){return a.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(h){super._setDirection(h),this._projectionTextureViewLightDirty=!0}_setPosition(h){super._setPosition(h),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(h,d,m){const j=this.ih().activeCamera;if(!j)return;this._shadowAngleScale=this._shadowAngleScale||1;const A=this._shadowAngleScale*this._angle,w=void 0!==this.shadowMinZ?this.shadowMinZ:j.jb,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,D=this.ih().getEngine().useReverseDepthBuffer;b.b.PerspectiveFovLHToRef(A,1,D?a:w,D?w:a,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,D)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),b.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const h=this.projectionTextureLightFar,d=this.projectionTextureLightNear,m=h/(h-d),j=-m*d,A=1/Math.tan(this._angle/2);b.b.FromValuesToRef(A/1,0,0,0,0,A,0,0,0,0,m,1,0,0,j,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof S.e){const h=this._projectionTexture.uScale/2,d=this._projectionTexture.vScale/2;b.b.FromValuesToRef(h,0,0,0,0,d,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(h,d){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),h.setMatrix("textureProjectionMatrix"+d,this._projectionTextureMatrix),h.setTexture("projectionLightTexture"+d,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&h.setTexture("iesLightTexture"+d,this._iesProfileTexture),this}transferToEffect(h,d){let m;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,d),m=b.i.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,d),m=b.i.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",m.x,m.y,m.z,this._cosHalfAngle,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,d),this}transferToNodeMaterialEffect(h,d){let m;return m=this.computeTransformedInformation()?b.i.Normalize(this.transformedDirection):b.i.Normalize(this.direction),this.ih().useRightHandedSystem?h.setFloat3(d,-m.x,-m.y,-m.z):h.setFloat3(d,m.x,m.y,m.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(h){const d=this._scene.getEngine(),m=void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.jb)??0;return d.useReverseDepthBuffer&&d.isNDCHalfZRange?m:this._scene.getEngine().isNDCHalfZRange?0:m}getDepthMaxZ(h){const d=this._scene.getEngine(),m=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)??1e4;return d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:m}prepareLightSpecificDefines(h,d){h["SPOTLIGHT"+d]=!0,h["PROJECTEDLIGHTTEXTURE"+d]=!(!this.projectionTexture||!this.projectionTexture.isReady()),h["IESLIGHTTEXTURE"+d]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,j.d)([(0,A.M)()],q.prototype,"angle",null),(0,j.d)([(0,A.M)()],q.prototype,"innerAngle",null),(0,j.d)([(0,A.M)()],q.prototype,"shadowAngleScale",null),(0,j.d)([(0,A.M)()],q.prototype,"exponent",void 0),(0,j.d)([(0,A.M)()],q.prototype,"projectionTextureLightNear",null),(0,j.d)([(0,A.M)()],q.prototype,"projectionTextureLightFar",null),(0,j.d)([(0,A.M)()],q.prototype,"projectionTextureUpDirection",null),(0,j.d)([(0,A.D)("projectedLightTexture")],q.prototype,"_projectionTexture",void 0),(0,M.i)("BABYLON.SpotLight",q)},12336:(h,d,m)=>{"use strict";m.d(d,{c:()=>w,f:()=>b,g:()=>a});const j={},A={};function b(h,d){j[h]=d}function w(h,d){A[h]=d}function a(h){return A[h]?A[h]:null}},12243:(h,d,m)=>{"use strict";m.d(d,{d:()=>y,f:()=>W});var j,A=m(11107),b=m(11097),w=m(11604),a=m(11094),D=m(11121),S=m(11445),M=m(11150),q=m(11154),E=m(11245),I=m(11188),R=m(11144);!function(h){h[h.Clean=0]="Clean",h[h.Stop=1]="Stop",h[h.Sync=2]="Sync",h[h.NoSync=3]="NoSync"}(j||(j={}));const Z=new b.e,L={};let B=!1;function V(){return L[".babylon"]}function v(h,d){const m=L[h];return m||(D.c.Warn("Unable to find a plugin to load "+h+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),d?V():void 0)}function C(h,d,m){let j="Unable to load from "+(h.rawData?"binary data":h.url);return d?j+=`: ${d}`:m&&(j+=`: ${m}`),j}async function T(h,d,m,j,A,b,w,a,D){var S;const q="data:"===(E=h.url).substring(0,5)?E.substring(5):null;var E;if(h.rawData&&!w)throw"When using ArrayBufferView to load data the file extension must be provided.";const B=q||w?"":function(h){const d=h.indexOf("?");-1!==d&&(h=h.substring(0,d));const m=h.lastIndexOf(".");return h.substring(m,h.length).toLowerCase()}(h.url);let C=w?v(w,!0):q?function(h){for(const d in L){const m=L[d].plugin;if(m.canDirectLoad&&m.canDirectLoad(h))return L[d]}return V()}(h.url):v(B,!1);if(!C&&B){if(h.url&&!h.url.startsWith("blob:")){const d=await async function(h,d){const m=d.method||"GET";return await new Promise(((j,A)=>{const b=new R.c;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const h={};if(d.responseHeaders)for(const m of d.responseHeaders)h[m]=b.getResponseHeader(m)||"";j({response:b.response,headerValues:h})}else A(`Unable to fetch data from ${h}. Error code: ${b.status}`)})),b.open(m,h),b.send()}))}(h.url,{method:"HEAD",responseHeaders:["Content-Type"]}),m=d.headerValues?d.headerValues["Content-Type"]:"";m&&(C=function(h){for(const d in L){const m=L[d];if(m.mimeType===h)return m}}(m))}C||(C=V())}if(!C)throw new Error(`No plugin or fallback for ${w??h.url}`);if(!1===(null===D||void 0===D||null===(S=D[C.plugin.name])||void 0===S?void 0:S.enabled))throw new Error(`The '${C.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(h.rawData&&!C.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(h=>{if(C.plugin.createPlugin){const d=C.plugin.createPlugin(D??{});return d instanceof Promise?(d.then(h).catch((h=>{A("Error instantiating plugin.",h)})),null):(h(d),d)}return h(C.plugin),C.plugin})((D=>{var S;if(!D)throw`The loader plugin corresponding to the '${w}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Z.notifyObservers(D),q&&(D.canDirectLoad&&D.canDirectLoad(h.url)||!(0,M.q)(h.url))){if(D.directLoad){const h=D.directLoad(d,q);h instanceof Promise?h.then((h=>{m(D,h)})).catch((h=>{A("Error in directLoad of _loadData: "+h,h)})):m(D,h)}else m(D,q);return}const E=C.isBinary,R=(h,j)=>{d.q?A("Scene has been disposed"):m(D,h,j)};let L=null,B=!1;null===(S=D.pd)||void 0===S||S.add((()=>{B=!0,L&&(L.abort(),L=null),b()}));const V=()=>{if(B)return;const m=(h,d)=>{A(null===h||void 0===h?void 0:h.statusText,d)};if(!D.loadFile&&h.rawData)throw"Plugin does not support loading ArrayBufferView.";L=D.loadFile?D.loadFile(d,h.rawData||h.file||h.url,h.rootUrl,R,j,E,m,a):d._loadFile(h.file||h.url,R,j,!0,E,m)},v=d.getEngine();let T=v.enableOfflineSupport;if(T){let m=!1;for(const j of d.disableOfflineSupportExceptionRules)if(j.test(h.url)){m=!0;break}T=!m}T&&I.b.OfflineProviderFactory?d.offlineProvider=I.b.OfflineProviderFactory(h.url,V,v.disableManifestCheck):V()}))}function o(h,d){let m,j,b=null,w=null;if(d)if(d.name)m=`file:${d.name}`,j=d.name,b=d;else if(ArrayBuffer.isView(d))m="",j=(0,E.d)(),w=d;else if(d.startsWith("data:"))m=d,j="";else if(h){const b=d;if("/"===b.substring(0,1))return A.e.Error("Wrong sceneFilename parameter"),null;m=h+b,j=b}else m=d,j=A.e.GetFilename(d),h=A.e.GetFolderPath(d);else m=h,j=A.e.GetFilename(h),h=A.e.GetFolderPath(h);return{url:m,rootUrl:h,name:j,file:b,rawData:w}}function y(h){if("string"===typeof h.extensions){const d=h.extensions;L[d.toLowerCase()]={plugin:h,isBinary:!1}}else{const d=h.extensions,m=Object.keys(d);for(const j of m)L[j.toLowerCase()]={plugin:h,isBinary:d[j].isBinary,mimeType:d[j].mimeType}}}async function i(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.b.LastCreatedScene,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!j)return D.c.Error("No scene available to import mesh to"),null;const I=o(d,m);if(!I)return null;const R={};j.addPendingData(R);const Z=()=>{j.removePendingData(R)},L=(h,d)=>{const m=C(I,h,d);w?w(j,m,new q.i(m,q.e.SceneLoaderError,d)):D.c.Error(m),Z()},B=b?h=>{try{b(h)}catch(d){L("Error in onProgress callback: "+d,d)}}:void 0,V=(h,d,m,b,w,a,D,S)=>{if(j.importedMeshesFiles.push(I.url),A)try{A(h,d,m,b,w,a,D,S)}catch(M){L("Error in onSuccess callback: "+M,M)}j.removePendingData(R)};return await T(I,j,((d,m,A)=>{if(d.rewriteRootURL&&(I.rootUrl=d.rewriteRootURL(I.rootUrl,A)),d.importMesh){const A=[],b=[],w=[];if(!d.importMesh(h,j,m,I.rootUrl,A,b,w,L))return;j.loadingPluginName=d.name,V(A,b,w,[],[],[],[],[])}else{d.importMeshAsync(h,j,m,I.rootUrl,B,I.name).then((h=>{j.loadingPluginName=d.name,V(h.meshes,h.aE,h.skeletons,h.animationGroups,h.transformNodes,h.geometries,h.lights,h.spriteManagers)})).catch((h=>{L(h.message,h)}))}}),B,L,Z,S,M,E)}async function g(h,d,m,j,A,b,w,a){return await new Promise(((D,S)=>{try{i(h,d,m,j,((h,d,m,j,A,b,w,a)=>{D({meshes:h,aE:d,skeletons:m,animationGroups:j,transformNodes:A,geometries:b,lights:w,spriteManagers:a})}),A,((h,d,m)=>{S(m||new Error(d))}),b,w,a).catch(S)}catch(q){S(q)}}))}async function F(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.b.LastCreatedEngine,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};m?await H(h,d,new w.c(m),j,b,D,S,M,q):A.e.Error("No engine available")}async function f(h,d,m,j,A,b,w){return await new Promise(((a,D)=>{F(h,d,m,(h=>{a(h)}),j,((h,d,m)=>{D(m||new Error(d))}),A,b,w)}))}async function H(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.b.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!m)return D.c.Error("No scene available to append to"),null;const I=o(h,d);if(!I)return null;const R={};m.addPendingData(R);const Z=()=>{m.removePendingData(R)};S.c.ShowLoadingScreen&&!B&&(B=!0,m.getEngine().displayLoadingUI(),m.executeWhenReady((()=>{m.getEngine().hideLoadingUI(),B=!1})));const L=(h,d)=>{const j=C(I,h,d);b?b(m,j,new q.i(j,q.e.SceneLoaderError,d)):D.c.Error(j),Z()},V=A?h=>{try{A(h)}catch(d){L("Error in onProgress callback",d)}}:void 0,v=()=>{if(j)try{j(m)}catch(h){L("Error in onSuccess callback",h)}m.removePendingData(R)};return await T(I,m,((h,d)=>{if(h.load){if(!h.load(m,d,I.rootUrl,L))return;m.loadingPluginName=h.name,v()}else{h.loadAsync(m,d,I.rootUrl,V,I.name).then((()=>{m.loadingPluginName=h.name,v()})).catch((h=>{L(h.message,h)}))}}),V,L,Z,w,M,E)}async function c(h,d,m,j,A,b,w){return await new Promise(((a,D)=>{try{H(h,d,m,(h=>{a(h)}),j,((h,d,m)=>{D(m||new Error(d))}),A,b,w).catch(D)}catch(q){D(q)}}))}async function k(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.b.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!m)return D.c.Error("No scene available to load asset container to"),null;const E=o(h,d);if(!E)return null;const I={};m.addPendingData(I);const R=()=>{m.removePendingData(I)},Z=(h,d)=>{const j=C(E,h,d);b?b(m,j,new q.i(j,q.e.SceneLoaderError,d)):D.c.Error(j),R()},L=A?h=>{try{A(h)}catch(d){Z("Error in onProgress callback",d)}}:void 0,B=h=>{if(j)try{j(h)}catch(d){Z("Error in onSuccess callback",d)}m.removePendingData(I)};return await T(E,m,((h,d)=>{if(h.loadAssetContainer){const j=h.loadAssetContainer(m,d,E.rootUrl,Z);if(!j)return;j.populateRootNodes(),m.loadingPluginName=h.name,B(j)}else if(h.loadAssetContainerAsync){h.loadAssetContainerAsync(m,d,E.rootUrl,L,E.name).then((d=>{d.populateRootNodes(),m.loadingPluginName=h.name,B(d)})).catch((h=>{Z(h.message,h)}))}else Z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),L,Z,R,w,S,M)}async function l(h,d,m,j,A,b,w){return await new Promise(((a,D)=>{try{k(h,d,m,(h=>{a(h)}),j,((h,d,m)=>{D(m||new Error(d))}),A,b,w).catch(D)}catch(q){D(q)}}))}async function K(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.b.LastCreatedScene,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!m)return void D.c.Error("No scene available to load animations to");if(j){for(const j of m.animatables)j.reset();m.stopAllAnimations();const h=m.animationGroups.slice();for(const m of h)m.dispose();const d=m.getNodes();for(const m of d)m.animations&&(m.animations=[])}else switch(A){case 0:const h=m.animationGroups.slice();for(const d of h)d.dispose();break;case 1:for(const d of m.animationGroups)d.stop();break;case 2:for(const d of m.animationGroups)d.reset(),d.restart();break;case 3:break;default:return void D.c.Error("Unknown animation group loading mode value '"+A+"'")}const R=m.animatables.length;await k(h,d,m,(h=>{h.mergeAnimationsTo(m,m.animatables.slice(R),b),h.dispose(),m.onAnimationFileImportedObservable.notifyObservers(m),w&&w(m)}),S,M,q,E,I)}async function N(h,d,m,j,A,b,w,a,D,S){return await new Promise(((M,E)=>{try{K(h,d,m,j,A,b,(h=>{M(h)}),w,((h,d,m)=>{E(m||new Error(d))}),a,D,S).catch(E)}catch(q){E(q)}}))}class W{static get ForceFullSceneLoadingForIncremental(){return S.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(h){S.c.ForceFullSceneLoadingForIncremental=h}static get ShowLoadingScreen(){return S.c.ShowLoadingScreen}static set ShowLoadingScreen(h){S.c.ShowLoadingScreen=h}static get loggingLevel(){return S.c.loggingLevel}static set loggingLevel(h){S.c.loggingLevel=h}static get CleanBoneMatrixWeights(){return S.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(h){S.c.CleanBoneMatrixWeights=h}static GetDefaultPlugin(){return V()}static GetPluginForExtension(h){var d;return null===(d=v(h,!0))||void 0===d?void 0:d.plugin}static IsPluginForExtensionAvailable(h){return function(h){return!!L[h]}(h)}static RegisterPlugin(h){y(h)}static ImportMesh(h,d,m,j,A,b,w,D,S){i(h,d,m,j,A,b,w,D,S).catch((h=>null===w||void 0===w?void 0:w(a.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportMeshAsync(h,d,m,j,A,b,w){return await g(h,d,m,j,A,b,w)}static Load(h,d,m,j,A,b,w,D){F(h,d,m,j,A,b,w,D).catch((h=>null===b||void 0===b?void 0:b(a.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAsync(h,d,m,j,A,b){return await f(h,d,m,j,A,b)}static Append(h,d,m,j,A,b,w,D){H(h,d,m,j,A,b,w,D).catch((h=>null===b||void 0===b?void 0:b(m??a.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async AppendAsync(h,d,m,j,A,b){return await c(h,d,m,j,A,b)}static LoadAssetContainer(h,d,m,j,A,b,w,D){k(h,d,m,j,A,b,w,D).catch((h=>null===b||void 0===b?void 0:b(m??a.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAssetContainerAsync(h,d,m,j,A,b){return await l(h,d,m,j,A,b)}static ImportAnimations(h,d,m,j,A,b,w,D,S,M,q){K(h,d,m,j,A,b,w,D,S,M,q).catch((h=>null===S||void 0===S?void 0:S(m??a.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportAnimationsAsync(h,d,m,j,A,b,w,a,D,S,M){return await N(h,d,m,j,A,b,a,S,M)}}W.NO_LOGGING=0,W.MINIMAL_LOGGING=1,W.SUMMARY_LOGGING=2,W.DETAILED_LOGGING=3,W.OnPluginActivatedObservable=Z},12629:(h,d,m)=>{"use strict";m.d(d,{e:()=>E});var j=m(11258),A=m(11261),b=m(11107),w=m(11058),a=m(11534),D=m(11543),S=m(11080),M=m(11097),q=m(11341);m(12633);class E extends a.b{set boundingBoxSize(h){if(this._boundingBoxSize&&this._boundingBoxSize.equals(h))return;this._boundingBoxSize=h;const d=this.ih();d&&d.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(h){this._rotationY=h,this.setReflectionTextureMatrix(w.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(h,d,m){let j="";for(const A of h)j+=A;return new E(j,d,null,m,h)}static CreateFromPrefilteredData(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=d.useDelayedTextureLoading;d.useDelayedTextureLoading=!1;const b=new E(h,d,null,!1,null,null,null,void 0,!0,m,j);return d.useDelayedTextureLoading=A,b}constructor(h,d){var m;let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,R=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0;super(d),this.onLoadObservable=new M.e,this.boundingBoxPosition=w.i.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new w.b,this._buffer=null,this.name=h,this.url=h,this._noMipmap=A,this.Nd=!1,this.isCube=!0,this._textureMatrix=w.b.Identity(),this.coordinatesMode=D.e.CUBIC_MODE;let v=null,C=null;null===j||Array.isArray(j)?(this._noMipmap=A,this._format=q,this._createPolynomials=R,v=j,this._loaderOptions=B,this._useSRGBBuffer=V,this._lodScale=Z,this._lodOffset=L):(v=j.extensions??null,this._noMipmap=j.noMipmap??!1,b=j.files??null,C=j.buffer??null,this._format=j.format??5,E=j.prefiltered??!1,I=j.forcedExtension??null,this._createPolynomials=j.createPolynomials??!1,this._lodScale=j.lodScale??.8,this._lodOffset=j.lodOffset??0,this._loaderOptions=j.loaderOptions,this._useSRGBBuffer=j.useSRGBBuffer,a=j.u??null,S=j.onError??null),(h||b)&&this.updateURL(h,I,a,E,S,v,null===(m=this.ih())||void 0===m?void 0:m.useDelayedTextureLoading,b,C)}getClassName(){return"CubeTexture"}updateURL(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=h),this.url=h,d&&(this._forcedExtension=d);const S=h.lastIndexOf("."),M=d||(S>-1?h.substring(S).toLowerCase():""),q=0===M.indexOf(".dds"),E=0===M.indexOf(".env"),I=0===M.indexOf(".basis");if(E?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=j,j&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(I||E||q||b||(b=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,b){for(let d=0;d<b.length;d++)this._files.push(h+b[d]);this._extensions=b}this._buffer=D,w?(this.delayLoadState=4,this._delayedOnLoad=m,this._delayedOnError=A):this._loadTexture(m,A)}delayLoad(h){4===this.delayLoadState&&(h&&(this._forcedExtension=h),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(h){var d,m;if(h.updateFlag===this._textureMatrix.updateFlag)return;h.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(m=this.ih())||void 0===m||m.markAllMaterialsAsDirty(1,(h=>-1!==h.getActiveTextures().indexOf(this))));if(this._textureMatrix=h,null===(d=this.ih())||void 0===d||!d.useRightHandedSystem)return;const j=w.d.Qd[0],A=w.d.Quaternion[0],b=w.d.Qd[1];this._textureMatrix.decompose(j,A,b),A.z*=-1,A.w*=-1,w.b.ComposeToRef(j,A,b,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var h;return null!==(h=this.ih())&&void 0!==h&&h.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=this.ih(),j=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const A=()=>{var d;(this.onLoadObservable.notifyObservers(this),j)&&(j.dispose(),null===(d=this.ih())||void 0===d||d.markAllMaterialsAsDirty(1));h&&h()},w=(h,m)=>{this._loadingError=!0,this._errorObject={message:h,exception:m},d&&d(h,m),D.e.OnTextureLoadErrorObservable.notifyObservers(this)};var a;this._texture?this._texture.isReady?b.e.SetImmediate((()=>A())):this._texture.onLoadedObservable.add((()=>A())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,m,this._lodScale,this._lodOffset,h,w,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,m,this._files,this._noMipmap,h,w,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(a=this._texture)||void 0===a||a.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(h,d,m){const j=q.d.Parse((()=>{let j=!1;return h.prefiltered&&(j=h.prefiltered),new E(m+(h.url??h.name),d,h.extensions,!1,h.files||null,null,null,void 0,j,h.forcedExtension)}),h,d);if(h.boundingBoxPosition&&(j.boundingBoxPosition=w.i.Ud(h.boundingBoxPosition)),h.boundingBoxSize&&(j.boundingBoxSize=w.i.Ud(h.boundingBoxSize)),h.animations)for(let A=0;A<h.animations.length;A++){const d=h.animations[A],m=(0,S.e)("BABYLON.Animation");m&&j.animations.push(m.Parse(d))}return j}clone(){let h=0;const d=q.d.Clone((()=>{const d=new E(this.url,this.ih()||this._getEngine(),this._extensions,this._noMipmap,this._files);return h=d.uniqueId,d}),this);return d.uniqueId=h,d}}(0,j.d)([(0,A.M)()],E.prototype,"url",void 0),(0,j.d)([(0,A.K)()],E.prototype,"boundingBoxPosition",void 0),(0,j.d)([(0,A.K)()],E.prototype,"boundingBoxSize",null),(0,j.d)([(0,A.M)("rotationY")],E.prototype,"rotationY",null),(0,j.d)([(0,A.M)("files")],E.prototype,"_files",void 0),(0,j.d)([(0,A.M)("forcedExtension")],E.prototype,"_forcedExtension",void 0),(0,j.d)([(0,A.M)("extensions")],E.prototype,"_extensions",void 0),(0,j.d)([(0,A.v)("textureMatrix")],E.prototype,"_textureMatrix",void 0),(0,j.d)([(0,A.v)("textureMatrixRefraction")],E.prototype,"_textureMatrixRefraction",void 0),D.e._CubeTextureParser=E.Parse,(0,S.i)("BABYLON.CubeTexture",E)},13113:(h,d,m)=>{"use strict";m.d(d,{d:()=>D});var j=m(11121),A=m(11543),b=m(11248),w=m(11470),a=m(11216);w.ThinEngine.prototype.createDynamicTexture=function(h,d,m,j){const A=new a.c(this,4);return A.baseWidth=h,A.baseHeight=d,m&&(h=this.needPOTTextures?(0,b.f)(h,this._caps.maxTextureSize):h,d=this.needPOTTextures?(0,b.f)(d,this._caps.maxTextureSize):d),A.width=h,A.height=d,A.isReady=!1,A.generateMipMaps=m,A.samplingMode=j,this.updateTextureSamplingMode(j,A),this._internalTexturesCache.push(A),A},w.ThinEngine.prototype.updateDynamicTexture=function(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!h)return;const w=this._gl,a=w.TEXTURE_2D,D=this._bindTextureDirectly(a,h,!0,b);this._unpackFlipY(void 0===m?h.invertY:m),j&&w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const S=this._getWebGLTextureType(h.type),M=this._getInternalFormat(A||h.format),q=this._getRGBABufferInternalSizedFormat(h.type,M);w.texImage2D(a,0,q,M,S,d),h.generateMipMaps&&w.generateMipmap(a),D||this._bindTextureDirectly(a,null),j&&w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),A&&(h.format=A),h._dynamicTextureSource=d,h._premulAlpha=j,h.invertY=m||!1,h.isReady=!0};class D extends A.e{constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,a=arguments.length>6?arguments[6]:void 0;const D=!m||m._isScene;super(null,D?m:null===m||void 0===m?void 0:m.Fd,D?!j:m,a,b,void 0,void 0,void 0,void 0,w),this.name=h,this.wrapU=A.e.CLAMP_ADDRESSMODE,this.wrapV=A.e.CLAMP_ADDRESSMODE,this._generateMipMaps=j;const S=this._getEngine();if(!S)return;if(d.getContext)this._canvas=d,this._ownCanvas=!1,this._texture=S.createDynamicTexture(this._canvas.width,this._canvas.height,j,b);else{this._canvas=S.createCanvas(1,1),this._ownCanvas=!0;const h=d;h.width||0===h.width?this._texture=S.createDynamicTexture(h.width,h.height,j,b):this._texture=S.createDynamicTexture(d,d,j,b)}const M=this.getSize();this._canvas.width!==M.width&&(this._canvas.width=M.width),this._canvas.height!==M.height&&(this._canvas.height=M.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(h){this._canvas.width=h.width,this._canvas.height=h.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(h.width,h.height,this._generateMipMaps,this.samplingMode)}scale(h){const d=this.getSize();d.width*=h,d.height*=h,this._recreate(d)}scaleTo(h,d){const m=this.getSize();m.width=h,m.height=d,this._recreate(m)}getContext(){return this._context}clear(h){const d=this.getSize();h&&(this._context.fillStyle=h),this._context.clearRect(0,0,d.width,d.height)}update(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===h||h,d,this._format||void 0,void 0,m)}drawText(h,d,m,j,A,b,w){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const D=this.getSize();if(b&&(this._context.fillStyle=b,this._context.fillRect(0,0,D.width,D.height)),this._context.font=j,null===d||void 0===d){const m=this._context.measureText(h);d=(D.width-m.width)/2}if(null===m||void 0===m){const h=parseInt(j.replace(/\D/g,""));m=D.height/2+h/3.65}this._context.fillStyle=A||"",this._context.fillText(h,d,m),a&&this.update(w)}dispose(){var h,d;(super.dispose(),this._ownCanvas)&&(null===(h=this._canvas)||void 0===h||null===(d=h.remove)||void 0===d||d.call(h));this._canvas=null,this._context=null}clone(){const h=this.ih();if(!h)return this;const d=this.getSize(),m=new D(this.name,d,h,this._generateMipMaps);return m.Nd=this.Nd,m.level=this.level,m.wrapU=this.wrapU,m.wrapV=this.wrapV,m}serialize(){const h=this.ih();h&&!h.isReady()&&j.c.Warn("The scene must be ready before serializing the dynamic texture");const d=super.serialize();return D._IsCanvasElement(this._canvas)&&(d.base64String=this._canvas.toDataURL()),d.invertY=this._invertY,d.samplingMode=this.samplingMode,d}static _IsCanvasElement(h){return void 0!==h.toDataURL}_rebuild(){this.update()}}},12547:(h,d,m)=>{"use strict";m.d(d,{d:()=>A});var j=m(11543);class A extends j.e{get depth(){return this._depth}constructor(h,d,m,A,b,w){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:j.e.TRILINEAR_SAMPLINGMODE,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10?arguments[10]:void 0;super(null,w,!a,D),this.format=b,this._texture=w.getEngine().createRawTexture2DArray(h,d,m,A,b,a,D,S,null,M,q),this._depth=A,this.is2DArray=!0}update(h){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,h,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(h,d,m,j,b){return new A(h,d,m,j,5,b,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12356:(h,d,m)=>{"use strict";m.d(d,{d:()=>a,e:()=>D,i:()=>b,j:()=>w});var j=m(11099),A=m(11058);function b(h,d){return`{X: ${h.x.toFixed(d)} Y: ${h.y.toFixed(d)}}`}function w(h,d){return`{X: ${h._x.toFixed(d)} Y: ${h._y.toFixed(d)} Z: ${h._z.toFixed(d)}}`}function a(h,d){return 2*Math.acos((0,j.Clamp)(A.c.Dot(h,d)))}function D(h,d){const m=new A.c;return function(h,d,m){const b=A.i.Cross(h,d),w=Math.acos((0,j.Clamp)(A.i.Dot(h,d),-1,1));A.c.RotationAxisToRef(b,w,m)}(h,d,m),m}},12184:(h,d,m)=>{"use strict";m.d(d,{c:()=>S});var j=m(11058),A=m(11353),b=m(11419),w=m(11388),a=m(11449);m(12191);function D(h){let d=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const m=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],b=[];let D=[];const S=h.width||h.size||1,M=h.height||h.size||1,q=h.depth||h.size||1,E=h.wrap||!1;let I=void 0===h.topBaseAt?1:h.topBaseAt,R=void 0===h.bottomBaseAt?0:h.bottomBaseAt;I=(I+4)%4,R=(R+4)%4;let Z=[2,0,3,1][I],L=[2,0,1,3][R],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(E){d=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let h=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],m=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const j=[17,18,19,16],A=[22,23,20,21];for(;Z>0;)h.unshift(h.pop()),j.unshift(j.pop()),Z--;for(;L>0;)m.unshift(m.pop()),A.unshift(A.pop()),L--;h=h.flat(),m=m.flat(),B=B.concat(h).concat(m),d.push(j[0],j[2],j[3],j[0],j[1],j[2]),d.push(A[0],A[2],A[3],A[0],A[1],A[2])}const V=[S/2,M/2,q/2];D=B.reduce(((h,d,m)=>h.concat(d*V[m%3])),[]);const v=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,C=h.faceUV||new Array(6),T=h.faceColors,o=[];for(let w=0;w<6;w++)void 0===C[w]&&(C[w]=new j.m(0,0,1,1)),T&&void 0===T[w]&&(T[w]=new A.f(1,1,1,1));for(let j=0;j<6;j++)if(b.push(C[j].z,a.b?1-C[j].w:C[j].w),b.push(C[j].x,a.b?1-C[j].w:C[j].w),b.push(C[j].x,a.b?1-C[j].y:C[j].y),b.push(C[j].z,a.b?1-C[j].y:C[j].y),T)for(let h=0;h<4;h++)o.push(T[j].r,T[j].g,T[j].b,T[j].a);w.c._ComputeSides(v,D,d,m,b,h.frontUVs,h.backUVs);const y=new w.c;if(y.indices=d,y.Fh=D,y.fh=m,y.kh=b,T){const h=v===w.c.DOUBLESIDE?o.concat(o):o;y.Hh=h}return y}function S(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new b.d(h,m);d.sideOrientation=b.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return D(d).Nh(j,d.updatable),j}w.c.CreateBox=D,b.d.CreateBox=function(h,d){return S(h,{size:d,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12339:(h,d,m)=>{"use strict";m.d(d,{b:()=>a});var j=m(11419),A=m(11388),b=m(11449);function w(h){const d=[],m=[],j=[],w=[],a=h.radius||.5,D=h.tessellation||64,S=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,M=0===h.sideOrientation?0:h.sideOrientation||A.c.DEFAULTSIDE;d.push(0,0,0),w.push(.5,.5);const q=2*Math.PI*S,E=1===S?q/D:q/(D-1);let I=0;for(let A=0;A<D;A++){const h=Math.cos(I),m=Math.sin(I),j=(h+1)/2,A=(1-m)/2;d.push(a*h,a*m,0),w.push(j,b.b?1-A:A),I+=E}1===S&&(d.push(d[3],d[4],d[5]),w.push(w[2],b.b?1-w[3]:w[3]));const R=d.length/3;for(let A=1;A<R-1;A++)m.push(A+1,0,A);A.c.ComputeNormals(d,m,j),A.c._ComputeSides(M,d,m,j,w,h.frontUVs,h.backUVs);const Z=new A.c;return Z.indices=m,Z.Fh=d,Z.fh=j,Z.kh=w,Z}function a(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new j.d(h,m);d.sideOrientation=j.d._GetDefaultSideOrientation(d.sideOrientation),A._originalBuilderSideOrientation=d.sideOrientation;return w(d).Nh(A,d.updatable),A}A.c.CreateDisc=w,j.d.CreateDisc=function(h,d,m){return a(h,{radius:d,tessellation:m,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12191:(h,d,m)=>{"use strict";m.d(d,{d:()=>L,b:()=>V,h:()=>B});var j=m(11058),A=m(11353),b=m(11419),w=m(11388),a=m(11281);b.d._GroundMeshParser=(h,d)=>D.Parse(h,d);class D extends b.d{constructor(h,d){super(h,d),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=h,this._subdivisionsY=h,this.subdivide(h);const m=this;m.createOrUpdateSubmeshesOctree&&m.createOrUpdateSubmeshesOctree(d)}getHeightAtCoordinates(h,d){const m=this.getWorldMatrix(),A=j.d.Matrix[5];m.invertToRef(A);const b=j.d.Qd[8];if(j.i.TransformCoordinatesFromFloatsToRef(h,0,d,A,b),h=b.x,d=b.z,h<this._minX||h>=this._maxX||d<=this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(h,d),a=-(w.x*h+w.z*d+w.w)/w.y;return j.i.TransformCoordinatesFromFloatsToRef(0,a,0,m,b),b.y}getNormalAtCoordinates(h,d){const m=new j.i(0,1,0);return this.getNormalAtCoordinatesToRef(h,d,m),m}getNormalAtCoordinatesToRef(h,d,m){const A=this.getWorldMatrix(),b=j.d.Matrix[5];A.invertToRef(b);const w=j.d.Qd[8];if(j.i.TransformCoordinatesFromFloatsToRef(h,0,d,b,w),h=w.x,d=w.z,h<this._minX||h>this._maxX||d<this._minZ||d>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(h,d);return j.i.TransformNormalFromFloatsToRef(a.x,a.y,a.z,A,m),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(h,d){const m=Math.floor((h+this._maxX)*this._subdivisionsX/this._width),j=Math.floor(-(d+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),A=this._heightQuads[j*this._subdivisionsX+m];let b;return b=d<A.slope.x*h+A.slope.y?A.facet1:A.facet2,b}_initHeightQuads(){const h=this._subdivisionsX,d=this._subdivisionsY;this._heightQuads=[];for(let m=0;m<d;m++)for(let d=0;d<h;d++){const A={slope:j.h.Zero(),facet1:new j.m(0,0,0,0),facet2:new j.m(0,0,0,0)};this._heightQuads[m*h+d]=A}return this}_computeHeightQuads(){const h=this.getVerticesData(a.d.PositionKind);if(!h)return this;const d=j.d.Qd[3],m=j.d.Qd[2],A=j.d.Qd[1],b=j.d.Qd[0],w=j.d.Qd[4],D=j.d.Qd[5],S=j.d.Qd[6],M=j.d.Qd[7],q=j.d.Qd[8];let E=0,I=0,R=0,Z=0,L=0,B=0,V=0;const v=this._subdivisionsX,C=this._subdivisionsY;for(let a=0;a<C;a++)for(let C=0;C<v;C++){E=3*C,I=a*(v+1)*3,R=(a+1)*(v+1)*3,d.x=h[I+E],d.y=h[I+E+1],d.z=h[I+E+2],m.x=h[I+E+3],m.y=h[I+E+4],m.z=h[I+E+5],A.x=h[R+E],A.y=h[R+E+1],A.z=h[R+E+2],b.x=h[R+E+3],b.y=h[R+E+4],b.z=h[R+E+5],Z=(b.z-d.z)/(b.x-d.x),L=d.z-Z*d.x,m.subtractToRef(d,w),A.subtractToRef(d,D),b.subtractToRef(d,S),j.i.CrossToRef(S,D,M),j.i.CrossToRef(w,S,q),M.normalize(),q.normalize(),B=-(M.x*d.x+M.y*d.y+M.z*d.z),V=-(q.x*m.x+q.y*m.y+q.z*m.z);const T=this._heightQuads[a*v+C];T.slope.xd(Z,L),T.facet1.xd(M.x,M.y,M.z,B),T.facet2.xd(q.x,q.y,q.z,V)}return this}serialize(h){super.serialize(h),h.subdivisionsX=this._subdivisionsX,h.subdivisionsY=this._subdivisionsY,h.minX=this._minX,h.maxX=this._maxX,h.jb=this._minZ,h.maxZ=this._maxZ,h.width=this._width,h.height=this._height}static Parse(h,d){const m=new D(h.name,d);return m._subdivisionsX=h.subdivisionsX||1,m._subdivisionsY=h.subdivisionsY||1,m._minX=h.minX,m._maxX=h.maxX,m._minZ=h.jb,m._maxZ=h.maxZ,m._width=h.width,m._height=h.height,m}}var S=m(11107),M=m(11094),q=m(11065),E=m(11449);function I(h){const d=[],m=[],A=[],b=[];let a,D;const S=h.width||h.size||1,M=h.height||h.size||1,q=0|(h.subdivisionsX||h.subdivisions||1),I=0|(h.subdivisionsY||h.subdivisions||1);for(a=0;a<=I;a++)for(D=0;D<=q;D++){const h=new j.i(D*S/q-S/2,0,(I-a)*M/I-M/2),d=new j.i(0,1,0);m.push(h.x,h.y,h.z),A.push(d.x,d.y,d.z),b.push(D/q,E.b?a/I:1-a/I)}for(a=0;a<I;a++)for(D=0;D<q;D++)d.push(D+1+(a+1)*(q+1)),d.push(D+1+a*(q+1)),d.push(D+a*(q+1)),d.push(D+(a+1)*(q+1)),d.push(D+1+(a+1)*(q+1)),d.push(D+a*(q+1));const R=new w.c;return R.indices=d,R.Fh=m,R.fh=A,R.kh=b,R}function R(h){const d=void 0!==h.xmin&&null!==h.xmin?h.xmin:-1,m=void 0!==h.zmin&&null!==h.zmin?h.zmin:-1,A=void 0!==h.xmax&&null!==h.xmax?h.xmax:1,b=void 0!==h.zmax&&null!==h.zmax?h.zmax:1,a=h.subdivisions||{w:1,h:1},D=h.precision||{w:1,h:1},S=[],M=[],q=[],E=[];let I,R,Z,L;a.h=a.h<1?1:a.h,a.w=a.w<1?1:a.w,D.w=D.w<1?1:D.w,D.h=D.h<1?1:D.h;const B=(A-d)/a.w,V=(b-m)/a.h;function v(h,d,m,A){const b=M.length/3,w=D.w+1;for(I=0;I<D.h;I++)for(R=0;R<D.w;R++){const h=[b+R+I*w,b+(R+1)+I*w,b+(R+1)+(I+1)*w,b+R+(I+1)*w];S.push(h[1]),S.push(h[2]),S.push(h[3]),S.push(h[0]),S.push(h[1]),S.push(h[3])}const a=j.i.Zero(),Z=new j.i(0,1,0);for(I=0;I<=D.h;I++)for(a.z=I*(A-d)/D.h+d,R=0;R<=D.w;R++)a.x=R*(m-h)/D.w+h,a.y=0,M.push(a.x,a.y,a.z),q.push(Z.x,Z.y,Z.z),E.push(R/D.w,I/D.h)}for(Z=0;Z<a.h;Z++)for(L=0;L<a.w;L++)v(d+L*B,m+Z*V,d+(L+1)*B,m+(Z+1)*V);const C=new w.c;return C.indices=S,C.Fh=M,C.fh=q,C.kh=E,C}function Z(h){const d=[],m=[],b=[],a=[];let D,S;const M=h.colorFilter||new A.d(.3,.59,.11),E=h.alphaFilter||0;let I=!1;if(h.minHeight>h.maxHeight){I=!0;const d=h.maxHeight;h.maxHeight=h.minHeight,h.minHeight=d}for(D=0;D<=h.subdivisions;D++)for(S=0;S<=h.subdivisions;S++){const d=new j.i(S*h.width/h.subdivisions-h.width/2,0,(h.subdivisions-D)*h.height/h.subdivisions-h.height/2),A=4*(((d.x+h.width/2)/h.width*(h.bufferWidth-1)|0)+((1-(d.z+h.height/2)/h.height)*(h.bufferHeight-1)|0)*h.bufferWidth);let w=h.buffer[A]/255,R=h.buffer[A+1]/255,Z=h.buffer[A+2]/255;const L=h.buffer[A+3]/255;I&&(w=1-w,R=1-R,Z=1-Z);const B=w*M.r+R*M.g+Z*M.b;d.y=L>=E?h.minHeight+(h.maxHeight-h.minHeight)*B:h.minHeight-q.c,h.heightBuffer&&(h.heightBuffer[D*(h.subdivisions+1)+S]=d.y),m.push(d.x,d.y,d.z),b.push(0,0,0),a.push(S/h.subdivisions,1-D/h.subdivisions)}for(D=0;D<h.subdivisions;D++)for(S=0;S<h.subdivisions;S++){const j=S+1+(D+1)*(h.subdivisions+1),A=S+1+D*(h.subdivisions+1),b=S+D*(h.subdivisions+1),w=S+(D+1)*(h.subdivisions+1),a=m[3*j+1]>=h.minHeight,M=m[3*A+1]>=h.minHeight,q=m[3*b+1]>=h.minHeight;a&&M&&q&&(d.push(j),d.push(A),d.push(b));m[3*w+1]>=h.minHeight&&a&&q&&(d.push(w),d.push(j),d.push(b))}w.c.ComputeNormals(m,d,b);const R=new w.c;return R.indices=d,R.Fh=m,R.fh=b,R.kh=a,R}function L(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const m=new D(h,arguments.length>2?arguments[2]:void 0);m._setReady(!1),m._subdivisionsX=d.subdivisionsX||d.subdivisions||1,m._subdivisionsY=d.subdivisionsY||d.subdivisions||1,m._width=d.width||1,m._height=d.height||1,m._maxX=m._width/2,m._maxZ=m._height/2,m._minX=-m._maxX,m._minZ=-m._maxZ;return I(d).Nh(m,d.updatable),m._setReady(!0),m}function B(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new b.d(h,m);return R(d).Nh(j,d.updatable),j}function V(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=m.width||10,w=m.height||10,a=m.subdivisions||1,q=m.minHeight||0,E=m.maxHeight||1,I=m.colorFilter||new A.d(.3,.59,.11),R=m.alphaFilter||0,L=m.updatable,B=m.onReady;j=j||M.b.LastCreatedScene;const V=new D(h,j);let v;V._subdivisionsX=a,V._subdivisionsY=a,V._width=b,V._height=w,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ,V._setReady(!1),m.passHeightBufferInCallback&&(v=new Float32Array((a+1)*(a+1)));const C=(h,d,m)=>{Z({width:b,height:w,subdivisions:a,minHeight:q,maxHeight:E,colorFilter:I,buffer:h,bufferWidth:d,bufferHeight:m,alphaFilter:R,heightBuffer:v}).Nh(V,L),B&&B(V,v),V._setReady(!0)};if("string"===typeof d){const h=h=>{var d;const m=h.width,A=h.height;if(j.q)return;const b=null===(d=j)||void 0===d?void 0:d.getEngine().resizeImageBitmap(h,m,A);C(b,m,A)};S.e.LoadImage(d,h,m.onError?m.onError:()=>{},j.offlineProvider)}else C(d.data,d.width,d.height);return V}w.c.CreateGround=I,w.c.CreateTiledGround=R,w.c.CreateGroundFromHeightMap=Z,b.d.CreateGround=(h,d,m,j,A,b)=>L(h,{width:d,height:m,subdivisions:j,updatable:b},A),b.d.CreateTiledGround=(h,d,m,j,A,b,w,a,D)=>B(h,{xmin:d,zmin:m,xmax:j,zmax:A,subdivisions:b,precision:w,updatable:D},a),b.d.CreateGroundFromHeightMap=(h,d,m,j,A,b,w,a,D,S,M)=>V(h,d,{width:m,height:j,subdivisions:A,minHeight:b,maxHeight:w,updatable:D,onReady:S,alphaFilter:M},a)},12843:(h,d,m)=>{"use strict";m.d(d,{b:()=>I,c:()=>q,d:()=>E});var j=m(11058),A=m(11419),b=m(11388),w=m(11740),a=m(11281),D=m(11121);function S(h){const d=[],m=[],j=h.lines,A=h.Hh,w=[];let a=0;for(let b=0;b<j.length;b++){const h=j[b];for(let j=0;j<h.length;j++){const{x:D,y:S,z:M}=h[j];if(m.push(D,S,M),A){const h=A[b],{r:d,g:m,b:a,a:D}=h[j];w.push(d,m,a,D)}j>0&&(d.push(a-1),d.push(a)),a++}}const D=new b.c;return D.indices=d,D.Fh=m,A&&(D.Hh=w),D}function M(h){const d=h.dashSize||3,m=h.gapSize||1,A=h.dashNb||200,w=h.points,a=[],D=[],S=j.i.Zero();let M=0,q=0,E=0,I=0,R=0,Z=0,L=0;for(L=0;L<w.length-1;L++)w[L+1].subtractToRef(w[L],S),M+=S.length();for(E=M/A,I=d*E/(d+m),L=0;L<w.length-1;L++){w[L+1].subtractToRef(w[L],S),q=Math.floor(S.length()/E),S.normalize();for(let h=0;h<q;h++)R=E*h,a.push(w[L].x+R*S.x,w[L].y+R*S.y,w[L].z+R*S.z),a.push(w[L].x+(R+I)*S.x,w[L].y+(R+I)*S.y,w[L].z+(R+I)*S.z),D.push(Z,Z+1),Z+=2}const B=new b.c;return B.Fh=a,B.indices=D,B}function q(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=d.instance,A=d.lines,b=d.Hh;if(j){const h=j.getVerticesData(a.d.PositionKind);let d,m;b&&(d=j.getVerticesData(a.d.ColorKind));let w=0,D=0;for(let j=0;j<A.length;j++){const a=A[j];for(let A=0;A<a.length;A++)h[w]=a[A].x,h[w+1]=a[A].y,h[w+2]=a[A].z,b&&d&&(m=b[j],d[D]=m[A].r,d[D+1]=m[A].g,d[D+2]=m[A].b,d[D+3]=m[A].a,D+=4),w+=3}return j.updateVerticesData(a.d.PositionKind,h,!1,!1),b&&d&&j.updateVerticesData(a.d.ColorKind,d,!1,!1),j.refreshBoundingInfo(),j}const D=!!b,M=new w.d(h,m,null,void 0,void 0,D,d.useVertexAlpha,d.material);return S(d).Nh(M,d.updatable),M}function E(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=d.Hh?[d.Hh]:null;return q(h,{lines:[d.points],updatable:d.updatable,instance:d.instance,Hh:j,useVertexAlpha:d.useVertexAlpha,material:d.material},m)}function I(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=d.points,a=d.instance,S=d.gapSize||1,q=d.dashSize||3;if(a){const h=h=>{const d=j.i.Zero(),m=h.length/6;let A=0,w=0,D=0,S=0,M=0,q=0,E=0,I=0;for(E=0;E<b.length-1;E++)b[E+1].subtractToRef(b[E],d),A+=d.length();D=A/m;const R=a._creationDataStorage.dashSize;for(S=R*D/(R+a._creationDataStorage.gapSize),E=0;E<b.length-1;E++)for(b[E+1].subtractToRef(b[E],d),w=Math.floor(d.length()/D),d.normalize(),I=0;I<w&&q<h.length;)M=D*I,h[q]=b[E].x+M*d.x,h[q+1]=b[E].y+M*d.y,h[q+2]=b[E].z+M*d.z,h[q+3]=b[E].x+(M+S)*d.x,h[q+4]=b[E].y+(M+S)*d.y,h[q+5]=b[E].z+(M+S)*d.z,q+=6,I++;for(;q<h.length;)h[q]=b[E].x,h[q+1]=b[E].y,h[q+2]=b[E].z,q+=3};return(d.dashNb||d.dashSize||d.gapSize||d.useVertexAlpha||d.material)&&D.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(h,!1),a}const E=new w.d(h,m,null,void 0,void 0,void 0,d.useVertexAlpha,d.material);return M(d).Nh(E,d.updatable),E._creationDataStorage=new A.h,E._creationDataStorage.dashSize=q,E._creationDataStorage.gapSize=S,E}b.c.CreateLineSystem=S,b.c.CreateDashedLines=M,A.d.cS=function(h,d){return E(h,{points:d,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},A.d.CreateDashedLines=function(h,d,m,j,A){return I(h,{points:d,dashSize:m,gapSize:j,dashNb:A,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12247:(h,d,m)=>{"use strict";m.d(d,{b:()=>a,e:()=>D});var j=m(11419),A=m(11388),b=m(11449);function w(h){const d=[],m=[],j=[],w=[],a=void 0!==h.width?h.width:void 0!==h.size?h.size:1,D=void 0!==h.height?h.height:void 0!==h.size?h.size:1,S=0===h.sideOrientation?0:h.sideOrientation||A.c.DEFAULTSIDE,M=a/2,q=D/2;m.push(-M,-q,0),j.push(0,0,-1),w.push(0,b.b?1:0),m.push(M,-q,0),j.push(0,0,-1),w.push(1,b.b?1:0),m.push(M,q,0),j.push(0,0,-1),w.push(1,b.b?0:1),m.push(-M,q,0),j.push(0,0,-1),w.push(0,b.b?0:1),d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),A.c._ComputeSides(S,m,d,j,w,h.frontUVs,h.backUVs);const E=new A.c;return E.indices=d,E.Fh=m,E.fh=j,E.kh=w,E}function a(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new j.d(h,m);d.sideOrientation=j.d._GetDefaultSideOrientation(d.sideOrientation),A._originalBuilderSideOrientation=d.sideOrientation;return w(d).Nh(A,d.updatable),d.sourcePlane&&(A.translate(d.sourcePlane.Dd,-d.sourcePlane.d),A.setDirection(d.sourcePlane.Dd.scale(-1))),A}const D={lS:a};A.c.lS=w,j.d.lS=(h,d,m,j,A)=>a(h,{size:d,width:d,height:d,sideOrientation:A,updatable:j},m)},12333:(h,d,m)=>{"use strict";m.d(d,{e:()=>D});var j=m(11058),A=m(11419),b=m(11388),w=m(11449);function a(h){const d=0|(h.segments||32),m=h.diameterX||h.diameter||1,A=h.diameterY||h.diameter||1,a=h.diameterZ||h.diameter||1,D=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,S=h.slice&&h.slice<=0?1:h.slice||1,M=0===h.sideOrientation?0:h.sideOrientation||b.c.DEFAULTSIDE,q=!!h.dedupTopBottomIndices,E=new j.i(m/2,A/2,a/2),I=2+d,R=2*I,Z=[],L=[],B=[],V=[];for(let b=0;b<=I;b++){const h=b/I,d=h*Math.PI*S;for(let m=0;m<=R;m++){const A=m/R,b=A*Math.PI*2*D,a=j.b.RotationZ(-d),S=j.b.RotationY(b),M=j.i.TransformCoordinates(j.i.Up(),a),q=j.i.TransformCoordinates(M,S),I=q.multiply(E),Z=q.divide(E).normalize();L.push(I.x,I.y,I.z),B.push(Z.x,Z.y,Z.z),V.push(A,w.b?1-h:h)}if(b>0){const h=L.length/3;for(let d=h-2*(R+1);d+R+2<h;d++)q?(b>1&&(Z.push(d),Z.push(d+1),Z.push(d+R+1)),(b<I||S<1)&&(Z.push(d+R+1),Z.push(d+1),Z.push(d+R+2))):(Z.push(d),Z.push(d+1),Z.push(d+R+1),Z.push(d+R+1),Z.push(d+1),Z.push(d+R+2))}}b.c._ComputeSides(M,L,Z,B,V,h.frontUVs,h.backUVs);const v=new b.c;return v.indices=Z,v.Fh=L,v.fh=B,v.kh=V,v}function D(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return a(d).Nh(j,d.updatable),j}b.c.CreateSphere=a,A.d.CreateSphere=(h,d,m,j,A,b)=>D(h,{segments:d,diameterX:m,diameterY:m,diameterZ:m,sideOrientation:b,updatable:A},j)},13124:(h,d,m)=>{"use strict";m.d(d,{d:()=>a});var j=m(11771),A=m(12638),b=m(11794),w=m(11388);class a{static get Configuration(){return{get decoder(){return A.d.DefaultConfiguration},set decoder(h){A.d.DefaultConfiguration=h}}}static set Configuration(h){A.d.DefaultConfiguration=h.decoder}static get DecoderAvailable(){return(0,j.h)(A.d.DefaultConfiguration)}static get Default(){return a._Default??(a._Default=new a),a._Default}static ResetDefault(h){a._Default&&(h||a._Default.dispose(),a._Default=null)}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DefaultNumWorkers;const d="number"===typeof h?{...A.d.DefaultConfiguration,numWorkers:h}:{...A.d.DefaultConfiguration,...h};this._decoder=new A.d(d)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(h,d,m){return this._decoder.decodeMeshToMeshDataAsync(h,d,m)}async decodeMeshToGeometryAsync(h,d,m,j){return await this._decoder.decodeMeshToGeometryAsync(h,d,m,j)}async _decodeMeshToGeometryForGltfAsync(h,d,m,j,A,b){return await this._decoder._decodeMeshToGeometryForGltfAsync(h,d,m,j,A,b)}async decodeMeshAsync(h,d){const m=await this._decoder.decodeMeshToMeshDataAsync(h,d),j=new w.c;m.indices&&(j.indices=m.indices);for(const A of m.attributes){const h=b.b.GetFloatData(A.data,A.size,b.b.GetDataType(A.data),A.byteOffset,A.byteStride,A.normalized,m.totalVertices);j.set(h,A.kind)}return j}}a.DefaultNumWorkers=(0,j.g)(),a._Default=null},12638:(h,d,m)=>{"use strict";m.d(d,{d:()=>S});var j=m(11771),A=m(11107),b=m(11443),w=m(11794),a=m(11121),D=m(11786);class S extends j.d{static get DefaultAvailable(){return(0,j.h)(S.DefaultConfiguration)}static get Default(){return S._Default??(S._Default=new S),S._Default}static ResetDefault(h){S._Default&&(h||S._Default.dispose(),S._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(h,d){return{module:await(d||DracoDecoderModule)({wasmBinary:h})}}_getWorkerContent(){return`${D.d}(${D.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.DefaultConfiguration)}decodeMeshToMeshDataAsync(h,d,m){const j=h instanceof ArrayBuffer?new Int8Array(h):new Int8Array(h.buffer,h.byteOffset,h.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async h=>await new Promise(((A,b)=>{h.push(((h,w)=>{let D=null;const S=[],M=d=>{h.removeEventListener("error",M),h.removeEventListener("message",q),b(d),w()},q=d=>{const j=d.data;switch(j.id){case"indices":D=j.data;break;case"attribute":S.push({kind:j.kind,data:j.data,size:j.size,byteOffset:j.byteOffset,byteStride:j.byteStride,normalized:(b=j.kind,E=j.normalized,m&&void 0!==m[b]?(E!==m[b]&&a.c.Warn(`Normalized flag from Draco data (${E}) does not match normalized flag from glTF accessor (${m[b]}). Using flag from glTF accessor.`),m[b]):E)});break;case"decodeMeshDone":h.removeEventListener("error",M),h.removeEventListener("message",q),A({indices:D,attributes:S,totalVertices:j.totalVertices}),w()}var b,E};h.addEventListener("error",M),h.addEventListener("message",q);const E=j.slice();h.postMessage({id:"decodeMesh",dataView:E,attributes:d},[E.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((h=>{let m=null;const A=[],b=(0,D.d)(h.module,j,d,(h=>{m=h}),((h,d,m,j,b,w)=>{A.push({kind:h,data:d,size:m,byteOffset:j,byteStride:b,normalized:w})}));return{indices:m,attributes:A,totalVertices:b}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(h,d,m,j){const A=await this.decodeMeshToMeshDataAsync(m,j),a=new b.b(h,d);A.indices&&a.setIndices(A.indices);for(const b of A.attributes)a.setVerticesBuffer(new w.b(d.getEngine(),b.data,b.kind,!1,void 0,b.byteStride,void 0,b.byteOffset,b.size,void 0,b.normalized,!0),A.totalVertices);return a}async _decodeMeshToGeometryForGltfAsync(h,d,m,j,A,a){const D=await this.decodeMeshToMeshDataAsync(m,j,A),S=new b.b(h,d);a&&(S._boundingInfo=a,S.useBoundingInfoFromGeometry=!0),D.indices&&S.setIndices(D.indices);for(const b of D.attributes)S.setVerticesBuffer(new w.b(d.getEngine(),b.data,b.kind,!1,void 0,b.byteStride,void 0,b.byteOffset,b.size,void 0,b.normalized,!0),D.totalVertices);return S}}S.DefaultConfiguration={wasmUrl:`${A.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${A.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${A.e._DefaultCdnUrl}/draco_decoder_gltf.js`},S._Default=null},12836:(h,d,m)=>{"use strict";m.d(d,{c:()=>ah});var j=m(11058),A=m(11419),b=m(11281),w=m(11388),a=m(11449);function D(h){let d=h.pathArray;const m=h.closeArray||!1,j=h.closePath||!1,A=h.invertUV||!1,D=Math.floor(d[0].length/2);let S=h.offset||D;S=S>D?D:Math.floor(S);const M=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,q=h.kh,E=h.Hh,I=[],R=[],Z=[],L=[],B=[],V=[],v=[],C=[];let T;const o=[],y=[];let i,g,F;if(d.length<2){const h=[],m=[];for(g=0;g<d[0].length-S;g++)h.push(d[0][g]),m.push(d[0][g+S]);d=[h,m]}let f=0;const H=j?1:0,c=m?1:0;let k,l,K,N,W,r;for(T=d[0].length,i=0;i<d.length+c;i++){for(v[i]=0,B[i]=[0],k=i===d.length?d[0]:d[i],l=k.length,T=T<l?T:l,F=0;F<l;)I.push(k[F].x,k[F].y,k[F].z),F>0&&(K=k[F].fm(k[F-1]).length(),N=K+v[i],B[i].push(N),v[i]=N),F++;j&&(F--,I.push(k[0].x,k[0].y,k[0].z),K=k[F].fm(k[0]).length(),N=K+v[i],B[i].push(N),v[i]=N),o[i]=l+H,y[i]=f,f+=l+H}let Y,x,Q=null,t=null;for(g=0;g<T+H;g++)for(C[g]=0,V[g]=[0],i=0;i<d.length-1+c;i++)W=d[i],r=i===d.length-1?d[0]:d[i+1],g===T?(Q=W[0],t=r[0]):(Q=W[g],t=r[g]),K=t.fm(Q).length(),N=K+C[g],V[g].push(N),C[g]=N;if(q)for(i=0;i<q.length;i++)L.push(q[i].x,a.b?1-q[i].y:q[i].y);else for(i=0;i<d.length+c;i++)for(g=0;g<T+H;g++)Y=0!=v[i]?B[i][g]/v[i]:0,x=0!=C[g]?V[g][i]/C[g]:0,A?L.push(x,Y):L.push(Y,a.b?1-x:x);i=0;let U=0,s=o[i]-1,J=o[i+1]-1,O=s<J?s:J,n=y[1]-y[0];const p=o.length-1;for(;U<=O&&i<p;)R.push(U,U+n,U+1),R.push(U+n+1,U+1,U+n),U+=1,U===O&&(i++,n=y[i+1]-y[i],s=o[i]-1,J=o[i+1]-1,U=y[i],O=s<J?s+U:J+U);if(w.c.ComputeNormals(I,R,Z),j){let h=0,m=0;for(i=0;i<d.length;i++){h=3*y[i],m=i+1<d.length?3*(y[i+1]-1):Z.length-3,Z[h]=.5*(Z[h]+Z[m]),Z[h+1]=.5*(Z[h+1]+Z[m+1]),Z[h+2]=.5*(Z[h+2]+Z[m+2]);const j=Math.sqrt(Z[h]*Z[h]+Z[h+1]*Z[h+1]+Z[h+2]*Z[h+2]);Z[h]/=j,Z[h+1]/=j,Z[h+2]/=j,Z[m]=Z[h],Z[m+1]=Z[h+1],Z[m+2]=Z[h+2]}}if(m){let h=3*y[0],m=3*y[d.length];for(g=0;g<T+H;g++){Z[h]=.5*(Z[h]+Z[m]),Z[h+1]=.5*(Z[h+1]+Z[m+1]),Z[h+2]=.5*(Z[h+2]+Z[m+2]);const d=Math.sqrt(Z[h]*Z[h]+Z[h+1]*Z[h+1]+Z[h+2]*Z[h+2]);Z[h]/=d,Z[h+1]/=d,Z[h+2]/=d,Z[m]=Z[h],Z[m+1]=Z[h+1],Z[m+2]=Z[h+2],h+=3,m+=3}}w.c._ComputeSides(M,I,R,Z,L,h.frontUVs,h.backUVs);let e=null;if(E){e=new Float32Array(4*E.length);for(let h=0;h<E.length;h++)e[4*h]=E[h].r,e[4*h+1]=E[h].g,e[4*h+2]=E[h].b,e[4*h+3]=E[h].a}const X=new w.c,z=new Float32Array(I),u=new Float32Array(Z),P=new Float32Array(L);return X.indices=R,X.Fh=z,X.fh=u,X.kh=P,e&&X.set(e,b.d.ColorKind),j&&(X._idx=y),X}function S(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=d.pathArray,M=d.closeArray,q=d.closePath,E=A.d._GetDefaultSideOrientation(d.sideOrientation),I=d.instance,R=d.updatable;if(I){const h=j.d.Qd[0].sd(Number.MAX_VALUE),m=j.d.Qd[1].sd(-Number.MAX_VALUE),D=d=>{let j=S[0].length;const b=I;let w=0;const a=b._originalBuilderSideOrientation===A.d.DOUBLESIDE?2:1;for(let A=1;A<=a;++A)for(let a=0;a<S.length;++a){const A=S[a],D=A.length;j=j<D?j:D;for(let b=0;b<j;++b){const j=A[b];d[w]=j.x,d[w+1]=j.y,d[w+2]=j.z,h.minimizeInPlaceFromFloats(j.x,j.y,j.z),m.maximizeInPlaceFromFloats(j.x,j.y,j.z),w+=3}if(b._creationDataStorage&&b._creationDataStorage.closePath){const h=A[0];d[w]=h.x,d[w+1]=h.y,d[w+2]=h.z,w+=3}}},M=I.getVerticesData(b.d.PositionKind);if(D(M),I.hasBoundingInfo?I.getBoundingInfo().reConstruct(h,m,I._worldMatrix):I.buildBoundingInfo(h,m,I._worldMatrix),I.updateVerticesData(b.d.PositionKind,M,!1,!1),d.Hh){const h=I.getVerticesData(b.d.ColorKind);for(let m=0,j=0;m<d.Hh.length;m++,j+=4){const A=d.Hh[m];h[j]=A.r,h[j+1]=A.g,h[j+2]=A.b,h[j+3]=A.a}I.updateVerticesData(b.d.ColorKind,h,!1,!1)}if(d.kh){const h=I.getVerticesData(b.d.UVKind);for(let m=0;m<d.kh.length;m++)h[2*m]=d.kh[m].x,h[2*m+1]=a.b?1-d.kh[m].y:d.kh[m].y;I.updateVerticesData(b.d.UVKind,h,!1,!1)}if(!I.areNormalsFrozen||I.isFacetDataEnabled){const h=I.Vd(),d=I.getVerticesData(b.d.NormalKind),m=I.isFacetDataEnabled?I.getFacetDataParameters():null;if(w.c.ComputeNormals(M,h,d,m),I._creationDataStorage&&I._creationDataStorage.closePath){let h=0,m=0;for(let j=0;j<S.length;j++)h=3*I._creationDataStorage.idx[j],m=j+1<S.length?3*(I._creationDataStorage.idx[j+1]-1):d.length-3,d[h]=.5*(d[h]+d[m]),d[h+1]=.5*(d[h+1]+d[m+1]),d[h+2]=.5*(d[h+2]+d[m+2]),d[m]=d[h],d[m+1]=d[h+1],d[m+2]=d[h+2]}I.areNormalsFrozen||I.updateVerticesData(b.d.NormalKind,d,!1,!1)}return I}{const j=new A.d(h,m);j._originalBuilderSideOrientation=E,j._creationDataStorage=new A.h;const b=D(d);return q&&(j._creationDataStorage.idx=b._idx),j._creationDataStorage.closePath=q,j._creationDataStorage.closeArray=M,b.Nh(j,R),j}}w.c.CreateRibbon=D,A.d.CreateRibbon=function(h,d){return S(h,{pathArray:d,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var M=m(12339),q=m(12184),E=m(11353);function I(h){const d=h.pattern||A.d.NO_FLIP,m=h.tileWidth||h.tileSize||1,j=h.tileHeight||h.tileSize||1,b=h.alignHorizontal||0,a=h.alignVertical||0,D=h.width||h.size||1,S=Math.floor(D/m);let M=D-S*m;const q=h.height||h.size||1,E=Math.floor(q/j);let I=q-E*j;const R=m*S/2,Z=j*E/2;let L=0,B=0,V=0,v=0,C=0,T=0;if(M>0||I>0){switch(V=-R,v=-Z,C=R,T=Z,b){case A.d.CENTER:M/=2,V-=M,C+=M;break;case A.d.LEFT:C+=M,L=-M/2;break;case A.d.RIGHT:V-=M,L=M/2}switch(a){case A.d.CENTER:I/=2,v-=I,T+=I;break;case A.d.BOTTOM:T+=I,B=-I/2;break;case A.d.TOP:v-=I,B=I/2}}const o=[],y=[],i=[];i[0]=[0,0,1,0,1,1,0,1],i[1]=[0,0,1,0,1,1,0,1],d!==A.d.ROTATE_TILE&&d!==A.d.ROTATE_ROW||(i[1]=[1,1,0,1,0,0,1,0]),d!==A.d.FLIP_TILE&&d!==A.d.FLIP_ROW||(i[1]=[1,0,0,0,0,1,1,1]),d!==A.d.FLIP_N_ROTATE_TILE&&d!==A.d.FLIP_N_ROTATE_ROW||(i[1]=[0,1,1,1,1,0,0,0]);let g=[];const F=[],f=[];let H=0;for(let w=0;w<E;w++)for(let h=0;h<S;h++)o.push(h*m-R+L,w*j-Z+B,0),o.push((h+1)*m-R+L,w*j-Z+B,0),o.push((h+1)*m-R+L,(w+1)*j-Z+B,0),o.push(h*m-R+L,(w+1)*j-Z+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),g=d===A.d.FLIP_TILE||d===A.d.ROTATE_TILE||d===A.d.FLIP_N_ROTATE_TILE?g.concat(i[(h%2+w%2)%2]):d===A.d.FLIP_ROW||d===A.d.ROTATE_ROW||d===A.d.FLIP_N_ROTATE_ROW?g.concat(i[w%2]):g.concat(i[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),H+=4;if(M>0||I>0){const h=I>0&&(a===A.d.CENTER||a===A.d.TOP),w=I>0&&(a===A.d.CENTER||a===A.d.BOTTOM),D=M>0&&(b===A.d.CENTER||b===A.d.RIGHT),q=M>0&&(b===A.d.CENTER||b===A.d.LEFT);let i,c,k,l,K=[];if(h&&D&&(o.push(V+L,v+B,0),o.push(-R+L,v+B,0),o.push(-R+L,v+I+B,0),o.push(V+L,v+I+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,i=1-M/m,c=1-I/j,k=1,l=1,K=[i,c,k,c,k,l,i,l],d===A.d.ROTATE_ROW&&(K=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),d===A.d.FLIP_ROW&&(K=[1-i,c,1-k,c,1-k,l,1-i,l]),d===A.d.FLIP_N_ROTATE_ROW&&(K=[i,1-c,k,1-c,k,1-l,i,1-l]),g=g.concat(K),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&q&&(o.push(R+L,v+B,0),o.push(C+L,v+B,0),o.push(C+L,v+I+B,0),o.push(R+L,v+I+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,i=0,c=1-I/j,k=M/m,l=1,K=[i,c,k,c,k,l,i,l],(d===A.d.ROTATE_ROW||d===A.d.ROTATE_TILE&&S%2===0)&&(K=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),(d===A.d.FLIP_ROW||d===A.d.FLIP_TILE&&S%2===0)&&(K=[1-i,c,1-k,c,1-k,l,1-i,l]),(d===A.d.FLIP_N_ROTATE_ROW||d===A.d.FLIP_N_ROTATE_TILE&&S%2===0)&&(K=[i,1-c,k,1-c,k,1-l,i,1-l]),g=g.concat(K),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&D&&(o.push(V+L,Z+B,0),o.push(-R+L,Z+B,0),o.push(-R+L,T+B,0),o.push(V+L,T+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,i=1-M/m,c=0,k=1,l=I/j,K=[i,c,k,c,k,l,i,l],(d===A.d.ROTATE_ROW&&E%2===1||d===A.d.ROTATE_TILE&&E%1===0)&&(K=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),(d===A.d.FLIP_ROW&&E%2===1||d===A.d.FLIP_TILE&&E%2===0)&&(K=[1-i,c,1-k,c,1-k,l,1-i,l]),(d===A.d.FLIP_N_ROTATE_ROW&&E%2===1||d===A.d.FLIP_N_ROTATE_TILE&&E%2===0)&&(K=[i,1-c,k,1-c,k,1-l,i,1-l]),g=g.concat(K),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&q&&(o.push(R+L,Z+B,0),o.push(C+L,Z+B,0),o.push(C+L,T+B,0),o.push(R+L,T+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,i=0,c=0,k=M/m,l=I/j,K=[i,c,k,c,k,l,i,l],(d===A.d.ROTATE_ROW&&E%2===1||d===A.d.ROTATE_TILE&&(E+S)%2===1)&&(K=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),(d===A.d.FLIP_ROW&&E%2===1||d===A.d.FLIP_TILE&&(E+S)%2===1)&&(K=[1-i,c,1-k,c,1-k,l,1-i,l]),(d===A.d.FLIP_N_ROTATE_ROW&&E%2===1||d===A.d.FLIP_N_ROTATE_TILE&&(E+S)%2===1)&&(K=[i,1-c,k,1-c,k,1-l,i,1-l]),g=g.concat(K),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h){const h=[];i=0,c=1-I/j,k=1,l=1,h[0]=[i,c,k,c,k,l,i,l],h[1]=[i,c,k,c,k,l,i,l],d!==A.d.ROTATE_TILE&&d!==A.d.ROTATE_ROW||(h[1]=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),d!==A.d.FLIP_TILE&&d!==A.d.FLIP_ROW||(h[1]=[1-i,c,1-k,c,1-k,l,1-i,l]),d!==A.d.FLIP_N_ROTATE_TILE&&d!==A.d.FLIP_N_ROTATE_ROW||(h[1]=[i,1-c,k,1-c,k,1-l,i,1-l]);for(let j=0;j<S;j++)o.push(j*m-R+L,v+B,0),o.push((j+1)*m-R+L,v+B,0),o.push((j+1)*m-R+L,v+I+B,0),o.push(j*m-R+L,v+I+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,g=d===A.d.FLIP_TILE||d===A.d.ROTATE_TILE||d===A.d.FLIP_N_ROTATE_TILE?g.concat(h[(j+1)%2]):d===A.d.FLIP_ROW||d===A.d.ROTATE_ROW||d===A.d.FLIP_N_ROTATE_ROW?g.concat(h[1]):g.concat(h[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const h=[];i=0,c=0,k=1,l=I/j,h[0]=[i,c,k,c,k,l,i,l],h[1]=[i,c,k,c,k,l,i,l],d!==A.d.ROTATE_TILE&&d!==A.d.ROTATE_ROW||(h[1]=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),d!==A.d.FLIP_TILE&&d!==A.d.FLIP_ROW||(h[1]=[1-i,c,1-k,c,1-k,l,1-i,l]),d!==A.d.FLIP_N_ROTATE_TILE&&d!==A.d.FLIP_N_ROTATE_ROW||(h[1]=[i,1-c,k,1-c,k,1-l,i,1-l]);for(let j=0;j<S;j++)o.push(j*m-R+L,T-I+B,0),o.push((j+1)*m-R+L,T-I+B,0),o.push((j+1)*m-R+L,T+B,0),o.push(j*m-R+L,T+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,g=d===A.d.FLIP_TILE||d===A.d.ROTATE_TILE||d===A.d.FLIP_N_ROTATE_TILE?g.concat(h[(j+E)%2]):d===A.d.FLIP_ROW||d===A.d.ROTATE_ROW||d===A.d.FLIP_N_ROTATE_ROW?g.concat(h[E%2]):g.concat(h[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(D){const h=[];i=1-M/m,c=0,k=1,l=1,h[0]=[i,c,k,c,k,l,i,l],h[1]=[i,c,k,c,k,l,i,l],d!==A.d.ROTATE_TILE&&d!==A.d.ROTATE_ROW||(h[1]=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),d!==A.d.FLIP_TILE&&d!==A.d.FLIP_ROW||(h[1]=[1-i,c,1-k,c,1-k,l,1-i,l]),d!==A.d.FLIP_N_ROTATE_TILE&&d!==A.d.FLIP_N_ROTATE_ROW||(h[1]=[i,1-c,k,1-c,k,1-l,i,1-l]);for(let m=0;m<E;m++)o.push(V+L,m*j-Z+B,0),o.push(V+M+L,m*j-Z+B,0),o.push(V+M+L,(m+1)*j-Z+B,0),o.push(V+L,(m+1)*j-Z+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,g=d===A.d.FLIP_TILE||d===A.d.ROTATE_TILE||d===A.d.FLIP_N_ROTATE_TILE?g.concat(h[(m+1)%2]):d===A.d.FLIP_ROW||d===A.d.ROTATE_ROW||d===A.d.FLIP_N_ROTATE_ROW?g.concat(h[m%2]):g.concat(h[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const h=[];i=0,c=0,k=M/j,l=1,h[0]=[i,c,k,c,k,l,i,l],h[1]=[i,c,k,c,k,l,i,l],d!==A.d.ROTATE_TILE&&d!==A.d.ROTATE_ROW||(h[1]=[1-i,1-c,1-k,1-c,1-k,1-l,1-i,1-l]),d!==A.d.FLIP_TILE&&d!==A.d.FLIP_ROW||(h[1]=[1-i,c,1-k,c,1-k,l,1-i,l]),d!==A.d.FLIP_N_ROTATE_TILE&&d!==A.d.FLIP_N_ROTATE_ROW||(h[1]=[i,1-c,k,1-c,k,1-l,i,1-l]);for(let m=0;m<E;m++)o.push(C-M+L,m*j-Z+B,0),o.push(C+L,m*j-Z+B,0),o.push(C+L,(m+1)*j-Z+B,0),o.push(C-M+L,(m+1)*j-Z+B,0),f.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,g=d===A.d.FLIP_TILE||d===A.d.ROTATE_TILE||d===A.d.FLIP_N_ROTATE_TILE?g.concat(h[(m+S)%2]):d===A.d.FLIP_ROW||d===A.d.ROTATE_ROW||d===A.d.FLIP_N_ROTATE_ROW?g.concat(h[m%2]):g.concat(h[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE;w.c._ComputeSides(c,o,f,y,g,h.frontUVs,h.backUVs);const k=new w.c;k.indices=f,k.Fh=o,k.fh=y,k.kh=g;const l=c===w.c.DOUBLESIDE?F.concat(F):F;return k.Hh=l,k}function R(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return I(d).Nh(j,d.updatable),j}function Z(h){const d=h.faceUV||new Array(6),m=h.faceColors,b=h.pattern||A.d.NO_FLIP,D=h.width||h.size||1,S=h.height||h.size||1,M=h.depth||h.size||1,q=h.tileWidth||h.tileSize||1,R=h.tileHeight||h.tileSize||1,Z=h.alignHorizontal||0,L=h.alignVertical||0,B=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE;for(let A=0;A<6;A++)void 0===d[A]&&(d[A]=new j.m(0,0,1,1)),m&&void 0===m[A]&&(m[A]=new E.f(1,1,1,1));const V=D/2,v=S/2,C=M/2,T=[];for(let j=0;j<2;j++)T[j]=I({pattern:b,tileWidth:q,tileHeight:R,width:D,height:S,alignVertical:L,alignHorizontal:Z,sideOrientation:B});for(let j=2;j<4;j++)T[j]=I({pattern:b,tileWidth:q,tileHeight:R,width:M,height:S,alignVertical:L,alignHorizontal:Z,sideOrientation:B});let o=L;L===A.d.BOTTOM?o=A.d.TOP:L===A.d.TOP&&(o=A.d.BOTTOM);for(let j=4;j<6;j++)T[j]=I({pattern:b,tileWidth:q,tileHeight:R,width:D,height:M,alignVertical:o,alignHorizontal:Z,sideOrientation:B});let y=[],i=[],g=[],F=[];const f=[],H=[],c=[],k=[];let l=0,K=0;for(let A=0;A<6;A++){const h=T[A].Fh.length;H[A]=[],c[A]=[];for(let d=0;d<h/3;d++)H[A].push(new j.i(T[A].Fh[3*d],T[A].Fh[3*d+1],T[A].Fh[3*d+2])),c[A].push(new j.i(T[A].fh[3*d],T[A].fh[3*d+1],T[A].fh[3*d+2]));l=T[A].kh.length,k[A]=[];for(let m=0;m<l;m+=2)k[A][m]=d[A].x+(d[A].z-d[A].x)*T[A].kh[m],k[A][m+1]=d[A].y+(d[A].w-d[A].y)*T[A].kh[m+1],a.b&&(k[A][m+1]=1-k[A][m+1]);if(g=g.concat(k[A]),F=F.concat(T[A].indices.map((h=>h+K))),K+=H[A].length,m)for(let d=0;d<4;d++)f.push(m[A].r,m[A].g,m[A].b,m[A].a)}const N=new j.i(0,0,C),W=j.b.RotationY(Math.PI);y=H[0].map((h=>j.i.TransformNormal(h,W).add(N))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]),i=c[0].map((h=>j.i.TransformNormal(h,W))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]),y=y.concat(H[1].map((h=>h.fm(N))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),i=i.concat(c[1].map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const r=new j.i(V,0,0),Y=j.b.RotationY(-Math.PI/2);y=y.concat(H[2].map((h=>j.i.TransformNormal(h,Y).add(r))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),i=i.concat(c[2].map((h=>j.i.TransformNormal(h,Y))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const x=j.b.RotationY(Math.PI/2);y=y.concat(H[3].map((h=>j.i.TransformNormal(h,x).fm(r))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),i=i.concat(c[3].map((h=>j.i.TransformNormal(h,x))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const Q=new j.i(0,v,0),t=j.b.RotationX(Math.PI/2);y=y.concat(H[4].map((h=>j.i.TransformNormal(h,t).add(Q))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),i=i.concat(c[4].map((h=>j.i.TransformNormal(h,t))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const U=j.b.RotationX(-Math.PI/2);y=y.concat(H[5].map((h=>j.i.TransformNormal(h,U).fm(Q))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),i=i.concat(c[5].map((h=>j.i.TransformNormal(h,U))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),w.c._ComputeSides(B,y,F,i,g);const s=new w.c;if(s.indices=F,s.Fh=y,s.fh=i,s.kh=g,m){const h=B===w.c.DOUBLESIDE?f.concat(f):f;s.Hh=h}return s}function L(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return Z(d).Nh(j,d.updatable),j}w.c.CreateTiledPlane=I;w.c.CreateTiledBox=Z;var B=m(12333),V=m(11604),v=m(11407);function C(h){const d=h.height||2;let m=0===h.diameterTop?0:h.diameterTop||h.diameter||1,b=0===h.diameterBottom?0:h.diameterBottom||h.diameter||1;m=m||1e-5,b=b||1e-5;const D=0|(h.tessellation||24),S=0|(h.subdivisions||1),M=!!h.hasRings,q=!!h.enclose,I=0===h.cap?0:h.cap||A.d.CAP_ALL,R=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,Z=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,L=h.faceUV||new Array(3),B=h.faceColors,V=2+(1+(1!==R&&q?2:0))*(M?S:1);let C;for(C=0;C<V;C++)B&&void 0===B[C]&&(B[C]=new E.f(1,1,1,1));for(C=0;C<V;C++)L&&void 0===L[C]&&(L[C]=new j.m(0,0,1,1));const T=[],o=[],y=[],i=[],g=[],F=2*Math.PI*R/D;let f,H,c;const k=(b-m)/2/d,l=j.i.Zero(),K=j.i.Zero(),N=j.i.Zero(),W=j.i.Zero(),r=j.i.Zero(),Y=v.e.Y;let x,Q,t,U=1,s=1,J=0,O=0;for(x=0;x<=S;x++)for(H=x/S,c=(H*(m-b)+b)/2,U=M&&0!==x&&x!==S?2:1,t=0;t<U;t++){for(M&&(s+=t),q&&(s+=2*t),Q=0;Q<=D;Q++)f=Q*F,l.x=Math.cos(-f)*c,l.y=-d/2+H*d,l.z=Math.sin(-f)*c,0===m&&x===S?(K.x=y[y.length-3*(D+1)],K.y=y[y.length-3*(D+1)+1],K.z=y[y.length-3*(D+1)+2]):(K.x=l.x,K.z=l.z,K.y=Math.sqrt(K.x*K.x+K.z*K.z)*k,K.normalize()),0===Q&&(N.D(l),W.D(K)),o.push(l.x,l.y,l.z),y.push(K.x,K.y,K.z),O=M?J!==s?L[s].y:L[s].w:L[s].y+(L[s].w-L[s].y)*H,i.push(L[s].x+(L[s].z-L[s].x)*Q/D,a.b?1-O:O),B&&g.push(B[s].r,B[s].g,B[s].b,B[s].a);1!==R&&q&&(o.push(l.x,l.y,l.z),o.push(0,l.y,0),o.push(0,l.y,0),o.push(N.x,N.y,N.z),j.i.CrossToRef(Y,K,r),r.normalize(),y.push(r.x,r.y,r.z,r.x,r.y,r.z),j.i.CrossToRef(W,Y,r),r.normalize(),y.push(r.x,r.y,r.z,r.x,r.y,r.z),O=M?J!==s?L[s+1].y:L[s+1].w:L[s+1].y+(L[s+1].w-L[s+1].y)*H,i.push(L[s+1].x,a.b?1-O:O),i.push(L[s+1].z,a.b?1-O:O),O=M?J!==s?L[s+2].y:L[s+2].w:L[s+2].y+(L[s+2].w-L[s+2].y)*H,i.push(L[s+2].x,a.b?1-O:O),i.push(L[s+2].z,a.b?1-O:O),B&&(g.push(B[s+1].r,B[s+1].g,B[s+1].b,B[s+1].a),g.push(B[s+1].r,B[s+1].g,B[s+1].b,B[s+1].a),g.push(B[s+2].r,B[s+2].g,B[s+2].b,B[s+2].a),g.push(B[s+2].r,B[s+2].g,B[s+2].b,B[s+2].a))),J!==s&&(J=s)}const n=1!==R&&q?D+4:D;for(x=0,s=0;s<S;s++){let h=0,d=0,m=0,j=0;for(Q=0;Q<D;Q++)h=x*(n+1)+Q,d=(x+1)*(n+1)+Q,m=x*(n+1)+(Q+1),j=(x+1)*(n+1)+(Q+1),T.push(h,d,m),T.push(j,m,d);1!==R&&q&&(T.push(h+2,d+2,m+2),T.push(j+2,m+2,d+2),T.push(h+4,d+4,m+4),T.push(j+4,m+4,d+4)),x=M?x+2:x+1}const p=h=>{const A=h?m/2:b/2;if(0===A)return;let w,S,M;const q=h?L[V-1]:L[0];let E=null;B&&(E=h?B[V-1]:B[0]);const I=o.length/3,Z=h?d/2:-d/2,v=new j.i(0,Z,0);o.push(v.x,v.y,v.z),y.push(0,h?1:-1,0);const C=q.y+.5*(q.w-q.y);i.push(q.x+.5*(q.z-q.x),a.b?1-C:C),E&&g.push(E.r,E.g,E.b,E.a);const F=new j.h(.5,.5);for(M=0;M<=D;M++){w=2*Math.PI*M*R/D;const d=Math.cos(-w),m=Math.sin(-w);S=new j.i(d*A,Z,m*A);const b=new j.h(d*F.x+.5,m*F.y+.5);o.push(S.x,S.y,S.z),y.push(0,h?1:-1,0);const I=q.y+(q.w-q.y)*b.y;i.push(q.x+(q.z-q.x)*b.x,a.b?1-I:I),E&&g.push(E.r,E.g,E.b,E.a)}for(M=0;M<D;M++)h?(T.push(I),T.push(I+(M+2)),T.push(I+(M+1))):(T.push(I),T.push(I+(M+1)),T.push(I+(M+2)))};I!==A.d.CAP_START&&I!==A.d.CAP_ALL||p(!1),I!==A.d.CAP_END&&I!==A.d.CAP_ALL||p(!0),w.c._ComputeSides(Z,o,T,y,i,h.frontUVs,h.backUVs);const e=new w.c;return e.indices=T,e.Fh=o,e.fh=y,e.kh=i,B&&(e.Hh=g),e}function T(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return C(d).Nh(j,d.updatable),j}function o(h){const d=[],m=[],A=[],b=[],D=h.diameter||1,S=h.thickness||.5,M=0|(h.tessellation||16),q=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,E=M+1;for(let w=0;w<=M;w++){const h=w/M,q=w*Math.PI*2/M-Math.PI/2,I=j.b.Translation(D/2,0,0).multiply(j.b.RotationY(q));for(let D=0;D<=M;D++){const q=1-D/M,R=D*Math.PI*2/M+Math.PI,Z=Math.cos(R),L=Math.sin(R);let B=new j.i(Z,L,0),V=B.scale(S/2);const v=new j.h(h,q);V=j.i.TransformCoordinates(V,I),B=j.i.TransformNormal(B,I),m.push(V.x,V.y,V.z),A.push(B.x,B.y,B.z),b.push(v.x,a.b?1-v.y:v.y);const C=(w+1)%E,T=(D+1)%E;d.push(w*E+D),d.push(w*E+T),d.push(C*E+D),d.push(w*E+T),d.push(C*E+T),d.push(C*E+D)}}w.c._ComputeSides(q,m,d,A,b,h.frontUVs,h.backUVs);const I=new w.c;return I.indices=d,I.Fh=m,I.fh=A,I.kh=b,I}function y(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return o(d).Nh(j,d.updatable),j}w.c.CreateCylinder=C,A.d.CreateCylinder=(h,d,m,j,b,w,a,D,S)=>{void 0!==a&&a instanceof V.c||(void 0!==a&&(S=D||A.d.DEFAULTSIDE,D=a),a=w,w=1);return T(h,{height:d,diameterTop:m,diameterBottom:j,tessellation:b,subdivisions:w,sideOrientation:S,updatable:D},a)};function i(h){const d=[],m=[],A=[],b=[],D=h.radius||2,S=h.tube||.5,M=h.radialSegments||32,q=h.tubularSegments||32,E=h.p||2,I=h.q||3,R=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,Z=h=>{const d=Math.cos(h),m=Math.sin(h),A=I/E*h,b=Math.cos(A),w=D*(2+b)*.5*d,a=D*(2+b)*m*.5,S=D*Math.sin(A)*.5;return new j.i(w,a,S)};let L,B;for(L=0;L<=M;L++){const h=L%M/M*2*E*Math.PI,d=Z(h),A=Z(h+.01),w=A.fm(d);let D=A.add(d);const I=j.i.Cross(w,D);for(D=j.i.Cross(I,w),I.normalize(),D.normalize(),B=0;B<q;B++){const h=B%q/q*2*Math.PI,j=-S*Math.cos(h),A=S*Math.sin(h);m.push(d.x+j*D.x+A*I.x),m.push(d.y+j*D.y+A*I.y),m.push(d.z+j*D.z+A*I.z),b.push(L/M),b.push(a.b?1-B/q:B/q)}}for(L=0;L<M;L++)for(B=0;B<q;B++){const h=(B+1)%q,m=L*q+B,j=(L+1)*q+B,A=(L+1)*q+h,b=L*q+h;d.push(b),d.push(j),d.push(m),d.push(b),d.push(A),d.push(j)}w.c.ComputeNormals(m,d,A),w.c._ComputeSides(R,m,d,A,b,h.frontUVs,h.backUVs);const V=new w.c;return V.indices=d,V.Fh=m,V.fh=A,V.kh=b,V}function g(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return i(d).Nh(j,d.updatable),j}w.c.CreateTorus=o,A.d.CreateTorus=(h,d,m,j,A,b,w)=>y(h,{diameter:d,thickness:m,tessellation:j,sideOrientation:w,updatable:b},A);w.c.CreateTorusKnot=i,A.d.CreateTorusKnot=(h,d,m,j,A,b,w,a,D,S)=>g(h,{radius:d,tube:m,radialSegments:j,tubularSegments:A,p:b,q:w,sideOrientation:S,updatable:D},a);var F=m(12843),f=m(11761),H=m(11526);function c(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=d.path,b=d.shape,w=d.scale||1,a=d.rotation||0,D=0===d.cap?0:d.cap||A.d.NO_CAP,S=d.updatable,M=A.d._GetDefaultSideOrientation(d.sideOrientation),q=d.instance||null,E=d.invertUV||!1,I=d.closeShape||!1,R=d.closePath||!1,Z=d.capFunction||null;return l(h,b,j,w,a,null,null,R,I,D,!1,m,!!S,M,q,E,d.frontUVs||null,d.backUVs||null,d.firstNormal||null,!!d.adjustFrame,Z)}function k(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=d.path,b=d.shape,w=d.scaleFunction||(()=>1),a=d.rotationFunction||(()=>0),D=d.closePath||d.ribbonCloseArray||!1,S=d.closeShape||d.ribbonClosePath||!1,M=0===d.cap?0:d.cap||A.d.NO_CAP,q=d.updatable,E=d.firstNormal||null,I=d.adjustFrame||!1,R=A.d._GetDefaultSideOrientation(d.sideOrientation),Z=d.instance,L=d.invertUV||!1,B=d.capFunction||null;return l(h,b,j,null,null,w,a,D,S,M,!0,m,!!q,R,Z||null,L,d.frontUVs||null,d.backUVs||null,E,I,B||null)}function l(h,d,m,b,w,a,D,M,q,E,I,R,Z,L,B,V,v,C,T,o,y){const i=(h,d,m,b,w,a,D,S,M,q,E)=>{const I=m.getTangents(),R=m.getNormals(),Z=m.getBinormals(),L=m.getDistances();if(E)for(let A=0;A<I.length;A++)if(0==I[A].x&&0==I[A].y&&0==I[A].z&&I[A].D(I[A-1]),0==R[A].x&&0==R[A].y&&0==R[A].z&&R[A].D(R[A-1]),0==Z[A].x&&0==Z[A].y&&0==Z[A].z&&Z[A].D(Z[A-1]),A>0){let h=I[A-1];j.i.Dot(h,I[A])<0&&I[A].scaleInPlace(-1),h=R[A-1],j.i.Dot(h,R[A])<0&&R[A].scaleInPlace(-1),h=Z[A-1],j.i.Dot(h,Z[A])<0&&Z[A].scaleInPlace(-1)}let B=0;const V=q&&S?S:()=>null!==a?a:0,v=q&&D?D:()=>null!==w?w:1;let C=M===A.d.NO_CAP||M===A.d.CAP_END?0:2;const T=j.d.Matrix[0];for(let A=0;A<d.length;A++){const m=[],w=V(A,L[A]),a=v(A,L[A]);j.b.RotationAxisToRef(I[A],B,T);for(let b=0;b<h.length;b++){const w=I[A].scale(h[b].z).add(R[A].scale(h[b].x)).add(Z[A].scale(h[b].y)),D=j.i.Zero();j.i.TransformCoordinatesToRef(w,T,D),D.scaleInPlace(a).addInPlace(d[A]),m[b]=D}b[C]=m,B+=w,C++}const o=y||(h=>{const d=Array(),m=j.i.Zero();let A;for(A=0;A<h.length;A++)m.addInPlace(h[A]);for(m.scaleInPlace(1/h.length),A=0;A<h.length;A++)d.push(m);return d});switch(M){case A.d.NO_CAP:break;case A.d.CAP_START:b[0]=o(b[2]),b[1]=b[2];break;case A.d.CAP_END:b[C]=b[C-1],b[C+1]=o(b[C-1]);break;case A.d.CAP_ALL:b[0]=o(b[2]),b[1]=b[2],b[C]=b[C-1],b[C+1]=o(b[C-1])}return b};let g,F;if(B){const h=B._creationDataStorage;return g=T?h.path3D.update(m,T):h.path3D.update(m),F=i(d,m,h.path3D,h.pathArray,b,w,a,D,h.cap,I,o),B=S("",{pathArray:F,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},R||void 0)}g=T?new H.f(m,T):new H.f(m);F=i(d,m,g,new Array,b,w,a,D,E=E<0||E>3?0:E,I,o);const f=S(h,{pathArray:F,closeArray:M,closePath:q,updatable:Z,sideOrientation:L,invertUV:V,frontUVs:v||void 0,backUVs:C||void 0},R);return f._creationDataStorage.pathArray=F,f._creationDataStorage.path3D=g,f._creationDataStorage.cap=E,f}function K(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=d.arc?d.arc<=0||d.arc>1?1:d.arc:1,w=void 0===d.closed||d.closed,a=d.shape,D=d.radius||1,M=d.tessellation||64,q=d.clip||0,E=d.updatable,I=A.d._GetDefaultSideOrientation(d.sideOrientation),R=d.cap||A.d.NO_CAP,Z=2*Math.PI,L=[],B=d.invertUV||!1;let V=0,v=0;const C=Z/M*b;let T,o;for(V=0;V<=M-q;V++){for(o=[],R!=A.d.CAP_START&&R!=A.d.CAP_ALL||(o.push(new j.i(0,a[0].y,0)),o.push(new j.i(Math.cos(V*C)*a[0].x*D,a[0].y,Math.sin(V*C)*a[0].x*D))),v=0;v<a.length;v++)T=new j.i(Math.cos(V*C)*a[v].x*D,a[v].y,Math.sin(V*C)*a[v].x*D),o.push(T);R!=A.d.CAP_END&&R!=A.d.CAP_ALL||(o.push(new j.i(Math.cos(V*C)*a[a.length-1].x*D,a[a.length-1].y,Math.sin(V*C)*a[a.length-1].x*D)),o.push(new j.i(0,a[a.length-1].y,0))),L.push(o)}return S(h,{pathArray:L,closeArray:w,sideOrientation:I,updatable:E,invertUV:B,frontUVs:d.frontUVs,backUVs:d.backUVs},m)}A.d.ExtrudeShape=function(h,d,m,j,b,w){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0,M=arguments.length>9?arguments[9]:void 0;return c(h,{shape:d,path:m,scale:j,rotation:b,cap:0===w?0:w||A.d.NO_CAP,sideOrientation:S,instance:M,updatable:D},a)},A.d.ExtrudeShapeCustom=(h,d,m,j,b,w,a,D,S,M,q,E)=>k(h,{shape:d,path:m,scaleFunction:j,rotationFunction:b,ribbonCloseArray:w,ribbonClosePath:a,cap:0===D?0:D||A.d.NO_CAP,sideOrientation:q,instance:E,updatable:M},S);A.d.CreateLathe=(h,d,m,j,A,b,w)=>K(h,{shape:d,radius:m,tessellation:j,sideOrientation:w,updatable:b},A);var N=m(12247),W=m(12191);function r(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=d.path;let w=d.instance,a=1;void 0!==d.radius?a=d.radius:w&&(a=w._creationDataStorage.radius);const D=d.tessellation||64,M=d.radiusFunction||null;let q=d.cap||A.d.NO_CAP;const E=d.invertUV||!1,I=d.updatable,R=A.d._GetDefaultSideOrientation(d.sideOrientation);d.arc=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1;const Z=(h,d,m,b,w,a,D,S)=>{const M=d.getTangents(),q=d.getNormals(),E=d.getDistances(),I=2*Math.PI/w*S,R=a||(()=>b);let Z,L,B,V;const v=j.d.Matrix[0];let C=D===A.d.NO_CAP||D===A.d.CAP_END?0:2;for(let A=0;A<h.length;A++){L=R(A,E[A]),Z=Array(),B=q[A];for(let d=0;d<w;d++)j.b.RotationAxisToRef(M[A],I*d,v),V=Z[d]?Z[d]:j.i.Zero(),j.i.TransformCoordinatesToRef(B,v,V),V.scaleInPlace(L).addInPlace(h[A]),Z[d]=V;m[C]=Z,C++}const T=(d,m)=>{const j=Array();for(let A=0;A<d;A++)j.push(h[m]);return j};switch(D){case A.d.NO_CAP:break;case A.d.CAP_START:m[0]=T(w,0),m[1]=m[2].slice(0);break;case A.d.CAP_END:m[C]=m[C-1].slice(0),m[C+1]=T(w,h.length-1);break;case A.d.CAP_ALL:m[0]=T(w,0),m[1]=m[2].slice(0),m[C]=m[C-1].slice(0),m[C+1]=T(w,h.length-1)}return m};let L,B;if(w){const h=w._creationDataStorage,m=d.arc||h.arc;return L=h.path3D.update(b),B=Z(b,L,h.pathArray,a,h.tessellation,M,h.cap,m),w=S("",{pathArray:B,instance:w}),h.path3D=L,h.pathArray=B,h.arc=m,h.radius=a,w}L=new H.f(b);q=q<0||q>3?0:q,B=Z(b,L,new Array,a,D,M,q,d.arc);const V=S(h,{pathArray:B,closePath:!0,closeArray:!1,updatable:I,sideOrientation:R,invertUV:E,frontUVs:d.frontUVs,backUVs:d.backUVs},m);return V._creationDataStorage.pathArray=B,V._creationDataStorage.path3D=L,V._creationDataStorage.tessellation=D,V._creationDataStorage.cap=q,V._creationDataStorage.arc=d.arc,V._creationDataStorage.radius=a,V}function Y(h){const d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const m=h.type&&(h.type<0||h.type>=d.length)?0:h.type||0,A=h.size,b=h.sizeX||A||1,D=h.sizeY||A||1,S=h.sizeZ||A||1,M=h.custom||d[m],q=M.face.length,I=h.faceUV||new Array(q),R=h.faceColors,Z=void 0===h.flat||h.flat,L=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,B=[],V=[],v=[],C=[],T=[];let o=0,y=0;const i=[];let g,F,f,H,c,k,l=0,K=0;if(Z)for(K=0;K<q;K++)R&&void 0===R[K]&&(R[K]=new E.f(1,1,1,1)),I&&void 0===I[K]&&(I[K]=new j.m(0,0,1,1));if(Z)for(K=0;K<q;K++){const h=M.face[K].length;for(f=2*Math.PI/h,H=.5*Math.tan(f/2),c=.5,l=0;l<h;l++)B.push(M.vertex[M.face[K][l]][0]*b,M.vertex[M.face[K][l]][1]*D,M.vertex[M.face[K][l]][2]*S),i.push(o),o++,g=I[K].x+(I[K].z-I[K].x)*(.5+H),F=I[K].y+(I[K].w-I[K].y)*(c-.5),C.push(g,a.b?1-F:F),k=H*Math.cos(f)-c*Math.sin(f),c=H*Math.sin(f)+c*Math.cos(f),H=k,R&&T.push(R[K].r,R[K].g,R[K].b,R[K].a);for(l=0;l<h-2;l++)V.push(i[0+y],i[l+2+y],i[l+1+y]);y+=h}else{for(l=0;l<M.vertex.length;l++)B.push(M.vertex[l][0]*b,M.vertex[l][1]*D,M.vertex[l][2]*S),C.push(0,a.b?1:0);for(K=0;K<q;K++)for(l=0;l<M.face[K].length-2;l++)V.push(M.face[K][0],M.face[K][l+2],M.face[K][l+1])}w.c.ComputeNormals(B,V,v),w.c._ComputeSides(L,B,V,v,C,h.frontUVs,h.backUVs);const N=new w.c;return N.Fh=B,N.indices=V,N.fh=v,N.kh=C,R&&Z&&(N.Hh=T),N}function x(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return Y(d).Nh(j,d.updatable),j}A.d.CreateTube=(h,d,m,j,A,b,w,a,D,S)=>r(h,{path:d,radius:m,tessellation:j,radiusFunction:A,arc:1,cap:b,updatable:a,sideOrientation:D,instance:S},w);function Q(h){const d=h.sideOrientation||w.c.DEFAULTSIDE,m=h.radius||1,A=void 0===h.flat||h.flat,b=0|(h.subdivisions||4),D=h.radiusX||m,S=h.radiusY||m,M=h.radiusZ||m,q=(1+Math.sqrt(5))/2,E=[-1,q,-0,1,q,0,-1,-q,0,1,-q,0,0,-1,-q,0,1,-q,0,-1,q,0,1,q,q,0,1,q,0,-1,-q,0,1,-q,0,-1],I=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],R=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],L=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],V=[],v=[],C=[];let T=0;const o=new Array(3),y=new Array(3);let i;for(i=0;i<3;i++)o[i]=j.i.Zero(),y[i]=j.h.Zero();for(let w=0;w<20;w++){for(i=0;i<3;i++){const h=I[3*w+i];o[i].xd(E[3*R[h]],E[3*R[h]+1],E[3*R[h]+2]),o[i].normalize(),y[i].xd(.134765625*Z[2*h]+.05859375+-.0390625*L[w],.2333984375*Z[2*h+1]+.025390625+.01953125*L[w])}const h=(h,d,m,w)=>{const q=j.i.Lerp(o[0],o[2],d/b),E=j.i.Lerp(o[1],o[2],d/b),I=b===d?o[2]:j.i.Lerp(q,E,h/(b-d));let R;if(I.normalize(),A){const h=j.i.Lerp(o[0],o[2],w/b),d=j.i.Lerp(o[1],o[2],w/b);R=j.i.Lerp(h,d,m/(b-w))}else R=new j.i(I.x,I.y,I.z);R.x/=D,R.y/=S,R.z/=M,R.normalize();const Z=j.h.Lerp(y[0],y[2],d/b),L=j.h.Lerp(y[1],y[2],d/b),i=b===d?y[2]:j.h.Lerp(Z,L,h/(b-d));V.push(I.x*D,I.y*S,I.z*M),v.push(R.x,R.y,R.z),C.push(i.x,a.b?1-i.y:i.y),B.push(T),T++};for(let d=0;d<b;d++)for(let m=0;m+d<b;m++)h(m,d,m+1/3,d+1/3),h(m+1,d,m+1/3,d+1/3),h(m,d+1,m+1/3,d+1/3),m+d+1<b&&(h(m+1,d,m+2/3,d+2/3),h(m+1,d+1,m+2/3,d+2/3),h(m,d+1,m+2/3,d+2/3))}w.c._ComputeSides(d,V,B,v,C,h.frontUVs,h.backUVs);const g=new w.c;return g.indices=B,g.Fh=V,g.fh=v,g.kh=C,g}function t(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new A.d(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),j._originalBuilderSideOrientation=d.sideOrientation;return Q(d).Nh(j,d.updatable),j}w.c.CreatePolyhedron=Y,A.d.CreatePolyhedron=(h,d,m)=>x(h,d,m);w.c.CreateIcoSphere=Q,A.d.CreateIcoSphere=(h,d,m)=>t(h,d,m);var U=m(11099);const s=new j.i(1,0,0),J=new j.i(-1,0,0),O=new j.i(0,1,0),n=new j.i(0,-1,0),p=new j.i(0,0,1),e=new j.i(0,0,-1);class X{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.i.Zero(),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.i.Up(),m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.h.Zero(),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=h,this.Dd=d,this.uv=m,this.vertexIdx=A,this.vertexIdxForBones=b,this.localPositionOverride=w,this.localNormalOverride=a,this.matrixIndicesOverride=D,this.matrixWeightsOverride=S}clone(){var h,d,m,j;return new X(this.position.clone(),this.Dd.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(h=this.localPositionOverride)||void 0===h?void 0:h.slice(),null===(d=this.localNormalOverride)||void 0===d?void 0:d.slice(),null===(m=this.matrixIndicesOverride)||void 0===m?void 0:m.slice(),null===(j=this.matrixWeightsOverride)||void 0===j?void 0:j.slice())}}function z(h,d,m){var D,S,M,q,E;const I=!!d.skeleton,R=!(null===(D=d.morphTargetManager)||void 0===D||!D.numTargets),Z=m.localMode||I,L=d.Vd(),B=I||R?d.bD(!0,!0):d.getVerticesData(b.d.PositionKind),V=I||R?d.getNormalsData(!0,!0):d.getVerticesData(b.d.NormalKind),v=Z?I?d.getVerticesData(b.d.PositionKind):B:null,C=Z?I?d.getVerticesData(b.d.NormalKind):V:null,T=d.getVerticesData(b.d.UVKind),o=I?d.getVerticesData(b.d.MatricesIndicesKind):null,y=I?d.getVerticesData(b.d.MatricesWeightsKind):null,i=I?d.getVerticesData(b.d.MatricesIndicesExtraKind):null,g=I?d.getVerticesData(b.d.MatricesWeightsExtraKind):null,F=m.position||j.i.Zero();let f=m.Dd||j.i.Up();const H=m.size||j.i.One(),c=m.angle||0;if(!f){const h=new j.i(0,0,1),m=d.ih().activeCamera,A=j.i.TransformCoordinates(h,m.getWorldMatrix());f=m.globalPosition.fm(A)}const k=-Math.atan2(f.z,f.x)-Math.PI/2,l=Math.sqrt(f.x*f.x+f.z*f.z),K=Math.atan2(f.y,l),N=new w.c;N.indices=[],N.Fh=[],N.fh=[],N.kh=[],N.matricesIndices=I?[]:null,N.matricesWeights=I?[]:null,N.matricesIndicesExtra=i?[]:null,N.matricesWeightsExtra=g?[]:null;let W=0;const r=(h,d)=>{const A=new X;if(!L||!B||!V)return A;const b=L[h];if(A.vertexIdx=3*b,A.vertexIdxForBones=4*b,A.position=new j.i(B[3*b],B[3*b+1],B[3*b+2]),j.i.TransformCoordinatesToRef(A.position,d,A.position),A.Dd=new j.i(V[3*b],V[3*b+1],V[3*b+2]),j.i.TransformNormalToRef(A.Dd,d,A.Dd),m.captureUVS&&T){const h=T[2*b+1];A.uv=new j.h(T[2*b],a.b?1-h:h)}return A},Y=[0,0,0,0],x=(h,d)=>{if(0===h.length)return h;const m=.5*Math.abs(j.i.Dot(H,d)),A=(h,d,m,j)=>{for(let A=0;A<j;++A)if(h[m+A]===d)return m+A;return-1},b=(h,b)=>{const w=j.i.GetClipFactor(h.position,b.position,d,m);let a=Y,D=Y;if(o&&y){const d=h.matrixIndicesOverride?0:h.vertexIdxForBones,m=h.matrixIndicesOverride??o,j=h.matrixWeightsOverride??y,S=b.matrixIndicesOverride?0:b.vertexIdxForBones,M=b.matrixIndicesOverride??o,q=b.matrixWeightsOverride??y;a=[0,0,0,0],D=[0,0,0,0];let E=0;for(let h=0;h<4;++h)if(j[d+h]>0){const b=A(M,m[d+h],S,4);a[E]=m[d+h],D[E]=(0,U.Lerp)(j[d+h],b>=0?q[b]:0,w),E++}for(let h=0;h<4&&E<4;++h){const j=M[S+h];-1===A(m,j,d,4)&&(a[E]=j,D[E]=(0,U.Lerp)(0,q[S+h],w),E++)}const I=D[0]+D[1]+D[2]+D[3];D[0]/=I,D[1]/=I,D[2]/=I,D[3]/=I}const S=h.localPositionOverride?h.localPositionOverride[0]:(null===v||void 0===v?void 0:v[h.vertexIdx])??0,M=h.localPositionOverride?h.localPositionOverride[1]:(null===v||void 0===v?void 0:v[h.vertexIdx+1])??0,q=h.localPositionOverride?h.localPositionOverride[2]:(null===v||void 0===v?void 0:v[h.vertexIdx+2])??0,E=b.localPositionOverride?b.localPositionOverride[0]:(null===v||void 0===v?void 0:v[b.vertexIdx])??0,I=b.localPositionOverride?b.localPositionOverride[1]:(null===v||void 0===v?void 0:v[b.vertexIdx+1])??0,R=b.localPositionOverride?b.localPositionOverride[2]:(null===v||void 0===v?void 0:v[b.vertexIdx+2])??0,Z=h.localNormalOverride?h.localNormalOverride[0]:(null===C||void 0===C?void 0:C[h.vertexIdx])??0,L=h.localNormalOverride?h.localNormalOverride[1]:(null===C||void 0===C?void 0:C[h.vertexIdx+1])??0,B=h.localNormalOverride?h.localNormalOverride[2]:(null===C||void 0===C?void 0:C[h.vertexIdx+2])??0,V=Z+((b.localNormalOverride?b.localNormalOverride[0]:(null===C||void 0===C?void 0:C[b.vertexIdx])??0)-Z)*w,T=L+((b.localNormalOverride?b.localNormalOverride[1]:(null===C||void 0===C?void 0:C[b.vertexIdx+1])??0)-L)*w,i=B+((b.localNormalOverride?b.localNormalOverride[2]:(null===C||void 0===C?void 0:C[b.vertexIdx+2])??0)-B)*w,g=Math.sqrt(V*V+T*T+i*i);return new X(j.i.Lerp(h.position,b.position,w),j.i.Lerp(h.Dd,b.Dd,w).normalize(),j.h.Lerp(h.uv,b.uv,w),-1,-1,v?[S+(E-S)*w,M+(I-M)*w,q+(R-q)*w]:null,C?[V/g,T/g,i/g]:null,a,D)};let w=null;h.length>3&&(w=[]);for(let a=0;a<h.length;a+=3){let A=0,D=null,S=null,M=null,q=null;const E=j.i.Dot(h[a].position,d)-m>0,I=j.i.Dot(h[a+1].position,d)-m>0,R=j.i.Dot(h[a+2].position,d)-m>0;switch(A=(E?1:0)+(I?1:0)+(R?1:0),A){case 0:h.length>3?(w.push(h[a]),w.push(h[a+1]),w.push(h[a+2])):w=h;break;case 1:if(w=w??new Array,E&&(D=h[a+1],S=h[a+2],M=b(h[a],D),q=b(h[a],S)),I){D=h[a],S=h[a+2],M=b(h[a+1],D),q=b(h[a+1],S),w.push(M),w.push(S.clone()),w.push(D.clone()),w.push(S.clone()),w.push(M.clone()),w.push(q);break}R&&(D=h[a],S=h[a+1],M=b(h[a+2],D),q=b(h[a+2],S)),D&&S&&M&&q&&(w.push(D.clone()),w.push(S.clone()),w.push(M),w.push(q),w.push(M.clone()),w.push(S.clone()));break;case 2:w=w??new Array,E||(D=h[a].clone(),S=b(D,h[a+1]),M=b(D,h[a+2]),w.push(D),w.push(S),w.push(M)),I||(D=h[a+1].clone(),S=b(D,h[a+2]),M=b(D,h[a]),w.push(D),w.push(S),w.push(M)),R||(D=h[a+2].clone(),S=b(D,h[a]),M=b(D,h[a+1]),w.push(D),w.push(S),w.push(M))}}return w},Q=d instanceof A.d?d:null,t=null===Q||void 0===Q?void 0:Q._thinInstanceDataStorage.matrixData,z=(null===Q||void 0===Q?void 0:Q.wb)||1,u=j.d.Matrix[0];u.D(j.b.IdentityReadOnly);for(let A=0;A<z;++A){if(null!==Q&&void 0!==Q&&Q.hasThinInstances&&t){const h=16*A;u.setRowFromFloats(0,t[h+0],t[h+1],t[h+2],t[h+3]),u.setRowFromFloats(1,t[h+4],t[h+5],t[h+6],t[h+7]),u.setRowFromFloats(2,t[h+8],t[h+9],t[h+10],t[h+11]),u.setRowFromFloats(3,t[h+12],t[h+13],t[h+14],t[h+15])}const h=j.b.RotationYawPitchRoll(k,K,c).multiply(j.b.Translation(F.x,F.y,F.z)),b=j.b.Invert(h),w=d.getWorldMatrix(),D=u.multiply(w).multiply(b),S=new Array(3);for(let d=0;d<L.length;d+=3){let h=S;if(h[0]=r(d,D),h[1]=r(d+1,D),h[2]=r(d+2,D),!(m.cullBackFaces&&-h[0].Dd.z<=0&&-h[1].Dd.z<=0&&-h[2].Dd.z<=0)&&(h=x(h,s),h&&(h=x(h,J),h&&(h=x(h,O),h&&(h=x(h,n),h&&(h=x(h,p),h&&(h=x(h,e),h)))))))for(let d=0;d<h.length;d++){const j=h[d];if(N.indices.push(W),Z?(j.localPositionOverride?(N.Fh[3*W]=j.localPositionOverride[0],N.Fh[3*W+1]=j.localPositionOverride[1],N.Fh[3*W+2]=j.localPositionOverride[2]):v&&(N.Fh[3*W]=v[j.vertexIdx],N.Fh[3*W+1]=v[j.vertexIdx+1],N.Fh[3*W+2]=v[j.vertexIdx+2]),j.localNormalOverride?(N.fh[3*W]=j.localNormalOverride[0],N.fh[3*W+1]=j.localNormalOverride[1],N.fh[3*W+2]=j.localNormalOverride[2]):C&&(N.fh[3*W]=C[j.vertexIdx],N.fh[3*W+1]=C[j.vertexIdx+1],N.fh[3*W+2]=C[j.vertexIdx+2])):(j.position.toArray(N.Fh,3*W),j.Dd.toArray(N.fh,3*W)),N.matricesIndices&&N.matricesWeights&&(j.matrixIndicesOverride?(N.matricesIndices[4*W]=j.matrixIndicesOverride[0],N.matricesIndices[4*W+1]=j.matrixIndicesOverride[1],N.matricesIndices[4*W+2]=j.matrixIndicesOverride[2],N.matricesIndices[4*W+3]=j.matrixIndicesOverride[3]):(o&&(N.matricesIndices[4*W]=o[j.vertexIdxForBones],N.matricesIndices[4*W+1]=o[j.vertexIdxForBones+1],N.matricesIndices[4*W+2]=o[j.vertexIdxForBones+2],N.matricesIndices[4*W+3]=o[j.vertexIdxForBones+3]),i&&N.matricesIndicesExtra&&(N.matricesIndicesExtra[4*W]=i[j.vertexIdxForBones],N.matricesIndicesExtra[4*W+1]=i[j.vertexIdxForBones+1],N.matricesIndicesExtra[4*W+2]=i[j.vertexIdxForBones+2],N.matricesIndicesExtra[4*W+3]=i[j.vertexIdxForBones+3])),j.matrixWeightsOverride?(N.matricesWeights[4*W]=j.matrixWeightsOverride[0],N.matricesWeights[4*W+1]=j.matrixWeightsOverride[1],N.matricesWeights[4*W+2]=j.matrixWeightsOverride[2],N.matricesWeights[4*W+3]=j.matrixWeightsOverride[3]):(y&&(N.matricesWeights[4*W]=y[j.vertexIdxForBones],N.matricesWeights[4*W+1]=y[j.vertexIdxForBones+1],N.matricesWeights[4*W+2]=y[j.vertexIdxForBones+2],N.matricesWeights[4*W+3]=y[j.vertexIdxForBones+3]),g&&N.matricesWeightsExtra&&(N.matricesWeightsExtra[4*W]=g[j.vertexIdxForBones],N.matricesWeightsExtra[4*W+1]=g[j.vertexIdxForBones+1],N.matricesWeightsExtra[4*W+2]=g[j.vertexIdxForBones+2],N.matricesWeightsExtra[4*W+3]=g[j.vertexIdxForBones+3]))),m.captureUVS)j.uv.toArray(N.kh,2*W);else{N.kh.push(.5+j.position.x/H.x);const h=.5+j.position.y/H.y;N.kh.push(a.b?1-h:h)}W++}}}0===N.indices.length&&(N.indices=null),0===N.Fh.length&&(N.Fh=null),0===N.fh.length&&(N.fh=null),0===N.kh.length&&(N.kh=null),0===(null===(S=N.matricesIndices)||void 0===S?void 0:S.length)&&(N.matricesIndices=null),0===(null===(M=N.matricesWeights)||void 0===M?void 0:M.length)&&(N.matricesWeights=null),0===(null===(q=N.matricesIndicesExtra)||void 0===q?void 0:q.length)&&(N.matricesIndicesExtra=null),0===(null===(E=N.matricesWeightsExtra)||void 0===E?void 0:E.length)&&(N.matricesWeightsExtra=null);const P=new A.d(h,d.ih());return N.Nh(P),Z?(P.skeleton=d.skeleton,P.parent=d):(P.position=F.clone(),P.rotation=new j.i(K,k,c)),P.Zd(!0),P.refreshBoundingInfo(!0,!0),P}function u(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const d=0|Math.max(h.subdivisions?h.subdivisions:2,1),m=0|Math.max(h.tessellation?h.tessellation:16,3),A=Math.max(h.height?h.height:1,0),b=Math.max(h.radius?h.radius:.25,0),D=0|Math.max(h.capSubdivisions?h.capSubdivisions:6,1),S=m,M=d,q=Math.max(h.radiusTop?h.radiusTop:b,0),E=Math.max(h.radiusBottom?h.radiusBottom:b,0),I=A-(q+E),R=2*Math.PI,Z=Math.max(h.topCapSubdivisions?h.topCapSubdivisions:D,1),L=Math.max(h.bottomCapSubdivisions?h.bottomCapSubdivisions:D,1),B=Math.acos((E-q)/A);let V=[];const v=[],C=[],T=[];let o=0;const y=[],i=.5*I,g=.5*Math.PI;let F,f;const H=j.i.Zero(),c=j.i.Zero(),k=Math.cos(B),l=Math.sin(B),K=new j.h(q*l,i+q*k).fm(new j.h(E*l,E*k-i)).length(),N=q*B+K+E*(g-B);let W=0;for(f=0;f<=Z;f++){const h=[],d=g-B*(f/Z);W+=q*B/Z;const m=Math.cos(d),j=Math.sin(d),A=m*q;for(F=0;F<=S;F++){const d=F/S,b=d*R+0,w=Math.sin(b),D=Math.cos(b);c.x=A*w,c.y=i+j*q,c.z=A*D,v.push(c.x,c.y,c.z),H.set(m*w,j,m*D),C.push(H.x,H.y,H.z),T.push(d,a.b?W/N:1-W/N),h.push(o),o++}y.push(h)}const r=A-q-E+k*q-k*E,Y=l*(E-q)/r;for(f=1;f<=M;f++){const h=[];W+=K/M;const d=l*(f*(E-q)/M+q);for(F=0;F<=S;F++){const m=F/S,j=m*R+0,A=Math.sin(j),b=Math.cos(j);c.x=d*A,c.y=i+k*q-f*r/M,c.z=d*b,v.push(c.x,c.y,c.z),H.set(A,Y,b).normalize(),C.push(H.x,H.y,H.z),T.push(m,a.b?W/N:1-W/N),h.push(o),o++}y.push(h)}for(f=1;f<=L;f++){const h=[],d=g-B-(Math.PI-B)*(f/L);W+=E*B/L;const m=Math.cos(d),j=Math.sin(d),A=m*E;for(F=0;F<=S;F++){const d=F/S,b=d*R+0,w=Math.sin(b),D=Math.cos(b);c.x=A*w,c.y=j*E-i,c.z=A*D,v.push(c.x,c.y,c.z),H.set(m*w,j,m*D),C.push(H.x,H.y,H.z),T.push(d,a.b?W/N:1-W/N),h.push(o),o++}y.push(h)}for(F=0;F<S;F++)for(f=0;f<Z+M+L;f++){const h=y[f][F],d=y[f+1][F],m=y[f+1][F+1],j=y[f][F+1];V.push(h),V.push(d),V.push(j),V.push(d),V.push(m),V.push(j)}if(V=V.reverse(),h.orientation&&!h.orientation.equals(j.i.Up())){const d=new j.b;h.orientation.clone().scale(.5*Math.PI).cross(j.i.Up()).toQuaternion().toRotationMatrix(d);const m=j.i.Zero();for(let h=0;h<v.length;h+=3)m.set(v[h],v[h+1],v[h+2]),j.i.TransformCoordinatesToRef(m.clone(),d,m),v[h]=m.x,v[h+1]=m.y,v[h+2]=m.z}const x=new w.c;return x.Fh=v,x.fh=C,x.kh=T,x.indices=V,x}function P(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:j.i.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new A.d(h,m);return u(d).Nh(b,d.updatable),b}A.d.CreateDecal=(h,d,m,j,A,b)=>z(h,d,{position:m,Dd:j,size:A,angle:b});A.d.CreateCapsule=(h,d,m)=>P(h,d,m),w.c.CreateCapsule=u;var G=m(11121),hh=m(11065);class dh{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=h,this.y=d,h!==Math.floor(h)&&(h=Math.floor(h),G.c.Warn("x is not an integer, floor(x) used")),d!==Math.floor(d)&&(d=Math.floor(d),G.c.Warn("y is not an integer, floor(y) used"))}clone(){return new dh(this.x,this.y)}rotate60About(h){const d=this.x;return this.x=h.x+h.y-this.y,this.y=d+this.y-h.x,this}rotateNeg60About(h){const d=this.x;return this.x=d+this.y-h.y,this.y=h.x+h.y-d,this}rotate120(h,d){h!==Math.floor(h)&&(h=Math.floor(h),G.c.Warn("m not an integer only floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),G.c.Warn("n not an integer only floor(n) used"));const m=this.x;return this.x=h-m-this.y,this.y=d+m,this}rotateNeg120(h,d){h!==Math.floor(h)&&(h=Math.floor(h),G.c.Warn("m is not an integer, floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),G.c.Warn("n is not an integer,   floor(n) used"));const m=this.x;return this.x=this.y-d,this.y=h+d-m-this.y,this}toCartesianOrigin(h,d){const m=j.i.Zero();return m.x=h.x+2*this.x*d+this.y*d,m.y=h.y+Math.sqrt(3)*this.y*d,m}static Zero(){return new dh(0,0)}}class mh{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new jh("icosahedron","Regular",[[0,hh.f,-1],[-hh.f,1,0],[-1,0,-hh.f],[1,0,-hh.f],[hh.f,1,0],[0,hh.f,1],[-1,0,hh.f],[-hh.f,-1,0],[0,-hh.f,-1],[hh.f,-1,0],[1,0,hh.f],[0,-hh.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let h=12;const d={},m=this.m,j=this.n;let A,b,w,a,D,S=m,M=1,q=0;0!==j&&(S=(0,U.HighestCommonFactor)(m,j)),M=m/S,q=j/S;const E=dh.Zero(),I=new dh(m,j),R=new dh(-j,m+j),Z=dh.Zero(),L=dh.Zero(),B=dh.Zero();let V,v,C,T,o=[];const y=[],i=this.vertByDist,g=(m,j,A,b)=>{V=m+"|"+A,v=j+"|"+b,V in d||v in d?V in d&&!(v in d)?d[v]=d[V]:v in d&&!(V in d)&&(d[V]=d[v]):(d[V]=h,d[v]=h,h++),i[A][0]>2?y[d[V]]=[-i[A][0],i[A][1],d[V]]:y[d[V]]=[o[i[A][0]],i[A][1],d[V]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let F=0;F<20;F++){if(o=this.IDATA.face[F],w=o[2],a=o[1],D=o[0],C=E.x+"|"+E.y,V=F+"|"+C,V in d||(d[V]=w,y[w]=[o[i[C][0]],i[C][1]]),C=I.x+"|"+I.y,V=F+"|"+C,V in d||(d[V]=a,y[a]=[o[i[C][0]],i[C][1]]),C=R.x+"|"+R.y,V=F+"|"+C,V in d||(d[V]=D,y[D]=[o[i[C][0]],i[C][1]]),A=this.IDATA.edgematch[F][0],b=this.IDATA.edgematch[F][1],"B"===b)for(let h=1;h<S;h++)L.x=m-h*(M+q),L.y=j+h*M,B.x=-h*q,B.y=h*(M+q),C=L.x+"|"+L.y,T=B.x+"|"+B.y,g(F,A,C,T);if("O"===b)for(let h=1;h<S;h++)B.x=-h*q,B.y=h*(M+q),Z.x=h*M,Z.y=h*q,C=B.x+"|"+B.y,T=Z.x+"|"+Z.y,g(F,A,C,T);if(A=this.IDATA.edgematch[F][2],b=this.IDATA.edgematch[F][3],b&&"A"===b)for(let h=1;h<S;h++)Z.x=h*M,Z.y=h*q,L.x=m-(S-h)*(M+q),L.y=j+(S-h)*M,C=Z.x+"|"+Z.y,T=L.x+"|"+L.y,g(F,A,C,T);for(let m=0;m<this.vertices.length;m++)C=this.vertices[m].x+"|"+this.vertices[m].y,V=F+"|"+C,V in d||(d[V]=h++,i[C][0]>2?y[d[V]]=[-i[C][0],i[C][1],d[V]]:y[d[V]]=[o[i[C][0]],i[C][1],d[V]])}this.closestTo=y,this.vecToidx=d}calcCoeffs(){const h=this.m,d=this.n,m=Math.sqrt(3)/3,j=h*h+d*d+h*d;this.coau=(h+d)/j,this.cobu=-d/j,this.coav=-m*(h-d)/j,this.cobv=m*(2*h+d)/j}createInnerFacets(){const h=this.m,d=this.n;for(let m=0;m<d+h+1;m++)for(let h=this.min[m];h<this.max[m]+1;h++)h<this.max[m]&&h<this.max[m+1]+1&&this.innerFacets.push(["|"+h+"|"+m,"|"+h+"|"+(m+1),"|"+(h+1)+"|"+m]),m>0&&h<this.max[m-1]&&h+1<this.max[m]+1&&this.innerFacets.push(["|"+h+"|"+m,"|"+(h+1)+"|"+m,"|"+(h+1)+"|"+(m-1)])}edgeVecsABOB(){const h=this.m,d=this.n,m=new dh(-d,h+d);for(let j=1;j<h+d;j++){const h=new dh(this.min[j],j),d=new dh(this.min[j-1],j-1),A=new dh(this.min[j+1],j+1),b=h.clone(),w=d.clone(),a=A.clone();b.rotate60About(m),w.rotate60About(m),a.rotate60About(m);const D=new dh(this.max[b.y],b.y),S=new dh(this.max[b.y-1],b.y-1),M=new dh(this.max[b.y-1]-1,b.y-1);b.x===D.x&&b.y===D.y||(b.x!==S.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,S,M]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,M,D])):b.y===a.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,d,S]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([h,S,A])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,d,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,S,D])))}}mapABOBtoOBOA(){const h=new dh(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const m=[];for(let j=0;j<3;j++)h.x=this.isoVecsABOB[d][j].x,h.y=this.isoVecsABOB[d][j].y,0===this.vertexTypes[d][j]&&h.rotateNeg120(this.m,this.n),m.push(h.clone());this.isoVecsOBOA.push(m)}}mapABOBtoBAOA(){const h=new dh(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const m=[];for(let j=0;j<3;j++)h.x=this.isoVecsABOB[d][j].x,h.y=this.isoVecsABOB[d][j].y,1===this.vertexTypes[d][j]&&h.rotate120(this.m,this.n),m.push(h.clone());this.isoVecsBAOA.push(m)}}MapToFace(h,d){const m=this.IDATA.face[h],A=m[2],b=m[1],w=m[0],a=j.i.Ud(this.IDATA.vertex[A]),D=j.i.Ud(this.IDATA.vertex[b]),S=j.i.Ud(this.IDATA.vertex[w]),M=D.fm(a),q=S.fm(a),E=M.scale(this.coau).add(q.scale(this.cobu)),I=M.scale(this.coav).add(q.scale(this.cobv)),R=[];let Z,L=j.d.Qd[0];for(let j=0;j<this.cartesian.length;j++)L=E.scale(this.cartesian[j].x).add(I.scale(this.cartesian[j].y)).add(a),R[j]=[L.x,L.y,L.z],Z=h+"|"+this.vertices[j].x+"|"+this.vertices[j].y,d.vertex[this.vecToidx[Z]]=[L.x,L.y,L.z]}build(h,d){const m=[],j=dh.Zero(),A=new dh(h,d),b=new dh(-d,h+d);m.push(j,A,b);for(let C=d;C<h+1;C++)for(let d=0;d<h+1-C;d++)m.push(new dh(d,C));if(d>0){const j=(0,U.HighestCommonFactor)(h,d),A=h/j,b=d/j;for(let a=1;a<j;a++)m.push(new dh(a*A,a*b)),m.push(new dh(-a*b,a*(A+b))),m.push(new dh(h-a*(A+b),d+a*A));const w=h/d;for(let a=1;a<d;a++)for(let j=0;j<a*w;j++)m.push(new dh(j,a)),m.push(new dh(j,a).rotate120(h,d)),m.push(new dh(j,a).rotateNeg120(h,d))}m.sort(((h,d)=>h.x-d.x)),m.sort(((h,d)=>h.y-d.y));const w=new Array(h+d+1),a=new Array(h+d+1);for(let C=0;C<w.length;C++)w[C]=1/0,a[C]=-1/0;let D=0,S=0;const M=m.length;for(let C=0;C<M;C++)S=m[C].x,D=m[C].y,w[D]=Math.min(S,w[D]),a[D]=Math.max(S,a[D]);const q=(m,j)=>{const A=m.clone();return"A"===j&&A.rotateNeg120(h,d),"B"===j&&A.rotate120(h,d),A.x<0?A.y:A.x+A.y},E=[],I=[],R=[],Z=[],L={},B=[];let V=-1,v=-1;for(let C=0;C<M;C++)E[C]=m[C].toCartesianOrigin(new dh(0,0),.5),I[C]=q(m[C],"O"),R[C]=q(m[C],"A"),Z[C]=q(m[C],"B"),I[C]===R[C]&&R[C]===Z[C]?(V=3,v=I[C]):I[C]===R[C]?(V=4,v=I[C]):R[C]===Z[C]?(V=5,v=R[C]):Z[C]===I[C]&&(V=6,v=I[C]),I[C]<R[C]&&I[C]<Z[C]&&(V=2,v=I[C]),R[C]<I[C]&&R[C]<Z[C]&&(V=1,v=R[C]),Z[C]<R[C]&&Z[C]<I[C]&&(V=0,v=Z[C]),B.push([V,v,m[C].x,m[C].y]);B.sort(((h,d)=>h[2]-d[2])),B.sort(((h,d)=>h[3]-d[3])),B.sort(((h,d)=>h[1]-d[1])),B.sort(((h,d)=>h[0]-d[0]));for(let C=0;C<B.length;C++)L[B[C][2]+"|"+B[C][3]]=[B[C][0],B[C][1],C];return this.m=h,this.n=d,this.vertices=m,this.vertByDist=L,this.cartesian=E,this.min=w,this.max=a,this}}class jh{constructor(h,d,m,j){this.name=h,this.category=d,this.vertex=m,this.face=j}}class Ah extends jh{innerToData(h,d){for(let m=0;m<d.innerFacets.length;m++)this.face.push(d.innerFacets[m].map((m=>d.vecToidx[h+m])))}mapABOBtoDATA(h,d){const m=d.IDATA.edgematch[h][0];for(let j=0;j<d.isoVecsABOB.length;j++){const A=[];for(let b=0;b<3;b++)0===d.vertexTypes[j][b]?A.push(h+"|"+d.isoVecsABOB[j][b].x+"|"+d.isoVecsABOB[j][b].y):A.push(m+"|"+d.isoVecsABOB[j][b].x+"|"+d.isoVecsABOB[j][b].y);this.face.push([d.vecToidx[A[0]],d.vecToidx[A[1]],d.vecToidx[A[2]]])}}mapOBOAtoDATA(h,d){const m=d.IDATA.edgematch[h][0];for(let j=0;j<d.isoVecsOBOA.length;j++){const A=[];for(let b=0;b<3;b++)1===d.vertexTypes[j][b]?A.push(h+"|"+d.isoVecsOBOA[j][b].x+"|"+d.isoVecsOBOA[j][b].y):A.push(m+"|"+d.isoVecsOBOA[j][b].x+"|"+d.isoVecsOBOA[j][b].y);this.face.push([d.vecToidx[A[0]],d.vecToidx[A[1]],d.vecToidx[A[2]]])}}mapBAOAtoDATA(h,d){const m=d.IDATA.edgematch[h][2];for(let j=0;j<d.isoVecsBAOA.length;j++){const A=[];for(let b=0;b<3;b++)1===d.vertexTypes[j][b]?A.push(h+"|"+d.isoVecsBAOA[j][b].x+"|"+d.isoVecsBAOA[j][b].y):A.push(m+"|"+d.isoVecsBAOA[j][b].x+"|"+d.isoVecsBAOA[j][b].y);this.face.push([d.vecToidx[A[0]],d.vecToidx[A[1]],d.vecToidx[A[2]]])}}orderData(h){const d=[];for(let b=0;b<13;b++)d[b]=[];const m=h.closestTo;for(let b=0;b<m.length;b++)m[b][0]>-1?m[b][1]>0&&d[m[b][0]].push([b,m[b][1]]):d[12].push([b,m[b][0]]);const j=[];for(let b=0;b<12;b++)j[b]=b;let A=12;for(let b=0;b<12;b++){d[b].sort(((h,d)=>h[1]-d[1]));for(let h=0;h<d[b].length;h++)j[d[b][h][0]]=A++}for(let b=0;b<d[12].length;b++)j[d[12][b][0]]=A++;for(let b=0;b<this.vertex.length;b++)this.vertex[b].push(j[b]);this.vertex.sort(((h,d)=>h[3]-d[3]));for(let b=0;b<this.vertex.length;b++)this.vertex[b].pop();for(let b=0;b<this.face.length;b++)for(let h=0;h<this.face[b].length;h++)this.face[b][h]=j[this.face[b][h]];this.sharedNodes=d[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(h,d){const m=[],j=[];let A=d.pop();j.push(A);let b=this.face[A].indexOf(h);b=(b+2)%3;let w=this.face[A][b];m.push(w);let a=0;for(;d.length>0;)A=d[a],this.face[A].indexOf(w)>-1?(b=(this.face[A].indexOf(w)+1)%3,w=this.face[A][b],m.push(w),j.push(A),d.splice(a,1),a=0):a++;return this.adjacentFaces.push(m),j}toGoldbergPolyhedronData(){const h=new jh("GeoDual","Goldberg",[],[]);h.name="GD dual";const d=this.vertex.length,m=new Array(d);for(let D=0;D<d;D++)m[D]=[];for(let D=0;D<this.face.length;D++)for(let h=0;h<3;h++)m[this.face[D][h]].push(D);let j=0,A=0,b=0,w=[],a=[];this.adjacentFaces=[];for(let D=0;D<m.length;D++){h.face[D]=this.setOrder(D,m[D].concat([]));for(const d of m[D]){j=0,A=0,b=0,w=this.face[d];for(let h=0;h<3;h++)a=this.vertex[w[h]],j+=a[0],A+=a[1],b+=a[2];h.vertex[d]=[j/3,A/3,b/3]}}return h}static BuildGeodesicData(h){const d=new Ah("Geodesic-m-n","Geodesic",[[0,hh.f,-1],[-hh.f,1,0],[-1,0,-hh.f],[1,0,-hh.f],[hh.f,1,0],[0,hh.f,1],[-1,0,hh.f],[-hh.f,-1,0],[0,-hh.f,-1],[hh.f,-1,0],[1,0,hh.f],[0,-hh.f,1]],[]);h.setIndices(),h.calcCoeffs(),h.createInnerFacets(),h.edgeVecsABOB(),h.mapABOBtoOBOA(),h.mapABOBtoBAOA();for(let m=0;m<h.IDATA.face.length;m++)h.MapToFace(m,d),d.innerToData(m,h),"B"===h.IDATA.edgematch[m][1]&&d.mapABOBtoDATA(m,h),"O"===h.IDATA.edgematch[m][1]&&d.mapOBOAtoDATA(m,h),"A"===h.IDATA.edgematch[m][3]&&d.mapBAOAtoDATA(m,h);d.orderData(h);return d.vertex=d.vertex.map((function(h){const d=h[0],m=h[1],j=h[2],A=Math.sqrt(d*d+m*m+j*j);return h[0]*=1/A,h[1]*=1/A,h[2]*=1/A,h})),d}}A.d._GoldbergMeshParser=(h,d)=>bh.Parse(h,d);class bh extends A.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(h,d){return void 0===d?(h>this.goldbergData.nbUnsharedFaces-1&&(G.c.Warn("Maximum number of unshared faces used"),h=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+h):(h>11&&(G.c.Warn("Last pole used"),h=11),d>this.goldbergData.nbFacesAtPole-1&&(G.c.Warn("Maximum number of faces at a pole used"),d=this.goldbergData.nbFacesAtPole-1),12+h*this.goldbergData.nbFacesAtPole+d)}_changeGoldbergFaceColors(h){for(let m=0;m<h.length;m++){const d=h[m][0],j=h[m][1],A=h[m][2];for(let h=d;h<j+1;h++)this.goldbergData.faceColors[h]=A}const d=[];for(let m=0;m<12;m++)for(let h=0;h<5;h++)d.push(this.goldbergData.faceColors[m].r,this.goldbergData.faceColors[m].g,this.goldbergData.faceColors[m].b,this.goldbergData.faceColors[m].a);for(let m=12;m<this.goldbergData.faceColors.length;m++)for(let h=0;h<6;h++)d.push(this.goldbergData.faceColors[m].r,this.goldbergData.faceColors[m].g,this.goldbergData.faceColors[m].b,this.goldbergData.faceColors[m].a);return d}setGoldbergFaceColors(h){const d=this._changeGoldbergFaceColors(h);this.xh(b.d.ColorKind,d)}updateGoldbergFaceColors(h){const d=this._changeGoldbergFaceColors(h);this.updateVerticesData(b.d.ColorKind,d)}_changeGoldbergFaceUVs(h){const d=this.getVerticesData(b.d.UVKind);for(let m=0;m<h.length;m++){const j=h[m][0],A=h[m][1],b=h[m][2],w=h[m][3],a=h[m][4],D=[],S=[];let M,q;for(let h=0;h<5;h++)M=b.x+w*Math.cos(a+h*Math.PI/2.5),q=b.y+w*Math.sin(a+h*Math.PI/2.5),M<0&&(M=0),M>1&&(M=1),D.push(M,q);for(let h=0;h<6;h++)M=b.x+w*Math.cos(a+h*Math.PI/3),q=b.y+w*Math.sin(a+h*Math.PI/3),M<0&&(M=0),M>1&&(M=1),S.push(M,q);for(let h=j;h<Math.min(12,A+1);h++)for(let m=0;m<5;m++)d[10*h+2*m]=D[2*m],d[10*h+2*m+1]=D[2*m+1];for(let h=Math.max(12,j);h<A+1;h++)for(let m=0;m<6;m++)d[12*h-24+2*m]=S[2*m],d[12*h-23+2*m]=S[2*m+1]}return d}setGoldbergFaceUVs(h){const d=this._changeGoldbergFaceUVs(h);this.xh(b.d.UVKind,d)}updateGoldbergFaceUVs(h){const d=this._changeGoldbergFaceUVs(h);this.updateVerticesData(b.d.UVKind,d)}placeOnGoldbergFaceAt(h,d,m){const A=j.i.RotationFromAxis(this.goldbergData.faceXaxis[d],this.goldbergData.faceYaxis[d],this.goldbergData.faceZaxis[d]);h.rotation=A,h.position=this.goldbergData.faceCenters[d].add(this.goldbergData.faceXaxis[d].scale(m.x)).add(this.goldbergData.faceYaxis[d].scale(m.y)).add(this.goldbergData.faceZaxis[d].scale(m.z))}serialize(h){super.serialize(h),h.type="GoldbergMesh";const d={};if(d.adjacentFaces=this.goldbergData.adjacentFaces,d.nbSharedFaces=this.goldbergData.nbSharedFaces,d.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,d.nbFaces=this.goldbergData.nbFaces,d.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){d.faceColors=[];for(const h of this.goldbergData.faceColors)d.faceColors.push(h.fd())}if(this.goldbergData.faceCenters){d.faceCenters=[];for(const h of this.goldbergData.faceCenters)d.faceCenters.push(h.fd())}if(this.goldbergData.faceZaxis){d.faceZaxis=[];for(const h of this.goldbergData.faceZaxis)d.faceZaxis.push(h.fd())}if(this.goldbergData.faceYaxis){d.faceYaxis=[];for(const h of this.goldbergData.faceYaxis)d.faceYaxis.push(h.fd())}if(this.goldbergData.faceXaxis){d.faceXaxis=[];for(const h of this.goldbergData.faceXaxis)d.faceXaxis.push(h.fd())}h.goldbergData=d}static Parse(h,d){const m=h.goldbergData;m.faceColors=m.faceColors.map((h=>E.f.Ud(h))),m.faceCenters=m.faceCenters.map((h=>j.i.Ud(h))),m.faceZaxis=m.faceZaxis.map((h=>j.i.Ud(h))),m.faceXaxis=m.faceXaxis.map((h=>j.i.Ud(h))),m.faceYaxis=m.faceYaxis.map((h=>j.i.Ud(h)));const A=new bh(h.name,d);return A.goldbergData=m,A}}var wh=m(11752);const ah={CreateBox:q.c,CreateTiledBox:L,CreateSphere:B.e,CreateDisc:M.b,CreateIcoSphere:t,CreateRibbon:S,CreateCylinder:T,CreateTorus:y,CreateTorusKnot:g,CreateLineSystem:F.c,cS:F.d,CreateDashedLines:F.b,ExtrudeShape:c,ExtrudeShapeCustom:k,CreateLathe:K,CreateTiledPlane:R,lS:N.b,CreateGround:W.d,CreateTiledGround:W.h,CreateGroundFromHeightMap:W.b,CreatePolygon:f.e,ExtrudePolygon:f.i,CreateTube:r,CreatePolyhedron:x,CreateGeodesic:function(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=d.m||1;j!==Math.floor(j)&&(j=Math.floor(j),G.c.Warn("m not an integer only floor(m) used"));let A=d.n||0;if(A!==Math.floor(A)&&(A=Math.floor(A),G.c.Warn("n not an integer only floor(n) used")),A>j){const h=A;A=j,j=h,G.c.Warn("n > m therefore m and n swapped")}const b=new mh;return b.build(j,A),x(h,{custom:Ah.BuildGeodesicData(b),size:d.size,sizeX:d.sizeX,sizeY:d.sizeY,sizeZ:d.sizeZ,faceUV:d.faceUV,faceColors:d.faceColors,flat:d.flat,updatable:d.updatable,sideOrientation:d.sideOrientation,frontUVs:d.frontUVs,backUVs:d.backUVs},m)},CreateGoldberg:function(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=d.size,D=d.sizeX||b||1,S=d.sizeY||b||1,M=d.sizeZ||b||1;let q=d.m||1;q!==Math.floor(q)&&(q=Math.floor(q),G.c.Warn("m not an integer only floor(m) used"));let I=d.n||0;if(I!==Math.floor(I)&&(I=Math.floor(I),G.c.Warn("n not an integer only floor(n) used")),I>q){const h=I;I=q,q=h,G.c.Warn("n > m therefore m and n swapped")}const R=new mh;R.build(q,I);const Z=Ah.BuildGeodesicData(R),L=Z.toGoldbergPolyhedronData(),B=new bh(h,m);d.sideOrientation=A.d._GetDefaultSideOrientation(d.sideOrientation),B._originalBuilderSideOrientation=d.sideOrientation;(function(h,d){const m=h.size,A=h.sizeX||m||1,b=h.sizeY||m||1,D=h.sizeZ||m||1,S=0===h.sideOrientation?0:h.sideOrientation||w.c.DEFAULTSIDE,M=[],q=[],E=[],I=[];let R=1/0,Z=-1/0,L=1/0,B=-1/0;for(let j=0;j<d.vertex.length;j++)R=Math.min(R,d.vertex[j][0]*A),Z=Math.max(Z,d.vertex[j][0]*A),L=Math.min(L,d.vertex[j][1]*b),B=Math.max(B,d.vertex[j][1]*b);let V=0;for(let w=0;w<d.face.length;w++){const h=d.face[w],m=j.i.Ud(d.vertex[h[0]]),S=j.i.Ud(d.vertex[h[2]]),v=j.i.Ud(d.vertex[h[1]]),C=S.fm(m),T=v.fm(m),o=j.i.Cross(T,C).normalize();for(let j=0;j<h.length;j++){E.push(o.x,o.y,o.z);const m=d.vertex[h[j]];M.push(m[0]*A,m[1]*b,m[2]*D);const w=(m[1]*b-L)/(B-L);I.push((m[0]*A-R)/(Z-R),a.b?1-w:w)}for(let d=0;d<h.length-2;d++)q.push(V,V+d+2,V+d+1);V+=h.length}w.c._ComputeSides(S,M,q,E,I);const v=new w.c;return v.Fh=M,v.indices=q,v.fh=E,v.kh=I,v})(d,L).Nh(B,d.updatable),B.goldbergData.nbSharedFaces=Z.sharedNodes,B.goldbergData.nbUnsharedFaces=Z.poleNodes,B.goldbergData.adjacentFaces=Z.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let A=0;A<Z.vertex.length;A++)B.goldbergData.faceCenters.push(j.i.Ud(Z.vertex[A])),B.goldbergData.faceCenters[A].x*=D,B.goldbergData.faceCenters[A].y*=S,B.goldbergData.faceCenters[A].z*=M,B.goldbergData.faceColors.push(new E.f(1,1,1,1));for(let A=0;A<L.face.length;A++){const h=L.face[A],d=j.i.Ud(L.vertex[h[0]]),m=j.i.Ud(L.vertex[h[2]]),b=j.i.Ud(L.vertex[h[1]]),w=m.fm(d),a=b.fm(d),D=j.i.Cross(a,w).normalize(),S=j.i.Cross(a,D).normalize();B.goldbergData.faceXaxis.push(a.normalize()),B.goldbergData.faceYaxis.push(D),B.goldbergData.faceZaxis.push(S)}return B},CreateDecal:z,CreateCapsule:P,CreateText:wh.e}},12260:(h,d,m)=>{"use strict";m.d(d,{b:()=>ad});var j=m(11058),A=m(11647);class b extends A.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var w=m(11353),a=(m(11493),m(11080));class D{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this._targetStopDuration!==h&&(this._targetStopDuration=h)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){this._noiseTexture!==h&&(this._noiseTexture=h,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(h){this._isAnimationSheetEnabled!=h&&(this._isAnimationSheetEnabled=h,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){this._useLogarithmicDepth=h&&this.ih().getEngine().getCaps().fragmentDepthSupported}ih(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(h){switch(h){case D.BLENDMODE_MULTIPLYADD:return;case D.BLENDMODE_ADD:h=1;break;case D.BLENDMODE_ONEONE:h=6;break;case D.BLENDMODE_STANDARD:h=2;break;case D.BLENDMODE_MULTIPLY:h=4;break;case D.BLENDMODE_SUBTRACT:h=3}this._engine.setAlphaMode(h)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:j.i.Zero()}set direction1(h){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=h)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:j.i.Zero()}set direction2(h){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=h)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:j.i.Zero()}set minEmitBox(h){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=h)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:j.i.Zero()}set maxEmitBox(h){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=h)}get billboardMode(){return this._billboardMode}set billboardMode(h){this._billboardMode!==h&&(this._billboardMode=h,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(h){this._isBillboardBased!==h&&(this._isBillboardBased=h,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(h){this._attachImageProcessingConfiguration(h)}_attachImageProcessingConfiguration(h){h!==this._imageProcessingConfiguration&&(!h&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=h)}_reset(){}_removeGradientAndTexture(h,d,m){if(!d)return this;let j=0;for(const A of d){if(A.gradient===h){d.splice(j,1);break}j++}return m&&m.dispose(),this}constructor(h){this.animations=[],this.renderingGroupId=0,this.k=j.i.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new j.i(10,10,10),this.onAnimationEnd=null,this.blendMode=D.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new j.h(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gS=new j.i(0,0,0),this._useLogarithmicDepth=!1,this.gravity=j.i.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new w.f(1,1,1,1),this.color2=new w.f(1,1,1,1),this.colorDead=new w.f(0,0,0,1),this.textureMask=new w.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new b,this.id=h,this.name=h}createPointEmitter(h,d){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new j.i(0,1,0),arguments.length>2&&void 0!==arguments[2]||new j.i(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new j.i(0,1,0),arguments.length>4&&void 0!==arguments[4]||new j.i(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new j.i(0,1,0),arguments.length>3&&void 0!==arguments[3]||new j.i(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(h,d,m,j){throw new Error("Method not implemented.")}}D.BLENDMODE_ONEONE=0,D.BLENDMODE_STANDARD=1,D.BLENDMODE_ADD=2,D.BLENDMODE_MULTIPLY=3,D.BLENDMODE_MULTIPLYADD=4,D.BLENDMODE_SUBTRACT=-1,(0,a.i)("BABYLON.BaseParticleSystem",D);var S=m(11099),M=m(11126);class q{constructor(){this.direction1=new j.i(0,1,0),this.direction2=new j.i(0,1,0),this.minEmitBox=new j.i(-.5,-.5,-.5),this.maxEmitBox=new j.i(.5,.5,.5)}startDirectionFunction(h,d,m,A){const b=(0,S.RandomRange)(this.direction1.x,this.direction2.x),w=(0,S.RandomRange)(this.direction1.y,this.direction2.y),a=(0,S.RandomRange)(this.direction1.z,this.direction2.z);if(A)return d.x=b,d.y=w,void(d.z=a);j.i.TransformNormalFromFloatsToRef(b,w,a,h,d)}startPositionFunction(h,d,m,A){const b=(0,S.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),w=(0,S.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),a=(0,S.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(A)return d.x=b,d.y=w,void(d.z=a);j.i.TransformCoordinatesFromFloatsToRef(b,w,a,h,d)}clone(){const h=new q;return M.e.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2),h.setVector3("minEmitBox",this.minEmitBox),h.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3),h.addUniform("minEmitBox",3),h.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.fd(),h.direction2=this.direction2.fd(),h.minEmitBox=this.minEmitBox.fd(),h.maxEmitBox=this.maxEmitBox.fd(),h}parse(h){j.i.FromArrayToRef(h.direction1,0,this.direction1),j.i.FromArrayToRef(h.direction2,0,this.direction2),j.i.FromArrayToRef(h.minEmitBox,0,this.minEmitBox),j.i.FromArrayToRef(h.maxEmitBox,0,this.maxEmitBox)}}class E{get radius(){return this._radius}set radius(h){this._radius=h,this._buildHeight()}get angle(){return this._angle}set angle(h){this._angle=h,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=m,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=d,this.radius=h}startDirectionFunction(h,d,m,A){A?j.d.Qd[0].D(m.ZD).normalize():m.position.subtractToRef(h.getTranslation(),j.d.Qd[0]).normalize();const b=(0,S.RandomRange)(0,this.directionRandomizer),w=(0,S.RandomRange)(0,this.directionRandomizer),a=(0,S.RandomRange)(0,this.directionRandomizer);d.x=j.d.Qd[0].x+b,d.y=j.d.Qd[0].y+w,d.z=j.d.Qd[0].z+a,d.normalize()}startPositionFunction(h,d,m,A){const b=(0,S.RandomRange)(0,2*Math.PI);let w;this.emitFromSpawnPointOnly?w=1e-4:(w=(0,S.RandomRange)(0,this.heightRange),w=1-w*w);let a=this._radius-(0,S.RandomRange)(0,this._radius*this.radiusRange);a*=w;const D=a*Math.sin(b),M=a*Math.cos(b),q=w*this._height;if(A)return d.x=D,d.y=q,void(d.z=M);j.i.TransformCoordinatesFromFloatsToRef(D,q,M,h,d)}clone(){const h=new E(this._radius,this._angle,this.directionRandomizer);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat2("radius",this._radius,this.radiusRange),h.setFloat("coneAngle",this._angle),h.setFloat2("height",this._height,this.heightRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",2),h.addUniform("coneAngle",1),h.addUniform("height",2),h.addUniform("directionRandomizer",1)}getEffectDefines(){let h="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(h+="\n#define CONEEMITTERSPAWNPOINT"),h}getClassName(){return"ConeParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this._radius,h.angle=this._angle,h.directionRandomizer=this.directionRandomizer,h.radiusRange=this.radiusRange,h.heightRange=this.heightRange,h.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,h}parse(h){this.radius=h.radius,this.angle=h.angle,this.directionRandomizer=h.directionRandomizer,this.radiusRange=void 0!==h.radiusRange?h.radiusRange:1,this.heightRange=void 0!==h.radiusRange?h.heightRange:1,this.emitFromSpawnPointOnly=void 0!==h.emitFromSpawnPointOnly&&h.emitFromSpawnPointOnly}}class I extends E{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0);super(h,d),this.direction1=m,this.direction2=A}startDirectionFunction(h,d){const m=(0,S.RandomRange)(this.direction1.x,this.direction2.x),A=(0,S.RandomRange)(this.direction1.y,this.direction2.y),b=(0,S.RandomRange)(this.direction1.z,this.direction2.z);j.i.TransformNormalFromFloatsToRef(m,A,b,h,d)}clone(){const h=new I(this.radius,this.angle,this.direction1,this.direction2);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.fd(),h.direction2=this.direction2.fd(),h}parse(h){super.parse(h),this.direction1.D(h.direction1),this.direction2.D(h.direction2)}}class R{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=h,this.height=d,this.radiusRange=m,this.directionRandomizer=A,this._tempVector=j.i.Zero()}startDirectionFunction(h,d,m,A,b){m.position.subtractToRef(h.getTranslation(),this._tempVector),this._tempVector.normalize(),j.i.TransformNormalToRef(this._tempVector,b,this._tempVector);const w=(0,S.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=w,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),A?d.D(this._tempVector):j.i.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h,d)}startPositionFunction(h,d,m,A){const b=(0,S.RandomRange)(-this.height/2,this.height/2),w=(0,S.RandomRange)(0,2*Math.PI),a=(0,S.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),D=Math.sqrt(a)*this.radius,M=D*Math.cos(w),q=D*Math.sin(w);A?d.xd(M,b,q):j.i.TransformCoordinatesFromFloatsToRef(M,b,q,h,d)}clone(){const h=new R(this.radius,this.directionRandomizer);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.height=this.height,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.height=h.height,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class Z extends R{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0),b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.i(0,1,0);super(h,d,m),this.direction1=A,this.direction2=b}startDirectionFunction(h,d,m,A){const b=(0,S.RandomRange)(this.direction1.x,this.direction2.x),w=(0,S.RandomRange)(this.direction1.y,this.direction2.y),a=(0,S.RandomRange)(this.direction1.z,this.direction2.z);A?d.xd(b,w,a):j.i.TransformNormalFromFloatsToRef(b,w,a,h,d)}clone(){const h=new Z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.fd(),h.direction2=this.direction2.fd(),h}parse(h){super.parse(h),j.i.FromArrayToRef(h.direction1,0,this.direction1),j.i.FromArrayToRef(h.direction2,0,this.direction2)}}class L{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=d,this.directionRandomizer=m}startDirectionFunction(h,d,m,A){const b=m.position.fm(h.getTranslation()).normalize(),w=(0,S.RandomRange)(0,this.directionRandomizer),a=(0,S.RandomRange)(0,this.directionRandomizer),D=(0,S.RandomRange)(0,this.directionRandomizer);b.x+=w,b.y+=a,b.z+=D,b.normalize(),A?d.D(b):j.i.TransformNormalFromFloatsToRef(b.x,b.y,b.z,h,d)}startPositionFunction(h,d,m,A){const b=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),w=(0,S.RandomRange)(0,1),a=(0,S.RandomRange)(0,2*Math.PI),D=Math.acos(2*w-1),M=b*Math.cos(a)*Math.sin(D),q=b*Math.cos(D),E=b*Math.sin(a)*Math.sin(D);A?d.xd(M,Math.abs(q),E):j.i.TransformCoordinatesFromFloatsToRef(M,Math.abs(q),E,h,d)}clone(){const h=new L(this.radius,this.directionRandomizer);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class B{constructor(){this.direction1=new j.i(0,1,0),this.direction2=new j.i(0,1,0)}startDirectionFunction(h,d,m,A){const b=(0,S.RandomRange)(this.direction1.x,this.direction2.x),w=(0,S.RandomRange)(this.direction1.y,this.direction2.y),a=(0,S.RandomRange)(this.direction1.z,this.direction2.z);A?d.xd(b,w,a):j.i.TransformNormalFromFloatsToRef(b,w,a,h,d)}startPositionFunction(h,d,m,A){A?d.xd(0,0,0):j.i.TransformCoordinatesFromFloatsToRef(0,0,0,h,d)}clone(){const h=new B;return M.e.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.fd(),h.direction2=this.direction2.fd(),h}parse(h){j.i.FromArrayToRef(h.direction1,0,this.direction1),j.i.FromArrayToRef(h.direction2,0,this.direction2)}}class V{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=d,this.directionRandomizer=m}startDirectionFunction(h,d,m,A){const b=m.position.fm(h.getTranslation()).normalize(),w=(0,S.RandomRange)(0,this.directionRandomizer),a=(0,S.RandomRange)(0,this.directionRandomizer),D=(0,S.RandomRange)(0,this.directionRandomizer);b.x+=w,b.y+=a,b.z+=D,b.normalize(),A?d.D(b):j.i.TransformNormalFromFloatsToRef(b.x,b.y,b.z,h,d)}startPositionFunction(h,d,m,A){const b=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),w=(0,S.RandomRange)(0,1),a=(0,S.RandomRange)(0,2*Math.PI),D=Math.acos(2*w-1),M=b*Math.cos(a)*Math.sin(D),q=b*Math.cos(D),E=b*Math.sin(a)*Math.sin(D);A?d.xd(M,q,E):j.i.TransformCoordinatesFromFloatsToRef(M,q,E,h,d)}clone(){const h=new V(this.radius,this.directionRandomizer);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class v extends V{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.i(0,1,0),m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0);super(h),this.direction1=d,this.direction2=m}startDirectionFunction(h,d){const m=(0,S.RandomRange)(this.direction1.x,this.direction2.x),A=(0,S.RandomRange)(this.direction1.y,this.direction2.y),b=(0,S.RandomRange)(this.direction1.z,this.direction2.z);j.i.TransformNormalFromFloatsToRef(m,A,b,h,d)}clone(){const h=new v(this.radius,this.direction1,this.direction2);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.fd(),h.direction2=this.direction2.fd(),h}parse(h){super.parse(h),this.direction1.D(h.direction1),this.direction2.D(h.direction2)}}class C{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(h,d,m,A){const b=j.d.Qd[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,m,b);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,m,b);const h=j.d.Qd[1];b.subtractToRef(m.position,h),h.scaleToRef(1/m.lifeTime,b)}else b.set(0,0,0);A?d.D(b):j.i.TransformNormalToRef(b,h,d)}startPositionFunction(h,d,m,A){const b=j.d.Qd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,m,b):b.set(0,0,0),A?d.D(b):j.i.TransformCoordinatesToRef(b,h,d)}clone(){const h=new C;return M.e.DeepCopy(this,h),h}applyToShader(h){}buildUniformLayout(h){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.particlePositionGenerator=this.particlePositionGenerator,h.particleDestinationGenerator=this.particleDestinationGenerator,h}parse(h){h.particlePositionGenerator&&(this.particlePositionGenerator=h.particlePositionGenerator),h.particleDestinationGenerator&&(this.particleDestinationGenerator=h.particleDestinationGenerator)}}var T=m(11281);class o{get mesh(){return this._mesh}set mesh(h){this._mesh!==h&&(this._mesh=h,h?(this._indices=h.Vd(),this._positions=h.getVerticesData(T.d.PositionKind),this._normals=h.getVerticesData(T.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=j.i.Zero(),this._mesh=null,this.direction1=new j.i(0,1,0),this.direction2=new j.i(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=h}startDirectionFunction(h,d,m,A){if(this.useMeshNormalsForDirection&&this._normals)return void j.i.TransformNormalToRef(this._storedNormal,h,d);const b=(0,S.RandomRange)(this.direction1.x,this.direction2.x),w=(0,S.RandomRange)(this.direction1.y,this.direction2.y),a=(0,S.RandomRange)(this.direction1.z,this.direction2.z);A?d.xd(b,w,a):j.i.TransformNormalFromFloatsToRef(b,w,a,h,d)}startPositionFunction(h,d,m,A){if(!this._indices||!this._positions)return;const b=3*(Math.random()*(this._indices.length/3)|0),w=Math.random(),a=Math.random()*(1-w),D=1-w-a,S=this._indices[b],M=this._indices[b+1],q=this._indices[b+2],E=j.d.Qd[0],I=j.d.Qd[1],R=j.d.Qd[2],Z=j.d.Qd[3];j.i.FromArrayToRef(this._positions,3*S,E),j.i.FromArrayToRef(this._positions,3*M,I),j.i.FromArrayToRef(this._positions,3*q,R),Z.x=w*E.x+a*I.x+D*R.x,Z.y=w*E.y+a*I.y+D*R.y,Z.z=w*E.z+a*I.z+D*R.z,A?d.xd(Z.x,Z.y,Z.z):j.i.TransformCoordinatesFromFloatsToRef(Z.x,Z.y,Z.z,h,d),this.useMeshNormalsForDirection&&this._normals&&(j.i.FromArrayToRef(this._normals,3*S,E),j.i.FromArrayToRef(this._normals,3*M,I),j.i.FromArrayToRef(this._normals,3*q,R),this._storedNormal.x=w*E.x+a*I.x+D*R.x,this._storedNormal.y=w*E.y+a*I.y+D*R.y,this._storedNormal.z=w*E.z+a*I.z+D*R.z)}clone(){const h=new o(this.mesh);return M.e.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var h;const d={};return d.type=this.getClassName(),d.direction1=this.direction1.fd(),d.direction2=this.direction2.fd(),d.meshId=null===(h=this.mesh)||void 0===h?void 0:h.id,d.useMeshNormalsForDirection=this.useMeshNormalsForDirection,d}parse(h,d){j.i.FromArrayToRef(h.direction1,0,this.direction1),j.i.FromArrayToRef(h.direction2,0,this.direction2),h.meshId&&d&&(this.mesh=d.getLastMeshById(h.meshId)),this.useMeshNormalsForDirection=h.useMeshNormalsForDirection}}class y{_isUbo(h){return void 0!==h.addUniform}constructor(h){this._isUbo(h)?(this.setMatrix3x3=h.updateMatrix3x3.bind(h),this.setMatrix2x2=h.updateMatrix2x2.bind(h),this.setFloat=h.updateFloat.bind(h),this.setFloat2=h.updateFloat2.bind(h),this.setFloat3=h.updateFloat3.bind(h),this.setFloat4=h.updateFloat4.bind(h),this.setFloatArray=h.updateFloatArray.bind(h),this.setArray=h.updateArray.bind(h),this.setIntArray=h.updateIntArray.bind(h),this.setMatrix=h.hb.bind(h),this.setMatrices=h.updateMatrices.bind(h),this.setVector3=h.updateVector3.bind(h),this.setVector4=h.updateVector4.bind(h),this.setColor3=h.updateColor3.bind(h),this.setColor4=h.updateColor4.bind(h),this.setDirectColor4=h.updateDirectColor4.bind(h),this.setInt=h.updateInt.bind(h),this.setInt2=h.updateInt2.bind(h),this.setInt3=h.updateInt3.bind(h),this.setInt4=h.updateInt4.bind(h)):(this.setMatrix3x3=h.setMatrix3x3.bind(h),this.setMatrix2x2=h.setMatrix2x2.bind(h),this.setFloat=h.setFloat.bind(h),this.setFloat2=h.setFloat2.bind(h),this.setFloat3=h.setFloat3.bind(h),this.setFloat4=h.setFloat4.bind(h),this.setFloatArray=h.setFloatArray.bind(h),this.setArray=h.setArray.bind(h),this.setIntArray=h.setIntArray.bind(h),this.setMatrix=h.setMatrix.bind(h),this.setMatrices=h.setMatrices.bind(h),this.setVector3=h.setVector3.bind(h),this.setVector4=h.setVector4.bind(h),this.setColor3=h.setColor3.bind(h),this.setColor4=h.setColor4.bind(h),this.setDirectColor4=h.setDirectColor4.bind(h),this.setInt=h.setInt.bind(h),this.setInt2=h.setInt2.bind(h),this.setInt3=h.setInt3.bind(h),this.setInt4=h.setInt4.bind(h))}}var i=m(11200);const g="gpuUpdateParticlesPixelShader",F="#version 300 es\nvoid main() {discard;}\n";i.b.ShadersStore[g]||(i.b.ShadersStore[g]=F);const f="gpuUpdateParticlesVertexShader",H="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";i.b.ShadersStore[f]||(i.b.ShadersStore[f]=H);(0,a.i)("BABYLON.WebGL2ParticleSystem",class{constructor(h,d){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=h,this._engine=d,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var h;return(null===(h=this._updateEffect)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof C&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=h,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new y(this._updateEffect)}createVertexBuffers(h,d){this._updateVAO.push(this._createUpdateVAO(h)),this._renderVAO.push(this._engine.recordVertexArrayObject(d,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=d}createParticleBuffer(h){return h}bindDrawBuffers(h,d,m){m?this._engine.bindBuffers(this._renderVertexBuffers,m,d):this._engine.bindVertexArrayObject(this._renderVAO[h],null)}preUpdateParticleBuffer(){const h=this._engine;if(this._engine.enableEffect(this._updateEffect),!h.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(h,d,m){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[h],null);const j=this._engine;j.bindTransformFeedbackBuffer(d.getBuffer()),j.setRasterizerState(!1),j.beginTransformFeedback(!0),j.drawArraysType(3,0,m),j.endTransformFeedback(),j.setRasterizerState(!0),j.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let h=0;h<this._updateVAO.length;h++)this._engine.releaseVertexArrayObject(this._updateVAO[h]);this._updateVAO.length=0;for(let h=0;h<this._renderVAO.length;h++)this._engine.releaseVertexArrayObject(this._renderVAO[h]);this._renderVAO.length=0}_createUpdateVAO(h){const d={};d.position=h.createVertexBuffer("position",0,3);let m=3;d.age=h.createVertexBuffer("age",m,1),m+=1,d.size=h.createVertexBuffer("size",m,3),m+=3,d.life=h.createVertexBuffer("life",m,1),m+=1,d.seed=h.createVertexBuffer("seed",m,4),m+=4,d.direction=h.createVertexBuffer("direction",m,3),m+=3,this._parent.particleEmitterType instanceof C&&(d.initialPosition=h.createVertexBuffer("initialPosition",m,3),m+=3),this._parent._colorGradientsTexture||(d.color=h.createVertexBuffer("color",m,4),m+=4),this._parent._isBillboardBased||(d.initialDirection=h.createVertexBuffer("initialDirection",m,3),m+=3),this._parent.noiseTexture&&(d.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",m,3),m+=3,d.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",m,3),m+=3),this._parent._angularSpeedGradientsTexture?(d.angle=h.createVertexBuffer("angle",m,1),m+=1):(d.angle=h.createVertexBuffer("angle",m,2),m+=2),this._parent._isAnimationSheetEnabled&&(d.cellIndex=h.createVertexBuffer("cellIndex",m,1),m+=1,this._parent.spriteRandomStartCell&&(d.cellStartOffset=h.createVertexBuffer("cellStartOffset",m,1),m+=1));const j=this._engine.recordVertexArrayObject(d,null,this._updateEffect);return this._engine.bindArrayBuffer(null),j}});class c{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,j=arguments.length>3?arguments[3]:void 0;this._engine=h,this._label=j,this._engine._storageBuffers.push(this),this._create(d,m)}_create(h,d){this._bufferSize=h,this._creationFlags=d,this._buffer=this._engine.createStorageBuffer(h,d,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(h,d,m){this._buffer&&this._engine.updateStorageBuffer(this._buffer,h,d,m)}async read(h,d,m,j){return await this._engine.readFromStorageBuffer(this._buffer,h,d,m,j)}dispose(){const h=this._engine._storageBuffers,d=h.indexOf(this);-1!==d&&(h[d]=h[h.length-1],h.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var k=m(11258),l=m(11261),K=m(11341),N=m(11543),W=m(11645),r=m(11121),Y=m(11223),x=m(11536);class Q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new x.b}_addDuration(h,d){h<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==h?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(d,!1),this._gpuTimeInFrameId=h):this.counter.addCount(d,!1))}}var t=m(11183);class U{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=h,this._engine=d,this.uniqueId=W.b.UniqueId,d.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Q),this._engine.getCaps().supportComputeShaders?j.bindingsMapping?(this._context=d.createComputeContext(),this._shaderPath=m,this._options={bindingsMapping:{},defines:[],...j}):r.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):r.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const j=this._bindings[h];this._bindings[h]={type:m?0:4,object:d,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!j||j.object!==d||j.type!==this._bindings[h].type)}setStorageTexture(h,d){const m=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==d),this._bindings[h]={type:1,object:d,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setExternalTexture(h,d){const m=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==d),this._bindings[h]={type:6,object:d,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setVideoTexture(h,d){return!!d.externalTexture&&(this.setExternalTexture(h,d.externalTexture),!0)}setUniformBuffer(h,d){const m=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==d),this._bindings[h]={type:U._BufferIsDataBuffer(d)?7:2,object:d,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setStorageBuffer(h,d){const m=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!m||m.object!==d),this._bindings[h]={type:U._BufferIsDataBuffer(d)?7:3,object:d,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}setTextureSampler(h,d){const m=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!m||!d.compareSampler(m.object)),this._bindings[h]={type:5,object:d,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries}}isReady(){let h=this._effect;for(const A in this._bindings){const h=this._bindings[A],d=h.type,m=h.object;switch(d){case 0:case 4:case 1:if(!m.isReady())return!1;break;case 6:if(!m.isReady())return!1;break}}const d=[],m=this._shaderPath;if(this._options.defines)for(let A=0;A<this._options.defines.length;A++)d.push(this._options.defines[A]);const j=d.join("\n");return this._cachedDefines!==j&&(this._cachedDefines=j,h=this._engine.createComputeEffect(m,{defines:j,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=h),!!h.isReady()}dispatch(h,d,m){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,h,d,m,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const m=U._BufferIsDataBuffer(h)?h:h.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,m,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const d in this._bindings){const m=this._bindings[d];if(!this._options.bindingsMapping[d])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+d+"'");switch(m.type){case 0:{const j=this._samplers[d],A=m.object;var h;if(!j||!A._texture||!j.compareSampler(A._texture))this._samplers[d]=(new Y.c).setParameters(A.wrapU,A.wrapV,A.wrapR,A.anisotropicFilteringLevel,A._texture.samplingMode,null===(h=A._texture)||void 0===h?void 0:h._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const h=m.object;h.getBuffer()!==m.buffer&&(m.buffer=h.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((A=>{(0,t.d)((()=>this.dispatch(h,d,m)),A,void 0,j)}))}serialize(){const h=K.d.Serialize(this);h.options=this._options,h.shaderPath=this._shaderPath,h.RE={},h.textures={};for(const d in this._bindings){const m=this._bindings[d],j=m.object;switch(m.type){case 0:case 4:case 1:{const A=j.serialize();A&&(h.textures[d]=A,h.RE[d]={type:m.type});break}}}return h}static Parse(h,d,m){const j=K.d.Parse((()=>new U(h.name,d.getEngine(),h.shaderPath,h.options)),h,d,m);for(const A in h.textures){const b=h.RE[A],w=N.e.Parse(h.textures[A],d,m);0===b.type?j.setTexture(A,w):4===b.type?j.setTexture(A,w,!1):j.setStorageTexture(A,w)}return j}static _BufferIsDataBuffer(h){return void 0!==h.underlyingResource}}(0,k.d)([(0,l.M)()],U.prototype,"name",void 0),(0,k.d)([(0,l.M)()],U.prototype,"fastMode",void 0),(0,a.i)("BABYLON.ComputeShader",U);var s=m(11335);const J="gpuUpdateParticlesComputeShader",O="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";i.b.ShadersStoreWGSL[J]||(i.b.ShadersStoreWGSL[J]=O);(0,a.i)("BABYLON.ComputeShaderParticleSystem",class{constructor(h,d){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=h,this._engine=d}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var h;return(null===(h=this._updateComputeShader)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){var d;const m={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(m.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(m.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(m.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(m.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(m.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(m.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(m.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new U("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:m,defines:h.split("\n")}),null===(d=this._simParamsComputeShader)||void 0===d||d.dispose(),this._simParamsComputeShader=new s.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new y(this._simParamsComputeShader)}createVertexBuffers(h,d){this._renderVertexBuffers.push(d)}createParticleBuffer(h){const d=new c(this._engine,4*h.length,11,"ComputeShaderParticleSystemBuffer");return d.update(h),this._bufferComputeShader.push(d),d.getBuffer()}bindDrawBuffers(h,d,m){this._engine.bindBuffers(this._renderVertexBuffers[h],m,d)}preUpdateParticleBuffer(){}updateParticleBuffer(h,d,m){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[h]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^h]),this._updateComputeShader.dispatch(Math.ceil(m/64))}releaseBuffers(){var h;for(let d=0;d<this._bufferComputeShader.length;++d)this._bufferComputeShader[d].dispose();this._bufferComputeShader.length=0,null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class n{constructor(h,d,m){this.gradient=h,this.color1=d,this.color2=m}getColorToRef(h){this.color2?w.f.LerpToRef(this.color1,this.color2,Math.random(),h):h.D(this.color1)}}class p{constructor(h,d){this.gradient=h,this.color=d}}class e{constructor(h,d,m){this.gradient=h,this.factor1=d,this.factor2=m}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class X{static GetCurrentGradient(h,d,m){if(d[0].gradient>h)return void m(d[0],d[0],1);for(let A=0;A<d.length-1;A++){const j=d[A],b=d[A+1];if(h>=j.gradient&&h<=b.gradient){return void m(j,b,(h-j.gradient)/(b.gradient-j.gradient))}}const j=d.length-1;m(d[j],d[j],1)}}var z=m(11097),u=m(11573),P=m(11094);class G{constructor(h){this.particleSystem=h,this.position=j.i.Zero(),this.direction=j.i.Zero(),this.color=new w.f(0,0,0,0),this.colorStep=new w.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new j.h(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new w.f(0,0,0,0),this._currentColor2=new w.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=G._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let h=this.age,d=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===d?(d=1,h=this._randomCellOffset):h+=this._randomCellOffset);const m=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let j;j=this._initialSpriteCellLoop?(0,S.Clamp)(h*d%this.lifeTime/this.lifeTime):(0,S.Clamp)(h*d/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+j*m|0}_inheritParticleInfoToSubEmitter(h){if(h.particleSystem.k.position){const d=h.particleSystem.k;if(d.position.D(this.position),h.inheritDirection){const h=j.d.Qd[0];this.direction.normalizeToRef(h),d.setDirection(h,0,Math.PI/2)}}else{h.particleSystem.k.D(this.position)}this.direction.scaleToRef(h.inheritedVelocityAmount/2,j.d.Qd[0]),h.particleSystem._inheritedVelocityOffset.D(j.d.Qd[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const h of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(h)}_reset(){this.age=0,this.id=G._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(h){h.position.D(this.position),this._initialDirection?h._initialDirection?h._initialDirection.D(this._initialDirection):h._initialDirection=this._initialDirection.clone():h._initialDirection=null,h.direction.D(this.direction),this.ZD&&(h.ZD?h.ZD.D(this.ZD):h.ZD=this.ZD.clone()),h.color.D(this.color),h.colorStep.D(this.colorStep),h.lifeTime=this.lifeTime,h.age=this.age,h._randomCellOffset=this._randomCellOffset,h.size=this.size,h.scale.D(this.scale),h.angle=this.angle,h.angularSpeed=this.angularSpeed,h.particleSystem=this.particleSystem,h.cellIndex=this.cellIndex,h.id=this.id,h._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(h._currentColorGradient=this._currentColorGradient,h._currentColor1.D(this._currentColor1),h._currentColor2.D(this._currentColor2)),this._currentSizeGradient&&(h._currentSizeGradient=this._currentSizeGradient,h._currentSize1=this._currentSize1,h._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(h._currentAngularSpeedGradient=this._currentAngularSpeedGradient,h._currentAngularSpeed1=this._currentAngularSpeed1,h._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(h._currentVelocityGradient=this._currentVelocityGradient,h._currentVelocity1=this._currentVelocity1,h._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(h._currentLimitVelocityGradient=this._currentLimitVelocityGradient,h._currentLimitVelocity1=this._currentLimitVelocity1,h._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(h._currentDragGradient=this._currentDragGradient,h._currentDrag1=this._currentDrag1,h._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(h._initialStartSpriteCellId=this._initialStartSpriteCellId,h._initialEndSpriteCellId=this._initialEndSpriteCellId,h._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(h.remapData&&this.remapData?h.remapData.D(this.remapData):h.remapData=new j.m(0,0,0,0)),this._randomNoiseCoordinates1&&(h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.D(this._randomNoiseCoordinates1),h._randomNoiseCoordinates2.D(this._randomNoiseCoordinates2)):(h._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),h._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}G._Count=0;var hh=m(11329),dh=(m(11491),m(11363)),mh=m(11357),jh=m(11617);function Ah(h,d){const m=(0,S.RandomRange)(0,1);w.f.LerpToRef(d.color1,d.color2,m,h.color),d.colorDead.subtractToRef(h.color,d._colorDiff),d._colorDiff.scaleToRef(1/h.lifeTime,h.colorStep)}function bh(h,d){h._currentColorGradient=d._colorGradients[0],h._currentColorGradient.getColorToRef(h.color),h._currentColor1.D(h.color),d._colorGradients.length>1?d._colorGradients[1].getColorToRef(h._currentColor2):h._currentColor2.D(h.color)}function wh(h,d){const m=d._colorGradients;X.GetCurrentGradient(d._ratio,m,((d,m,j)=>{d!==h._currentColorGradient&&(h._currentColor1.D(h._currentColor2),m.getColorToRef(h._currentColor2),h._currentColorGradient=d),w.f.LerpToRef(h._currentColor1,h._currentColor2,j,h.color)}))}function ah(h,d){h.colorStep.scaleToRef(d._scaledUpdateSpeed,d._scaledColorStep),h.color.addInPlace(d._scaledColorStep),h.color.a<0&&(h.color.a=0)}function Dh(h,d){X.GetCurrentGradient(d._ratio,d._angularSpeedGradients,((d,m,j)=>{d!==h._currentAngularSpeedGradient&&(h._currentAngularSpeed1=h._currentAngularSpeed2,h._currentAngularSpeed2=m.getFactor(),h._currentAngularSpeedGradient=d),h.angularSpeed=(0,S.Lerp)(h._currentAngularSpeed1,h._currentAngularSpeed2,j)}))}function Sh(h,d){h.angle+=h.angularSpeed*d._scaledUpdateSpeed}function Mh(h,d){d.particleEmitterType.startDirectionFunction(d._emitterWorldMatrix,h.direction,h,d.isLocal,d._emitterInverseWorldMatrix)}function qh(h,d){d.startDirectionFunction(d._emitterWorldMatrix,h.direction,h,d.isLocal)}function Eh(h,d){h._currentVelocityGradient=d._velocityGradients[0],h._currentVelocity1=h._currentVelocityGradient.getFactor(),d._velocityGradients.length>1?h._currentVelocity2=d._velocityGradients[1].getFactor():h._currentVelocity2=h._currentVelocity1}function Ih(h,d){h._currentLimitVelocityGradient=d._limitVelocityGradients[0],h._currentLimitVelocity1=h._currentLimitVelocityGradient.getFactor(),d._limitVelocityGradients.length>1?h._currentLimitVelocity2=d._limitVelocityGradients[1].getFactor():h._currentLimitVelocity2=h._currentLimitVelocity1}function Rh(h,d){X.GetCurrentGradient(d._ratio,d._velocityGradients,((m,j,A)=>{m!==h._currentVelocityGradient&&(h._currentVelocity1=h._currentVelocity2,h._currentVelocity2=j.getFactor(),h._currentVelocityGradient=m),d._directionScale*=(0,S.Lerp)(h._currentVelocity1,h._currentVelocity2,A)}))}function Zh(h,d){X.GetCurrentGradient(d._ratio,d._limitVelocityGradients,((m,j,A)=>{m!==h._currentLimitVelocityGradient&&(h._currentLimitVelocity1=h._currentLimitVelocity2,h._currentLimitVelocity2=j.getFactor(),h._currentLimitVelocityGradient=m);const b=(0,S.Lerp)(h._currentLimitVelocity1,h._currentLimitVelocity2,A);h.direction.length()>b&&h.direction.scaleInPlace(d.limitVelocityDamping)}))}function Lh(h,d){h.direction.scaleToRef(d._directionScale,d._scaledDirection)}function Bh(h,d){d.particleEmitterType.startPositionFunction(d._emitterWorldMatrix,h.position,h,d.isLocal)}function Vh(h,d){d.startPositionFunction(d._emitterWorldMatrix,h.position,h,d.isLocal)}function vh(h,d){h.ZD?h.ZD.D(h.position):h.ZD=h.position.clone(),j.i.TransformCoordinatesToRef(h.ZD,d._emitterWorldMatrix,h.position)}function Ch(h,d){d.isLocal&&h.ZD?(h.ZD.addInPlace(d._scaledDirection),j.i.TransformCoordinatesToRef(h.ZD,d._emitterWorldMatrix,h.position)):h.position.addInPlace(d._scaledDirection)}function Th(h,d){h._currentDragGradient=d._dragGradients[0],h._currentDrag1=h._currentDragGradient.getFactor(),d._dragGradients.length>1?h._currentDrag2=d._dragGradients[1].getFactor():h._currentDrag2=h._currentDrag1}function oh(h,d){X.GetCurrentGradient(d._ratio,d._dragGradients,((m,j,A)=>{m!==h._currentDragGradient&&(h._currentDrag1=h._currentDrag2,h._currentDrag2=j.getFactor(),h._currentDragGradient=m);const b=(0,S.Lerp)(h._currentDrag1,h._currentDrag2,A);d._scaledDirection.scaleInPlace(1-b)}))}function yh(h,d){h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.xd(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2.xd(Math.random(),Math.random(),Math.random())):(h._randomNoiseCoordinates1=new j.i(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2=new j.i(Math.random(),Math.random(),Math.random()))}function ih(h,d){const m=d._noiseTextureData,A=d._noiseTextureSize;if(m&&A&&h._randomNoiseCoordinates1){const b=d._fetchR(h._randomNoiseCoordinates1.x,h._randomNoiseCoordinates1.y,A.width,A.height,m),w=d._fetchR(h._randomNoiseCoordinates1.z,h._randomNoiseCoordinates2.x,A.width,A.height,m),a=d._fetchR(h._randomNoiseCoordinates2.y,h._randomNoiseCoordinates2.z,A.width,A.height,m),D=j.d.Qd[0],S=j.d.Qd[1];D.xd((2*b-1)*d.noiseStrength.x,(2*w-1)*d.noiseStrength.y,(2*a-1)*d.noiseStrength.z),D.scaleToRef(d._tempScaledUpdateSpeed,S),h.direction.addInPlace(S)}}function gh(h,d){d.gravity.scaleToRef(d._tempScaledUpdateSpeed,d._scaledGravity),h.direction.addInPlace(d._scaledGravity)}function Fh(h,d){h.size=(0,S.RandomRange)(d.minSize,d.maxSize),h.scale.xd((0,S.RandomRange)(d.minScaleX,d.maxScaleX),(0,S.RandomRange)(d.minScaleY,d.maxScaleY))}function fh(h,d){h._currentSizeGradient=d._sizeGradients[0],h._currentSize1=h._currentSizeGradient.getFactor(),h.size=h._currentSize1,d._sizeGradients.length>1?h._currentSize2=d._sizeGradients[1].getFactor():h._currentSize2=h._currentSize1,h.scale.xd((0,S.RandomRange)(d.minScaleX,d.maxScaleX),(0,S.RandomRange)(d.minScaleY,d.maxScaleY))}function Hh(h,d){const m=d._actualFrame/d.targetStopDuration;X.GetCurrentGradient(m,d._startSizeGradients,((m,j,A)=>{m!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=j.getFactor(),d._currentStartSizeGradient=m);const b=(0,S.Lerp)(d._currentStartSize1,d._currentStartSize2,A);h.scale.scaleInPlace(b)}))}function ch(h,d){X.GetCurrentGradient(d._ratio,d._sizeGradients,((d,m,j)=>{d!==h._currentSizeGradient&&(h._currentSize1=h._currentSize2,h._currentSize2=m.getFactor(),h._currentSizeGradient=d),h.size=(0,S.Lerp)(h._currentSize1,h._currentSize2,j)}))}function kh(h,d){h.remapData=new j.m(0,1,0,1)}function lh(h,d){d._colorRemapGradients&&d._colorRemapGradients.length>0&&X.GetCurrentGradient(d._ratio,d._colorRemapGradients,((d,m,j)=>{const A=(0,S.Lerp)(d.factor1,m.factor1,j),b=(0,S.Lerp)(d.factor2,m.factor2,j);h.remapData.x=A,h.remapData.y=b-A})),d._alphaRemapGradients&&d._alphaRemapGradients.length>0&&X.GetCurrentGradient(d._ratio,d._alphaRemapGradients,((d,m,j)=>{const A=(0,S.Lerp)(d.factor1,m.factor1,j),b=(0,S.Lerp)(d.factor2,m.factor2,j);h.remapData.z=A,h.remapData.w=b-A}))}function Kh(h,d){const m=(0,S.Clamp)(d._actualFrame/d.targetStopDuration);X.GetCurrentGradient(m,d._lifeTimeGradients,((d,j)=>{const A=d,b=j,w=A.getFactor(),a=b.getFactor(),D=(m-A.gradient)/(b.gradient-A.gradient);h.lifeTime=(0,S.Lerp)(w,a,D)})),d._emitPower=(0,S.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Nh(h,d){h.lifeTime=(0,S.RandomRange)(d.minLifeTime,d.maxLifeTime),d._emitPower=(0,S.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Wh(h,d){0===d._emitPower?(h._initialDirection?h._initialDirection.D(h.direction):h._initialDirection=h.direction.clone(),h.direction.set(0,0,0)):(h._initialDirection=null,h.direction.scaleInPlace(d._emitPower)),h.direction.addInPlace(d._inheritedVelocityOffset)}function rh(h,d){h.angularSpeed=(0,S.RandomRange)(d.minAngularSpeed,d.maxAngularSpeed),h.angle=(0,S.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function Yh(h,d){h._currentAngularSpeedGradient=d._angularSpeedGradients[0],h.angularSpeed=h._currentAngularSpeedGradient.getFactor(),h._currentAngularSpeed1=h.angularSpeed,d._angularSpeedGradients.length>1?h._currentAngularSpeed2=d._angularSpeedGradients[1].getFactor():h._currentAngularSpeed2=h._currentAngularSpeed1,h.angle=(0,S.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function xh(h,d){h._initialStartSpriteCellId=d.startSpriteCellID,h._initialEndSpriteCellId=d.endSpriteCellID,h._initialSpriteCellLoop=d.spriteCellLoop}function Qh(h,d){h.previousItem=d.previousItem,h.nextItem=d,d.previousItem&&(d.previousItem.nextItem=h),d.previousItem=h}function th(h,d){h.previousItem=d,h.nextItem=d.nextItem,d.nextItem&&(d.nextItem.previousItem=h),d.nextItem=h}function Uh(h,d){let m=d;for(;m.nextItem;)m=m.nextItem;h.previousItem=m,h.nextItem=m.nextItem,m.nextItem=h}function sh(h){h.previousItem&&(h.previousItem.nextItem=h.nextItem),h.nextItem&&(h.nextItem.previousItem=h.previousItem)}class Jh extends D{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(h){this._startDirectionFunction!==h&&(this._startDirectionFunction=h,this._directionProcessing.process=h?qh:Mh)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(h){this._startPositionFunction!==h&&(this._startPositionFunction=h,this._positionCreation.process=h?Vh:Bh)}set onDispose(h){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(h)}get q(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(h){this._useRampGradients!==h&&(this._useRampGradients=h,this._resetEffect(),h?(this._rampCreation={process:kh,previousItem:null,nextItem:null},th(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:lh,previousItem:null,nextItem:null},th(this._remapGradientProcessing,this._gravityProcessing)):(sh(this._rampCreation),sh(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(h){this._isLocal!==h&&(this._isLocal=h,h?(this._isLocalCreation={process:vh,previousItem:null,nextItem:null},th(this._isLocalCreation,this._positionCreation)):sh(this._isLocalCreation))}get particles(){return this.SE}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h,h?(this._sheetCreation={process:xh,previousItem:null,nextItem:null},th(this._sheetCreation,this._colorCreation)):sh(this._sheetCreation),this._reset())}getActiveCount(){return this.SE.length}getClassName(){return"Rb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[d])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new hh.d(this._engine),this._customWrappers[d].effect=h,this._customWrappers[d].drawContext&&(this._customWrappers[d].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){if(this.noiseTexture!==h){if(this._noiseTexture=h,!h)return sh(this._noiseCreation),void sh(this._noiseProcessing);this._noiseCreation={process:yh,previousItem:null,nextItem:null},th(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ih,previousItem:null,nextItem:null},th(this._noiseProcessing,this._positionProcessing)}}constructor(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(h),this._emitterInverseWorldMatrix=j.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new j.i,this.pd=new z.e,this.onStoppedObservable=new z.e,this.onStartedObservable=new z.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.SE=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new w.f(0,0,0,0),this._colorDiff=new w.f(0,0,0,0),this._scaledDirection=j.i.Zero(),this._scaledGravity=j.i.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=h=>{},this.recycleParticle=h=>{const d=this.SE.pop();d!==h&&d.copyTo(h),this._stockParticles.push(d)},this._createParticle=()=>{let h;return 0!==this._stockParticles.length?(h=this._stockParticles.pop(),h._reset()):h=new G(this),this._prepareParticle(h),h},this.paused=!1,this._shadersLoaded=!1,this._capacity=d,this._epsilon=a,m&&"Scene"!==m.getClassName()?(this._engine=m,this.defaultProjectionMatrix=j.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=m||P.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.aE.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Nh,previousItem:null,nextItem:null},this._positionCreation={process:Bh,previousItem:null,nextItem:null},th(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Mh,previousItem:null,nextItem:null},th(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Wh,previousItem:null,nextItem:null},th(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Fh,previousItem:null,nextItem:null},th(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:rh,previousItem:null,nextItem:null},th(this._angleCreation,this._sizeCreation),this._colorCreation={process:Ah,previousItem:null,nextItem:null},th(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,D||(this._colorProcessing={process:ah,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Sh,previousItem:null,nextItem:null},th(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Lh,previousItem:null,nextItem:null},th(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Ch,previousItem:null,nextItem:null},th(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:gh,previousItem:null,nextItem:null},th(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=b,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new hh.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new q,this.updateFunction=h=>{var d;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(d=this.noiseTexture.getContent())||void 0===d||d.then((h=>{this._noiseTextureData=h})));const m=h===this.SE;for(let j=0;j<h.length;j++){const d=h[j];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const A=d.age;if(d.age+=this._tempScaledUpdateSpeed,d.age>d.lifeTime){const h=d.age-A,m=d.lifeTime-A;this._tempScaledUpdateSpeed=m*this._tempScaledUpdateSpeed/h,d.age=d.lifeTime}this._ratio=d.age/d.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let b=this._updateQueueStart;for(;b;)b.process(d,this),b=b.nextItem;if(this._isAnimationSheetEnabled&&!D&&d.updateCellIndex(),d._inheritParticleInfoToSubEmitters(),d.age>=d.lifeTime){if(this._emitFromParticle(d),d._attachedSubEmitters){for(const h of d._attachedSubEmitters)h.particleSystem.disposeOnStop=!0,h.particleSystem.stop();d._attachedSubEmitters=null}this.recycleParticle(d),m&&j--}else;}}}serialize(h){throw new Error("Method not implemented.")}clone(h,d){throw new Error("Method not implemented.")}_addFactorGradient(h,d,m,j){const A=new e(d,m,j);h.push(A),h.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0))}_removeFactorGradient(h,d){if(!h)return;let m=0;for(const j of h){if(j.gradient===d){h.splice(m,1);break}m++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Kh:this._lifeTimeCreation.process=Nh}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Hh,previousItem:null,nextItem:null},th(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(sh(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this.targetStopDuration!==h&&(this._targetStopDuration=h,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(h,d,m){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,h,d,m),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(h){return this._removeFactorGradient(this._lifeTimeGradients,h),this._syncLifeTimeCreation(),this}addSizeGradient(h,d,m){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=fh,this._sizeGradientProcessing={process:ch,previousItem:null,nextItem:null},Qh(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,h,d,m),this}removeSizeGradient(h){var d;return this._removeFactorGradient(this._sizeGradients,h),0===(null===(d=this._sizeGradients)||void 0===d?void 0:d.length)&&(sh(this._sizeGradientProcessing),this._sizeCreation.process=Fh),this}addColorRemapGradient(h,d,m){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,h,d,m),this}removeColorRemapGradient(h){return this._removeFactorGradient(this._colorRemapGradients,h),this}addAlphaRemapGradient(h,d,m){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,h,d,m),this}removeAlphaRemapGradient(h){return this._removeFactorGradient(this._alphaRemapGradients,h),this}addAngularSpeedGradient(h,d,m){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Yh,this._angularSpeedGradientProcessing={process:Dh,previousItem:null,nextItem:null},Qh(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,h,d,m),this}removeAngularSpeedGradient(h){var d;return this._removeFactorGradient(this._angularSpeedGradients,h),0===(null===(d=this._angularSpeedGradients)||void 0===d?void 0:d.length)&&(this._angleCreation.process=rh,sh(this._angularSpeedGradientProcessing)),this}addVelocityGradient(h,d,m){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Eh,previousItem:null,nextItem:null},th(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Rh,previousItem:null,nextItem:null},Qh(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,h,d,m),this}removeVelocityGradient(h){var d;return this._removeFactorGradient(this._velocityGradients,h),0===(null===(d=this._velocityGradients)||void 0===d?void 0:d.length)&&(sh(this._velocityCreation),sh(this._velocityGradientProcessing)),this}addLimitVelocityGradient(h,d,m){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Ih,previousItem:null,nextItem:null},th(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Zh,previousItem:null,nextItem:null},th(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,h,d,m),this}removeLimitVelocityGradient(h){var d;return this._removeFactorGradient(this._limitVelocityGradients,h),0===(null===(d=this._limitVelocityGradients)||void 0===d?void 0:d.length)&&(sh(this._limitVelocityCreation),sh(this._limitVelocityGradientProcessing)),this}addDragGradient(h,d,m){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Th,previousItem:null,nextItem:null},Qh(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:oh,previousItem:null,nextItem:null},Qh(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,h,d,m),this}removeDragGradient(h){var d;return this._removeFactorGradient(this._dragGradients,h),0===(null===(d=this._dragGradients)||void 0===d?void 0:d.length)&&(sh(this._dragCreation),sh(this._dragGradientProcessing)),this}addEmitRateGradient(h,d,m){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,h,d,m),this}removeEmitRateGradient(h){return this._removeFactorGradient(this._emitRateGradients,h),this}addStartSizeGradient(h,d,m){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,h,d,m),this._syncStartSizeCreation(),this}removeStartSizeGradient(h){return this._removeFactorGradient(this._startSizeGradients,h),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const h=new Uint8Array(4*this._rawTextureWidth),d=w.g.qb[0];for(let m=0;m<this._rawTextureWidth;m++){const j=m/this._rawTextureWidth;X.GetCurrentGradient(j,this._rampGradients,((j,A,b)=>{w.d.LerpToRef(j.color,A.color,b,d),h[4*m]=255*d.r,h[4*m+1]=255*d.g,h[4*m+2]=255*d.b,h[4*m+3]=255}))}this._rampGradientsTexture=u.b.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(h,d){this._rampGradients||(this._rampGradients=[]);const m=new p(h,d);return this._rampGradients.push(m),this._syncRampGradientTexture(),this}removeRampGradient(h){return this._removeGradientAndTexture(h,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(h,d,m){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=bh,this._colorProcessing.process=wh);const j=new n(h,d,m);return this._colorGradients.push(j),this._colorGradients.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0)),this}removeColorGradient(h){if(!this._colorGradients)return this;let d=0;for(const m of this._colorGradients){if(m.gradient===h){this._colorGradients.splice(d,1);break}d++}return 0===this._colorGradients.length&&(this._colorCreation.process=Ah,this._colorProcessing.process=ah),this}resetDrawCache(){if(this._drawWrappers){for(const h of this._drawWrappers)if(h)for(const d of h)null===d||void 0===d||d.dispose();this._drawWrappers=[]}}_fetchR(h,d,m,j,A){return A[4*(((h=.5*Math.abs(h)+.5)*m%m|0)+((d=.5*Math.abs(d)+.5)*j%j|0)*m)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const h=this._engine,d=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*d),this._vertexBuffer=new T.c(h,this._vertexData,!0,d);let m=0;const j=this._vertexBuffer.createVertexBuffer(T.d.PositionKind,m,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.d.PositionKind]=j,m+=3;const A=this._vertexBuffer.createVertexBuffer(T.d.ColorKind,m,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.d.ColorKind]=A,m+=4;const b=this._vertexBuffer.createVertexBuffer("angle",m,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=b,m+=1;const w=this._vertexBuffer.createVertexBuffer("size",m,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=w,m+=2,this._isAnimationSheetEnabled){const h=this._vertexBuffer.createVertexBuffer("cellIndex",m,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=h,m+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const h=this._vertexBuffer.createVertexBuffer("direction",m,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=h,m+=3}if(this._useRampGradients){const h=this._vertexBuffer.createVertexBuffer("remapData",m,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=h,m+=4}let a;if(this._useInstancing){const d=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new T.c(h,d,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",m,2,this._vertexBufferSize,this._useInstancing),m+=2;this._vertexBuffers.offset=a,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const h=[],d=[];let m=0;for(let j=0;j<this._capacity;j++)h.push(m),h.push(m+1),h.push(m+2),h.push(m),h.push(m+2),h.push(m+3),d.push(m,m+1,m+1,m+2,m+2,m+3,m+3,m,m,m+3),m+=4;this._indexBuffer=this._engine.createIndexBuffer(h),this._linesIndexBuffer=this._engine.createIndexBuffer(d)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(h)setTimeout((()=>{this.start(0)}),h);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var d;-1!==(null===(d=this.k)||void 0===d?void 0:d.getClassName().indexOf("Mesh"))&&this.k.Zd(!0);const h=this.noiseTexture;if(h&&h.onGeneratedObservable)h.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let d=0;d<this.preWarmCycles;d++)this.animate(!0),h.render()}))}));else for(let d=0;d<this.preWarmCycles;d++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(h))}_postStop(h){}reset(){this._stockParticles.length=0,this.SE.length=0}_appendParticleVertex(h,d,m,A){let b=h*this._vertexBufferSize;if(this._vertexData[b++]=d.position.x+this.gS.x,this._vertexData[b++]=d.position.y+this.gS.y,this._vertexData[b++]=d.position.z+this.gS.z,this._vertexData[b++]=d.color.r,this._vertexData[b++]=d.color.g,this._vertexData[b++]=d.color.b,this._vertexData[b++]=d.color.a,this._vertexData[b++]=d.angle,this._vertexData[b++]=d.scale.x*d.size,this._vertexData[b++]=d.scale.y*d.size,this._isAnimationSheetEnabled&&(this._vertexData[b++]=d.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[b++]=d.direction.x,this._vertexData[b++]=d.direction.y,this._vertexData[b++]=d.direction.z);else if(d._initialDirection){let h=d._initialDirection;this.isLocal&&(j.i.TransformNormalToRef(h,this._emitterWorldMatrix,j.d.Qd[0]),h=j.d.Qd[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[b++]=h.x,this._vertexData[b++]=h.y,this._vertexData[b++]=h.z}else{let h=d.direction;this.isLocal&&(j.i.TransformNormalToRef(h,this._emitterWorldMatrix,j.d.Qd[0]),h=j.d.Qd[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[b++]=h.x,this._vertexData[b++]=h.y,this._vertexData[b++]=h.z}this._useRampGradients&&d.remapData&&(this._vertexData[b++]=d.remapData.x,this._vertexData[b++]=d.remapData.y,this._vertexData[b++]=d.remapData.z,this._vertexData[b++]=d.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===m?m=this._epsilon:1===m&&(m=1-this._epsilon),0===A?A=this._epsilon:1===A&&(A=1-this._epsilon)),this._vertexData[b++]=m,this._vertexData[b++]=A)}_prepareParticle(h){}_createNewOnes(h){let d;for(let m=0;m<h&&this.SE.length!==this._capacity;m++){d=this._createParticle(),this.SE.push(d);let h=this._createQueueStart;for(;h;)h.process(d,this),h=h.nextItem;d._inheritParticleInfoToSubEmitters()}}_update(h){if(this._alive=this.SE.length>0,this.k.position){const h=this.k;this._emitterWorldMatrix=h.getWorldMatrix()}else{const h=this.k;this._emitterWorldMatrix=j.b.Translation(h.x,h.y,h.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.SE),this._createNewOnes(h)}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=[T.d.PositionKind,T.d.ColorKind,"angle","offset","size"];return h&&j.push("cellIndex"),d||j.push("direction"),m&&j.push("remapData"),j}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,dh.b)(j),h&&j.push("particlesInfos"),d&&j.push("logarithmicDepthConstant"),m&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,dh.k)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&h.push("#define FOG")),this._isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),d===D.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&h.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case 2:h.push("#define BILLBOARDY");break;case 8:case 9:h.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&h.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:h.push("#define BILLBOARDMODE_ALL")}m&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,d,m){d.push(...Jh._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),h.push(...Jh._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),m.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,jh.e)(h,this._imageProcessingConfigurationDefines),(0,jh.b)(m,this._imageProcessingConfigurationDefines))}_getWrapper(h){const d=this._getCustomDrawWrapper(h);if(null!==d&&void 0!==d&&d.effect)return d;const m=[];this.fillDefines(m,h);const j=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let A=this._drawWrappers[j];A||(A=this._drawWrappers[j]=[]);let b=A[h];b||(b=new hh.d(this._engine),b.drawContext&&(b.drawContext.useInstancing=this._useInstancing),A[h]=b);const w=m.join("\n");if(b.defines!==w){const h=[],d=[],m=[];this.fillUniformsAttributesAndSamplerNames(d,h,m),b.setEffect(this._engine.createEffect("particles",h,d,m,w,void 0,void 0,void 0,void 0,this._shaderLanguage),w)}return b}animate(){var h;let d,m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!m&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(m?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let h=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const d=this._actualFrame/this.targetStopDuration;X.GetCurrentGradient(d,this._emitRateGradients,((d,m,j)=>{d!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=m.getFactor(),this._currentEmitRateGradient=d),h=(0,S.Lerp)(this._currentEmitRate1,this._currentEmitRate2,j)}))}d=h*this._scaledUpdateSpeed|0,this._newPartsExcess+=h*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!m){let h=0;for(let d=0;d<this.SE.length;d++){const m=this.SE[d];this._appendParticleVertices(h,m),h+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.SE.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(h,d){this._appendParticleVertex(h++,d,0,0),this._useInstancing||(this._appendParticleVertex(h++,d,1,0),this._appendParticleVertex(h++,d,1,1),this._appendParticleVertex(h++,d,0,1))}rebuild(){var h;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(h=this._spriteBuffer)||void 0===h||h._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Jh.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(m.bind(m,12439)),Promise.resolve().then(m.bind(m,12379))])):await Promise.all([Promise.resolve().then(m.bind(m,12370)),Promise.resolve().then(m.bind(m,12361))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==D.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(D.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(D.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(h){const d=this._getWrapper(h),m=d.effect,A=this._engine;A.enableEffect(d);const b=this.defaultViewMatrix??this._scene.getViewMatrix();if(m.setTexture("diffuseSampler",this.particleTexture),m.setMatrix("view",b),m.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();m.setFloat3("particlesInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,this.spriteCellWidth/h.width)}if(m.setVector2("translationPivot",this.translationPivot),m.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;m.setVector3("eyePosition",h.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),m.setTexture("rampSampler",this._rampGradientsTexture));const w=m.defines;var a,D,S,M,q,E;(this._scene&&((0,dh.f)(m,this,this._scene),this.applyFog&&(0,mh.g)(this._scene,void 0,m)),w.indexOf("#define BILLBOARDMODE_ALL")>=0&&(b.invertToRef(j.d.Matrix[0]),m.setMatrix("invView",j.d.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?A.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,m):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,m)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?A.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBuffer:this._indexBuffer,m):A.bindBuffers(this._vertexBuffers,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:null,m);(this.useLogarithmicDepth&&this._scene&&(0,mh.l)(w,m,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(m),this._setEngineBasedOnBlendMode(h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(m),this._useInstancing)?null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?A.drawElementsType(6,0,10,this.SE.length):A.drawArraysType(7,0,4,this.SE.length):null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?A.drawElementsType(1,0,10*this.SE.length):A.drawElementsType(0,0,6*this.SE.length);return this.SE.length}render(){if(!this.isReady()||!this.SE.length)return 0;const h=this._engine;h.setState&&(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0));let d=0;return d=this.blendMode===D.BLENDMODE_MULTIPLYADD?this._render(D.BLENDMODE_MULTIPLY)+this._render(D.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),d}_onDispose(){}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(d,m),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const h=this._scene.aE.indexOf(this);h>-1&&this._scene.aE.splice(h,1),this._scene._activeParticleSystems.dispose()}this.pd.notifyObservers(this),this.pd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Jh.ForceGLSL=!1;var Oh,nh=m(11137);!function(h){h[h.ATTACHED=0]="ATTACHED",h[h.END=1]="END"}(Oh||(Oh={}));class ph{constructor(h){if(this.particleSystem=h,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!h.k||!h.k.dispose){const d=(0,a.e)("BABYLON.AbstractMesh");h.k=new d("SubemitterSystemEmitter",h.ih()),h._disposeEmitterOnDispose=!0}}clone(){let h=this.particleSystem.k;if(h){if(h instanceof j.i)h=h.clone();else if(-1!==h.getClassName().indexOf("Mesh")){h=new((0,a.e)("BABYLON.Mesh"))("",h.ih()),h.isVisible=!1}}else h=new j.i;const d=new ph(this.particleSystem.clone(this.particleSystem.name,h));return d.particleSystem.name+="Clone",d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem._disposeEmitterOnDispose=!0,d.particleSystem.disposeOnStop=!0,d}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem=this.particleSystem.serialize(h),d}static _ParseParticleSystem(h,d,m){throw(0,nh.b)("ParseParticle")}static Parse(h,d,m){const j=h.particleSystem,A=new ph(ph._ParseParticleSystem(j,d,m,!0));return A.type=h.type,A.inheritDirection=h.inheritDirection,A.inheritedVelocityAmount=h.inheritedVelocityAmount,A.particleSystem._isSubEmitter=!0,A}dispose(){this.particleSystem.dispose()}}var eh=m(11188);function Xh(h,d){const m=new B;return m.direction1=h,m.direction2=d,m}function zh(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function uh(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ph(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.i(0,1,0),m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0);return new v(h,d,m)}function Gh(){return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function hd(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0),b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.i(0,1,0);return new Z(h,d,m,A,b)}function dd(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new E(h,d)}function md(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0);return new I(h,d,m,A)}const jd=j.i.Zero(),Ad=j.i.Zero(),bd=j.i.Zero();class wd{constructor(){this.strength=0,this.position=j.i.Zero()}_processParticle(h,d){this.position.subtractToRef(h.position,jd);const m=jd.lengthSquared()+1;jd.normalize().scaleToRef(this.strength/m,Ad),Ad.scaleToRef(d._tempScaledUpdateSpeed,bd),h.direction.addInPlace(bd)}serialize(){return{position:this.position.fd(),strength:this.strength}}}class ad extends Jh{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=h=>{if(!this._subEmitters||0===this._subEmitters.length)return;const d=Math.floor(Math.random()*this._subEmitters.length);for(const m of this._subEmitters[d])if(1===m.type){const d=m.clone();h._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(d.particleSystem),d.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(h,d){const m=Xh(h,d);return this.particleEmitterType=m,m}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h,this._flowMapUpdate&&(sh(this._flowMapUpdate),this._flowMapUpdate=null),h&&(this._flowMapUpdate={process:h=>{var d;const m=null===(d=this.ih())||void 0===d?void 0:d.getTransformMatrix();this._flowMap._processParticle(h,this.flowMapStrength*this._tempScaledUpdateSpeed,m)},previousItem:null,nextItem:null},th(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(h){this._attractors.push(h),1===this._attractors.length&&(this._attractorUpdate={process:h=>{for(const d of this._attractors)d._processParticle(h,this)},previousItem:null,nextItem:null},th(this._attractorUpdate,this._directionProcessing))}removeAttractor(h){const d=this._attractors.indexOf(h);-1!==d&&this._attractors.splice(d,1),0===this._attractors.length&&sh(this._attractorUpdate)}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(h)}createHemisphericEmitter(){const h=zh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=uh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=Ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.i(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=Gh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.i(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=md(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,d,m,j){const A=new q;return this.particleEmitterType=A,this.direction1=h,this.direction2=d,this.minEmitBox=m,this.maxEmitBox=j,A}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const h of this.subEmitters)h instanceof ad?this._subEmitters.push([new ph(h)]):h instanceof ph?this._subEmitters.push([h]):h instanceof Array&&this._subEmitters.push(h)}_stopSubEmitters(){if(this.activeSubSystems){for(const h of this.activeSubSystems)h.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const h=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==h&&this._rootParticleSystem.activeSubSystems.splice(h,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(h){h&&this._stopSubEmitters()}_prepareParticle(h){if(this._subEmitters&&this._subEmitters.length>0){const d=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];h._attachedSubEmitters=[];for(const m of d)if(0===m.type){const d=m.clone();h._attachedSubEmitters.push(d),d.particleSystem.start()}}}_onDispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),h&&this.particles)for(const m of this.particles)if(m._attachedSubEmitters)for(let h=m._attachedSubEmitters.length-1;h>=0;h-=1)m._attachedSubEmitters[h].dispose();if(d&&this.activeSubSystems)for(let m=this.activeSubSystems.length-1;m>=0;m-=1)this.activeSubSystems[m].dispose();if(this._subEmitters&&this._subEmitters.length){for(let h=0;h<this._subEmitters.length;h++)for(const d of this._subEmitters[h])d.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(h,d,m,A){let b;b=m instanceof eh.b?null:m;const D=(0,a.e)("BABYLON.Texture");if(D&&b&&(h.texture?d.particleTexture=D.Parse(h.texture,b,A):h.textureName&&(d.particleTexture=new D(A+h.textureName,b,!1,void 0===h.invertY||h.invertY),d.particleTexture.name=h.textureName)),h.emitterId||0===h.emitterId||void 0!==h.k?h.emitterId&&b?d.k=b.getLastMeshById(h.emitterId):d.k=j.i.Ud(h.k):d.k=j.i.Zero(),d.isLocal=!!h.isLocal,void 0!==h.renderingGroupId&&(d.renderingGroupId=h.renderingGroupId),void 0!==h.isBillboardBased&&(d.isBillboardBased=h.isBillboardBased),void 0!==h.billboardMode&&(d.billboardMode=h.billboardMode),void 0!==h.useLogarithmicDepth&&(d.useLogarithmicDepth=h.useLogarithmicDepth),h.animations){for(let m=0;m<h.animations.length;m++){const j=h.animations[m],A=(0,a.e)("BABYLON.Animation");A&&d.animations.push(A.Parse(j))}d.beginAnimationOnStart=h.beginAnimationOnStart,d.beginAnimationFrom=h.beginAnimationFrom,d.beginAnimationTo=h.beginAnimationTo,d.beginAnimationLoop=h.beginAnimationLoop}if(h.autoAnimate&&b&&b.beginAnimation(d,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),d.startDelay=0|h.startDelay,d.minAngularSpeed=h.minAngularSpeed,d.maxAngularSpeed=h.maxAngularSpeed,d.minSize=h.minSize,d.maxSize=h.maxSize,h.minScaleX&&(d.minScaleX=h.minScaleX,d.maxScaleX=h.maxScaleX,d.minScaleY=h.minScaleY,d.maxScaleY=h.maxScaleY),void 0!==h.preWarmCycles&&(d.preWarmCycles=h.preWarmCycles,d.preWarmStepOffset=h.preWarmStepOffset),void 0!==h.minInitialRotation&&(d.minInitialRotation=h.minInitialRotation,d.maxInitialRotation=h.maxInitialRotation),d.minLifeTime=h.minLifeTime,d.maxLifeTime=h.maxLifeTime,d.minEmitPower=h.minEmitPower,d.maxEmitPower=h.maxEmitPower,d.emitRate=h.emitRate,d.gravity=j.i.Ud(h.gravity),h.noiseStrength&&(d.noiseStrength=j.i.Ud(h.noiseStrength)),d.color1=w.f.Ud(h.color1),d.color2=w.f.Ud(h.color2),d.colorDead=w.f.Ud(h.colorDead),d.updateSpeed=h.updateSpeed,d.targetStopDuration=h.targetStopDuration,d.blendMode=h.blendMode,h.colorGradients)for(const j of h.colorGradients)d.addColorGradient(j.gradient,w.f.Ud(j.color1),j.color2?w.f.Ud(j.color2):void 0);if(h.rampGradients){for(const m of h.rampGradients)d.addRampGradient(m.gradient,w.d.Ud(m.color));d.useRampGradients=h.useRampGradients}if(h.colorRemapGradients)for(const j of h.colorRemapGradients)d.addColorRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.alphaRemapGradients)for(const j of h.alphaRemapGradients)d.addAlphaRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.sizeGradients)for(const j of h.sizeGradients)d.addSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.angularSpeedGradients)for(const j of h.angularSpeedGradients)d.addAngularSpeedGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.velocityGradients)for(const j of h.velocityGradients)d.addVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.dragGradients)for(const j of h.dragGradients)d.addDragGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.emitRateGradients)for(const j of h.emitRateGradients)d.addEmitRateGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.startSizeGradients)for(const j of h.startSizeGradients)d.addStartSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.lifeTimeGradients)for(const j of h.lifeTimeGradients)d.addLifeTimeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.limitVelocityGradients){for(const m of h.limitVelocityGradients)d.addLimitVelocityGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);d.limitVelocityDamping=h.limitVelocityDamping}if(h.noiseTexture&&b){const m=(0,a.e)("BABYLON.ProceduralTexture");d.noiseTexture=m.Parse(h.noiseTexture,b,A)}let S;if(h.particleEmitterType){switch(h.particleEmitterType.type){case"SphereParticleEmitter":S=new V;break;case"SphereDirectedParticleEmitter":S=new v;break;case"ConeEmitter":case"ConeParticleEmitter":S=new E;break;case"ConeDirectedParticleEmitter":S=new I;break;case"CylinderParticleEmitter":S=new R;break;case"CylinderDirectedParticleEmitter":S=new Z;break;case"HemisphericParticleEmitter":S=new L;break;case"PointParticleEmitter":S=new B;break;case"MeshParticleEmitter":S=new o;break;case"CustomParticleEmitter":S=new C;break;default:S=new q}S.parse(h.particleEmitterType,b)}else S=new q,S.parse(h,b);d.particleEmitterType=S,d.startSpriteCellID=h.startSpriteCellID,d.endSpriteCellID=h.endSpriteCellID,d.spriteCellLoop=h.spriteCellLoop??!0,d.spriteCellWidth=h.spriteCellWidth,d.spriteCellHeight=h.spriteCellHeight,d.spriteCellChangeSpeed=h.spriteCellChangeSpeed,d.spriteRandomStartCell=h.spriteRandomStartCell,d.disposeOnStop=h.disposeOnStop??!1,d.manualEmitCount=h.manualEmitCount??-1}static Parse(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0;const a=h.name;let D,S,M=null,q=null;if(d instanceof eh.b?D=d:(S=d,D=S.getEngine()),h.customShader&&D.createEffectForParticles){q=h.customShader;const d=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";M=D.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,d)}const E=new ad(a,b||h.km,d,M,h.isAnimationSheetEnabled);if(E.customShader=q,E._rootUrl=m,h.id&&(E.id=h.id),h.subEmitters){E.subEmitters=[];for(const j of h.subEmitters){const h=[];for(const A of j)h.push(ph.Parse(A,d,m));E.subEmitters.push(h)}}if(h.attractors)for(const w of h.attractors){const h=new wd;h.position=j.i.Ud(w.position),h.strength=w.strength,E.addAttractor(h)}return ad._Parse(h,E,d,m),h.textureMask&&(E.textureMask=w.f.Ud(h.textureMask)),h.gS&&(E.gS=j.i.Ud(h.gS)),h.preventAutoStart&&(E.preventAutoStart=h.preventAutoStart),A||E.preventAutoStart||E.start(),E}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};if(ad._Serialize(d,this,h),d.textureMask=this.textureMask.fd(),d.customShader=this.customShader,d.preventAutoStart=this.preventAutoStart,d.gS=this.gS.fd(),this.subEmitters){d.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const m of this._subEmitters){const j=[];for(const d of m)j.push(d.serialize(h));d.subEmitters.push(j)}}if(this._attractors&&this._attractors.length){d.attractors=[];for(const h of this._attractors)d.attractors.push(h.serialize())}return d}static _Serialize(h,d,m){if(h.name=d.name,h.id=d.id,h.km=d.getCapacity(),h.disposeOnStop=d.disposeOnStop,h.manualEmitCount=d.manualEmitCount,d.k.position){const m=d.k;h.emitterId=m.id}else{const m=d.k;h.k=m.fd()}d.particleEmitterType&&(h.particleEmitterType=d.particleEmitterType.serialize()),d.particleTexture&&(m?h.texture=d.particleTexture.serialize():(h.textureName=d.particleTexture.name,h.invertY=!!d.particleTexture._invertY)),h.isLocal=d.isLocal,K.d.AppendSerializedAnimations(d,h),h.beginAnimationOnStart=d.beginAnimationOnStart,h.beginAnimationFrom=d.beginAnimationFrom,h.beginAnimationTo=d.beginAnimationTo,h.beginAnimationLoop=d.beginAnimationLoop,h.startDelay=d.startDelay,h.renderingGroupId=d.renderingGroupId,h.isBillboardBased=d.isBillboardBased,h.billboardMode=d.billboardMode,h.minAngularSpeed=d.minAngularSpeed,h.maxAngularSpeed=d.maxAngularSpeed,h.minSize=d.minSize,h.maxSize=d.maxSize,h.minScaleX=d.minScaleX,h.maxScaleX=d.maxScaleX,h.minScaleY=d.minScaleY,h.maxScaleY=d.maxScaleY,h.minEmitPower=d.minEmitPower,h.maxEmitPower=d.maxEmitPower,h.minLifeTime=d.minLifeTime,h.maxLifeTime=d.maxLifeTime,h.emitRate=d.emitRate,h.gravity=d.gravity.fd(),h.noiseStrength=d.noiseStrength.fd(),h.color1=d.color1.fd(),h.color2=d.color2.fd(),h.colorDead=d.colorDead.fd(),h.updateSpeed=d.updateSpeed,h.targetStopDuration=d.targetStopDuration,h.blendMode=d.blendMode,h.preWarmCycles=d.preWarmCycles,h.preWarmStepOffset=d.preWarmStepOffset,h.minInitialRotation=d.minInitialRotation,h.maxInitialRotation=d.maxInitialRotation,h.startSpriteCellID=d.startSpriteCellID,h.spriteCellLoop=d.spriteCellLoop,h.endSpriteCellID=d.endSpriteCellID,h.spriteCellChangeSpeed=d.spriteCellChangeSpeed,h.spriteCellWidth=d.spriteCellWidth,h.spriteCellHeight=d.spriteCellHeight,h.spriteRandomStartCell=d.spriteRandomStartCell,h.isAnimationSheetEnabled=d.isAnimationSheetEnabled,h.useLogarithmicDepth=d.useLogarithmicDepth;const j=d.getColorGradients();if(j){h.colorGradients=[];for(const d of j){const m={gradient:d.gradient,color1:d.color1.fd()};d.color2?m.color2=d.color2.fd():m.color2=d.color1.fd(),h.colorGradients.push(m)}}const A=d.getRampGradients();if(A){h.rampGradients=[];for(const d of A){const m={gradient:d.gradient,color:d.color.fd()};h.rampGradients.push(m)}h.useRampGradients=d.useRampGradients}const b=d.getColorRemapGradients();if(b){h.colorRemapGradients=[];for(const d of b){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.colorRemapGradients.push(m)}}const w=d.getAlphaRemapGradients();if(w){h.alphaRemapGradients=[];for(const d of w){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.alphaRemapGradients.push(m)}}const a=d.getSizeGradients();if(a){h.sizeGradients=[];for(const d of a){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.sizeGradients.push(m)}}const D=d.getAngularSpeedGradients();if(D){h.angularSpeedGradients=[];for(const d of D){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.angularSpeedGradients.push(m)}}const S=d.getVelocityGradients();if(S){h.velocityGradients=[];for(const d of S){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.velocityGradients.push(m)}}const M=d.getDragGradients();if(M){h.dragGradients=[];for(const d of M){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.dragGradients.push(m)}}const q=d.getEmitRateGradients();if(q){h.emitRateGradients=[];for(const d of q){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.emitRateGradients.push(m)}}const E=d.getStartSizeGradients();if(E){h.startSizeGradients=[];for(const d of E){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.startSizeGradients.push(m)}}const I=d.getLifeTimeGradients();if(I){h.lifeTimeGradients=[];for(const d of I){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.lifeTimeGradients.push(m)}}const R=d.getLimitVelocityGradients();if(R){h.limitVelocityGradients=[];for(const d of R){const m={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?m.factor2=d.factor2:m.factor2=d.factor1,h.limitVelocityGradients.push(m)}h.limitVelocityDamping=d.limitVelocityDamping}d.noiseTexture&&(h.noiseTexture=d.noiseTexture.serialize())}clone(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let A=null;const b=this._engine;if(b.createEffectForParticles&&null!=this.customShader){A=this.customShader;const h=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",d=b.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,h);j[0]?j[0].effect=d:this.setCustomEffect(d,0)}const w=this.serialize(m),a=ad.Parse(w,this._scene||this._engine,this._rootUrl);return a.name=h,a.customShader=A,a._customWrappers=j,void 0===d&&(d=this.k),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.k=d,this.preventAutoStart||a.start(),a}}ad.BILLBOARDMODE_Y=2,ad.BILLBOARDMODE_ALL=7,ad.BILLBOARDMODE_STRETCHED=8,ad.BILLBOARDMODE_STRETCHED_LOCAL=9,ph._ParseParticleSystem=ad.Parse;var Dd=m(11606),Sd=m(11604),Md=m(11463);Md.b.prototype.createTransformFeedback=function(){const h=this._gl.createTransformFeedback();if(!h)throw new Error("Unable to create Transform Feedback");return h},Md.b.prototype.deleteTransformFeedback=function(h){this._gl.deleteTransformFeedback(h)},Md.b.prototype.bindTransformFeedback=function(h){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,h)},Md.b.prototype.beginTransformFeedback=function(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(h?this._gl.POINTS:this._gl.TRIANGLES)},Md.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Md.b.prototype.setTranformFeedbackVaryings=function(h,d){this._gl.transformFeedbackVaryings(h,d,this._gl.INTERLEAVED_ATTRIBS)},Md.b.prototype.bindTransformFeedbackBuffer=function(h){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h?h.underlyingResource:null)},Md.b.prototype.readTransformFeedbackBuffer=function(h){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h)};const qd="clipPlaneFragmentDeclaration2",Ed="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";i.b.IncludesShadersStore[qd]||(i.b.IncludesShadersStore[qd]=Ed);m(12267),m(12271),m(12278),m(12286),m(12295),m(12297),m(12299),m(12308);const Id="gpuRenderParticlesPixelShader",Rd="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";i.b.ShadersStore[Id]||(i.b.ShadersStore[Id]=Rd);const Zd="clipPlaneVertexDeclaration2",Ld="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";i.b.IncludesShadersStore[Zd]||(i.b.IncludesShadersStore[Zd]=Ld);m(12315),m(12324),m(12327),m(12331);const Bd="gpuRenderParticlesVertexShader",Vd="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";i.b.ShadersStore[Bd]||(i.b.ShadersStore[Bd]=Vd);class vd extends D{static get IsSupported(){if(!P.b.LastCreatedEngine)return!1;const h=P.b.LastCreatedEngine.getCaps();return h.supportTransformFeedbacks||h.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(h){this._maxActiveParticleCount=Math.min(h,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(h){this.maxActiveParticleCount=h}createPointEmitter(h,d){const m=Xh(h,d);return this.particleEmitterType=m,m}createHemisphericEmitter(){const h=zh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=uh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=Ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.i(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=Gh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.i(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=md(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.i(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.i(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,d,m,j){const A=new q;return this.particleEmitterType=A,this.direction1=h,this.direction2=d,this.minEmitBox=m,this.maxEmitBox=j,A}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ad.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ad.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ad.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";h?setTimeout((()=>{this.start(0)}),h):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[d])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new hh.d(this._engine),this._customWrappers[d].effect=h}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(h,d,m){return super._removeGradientAndTexture(h,d,m),this._releaseBuffers(),this}addColorGradient(h,d){this._colorGradients||(this._colorGradients=[]);const m=new n(h,d);return this._colorGradients.push(m),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(h&&this._colorGradients.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(h){return this._removeGradientAndTexture(h,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const d in this._drawWrappers){var h;null===(h=this._drawWrappers[d].drawContext)||void 0===h||h.reset()}}_addFactorGradient(h,d,m){const j=new e(d,m);h.push(j),this._releaseBuffers()}addSizeGradient(h,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,h,d),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(h){return this._removeGradientAndTexture(h,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(h,d){if(!h)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&h.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0));const m=this;m[d]&&(m[d].dispose(),m[d]=null)}addAngularSpeedGradient(h,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,h,d),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(h){return this._removeGradientAndTexture(h,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(h,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,h,d),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(h){return this._removeGradientAndTexture(h,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(h,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,h,d),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(h){return this._removeGradientAndTexture(h,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(h,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,h,d),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(h){return this._removeGradientAndTexture(h,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(h){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(h),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.pd=new z.e,this.onStoppedObservable=new z.e,this.onStartedObservable=new z.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,m&&"Scene"!==m.getClassName()?(this._engine=m,this.defaultProjectionMatrix=j.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=m||P.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.aE.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,a.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,a.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new hh.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers={0:new hh.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(d=d??{}).randomTextureSize||delete d.randomTextureSize;const w={km:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...d},D=d;isFinite(D)&&(w.km=D),this._capacity=w.km,this._maxActiveParticleCount=w.km,this._currentActiveCount=0,this._isAnimationSheetEnabled=b,this.particleEmitterType=new q;const S=Math.min(this._engine.getCaps().maxTextureSize,w.randomTextureSize);let M=[];for(let j=0;j<S;++j)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture=new u.b(new Float32Array(M),S,1,5,m,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,M=[];for(let j=0;j<S;++j)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture2=new u.b(new Float32Array(M),S,1,5,m,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=S}_reset(){this._releaseBuffers()}_createVertexBuffers(h,d,m){const j={};j.position=d.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let A=3;j.age=d.createVertexBuffer("age",A,1,this._attributesStrideSize,!0),A+=1,j.size=d.createVertexBuffer("size",A,3,this._attributesStrideSize,!0),A+=3,j.life=d.createVertexBuffer("life",A,1,this._attributesStrideSize,!0),A+=1,A+=4,this.billboardMode===ad.BILLBOARDMODE_STRETCHED&&(j.direction=d.createVertexBuffer("direction",A,3,this._attributesStrideSize,!0)),A+=3,this._platform.alignDataInBuffer&&(A+=1),this.particleEmitterType instanceof C&&(A+=3,this._platform.alignDataInBuffer&&(A+=1)),this._colorGradientsTexture||(j.color=d.createVertexBuffer("color",A,4,this._attributesStrideSize,!0),A+=4),this._isBillboardBased||(j.initialDirection=d.createVertexBuffer("initialDirection",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),this.noiseTexture&&(j.noiseCoordinates1=d.createVertexBuffer("noiseCoordinates1",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1),j.noiseCoordinates2=d.createVertexBuffer("noiseCoordinates2",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),j.angle=d.createVertexBuffer("angle",A,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?A++:A+=2,this._isAnimationSheetEnabled&&(j.cellIndex=d.createVertexBuffer("cellIndex",A,1,this._attributesStrideSize,!0),A+=1,this.spriteRandomStartCell&&(j.cellStartOffset=d.createVertexBuffer("cellStartOffset",A,1,this._attributesStrideSize,!0),A+=1)),j.offset=m.createVertexBuffer("offset",0,2),j.uv=m.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(j),this._platform.createVertexBuffers(h,j),this.resetDrawCache()}_initialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!h)return;const d=this._engine,m=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof C&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const A=this.particleEmitterType instanceof C,b=j.d.Qd[0];let w=0;for(let j=0;j<this._capacity;j++)if(m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(0),m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),A?(this.particleEmitterType.particleDestinationGenerator(j,null,b),m.push(b.x),m.push(b.y),m.push(b.z)):(m.push(0),m.push(0),m.push(0)),this._platform.alignDataInBuffer&&m.push(0),w+=16,A&&(this.particleEmitterType.particlePositionGenerator(j,null,b),m.push(b.x),m.push(b.y),m.push(b.z),this._platform.alignDataInBuffer&&m.push(0),w+=4),this._colorGradientsTexture||(m.push(0),m.push(0),m.push(0),m.push(0),w+=4),this.isBillboardBased||(m.push(0),m.push(0),m.push(0),this._platform.alignDataInBuffer&&m.push(0),w+=4),this.noiseTexture&&(m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),this._platform.alignDataInBuffer&&m.push(0),m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),this._platform.alignDataInBuffer&&m.push(0),w+=8),m.push(0),w+=1,this._angularSpeedGradientsTexture||(m.push(0),w+=1),this._isAnimationSheetEnabled&&(m.push(0),w+=1,this.spriteRandomStartCell&&(m.push(0),w+=1)),this._platform.alignDataInBuffer){let h=3-(w+3&3);for(w+=h;h-- >0;)m.push(0)}const a=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),D=this._platform.createParticleBuffer(m),S=this._platform.createParticleBuffer(m);this._buffer0=new T.c(d,D,!1,this._attributesStrideSize),this._buffer1=new T.c(d,S,!1,this._attributesStrideSize),this._spriteBuffer=new T.c(d,a,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let h=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(h+="\n#define BILLBOARD"),this._colorGradientsTexture&&(h+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(h+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(h+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(h+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(h+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(h+="\n#define DRAGGRADIENTS"),this._flowMap&&(h+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(h+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(h+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(h+="\n#define NOISE"),this.isLocal&&(h+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===h||(this._cachedUpdateDefines=h,this._updateBuffer=this._platform.createUpdateBuffer(h)),this._platform.isUpdateBufferReady()}_getWrapper(h){const d=this._getCustomDrawWrapper(h);if(null!==d&&void 0!==d&&d.effect)return d;const m=[];this.fillDefines(m,h);let j=this._drawWrappers[h];j||(j=new hh.d(this._engine),j.drawContext&&(j.drawContext.useInstancing=!0),this._drawWrappers[h]=j);const A=m.join("\n");if(j.defines!==A){const h=[],d=[],m=[];this.fillUniformsAttributesAndSamplerNames(d,h,m),j.setEffect(this._engine.createEffect("gpuRenderParticles",h,d,m,A),A)}return j}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=[T.d.PositionKind,"age","life","size","angle"];return h||A.push(T.d.ColorKind),d&&A.push("cellIndex"),m||A.push("initialDirection"),j&&A.push("direction"),A.push("offset",T.d.UVKind),A}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["emitterWM","gS","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,dh.b)(j),h&&j.push("sheetInfos"),d&&j.push("logarithmicDepthConstant"),m&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,dh.k)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Sd.c.FOGMODE_NONE&&h.push("#define FOG")),d===ad.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this.isLocal&&h.push("#define LOCAL"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case ad.BILLBOARDMODE_Y:h.push("#define BILLBOARDY");break;case ad.BILLBOARDMODE_STRETCHED:h.push("#define BILLBOARDSTRETCHED");break;case ad.BILLBOARDMODE_ALL:h.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&h.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),m&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,d,m){d.push(...vd._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ad.BILLBOARDMODE_STRETCHED)),h.push(...vd._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),m.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Dd.d.PrepareUniforms(h,this._imageProcessingConfigurationDefines),Dd.d.PrepareSamplers(m,this._imageProcessingConfigurationDefines))}animate(){var h;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(d?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(h,d){const m=this[d];if(!h||!h.length||m)return;const j=new Float32Array(this._rawTextureWidth);for(let A=0;A<this._rawTextureWidth;A++){const d=A/this._rawTextureWidth;X.GetCurrentGradient(d,h,((h,d,m)=>{j[A]=(0,S.Lerp)(h.factor1,d.factor1,m)}))}this[d]=u.b.CreateRTexture(j,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[d].name=d.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const h=new Uint8Array(4*this._rawTextureWidth),d=w.g.Eb[0];for(let m=0;m<this._rawTextureWidth;m++){const j=m/this._rawTextureWidth;X.GetCurrentGradient(j,this._colorGradients,((j,A,b)=>{w.f.LerpToRef(j.color1,A.color1,b,d),h[4*m]=255*d.r,h[4*m+1]=255*d.g,h[4*m+2]=255*d.b,h[4*m+3]=255*d.a}))}this._colorGradientsTexture=u.b.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(h,d){var m,A,b,w;const a=this._getWrapper(h),D=a.effect;this._engine.enableEffect(a);const S=(null===(m=this._scene)||void 0===m?void 0:m.getViewMatrix())||j.b.IdentityReadOnly;if(D.setMatrix("view",S),D.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),D.setTexture("diffuseSampler",this.particleTexture),D.setVector2("translationPivot",this.translationPivot),D.setVector3("gS",this.gS),this.isLocal&&D.setMatrix("emitterWM",d),this._colorGradientsTexture?D.setTexture("colorGradientSampler",this._colorGradientsTexture):D.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();D.setFloat3("sheetInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,h.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;D.setVector3("eyePosition",h.globalPosition)}const M=D.defines;if(this._scene&&((0,dh.f)(D,this,this._scene),this.applyFog&&(0,mh.g)(this._scene,void 0,D)),M.indexOf("#define BILLBOARDMODE_ALL")>=0){const h=S.clone();h.invert(),D.setMatrix("invView",h)}return this.useLogarithmicDepth&&this._scene&&(0,mh.l)(M,D,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),this._setEngineBasedOnBlendMode(h),this._platform.bindDrawBuffers(this._targetIndex,D,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(w=this._scene)&&void 0!==w&&w.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(h){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!h)if(this.k.position){h=this.k.getWorldMatrix()}else{const d=this.k;h=j.d.Matrix[0],j.b.TranslationToRef(d.x,d.y,d.z,h)}const d=this._engine,m=d.getDepthWrite();if(d.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const h=this.ih();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",h.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",h),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const A=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=A,d.setDepthWrite(m)}render(){let h,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!d&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const h=0|this._accumulatedCount;this._accumulatedCount-=h,this._currentActiveCount+=h}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){h=this.k.getWorldMatrix()}else{const d=this.k;h=j.d.Matrix[0],j.b.TranslationToRef(d.x,d.y,d.z,h)}const A=this._engine;this.updateInAnimate||this._update(h);let b=0;return d||m||(A.setState(!1),this.forceDepthWrite&&A.setDepthWrite(!0),b=this.blendMode===ad.BLENDMODE_MULTIPLYADD?this._render(ad.BLENDMODE_MULTIPLY,h)+this._render(ad.BLENDMODE_ADD,h):this._render(this.blendMode,h),this._engine.setAlphaMode(0)),b}rebuild(){const h=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(h,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,h()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const d in this._drawWrappers){this._drawWrappers[d].dispose()}if(this._drawWrappers={},this._scene){const h=this._scene.aE.indexOf(this);h>-1&&this._scene.aE.splice(h,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let d=0;d<this._renderVertexBuffers.length;++d){const h=this._renderVertexBuffers[d];for(const d in h)h[d].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.pd.notifyObservers(this),this.pd.clear()}clone(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let A=null;const b=this._engine;if(b.createEffectForParticles&&null!=this.customShader){A=this.customShader;const h=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";j[0]=b.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,h,void 0,void 0,void 0,this)}const w=this.serialize(m),a=vd.Parse(w,this._scene||this._engine,this._rootUrl);return a.name=h,a.customShader=A,a._customWrappers=j,void 0===d&&(d=this.k),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.k=d,a}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return ad._Serialize(d,this,h),d.activeParticleCount=this.activeParticleCount,d.randomTextureSize=this._randomTextureSize,d.customShader=this.customShader,d}static Parse(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const b=h.name;let w,a;d instanceof eh.b?w=d:(a=d,w=a.getEngine());const D=new vd(b,{km:A||h.km,randomTextureSize:h.randomTextureSize},d,null,h.isAnimationSheetEnabled);if(D._rootUrl=m,h.customShader&&w.createEffectForParticles){const d=h.customShader,m=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"",j=w.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,m,void 0,void 0,void 0,D);D.setCustomEffect(j,0),D.customShader=d}return h.id&&(D.id=h.id),h.activeParticleCount&&(D.activeParticleCount=h.activeParticleCount),ad._Parse(h,D,d,m),h.preventAutoStart&&(D.preventAutoStart=h.preventAutoStart),j||D.preventAutoStart||D.start(),D}}var Cd=m(11107),Td=m(12333),od=m(11711);class yd{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(h){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const d of this.systems)d.k=h;this._emitterNode=h}setEmitterAsSphere(h,d,m){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:h,renderingGroupId:d};const j=(0,Td.e)("emitterSphere",{diameter:h.diameter,segments:h.segments},m);j.renderingGroupId=d;const A=new od.b("emitterSphereMaterial",m);A.emissiveColor=h.color,j.material=A;for(const b of this.systems)b.k=j;this._emitterNode=j}start(h){for(const d of this.systems)h&&(d.k=h),d.start()}dispose(){for(const h of this.systems)h.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={systems:[]};for(const m of this.systems)d.systems.push(m.serialize(h));return this._emitterNode&&(d.k=this._emitterCreationOptions),d}static Parse(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;const A=new yd,b=this.BaseAssetsUrl+"/textures/";d=d||P.b.LastCreatedScene;for(const w of h.systems)A.systems.push(m?vd.Parse(w,d,b,!0,j):ad.Parse(w,d,b,!0,j));if(h.k){const m=h.k.options;if("Sphere"===h.k.kind)A.setEmitterAsSphere({diameter:m.diameter,segments:m.segments,color:w.d.Ud(m.color)},h.k.renderingGroupId,d)}return A}}yd.BaseAssetsUrl="https://assets.babylonjs.com/particles";var id=m(11144);class gd{static CreateDefault(h){let d,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,j=arguments.length>2?arguments[2]:void 0;d=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new vd("default system",{km:m},j):new ad("default system",m,j),d.k=h;const A=Cd.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return d.particleTexture=new N.e(A,d.ih()),d.createConeEmitter(.1,Math.PI/4),d.color1=new w.f(1,1,1,1),d.color2=new w.f(1,1,1,1),d.colorDead=new w.f(1,1,1,0),d.minSize=.1,d.maxSize=.1,d.minEmitPower=2,d.maxEmitPower=2,d.updateSpeed=1/60,d.emitRate=30,d}static CreateAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;d||(d=P.b.LastCreatedScene);const A={};return d.addPendingData(A),new Promise(((b,w)=>{if(m&&!vd.IsSupported)return d.removePendingData(A),w("Particle system with GPU is not supported.");Cd.e.LoadFile(`${gd.BaseAssetsUrl}/systems/${h}.json`,(h=>{d.removePendingData(A);const w=JSON.parse(h.toString());return b(yd.Parse(w,d,m,j))}),void 0,void 0,void 0,(()=>(d.removePendingData(A),w(`An error occurred with the creation of your particle system. Check if your type '${h}' exists.`))))}))}static ExportSet(h){const d=new yd;for(const m of h)d.systems.push(m);return d}static ParseFromFileAsync(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",b=arguments.length>5?arguments[5]:void 0;return new Promise(((w,a)=>{const D=new id.c;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const d=JSON.parse(D.responseText);let a;a=j?vd.Parse(d,m,A,!1,b):ad.Parse(d,m,A,!1,b),h&&(a.name=h),w(a)}else a("Unable to load the particle system")})),D.open("GET",d),D.send()}))}static ParseFromSnippetAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0;if("_BLANK"===h){const h=this.CreateDefault(null);return h.start(),Promise.resolve(h)}return new Promise(((b,w)=>{const a=new id.c;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const w=JSON.parse(JSON.parse(a.responseText).jsonPayload),D=JSON.parse(w.particleSystem);let S;S=m?vd.Parse(D,d,j,!1,A):ad.Parse(D,d,j,!1,A),S.snippetId=h,b(S)}else w("Unable to load the snippet "+h)})),a.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),a.send()}))}}gd.BaseAssetsUrl=yd.BaseAssetsUrl,gd.SnippetUrl="https://snippet.babylonjs.com",gd.CreateFromSnippetAsync=gd.ParseFromSnippetAsync;var Fd=m(11419),fd=m(11461),Hd=m(12336);(0,Hd.f)(fd.b.NAME_PARTICLESYSTEM,((h,d,m,j)=>{const A=(0,Hd.g)(fd.b.NAME_PARTICLESYSTEM);if(A&&void 0!==h.aE&&null!==h.aE)for(let b=0,w=h.aE.length;b<w;b++){const w=h.aE[b];m.aE.push(A(w,d,j))}})),(0,Hd.c)(fd.b.NAME_PARTICLESYSTEM,((h,d,m)=>{if(h.activeParticleCount){return vd.Parse(h,d,m)}return ad.Parse(h,d,m)})),eh.b.prototype.createEffectForParticles=function(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",b=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,D=arguments.length>7?arguments[7]:void 0,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9?arguments[9]:void 0,q=[],E=[];const I=[];return D?D.fillUniformsAttributesAndSamplerNames(E,q,I):(q=ad._GetAttributeNamesOrOptions(),E=ad._GetEffectCreationOptions()),-1===A.indexOf(" BILLBOARD")&&(A+="\n#define BILLBOARD\n"),null!==D&&void 0!==D&&D.isAnimationSheetEnabled&&-1===A.indexOf(" ANIMATESHEET")&&(A+="\n#define ANIMATESHEET\n"),-1===j.indexOf("diffuseSampler")&&j.push("diffuseSampler"),this.createEffect({vertex:M??(null===D||void 0===D?void 0:D.vertexShaderName)??"particles",fragmentElement:h},q,E.concat(d),I.concat(j),A,b,w,a,void 0,S,(async()=>{0===S?await Promise.resolve().then(m.bind(m,12370)):await Promise.resolve().then(m.bind(m,12439))}))},Fd.d.prototype.getEmittedParticleSystems=function(){const h=[];for(let d=0;d<this.ih().aE.length;d++){const m=this.ih().aE[d];m.k===this&&h.push(m)}return h},Fd.d.prototype.getHierarchyEmittedParticleSystems=function(){const h=[],d=this.getDescendants();d.push(this);for(let m=0;m<this.ih().aE.length;m++){const j=this.ih().aE[m],A=j.k;A.position&&-1!==d.indexOf(A)&&h.push(j)}return h};m(11303),m(11317),m(11380);m(11388),m(12339),m(11407),m(11276),m(11457);m(11519);var cd;m(12348),m(11534);!function(h){h[h.Color=2]="Color",h[h.UV=1]="UV",h[h.Random=0]="Random",h[h.Stated=3]="Stated"}(cd||(cd={}));var kd=m(11538);const ld=new j.i(0,0,0),Kd=new j.i(0,0,0),Nd=new j.i(0,0,0);class Wd{constructor(h,d,m){this.width=h,this.height=d,this.data=m}processFlowable(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;if(!m)return;m instanceof j.b?j.i.TransformCoordinatesToRef(h.position,m,Nd):(Nd.x=m.x,Nd.y=m.y,Nd.z=m.z);const A=.5*Nd.x+.5,b=1-(.5*Nd.y+.5),w=Math.floor(A*this.width),a=Math.floor(b*this.height);if(w<0||w>=this.width||a<0||a>=this.height)return;const D=4*(a*this.width+w),S=this.data[D]/255*2-1,M=this.data[D+1]/255*2-1,q=this.data[D+2]/255*2-1,E=this.data[D+3]/255;ld.set(S,M,q),ld.scaleToRef(d*E,Kd),h.direction.addInPlace(Kd)}_processParticle(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;this.processFlowable(h,d,m)}static async FromUrlAsync(h){return await new Promise(((d,m)=>{const j=document.createElement("canvas"),A=j.getContext("2d");let b=null;const w=new Image;w.crossOrigin="anonymous",w.src=h,w.onerror=d=>{m(new Error(`Failed to load image: ${h} : ${d}`))},w.onload=()=>{j.width=w.width,j.height=w.height,A.drawImage(w,0,0),b=A.getImageData(0,0,j.width,j.height),d(new Wd(j.width,j.height,b.data))}}))}static async ExtractFromTextureAsync(h){return await new Promise(((d,m)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{const m=await this.ExtractFromTextureAsync(h);d(m)}catch(j){m(j)}}));const j=h.getSize();kd.j.GetTextureDataAsync(h,j.width,j.height).then((h=>{d(new Wd(j.width,j.height,new Uint8ClampedArray(h)))})).catch(m)}))}}var rd,Yd,xd,Qd,td,Ud,sd,Jd,Od;!function(h){h[h.Int=1]="Int",h[h.Float=2]="Float",h[h.Vector2=4]="Vector2",h[h.Qd=8]="Qd",h[h.Matrix=16]="Matrix",h[h.Particle=32]="Particle",h[h.Texture=64]="Texture",h[h.Eb=128]="Eb",h[h.FloatGradient=256]="FloatGradient",h[h.Vector2Gradient=512]="Vector2Gradient",h[h.Vector3Gradient=1024]="Vector3Gradient",h[h.Color4Gradient=2048]="Color4Gradient",h[h.System=4096]="System",h[h.AutoDetect=8192]="AutoDetect",h[h.BasedOnInput=16384]="BasedOnInput",h[h.Undefined=32768]="Undefined",h[h.All=65535]="All"}(rd||(rd={})),function(h){h[h.Compatible=0]="Compatible",h[h.TypeIncompatible=1]="TypeIncompatible",h[h.HierarchyIssue=2]="HierarchyIssue"}(Yd||(Yd={})),function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(xd||(xd={}));class nd{get direction(){return this._direction}get type(){if(this._type===rd.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===rd.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(h){this._type=h}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((h=>h.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(h,d,m){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=rd.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new z.e,this.onDisconnectionObservable=new z.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=d,this.name=h,this._direction=m}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(h){var d;return this.isConnected?null!==(d=this._connectedPoint)&&void 0!==d&&d._storedFunction?this._connectedPoint._storedFunction(h):this._connectedPoint._storedValue:this.value}canConnectTo(h){return 0===this.checkCompatibilityState(h)}checkCompatibilityState(h){const d=this._ownerBlock,m=h.ownerBlock;if(this.type!==h.type&&h.innerType!==rd.AutoDetect)return h.acceptedConnectionPointTypes&&-1!==h.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(h.excludedConnectionPointTypes&&-1!==h.excludedConnectionPointTypes.indexOf(this.type))return 1;let j=m,A=d;return 0===this.direction&&(j=d,A=m),j.isAnAncestorOf(A)?2:0}connectTo(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(h))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${h.ownerBlock.name}".${h.name}`;return this._endpoints.push(h),h._connectedPoint=this,this.onConnectionObservable.notifyObservers(h),h.onConnectionObservable.notifyObservers(this),this}disconnectFrom(h){const d=this._endpoints.indexOf(h);return-1===d||(this._endpoints.splice(d,1),h._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(h),h.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(h){let d=1;for(;d<rd.All;)h&d||this.excludedConnectionPointTypes.push(d),d<<=1}serialize(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d={};return d.name=this.name,d.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.fd?(d.valueType="BABYLON."+this.value.getClassName(),d.value=this.value.fd()):(d.valueType="number",d.value=this.value)),h&&this.connectedPoint&&(d.inputName=this.name,d.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,d.targetConnectionName=this.connectedPoint.name,d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),d}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class pd{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(h){this._name=h}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(h){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new z.e,this.pd=new z.e,this.onInputChangedObservable=new z.e,this.visibleOnFrame=!1,this._name=h,this.uniqueId=W.b.UniqueId}_inputRename(h){return h}_outputRename(h){return h}isAnAncestorOf(h){for(const d of this._outputs)if(d.hasEndpoints)for(const m of d.endpoints){if(m.ownerBlock===h)return!0;if(m.ownerBlock.isAnAncestorOf(h))return!0}return!1}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const d of this._outputs)if(d.hasEndpoints)for(const m of d.endpoints)if(m.ownerBlock.isAnAncestorOfType(h))return!0;return!1}getInputByName(h){const d=this._inputs.filter((d=>d.name===h));return d.length?d[0]:null}_linkConnectionTypes(h,d){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[d]._acceptedConnectionPointType=this._inputs[h]:(this._inputs[h]._linkedConnectionSource=this._inputs[d],this._inputs[h]._isMainLinkSource=!0),this._inputs[d]._linkedConnectionSource=this._inputs[h]}registerInput(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;const w=new nd(h,this,0);return w.type=d,w.isOptional=m,w.defaultValue=j,w.value=j,w.valueMin=A,w.valueMax=b,this._inputs.push(w),this.onInputChangedObservable.notifyObservers(w),this}registerOutput(h,d,m){return(m=m??new nd(h,this,1)).type=d,this._outputs.push(m),this}_build(h){}_customBuildStep(h){}build(h){if(this._buildId===h.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((h=>h.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=h.buildId;for(const d of this._inputs){if(!d.connectedPoint){d.isOptional||h.notConnectedNonOptionalInputs.push(d);continue}const m=d.connectedPoint.ownerBlock;m&&m!==this&&!m.isSystem&&m.build(h)}return this._customBuildStep(h),h.verbose&&r.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(h),this.onBuildObservable.notifyObservers(this),!1}serialize(){const h={};h.customType="BABYLON."+this.getClassName(),h.id=this.uniqueId,h.name=this.name,h.visibleOnFrame=this.visibleOnFrame,h.inputs=[],h.outputs=[];for(const d of this.inputs)h.inputs.push(d.serialize());for(const d of this.outputs)h.outputs.push(d.serialize(!1));return h}_deserialize(h){this._name=h.name,this.comments=h.comments,this.visibleOnFrame=!!h.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(h)}_deserializePortDisplayNamesAndExposedOnFrame(h){const d=h.inputs,m=h.outputs;if(d)for(const j of d){const h=this.inputs.find((h=>h.name===j.name));if(!h)return;if(j.displayName&&(h.displayName=j.displayName),j.isExposedOnFrame&&(h.isExposedOnFrame=j.isExposedOnFrame,h.exposedPortPosition=j.exposedPortPosition),void 0!==j.value&&null!==j.value)if("number"===j.valueType)h.value=j.value;else{const d=(0,a.e)(j.valueType);d&&(h.value=d.Ud(j.value))}}if(m)for(let j=0;j<m.length;j++){const h=m[j];h.displayName&&(this.outputs[j].displayName=h.displayName),h.isExposedOnFrame&&(this.outputs[j].isExposedOnFrame=h.isExposedOnFrame,this.outputs[j].exposedPortPosition=h.exposedPortPosition)}}clone(){const h=this.serialize(),d=(0,a.e)(h.customType);if(d){const m=new d;return m._deserialize(h),m}return null}dispose(){this.pd.notifyObservers(this),this.pd.clear();for(const h of this.inputs)h.dispose();for(const h of this.outputs)h.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ed(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",j=arguments.length>3?arguments[3]:void 0;return(A,b)=>{let w=A._propStore;w||(w=[],A._propStore=w),w.push({propertyName:b,displayName:h,type:d,groupName:m,options:j??{},className:A.getClassName()})}}(0,k.d)([(0,l.M)("comment")],pd.prototype,"comments",void 0),function(h){h[h.Boolean=0]="Boolean",h[h.Float=1]="Float",h[h.Int=2]="Int",h[h.Vector2=3]="Vector2",h[h.List=4]="List",h[h.Eb=5]="Eb",h[h.SamplingMode=6]="SamplingMode",h[h.TextureFormat=7]="TextureFormat",h[h.TextureType=8]="TextureType"}(Qd||(Qd={})),function(h){h[h.None=0]="None",h[h.Position=1]="Position",h[h.Direction=2]="Direction",h[h.Age=3]="Age",h[h.Lifetime=4]="Lifetime",h[h.Color=5]="Color",h[h.ScaledDirection=6]="ScaledDirection",h[h.Scale=7]="Scale",h[h.AgeGradient=8]="AgeGradient",h[h.Angle=9]="Angle",h[h.SpriteCellIndex=16]="SpriteCellIndex",h[h.SpriteCellStart=17]="SpriteCellStart",h[h.SpriteCellEnd=18]="SpriteCellEnd"}(td||(td={})),function(h){h[h.None=0]="None",h[h.Time=1]="Time",h[h.Delta=2]="Delta",h[h.Emitter=3]="Emitter"}(Ud||(Ud={}));class Xd{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let h="";for(const d of this.notConnectedNonOptionalInputs)h+=`input ${d.name} from block ${d.ownerBlock.name}[${d.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(h)throw"Build of Node Particle System Set failed:\n"+h}adapt(h,d){const m=h.getConnectedValue(this)||0;if(h.type===d)return m;switch(d){case rd.Vector2:return new j.h(m,m);case rd.Qd:return new j.i(m,m,m);case rd.Eb:return new w.f(m,m,m,m)}return null}getContextualValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case td.Position:return this.particleContext.position;case td.Direction:return this.particleContext.direction;case td.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case td.Color:return this.particleContext.color;case td.Age:return this.particleContext.age;case td.Lifetime:return this.particleContext.lifeTime;case td.Angle:return this.particleContext.angle;case td.Scale:return this.particleContext.scale;case td.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case td.SpriteCellEnd:return this.systemContext.endSpriteCellID;case td.SpriteCellIndex:return this.particleContext.cellIndex;case td.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case Ud.Time:return this.systemContext._actualFrame;case Ud.Delta:return this.systemContext._scaledUpdateSpeed;case Ud.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function zd(h,d,m){const j=new Xd;j.Fd=d;const A=h.createSystem(j);return A.canStart=()=>!0,A.k=m.clone(),A.disposeOnStop=!0,A.start(),A}class ud extends pd{constructor(h){super(h),this.blendMode=D.BLENDMODE_ONEONE,this.km=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",rd.Particle),this.registerInput("texture",rd.Texture),this.registerInput("onStart",rd.System,!0),this.registerInput("onEnd",rd.System,!0),this.registerOutput("system",rd.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(h){h.km=this.km,h.buildId=this._buildId++,this.build(h);const d=this.particle.getConnectedValue(h);return d.particleTexture=this.texture.getConnectedValue(h),d.emitRate=this.emitRate,d.blendMode=this.blendMode,d.name=this.name,d._nodeGenerated=!0,d._targetStopDuration=this.targetStopDuration,d.startDelay=this.startDelay,this.system._storedValue=this,d.canStart=()=>!this.doNoStart,d.onStartedObservable.add((m=>{const j=this.onStart.getConnectedValue(h);j&&m.onStartedObservable.addOnce((()=>{h.systemContext=d;const m=zd(j,h.Fd,h.emitterPosition);this.pd.addOnce((()=>{m.dispose()}))}));const A=this.onEnd.getConnectedValue(h);A&&m.onStoppedObservable.addOnce((()=>{h.systemContext=d;const m=zd(A,h.Fd,h.emitterPosition);this.pd.addOnce((()=>{m.dispose()}))}))})),this.pd.addOnce((()=>{d.dispose()})),d}serialize(){const h=super.serialize();return h.km=this.km,h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.doNoStart=this.doNoStart,h.targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,h}_deserialize(h){super._deserialize(h),this.km=h.km,this.emitRate=h.emitRate,this.doNoStart=!!h.doNoStart,void 0!==h.blendMode&&(this.blendMode=h.blendMode),void 0!==h.targetStopDuration&&(this.targetStopDuration=h.targetStopDuration),void 0!==h.startDelay&&(this.startDelay=h.startDelay)}}(0,k.d)([ed("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:D.BLENDMODE_ONEONE},{label:"Standard",value:D.BLENDMODE_STANDARD},{label:"Add",value:D.BLENDMODE_ADD},{label:"Multiply",value:D.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:D.BLENDMODE_MULTIPLYADD}]})],ud.prototype,"blendMode",void 0),(0,k.d)([ed("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],ud.prototype,"km",void 0),(0,k.d)([ed("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ud.prototype,"emitRate",void 0),(0,k.d)([ed("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ud.prototype,"targetStopDuration",void 0),(0,k.d)([ed("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ud.prototype,"startDelay",void 0),(0,k.d)([ed("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ud.prototype,"doNoStart",void 0),(0,a.i)("BABYLON.SystemBlock",ud);class Pd extends pd{get type(){if(this._type===rd.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=rd.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=rd.Vector2,this._type;case"Qd":return this._type=rd.Qd,this._type;case"Eb":return this._type=rd.Eb,this._type;case"Matrix":return this._type=rd.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===td.None&&this._systemSource!==Ud.None}get systemSource(){return this._systemSource}set systemSource(h){if(this._systemSource=h,h!==Ud.None){switch(this._contextualSource=td.None,this._type=rd.Float,h){case Ud.Time:case Ud.Delta:this._type=rd.Float;break;case Ud.Emitter:this._type=rd.Qd}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==td.None}get contextualValue(){return this._contextualSource}set contextualValue(h){if(this._contextualSource=h,h!==td.None){switch(this._systemSource=Ud.None,h){case td.Scale:this._type=rd.Vector2;break;case td.Position:case td.Direction:case td.ScaledDirection:this._type=rd.Qd;break;case td.Color:this._type=rd.Eb;break;case td.Age:case td.Lifetime:case td.Angle:case td.AgeGradient:this._type=rd.Float;break;case td.SpriteCellEnd:case td.SpriteCellStart:case td.SpriteCellIndex:this._type=rd.Int}this.output&&(this.output.type=this._type)}}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rd.AutoDetect;super(h),this._type=rd.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new z.e,this._systemSource=Ud.None,this._contextualSource=td.None,this._type=d,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",d)}get value(){return this._storedValue}set value(h){this.type===rd.Float&&this.min!==this.max&&(h=Math.max(this.min,h),h=Math.min(this.max,h)),this._storedValue=h,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(h){this._valueCallback=h}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case rd.Int:case rd.Float:this.value=0;break;case rd.Vector2:this.value=j.h.Zero();break;case rd.Qd:this.value=j.i.Zero();break;case rd.Eb:this.value=new w.f(1,1,1,1);break;case rd.Matrix:this.value=j.b.Identity()}}_build(h){super._build(h),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=h=>h.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=h=>h.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const h=super.serialize();return h.type=this.type,h.contextualValue=this.contextualValue,h.systemSource=this.systemSource,h.min=this.min,h.max=this.max,h.groupInInspector=this.groupInInspector,h.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.fd?(h.valueType="BABYLON."+this._storedValue.getClassName(),h.value=this._storedValue.fd()):(h.valueType="number",h.value=this._storedValue)),h}_deserialize(h){if(super._deserialize(h),this._type=h.type,this.contextualValue=h.contextualValue,this.systemSource=h.systemSource||Ud.None,this.min=h.min||0,this.max=h.max||0,this.groupInInspector=h.groupInInspector||"",void 0!==h.displayInInspector&&(this.displayInInspector=h.displayInInspector),h.valueType)if("number"===h.valueType)this._storedValue=h.value;else{const d=(0,a.e)(h.valueType);d&&(this._storedValue=d.Ud(h.value))}}}(0,a.i)("BABYLON.ParticleInputBlock",Pd);class Gd extends pd{get url(){return this._url}set url(h){this._url!==h&&(this._cachedData=null,this._url=h,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(h){this._textureDataUrl!==h&&(this._cachedData=null,this._textureDataUrl=h,this._url="",this._sourceTexture=null)}set sourceTexture(h){this._sourceTexture!==h&&(this._cachedData=null,this._sourceTexture=h,this._url="",this._textureDataUrl="")}constructor(h){super(h),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",rd.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const h=this.texture._storedValue;return await new Promise(((d,m)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),d(this._cachedData)}catch(h){m(h)}}));const j=h.getSize();kd.j.GetTextureDataAsync(h,j.width,j.height).then((m=>{this._cachedData={width:j.width,height:j.height,data:new Uint8ClampedArray(m)},h.dispose(),d(this._cachedData)})).catch(m)}))}_build(h){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new N.e(this._textureDataUrl,h.Fd):this.texture._storedValue=new N.e(this._url,h.Fd):this.texture._storedValue=null}serialize(){const h=super.serialize();return h.url=this.url,h.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(h.textureDataUrl=this.textureDataUrl),h}_deserialize(h){super._deserialize(h),this.url=h.url,this.serializedCachedData=!!h.serializedCachedData,h.textureDataUrl&&(this.textureDataUrl=h.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,a.i)("BABYLON.ParticleTextureSourceBlock",Gd);class hm extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("position",rd.Qd),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.position.isConnected)return;const m={process:m=>{h.particleContext=m,h.systemContext=d,m.position.D(this.position.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m}}(0,a.i)("BABYLON.UpdatePositionBlock",hm),function(h){h[h.Add=0]="Add",h[h.Subtract=1]="Subtract",h[h.Multiply=2]="Multiply",h[h.Divide=3]="Divide",h[h.Max=4]="Max",h[h.Min=5]="Min"}(sd||(sd={}));class dm extends pd{constructor(h){super(h),this.operation=sd.Add,this.registerInput("left",rd.AutoDetect),this.registerInput("right",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this.output._typeConnectionSource=this.left;const d=[rd.Matrix,rd.Particle,rd.Texture,rd.System,rd.FloatGradient,rd.Color4Gradient,rd.Vector2Gradient,rd.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...d),this.right.excludedConnectionPointTypes.push(...d),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(h){let d;const m=this.left,A=this.right;if(!m.isConnected||!A.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const b=m.type===rd.Float||m.type===rd.Int,a=A.type===rd.Float||A.type===rd.Int,D=b&&a;switch(this.operation){case sd.Add:d=D?h=>m.getConnectedValue(h)+A.getConnectedValue(h):b?h=>h.adapt(m,A.type).add(A.getConnectedValue(h)):h=>m.getConnectedValue(h).add(h.adapt(A,m.type));break;case sd.Subtract:d=D?h=>m.getConnectedValue(h)-A.getConnectedValue(h):b?h=>h.adapt(m,A.type).fm(A.getConnectedValue(h)):h=>m.getConnectedValue(h).fm(h.adapt(A,m.type));break;case sd.Multiply:d=D?h=>m.getConnectedValue(h)*A.getConnectedValue(h):b?h=>h.adapt(m,A.type).multiply(A.getConnectedValue(h)):h=>m.getConnectedValue(h).multiply(h.adapt(A,m.type));break;case sd.Divide:d=D?h=>m.getConnectedValue(h)/A.getConnectedValue(h):b?h=>h.adapt(m,A.type).divide(A.getConnectedValue(h)):h=>m.getConnectedValue(h).divide(h.adapt(A,m.type));break;case sd.Min:if(D)d=h=>Math.min(m.getConnectedValue(h),A.getConnectedValue(h));else{const[h,a]=b?[A,m]:[m,A];switch(h.type){case rd.Vector2:d=d=>j.h.Minimize(h.getConnectedValue(d),d.adapt(a,h.type));break;case rd.Qd:d=d=>j.i.Minimize(h.getConnectedValue(d),d.adapt(a,h.type));break;case rd.Eb:d=d=>{const m=h.getConnectedValue(d),{r:j,g:A,b:b,a:D}=d.adapt(a,h.type);return new w.f(Math.min(m.r,j),Math.min(m.g,A),Math.min(m.b,b),Math.min(m.a,D))}}}break;case sd.Max:if(!D){const[h,a]=b?[A,m]:[m,A];switch(h.type){case rd.Vector2:d=d=>j.h.Maximize(h.getConnectedValue(d),d.adapt(a,h.type));break;case rd.Qd:d=d=>j.i.Maximize(h.getConnectedValue(d),d.adapt(a,h.type));break;case rd.Eb:d=d=>{const m=h.getConnectedValue(d),{r:j,g:A,b:b,a:D}=d.adapt(a,h.type);return new w.f(Math.max(m.r,j),Math.min(m.g,A),Math.min(m.b,b),Math.min(m.a,D))}}break}d=h=>Math.max(m.getConnectedValue(h),A.getConnectedValue(h))}this.output._storedFunction=h=>m.type===rd.Int?0|d(h):d(h)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===rd.Int||this.left.type===rd.Float&&this.right.type!==rd.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[h,d]of[[this.left,this.right],[this.right,this.left]])h.acceptedConnectionPointTypes=[rd.Int,rd.Float],d.isConnected&&(h.acceptedConnectionPointTypes.push(d.type),d.type!==rd.Int&&d.type!==rd.Float||h.acceptedConnectionPointTypes.push(rd.Vector2,rd.Qd,rd.Eb))}dispose(){super.dispose();for(const h of this._connectionObservers)h.remove();this._connectionObservers.length=0}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,k.d)([ed("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:sd.Add},{label:"Subtract",value:sd.Subtract},{label:"Multiply",value:sd.Multiply},{label:"Divide",value:sd.Divide},{label:"Max",value:sd.Max},{label:"Min",value:sd.Min}]})],dm.prototype,"operation",void 0),(0,a.i)("BABYLON.ParticleMathBlock",dm);class mm extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("direction1",rd.Qd,!0,new j.i(0,1,0)),this.registerInput("direction2",rd.Qd,!0,new j.i(0,1,0)),this.registerInput("minEmitBox",rd.Qd,!0,new j.i(-.5,-.5,-.5)),this.registerInput("maxEmitBox",rd.Qd,!0,new j.i(.5,.5,.5)),this.registerOutput("output",rd.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.direction1.getConnectedValue(h),b=this.direction2.getConnectedValue(h),w=(0,S.RandomRange)(A.x,b.x),a=(0,S.RandomRange)(A.y,b.y),D=(0,S.RandomRange)(A.z,b.z);h.isEmitterTransformNode?j.i.TransformNormalFromFloatsToRef(w,a,D,h.emitterWorldMatrix,m.direction):m.direction.xd(w,a,D)},d._positionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.minEmitBox.getConnectedValue(h),b=this.maxEmitBox.getConnectedValue(h),w=(0,S.RandomRange)(A.x,b.x),a=(0,S.RandomRange)(A.y,b.y),D=(0,S.RandomRange)(A.z,b.z);h.isEmitterTransformNode?j.i.TransformCoordinatesFromFloatsToRef(w,a,D,h.emitterWorldMatrix,m.position):(m.position.xd(w,a,D),m.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}}(0,a.i)("BABYLON.BoxShapeBlock",mm);class jm extends pd{constructor(h){super(h),this.registerInput("emitPower",rd.Float,!0,1),this.registerInput("lifeTime",rd.Float,!0,1),this.registerInput("color",rd.Eb,!0,new w.f(1,1,1,1)),this.registerInput("scale",rd.Vector2,!0,new j.h(1,1)),this.registerInput("angle",rd.Float,!0,0),this.registerOutput("particle",rd.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(h){const d=new ad(this.name,h.km,h.Fd,null,!1,void 0,!0);d.particleEmitterType=new B,d._lifeTimeCreation.process=(d,m)=>{h.particleContext=d,d.lifeTime=this.lifeTime.getConnectedValue(h),m._emitPower=this.emitPower.getConnectedValue(h)},d._colorCreation.process=d=>{h.particleContext=d,d.color.D(this.color.getConnectedValue(h))},d._sizeCreation.process=d=>{h.particleContext=d,d.size=1,d.scale.D(this.scale.getConnectedValue(h))},d._angleCreation.process=d=>{h.particleContext=d,d.angle=this.angle.getConnectedValue(h)},this.particle._storedValue=d}}(0,a.i)("BABYLON.CreateParticleBlock",jm);class Am{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const h=[];for(const d of this.attachedBlocks)d.isInput&&h.push(d);return h}constructor(h){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new z.e,this.name=h}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(h)&&this.attachedBlocks.push(h);for(const m of h.inputs){const j=m.connectedPoint;if(j){const m=j.ownerBlock;m!==h&&this._initializeBlock(m,d)}}}async buildAsync(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((m=>{const j=new yd;for(const h of this._systemBlocks)this._initializeBlock(h);for(const A of this.systemBlocks){const m=new Xd;m.buildId=this._buildId++,m.Fd=h,m.verbose=d;const b=A.createSystem(m);m.emitErrors(),j.systems.push(b)}this.onBuildObservable.notifyObservers(this),m(j)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const h=new ud("Particle system"),d=new hm("Update position");d.output.connectTo(h.particle);const m=new Pd("Position");m.contextualValue=td.Position;const j=new Pd("Scaled direction");j.contextualValue=td.ScaledDirection;const A=new dm("Add");A.operation=sd.Add,m.output.connectTo(A.left),j.output.connectTo(A.right),A.output.connectTo(d.position);const b=new jm("Create particle"),w=new mm("Box shape");b.particle.connectTo(w.particle),w.output.connectTo(d.particle);const a=new Gd("Texture");a.texture.connectTo(h.texture),a.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(h)}removeBlock(h){const d=this.attachedBlocks.indexOf(h);if(d>-1&&this.attachedBlocks.splice(d,1),h.isSystem){const d=this._systemBlocks.indexOf(h);d>-1&&this._systemBlocks.splice(d,1)}}parseSerializedObject(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d||this.clear();const m={};for(const j of h.iM){const h=(0,a.e)(j.customType);if(h){const d=new h;d._deserialize(j),m[j.id]=d,this.attachedBlocks.push(d),d.isSystem&&this._systemBlocks.push(d)}}for(const j of this.attachedBlocks)if(j.isTeleportOut){const h=j,d=h._tempEntryPointUniqueId;if(d){const j=m[d];j&&j.attachToEndpoint(h)}}for(let j=0;j<h.iM.length;j++){const A=h.iM[j],b=m[A.id];b&&(b.inputs.length&&A.inputs.some((h=>h.targetConnectionName))&&!d||this._restoreConnections(b,h,m))}if(h.locations||h.editorData&&h.editorData.locations){const j=h.locations||h.editorData.locations;for(const h of j)m[h.dj]&&(h.dj=m[h.dj].uniqueId);d&&this.editorData&&this.editorData.locations&&j.concat(this.editorData.locations),h.locations?this.editorData={locations:j}:(this.editorData=h.editorData,this.editorData.locations=j);const A=[];for(const h in m)A[h]=m[h].uniqueId;this.editorData.map=A}this.comment=h.comment}_restoreConnections(h,d,m){for(const j of h.outputs)for(const A of d.iM){const b=m[A.id];if(b)for(const w of A.inputs)if(m[w.targetBlockId]!==h||w.targetConnectionName!==j.name);else{const h=b.getInputByName(w.inputName);if(!h||h.isConnected)continue;j.connectTo(h,!0),this._restoreConnections(b,d,m)}}}serialize(h){const d=h?{}:K.d.Serialize(this);d.editorData=JSON.parse(JSON.stringify(this.editorData));let m=[];h?m=h:d.customType="BABYLON.NodeParticleSystemSet",d.iM=[];for(const j of m)d.iM.push(j.serialize());if(!h)for(const j of this.attachedBlocks)-1===m.indexOf(j)&&d.iM.push(j.serialize());return d}dispose(){for(const h of this.attachedBlocks)h.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(h){const d=new Am(h);return d.setToDefault(),d}static Parse(h){const d=K.d.Parse((()=>new Am(h.name)),h,null);return d.parseSerializedObject(h),d}static ParseFromSnippetAsync(h,d){return"_BLANK"===h?Promise.resolve(Am.CreateDefault("blank")):new Promise(((m,j)=>{const A=new id.c;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const w=JSON.parse(JSON.parse(A.responseText).jsonPayload),a=JSON.parse(w.nodeParticle);d||(d=K.d.Parse((()=>new Am(h)),a,null)),d.parseSerializedObject(a),d.snippetId=h;try{m(d)}catch(b){j(b)}}else j("Unable to load the snippet "+h)})),A.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),A.send()}))}}Am.EditorURL=`${Cd.e._DefaultCdnUrl}/v${eh.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Am.SnippetUrl="https://snippet.babylonjs.com",(0,k.d)([(0,l.M)()],Am.prototype,"name",void 0),(0,k.d)([(0,l.M)("comment")],Am.prototype,"comment",void 0),function(h){h[h.None=0]="None",h[h.PerParticle=1]="PerParticle",h[h.PerSystem=2]="PerSystem"}(Jd||(Jd={}));class bm extends pd{constructor(h){super(h),this._currentLockId=-2,this.lockMode=Jd.PerParticle,this.registerInput("min",rd.AutoDetect,!0,0),this.registerInput("max",rd.AutoDetect,!0,1),this.registerOutput("output",rd.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rd.Float|rd.Int|rd.Vector2|rd.Qd|rd.Eb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(rd.Float|rd.Int|rd.Vector2|rd.Qd|rd.Eb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=rd.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case rd.AutoDetect:case rd.Int:case rd.Float:h=h=>{const d=this.min.getConnectedValue(h)||0,m=this.max.getConnectedValue(h)||1;return d+Math.random()*(m-d)};break;case rd.Vector2:h=h=>{const d=this.min.getConnectedValue(h)||j.h.Zero(),m=this.max.getConnectedValue(h)||j.h.One();return new j.h(d.x+Math.random()*(m.x-d.x),d.y+Math.random()*(m.y-d.y))};break;case rd.Qd:h=h=>{const d=this.min.getConnectedValue(h)||j.i.Zero(),m=this.max.getConnectedValue(h)||j.i.One();return new j.i(d.x+Math.random()*(m.x-d.x),d.y+Math.random()*(m.y-d.y),d.z+Math.random()*(m.z-d.z))};break;case rd.Eb:h=h=>{const d=this.min.getConnectedValue(h)||new w.f(0,0,0,0),m=this.max.getConnectedValue(h)||new w.f(1,1,1,1);return new w.f(d.x+Math.random()*(m.x-d.x),d.y+Math.random()*(m.y-d.y),d.z+Math.random()*(m.z-d.z),d.w+Math.random()*(m.w-d.w))}}this.output._storedFunction=d=>{var m;let j=0;switch(this.lockMode){case Jd.PerParticle:j=(null===(m=d.particleContext)||void 0===m?void 0:m.id)||-1;break;case Jd.PerSystem:j=d.buildId||0}return this._currentLockId!==j&&(this.lockMode!==Jd.None&&(this._currentLockId=j),this.output._storedValue=h(d)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),this.lockMode=h.lockMode}}(0,k.d)([ed("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Jd.None},{label:"Per particle",value:Jd.PerParticle},{label:"Per system",value:Jd.PerSystem}]})],bm.prototype,"lockMode",void 0),(0,a.i)("BABYLON.ParticleRandomBlock",bm);class wm extends pd{constructor(h){super(h),this._currentLockId=-2,this.lockMode=Jd.PerParticle,this.registerInput("min",rd.AutoDetect),this.registerInput("max",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const d=[rd.Matrix,rd.Particle,rd.Texture,rd.System,rd.FloatGradient,rd.Color4Gradient,rd.Vector2Gradient,rd.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...d),this.max.excludedConnectionPointTypes.push(...d)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case rd.Float:case rd.Int:h=h=>{const d=this.min.getConnectedValue(h),m=this.max.getConnectedValue(h);return Math.random()*(m-d)+d};break;case rd.Vector2:h=h=>{const d=this.min.getConnectedValue(h),m=this.max.getConnectedValue(h);return new j.h(Math.random()*(m.x-d.x)+d.x,Math.random()*(m.y-d.y)+d.y)};break;case rd.Qd:h=h=>{const d=this.min.getConnectedValue(h),m=this.max.getConnectedValue(h);return new j.i(Math.random()*(m.x-d.x)+d.x,Math.random()*(m.y-d.y)+d.y,Math.random()*(m.z-d.z)+d.z)};break;case rd.Eb:h=h=>{const d=this.min.getConnectedValue(h),m=this.max.getConnectedValue(h);return new w.f(Math.random()*(m.r-d.r)+d.r,Math.random()*(m.g-d.g)+d.g,Math.random()*(m.b-d.b)+d.b,Math.random()*(m.a-d.a)+d.a)}}this.output._storedFunction=d=>{var m;let j=0;switch(this.lockMode){case Jd.PerParticle:j=(null===(m=d.particleContext)||void 0===m?void 0:m.id)||-1;break;case Jd.PerSystem:j=d.buildId||0}return this._currentLockId!==j&&(this.lockMode!==Jd.None&&(this._currentLockId=j),this.output._storedValue=h(d)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),void 0!==h.lockMode&&(this.lockMode=h.lockMode)}}(0,k.d)([ed("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Jd.None},{label:"Per particle",value:Jd.PerParticle},{label:"Per system",value:Jd.PerSystem}]})],wm.prototype,"lockMode",void 0),(0,a.i)("BABYLON.RandomRangeBlock",wm);(0,a.i)("BABYLON.ParticleLerpBlock",class extends pd{constructor(h){super(h),this.registerInput("left",rd.AutoDetect),this.registerInput("right",rd.AutoDetect),this.registerInput("gradient",rd.Float,!0,0,0,1),this.registerOutput("output",rd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rd.Float|rd.Int|rd.Vector2|rd.Qd|rd.Eb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=(h,d,m)=>(1-h)*d+h*m;this.output._storedFunction=d=>{const m=this.left.getConnectedValue(d),A=this.right.getConnectedValue(d),b=this.gradient.getConnectedValue(d);switch(this.left.type){case rd.Int:case rd.Float:return h(b,m,A);case rd.Vector2:return new j.h(h(b,m.x,A.x),h(b,m.y,A.y));case rd.Qd:return new j.i(h(b,m.x,A.x),h(b,m.y,A.y),h(b,m.z,A.z));case rd.Eb:return new w.f(h(b,m.r,A.r),h(b,m.g,A.g),h(b,m.b,A.b),h(b,m.a,A.a))}return 0}}});(0,a.i)("BABYLON.UpdateDirectionBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("direction",rd.Qd),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.direction.isConnected)return;const m={process:m=>{h.particleContext=m,h.systemContext=d,m.direction.D(this.direction.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m}});(0,a.i)("BABYLON.UpdateColorBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("color",rd.Eb),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.color.isConnected)return;const m={process:m=>{h.particleContext=m,h.systemContext=d,m.color.D(this.color.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m}});(0,a.i)("BABYLON.UpdateScaleBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("scale",rd.Vector2),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.scale.isConnected)return;const m={process:m=>{h.particleContext=m,h.systemContext=d,m.scale.D(this.scale.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m}});(0,a.i)("BABYLON.UpdateAngleBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("angle",rd.Float),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.angle.isConnected)return;const m={process:m=>{h.particleContext=m,h.systemContext=d,m.angle=this.angle.getConnectedValue(h)},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m}});(0,a.i)("BABYLON.BasicPositionUpdateBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(h){const d=this.particle.getConnectedValue(h),m={process:m=>{h.particleContext=m,h.systemContext=d,m.direction.scaleToRef(d._directionScale,d._scaledDirection),m.position.addInPlace(d._scaledDirection)},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m,this.output._storedValue=d}});(0,a.i)("BABYLON.BasicSpriteUpdateBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(h){const d=this.particle.getConnectedValue(h),m={process:m=>{h.particleContext=m,h.systemContext=d,m.updateCellIndex()},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m,this.output._storedValue=d}});(0,a.i)("BABYLON.UpdateSpriteCellIndexBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("cellIndex",rd.Int),this.registerOutput("output",rd.Particle),this.cellIndex.acceptedConnectionPointTypes=[rd.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.cellIndex.isConnected)return;const m={process:m=>{h.particleContext=m,h.systemContext=d,m.cellIndex=Math.floor(this.cellIndex.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m}});class am extends pd{constructor(h){super(h),this.strength=1,this.registerInput("particle",rd.Particle),this.registerInput("flowMap",rd.Texture),this.registerOutput("output",rd.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(h){var d;const m=this.particle.getConnectedValue(h),j=h.Fd;let A;(null===(d=this.flowMap.connectedPoint)||void 0===d?void 0:d.ownerBlock).extractTextureContentAsync().then((h=>{h&&(A=new Wd(h.width,h.height,h.data))}));const b={process:h=>{const d=j.getTransformMatrix();A&&A._processParticle(h,this.strength*m._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null};m._updateQueueStart?Uh(b,m._updateQueueStart):m._updateQueueStart=b,this.output._storedValue=m}serialize(){const h=super.serialize();return h.strength=this.strength,h}_deserialize(h){super._deserialize(h),this.strength=h.strength}}(0,k.d)([ed("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],am.prototype,"strength",void 0),(0,a.i)("BABYLON.UpdateFlowMapBlock",am);(0,a.i)("BABYLON.SphereShapeBlock",class extends pd{constructor(h){super(h),this.registerInput("input",rd.Particle),this.registerInput("radius",rd.Float,!0,1),this.registerInput("radiusRange",rd.Float,!0,1,0,1),this.registerInput("directionRandomizer",rd.Float,!0,0,0,1),this.registerOutput("output",rd.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(h){const d=this.input.getConnectedValue(h);d._directionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.directionRandomizer.getConnectedValue(h),b=m.position.fm(h.emitterPosition).normalize(),w=(0,S.RandomRange)(0,A),a=(0,S.RandomRange)(0,A),D=(0,S.RandomRange)(0,A);b.x+=w,b.y+=a,b.z+=D,b.normalize(),h.isEmitterTransformNode?j.i.TransformNormalFromFloatsToRef(w,a,D,h.emitterWorldMatrix,m.direction):m.direction.xd(w,a,D)},d._positionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.radius.getConnectedValue(h),b=this.radiusRange.getConnectedValue(h),w=A-(0,S.RandomRange)(0,A*b),a=(0,S.RandomRange)(0,1),D=(0,S.RandomRange)(0,2*Math.PI),M=Math.acos(2*a-1),q=w*Math.cos(D)*Math.sin(M),E=w*Math.cos(M),I=w*Math.sin(D)*Math.sin(M);h.isEmitterTransformNode?j.i.TransformCoordinatesFromFloatsToRef(q,E,I,h.emitterWorldMatrix,m.position):(m.position.xd(q,E,I),m.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}});(0,a.i)("BABYLON.PointShapeBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("direction1",rd.Qd,!0,new j.i(0,1,0)),this.registerInput("direction2",rd.Qd,!0,new j.i(0,1,0)),this.registerOutput("output",rd.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.direction1.getConnectedValue(h),b=this.direction2.getConnectedValue(h),w=(0,S.RandomRange)(A.x,b.x),a=(0,S.RandomRange)(A.y,b.y),D=(0,S.RandomRange)(A.z,b.z);h.isEmitterTransformNode?j.i.TransformNormalFromFloatsToRef(w,a,D,h.emitterWorldMatrix,m.direction):m.direction.xd(w,a,D)},d._positionCreation.process=m=>{h.systemContext=d,h.isEmitterTransformNode?j.i.TransformCoordinatesFromFloatsToRef(0,0,0,h.emitterWorldMatrix,m.position):m.position.D(h.emitterPosition)},this.output._storedValue=d}});(0,a.i)("BABYLON.CustomShapeBlock",class extends pd{constructor(h){super(h),this.registerInput("particle",rd.Particle),this.registerInput("position",rd.Qd,!0,new j.i(0,0,0)),this.registerInput("direction",rd.Qd,!0,new j.i(0,1,0)),this.registerOutput("output",rd.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.direction.getConnectedValue(h);h.isEmitterTransformNode?j.i.TransformNormalToRef(A,h.emitterWorldMatrix,m.direction):m.direction.D(A)},d._positionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.position.getConnectedValue(h);h.isEmitterTransformNode?j.i.TransformCoordinatesToRef(A,h.emitterWorldMatrix,m.position):(m.position.D(A),m.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}});(0,a.i)("BABYLON.CylinderShapeBlock",class extends pd{constructor(h){super(h),this._tempVector=j.i.Zero(),this.registerInput("particle",rd.Particle),this.registerInput("radius",rd.Float,!0,1),this.registerInput("height",rd.Float,!0,1,0),this.registerInput("radiusRange",rd.Float,!0,1,0,1),this.registerInput("directionRandomizer",rd.Float,!0,0,0,1),this.registerOutput("output",rd.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.directionRandomizer.getConnectedValue(h);m.position.subtractToRef(h.emitterPosition,this._tempVector),this._tempVector.normalize(),h.isEmitterTransformNode&&j.i.TransformNormalToRef(this._tempVector,h.emitterInverseWorldMatrix,this._tempVector);const b=(0,S.RandomRange)(-A/2,A/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*A,this._tempVector.y=b,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),h.isEmitterTransformNode?j.i.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h.emitterWorldMatrix,m.direction):m.direction.D(this._tempVector)},d._positionCreation.process=m=>{h.particleContext=m,h.systemContext=d;const A=this.height.getConnectedValue(h),b=this.radiusRange.getConnectedValue(h),w=this.radius.getConnectedValue(h),a=(0,S.RandomRange)(-A/2,A/2),D=(0,S.RandomRange)(0,2*Math.PI),M=(0,S.RandomRange)((1-b)*(1-b),1),q=Math.sqrt(M)*w,E=q*Math.cos(D),I=q*Math.sin(D);h.isEmitterTransformNode?j.i.TransformCoordinatesFromFloatsToRef(E,a,I,h.emitterWorldMatrix,m.position):(m.position.xd(E,a,I),m.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}});class Dm extends pd{constructor(h){super(h),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",rd.Particle),this.registerOutput("output",rd.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const d=this.particle.getConnectedValue(h);d._isAnimationSheetEnabled=!0,d.spriteCellWidth=this.width,d.spriteCellHeight=this.height,d.startSpriteCellID=this.start,d.endSpriteCellID=this.end,d.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=d}serialize(){const h=super.serialize();return h.width=this.width,h.height=this.height,h.start=this.start,h.end=this.end,h.randomStartCell=this.randomStartCell,h}_deserialize(h){super._deserialize(h),this.width=h.width,this.height=h.height,this.start=h.start,this.end=h.end,this.randomStartCell=h.randomStartCell}}(0,k.d)([ed("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Dm.prototype,"start",void 0),(0,k.d)([ed("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Dm.prototype,"end",void 0),(0,k.d)([ed("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Dm.prototype,"width",void 0),(0,k.d)([ed("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Dm.prototype,"height",void 0),(0,k.d)([ed("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Dm.prototype,"loop",void 0),(0,k.d)([ed("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Dm.prototype,"randomStartCell",void 0),(0,a.i)("BABYLON.SetupSpriteSheetBlock",Dm);class Sm extends pd{constructor(h){super(h),this.reference=0,this.registerInput("value",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case rd.Float:return rd.FloatGradient;case rd.Vector2:return rd.Vector2Gradient;case rd.Qd:return rd.Vector3Gradient;case rd.Eb:return rd.Color4Gradient}return h},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rd.Float|rd.Vector2|rd.Qd|rd.Eb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=h=>null}serialize(){const h=super.serialize();return h.reference=this.reference,h}_deserialize(h){super._deserialize(h),this.reference=h.reference}}(0,k.d)([ed("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Sm.prototype,"reference",void 0),(0,a.i)("BABYLON.ParticleGradientValueBlock",Sm);(0,a.i)("BABYLON.ParticleGradientBlock",class extends pd{constructor(h){super(h),this._entryCount=1,this.registerInput("gradient",rd.Float,!0,1,0,1),this.registerInput("value0",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case rd.FloatGradient:return rd.Float;case rd.Vector2Gradient:return rd.Vector2;case rd.Vector3Gradient:return rd.Qd;case rd.Color4Gradient:return rd.Eb}return h},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(rd.FloatGradient|rd.Vector2Gradient|rd.Vector3Gradient|rd.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(h){this._inputs[h].onConnectionObservable.add((()=>{this._entryCount>h||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),rd.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const h=[];for(let m=1;m<this._inputs.length;m++){var d;if(this._inputs[m].isConnected)h.push(null===(d=this._inputs[m].connectedPoint)||void 0===d?void 0:d.ownerBlock)}h.sort(((h,d)=>h.reference-d.reference)),this.output._storedFunction=d=>{const m=this.gradient.getConnectedValue(d);if(1===h.length)return h[0].value.getConnectedValue(d);let A=null;for(let b=h.length-1;b>=0;b--){const a=h[b];if(a.reference<=m){const h=a.value.getConnectedValue(d);if(A){const b=A.value.getConnectedValue(d),D=A.reference,M=a.reference,q=Math.max(0,Math.min(1,(m-M)/(D-M)));switch(this.output.type){case rd.Float:return(0,S.Lerp)(h,b,q);case rd.Vector2:return j.h.Lerp(h,b,q);case rd.Qd:return j.i.Lerp(h,b,q);case rd.Eb:return w.f.Lerp(h,b,q)}}return h}A=a}return 0}}});(0,a.i)("BABYLON.ParticleConverterBlock",class extends pd{constructor(h){super(h),this.registerInput("color ",rd.Eb,!0),this.registerInput("xyz ",rd.Qd,!0),this.registerInput("xy ",rd.Vector2,!0),this.registerInput("zw ",rd.Vector2,!0),this.registerInput("x ",rd.Float,!0),this.registerInput("y ",rd.Float,!0),this.registerInput("z ",rd.Float,!0),this.registerInput("w ",rd.Float,!0),this.registerOutput("color",rd.Eb),this.registerOutput("xyz",rd.Qd),this.registerOutput("xy",rd.Vector2),this.registerOutput("zw",rd.Vector2),this.registerOutput("x",rd.Float),this.registerOutput("y",rd.Float),this.registerOutput("z",rd.Float),this.registerOutput("w",rd.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(h){return"color "===h?"colorIn":"xyz "===h?"xyzIn":"xy "===h?"xyIn":"zw "===h?"zwIn":"x "===h?"xIn":"y "===h?"yIn":"z "===h?"zIn":"w "===h?"wIn":h}_outputRename(h){switch(h){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return h}}_build(h){super._build(h);const d=this.xIn,m=this.yIn,A=this.zIn,b=this.wIn,a=this.xyIn,D=this.zwIn,S=this.xyzIn,M=this.colorIn,q=this.colorOut,E=this.xyzOut,I=this.xyOut,R=this.zwOut,Z=this.xOut,L=this.yOut,B=this.zOut,V=this.wOut,v=h=>{if(M.isConnected)return M.getConnectedValue(h);let j=0,q=0,E=0,I=0;if(d.isConnected&&(j=d.getConnectedValue(h)),m.isConnected&&(q=m.getConnectedValue(h)),A.isConnected&&(E=A.getConnectedValue(h)),b.isConnected&&(I=b.getConnectedValue(h)),a.isConnected){const d=a.getConnectedValue(h);d&&(j=d.x,q=d.y)}if(D.isConnected){const d=D.getConnectedValue(h);d&&(E=d.x,I=d.y)}if(S.isConnected){const d=S.getConnectedValue(h);d&&(j=d.x,q=d.y,E=d.z)}return new w.f(j,q,E,I)};q._storedFunction=h=>v(h),E._storedFunction=h=>{const d=v(h);return new j.i(d.r,d.g,d.b)},I._storedFunction=h=>{const d=v(h);return new j.h(d.r,d.g)},R._storedFunction=h=>{const d=v(h);return new j.h(d.b,d.a)},Z._storedFunction=h=>v(h).r,L._storedFunction=h=>v(h).g,B._storedFunction=h=>v(h).b,V._storedFunction=h=>v(h).a}}),function(h){h[h.Cos=0]="Cos",h[h.Sin=1]="Sin",h[h.Abs=2]="Abs",h[h.Exp=3]="Exp",h[h.Exp2=4]="Exp2",h[h.Round=5]="Round",h[h.Floor=6]="Floor",h[h.Ceiling=7]="Ceiling",h[h.Sqrt=8]="Sqrt",h[h.Log=9]="Log",h[h.Tan=10]="Tan",h[h.ArcTan=11]="ArcTan",h[h.ArcCos=12]="ArcCos",h[h.ArcSin=13]="ArcSin",h[h.Sign=14]="Sign",h[h.Negate=15]="Negate",h[h.OneMinus=16]="OneMinus",h[h.Reciprocal=17]="Reciprocal",h[h.ToDegrees=18]="ToDegrees",h[h.ToRadians=19]="ToRadians",h[h.Fract=20]="Fract"}(Od||(Od={}));class Mm extends pd{constructor(h){super(h),this.operation=Od.Cos,this.registerInput("input",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rd.Float|rd.Int|rd.Vector2|rd.Qd|rd.Eb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);let d=null;switch(this.operation){case Od.Cos:d=h=>Math.cos(h);break;case Od.Sin:d=h=>Math.sin(h);break;case Od.Abs:d=h=>Math.abs(h);break;case Od.Exp:d=h=>Math.exp(h);break;case Od.Exp2:d=h=>Math.pow(2,h);break;case Od.Round:d=h=>Math.round(h);break;case Od.Floor:d=h=>Math.floor(h);break;case Od.Ceiling:d=h=>Math.ceil(h);break;case Od.Sqrt:d=h=>Math.sqrt(h);break;case Od.Log:d=h=>Math.log(h);break;case Od.Tan:d=h=>Math.tan(h);break;case Od.ArcTan:d=h=>Math.atan(h);break;case Od.ArcCos:d=h=>Math.acos(h);break;case Od.ArcSin:d=h=>Math.asin(h);break;case Od.Sign:d=h=>Math.sign(h);break;case Od.Negate:d=h=>-h;break;case Od.OneMinus:d=h=>1-h;break;case Od.Reciprocal:d=h=>1/h;break;case Od.ToRadians:d=h=>h*Math.PI/180;break;case Od.ToDegrees:d=h=>180*h/Math.PI;break;case Od.Fract:d=h=>h>=0?h-Math.floor(h):h-Math.ceil(h)}if(!d)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case rd.Int:case rd.Float:this.output._storedFunction=h=>{const m=this.input.getConnectedValue(h);return d(m)};break;case rd.Vector2:this.output._storedFunction=h=>{const m=this.input.getConnectedValue(h);return new j.h(d(m.x),d(m.y))};break;case rd.Qd:this.output._storedFunction=h=>{const m=this.input.getConnectedValue(h);return new j.i(d(m.x),d(m.y),d(m.z))};break;case rd.Eb:this.output._storedFunction=h=>{const m=this.input.getConnectedValue(h);return new w.f(d(m.r),d(m.g),d(m.b),d(m.a))}}return this}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,k.d)([ed("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Od.Cos},{label:"Sin",value:Od.Sin},{label:"Abs",value:Od.Abs},{label:"Exp",value:Od.Exp},{label:"Exp2",value:Od.Exp2},{label:"Round",value:Od.Round},{label:"Floor",value:Od.Floor},{label:"Ceiling",value:Od.Ceiling},{label:"Sqrt",value:Od.Sqrt},{label:"Log",value:Od.Log},{label:"Tan",value:Od.Tan},{label:"ArcTan",value:Od.ArcTan},{label:"ArcCos",value:Od.ArcCos},{label:"ArcSin",value:Od.ArcSin},{label:"Sign",value:Od.Sign},{label:"Negate",value:Od.Negate},{label:"OneMinus",value:Od.OneMinus},{label:"Reciprocal",value:Od.Reciprocal},{label:"ToDegrees",value:Od.ToDegrees},{label:"ToRadians",value:Od.ToRadians},{label:"Fract",value:Od.Fract}]})],Mm.prototype,"operation",void 0),(0,a.i)("BABYLON.ParticleTrigonometryBlock",Mm);var qm,Em=m(12356);class Im extends pd{constructor(h){super(h),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(rd.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(rd.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(rd.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(rd.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(rd.System),this._inputs[0].excludedConnectionPointTypes.push(rd.Particle),this._inputs[0].excludedConnectionPointTypes.push(rd.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const d=h=>{const d=this.input.getConnectedValue(h);if(this.log.length>=this.stackSize)return d;if(null===d||void 0===d)return this.log.push(["null",""]),d;switch(this.input.type){case rd.Vector2:this.log.push([(0,Em.i)(d,4),d.toString()]);break;case rd.Qd:this.log.push([(0,Em.j)(d,4),d.toString()]);break;case rd.Eb:this.log.push([`{R: ${d.r.toFixed(4)} G: ${d.g.toFixed(4)} B: ${d.b.toFixed(4)} A: ${d.a.toFixed(4)}}`,d.toString()]);break;default:this.log.push([d.toString(),d.toString()])}return d};this.output.isConnected?this.output._storedFunction=d:this.output._storedValue=d(h)}serialize(){const h=super.serialize();return h.stackSize=this.stackSize,h}_deserialize(h){super._deserialize(h),this.stackSize=h.stackSize}}(0,k.d)([ed("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Im.prototype,"stackSize",void 0),(0,a.i)("BABYLON.ParticleDebugBlock",Im);(0,a.i)("BABYLON.ParticleElbowBlock",class extends pd{constructor(h){super(h),this.registerInput("input",rd.AutoDetect),this.registerOutput("output",rd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const d=this._outputs[0],m=this._inputs[0];d._storedFunction=h=>m.getConnectedValue(h)}});(0,a.i)("BABYLON.ParticleTeleportInBlock",class extends pd{get endpoints(){return this._endpoints}constructor(h){super(h),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",rd.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const d of this.endpoints)if(d.isAnAncestorOfType(h))return!0;return!1}isAnAncestorOf(h){for(const d of this.endpoints){if(d===h)return!0;if(d.isAnAncestorOf(h))return!0}return!1}attachToEndpoint(h){h.detach(),this._endpoints.push(h),h._entryPoint=this,h._outputs[0]._typeConnectionSource=this._inputs[0],h._tempEntryPointUniqueId=null,h.name="> "+this.name}detachFromEndpoint(h){const d=this._endpoints.indexOf(h);-1!==d&&(this._endpoints.splice(d,1),h._outputs[0]._typeConnectionSource=null,h._entryPoint=null)}_build(){for(const h of this._endpoints)h.output._storedFunction=h=>this.input.getConnectedValue(h)}});(0,a.i)("BABYLON.ParticleTeleportOutBlock",class extends pd{constructor(h){super(h),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",rd.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(h){this.entryPoint&&this.entryPoint.build(h)}clone(){const h=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(h),h}serialize(){var h;const d=super.serialize();return d.entryPoint=(null===(h=this.entryPoint)||void 0===h?void 0:h.uniqueId)??"",d}_deserialize(h){super._deserialize(h),this._tempEntryPointUniqueId=h.entryPoint}}),function(h){h[h.Equal=0]="Equal",h[h.NotEqual=1]="NotEqual",h[h.LessThan=2]="LessThan",h[h.GreaterThan=3]="GreaterThan",h[h.LessOrEqual=4]="LessOrEqual",h[h.GreaterOrEqual=5]="GreaterOrEqual",h[h.Xor=6]="Xor",h[h.Or=7]="Or",h[h.And=8]="And"}(qm||(qm={}));class Rm extends pd{constructor(h){super(h),this.test=qm.Equal,this.epsilon=0,this.registerInput("left",rd.Float),this.registerInput("right",rd.Float,!0,0),this.registerInput("ifTrue",rd.AutoDetect,!0,1),this.registerInput("ifFalse",rd.AutoDetect,!0,0),this.registerOutput("output",rd.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=rd.Float,this._inputs[0].acceptedConnectionPointTypes.push(rd.Int),this._inputs[1].acceptedConnectionPointTypes.push(rd.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const h=h=>{const d=this.left.getConnectedValue(h),m=this.right.getConnectedValue(h);let j=!1;switch(this.test){case qm.Equal:j=(0,S.WithinEpsilon)(d,m,this.epsilon);break;case qm.NotEqual:j=!(0,S.WithinEpsilon)(d,m,this.epsilon);break;case qm.LessThan:j=d<m+this.epsilon;break;case qm.GreaterThan:j=d>m-this.epsilon;break;case qm.LessOrEqual:j=d<=m+this.epsilon;break;case qm.GreaterOrEqual:j=d>=m-this.epsilon;break;case qm.Xor:j=!!d&&!m||!d&&!!m;break;case qm.Or:j=!!d||!!m;break;case qm.And:j=!!d&&!!m}return j};this.output._storedFunction=d=>h(d)?this.ifTrue.getConnectedValue(d):this.ifFalse.getConnectedValue(d)}serialize(){const h=super.serialize();return h.test=this.test,h.epsilon=this.epsilon,h}_deserialize(h){super._deserialize(h),this.test=h.test,void 0!==h.epsilon&&(this.epsilon=h.epsilon)}}(0,k.d)([ed("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:qm.Equal},{label:"NotEqual",value:qm.NotEqual},{label:"LessThan",value:qm.LessThan},{label:"GreaterThan",value:qm.GreaterThan},{label:"LessOrEqual",value:qm.LessOrEqual},{label:"GreaterOrEqual",value:qm.GreaterOrEqual},{label:"Xor",value:qm.Xor},{label:"Or",value:qm.Or},{label:"And",value:qm.And}]})],Rm.prototype,"test",void 0),(0,k.d)([ed("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Rm.prototype,"epsilon",void 0),(0,a.i)("BABYLON.ParticleConditionBlock",Rm);class Zm extends pd{constructor(h){super(h),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",rd.Particle),this.registerInput("condition",rd.Float,!0,0),this.registerInput("system",rd.System),this.registerOutput("output",rd.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){this._triggerCount=0;const d=this.input.getConnectedValue(h),m={process:m=>{if(h.particleContext=m,h.systemContext=d,0!==this.condition.getConnectedValue(h)&&(0===this.limit||this._triggerCount<this.limit)){const j=(new Date).getTime();if(this._previousOne&&j-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=j;const A=this.system.getConnectedValue(h);if(A){const j=zd(A,h.Fd,m.position);j.pd.addOnce((()=>{this._triggerCount--})),d.pd.addOnce((()=>{j.dispose()}))}}},previousItem:null,nextItem:null};d._updateQueueStart?Uh(m,d._updateQueueStart):d._updateQueueStart=m,this.output._storedValue=d}serialize(){const h=super.serialize();return h.limit=this.limit,h.delay=this.delay,h}_deserialize(h){super._deserialize(h),void 0!==h.limit&&(this.limit=h.limit),void 0!==h.delay&&(this.delay=h.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,k.d)([ed("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zm.prototype,"limit",void 0),(0,k.d)([ed("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zm.prototype,"delay",void 0),(0,a.i)("BABYLON.ParticleTriggerBlock",Zm);m(12361),m(12370),m(12379),m(12439)},12419:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12381:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12456:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneVertex",b="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12443:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12432:(h,d,m)=>{"use strict";var j=m(11200);const A="fogFragment",b="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12410:(h,d,m)=>{"use strict";var j=m(11200);const A="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12458:(h,d,m)=>{"use strict";var j=m(11200);const A="fogVertex",b="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12447:(h,d,m)=>{"use strict";var j=m(11200);const A="fogVertexDeclaration",b="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12398:(h,d,m)=>{"use strict";var j=m(11200);const A="helperFunctions",b="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12387:(h,d,m)=>{"use strict";var j=m(11200);const A="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12401:(h,d,m)=>{"use strict";var j=m(11200);const A="imageProcessingFunctions",b="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12393:(h,d,m)=>{"use strict";var j=m(11200);const A="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12426:(h,d,m)=>{"use strict";var j=m(11200);const A="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12464:(h,d,m)=>{"use strict";var j=m(11200);const A="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";j.b.IncludesShadersStoreWGSL[A]||(j.b.IncludesShadersStoreWGSL[A]=b)},12379:(h,d,m)=>{"use strict";m.r(d),m.d(d,{particlesPixelShaderWGSL:()=>w});var j=m(11200);m(12381),m(12387),m(12393),m(12398),m(12401),m(12410),m(12419),m(12426),m(12432);const A="particlesPixelShader",b="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.b.ShadersStoreWGSL[A]||(j.b.ShadersStoreWGSL[A]=b);const w={name:A,shader:b}},12439:(h,d,m)=>{"use strict";m.r(d),m.d(d,{particlesVertexShaderWGSL:()=>w});var j=m(11200);m(12443),m(12447),m(12393),m(12456),m(12458),m(12464);const A="particlesVertexShader",b="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.b.ShadersStoreWGSL[A]||(j.b.ShadersStoreWGSL[A]=b);const w={name:A,shader:b}},12297:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12367:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12324:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneVertex",b="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12373:(h,d,m)=>{"use strict";var j=m(11200);const A="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12308:(h,d,m)=>{"use strict";var j=m(11200);const A="fogFragment",b="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12295:(h,d,m)=>{"use strict";var j=m(11200);const A="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12327:(h,d,m)=>{"use strict";var j=m(11200);const A="fogVertex",b="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12315:(h,d,m)=>{"use strict";var j=m(11200);const A="fogVertexDeclaration",b="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12278:(h,d,m)=>{"use strict";var j=m(11200);const A="helperFunctions",b="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12267:(h,d,m)=>{"use strict";var j=m(11200);const A="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12286:(h,d,m)=>{"use strict";var j=m(11200);const A="imageProcessingFunctions",b="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12271:(h,d,m)=>{"use strict";var j=m(11200);const A="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12299:(h,d,m)=>{"use strict";var j=m(11200);const A="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12331:(h,d,m)=>{"use strict";var j=m(11200);const A="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";j.b.IncludesShadersStore[A]||(j.b.IncludesShadersStore[A]=b)},12361:(h,d,m)=>{"use strict";m.r(d),m.d(d,{particlesPixelShader:()=>w});var j=m(11200);m(12367),m(12267),m(12271),m(12278),m(12286),m(12295),m(12297),m(12299),m(12308);const A="particlesPixelShader",b="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.b.ShadersStore[A]||(j.b.ShadersStore[A]=b);const w={name:A,shader:b}},12370:(h,d,m)=>{"use strict";m.r(d),m.d(d,{particlesVertexShader:()=>w});var j=m(11200);m(12373),m(12315),m(12271),m(12324),m(12327),m(12331);const A="particlesVertexShader",b="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.b.ShadersStore[A]||(j.b.ShadersStore[A]=b);const w={name:A,shader:b}},12716:(h,d,m)=>{"use strict";m.r(d),m.d(d,{FlowGraphGLTFDataProvider:()=>b});var j=m(12687),A=m(12671);class b extends j.d{constructor(h){var d,m;super();const j=h.glTF,b=(null===(d=j.animations)||void 0===d?void 0:d.map((h=>h._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",A.e,b);const w=(null===(m=j.nodes)||void 0===m?void 0:m.map((h=>h._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",A.e,w)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12608:(h,d,m)=>{"use strict";m.d(d,{d:()=>L,e:()=>R,f:()=>I,j:()=>Z});var j=m(11058),A=m(11578),b=m(11353),w=m(12611);const a=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class D{constructor(h,d){this._gltf=h,this._infoTree=d}convert(h){let d,m=this._gltf,j=this._infoTree;if(!h.startsWith("/"))throw new Error("Path must start with a /");const A=h.split("/");if(A.shift(),A[A.length-1].includes(".length")){const h=A[A.length-1].split(".");A.pop(),A.push(...h)}let b=!1;for(const D of A){const A="length"===D;if(A&&!j.__array__)throw new Error(`Path ${h} is invalid`);if(j.__ignoreObjectTree__&&(b=!0),j.__array__&&!A)j=j.__array__;else if(j=j[D],!j)throw new Error(`Path ${h} is invalid`);if(!b)if(void 0===m){if(!a.find((d=>d.regex.test(h))))throw new Error(`Path ${h} is invalid`)}else if(!A){var w;m=null===(w=m)||void 0===w?void 0:w[D]}(j.__target__||A)&&(d=m)}return{object:d,info:j}}}function S(h,d,m,j){const A=M(h,d);return j?A[m][j]:A[m]}function M(h,d,m){var j,b;return null===(j=h._data)||void 0===j||null===(b=j[(null===m||void 0===m?void 0:m.fillMode)??A.c.MATERIAL_TriangleFillMode])||void 0===b?void 0:b.babylonMaterial}function q(h,d){return{offset:{componentsCount:2,type:"Vector2",get:(m,A,b)=>{const w=S(m,b,h,d);return new j.h(null===w||void 0===w?void 0:w.uOffset,null===w||void 0===w?void 0:w.vOffset)},getTarget:M,set:(m,j,A,b)=>{const w=S(j,b,h,d);w.uOffset=m.x,w.vOffset=m.y},getPropertyName:[()=>`${h}${d?"."+d:""}.uOffset`,()=>`${h}${d?"."+d:""}.vOffset`]},rotation:{type:"number",get:(m,j,A)=>{var b;return null===(b=S(m,A,h,d))||void 0===b?void 0:b.wAng},getTarget:M,set:(m,j,A,b)=>S(j,b,h,d).wAng=m,getPropertyName:[()=>`${h}${d?"."+d:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(m,A,b)=>{const w=S(m,b,h,d);return new j.h(null===w||void 0===w?void 0:w.uScale,null===w||void 0===w?void 0:w.vScale)},getTarget:M,set:(m,j,A,b)=>{const w=S(j,b,h,d);w.uScale=m.x,w.vScale=m.y},getPropertyName:[()=>`${h}${d?"."+d:""}.uScale`,()=>`${h}${d?"."+d:""}.vScale`]}}}const E={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:h=>{var d,m;return new j.h((null===(d=h._babylonCamera)||void 0===d?void 0:d.orthoLeft)??0,(null===(m=h._babylonCamera)||void 0===m?void 0:m.orthoRight)??0)},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.orthoLeft=h.x,d._babylonCamera.orthoRight=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:h=>{var d,m;return new j.h((null===(d=h._babylonCamera)||void 0===d?void 0:d.orthoBottom)??0,(null===(m=h._babylonCamera)||void 0===m?void 0:m.orthoTop)??0)},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.orthoBottom=h.x,d._babylonCamera.orthoTop=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.maxZ},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.jb},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.jb=h)},getTarget:h=>h,getPropertyName:[()=>"jb"]}},perspective:{aspectRatio:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.getEngine().getAspectRatio(h._babylonCamera)},getTarget:h=>h,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.fov},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.fov=h)},getTarget:h=>h,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.maxZ},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.jb},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.jb=h)},getTarget:h=>h,getPropertyName:[()=>"jb"]}}}},nodes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Qd",get:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.position},set:(h,d)=>{var m;return null===(m=d._babylonTransformNode)||void 0===m?void 0:m.position.D(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion},set:(h,d)=>{var m,j;return null===(m=d._babylonTransformNode)||void 0===m||null===(j=m.rotationQuaternion)||void 0===j?void 0:j.D(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Qd",get:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.td},set:(h,d)=>{var m;return null===(m=d._babylonTransformNode)||void 0===m?void 0:m.td.D(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"td"]},weights:{length:{type:"number",get:h=>h._numMorphTargets,getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(h,d)=>{var m,j;return void 0!==d?null===(m=h._primitiveBabylonMeshes)||void 0===m||null===(j=m[0].morphTargetManager)||void 0===j?void 0:j.getTarget(d).influence:void 0},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(h,d)=>[0],getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:h=>{var d,m,A;return j.b.Compose(null===(d=h._babylonTransformNode)||void 0===d?void 0:d.td,null===(m=h._babylonTransformNode)||void 0===m?void 0:m.rotationQuaternion,null===(A=h._babylonTransformNode)||void 0===A?void 0:A.position)},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:h=>{var d,m,A,b;const w=j.b.Identity();let a=h.parent;for(;a&&a.parent;)a=a.parent;const D=(null===(d=h._babylonTransformNode)||void 0===d?void 0:d.position._isDirty)||(null===(m=h._babylonTransformNode)||void 0===m||null===(A=m.rotationQuaternion)||void 0===A?void 0:A._isDirty)||(null===(b=h._babylonTransformNode)||void 0===b?void 0:b.td._isDirty);if(a){var S;const d=null===(S=a._babylonTransformNode)||void 0===S?void 0:S.Zd(!0).invert();var M,q;if(d)null===(M=h._babylonTransformNode)||void 0===M||null===(q=M.Zd(D))||void 0===q||q.multiplyToRef(d,w)}else h._babylonTransformNode&&w.D(h._babylonTransformNode.Zd(D));return w},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:h=>{var d,m;return null===(d=h._babylonTransformNode)||void 0===d||null===(m=d.getChildren((h=>h instanceof w.b),!0)[0])||void 0===m?void 0:m.ab},getTarget:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.getChildren((h=>h instanceof w.b),!0)[0]},set:(h,d)=>{if(d._babylonTransformNode){const m=d._babylonTransformNode.getChildren((h=>h instanceof w.b),!0)[0];m&&(m.ab=h)}}},color:{type:"qb",get:h=>{var d,m;return null===(d=h._babylonTransformNode)||void 0===d||null===(m=d.getChildren((h=>h instanceof w.b),!0)[0])||void 0===m?void 0:m.Db},getTarget:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.getChildren((h=>h instanceof w.b),!0)[0]},set:(h,d)=>{if(d._babylonTransformNode){const m=d._babylonTransformNode.getChildren((h=>h instanceof w.b),!0)[0];m&&(m.Db=h)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"qb",get:(h,d,m)=>M(h,d,m).emissiveColor,set:(h,d,m,j)=>M(d,m,j).emissiveColor.D(h),getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:q("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(h,d,m)=>{var j;return null===(j=S(h,m,"bumpTexture"))||void 0===j?void 0:j.level},set:(h,d,m,j)=>{const A=S(d,j,"bumpTexture");A&&(A.level=h)},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:q("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(h,d,m)=>M(h,d,m).ambientTextureStrength,set:(h,d,m,j)=>{const A=M(d,m,j);A&&(A.ambientTextureStrength=h)},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:q("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Eb",get:(h,d,m)=>{const j=M(h,d,m);return b.f.FromColor3(j.albedoColor,j.alpha)},set:(h,d,m,j)=>{const A=M(d,m,j);A.albedoColor.set(h.r,h.g,h.b),A.alpha=h.a},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:q("albedoTexture")}},metallicFactor:{type:"number",get:(h,d,m)=>M(h,d,m).metallic,set:(h,d,m,j)=>{const A=M(d,m,j);A&&(A.metallic=h)},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(h,d,m)=>M(h,d,m).roughness,set:(h,d,m,j)=>{const A=M(d,m,j);A&&(A.roughness=h)},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:q("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(h,d,m)=>M(h,d,m).anisotropy.ab,set:(h,d,m,j)=>{M(d,m,j).anisotropy.ab=h},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(h,d,m)=>M(h,d,m).anisotropy.angle,set:(h,d,m,j)=>{M(d,m,j).anisotropy.angle=h},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:q("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(h,d,m)=>M(h,d,m).clearCoat.ab,set:(h,d,m,j)=>{M(d,m,j).clearCoat.ab=h},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(h,d,m)=>M(h,d,m).clearCoat.roughness,set:(h,d,m,j)=>{M(d,m,j).clearCoat.roughness=h},getTarget:(h,d,m)=>M(h,d,m),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:q("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(h,d,m)=>{var j;return null===(j=M(h,d,m).clearCoat.bumpTexture)||void 0===j?void 0:j.level},getTarget:M,set:(h,d,m,j)=>M(d,m,j).clearCoat.bumpTexture.level=h},extensions:{KHR_texture_transform:q("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:q("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(h,d,m)=>M(h,d,m).subSurface.dispersion,getTarget:M,set:(h,d,m,j)=>M(d,m,j).subSurface.dispersion=h}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(h,d,m)=>M(h,d,m).emissiveIntensity,getTarget:M,set:(h,d,m,j)=>M(d,m,j).emissiveIntensity=h}},KHR_materials_ior:{ior:{type:"number",get:(h,d,m)=>M(h,d,m).indexOfRefraction,getTarget:M,set:(h,d,m,j)=>M(d,m,j).indexOfRefraction=h}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(h,d,m)=>M(h,d,m).iridescence.ab,getTarget:M,set:(h,d,m,j)=>M(d,m,j).iridescence.ab=h},iridescenceIor:{type:"number",get:(h,d,m)=>M(h,d,m).iridescence.indexOfRefraction,getTarget:M,set:(h,d,m,j)=>M(d,m,j).iridescence.indexOfRefraction=h},iridescenceTexture:{extensions:{KHR_texture_transform:q("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(h,d,m)=>M(h,d,m).iridescence.maximumThickness,getTarget:M,set:(h,d,m,j)=>M(d,m,j).iridescence.maximumThickness=h},iridescenceThicknessMinimum:{type:"number",get:(h,d,m)=>M(h,d,m).iridescence.minimumThickness,getTarget:M,set:(h,d,m,j)=>M(d,m,j).iridescence.minimumThickness=h},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:q("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"qb",get:(h,d,m)=>M(h,d,m).sheen.color,getTarget:M,set:(h,d,m,j)=>M(d,m,j).sheen.color.D(h)},sheenColorTexture:{extensions:{KHR_texture_transform:q("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(h,d,m)=>M(h,d,m).sheen.ab,getTarget:M,set:(h,d,m,j)=>M(d,m,j).sheen.ab=h},sheenRoughnessTexture:{extensions:{KHR_texture_transform:q("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(h,d,m)=>M(h,d,m).metallicF0Factor,getTarget:M,set:(h,d,m,j)=>M(d,m,j).metallicF0Factor=h,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"qb",get:(h,d,m)=>M(h,d,m).metallicReflectanceColor,getTarget:M,set:(h,d,m,j)=>M(d,m,j).metallicReflectanceColor.D(h),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:q("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:q("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(h,d,m)=>M(h,d,m).subSurface.refractionIntensity,getTarget:M,set:(h,d,m,j)=>M(d,m,j).subSurface.refractionIntensity=h,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:q("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(h,d,m)=>M(h,d,m).subSurface.translucencyIntensity,getTarget:M,set:(h,d,m,j)=>M(d,m,j).subSurface.translucencyIntensity=h},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:q("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"qb",get:(h,d,m)=>M(h,d,m).subSurface.translucencyColor,getTarget:M,set:(h,d,m,j)=>{var A;return h&&(null===(A=M(d,m,j).subSurface.translucencyColor)||void 0===A?void 0:A.D(h))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:q("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"qb",get:(h,d,m)=>M(h,d,m).subSurface.tintColor,getTarget:M,set:(h,d,m,j)=>M(d,m,j).subSurface.tintColor.D(h)},attenuationDistance:{type:"number",get:(h,d,m)=>M(h,d,m).subSurface.tintColorAtDistance,getTarget:M,set:(h,d,m,j)=>M(d,m,j).subSurface.tintColorAtDistance=h},thicknessFactor:{type:"number",get:(h,d,m)=>M(h,d,m).subSurface.maximumThickness,getTarget:M,set:(h,d,m,j)=>M(d,m,j).subSurface.maximumThickness=h},thicknessTexture:{extensions:{KHR_texture_transform:q("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,color:{type:"qb",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.Db},set:(h,d)=>{var m;return null===(m=d._babylonLight)||void 0===m?void 0:m.Db.D(h)},getTarget:h=>h._babylonLight,getPropertyName:[h=>"diffuse"]},ab:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.ab},set:(h,d)=>d._babylonLight?d._babylonLight.ab=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"intensity"]},range:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.range},set:(h,d)=>d._babylonLight?d._babylonLight.range=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"range"]},spot:{innerConeAngle:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.innerAngle},set:(h,d)=>d._babylonLight?d._babylonLight.innerAngle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"innerConeAngle"]},outerConeAngle:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.angle},set:(h,d)=>d._babylonLight?d._babylonLight.angle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTexture)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,ab:{type:"number",get:h=>{var d;return null===(d=h._babylonTexture)||void 0===d?void 0:d.level},set:(h,d)=>{d._babylonTexture&&(d._babylonTexture.level=h)},getTarget:h=>h._babylonTexture},rotation:{type:"Quaternion",get:h=>{var d;return h._babylonTexture&&j.c.FromRotationMatrix(null===(d=h._babylonTexture)||void 0===d?void 0:d.getReflectionTextureMatrix())},set:(h,d)=>{var m;d._babylonTexture&&(null!==(m=d._babylonTexture.ih())&&void 0!==m&&m.useRightHandedSystem||(h=j.c.Inverse(h)),j.b.FromQuaternionToRef(h,d._babylonTexture.getReflectionTextureMatrix()))},getTarget:h=>h._babylonTexture}}}}},animations:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>{var d;return null===(d=h.primitives[0]._instanceData)||void 0===d?void 0:d.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function I(h){return new D(h,E)}function R(h){const d=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let m=E;for(const j of d)j&&(m=m[j]);if(m&&m.type&&m.get)return m}function Z(h,d){const m=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let j=E;for(const A of m)A&&(j=j[A]);j&&j.type&&j.get&&(j.interpolation=d)}function L(h,d){const m=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let j=E;for(const A of m)if(A){if(!j[A]){if("?"===A){j.__ignoreObjectTree__=!0;continue}j[A]={},"__array__"===A&&(j[A].__target__=!0)}j=j[A]}Object.assign(j,d)}},12615:(h,d,m)=>{"use strict";m.r(d),m.d(d,{AnimationPropertyInfo:()=>S,TransformNodeAnimationPropertyInfo:()=>M,WeightAnimationPropertyInfo:()=>q,getQuaternion:()=>a,getVector3:()=>w,getWeights:()=>D});var j=m(11714),A=m(11058),b=m(12608);function w(h,d,m,j){return A.i.Ud(d,m).scaleInPlace(j)}function a(h,d,m,j){return A.c.Ud(d,m).scaleInPlace(j)}function D(h,d,m,j){const A=new Array(h._numMorphTargets);for(let b=0;b<A.length;b++)A[b]=d[m++]*j;return A}class S{constructor(h,d,m,j){this.type=h,this.name=d,this.getValue=m,this.getStride=j}_buildAnimation(h,d,m){const A=new j.b(h,this.name,d,this.type);return A.setKeys(m),A}}class M extends S{buildAnimations(h,d,m,j){const A=[];return A.push({babylonAnimatable:h._babylonTransformNode,babylonAnimation:this._buildAnimation(d,m,j)}),A}}class q extends S{buildAnimations(h,d,m,A){const b=[];if(h._numMorphTargets)for(let w=0;w<h._numMorphTargets;w++){const a=new j.b(`${d}_${w}`,this.name,m,this.type);if(a.setKeys(A.map((h=>({frame:h.frame,inTangent:h.inTangent?h.inTangent[w]:void 0,value:h.value[w],outTangent:h.outTangent?h.outTangent[w]:void 0,interpolation:h.interpolation})))),h._primitiveBabylonMeshes)for(const d of h._primitiveBabylonMeshes)if(d.morphTargetManager){const h=d.morphTargetManager.getTarget(w),m=a.clone();h.animations.push(m),b.push({babylonAnimatable:h,babylonAnimation:m})}}return b}}(0,b.j)("/nodes/{}/translation",[new M(j.b.ANIMATIONTYPE_VECTOR3,"position",w,(()=>3))]),(0,b.j)("/nodes/{}/rotation",[new M(j.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",a,(()=>4))]),(0,b.j)("/nodes/{}/scale",[new M(j.b.ANIMATIONTYPE_VECTOR3,"td",w,(()=>3))]),(0,b.j)("/nodes/{}/weights",[new q(j.b.ANIMATIONTYPE_FLOAT,"influence",D,(h=>h._numMorphTargets))])},12573:(h,d,m)=>{"use strict";class j{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((h,d)=>{this._resolve=h,this._reject=d}))}}var A=m(11058),b=m(11353),w=m(11107),a=m(11427),D=m(12582),S=m(12594),M=m(11097),q=m(11573),E=m(11714),I=m(11722),R=m(11094),Z=m(11121),L=m(11126);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(h){this._useTextureToStoreBoneMatrices=h,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(h,d,m){this.name=h,this.id=d,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=A.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new M.e,this.bones=[],this._scene=m||R.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const j=this._scene.getEngine().getCaps();this._canUseTextureForBones=j.textureFloat&&j.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((h=>!h.getParent()))}getTransformMatrices(h){if(this.needInitialSkinMatrix){if(!h)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return h._bonesTransformMatrices||this.prepare(!0),h._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(h){return this.needInitialSkinMatrix&&h._transformMatrixTexture?h._transformMatrixTexture:this._transformMatrixTexture}ih(){return this._scene}toString(h){let d=`Name: ${this.name}, nBones: ${this.bones.length}`;if(d+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,h){d+=", Ranges: {";let h=!0;for(const m in this._ranges)h&&(d+=", ",h=!1),d+=m;d+="}"}return d}getBoneIndexByName(h){for(let d=0,m=this.bones.length;d<m;d++)if(this.bones[d].name===h)return d;return-1}createAnimationRange(h,d,m){if(!this._ranges[h]){this._ranges[h]=new I.c(h,d,m);for(let j=0,A=this.bones.length;j<A;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].createRange(h,d,m)}}deleteAnimationRange(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let m=0,j=this.bones.length;m<j;m++)this.bones[m].animations[0]&&this.bones[m].animations[0].deleteRange(h,d);this._ranges[h]=null}getAnimationRange(h){return this._ranges[h]||null}getAnimationRanges(){const h=[];let d;for(d in this._ranges)h.push(this._ranges[d]);return h}copyAnimationRange(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[d]||!h.getAnimationRange(d))return!1;let j=!0;const A=this._getHighestAnimationFrame()+1,b={},w=h.bones;let a,D;for(D=0,a=w.length;D<a;D++)b[w[D].name]=w[D];this.bones.length!==w.length&&(Z.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${w.length}`),j=!1);const S=m&&this.dimensionsAtRest&&h.dimensionsAtRest?this.dimensionsAtRest.divide(h.dimensionsAtRest):null;for(D=0,a=this.bones.length;D<a;D++){const h=this.bones[D].name,w=b[h];w?j=j&&this.bones[D].copyAnimationRange(w,d,A,m,S):(Z.c.Warn("copyAnimationRange: not same rig, missing source bone "+h),j=!1)}const M=h.getAnimationRange(d);return M&&(this._ranges[d]=new I.c(d,M.from+A,M.to+A)),j}returnToRest(){for(const h of this.bones)-1!==h._index&&h.returnToRest()}_getHighestAnimationFrame(){let h=0;for(let d=0,m=this.bones.length;d<m;d++)if(this.bones[d].animations[0]){const m=this.bones[d].animations[0].getHighestFrame();h<m&&(h=m)}return h}beginAnimation(h,d,m,j){const A=this.getAnimationRange(h);return A?this._scene.beginAnimation(this,A.from,A.to,d,m,j):null}static MakeAnimationAdditive(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;const j=h.getAnimationRange(m);if(!j)return null;const A=h._scene.getAllAnimatablesByTarget(h);let b=null;for(let a=0;a<A.length;a++){const h=A[a];if(h.fromFrame===(null===j||void 0===j?void 0:j.from)&&h.toFrame===(null===j||void 0===j?void 0:j.to)){b=h;break}}const w=h.getAnimatables();for(let a=0;a<w.length;a++){const h=w[a].animations;if(h)for(let j=0;j<h.length;j++)E.b.MakeAnimationAdditive(h[j],d,m)}return b&&(b.isAdditive=!0),h}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(h){this._meshesWithPoseMatrix.push(h)}_unregisterMeshWithPoseMatrix(h){const d=this._meshesWithPoseMatrix.indexOf(h);d>-1&&this._meshesWithPoseMatrix.splice(d,1)}_computeTransformMatrices(h,d){this.onBeforeComputeObservable.notifyObservers(this);for(let m=0;m<this.bones.length;m++){const j=this.bones[m];j._childUpdateId++;const A=j.getParent();if(A?j.getLocalMatrix().multiplyToRef(A.getFinalMatrix(),j.getFinalMatrix()):d?j.getLocalMatrix().multiplyToRef(d,j.getFinalMatrix()):j.getFinalMatrix().D(j.getLocalMatrix()),-1!==j._index){const d=null===j._index?m:j._index;j.getAbsoluteInverseBindMatrix().multiplyToArray(j.getFinalMatrix(),h,16*d)}}this._identity.copyToArray(h,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const h=this.ih().getRenderId();if(this._currentRenderId===h)return;this._currentRenderId=h}if(this._numBonesWithLinkedTransformNode>0)for(const h of this.bones)if(h._linkedTransformNode){const d=h._linkedTransformNode;h.position=d.position,d.rotationQuaternion?h.rotationQuaternion=d.rotationQuaternion:h.rotation=d.rotation,h.td=d.td}if(this.needInitialSkinMatrix)for(const h of this._meshesWithPoseMatrix){const d=h.getPoseMatrix();let m=this._isDirty;if(h._bonesTransformMatrices&&h._bonesTransformMatrices.length===16*(this.bones.length+1)||(h._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),m=!0),m){if(this._synchronizedWithMesh!==h){this._synchronizedWithMesh=h;for(const h of this.bones)if(!h.getParent()){h.getBindMatrix().multiplyToRef(d,A.d.Matrix[1]),h._updateAbsoluteBindMatrices(A.d.Matrix[1])}if(this.isUsingTextureForMatrices){const d=4*(this.bones.length+1);h._transformMatrixTexture&&h._transformMatrixTexture.getSize().width===d||(h._transformMatrixTexture&&h._transformMatrixTexture.dispose(),h._transformMatrixTexture=q.b.CreateRGBATexture(h._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(h._bonesTransformMatrices,d),this.isUsingTextureForMatrices&&h._transformMatrixTexture&&h._transformMatrixTexture.update(h._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=q.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let h=0;h<this.bones.length;h++)this._animatables.push(this.bones[h])}return this._animatables}clone(h,d){const m=new B(h,d||h,this._scene);m.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){const h=this.bones[j];let d=null;const A=h.getParent();if(A){const h=this.bones.indexOf(A);d=m.bones[h]}const b=new S.e(h.name,m,d,h.getBindMatrix().clone(),h.getRestMatrix().clone());b._index=h._index,h._linkedTransformNode&&b.linkTransformNode(h._linkedTransformNode),L.e.DeepCopy(h.animations,b.animations)}if(this._ranges){m._ranges={};for(const h in this._ranges){const d=this._ranges[h];d&&(m._ranges[h]=d.clone())}}return this._isDirty=!0,m.prepare(!0),m}enableBlending(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const d of this.bones)for(const m of d.animations)m.enableBlending=!0,m.blendingSpeed=h}dispose(){if(this._meshesWithPoseMatrix.length=0,this.ih().stopAnimation(this),this.ih().removeSkeleton(this),this._parentContainer){const h=this._parentContainer.skeletons.indexOf(this);h>-1&&this._parentContainer.skeletons.splice(h,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const h={};h.name=this.name,h.id=this.id,this.dimensionsAtRest&&(h.dimensionsAtRest=this.dimensionsAtRest.fd()),h.bones=[],h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let m=0;m<this.bones.length;m++){var d;const j=this.bones[m],A=j.getParent(),b={parentBoneIndex:A?this.bones.indexOf(A):-1,index:j.getIndex(),name:j.name,id:j.id,matrix:j.getBindMatrix().fd(),rest:j.getRestMatrix().fd(),linkedTransformNodeId:null===(d=j.getTransformNode())||void 0===d?void 0:d.id};h.bones.push(b),j.length&&(b.length=j.length),j.metadata&&(b.metadata=j.metadata),j.animations&&j.animations.length>0&&(b.animation=j.animations[0].serialize()),h.ranges=[];for(const d in this._ranges){const m=this._ranges[d];if(!m)continue;const j={};j.name=d,j.from=m.from,j.to=m.to,h.ranges.push(j)}}return h}static Parse(h,d){const m=new B(h.name,h.id,d);let j;for(h.dimensionsAtRest&&(m.dimensionsAtRest=A.i.Ud(h.dimensionsAtRest)),m.needInitialSkinMatrix=h.needInitialSkinMatrix,j=0;j<h.bones.length;j++){const d=h.bones[j],b=h.bones[j].index;let w=null;d.parentBoneIndex>-1&&(w=m.bones[d.parentBoneIndex]);const a=d.rest?A.b.Ud(d.rest):null,D=new S.e(d.name,m,w,A.b.Ud(d.matrix),a,null,b);void 0!==d.id&&null!==d.id&&(D.id=d.id),d.length&&(D.length=d.length),d.metadata&&(D.metadata=d.metadata),d.animation&&D.animations.push(E.b.Parse(d.animation)),void 0!==d.linkedTransformNodeId&&null!==d.linkedTransformNodeId&&(m._hasWaitingData=!0,D._waitingTransformNodeId=d.linkedTransformNodeId)}if(h.ranges)for(j=0;j<h.ranges.length;j++){const d=h.ranges[j];m.createAnimationRange(d.name,d.from,d.to)}return m}computeAbsoluteMatrices(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||h)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(h)}getPoseMatrix(){let h=null;return this._meshesWithPoseMatrix.length>0&&(h=this._meshesWithPoseMatrix[0].getPoseMatrix()),h}sortBones(){const h=[],d=new Array(this.bones.length);for(let m=0;m<this.bones.length;m++)this._sortBones(m,h,d);this.bones=h}_sortBones(h,d,m){if(m[h])return;m[h]=!0;const j=this.bones[h];if(!j)return;void 0===j._index&&(j._index=h);const A=j.getParent();A&&this._sortBones(this.bones.indexOf(A),d,m),d.push(j)}setCurrentPoseAsRest(){for(const h of this.bones)h.setCurrentPoseAsRest()}}var V=m(11251),v=m(11590),C=m(11543),T=m(11366),o=m(11281),y=m(11443),i=m(11380),g=m(11419),F=m(11728),f=m(11430),H=m(12547);class c{set areUpdatesFrozen(h){h?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new f.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,h||(h=R.b.LastCreatedScene),this._scene=h,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const h=this._scene.getEngine().getCaps();this._canUseTextureForTargets=h.canUseGLVertexID&&h.textureFloat&&h.maxVertexTextureImageUnits>0&&h.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return c.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?c.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(h){this._numMaxInfluencers!==h&&(this._numMaxInfluencers=h,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(h){this._useTextureToStoreTargets!==h&&(this._useTextureToStoreTargets=h,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var h;return c.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(h=this._scene)&&void 0!==h&&h.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(h){return this._activeTargets.data[h]}getTarget(h){return this._targets[h]}getTargetByName(h){for(const d of this._targets)if(d.name===h)return d;return null}addTarget(h){this._targets.push(h),this._targetInfluenceChangedObservers.push(h.onInfluenceChanged.add((h=>{this.areUpdatesFrozen&&h&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(h)}))),this._targetDataLayoutChangedObservers.push(h._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(h){const d=this._targets.indexOf(h);d>=0&&(this._targets.splice(d,1),h.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(d,1)[0]),h._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(d,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(h)}_bind(h){h.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),h.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),h.setTexture("morphTargets",this._targetStoreTexture),h.setInt("morphTargetCount",this.numInfluencers)}clone(){const h=new c(this._scene);for(const d of this._targets)h.addTarget(d.clone());return h.enablePositionMorphing=this.enablePositionMorphing,h.enableNormalMorphing=this.enableNormalMorphing,h.enableTangentMorphing=this.enableTangentMorphing,h.enableUVMorphing=this.enableUVMorphing,h.enableUV2Morphing=this.enableUV2Morphing,h.enableColorMorphing=this.enableColorMorphing,h}serialize(){const h={};h.id=this.uniqueId,h.targets=[];for(const d of this._targets)h.targets.push(d.serialize());return h}_syncActiveTargets(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const d=!!this._targetStoreTexture,m=this.isUsingTextureForTargets;(this._mustSynchronize||d!==m)&&(this._mustSynchronize=!1,this.synchronize());let j=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let A=-1;for(const b of this._targets)if(A++,0!==b.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=c.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(b),this._morphTargetTextureIndices[j]=A,this._tempInfluences[j++]=b.influence}this._morphTargetTextureIndices.length!==j&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,j)),this._influences&&this._influences.length===j||(this._influences=new Float32Array(j));for(let b=0;b<j;b++)this._influences[b]=this._tempInfluences[b];if(h&&this._scene)for(const b of this._scene.meshes)b.morphTargetManager===this&&(m?b._markSubMeshesAsAttributesDirty():b._syncGeometryWithMorphTargetManager())}synchronize(){var h;if(!this._scene||this.areUpdatesFrozen)return;const d=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(h=this._targetStoreTexture)||void 0===h||h.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>d.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const m of this._targets){this._supportsPositions=this._supportsPositions&&m.hasPositions,this._supportsNormals=this._supportsNormals&&m.hasNormals,this._supportsTangents=this._supportsTangents&&m.hasTangents,this._supportsUVs=this._supportsUVs&&m.hasUVs,this._supportsUV2s=this._supportsUV2s&&m.hasUV2s,this._supportsColors=this._supportsColors&&m.hasColors;const h=m.vertexCount;if(0===this._vertexCount)this._vertexCount=h;else if(this._vertexCount!==h)return void Z.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${m.name}": ${h}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const h=d.getCaps().maxTextureSize;this._textureWidth>h&&(this._textureHeight=Math.ceil(this._textureWidth/h),this._textureWidth=h);const m=this._targets.length,j=new Float32Array(m*this._textureWidth*this._textureHeight*4);let A=0;for(let d=0;d<m;d++){const h=this._targets[d],m=h.getPositions(),b=h.getNormals(),w=h.getUVs(),a=h.getTangents(),D=h.getUV2s(),S=h.getColors();A=d*this._textureWidth*this._textureHeight*4;for(let d=0;d<this._vertexCount;d++)this._supportsPositions&&m&&(j[A]=m[3*d],j[A+1]=m[3*d+1],j[A+2]=m[3*d+2],A+=4),this._supportsNormals&&b&&(j[A]=b[3*d],j[A+1]=b[3*d+1],j[A+2]=b[3*d+2],A+=4),this._supportsUVs&&w&&(j[A]=w[2*d],j[A+1]=w[2*d+1],A+=4),this._supportsTangents&&a&&(j[A]=a[3*d],j[A+1]=a[3*d+1],j[A+2]=a[3*d+2],A+=4),this._supportsUV2s&&D&&(j[A]=D[2*d],j[A+1]=D[2*d+1],A+=4),this._supportsColors&&S&&(j[A]=S[4*d],j[A+1]=S[4*d+1],j[A+2]=S[4*d+2],j[A+3]=S[4*d+3],A+=4)}this._targetStoreTexture=H.d.CreateRGBATexture(j,this._textureWidth,this._textureHeight,m,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const m of this._scene.meshes)m.morphTargetManager===this&&m._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const h=this._parentContainer.morphTargetManagers.indexOf(this);h>-1&&this._parentContainer.morphTargetManagers.splice(h,1),this._parentContainer=null}for(const h of this._targets)this._scene.stopAnimation(h)}}static Parse(h,d){const m=new c(d);for(const j of h.targets)m.addTarget(F.e.Parse(j,d));return m}}c.EnableTextureStorage=!0,c.MaxActiveMorphTargetsInVertexAttributeMode=8,c.ConstantTargetCountForTextureMode=0;var k=m(12596),l=m(11150),K=m(11303);const N=new Map,W=N;function r(h,d,m){Y(h)&&Z.c.Warn(`Extension with the name '${h}' already exists`),N.set(h,{isGLTFExtension:d,factory:m})}function Y(h){return N.delete(h)}var x=m(12608),Q=m(11803),t=m(11290);class U{static Get(h,d,m){if(!d||void 0==m||!d[m])throw new Error(`${h}: Failed to find index (${m})`);return d[m]}static TryGet(h,d){return h&&void 0!=d&&h[d]?h[d]:null}static Assign(h){if(h)for(let d=0;d<h.length;d++)h[d].index=d}}function s(h){if(h.min&&h.max){const d=h.min,m=h.max,j=A.d.Qd[0].xd(d[0],d[1],d[2]),b=A.d.Qd[1].xd(m[0],m[1],m[2]);if(h.normalized&&5126!==h.componentType){let d=1;switch(h.componentType){case 5120:d=127;break;case 5121:d=255;break;case 5122:d=32767;break;case 5123:d=65535}const m=1/d;j.scaleInPlace(m),b.scaleInPlace(m)}return new K.e(j,b)}return null}class J{static RegisterExtension(h,d){r(h,!1,d)}static UnregisterExtension(h){return Y(h)}get mb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(h){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=h}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((h=>h.dispose&&h.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(h,d,m,j,A,b){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=d,this._assetContainer=m,this._loadData(j);let b=null;if(h){const d={};if(this._gltf.nodes)for(const h of this._gltf.nodes)h.name&&(d[h.name]=h.index);b=(h instanceof Array?h:[h]).map((h=>{const m=d[h];if(void 0===m)throw new Error(`Failed to find node '${h}'`);return m}))}return await this._loadAsync(A,w,b,(()=>({meshes:this._getMeshes(),aE:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=h,this._loadData(d),await this._loadAsync(m,A,null,(()=>{}))}async _loadAsync(h,d,m,j){return await Promise.resolve().then((async()=>{this._rootUrl=h,this._uniqueRootUrl=!h.startsWith("file:")&&d?h:`${h}${Date.now()}/`,this._fileName=d,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const A=`${k.l[k.l.LOADING]} => ${k.l[k.l.READY]}`,b=`${k.l[k.l.LOADING]} => ${k.l[k.l.COMPLETE]}`;this._parent._startPerformanceCounter(A),this._parent._startPerformanceCounter(b),this._parent._setState(k.l.LOADING),this._extensionsOnLoading();const a=new Array;if(!this.parent.loadOnlyMaterials)if(m)a.push(this.loadSceneAsync("/nodes",{nodes:m,index:-1}));else if(void 0!=this._gltf.Fd||this._gltf.scenes&&this._gltf.scenes[0]){const h=U.Get("/scene",this._gltf.scenes,this._gltf.Fd||0);a.push(this.loadSceneAsync(`/scenes/${h.index}`,h))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let h=0;h<this._gltf.materials.length;++h){const d=this._gltf.materials[h],m="/materials/"+h,j=V.d.TriangleFillMode;a.push(this._loadMaterialAsync(m,d,null,j,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&a.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&a.push(this._compileShadowGeneratorsAsync());const D=Promise.all(a).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.jD(!0);for(const h of this._babylonScene.materials){const d=h;void 0!==d.maxSimultaneousLights&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(k.l.READY),this._skipStartAnimationStep||this._startAnimations(),j()}));return await D.then((h=>(this._parent._endPerformanceCounter(A),w.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(b),this._parent._setState(k.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(h=>{this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()}))})),h)))})).catch((h=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()),h}))}_loadData(h){if(this._gltf=h.json,this._setupData(),h.bin){const d=this._gltf.buffers;if(d&&d[0]&&!d[0].uri){const m=d[0];(m.byteLength<h.bin.byteLength-3||m.byteLength>h.bin.byteLength)&&Z.c.Warn(`Binary buffer length (${m.byteLength}) from JSON does not match chunk length (${h.bin.byteLength})`),this._bin=h.bin}else Z.c.Warn("Unexpected BIN chunk")}}_setupData(){if(U.Assign(this._gltf.accessors),U.Assign(this._gltf.animations),U.Assign(this._gltf.buffers),U.Assign(this._gltf.bufferViews),U.Assign(this._gltf.cameras),U.Assign(this._gltf.images),U.Assign(this._gltf.materials),U.Assign(this._gltf.meshes),U.Assign(this._gltf.nodes),U.Assign(this._gltf.samplers),U.Assign(this._gltf.scenes),U.Assign(this._gltf.skins),U.Assign(this._gltf.textures),this._gltf.nodes){const h={};for(const m of this._gltf.nodes)if(m.children)for(const d of m.children)h[d]=m.index;const d=this._createRootNode();for(const m of this._gltf.nodes){const j=h[m.index];m.parent=void 0===j?d:this._gltf.nodes[j]}}}async _loadExtensionsAsync(){const h=[];if(W.forEach(((d,m)=>{var j;!1===(null===(j=this.parent.extensionOptions[m])||void 0===j?void 0:j.enabled)?d.isGLTFExtension&&this.isExtensionUsed(m)&&Z.c.Warn(`Extension ${m} is used but has been explicitly disabled.`):d.isGLTFExtension&&!this.isExtensionUsed(m)||h.push((async()=>{const h=await d.factory(this);return h.name!==m&&Z.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${h.name} !== ${m}`),this._parent.onExtensionLoadedObservable.notifyObservers(h),h})())})),this._extensions.push(...await Promise.all(h)),this._extensions.sort(((h,d)=>(h.order||Number.MAX_VALUE)-(d.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const m of this._gltf.extensionsRequired){if(!this._extensions.some((h=>h.name===m&&h.enabled))){var d;if(!1===(null===(d=this.parent.extensionOptions[m])||void 0===d?void 0:d.enabled))throw new Error(`Required extension ${m} is disabled`);throw new Error(`Required extension ${m} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new g.d("__root__",this._babylonScene);this._rootBabylonMesh=h,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.jD(!1);const d={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.j.AUTO:this._babylonScene.useRightHandedSystem||(d.rotation=[0,1,0,0],d.scale=[1,1,-1],J._LoadTransform(d,this._rootBabylonMesh));break;case k.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(h),d}loadSceneAsync(h,d){const m=this._extensionsLoadSceneAsync(h,d);if(m)return m;const j=new Array;if(this.logOpen(`${h} ${d.name||""}`),d.nodes)for(const A of d.nodes){const d=U.Get(`${h}/nodes/${A}`,this._gltf.nodes,A);j.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(h=>{h.parent=this._rootBabylonMesh})))}for(const A of this._postSceneLoadActions)A();return j.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(j).then((()=>{}))}_forEachPrimitive(h,d){if(h._primitiveBabylonMeshes)for(const m of h._primitiveBabylonMeshes)d(m)}_getGeometries(){const h=[],d=this._gltf.nodes;if(d)for(const m of d)this._forEachPrimitive(m,(d=>{const m=d.Ld;m&&-1===h.indexOf(m)&&h.push(m)}));return h}_getMeshes(){const h=[];this._rootBabylonMesh instanceof i.b&&h.push(this._rootBabylonMesh);const d=this._gltf.nodes;if(d)for(const m of d)this._forEachPrimitive(m,(d=>{h.push(d)}));return h}_getTransformNodes(){const h=[],d=this._gltf.nodes;if(d)for(const m of d)m._babylonTransformNode&&"Ib"===m._babylonTransformNode.getClassName()&&h.push(m._babylonTransformNode),m._babylonTransformNodeForSkin&&h.push(m._babylonTransformNodeForSkin);return h}_getSkeletons(){const h=[],d=this._gltf.skins;if(d)for(const m of d)m._data&&h.push(m._data.babylonSkeleton);return h}_getAnimationGroups(){const h=[],d=this._gltf.animations;if(d)for(const m of d)m._babylonAnimationGroup&&h.push(m._babylonAnimationGroup);return h}_startAnimations(){switch(this._parent.animationStartMode){case k.f.NONE:break;case k.f.FIRST:{const h=this._getAnimationGroups();0!==h.length&&h[0].start(!0);break}case k.f.ALL:{const h=this._getAnimationGroups();for(const d of h)d.start(!0);break}default:return void Z.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadNodeAsync(h,d,m);if(j)return j;if(d._babylonTransformNode)throw new Error(`${h}: Invalid recursive node hierarchy`);const A=new Array;this.logOpen(`${h} ${d.name||""}`);const b=j=>{if(J.AddPointerMetadata(j,h),J._LoadTransform(d,j),void 0!=d.camera){const m=U.Get(`${h}/camera`,this._gltf.cameras,d.camera);A.push(this.loadCameraAsync(`/cameras/${m.index}`,m,(h=>{h.parent=j,this._babylonScene.useRightHandedSystem||(j.td.x=-1)})))}if(d.children)for(const m of d.children){const d=U.Get(`${h}/children/${m}`,this._gltf.nodes,m);A.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(h=>{h.parent=j})))}m(j)},w=void 0!=d.mesh,a=this._parent.loadSkins&&void 0!=d.skin;if(!w||a){const h=d.name||`node${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new T.c(h,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==d.mesh?d._babylonTransformNode=m:d._babylonTransformNodeForSkin=m,b(m)}if(w)if(a){const m=U.Get(`${h}/mesh`,this._gltf.meshes,d.mesh);A.push(this._loadMeshAsync(`/meshes/${m.index}`,d,m,(m=>{const j=d._babylonTransformNodeForSkin;m.metadata=(0,Q.d)(j.metadata,m.metadata||{});const b=U.Get(`${h}/skin`,this._gltf.skins,d.skin);A.push(this._loadSkinAsync(`/skins/${b.index}`,d,b,(h=>{this._forEachPrimitive(d,(d=>{d.skeleton=h})),this._postSceneLoadActions.push((()=>{if(void 0!=b.skeleton){const h=U.Get(`/skins/${b.index}/skeleton`,this._gltf.nodes,b.skeleton).parent;d.index===h.index?m.parent=j.parent:m.parent=h._babylonTransformNode}else m.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:j,skinnedNode:m})}))})))})))}else{const m=U.Get(`${h}/mesh`,this._gltf.meshes,d.mesh);A.push(this._loadMeshAsync(`/meshes/${m.index}`,d,m,b))}return this.logClose(),Promise.all(A).then((()=>(this._forEachPrimitive(d,(h=>{const d=h;!d.isAnInstance&&d.Ld&&d.Ld.useBoundingInfoFromGeometry?h.rh():h.refreshBoundingInfo(!0,!0)})),d._babylonTransformNode)))}_loadMeshAsync(h,d,m,j){const A=m.primitives;if(!A||!A.length)throw new Error(`${h}: Primitives are missing`);void 0==A[0].index&&U.Assign(A);const b=new Array;this.logOpen(`${h} ${m.name||""}`);const w=d.name||`node${d.index}`;if(1===A.length){const j=m.primitives[0];b.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${j.index}`,w,d,m,j,(h=>{d._babylonTransformNode=h,d._primitiveBabylonMeshes=[h]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,d._babylonTransformNode=new T.c(w,this._babylonScene),d._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._primitiveBabylonMeshes=[];for(const j of A)b.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${j.index}`,`${w}_primitive${j.index}`,d,m,j,(h=>{h.parent=d._babylonTransformNode,d._primitiveBabylonMeshes.push(h)})))}return j(d._babylonTransformNode),this.logClose(),Promise.all(b).then((()=>d._babylonTransformNode))}_loadMeshPrimitiveAsync(h,d,m,j,A,b){const w=this._extensionsLoadMeshPrimitiveAsync(h,d,m,j,A,b);if(w)return w;this.logOpen(`${h}`);const a=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==m.skin&&!j.primitives[0].targets;let D,S;if(a&&A._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,D=A._instanceData.babylonSourceMesh.createInstance(d),D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S=A._instanceData.promise;else{const b=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new g.d(d,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.sideOrientation=this._babylonScene.useRightHandedSystem?V.d.CounterClockWiseSideOrientation:V.d.ClockWiseSideOrientation,this._createMorphTargets(h,m,j,A,w),b.push(this._loadVertexDataAsync(h,A,w).then((async d=>await this._loadMorphTargetsAsync(h,A,w,d).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,d.Nh(w),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const M=J._GetDrawMode(h,A.mode);if(void 0==A.material){let h=this._defaultBabylonMaterialData[M];h||(h=this._createDefaultMaterial("__GLTFLoader._default",M),this._parent.onMaterialLoadedObservable.notifyObservers(h),this._defaultBabylonMaterialData[M]=h),w.material=h}else if(!this.parent.skipMaterials){const d=U.Get(`${h}/material`,this._gltf.materials,A.material);b.push(this._loadMaterialAsync(`/materials/${d.index}`,d,w,M,(h=>{w.material=h})))}S=Promise.all(b),a&&(A._instanceData={babylonSourceMesh:w,promise:S}),D=w}return J.AddPointerMetadata(D,h),this._parent.onMeshLoadedObservable.notifyObservers(D),b(D),this.logClose(),S.then((()=>D))}_loadVertexDataAsync(h,d,m){const j=this._extensionsLoadVertexDataAsync(h,d,m);if(j)return j;const A=d.attributes;if(!A)throw new Error(`${h}: Attributes are missing`);const b=new Array,w=new y.b(m.name,this._babylonScene);if(void 0==d.indices)m.isUnIndexed=!0;else{const m=U.Get(`${h}/indices`,this._gltf.accessors,d.indices);b.push(this._loadIndicesAccessorAsync(`/accessors/${m.index}`,m).then((h=>{w.setIndices(h)})))}const a=(d,j,a)=>{if(void 0==A[d])return;m._delayInfo=m._delayInfo||[],-1===m._delayInfo.indexOf(j)&&m._delayInfo.push(j);const D=U.Get(`${h}/attributes/${d}`,this._gltf.accessors,A[d]);b.push(this._loadVertexAccessorAsync(`/accessors/${D.index}`,D,j).then((h=>{if(h.getKind()===o.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!m.skeleton){const h=s(D);h&&(w._boundingInfo=h,w.useBoundingInfoFromGeometry=!0)}w.setVerticesBuffer(h,D.count)}))),j==o.d.MatricesIndicesExtraKind&&(m.numBoneInfluencers=8),a&&a(D)};return a("POSITION",o.d.PositionKind),a("NORMAL",o.d.NormalKind),a("TANGENT",o.d.TangentKind),a("TEXCOORD_0",o.d.UVKind),a("TEXCOORD_1",o.d.UV2Kind),a("TEXCOORD_2",o.d.UV3Kind),a("TEXCOORD_3",o.d.UV4Kind),a("TEXCOORD_4",o.d.UV5Kind),a("TEXCOORD_5",o.d.UV6Kind),a("JOINTS_0",o.d.MatricesIndicesKind),a("WEIGHTS_0",o.d.MatricesWeightsKind),a("JOINTS_1",o.d.MatricesIndicesExtraKind),a("WEIGHTS_1",o.d.MatricesWeightsExtraKind),a("COLOR_0",o.d.ColorKind,(h=>{"VEC4"===h.type&&(m.hasVertexAlpha=!0)})),Promise.all(b).then((()=>w))}_createMorphTargets(h,d,m,j,A){if(!j.targets||!this._parent.loadMorphTargets)return;if(void 0==d._numMorphTargets)d._numMorphTargets=j.targets.length;else if(j.targets.length!==d._numMorphTargets)throw new Error(`${h}: Primitives do not have the same number of targets`);const b=m.extras?m.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,A.morphTargetManager=new c(this._babylonScene),A.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.morphTargetManager.areUpdatesFrozen=!0;for(let w=0;w<j.targets.length;w++){const h=d.weights?d.weights[w]:m.weights?m.weights[w]:0,j=b?b[w]:`morphTarget${w}`;A.morphTargetManager.addTarget(new F.e(j,h,A.ih()))}}_loadMorphTargetsAsync(h,d,m,j){if(!d.targets||!this._parent.loadMorphTargets)return Promise.resolve();const A=new Array,b=m.morphTargetManager;for(let w=0;w<b.numTargets;w++){const m=b.getTarget(w);A.push(this._loadMorphTargetVertexDataAsync(`${h}/targets/${w}`,j,d.targets[w],m))}return Promise.all(A).then((()=>{b.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(h,d,m,j){const A=new Array,b=(j,b,w)=>{if(void 0==m[j])return;const a=d.getVertexBuffer(b);if(!a)return;const D=U.Get(`${h}/${j}`,this._gltf.accessors,m[j]);A.push(this._loadFloatAccessorAsync(`/accessors/${D.index}`,D).then((h=>{w(a,h)})))};return b("POSITION",o.d.PositionKind,((h,d)=>{const m=new Float32Array(d.length);h.forEach(d.length,((h,j)=>{m[j]=d[j]+h})),j.setPositions(m)})),b("NORMAL",o.d.NormalKind,((h,d)=>{const m=new Float32Array(d.length);h.forEach(m.length,((h,j)=>{m[j]=d[j]+h})),j.setNormals(m)})),b("TANGENT",o.d.TangentKind,((h,d)=>{const m=new Float32Array(d.length/3*4);let A=0;h.forEach(d.length/3*4,((h,j)=>{(j+1)%4!==0&&(m[A]=d[A]+h,A++)})),j.setTangents(m)})),b("TEXCOORD_0",o.d.UVKind,((h,d)=>{const m=new Float32Array(d.length);h.forEach(d.length,((h,j)=>{m[j]=d[j]+h})),j.setUVs(m)})),b("TEXCOORD_1",o.d.UV2Kind,((h,d)=>{const m=new Float32Array(d.length);h.forEach(d.length,((h,j)=>{m[j]=d[j]+h})),j.setUV2s(m)})),b("COLOR_0",o.d.ColorKind,((d,m)=>{let A=null;const b=d.getSize();if(3===b){A=new Float32Array(m.length/3*4),d.forEach(m.length,((h,d)=>{const j=Math.floor(d/3),b=d%3;A[4*j+b]=m[3*j+b]+h}));for(let h=0;h<m.length/3;++h)A[4*h+3]=1}else{if(4!==b)throw new Error(`${h}: Invalid number of components (${b}) for COLOR_0 attribute`);A=new Float32Array(m.length),d.forEach(m.length,((h,d)=>{A[d]=m[d]+h}))}j.setColors(A)})),await Promise.all(A).then((()=>{}))}static _LoadTransform(h,d){if(void 0!=h.skin)return;let m=A.i.Zero(),j=A.c.Identity(),b=A.i.One();if(h.matrix){A.b.Ud(h.matrix).decompose(b,j,m)}else h.translation&&(m=A.i.Ud(h.translation)),h.rotation&&(j=A.c.Ud(h.rotation)),h.scale&&(b=A.i.Ud(h.scale));d.position=m,d.rotationQuaternion=j,d.td=b}_loadSkinAsync(h,d,m,j){if(!this._parent.loadSkins)return Promise.resolve();const A=this._extensionsLoadSkinAsync(h,d,m);if(A)return A;if(m._data)return j(m._data.babylonSkeleton),m._data.promise;const b=`skeleton${m.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new B(m.name||b,b,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(h,m,w);const a=this._loadSkinInverseBindMatricesDataAsync(h,m).then((h=>{this._updateBoneMatrices(w,h)}));return m._data={babylonSkeleton:w,promise:a},j(w),a}_loadBones(h,d,m){if(void 0==d.skeleton||this._parent.alwaysComputeSkeletonRootNode){const m=this._findSkeletonRootNode(`${h}/joints`,d.joints);if(m)if(void 0===d.skeleton)d.skeleton=m.index;else{const j=(h,d)=>{for(;d.parent;d=d.parent)if(d.parent===h)return!0;return!1},A=U.Get(`${h}/skeleton`,this._gltf.nodes,d.skeleton);A===m||j(A,m)||(Z.c.Warn(`${h}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),d.skeleton=m.index)}else Z.c.Warn(`${h}: Failed to find common root`)}const j={};for(const A of d.joints){const b=U.Get(`${h}/joints/${A}`,this._gltf.nodes,A);this._loadBone(b,d,m,j)}}_findSkeletonRootNode(h,d){if(0===d.length)return null;const m={};for(const A of d){const d=[];let j=U.Get(`${h}/${A}`,this._gltf.nodes,A);for(;-1!==j.index;)d.unshift(j),j=j.parent;m[A]=d}let j=null;for(let A=0;;++A){let h=m[d[0]];if(A>=h.length)return j;const b=h[A];for(let w=1;w<d.length;++w)if(h=m[d[w]],A>=h.length||b!==h[A])return j;j=b}}_loadBone(h,d,m,j){h._isJoint=!0;let A=j[h.index];if(A)return A;let b=null;h.index!==d.skeleton&&(h.parent&&-1!==h.parent.index?b=this._loadBone(h.parent,d,m,j):void 0!==d.skeleton&&Z.c.Warn(`/skins/${d.index}/skeleton: Skeleton node is not a common root`));const w=d.joints.indexOf(h.index);return A=new S.e(h.name||`joint${h.index}`,m,b,this._getNodeMatrix(h),null,null,w),j[h.index]=A,this._postSceneLoadActions.push((()=>{A.linkTransformNode(h._babylonTransformNode)})),A}_loadSkinInverseBindMatricesDataAsync(h,d){if(void 0==d.inverseBindMatrices)return Promise.resolve(null);const m=U.Get(`${h}/inverseBindMatrices`,this._gltf.accessors,d.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${m.index}`,m)}_updateBoneMatrices(h,d){for(const m of h.bones){const h=A.b.Identity(),j=m._index;d&&-1!==j&&(A.b.FromArrayToRef(d,16*j,h),h.invertToRef(h));const b=m.getParent();b&&h.multiplyToRef(b.getAbsoluteInverseBindMatrix(),h),m.hb(h,!1,!1),m._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(h){return h.matrix?A.b.Ud(h.matrix):A.b.Compose(h.scale?A.i.Ud(h.scale):A.i.One(),h.rotation?A.c.Ud(h.rotation):A.c.Identity(),h.translation?A.i.Ud(h.translation):A.i.Zero())}loadCameraAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadCameraAsync(h,d,m);if(j)return j;const b=new Array;this.logOpen(`${h} ${d.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new D.b(d.name||`camera${d.index}`,A.i.Zero(),this._babylonScene,!1);switch(w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonCamera=w,w.setTarget(new A.i(0,0,-1)),d.type){case"perspective":{const m=d.perspective;if(!m)throw new Error(`${h}: Camera perspective properties are missing`);w.fov=m.yfov,w.jb=m.znear,w.maxZ=m.zfar||0;break}case"orthographic":if(!d.orthographic)throw new Error(`${h}: Camera orthographic properties are missing`);w.mode=a.e.ORTHOGRAPHIC_CAMERA,w.orthoLeft=-d.orthographic.xmag,w.orthoRight=d.orthographic.xmag,w.orthoBottom=-d.orthographic.ymag,w.orthoTop=d.orthographic.ymag,w.jb=d.orthographic.znear,w.maxZ=d.orthographic.zfar;break;default:throw new Error(`${h}: Invalid camera type (${d.type})`)}return J.AddPointerMetadata(w,h),this._parent.onCameraLoadedObservable.notifyObservers(w),m(w),this.logClose(),Promise.all(b).then((()=>w))}_loadAnimationsAsync(){const h=this._gltf.animations;if(!h)return Promise.resolve();const d=new Array;for(let m=0;m<h.length;m++){const j=h[m];d.push(this.loadAnimationAsync(`/animations/${j.index}`,j).then((h=>{0===h.targetedAnimations.length&&h.dispose()})))}return Promise.all(d).then((()=>{}))}loadAnimationAsync(h,d){const j=this._extensionsLoadAnimationAsync(h,d);return j||m.e(58).then(m.bind(m,14043)).then((m=>{let{AnimationGroup:j}=m;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new j(d.name||`animation${d.index}`,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonAnimationGroup=A;const b=new Array;U.Assign(d.channels),U.Assign(d.samplers);for(const w of d.channels)b.push(this._loadAnimationChannelAsync(`${h}/channels/${w.index}`,h,d,w,((h,d)=>{h.animations=h.animations||[],h.animations.push(d),A.addTargetedAnimation(d,h)})));return Promise.all(b).then((()=>(A.normalize(0),A)))}))}async _loadAnimationChannelAsync(h,d,j,A,b){const w=this._extensionsLoadAnimationChannelAsync(h,d,j,A,b);if(w)return await w;if(void 0==A.target.node)return await Promise.resolve();const a=U.Get(`${h}/target/node`,this._gltf.nodes,A.target.node),D=A.target.path,S="weights"===D;if(S&&!a._numMorphTargets||!S&&!a._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!S&&!a._isJoint)return await Promise.resolve();let M;switch(await Promise.resolve().then(m.bind(m,12615)),D){case"translation":var q;M=null===(q=(0,x.e)("/nodes/{}/translation"))||void 0===q?void 0:q.interpolation;break;case"rotation":var E;M=null===(E=(0,x.e)("/nodes/{}/rotation"))||void 0===E?void 0:E.interpolation;break;case"scale":var I;M=null===(I=(0,x.e)("/nodes/{}/scale"))||void 0===I?void 0:I.interpolation;break;case"weights":var R;M=null===(R=(0,x.e)("/nodes/{}/weights"))||void 0===R?void 0:R.interpolation;break;default:throw new Error(`${h}/target/path: Invalid value (${A.target.path})`)}if(!M)throw new Error(`${h}/target/path: Could not find interpolation properties for target path (${A.target.path})`);const Z={object:a,info:M};return await this._loadAnimationChannelFromTargetInfoAsync(h,d,j,A,Z,b)}_loadAnimationChannelFromTargetInfoAsync(h,d,m,j,A,b){const w=this.parent.targetFps,a=1/w,D=U.Get(`${h}/sampler`,m.samplers,j.sampler);return this._loadAnimationSamplerAsync(`${d}/samplers/${j.sampler}`,D).then((h=>{let d=0;const D=A.object,S=A.info;for(const A of S){const S=A.getStride(D),M=h.input,q=h.output,E=new Array(M.length);let I=0;switch(h.interpolation){case"STEP":for(let h=0;h<M.length;h++){const d=A.getValue(D,q,I,1);I+=S,E[h]={frame:M[h]*w,value:d,interpolation:1}}break;case"CUBICSPLINE":for(let h=0;h<M.length;h++){const d=A.getValue(D,q,I,a);I+=S;const m=A.getValue(D,q,I,1);I+=S;const j=A.getValue(D,q,I,a);I+=S,E[h]={frame:M[h]*w,inTangent:d,value:m,outTangent:j}}break;case"LINEAR":for(let h=0;h<M.length;h++){const d=A.getValue(D,q,I,1);I+=S,E[h]={frame:M[h]*w,value:d}}}if(I>0){const h=`${m.name||`animation${m.index}`}_channel${j.index}_${d}`,a=A.buildAnimations(D,h,w,E);for(const m of a)d++,b(m.babylonAnimatable,m.babylonAnimation)}}}))}_loadAnimationSamplerAsync(h,d){if(d._data)return d._data;const m=d.interpolation||"LINEAR";switch(m){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${h}/interpolation: Invalid value (${d.interpolation})`)}const j=U.Get(`${h}/input`,this._gltf.accessors,d.input),A=U.Get(`${h}/output`,this._gltf.accessors,d.output);return d._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${j.index}`,j),this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)]).then((h=>{let[d,j]=h;return{input:d,interpolation:m,output:j}})),d._data}loadBufferAsync(h,d,m,j){const A=this._extensionsLoadBufferAsync(h,d,m,j);if(A)return A;if(!d._data)if(d.uri)d._data=this.loadUriAsync(`${h}/uri`,d,d.uri);else{if(!this._bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);d._data=this._bin.readAsync(0,d.byteLength)}return d._data.then((d=>{try{return new Uint8Array(d.buffer,d.byteOffset+m,j)}catch(A){throw new Error(`${h}: ${A.message}`)}}))}loadBufferViewAsync(h,d){const m=this._extensionsLoadBufferViewAsync(h,d);if(m)return m;if(d._data)return d._data;const j=U.Get(`${h}/buffer`,this._gltf.buffers,d.buffer);return d._data=this.loadBufferAsync(`/buffers/${j.index}`,j,d.byteOffset||0,d.byteLength),d._data}_loadAccessorAsync(h,d,m){if(d._data)return d._data;const j=J._GetNumComponents(h,d.type),A=j*o.d.GetTypeByteLength(d.componentType),b=j*d.count;if(void 0==d.bufferView)d._data=Promise.resolve(new m(b));else{const w=U.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((a=>{if(5126!==d.componentType||d.normalized||w.byteStride&&w.byteStride!==A){const h=new m(b);return o.d.ForEach(a,d.byteOffset||0,w.byteStride||A,j,d.componentType,h.length,d.normalized||!1,((d,m)=>{h[m]=d})),h}return J._GetTypedArray(h,d.componentType,a,d.byteOffset,b)}))}if(d.sparse){const b=d.sparse;d._data=d._data.then((w=>{const a=w,D=U.Get(`${h}/sparse/indices/bufferView`,this._gltf.bufferViews,b.indices.bufferView),S=U.Get(`${h}/sparse/values/bufferView`,this._gltf.bufferViews,b.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${D.index}`,D),this.loadBufferViewAsync(`/bufferViews/${S.index}`,S)]).then((w=>{let[D,S]=w;const M=J._GetTypedArray(`${h}/sparse/indices`,b.indices.componentType,D,b.indices.byteOffset,b.count),q=j*b.count;let E;if(5126!==d.componentType||d.normalized){const w=J._GetTypedArray(`${h}/sparse/values`,d.componentType,S,b.values.byteOffset,q);E=new m(q),o.d.ForEach(w,0,A,j,d.componentType,E.length,d.normalized||!1,((h,d)=>{E[d]=h}))}else E=J._GetTypedArray(`${h}/sparse/values`,d.componentType,S,b.values.byteOffset,q);let I=0;for(let h=0;h<M.length;h++){let d=M[h]*j;for(let h=0;h<j;h++)a[d++]=E[I++]}return a}))}))}return d._data}_loadFloatAccessorAsync(h,d){return this._loadAccessorAsync(h,d,Float32Array)}_loadIndicesAccessorAsync(h,d){if("SCALAR"!==d.type)throw new Error(`${h}/type: Invalid value ${d.type}`);if(5121!==d.componentType&&5123!==d.componentType&&5125!==d.componentType)throw new Error(`${h}/componentType: Invalid value ${d.componentType}`);if(d._data)return d._data;if(d.sparse){const m=J._GetTypedArrayConstructor(`${h}/componentType`,d.componentType);d._data=this._loadAccessorAsync(h,d,m)}else{const m=U.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((m=>J._GetTypedArray(h,d.componentType,m,d.byteOffset,d.count)))}return d._data}_loadVertexBufferViewAsync(h){if(h._babylonBuffer)return h._babylonBuffer;const d=this._babylonScene.getEngine();return h._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>new o.c(d,h,!1))),h._babylonBuffer}_loadVertexAccessorAsync(h,d,m){var j;if(null!==(j=d._babylonVertexBuffer)&&void 0!==j&&j[m])return d._babylonVertexBuffer[m];d._babylonVertexBuffer||(d._babylonVertexBuffer={});const A=this._babylonScene.getEngine();if(d.sparse||void 0==d.bufferView)d._babylonVertexBuffer[m]=this._loadFloatAccessorAsync(h,d).then((h=>new o.d(A,h,m,!1)));else{const j=U.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._babylonVertexBuffer[m]=this._loadVertexBufferViewAsync(j).then((b=>{const w=J._GetNumComponents(h,d.type);return new o.d(A,b,m,!1,void 0,j.byteStride,void 0,d.byteOffset,w,d.componentType,d.normalized,!0,void 0,!0)}))}return d._babylonVertexBuffer[m]}_loadMaterialMetallicRoughnessPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return d&&(d.baseColorFactor?(m.albedoColor=b.d.Ud(d.baseColorFactor),m.alpha=d.baseColorFactor[3]):m.albedoColor=b.d.White(),m.metallic=void 0==d.metallicFactor?1:d.metallicFactor,m.roughness=void 0==d.roughnessFactor?1:d.roughnessFactor,d.baseColorTexture&&j.push(this.loadTextureInfoAsync(`${h}/baseColorTexture`,d.baseColorTexture,(h=>{h.name=`${m.name} (Base Color)`,m.albedoTexture=h}))),d.metallicRoughnessTexture&&(d.metallicRoughnessTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${h}/metallicRoughnessTexture`,d.metallicRoughnessTexture,(h=>{h.name=`${m.name} (Metallic Roughness)`,m.metallicTexture=h}))),m.useMetallnessFromMetallicTextureBlue=!0,m.useRoughnessFromMetallicTextureGreen=!0,m.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(j).then((()=>{}))}_loadMaterialAsync(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const b=this._extensionsLoadMaterialAsync(h,d,m,j,A);if(b)return b;d._data=d._data||{};let w=d._data[j];if(!w){this.logOpen(`${h} ${d.name||""}`);const m=this.createMaterial(h,d,j);w={babylonMaterial:m,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(h,d,m)},d._data[j]=w,J.AddPointerMetadata(m,h),this._parent.onMaterialLoadedObservable.notifyObservers(m),this.logClose()}return m&&(w.babylonMeshes.push(m),m.pd.addOnce((()=>{const h=w.babylonMeshes.indexOf(m);-1!==h&&w.babylonMeshes.splice(h,1)}))),A(w.babylonMaterial),w.promise.then((()=>w.babylonMaterial))}_createDefaultMaterial(h,d){this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new v.d(h,this._babylonScene);return m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.fillMode=d,m.enableSpecularAntiAliasing=!0,m.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,m.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,m.transparencyMode=v.d.PBRMATERIAL_OPAQUE,m.metallic=1,m.roughness=1,m}createMaterial(h,d,m){const j=this._extensionsCreateMaterial(h,d,m);if(j)return j;const A=d.name||`material${d.index}`;return this._createDefaultMaterial(A,m)}loadMaterialPropertiesAsync(h,d,m){const j=this._extensionsLoadMaterialPropertiesAsync(h,d,m);if(j)return j;const A=new Array;return A.push(this.loadMaterialBasePropertiesAsync(h,d,m)),d.pbrMetallicRoughness&&A.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${h}/pbrMetallicRoughness`,d.pbrMetallicRoughness,m)),this.loadMaterialAlphaProperties(h,d,m),Promise.all(A).then((()=>{}))}loadMaterialBasePropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return m.emissiveColor=d.emissiveFactor?b.d.Ud(d.emissiveFactor):new b.d(0,0,0),d.doubleSided&&(m.yd=!1,m.twoSidedLighting=!0),d.normalTexture&&(d.normalTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${h}/normalTexture`,d.normalTexture,(h=>{h.name=`${m.name} (Normal)`,m.bumpTexture=h}))),m.invertNormalMapX=!this._babylonScene.useRightHandedSystem,m.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=d.normalTexture.scale&&m.bumpTexture&&(m.bumpTexture.level=d.normalTexture.scale),m.forceIrradianceInFragment=!0),d.occlusionTexture&&(d.occlusionTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${h}/occlusionTexture`,d.occlusionTexture,(h=>{h.name=`${m.name} (Occlusion)`,m.ambientTexture=h}))),m.useAmbientInGrayScale=!0,void 0!=d.occlusionTexture.strength&&(m.ambientTextureStrength=d.occlusionTexture.strength)),d.emissiveTexture&&j.push(this.loadTextureInfoAsync(`${h}/emissiveTexture`,d.emissiveTexture,(h=>{h.name=`${m.name} (Emissive)`,m.emissiveTexture=h}))),Promise.all(j).then((()=>{}))}loadMaterialAlphaProperties(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);switch(d.alphaMode||"OPAQUE"){case"OPAQUE":m.transparencyMode=v.d.PBRMATERIAL_OPAQUE,m.alpha=1;break;case"MASK":m.transparencyMode=v.d.PBRMATERIAL_ALPHATEST,m.alphaCutOff=void 0==d.alphaCutoff?.5:d.alphaCutoff,m.albedoTexture&&(m.albedoTexture.Nd=!0);break;case"BLEND":m.transparencyMode=v.d.PBRMATERIAL_ALPHABLEND,m.albedoTexture&&(m.albedoTexture.Nd=!0,m.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${h}/alphaMode: Invalid value (${d.alphaMode})`)}}loadTextureInfoAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureInfoAsync(h,d,m);if(j)return j;if(this.logOpen(`${h}`),d.texCoord>=6)throw new Error(`${h}/texCoord: Invalid value (${d.texCoord})`);const A=U.Get(`${h}/index`,this._gltf.textures,d.index);A._textureInfo=d;const b=this._loadTextureAsync(`/textures/${d.index}`,A,(j=>{j.coordinatesIndex=d.texCoord||0,J.AddPointerMetadata(j,h),this._parent.onTextureLoadedObservable.notifyObservers(j),m(j)}));return this.logClose(),b}_loadTextureAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureAsync(h,d,m);if(j)return j;this.logOpen(`${h} ${d.name||""}`);const A=void 0==d.sampler?J.DefaultSampler:U.Get(`${h}/sampler`,this._gltf.samplers,d.sampler),b=U.Get(`${h}/source`,this._gltf.images,d.source),w=this._createTextureAsync(h,A,b,m,void 0,!d._textureInfo.nonColorData);return this.logClose(),w}_createTextureAsync(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},b=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0;const a=this._loadSampler(`/samplers/${d.index}`,d),D=new Array,S=new j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,u:()=>{this._disposed||S.resolve()},onError:(d,m)=>{this._disposed||S.reject(new Error(`${h}: ${m&&m.message?m.message:d||"Failed to load texture"}`))},mimeType:m.mimeType??(0,l.m)(m.uri??""),loaderOptions:b,useSRGBBuffer:!!w&&this._parent.useSRGBBuffers},q=new C.e(null,this._babylonScene,M);return q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D.push(S.promise),D.push(this.loadImageAsync(`/images/${m.index}`,m).then((h=>{const d=m.uri||`${this._fileName}#image${m.index}`,j=`data:${this._uniqueRootUrl}${d}`;q.updateURL(j,h);const A=q.getInternalTexture();A&&(A.label=m.name)}))),q.wrapU=a.wrapU,q.wrapV=a.wrapV,A(q),this._parent.useGltfTextureNames&&(q.name=m.name||m.uri||`image${m.index}`),Promise.all(D).then((()=>q))}_loadSampler(h,d){return d._data||(d._data={noMipMaps:9728===d.minFilter||9729===d.minFilter,samplingMode:J._GetTextureSamplingMode(h,d),wrapU:J._GetTextureWrapMode(`${h}/wrapS`,d.wrapS),wrapV:J._GetTextureWrapMode(`${h}/wrapT`,d.wrapT)}),d._data}loadImageAsync(h,d){if(!d._data){if(this.logOpen(`${h} ${d.name||""}`),d.uri)d._data=this.loadUriAsync(`${h}/uri`,d,d.uri);else{const m=U.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m)}this.logClose()}return d._data}loadUriAsync(h,d,m){const j=this._extensionsLoadUriAsync(h,d,m);if(j)return j;if(!J._ValidateUri(m))throw new Error(`${h}: '${m}' is invalid`);if((0,l.q)(m)){const d=new Uint8Array((0,l.e)(m));return this.log(`${h}: Decoded ${m.substring(0,64)}... (${d.length} bytes)`),Promise.resolve(d)}return this.log(`${h}: Loading ${m}`),this._parent.preprocessUrlAsync(this._rootUrl+m).then((d=>new Promise(((j,A)=>{this._parent._loadFile(this._babylonScene,d,(d=>{this._disposed||(this.log(`${h}: Loaded ${m} (${d.byteLength} bytes)`),j(new Uint8Array(d)))}),!0,(d=>{A(new l.s(`${h}: Failed to load '${m}'${d?": "+d.status+" "+d.statusText:""}`,d))}))}))))}static AddPointerMetadata(h,d){h.metadata=h.metadata||{};const m=h._internalMetadata=h._internalMetadata||{},j=m.mb=m.mb||{};(j.pointers=j.pointers||[]).push(d)}static _GetTextureWrapMode(h,d){switch(d=void 0==d?10497:d){case 33071:return C.e.CLAMP_ADDRESSMODE;case 33648:return C.e.MIRROR_ADDRESSMODE;case 10497:return C.e.WRAP_ADDRESSMODE;default:return Z.c.Warn(`${h}: Invalid value (${d})`),C.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(h,d){const m=void 0==d.magFilter?9729:d.magFilter,j=void 0==d.minFilter?9987:d.minFilter;if(9729===m)switch(j){case 9728:return C.e.LINEAR_NEAREST;case 9729:return C.e.LINEAR_LINEAR;case 9984:return C.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return C.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return C.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return C.e.LINEAR_LINEAR_MIPLINEAR;default:return Z.c.Warn(`${h}/minFilter: Invalid value (${j})`),C.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==m&&Z.c.Warn(`${h}/magFilter: Invalid value (${m})`),j){case 9728:return C.e.NEAREST_NEAREST;case 9729:return C.e.NEAREST_LINEAR;case 9984:return C.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return C.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return C.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return C.e.NEAREST_LINEAR_MIPLINEAR;default:return Z.c.Warn(`${h}/minFilter: Invalid value (${j})`),C.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(h,d){try{return(0,t.n)(d)}catch(m){throw new Error(`${h}: ${m.message}`)}}static _GetTypedArray(h,d,m,j,A){const b=m.buffer;j=m.byteOffset+(j||0);const w=J._GetTypedArrayConstructor(`${h}/componentType`,d),a=o.d.GetTypeByteLength(d);return j%a!==0?(Z.c.Warn(`${h}: Copying buffer as byte offset (${j}) is not a multiple of component type byte length (${a})`),new w(b.slice(j,j+A*a),0)):new w(b,j,A)}static _GetNumComponents(h,d){switch(d){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${h}: Invalid type (${d})`)}static _ValidateUri(h){return w.e.IsBase64(h)||-1===h.indexOf("..")}static _GetDrawMode(h,d){switch(void 0==d&&(d=4),d){case 0:return V.d.PointListDrawMode;case 1:return V.d.LineListDrawMode;case 2:return V.d.LineLoopDrawMode;case 3:return V.d.LineStripDrawMode;case 4:return V.d.TriangleFillMode;case 5:return V.d.TriangleStripDrawMode;case 6:return V.d.TriangleFanDrawMode}throw new Error(`${h}: Invalid mesh primitive mode (${d})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const h=new Array;if(this._gltf.materials)for(const d of this._gltf.materials)if(d._data)for(const m in d._data){const j=d._data[m];for(const d of j.babylonMeshes){d.Zd(!0);const m=j.babylonMaterial;h.push(m.forceCompilationAsync(d)),h.push(m.forceCompilationAsync(d,{useInstances:!0})),this._parent.useClipPlane&&(h.push(m.forceCompilationAsync(d,{clipPlane:!0})),h.push(m.forceCompilationAsync(d,{clipPlane:!0,useInstances:!0})))}}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const h=new Array,d=this._babylonScene.lights;for(const m of d){const d=m.getShadowGenerator();d&&h.push(d.forceCompilationAsync())}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(h){for(const d of this._extensions)d.enabled&&h(d)}_applyExtensions(h,d,m){for(const j of this._extensions)if(j.enabled){const A=`${j.name}.${d}`,b=h;b._activeLoaderExtensionFunctions=b._activeLoaderExtensionFunctions||{};const w=b._activeLoaderExtensionFunctions;if(!w[A]){w[A]=!0;try{const h=m(j);if(h)return h}finally{delete w[A]}}}return null}_extensionsOnLoading(){this._forEachExtensions((h=>h.onLoading&&h.onLoading()))}_extensionsOnReady(){this._forEachExtensions((h=>h.onReady&&h.onReady()))}_extensionsLoadSceneAsync(h,d){return this._applyExtensions(d,"loadScene",(m=>m.loadSceneAsync&&m.loadSceneAsync(h,d)))}_extensionsLoadNodeAsync(h,d,m){return this._applyExtensions(d,"loadNode",(j=>j.loadNodeAsync&&j.loadNodeAsync(h,d,m)))}_extensionsLoadCameraAsync(h,d,m){return this._applyExtensions(d,"loadCamera",(j=>j.loadCameraAsync&&j.loadCameraAsync(h,d,m)))}_extensionsLoadVertexDataAsync(h,d,m){return this._applyExtensions(d,"loadVertexData",(j=>j._loadVertexDataAsync&&j._loadVertexDataAsync(h,d,m)))}_extensionsLoadMeshPrimitiveAsync(h,d,m,j,A,b){return this._applyExtensions(A,"loadMeshPrimitive",(w=>w._loadMeshPrimitiveAsync&&w._loadMeshPrimitiveAsync(h,d,m,j,A,b)))}_extensionsLoadMaterialAsync(h,d,m,j,A){return this._applyExtensions(d,"loadMaterial",(b=>b._loadMaterialAsync&&b._loadMaterialAsync(h,d,m,j,A)))}_extensionsCreateMaterial(h,d,m){return this._applyExtensions(d,"createMaterial",(j=>j.createMaterial&&j.createMaterial(h,d,m)))}_extensionsLoadMaterialPropertiesAsync(h,d,m){return this._applyExtensions(d,"loadMaterialProperties",(j=>j.loadMaterialPropertiesAsync&&j.loadMaterialPropertiesAsync(h,d,m)))}_extensionsLoadTextureInfoAsync(h,d,m){return this._applyExtensions(d,"loadTextureInfo",(j=>j.loadTextureInfoAsync&&j.loadTextureInfoAsync(h,d,m)))}_extensionsLoadTextureAsync(h,d,m){return this._applyExtensions(d,"loadTexture",(j=>j._loadTextureAsync&&j._loadTextureAsync(h,d,m)))}_extensionsLoadAnimationAsync(h,d){return this._applyExtensions(d,"loadAnimation",(m=>m.loadAnimationAsync&&m.loadAnimationAsync(h,d)))}_extensionsLoadAnimationChannelAsync(h,d,m,j,A){return this._applyExtensions(m,"loadAnimationChannel",(b=>b._loadAnimationChannelAsync&&b._loadAnimationChannelAsync(h,d,m,j,A)))}_extensionsLoadSkinAsync(h,d,m){return this._applyExtensions(m,"loadSkin",(j=>j._loadSkinAsync&&j._loadSkinAsync(h,d,m)))}_extensionsLoadUriAsync(h,d,m){return this._applyExtensions(d,"loadUri",(j=>j._loadUriAsync&&j._loadUriAsync(h,d,m)))}_extensionsLoadBufferViewAsync(h,d){return this._applyExtensions(d,"loadBufferView",(m=>m.loadBufferViewAsync&&m.loadBufferViewAsync(h,d)))}_extensionsLoadBufferAsync(h,d,m,j){return this._applyExtensions(d,"loadBuffer",(A=>A.loadBufferAsync&&A.loadBufferAsync(h,d,m,j)))}static LoadExtensionAsync(h,d,m,j){if(!d.extensions)return null;const A=d.extensions[m];return A?j(`${h}/extensions/${m}`,A):null}static LoadExtraAsync(h,d,m,j){if(!d.extras)return null;const A=d.extras[m];return A?j(`${h}/extras/${m}`,A):null}isExtensionUsed(h){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(h)}logOpen(h){this._parent._logOpen(h)}logClose(){this._parent._logClose()}log(h){this._parent._log(h)}startPerformanceCounter(h){this._parent._startPerformanceCounter(h)}endPerformanceCounter(h){this._parent._endPerformanceCounter(h)}}J.DefaultSampler={index:-1},k.b._CreateGLTF2Loader=h=>new J(h);var O=m(12615),n=m(11516),p=m(11341),e=m(12623),X=m(12629);class z extends X.e{constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",h),this._texture=h.getEngine().createRawCubeTexture(d,m,j,A,b,w,a,D)}update(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,h,d,m,j,A)}updateRGBDAsync(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,e.e)(this._texture,h,d,m,j).then((()=>{}))}clone(){return p.d.Clone((()=>{const h=this.ih(),d=this._texture,m=new z(h,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return 13===d.source&&m.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),m}),this)}}const u="EXT_lights_image_based";class P{constructor(h){this.name=u,this._loader=h,this.enabled=this._loader.isExtensionUsed(u)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.mb.extensions;if(h&&h[this.name]){const d=h[this.name];this._lights=d.lights}}loadSceneAsync(h,d){return J.LoadExtensionAsync(h,d,this.name,(async(m,j)=>{this._loader._allMaterialsDirtyRequired=!0;const A=new Array;A.push(this._loader.loadSceneAsync(h,d)),this._loader.logOpen(`${m}`);const b=U.Get(`${m}/light`,this._lights,j.Rd);return A.push(this._loadLightAsync(`/extensions/${this.name}/lights/${j.Rd}`,b).then((h=>{this._loader.babylonScene.environmentTexture=h}))),this._loader.logClose(),await Promise.all(A).then((()=>{}))}))}_loadLightAsync(h,d){if(!d._loaded){const m=new Array;this._loader.logOpen(`${h}`);const j=new Array(d.specularImages.length);for(let A=0;A<d.specularImages.length;A++){const b=d.specularImages[A];j[A]=new Array(b.length);for(let d=0;d<b.length;d++){const w=`${h}/specularImages/${A}/${d}`;this._loader.logOpen(`${w}`);const a=b[d],D=U.Get(w,this._loader.mb.images,a);m.push(this._loader.loadImageAsync(`/images/${a}`,D).then((h=>{j[A][d]=h}))),this._loader.logClose()}}this._loader.logClose(),d._loaded=Promise.all(m).then((async()=>{const m=new z(this._loader.babylonScene,null,d.specularImageSize);if(m.name=d.name||"environment",d._babylonTexture=m,void 0!=d.ab&&(m.level=d.ab),d.rotation){let h=A.c.Ud(d.rotation);this._loader.babylonScene.useRightHandedSystem||(h=A.c.Inverse(h)),A.b.FromQuaternionToRef(h,m.getReflectionTextureMatrix())}if(!d.irradianceCoefficients)throw new Error(`${h}: Irradiance coefficients are missing`);const b=n.b.Ud(d.irradianceCoefficients);b.scaleInPlace(d.ab),b.convertIrradianceToLambertianRadiance();const w=n.d.FromHarmonics(b),a=(j.length-1)/Math.log2(d.specularImageSize);return await m.updateRGBDAsync(j,w,a)}))}return d._loaded.then((()=>d._babylonTexture))}}Y(u),r(u,!0,(h=>new P(h)));m(11767);const G="EXT_mesh_gpu_instancing";class hh{constructor(h){this.name=G,this._loader=h,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null}loadNodeAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(h,j)=>{this._loader._disableInstancedMesh++;const b=this._loader.loadNodeAsync(`/nodes/${d.index}`,d,m);if(this._loader._disableInstancedMesh--,!d._primitiveBabylonMeshes)return await b;const w=new Array;let a=0;const D=d=>{if(void 0==j.attributes[d])return void w.push(Promise.resolve(null));const m=U.Get(`${h}/attributes/${d}`,this._loader.mb.accessors,j.attributes[d]);if(w.push(this._loader._loadFloatAccessorAsync(`/accessors/${m.bufferView}`,m)),0===a)a=m.count;else if(a!==m.count)throw new Error(`${h}/attributes: Instance buffer accessors do not have the same count.`)};return D("TRANSLATION"),D("ROTATION"),D("SCALE"),await b.then((async h=>{const[m,j,b]=await Promise.all(w),D=new Float32Array(16*a);A.d.Qd[0].xd(0,0,0),A.d.Quaternion[0].xd(0,0,0,1),A.d.Qd[1].xd(1,1,1);for(let d=0;d<a;++d)m&&A.i.FromArrayToRef(m,3*d,A.d.Qd[0]),j&&A.c.FromArrayToRef(j,4*d,A.d.Quaternion[0]),b&&A.i.FromArrayToRef(b,3*d,A.d.Qd[1]),A.b.ComposeToRef(A.d.Qd[1],A.d.Quaternion[0],A.d.Qd[0],A.d.Matrix[0]),A.d.Matrix[0].copyToArray(D,16*d);for(const A of d._primitiveBabylonMeshes)A.iq("matrix",D,16,!0);return h}))}))}}Y(G),r(G,!0,(h=>new hh(h)));let dh=0,mh=null;class jh{static get Default(){return jh._Default||(jh._Default=new jh),jh._Default}constructor(){const h=jh.Configuration.decoder;this._decoderModulePromise=w.e.LoadBabylonScriptAsync(h.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(h,d,m,j,A){await this._decoderModulePromise,0===dh&&(MeshoptDecoder.useWorkers(1),dh=1);const b=await MeshoptDecoder.decodeGltfBufferAsync(d,m,h,j,A);return null!==mh&&clearTimeout(mh),mh=setTimeout((()=>{MeshoptDecoder.useWorkers(0),dh=0,mh=null}),1e3),b}}jh.Configuration={decoder:{url:`${w.e._DefaultCdnUrl}/meshopt_decoder.js`}},jh._Default=null;const Ah="EXT_meshopt_compression";class bh{constructor(h){this.name=Ah,this.enabled=h.isExtensionUsed(Ah),this._loader=h}dispose(){this._loader=null}loadBufferViewAsync(h,d){return J.LoadExtensionAsync(h,d,this.name,(async(m,j)=>{const A=d;if(A._meshOptData)return await A._meshOptData;const b=U.Get(`${h}/buffer`,this._loader.mb.buffers,j.buffer);return A._meshOptData=this._loader.loadBufferAsync(`/buffers/${b.index}`,b,j.byteOffset||0,j.byteLength).then((async h=>await jh.Default.decodeGltfBufferAsync(h,j.count,j.byteStride,j.mode,j.filter))),await A._meshOptData}))}}Y(Ah),r(Ah,!0,(h=>new bh(h)));const wh="EXT_texture_webp";class ah{constructor(h){this.name=wh,this._loader=h,this.enabled=h.isExtensionUsed(wh)}dispose(){this._loader=null}_loadTextureAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=void 0==d.sampler?J.DefaultSampler:U.Get(`${h}/sampler`,this._loader.mb.samplers,d.sampler),w=U.Get(`${j}/source`,this._loader.mb.images,A.source);return await this._loader._createTextureAsync(h,b,w,(h=>{m(h)}),void 0,!d._textureInfo.nonColorData)}))}}Y(wh),r(wh,!0,(h=>new ah(h)));const Dh="EXT_texture_avif";class Sh{constructor(h){this.name=Dh,this._loader=h,this.enabled=h.isExtensionUsed(Dh)}dispose(){this._loader=null}_loadTextureAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=void 0==d.sampler?J.DefaultSampler:U.Get(`${h}/sampler`,this._loader.mb.samplers,d.sampler),w=U.Get(`${j}/source`,this._loader.mb.images,A.source);return await this._loader._createTextureAsync(h,b,w,(h=>{m(h)}),void 0,!d._textureInfo.nonColorData)}))}}Y(Dh),r(Dh,!0,(h=>new Sh(h)));var Mh=m(12611),qh=m(11736);const Eh="EXT_lights_ies";class Ih{constructor(h){this.name=Eh,this._loader=h,this.enabled=this._loader.isExtensionUsed(Eh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.mb.extensions;if(h&&h[this.name]){const d=h[this.name];this._lights=d.lights,U.Assign(this._lights)}}loadNodeAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,w)=>{let a,D;this._loader._allMaterialsDirtyRequired=!0;const S=await this._loader.loadNodeAsync(h,d,(h=>{D=U.Get(j,this._lights,w.Rd);const d=D.name||h.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a=new Mh.b(d,A.i.Zero(),A.i.Backward(),0,1,this._loader.babylonScene),a.angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,D._babylonLight=a,a.falloffType=qh.d.FALLOFF_GLTF,a.Db=w.color?b.d.Ud(w.color):b.d.White(),a.ab=w.multiplier||1,a.range=Number.MAX_VALUE,a.parent=h,this._loader._babylonLights.push(a),J.AddPointerMetadata(a,j),m(h)}));let M;if(D.uri)M=await this._loader.loadUriAsync(h,D,D.uri);else{const d=U.Get(`${h}/bufferView`,this._loader.mb.bufferViews,D.bufferView);M=await this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return a.iesProfileTexture=new C.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,M,!0,void 0,void 0,void 0,void 0,".ies"),S}))}}Y(Eh),r(Eh,!0,(h=>new Ih(h)));var Rh=m(12638);const Zh="KHR_draco_mesh_compression";class Lh{constructor(h){this.name=Zh,this.useNormalizedFlagFromAccessor=!0,this._loader=h,this.enabled=Rh.d.DefaultAvailable&&this._loader.isExtensionUsed(Zh)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{if(void 0!=d.mode&&4!==d.mode&&5!==d.mode)throw new Error(`${h}: Unsupported mode ${d.mode}`);const b={},w={},a=(h,j)=>{const a=A.attributes[h];if(void 0!=a&&(m._delayInfo=m._delayInfo||[],-1===m._delayInfo.indexOf(j)&&m._delayInfo.push(j),b[j]=a,this.useNormalizedFlagFromAccessor)){const m=U.TryGet(this._loader.mb.accessors,d.attributes[h]);m&&(w[j]=m.normalized||!1)}};a("POSITION",o.d.PositionKind),a("NORMAL",o.d.NormalKind),a("TANGENT",o.d.TangentKind),a("TEXCOORD_0",o.d.UVKind),a("TEXCOORD_1",o.d.UV2Kind),a("TEXCOORD_2",o.d.UV3Kind),a("TEXCOORD_3",o.d.UV4Kind),a("TEXCOORD_4",o.d.UV5Kind),a("TEXCOORD_5",o.d.UV6Kind),a("JOINTS_0",o.d.MatricesIndicesKind),a("WEIGHTS_0",o.d.MatricesWeightsKind),a("COLOR_0",o.d.ColorKind);const D=U.Get(j,this._loader.mb.bufferViews,A.bufferView);return D._dracoBabylonGeometry||(D._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((async j=>{const A=this.dracoDecoder||Rh.d.Default,a=U.TryGet(this._loader.mb.accessors,d.attributes.POSITION),D=this._loader.parent.alwaysComputeBoundingBox||m.skeleton||!a?null:s(a);return await A._decodeMeshToGeometryForGltfAsync(m.name,this._loader.babylonScene,j,b,w,D).catch((d=>{throw new Error(`${h}: ${d.message}`)}))}))),await D._dracoBabylonGeometry}))}}Y(Zh),r(Zh,!0,(h=>new Lh(h)));var Bh=m(12644),Vh=m(11258),vh=m(11261),Ch=m(11374),Th=m(11809),oh=m(11080);Ch.b.AddNodeConstructor("Light_Type_0",((h,d)=>()=>new yh(h,A.i.Zero(),d)));class yh extends Th.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(h){this._shadowAngle=h,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(h){const d=this.needCube();if(this._direction=h,this.needCube()!==d&&this._shadowGenerators){const h=this._shadowGenerators.values();for(let d=h.next();!0!==d.done;d=h.next()){d.value.recreateShadowMap()}}}constructor(h,d,m){super(h,m),this._shadowAngle=Math.PI/2,this.position=d}getClassName(){return"PointLight"}getTypeID(){return qh.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(h){if(this.direction)return super.getShadowDirection(h);switch(h){case 0:return new A.i(1,0,0);case 1:return new A.i(-1,0,0);case 2:return new A.i(0,-1,0);case 3:return new A.i(0,1,0);case 4:return new A.i(0,0,1);case 5:return new A.i(0,0,-1)}return A.i.Zero()}_setDefaultShadowProjectionMatrix(h,d,m){const j=this.ih().activeCamera;if(!j)return;const b=void 0!==this.shadowMinZ?this.shadowMinZ:j.jb,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,a=this.ih().getEngine().useReverseDepthBuffer;A.b.PerspectiveFovLHToRef(this.shadowAngle,1,a?w:b,a?b:w,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,d){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,d):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,d),this}transferToNodeMaterialEffect(h,d){return this.computeTransformedInformation()?h.setFloat3(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):h.setFloat3(d,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(h,d){h["POINTLIGHT"+d]=!0}}(0,Vh.d)([(0,vh.M)()],yh.prototype,"shadowAngle",null),(0,oh.i)("BABYLON.PointLight",yh);const ih="KHR_lights_punctual";class gh{constructor(h){this.name=ih,this._loader=h,this.enabled=this._loader.isExtensionUsed(ih)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.mb.extensions;if(h&&h[this.name]){const d=h[this.name];this._lights=d.lights,U.Assign(this._lights)}}loadNodeAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,w)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(h,d,(h=>{let d;const a=U.Get(j,this._lights,w.Rd),D=a.name||h.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":{const h=new Bh.c(D,A.i.Backward(),this._loader.babylonScene);h.position.sd(0),d=h;break}case"point":d=new yh(D,A.i.Zero(),this._loader.babylonScene);break;case"spot":{const h=new Mh.b(D,A.i.Zero(),A.i.Backward(),0,1,this._loader.babylonScene);h.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),h.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),d=h;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${j}: Invalid light type (${a.type})`)}d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=d,d.falloffType=qh.d.FALLOFF_GLTF,d.Db=a.color?b.d.Ud(a.color):b.d.White(),d.ab=void 0==a.ab?1:a.ab,d.range=void 0==a.range?Number.MAX_VALUE:a.range,d.parent=h,this._loader._babylonLights.push(d),J.AddPointerMetadata(d,j),m(h)})))))}}Y(ih),r(ih,!0,(h=>new gh(h)));const Fh="KHR_materials_pbrSpecularGlossiness";class fh{constructor(h){this.name=Fh,this.order=200,this._loader=h,this.enabled=this._loader.isExtensionUsed(Fh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialBasePropertiesAsync(h,d,m)),b.push(this._loadSpecularGlossinessPropertiesAsync(j,A,m)),this._loader.loadMaterialAlphaProperties(h,d,m),await Promise.all(b).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return m.metallic=null,m.roughness=null,d.diffuseFactor?(m.albedoColor=b.d.Ud(d.diffuseFactor),m.alpha=d.diffuseFactor[3]):m.albedoColor=b.d.White(),m.reflectivityColor=d.specularFactor?b.d.Ud(d.specularFactor):b.d.White(),m.microSurface=void 0==d.glossinessFactor?1:d.glossinessFactor,d.diffuseTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTexture`,d.diffuseTexture,(h=>{h.name=`${m.name} (Diffuse)`,m.albedoTexture=h}))),d.specularGlossinessTexture&&(j.push(this._loader.loadTextureInfoAsync(`${h}/specularGlossinessTexture`,d.specularGlossinessTexture,(h=>{h.name=`${m.name} (Specular Glossiness)`,m.reflectivityTexture=h,m.reflectivityTexture.Nd=!0}))),m.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(j).then((()=>{}))}}Y(Fh),r(Fh,!0,(h=>new fh(h)));const Hh="KHR_materials_unlit";class ch{constructor(h){this.name=Hh,this.order=210,this._loader=h,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async()=>await this._loadUnlitPropertiesAsync(h,d,m)))}_loadUnlitPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;m.unlit=!0;const A=d.pbrMetallicRoughness;return A&&(A.baseColorFactor?(m.albedoColor=b.d.Ud(A.baseColorFactor),m.alpha=A.baseColorFactor[3]):m.albedoColor=b.d.White(),A.baseColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/baseColorTexture`,A.baseColorTexture,(h=>{h.name=`${m.name} (Base Color)`,m.albedoTexture=h})))),d.doubleSided&&(m.yd=!1,m.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(h,d,m),Promise.all(j).then((()=>{}))}}Y(Hh),r(Hh,!0,(h=>new ch(h)));const kh="KHR_materials_clearcoat";class lh{constructor(h){this.name=kh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(kh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadClearCoatPropertiesAsync(j,A,m)),await Promise.all(b)}))}_loadClearCoatPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return m.clearCoat.isEnabled=!0,m.clearCoat.useRoughnessFromMainTexture=!1,m.clearCoat.remapF0OnInterfaceChange=!1,void 0!=d.clearcoatFactor?m.clearCoat.ab=d.clearcoatFactor:m.clearCoat.ab=0,d.clearcoatTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatTexture`,d.clearcoatTexture,(h=>{h.name=`${m.name} (ClearCoat)`,m.clearCoat.texture=h}))),void 0!=d.clearcoatRoughnessFactor?m.clearCoat.roughness=d.clearcoatRoughnessFactor:m.clearCoat.roughness=0,d.clearcoatRoughnessTexture&&(d.clearcoatRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatRoughnessTexture`,d.clearcoatRoughnessTexture,(h=>{h.name=`${m.name} (ClearCoat Roughness)`,m.clearCoat.textureRoughness=h})))),d.clearcoatNormalTexture&&(d.clearcoatNormalTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatNormalTexture`,d.clearcoatNormalTexture,(h=>{h.name=`${m.name} (ClearCoat Normal)`,m.clearCoat.bumpTexture=h}))),m.invertNormalMapX=!m.ih().useRightHandedSystem,m.invertNormalMapY=m.ih().useRightHandedSystem,void 0!=d.clearcoatNormalTexture.scale&&(m.clearCoat.bumpTexture.level=d.clearcoatNormalTexture.scale)),Promise.all(j).then((()=>{}))}}Y(kh),r(kh,!0,(h=>new lh(h)));const Kh="KHR_materials_iridescence";class Nh{constructor(h){this.name=Kh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(Kh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadIridescencePropertiesAsync(j,A,m)),await Promise.all(b).then((()=>{}))}))}_loadIridescencePropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return m.iridescence.isEnabled=!0,m.iridescence.ab=d.iridescenceFactor??0,m.iridescence.indexOfRefraction=d.iridescenceIor??d.iridescenceIOR??1.3,m.iridescence.minimumThickness=d.iridescenceThicknessMinimum??100,m.iridescence.maximumThickness=d.iridescenceThicknessMaximum??400,d.iridescenceTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceTexture`,d.iridescenceTexture,(h=>{h.name=`${m.name} (Iridescence)`,m.iridescence.texture=h}))),d.iridescenceThicknessTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceThicknessTexture`,d.iridescenceThicknessTexture,(h=>{h.name=`${m.name} (Iridescence Thickness)`,m.iridescence.thicknessTexture=h}))),Promise.all(j).then((()=>{}))}}Y(Kh),r(Kh,!0,(h=>new Nh(h)));const Wh="KHR_materials_anisotropy";class rh{constructor(h){this.name=Wh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(Wh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadIridescencePropertiesAsync(j,A,m)),await Promise.all(b)}))}async _loadIridescencePropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;m.anisotropy.isEnabled=!0,m.anisotropy.ab=d.anisotropyStrength??0,m.anisotropy.angle=d.anisotropyRotation??0,d.anisotropyTexture&&(d.anisotropyTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/anisotropyTexture`,d.anisotropyTexture,(h=>{h.name=`${m.name} (Anisotropy Intensity)`,m.anisotropy.texture=h})))),await Promise.all(j)}}Y(Wh),r(Wh,!0,(h=>new rh(h)));const Yh="KHR_materials_emissive_strength";class xh{constructor(h){this.name=Yh,this.order=170,this._loader=h,this.enabled=this._loader.isExtensionUsed(Yh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>await this._loader.loadMaterialPropertiesAsync(h,d,m).then((()=>{this._loadEmissiveProperties(j,A,m)}))))}_loadEmissiveProperties(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);void 0!==d.emissiveStrength&&(m.emissiveIntensity=d.emissiveStrength)}}Y(Yh),r(Yh,!0,(h=>new xh(h)));const Qh="KHR_materials_sheen";class th{constructor(h){this.name=Qh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(Qh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadSheenPropertiesAsync(j,A,m)),await Promise.all(b).then((()=>{}))}))}_loadSheenPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return m.sheen.isEnabled=!0,m.sheen.ab=1,void 0!=d.sheenColorFactor?m.sheen.color=b.d.Ud(d.sheenColorFactor):m.sheen.color=b.d.Black(),d.sheenColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/sheenColorTexture`,d.sheenColorTexture,(h=>{h.name=`${m.name} (Sheen Color)`,m.sheen.texture=h}))),void 0!==d.sheenRoughnessFactor?m.sheen.roughness=d.sheenRoughnessFactor:m.sheen.roughness=0,d.sheenRoughnessTexture&&(d.sheenRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/sheenRoughnessTexture`,d.sheenRoughnessTexture,(h=>{h.name=`${m.name} (Sheen Roughness)`,m.sheen.textureRoughness=h})))),m.sheen.albedoScaling=!0,m.sheen.useRoughnessFromMainTexture=!1,Promise.all(j).then((()=>{}))}}Y(Qh),r(Qh,!0,(h=>new th(h)));var Uh=m(11578);const sh="KHR_materials_specular";class Jh{constructor(h){this.name=sh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(sh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;if(b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadSpecularPropertiesAsync(j,A,m)),A.extensions&&A.extensions.EXT_materials_specular_edge_color&&m instanceof v.d){A.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(m.brdf.dielectricSpecularModel=Uh.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,m.brdf.conductorSpecularModel=Uh.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(b).then((()=>{}))}))}_loadSpecularPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return void 0!==d.specularFactor&&(m.metallicF0Factor=d.specularFactor),void 0!==d.specularColorFactor&&(m.metallicReflectanceColor=b.d.Ud(d.specularColorFactor)),d.specularTexture&&(d.specularTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/specularTexture`,d.specularTexture,(h=>{h.name=`${m.name} (Specular)`,m.metallicReflectanceTexture=h,m.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),d.specularColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/specularColorTexture`,d.specularColorTexture,(h=>{h.name=`${m.name} (Specular Color)`,m.reflectanceTexture=h}))),Promise.all(j).then((()=>{}))}}Y(sh),r(sh,!0,(h=>new Jh(h)));const Oh="KHR_materials_ior";class nh{constructor(h){this.name=Oh,this.order=180,this._loader=h,this.enabled=this._loader.isExtensionUsed(Oh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadIorPropertiesAsync(j,A,m)),await Promise.all(b).then((()=>{}))}))}_loadIorPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);return void 0!==d.ior?m.indexOfRefraction=d.ior:m.indexOfRefraction=nh._DEFAULT_IOR,Promise.resolve()}}nh._DEFAULT_IOR=1.5,Y(Oh),r(Oh,!0,(h=>new nh(h)));const ph="KHR_materials_variants";class eh{constructor(h){this.name=ph,this._loader=h,this.enabled=this._loader.isExtensionUsed(ph)}dispose(){this._loader=null}static GetAvailableVariants(h){const d=this._GetExtensionMetadata(h);return d?Object.keys(d.variants):[]}getAvailableVariants(h){return eh.GetAvailableVariants(h)}static SelectVariant(h,d){const m=this._GetExtensionMetadata(h);if(!m)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ph} extension`);const j=h=>{const d=m.variants[h];if(d)for(const m of d)m.mesh.material=m.material};if(d instanceof Array)for(const A of d)j(A);else j(d);m.lastSelected=d}selectVariant(h,d){eh.SelectVariant(h,d)}static Reset(h){const d=this._GetExtensionMetadata(h);if(!d)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ph} extension`);for(const m of d.original)m.mesh.material=m.material;d.lastSelected=null}reset(h){eh.Reset(h)}static GetLastSelectedVariant(h){const d=this._GetExtensionMetadata(h);if(!d)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ph} extension`);return d.lastSelected}getLastSelectedVariant(h){return eh.GetLastSelectedVariant(h)}static _GetExtensionMetadata(h){var d,m;return(null===h||void 0===h||null===(d=h._internalMetadata)||void 0===d||null===(m=d.mb)||void 0===m?void 0:m[ph])||null}onLoading(){const h=this._loader.mb.extensions;if(h&&h[this.name]){const d=h[this.name];this._variants=d.variants}}onReady(){const h=this._loader.rootBabylonMesh;if(h){var d;const m=this._loader.parent.extensionOptions[ph];null!==m&&void 0!==m&&m.defaultVariant&&eh.SelectVariant(h,m.defaultVariant),null===m||void 0===m||null===(d=m.onLoaded)||void 0===d||d.call(m,{get variants(){return eh.GetAvailableVariants(h)},get selectedVariant(){const d=eh.GetLastSelectedVariant(h);return d?Array.isArray(d)?d[0]:d:eh.GetAvailableVariants(h)[0]},set selectedVariant(d){eh.SelectVariant(h,d)}})}}_loadMeshPrimitiveAsync(h,d,m,j,A,b){return J.LoadExtensionAsync(h,A,this.name,(async(w,a)=>{const D=new Array;return D.push(this._loader._loadMeshPrimitiveAsync(h,d,m,j,A,(d=>{if(b(d),d instanceof g.d){const m=J._GetDrawMode(h,A.mode),j=this._loader.rootBabylonMesh,b=j?j._internalMetadata=j._internalMetadata||{}:{},S=b.mb=b.mb||{},M=S[ph]=S[ph]||{lastSelected:null,original:[],variants:{}};M.original.push({mesh:d,material:d.material});for(let h=0;h<a.mappings.length;++h){const A=a.mappings[h],b=U.Get(`${w}/mappings/${h}/material`,this._loader.mb.materials,A.material);D.push(this._loader._loadMaterialAsync(`#/materials/${A.material}`,b,d,m,(h=>{for(let m=0;m<A.variants.length;++m){const b=A.variants[m],w=U.Get(`/extensions/${ph}/variants/${b}`,this._variants,b);M.variants[w.name]=M.variants[w.name]||[],M.variants[w.name].push({mesh:d,material:h}),d.onClonedObservable.add((h=>{const m=h;let A=null,b=m;do{if(b=b.parent,!b)return;A=eh._GetExtensionMetadata(b)}while(null===A);if(j&&A===eh._GetExtensionMetadata(j)){b._internalMetadata={};for(const h in j._internalMetadata)b._internalMetadata[h]=j._internalMetadata[h];b._internalMetadata.mb=[];for(const h in j._internalMetadata.mb)b._internalMetadata.mb[h]=j._internalMetadata.mb[h];b._internalMetadata.mb[ph]={lastSelected:null,original:[],variants:{}};for(const h of A.original)b._internalMetadata.mb[ph].original.push({mesh:h.mesh,material:h.material});for(const h in A.variants)if(Object.prototype.hasOwnProperty.call(A.variants,h)){b._internalMetadata.mb[ph].variants[h]=[];for(const d of A.variants[h])b._internalMetadata.mb[ph].variants[h].push({mesh:d.mesh,material:d.material})}A=b._internalMetadata.mb[ph]}for(const j of A.original)j.mesh===d&&(j.mesh=m);for(const j of A.variants[w.name])j.mesh===d&&(j.mesh=m)}))}})))}}}))),await Promise.all(D).then((h=>{let[d]=h;return d}))}))}}Y(ph),r(ph,!0,(h=>new eh(h)));var Xh=m(11548);class zh{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Uh.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(h,d){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...zh._GetDefaultOptions(),...h},this._scene=d,this._scene._transmissionHelper=this,this.onErrorObservable=new M.e,this._scene.pd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(h){if(!Object.keys(h).filter((d=>this._options[d]!==h[d])).length)return;const d={...this._options,...h},m=this._options;this._options=d,d.renderSize===m.renderSize&&d.renderTargetTextureType===m.renderTargetTextureType&&d.generateMipmaps===m.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=d.samples,this._opaqueRenderTarget.lodGenerationScale=d.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=d.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(h){return!!h&&!!(h instanceof v.d&&h.subSurface.isRefractionEnabled)}_addMesh(h){this._materialObservers[h.uniqueId]=h.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),w.e.SetImmediate((()=>{this._shouldRenderAsTransmission(h.material)?(h.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(h)&&this._transparentMeshesCache.push(h)):-1===this._opaqueMeshesCache.indexOf(h)&&this._opaqueMeshesCache.push(h)}))}_removeMesh(h){h.onMaterialChangedObservable.remove(this._materialObservers[h.uniqueId]),delete this._materialObservers[h.uniqueId];let d=this._transparentMeshesCache.indexOf(h);-1!==d&&this._transparentMeshesCache.splice(d,1),d=this._opaqueMeshesCache.indexOf(h),-1!==d&&this._opaqueMeshesCache.splice(d,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(h){const d=this._transparentMeshesCache.indexOf(h),m=this._opaqueMeshesCache.indexOf(h);this._shouldRenderAsTransmission(h.material)?(h.material instanceof v.d&&(h.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==m?(this._opaqueMeshesCache.splice(m,1),this._transparentMeshesCache.push(h)):-1===d&&this._transparentMeshesCache.push(h)):-1!==d?(this._transparentMeshesCache.splice(d,1),this._opaqueMeshesCache.push(h)):-1===m&&this._opaqueMeshesCache.push(h)}_isRenderTargetValid(){var h;return null!==(null===(h=this._opaqueRenderTarget)||void 0===h?void 0:h.getInternalTexture())}_setupRenderTargets(){var h;let d;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Xh.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(h=this._options.clearColor)||void 0===h?void 0:h.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((h=>{d=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?h.clearColor.D(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(h.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=d}));for(const m of this._transparentMeshesCache)this._shouldRenderAsTransmission(m.material)&&(m.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const uh="KHR_materials_transmission";class Ph{constructor(h){this.name=uh,this.order=175,this._loader=h,this.enabled=this._loader.isExtensionUsed(uh),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadTransparentPropertiesAsync(j,d,m,A)),await Promise.all(b).then((()=>{}))}))}_loadTransparentPropertiesAsync(h,d,m,j){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const A=m;if(A.subSurface.isRefractionEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.useAlbedoToTintRefraction=!0,void 0===j.transmissionFactor)return A.subSurface.refractionIntensity=0,A.subSurface.isRefractionEnabled=!1,Promise.resolve();{var b;A.subSurface.refractionIntensity=j.transmissionFactor;const h=A.ih();if(A.subSurface.refractionIntensity&&!h._transmissionHelper)new zh({},A.ih());else if(A.subSurface.refractionIntensity&&(null===(b=h._transmissionHelper)||void 0===b||!b._isRenderTargetValid())){var w;null===(w=h._transmissionHelper)||void 0===w||w._setupRenderTargets()}}return A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,j.transmissionTexture?(j.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/transmissionTexture`,j.transmissionTexture,void 0).then((h=>{h.name=`${m.name} (Transmission)`,A.subSurface.refractionIntensityTexture=h,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Y(uh),r(uh,!0,(h=>new Ph(h)));const Gh="KHR_materials_diffuse_transmission";class hd{constructor(h){this.name=Gh,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(Gh),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadTranslucentPropertiesAsync(j,d,m,A)),await Promise.all(b).then((()=>{}))}))}_loadTranslucentPropertiesAsync(h,d,m,j){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const A=m;if(A.subSurface.isTranslucencyEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,A.subSurface.useAlbedoToTintTranslucency=!1,void 0===j.diffuseTransmissionFactor)return A.subSurface.translucencyIntensity=0,A.subSurface.isTranslucencyEnabled=!1,Promise.resolve();A.subSurface.translucencyIntensity=j.diffuseTransmissionFactor;const w=new Array;return A.subSurface.useGltfStyleTextures=!0,j.diffuseTransmissionTexture&&(j.diffuseTransmissionTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionTexture`,j.diffuseTransmissionTexture).then((h=>{h.name=`${m.name} (Diffuse Transmission)`,A.subSurface.translucencyIntensityTexture=h})))),void 0!==j.diffuseTransmissionColorFactor?A.subSurface.translucencyColor=b.d.Ud(j.diffuseTransmissionColorFactor):A.subSurface.translucencyColor=b.d.White(),j.diffuseTransmissionColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionColorTexture`,j.diffuseTransmissionColorTexture).then((h=>{h.name=`${m.name} (Diffuse Transmission Color)`,A.subSurface.translucencyColorTexture=h}))),Promise.all(w).then((()=>{}))}}Y(Gh),r(Gh,!0,(h=>new hd(h)));const dd="KHR_materials_volume";class md{constructor(h){this.name=dd,this.order=173,this._loader=h,this.enabled=this._loader.isExtensionUsed(dd),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadVolumePropertiesAsync(j,d,m,A)),await Promise.all(b).then((()=>{}))}))}_loadVolumePropertiesAsync(h,d,m,j){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);if(!m.subSurface.isRefractionEnabled&&!m.subSurface.isTranslucencyEnabled||!j.thicknessFactor)return Promise.resolve();m.subSurface.volumeIndexOfRefraction=m.indexOfRefraction;const A=void 0!==j.attenuationDistance?j.attenuationDistance:Number.MAX_VALUE;return m.subSurface.tintColorAtDistance=A,void 0!==j.attenuationColor&&3==j.attenuationColor.length&&m.subSurface.tintColor.xd(j.attenuationColor[0],j.attenuationColor[1],j.attenuationColor[2]),m.subSurface.minimumThickness=0,m.subSurface.maximumThickness=j.thicknessFactor,m.subSurface.useThicknessAsDepth=!0,j.thicknessTexture?(j.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/thicknessTexture`,j.thicknessTexture).then((h=>{h.name=`${m.name} (Thickness)`,m.subSurface.thicknessTexture=h,m.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Y(dd),r(dd,!0,(h=>new md(h)));const jd="KHR_materials_dispersion";class Ad{constructor(h){this.name=jd,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(jd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadDispersionPropertiesAsync(j,d,m,A)),await Promise.all(b).then((()=>{}))}))}_loadDispersionPropertiesAsync(h,d,m,j){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);return m.subSurface.isRefractionEnabled&&j.dispersion?(m.subSurface.isDispersionEnabled=!0,m.subSurface.dispersion=j.dispersion,Promise.resolve()):Promise.resolve()}}Y(jd),r(jd,!0,(h=>new Ad(h)));const bd="EXT_materials_diffuse_roughness";class wd{constructor(h){this.name=bd,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(bd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(h,d,m)),b.push(this._loadDiffuseRoughnessPropertiesAsync(j,A,m)),await Promise.all(b).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(h,d,m){if(!(m instanceof v.d))throw new Error(`${h}: Material type not supported`);const j=new Array;return m.brdf.baseDiffuseModel=Uh.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=d.diffuseRoughnessFactor?m.baseDiffuseRoughness=d.diffuseRoughnessFactor:m.baseDiffuseRoughness=0,d.diffuseRoughnessTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/diffuseRoughnessTexture`,d.diffuseRoughnessTexture,(h=>{h.name=`${m.name} (Diffuse Roughness)`,m.baseDiffuseRoughnessTexture=h}))),Promise.all(j).then((()=>{}))}}Y(bd),r(bd,!0,(h=>new wd(h)));const ad="KHR_mesh_quantization";class Dd{constructor(h){this.name=ad,this.enabled=h.isExtensionUsed(ad)}dispose(){}}Y(ad),r(ad,!0,(h=>new Dd(h)));const Sd="KHR_texture_basisu";class Md{constructor(h){this.name=Sd,this._loader=h,this.enabled=h.isExtensionUsed(Sd)}dispose(){this._loader=null}_loadTextureAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>{const b=void 0==d.sampler?J.DefaultSampler:U.Get(`${h}/sampler`,this._loader.mb.samplers,d.sampler),w=U.Get(`${j}/source`,this._loader.mb.images,A.source);return await this._loader._createTextureAsync(h,b,w,(h=>{m(h)}),d._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!d._textureInfo.nonColorData)}))}}Y(Sd),r(Sd,!0,(h=>new Md(h)));const qd="KHR_texture_transform";class Ed{constructor(h){this.name=qd,this._loader=h,this.enabled=this._loader.isExtensionUsed(qd)}dispose(){this._loader=null}loadTextureInfoAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(j,A)=>await this._loader.loadTextureInfoAsync(h,d,(h=>{if(!(h instanceof C.e))throw new Error(`${j}: Texture type not supported`);A.offset&&(h.uOffset=A.offset[0],h.vOffset=A.offset[1]),h.uRotationCenter=0,h.vRotationCenter=0,A.rotation&&(h.wAng=-A.rotation),A.scale&&(h.uScale=A.scale[0],h.vScale=A.scale[1]),void 0!=A.texCoord&&(h.coordinatesIndex=A.texCoord),m(h)}))))}}Y(qd),r(qd,!0,(h=>new Ed(h)));const Id="KHR_xmp_json_ld";class Rd{constructor(h){this.name=Id,this.order=100,this._loader=h,this.enabled=this._loader.isExtensionUsed(Id)}dispose(){this._loader=null}onLoading(){var h,d,m;if(null===this._loader.rootBabylonMesh)return;const j=null===(h=this._loader.mb.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld,A=null===(d=this._loader.mb.asset)||void 0===d||null===(m=d.extensions)||void 0===m?void 0:m.KHR_xmp_json_ld;if(j&&A){const h=+A.packet;j.packets&&h<j.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=j.packets[h])}}}function Zd(h,d,m,j){return b.d.Ud(d,m).scale(j)}function Ld(h,d,m,j){return d[m]*j}function Bd(h,d,m,j){return-d[m]*j}function Vd(h,d,m,j){return d[m+1]*j}function vd(h,d,m,j){return d[m]*j*2}function Cd(h){return{scale:[new od(E.b.ANIMATIONTYPE_FLOAT,`${h}.uScale`,Ld,(()=>2)),new od(E.b.ANIMATIONTYPE_FLOAT,`${h}.vScale`,Vd,(()=>2))],offset:[new od(E.b.ANIMATIONTYPE_FLOAT,`${h}.uOffset`,Ld,(()=>2)),new od(E.b.ANIMATIONTYPE_FLOAT,`${h}.vOffset`,Vd,(()=>2))],rotation:[new od(E.b.ANIMATIONTYPE_FLOAT,`${h}.wAng`,Bd,(()=>1))]}}Y(Id),r(Id,!0,(h=>new Rd(h)));class Td extends O.AnimationPropertyInfo{buildAnimations(h,d,m,j){return[{babylonAnimatable:h._babylonCamera,babylonAnimation:this._buildAnimation(d,m,j)}]}}class od extends O.AnimationPropertyInfo{buildAnimations(h,d,m,j){const A=[];for(const b in h._data)A.push({babylonAnimatable:h._data[b].babylonMaterial,babylonAnimation:this._buildAnimation(d,m,j)});return A}}class yd extends O.AnimationPropertyInfo{buildAnimations(h,d,m,j){return[{babylonAnimatable:h._babylonLight,babylonAnimation:this._buildAnimation(d,m,j)}]}}(0,x.j)("/cameras/{}/orthographic/xmag",[new Td(E.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Bd,(()=>1)),new Td(E.b.ANIMATIONTYPE_FLOAT,"orthoRight",Vd,(()=>1))]),(0,x.j)("/cameras/{}/orthographic/ymag",[new Td(E.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Bd,(()=>1)),new Td(E.b.ANIMATIONTYPE_FLOAT,"orthoTop",Vd,(()=>1))]),(0,x.j)("/cameras/{}/orthographic/zfar",[new Td(E.b.ANIMATIONTYPE_FLOAT,"maxZ",Ld,(()=>1))]),(0,x.j)("/cameras/{}/orthographic/znear",[new Td(E.b.ANIMATIONTYPE_FLOAT,"jb",Ld,(()=>1))]),(0,x.j)("/cameras/{}/perspective/yfov",[new Td(E.b.ANIMATIONTYPE_FLOAT,"fov",Ld,(()=>1))]),(0,x.j)("/cameras/{}/perspective/zfar",[new Td(E.b.ANIMATIONTYPE_FLOAT,"maxZ",Ld,(()=>1))]),(0,x.j)("/cameras/{}/perspective/znear",[new Td(E.b.ANIMATIONTYPE_FLOAT,"jb",Ld,(()=>1))]),(0,x.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new od(E.b.ANIMATIONTYPE_COLOR3,"albedoColor",Zd,(()=>4)),new od(E.b.ANIMATIONTYPE_FLOAT,"alpha",(function(h,d,m,j){return d[m+3]*j}),(()=>4))]),(0,x.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"metallic",Ld,(()=>1))]),(0,x.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"roughness",Ld,(()=>1))]);const id=Cd("albedoTexture");(0,x.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",id.scale),(0,x.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",id.offset),(0,x.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",id.rotation);const gd=Cd("metallicTexture");(0,x.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",gd.scale),(0,x.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",gd.offset),(0,x.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",gd.rotation),(0,x.j)("/materials/{}/emissiveFactor",[new od(E.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Zd,(()=>3))]);const Fd=Cd("bumpTexture");(0,x.j)("/materials/{}/normalTexture/scale",[new od(E.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ld,(()=>1))]),(0,x.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Fd.scale),(0,x.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Fd.offset),(0,x.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Fd.rotation),(0,x.j)("/materials/{}/occlusionTexture/strength",[new od(E.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ld,(()=>1))]);const fd=Cd("ambientTexture");(0,x.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",fd.scale),(0,x.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",fd.offset),(0,x.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",fd.rotation);const Hd=Cd("emissiveTexture");(0,x.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Hd.scale),(0,x.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Hd.offset),(0,x.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Hd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new od(E.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new od(E.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Ld,(()=>1))]);const cd=Cd("anisotropy.texture");(0,x.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",cd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",cd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",cd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ld,(()=>1))]);const kd=Cd("clearCoat.texture");(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",kd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",kd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",kd.rotation);const ld=Cd("clearCoat.bumpTexture");(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new od(E.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",ld.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",ld.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",ld.rotation);const Kd=Cd("clearCoat.textureRoughness");(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Kd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Kd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Kd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new od(E.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new od(E.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new od(E.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new od(E.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new od(E.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ld,(()=>1))]);const Nd=Cd("iridescence.texture");(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Nd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Nd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Nd.rotation);const Wd=Cd("iridescence.thicknessTexture");(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Wd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Wd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Wd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new od(E.b.ANIMATIONTYPE_COLOR3,"sheen.color",Zd,(()=>3))]),(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ld,(()=>1))]);const rd=Cd("sheen.texture");(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",rd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",rd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",rd.rotation);const Yd=Cd("sheen.textureRoughness");(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Yd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Yd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Yd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new od(E.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Zd,(()=>3))]);const xd=Cd("metallicReflectanceTexture");(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",xd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",xd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",xd.rotation);const Qd=Cd("reflectanceTexture");(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Qd.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Qd.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Qd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ld,(()=>1))]);const td=Cd("subSurface.refractionIntensityTexture");(0,x.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",td.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",td.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",td.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new od(E.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Zd,(()=>3))]),(0,x.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new od(E.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ld,(()=>1))]),(0,x.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ld,(()=>1))]);const Ud=Cd("subSurface.thicknessTexture");(0,x.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ud.scale),(0,x.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ud.offset),(0,x.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ud.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new od(E.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Ld,(()=>1))]);const sd=Cd("subSurface.translucencyIntensityTexture");(0,x.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",sd.scale),(0,x.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",sd.offset),(0,x.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",sd.rotation),(0,x.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new od(E.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Zd,(()=>3))]);const Jd=Cd("subSurface.translucencyColorTexture");(0,x.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Jd.scale),(0,x.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Jd.offset),(0,x.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Jd.rotation),(0,x.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new yd(E.b.ANIMATIONTYPE_COLOR3,"diffuse",Zd,(()=>3))]),(0,x.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new yd(E.b.ANIMATIONTYPE_FLOAT,"intensity",Ld,(()=>1))]),(0,x.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new yd(E.b.ANIMATIONTYPE_FLOAT,"range",Ld,(()=>1))]),(0,x.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new yd(E.b.ANIMATIONTYPE_FLOAT,"innerAngle",vd,(()=>1))]),(0,x.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new yd(E.b.ANIMATIONTYPE_FLOAT,"angle",vd,(()=>1))]),(0,x.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new yd(E.b.ANIMATIONTYPE_COLOR3,"diffuse",Zd,(()=>3))]),(0,x.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new yd(E.b.ANIMATIONTYPE_FLOAT,"intensity",Ld,(()=>1))]);const Od="KHR_animation_pointer";class nd{constructor(h){this.name=Od,this._loader=h,this._pathToObjectConverter=(0,x.f)(this._loader.mb)}get enabled(){return this._loader.isExtensionUsed(Od)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(h,d,m,j,A){var b;const w=null===(b=j.target.extensions)||void 0===b?void 0:b.KHR_animation_pointer;if(!w||!this._pathToObjectConverter)return null;"pointer"!==j.target.path&&Z.c.Warn(`${h}/target/path: Value (${j.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=j.target.node&&Z.c.Warn(`${h}/target/node: Value (${j.target.node}) must not be present when using the ${this.name} extension`);const a=`${h}/extensions/${this.name}`,D=w.pointer;if(!D)throw new Error(`${a}: Pointer is missing`);try{const b=this._pathToObjectConverter.convert(D);if(!b.info.interpolation)throw new Error(`${a}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(h,d,m,j,{object:b.object,info:b.info.interpolation},A)}catch(S){return Z.c.Warn(`${a}/pointer: Invalid pointer (${D}) skipped`),null}}}Y(Od),r(Od,!0,(h=>new nd(h)));class pd{constructor(h,d,m){this.frame=h,this.action=d,this.onlyOnce=m,this.isDone=!1}_clone(){return new pd(this.frame,this.action,this.onlyOnce)}}var ed=m(11137),Xd=m(11188),zd=m(11183);class ud{get loop(){return this._loop}set loop(h){h!==this._loop&&(this._loop=h,this.updateOptions({loop:h}))}get currentTime(){var h;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.audioContext&&(this.isPlaying||this.isPaused)){const h=this.isPaused?0:Xd.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+h}return 0}get spatialSound(){return this._spatialSound}set spatialSound(h){if(h==this._spatialSound)return;const d=this.isPlaying;this.pause(),h?(this._spatialSound=h,this._updateSpatialParameters()):this._disableSpatialSound(),d&&this.play()}constructor(h,d,m){var j;let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new M.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=A.i.Zero(),this._localDirection=new A.i(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=h,m=m||R.b.LastCreatedScene)if(this._scene=m,ud._SceneComponentInitialization(m),this._readyToPlayCallback=b,this._customAttenuationFunction=(h,d,m,j,A)=>d<m?h*(1-d/m):0,a&&(this.autoplay=a.autoplay||!1,this._loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this._spatialSound=a.spatialSound??!1,this.maxDistance=a.maxDistance??100,this.useCustomAttenuation=a.useCustomAttenuation??!1,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=a.streaming??!1,this._length=a.length,this._offset=a.offset),null!==(j=Xd.b.audioEngine)&&void 0!==j&&j.canUseWebAudio&&Xd.b.audioEngine.audioContext){this._soundGain=Xd.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let h=!0;if(d)try{"string"===typeof d?(this._urlType="String",this._url=d):d instanceof ArrayBuffer?this._urlType="ArrayBuffer":d instanceof HTMLMediaElement?this._urlType="MediaElement":d instanceof MediaStream?this._urlType="MediaStream":d instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(d)&&(this._urlType="Array");let m=[],j=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Xd.b.audioEngine.audioContext.createMediaElementSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Xd.b.audioEngine.audioContext.createMediaStreamSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":d.byteLength>0&&(j=!0,this._soundLoaded(d));break;case"AudioBuffer":this._audioBufferLoaded(d);break;case"String":m.push(d);case"Array":0===m.length&&(m=d);for(let h=0;h<m.length;h++){const d=m[h];if(j=a&&a.skipCodecCheck||-1!==d.indexOf(".mp3",d.length-4)&&Xd.b.audioEngine.isMP3supported||-1!==d.indexOf(".ogg",d.length-4)&&Xd.b.audioEngine.isOGGsupported||-1!==d.indexOf(".wav",d.length-4)||-1!==d.indexOf(".m4a",d.length-4)||-1!==d.indexOf(".mp4",d.length-4)||-1!==d.indexOf("blob:"),j){this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,w.e.SetCorsBehavior(d,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(d,(h=>{this._soundLoaded(h)}),void 0,!0,!0,(h=>{h&&Z.c.Error("XHR "+h.status+" error on: "+d+"."),Z.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:h=!1}h?j||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Z.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(D){Z.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Xd.b.audioEngine&&!Xd.b.audioEngine.WarnedWebAudioUnsupported&&(Z.c.Error("Web Audio is not supported by your browser."),Xd.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var h;null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(h){var d;null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.audioContext&&(this._audioBuffer=h,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(h){var d;null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.audioContext&&Xd.b.audioEngine.audioContext.decodeAudioData(h,(h=>{this._audioBufferLoaded(h)}),(h=>{Z.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+h)}))}setAudioBuffer(h){var d;null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&(this._audioBuffer=h,this._isReadyToPlay=!0)}updateOptions(h){h&&(this.loop=h.loop??this.loop,this.maxDistance=h.maxDistance??this.maxDistance,this.useCustomAttenuation=h.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=h.rolloffFactor??this.rolloffFactor,this.refDistance=h.refDistance??this.refDistance,this.distanceModel=h.distanceModel??this.distanceModel,this._playbackRate=h.playbackRate??this._playbackRate,this._length=h.length??void 0,this.spatialSound=h.spatialSound??this._spatialSound,this._setOffset(h.offset??void 0),this.setVolume(h.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var h;null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&Xd.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Xd.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var h;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(h=this._soundPanner)||void 0===h||h.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var h;null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(h){var d;null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(h),this._isOutputConnected=!0)}setDirectionalCone(h,d,m){d<h?Z.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=h,this._coneOuterAngle=d,this._coneOuterGain=m,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!=this._coneInnerAngle){var d;if(this._coneOuterAngle<h)return void Z.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h,null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!=this._coneOuterAngle){var d;if(h<this._coneInnerAngle)return void Z.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h,null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(h){var d;h.equals(this._position)||(this._position.D(h),null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(h){var d;this._localDirection=h,null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const h=this._connectedTransformNode.getWorldMatrix(),d=A.i.TransformNormal(this._localDirection,h);d.normalize(),this._soundPanner.orientationX.value=d.x,this._soundPanner.orientationY.value=d.y,this._soundPanner.orientationZ.value=d.z}updateDistanceFromListener(){var h;if(null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const h=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.fm(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,h,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(h){this._customAttenuationFunction=h}play(h,d,m){var j;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(j=Xd.b.audioEngine)&&void 0!==j&&j.audioContext)try{var A,b;this._clearTimeoutsAndObservers();let j=h?(null===(A=Xd.b.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+h:null===(b=Xd.b.audioEngine)||void 0===b?void 0:b.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Xd.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const h=()=>{var m;if(null!==(m=Xd.b.audioEngine)&&void 0!==m&&m.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=d??0;const m=this._htmlAudioElement.play();void 0!==m&&m.catch((()=>{var d,m;(null===(d=Xd.b.audioEngine)||void 0===d||d.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(m=Xd.b.audioEngine)||void 0===m?void 0:m.onAudioUnlockedObservable.addOnce((()=>{h()})))}))}else{var j;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(j=Xd.b.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{h()}))}};h()}}else{var w;const A=()=>{var A;if(null!==(A=Xd.b.audioEngine)&&void 0!==A&&A.audioContext){var b;if(m=m||this._length,void 0!==d&&this._setOffset(d),this._soundSource){const h=this._soundSource;h.onended=()=>{h.disconnect()}}if(this._soundSource=null===(b=Xd.b.audioEngine)||void 0===b?void 0:b.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var w;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==d&&(this._soundSource.loopStart=d),void 0!==m&&(this._soundSource.loopEnd=(0|d)+m),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},j=h?(null===(w=Xd.b.audioEngine)||void 0===w?void 0:w.audioContext.currentTime)+h:Xd.b.audioEngine.audioContext.currentTime;const A=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(j,A,this.loop?void 0:m)}}};"suspended"===(null===(w=Xd.b.audioEngine)||void 0===w?void 0:w.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var h;"suspended"===(null===(h=Xd.b.audioEngine)||void 0===h?void 0:h.audioContext.state)?(Xd.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Xd.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{A()})))):A()}),500):A()}this._startTime=j,this.isPlaying=!0,this.isPaused=!1}catch(a){Z.c.Error("Error while trying to play audio: "+this.name+", "+a.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(h){var d;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var m;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(m=this._streamingSource)||void 0===m||m.disconnect();this.isPlaying=!1}else if(null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.audioContext&&this._soundSource){const d=h?Xd.b.audioEngine.audioContext.currentTime+h:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(d)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Xd.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(h,d){var m;null!==(m=Xd.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&this._soundGain&&(d&&Xd.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Xd.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Xd.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(h,Xd.b.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=h),this._volume=h}setPlaybackRate(h){this._playbackRate=h,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(h){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=h,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=h=>this._onRegisterAfterWorldMatrixUpdate(h),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(h){var d;if(h.getBoundingInfo){const d=h.getBoundingInfo();this.setPosition(d.boundingSphere.centerWorld)}else this.setPosition(h.absolutePosition);null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const h=()=>{(0,zd.d)((()=>this._isReadyToPlay),(()=>{m._audioBuffer=this.getAudioBuffer(),m._isReadyToPlay=!0,m.autoplay&&m.play(0,this._offset,this._length)}),void 0,300)},d={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},m=new ud(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,d);return this.useCustomAttenuation&&m.setAttenuationFunction(this._customAttenuationFunction),m.setPosition(this._position),m.setPlaybackRate(this._playbackRate),h(),m}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const h={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(h.connectedMeshId=this._connectedTransformNode.id),h.position=this._position.fd(),h.refDistance=this.refDistance,h.distanceModel=this.distanceModel,h.isDirectional=this._isDirectional,h.localDirectionToMesh=this._localDirection.fd(),h.coneInnerAngle=this._coneInnerAngle,h.coneOuterAngle=this._coneOuterAngle,h.coneOuterGain=this._coneOuterGain),h}static Parse(h,d,m,j){const b=h.name;let w;w=h.url?m+h.url:m+b;const a={autoplay:h.autoplay,loop:h.loop,volume:h.volume,spatialSound:h.spatialSound,maxDistance:h.maxDistance,rolloffFactor:h.rolloffFactor,refDistance:h.refDistance,distanceModel:h.distanceModel,playbackRate:h.playbackRate};let D;if(j){const h=()=>{(0,zd.d)((()=>j._isReadyToPlay),(()=>{D._audioBuffer=j.getAudioBuffer(),D._isReadyToPlay=!0,D.autoplay&&D.play(0,D._offset,D._length)}),void 0,300)};D=new ud(b,new ArrayBuffer(0),d,null,a),h()}else D=new ud(b,w,d,(()=>{d.removePendingData(D)}),a),d.addPendingData(D);if(h.position){const d=A.i.Ud(h.position);D.setPosition(d)}if(h.isDirectional&&(D.setDirectionalCone(h.coneInnerAngle||360,h.coneOuterAngle||360,h.coneOuterGain||0),h.localDirectionToMesh)){const d=A.i.Ud(h.localDirectionToMesh);D.setLocalDirectionToMesh(d)}if(h.connectedMeshId){const m=d.getMeshById(h.connectedMeshId);m&&D.attachToMesh(m)}return h.metadata&&(D.metadata=h.metadata),D}_setOffset(h){this._offset!==h&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=h)}_clearTimeoutsAndObservers(){var h;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(h=Xd.b.audioEngine)||void 0===h||h.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}ud._SceneComponentInitialization=h=>{throw(0,ed.b)("AudioSceneComponent")},(0,oh.i)("BABYLON.Sound",ud);class Pd{constructor(h,d,m){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],d.length!==m.length)throw new Error("Sounds length does not equal weights length");this.loop=h,this._weights=m;let j=0;for(const b of m)j+=b;const A=j>0?1/j:0;for(let b=0;b<this._weights.length;b++)this._weights[b]*=A;this._sounds=d;for(const b of this._sounds)b.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!==this._coneInnerAngle){if(this._coneOuterAngle<h)return void Z.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h;for(const d of this._sounds)d.directionalConeInnerAngle=h}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!==this._coneOuterAngle){if(h<this._coneInnerAngle)return void Z.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h;for(const d of this._sounds)d.directionalConeOuterAngle=h}}get volume(){return this._volume}set volume(h){if(h!==this._volume)for(const d of this._sounds)d.setVolume(h)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(h){if(!this.isPaused){this.stop();const h=Math.random();let d=0;for(let m=0;m<this._weights.length;m++)if(d+=this._weights[m],h<=d){this._currentIndex=m;break}}const d=this._sounds[this._currentIndex??0];d.isReady()?d.play(0,this.isPaused?void 0:h):d.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Gd{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(h=h||R.b.LastCreatedScene)&&(this._scene=h,this.soundCollection=[],this._options=d,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var h;null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&Xd.b.audioEngine.audioContext&&(this._outputAudioNode=Xd.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Xd.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Xd.b.audioEngine&&Xd.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(h){var d;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&h.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==h.soundTrackId&&(-1===h.soundTrackId?this._scene.mainSoundTrack.removeSound(h):this._scene.soundTracks&&this._scene.soundTracks[h.soundTrackId].removeSound(h)),this.soundCollection.push(h),h.soundTrackId=this.id}removeSound(h){const d=this.soundCollection.indexOf(h);-1!==d&&this.soundCollection.splice(d,1)}setVolume(h){var d;null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=h)}switchPanningModelToHRTF(){var h;if(null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var h;if(null!==(h=Xd.b.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToEqualPower()}connectToAnalyser(h){var d;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=h,null!==(d=Xd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Xd.b.audioEngine.masterGain))}}var hm=m(11461),dm=m(11604),mm=m(11115);Xd.b.AudioEngineFactory=(h,d,m)=>new jm(h,d,m);class jm{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new M.e,this.onAudioLockedObservable=new M.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,mm.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const j=document.createElement("audio");this._hostElement=h,this._audioContext=d,this._audioDestination=m;try{j&&j.canPlayType&&(j.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||j.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(A){}try{j&&j.canPlayType&&j.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(A){}}lock(){this._triggerSuspendedState()}unlock(){var h,d;if("running"===(null===(h=this._audioContext)||void 0===h?void 0:h.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(d=this._audioContext)||void 0===d||d.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Z.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var h;null===(h=this._audioContext)||void 0===h||h.addEventListener("statechange",(()=>{var h;this.unlocked&&"running"!==(null===(h=this._audioContext)||void 0===h?void 0:h.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var h;return null!==(h=this._audioContext)&&void 0!==h&&h.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(h){this.canUseWebAudio=!1,Z.c.Error("Web Audio: "+h.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(h){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const h=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",d=document.createElement("style");d.appendChild(document.createTextNode(h)),document.getElementsByTagName("head")[0].appendChild(d),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var h;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(h=this._audioContext)||void 0===h||h.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(h){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=h)}connectToAnalyser(h){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=h,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Am=m(11132);(0,m(12336).f)(hm.b.NAME_AUDIO,((h,d,m,j)=>{let A,b=[];if(m.sE=m.sE||[],void 0!==h.sE&&null!==h.sE)for(let a=0,D=h.sE.length;a<D;a++){var w;const D=h.sE[a];null!==(w=Xd.b.audioEngine)&&void 0!==w&&w.canUseWebAudio?(D.url||(D.url=D.name),b[D.url]?m.sE.push(ud.Parse(D,d,j,b[D.url])):(A=ud.Parse(D,d,j),b[D.url]=A,m.sE.push(A))):m.sE.push(new ud(D.name,null,d))}b=[]})),Object.defineProperty(dm.c.prototype,"mainSoundTrack",{get:function(){let h=this._getComponent(hm.b.NAME_AUDIO);return h||(h=new bm(this),this.o(h)),this._mainSoundTrack||(this._mainSoundTrack=new Gd(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),dm.c.prototype.getSoundByName=function(h){let d;for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===h)return this.mainSoundTrack.soundCollection[d];if(this.soundTracks)for(let m=0;m<this.soundTracks.length;m++)for(d=0;d<this.soundTracks[m].soundCollection.length;d++)if(this.soundTracks[m].soundCollection[d].name===h)return this.soundTracks[m].soundCollection[d];return null},Object.defineProperty(dm.c.prototype,"audioEnabled",{get:function(){let h=this._getComponent(hm.b.NAME_AUDIO);return h||(h=new bm(this),this.o(h)),h.audioEnabled},set:function(h){let d=this._getComponent(hm.b.NAME_AUDIO);d||(d=new bm(this),this.o(d)),h?d.enableAudio():d.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(dm.c.prototype,"headphone",{get:function(){let h=this._getComponent(hm.b.NAME_AUDIO);return h||(h=new bm(this),this.o(h)),h.headphone},set:function(h){let d=this._getComponent(hm.b.NAME_AUDIO);d||(d=new bm(this),this.o(d)),h?d.switchAudioModeForHeadphones():d.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(dm.c.prototype,"audioListenerPositionProvider",{get:function(){let h=this._getComponent(hm.b.NAME_AUDIO);return h||(h=new bm(this),this.o(h)),h.audioListenerPositionProvider},set:function(h){let d=this._getComponent(hm.b.NAME_AUDIO);if(d||(d=new bm(this),this.o(d)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");d.audioListenerPositionProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(dm.c.prototype,"audioListenerRotationProvider",{get:function(){let h=this._getComponent(hm.b.NAME_AUDIO);return h||(h=new bm(this),this.o(h)),h.audioListenerRotationProvider},set:function(h){let d=this._getComponent(hm.b.NAME_AUDIO);if(d||(d=new bm(this),this.o(d)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");d.audioListenerRotationProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(dm.c.prototype,"audioPositioningRefreshRate",{get:function(){let h=this._getComponent(hm.b.NAME_AUDIO);return h||(h=new bm(this),this.o(h)),h.audioPositioningRefreshRate},set:function(h){let d=this._getComponent(hm.b.NAME_AUDIO);d||(d=new bm(this),this.o(d)),d.audioPositioningRefreshRate=h},enumerable:!0,configurable:!0});class bm{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(h){this.name=hm.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new A.i,this._cachedCameraPosition=new A.i,this._lastCheck=0,this._invertMatrixTemp=new A.b,this._cameraDirectionTemp=new A.i,(h=h||R.b.LastCreatedScene)&&(this.Fd=h,h.soundTracks=[],h.sE=[])}register(){this.Fd._afterRenderStage.registerStep(hm.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(h){if(h.sE=[],this.Fd.soundTracks)for(let d=0;d<this.Fd.soundTracks.length;d++){const m=this.Fd.soundTracks[d];for(let d=0;d<m.soundCollection.length;d++)h.sE.push(m.soundCollection[d].serialize())}}addFromContainer(h){if(h.sE)for(const d of h.sE)d.play(),d.autoplay=!0,this.Fd.mainSoundTrack.addSound(d)}removeFromContainer(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h.sE)for(const m of h.sE)m.stop(),m.autoplay=!1,this.Fd.mainSoundTrack.removeSound(m),d&&m.dispose()}dispose(){const h=this.Fd;if(h._mainSoundTrack&&h.mainSoundTrack.dispose(),h.soundTracks)for(let d=0;d<h.soundTracks.length;d++)h.soundTracks[d].dispose()}disableAudio(){const h=this.Fd;let d;for(this._audioEnabled=!1,Xd.b.audioEngine&&Xd.b.audioEngine.audioContext&&Xd.b.audioEngine.audioContext.suspend(),d=0;d<h.mainSoundTrack.soundCollection.length;d++)h.mainSoundTrack.soundCollection[d].pause();if(h.soundTracks)for(d=0;d<h.soundTracks.length;d++)for(let m=0;m<h.soundTracks[d].soundCollection.length;m++)h.soundTracks[d].soundCollection[m].pause()}enableAudio(){const h=this.Fd;let d;for(this._audioEnabled=!0,Xd.b.audioEngine&&Xd.b.audioEngine.audioContext&&Xd.b.audioEngine.audioContext.resume(),d=0;d<h.mainSoundTrack.soundCollection.length;d++)h.mainSoundTrack.soundCollection[d].isPaused&&h.mainSoundTrack.soundCollection[d].play();if(h.soundTracks)for(d=0;d<h.soundTracks.length;d++)for(let m=0;m<h.soundTracks[d].soundCollection.length;m++)h.soundTracks[d].soundCollection[m].isPaused&&h.soundTracks[d].soundCollection[m].play()}switchAudioModeForHeadphones(){const h=this.Fd;if(this._headphone=!0,h.mainSoundTrack.switchPanningModelToHRTF(),h.soundTracks)for(let d=0;d<h.soundTracks.length;d++)h.soundTracks[d].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const h=this.Fd;if(this._headphone=!1,h.mainSoundTrack.switchPanningModelToEqualPower(),h.soundTracks)for(let d=0;d<h.soundTracks.length;d++)h.soundTracks[d].switchPanningModelToEqualPower()}_afterRender(){const h=Am.b.Now;if(this._lastCheck&&h-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=h;const d=this.Fd;if(!this._audioEnabled||!d._mainSoundTrack||!d.soundTracks||0===d._mainSoundTrack.soundCollection.length&&1===d.soundTracks.length)return;const m=Xd.b.audioEngine;if(m&&m.audioContext){let h,j=d.activeCamera;if(d.activeCameras&&d.activeCameras.length>0&&(j=d.activeCameras[0]),this.audioListenerPositionProvider){const h=this.audioListenerPositionProvider();m.audioContext.listener.setPosition(h.x||0,h.y||0,h.z||0)}else j?this._cachedCameraPosition.equals(j.globalPosition)||(this._cachedCameraPosition.D(j.globalPosition),m.audioContext.listener.setPosition(j.globalPosition.x,j.globalPosition.y,j.globalPosition.z)):m.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const h=this.audioListenerRotationProvider();m.audioContext.listener.setOrientation(h.x||0,h.y||0,h.z||0,0,1,0)}else j?(j.rigCameras&&j.rigCameras.length>0&&(j=j.rigCameras[0]),j.getViewMatrix().invertToRef(this._invertMatrixTemp),A.i.TransformNormalToRef(bm._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.D(this._cameraDirectionTemp),m.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):m.audioContext.listener.setOrientation(0,0,0,0,1,0);for(h=0;h<d.mainSoundTrack.soundCollection.length;h++){const m=d.mainSoundTrack.soundCollection[h];m.useCustomAttenuation&&m.updateDistanceFromListener()}if(d.soundTracks)for(h=0;h<d.soundTracks.length;h++)for(let m=0;m<d.soundTracks[h].soundCollection.length;m++){const j=d.soundTracks[h].soundCollection[m];j.useCustomAttenuation&&j.updateDistanceFromListener()}}}}bm._CameraDirection=new A.i(0,0,-1),ud._SceneComponentInitialization=h=>{let d=h._getComponent(hm.b.NAME_AUDIO);d||(d=new bm(h),h.o(d))};const wm="MSFT_audio_emitter";class am{constructor(h){this.name=wm,this._loader=h,this.enabled=this._loader.isExtensionUsed(wm)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const h=this._loader.mb.extensions;if(h&&h[this.name]){const d=h[this.name];this._clips=d.clips,this._emitters=d.emitters,U.Assign(this._clips),U.Assign(this._emitters)}}loadSceneAsync(h,d){return J.LoadExtensionAsync(h,d,this.name,(async(m,j)=>{const A=new Array;A.push(this._loader.loadSceneAsync(h,d));for(const h of j.emitters){const d=U.Get(`${m}/emitters`,this._emitters,h);if(void 0!=d.refDistance||void 0!=d.maxDistance||void 0!=d.rolloffFactor||void 0!=d.distanceModel||void 0!=d.innerAngle||void 0!=d.outerAngle)throw new Error(`${m}: Direction or Distance properties are not allowed on emitters attached to a scene`);A.push(this._loadEmitterAsync(`${m}/emitters/${d.index}`,d))}await Promise.all(A)}))}loadNodeAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(h,j)=>{const b=new Array,a=await this._loader.loadNodeAsync(h,d,(d=>{for(const m of j.emitters){const j=U.Get(`${h}/emitters`,this._emitters,m);b.push(this._loadEmitterAsync(`${h}/emitters/${j.index}`,j).then((()=>{for(const h of j._babylonSounds)h.attachToMesh(d),void 0==j.innerAngle&&void 0==j.outerAngle||(h.setLocalDirectionToMesh(A.i.Forward()),h.setDirectionalCone(2*w.e.ToDegrees(void 0==j.innerAngle?Math.PI:j.innerAngle),2*w.e.ToDegrees(void 0==j.outerAngle?Math.PI:j.outerAngle),0))})))}m(d)}));return await Promise.all(b),a}))}loadAnimationAsync(h,d){return J.LoadExtensionAsync(h,d,this.name,(async(m,j)=>{const A=await this._loader.loadAnimationAsync(h,d),b=new Array;U.Assign(j.events);for(const w of j.events)b.push(this._loadAnimationEventAsync(`${m}/events/${w.index}`,h,d,w,A));return await Promise.all(b),A}))}_loadClipAsync(h,d){if(d._objectURL)return d._objectURL;let m;if(d.uri)m=this._loader.loadUriAsync(h,d,d.uri);else{const j=U.Get(`${h}/bufferView`,this._loader.mb.bufferViews,d.bufferView);m=this._loader.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}return d._objectURL=m.then((h=>URL.createObjectURL(new Blob([h],{type:d.mimeType})))),d._objectURL}_loadEmitterAsync(h,d){if(d._babylonSounds=d._babylonSounds||[],!d._babylonData){const h=new Array,m=d.name||`emitter${d.index}`,j={loop:!1,autoplay:!1,volume:void 0==d.volume?1:d.volume};for(let b=0;b<d.clips.length;b++){const A=`/extensions/${this.name}/clips`,w=U.Get(A,this._clips,d.clips[b].clip);h.push(this._loadClipAsync(`${A}/${d.clips[b].clip}`,w).then((h=>{const A=d._babylonSounds[b]=new ud(m,h,this._loader.babylonScene,null,j);A.refDistance=d.refDistance||1,A.maxDistance=d.maxDistance||256,A.rolloffFactor=d.rolloffFactor||1,A.distanceModel=d.distanceModel||"exponential"})))}const A=Promise.all(h).then((()=>{const h=d.clips.map((h=>h.weight||1)),m=new Pd(d.loop||!1,d._babylonSounds,h);d.innerAngle&&(m.directionalConeInnerAngle=2*w.e.ToDegrees(d.innerAngle)),d.outerAngle&&(m.directionalConeOuterAngle=2*w.e.ToDegrees(d.outerAngle)),d.volume&&(m.volume=d.volume),d._babylonData.sound=m}));d._babylonData={loaded:A}}return d._babylonData.loaded}_getEventAction(h,d,m,j,A){switch(m){case"play":return h=>{const m=(A||0)+(h-j);d.play(m)};case"stop":return()=>{d.stop()};case"pause":return()=>{d.pause()};default:throw new Error(`${h}: Unsupported action ${m}`)}}_loadAnimationEventAsync(h,d,m,j,A){if(0==A.targetedAnimations.length)return Promise.resolve();const b=A.targetedAnimations[0],w=j.k,a=U.Get(`/extensions/${this.name}/emitters`,this._emitters,w);return this._loadEmitterAsync(h,a).then((()=>{const d=a._babylonData.sound;if(d){const m=new pd(j.time,this._getEventAction(h,d,j.action,j.time,j.startOffset));b.animation.addEvent(m),A.onAnimationGroupEndObservable.add((()=>{d.stop()})),A.onAnimationGroupPauseObservable.add((()=>{d.pause()}))}}))}}Y(wm),r(wm,!0,(h=>new am(h)));const Dm="MSFT_lod";class Sm{constructor(h){var d;this.name=Dm,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new M.e,this.onMaterialLODsLoadedObservable=new M.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=h,this.maxLODsToLoad=(null===(d=this._loader.parent.extensionOptions[Dm])||void 0===d?void 0:d.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Dm)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let h=0;h<this._nodePromiseLODs.length;h++){const d=Promise.all(this._nodePromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Node LOD ${h}`),this._loader.log(`Loaded node LOD ${h}`)),this.onNodeLODsLoadedObservable.notifyObservers(h),h!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${h+1}`),this._loadBufferLOD(this._nodeBufferLODs,h+1),this._nodeSignalLODs[h]&&this._nodeSignalLODs[h].resolve())}));this._loader._completePromises.push(d)}for(let h=0;h<this._materialPromiseLODs.length;h++){const d=Promise.all(this._materialPromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Material LOD ${h}`),this._loader.log(`Loaded material LOD ${h}`)),this.onMaterialLODsLoadedObservable.notifyObservers(h),h!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${h+1}`),this._loadBufferLOD(this._materialBufferLODs,h+1),this._materialSignalLODs[h]&&this._materialSignalLODs[h].resolve())}));this._loader._completePromises.push(d)}}loadSceneAsync(h,d){const m=this._loader.loadSceneAsync(h,d);return this._loadBufferLOD(this._bufferLODs,0),m}loadNodeAsync(h,d,m){return J.LoadExtensionAsync(h,d,this.name,(async(h,A)=>{let b;const w=this._getLODs(h,d,this._loader.mb.nodes,A.ids);this._loader.logOpen(`${h}`);for(let d=0;d<w.length;d++){const h=w[d];0!==d&&(this._nodeIndexLOD=d,this._nodeSignalLODs[d]=this._nodeSignalLODs[d]||new j);const A=h=>{m(h),h.jD(!1)},a=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,A).then((h=>{if(0!==d){const h=w[d-1];h._babylonTransformNode&&(this._disposeTransformNode(h._babylonTransformNode),delete h._babylonTransformNode)}return h.jD(!0),h}));this._nodePromiseLODs[d]=this._nodePromiseLODs[d]||[],0===d?b=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[d].push(a))}return this._loader.logClose(),await b}))}_loadMaterialAsync(h,d,m,j,A){return this._nodeIndexLOD?null:J.LoadExtensionAsync(h,d,this.name,(async(h,b)=>{let w;const a=this._getLODs(h,d,this._loader.mb.materials,b.ids);this._loader.logOpen(`${h}`);for(let d=0;d<a.length;d++){const h=a[d];0!==d&&(this._materialIndexLOD=d);const b=this._loader._loadMaterialAsync(`/materials/${h.index}`,h,m,j,(h=>{0===d&&A(h)})).then((h=>{if(0!==d){A(h);const m=a[d-1]._data;m[j]&&(this._disposeMaterials([m[j].babylonMaterial]),delete m[j])}return h}));this._materialPromiseLODs[d]=this._materialPromiseLODs[d]||[],0===d?w=b:(this._materialIndexLOD=null,this._materialPromiseLODs[d].push(b))}return this._loader.logClose(),await w}))}_loadUriAsync(h,d,m){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const A=this._nodeIndexLOD-1;return this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new j,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(h,d,m)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const A=this._materialIndexLOD-1;return this._materialSignalLODs[A]=this._materialSignalLODs[A]||new j,this._materialSignalLODs[A].promise.then((async()=>await this._loader.loadUriAsync(h,d,m)))}return null}loadBufferAsync(h,d,m,A){if(this._loader.parent.useRangeRequests&&!d.uri){if(!this._loader.bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);const d=async(h,d)=>{const b=m,w=b+A-1;let a=h[d];return a?(a.start=Math.min(a.start,b),a.end=Math.max(a.end,w)):(a={start:b,end:w,loaded:new j},h[d]=a),await a.loaded.promise.then((h=>new Uint8Array(h.buffer,h.byteOffset+m-a.start,A)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?d(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?d(this._materialBufferLODs,this._materialIndexLOD):d(this._bufferLODs,0)}return null}_loadBufferLOD(h,d){const m=h[d];m&&(this._loader.log(`Loading buffer range [${m.start}-${m.end}]`),this._loader.bin.readAsync(m.start,m.end-m.start+1).then((h=>{m.loaded.resolve(h)}),(h=>{m.loaded.reject(h)})))}_getLODs(h,d,m,j){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const A=[];for(let b=j.length-1;b>=0;b--)if(A.push(U.Get(`${h}/ids/${j[b]}`,m,j[b])),A.length===this.maxLODsToLoad)return A;return A.push(d),A}_disposeTransformNode(h){const d=[],m=h.material;m&&d.push(m);for(const A of h.getChildMeshes())A.material&&d.push(A.material);h.dispose();const j=d.filter((h=>this._loader.babylonScene.meshes.every((d=>d.material!=h))));this._disposeMaterials(j)}_disposeMaterials(h){const d={};for(const m of h){for(const h of m.getActiveTextures())d[h.uniqueId]=h;m.dispose()}for(const m in d)for(const h of this._loader.babylonScene.materials)h.hasTexture(d[m])&&delete d[m];for(const m in d)d[m].dispose()}}Y(Dm),r(Dm,!0,(h=>new Sm(h)));const Mm="MSFT_minecraftMesh";class qm{constructor(h){this.name=Mm,this._loader=h,this.enabled=this._loader.isExtensionUsed(Mm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtraAsync(h,d,this.name,(async(j,A)=>{if(A){if(!(m instanceof v.d))throw new Error(`${j}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(h,d,m);return m.needAlphaBlending()&&(m.forceDepthWrite=!0,m.separateCullingPass=!0),m.yd=m.forceDepthWrite,m.twoSidedLighting=!0,await A}}))}}Y(Mm),r(Mm,!0,(h=>new qm(h)));const Em="MSFT_sRGBFactors";class Im{constructor(h){this.name=Em,this._loader=h,this.enabled=this._loader.isExtensionUsed(Em)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,m){return J.LoadExtraAsync(h,d,this.name,(async(j,A)=>{if(A){if(!(m instanceof v.d))throw new Error(`${j}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(h,d,m),b=m.ih().getEngine().useExactSrgbConversions;return m.albedoTexture||m.albedoColor.toLinearSpaceToRef(m.albedoColor,b),m.reflectivityTexture||m.reflectivityColor.toLinearSpaceToRef(m.reflectivityColor,b),await A}}))}}Y(Em),r(Em,!0,(h=>new Im(h)));var Rm=m(12651);const Zm={};var Lm=m(12703),Bm=m(12681),Vm=m(12659),vm=m(12671);function Cm(h,d){for(const m of h)for(const h of m.dataOutputs)if(h.uniqueId===d)return h;throw new Error("Could not find data out connection with unique id "+d)}function Tm(h,d){for(const m of h)if(m instanceof Bm.c)for(const h of m.signalInputs)if(h.uniqueId===d)return h;throw new Error("Could not find signal in connection with unique id "+d)}async function om(h,d){const j=await Promise.all(h.allBlocks.map((async h=>{const d=function(h){switch(h){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([m.e(58),m.e(59)]).then(m.bind(m,14045))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await m.e(60).then(m.bind(m,14054))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await m.e(61).then(m.bind(m,14058))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await m.e(62).then(m.bind(m,14067))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await m.e(63).then(m.bind(m,14076))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await m.e(64).then(m.bind(m,14084))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await m.e(65).then(m.bind(m,14091))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await m.e(66).then(m.bind(m,14100))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await m.e(67).then(m.bind(m,14105))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await m.e(70).then(m.bind(m,14140))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await m.e(70).then(m.bind(m,14140))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await m.e(70).then(m.bind(m,14140))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await m.e(70).then(m.bind(m,14140))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await m.e(75).then(m.bind(m,14144))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await m.e(76).then(m.bind(m,14147))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await m.e(77).then(m.bind(m,14154))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await m.e(78).then(m.bind(m,14157))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await m.e(79).then(m.bind(m,14165))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await m.e(80).then(m.bind(m,14169))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await m.e(81).then(m.bind(m,14173))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await m.e(82).then(m.bind(m,14175))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await m.e(83).then(m.bind(m,14179))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await m.e(84).then(m.bind(m,14183))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await m.e(85).then(m.bind(m,14186))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await m.e(86).then(m.bind(m,14192))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await m.e(87).then(m.bind(m,14196))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await m.e(88).then(m.bind(m,14205))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await m.e(89).then(m.bind(m,14208))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await m.e(90).then(m.bind(m,14213))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await m.e(91).then(m.bind(m,14222))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await m.e(92).then(m.bind(m,14225))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await m.e(93).then(m.bind(m,14227))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await m.e(72).then(m.bind(m,14232))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await m.e(94).then(m.bind(m,14234))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await m.e(95).then(m.bind(m,14242))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await m.e(96).then(m.bind(m,14251))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await m.e(73).then(m.bind(m,14253))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await m.e(68).then(m.bind(m,14112))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await m.e(74).then(m.bind(m,14257))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await m.e(69).then(m.bind(m,14137))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await m.e(70).then(m.bind(m,14140))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await m.e(70).then(m.bind(m,14140))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await m.e(71).then(m.bind(m,14261))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await m.e(71).then(m.bind(m,14261))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await m.e(71).then(m.bind(m,14261))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await m.e(71).then(m.bind(m,14261))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await m.e(71).then(m.bind(m,14261))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await m.e(71).then(m.bind(m,14261))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await m.e(97).then(m.bind(m,14264))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await m.e(98).then(m.bind(m,14269))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await m.e(99).then(m.bind(m,14277))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await m.e(100).then(m.bind(m,14280))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await m.e(101).then(m.bind(m,14282))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await m.e(102).then(m.bind(m,14286))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await m.e(103).then(m.bind(m,14290))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await m.e(104).then(m.bind(m,14297))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await m.e(105).then(m.bind(m,14304))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await m.e(106).then(m.bind(m,14309))).FlowGraphDataSwitchBlock;default:if(Zm[h])return Zm[h];throw new Error(`Unknown block name ${h}`)}}(h.className);return await d()})));return function(h,d,m){const j=d.coordinator.createGraph(),A=[],b=d.valueParseFunction??Vm.b;for(let w=0;w<h.allBlocks.length;w++){const a=im(h.allBlocks[w],{Fd:d.coordinator.config.Fd,pathConverter:d.pathConverter,assetsContainer:d.coordinator.config.Fd,valueParseFunction:b},m[w]);A.push(a),a instanceof Lm.c&&j.addEventBlock(a)}for(const w of A){for(const h of w.dataInputs)for(const d of h.connectedPointIds){const m=Cm(A,d);h.connectTo(m)}if(w instanceof Bm.c)for(const h of w.signalOutputs)for(const d of h.connectedPointIds){const m=Tm(A,d);h.connectTo(m)}}for(const w of h.executionContexts)ym(w,{graph:j,valueParseFunction:b},h.rightHanded);return j}(h,d,j)}function ym(h,d,m){const j=d.graph.createContext();h.enableLogging&&(j.enableLogging=!0),j.treatDataAsRightHanded=m||!1;const A=d.valueParseFunction??Vm.b;j.uniqueId=h.uniqueId;const b=j.ih();if(h._assetsContext){var w,a,D,S,M,q,E,I,R,Z;const d=h._assetsContext,m={meshes:null===(w=d.meshes)||void 0===w?void 0:w.map((h=>b.getMeshById(h))),lights:null===(a=d.lights)||void 0===a?void 0:a.map((h=>b.getLightByName(h))),cameras:null===(D=d.cameras)||void 0===D?void 0:D.map((h=>b.getCameraByName(h))),materials:null===(S=d.materials)||void 0===S?void 0:S.map((h=>b.getMaterialById(h))),textures:null===(M=d.textures)||void 0===M?void 0:M.map((h=>b.getTextureByName(h))),animations:null===(q=d.animations)||void 0===q?void 0:q.map((h=>b.animations.find((d=>d.name===h)))),skeletons:null===(E=d.skeletons)||void 0===E?void 0:E.map((h=>b.getSkeletonByName(h))),aE:null===(I=d.aE)||void 0===I?void 0:I.map((h=>b.getParticleSystemById(h))),animationGroups:null===(R=d.animationGroups)||void 0===R?void 0:R.map((h=>b.getAnimationGroupByName(h))),transformNodes:null===(Z=d.transformNodes)||void 0===Z?void 0:Z.map((h=>b.getTransformNodeById(h))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],sE:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};j.assetsContext=m}for(const L in h._userVariables){const d=A(L,h._userVariables,j.assetsContext,b);j.userVariables[L]=d}for(const L in h._connectionValues){const d=A(L,h._connectionValues,j.assetsContext,b);j._setConnectionValueByKey(L,d)}return j}function im(h,d,m){const j={},A=d.valueParseFunction??Vm.b;if(h.config)for(const w in h.config)j[w]=A(w,h.config,d.assetsContainer||d.Fd,d.Fd);if((0,Vm.g)(h.className)){if(!d.pathConverter)throw new Error("Path converter is required for this block");j.pathConverter=d.pathConverter}const b=new m(j);b.uniqueId=h.uniqueId;for(let w=0;w<h.dataInputs.length;w++){const d=b.getDataInput(h.dataInputs[w].name);if(!d)throw new Error("Could not find data input with name "+h.dataInputs[w].name+" in block "+h.className);d.deserialize(h.dataInputs[w])}for(let w=0;w<h.dataOutputs.length;w++){const d=b.getDataOutput(h.dataOutputs[w].name);if(!d)throw new Error("Could not find data output with name "+h.dataOutputs[w].name+" in block "+h.className);d.deserialize(h.dataOutputs[w])}return b.metadata=h.metadata,b.deserialize&&b.deserialize(h),b}function gm(h){const[d,m]=h.split(":");return Fm({op:d,extension:m})}function Fm(h){var d;let m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=h.extension?null===(d=Hm[h.extension])||void 0===d?void 0:d[h.op]:cm[h.op];if(!j&&(Z.c.Warn(`No mapping found for operation ${h.op} and extension ${h.extension||"KHR_interactivity"}`),m)){const d={},m={flows:{}};if(h.inputValueSockets){d.values={};for(const m in h.inputValueSockets)d.values[m]={name:m}}return h.outputValueSockets&&(m.values={},Object.keys(h.outputValueSockets).forEach((h=>{m.values[h]={name:h}}))),{iM:[],inputs:d,outputs:m}}return j}function fm(h,d,m){Hm[d]||(Hm[d]={}),Hm[d][h]=m}const Hm={BABYLON:{"flow/log":{iM:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},cm={"event/onStart":{iM:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{iM:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{iM:["FlowGraphSendCustomEventBlock"],extraProcessor(h,d,m,j,A){if("event/send"!==d.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const b=h.configuration.event.value[0];if("number"!==typeof b)throw new Error("Event id should be a number");const w=j.arrays.events[b],a=A[0];return a.config||(a.config={}),a.config.eventId=w.eventId,a.config.eventData=w.eventData,A}},"event/receive":{iM:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(h,d){var m;if(!h.configuration)return Z.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const j=h.configuration.event;if(!j)return Z.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const A=j.value[0];if("number"!==typeof A)return Z.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(m=d.events)||void 0===m?void 0:m[A])?{valid:!0}:(Z.c.Error(`Event with id ${A} not found`),{valid:!1,error:`Event with id ${A} not found`})},extraProcessor(h,d,m,j,A){if("event/receive"!==d.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const b=h.configuration.event.value[0];if("number"!==typeof b)throw new Error("Event id should be a number");const w=j.arrays.events[b],a=A[0];return a.config||(a.config={}),a.config.eventId=w.eventId,a.config.eventData=w.eventData,A}},"math/e":km("FlowGraphEBlock"),"math/pi":km("FlowGraphPIBlock"),"math/inf":km("FlowGraphInfBlock"),"math/nan":km("FlowGraphNaNBlock"),"math/abs":km("FlowGraphAbsBlock"),"math/sign":km("FlowGraphSignBlock"),"math/trunc":km("FlowGraphTruncBlock"),"math/floor":km("FlowGraphFloorBlock"),"math/ceil":km("FlowGraphCeilBlock"),"math/round":{iM:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A){var b;return(b=A[0]).config||(b.config={}),A[0].config.roundHalfAwayFromZero=!0,A}},"math/fract":km("FlowGraphFractBlock"),"math/neg":km("FlowGraphNegationBlock"),"math/add":km("FlowGraphAddBlock",["a","b"],!0),"math/sub":km("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{iM:["FlowGraphMultiplyBlock"],extraProcessor(h,d,m,j,A){var b;(b=A[0]).config||(b.config={}),A[0].config.useMatrixPerComponent=!0,A[0].config.preventIntegerFloatArithmetic=!0;let w=-1;return Object.keys(h.values||{}).find((d=>{var m;return void 0!==(null===(m=h.values)||void 0===m?void 0:m[d].type)&&(w=h.values[d].type,!0)})),-1!==w&&(A[0].config.type=j.arrays.types[w].flowGraphType),A},validation:h=>h.values?lm(h):{valid:!0}},"math/div":km("FlowGraphDivideBlock",["a","b"],!0),"math/rem":km("FlowGraphModuloBlock",["a","b"]),"math/min":km("FlowGraphMinBlock",["a","b"]),"math/max":km("FlowGraphMaxBlock",["a","b"]),"math/clamp":km("FlowGraphClampBlock",["a","b","c"]),"math/saturate":km("FlowGraphSaturateBlock"),"math/mix":km("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":km("FlowGraphEqualityBlock",["a","b"]),"math/lt":km("FlowGraphLessThanBlock",["a","b"]),"math/le":km("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":km("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":km("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":km("FlowGraphIsNaNBlock"),"math/isinf":km("FlowGraphIsInfBlock"),"math/select":{iM:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{iM:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":km("FlowGraphSinBlock"),"math/cos":km("FlowGraphCosBlock"),"math/tan":km("FlowGraphTanBlock"),"math/asin":km("FlowGraphASinBlock"),"math/acos":km("FlowGraphACosBlock"),"math/atan":km("FlowGraphATanBlock"),"math/atan2":km("FlowGraphATan2Block",["a","b"]),"math/sinh":km("FlowGraphSinhBlock"),"math/cosh":km("FlowGraphCoshBlock"),"math/tanh":km("FlowGraphTanhBlock"),"math/asinh":km("FlowGraphASinhBlock"),"math/acosh":km("FlowGraphACoshBlock"),"math/atanh":km("FlowGraphATanhBlock"),"math/exp":km("FlowGraphExponentialBlock"),"math/log":km("FlowGraphLogBlock"),"math/log2":km("FlowGraphLog2Block"),"math/log10":km("FlowGraphLog10Block"),"math/sqrt":km("FlowGraphSquareRootBlock"),"math/cbrt":km("FlowGraphCubeRootBlock"),"math/pow":km("FlowGraphPowerBlock",["a","b"]),"math/length":km("FlowGraphLengthBlock"),"math/normalize":km("FlowGraphNormalizeBlock"),"math/dot":km("FlowGraphDotBlock",["a","b"]),"math/cross":km("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":km("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":km("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{iM:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{iM:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{iM:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{iM:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{iM:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{iM:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{iM:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":km("FlowGraphTransposeBlock"),"math/determinant":km("FlowGraphDeterminantBlock"),"math/inverse":km("FlowGraphInvertMatrixBlock"),"math/matmul":km("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{iM:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"td",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A,b){const w=A[0].dataInputs.find((h=>"rotationQuaternion"===h.name));if(!w)throw new Error("Rotation quaternion input not found");return b._connectionValues[w.uniqueId]&&(b._connectionValues[w.uniqueId].type="Quaternion"),A}},"math/matDecompose":{iM:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"td"}}}},"math/quatConjugate":km("FlowGraphConjugateBlock",["a"]),"math/quatMul":{iM:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A){var b;return(b=A[0]).config||(b.config={}),A[0].config.type="Quaternion",A}},"math/quatAngleBetween":km("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{iM:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":km("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":km("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{iM:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A){var b;return(b=A[0]).config||(b.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract2x2":{iM:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{iM:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A){var b;return(b=A[0]).config||(b.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract3x3":{iM:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{iM:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A){var b;return(b=A[0]).config||(b.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract4x4":{iM:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{iM:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A,b){var w,a;(a=A[0]).config||(a.config={});const D=A[0].dataInputs[0];return A[0].config.valueType=(null===(w=b._connectionValues[D.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",A}},"math/and":{iM:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A,b){var w,a,D;(D=A[0]).config||(D.config={});const S=A[0].dataInputs[0],M=A[0].dataInputs[1];return A[0].config.valueType=(null===(w=b._connectionValues[S.uniqueId])||void 0===w?void 0:w.type)??(null===(a=b._connectionValues[M.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",A}},"math/or":{iM:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A,b){var w,a,D;(D=A[0]).config||(D.config={});const S=A[0].dataInputs[0],M=A[0].dataInputs[1];return A[0].config.valueType=(null===(w=b._connectionValues[S.uniqueId])||void 0===w?void 0:w.type)??(null===(a=b._connectionValues[M.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",A}},"math/xor":{iM:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,m,j,A,b){var w,a,D;(D=A[0]).config||(D.config={});const S=A[0].dataInputs[0],M=A[0].dataInputs[1];return A[0].config.valueType=(null===(w=b._connectionValues[S.uniqueId])||void 0===w?void 0:w.type)??(null===(a=b._connectionValues[M.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",A}},"math/asr":km("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":km("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":km("FlowGraphLeadingZerosBlock"),"math/ctz":km("FlowGraphTrailingZerosBlock"),"math/popcnt":km("FlowGraphOneBitsCounterBlock"),"math/rad":km("FlowGraphDegToRadBlock"),"math/deg":km("FlowGraphRadToDegBlock"),"type/boolToInt":km("FlowGraphBooleanToInt"),"type/boolToFloat":km("FlowGraphBooleanToFloat"),"type/intToBool":km("FlowGraphIntToBoolean"),"type/intToFloat":km("FlowGraphIntToFloat"),"type/floatToInt":km("FlowGraphFloatToInt"),"type/floatToBool":km("FlowGraphFloatToBoolean"),"flow/sequence":{iM:["FlowGraphSequenceBlock"],extraProcessor(h,d,m,j,A){const b=A[0];return b.config||(b.config={}),b.config.outputSignalCount=Object.keys(h.flows||[]).length,b.signalOutputs.forEach(((h,d)=>{h.name="out_"+d})),A}},"flow/branch":{iM:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{iM:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(h){if(h.configuration&&h.configuration.cases){const d=h.configuration.cases.value;if(!d.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return Z.c.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const m=new Set(d);h.configuration.cases.value=Array.from(m)}return{valid:!0}},extraProcessor(h,d,m,j,A){if("flow/switch"!==d.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return A[0].signalOutputs.forEach((h=>{"default"!==h.name&&(h.name="out_"+h.name)})),A}},"flow/while":{iM:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{iM:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(h,d,m,j,A){const b=A[0];return b.config||(b.config={}),b.config.incrementIndexWhenLoopDone=!0,A}},"flow/doN":{iM:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{iM:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(h,d,m,j,A){if("flow/multiGate"!==d.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const b=A[0];return b.config||(b.config={}),b.config.outputSignalCount=Object.keys(h.flows).length,b.signalOutputs.forEach(((h,d)=>{h.name="out_"+d})),A}},"flow/waitAll":{iM:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(h){var d,m;return"number"!==typeof(null===(d=h.configuration)||void 0===d||null===(m=d.inputFlows)||void 0===m?void 0:m.value[0])&&(h.configuration=h.configuration||{inputFlows:{value:[0]}},h.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{iM:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{iM:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{iM:["FlowGraphCancelDelayBlock"]},"variable/get":{iM:["FlowGraphGetVariableBlock"],validation(h){var d,m;return null!==(d=h.configuration)&&void 0!==d&&null!==(m=d.variable)&&void 0!==m&&m.value?{valid:!0}:(Z.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,d)=>[d.getVariableName(h[0])]}}},"variable/set":{iM:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,d)=>[d.getVariableName(h[0])]}}},"variable/setMultiple":{iM:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(h,d)=>[h[0].map((h=>d.getVariableName(h)))]}},extraProcessor:(h,d,m,j,A)=>(A[0].dataInputs.forEach((h=>{h.name=j.getVariableName(+h.name)})),A)},"variable/interpolate":{iM:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(h,d)=>[d.getVariableName(h[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:h=>!0===h[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rm:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rm:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rm:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rm:"FlowGraphPlayAnimationBlock"},out:{name:"out",rm:"FlowGraphPlayAnimationBlock"},done:{name:"done",rm:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(h,d,m,j,A){var b,w,a;const D=A[0],S=null===(b=h.configuration)||void 0===b?void 0:b.variable.value[0];if("number"!==typeof S)throw Z.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const M=j.arrays.staticVariables[S];"undefined"===typeof D.config.animationType.value&&(j.arrays.staticVariables,D.config.animationType.value=(0,vm.H)(M.type));const q=A[4];return q.config||(q.config={}),(w=q.config).variable||(w.variable={}),q.config.variable.value=j.getVariableName(S),(a=A[3]).config||(a.config={}),A}},"pointer/get":{iM:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rm:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",rm:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,d,m,j,A)=>(A.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),A)},"pointer/set":{iM:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rm:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",rm:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,d,m,j,A)=>(A.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),A)},"pointer/interpolate":{iM:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",rm:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",rm:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rm:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rm:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rm:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rm:"FlowGraphPlayAnimationBlock"},out:{name:"out",rm:"FlowGraphPlayAnimationBlock"},done:{name:"done",rm:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,d,m,j,A)=>(A.forEach((d=>{"FlowGraphJsonPointerParserBlock"===d.className?(d.config||(d.config={}),d.config.outputValue=!0):"FlowGraphInterpolationBlock"===d.className&&(d.config||(d.config={}),Object.keys(h.values||[]).forEach((m=>{var A;const b=null===(A=h.values)||void 0===A?void 0:A[m];if("value"===m&&b){const h=b.type;void 0!==h&&(d.config.animationType=j.arrays.types[h].flowGraphType)}})))})),A)},"animation/start":{iM:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rm:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(h,d)=>[h[0]*d._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(h,d)=>[h[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,d,m,j,A,b,w){const a=A[A.length-1];return a.config||(a.config={}),a.config.glTF=w,A}},"animation/stop":{iM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rm:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,d,m,j,A,b,w){const a=A[A.length-1];return a.config||(a.config={}),a.config.glTF=w,A}},"animation/stopAt":{iM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",rm:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(h,d)=>[h[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,d,m,j,A,b,w){const a=A[A.length-1];return a.config||(a.config={}),a.config.glTF=w,A}},"math/switch":{iM:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(h){if(h.configuration&&h.configuration.cases){const d=h.configuration.cases.value;if(!d.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return Z.c.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const m=new Set(d);h.configuration.cases.value=Array.from(m)}return{valid:!0}},extraProcessor(h,d,m,j,A){const b=A[0];return b.dataInputs.forEach((h=>{"default"!==h.name&&"case"!==h.name&&(h.name="in_"+h.name)})),b.config||(b.config={}),b.config.treatCasesAsIntegers=!0,A}},"debug/log":{iM:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function km(h){let d=arguments.length>2?arguments[2]:void 0;return{iM:[h],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((h,d)=>(h[d]={name:d},h)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(h,m,j,A,b){var w;if(d){(w=b[0]).config||(w.config={}),b[0].config.preventIntegerFloatArithmetic=!0;let d=-1;Object.keys(h.values||{}).find((m=>{var j;return void 0!==(null===(j=h.values)||void 0===j?void 0:j[m].type)&&(d=h.values[m].type,!0)})),-1!==d&&(b[0].config.type=A.arrays.types[d].flowGraphType)}return b},validation:h=>d?lm(h):{valid:!0}}}function lm(h){if(h.values){const d=Object.keys(h.values).map((d=>h.values[d].type)).filter((h=>void 0!==h));if(!d.every((h=>h===d[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}cm["math/compose"]=cm["math/matCompose"],cm["math/decompose"]=cm["math/matDecompose"];var Km=m(11245);const Nm={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Qd",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Wm{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=h,this._gltf=d,this._animationTargetFps=m,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const h of this._interactivityGraph.types)this._types.push(Nm[h.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const h of this._interactivityGraph.declarations){const d=Fm(h);if(!d)throw Z.c.Error(["No mapping found for declaration",h]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:d,fullOperationName:h.extension?h.op+":"+h.extension:h.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const h of this._interactivityGraph.variables){const d=this._parseVariable(h);this._staticVariables.push(d)}}_parseVariable(h,d){const m=this._types[h.type];if(!m)throw Z.c.Error(["No type found for variable",h]),new Error("Error parsing variables");if(h.value&&h.value.length!==m.length)throw Z.c.Error(["Invalid value length for variable",h,m]),new Error("Error parsing variables");const j=h.value||[];if(!j.length)switch(m.flowGraphType){case"boolean":j.push(!1);break;case"FlowGraphInteger":j.push(0);break;case"number":j.push(NaN);break;case"Vector2":j.push(NaN,NaN);break;case"Qd":j.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":j.fill(NaN,0,4);break;case"Matrix":j.fill(NaN,0,16);break;case"Matrix3D":j.fill(NaN,0,9)}return"number"===m.elementType&&"string"===typeof j[0]&&(j[0]=parseFloat(j[0])),{type:m.flowGraphType,value:d?d(j,this):j}}_parseEvents(){if(this._interactivityGraph.events)for(const h of this._interactivityGraph.events){const d={eventId:h.id||"internalEvent_"+this._internalEventsCounter++};h.values&&(d.eventData=Object.keys(h.values).map((d=>{var m;const j=null===(m=h.values)||void 0===m?void 0:m[d];if(!j)throw Z.c.Error(["No value found for event key",d]),new Error("Error parsing events");const A=this._types[j.type];if(!A)throw Z.c.Error(["No type found for event value",j]),new Error("Error parsing events");const b="undefined"!==typeof j.value?this._parseVariable(j):void 0;return{id:d,type:A.flowGraphType,eventData:!0,value:b}}))),this._events.push(d)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const d of this._interactivityGraph.nodes){if("number"!==typeof d.declaration)throw Z.c.Error(["No declaration found for node",d]),new Error("Error parsing nodes");const m=this._mappings[d.declaration];if(!m)throw Z.c.Error(["No mapping found for node",d]),new Error("Error parsing nodes");if(m.flowGraphMapping.validation){const j=m.flowGraphMapping.validation(d,this._interactivityGraph,this._gltf);var h;if(!j.valid)throw new Error(`Error validating interactivity node ${null===(h=this._interactivityGraph.declarations)||void 0===h?void 0:h[d.declaration].op} - ${j.error}`)}const j=[];for(const h of m.flowGraphMapping.iM){const A=this._getEmptyBlock(h,m.fullOperationName);this._parseNodeConfiguration(d,A,m.flowGraphMapping,h),j.push(A)}this._nodes.push({iM:j,fullOperationName:m.fullOperationName})}}_getEmptyBlock(h,d){return{uniqueId:(0,Km.d)(),className:h,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:d,metadata:{}}}_parseNodeConfiguration(h,d,m,j){const A=d.config;if(h.configuration){const d=Object.keys(h.configuration);for(const a of d){var b,w;const d=null===(b=h.configuration)||void 0===b?void 0:b[a];if(!d)throw Z.c.Error(["No value found for node configuration",a]),new Error("Error parsing node configuration");const D=null===(w=m.configuration)||void 0===w?void 0:w[a];if(D&&D.rm?D.rm===j:0===m.iM.indexOf(j)){const h=(null===D||void 0===D?void 0:D.name)||a;d&&"undefined"!==typeof d.value||"undefined"===typeof(null===D||void 0===D?void 0:D.defaultValue)?d.value.length>=0?A[h]={value:1===d.value.length?d.value[0]:d.value}:Z.c.Warn(["Invalid value for node configuration",d]):A[h]={value:D.defaultValue},D&&D.dataTransformer&&(A[h].value=D.dataTransformer([A[h].value],this)[0])}}}}_parseNodeConnections(h){for(let o=0;o<this._nodes.length;o++){var d;const y=null===(d=this._interactivityGraph.nodes)||void 0===d?void 0:d[o];if(!y)throw Z.c.Error(["No node found for interactivity node",this._nodes[o]]),new Error("Error parsing node connections");const i=this._nodes[o],g=this._mappings[y.declaration];if(!g)throw Z.c.Error(["No mapping found for node",y]),new Error("Error parsing node connections");const F=y.flows||{},f=Object.keys(F).sort();for(const h of f){var m,j,A,b;const d=F[h],S=null===(m=g.flowGraphMapping.outputs)||void 0===m||null===(j=m.flows)||void 0===j?void 0:j[h],M=(null===S||void 0===S?void 0:S.name)||h,q=this._createNewSocketConnection(M,!0);(S&&S.rm&&i.iM.find((h=>h.className===S.rm))||i.iM[0]).signalOutputs.push(q);const E=d.node,I=this._nodes[E];if(!I)throw Z.c.Error(["No node found for input node id",E]),new Error("Error parsing node connections");const R=gm(I.fullOperationName);if(!R)throw Z.c.Error(["No mapping found for input node",I]),new Error("Error parsing node connections");let L=null===(A=R.inputs)||void 0===A||null===(b=A.flows)||void 0===b?void 0:b[d.socket||"in"],B=!1;if(!L)for(const h in null===(w=R.inputs)||void 0===w?void 0:w.flows){var w,a,D;if(h.startsWith("[")&&h.endsWith("]"))B=!0,L=null===(a=R.inputs)||void 0===a||null===(D=a.flows)||void 0===D?void 0:D[h]}const V=L?B?L.name.replace("$1",d.socket||""):L.name:d.socket||"in",v=L&&L.rm&&I.iM.find((h=>h.className===L.rm))||I.iM[0];let C=v.signalInputs.find((h=>h.name===V));C||(C=this._createNewSocketConnection(V),v.signalInputs.push(C)),C.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(C.uniqueId)}const H=y.values||{},c=Object.keys(H);for(const d of c){var S,M;const m=H[d];let j=null===(S=g.flowGraphMapping.inputs)||void 0===S||null===(M=S.values)||void 0===M?void 0:M[d],A=!1;if(!j)for(const h in null===(q=g.flowGraphMapping.inputs)||void 0===q?void 0:q.values){var q,E,I;if(h.startsWith("[")&&h.endsWith("]"))A=!0,j=null===(E=g.flowGraphMapping.inputs)||void 0===E||null===(I=E.values)||void 0===I?void 0:I[h]}const b=j?A?j.name.replace("$1",d):j.name:d,w=this._createNewSocketConnection(b);if((j&&j.rm&&i.iM.find((h=>h.className===j.rm))||i.iM[0]).dataInputs.push(w),void 0!==m.value){const d=this._parseVariable(m,j&&j.dataTransformer);h._connectionValues[w.uniqueId]=d}else{if("undefined"===typeof m.node)throw Z.c.Error(["Invalid value for value connection",m]),new Error("Error parsing node connections");{var R,L,B;const h=m.node,d=m.socket||"value",j=this._nodes[h];if(!j)throw Z.c.Error(["No node found for output socket reference",m]),new Error("Error parsing node connections");const A=gm(j.fullOperationName);if(!A)throw Z.c.Error(["No mapping found for output socket reference",m]),new Error("Error parsing node connections");let b=null===(R=A.outputs)||void 0===R||null===(L=R.values)||void 0===L?void 0:L[d],a=!1;if(!b)for(const m in null===(V=A.outputs)||void 0===V?void 0:V.values){var V,v,C;if(m.startsWith("[")&&m.endsWith("]"))a=!0,b=null===(v=A.outputs)||void 0===v||null===(C=v.values)||void 0===C?void 0:C[m]}const D=b?a?b.name.replace("$1",d):null===(B=b)||void 0===B?void 0:B.name:d,S=b&&b.rm&&j.iM.find((h=>h.className===b.rm))||j.iM[0];let M=S.dataOutputs.find((h=>h.name===D));M||(M=this._createNewSocketConnection(D,!0),S.dataOutputs.push(M)),w.connectedPointIds.push(M.uniqueId),M.connectedPointIds.push(w.uniqueId)}}}if(g.flowGraphMapping.interBlockConnectors)for(const h of g.flowGraphMapping.interBlockConnectors){const d=h.input,m=h.output,j=h.isVariable;this._connectFlowGraphNodes(d,m,i.iM[h.inputBlockIndex],i.iM[h.outputBlockIndex],j)}if(g.flowGraphMapping.extraProcessor){var T;const d=null===(T=this._interactivityGraph.declarations)||void 0===T?void 0:T[y.declaration];if(!d)throw Z.c.Error(["No declaration found for extra processor",y]),new Error("Error parsing node connections");i.iM=g.flowGraphMapping.extraProcessor(y,d,g.flowGraphMapping,this,i.iM,h,this._gltf)}}}_createNewSocketConnection(h,d){return{uniqueId:(0,Km.d)(),name:h,_connectionType:d?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(h,d,m,j,A){const b=A?m.dataInputs:m.signalInputs,w=A?j.dataOutputs:j.signalOutputs,a=b.find((d=>d.name===h))||this._createNewSocketConnection(h),D=w.find((h=>h.name===d))||this._createNewSocketConnection(d,!0);b.find((d=>d.name===h))||b.push(a),w.find((h=>h.name===d))||w.push(D),a.connectedPointIds.push(D.uniqueId),D.connectedPointIds.push(a.uniqueId)}getVariableName(h){return"staticVariable_"+h}serializeToFlowGraph(){const h={uniqueId:(0,Km.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(h);for(let d=0;d<this._staticVariables.length;d++){const m=this._staticVariables[d];h._userVariables[this.getVariableName(d)]=m}return{rightHanded:!0,allBlocks:this._nodes.reduce(((h,d)=>h.concat(d.iM)),[]),executionContexts:[h]}}}const rm="KHR_interactivity";class Ym{constructor(h){this._loader=h,this.name=rm,this.enabled=this._loader.isExtensionUsed(rm),this._pathConverter=(0,x.f)(this._loader.mb),h._skipStartAnimationStep=!0;const d=h.babylonScene;d&&function(h){(0,x.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!h.activeCamera)return new A.c(NaN,NaN,NaN,NaN);const d=A.c.FromRotationMatrix(h.activeCamera.getWorldMatrix()).normalize();return h.useRightHandedSystem||(d.w*=-1,d.x*=-1),d},type:"Quaternion",getTarget:()=>h.activeCamera}),(0,x.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!h.activeCamera)return new A.i(NaN,NaN,NaN);const d=h.activeCamera.getWorldMatrix().getTranslation();return h.useRightHandedSystem||(d.x*=-1),d},type:"Qd",getTarget:()=>h.activeCamera}),(0,x.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:h=>{var d;return(null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.isPlaying)??!1},type:"boolean",getTarget:h=>h._babylonAnimationGroup}),(0,x.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.from)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,x.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.to)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,x.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,x.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup})}(d)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var h;if(!this._loader.babylonScene||!this._pathConverter)return;const d=this._loader.babylonScene,m=null===(h=this._loader.mb.extensions)||void 0===h?void 0:h.KHR_interactivity;if(!m)return;const j=new Rm.b({Fd:d});j.dispatchEventsSynchronously=!1;const A=m.graphs.map((h=>new Wm(h,this._loader.mb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(A.map((async h=>await om(h,{coordinator:j,pathConverter:this._pathConverter})))),j.start()}}var xm;xm=async()=>(await Promise.resolve().then(m.bind(m,12716))).FlowGraphGLTFDataProvider,Zm[`${rm}/${"FlowGraphGLTFDataProvider"}`]=xm,Y(rm),r(rm,!0,(h=>new Ym(h)));const Qm="KHR_node_visibility";(0,x.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:h=>{const d=h._babylonTransformNode;return!d||void 0===d.isVisible||d.isVisible},set:(h,d)=>{var m,j;null===(m=d._primitiveBabylonMeshes)||void 0===m||m.forEach((h=>{h.inheritVisibility=!0})),d._babylonTransformNode&&(d._babylonTransformNode.isVisible=h),null===(j=d._primitiveBabylonMeshes)||void 0===j||j.forEach((d=>{d.isVisible=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class tm{constructor(h){this.name=Qm,this._loader=h,this.enabled=h.isExtensionUsed(Qm)}async onReady(){var h;null===(h=this._loader.mb.nodes)||void 0===h||h.forEach((h=>{var d,m,j,A;(null===(d=h._primitiveBabylonMeshes)||void 0===d||d.forEach((h=>{h.inheritVisibility=!0})),null!==(m=h.extensions)&&void 0!==m&&m.KHR_node_visibility)&&(!1===(null===(j=h.extensions)||void 0===j?void 0:j.KHR_node_visibility.visible)&&(h._babylonTransformNode&&(h._babylonTransformNode.isVisible=!1),null===(A=h._primitiveBabylonMeshes)||void 0===A||A.forEach((h=>{h.isVisible=!1}))))}))}dispose(){this._loader=null}}Y(Qm),r(Qm,!0,(h=>new tm(h)));const Um="KHR_node_selectability";fm("event/onSelect",Um,{iM:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rm:"FlowGraphGetVariableBlock",dataTransformer:h=>["pickedMesh_"+h[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",rm:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,d,m,j,A,b,w){var a,D,S,M,q,E;const I=A[A.length-1];I.config=I.config||{},I.config.glTF=w;const R=null===(a=h.configuration)||void 0===a||null===(D=a.nodeIndex)||void 0===D?void 0:D.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const Z="pickedMesh_"+R;return A[1].config.variable=Z,b._userVariables[Z]={className:"Mesh",id:null===w||void 0===w||null===(S=w.nodes)||void 0===S||null===(M=S[R]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===w||void 0===w||null===(q=w.nodes)||void 0===q||null===(E=q[R]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},A}}),(0,x.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:h=>{const d=h._babylonTransformNode;return!d||void 0===d.GD||d.GD},set:(h,d)=>{var m;null===(m=d._primitiveBabylonMeshes)||void 0===m||m.forEach((d=>{d.GD=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"GD"],type:"boolean"});class sm{constructor(h){this.name=Um,this._loader=h,this.enabled=h.isExtensionUsed(Um)}async onReady(){var h;null===(h=this._loader.mb.nodes)||void 0===h||h.forEach((h=>{var d,m,j;null!==(d=h.extensions)&&void 0!==d&&d.KHR_node_selectability&&!1===(null===(m=h.extensions)||void 0===m?void 0:m.KHR_node_selectability.selectable)&&(null===(j=h._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((h=>{h.GD=!1})))}))}dispose(){this._loader=null}}Y(Um),r(Um,!0,(h=>new sm(h)));const Jm="KHR_node_hoverability",Om="targetMeshPointerOver_";fm("event/onHoverIn",Jm,{iM:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rm:"FlowGraphGetVariableBlock",dataTransformer:h=>[Om+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rm:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,d,m,j,A,b,w){var a,D,S,M,q,E;const I=A[A.length-1];I.config=I.config||{},I.config.glTF=w;const R=null===(a=h.configuration)||void 0===a||null===(D=a.nodeIndex)||void 0===D?void 0:D.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const Z=Om+R;return A[1].config.variable=Z,b._userVariables[Z]={className:"Mesh",id:null===w||void 0===w||null===(S=w.nodes)||void 0===S||null===(M=S[R]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===w||void 0===w||null===(q=w.nodes)||void 0===q||null===(E=q[R]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},A}});const nm="targetMeshPointerOut_";fm("event/onHoverOut",Jm,{iM:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rm:"FlowGraphGetVariableBlock",dataTransformer:h=>[nm+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rm:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,d,m,j,A,b,w){var a,D,S,M,q,E;const I=A[A.length-1];I.config=I.config||{},I.config.glTF=w;const R=null===(a=h.configuration)||void 0===a||null===(D=a.nodeIndex)||void 0===D?void 0:D.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const Z=nm+R;return A[1].config.variable=Z,b._userVariables[Z]={className:"Mesh",id:null===w||void 0===w||null===(S=w.nodes)||void 0===S||null===(M=S[R]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===w||void 0===w||null===(q=w.nodes)||void 0===q||null===(E=q[R]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},A}}),(0,x.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:h=>{const d=h._babylonTransformNode;return!d||void 0===d.pointerOverDisableMeshTesting||d.pointerOverDisableMeshTesting},set:(h,d)=>{var m;null===(m=d._primitiveBabylonMeshes)||void 0===m||m.forEach((d=>{d.pointerOverDisableMeshTesting=!h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class pm{constructor(h){this.name=Jm,this._loader=h,this.enabled=h.isExtensionUsed(Jm)}async onReady(){var h;null===(h=this._loader.mb.nodes)||void 0===h||h.forEach((h=>{var d,m,j;null!==(d=h.extensions)&&void 0!==d&&d.KHR_node_hoverability&&!1===(null===(m=h.extensions)||void 0===m?void 0:m.KHR_node_hoverability.hoverable)&&(null===(j=h._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((h=>{h.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}Y(Jm),r(Jm,!0,(h=>new pm(h)));const em="ExtrasAsMetadata";class Xm{_assignExtras(h,d){if(d.extras&&Object.keys(d.extras).length>0){const m=h.metadata=h.metadata||{};(m.mb=m.mb||{}).extras=d.extras}}constructor(h){this.name=em,this.enabled=!0,this._loader=h}dispose(){this._loader=null}loadNodeAsync(h,d,m){return this._loader.loadNodeAsync(h,d,(h=>{this._assignExtras(h,d),m(h)}))}loadCameraAsync(h,d,m){return this._loader.loadCameraAsync(h,d,(h=>{this._assignExtras(h,d),m(h)}))}createMaterial(h,d,m){const j=this._loader.createMaterial(h,d,m);return this._assignExtras(j,d),j}}Y(em),r(em,!1,(h=>new Xm(h)));m(12716)},12596:(h,d,m)=>{"use strict";m.d(d,{b:()=>l,f:()=>g,j:()=>i,l:()=>F});var j=m(11097),A=m(11107),b=m(12243),w=m(11419),a=m(11366),D=m(11380),S=m(11121),M=m(11094),q=m(11412),E=m(11736),I=m(11427),R=m(11350);class Z{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.aE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.sE=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(h){this._environmentTexture=h}getNodes(){let h=[];h=h.concat(this.meshes),h=h.concat(this.lights),h=h.concat(this.cameras),h=h.concat(this.transformNodes);for(const d of this.skeletons)h=h.concat(d.bones);return h}}class L extends Z{}class B{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const h=this.rootNodes;for(const j of h)j.dispose();h.length=0;const d=this.skeletons;for(const j of d)j.dispose();d.length=0;const m=this.animationGroups;for(const j of m)j.dispose();m.length=0}}class V extends Z{constructor(h){super(),this._wasAddedToScene=!1,(h=h||M.b.LastCreatedScene)&&(this.Fd=h,this.proceduralTextures=[],h.pd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=h.getEngine().onContextRestoredObservable.add((()=>{for(const h of this.geometries)h._rebuild();for(const h of this.meshes)h._rebuild();for(const h of this.aE)h.rebuild();for(const h of this.textures)h._rebuild()})))}_topologicalSort(h){const d=new Map;for(const w of h)d.set(w.uniqueId,w);const m={dependsOn:new Map,dependedBy:new Map};for(const w of h){const h=w.uniqueId;m.dependsOn.set(h,new Set),m.dependedBy.set(h,new Set)}for(const w of h){const h=w.uniqueId,j=m.dependsOn.get(h);if(w instanceof q.b){const A=w.sourceMesh;d.has(A.uniqueId)&&(j.add(A.uniqueId),m.dependedBy.get(A.uniqueId).add(h))}const A=m.dependedBy.get(h);for(const b of w.getDescendants()){const j=b.uniqueId;if(d.has(j)){A.add(j);m.dependsOn.get(j).add(h)}}}const j=[],A=[];for(const w of h){const h=w.uniqueId;0===m.dependsOn.get(h).size&&(A.push(w),d.delete(h))}const b=A;for(;b.length>0;){const h=b.shift();j.push(h);const A=m.dependedBy.get(h.uniqueId);for(const j of Array.from(A.values())){const A=m.dependsOn.get(j);A.delete(h.uniqueId),0===A.size&&d.get(j)&&(b.push(d.get(j)),d.delete(j))}}return d.size>0&&(S.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),d.forEach((h=>{S.c.Error(h.name)}))),j}_addNodeAndDescendantsToList(h,d,m,j){if(m&&(!j||j(m))&&!d.has(m.uniqueId)){h.push(m),d.add(m.uniqueId);for(const A of m.getDescendants(!0))this._addNodeAndDescendantsToList(h,d,A,j)}}_isNodeInContainer(h){return h instanceof D.b&&-1!==this.meshes.indexOf(h)||(h instanceof a.c&&-1!==this.transformNodes.indexOf(h)||(h instanceof E.d&&-1!==this.lights.indexOf(h)||h instanceof I.e&&-1!==this.cameras.indexOf(h)))}_isValidHierarchy(){for(const h of this.meshes)if(h.parent&&!this._isNodeInContainer(h.parent))return S.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.transformNodes)if(h.parent&&!this._isNodeInContainer(h.parent))return S.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.lights)if(h.parent&&!this._isNodeInContainer(h.parent))return S.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.cameras)if(h.parent&&!this._isNodeInContainer(h.parent))return S.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||A.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const j={},b={},a=new B,D=[],S=[],M={doNotInstantiate:!0,...m},q=[],E=new Set;for(const A of this.transformNodes)null===A.parent&&this._addNodeAndDescendantsToList(q,E,A,M.predicate);for(const A of this.meshes)null===A.parent&&this._addNodeAndDescendantsToList(q,E,A,M.predicate);const I=this._topologicalSort(q),R=(m,A)=>{if(((d,m)=>{if(j[d.uniqueId]=m.uniqueId,b[m.uniqueId]=m,h&&(m.name=h(d.name)),m instanceof w.d){const h=m;if(h.morphTargetManager){const m=d.morphTargetManager;h.morphTargetManager=m.clone();for(let d=0;d<m.numTargets;d++){const A=m.getTarget(d),w=h.morphTargetManager.getTarget(d);j[A.uniqueId]=w.uniqueId,b[w.uniqueId]=w}}}})(m,A),m.parent){const h=j[m.parent.uniqueId],d=b[h];A.parent=d||m.parent}if(A.position&&m.position&&A.position.D(m.position),A.rotationQuaternion&&m.rotationQuaternion&&A.rotationQuaternion.D(m.rotationQuaternion),A.rotation&&m.rotation&&A.rotation.D(m.rotation),A.td&&m.td&&A.td.D(m.td),A.material){const w=A;if(w.material)if(d){const d=m.material;if(-1===S.indexOf(d)){let m=d.clone(h?h(d.name):"Clone of "+d.name);if(S.push(d),j[d.uniqueId]=m.uniqueId,b[m.uniqueId]=m,"MultiMaterial"===d.getClassName()){const A=d;for(const d of A.bb)d&&(m=d.clone(h?h(d.name):"Clone of "+d.name),S.push(d),j[d.uniqueId]=m.uniqueId,b[m.uniqueId]=m);A.bb=A.bb.map((h=>h&&b[j[h.uniqueId]]))}}"InstancedMesh"!==w.getClassName()&&(w.material=b[j[d.uniqueId]])}else"MultiMaterial"===w.material.getClassName()?-1===this.Fd.multiMaterials.indexOf(w.material)&&this.Fd.addMultiMaterial(w.material):-1===this.Fd.materials.indexOf(w.material)&&this.Fd.addMaterial(w.material)}null===A.parent&&a.rootNodes.push(A)};for(const A of I)if("InstancedMesh"===A.getClassName()){const h=A,d=h.sourceMesh,m=j[d.uniqueId];R(h,("number"===typeof m?b[m]:d).createInstance(h.name))}else{let h=!0;"Ib"===A.getClassName()||"Node"===A.getClassName()||A.skeleton||!A.getTotalVertices||0===A.getTotalVertices()?h=!1:M.doNotInstantiate&&(h="function"===typeof M.doNotInstantiate?!M.doNotInstantiate(A):!M.doNotInstantiate);const d=h?A.createInstance(`instance of ${A.name}`):A.clone(`Clone of ${A.name}`,null,!0);if(!d)throw new Error(`Could not clone or instantiate node on Asset Container ${A.name}`);R(A,d)}for(const A of this.skeletons){if(M.predicate&&!M.predicate(A))continue;const d=A.clone(h?h(A.name):"Clone of "+A.name);for(const h of this.meshes)if(h.skeleton===A&&!h.isAnInstance){const m=b[j[h.uniqueId]];if(!m||m.isAnInstance)continue;if(m.skeleton=d,-1!==D.indexOf(d))continue;D.push(d);for(const h of d.bones)h._linkedTransformNode&&(h._linkedTransformNode=b[j[h._linkedTransformNode.uniqueId]])}a.skeletons.push(d)}for(const A of this.animationGroups){if(M.predicate&&!M.predicate(A))continue;const d=A.clone(h?h(A.name):"Clone of "+A.name,(h=>b[j[h.uniqueId]]||h));a.animationGroups.push(d)}return a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||A.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Fd.environmentTexture=this.environmentTexture);for(const h of this.Fd._serializableComponents)h.addFromContainer(this);this.Fd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=[];for(const m of this.cameras)h&&!h(m)||(this.Fd.addCamera(m),d.push(m));for(const m of this.lights)h&&!h(m)||(this.Fd.addLight(m),d.push(m));for(const m of this.meshes)h&&!h(m)||(this.Fd.qM(m),d.push(m));for(const m of this.skeletons)h&&!h(m)||this.Fd.addSkeleton(m);for(const m of this.animations)h&&!h(m)||this.Fd.addAnimation(m);for(const m of this.animationGroups)h&&!h(m)||this.Fd.addAnimationGroup(m);for(const m of this.multiMaterials)h&&!h(m)||this.Fd.addMultiMaterial(m);for(const m of this.materials)h&&!h(m)||this.Fd.addMaterial(m);for(const m of this.morphTargetManagers)h&&!h(m)||this.Fd.addMorphTargetManager(m);for(const m of this.geometries)h&&!h(m)||this.Fd.addGeometry(m);for(const m of this.transformNodes)h&&!h(m)||(this.Fd.addTransformNode(m),d.push(m));for(const m of this.actionManagers)h&&!h(m)||this.Fd.addActionManager(m);for(const m of this.textures)h&&!h(m)||this.Fd.addTexture(m);for(const m of this.reflectionProbes)h&&!h(m)||this.Fd.addReflectionProbe(m);for(const m of d)m.parent&&-1===this.Fd.getNodes().indexOf(m.parent)&&(m.setParent?m.setParent(null):m.parent=null)}removeAllFromScene(){this._isValidHierarchy()||A.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Fd.environmentTexture&&(this.Fd.environmentTexture=null);for(const h of this.Fd._serializableComponents)h.removeFromContainer(this)}removeFromScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const d of this.cameras)h&&!h(d)||this.Fd.removeCamera(d);for(const d of this.lights)h&&!h(d)||this.Fd.removeLight(d);for(const d of this.meshes)h&&!h(d)||this.Fd.MM(d,!0);for(const d of this.skeletons)h&&!h(d)||this.Fd.removeSkeleton(d);for(const d of this.animations)h&&!h(d)||this.Fd.removeAnimation(d);for(const d of this.animationGroups)h&&!h(d)||this.Fd.removeAnimationGroup(d);for(const d of this.multiMaterials)h&&!h(d)||this.Fd.removeMultiMaterial(d);for(const d of this.materials)h&&!h(d)||this.Fd.removeMaterial(d);for(const d of this.morphTargetManagers)h&&!h(d)||this.Fd.removeMorphTargetManager(d);for(const d of this.geometries)h&&!h(d)||this.Fd.removeGeometry(d);for(const d of this.transformNodes)h&&!h(d)||this.Fd.removeTransformNode(d);for(const d of this.actionManagers)h&&!h(d)||this.Fd.removeActionManager(d);for(const d of this.textures)h&&!h(d)||this.Fd.removeTexture(d);for(const d of this.reflectionProbes)h&&!h(d)||this.Fd.removeReflectionProbe(d)}dispose(){const h=this.cameras.slice(0);for(const I of h)I.dispose();this.cameras.length=0;const d=this.lights.slice(0);for(const I of d)I.dispose();this.lights.length=0;const m=this.meshes.slice(0);for(const I of m)I.dispose();this.meshes.length=0;const j=this.skeletons.slice(0);for(const I of j)I.dispose();this.skeletons.length=0;const A=this.animationGroups.slice(0);for(const I of A)I.dispose();this.animationGroups.length=0;const b=this.multiMaterials.slice(0);for(const I of b)I.dispose();this.multiMaterials.length=0;const w=this.materials.slice(0);for(const I of w)I.dispose();this.materials.length=0;const a=this.geometries.slice(0);for(const I of a)I.dispose();this.geometries.length=0;const D=this.transformNodes.slice(0);for(const I of D)I.dispose();this.transformNodes.length=0;const S=this.actionManagers.slice(0);for(const I of S)I.dispose();this.actionManagers.length=0;const M=this.textures.slice(0);for(const I of M)I.dispose();this.textures.length=0;const q=this.reflectionProbes.slice(0);for(const I of q)I.dispose();this.reflectionProbes.length=0;const E=this.morphTargetManagers.slice(0);for(const I of E)I.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const I of this.Fd._serializableComponents)I.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Fd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(h,d,m){if(h&&d)for(const j of h){let h=!0;if(m)for(const d of m)if(j===d){h=!1;break}h&&(d.push(j),j._parentContainer=this)}}moveAllFromScene(h){this._wasAddedToScene=!1,void 0===h&&(h=new L);for(const d in this)Object.prototype.hasOwnProperty.call(this,d)&&(this[d]=this[d]||("_environmentTexture"===d?null:[]),this._moveAssets(this.Fd[d],this[d],h[d]));this.environmentTexture=this.Fd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const h=new w.d("assetContainerRootMesh",this.Fd);for(const d of this.meshes)d.parent||h.addChild(d);return this.meshes.unshift(h),h}mergeAnimationsTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.b.LastCreatedScene,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!h)return S.c.Error("No scene available to merge animations to"),[];const j=m||(d=>{let m=null;const j=d.animations.length?d.animations[0].targetProperty:"",A=d.name.split(".").join("").split("_primitive")[0];switch(j){case"position":case"rotationQuaternion":m=h.getTransformNodeByName(d.name)||h.getTransformNodeByName(A);break;case"influence":m=h.getMorphTargetByName(d.name)||h.getMorphTargetByName(A);break;default:m=h.getNodeByName(d.name)||h.getNodeByName(A)}return m}),A=this.getNodes();for(const a of A){const h=j(a);if(null!==h){for(const d of a.animations){const m=h.animations.filter((h=>h.targetProperty===d.targetProperty));for(const d of m){const m=h.animations.indexOf(d,0);m>-1&&h.animations.splice(m,1)}}h.animations=h.animations.concat(a.animations)}}const b=[],w=this.animationGroups.slice();for(const a of w){b.push(a.clone(a.name,j));for(const h of a.animatables)h.stop()}for(const a of d){const d=j(a.target);d&&(h.beginAnimation(d,a.fromFrame,a.toFrame,a.loopAnimation,a.speedRatio,a.onAnimationEnd?a.onAnimationEnd:void 0,void 0,!0,void 0,a.onAnimationLoop?a.onAnimationLoop:void 0),h.stopAnimation(a.target))}return b}populateRootNodes(){this.rootNodes.length=0;for(const h of this.meshes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.transformNodes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.lights)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.cameras)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h)}addAllAssetsToContainer(h){if(!h)return;const d=[],m=new Set;for(d.push(h);d.length>0;){const h=d.pop();if(h instanceof w.d?(h.Ld&&-1===this.geometries.indexOf(h.Ld)&&this.geometries.push(h.Ld),this.meshes.push(h)):h instanceof q.b?this.meshes.push(h):h instanceof a.c?this.transformNodes.push(h):h instanceof E.d?this.lights.push(h):h instanceof I.e&&this.cameras.push(h),h instanceof D.b){if(h.material&&-1===this.materials.indexOf(h.material)){this.materials.push(h.material);for(const d of h.material.getActiveTextures())-1===this.textures.indexOf(d)&&this.textures.push(d)}h.skeleton&&-1===this.skeletons.indexOf(h.skeleton)&&this.skeletons.push(h.skeleton),h.morphTargetManager&&-1===this.morphTargetManagers.indexOf(h.morphTargetManager)&&this.morphTargetManagers.push(h.morphTargetManager)}for(const j of h.getChildren())m.has(j)||d.push(j);m.add(h)}this.populateRootNodes()}_getByTags(h,d,m){if(void 0===d)return h;const j=[];for(const A in h){const b=h[A];R.e&&R.e.MatchesQuery(b,d)&&(!m||m(b))&&j.push(b)}return j}getMeshesByTags(h,d){return this._getByTags(this.meshes,h,d)}getCamerasByTags(h,d){return this._getByTags(this.cameras,h,d)}getLightsByTags(h,d){return this._getByTags(this.lights,h,d)}getMaterialsByTags(h,d){return this._getByTags(this.materials,h,d).concat(this._getByTags(this.multiMaterials,h,d))}getTransformNodesByTags(h,d){return this._getByTags(this.transformNodes,h,d)}}var v=m(11162);class C{constructor(h){this.byteOffset=0,this.buffer=h}async loadAsync(h){const d=await this.buffer.readAsync(this.byteOffset,h);this._dataView=new DataView(d.buffer,d.byteOffset,d.byteLength),this._dataByteOffset=0}readUint32(){const h=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,h}readUint8Array(h){const d=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,h);return this._dataByteOffset+=h,this.byteOffset+=h,d}readString(h){return(0,v.l)(this.readUint8Array(h))}skipBytes(h){this._dataByteOffset+=h,this.byteOffset+=h}}var T=m(12600);const o="Z2xURg",y={name:"mb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:h=>-1!==h.indexOf("asset")&&-1!==h.indexOf("version")||h.startsWith("data:base64,"+o)||h.startsWith("data:;base64,"+o)||h.startsWith("data:application/octet-stream;base64,"+o)||h.startsWith("data:model/gltf-binary;base64,"+o)};var i,g,F,f=m(11150),H=m(11154);function c(h,d,m){try{return Promise.resolve(new Uint8Array(h,d,m))}catch(j){return Promise.reject(j)}}!function(h){h[h.AUTO=0]="AUTO",h[h.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(i||(i={})),function(h){h[h.NONE=0]="NONE",h[h.FIRST=1]="FIRST",h[h.ALL=2]="ALL"}(g||(g={})),function(h){h[h.LOADING=0]="LOADING",h[h.READY=1]="READY",h[h.COMPLETE=2]="COMPLETE"}(F||(F={}));class k{constructor(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=g.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=h=>Promise.resolve(h),this.extensionOptions={}}D(h){h&&(this.onParsed=h.onParsed,this.coordinateSystemMode=h.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=h.animationStartMode??this.animationStartMode,this.loadNodeAnimations=h.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=h.loadSkins??this.loadSkins,this.loadMorphTargets=h.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=h.compileMaterials??this.compileMaterials,this.useClipPlane=h.useClipPlane??this.useClipPlane,this.compileShadowGenerators=h.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=h.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=h.useRangeRequests??this.useRangeRequests,this.createInstances=h.createInstances??this.createInstances,this.alwaysComputeBoundingBox=h.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=h.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=h.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=h.skipMaterials??this.skipMaterials,this.useSRGBBuffers=h.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=h.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=h.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=h.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=h.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=h.customRootNode,this.onMeshLoaded=h.onMeshLoaded,this.onSkinLoaded=h.onSkinLoaded,this.onTextureLoaded=h.onTextureLoaded,this.onMaterialLoaded=h.onMaterialLoaded,this.onCameraLoaded=h.onCameraLoaded,this.extensionOptions=h.extensionOptions??this.extensionOptions)}}class l extends k{constructor(h){super(),this.onParsedObservable=new j.e,this.onMeshLoadedObservable=new j.e,this.onSkinLoadedObservable=new j.e,this.onTextureLoadedObservable=new j.e,this.onMaterialLoadedObservable=new j.e,this.onCameraLoadedObservable=new j.e,this.onCompleteObservable=new j.e,this.onErrorObservable=new j.e,this.pd=new j.e,this.onExtensionLoadedObservable=new j.e,this.validate=!1,this.onValidatedObservable=new j.e,this._loader=null,this._state=null,this._requests=new Array,this.name=y.name,this.extensions=y.extensions,this.onLoaderStateChangedObservable=new j.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.D(h)}set onParsed(h){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),h&&(this._onParsedObserver=this.onParsedObservable.add(h))}set onMeshLoaded(h){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),h&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(h))}set onSkinLoaded(h){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),h&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((d=>h(d.node,d.skinnedNode))))}set onTextureLoaded(h){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),h&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(h))}set onMaterialLoaded(h){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),h&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(h))}set onCameraLoaded(h){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),h&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(h))}set onComplete(h){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(h)}set onError(h){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(h)}set onDispose(h){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(h)}set onExtensionLoaded(h){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(h)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(h){this._loggingEnabled!==h&&(this._loggingEnabled=h,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(h){this._capturePerformanceCounters!==h&&(this._capturePerformanceCounters=h,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(h){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(h)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const h of this._requests)h.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=h=>Promise.resolve(h),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.pd.notifyObservers(void 0),this.pd.clear()}loadFile(h,d,m,b,w,a,D,M){if(ArrayBuffer.isView(d))return this._loadBinary(h,d,m,b,D,M),null;this._progressCallback=w;const q=d.name||A.e.GetFilename(d);if(a){if(this.useRangeRequests){this.validate&&S.c.Warn("glTF validation is not supported when range requests are enabled");const m={abort:()=>{},onCompleteObservable:new j.e},A={readAsync:(m,j)=>new Promise(((A,b)=>{this._loadFile(h,d,(h=>{A(new Uint8Array(h))}),!0,(h=>{b(h)}),(h=>{h.setRequestHeader("Range",`bytes=${m}-${m+j-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new C(A)).then((h=>{m.onCompleteObservable.notifyObservers(m),b(h)}),D?h=>D(void 0,h):void 0),m}return this._loadFile(h,d,(d=>{this._validate(h,new Uint8Array(d,0,d.byteLength),m,q),this._unpackBinaryAsync(new C({readAsync:(h,m)=>c(d,h,m),byteLength:d.byteLength})).then((h=>{b(h)}),D?h=>D(void 0,h):void 0)}),!0,D)}return this._loadFile(h,d,(d=>{try{this._validate(h,d,m,q),b({json:this._parseJson(d)})}catch{D&&D()}}),!1,D)}_loadBinary(h,d,m,j,A,b){this._validate(h,new Uint8Array(d.buffer,d.byteOffset,d.byteLength),m,b),this._unpackBinaryAsync(new C({readAsync:(h,m)=>function(h,d,m){try{if(d<0||d>=h.byteLength)throw new RangeError("Offset is out of range.");if(d+m>h.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(h.buffer,h.byteOffset+d,m))}catch(j){return Promise.reject(j)}}(d,h,m),byteLength:d.byteLength})).then((h=>{j(h)}),A?h=>A(void 0,h):void 0)}importMeshAsync(h,d,m,j,A,b){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(m),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(m),this._loader.importMeshAsync(h,d,null,m,j,A,b))))}loadAsync(h,d,m,j,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(d),this._loader.loadAsync(h,d,m,j,A))))}loadAssetContainerAsync(h,d,m,j,A){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(d);const b=new V(h),w=[];this.onMaterialLoadedObservable.add((h=>{w.push(h)}));const a=[];this.onTextureLoadedObservable.add((h=>{a.push(h)}));const D=[];this.onCameraLoadedObservable.add((h=>{D.push(h)}));const S=[];return this.onMeshLoadedObservable.add((h=>{h.morphTargetManager&&S.push(h.morphTargetManager)})),this._loader.importMeshAsync(null,h,b,d,m,j,A).then((h=>(Array.prototype.push.apply(b.geometries,h.geometries),Array.prototype.push.apply(b.meshes,h.meshes),Array.prototype.push.apply(b.aE,h.aE),Array.prototype.push.apply(b.skeletons,h.skeletons),Array.prototype.push.apply(b.animationGroups,h.animationGroups),Array.prototype.push.apply(b.materials,w),Array.prototype.push.apply(b.textures,a),Array.prototype.push.apply(b.lights,h.lights),Array.prototype.push.apply(b.transformNodes,h.transformNodes),Array.prototype.push.apply(b.cameras,D),Array.prototype.push.apply(b.morphTargetManagers,S),b)))}))}canDirectLoad(h){return y.canDirectLoad(h)}directLoad(h,d){if(d.startsWith("base64,"+o)||d.startsWith(";base64,"+o)||d.startsWith("application/octet-stream;base64,"+o)||d.startsWith("model/gltf-binary;base64,"+o)){const m=(0,f.e)(d);return this._validate(h,new Uint8Array(m,0,m.byteLength)),this._unpackBinaryAsync(new C({readAsync:(h,d)=>c(m,h,d),byteLength:m.byteLength}))}return this._validate(h,d),Promise.resolve({json:this._parseJson(d)})}createPlugin(h){return new l(h[y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((h,d)=>{this.onCompleteObservable.addOnce((()=>{h()})),this.onErrorObservable.addOnce((h=>{d(h)}))}))}_setState(h){this._state!==h&&(this._state=h,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(F[this._state]))}_loadFile(h,d,m,j,A,b){const w=h._loadFile(d,m,(h=>{this._onProgress(h,w)}),!0,j,A,b);return w.onCompleteObservable.add((()=>{w._lengthComputable=!0,w._total=w._loaded})),this._requests.push(w),w}_onProgress(h,d){if(!this._progressCallback)return;d._lengthComputable=h.lengthComputable,d._loaded=h.loaded,d._total=h.total;let m=!0,j=0,A=0;for(const b of this._requests){if(void 0===b._lengthComputable||void 0===b._loaded||void 0===b._total)return;m=m&&b._lengthComputable,j+=b._loaded,A+=b._total}this._progressCallback({lengthComputable:m,loaded:j,total:m?A:0})}_validate(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),T.b.ValidateAsync(d,m,j,(d=>this.preprocessUrlAsync(m+d).then((d=>h._loadFileAsync(d,void 0,!0,!0).then((h=>new Uint8Array(h,0,h.byteLength))))))).then((h=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(h),this.onValidatedObservable.clear()}),(h=>{this._endPerformanceCounter("Validate JSON"),A.e.Warn(`Failed to validate: ${h.message}`),this.onValidatedObservable.clear()})))}_getLoader(h){const d=h.json.asset||{};this._log(`Asset version: ${d.version}`),d.minVersion&&this._log(`Asset minimum version: ${d.minVersion}`),d.generator&&this._log(`Asset generator: ${d.generator}`);const m=l._parseVersion(d.version);if(!m)throw new Error("Invalid version: "+d.version);if(void 0!==d.minVersion){const h=l._parseVersion(d.minVersion);if(!h)throw new Error("Invalid minimum version: "+d.minVersion);if(l._compareVersion(h,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+d.minVersion)}const j={1:l._CreateGLTF1Loader,2:l._CreateGLTF2Loader}[m.major];if(!j)throw new Error("Unsupported version: "+d.version);return j(this)}_parseJson(h){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${h.length}`);const d=JSON.parse(h);return this._endPerformanceCounter("Parse JSON"),d}_unpackBinaryAsync(h){return this._startPerformanceCounter("Unpack Binary"),h.loadAsync(20).then((()=>{const d=h.readUint32();if(1179937895!==d)throw new H.i("Unexpected magic: "+d,H.e.GLTFLoaderUnexpectedMagicError);const m=h.readUint32();this.loggingEnabled&&this._log(`Binary version: ${m}`);const j=h.readUint32();let A;switch(this.useRangeRequests||j===h.buffer.byteLength||S.c.Warn(`Length in header does not match actual data length: ${j} != ${h.buffer.byteLength}`),m){case 1:A=this._unpackBinaryV1Async(h,j);break;case 2:A=this._unpackBinaryV2Async(h,j);break;default:throw new Error("Unsupported version: "+m)}return this._endPerformanceCounter("Unpack Binary"),A}))}_unpackBinaryV1Async(h,d){const m=h.readUint32(),j=h.readUint32();if(0!==j)throw new Error(`Unexpected content format: ${j}`);const A=d-h.byteOffset,b={json:this._parseJson(h.readString(m)),bin:null};if(0!==A){const d=h.byteOffset;b.bin={readAsync:(m,j)=>h.buffer.readAsync(d+m,j),byteLength:A}}return Promise.resolve(b)}_unpackBinaryV2Async(h,d){const m=1313821514,j=5130562,A=h.readUint32();if(h.readUint32()!==m)throw new Error("First chunk format is not JSON");return h.byteOffset+A===d?h.loadAsync(A).then((()=>({json:this._parseJson(h.readString(A)),bin:null}))):h.loadAsync(A+8).then((()=>{const b={json:this._parseJson(h.readString(A)),bin:null},w=()=>{const A=h.readUint32();switch(h.readUint32()){case m:throw new Error("Unexpected JSON chunk");case j:{const d=h.byteOffset;b.bin={readAsync:(m,j)=>h.buffer.readAsync(d+m,j),byteLength:A},h.skipBytes(A);break}default:h.skipBytes(A)}return h.byteOffset!==d?h.loadAsync(8).then(w):Promise.resolve(b)};return w()}))}static _parseVersion(h){if("1.0"===h||"1.0.1"===h)return{major:1,minor:0};const d=(h+"").match(/^(\d+)\.(\d+)/);return d?{major:parseInt(d[1]),minor:parseInt(d[2])}:null}static _compareVersion(h,d){return h.major>d.major?1:h.major<d.major?-1:h.minor>d.minor?1:h.minor<d.minor?-1:0}_logOpen(h){this._log(h),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(h){const d=l._logSpaces.substring(0,2*this._logIndentLevel);S.c.Log(`${d}${h}`)}_logDisabled(h){}_startPerformanceCounterEnabled(h){A.e.StartPerformanceCounter(h)}_startPerformanceCounterDisabled(h){}_endPerformanceCounterEnabled(h){A.e.EndPerformanceCounter(h)}_endPerformanceCounterDisabled(h){}}l.IncrementalLoading=!0,l.HomogeneousCoordinates=!1,l._logSpaces="                                ",(0,b.d)(new l)},12600:(h,d,m)=>{"use strict";m.d(d,{b:()=>w});var j=m(11107);function A(h,d,m,j){const A={externalResourceFunction:j};return m&&(A.uri="file:"===d?m:d+m),ArrayBuffer.isView(h)?GLTFValidator.validateBytes(h,A):GLTFValidator.validateString(h,A)}function b(){const h=[];onmessage=d=>{const m=d.data;switch(m.id){case"init":importScripts(m.url);break;case"validate":A(m.data,m.rootUrl,m.fileName,(d=>new Promise(((m,j)=>{const A=h.length;h.push({resolve:m,reject:j}),postMessage({id:"getExternalResource",index:A,uri:d})})))).then((h=>{postMessage({id:"validate.resolve",value:h})}),(h=>{postMessage({id:"validate.reject",reason:h})}));break;case"getExternalResource.resolve":h[m.index].resolve(m.value);break;case"getExternalResource.reject":h[m.index].reject(m.reason)}}}class w{static ValidateAsync(h,d,m,w){return"function"===typeof Worker?new Promise(((a,D)=>{const S=`${A}(${b})()`,M=URL.createObjectURL(new Blob([S],{type:"application/javascript"})),q=new Worker(M),E=h=>{q.removeEventListener("error",E),q.removeEventListener("message",I),D(h)},I=h=>{const d=h.data;switch(d.id){case"getExternalResource":w(d.uri).then((h=>{q.postMessage({id:"getExternalResource.resolve",index:d.index,value:h},[h.buffer])}),(h=>{q.postMessage({id:"getExternalResource.reject",index:d.index,reason:h})}));break;case"validate.resolve":q.removeEventListener("error",E),q.removeEventListener("message",I),a(d.value),q.terminate();break;case"validate.reject":q.removeEventListener("error",E),q.removeEventListener("message",I),D(d.reason),q.terminate()}};if(q.addEventListener("error",E),q.addEventListener("message",I),q.postMessage({id:"init",url:j.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(h)){const j=h.slice();q.postMessage({id:"validate",data:j,rootUrl:d,fileName:m},[j.buffer])}else q.postMessage({id:"validate",data:h,rootUrl:d,fileName:m})})):(this._LoadScriptPromise||(this._LoadScriptPromise=j.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>A(h,d,m,w))))}}w.Configuration={url:`${j.e._DefaultCdnUrl}/gltf_validator.js`}},13116:(h,d,m)=>{"use strict";m.d(d,{c:()=>y});var j=m(11258),A=m(11261),b=m(11341),w=m(11058),a=m(11647),D=m(11663),S=m(11281),M=m(11604),q=m(11080),E=m(11200);m(12367),m(12271),m(12295),m(12278),m(12297),m(12299),m(12308);const I="imageProcessingCompatibility",R="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";E.b.IncludesShadersStore[I]||(E.b.IncludesShadersStore[I]=R);const Z="skyPixelShader",L="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";E.b.ShadersStore[Z]||(E.b.ShadersStore[Z]=L);m(12373),m(12315),m(12324),m(12331),m(12327);const B="skyVertexShader",V="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";E.b.ShadersStore[B]||(E.b.ShadersStore[B]=V);var v=m(11684),C=m(11363),T=m(11357);class o extends a.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class y extends D.c{constructor(h,d){super(h,d),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new w.i(0,100,0),this.useSunPosition=!1,this.cameraOffset=w.i.Zero(),this.up=w.i.Up(),this.dithering=!1,this._cameraPosition=w.i.Zero(),this._skyOrientation=new w.c}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(h,d){const m=d._drawWrapper;if(this.isFrozen&&m.effect&&m._wasPreviouslyReady)return!0;d.materialDefines||(d.materialDefines=new o);const j=d.materialDefines,A=this.ih();if(this._isReadyForSubMesh(d))return!0;if((0,T.X)(h,A,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,j),(0,T.I)(h,j,!0,!1),j.IMAGEPROCESSINGPOSTPROCESS!==A.imageProcessingConfiguration.applyByPostProcess&&j.markAsMiscDirty(),j.DITHER!==this.dithering&&j.markAsMiscDirty(),j.isDirty){j.markAsProcessed(),A.resetCachedMaterial();const h=new v.e;j.FOG&&h.addFallback(1,"FOG"),j.IMAGEPROCESSINGPOSTPROCESS=A.imageProcessingConfiguration.applyByPostProcess,j.DITHER=this.dithering;const m=[S.d.PositionKind];j.VERTEXCOLOR&&m.push(S.d.ColorKind);const b="sky",w=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,C.b)(w);const a=j.toString();d.setEffect(A.getEngine().createEffect(b,m,w,[],a,h,this.onCompiled,this.onError),j,this._materialContext)}return!(!d.effect||!d.effect.isReady())&&(j._renderId=A.getRenderId(),m._wasPreviouslyReady=!0,!0)}bindForSubMesh(h,d,m){const j=this.ih(),A=m.materialDefines;if(!A)return;const b=m.effect;if(!b)return;this._activeEffect=b,this.bindOnlyWorldMatrix(h),this._activeEffect.setMatrix("viewProjection",j.getTransformMatrix()),this._mustRebind(j,b,m)&&((0,C.f)(b,this,j),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,T.l)(A,b,j)),j.fogEnabled&&d.applyFog&&j.fogMode!==M.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",j.getViewMatrix()),(0,T.g)(j,d,this._activeEffect);const a=j.activeCamera;if(a){const h=a.getWorldMatrix();this._cameraPosition.x=h.m[12],this._cameraPosition.y=h.m[13],this._cameraPosition.z=h.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const h=Math.PI*(this.inclination-.5),d=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(d)*Math.cos(h),this.sunPosition.y=this.distance*Math.sin(-h),this.sunPosition.z=this.distance*Math.sin(d)*Math.cos(h),w.c.FromUnitVectorsToRef(w.i.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(d,this._activeEffect,m)}getAnimatables(){return[]}dispose(h){super.dispose(h)}clone(h){return b.d.Clone((()=>new y(h,this.ih())),this)}serialize(){const h=super.serialize();return h.customType="BABYLON.SkyMaterial",h}getClassName(){return"SkyMaterial"}static Parse(h,d,m){return b.d.Parse((()=>new y(h.name,d)),h,d,m)}}(0,j.d)([(0,A.M)()],y.prototype,"luminance",void 0),(0,j.d)([(0,A.M)()],y.prototype,"turbidity",void 0),(0,j.d)([(0,A.M)()],y.prototype,"rayleigh",void 0),(0,j.d)([(0,A.M)()],y.prototype,"mieCoefficient",void 0),(0,j.d)([(0,A.M)()],y.prototype,"mieDirectionalG",void 0),(0,j.d)([(0,A.M)()],y.prototype,"distance",void 0),(0,j.d)([(0,A.M)()],y.prototype,"inclination",void 0),(0,j.d)([(0,A.M)()],y.prototype,"azimuth",void 0),(0,j.d)([(0,A.K)()],y.prototype,"sunPosition",void 0),(0,j.d)([(0,A.M)()],y.prototype,"useSunPosition",void 0),(0,j.d)([(0,A.K)()],y.prototype,"cameraOffset",void 0),(0,j.d)([(0,A.K)()],y.prototype,"up",void 0),(0,j.d)([(0,A.M)()],y.prototype,"dithering",void 0),(0,q.i)("BABYLON.SkyMaterial",y)},11835:(h,d,m)=>{"use strict";function j(h,d){d.headers=h.headers||{},d.statusMessage=h.statusText,d.statusCode=h.status,d.data=h.response}function A(h,d,m){return new Promise((function(A,b){m=m||{};var w,a,D,S=new XMLHttpRequest,M=m.body,q=m.headers||{};for(w in m.timeout&&(S.timeout=m.timeout),S.ontimeout=S.onerror=function(h){h.timeout="timeout"==h.type,b(h)},S.open(h,d.href||d),S.onload=function(){for(D=S.getAllResponseHeaders().trim().split(/[\r\n]+/),j(S,S);a=D.shift();)a=a.split(": "),S.headers[a.shift().toLowerCase()]=a.join(": ");if((a=S.headers["content-type"])&&~a.indexOf("application/json"))try{S.data=JSON.parse(S.data,m.reviver)}catch(h){return j(S,h),b(h)}(S.status>=400?b:A)(S)},typeof FormData<"u"&&M instanceof FormData||M&&"object"==typeof M&&(q["content-type"]="application/json",M=JSON.stringify(M)),S.withCredentials=!!m.withCredentials,q)S.setRequestHeader(w,q[w]);S.send(M)}))}m.r(d),m.d(d,{del:()=>D,get:()=>b,patch:()=>a,post:()=>w,put:()=>S,send:()=>A});var b=A.bind(A,"GET"),w=A.bind(A,"POST"),a=A.bind(A,"PATCH"),D=A.bind(A,"DELETE"),S=A.bind(A,"PUT")},13210:(h,d,m)=>{"use strict";m.d(d,{d:()=>q});const j=.5*(Math.sqrt(3)-1),A=(3-Math.sqrt(3))/6,b=1/3,w=1/6,a=(Math.sqrt(5)-1)/4,D=(5-Math.sqrt(5))/20,S=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),M=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const q=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const d="function"==typeof h?h:function(h){let d=0,m=0,j=0,A=1;const b=function(){let h=4022871197;return function(d){d=d.toString();for(let m=0;m<d.length;m++){h+=d.charCodeAt(m);let j=.02519603282416938*h;h=j>>>0,j-=h,j*=h,h=j>>>0,j-=h,h+=4294967296*j}return 2.3283064365386963e-10*(h>>>0)}}();d=b(" "),m=b(" "),j=b(" "),d-=b(h),d<0&&(d+=1);m-=b(h),m<0&&(m+=1);j-=b(h),j<0&&(j+=1);return function(){const h=2091639*d+2.3283064365386963e-10*A;return d=m,m=j,j=h-(A=0|h)}}(h);this.p=function(h){const d=new Uint8Array(256);for(let m=0;m<256;m++)d[m]=m;for(let m=0;m<255;m++){const j=m+~~(h()*(256-m)),A=d[m];d[m]=d[j],d[j]=A}return d}(d),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let m=0;m<512;m++)this.perm[m]=this.p[255&m],this.permMod12[m]=this.perm[m]%12}noise2D(h,d){const m=this.permMod12,b=this.perm;let w=0,a=0,D=0;const M=(h+d)*j,q=Math.floor(h+M),E=Math.floor(d+M),I=(q+E)*A,R=h-(q-I),Z=d-(E-I);let L,B;R>Z?(L=1,B=0):(L=0,B=1);const V=R-L+A,v=Z-B+A,C=R-1+2*A,T=Z-1+2*A,o=255&q,y=255&E;let i=.5-R*R-Z*Z;if(i>=0){const h=3*m[o+b[y]];i*=i,w=i*i*(S[h]*R+S[h+1]*Z)}let g=.5-V*V-v*v;if(g>=0){const h=3*m[o+L+b[y+B]];g*=g,a=g*g*(S[h]*V+S[h+1]*v)}let F=.5-C*C-T*T;if(F>=0){const h=3*m[o+1+b[y+1]];F*=F,D=F*F*(S[h]*C+S[h+1]*T)}return 70*(w+a+D)}noise3D(h,d,m){const j=this.permMod12,A=this.perm;let a,D,M,q;const E=(h+d+m)*b,I=Math.floor(h+E),R=Math.floor(d+E),Z=Math.floor(m+E),L=(I+R+Z)*w,B=h-(I-L),V=d-(R-L),v=m-(Z-L);let C,T,o,y,i,g;B>=V?V>=v?(C=1,T=0,o=0,y=1,i=1,g=0):B>=v?(C=1,T=0,o=0,y=1,i=0,g=1):(C=0,T=0,o=1,y=1,i=0,g=1):V<v?(C=0,T=0,o=1,y=0,i=1,g=1):B<v?(C=0,T=1,o=0,y=0,i=1,g=1):(C=0,T=1,o=0,y=1,i=1,g=0);const F=B-C+w,f=V-T+w,H=v-o+w,c=B-y+2*w,k=V-i+2*w,l=v-g+2*w,K=B-1+.5,N=V-1+.5,W=v-1+.5,r=255&I,Y=255&R,x=255&Z;let Q=.6-B*B-V*V-v*v;if(Q<0)a=0;else{const h=3*j[r+A[Y+A[x]]];Q*=Q,a=Q*Q*(S[h]*B+S[h+1]*V+S[h+2]*v)}let t=.6-F*F-f*f-H*H;if(t<0)D=0;else{const h=3*j[r+C+A[Y+T+A[x+o]]];t*=t,D=t*t*(S[h]*F+S[h+1]*f+S[h+2]*H)}let U=.6-c*c-k*k-l*l;if(U<0)M=0;else{const h=3*j[r+y+A[Y+i+A[x+g]]];U*=U,M=U*U*(S[h]*c+S[h+1]*k+S[h+2]*l)}let s=.6-K*K-N*N-W*W;if(s<0)q=0;else{const h=3*j[r+1+A[Y+1+A[x+1]]];s*=s,q=s*s*(S[h]*K+S[h+1]*N+S[h+2]*W)}return 32*(a+D+M+q)}noise4D(h,d,m,j){const A=this.perm;let b,w,S,q,E;const I=(h+d+m+j)*a,R=Math.floor(h+I),Z=Math.floor(d+I),L=Math.floor(m+I),B=Math.floor(j+I),V=(R+Z+L+B)*D,v=h-(R-V),C=d-(Z-V),T=m-(L-V),o=j-(B-V);let y=0,i=0,g=0,F=0;v>C?y++:i++,v>T?y++:g++,v>o?y++:F++,C>T?i++:g++,C>o?i++:F++,T>o?g++:F++;const f=y>=3?1:0,H=i>=3?1:0,c=g>=3?1:0,k=F>=3?1:0,l=y>=2?1:0,K=i>=2?1:0,N=g>=2?1:0,W=F>=2?1:0,r=y>=1?1:0,Y=i>=1?1:0,x=g>=1?1:0,Q=F>=1?1:0,t=v-f+D,U=C-H+D,s=T-c+D,J=o-k+D,O=v-l+2*D,n=C-K+2*D,p=T-N+2*D,e=o-W+2*D,X=v-r+3*D,z=C-Y+3*D,u=T-x+3*D,P=o-Q+3*D,G=v-1+4*D,hh=C-1+4*D,dh=T-1+4*D,mh=o-1+4*D,jh=255&R,Ah=255&Z,bh=255&L,wh=255&B;let ah=.6-v*v-C*C-T*T-o*o;if(ah<0)b=0;else{const h=A[jh+A[Ah+A[bh+A[wh]]]]%32*4;ah*=ah,b=ah*ah*(M[h]*v+M[h+1]*C+M[h+2]*T+M[h+3]*o)}let Dh=.6-t*t-U*U-s*s-J*J;if(Dh<0)w=0;else{const h=A[jh+f+A[Ah+H+A[bh+c+A[wh+k]]]]%32*4;Dh*=Dh,w=Dh*Dh*(M[h]*t+M[h+1]*U+M[h+2]*s+M[h+3]*J)}let Sh=.6-O*O-n*n-p*p-e*e;if(Sh<0)S=0;else{const h=A[jh+l+A[Ah+K+A[bh+N+A[wh+W]]]]%32*4;Sh*=Sh,S=Sh*Sh*(M[h]*O+M[h+1]*n+M[h+2]*p+M[h+3]*e)}let Mh=.6-X*X-z*z-u*u-P*P;if(Mh<0)q=0;else{const h=A[jh+r+A[Ah+Y+A[bh+x+A[wh+Q]]]]%32*4;Mh*=Mh,q=Mh*Mh*(M[h]*X+M[h+1]*z+M[h+2]*u+M[h+3]*P)}let qh=.6-G*G-hh*hh-dh*dh-mh*mh;if(qh<0)E=0;else{const h=A[jh+1+A[Ah+1+A[bh+1+A[wh+1]]]]%32*4;qh*=qh,E=qh*qh*(M[h]*G+M[h+1]*hh+M[h+2]*dh+M[h+3]*mh)}return 27*(b+w+S+q+E)}}}}]);